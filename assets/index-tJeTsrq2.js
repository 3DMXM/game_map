const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BqvrvH4_.js","assets/index-CEEIE3Nn.css"])))=>i.map(i=>d[i]);
(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const A of document.querySelectorAll('link[rel="modulepreload"]'))v(A);new MutationObserver(A=>{for(const R of A)if(R.type==="childList")for(const D of R.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&v(D)}).observe(document,{childList:!0,subtree:!0});function p(A){const R={};return A.integrity&&(R.integrity=A.integrity),A.referrerPolicy&&(R.referrerPolicy=A.referrerPolicy),A.crossOrigin==="use-credentials"?R.credentials="include":A.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function v(A){if(A.ep)return;A.ep=!0;const R=p(A);fetch(A.href,R)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function _1(r){const l=Object.create(null);for(const p of r.split(","))l[p]=1;return p=>p in l}const ii={},Ed=[],yo=()=>{},WD=()=>!1,Ry=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&(r.charCodeAt(2)>122||r.charCodeAt(2)<97),g1=r=>r.startsWith("onUpdate:"),Wi=Object.assign,y1=(r,l)=>{const p=r.indexOf(l);p>-1&&r.splice(p,1)},ZD=Object.prototype.hasOwnProperty,Hn=(r,l)=>ZD.call(r,l),Vr=Array.isArray,Ad=r=>Dm(r)==="[object Map]",Dy=r=>Dm(r)==="[object Set]",YT=r=>Dm(r)==="[object Date]",Zr=r=>typeof r=="function",qn=r=>typeof r=="string",ua=r=>typeof r=="symbol",Un=r=>r!==null&&typeof r=="object",ay=r=>(Un(r)||Zr(r))&&Zr(r.then)&&Zr(r.catch),LA=Object.prototype.toString,Dm=r=>LA.call(r),XD=r=>Dm(r).slice(8,-1),OA=r=>Dm(r)==="[object Object]",v1=r=>qn(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,im=_1(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),zy=r=>{const l=Object.create(null);return p=>l[p]||(l[p]=r(p))},KD=/-(\w)/g,js=zy(r=>r.replace(KD,(l,p)=>p?p.toUpperCase():"")),YD=/\B([A-Z])/g,Ac=zy(r=>r.replace(YD,"-$1").toLowerCase()),Mc=zy(r=>r.charAt(0).toUpperCase()+r.slice(1)),ux=zy(r=>r?`on${Mc(r)}`:""),xc=(r,l)=>!Object.is(r,l),Xg=(r,...l)=>{for(let p=0;p<r.length;p++)r[p](...l)},kA=(r,l,p,v=!1)=>{Object.defineProperty(r,l,{configurable:!0,enumerable:!1,writable:v,value:p})},kx=r=>{const l=parseFloat(r);return isNaN(l)?r:l},JD=r=>{const l=qn(r)?Number(r):NaN;return isNaN(l)?r:l};let JT;const Ly=()=>JT||(JT=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Vu(r){if(Vr(r)){const l={};for(let p=0;p<r.length;p++){const v=r[p],A=qn(v)?rz(v):Vu(v);if(A)for(const R in A)l[R]=A[R]}return l}else if(qn(r)||Un(r))return r}const QD=/;(?![^(]*\))/g,ez=/:([^]+)/,tz=/\/\*[^]*?\*\//g;function rz(r){const l={};return r.replace(tz,"").split(QD).forEach(p=>{if(p){const v=p.split(ez);v.length>1&&(l[v[0].trim()]=v[1].trim())}}),l}function kn(r){let l="";if(qn(r))l=r;else if(Vr(r))for(let p=0;p<r.length;p++){const v=kn(r[p]);v&&(l+=v+" ")}else if(Un(r))for(const p in r)r[p]&&(l+=p+" ");return l.trim()}function _j(r){if(!r)return null;let{class:l,style:p}=r;return l&&!qn(l)&&(r.class=kn(l)),p&&(r.style=Vu(p)),r}const nz="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",iz=_1(nz);function FA(r){return!!r||r===""}function sz(r,l){if(r.length!==l.length)return!1;let p=!0;for(let v=0;p&&v<r.length;v++)p=Rd(r[v],l[v]);return p}function Rd(r,l){if(r===l)return!0;let p=YT(r),v=YT(l);if(p||v)return p&&v?r.getTime()===l.getTime():!1;if(p=ua(r),v=ua(l),p||v)return r===l;if(p=Vr(r),v=Vr(l),p||v)return p&&v?sz(r,l):!1;if(p=Un(r),v=Un(l),p||v){if(!p||!v)return!1;const A=Object.keys(r).length,R=Object.keys(l).length;if(A!==R)return!1;for(const D in r){const i=r.hasOwnProperty(D),G=l.hasOwnProperty(D);if(i&&!G||!i&&G||!Rd(r[D],l[D]))return!1}}return String(r)===String(l)}function BA(r,l){return r.findIndex(p=>Rd(p,l))}const NA=r=>!!(r&&r.__v_isRef===!0),Vs=r=>qn(r)?r:r==null?"":Vr(r)||Un(r)&&(r.toString===LA||!Zr(r.toString))?NA(r)?Vs(r.value):JSON.stringify(r,VA,2):String(r),VA=(r,l)=>NA(l)?VA(r,l.value):Ad(l)?{[`Map(${l.size})`]:[...l.entries()].reduce((p,[v,A],R)=>(p[hx(v,R)+" =>"]=A,p),{})}:Dy(l)?{[`Set(${l.size})`]:[...l.values()].map(p=>hx(p))}:ua(l)?hx(l):Un(l)&&!Vr(l)&&!OA(l)?String(l):l,hx=(r,l="")=>{var p;return ua(r)?`Symbol(${(p=r.description)!=null?p:l})`:r};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ks;class UA{constructor(l=!1){this.detached=l,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=ks,!l&&ks&&(this.index=(ks.scopes||(ks.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let l,p;if(this.scopes)for(l=0,p=this.scopes.length;l<p;l++)this.scopes[l].pause();for(l=0,p=this.effects.length;l<p;l++)this.effects[l].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let l,p;if(this.scopes)for(l=0,p=this.scopes.length;l<p;l++)this.scopes[l].resume();for(l=0,p=this.effects.length;l<p;l++)this.effects[l].resume()}}run(l){if(this._active){const p=ks;try{return ks=this,l()}finally{ks=p}}}on(){ks=this}off(){ks=this.parent}stop(l){if(this._active){this._active=!1;let p,v;for(p=0,v=this.effects.length;p<v;p++)this.effects[p].stop();for(this.effects.length=0,p=0,v=this.cleanups.length;p<v;p++)this.cleanups[p]();if(this.cleanups.length=0,this.scopes){for(p=0,v=this.scopes.length;p<v;p++)this.scopes[p].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!l){const A=this.parent.scopes.pop();A&&A!==this&&(this.parent.scopes[this.index]=A,A.index=this.index)}this.parent=void 0}}}function x1(r){return new UA(r)}function b1(){return ks}function Oy(r,l=!1){ks&&ks.cleanups.push(r)}let ai;const dx=new WeakSet;class jA{constructor(l){this.fn=l,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,ks&&ks.active&&ks.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,dx.has(this)&&(dx.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||GA(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,QT(this),HA(this);const l=ai,p=ca;ai=this,ca=!0;try{return this.fn()}finally{qA(this),ai=l,ca=p,this.flags&=-3}}stop(){if(this.flags&1){for(let l=this.deps;l;l=l.nextDep)S1(l);this.deps=this.depsTail=void 0,QT(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?dx.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Fx(this)&&this.run()}get dirty(){return Fx(this)}}let $A=0,sm,om;function GA(r,l=!1){if(r.flags|=8,l){r.next=om,om=r;return}r.next=sm,sm=r}function w1(){$A++}function T1(){if(--$A>0)return;if(om){let l=om;for(om=void 0;l;){const p=l.next;l.next=void 0,l.flags&=-9,l=p}}let r;for(;sm;){let l=sm;for(sm=void 0;l;){const p=l.next;if(l.next=void 0,l.flags&=-9,l.flags&1)try{l.trigger()}catch(v){r||(r=v)}l=p}}if(r)throw r}function HA(r){for(let l=r.deps;l;l=l.nextDep)l.version=-1,l.prevActiveLink=l.dep.activeLink,l.dep.activeLink=l}function qA(r){let l,p=r.depsTail,v=p;for(;v;){const A=v.prevDep;v.version===-1?(v===p&&(p=A),S1(v),oz(v)):l=v,v.dep.activeLink=v.prevActiveLink,v.prevActiveLink=void 0,v=A}r.deps=l,r.depsTail=p}function Fx(r){for(let l=r.deps;l;l=l.nextDep)if(l.dep.version!==l.version||l.dep.computed&&(WA(l.dep.computed)||l.dep.version!==l.version))return!0;return!!r._dirty}function WA(r){if(r.flags&4&&!(r.flags&16)||(r.flags&=-17,r.globalVersion===pm))return;r.globalVersion=pm;const l=r.dep;if(r.flags|=2,l.version>0&&!r.isSSR&&r.deps&&!Fx(r)){r.flags&=-3;return}const p=ai,v=ca;ai=r,ca=!0;try{HA(r);const A=r.fn(r._value);(l.version===0||xc(A,r._value))&&(r._value=A,l.version++)}catch(A){throw l.version++,A}finally{ai=p,ca=v,qA(r),r.flags&=-3}}function S1(r,l=!1){const{dep:p,prevSub:v,nextSub:A}=r;if(v&&(v.nextSub=A,r.prevSub=void 0),A&&(A.prevSub=v,r.nextSub=void 0),p.subs===r&&(p.subs=v,!v&&p.computed)){p.computed.flags&=-5;for(let R=p.computed.deps;R;R=R.nextDep)S1(R,!0)}!l&&!--p.sc&&p.map&&p.map.delete(p.key)}function oz(r){const{prevDep:l,nextDep:p}=r;l&&(l.nextDep=p,r.prevDep=void 0),p&&(p.prevDep=l,r.nextDep=void 0)}let ca=!0;const ZA=[];function Ic(){ZA.push(ca),ca=!1}function Cc(){const r=ZA.pop();ca=r===void 0?!0:r}function QT(r){const{cleanup:l}=r;if(r.cleanup=void 0,l){const p=ai;ai=void 0;try{l()}finally{ai=p}}}let pm=0;class az{constructor(l,p){this.sub=l,this.dep=p,this.version=p.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class E1{constructor(l){this.computed=l,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(l){if(!ai||!ca||ai===this.computed)return;let p=this.activeLink;if(p===void 0||p.sub!==ai)p=this.activeLink=new az(ai,this),ai.deps?(p.prevDep=ai.depsTail,ai.depsTail.nextDep=p,ai.depsTail=p):ai.deps=ai.depsTail=p,XA(p);else if(p.version===-1&&(p.version=this.version,p.nextDep)){const v=p.nextDep;v.prevDep=p.prevDep,p.prevDep&&(p.prevDep.nextDep=v),p.prevDep=ai.depsTail,p.nextDep=void 0,ai.depsTail.nextDep=p,ai.depsTail=p,ai.deps===p&&(ai.deps=v)}return p}trigger(l){this.version++,pm++,this.notify(l)}notify(l){w1();try{for(let p=this.subs;p;p=p.prevSub)p.sub.notify()&&p.sub.dep.notify()}finally{T1()}}}function XA(r){if(r.dep.sc++,r.sub.flags&4){const l=r.dep.computed;if(l&&!r.dep.subs){l.flags|=20;for(let v=l.deps;v;v=v.nextDep)XA(v)}const p=r.dep.subs;p!==r&&(r.prevSub=p,p&&(p.nextSub=r)),r.dep.subs=r}}const ly=new WeakMap,Lu=Symbol(""),Bx=Symbol(""),mm=Symbol("");function fs(r,l,p){if(ca&&ai){let v=ly.get(r);v||ly.set(r,v=new Map);let A=v.get(p);A||(v.set(p,A=new E1),A.map=v,A.key=p),A.track()}}function gl(r,l,p,v,A,R){const D=ly.get(r);if(!D){pm++;return}const i=G=>{G&&G.trigger()};if(w1(),l==="clear")D.forEach(i);else{const G=Vr(r),W=G&&v1(p);if(G&&p==="length"){const H=Number(v);D.forEach((ee,ne)=>{(ne==="length"||ne===mm||!ua(ne)&&ne>=H)&&i(ee)})}else switch((p!==void 0||D.has(void 0))&&i(D.get(p)),W&&i(D.get(mm)),l){case"add":G?W&&i(D.get("length")):(i(D.get(Lu)),Ad(r)&&i(D.get(Bx)));break;case"delete":G||(i(D.get(Lu)),Ad(r)&&i(D.get(Bx)));break;case"set":Ad(r)&&i(D.get(Lu));break}}T1()}function lz(r,l){const p=ly.get(r);return p&&p.get(l)}function _d(r){const l=zn(r);return l===r?l:(fs(l,"iterate",mm),No(r)?l:l.map(ps))}function ky(r){return fs(r=zn(r),"iterate",mm),r}const cz={__proto__:null,[Symbol.iterator](){return fx(this,Symbol.iterator,ps)},concat(...r){return _d(this).concat(...r.map(l=>Vr(l)?_d(l):l))},entries(){return fx(this,"entries",r=>(r[1]=ps(r[1]),r))},every(r,l){return fl(this,"every",r,l,void 0,arguments)},filter(r,l){return fl(this,"filter",r,l,p=>p.map(ps),arguments)},find(r,l){return fl(this,"find",r,l,ps,arguments)},findIndex(r,l){return fl(this,"findIndex",r,l,void 0,arguments)},findLast(r,l){return fl(this,"findLast",r,l,ps,arguments)},findLastIndex(r,l){return fl(this,"findLastIndex",r,l,void 0,arguments)},forEach(r,l){return fl(this,"forEach",r,l,void 0,arguments)},includes(...r){return px(this,"includes",r)},indexOf(...r){return px(this,"indexOf",r)},join(r){return _d(this).join(r)},lastIndexOf(...r){return px(this,"lastIndexOf",r)},map(r,l){return fl(this,"map",r,l,void 0,arguments)},pop(){return Yp(this,"pop")},push(...r){return Yp(this,"push",r)},reduce(r,...l){return eS(this,"reduce",r,l)},reduceRight(r,...l){return eS(this,"reduceRight",r,l)},shift(){return Yp(this,"shift")},some(r,l){return fl(this,"some",r,l,void 0,arguments)},splice(...r){return Yp(this,"splice",r)},toReversed(){return _d(this).toReversed()},toSorted(r){return _d(this).toSorted(r)},toSpliced(...r){return _d(this).toSpliced(...r)},unshift(...r){return Yp(this,"unshift",r)},values(){return fx(this,"values",ps)}};function fx(r,l,p){const v=ky(r),A=v[l]();return v!==r&&!No(r)&&(A._next=A.next,A.next=()=>{const R=A._next();return R.value&&(R.value=p(R.value)),R}),A}const uz=Array.prototype;function fl(r,l,p,v,A,R){const D=ky(r),i=D!==r&&!No(r),G=D[l];if(G!==uz[l]){const ee=G.apply(r,R);return i?ps(ee):ee}let W=p;D!==r&&(i?W=function(ee,ne){return p.call(this,ps(ee),ne,r)}:p.length>2&&(W=function(ee,ne){return p.call(this,ee,ne,r)}));const H=G.call(D,W,v);return i&&A?A(H):H}function eS(r,l,p,v){const A=ky(r);let R=p;return A!==r&&(No(r)?p.length>3&&(R=function(D,i,G){return p.call(this,D,i,G,r)}):R=function(D,i,G){return p.call(this,D,ps(i),G,r)}),A[l](R,...v)}function px(r,l,p){const v=zn(r);fs(v,"iterate",mm);const A=v[l](...p);return(A===-1||A===!1)&&I1(p[0])?(p[0]=zn(p[0]),v[l](...p)):A}function Yp(r,l,p=[]){Ic(),w1();const v=zn(r)[l].apply(r,p);return T1(),Cc(),v}const hz=_1("__proto__,__v_isRef,__isVue"),KA=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(ua));function dz(r){ua(r)||(r=String(r));const l=zn(this);return fs(l,"has",r),l.hasOwnProperty(r)}class YA{constructor(l=!1,p=!1){this._isReadonly=l,this._isShallow=p}get(l,p,v){if(p==="__v_skip")return l.__v_skip;const A=this._isReadonly,R=this._isShallow;if(p==="__v_isReactive")return!A;if(p==="__v_isReadonly")return A;if(p==="__v_isShallow")return R;if(p==="__v_raw")return v===(A?R?wz:tM:R?eM:QA).get(l)||Object.getPrototypeOf(l)===Object.getPrototypeOf(v)?l:void 0;const D=Vr(l);if(!A){let G;if(D&&(G=cz[p]))return G;if(p==="hasOwnProperty")return dz}const i=Reflect.get(l,p,Yn(l)?l:v);return(ua(p)?KA.has(p):hz(p))||(A||fs(l,"get",p),R)?i:Yn(i)?D&&v1(p)?i:i.value:Un(i)?A?Vd(i):Ki(i):i}}class JA extends YA{constructor(l=!1){super(!1,l)}set(l,p,v,A){let R=l[p];if(!this._isShallow){const G=Uu(R);if(!No(v)&&!Uu(v)&&(R=zn(R),v=zn(v)),!Vr(l)&&Yn(R)&&!Yn(v))return G?!1:(R.value=v,!0)}const D=Vr(l)&&v1(p)?Number(p)<l.length:Hn(l,p),i=Reflect.set(l,p,v,Yn(l)?l:A);return l===zn(A)&&(D?xc(v,R)&&gl(l,"set",p,v):gl(l,"add",p,v)),i}deleteProperty(l,p){const v=Hn(l,p);l[p];const A=Reflect.deleteProperty(l,p);return A&&v&&gl(l,"delete",p,void 0),A}has(l,p){const v=Reflect.has(l,p);return(!ua(p)||!KA.has(p))&&fs(l,"has",p),v}ownKeys(l){return fs(l,"iterate",Vr(l)?"length":Lu),Reflect.ownKeys(l)}}class fz extends YA{constructor(l=!1){super(!0,l)}set(l,p){return!0}deleteProperty(l,p){return!0}}const pz=new JA,mz=new fz,_z=new JA(!0);const Nx=r=>r,kg=r=>Reflect.getPrototypeOf(r);function gz(r,l,p){return function(...v){const A=this.__v_raw,R=zn(A),D=Ad(R),i=r==="entries"||r===Symbol.iterator&&D,G=r==="keys"&&D,W=A[r](...v),H=p?Nx:l?Vx:ps;return!l&&fs(R,"iterate",G?Bx:Lu),{next(){const{value:ee,done:ne}=W.next();return ne?{value:ee,done:ne}:{value:i?[H(ee[0]),H(ee[1])]:H(ee),done:ne}},[Symbol.iterator](){return this}}}}function Fg(r){return function(...l){return r==="delete"?!1:r==="clear"?void 0:this}}function yz(r,l){const p={get(A){const R=this.__v_raw,D=zn(R),i=zn(A);r||(xc(A,i)&&fs(D,"get",A),fs(D,"get",i));const{has:G}=kg(D),W=l?Nx:r?Vx:ps;if(G.call(D,A))return W(R.get(A));if(G.call(D,i))return W(R.get(i));R!==D&&R.get(A)},get size(){const A=this.__v_raw;return!r&&fs(zn(A),"iterate",Lu),Reflect.get(A,"size",A)},has(A){const R=this.__v_raw,D=zn(R),i=zn(A);return r||(xc(A,i)&&fs(D,"has",A),fs(D,"has",i)),A===i?R.has(A):R.has(A)||R.has(i)},forEach(A,R){const D=this,i=D.__v_raw,G=zn(i),W=l?Nx:r?Vx:ps;return!r&&fs(G,"iterate",Lu),i.forEach((H,ee)=>A.call(R,W(H),W(ee),D))}};return Wi(p,r?{add:Fg("add"),set:Fg("set"),delete:Fg("delete"),clear:Fg("clear")}:{add(A){!l&&!No(A)&&!Uu(A)&&(A=zn(A));const R=zn(this);return kg(R).has.call(R,A)||(R.add(A),gl(R,"add",A,A)),this},set(A,R){!l&&!No(R)&&!Uu(R)&&(R=zn(R));const D=zn(this),{has:i,get:G}=kg(D);let W=i.call(D,A);W||(A=zn(A),W=i.call(D,A));const H=G.call(D,A);return D.set(A,R),W?xc(R,H)&&gl(D,"set",A,R):gl(D,"add",A,R),this},delete(A){const R=zn(this),{has:D,get:i}=kg(R);let G=D.call(R,A);G||(A=zn(A),G=D.call(R,A)),i&&i.call(R,A);const W=R.delete(A);return G&&gl(R,"delete",A,void 0),W},clear(){const A=zn(this),R=A.size!==0,D=A.clear();return R&&gl(A,"clear",void 0,void 0),D}}),["keys","values","entries",Symbol.iterator].forEach(A=>{p[A]=gz(A,r,l)}),p}function A1(r,l){const p=yz(r,l);return(v,A,R)=>A==="__v_isReactive"?!r:A==="__v_isReadonly"?r:A==="__v_raw"?v:Reflect.get(Hn(p,A)&&A in v?p:v,A,R)}const vz={get:A1(!1,!1)},xz={get:A1(!1,!0)},bz={get:A1(!0,!1)};const QA=new WeakMap,eM=new WeakMap,tM=new WeakMap,wz=new WeakMap;function Tz(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Sz(r){return r.__v_skip||!Object.isExtensible(r)?0:Tz(XD(r))}function Ki(r){return Uu(r)?r:M1(r,!1,pz,vz,QA)}function rM(r){return M1(r,!1,_z,xz,eM)}function Vd(r){return M1(r,!0,mz,bz,tM)}function M1(r,l,p,v,A){if(!Un(r)||r.__v_raw&&!(l&&r.__v_isReactive))return r;const R=A.get(r);if(R)return R;const D=Sz(r);if(D===0)return r;const i=new Proxy(r,D===2?v:p);return A.set(r,i),i}function bc(r){return Uu(r)?bc(r.__v_raw):!!(r&&r.__v_isReactive)}function Uu(r){return!!(r&&r.__v_isReadonly)}function No(r){return!!(r&&r.__v_isShallow)}function I1(r){return r?!!r.__v_raw:!1}function zn(r){const l=r&&r.__v_raw;return l?zn(l):r}function C1(r){return!Hn(r,"__v_skip")&&Object.isExtensible(r)&&kA(r,"__v_skip",!0),r}const ps=r=>Un(r)?Ki(r):r,Vx=r=>Un(r)?Vd(r):r;function Yn(r){return r?r.__v_isRef===!0:!1}function dn(r){return nM(r,!1)}function Vn(r){return nM(r,!0)}function nM(r,l){return Yn(r)?r:new Ez(r,l)}class Ez{constructor(l,p){this.dep=new E1,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=p?l:zn(l),this._value=p?l:ps(l),this.__v_isShallow=p}get value(){return this.dep.track(),this._value}set value(l){const p=this._rawValue,v=this.__v_isShallow||No(l)||Uu(l);l=v?l:zn(l),xc(l,p)&&(this._rawValue=l,this._value=v?l:ps(l),this.dep.trigger())}}function xt(r){return Yn(r)?r.value:r}const Az={get:(r,l,p)=>l==="__v_raw"?r:xt(Reflect.get(r,l,p)),set:(r,l,p,v)=>{const A=r[l];return Yn(A)&&!Yn(p)?(A.value=p,!0):Reflect.set(r,l,p,v)}};function iM(r){return bc(r)?r:new Proxy(r,Az)}function Fy(r){const l=Vr(r)?new Array(r.length):{};for(const p in r)l[p]=sM(r,p);return l}class Mz{constructor(l,p,v){this._object=l,this._key=p,this._defaultValue=v,this.__v_isRef=!0,this._value=void 0}get value(){const l=this._object[this._key];return this._value=l===void 0?this._defaultValue:l}set value(l){this._object[this._key]=l}get dep(){return lz(zn(this._object),this._key)}}class Iz{constructor(l){this._getter=l,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function Si(r,l,p){return Yn(r)?r:Zr(r)?new Iz(r):Un(r)&&arguments.length>1?sM(r,l,p):dn(r)}function sM(r,l,p){const v=r[l];return Yn(v)?v:new Mz(r,l,p)}class Cz{constructor(l,p,v){this.fn=l,this.setter=p,this._value=void 0,this.dep=new E1(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=pm-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!p,this.isSSR=v}notify(){if(this.flags|=16,!(this.flags&8)&&ai!==this)return GA(this,!0),!0}get value(){const l=this.dep.track();return WA(this),l&&(l.version=this.dep.version),this._value}set value(l){this.setter&&this.setter(l)}}function Pz(r,l,p=!1){let v,A;return Zr(r)?v=r:(v=r.get,A=r.set),new Cz(v,A,p)}const Bg={},cy=new WeakMap;let Cu;function Rz(r,l=!1,p=Cu){if(p){let v=cy.get(p);v||cy.set(p,v=[]),v.push(r)}}function Dz(r,l,p=ii){const{immediate:v,deep:A,once:R,scheduler:D,augmentJob:i,call:G}=p,W=ht=>A?ht:No(ht)||A===!1||A===0?yl(ht,1):yl(ht);let H,ee,ne,de,he=!1,_e=!1;if(Yn(r)?(ee=()=>r.value,he=No(r)):bc(r)?(ee=()=>W(r),he=!0):Vr(r)?(_e=!0,he=r.some(ht=>bc(ht)||No(ht)),ee=()=>r.map(ht=>{if(Yn(ht))return ht.value;if(bc(ht))return W(ht);if(Zr(ht))return G?G(ht,2):ht()})):Zr(r)?l?ee=G?()=>G(r,2):r:ee=()=>{if(ne){Ic();try{ne()}finally{Cc()}}const ht=Cu;Cu=H;try{return G?G(r,3,[de]):r(de)}finally{Cu=ht}}:ee=yo,l&&A){const ht=ee,ft=A===!0?1/0:A;ee=()=>yl(ht(),ft)}const Ie=b1(),je=()=>{H.stop(),Ie&&Ie.active&&y1(Ie.effects,H)};if(R&&l){const ht=l;l=(...ft)=>{ht(...ft),je()}}let vt=_e?new Array(r.length).fill(Bg):Bg;const Pt=ht=>{if(!(!(H.flags&1)||!H.dirty&&!ht))if(l){const ft=H.run();if(A||he||(_e?ft.some((bt,Je)=>xc(bt,vt[Je])):xc(ft,vt))){ne&&ne();const bt=Cu;Cu=H;try{const Je=[ft,vt===Bg?void 0:_e&&vt[0]===Bg?[]:vt,de];G?G(l,3,Je):l(...Je),vt=ft}finally{Cu=bt}}}else H.run()};return i&&i(Pt),H=new jA(ee),H.scheduler=D?()=>D(Pt,!1):Pt,de=ht=>Rz(ht,!1,H),ne=H.onStop=()=>{const ht=cy.get(H);if(ht){if(G)G(ht,4);else for(const ft of ht)ft();cy.delete(H)}},l?v?Pt(!0):vt=H.run():D?D(Pt.bind(null,!0),!0):H.run(),je.pause=H.pause.bind(H),je.resume=H.resume.bind(H),je.stop=je,je}function yl(r,l=1/0,p){if(l<=0||!Un(r)||r.__v_skip||(p=p||new Set,p.has(r)))return r;if(p.add(r),l--,Yn(r))yl(r.value,l,p);else if(Vr(r))for(let v=0;v<r.length;v++)yl(r[v],l,p);else if(Dy(r)||Ad(r))r.forEach(v=>{yl(v,l,p)});else if(OA(r)){for(const v in r)yl(r[v],l,p);for(const v of Object.getOwnPropertySymbols(r))Object.prototype.propertyIsEnumerable.call(r,v)&&yl(r[v],l,p)}return r}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function zm(r,l,p,v){try{return v?r(...v):r()}catch(A){By(A,l,p)}}function ha(r,l,p,v){if(Zr(r)){const A=zm(r,l,p,v);return A&&ay(A)&&A.catch(R=>{By(R,l,p)}),A}if(Vr(r)){const A=[];for(let R=0;R<r.length;R++)A.push(ha(r[R],l,p,v));return A}}function By(r,l,p,v=!0){const A=l?l.vnode:null,{errorHandler:R,throwUnhandledErrorInProduction:D}=l&&l.appContext.config||ii;if(l){let i=l.parent;const G=l.proxy,W=`https://vuejs.org/error-reference/#runtime-${p}`;for(;i;){const H=i.ec;if(H){for(let ee=0;ee<H.length;ee++)if(H[ee](r,G,W)===!1)return}i=i.parent}if(R){Ic(),zm(R,null,10,[r,G,W]),Cc();return}}zz(r,p,A,v,D)}function zz(r,l,p,v=!0,A=!1){if(A)throw r;console.error(r)}const Fs=[];let Ba=-1;const Md=[];let dc=null,wd=0;const oM=Promise.resolve();let uy=null;function Bs(r){const l=uy||oM;return r?l.then(this?r.bind(this):r):l}function Lz(r){let l=Ba+1,p=Fs.length;for(;l<p;){const v=l+p>>>1,A=Fs[v],R=_m(A);R<r||R===r&&A.flags&2?l=v+1:p=v}return l}function P1(r){if(!(r.flags&1)){const l=_m(r),p=Fs[Fs.length-1];!p||!(r.flags&2)&&l>=_m(p)?Fs.push(r):Fs.splice(Lz(l),0,r),r.flags|=1,aM()}}function aM(){uy||(uy=oM.then(cM))}function Oz(r){Vr(r)?Md.push(...r):dc&&r.id===-1?dc.splice(wd+1,0,r):r.flags&1||(Md.push(r),r.flags|=1),aM()}function tS(r,l,p=Ba+1){for(;p<Fs.length;p++){const v=Fs[p];if(v&&v.flags&2){if(r&&v.id!==r.uid)continue;Fs.splice(p,1),p--,v.flags&4&&(v.flags&=-2),v(),v.flags&4||(v.flags&=-2)}}}function lM(r){if(Md.length){const l=[...new Set(Md)].sort((p,v)=>_m(p)-_m(v));if(Md.length=0,dc){dc.push(...l);return}for(dc=l,wd=0;wd<dc.length;wd++){const p=dc[wd];p.flags&4&&(p.flags&=-2),p.flags&8||p(),p.flags&=-2}dc=null,wd=0}}const _m=r=>r.id==null?r.flags&2?-1:1/0:r.id;function cM(r){try{for(Ba=0;Ba<Fs.length;Ba++){const l=Fs[Ba];l&&!(l.flags&8)&&(l.flags&4&&(l.flags&=-2),zm(l,l.i,l.i?15:14),l.flags&4||(l.flags&=-2))}}finally{for(;Ba<Fs.length;Ba++){const l=Fs[Ba];l&&(l.flags&=-2)}Ba=-1,Fs.length=0,lM(),uy=null,(Fs.length||Md.length)&&cM()}}let qi=null,uM=null;function hy(r){const l=qi;return qi=r,uM=r&&r.type.__scopeId||null,l}function An(r,l=qi,p){if(!l||r._n)return r;const v=(...A)=>{v._d&&_S(-1);const R=hy(l);let D;try{D=r(...A)}finally{hy(R),v._d&&_S(1)}return D};return v._n=!0,v._c=!0,v._d=!0,v}function Dd(r,l){if(qi===null)return r;const p=jy(qi),v=r.dirs||(r.dirs=[]);for(let A=0;A<l.length;A++){let[R,D,i,G=ii]=l[A];R&&(Zr(R)&&(R={mounted:R,updated:R}),R.deep&&yl(D),v.push({dir:R,instance:p,value:D,oldValue:void 0,arg:i,modifiers:G}))}return r}function Tu(r,l,p,v){const A=r.dirs,R=l&&l.dirs;for(let D=0;D<A.length;D++){const i=A[D];R&&(i.oldValue=R[D].value);let G=i.dir[v];G&&(Ic(),ha(G,p,8,[r.el,i,r,l]),Cc())}}const hM=Symbol("_vte"),dM=r=>r.__isTeleport,am=r=>r&&(r.disabled||r.disabled===""),rS=r=>r&&(r.defer||r.defer===""),nS=r=>typeof SVGElement<"u"&&r instanceof SVGElement,iS=r=>typeof MathMLElement=="function"&&r instanceof MathMLElement,Ux=(r,l)=>{const p=r&&r.to;return qn(p)?l?l(p):null:p},fM={name:"Teleport",__isTeleport:!0,process(r,l,p,v,A,R,D,i,G,W){const{mc:H,pc:ee,pbc:ne,o:{insert:de,querySelector:he,createText:_e,createComment:Ie}}=W,je=am(l.props);let{shapeFlag:vt,children:Pt,dynamicChildren:ht}=l;if(r==null){const ft=l.el=_e(""),bt=l.anchor=_e("");de(ft,p,v),de(bt,p,v);const Je=(pt,lt)=>{vt&16&&(A&&A.isCE&&(A.ce._teleportTarget=pt),H(Pt,pt,lt,A,R,D,i,G))},Et=()=>{const pt=l.target=Ux(l.props,he),lt=pM(pt,l,_e,de);pt&&(D!=="svg"&&nS(pt)?D="svg":D!=="mathml"&&iS(pt)&&(D="mathml"),je||(Je(pt,lt),Kg(l,!1)))};je&&(Je(p,bt),Kg(l,!0)),rS(l.props)?Os(()=>{Et(),l.el.__isMounted=!0},R):Et()}else{if(rS(l.props)&&!r.el.__isMounted){Os(()=>{fM.process(r,l,p,v,A,R,D,i,G,W),delete r.el.__isMounted},R);return}l.el=r.el,l.targetStart=r.targetStart;const ft=l.anchor=r.anchor,bt=l.target=r.target,Je=l.targetAnchor=r.targetAnchor,Et=am(r.props),pt=Et?p:bt,lt=Et?ft:Je;if(D==="svg"||nS(bt)?D="svg":(D==="mathml"||iS(bt))&&(D="mathml"),ht?(ne(r.dynamicChildren,ht,pt,A,R,D,i),B1(r,l,!0)):G||ee(r,l,pt,lt,A,R,D,i,!1),je)Et?l.props&&r.props&&l.props.to!==r.props.to&&(l.props.to=r.props.to):Ng(l,p,ft,W,1);else if((l.props&&l.props.to)!==(r.props&&r.props.to)){const dt=l.target=Ux(l.props,he);dt&&Ng(l,dt,null,W,0)}else Et&&Ng(l,bt,Je,W,1);Kg(l,je)}},remove(r,l,p,{um:v,o:{remove:A}},R){const{shapeFlag:D,children:i,anchor:G,targetStart:W,targetAnchor:H,target:ee,props:ne}=r;if(ee&&(A(W),A(H)),R&&A(G),D&16){const de=R||!am(ne);for(let he=0;he<i.length;he++){const _e=i[he];v(_e,l,p,de,!!_e.dynamicChildren)}}},move:Ng,hydrate:kz};function Ng(r,l,p,{o:{insert:v},m:A},R=2){R===0&&v(r.targetAnchor,l,p);const{el:D,anchor:i,shapeFlag:G,children:W,props:H}=r,ee=R===2;if(ee&&v(D,l,p),(!ee||am(H))&&G&16)for(let ne=0;ne<W.length;ne++)A(W[ne],l,p,2);ee&&v(i,l,p)}function kz(r,l,p,v,A,R,{o:{nextSibling:D,parentNode:i,querySelector:G,insert:W,createText:H}},ee){const ne=l.target=Ux(l.props,G);if(ne){const de=am(l.props),he=ne._lpa||ne.firstChild;if(l.shapeFlag&16)if(de)l.anchor=ee(D(r),l,i(r),p,v,A,R),l.targetStart=he,l.targetAnchor=he&&D(he);else{l.anchor=D(r);let _e=he;for(;_e;){if(_e&&_e.nodeType===8){if(_e.data==="teleport start anchor")l.targetStart=_e;else if(_e.data==="teleport anchor"){l.targetAnchor=_e,ne._lpa=l.targetAnchor&&D(l.targetAnchor);break}}_e=D(_e)}l.targetAnchor||pM(ne,l,H,W),ee(he&&D(he),l,ne,p,v,A,R)}Kg(l,de)}return l.anchor&&D(l.anchor)}const gj=fM;function Kg(r,l){const p=r.ctx;if(p&&p.ut){let v,A;for(l?(v=r.el,A=r.anchor):(v=r.targetStart,A=r.targetAnchor);v&&v!==A;)v.nodeType===1&&v.setAttribute("data-v-owner",p.uid),v=v.nextSibling;p.ut()}}function pM(r,l,p,v){const A=l.targetStart=p(""),R=l.targetAnchor=p("");return A[hM]=R,r&&(v(A,r),v(R,r)),R}const fc=Symbol("_leaveCb"),Vg=Symbol("_enterCb");function mM(){const r={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return fa(()=>{r.isMounted=!0}),Ua(()=>{r.isUnmounting=!0}),r}const Fo=[Function,Array],_M={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Fo,onEnter:Fo,onAfterEnter:Fo,onEnterCancelled:Fo,onBeforeLeave:Fo,onLeave:Fo,onAfterLeave:Fo,onLeaveCancelled:Fo,onBeforeAppear:Fo,onAppear:Fo,onAfterAppear:Fo,onAppearCancelled:Fo},gM=r=>{const l=r.subTree;return l.component?gM(l.component):l},Fz={name:"BaseTransition",props:_M,setup(r,{slots:l}){const p=$s(),v=mM();return()=>{const A=l.default&&R1(l.default(),!0);if(!A||!A.length)return;const R=yM(A),D=zn(r),{mode:i}=D;if(v.isLeaving)return mx(R);const G=sS(R);if(!G)return mx(R);let W=gm(G,D,v,p,ee=>W=ee);G.type!==Ns&&ju(G,W);let H=p.subTree&&sS(p.subTree);if(H&&H.type!==Ns&&!Pu(G,H)&&gM(p).type!==Ns){let ee=gm(H,D,v,p);if(ju(H,ee),i==="out-in"&&G.type!==Ns)return v.isLeaving=!0,ee.afterLeave=()=>{v.isLeaving=!1,p.job.flags&8||p.update(),delete ee.afterLeave,H=void 0},mx(R);i==="in-out"&&G.type!==Ns?ee.delayLeave=(ne,de,he)=>{const _e=vM(v,H);_e[String(H.key)]=H,ne[fc]=()=>{de(),ne[fc]=void 0,delete W.delayedLeave,H=void 0},W.delayedLeave=()=>{he(),delete W.delayedLeave,H=void 0}}:H=void 0}else H&&(H=void 0);return R}}};function yM(r){let l=r[0];if(r.length>1){for(const p of r)if(p.type!==Ns){l=p;break}}return l}const Bz=Fz;function vM(r,l){const{leavingVNodes:p}=r;let v=p.get(l.type);return v||(v=Object.create(null),p.set(l.type,v)),v}function gm(r,l,p,v,A){const{appear:R,mode:D,persisted:i=!1,onBeforeEnter:G,onEnter:W,onAfterEnter:H,onEnterCancelled:ee,onBeforeLeave:ne,onLeave:de,onAfterLeave:he,onLeaveCancelled:_e,onBeforeAppear:Ie,onAppear:je,onAfterAppear:vt,onAppearCancelled:Pt}=l,ht=String(r.key),ft=vM(p,r),bt=(pt,lt)=>{pt&&ha(pt,v,9,lt)},Je=(pt,lt)=>{const dt=lt[1];bt(pt,lt),Vr(pt)?pt.every(mt=>mt.length<=1)&&dt():pt.length<=1&&dt()},Et={mode:D,persisted:i,beforeEnter(pt){let lt=G;if(!p.isMounted)if(R)lt=Ie||G;else return;pt[fc]&&pt[fc](!0);const dt=ft[ht];dt&&Pu(r,dt)&&dt.el[fc]&&dt.el[fc](),bt(lt,[pt])},enter(pt){let lt=W,dt=H,mt=ee;if(!p.isMounted)if(R)lt=je||W,dt=vt||H,mt=Pt||ee;else return;let nr=!1;const Cr=pt[Vg]=Zt=>{nr||(nr=!0,Zt?bt(mt,[pt]):bt(dt,[pt]),Et.delayedLeave&&Et.delayedLeave(),pt[Vg]=void 0)};lt?Je(lt,[pt,Cr]):Cr()},leave(pt,lt){const dt=String(r.key);if(pt[Vg]&&pt[Vg](!0),p.isUnmounting)return lt();bt(ne,[pt]);let mt=!1;const nr=pt[fc]=Cr=>{mt||(mt=!0,lt(),Cr?bt(_e,[pt]):bt(he,[pt]),pt[fc]=void 0,ft[dt]===r&&delete ft[dt])};ft[dt]=r,de?Je(de,[pt,nr]):nr()},clone(pt){const lt=gm(pt,l,p,v,A);return A&&A(lt),lt}};return Et}function mx(r){if(Ny(r))return r=wc(r),r.children=null,r}function sS(r){if(!Ny(r))return dM(r.type)&&r.children?yM(r.children):r;const{shapeFlag:l,children:p}=r;if(p){if(l&16)return p[0];if(l&32&&Zr(p.default))return p.default()}}function ju(r,l){r.shapeFlag&6&&r.component?(r.transition=l,ju(r.component.subTree,l)):r.shapeFlag&128?(r.ssContent.transition=l.clone(r.ssContent),r.ssFallback.transition=l.clone(r.ssFallback)):r.transition=l}function R1(r,l=!1,p){let v=[],A=0;for(let R=0;R<r.length;R++){let D=r[R];const i=p==null?D.key:String(p)+String(D.key!=null?D.key:R);D.type===ti?(D.patchFlag&128&&A++,v=v.concat(R1(D.children,l,i))):(l||D.type!==Ns)&&v.push(i!=null?wc(D,{key:i}):D)}if(A>1)for(let R=0;R<v.length;R++)v[R].patchFlag=-2;return v}/*! #__NO_SIDE_EFFECTS__ */function pn(r,l){return Zr(r)?Wi({name:r.name},l,{setup:r}):r}function xM(r){r.ids=[r.ids[0]+r.ids[2]+++"-",0,0]}function dy(r,l,p,v,A=!1){if(Vr(r)){r.forEach((he,_e)=>dy(he,l&&(Vr(l)?l[_e]:l),p,v,A));return}if(Id(v)&&!A){v.shapeFlag&512&&v.type.__asyncResolved&&v.component.subTree.component&&dy(r,l,p,v.component.subTree);return}const R=v.shapeFlag&4?jy(v.component):v.el,D=A?null:R,{i,r:G}=r,W=l&&l.r,H=i.refs===ii?i.refs={}:i.refs,ee=i.setupState,ne=zn(ee),de=ee===ii?()=>!1:he=>Hn(ne,he);if(W!=null&&W!==G&&(qn(W)?(H[W]=null,de(W)&&(ee[W]=null)):Yn(W)&&(W.value=null)),Zr(G))zm(G,i,12,[D,H]);else{const he=qn(G),_e=Yn(G);if(he||_e){const Ie=()=>{if(r.f){const je=he?de(G)?ee[G]:H[G]:G.value;A?Vr(je)&&y1(je,R):Vr(je)?je.includes(R)||je.push(R):he?(H[G]=[R],de(G)&&(ee[G]=H[G])):(G.value=[R],r.k&&(H[r.k]=G.value))}else he?(H[G]=D,de(G)&&(ee[G]=D)):_e&&(G.value=D,r.k&&(H[r.k]=D))};D?(Ie.id=-1,Os(Ie,p)):Ie()}}}Ly().requestIdleCallback;Ly().cancelIdleCallback;const Id=r=>!!r.type.__asyncLoader,Ny=r=>r.type.__isKeepAlive;function bM(r,l){TM(r,"a",l)}function wM(r,l){TM(r,"da",l)}function TM(r,l,p=Yi){const v=r.__wdc||(r.__wdc=()=>{let A=p;for(;A;){if(A.isDeactivated)return;A=A.parent}return r()});if(Vy(l,v,p),p){let A=p.parent;for(;A&&A.parent;)Ny(A.parent.vnode)&&Nz(v,l,p,A),A=A.parent}}function Nz(r,l,p,v){const A=Vy(l,r,v,!0);z1(()=>{y1(v[l],A)},p)}function Vy(r,l,p=Yi,v=!1){if(p){const A=p[r]||(p[r]=[]),R=l.__weh||(l.__weh=(...D)=>{Ic();const i=Lm(p),G=ha(l,p,r,D);return i(),Cc(),G});return v?A.unshift(R):A.push(R),R}}const xl=r=>(l,p=Yi)=>{(!xm||r==="sp")&&Vy(r,(...v)=>l(...v),p)},SM=xl("bm"),fa=xl("m"),Vz=xl("bu"),D1=xl("u"),Ua=xl("bum"),z1=xl("um"),Uz=xl("sp"),jz=xl("rtg"),$z=xl("rtc");function Gz(r,l=Yi){Vy("ec",r,l)}const L1="components",Hz="directives";function EM(r,l){return k1(L1,r,!0,l)||r}const AM=Symbol.for("v-ndc");function mo(r){return qn(r)?k1(L1,r,!1)||r:r||AM}function O1(r){return k1(Hz,r)}function k1(r,l,p=!0,v=!1){const A=qi||Yi;if(A){const R=A.type;if(r===L1){const i=R4(R,!1);if(i&&(i===l||i===js(l)||i===Mc(js(l))))return R}const D=oS(A[r]||R[r],l)||oS(A.appContext[r],l);return!D&&v?R:D}}function oS(r,l){return r&&(r[l]||r[js(l)]||r[Mc(js(l))])}function aS(r,l,p,v){let A;const R=p,D=Vr(r);if(D||qn(r)){const i=D&&bc(r);let G=!1;i&&(G=!No(r),r=ky(r)),A=new Array(r.length);for(let W=0,H=r.length;W<H;W++)A[W]=l(G?ps(r[W]):r[W],W,void 0,R)}else if(typeof r=="number"){A=new Array(r);for(let i=0;i<r;i++)A[i]=l(i+1,i,void 0,R)}else if(Un(r))if(r[Symbol.iterator])A=Array.from(r,(i,G)=>l(i,G,void 0,R));else{const i=Object.keys(r);A=new Array(i.length);for(let G=0,W=i.length;G<W;G++){const H=i[G];A[G]=l(r[H],H,G,R)}}else A=[];return A}function yj(r,l){for(let p=0;p<l.length;p++){const v=l[p];if(Vr(v))for(let A=0;A<v.length;A++)r[v[A].name]=v[A].fn;else v&&(r[v.name]=v.key?(...A)=>{const R=v.fn(...A);return R&&(R.key=v.key),R}:v.fn)}return r}function la(r,l,p={},v,A){if(qi.ce||qi.parent&&Id(qi.parent)&&qi.parent.ce)return l!=="default"&&(p.name=l),Kt(),Cn(ti,null,[st("slot",p,v&&v())],64);let R=r[l];R&&R._c&&(R._d=!1),Kt();const D=R&&MM(R(p)),i=p.key||D&&D.key,G=Cn(ti,{key:(i&&!ua(i)?i:`_${l}`)+(!D&&v?"_fb":"")},D||(v?v():[]),D&&r._===1?64:-2);return G.scopeId&&(G.slotScopeIds=[G.scopeId+"-s"]),R&&R._c&&(R._d=!0),G}function MM(r){return r.some(l=>vm(l)?!(l.type===Ns||l.type===ti&&!MM(l.children)):!0)?r:null}const jx=r=>r?ZM(r)?jy(r):jx(r.parent):null,lm=Wi(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>jx(r.parent),$root:r=>jx(r.root),$host:r=>r.ce,$emit:r=>r.emit,$options:r=>RM(r),$forceUpdate:r=>r.f||(r.f=()=>{P1(r.update)}),$nextTick:r=>r.n||(r.n=Bs.bind(r.proxy)),$watch:r=>p4.bind(r)}),_x=(r,l)=>r!==ii&&!r.__isScriptSetup&&Hn(r,l),qz={get({_:r},l){if(l==="__v_skip")return!0;const{ctx:p,setupState:v,data:A,props:R,accessCache:D,type:i,appContext:G}=r;let W;if(l[0]!=="$"){const de=D[l];if(de!==void 0)switch(de){case 1:return v[l];case 2:return A[l];case 4:return p[l];case 3:return R[l]}else{if(_x(v,l))return D[l]=1,v[l];if(A!==ii&&Hn(A,l))return D[l]=2,A[l];if((W=r.propsOptions[0])&&Hn(W,l))return D[l]=3,R[l];if(p!==ii&&Hn(p,l))return D[l]=4,p[l];$x&&(D[l]=0)}}const H=lm[l];let ee,ne;if(H)return l==="$attrs"&&fs(r.attrs,"get",""),H(r);if((ee=i.__cssModules)&&(ee=ee[l]))return ee;if(p!==ii&&Hn(p,l))return D[l]=4,p[l];if(ne=G.config.globalProperties,Hn(ne,l))return ne[l]},set({_:r},l,p){const{data:v,setupState:A,ctx:R}=r;return _x(A,l)?(A[l]=p,!0):v!==ii&&Hn(v,l)?(v[l]=p,!0):Hn(r.props,l)||l[0]==="$"&&l.slice(1)in r?!1:(R[l]=p,!0)},has({_:{data:r,setupState:l,accessCache:p,ctx:v,appContext:A,propsOptions:R}},D){let i;return!!p[D]||r!==ii&&Hn(r,D)||_x(l,D)||(i=R[0])&&Hn(i,D)||Hn(v,D)||Hn(lm,D)||Hn(A.config.globalProperties,D)},defineProperty(r,l,p){return p.get!=null?r._.accessCache[l]=0:Hn(p,"value")&&this.set(r,l,p.value,null),Reflect.defineProperty(r,l,p)}};function IM(){return CM().slots}function Wz(){return CM().attrs}function CM(){const r=$s();return r.setupContext||(r.setupContext=KM(r))}function lS(r){return Vr(r)?r.reduce((l,p)=>(l[p]=null,l),{}):r}let $x=!0;function Zz(r){const l=RM(r),p=r.proxy,v=r.ctx;$x=!1,l.beforeCreate&&cS(l.beforeCreate,r,"bc");const{data:A,computed:R,methods:D,watch:i,provide:G,inject:W,created:H,beforeMount:ee,mounted:ne,beforeUpdate:de,updated:he,activated:_e,deactivated:Ie,beforeDestroy:je,beforeUnmount:vt,destroyed:Pt,unmounted:ht,render:ft,renderTracked:bt,renderTriggered:Je,errorCaptured:Et,serverPrefetch:pt,expose:lt,inheritAttrs:dt,components:mt,directives:nr,filters:Cr}=l;if(W&&Xz(W,v,null),D)for(const vr in D){const Ur=D[vr];Zr(Ur)&&(v[vr]=Ur.bind(p))}if(A){const vr=A.call(p,p);Un(vr)&&(r.data=Ki(vr))}if($x=!0,R)for(const vr in R){const Ur=R[vr],lr=Zr(Ur)?Ur.bind(p,p):Zr(Ur.get)?Ur.get.bind(p,p):yo,qr=!Zr(Ur)&&Zr(Ur.set)?Ur.set.bind(p):yo,ur=et({get:lr,set:qr});Object.defineProperty(v,vr,{enumerable:!0,configurable:!0,get:()=>ur.value,set:ir=>ur.value=ir})}if(i)for(const vr in i)PM(i[vr],v,p,vr);if(G){const vr=Zr(G)?G.call(p):G;Reflect.ownKeys(vr).forEach(Ur=>{vo(Ur,vr[Ur])})}H&&cS(H,r,"c");function Tr(vr,Ur){Vr(Ur)?Ur.forEach(lr=>vr(lr.bind(p))):Ur&&vr(Ur.bind(p))}if(Tr(SM,ee),Tr(fa,ne),Tr(Vz,de),Tr(D1,he),Tr(bM,_e),Tr(wM,Ie),Tr(Gz,Et),Tr($z,bt),Tr(jz,Je),Tr(Ua,vt),Tr(z1,ht),Tr(Uz,pt),Vr(lt))if(lt.length){const vr=r.exposed||(r.exposed={});lt.forEach(Ur=>{Object.defineProperty(vr,Ur,{get:()=>p[Ur],set:lr=>p[Ur]=lr})})}else r.exposed||(r.exposed={});ft&&r.render===yo&&(r.render=ft),dt!=null&&(r.inheritAttrs=dt),mt&&(r.components=mt),nr&&(r.directives=nr),pt&&xM(r)}function Xz(r,l,p=yo){Vr(r)&&(r=Gx(r));for(const v in r){const A=r[v];let R;Un(A)?"default"in A?R=Pn(A.from||v,A.default,!0):R=Pn(A.from||v):R=Pn(A),Yn(R)?Object.defineProperty(l,v,{enumerable:!0,configurable:!0,get:()=>R.value,set:D=>R.value=D}):l[v]=R}}function cS(r,l,p){ha(Vr(r)?r.map(v=>v.bind(l.proxy)):r.bind(l.proxy),l,p)}function PM(r,l,p,v){let A=v.includes(".")?$M(p,v):()=>p[v];if(qn(r)){const R=l[r];Zr(R)&&Tn(A,R)}else if(Zr(r))Tn(A,r.bind(p));else if(Un(r))if(Vr(r))r.forEach(R=>PM(R,l,p,v));else{const R=Zr(r.handler)?r.handler.bind(p):l[r.handler];Zr(R)&&Tn(A,R,r)}}function RM(r){const l=r.type,{mixins:p,extends:v}=l,{mixins:A,optionsCache:R,config:{optionMergeStrategies:D}}=r.appContext,i=R.get(l);let G;return i?G=i:!A.length&&!p&&!v?G=l:(G={},A.length&&A.forEach(W=>fy(G,W,D,!0)),fy(G,l,D)),Un(l)&&R.set(l,G),G}function fy(r,l,p,v=!1){const{mixins:A,extends:R}=l;R&&fy(r,R,p,!0),A&&A.forEach(D=>fy(r,D,p,!0));for(const D in l)if(!(v&&D==="expose")){const i=Kz[D]||p&&p[D];r[D]=i?i(r[D],l[D]):l[D]}return r}const Kz={data:uS,props:hS,emits:hS,methods:nm,computed:nm,beforeCreate:Ls,created:Ls,beforeMount:Ls,mounted:Ls,beforeUpdate:Ls,updated:Ls,beforeDestroy:Ls,beforeUnmount:Ls,destroyed:Ls,unmounted:Ls,activated:Ls,deactivated:Ls,errorCaptured:Ls,serverPrefetch:Ls,components:nm,directives:nm,watch:Jz,provide:uS,inject:Yz};function uS(r,l){return l?r?function(){return Wi(Zr(r)?r.call(this,this):r,Zr(l)?l.call(this,this):l)}:l:r}function Yz(r,l){return nm(Gx(r),Gx(l))}function Gx(r){if(Vr(r)){const l={};for(let p=0;p<r.length;p++)l[r[p]]=r[p];return l}return r}function Ls(r,l){return r?[...new Set([].concat(r,l))]:l}function nm(r,l){return r?Wi(Object.create(null),r,l):l}function hS(r,l){return r?Vr(r)&&Vr(l)?[...new Set([...r,...l])]:Wi(Object.create(null),lS(r),lS(l??{})):l}function Jz(r,l){if(!r)return l;if(!l)return r;const p=Wi(Object.create(null),r);for(const v in l)p[v]=Ls(r[v],l[v]);return p}function DM(){return{app:null,config:{isNativeTag:WD,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Qz=0;function e4(r,l){return function(v,A=null){Zr(v)||(v=Wi({},v)),A!=null&&!Un(A)&&(A=null);const R=DM(),D=new WeakSet,i=[];let G=!1;const W=R.app={_uid:Qz++,_component:v,_props:A,_container:null,_context:R,_instance:null,version:z4,get config(){return R.config},set config(H){},use(H,...ee){return D.has(H)||(H&&Zr(H.install)?(D.add(H),H.install(W,...ee)):Zr(H)&&(D.add(H),H(W,...ee))),W},mixin(H){return R.mixins.includes(H)||R.mixins.push(H),W},component(H,ee){return ee?(R.components[H]=ee,W):R.components[H]},directive(H,ee){return ee?(R.directives[H]=ee,W):R.directives[H]},mount(H,ee,ne){if(!G){const de=W._ceVNode||st(v,A);return de.appContext=R,ne===!0?ne="svg":ne===!1&&(ne=void 0),r(de,H,ne),G=!0,W._container=H,H.__vue_app__=W,jy(de.component)}},onUnmount(H){i.push(H)},unmount(){G&&(ha(i,W._instance,16),r(null,W._container),delete W._container.__vue_app__)},provide(H,ee){return R.provides[H]=ee,W},runWithContext(H){const ee=Ou;Ou=W;try{return H()}finally{Ou=ee}}};return W}}let Ou=null;function vo(r,l){if(Yi){let p=Yi.provides;const v=Yi.parent&&Yi.parent.provides;v===p&&(p=Yi.provides=Object.create(v)),p[r]=l}}function Pn(r,l,p=!1){const v=Yi||qi;if(v||Ou){const A=Ou?Ou._context.provides:v?v.parent==null?v.vnode.appContext&&v.vnode.appContext.provides:v.parent.provides:void 0;if(A&&r in A)return A[r];if(arguments.length>1)return p&&Zr(l)?l.call(v&&v.proxy):l}}function t4(){return!!(Yi||qi||Ou)}const zM={},LM=()=>Object.create(zM),OM=r=>Object.getPrototypeOf(r)===zM;function r4(r,l,p,v=!1){const A={},R=LM();r.propsDefaults=Object.create(null),kM(r,l,A,R);for(const D in r.propsOptions[0])D in A||(A[D]=void 0);p?r.props=v?A:rM(A):r.type.props?r.props=A:r.props=R,r.attrs=R}function n4(r,l,p,v){const{props:A,attrs:R,vnode:{patchFlag:D}}=r,i=zn(A),[G]=r.propsOptions;let W=!1;if((v||D>0)&&!(D&16)){if(D&8){const H=r.vnode.dynamicProps;for(let ee=0;ee<H.length;ee++){let ne=H[ee];if(Uy(r.emitsOptions,ne))continue;const de=l[ne];if(G)if(Hn(R,ne))de!==R[ne]&&(R[ne]=de,W=!0);else{const he=js(ne);A[he]=Hx(G,i,he,de,r,!1)}else de!==R[ne]&&(R[ne]=de,W=!0)}}}else{kM(r,l,A,R)&&(W=!0);let H;for(const ee in i)(!l||!Hn(l,ee)&&((H=Ac(ee))===ee||!Hn(l,H)))&&(G?p&&(p[ee]!==void 0||p[H]!==void 0)&&(A[ee]=Hx(G,i,ee,void 0,r,!0)):delete A[ee]);if(R!==i)for(const ee in R)(!l||!Hn(l,ee))&&(delete R[ee],W=!0)}W&&gl(r.attrs,"set","")}function kM(r,l,p,v){const[A,R]=r.propsOptions;let D=!1,i;if(l)for(let G in l){if(im(G))continue;const W=l[G];let H;A&&Hn(A,H=js(G))?!R||!R.includes(H)?p[H]=W:(i||(i={}))[H]=W:Uy(r.emitsOptions,G)||(!(G in v)||W!==v[G])&&(v[G]=W,D=!0)}if(R){const G=zn(p),W=i||ii;for(let H=0;H<R.length;H++){const ee=R[H];p[ee]=Hx(A,G,ee,W[ee],r,!Hn(W,ee))}}return D}function Hx(r,l,p,v,A,R){const D=r[p];if(D!=null){const i=Hn(D,"default");if(i&&v===void 0){const G=D.default;if(D.type!==Function&&!D.skipFactory&&Zr(G)){const{propsDefaults:W}=A;if(p in W)v=W[p];else{const H=Lm(A);v=W[p]=G.call(null,l),H()}}else v=G;A.ce&&A.ce._setProp(p,v)}D[0]&&(R&&!i?v=!1:D[1]&&(v===""||v===Ac(p))&&(v=!0))}return v}const i4=new WeakMap;function FM(r,l,p=!1){const v=p?i4:l.propsCache,A=v.get(r);if(A)return A;const R=r.props,D={},i=[];let G=!1;if(!Zr(r)){const H=ee=>{G=!0;const[ne,de]=FM(ee,l,!0);Wi(D,ne),de&&i.push(...de)};!p&&l.mixins.length&&l.mixins.forEach(H),r.extends&&H(r.extends),r.mixins&&r.mixins.forEach(H)}if(!R&&!G)return Un(r)&&v.set(r,Ed),Ed;if(Vr(R))for(let H=0;H<R.length;H++){const ee=js(R[H]);dS(ee)&&(D[ee]=ii)}else if(R)for(const H in R){const ee=js(H);if(dS(ee)){const ne=R[H],de=D[ee]=Vr(ne)||Zr(ne)?{type:ne}:Wi({},ne),he=de.type;let _e=!1,Ie=!0;if(Vr(he))for(let je=0;je<he.length;++je){const vt=he[je],Pt=Zr(vt)&&vt.name;if(Pt==="Boolean"){_e=!0;break}else Pt==="String"&&(Ie=!1)}else _e=Zr(he)&&he.name==="Boolean";de[0]=_e,de[1]=Ie,(_e||Hn(de,"default"))&&i.push(ee)}}const W=[D,i];return Un(r)&&v.set(r,W),W}function dS(r){return r[0]!=="$"&&!im(r)}const BM=r=>r[0]==="_"||r==="$stable",F1=r=>Vr(r)?r.map(Na):[Na(r)],s4=(r,l,p)=>{if(l._n)return l;const v=An((...A)=>F1(l(...A)),p);return v._c=!1,v},NM=(r,l,p)=>{const v=r._ctx;for(const A in r){if(BM(A))continue;const R=r[A];if(Zr(R))l[A]=s4(A,R,v);else if(R!=null){const D=F1(R);l[A]=()=>D}}},VM=(r,l)=>{const p=F1(l);r.slots.default=()=>p},UM=(r,l,p)=>{for(const v in l)(p||v!=="_")&&(r[v]=l[v])},o4=(r,l,p)=>{const v=r.slots=LM();if(r.vnode.shapeFlag&32){const A=l._;A?(UM(v,l,p),p&&kA(v,"_",A,!0)):NM(l,v)}else l&&VM(r,l)},a4=(r,l,p)=>{const{vnode:v,slots:A}=r;let R=!0,D=ii;if(v.shapeFlag&32){const i=l._;i?p&&i===1?R=!1:UM(A,l,p):(R=!l.$stable,NM(l,A)),D=l}else l&&(VM(r,l),D={default:1});if(R)for(const i in A)!BM(i)&&D[i]==null&&delete A[i]},Os=b4;function l4(r){return c4(r)}function c4(r,l){const p=Ly();p.__VUE__=!0;const{insert:v,remove:A,patchProp:R,createElement:D,createText:i,createComment:G,setText:W,setElementText:H,parentNode:ee,nextSibling:ne,setScopeId:de=yo,insertStaticContent:he}=r,_e=(ke,Ve,Ae,wt=null,Vt=null,zt=null,Dt=void 0,jt=null,Jt=!!Ve.dynamicChildren)=>{if(ke===Ve)return;ke&&!Pu(ke,Ve)&&(wt=Rt(ke),ir(ke,Vt,zt,!0),ke=null),Ve.patchFlag===-2&&(Jt=!1,Ve.dynamicChildren=null);const{type:Gt,ref:Pr,shapeFlag:cr}=Ve;switch(Gt){case Ud:Ie(ke,Ve,Ae,wt);break;case Ns:je(ke,Ve,Ae,wt);break;case yx:ke==null&&vt(Ve,Ae,wt,Dt);break;case ti:mt(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt);break;default:cr&1?ft(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt):cr&6?nr(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt):(cr&64||cr&128)&&Gt.process(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt,te)}Pr!=null&&Vt&&dy(Pr,ke&&ke.ref,zt,Ve||ke,!Ve)},Ie=(ke,Ve,Ae,wt)=>{if(ke==null)v(Ve.el=i(Ve.children),Ae,wt);else{const Vt=Ve.el=ke.el;Ve.children!==ke.children&&W(Vt,Ve.children)}},je=(ke,Ve,Ae,wt)=>{ke==null?v(Ve.el=G(Ve.children||""),Ae,wt):Ve.el=ke.el},vt=(ke,Ve,Ae,wt)=>{[ke.el,ke.anchor]=he(ke.children,Ve,Ae,wt,ke.el,ke.anchor)},Pt=({el:ke,anchor:Ve},Ae,wt)=>{let Vt;for(;ke&&ke!==Ve;)Vt=ne(ke),v(ke,Ae,wt),ke=Vt;v(Ve,Ae,wt)},ht=({el:ke,anchor:Ve})=>{let Ae;for(;ke&&ke!==Ve;)Ae=ne(ke),A(ke),ke=Ae;A(Ve)},ft=(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt)=>{Ve.type==="svg"?Dt="svg":Ve.type==="math"&&(Dt="mathml"),ke==null?bt(Ve,Ae,wt,Vt,zt,Dt,jt,Jt):pt(ke,Ve,Vt,zt,Dt,jt,Jt)},bt=(ke,Ve,Ae,wt,Vt,zt,Dt,jt)=>{let Jt,Gt;const{props:Pr,shapeFlag:cr,transition:Ye,dirs:Qt}=ke;if(Jt=ke.el=D(ke.type,zt,Pr&&Pr.is,Pr),cr&8?H(Jt,ke.children):cr&16&&Et(ke.children,Jt,null,wt,Vt,gx(ke,zt),Dt,jt),Qt&&Tu(ke,null,wt,"created"),Je(Jt,ke,ke.scopeId,Dt,wt),Pr){for(const xn in Pr)xn!=="value"&&!im(xn)&&R(Jt,xn,null,Pr[xn],zt,wt);"value"in Pr&&R(Jt,"value",null,Pr.value,zt),(Gt=Pr.onVnodeBeforeMount)&&Oa(Gt,wt,ke)}Qt&&Tu(ke,null,wt,"beforeMount");const Gr=u4(Vt,Ye);Gr&&Ye.beforeEnter(Jt),v(Jt,Ve,Ae),((Gt=Pr&&Pr.onVnodeMounted)||Gr||Qt)&&Os(()=>{Gt&&Oa(Gt,wt,ke),Gr&&Ye.enter(Jt),Qt&&Tu(ke,null,wt,"mounted")},Vt)},Je=(ke,Ve,Ae,wt,Vt)=>{if(Ae&&de(ke,Ae),wt)for(let zt=0;zt<wt.length;zt++)de(ke,wt[zt]);if(Vt){let zt=Vt.subTree;if(Ve===zt||HM(zt.type)&&(zt.ssContent===Ve||zt.ssFallback===Ve)){const Dt=Vt.vnode;Je(ke,Dt,Dt.scopeId,Dt.slotScopeIds,Vt.parent)}}},Et=(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt=0)=>{for(let Gt=Jt;Gt<ke.length;Gt++){const Pr=ke[Gt]=jt?pc(ke[Gt]):Na(ke[Gt]);_e(null,Pr,Ve,Ae,wt,Vt,zt,Dt,jt)}},pt=(ke,Ve,Ae,wt,Vt,zt,Dt)=>{const jt=Ve.el=ke.el;let{patchFlag:Jt,dynamicChildren:Gt,dirs:Pr}=Ve;Jt|=ke.patchFlag&16;const cr=ke.props||ii,Ye=Ve.props||ii;let Qt;if(Ae&&Su(Ae,!1),(Qt=Ye.onVnodeBeforeUpdate)&&Oa(Qt,Ae,Ve,ke),Pr&&Tu(Ve,ke,Ae,"beforeUpdate"),Ae&&Su(Ae,!0),(cr.innerHTML&&Ye.innerHTML==null||cr.textContent&&Ye.textContent==null)&&H(jt,""),Gt?lt(ke.dynamicChildren,Gt,jt,Ae,wt,gx(Ve,Vt),zt):Dt||Ur(ke,Ve,jt,null,Ae,wt,gx(Ve,Vt),zt,!1),Jt>0){if(Jt&16)dt(jt,cr,Ye,Ae,Vt);else if(Jt&2&&cr.class!==Ye.class&&R(jt,"class",null,Ye.class,Vt),Jt&4&&R(jt,"style",cr.style,Ye.style,Vt),Jt&8){const Gr=Ve.dynamicProps;for(let xn=0;xn<Gr.length;xn++){const jr=Gr[xn],xi=cr[jr],ri=Ye[jr];(ri!==xi||jr==="value")&&R(jt,jr,xi,ri,Vt,Ae)}}Jt&1&&ke.children!==Ve.children&&H(jt,Ve.children)}else!Dt&&Gt==null&&dt(jt,cr,Ye,Ae,Vt);((Qt=Ye.onVnodeUpdated)||Pr)&&Os(()=>{Qt&&Oa(Qt,Ae,Ve,ke),Pr&&Tu(Ve,ke,Ae,"updated")},wt)},lt=(ke,Ve,Ae,wt,Vt,zt,Dt)=>{for(let jt=0;jt<Ve.length;jt++){const Jt=ke[jt],Gt=Ve[jt],Pr=Jt.el&&(Jt.type===ti||!Pu(Jt,Gt)||Jt.shapeFlag&70)?ee(Jt.el):Ae;_e(Jt,Gt,Pr,null,wt,Vt,zt,Dt,!0)}},dt=(ke,Ve,Ae,wt,Vt)=>{if(Ve!==Ae){if(Ve!==ii)for(const zt in Ve)!im(zt)&&!(zt in Ae)&&R(ke,zt,Ve[zt],null,Vt,wt);for(const zt in Ae){if(im(zt))continue;const Dt=Ae[zt],jt=Ve[zt];Dt!==jt&&zt!=="value"&&R(ke,zt,jt,Dt,Vt,wt)}"value"in Ae&&R(ke,"value",Ve.value,Ae.value,Vt)}},mt=(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt)=>{const Gt=Ve.el=ke?ke.el:i(""),Pr=Ve.anchor=ke?ke.anchor:i("");let{patchFlag:cr,dynamicChildren:Ye,slotScopeIds:Qt}=Ve;Qt&&(jt=jt?jt.concat(Qt):Qt),ke==null?(v(Gt,Ae,wt),v(Pr,Ae,wt),Et(Ve.children||[],Ae,Pr,Vt,zt,Dt,jt,Jt)):cr>0&&cr&64&&Ye&&ke.dynamicChildren?(lt(ke.dynamicChildren,Ye,Ae,Vt,zt,Dt,jt),(Ve.key!=null||Vt&&Ve===Vt.subTree)&&B1(ke,Ve,!0)):Ur(ke,Ve,Ae,Pr,Vt,zt,Dt,jt,Jt)},nr=(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt)=>{Ve.slotScopeIds=jt,ke==null?Ve.shapeFlag&512?Vt.ctx.activate(Ve,Ae,wt,Dt,Jt):Cr(Ve,Ae,wt,Vt,zt,Dt,Jt):Zt(ke,Ve,Jt)},Cr=(ke,Ve,Ae,wt,Vt,zt,Dt)=>{const jt=ke.component=M4(ke,wt,Vt);if(Ny(ke)&&(jt.ctx.renderer=te),I4(jt,!1,Dt),jt.asyncDep){if(Vt&&Vt.registerDep(jt,Tr,Dt),!ke.el){const Jt=jt.subTree=st(Ns);je(null,Jt,Ve,Ae)}}else Tr(jt,ke,Ve,Ae,Vt,zt,Dt)},Zt=(ke,Ve,Ae)=>{const wt=Ve.component=ke.component;if(v4(ke,Ve,Ae))if(wt.asyncDep&&!wt.asyncResolved){vr(wt,Ve,Ae);return}else wt.next=Ve,wt.update();else Ve.el=ke.el,wt.vnode=Ve},Tr=(ke,Ve,Ae,wt,Vt,zt,Dt)=>{const jt=()=>{if(ke.isMounted){let{next:cr,bu:Ye,u:Qt,parent:Gr,vnode:xn}=ke;{const Ni=jM(ke);if(Ni){cr&&(cr.el=xn.el,vr(ke,cr,Dt)),Ni.asyncDep.then(()=>{ke.isUnmounted||jt()});return}}let jr=cr,xi;Su(ke,!1),cr?(cr.el=xn.el,vr(ke,cr,Dt)):cr=xn,Ye&&Xg(Ye),(xi=cr.props&&cr.props.onVnodeBeforeUpdate)&&Oa(xi,Gr,cr,xn),Su(ke,!0);const ri=pS(ke),Ji=ke.subTree;ke.subTree=ri,_e(Ji,ri,ee(Ji.el),Rt(Ji),ke,Vt,zt),cr.el=ri.el,jr===null&&x4(ke,ri.el),Qt&&Os(Qt,Vt),(xi=cr.props&&cr.props.onVnodeUpdated)&&Os(()=>Oa(xi,Gr,cr,xn),Vt)}else{let cr;const{el:Ye,props:Qt}=Ve,{bm:Gr,m:xn,parent:jr,root:xi,type:ri}=ke,Ji=Id(Ve);Su(ke,!1),Gr&&Xg(Gr),!Ji&&(cr=Qt&&Qt.onVnodeBeforeMount)&&Oa(cr,jr,Ve),Su(ke,!0);{xi.ce&&xi.ce._injectChildStyle(ri);const Ni=ke.subTree=pS(ke);_e(null,Ni,Ae,wt,ke,Vt,zt),Ve.el=Ni.el}if(xn&&Os(xn,Vt),!Ji&&(cr=Qt&&Qt.onVnodeMounted)){const Ni=Ve;Os(()=>Oa(cr,jr,Ni),Vt)}(Ve.shapeFlag&256||jr&&Id(jr.vnode)&&jr.vnode.shapeFlag&256)&&ke.a&&Os(ke.a,Vt),ke.isMounted=!0,Ve=Ae=wt=null}};ke.scope.on();const Jt=ke.effect=new jA(jt);ke.scope.off();const Gt=ke.update=Jt.run.bind(Jt),Pr=ke.job=Jt.runIfDirty.bind(Jt);Pr.i=ke,Pr.id=ke.uid,Jt.scheduler=()=>P1(Pr),Su(ke,!0),Gt()},vr=(ke,Ve,Ae)=>{Ve.component=ke;const wt=ke.vnode.props;ke.vnode=Ve,ke.next=null,n4(ke,Ve.props,wt,Ae),a4(ke,Ve.children,Ae),Ic(),tS(ke),Cc()},Ur=(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt=!1)=>{const Gt=ke&&ke.children,Pr=ke?ke.shapeFlag:0,cr=Ve.children,{patchFlag:Ye,shapeFlag:Qt}=Ve;if(Ye>0){if(Ye&128){qr(Gt,cr,Ae,wt,Vt,zt,Dt,jt,Jt);return}else if(Ye&256){lr(Gt,cr,Ae,wt,Vt,zt,Dt,jt,Jt);return}}Qt&8?(Pr&16&&yn(Gt,Vt,zt),cr!==Gt&&H(Ae,cr)):Pr&16?Qt&16?qr(Gt,cr,Ae,wt,Vt,zt,Dt,jt,Jt):yn(Gt,Vt,zt,!0):(Pr&8&&H(Ae,""),Qt&16&&Et(cr,Ae,wt,Vt,zt,Dt,jt,Jt))},lr=(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt)=>{ke=ke||Ed,Ve=Ve||Ed;const Gt=ke.length,Pr=Ve.length,cr=Math.min(Gt,Pr);let Ye;for(Ye=0;Ye<cr;Ye++){const Qt=Ve[Ye]=Jt?pc(Ve[Ye]):Na(Ve[Ye]);_e(ke[Ye],Qt,Ae,null,Vt,zt,Dt,jt,Jt)}Gt>Pr?yn(ke,Vt,zt,!0,!1,cr):Et(Ve,Ae,wt,Vt,zt,Dt,jt,Jt,cr)},qr=(ke,Ve,Ae,wt,Vt,zt,Dt,jt,Jt)=>{let Gt=0;const Pr=Ve.length;let cr=ke.length-1,Ye=Pr-1;for(;Gt<=cr&&Gt<=Ye;){const Qt=ke[Gt],Gr=Ve[Gt]=Jt?pc(Ve[Gt]):Na(Ve[Gt]);if(Pu(Qt,Gr))_e(Qt,Gr,Ae,null,Vt,zt,Dt,jt,Jt);else break;Gt++}for(;Gt<=cr&&Gt<=Ye;){const Qt=ke[cr],Gr=Ve[Ye]=Jt?pc(Ve[Ye]):Na(Ve[Ye]);if(Pu(Qt,Gr))_e(Qt,Gr,Ae,null,Vt,zt,Dt,jt,Jt);else break;cr--,Ye--}if(Gt>cr){if(Gt<=Ye){const Qt=Ye+1,Gr=Qt<Pr?Ve[Qt].el:wt;for(;Gt<=Ye;)_e(null,Ve[Gt]=Jt?pc(Ve[Gt]):Na(Ve[Gt]),Ae,Gr,Vt,zt,Dt,jt,Jt),Gt++}}else if(Gt>Ye)for(;Gt<=cr;)ir(ke[Gt],Vt,zt,!0),Gt++;else{const Qt=Gt,Gr=Gt,xn=new Map;for(Gt=Gr;Gt<=Ye;Gt++){const Jn=Ve[Gt]=Jt?pc(Ve[Gt]):Na(Ve[Gt]);Jn.key!=null&&xn.set(Jn.key,Gt)}let jr,xi=0;const ri=Ye-Gr+1;let Ji=!1,Ni=0;const xs=new Array(ri);for(Gt=0;Gt<ri;Gt++)xs[Gt]=0;for(Gt=Qt;Gt<=cr;Gt++){const Jn=ke[Gt];if(xi>=ri){ir(Jn,Vt,zt,!0);continue}let Vi;if(Jn.key!=null)Vi=xn.get(Jn.key);else for(jr=Gr;jr<=Ye;jr++)if(xs[jr-Gr]===0&&Pu(Jn,Ve[jr])){Vi=jr;break}Vi===void 0?ir(Jn,Vt,zt,!0):(xs[Vi-Gr]=Gt+1,Vi>=Ni?Ni=Vi:Ji=!0,_e(Jn,Ve[Vi],Ae,null,Vt,zt,Dt,jt,Jt),xi++)}const wo=Ji?h4(xs):Ed;for(jr=wo.length-1,Gt=ri-1;Gt>=0;Gt--){const Jn=Gr+Gt,Vi=Ve[Jn],Rr=Jn+1<Pr?Ve[Jn+1].el:wt;xs[Gt]===0?_e(null,Vi,Ae,Rr,Vt,zt,Dt,jt,Jt):Ji&&(jr<0||Gt!==wo[jr]?ur(Vi,Ae,Rr,2):jr--)}}},ur=(ke,Ve,Ae,wt,Vt=null)=>{const{el:zt,type:Dt,transition:jt,children:Jt,shapeFlag:Gt}=ke;if(Gt&6){ur(ke.component.subTree,Ve,Ae,wt);return}if(Gt&128){ke.suspense.move(Ve,Ae,wt);return}if(Gt&64){Dt.move(ke,Ve,Ae,te);return}if(Dt===ti){v(zt,Ve,Ae);for(let cr=0;cr<Jt.length;cr++)ur(Jt[cr],Ve,Ae,wt);v(ke.anchor,Ve,Ae);return}if(Dt===yx){Pt(ke,Ve,Ae);return}if(wt!==2&&Gt&1&&jt)if(wt===0)jt.beforeEnter(zt),v(zt,Ve,Ae),Os(()=>jt.enter(zt),Vt);else{const{leave:cr,delayLeave:Ye,afterLeave:Qt}=jt,Gr=()=>v(zt,Ve,Ae),xn=()=>{cr(zt,()=>{Gr(),Qt&&Qt()})};Ye?Ye(zt,Gr,xn):xn()}else v(zt,Ve,Ae)},ir=(ke,Ve,Ae,wt=!1,Vt=!1)=>{const{type:zt,props:Dt,ref:jt,children:Jt,dynamicChildren:Gt,shapeFlag:Pr,patchFlag:cr,dirs:Ye,cacheIndex:Qt}=ke;if(cr===-2&&(Vt=!1),jt!=null&&dy(jt,null,Ae,ke,!0),Qt!=null&&(Ve.renderCache[Qt]=void 0),Pr&256){Ve.ctx.deactivate(ke);return}const Gr=Pr&1&&Ye,xn=!Id(ke);let jr;if(xn&&(jr=Dt&&Dt.onVnodeBeforeUnmount)&&Oa(jr,Ve,ke),Pr&6)di(ke.component,Ae,wt);else{if(Pr&128){ke.suspense.unmount(Ae,wt);return}Gr&&Tu(ke,null,Ve,"beforeUnmount"),Pr&64?ke.type.remove(ke,Ve,Ae,te,wt):Gt&&!Gt.hasOnce&&(zt!==ti||cr>0&&cr&64)?yn(Gt,Ve,Ae,!1,!0):(zt===ti&&cr&384||!Vt&&Pr&16)&&yn(Jt,Ve,Ae),wt&&$t(ke)}(xn&&(jr=Dt&&Dt.onVnodeUnmounted)||Gr)&&Os(()=>{jr&&Oa(jr,Ve,ke),Gr&&Tu(ke,null,Ve,"unmounted")},Ae)},$t=ke=>{const{type:Ve,el:Ae,anchor:wt,transition:Vt}=ke;if(Ve===ti){vi(Ae,wt);return}if(Ve===yx){ht(ke);return}const zt=()=>{A(Ae),Vt&&!Vt.persisted&&Vt.afterLeave&&Vt.afterLeave()};if(ke.shapeFlag&1&&Vt&&!Vt.persisted){const{leave:Dt,delayLeave:jt}=Vt,Jt=()=>Dt(Ae,zt);jt?jt(ke.el,zt,Jt):Jt()}else zt()},vi=(ke,Ve)=>{let Ae;for(;ke!==Ve;)Ae=ne(ke),A(ke),ke=Ae;A(Ve)},di=(ke,Ve,Ae)=>{const{bum:wt,scope:Vt,job:zt,subTree:Dt,um:jt,m:Jt,a:Gt}=ke;fS(Jt),fS(Gt),wt&&Xg(wt),Vt.stop(),zt&&(zt.flags|=8,ir(Dt,ke,Ve,Ae)),jt&&Os(jt,Ve),Os(()=>{ke.isUnmounted=!0},Ve),Ve&&Ve.pendingBranch&&!Ve.isUnmounted&&ke.asyncDep&&!ke.asyncResolved&&ke.suspenseId===Ve.pendingId&&(Ve.deps--,Ve.deps===0&&Ve.resolve())},yn=(ke,Ve,Ae,wt=!1,Vt=!1,zt=0)=>{for(let Dt=zt;Dt<ke.length;Dt++)ir(ke[Dt],Ve,Ae,wt,Vt)},Rt=ke=>{if(ke.shapeFlag&6)return Rt(ke.component.subTree);if(ke.shapeFlag&128)return ke.suspense.next();const Ve=ne(ke.anchor||ke.el),Ae=Ve&&Ve[hM];return Ae?ne(Ae):Ve};let tr=!1;const Yt=(ke,Ve,Ae)=>{ke==null?Ve._vnode&&ir(Ve._vnode,null,null,!0):_e(Ve._vnode||null,ke,Ve,null,null,null,Ae),Ve._vnode=ke,tr||(tr=!0,tS(),lM(),tr=!1)},te={p:_e,um:ir,m:ur,r:$t,mt:Cr,mc:Et,pc:Ur,pbc:lt,n:Rt,o:r};return{render:Yt,hydrate:void 0,createApp:e4(Yt)}}function gx({type:r,props:l},p){return p==="svg"&&r==="foreignObject"||p==="mathml"&&r==="annotation-xml"&&l&&l.encoding&&l.encoding.includes("html")?void 0:p}function Su({effect:r,job:l},p){p?(r.flags|=32,l.flags|=4):(r.flags&=-33,l.flags&=-5)}function u4(r,l){return(!r||r&&!r.pendingBranch)&&l&&!l.persisted}function B1(r,l,p=!1){const v=r.children,A=l.children;if(Vr(v)&&Vr(A))for(let R=0;R<v.length;R++){const D=v[R];let i=A[R];i.shapeFlag&1&&!i.dynamicChildren&&((i.patchFlag<=0||i.patchFlag===32)&&(i=A[R]=pc(A[R]),i.el=D.el),!p&&i.patchFlag!==-2&&B1(D,i)),i.type===Ud&&(i.el=D.el)}}function h4(r){const l=r.slice(),p=[0];let v,A,R,D,i;const G=r.length;for(v=0;v<G;v++){const W=r[v];if(W!==0){if(A=p[p.length-1],r[A]<W){l[v]=A,p.push(v);continue}for(R=0,D=p.length-1;R<D;)i=R+D>>1,r[p[i]]<W?R=i+1:D=i;W<r[p[R]]&&(R>0&&(l[v]=p[R-1]),p[R]=v)}}for(R=p.length,D=p[R-1];R-- >0;)p[R]=D,D=l[D];return p}function jM(r){const l=r.subTree.component;if(l)return l.asyncDep&&!l.asyncResolved?l:jM(l)}function fS(r){if(r)for(let l=0;l<r.length;l++)r[l].flags|=8}const d4=Symbol.for("v-scx"),f4=()=>Pn(d4);function Hu(r,l){return N1(r,null,l)}function Tn(r,l,p){return N1(r,l,p)}function N1(r,l,p=ii){const{immediate:v,deep:A,flush:R,once:D}=p,i=Wi({},p),G=l&&v||!l&&R!=="post";let W;if(xm){if(R==="sync"){const de=f4();W=de.__watcherHandles||(de.__watcherHandles=[])}else if(!G){const de=()=>{};return de.stop=yo,de.resume=yo,de.pause=yo,de}}const H=Yi;i.call=(de,he,_e)=>ha(de,H,he,_e);let ee=!1;R==="post"?i.scheduler=de=>{Os(de,H&&H.suspense)}:R!=="sync"&&(ee=!0,i.scheduler=(de,he)=>{he?de():P1(de)}),i.augmentJob=de=>{l&&(de.flags|=4),ee&&(de.flags|=2,H&&(de.id=H.uid,de.i=H))};const ne=Dz(r,l,i);return xm&&(W?W.push(ne):G&&ne()),ne}function p4(r,l,p){const v=this.proxy,A=qn(r)?r.includes(".")?$M(v,r):()=>v[r]:r.bind(v,v);let R;Zr(l)?R=l:(R=l.handler,p=l);const D=Lm(this),i=N1(A,R.bind(v),p);return D(),i}function $M(r,l){const p=l.split(".");return()=>{let v=r;for(let A=0;A<p.length&&v;A++)v=v[p[A]];return v}}const m4=(r,l)=>l==="modelValue"||l==="model-value"?r.modelModifiers:r[`${l}Modifiers`]||r[`${js(l)}Modifiers`]||r[`${Ac(l)}Modifiers`];function _4(r,l,...p){if(r.isUnmounted)return;const v=r.vnode.props||ii;let A=p;const R=l.startsWith("update:"),D=R&&m4(v,l.slice(7));D&&(D.trim&&(A=p.map(H=>qn(H)?H.trim():H)),D.number&&(A=p.map(kx)));let i,G=v[i=ux(l)]||v[i=ux(js(l))];!G&&R&&(G=v[i=ux(Ac(l))]),G&&ha(G,r,6,A);const W=v[i+"Once"];if(W){if(!r.emitted)r.emitted={};else if(r.emitted[i])return;r.emitted[i]=!0,ha(W,r,6,A)}}function GM(r,l,p=!1){const v=l.emitsCache,A=v.get(r);if(A!==void 0)return A;const R=r.emits;let D={},i=!1;if(!Zr(r)){const G=W=>{const H=GM(W,l,!0);H&&(i=!0,Wi(D,H))};!p&&l.mixins.length&&l.mixins.forEach(G),r.extends&&G(r.extends),r.mixins&&r.mixins.forEach(G)}return!R&&!i?(Un(r)&&v.set(r,null),null):(Vr(R)?R.forEach(G=>D[G]=null):Wi(D,R),Un(r)&&v.set(r,D),D)}function Uy(r,l){return!r||!Ry(l)?!1:(l=l.slice(2).replace(/Once$/,""),Hn(r,l[0].toLowerCase()+l.slice(1))||Hn(r,Ac(l))||Hn(r,l))}function pS(r){const{type:l,vnode:p,proxy:v,withProxy:A,propsOptions:[R],slots:D,attrs:i,emit:G,render:W,renderCache:H,props:ee,data:ne,setupState:de,ctx:he,inheritAttrs:_e}=r,Ie=hy(r);let je,vt;try{if(p.shapeFlag&4){const ht=A||v,ft=ht;je=Na(W.call(ft,ht,H,ee,de,ne,he)),vt=i}else{const ht=l;je=Na(ht.length>1?ht(ee,{attrs:i,slots:D,emit:G}):ht(ee,null)),vt=l.props?i:g4(i)}}catch(ht){cm.length=0,By(ht,r,1),je=st(Ns)}let Pt=je;if(vt&&_e!==!1){const ht=Object.keys(vt),{shapeFlag:ft}=Pt;ht.length&&ft&7&&(R&&ht.some(g1)&&(vt=y4(vt,R)),Pt=wc(Pt,vt,!1,!0))}return p.dirs&&(Pt=wc(Pt,null,!1,!0),Pt.dirs=Pt.dirs?Pt.dirs.concat(p.dirs):p.dirs),p.transition&&ju(Pt,p.transition),je=Pt,hy(Ie),je}const g4=r=>{let l;for(const p in r)(p==="class"||p==="style"||Ry(p))&&((l||(l={}))[p]=r[p]);return l},y4=(r,l)=>{const p={};for(const v in r)(!g1(v)||!(v.slice(9)in l))&&(p[v]=r[v]);return p};function v4(r,l,p){const{props:v,children:A,component:R}=r,{props:D,children:i,patchFlag:G}=l,W=R.emitsOptions;if(l.dirs||l.transition)return!0;if(p&&G>=0){if(G&1024)return!0;if(G&16)return v?mS(v,D,W):!!D;if(G&8){const H=l.dynamicProps;for(let ee=0;ee<H.length;ee++){const ne=H[ee];if(D[ne]!==v[ne]&&!Uy(W,ne))return!0}}}else return(A||i)&&(!i||!i.$stable)?!0:v===D?!1:v?D?mS(v,D,W):!0:!!D;return!1}function mS(r,l,p){const v=Object.keys(l);if(v.length!==Object.keys(r).length)return!0;for(let A=0;A<v.length;A++){const R=v[A];if(l[R]!==r[R]&&!Uy(p,R))return!0}return!1}function x4({vnode:r,parent:l},p){for(;l;){const v=l.subTree;if(v.suspense&&v.suspense.activeBranch===r&&(v.el=r.el),v===r)(r=l.vnode).el=p,l=l.parent;else break}}const HM=r=>r.__isSuspense;function b4(r,l){l&&l.pendingBranch?Vr(r)?l.effects.push(...r):l.effects.push(r):Oz(r)}const ti=Symbol.for("v-fgt"),Ud=Symbol.for("v-txt"),Ns=Symbol.for("v-cmt"),yx=Symbol.for("v-stc"),cm=[];let go=null;function Kt(r=!1){cm.push(go=r?null:[])}function w4(){cm.pop(),go=cm[cm.length-1]||null}let ym=1;function _S(r,l=!1){ym+=r,r<0&&go&&l&&(go.hasOnce=!0)}function qM(r){return r.dynamicChildren=ym>0?go||Ed:null,w4(),ym>0&&go&&go.push(r),r}function Nr(r,l,p,v,A,R){return qM(Wr(r,l,p,v,A,R,!0))}function Cn(r,l,p,v,A){return qM(st(r,l,p,v,A,!0))}function vm(r){return r?r.__v_isVNode===!0:!1}function Pu(r,l){return r.type===l.type&&r.key===l.key}const WM=({key:r})=>r??null,Yg=({ref:r,ref_key:l,ref_for:p})=>(typeof r=="number"&&(r=""+r),r!=null?qn(r)||Yn(r)||Zr(r)?{i:qi,r,k:l,f:!!p}:r:null);function Wr(r,l=null,p=null,v=0,A=null,R=r===ti?0:1,D=!1,i=!1){const G={__v_isVNode:!0,__v_skip:!0,type:r,props:l,key:l&&WM(l),ref:l&&Yg(l),scopeId:uM,slotScopeIds:null,children:p,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:R,patchFlag:v,dynamicProps:A,dynamicChildren:null,appContext:null,ctx:qi};return i?(V1(G,p),R&128&&r.normalize(G)):p&&(G.shapeFlag|=qn(p)?8:16),ym>0&&!D&&go&&(G.patchFlag>0||R&6)&&G.patchFlag!==32&&go.push(G),G}const st=T4;function T4(r,l=null,p=null,v=0,A=null,R=!1){if((!r||r===AM)&&(r=Ns),vm(r)){const i=wc(r,l,!0);return p&&V1(i,p),ym>0&&!R&&go&&(i.shapeFlag&6?go[go.indexOf(r)]=i:go.push(i)),i.patchFlag=-2,i}if(D4(r)&&(r=r.__vccOpts),l){l=S4(l);let{class:i,style:G}=l;i&&!qn(i)&&(l.class=kn(i)),Un(G)&&(I1(G)&&!Vr(G)&&(G=Wi({},G)),l.style=Vu(G))}const D=qn(r)?1:HM(r)?128:dM(r)?64:Un(r)?4:Zr(r)?2:0;return Wr(r,l,p,v,A,D,R,!0)}function S4(r){return r?I1(r)||OM(r)?Wi({},r):r:null}function wc(r,l,p=!1,v=!1){const{props:A,ref:R,patchFlag:D,children:i,transition:G}=r,W=l?ys(A||{},l):A,H={__v_isVNode:!0,__v_skip:!0,type:r.type,props:W,key:W&&WM(W),ref:l&&l.ref?p&&R?Vr(R)?R.concat(Yg(l)):[R,Yg(l)]:Yg(l):R,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:i,target:r.target,targetStart:r.targetStart,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:l&&r.type!==ti?D===-1?16:D|16:D,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:G,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&wc(r.ssContent),ssFallback:r.ssFallback&&wc(r.ssFallback),el:r.el,anchor:r.anchor,ctx:r.ctx,ce:r.ce};return G&&v&&ju(H,G.clone(H)),H}function Ru(r=" ",l=0){return st(Ud,null,r,l)}function In(r="",l=!1){return l?(Kt(),Cn(Ns,null,r)):st(Ns,null,r)}function Na(r){return r==null||typeof r=="boolean"?st(Ns):Vr(r)?st(ti,null,r.slice()):vm(r)?pc(r):st(Ud,null,String(r))}function pc(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:wc(r)}function V1(r,l){let p=0;const{shapeFlag:v}=r;if(l==null)l=null;else if(Vr(l))p=16;else if(typeof l=="object")if(v&65){const A=l.default;A&&(A._c&&(A._d=!1),V1(r,A()),A._c&&(A._d=!0));return}else{p=32;const A=l._;!A&&!OM(l)?l._ctx=qi:A===3&&qi&&(qi.slots._===1?l._=1:(l._=2,r.patchFlag|=1024))}else Zr(l)?(l={default:l,_ctx:qi},p=32):(l=String(l),v&64?(p=16,l=[Ru(l)]):p=8);r.children=l,r.shapeFlag|=p}function ys(...r){const l={};for(let p=0;p<r.length;p++){const v=r[p];for(const A in v)if(A==="class")l.class!==v.class&&(l.class=kn([l.class,v.class]));else if(A==="style")l.style=Vu([l.style,v.style]);else if(Ry(A)){const R=l[A],D=v[A];D&&R!==D&&!(Vr(R)&&R.includes(D))&&(l[A]=R?[].concat(R,D):D)}else A!==""&&(l[A]=v[A])}return l}function Oa(r,l,p,v=null){ha(r,l,7,[p,v])}const E4=DM();let A4=0;function M4(r,l,p){const v=r.type,A=(l?l.appContext:r.appContext)||E4,R={uid:A4++,vnode:r,type:v,parent:l,appContext:A,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new UA(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:l?l.provides:Object.create(A.provides),ids:l?l.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:FM(v,A),emitsOptions:GM(v,A),emit:null,emitted:null,propsDefaults:ii,inheritAttrs:v.inheritAttrs,ctx:ii,data:ii,props:ii,attrs:ii,slots:ii,refs:ii,setupState:ii,setupContext:null,suspense:p,suspenseId:p?p.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return R.ctx={_:R},R.root=l?l.root:R,R.emit=_4.bind(null,R),r.ce&&r.ce(R),R}let Yi=null;const $s=()=>Yi||qi;let py,qx;{const r=Ly(),l=(p,v)=>{let A;return(A=r[p])||(A=r[p]=[]),A.push(v),R=>{A.length>1?A.forEach(D=>D(R)):A[0](R)}};py=l("__VUE_INSTANCE_SETTERS__",p=>Yi=p),qx=l("__VUE_SSR_SETTERS__",p=>xm=p)}const Lm=r=>{const l=Yi;return py(r),r.scope.on(),()=>{r.scope.off(),py(l)}},gS=()=>{Yi&&Yi.scope.off(),py(null)};function ZM(r){return r.vnode.shapeFlag&4}let xm=!1;function I4(r,l=!1,p=!1){l&&qx(l);const{props:v,children:A}=r.vnode,R=ZM(r);r4(r,v,R,l),o4(r,A,p);const D=R?C4(r,l):void 0;return l&&qx(!1),D}function C4(r,l){const p=r.type;r.accessCache=Object.create(null),r.proxy=new Proxy(r.ctx,qz);const{setup:v}=p;if(v){Ic();const A=r.setupContext=v.length>1?KM(r):null,R=Lm(r),D=zm(v,r,0,[r.props,A]),i=ay(D);if(Cc(),R(),(i||r.sp)&&!Id(r)&&xM(r),i){if(D.then(gS,gS),l)return D.then(G=>{yS(r,G)}).catch(G=>{By(G,r,0)});r.asyncDep=D}else yS(r,D)}else XM(r)}function yS(r,l,p){Zr(l)?r.type.__ssrInlineRender?r.ssrRender=l:r.render=l:Un(l)&&(r.setupState=iM(l)),XM(r)}function XM(r,l,p){const v=r.type;r.render||(r.render=v.render||yo);{const A=Lm(r);Ic();try{Zz(r)}finally{Cc(),A()}}}const P4={get(r,l){return fs(r,"get",""),r[l]}};function KM(r){const l=p=>{r.exposed=p||{}};return{attrs:new Proxy(r.attrs,P4),slots:r.slots,emit:r.emit,expose:l}}function jy(r){return r.exposed?r.exposeProxy||(r.exposeProxy=new Proxy(iM(C1(r.exposed)),{get(l,p){if(p in l)return l[p];if(p in lm)return lm[p](r)},has(l,p){return p in l||p in lm}})):r.proxy}function R4(r,l=!0){return Zr(r)?r.displayName||r.name:r.name||l&&r.__name}function D4(r){return Zr(r)&&"__vccOpts"in r}const et=(r,l)=>Pz(r,l,xm);function bl(r,l,p){const v=arguments.length;return v===2?Un(l)&&!Vr(l)?vm(l)?st(r,null,[l]):st(r,l):st(r,null,l):(v>3?p=Array.prototype.slice.call(arguments,2):v===3&&vm(p)&&(p=[p]),st(r,l,p))}const z4="3.5.13",L4=yo;/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Wx;const vS=typeof window<"u"&&window.trustedTypes;if(vS)try{Wx=vS.createPolicy("vue",{createHTML:r=>r})}catch{}const YM=Wx?r=>Wx.createHTML(r):r=>r,O4="http://www.w3.org/2000/svg",k4="http://www.w3.org/1998/Math/MathML",_l=typeof document<"u"?document:null,xS=_l&&_l.createElement("template"),F4={insert:(r,l,p)=>{l.insertBefore(r,p||null)},remove:r=>{const l=r.parentNode;l&&l.removeChild(r)},createElement:(r,l,p,v)=>{const A=l==="svg"?_l.createElementNS(O4,r):l==="mathml"?_l.createElementNS(k4,r):p?_l.createElement(r,{is:p}):_l.createElement(r);return r==="select"&&v&&v.multiple!=null&&A.setAttribute("multiple",v.multiple),A},createText:r=>_l.createTextNode(r),createComment:r=>_l.createComment(r),setText:(r,l)=>{r.nodeValue=l},setElementText:(r,l)=>{r.textContent=l},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>_l.querySelector(r),setScopeId(r,l){r.setAttribute(l,"")},insertStaticContent(r,l,p,v,A,R){const D=p?p.previousSibling:l.lastChild;if(A&&(A===R||A.nextSibling))for(;l.insertBefore(A.cloneNode(!0),p),!(A===R||!(A=A.nextSibling)););else{xS.innerHTML=YM(v==="svg"?`<svg>${r}</svg>`:v==="mathml"?`<math>${r}</math>`:r);const i=xS.content;if(v==="svg"||v==="mathml"){const G=i.firstChild;for(;G.firstChild;)i.appendChild(G.firstChild);i.removeChild(G)}l.insertBefore(i,p)}return[D?D.nextSibling:l.firstChild,p?p.previousSibling:l.lastChild]}},ac="transition",Jp="animation",zd=Symbol("_vtc"),JM={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},QM=Wi({},_M,JM),B4=r=>(r.displayName="Transition",r.props=QM,r),Om=B4((r,{slots:l})=>bl(Bz,eI(r),l)),Eu=(r,l=[])=>{Vr(r)?r.forEach(p=>p(...l)):r&&r(...l)},bS=r=>r?Vr(r)?r.some(l=>l.length>1):r.length>1:!1;function eI(r){const l={};for(const mt in r)mt in JM||(l[mt]=r[mt]);if(r.css===!1)return l;const{name:p="v",type:v,duration:A,enterFromClass:R=`${p}-enter-from`,enterActiveClass:D=`${p}-enter-active`,enterToClass:i=`${p}-enter-to`,appearFromClass:G=R,appearActiveClass:W=D,appearToClass:H=i,leaveFromClass:ee=`${p}-leave-from`,leaveActiveClass:ne=`${p}-leave-active`,leaveToClass:de=`${p}-leave-to`}=r,he=N4(A),_e=he&&he[0],Ie=he&&he[1],{onBeforeEnter:je,onEnter:vt,onEnterCancelled:Pt,onLeave:ht,onLeaveCancelled:ft,onBeforeAppear:bt=je,onAppear:Je=vt,onAppearCancelled:Et=Pt}=l,pt=(mt,nr,Cr,Zt)=>{mt._enterCancelled=Zt,uc(mt,nr?H:i),uc(mt,nr?W:D),Cr&&Cr()},lt=(mt,nr)=>{mt._isLeaving=!1,uc(mt,ee),uc(mt,de),uc(mt,ne),nr&&nr()},dt=mt=>(nr,Cr)=>{const Zt=mt?Je:vt,Tr=()=>pt(nr,mt,Cr);Eu(Zt,[nr,Tr]),wS(()=>{uc(nr,mt?G:R),Fa(nr,mt?H:i),bS(Zt)||TS(nr,v,_e,Tr)})};return Wi(l,{onBeforeEnter(mt){Eu(je,[mt]),Fa(mt,R),Fa(mt,D)},onBeforeAppear(mt){Eu(bt,[mt]),Fa(mt,G),Fa(mt,W)},onEnter:dt(!1),onAppear:dt(!0),onLeave(mt,nr){mt._isLeaving=!0;const Cr=()=>lt(mt,nr);Fa(mt,ee),mt._enterCancelled?(Fa(mt,ne),Zx()):(Zx(),Fa(mt,ne)),wS(()=>{mt._isLeaving&&(uc(mt,ee),Fa(mt,de),bS(ht)||TS(mt,v,Ie,Cr))}),Eu(ht,[mt,Cr])},onEnterCancelled(mt){pt(mt,!1,void 0,!0),Eu(Pt,[mt])},onAppearCancelled(mt){pt(mt,!0,void 0,!0),Eu(Et,[mt])},onLeaveCancelled(mt){lt(mt),Eu(ft,[mt])}})}function N4(r){if(r==null)return null;if(Un(r))return[vx(r.enter),vx(r.leave)];{const l=vx(r);return[l,l]}}function vx(r){return JD(r)}function Fa(r,l){l.split(/\s+/).forEach(p=>p&&r.classList.add(p)),(r[zd]||(r[zd]=new Set)).add(l)}function uc(r,l){l.split(/\s+/).forEach(v=>v&&r.classList.remove(v));const p=r[zd];p&&(p.delete(l),p.size||(r[zd]=void 0))}function wS(r){requestAnimationFrame(()=>{requestAnimationFrame(r)})}let V4=0;function TS(r,l,p,v){const A=r._endId=++V4,R=()=>{A===r._endId&&v()};if(p!=null)return setTimeout(R,p);const{type:D,timeout:i,propCount:G}=tI(r,l);if(!D)return v();const W=D+"end";let H=0;const ee=()=>{r.removeEventListener(W,ne),R()},ne=de=>{de.target===r&&++H>=G&&ee()};setTimeout(()=>{H<G&&ee()},i+1),r.addEventListener(W,ne)}function tI(r,l){const p=window.getComputedStyle(r),v=he=>(p[he]||"").split(", "),A=v(`${ac}Delay`),R=v(`${ac}Duration`),D=SS(A,R),i=v(`${Jp}Delay`),G=v(`${Jp}Duration`),W=SS(i,G);let H=null,ee=0,ne=0;l===ac?D>0&&(H=ac,ee=D,ne=R.length):l===Jp?W>0&&(H=Jp,ee=W,ne=G.length):(ee=Math.max(D,W),H=ee>0?D>W?ac:Jp:null,ne=H?H===ac?R.length:G.length:0);const de=H===ac&&/\b(transform|all)(,|$)/.test(v(`${ac}Property`).toString());return{type:H,timeout:ee,propCount:ne,hasTransform:de}}function SS(r,l){for(;r.length<l.length;)r=r.concat(r);return Math.max(...l.map((p,v)=>ES(p)+ES(r[v])))}function ES(r){return r==="auto"?0:Number(r.slice(0,-1).replace(",","."))*1e3}function Zx(){return document.body.offsetHeight}function U4(r,l,p){const v=r[zd];v&&(l=(l?[l,...v]:[...v]).join(" ")),l==null?r.removeAttribute("class"):p?r.setAttribute("class",l):r.className=l}const my=Symbol("_vod"),rI=Symbol("_vsh"),nI={beforeMount(r,{value:l},{transition:p}){r[my]=r.style.display==="none"?"":r.style.display,p&&l?p.beforeEnter(r):Qp(r,l)},mounted(r,{value:l},{transition:p}){p&&l&&p.enter(r)},updated(r,{value:l,oldValue:p},{transition:v}){!l!=!p&&(v?l?(v.beforeEnter(r),Qp(r,!0),v.enter(r)):v.leave(r,()=>{Qp(r,!1)}):Qp(r,l))},beforeUnmount(r,{value:l}){Qp(r,l)}};function Qp(r,l){r.style.display=l?r[my]:"none",r[rI]=!l}const j4=Symbol(""),$4=/(^|;)\s*display\s*:/;function G4(r,l,p){const v=r.style,A=qn(p);let R=!1;if(p&&!A){if(l)if(qn(l))for(const D of l.split(";")){const i=D.slice(0,D.indexOf(":")).trim();p[i]==null&&Jg(v,i,"")}else for(const D in l)p[D]==null&&Jg(v,D,"");for(const D in p)D==="display"&&(R=!0),Jg(v,D,p[D])}else if(A){if(l!==p){const D=v[j4];D&&(p+=";"+D),v.cssText=p,R=$4.test(p)}}else l&&r.removeAttribute("style");my in r&&(r[my]=R?v.display:"",r[rI]&&(v.display="none"))}const AS=/\s*!important$/;function Jg(r,l,p){if(Vr(p))p.forEach(v=>Jg(r,l,v));else if(p==null&&(p=""),l.startsWith("--"))r.setProperty(l,p);else{const v=H4(r,l);AS.test(p)?r.setProperty(Ac(v),p.replace(AS,""),"important"):r[v]=p}}const MS=["Webkit","Moz","ms"],xx={};function H4(r,l){const p=xx[l];if(p)return p;let v=js(l);if(v!=="filter"&&v in r)return xx[l]=v;v=Mc(v);for(let A=0;A<MS.length;A++){const R=MS[A]+v;if(R in r)return xx[l]=R}return l}const IS="http://www.w3.org/1999/xlink";function CS(r,l,p,v,A,R=iz(l)){v&&l.startsWith("xlink:")?p==null?r.removeAttributeNS(IS,l.slice(6,l.length)):r.setAttributeNS(IS,l,p):p==null||R&&!FA(p)?r.removeAttribute(l):r.setAttribute(l,R?"":ua(p)?String(p):p)}function PS(r,l,p,v,A){if(l==="innerHTML"||l==="textContent"){p!=null&&(r[l]=l==="innerHTML"?YM(p):p);return}const R=r.tagName;if(l==="value"&&R!=="PROGRESS"&&!R.includes("-")){const i=R==="OPTION"?r.getAttribute("value")||"":r.value,G=p==null?r.type==="checkbox"?"on":"":String(p);(i!==G||!("_value"in r))&&(r.value=G),p==null&&r.removeAttribute(l),r._value=p;return}let D=!1;if(p===""||p==null){const i=typeof r[l];i==="boolean"?p=FA(p):p==null&&i==="string"?(p="",D=!0):i==="number"&&(p=0,D=!0)}try{r[l]=p}catch{}D&&r.removeAttribute(A||l)}function _c(r,l,p,v){r.addEventListener(l,p,v)}function q4(r,l,p,v){r.removeEventListener(l,p,v)}const RS=Symbol("_vei");function W4(r,l,p,v,A=null){const R=r[RS]||(r[RS]={}),D=R[l];if(v&&D)D.value=v;else{const[i,G]=Z4(l);if(v){const W=R[l]=Y4(v,A);_c(r,i,W,G)}else D&&(q4(r,i,D,G),R[l]=void 0)}}const DS=/(?:Once|Passive|Capture)$/;function Z4(r){let l;if(DS.test(r)){l={};let v;for(;v=r.match(DS);)r=r.slice(0,r.length-v[0].length),l[v[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):Ac(r.slice(2)),l]}let bx=0;const X4=Promise.resolve(),K4=()=>bx||(X4.then(()=>bx=0),bx=Date.now());function Y4(r,l){const p=v=>{if(!v._vts)v._vts=Date.now();else if(v._vts<=p.attached)return;ha(J4(v,p.value),l,5,[v])};return p.value=r,p.attached=K4(),p}function J4(r,l){if(Vr(l)){const p=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{p.call(r),r._stopped=!0},l.map(v=>A=>!A._stopped&&v&&v(A))}else return l}const zS=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)>96&&r.charCodeAt(2)<123,Q4=(r,l,p,v,A,R)=>{const D=A==="svg";l==="class"?U4(r,v,D):l==="style"?G4(r,p,v):Ry(l)?g1(l)||W4(r,l,p,v,R):(l[0]==="."?(l=l.slice(1),!0):l[0]==="^"?(l=l.slice(1),!1):eL(r,l,v,D))?(PS(r,l,v),!r.tagName.includes("-")&&(l==="value"||l==="checked"||l==="selected")&&CS(r,l,v,D,R,l!=="value")):r._isVueCE&&(/[A-Z]/.test(l)||!qn(v))?PS(r,js(l),v,R,l):(l==="true-value"?r._trueValue=v:l==="false-value"&&(r._falseValue=v),CS(r,l,v,D))};function eL(r,l,p,v){if(v)return!!(l==="innerHTML"||l==="textContent"||l in r&&zS(l)&&Zr(p));if(l==="spellcheck"||l==="draggable"||l==="translate"||l==="form"||l==="list"&&r.tagName==="INPUT"||l==="type"&&r.tagName==="TEXTAREA")return!1;if(l==="width"||l==="height"){const A=r.tagName;if(A==="IMG"||A==="VIDEO"||A==="CANVAS"||A==="SOURCE")return!1}return zS(l)&&qn(p)?!1:l in r}const iI=new WeakMap,sI=new WeakMap,_y=Symbol("_moveCb"),LS=Symbol("_enterCb"),tL=r=>(delete r.props.mode,r),rL=tL({name:"TransitionGroup",props:Wi({},QM,{tag:String,moveClass:String}),setup(r,{slots:l}){const p=$s(),v=mM();let A,R;return D1(()=>{if(!A.length)return;const D=r.moveClass||`${r.name||"v"}-move`;if(!oL(A[0].el,p.vnode.el,D))return;A.forEach(nL),A.forEach(iL);const i=A.filter(sL);Zx(),i.forEach(G=>{const W=G.el,H=W.style;Fa(W,D),H.transform=H.webkitTransform=H.transitionDuration="";const ee=W[_y]=ne=>{ne&&ne.target!==W||(!ne||/transform$/.test(ne.propertyName))&&(W.removeEventListener("transitionend",ee),W[_y]=null,uc(W,D))};W.addEventListener("transitionend",ee)})}),()=>{const D=zn(r),i=eI(D);let G=D.tag||ti;if(A=[],R)for(let W=0;W<R.length;W++){const H=R[W];H.el&&H.el instanceof Element&&(A.push(H),ju(H,gm(H,i,v,p)),iI.set(H,H.el.getBoundingClientRect()))}R=l.default?R1(l.default()):[];for(let W=0;W<R.length;W++){const H=R[W];H.key!=null&&ju(H,gm(H,i,v,p))}return st(G,null,R)}}}),U1=rL;function nL(r){const l=r.el;l[_y]&&l[_y](),l[LS]&&l[LS]()}function iL(r){sI.set(r,r.el.getBoundingClientRect())}function sL(r){const l=iI.get(r),p=sI.get(r),v=l.left-p.left,A=l.top-p.top;if(v||A){const R=r.el.style;return R.transform=R.webkitTransform=`translate(${v}px,${A}px)`,R.transitionDuration="0s",r}}function oL(r,l,p){const v=r.cloneNode(),A=r[zd];A&&A.forEach(i=>{i.split(/\s+/).forEach(G=>G&&v.classList.remove(G))}),p.split(/\s+/).forEach(i=>i&&v.classList.add(i)),v.style.display="none";const R=l.nodeType===1?l:l.parentNode;R.appendChild(v);const{hasTransform:D}=tI(v);return R.removeChild(v),D}const Ld=r=>{const l=r.props["onUpdate:modelValue"]||!1;return Vr(l)?p=>Xg(l,p):l};function aL(r){r.target.composing=!0}function OS(r){const l=r.target;l.composing&&(l.composing=!1,l.dispatchEvent(new Event("input")))}const vl=Symbol("_assign"),vj={created(r,{modifiers:{lazy:l,trim:p,number:v}},A){r[vl]=Ld(A);const R=v||A.props&&A.props.type==="number";_c(r,l?"change":"input",D=>{if(D.target.composing)return;let i=r.value;p&&(i=i.trim()),R&&(i=kx(i)),r[vl](i)}),p&&_c(r,"change",()=>{r.value=r.value.trim()}),l||(_c(r,"compositionstart",aL),_c(r,"compositionend",OS),_c(r,"change",OS))},mounted(r,{value:l}){r.value=l??""},beforeUpdate(r,{value:l,oldValue:p,modifiers:{lazy:v,trim:A,number:R}},D){if(r[vl]=Ld(D),r.composing)return;const i=(R||r.type==="number")&&!/^0\d/.test(r.value)?kx(r.value):r.value,G=l??"";i!==G&&(document.activeElement===r&&r.type!=="range"&&(v&&l===p||A&&r.value.trim()===G)||(r.value=G))}},xj={deep:!0,created(r,l,p){r[vl]=Ld(p),_c(r,"change",()=>{const v=r._modelValue,A=oI(r),R=r.checked,D=r[vl];if(Vr(v)){const i=BA(v,A),G=i!==-1;if(R&&!G)D(v.concat(A));else if(!R&&G){const W=[...v];W.splice(i,1),D(W)}}else if(Dy(v)){const i=new Set(v);R?i.add(A):i.delete(A),D(i)}else D(aI(r,R))})},mounted:kS,beforeUpdate(r,l,p){r[vl]=Ld(p),kS(r,l,p)}};function kS(r,{value:l,oldValue:p},v){r._modelValue=l;let A;if(Vr(l))A=BA(l,v.props.value)>-1;else if(Dy(l))A=l.has(v.props.value);else{if(l===p)return;A=Rd(l,aI(r,!0))}r.checked!==A&&(r.checked=A)}const bj={created(r,{value:l},p){r.checked=Rd(l,p.props.value),r[vl]=Ld(p),_c(r,"change",()=>{r[vl](oI(r))})},beforeUpdate(r,{value:l,oldValue:p},v){r[vl]=Ld(v),l!==p&&(r.checked=Rd(l,v.props.value))}};function oI(r){return"_value"in r?r._value:r.value}function aI(r,l){const p=l?"_trueValue":"_falseValue";return p in r?r[p]:l}const lL=["ctrl","shift","alt","meta"],cL={stop:r=>r.stopPropagation(),prevent:r=>r.preventDefault(),self:r=>r.target!==r.currentTarget,ctrl:r=>!r.ctrlKey,shift:r=>!r.shiftKey,alt:r=>!r.altKey,meta:r=>!r.metaKey,left:r=>"button"in r&&r.button!==0,middle:r=>"button"in r&&r.button!==1,right:r=>"button"in r&&r.button!==2,exact:(r,l)=>lL.some(p=>r[`${p}Key`]&&!l.includes(p))},lI=(r,l)=>{const p=r._withMods||(r._withMods={}),v=l.join(".");return p[v]||(p[v]=(A,...R)=>{for(let D=0;D<l.length;D++){const i=cL[l[D]];if(i&&i(A,l))return}return r(A,...R)})},uL={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},hL=(r,l)=>{const p=r._withKeys||(r._withKeys={}),v=l.join(".");return p[v]||(p[v]=A=>{if(!("key"in A))return;const R=Ac(A.key);if(l.some(D=>D===R||uL[D]===R))return r(A)})},dL=Wi({patchProp:Q4},F4);let FS;function cI(){return FS||(FS=l4(dL))}const wj=(...r)=>{cI().render(...r)},fL=(...r)=>{const l=cI().createApp(...r),{mount:p}=l;return l.mount=v=>{const A=mL(v);if(!A)return;const R=l._component;!Zr(R)&&!R.render&&!R.template&&(R.template=A.innerHTML),A.nodeType===1&&(A.textContent="");const D=p(A,!1,pL(A));return A instanceof Element&&(A.removeAttribute("v-cloak"),A.setAttribute("data-v-app","")),D},l};function pL(r){if(r instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&r instanceof MathMLElement)return"mathml"}function mL(r){return qn(r)?document.querySelector(r):r}/*!
 * pinia v3.0.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let uI;const $y=r=>uI=r,hI=Symbol();function Xx(r){return r&&typeof r=="object"&&Object.prototype.toString.call(r)==="[object Object]"&&typeof r.toJSON!="function"}var um;(function(r){r.direct="direct",r.patchObject="patch object",r.patchFunction="patch function"})(um||(um={}));function _L(){const r=x1(!0),l=r.run(()=>dn({}));let p=[],v=[];const A=C1({install(R){$y(A),A._a=R,R.provide(hI,A),R.config.globalProperties.$pinia=A,v.forEach(D=>p.push(D)),v=[]},use(R){return this._a?p.push(R):v.push(R),this},_p:p,_a:null,_e:r,_s:new Map,state:l});return A}const dI=()=>{};function BS(r,l,p,v=dI){r.push(l);const A=()=>{const R=r.indexOf(l);R>-1&&(r.splice(R,1),v())};return!p&&b1()&&Oy(A),A}function gd(r,...l){r.slice().forEach(p=>{p(...l)})}const gL=r=>r(),NS=Symbol(),wx=Symbol();function Kx(r,l){r instanceof Map&&l instanceof Map?l.forEach((p,v)=>r.set(v,p)):r instanceof Set&&l instanceof Set&&l.forEach(r.add,r);for(const p in l){if(!l.hasOwnProperty(p))continue;const v=l[p],A=r[p];Xx(A)&&Xx(v)&&r.hasOwnProperty(p)&&!Yn(v)&&!bc(v)?r[p]=Kx(A,v):r[p]=v}return r}const yL=Symbol();function vL(r){return!Xx(r)||!r.hasOwnProperty(yL)}const{assign:hc}=Object;function xL(r){return!!(Yn(r)&&r.effect)}function bL(r,l,p,v){const{state:A,actions:R,getters:D}=l,i=p.state.value[r];let G;function W(){i||(p.state.value[r]=A?A():{});const H=Fy(p.state.value[r]);return hc(H,R,Object.keys(D||{}).reduce((ee,ne)=>(ee[ne]=C1(et(()=>{$y(p);const de=p._s.get(r);return D[ne].call(de,de)})),ee),{}))}return G=fI(r,W,l,p,v,!0),G}function fI(r,l,p={},v,A,R){let D;const i=hc({actions:{}},p),G={deep:!0};let W,H,ee=[],ne=[],de;const he=v.state.value[r];!R&&!he&&(v.state.value[r]={}),dn({});let _e;function Ie(Et){let pt;W=H=!1,typeof Et=="function"?(Et(v.state.value[r]),pt={type:um.patchFunction,storeId:r,events:de}):(Kx(v.state.value[r],Et),pt={type:um.patchObject,payload:Et,storeId:r,events:de});const lt=_e=Symbol();Bs().then(()=>{_e===lt&&(W=!0)}),H=!0,gd(ee,pt,v.state.value[r])}const je=R?function(){const{state:pt}=p,lt=pt?pt():{};this.$patch(dt=>{hc(dt,lt)})}:dI;function vt(){D.stop(),ee=[],ne=[],v._s.delete(r)}const Pt=(Et,pt="")=>{if(NS in Et)return Et[wx]=pt,Et;const lt=function(){$y(v);const dt=Array.from(arguments),mt=[],nr=[];function Cr(vr){mt.push(vr)}function Zt(vr){nr.push(vr)}gd(ne,{args:dt,name:lt[wx],store:ft,after:Cr,onError:Zt});let Tr;try{Tr=Et.apply(this&&this.$id===r?this:ft,dt)}catch(vr){throw gd(nr,vr),vr}return Tr instanceof Promise?Tr.then(vr=>(gd(mt,vr),vr)).catch(vr=>(gd(nr,vr),Promise.reject(vr))):(gd(mt,Tr),Tr)};return lt[NS]=!0,lt[wx]=pt,lt},ht={_p:v,$id:r,$onAction:BS.bind(null,ne),$patch:Ie,$reset:je,$subscribe(Et,pt={}){const lt=BS(ee,Et,pt.detached,()=>dt()),dt=D.run(()=>Tn(()=>v.state.value[r],mt=>{(pt.flush==="sync"?H:W)&&Et({storeId:r,type:um.direct,events:de},mt)},hc({},G,pt)));return lt},$dispose:vt},ft=Ki(ht);v._s.set(r,ft);const Je=(v._a&&v._a.runWithContext||gL)(()=>v._e.run(()=>(D=x1()).run(()=>l({action:Pt}))));for(const Et in Je){const pt=Je[Et];if(Yn(pt)&&!xL(pt)||bc(pt))R||(he&&vL(pt)&&(Yn(pt)?pt.value=he[Et]:Kx(pt,he[Et])),v.state.value[r][Et]=pt);else if(typeof pt=="function"){const lt=Pt(pt,Et);Je[Et]=lt,i.actions[Et]=pt}}return hc(ft,Je),hc(zn(ft),Je),Object.defineProperty(ft,"$state",{get:()=>v.state.value[r],set:Et=>{Ie(pt=>{hc(pt,Et)})}}),v._p.forEach(Et=>{hc(ft,D.run(()=>Et({store:ft,app:v._a,pinia:v,options:i})))}),he&&R&&p.hydrate&&p.hydrate(ft.$state,he),W=!0,H=!0,ft}/*! #__NO_SIDE_EFFECTS__ */function pI(r,l,p){let v;const A=typeof l=="function";v=A?p:l;function R(D,i){const G=t4();return D=D||(G?Pn(hI,null):null),D&&$y(D),D=uI,D._s.has(r)||(A?fI(r,l,v,D):bL(r,v,D)),D._s.get(r)}return R.$id=r,R}const wL={name:"App"},km=(r,l)=>{const p=r.__vccOpts||r;for(const[v,A]of l)p[v]=A;return p};function TL(r,l,p,v,A,R){const D=EM("RouterView");return Kt(),Cn(D)}const SL=km(wL,[["render",TL]]);/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Td=typeof document<"u";function mI(r){return typeof r=="object"||"displayName"in r||"props"in r||"__vccOpts"in r}function EL(r){return r.__esModule||r[Symbol.toStringTag]==="Module"||r.default&&mI(r.default)}const Kn=Object.assign;function Tx(r,l){const p={};for(const v in l){const A=l[v];p[v]=da(A)?A.map(r):r(A)}return p}const hm=()=>{},da=Array.isArray,_I=/#/g,AL=/&/g,ML=/\//g,IL=/=/g,CL=/\?/g,gI=/\+/g,PL=/%5B/g,RL=/%5D/g,yI=/%5E/g,DL=/%60/g,vI=/%7B/g,zL=/%7C/g,xI=/%7D/g,LL=/%20/g;function j1(r){return encodeURI(""+r).replace(zL,"|").replace(PL,"[").replace(RL,"]")}function OL(r){return j1(r).replace(vI,"{").replace(xI,"}").replace(yI,"^")}function Yx(r){return j1(r).replace(gI,"%2B").replace(LL,"+").replace(_I,"%23").replace(AL,"%26").replace(DL,"`").replace(vI,"{").replace(xI,"}").replace(yI,"^")}function kL(r){return Yx(r).replace(IL,"%3D")}function FL(r){return j1(r).replace(_I,"%23").replace(CL,"%3F")}function BL(r){return r==null?"":FL(r).replace(ML,"%2F")}function bm(r){try{return decodeURIComponent(""+r)}catch{}return""+r}const NL=/\/$/,VL=r=>r.replace(NL,"");function Sx(r,l,p="/"){let v,A={},R="",D="";const i=l.indexOf("#");let G=l.indexOf("?");return i<G&&i>=0&&(G=-1),G>-1&&(v=l.slice(0,G),R=l.slice(G+1,i>-1?i:l.length),A=r(R)),i>-1&&(v=v||l.slice(0,i),D=l.slice(i,l.length)),v=GL(v??l,p),{fullPath:v+(R&&"?")+R+D,path:v,query:A,hash:bm(D)}}function UL(r,l){const p=l.query?r(l.query):"";return l.path+(p&&"?")+p+(l.hash||"")}function VS(r,l){return!l||!r.toLowerCase().startsWith(l.toLowerCase())?r:r.slice(l.length)||"/"}function jL(r,l,p){const v=l.matched.length-1,A=p.matched.length-1;return v>-1&&v===A&&Od(l.matched[v],p.matched[A])&&bI(l.params,p.params)&&r(l.query)===r(p.query)&&l.hash===p.hash}function Od(r,l){return(r.aliasOf||r)===(l.aliasOf||l)}function bI(r,l){if(Object.keys(r).length!==Object.keys(l).length)return!1;for(const p in r)if(!$L(r[p],l[p]))return!1;return!0}function $L(r,l){return da(r)?US(r,l):da(l)?US(l,r):r===l}function US(r,l){return da(l)?r.length===l.length&&r.every((p,v)=>p===l[v]):r.length===1&&r[0]===l}function GL(r,l){if(r.startsWith("/"))return r;if(!r)return l;const p=l.split("/"),v=r.split("/"),A=v[v.length-1];(A===".."||A===".")&&v.push("");let R=p.length-1,D,i;for(D=0;D<v.length;D++)if(i=v[D],i!==".")if(i==="..")R>1&&R--;else break;return p.slice(0,R).join("/")+"/"+v.slice(D).join("/")}const lc={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var wm;(function(r){r.pop="pop",r.push="push"})(wm||(wm={}));var dm;(function(r){r.back="back",r.forward="forward",r.unknown=""})(dm||(dm={}));function HL(r){if(!r)if(Td){const l=document.querySelector("base");r=l&&l.getAttribute("href")||"/",r=r.replace(/^\w+:\/\/[^\/]+/,"")}else r="/";return r[0]!=="/"&&r[0]!=="#"&&(r="/"+r),VL(r)}const qL=/^[^#]+#/;function WL(r,l){return r.replace(qL,"#")+l}function ZL(r,l){const p=document.documentElement.getBoundingClientRect(),v=r.getBoundingClientRect();return{behavior:l.behavior,left:v.left-p.left-(l.left||0),top:v.top-p.top-(l.top||0)}}const Gy=()=>({left:window.scrollX,top:window.scrollY});function XL(r){let l;if("el"in r){const p=r.el,v=typeof p=="string"&&p.startsWith("#"),A=typeof p=="string"?v?document.getElementById(p.slice(1)):document.querySelector(p):p;if(!A)return;l=ZL(A,r)}else l=r;"scrollBehavior"in document.documentElement.style?window.scrollTo(l):window.scrollTo(l.left!=null?l.left:window.scrollX,l.top!=null?l.top:window.scrollY)}function jS(r,l){return(history.state?history.state.position-l:-1)+r}const Jx=new Map;function KL(r,l){Jx.set(r,l)}function YL(r){const l=Jx.get(r);return Jx.delete(r),l}let JL=()=>location.protocol+"//"+location.host;function wI(r,l){const{pathname:p,search:v,hash:A}=l,R=r.indexOf("#");if(R>-1){let i=A.includes(r.slice(R))?r.slice(R).length:1,G=A.slice(i);return G[0]!=="/"&&(G="/"+G),VS(G,"")}return VS(p,r)+v+A}function QL(r,l,p,v){let A=[],R=[],D=null;const i=({state:ne})=>{const de=wI(r,location),he=p.value,_e=l.value;let Ie=0;if(ne){if(p.value=de,l.value=ne,D&&D===he){D=null;return}Ie=_e?ne.position-_e.position:0}else v(de);A.forEach(je=>{je(p.value,he,{delta:Ie,type:wm.pop,direction:Ie?Ie>0?dm.forward:dm.back:dm.unknown})})};function G(){D=p.value}function W(ne){A.push(ne);const de=()=>{const he=A.indexOf(ne);he>-1&&A.splice(he,1)};return R.push(de),de}function H(){const{history:ne}=window;ne.state&&ne.replaceState(Kn({},ne.state,{scroll:Gy()}),"")}function ee(){for(const ne of R)ne();R=[],window.removeEventListener("popstate",i),window.removeEventListener("beforeunload",H)}return window.addEventListener("popstate",i),window.addEventListener("beforeunload",H,{passive:!0}),{pauseListeners:G,listen:W,destroy:ee}}function $S(r,l,p,v=!1,A=!1){return{back:r,current:l,forward:p,replaced:v,position:window.history.length,scroll:A?Gy():null}}function eO(r){const{history:l,location:p}=window,v={value:wI(r,p)},A={value:l.state};A.value||R(v.value,{back:null,current:v.value,forward:null,position:l.length-1,replaced:!0,scroll:null},!0);function R(G,W,H){const ee=r.indexOf("#"),ne=ee>-1?(p.host&&document.querySelector("base")?r:r.slice(ee))+G:JL()+r+G;try{l[H?"replaceState":"pushState"](W,"",ne),A.value=W}catch(de){console.error(de),p[H?"replace":"assign"](ne)}}function D(G,W){const H=Kn({},l.state,$S(A.value.back,G,A.value.forward,!0),W,{position:A.value.position});R(G,H,!0),v.value=G}function i(G,W){const H=Kn({},A.value,l.state,{forward:G,scroll:Gy()});R(H.current,H,!0);const ee=Kn({},$S(v.value,G,null),{position:H.position+1},W);R(G,ee,!1),v.value=G}return{location:v,state:A,push:i,replace:D}}function tO(r){r=HL(r);const l=eO(r),p=QL(r,l.state,l.location,l.replace);function v(R,D=!0){D||p.pauseListeners(),history.go(R)}const A=Kn({location:"",base:r,go:v,createHref:WL.bind(null,r)},l,p);return Object.defineProperty(A,"location",{enumerable:!0,get:()=>l.location.value}),Object.defineProperty(A,"state",{enumerable:!0,get:()=>l.state.value}),A}function rO(r){return typeof r=="string"||r&&typeof r=="object"}function TI(r){return typeof r=="string"||typeof r=="symbol"}const SI=Symbol("");var GS;(function(r){r[r.aborted=4]="aborted",r[r.cancelled=8]="cancelled",r[r.duplicated=16]="duplicated"})(GS||(GS={}));function kd(r,l){return Kn(new Error,{type:r,[SI]:!0},l)}function pl(r,l){return r instanceof Error&&SI in r&&(l==null||!!(r.type&l))}const HS="[^/]+?",nO={sensitive:!1,strict:!1,start:!0,end:!0},iO=/[.+*?^${}()[\]/\\]/g;function sO(r,l){const p=Kn({},nO,l),v=[];let A=p.start?"^":"";const R=[];for(const W of r){const H=W.length?[]:[90];p.strict&&!W.length&&(A+="/");for(let ee=0;ee<W.length;ee++){const ne=W[ee];let de=40+(p.sensitive?.25:0);if(ne.type===0)ee||(A+="/"),A+=ne.value.replace(iO,"\\$&"),de+=40;else if(ne.type===1){const{value:he,repeatable:_e,optional:Ie,regexp:je}=ne;R.push({name:he,repeatable:_e,optional:Ie});const vt=je||HS;if(vt!==HS){de+=10;try{new RegExp(`(${vt})`)}catch(ht){throw new Error(`Invalid custom RegExp for param "${he}" (${vt}): `+ht.message)}}let Pt=_e?`((?:${vt})(?:/(?:${vt}))*)`:`(${vt})`;ee||(Pt=Ie&&W.length<2?`(?:/${Pt})`:"/"+Pt),Ie&&(Pt+="?"),A+=Pt,de+=20,Ie&&(de+=-8),_e&&(de+=-20),vt===".*"&&(de+=-50)}H.push(de)}v.push(H)}if(p.strict&&p.end){const W=v.length-1;v[W][v[W].length-1]+=.7000000000000001}p.strict||(A+="/?"),p.end?A+="$":p.strict&&!A.endsWith("/")&&(A+="(?:/|$)");const D=new RegExp(A,p.sensitive?"":"i");function i(W){const H=W.match(D),ee={};if(!H)return null;for(let ne=1;ne<H.length;ne++){const de=H[ne]||"",he=R[ne-1];ee[he.name]=de&&he.repeatable?de.split("/"):de}return ee}function G(W){let H="",ee=!1;for(const ne of r){(!ee||!H.endsWith("/"))&&(H+="/"),ee=!1;for(const de of ne)if(de.type===0)H+=de.value;else if(de.type===1){const{value:he,repeatable:_e,optional:Ie}=de,je=he in W?W[he]:"";if(da(je)&&!_e)throw new Error(`Provided param "${he}" is an array but it is not repeatable (* or + modifiers)`);const vt=da(je)?je.join("/"):je;if(!vt)if(Ie)ne.length<2&&(H.endsWith("/")?H=H.slice(0,-1):ee=!0);else throw new Error(`Missing required param "${he}"`);H+=vt}}return H||"/"}return{re:D,score:v,keys:R,parse:i,stringify:G}}function oO(r,l){let p=0;for(;p<r.length&&p<l.length;){const v=l[p]-r[p];if(v)return v;p++}return r.length<l.length?r.length===1&&r[0]===80?-1:1:r.length>l.length?l.length===1&&l[0]===80?1:-1:0}function EI(r,l){let p=0;const v=r.score,A=l.score;for(;p<v.length&&p<A.length;){const R=oO(v[p],A[p]);if(R)return R;p++}if(Math.abs(A.length-v.length)===1){if(qS(v))return 1;if(qS(A))return-1}return A.length-v.length}function qS(r){const l=r[r.length-1];return r.length>0&&l[l.length-1]<0}const aO={type:0,value:""},lO=/[a-zA-Z0-9_]/;function cO(r){if(!r)return[[]];if(r==="/")return[[aO]];if(!r.startsWith("/"))throw new Error(`Invalid path "${r}"`);function l(de){throw new Error(`ERR (${p})/"${W}": ${de}`)}let p=0,v=p;const A=[];let R;function D(){R&&A.push(R),R=[]}let i=0,G,W="",H="";function ee(){W&&(p===0?R.push({type:0,value:W}):p===1||p===2||p===3?(R.length>1&&(G==="*"||G==="+")&&l(`A repeatable param (${W}) must be alone in its segment. eg: '/:ids+.`),R.push({type:1,value:W,regexp:H,repeatable:G==="*"||G==="+",optional:G==="*"||G==="?"})):l("Invalid state to consume buffer"),W="")}function ne(){W+=G}for(;i<r.length;){if(G=r[i++],G==="\\"&&p!==2){v=p,p=4;continue}switch(p){case 0:G==="/"?(W&&ee(),D()):G===":"?(ee(),p=1):ne();break;case 4:ne(),p=v;break;case 1:G==="("?p=2:lO.test(G)?ne():(ee(),p=0,G!=="*"&&G!=="?"&&G!=="+"&&i--);break;case 2:G===")"?H[H.length-1]=="\\"?H=H.slice(0,-1)+G:p=3:H+=G;break;case 3:ee(),p=0,G!=="*"&&G!=="?"&&G!=="+"&&i--,H="";break;default:l("Unknown state");break}}return p===2&&l(`Unfinished custom RegExp for param "${W}"`),ee(),D(),A}function uO(r,l,p){const v=sO(cO(r.path),p),A=Kn(v,{record:r,parent:l,children:[],alias:[]});return l&&!A.record.aliasOf==!l.record.aliasOf&&l.children.push(A),A}function hO(r,l){const p=[],v=new Map;l=KS({strict:!1,end:!0,sensitive:!1},l);function A(ee){return v.get(ee)}function R(ee,ne,de){const he=!de,_e=ZS(ee);_e.aliasOf=de&&de.record;const Ie=KS(l,ee),je=[_e];if("alias"in ee){const ht=typeof ee.alias=="string"?[ee.alias]:ee.alias;for(const ft of ht)je.push(ZS(Kn({},_e,{components:de?de.record.components:_e.components,path:ft,aliasOf:de?de.record:_e})))}let vt,Pt;for(const ht of je){const{path:ft}=ht;if(ne&&ft[0]!=="/"){const bt=ne.record.path,Je=bt[bt.length-1]==="/"?"":"/";ht.path=ne.record.path+(ft&&Je+ft)}if(vt=uO(ht,ne,Ie),de?de.alias.push(vt):(Pt=Pt||vt,Pt!==vt&&Pt.alias.push(vt),he&&ee.name&&!XS(vt)&&D(ee.name)),AI(vt)&&G(vt),_e.children){const bt=_e.children;for(let Je=0;Je<bt.length;Je++)R(bt[Je],vt,de&&de.children[Je])}de=de||vt}return Pt?()=>{D(Pt)}:hm}function D(ee){if(TI(ee)){const ne=v.get(ee);ne&&(v.delete(ee),p.splice(p.indexOf(ne),1),ne.children.forEach(D),ne.alias.forEach(D))}else{const ne=p.indexOf(ee);ne>-1&&(p.splice(ne,1),ee.record.name&&v.delete(ee.record.name),ee.children.forEach(D),ee.alias.forEach(D))}}function i(){return p}function G(ee){const ne=pO(ee,p);p.splice(ne,0,ee),ee.record.name&&!XS(ee)&&v.set(ee.record.name,ee)}function W(ee,ne){let de,he={},_e,Ie;if("name"in ee&&ee.name){if(de=v.get(ee.name),!de)throw kd(1,{location:ee});Ie=de.record.name,he=Kn(WS(ne.params,de.keys.filter(Pt=>!Pt.optional).concat(de.parent?de.parent.keys.filter(Pt=>Pt.optional):[]).map(Pt=>Pt.name)),ee.params&&WS(ee.params,de.keys.map(Pt=>Pt.name))),_e=de.stringify(he)}else if(ee.path!=null)_e=ee.path,de=p.find(Pt=>Pt.re.test(_e)),de&&(he=de.parse(_e),Ie=de.record.name);else{if(de=ne.name?v.get(ne.name):p.find(Pt=>Pt.re.test(ne.path)),!de)throw kd(1,{location:ee,currentLocation:ne});Ie=de.record.name,he=Kn({},ne.params,ee.params),_e=de.stringify(he)}const je=[];let vt=de;for(;vt;)je.unshift(vt.record),vt=vt.parent;return{name:Ie,path:_e,params:he,matched:je,meta:fO(je)}}r.forEach(ee=>R(ee));function H(){p.length=0,v.clear()}return{addRoute:R,resolve:W,removeRoute:D,clearRoutes:H,getRoutes:i,getRecordMatcher:A}}function WS(r,l){const p={};for(const v of l)v in r&&(p[v]=r[v]);return p}function ZS(r){const l={path:r.path,redirect:r.redirect,name:r.name,meta:r.meta||{},aliasOf:r.aliasOf,beforeEnter:r.beforeEnter,props:dO(r),children:r.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in r?r.components||null:r.component&&{default:r.component}};return Object.defineProperty(l,"mods",{value:{}}),l}function dO(r){const l={},p=r.props||!1;if("component"in r)l.default=p;else for(const v in r.components)l[v]=typeof p=="object"?p[v]:p;return l}function XS(r){for(;r;){if(r.record.aliasOf)return!0;r=r.parent}return!1}function fO(r){return r.reduce((l,p)=>Kn(l,p.meta),{})}function KS(r,l){const p={};for(const v in r)p[v]=v in l?l[v]:r[v];return p}function pO(r,l){let p=0,v=l.length;for(;p!==v;){const R=p+v>>1;EI(r,l[R])<0?v=R:p=R+1}const A=mO(r);return A&&(v=l.lastIndexOf(A,v-1)),v}function mO(r){let l=r;for(;l=l.parent;)if(AI(l)&&EI(r,l)===0)return l}function AI({record:r}){return!!(r.name||r.components&&Object.keys(r.components).length||r.redirect)}function _O(r){const l={};if(r===""||r==="?")return l;const v=(r[0]==="?"?r.slice(1):r).split("&");for(let A=0;A<v.length;++A){const R=v[A].replace(gI," "),D=R.indexOf("="),i=bm(D<0?R:R.slice(0,D)),G=D<0?null:bm(R.slice(D+1));if(i in l){let W=l[i];da(W)||(W=l[i]=[W]),W.push(G)}else l[i]=G}return l}function YS(r){let l="";for(let p in r){const v=r[p];if(p=kL(p),v==null){v!==void 0&&(l+=(l.length?"&":"")+p);continue}(da(v)?v.map(R=>R&&Yx(R)):[v&&Yx(v)]).forEach(R=>{R!==void 0&&(l+=(l.length?"&":"")+p,R!=null&&(l+="="+R))})}return l}function gO(r){const l={};for(const p in r){const v=r[p];v!==void 0&&(l[p]=da(v)?v.map(A=>A==null?null:""+A):v==null?v:""+v)}return l}const yO=Symbol(""),JS=Symbol(""),$1=Symbol(""),MI=Symbol(""),Qx=Symbol("");function em(){let r=[];function l(v){return r.push(v),()=>{const A=r.indexOf(v);A>-1&&r.splice(A,1)}}function p(){r=[]}return{add:l,list:()=>r.slice(),reset:p}}function mc(r,l,p,v,A,R=D=>D()){const D=v&&(v.enterCallbacks[A]=v.enterCallbacks[A]||[]);return()=>new Promise((i,G)=>{const W=ne=>{ne===!1?G(kd(4,{from:p,to:l})):ne instanceof Error?G(ne):rO(ne)?G(kd(2,{from:l,to:ne})):(D&&v.enterCallbacks[A]===D&&typeof ne=="function"&&D.push(ne),i())},H=R(()=>r.call(v&&v.instances[A],l,p,W));let ee=Promise.resolve(H);r.length<3&&(ee=ee.then(W)),ee.catch(ne=>G(ne))})}function Ex(r,l,p,v,A=R=>R()){const R=[];for(const D of r)for(const i in D.components){let G=D.components[i];if(!(l!=="beforeRouteEnter"&&!D.instances[i]))if(mI(G)){const H=(G.__vccOpts||G)[l];H&&R.push(mc(H,p,v,D,i,A))}else{let W=G();R.push(()=>W.then(H=>{if(!H)throw new Error(`Couldn't resolve component "${i}" at "${D.path}"`);const ee=EL(H)?H.default:H;D.mods[i]=H,D.components[i]=ee;const de=(ee.__vccOpts||ee)[l];return de&&mc(de,p,v,D,i,A)()}))}}return R}function QS(r){const l=Pn($1),p=Pn(MI),v=et(()=>{const G=xt(r.to);return l.resolve(G)}),A=et(()=>{const{matched:G}=v.value,{length:W}=G,H=G[W-1],ee=p.matched;if(!H||!ee.length)return-1;const ne=ee.findIndex(Od.bind(null,H));if(ne>-1)return ne;const de=eE(G[W-2]);return W>1&&eE(H)===de&&ee[ee.length-1].path!==de?ee.findIndex(Od.bind(null,G[W-2])):ne}),R=et(()=>A.value>-1&&TO(p.params,v.value.params)),D=et(()=>A.value>-1&&A.value===p.matched.length-1&&bI(p.params,v.value.params));function i(G={}){if(wO(G)){const W=l[xt(r.replace)?"replace":"push"](xt(r.to)).catch(hm);return r.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>W),W}return Promise.resolve()}return{route:v,href:et(()=>v.value.href),isActive:R,isExactActive:D,navigate:i}}function vO(r){return r.length===1?r[0]:r}const xO=pn({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:QS,setup(r,{slots:l}){const p=Ki(QS(r)),{options:v}=Pn($1),A=et(()=>({[tE(r.activeClass,v.linkActiveClass,"router-link-active")]:p.isActive,[tE(r.exactActiveClass,v.linkExactActiveClass,"router-link-exact-active")]:p.isExactActive}));return()=>{const R=l.default&&vO(l.default(p));return r.custom?R:bl("a",{"aria-current":p.isExactActive?r.ariaCurrentValue:null,href:p.href,onClick:p.navigate,class:A.value},R)}}}),bO=xO;function wO(r){if(!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)&&!r.defaultPrevented&&!(r.button!==void 0&&r.button!==0)){if(r.currentTarget&&r.currentTarget.getAttribute){const l=r.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(l))return}return r.preventDefault&&r.preventDefault(),!0}}function TO(r,l){for(const p in l){const v=l[p],A=r[p];if(typeof v=="string"){if(v!==A)return!1}else if(!da(A)||A.length!==v.length||v.some((R,D)=>R!==A[D]))return!1}return!0}function eE(r){return r?r.aliasOf?r.aliasOf.path:r.path:""}const tE=(r,l,p)=>r??l??p,SO=pn({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(r,{attrs:l,slots:p}){const v=Pn(Qx),A=et(()=>r.route||v.value),R=Pn(JS,0),D=et(()=>{let W=xt(R);const{matched:H}=A.value;let ee;for(;(ee=H[W])&&!ee.components;)W++;return W}),i=et(()=>A.value.matched[D.value]);vo(JS,et(()=>D.value+1)),vo(yO,i),vo(Qx,A);const G=dn();return Tn(()=>[G.value,i.value,r.name],([W,H,ee],[ne,de,he])=>{H&&(H.instances[ee]=W,de&&de!==H&&W&&W===ne&&(H.leaveGuards.size||(H.leaveGuards=de.leaveGuards),H.updateGuards.size||(H.updateGuards=de.updateGuards))),W&&H&&(!de||!Od(H,de)||!ne)&&(H.enterCallbacks[ee]||[]).forEach(_e=>_e(W))},{flush:"post"}),()=>{const W=A.value,H=r.name,ee=i.value,ne=ee&&ee.components[H];if(!ne)return rE(p.default,{Component:ne,route:W});const de=ee.props[H],he=de?de===!0?W.params:typeof de=="function"?de(W):de:null,Ie=bl(ne,Kn({},he,l,{onVnodeUnmounted:je=>{je.component.isUnmounted&&(ee.instances[H]=null)},ref:G}));return rE(p.default,{Component:Ie,route:W})||Ie}}});function rE(r,l){if(!r)return null;const p=r(l);return p.length===1?p[0]:p}const EO=SO;function AO(r){const l=hO(r.routes,r),p=r.parseQuery||_O,v=r.stringifyQuery||YS,A=r.history,R=em(),D=em(),i=em(),G=Vn(lc);let W=lc;Td&&r.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const H=Tx.bind(null,Rt=>""+Rt),ee=Tx.bind(null,BL),ne=Tx.bind(null,bm);function de(Rt,tr){let Yt,te;return TI(Rt)?(Yt=l.getRecordMatcher(Rt),te=tr):te=Rt,l.addRoute(te,Yt)}function he(Rt){const tr=l.getRecordMatcher(Rt);tr&&l.removeRoute(tr)}function _e(){return l.getRoutes().map(Rt=>Rt.record)}function Ie(Rt){return!!l.getRecordMatcher(Rt)}function je(Rt,tr){if(tr=Kn({},tr||G.value),typeof Rt=="string"){const Ae=Sx(p,Rt,tr.path),wt=l.resolve({path:Ae.path},tr),Vt=A.createHref(Ae.fullPath);return Kn(Ae,wt,{params:ne(wt.params),hash:bm(Ae.hash),redirectedFrom:void 0,href:Vt})}let Yt;if(Rt.path!=null)Yt=Kn({},Rt,{path:Sx(p,Rt.path,tr.path).path});else{const Ae=Kn({},Rt.params);for(const wt in Ae)Ae[wt]==null&&delete Ae[wt];Yt=Kn({},Rt,{params:ee(Ae)}),tr.params=ee(tr.params)}const te=l.resolve(Yt,tr),vn=Rt.hash||"";te.params=H(ne(te.params));const ke=UL(v,Kn({},Rt,{hash:OL(vn),path:te.path})),Ve=A.createHref(ke);return Kn({fullPath:ke,hash:vn,query:v===YS?gO(Rt.query):Rt.query||{}},te,{redirectedFrom:void 0,href:Ve})}function vt(Rt){return typeof Rt=="string"?Sx(p,Rt,G.value.path):Kn({},Rt)}function Pt(Rt,tr){if(W!==Rt)return kd(8,{from:tr,to:Rt})}function ht(Rt){return Je(Rt)}function ft(Rt){return ht(Kn(vt(Rt),{replace:!0}))}function bt(Rt){const tr=Rt.matched[Rt.matched.length-1];if(tr&&tr.redirect){const{redirect:Yt}=tr;let te=typeof Yt=="function"?Yt(Rt):Yt;return typeof te=="string"&&(te=te.includes("?")||te.includes("#")?te=vt(te):{path:te},te.params={}),Kn({query:Rt.query,hash:Rt.hash,params:te.path!=null?{}:Rt.params},te)}}function Je(Rt,tr){const Yt=W=je(Rt),te=G.value,vn=Rt.state,ke=Rt.force,Ve=Rt.replace===!0,Ae=bt(Yt);if(Ae)return Je(Kn(vt(Ae),{state:typeof Ae=="object"?Kn({},vn,Ae.state):vn,force:ke,replace:Ve}),tr||Yt);const wt=Yt;wt.redirectedFrom=tr;let Vt;return!ke&&jL(v,te,Yt)&&(Vt=kd(16,{to:wt,from:te}),ur(te,te,!0,!1)),(Vt?Promise.resolve(Vt):lt(wt,te)).catch(zt=>pl(zt)?pl(zt,2)?zt:qr(zt):Ur(zt,wt,te)).then(zt=>{if(zt){if(pl(zt,2))return Je(Kn({replace:Ve},vt(zt.to),{state:typeof zt.to=="object"?Kn({},vn,zt.to.state):vn,force:ke}),tr||wt)}else zt=mt(wt,te,!0,Ve,vn);return dt(wt,te,zt),zt})}function Et(Rt,tr){const Yt=Pt(Rt,tr);return Yt?Promise.reject(Yt):Promise.resolve()}function pt(Rt){const tr=vi.values().next().value;return tr&&typeof tr.runWithContext=="function"?tr.runWithContext(Rt):Rt()}function lt(Rt,tr){let Yt;const[te,vn,ke]=MO(Rt,tr);Yt=Ex(te.reverse(),"beforeRouteLeave",Rt,tr);for(const Ae of te)Ae.leaveGuards.forEach(wt=>{Yt.push(mc(wt,Rt,tr))});const Ve=Et.bind(null,Rt,tr);return Yt.push(Ve),yn(Yt).then(()=>{Yt=[];for(const Ae of R.list())Yt.push(mc(Ae,Rt,tr));return Yt.push(Ve),yn(Yt)}).then(()=>{Yt=Ex(vn,"beforeRouteUpdate",Rt,tr);for(const Ae of vn)Ae.updateGuards.forEach(wt=>{Yt.push(mc(wt,Rt,tr))});return Yt.push(Ve),yn(Yt)}).then(()=>{Yt=[];for(const Ae of ke)if(Ae.beforeEnter)if(da(Ae.beforeEnter))for(const wt of Ae.beforeEnter)Yt.push(mc(wt,Rt,tr));else Yt.push(mc(Ae.beforeEnter,Rt,tr));return Yt.push(Ve),yn(Yt)}).then(()=>(Rt.matched.forEach(Ae=>Ae.enterCallbacks={}),Yt=Ex(ke,"beforeRouteEnter",Rt,tr,pt),Yt.push(Ve),yn(Yt))).then(()=>{Yt=[];for(const Ae of D.list())Yt.push(mc(Ae,Rt,tr));return Yt.push(Ve),yn(Yt)}).catch(Ae=>pl(Ae,8)?Ae:Promise.reject(Ae))}function dt(Rt,tr,Yt){i.list().forEach(te=>pt(()=>te(Rt,tr,Yt)))}function mt(Rt,tr,Yt,te,vn){const ke=Pt(Rt,tr);if(ke)return ke;const Ve=tr===lc,Ae=Td?history.state:{};Yt&&(te||Ve?A.replace(Rt.fullPath,Kn({scroll:Ve&&Ae&&Ae.scroll},vn)):A.push(Rt.fullPath,vn)),G.value=Rt,ur(Rt,tr,Yt,Ve),qr()}let nr;function Cr(){nr||(nr=A.listen((Rt,tr,Yt)=>{if(!di.listening)return;const te=je(Rt),vn=bt(te);if(vn){Je(Kn(vn,{replace:!0,force:!0}),te).catch(hm);return}W=te;const ke=G.value;Td&&KL(jS(ke.fullPath,Yt.delta),Gy()),lt(te,ke).catch(Ve=>pl(Ve,12)?Ve:pl(Ve,2)?(Je(Kn(vt(Ve.to),{force:!0}),te).then(Ae=>{pl(Ae,20)&&!Yt.delta&&Yt.type===wm.pop&&A.go(-1,!1)}).catch(hm),Promise.reject()):(Yt.delta&&A.go(-Yt.delta,!1),Ur(Ve,te,ke))).then(Ve=>{Ve=Ve||mt(te,ke,!1),Ve&&(Yt.delta&&!pl(Ve,8)?A.go(-Yt.delta,!1):Yt.type===wm.pop&&pl(Ve,20)&&A.go(-1,!1)),dt(te,ke,Ve)}).catch(hm)}))}let Zt=em(),Tr=em(),vr;function Ur(Rt,tr,Yt){qr(Rt);const te=Tr.list();return te.length?te.forEach(vn=>vn(Rt,tr,Yt)):console.error(Rt),Promise.reject(Rt)}function lr(){return vr&&G.value!==lc?Promise.resolve():new Promise((Rt,tr)=>{Zt.add([Rt,tr])})}function qr(Rt){return vr||(vr=!Rt,Cr(),Zt.list().forEach(([tr,Yt])=>Rt?Yt(Rt):tr()),Zt.reset()),Rt}function ur(Rt,tr,Yt,te){const{scrollBehavior:vn}=r;if(!Td||!vn)return Promise.resolve();const ke=!Yt&&YL(jS(Rt.fullPath,0))||(te||!Yt)&&history.state&&history.state.scroll||null;return Bs().then(()=>vn(Rt,tr,ke)).then(Ve=>Ve&&XL(Ve)).catch(Ve=>Ur(Ve,Rt,tr))}const ir=Rt=>A.go(Rt);let $t;const vi=new Set,di={currentRoute:G,listening:!0,addRoute:de,removeRoute:he,clearRoutes:l.clearRoutes,hasRoute:Ie,getRoutes:_e,resolve:je,options:r,push:ht,replace:ft,go:ir,back:()=>ir(-1),forward:()=>ir(1),beforeEach:R.add,beforeResolve:D.add,afterEach:i.add,onError:Tr.add,isReady:lr,install(Rt){const tr=this;Rt.component("RouterLink",bO),Rt.component("RouterView",EO),Rt.config.globalProperties.$router=tr,Object.defineProperty(Rt.config.globalProperties,"$route",{enumerable:!0,get:()=>xt(G)}),Td&&!$t&&G.value===lc&&($t=!0,ht(A.location).catch(vn=>{}));const Yt={};for(const vn in lc)Object.defineProperty(Yt,vn,{get:()=>G.value[vn],enumerable:!0});Rt.provide($1,tr),Rt.provide(MI,rM(Yt)),Rt.provide(Qx,G);const te=Rt.unmount;vi.add(Rt),Rt.unmount=function(){vi.delete(Rt),vi.size<1&&(W=lc,nr&&nr(),nr=null,G.value=lc,$t=!1,vr=!1),te()}}};function yn(Rt){return Rt.reduce((tr,Yt)=>tr.then(()=>pt(Yt)),Promise.resolve())}return di}function MO(r,l){const p=[],v=[],A=[],R=Math.max(l.matched.length,r.matched.length);for(let D=0;D<R;D++){const i=l.matched[D];i&&(r.matched.find(W=>Od(W,i))?v.push(i):p.push(i));const G=r.matched[D];G&&(l.matched.find(W=>Od(W,G))||A.push(G))}return[p,v,A]}const IO="modulepreload",CO=function(r){return"/"+r},nE={},PO=function(l,p,v){let A=Promise.resolve();if(p&&p.length>0){document.getElementsByTagName("link");const D=document.querySelector("meta[property=csp-nonce]"),i=(D==null?void 0:D.nonce)||(D==null?void 0:D.getAttribute("nonce"));A=Promise.allSettled(p.map(G=>{if(G=CO(G),G in nE)return;nE[G]=!0;const W=G.endsWith(".css"),H=W?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${G}"]${H}`))return;const ee=document.createElement("link");if(ee.rel=W?"stylesheet":IO,W||(ee.as="script"),ee.crossOrigin="",ee.href=G,i&&ee.setAttribute("nonce",i),document.head.appendChild(ee),W)return new Promise((ne,de)=>{ee.addEventListener("load",ne),ee.addEventListener("error",()=>de(new Error(`Unable to preload CSS for ${G}`)))})}))}function R(D){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=D,window.dispatchEvent(i),!i.defaultPrevented)throw D}return A.then(D=>{for(const i of D||[])i.status==="rejected"&&R(i.reason);return l().catch(R)})},RO=[{path:"/",name:"/",component:()=>PO(()=>import("./index-BqvrvH4_.js"),__vite__mapDeps([0,1]))}],II=pI("main",{state:()=>({drawer:void 0,movileDrawer:!1})});function DO(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Qg={exports:{}},zO=Qg.exports,iE;function LO(){return iE||(iE=1,function(r,l){(function(p,v){r.exports=v()})(zO,function(){var p,v,A;function R(i,G){if(!p)p=G;else if(!v)v=G;else{var W="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+v+")(sharedChunk); self.onerror = null;",H={};p(H),A=G(H),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(A.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}R(["exports"],function(i){function G(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var W,H={},ee={};function ne(){if(W)return ee;W=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.setMatrixArrayType=function(u){ee.ARRAY_TYPE=e=u},ee.toRadian=function(u){return u*a},ee.equals=function(u,c){return Math.abs(u-c)<=o*Math.max(1,Math.abs(u),Math.abs(c))},ee.RANDOM=ee.ARRAY_TYPE=ee.EPSILON=void 0;var o=1e-6;ee.EPSILON=o;var e=typeof Float32Array<"u"?Float32Array:Array;ee.ARRAY_TYPE=e;var n=Math.random;ee.RANDOM=n;var a=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var u=0,c=arguments.length;c--;)u+=arguments[c]*arguments[c];return Math.sqrt(u)}),ee}var de,he={};function _e(){if(de)return he;function o(c){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},o(c)}de=1,Object.defineProperty(he,"__esModule",{value:!0}),he.create=function(){var c=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},he.clone=function(c){var f=new e.ARRAY_TYPE(4);return f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f},he.copy=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[3],c},he.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c},he.fromValues=function(c,f,y,b){var S=new e.ARRAY_TYPE(4);return S[0]=c,S[1]=f,S[2]=y,S[3]=b,S},he.set=function(c,f,y,b,S){return c[0]=f,c[1]=y,c[2]=b,c[3]=S,c},he.transpose=function(c,f){if(c===f){var y=f[1];c[1]=f[2],c[2]=y}else c[0]=f[0],c[1]=f[2],c[2]=f[1],c[3]=f[3];return c},he.invert=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=y*_-S*b;return w?(c[0]=_*(w=1/w),c[1]=-b*w,c[2]=-S*w,c[3]=y*w,c):null},he.adjoint=function(c,f){var y=f[0];return c[0]=f[3],c[1]=-f[1],c[2]=-f[2],c[3]=y,c},he.determinant=function(c){return c[0]*c[3]-c[2]*c[1]},he.multiply=a,he.rotate=function(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=Math.sin(y),T=Math.cos(y);return c[0]=b*T+_*M,c[1]=S*T+w*M,c[2]=b*-M+_*T,c[3]=S*-M+w*T,c},he.scale=function(c,f,y){var b=f[1],S=f[2],_=f[3],w=y[0],M=y[1];return c[0]=f[0]*w,c[1]=b*w,c[2]=S*M,c[3]=_*M,c},he.fromRotation=function(c,f){var y=Math.sin(f),b=Math.cos(f);return c[0]=b,c[1]=y,c[2]=-y,c[3]=b,c},he.fromScaling=function(c,f){return c[0]=f[0],c[1]=0,c[2]=0,c[3]=f[1],c},he.str=function(c){return"mat2("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+")"},he.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},he.LDU=function(c,f,y,b){return c[2]=b[2]/b[0],y[0]=b[0],y[1]=b[1],y[3]=b[3]-c[2]*y[1],[c,f,y]},he.add=function(c,f,y){return c[0]=f[0]+y[0],c[1]=f[1]+y[1],c[2]=f[2]+y[2],c[3]=f[3]+y[3],c},he.subtract=u,he.exactEquals=function(c,f){return c[0]===f[0]&&c[1]===f[1]&&c[2]===f[2]&&c[3]===f[3]},he.equals=function(c,f){var y=c[0],b=c[1],S=c[2],_=c[3],w=f[0],M=f[1],T=f[2],E=f[3];return Math.abs(y-w)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(w))&&Math.abs(b-M)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(M))&&Math.abs(S-T)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(T))&&Math.abs(_-E)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(E))},he.multiplyScalar=function(c,f,y){return c[0]=f[0]*y,c[1]=f[1]*y,c[2]=f[2]*y,c[3]=f[3]*y,c},he.multiplyScalarAndAdd=function(c,f,y,b){return c[0]=f[0]+y[0]*b,c[1]=f[1]+y[1]*b,c[2]=f[2]+y[2]*b,c[3]=f[3]+y[3]*b,c},he.sub=he.mul=void 0;var e=function(c,f){if(c&&c.__esModule)return c;if(c===null||o(c)!=="object"&&typeof c!="function")return{default:c};var y=n(void 0);if(y&&y.has(c))return y.get(c);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var w=S?Object.getOwnPropertyDescriptor(c,_):null;w&&(w.get||w.set)?Object.defineProperty(b,_,w):b[_]=c[_]}return b.default=c,y&&y.set(c,b),b}(ne());function n(c){if(typeof WeakMap!="function")return null;var f=new WeakMap,y=new WeakMap;return(n=function(b){return b?y:f})(c)}function a(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=y[0],T=y[1],E=y[2],C=y[3];return c[0]=b*M+_*T,c[1]=S*M+w*T,c[2]=b*E+_*C,c[3]=S*E+w*C,c}function u(c,f,y){return c[0]=f[0]-y[0],c[1]=f[1]-y[1],c[2]=f[2]-y[2],c[3]=f[3]-y[3],c}return he.mul=a,he.sub=u,he}var Ie,je={};function vt(){if(Ie)return je;function o(c){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},o(c)}Ie=1,Object.defineProperty(je,"__esModule",{value:!0}),je.create=function(){var c=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0,c[4]=0,c[5]=0),c[0]=1,c[3]=1,c},je.clone=function(c){var f=new e.ARRAY_TYPE(6);return f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f[4]=c[4],f[5]=c[5],f},je.copy=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c},je.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=0,c[5]=0,c},je.fromValues=function(c,f,y,b,S,_){var w=new e.ARRAY_TYPE(6);return w[0]=c,w[1]=f,w[2]=y,w[3]=b,w[4]=S,w[5]=_,w},je.set=function(c,f,y,b,S,_,w){return c[0]=f,c[1]=y,c[2]=b,c[3]=S,c[4]=_,c[5]=w,c},je.invert=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],M=f[5],T=y*_-b*S;return T?(c[0]=_*(T=1/T),c[1]=-b*T,c[2]=-S*T,c[3]=y*T,c[4]=(S*M-_*w)*T,c[5]=(b*w-y*M)*T,c):null},je.determinant=function(c){return c[0]*c[3]-c[1]*c[2]},je.multiply=a,je.rotate=function(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=Math.sin(y),C=Math.cos(y);return c[0]=b*C+_*E,c[1]=S*C+w*E,c[2]=b*-E+_*C,c[3]=S*-E+w*C,c[4]=M,c[5]=T,c},je.scale=function(c,f,y){var b=f[1],S=f[2],_=f[3],w=f[4],M=f[5],T=y[0],E=y[1];return c[0]=f[0]*T,c[1]=b*T,c[2]=S*E,c[3]=_*E,c[4]=w,c[5]=M,c},je.translate=function(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=y[0],C=y[1];return c[0]=b,c[1]=S,c[2]=_,c[3]=w,c[4]=b*E+_*C+M,c[5]=S*E+w*C+T,c},je.fromRotation=function(c,f){var y=Math.sin(f),b=Math.cos(f);return c[0]=b,c[1]=y,c[2]=-y,c[3]=b,c[4]=0,c[5]=0,c},je.fromScaling=function(c,f){return c[0]=f[0],c[1]=0,c[2]=0,c[3]=f[1],c[4]=0,c[5]=0,c},je.fromTranslation=function(c,f){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=f[0],c[5]=f[1],c},je.str=function(c){return"mat2d("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+")"},je.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3],c[4],c[5],1)},je.add=function(c,f,y){return c[0]=f[0]+y[0],c[1]=f[1]+y[1],c[2]=f[2]+y[2],c[3]=f[3]+y[3],c[4]=f[4]+y[4],c[5]=f[5]+y[5],c},je.subtract=u,je.multiplyScalar=function(c,f,y){return c[0]=f[0]*y,c[1]=f[1]*y,c[2]=f[2]*y,c[3]=f[3]*y,c[4]=f[4]*y,c[5]=f[5]*y,c},je.multiplyScalarAndAdd=function(c,f,y,b){return c[0]=f[0]+y[0]*b,c[1]=f[1]+y[1]*b,c[2]=f[2]+y[2]*b,c[3]=f[3]+y[3]*b,c[4]=f[4]+y[4]*b,c[5]=f[5]+y[5]*b,c},je.exactEquals=function(c,f){return c[0]===f[0]&&c[1]===f[1]&&c[2]===f[2]&&c[3]===f[3]&&c[4]===f[4]&&c[5]===f[5]},je.equals=function(c,f){var y=c[0],b=c[1],S=c[2],_=c[3],w=c[4],M=c[5],T=f[0],E=f[1],C=f[2],O=f[3],k=f[4],U=f[5];return Math.abs(y-T)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(T))&&Math.abs(b-E)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(S-C)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(C))&&Math.abs(_-O)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(O))&&Math.abs(w-k)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(k))&&Math.abs(M-U)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(U))},je.sub=je.mul=void 0;var e=function(c,f){if(c&&c.__esModule)return c;if(c===null||o(c)!=="object"&&typeof c!="function")return{default:c};var y=n(void 0);if(y&&y.has(c))return y.get(c);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var w=S?Object.getOwnPropertyDescriptor(c,_):null;w&&(w.get||w.set)?Object.defineProperty(b,_,w):b[_]=c[_]}return b.default=c,y&&y.set(c,b),b}(ne());function n(c){if(typeof WeakMap!="function")return null;var f=new WeakMap,y=new WeakMap;return(n=function(b){return b?y:f})(c)}function a(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=y[0],C=y[1],O=y[2],k=y[3],U=y[4],V=y[5];return c[0]=b*E+_*C,c[1]=S*E+w*C,c[2]=b*O+_*k,c[3]=S*O+w*k,c[4]=b*U+_*V+M,c[5]=S*U+w*V+T,c}function u(c,f,y){return c[0]=f[0]-y[0],c[1]=f[1]-y[1],c[2]=f[2]-y[2],c[3]=f[3]-y[3],c[4]=f[4]-y[4],c[5]=f[5]-y[5],c}return je.mul=a,je.sub=u,je}var Pt,ht={};function ft(){if(Pt)return ht;function o(c){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},o(c)}Pt=1,Object.defineProperty(ht,"__esModule",{value:!0}),ht.create=function(){var c=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c},ht.fromMat4=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[4],c[4]=f[5],c[5]=f[6],c[6]=f[8],c[7]=f[9],c[8]=f[10],c},ht.clone=function(c){var f=new e.ARRAY_TYPE(9);return f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f[4]=c[4],f[5]=c[5],f[6]=c[6],f[7]=c[7],f[8]=c[8],f},ht.copy=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c[6]=f[6],c[7]=f[7],c[8]=f[8],c},ht.fromValues=function(c,f,y,b,S,_,w,M,T){var E=new e.ARRAY_TYPE(9);return E[0]=c,E[1]=f,E[2]=y,E[3]=b,E[4]=S,E[5]=_,E[6]=w,E[7]=M,E[8]=T,E},ht.set=function(c,f,y,b,S,_,w,M,T,E){return c[0]=f,c[1]=y,c[2]=b,c[3]=S,c[4]=_,c[5]=w,c[6]=M,c[7]=T,c[8]=E,c},ht.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=1,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},ht.transpose=function(c,f){if(c===f){var y=f[1],b=f[2],S=f[5];c[1]=f[3],c[2]=f[6],c[3]=y,c[5]=f[7],c[6]=b,c[7]=S}else c[0]=f[0],c[1]=f[3],c[2]=f[6],c[3]=f[1],c[4]=f[4],c[5]=f[7],c[6]=f[2],c[7]=f[5],c[8]=f[8];return c},ht.invert=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],M=f[5],T=f[6],E=f[7],C=f[8],O=C*w-M*E,k=-C*_+M*T,U=E*_-w*T,V=y*O+b*k+S*U;return V?(c[0]=O*(V=1/V),c[1]=(-C*b+S*E)*V,c[2]=(M*b-S*w)*V,c[3]=k*V,c[4]=(C*y-S*T)*V,c[5]=(-M*y+S*_)*V,c[6]=U*V,c[7]=(-E*y+b*T)*V,c[8]=(w*y-b*_)*V,c):null},ht.adjoint=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],M=f[5],T=f[6],E=f[7],C=f[8];return c[0]=w*C-M*E,c[1]=S*E-b*C,c[2]=b*M-S*w,c[3]=M*T-_*C,c[4]=y*C-S*T,c[5]=S*_-y*M,c[6]=_*E-w*T,c[7]=b*T-y*E,c[8]=y*w-b*_,c},ht.determinant=function(c){var f=c[3],y=c[4],b=c[5],S=c[6],_=c[7],w=c[8];return c[0]*(w*y-b*_)+c[1]*(-w*f+b*S)+c[2]*(_*f-y*S)},ht.multiply=a,ht.translate=function(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=f[6],C=f[7],O=f[8],k=y[0],U=y[1];return c[0]=b,c[1]=S,c[2]=_,c[3]=w,c[4]=M,c[5]=T,c[6]=k*b+U*w+E,c[7]=k*S+U*M+C,c[8]=k*_+U*T+O,c},ht.rotate=function(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=f[6],C=f[7],O=f[8],k=Math.sin(y),U=Math.cos(y);return c[0]=U*b+k*w,c[1]=U*S+k*M,c[2]=U*_+k*T,c[3]=U*w-k*b,c[4]=U*M-k*S,c[5]=U*T-k*_,c[6]=E,c[7]=C,c[8]=O,c},ht.scale=function(c,f,y){var b=y[0],S=y[1];return c[0]=b*f[0],c[1]=b*f[1],c[2]=b*f[2],c[3]=S*f[3],c[4]=S*f[4],c[5]=S*f[5],c[6]=f[6],c[7]=f[7],c[8]=f[8],c},ht.fromTranslation=function(c,f){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=1,c[5]=0,c[6]=f[0],c[7]=f[1],c[8]=1,c},ht.fromRotation=function(c,f){var y=Math.sin(f),b=Math.cos(f);return c[0]=b,c[1]=y,c[2]=0,c[3]=-y,c[4]=b,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},ht.fromScaling=function(c,f){return c[0]=f[0],c[1]=0,c[2]=0,c[3]=0,c[4]=f[1],c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},ht.fromMat2d=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=0,c[3]=f[2],c[4]=f[3],c[5]=0,c[6]=f[4],c[7]=f[5],c[8]=1,c},ht.fromQuat=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=y+y,M=b+b,T=S+S,E=y*w,C=b*w,O=b*M,k=S*w,U=S*M,V=S*T,N=_*w,$=_*M,Z=_*T;return c[0]=1-O-V,c[3]=C-Z,c[6]=k+$,c[1]=C+Z,c[4]=1-E-V,c[7]=U-N,c[2]=k-$,c[5]=U+N,c[8]=1-E-O,c},ht.normalFromMat4=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],M=f[5],T=f[6],E=f[7],C=f[8],O=f[9],k=f[10],U=f[11],V=f[12],N=f[13],$=f[14],Z=f[15],K=y*M-b*w,ae=y*T-S*w,ie=y*E-_*w,se=b*T-S*M,ve=b*E-_*M,le=S*E-_*T,xe=C*N-O*V,Me=C*$-k*V,Se=C*Z-U*V,Pe=O*$-k*N,Ce=O*Z-U*N,Fe=k*Z-U*$,Le=K*Fe-ae*Ce+ie*Pe+se*Se-ve*Me+le*xe;return Le?(c[0]=(M*Fe-T*Ce+E*Pe)*(Le=1/Le),c[1]=(T*Se-w*Fe-E*Me)*Le,c[2]=(w*Ce-M*Se+E*xe)*Le,c[3]=(S*Ce-b*Fe-_*Pe)*Le,c[4]=(y*Fe-S*Se+_*Me)*Le,c[5]=(b*Se-y*Ce-_*xe)*Le,c[6]=(N*le-$*ve+Z*se)*Le,c[7]=($*ie-V*le-Z*ae)*Le,c[8]=(V*ve-N*ie+Z*K)*Le,c):null},ht.projection=function(c,f,y){return c[0]=2/f,c[1]=0,c[2]=0,c[3]=0,c[4]=-2/y,c[5]=0,c[6]=-1,c[7]=1,c[8]=1,c},ht.str=function(c){return"mat3("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+")"},ht.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8])},ht.add=function(c,f,y){return c[0]=f[0]+y[0],c[1]=f[1]+y[1],c[2]=f[2]+y[2],c[3]=f[3]+y[3],c[4]=f[4]+y[4],c[5]=f[5]+y[5],c[6]=f[6]+y[6],c[7]=f[7]+y[7],c[8]=f[8]+y[8],c},ht.subtract=u,ht.multiplyScalar=function(c,f,y){return c[0]=f[0]*y,c[1]=f[1]*y,c[2]=f[2]*y,c[3]=f[3]*y,c[4]=f[4]*y,c[5]=f[5]*y,c[6]=f[6]*y,c[7]=f[7]*y,c[8]=f[8]*y,c},ht.multiplyScalarAndAdd=function(c,f,y,b){return c[0]=f[0]+y[0]*b,c[1]=f[1]+y[1]*b,c[2]=f[2]+y[2]*b,c[3]=f[3]+y[3]*b,c[4]=f[4]+y[4]*b,c[5]=f[5]+y[5]*b,c[6]=f[6]+y[6]*b,c[7]=f[7]+y[7]*b,c[8]=f[8]+y[8]*b,c},ht.exactEquals=function(c,f){return c[0]===f[0]&&c[1]===f[1]&&c[2]===f[2]&&c[3]===f[3]&&c[4]===f[4]&&c[5]===f[5]&&c[6]===f[6]&&c[7]===f[7]&&c[8]===f[8]},ht.equals=function(c,f){var y=c[0],b=c[1],S=c[2],_=c[3],w=c[4],M=c[5],T=c[6],E=c[7],C=c[8],O=f[0],k=f[1],U=f[2],V=f[3],N=f[4],$=f[5],Z=f[6],K=f[7],ae=f[8];return Math.abs(y-O)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(O))&&Math.abs(b-k)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(k))&&Math.abs(S-U)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(_-V)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(w-N)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(N))&&Math.abs(M-$)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs($))&&Math.abs(T-Z)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(Z))&&Math.abs(E-K)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(K))&&Math.abs(C-ae)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(ae))},ht.sub=ht.mul=void 0;var e=function(c,f){if(c&&c.__esModule)return c;if(c===null||o(c)!=="object"&&typeof c!="function")return{default:c};var y=n(void 0);if(y&&y.has(c))return y.get(c);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var w=S?Object.getOwnPropertyDescriptor(c,_):null;w&&(w.get||w.set)?Object.defineProperty(b,_,w):b[_]=c[_]}return b.default=c,y&&y.set(c,b),b}(ne());function n(c){if(typeof WeakMap!="function")return null;var f=new WeakMap,y=new WeakMap;return(n=function(b){return b?y:f})(c)}function a(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=f[6],C=f[7],O=f[8],k=y[0],U=y[1],V=y[2],N=y[3],$=y[4],Z=y[5],K=y[6],ae=y[7],ie=y[8];return c[0]=k*b+U*w+V*E,c[1]=k*S+U*M+V*C,c[2]=k*_+U*T+V*O,c[3]=N*b+$*w+Z*E,c[4]=N*S+$*M+Z*C,c[5]=N*_+$*T+Z*O,c[6]=K*b+ae*w+ie*E,c[7]=K*S+ae*M+ie*C,c[8]=K*_+ae*T+ie*O,c}function u(c,f,y){return c[0]=f[0]-y[0],c[1]=f[1]-y[1],c[2]=f[2]-y[2],c[3]=f[3]-y[3],c[4]=f[4]-y[4],c[5]=f[5]-y[5],c[6]=f[6]-y[6],c[7]=f[7]-y[7],c[8]=f[8]-y[8],c}return ht.mul=a,ht.sub=u,ht}var bt,Je={};function Et(){if(bt)return Je;function o(_){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},o(_)}bt=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.create=function(){var _=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},Je.clone=function(_){var w=new e.ARRAY_TYPE(16);return w[0]=_[0],w[1]=_[1],w[2]=_[2],w[3]=_[3],w[4]=_[4],w[5]=_[5],w[6]=_[6],w[7]=_[7],w[8]=_[8],w[9]=_[9],w[10]=_[10],w[11]=_[11],w[12]=_[12],w[13]=_[13],w[14]=_[14],w[15]=_[15],w},Je.copy=function(_,w){return _[0]=w[0],_[1]=w[1],_[2]=w[2],_[3]=w[3],_[4]=w[4],_[5]=w[5],_[6]=w[6],_[7]=w[7],_[8]=w[8],_[9]=w[9],_[10]=w[10],_[11]=w[11],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15],_},Je.fromValues=function(_,w,M,T,E,C,O,k,U,V,N,$,Z,K,ae,ie){var se=new e.ARRAY_TYPE(16);return se[0]=_,se[1]=w,se[2]=M,se[3]=T,se[4]=E,se[5]=C,se[6]=O,se[7]=k,se[8]=U,se[9]=V,se[10]=N,se[11]=$,se[12]=Z,se[13]=K,se[14]=ae,se[15]=ie,se},Je.set=function(_,w,M,T,E,C,O,k,U,V,N,$,Z,K,ae,ie,se){return _[0]=w,_[1]=M,_[2]=T,_[3]=E,_[4]=C,_[5]=O,_[6]=k,_[7]=U,_[8]=V,_[9]=N,_[10]=$,_[11]=Z,_[12]=K,_[13]=ae,_[14]=ie,_[15]=se,_},Je.identity=a,Je.transpose=function(_,w){if(_===w){var M=w[1],T=w[2],E=w[3],C=w[6],O=w[7],k=w[11];_[1]=w[4],_[2]=w[8],_[3]=w[12],_[4]=M,_[6]=w[9],_[7]=w[13],_[8]=T,_[9]=C,_[11]=w[14],_[12]=E,_[13]=O,_[14]=k}else _[0]=w[0],_[1]=w[4],_[2]=w[8],_[3]=w[12],_[4]=w[1],_[5]=w[5],_[6]=w[9],_[7]=w[13],_[8]=w[2],_[9]=w[6],_[10]=w[10],_[11]=w[14],_[12]=w[3],_[13]=w[7],_[14]=w[11],_[15]=w[15];return _},Je.invert=function(_,w){var M=w[0],T=w[1],E=w[2],C=w[3],O=w[4],k=w[5],U=w[6],V=w[7],N=w[8],$=w[9],Z=w[10],K=w[11],ae=w[12],ie=w[13],se=w[14],ve=w[15],le=M*k-T*O,xe=M*U-E*O,Me=M*V-C*O,Se=T*U-E*k,Pe=T*V-C*k,Ce=E*V-C*U,Fe=N*ie-$*ae,Le=N*se-Z*ae,Ne=N*ve-K*ae,ot=$*se-Z*ie,it=$*ve-K*ie,Bt=Z*ve-K*se,_t=le*Bt-xe*it+Me*ot+Se*Ne-Pe*Le+Ce*Fe;return _t?(_[0]=(k*Bt-U*it+V*ot)*(_t=1/_t),_[1]=(E*it-T*Bt-C*ot)*_t,_[2]=(ie*Ce-se*Pe+ve*Se)*_t,_[3]=(Z*Pe-$*Ce-K*Se)*_t,_[4]=(U*Ne-O*Bt-V*Le)*_t,_[5]=(M*Bt-E*Ne+C*Le)*_t,_[6]=(se*Me-ae*Ce-ve*xe)*_t,_[7]=(N*Ce-Z*Me+K*xe)*_t,_[8]=(O*it-k*Ne+V*Fe)*_t,_[9]=(T*Ne-M*it-C*Fe)*_t,_[10]=(ae*Pe-ie*Me+ve*le)*_t,_[11]=($*Me-N*Pe-K*le)*_t,_[12]=(k*Le-O*ot-U*Fe)*_t,_[13]=(M*ot-T*Le+E*Fe)*_t,_[14]=(ie*xe-ae*Se-se*le)*_t,_[15]=(N*Se-$*xe+Z*le)*_t,_):null},Je.adjoint=function(_,w){var M=w[0],T=w[1],E=w[2],C=w[3],O=w[4],k=w[5],U=w[6],V=w[7],N=w[8],$=w[9],Z=w[10],K=w[11],ae=w[12],ie=w[13],se=w[14],ve=w[15];return _[0]=k*(Z*ve-K*se)-$*(U*ve-V*se)+ie*(U*K-V*Z),_[1]=-(T*(Z*ve-K*se)-$*(E*ve-C*se)+ie*(E*K-C*Z)),_[2]=T*(U*ve-V*se)-k*(E*ve-C*se)+ie*(E*V-C*U),_[3]=-(T*(U*K-V*Z)-k*(E*K-C*Z)+$*(E*V-C*U)),_[4]=-(O*(Z*ve-K*se)-N*(U*ve-V*se)+ae*(U*K-V*Z)),_[5]=M*(Z*ve-K*se)-N*(E*ve-C*se)+ae*(E*K-C*Z),_[6]=-(M*(U*ve-V*se)-O*(E*ve-C*se)+ae*(E*V-C*U)),_[7]=M*(U*K-V*Z)-O*(E*K-C*Z)+N*(E*V-C*U),_[8]=O*($*ve-K*ie)-N*(k*ve-V*ie)+ae*(k*K-V*$),_[9]=-(M*($*ve-K*ie)-N*(T*ve-C*ie)+ae*(T*K-C*$)),_[10]=M*(k*ve-V*ie)-O*(T*ve-C*ie)+ae*(T*V-C*k),_[11]=-(M*(k*K-V*$)-O*(T*K-C*$)+N*(T*V-C*k)),_[12]=-(O*($*se-Z*ie)-N*(k*se-U*ie)+ae*(k*Z-U*$)),_[13]=M*($*se-Z*ie)-N*(T*se-E*ie)+ae*(T*Z-E*$),_[14]=-(M*(k*se-U*ie)-O*(T*se-E*ie)+ae*(T*U-E*k)),_[15]=M*(k*Z-U*$)-O*(T*Z-E*$)+N*(T*U-E*k),_},Je.determinant=function(_){var w=_[0],M=_[1],T=_[2],E=_[3],C=_[4],O=_[5],k=_[6],U=_[7],V=_[8],N=_[9],$=_[10],Z=_[11],K=_[12],ae=_[13],ie=_[14],se=_[15];return(w*O-M*C)*($*se-Z*ie)-(w*k-T*C)*(N*se-Z*ae)+(w*U-E*C)*(N*ie-$*ae)+(M*k-T*O)*(V*se-Z*K)-(M*U-E*O)*(V*ie-$*K)+(T*U-E*k)*(V*ae-N*K)},Je.multiply=u,Je.translate=function(_,w,M){var T,E,C,O,k,U,V,N,$,Z,K,ae,ie=M[0],se=M[1],ve=M[2];return w===_?(_[12]=w[0]*ie+w[4]*se+w[8]*ve+w[12],_[13]=w[1]*ie+w[5]*se+w[9]*ve+w[13],_[14]=w[2]*ie+w[6]*se+w[10]*ve+w[14],_[15]=w[3]*ie+w[7]*se+w[11]*ve+w[15]):(E=w[1],C=w[2],O=w[3],k=w[4],U=w[5],V=w[6],N=w[7],$=w[8],Z=w[9],K=w[10],ae=w[11],_[0]=T=w[0],_[1]=E,_[2]=C,_[3]=O,_[4]=k,_[5]=U,_[6]=V,_[7]=N,_[8]=$,_[9]=Z,_[10]=K,_[11]=ae,_[12]=T*ie+k*se+$*ve+w[12],_[13]=E*ie+U*se+Z*ve+w[13],_[14]=C*ie+V*se+K*ve+w[14],_[15]=O*ie+N*se+ae*ve+w[15]),_},Je.scale=function(_,w,M){var T=M[0],E=M[1],C=M[2];return _[0]=w[0]*T,_[1]=w[1]*T,_[2]=w[2]*T,_[3]=w[3]*T,_[4]=w[4]*E,_[5]=w[5]*E,_[6]=w[6]*E,_[7]=w[7]*E,_[8]=w[8]*C,_[9]=w[9]*C,_[10]=w[10]*C,_[11]=w[11]*C,_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15],_},Je.rotate=function(_,w,M,T){var E,C,O,k,U,V,N,$,Z,K,ae,ie,se,ve,le,xe,Me,Se,Pe,Ce,Fe,Le,Ne,ot,it=T[0],Bt=T[1],_t=T[2],At=Math.hypot(it,Bt,_t);return At<e.EPSILON?null:(it*=At=1/At,Bt*=At,_t*=At,E=Math.sin(M),C=Math.cos(M),U=w[1],V=w[2],N=w[3],Z=w[5],K=w[6],ae=w[7],se=w[9],ve=w[10],le=w[11],xe=it*it*(O=1-C)+C,Pe=it*Bt*O-_t*E,Ce=Bt*Bt*O+C,Fe=_t*Bt*O+it*E,Le=it*_t*O+Bt*E,Ne=Bt*_t*O-it*E,ot=_t*_t*O+C,_[0]=(k=w[0])*xe+($=w[4])*(Me=Bt*it*O+_t*E)+(ie=w[8])*(Se=_t*it*O-Bt*E),_[1]=U*xe+Z*Me+se*Se,_[2]=V*xe+K*Me+ve*Se,_[3]=N*xe+ae*Me+le*Se,_[4]=k*Pe+$*Ce+ie*Fe,_[5]=U*Pe+Z*Ce+se*Fe,_[6]=V*Pe+K*Ce+ve*Fe,_[7]=N*Pe+ae*Ce+le*Fe,_[8]=k*Le+$*Ne+ie*ot,_[9]=U*Le+Z*Ne+se*ot,_[10]=V*Le+K*Ne+ve*ot,_[11]=N*Le+ae*Ne+le*ot,w!==_&&(_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_)},Je.rotateX=function(_,w,M){var T=Math.sin(M),E=Math.cos(M),C=w[4],O=w[5],k=w[6],U=w[7],V=w[8],N=w[9],$=w[10],Z=w[11];return w!==_&&(_[0]=w[0],_[1]=w[1],_[2]=w[2],_[3]=w[3],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_[4]=C*E+V*T,_[5]=O*E+N*T,_[6]=k*E+$*T,_[7]=U*E+Z*T,_[8]=V*E-C*T,_[9]=N*E-O*T,_[10]=$*E-k*T,_[11]=Z*E-U*T,_},Je.rotateY=function(_,w,M){var T=Math.sin(M),E=Math.cos(M),C=w[0],O=w[1],k=w[2],U=w[3],V=w[8],N=w[9],$=w[10],Z=w[11];return w!==_&&(_[4]=w[4],_[5]=w[5],_[6]=w[6],_[7]=w[7],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_[0]=C*E-V*T,_[1]=O*E-N*T,_[2]=k*E-$*T,_[3]=U*E-Z*T,_[8]=C*T+V*E,_[9]=O*T+N*E,_[10]=k*T+$*E,_[11]=U*T+Z*E,_},Je.rotateZ=function(_,w,M){var T=Math.sin(M),E=Math.cos(M),C=w[0],O=w[1],k=w[2],U=w[3],V=w[4],N=w[5],$=w[6],Z=w[7];return w!==_&&(_[8]=w[8],_[9]=w[9],_[10]=w[10],_[11]=w[11],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_[0]=C*E+V*T,_[1]=O*E+N*T,_[2]=k*E+$*T,_[3]=U*E+Z*T,_[4]=V*E-C*T,_[5]=N*E-O*T,_[6]=$*E-k*T,_[7]=Z*E-U*T,_},Je.fromTranslation=function(_,w){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=w[0],_[13]=w[1],_[14]=w[2],_[15]=1,_},Je.fromScaling=function(_,w){return _[0]=w[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=w[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=w[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Je.fromRotation=function(_,w,M){var T,E,C,O=M[0],k=M[1],U=M[2],V=Math.hypot(O,k,U);return V<e.EPSILON?null:(O*=V=1/V,k*=V,U*=V,T=Math.sin(w),E=Math.cos(w),_[0]=O*O*(C=1-E)+E,_[1]=k*O*C+U*T,_[2]=U*O*C-k*T,_[3]=0,_[4]=O*k*C-U*T,_[5]=k*k*C+E,_[6]=U*k*C+O*T,_[7]=0,_[8]=O*U*C+k*T,_[9]=k*U*C-O*T,_[10]=U*U*C+E,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)},Je.fromXRotation=function(_,w){var M=Math.sin(w),T=Math.cos(w);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=T,_[6]=M,_[7]=0,_[8]=0,_[9]=-M,_[10]=T,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Je.fromYRotation=function(_,w){var M=Math.sin(w),T=Math.cos(w);return _[0]=T,_[1]=0,_[2]=-M,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=M,_[9]=0,_[10]=T,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Je.fromZRotation=function(_,w){var M=Math.sin(w),T=Math.cos(w);return _[0]=T,_[1]=M,_[2]=0,_[3]=0,_[4]=-M,_[5]=T,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Je.fromRotationTranslation=c,Je.fromQuat2=function(_,w){var M=new e.ARRAY_TYPE(3),T=-w[0],E=-w[1],C=-w[2],O=w[3],k=w[4],U=w[5],V=w[6],N=w[7],$=T*T+E*E+C*C+O*O;return $>0?(M[0]=2*(k*O+N*T+U*C-V*E)/$,M[1]=2*(U*O+N*E+V*T-k*C)/$,M[2]=2*(V*O+N*C+k*E-U*T)/$):(M[0]=2*(k*O+N*T+U*C-V*E),M[1]=2*(U*O+N*E+V*T-k*C),M[2]=2*(V*O+N*C+k*E-U*T)),c(_,w,M),_},Je.getTranslation=function(_,w){return _[0]=w[12],_[1]=w[13],_[2]=w[14],_},Je.getScaling=f,Je.getRotation=function(_,w){var M=new e.ARRAY_TYPE(3);f(M,w);var T=1/M[0],E=1/M[1],C=1/M[2],O=w[0]*T,k=w[1]*E,U=w[2]*C,V=w[4]*T,N=w[5]*E,$=w[6]*C,Z=w[8]*T,K=w[9]*E,ae=w[10]*C,ie=O+N+ae,se=0;return ie>0?(se=2*Math.sqrt(ie+1),_[3]=.25*se,_[0]=($-K)/se,_[1]=(Z-U)/se,_[2]=(k-V)/se):O>N&&O>ae?(se=2*Math.sqrt(1+O-N-ae),_[3]=($-K)/se,_[0]=.25*se,_[1]=(k+V)/se,_[2]=(Z+U)/se):N>ae?(se=2*Math.sqrt(1+N-O-ae),_[3]=(Z-U)/se,_[0]=(k+V)/se,_[1]=.25*se,_[2]=($+K)/se):(se=2*Math.sqrt(1+ae-O-N),_[3]=(k-V)/se,_[0]=(Z+U)/se,_[1]=($+K)/se,_[2]=.25*se),_},Je.fromRotationTranslationScale=function(_,w,M,T){var E=w[0],C=w[1],O=w[2],k=w[3],U=E+E,V=C+C,N=O+O,$=E*U,Z=E*V,K=E*N,ae=C*V,ie=C*N,se=O*N,ve=k*U,le=k*V,xe=k*N,Me=T[0],Se=T[1],Pe=T[2];return _[0]=(1-(ae+se))*Me,_[1]=(Z+xe)*Me,_[2]=(K-le)*Me,_[3]=0,_[4]=(Z-xe)*Se,_[5]=(1-($+se))*Se,_[6]=(ie+ve)*Se,_[7]=0,_[8]=(K+le)*Pe,_[9]=(ie-ve)*Pe,_[10]=(1-($+ae))*Pe,_[11]=0,_[12]=M[0],_[13]=M[1],_[14]=M[2],_[15]=1,_},Je.fromRotationTranslationScaleOrigin=function(_,w,M,T,E){var C=w[0],O=w[1],k=w[2],U=w[3],V=C+C,N=O+O,$=k+k,Z=C*V,K=C*N,ae=C*$,ie=O*N,se=O*$,ve=k*$,le=U*V,xe=U*N,Me=U*$,Se=T[0],Pe=T[1],Ce=T[2],Fe=E[0],Le=E[1],Ne=E[2],ot=(1-(ie+ve))*Se,it=(K+Me)*Se,Bt=(ae-xe)*Se,_t=(K-Me)*Pe,At=(1-(Z+ve))*Pe,ct=(se+le)*Pe,rr=(ae+xe)*Ce,Ot=(se-le)*Ce,qt=(1-(Z+ie))*Ce;return _[0]=ot,_[1]=it,_[2]=Bt,_[3]=0,_[4]=_t,_[5]=At,_[6]=ct,_[7]=0,_[8]=rr,_[9]=Ot,_[10]=qt,_[11]=0,_[12]=M[0]+Fe-(ot*Fe+_t*Le+rr*Ne),_[13]=M[1]+Le-(it*Fe+At*Le+Ot*Ne),_[14]=M[2]+Ne-(Bt*Fe+ct*Le+qt*Ne),_[15]=1,_},Je.fromQuat=function(_,w){var M=w[0],T=w[1],E=w[2],C=w[3],O=M+M,k=T+T,U=E+E,V=M*O,N=T*O,$=T*k,Z=E*O,K=E*k,ae=E*U,ie=C*O,se=C*k,ve=C*U;return _[0]=1-$-ae,_[1]=N+ve,_[2]=Z-se,_[3]=0,_[4]=N-ve,_[5]=1-V-ae,_[6]=K+ie,_[7]=0,_[8]=Z+se,_[9]=K-ie,_[10]=1-V-$,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},Je.frustum=function(_,w,M,T,E,C,O){var k=1/(M-w),U=1/(E-T),V=1/(C-O);return _[0]=2*C*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*C*U,_[6]=0,_[7]=0,_[8]=(M+w)*k,_[9]=(E+T)*U,_[10]=(O+C)*V,_[11]=-1,_[12]=0,_[13]=0,_[14]=O*C*2*V,_[15]=0,_},Je.perspectiveNO=y,Je.perspectiveZO=function(_,w,M,T,E){var C,O=1/Math.tan(w/2);return _[0]=O/M,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=O,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,E!=null&&E!==1/0?(_[10]=E*(C=1/(T-E)),_[14]=E*T*C):(_[10]=-1,_[14]=-T),_},Je.perspectiveFromFieldOfView=function(_,w,M,T){var E=Math.tan(w.upDegrees*Math.PI/180),C=Math.tan(w.downDegrees*Math.PI/180),O=Math.tan(w.leftDegrees*Math.PI/180),k=Math.tan(w.rightDegrees*Math.PI/180),U=2/(O+k),V=2/(E+C);return _[0]=U,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=V,_[6]=0,_[7]=0,_[8]=-(O-k)*U*.5,_[9]=(E-C)*V*.5,_[10]=T/(M-T),_[11]=-1,_[12]=0,_[13]=0,_[14]=T*M/(M-T),_[15]=0,_},Je.orthoNO=b,Je.orthoZO=function(_,w,M,T,E,C,O){var k=1/(w-M),U=1/(T-E),V=1/(C-O);return _[0]=-2*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*U,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=V,_[11]=0,_[12]=(w+M)*k,_[13]=(E+T)*U,_[14]=C*V,_[15]=1,_},Je.lookAt=function(_,w,M,T){var E,C,O,k,U,V,N,$,Z,K,ae=w[0],ie=w[1],se=w[2],ve=T[0],le=T[1],xe=T[2],Me=M[0],Se=M[1],Pe=M[2];return Math.abs(ae-Me)<e.EPSILON&&Math.abs(ie-Se)<e.EPSILON&&Math.abs(se-Pe)<e.EPSILON?a(_):(N=ae-Me,$=ie-Se,Z=se-Pe,E=le*(Z*=K=1/Math.hypot(N,$,Z))-xe*($*=K),C=xe*(N*=K)-ve*Z,O=ve*$-le*N,(K=Math.hypot(E,C,O))?(E*=K=1/K,C*=K,O*=K):(E=0,C=0,O=0),k=$*O-Z*C,U=Z*E-N*O,V=N*C-$*E,(K=Math.hypot(k,U,V))?(k*=K=1/K,U*=K,V*=K):(k=0,U=0,V=0),_[0]=E,_[1]=k,_[2]=N,_[3]=0,_[4]=C,_[5]=U,_[6]=$,_[7]=0,_[8]=O,_[9]=V,_[10]=Z,_[11]=0,_[12]=-(E*ae+C*ie+O*se),_[13]=-(k*ae+U*ie+V*se),_[14]=-(N*ae+$*ie+Z*se),_[15]=1,_)},Je.targetTo=function(_,w,M,T){var E=w[0],C=w[1],O=w[2],k=T[0],U=T[1],V=T[2],N=E-M[0],$=C-M[1],Z=O-M[2],K=N*N+$*$+Z*Z;K>0&&(N*=K=1/Math.sqrt(K),$*=K,Z*=K);var ae=U*Z-V*$,ie=V*N-k*Z,se=k*$-U*N;return(K=ae*ae+ie*ie+se*se)>0&&(ae*=K=1/Math.sqrt(K),ie*=K,se*=K),_[0]=ae,_[1]=ie,_[2]=se,_[3]=0,_[4]=$*se-Z*ie,_[5]=Z*ae-N*se,_[6]=N*ie-$*ae,_[7]=0,_[8]=N,_[9]=$,_[10]=Z,_[11]=0,_[12]=E,_[13]=C,_[14]=O,_[15]=1,_},Je.str=function(_){return"mat4("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+", "+_[4]+", "+_[5]+", "+_[6]+", "+_[7]+", "+_[8]+", "+_[9]+", "+_[10]+", "+_[11]+", "+_[12]+", "+_[13]+", "+_[14]+", "+_[15]+")"},Je.frob=function(_){return Math.hypot(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])},Je.add=function(_,w,M){return _[0]=w[0]+M[0],_[1]=w[1]+M[1],_[2]=w[2]+M[2],_[3]=w[3]+M[3],_[4]=w[4]+M[4],_[5]=w[5]+M[5],_[6]=w[6]+M[6],_[7]=w[7]+M[7],_[8]=w[8]+M[8],_[9]=w[9]+M[9],_[10]=w[10]+M[10],_[11]=w[11]+M[11],_[12]=w[12]+M[12],_[13]=w[13]+M[13],_[14]=w[14]+M[14],_[15]=w[15]+M[15],_},Je.subtract=S,Je.multiplyScalar=function(_,w,M){return _[0]=w[0]*M,_[1]=w[1]*M,_[2]=w[2]*M,_[3]=w[3]*M,_[4]=w[4]*M,_[5]=w[5]*M,_[6]=w[6]*M,_[7]=w[7]*M,_[8]=w[8]*M,_[9]=w[9]*M,_[10]=w[10]*M,_[11]=w[11]*M,_[12]=w[12]*M,_[13]=w[13]*M,_[14]=w[14]*M,_[15]=w[15]*M,_},Je.multiplyScalarAndAdd=function(_,w,M,T){return _[0]=w[0]+M[0]*T,_[1]=w[1]+M[1]*T,_[2]=w[2]+M[2]*T,_[3]=w[3]+M[3]*T,_[4]=w[4]+M[4]*T,_[5]=w[5]+M[5]*T,_[6]=w[6]+M[6]*T,_[7]=w[7]+M[7]*T,_[8]=w[8]+M[8]*T,_[9]=w[9]+M[9]*T,_[10]=w[10]+M[10]*T,_[11]=w[11]+M[11]*T,_[12]=w[12]+M[12]*T,_[13]=w[13]+M[13]*T,_[14]=w[14]+M[14]*T,_[15]=w[15]+M[15]*T,_},Je.exactEquals=function(_,w){return _[0]===w[0]&&_[1]===w[1]&&_[2]===w[2]&&_[3]===w[3]&&_[4]===w[4]&&_[5]===w[5]&&_[6]===w[6]&&_[7]===w[7]&&_[8]===w[8]&&_[9]===w[9]&&_[10]===w[10]&&_[11]===w[11]&&_[12]===w[12]&&_[13]===w[13]&&_[14]===w[14]&&_[15]===w[15]},Je.equals=function(_,w){var M=_[0],T=_[1],E=_[2],C=_[3],O=_[4],k=_[5],U=_[6],V=_[7],N=_[8],$=_[9],Z=_[10],K=_[11],ae=_[12],ie=_[13],se=_[14],ve=_[15],le=w[0],xe=w[1],Me=w[2],Se=w[3],Pe=w[4],Ce=w[5],Fe=w[6],Le=w[7],Ne=w[8],ot=w[9],it=w[10],Bt=w[11],_t=w[12],At=w[13],ct=w[14],rr=w[15];return Math.abs(M-le)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(le))&&Math.abs(T-xe)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(xe))&&Math.abs(E-Me)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Me))&&Math.abs(C-Se)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(Se))&&Math.abs(O-Pe)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(Pe))&&Math.abs(k-Ce)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ce))&&Math.abs(U-Fe)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(Fe))&&Math.abs(V-Le)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(Le))&&Math.abs(N-Ne)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(Ne))&&Math.abs($-ot)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(ot))&&Math.abs(Z-it)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(it))&&Math.abs(K-Bt)<=e.EPSILON*Math.max(1,Math.abs(K),Math.abs(Bt))&&Math.abs(ae-_t)<=e.EPSILON*Math.max(1,Math.abs(ae),Math.abs(_t))&&Math.abs(ie-At)<=e.EPSILON*Math.max(1,Math.abs(ie),Math.abs(At))&&Math.abs(se-ct)<=e.EPSILON*Math.max(1,Math.abs(se),Math.abs(ct))&&Math.abs(ve-rr)<=e.EPSILON*Math.max(1,Math.abs(ve),Math.abs(rr))},Je.sub=Je.mul=Je.ortho=Je.perspective=void 0;var e=function(_,w){if(_&&_.__esModule)return _;if(_===null||o(_)!=="object"&&typeof _!="function")return{default:_};var M=n(void 0);if(M&&M.has(_))return M.get(_);var T={},E=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var C in _)if(C!=="default"&&Object.prototype.hasOwnProperty.call(_,C)){var O=E?Object.getOwnPropertyDescriptor(_,C):null;O&&(O.get||O.set)?Object.defineProperty(T,C,O):T[C]=_[C]}return T.default=_,M&&M.set(_,T),T}(ne());function n(_){if(typeof WeakMap!="function")return null;var w=new WeakMap,M=new WeakMap;return(n=function(T){return T?M:w})(_)}function a(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function u(_,w,M){var T=w[0],E=w[1],C=w[2],O=w[3],k=w[4],U=w[5],V=w[6],N=w[7],$=w[8],Z=w[9],K=w[10],ae=w[11],ie=w[12],se=w[13],ve=w[14],le=w[15],xe=M[0],Me=M[1],Se=M[2],Pe=M[3];return _[0]=xe*T+Me*k+Se*$+Pe*ie,_[1]=xe*E+Me*U+Se*Z+Pe*se,_[2]=xe*C+Me*V+Se*K+Pe*ve,_[3]=xe*O+Me*N+Se*ae+Pe*le,_[4]=(xe=M[4])*T+(Me=M[5])*k+(Se=M[6])*$+(Pe=M[7])*ie,_[5]=xe*E+Me*U+Se*Z+Pe*se,_[6]=xe*C+Me*V+Se*K+Pe*ve,_[7]=xe*O+Me*N+Se*ae+Pe*le,_[8]=(xe=M[8])*T+(Me=M[9])*k+(Se=M[10])*$+(Pe=M[11])*ie,_[9]=xe*E+Me*U+Se*Z+Pe*se,_[10]=xe*C+Me*V+Se*K+Pe*ve,_[11]=xe*O+Me*N+Se*ae+Pe*le,_[12]=(xe=M[12])*T+(Me=M[13])*k+(Se=M[14])*$+(Pe=M[15])*ie,_[13]=xe*E+Me*U+Se*Z+Pe*se,_[14]=xe*C+Me*V+Se*K+Pe*ve,_[15]=xe*O+Me*N+Se*ae+Pe*le,_}function c(_,w,M){var T=w[0],E=w[1],C=w[2],O=w[3],k=T+T,U=E+E,V=C+C,N=T*k,$=T*U,Z=T*V,K=E*U,ae=E*V,ie=C*V,se=O*k,ve=O*U,le=O*V;return _[0]=1-(K+ie),_[1]=$+le,_[2]=Z-ve,_[3]=0,_[4]=$-le,_[5]=1-(N+ie),_[6]=ae+se,_[7]=0,_[8]=Z+ve,_[9]=ae-se,_[10]=1-(N+K),_[11]=0,_[12]=M[0],_[13]=M[1],_[14]=M[2],_[15]=1,_}function f(_,w){var M=w[4],T=w[5],E=w[6],C=w[8],O=w[9],k=w[10];return _[0]=Math.hypot(w[0],w[1],w[2]),_[1]=Math.hypot(M,T,E),_[2]=Math.hypot(C,O,k),_}function y(_,w,M,T,E){var C,O=1/Math.tan(w/2);return _[0]=O/M,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=O,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,E!=null&&E!==1/0?(_[10]=(E+T)*(C=1/(T-E)),_[14]=2*E*T*C):(_[10]=-1,_[14]=-2*T),_}function b(_,w,M,T,E,C,O){var k=1/(w-M),U=1/(T-E),V=1/(C-O);return _[0]=-2*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*U,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*V,_[11]=0,_[12]=(w+M)*k,_[13]=(E+T)*U,_[14]=(O+C)*V,_[15]=1,_}function S(_,w,M){return _[0]=w[0]-M[0],_[1]=w[1]-M[1],_[2]=w[2]-M[2],_[3]=w[3]-M[3],_[4]=w[4]-M[4],_[5]=w[5]-M[5],_[6]=w[6]-M[6],_[7]=w[7]-M[7],_[8]=w[8]-M[8],_[9]=w[9]-M[9],_[10]=w[10]-M[10],_[11]=w[11]-M[11],_[12]=w[12]-M[12],_[13]=w[13]-M[13],_[14]=w[14]-M[14],_[15]=w[15]-M[15],_}return Je.perspective=y,Je.ortho=b,Je.mul=u,Je.sub=S,Je}var pt,lt={},dt={};function mt(){if(pt)return dt;function o(E){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(E)}pt=1,Object.defineProperty(dt,"__esModule",{value:!0}),dt.create=a,dt.clone=function(E){var C=new e.ARRAY_TYPE(3);return C[0]=E[0],C[1]=E[1],C[2]=E[2],C},dt.length=u,dt.fromValues=function(E,C,O){var k=new e.ARRAY_TYPE(3);return k[0]=E,k[1]=C,k[2]=O,k},dt.copy=function(E,C){return E[0]=C[0],E[1]=C[1],E[2]=C[2],E},dt.set=function(E,C,O,k){return E[0]=C,E[1]=O,E[2]=k,E},dt.add=function(E,C,O){return E[0]=C[0]+O[0],E[1]=C[1]+O[1],E[2]=C[2]+O[2],E},dt.subtract=c,dt.multiply=f,dt.divide=y,dt.ceil=function(E,C){return E[0]=Math.ceil(C[0]),E[1]=Math.ceil(C[1]),E[2]=Math.ceil(C[2]),E},dt.floor=function(E,C){return E[0]=Math.floor(C[0]),E[1]=Math.floor(C[1]),E[2]=Math.floor(C[2]),E},dt.min=function(E,C,O){return E[0]=Math.min(C[0],O[0]),E[1]=Math.min(C[1],O[1]),E[2]=Math.min(C[2],O[2]),E},dt.max=function(E,C,O){return E[0]=Math.max(C[0],O[0]),E[1]=Math.max(C[1],O[1]),E[2]=Math.max(C[2],O[2]),E},dt.round=function(E,C){return E[0]=Math.round(C[0]),E[1]=Math.round(C[1]),E[2]=Math.round(C[2]),E},dt.scale=function(E,C,O){return E[0]=C[0]*O,E[1]=C[1]*O,E[2]=C[2]*O,E},dt.scaleAndAdd=function(E,C,O,k){return E[0]=C[0]+O[0]*k,E[1]=C[1]+O[1]*k,E[2]=C[2]+O[2]*k,E},dt.distance=b,dt.squaredDistance=S,dt.squaredLength=_,dt.negate=function(E,C){return E[0]=-C[0],E[1]=-C[1],E[2]=-C[2],E},dt.inverse=function(E,C){return E[0]=1/C[0],E[1]=1/C[1],E[2]=1/C[2],E},dt.normalize=function(E,C){var O=C[0],k=C[1],U=C[2],V=O*O+k*k+U*U;return V>0&&(V=1/Math.sqrt(V)),E[0]=C[0]*V,E[1]=C[1]*V,E[2]=C[2]*V,E},dt.dot=w,dt.cross=function(E,C,O){var k=C[0],U=C[1],V=C[2],N=O[0],$=O[1],Z=O[2];return E[0]=U*Z-V*$,E[1]=V*N-k*Z,E[2]=k*$-U*N,E},dt.lerp=function(E,C,O,k){var U=C[0],V=C[1],N=C[2];return E[0]=U+k*(O[0]-U),E[1]=V+k*(O[1]-V),E[2]=N+k*(O[2]-N),E},dt.hermite=function(E,C,O,k,U,V){var N=V*V,$=N*(2*V-3)+1,Z=N*(V-2)+V,K=N*(V-1),ae=N*(3-2*V);return E[0]=C[0]*$+O[0]*Z+k[0]*K+U[0]*ae,E[1]=C[1]*$+O[1]*Z+k[1]*K+U[1]*ae,E[2]=C[2]*$+O[2]*Z+k[2]*K+U[2]*ae,E},dt.bezier=function(E,C,O,k,U,V){var N=1-V,$=N*N,Z=V*V,K=$*N,ae=3*V*$,ie=3*Z*N,se=Z*V;return E[0]=C[0]*K+O[0]*ae+k[0]*ie+U[0]*se,E[1]=C[1]*K+O[1]*ae+k[1]*ie+U[1]*se,E[2]=C[2]*K+O[2]*ae+k[2]*ie+U[2]*se,E},dt.random=function(E,C){C=C||1;var O=2*e.RANDOM()*Math.PI,k=2*e.RANDOM()-1,U=Math.sqrt(1-k*k)*C;return E[0]=Math.cos(O)*U,E[1]=Math.sin(O)*U,E[2]=k*C,E},dt.transformMat4=function(E,C,O){var k=C[0],U=C[1],V=C[2],N=O[3]*k+O[7]*U+O[11]*V+O[15];return E[0]=(O[0]*k+O[4]*U+O[8]*V+O[12])/(N=N||1),E[1]=(O[1]*k+O[5]*U+O[9]*V+O[13])/N,E[2]=(O[2]*k+O[6]*U+O[10]*V+O[14])/N,E},dt.transformMat3=function(E,C,O){var k=C[0],U=C[1],V=C[2];return E[0]=k*O[0]+U*O[3]+V*O[6],E[1]=k*O[1]+U*O[4]+V*O[7],E[2]=k*O[2]+U*O[5]+V*O[8],E},dt.transformQuat=function(E,C,O){var k=O[0],U=O[1],V=O[2],N=C[0],$=C[1],Z=C[2],K=U*Z-V*$,ae=V*N-k*Z,ie=k*$-U*N,se=U*ie-V*ae,ve=V*K-k*ie,le=k*ae-U*K,xe=2*O[3];return ae*=xe,ie*=xe,ve*=2,le*=2,E[0]=N+(K*=xe)+(se*=2),E[1]=$+ae+ve,E[2]=Z+ie+le,E},dt.rotateX=function(E,C,O,k){var U=[],V=[];return U[0]=C[0]-O[0],U[1]=C[1]-O[1],U[2]=C[2]-O[2],V[0]=U[0],V[1]=U[1]*Math.cos(k)-U[2]*Math.sin(k),V[2]=U[1]*Math.sin(k)+U[2]*Math.cos(k),E[0]=V[0]+O[0],E[1]=V[1]+O[1],E[2]=V[2]+O[2],E},dt.rotateY=function(E,C,O,k){var U=[],V=[];return U[0]=C[0]-O[0],U[1]=C[1]-O[1],U[2]=C[2]-O[2],V[0]=U[2]*Math.sin(k)+U[0]*Math.cos(k),V[1]=U[1],V[2]=U[2]*Math.cos(k)-U[0]*Math.sin(k),E[0]=V[0]+O[0],E[1]=V[1]+O[1],E[2]=V[2]+O[2],E},dt.rotateZ=function(E,C,O,k){var U=[],V=[];return U[0]=C[0]-O[0],U[1]=C[1]-O[1],U[2]=C[2]-O[2],V[0]=U[0]*Math.cos(k)-U[1]*Math.sin(k),V[1]=U[0]*Math.sin(k)+U[1]*Math.cos(k),V[2]=U[2],E[0]=V[0]+O[0],E[1]=V[1]+O[1],E[2]=V[2]+O[2],E},dt.angle=function(E,C){var O=E[0],k=E[1],U=E[2],V=C[0],N=C[1],$=C[2],Z=Math.sqrt(O*O+k*k+U*U)*Math.sqrt(V*V+N*N+$*$),K=Z&&w(E,C)/Z;return Math.acos(Math.min(Math.max(K,-1),1))},dt.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E},dt.str=function(E){return"vec3("+E[0]+", "+E[1]+", "+E[2]+")"},dt.exactEquals=function(E,C){return E[0]===C[0]&&E[1]===C[1]&&E[2]===C[2]},dt.equals=function(E,C){var O=E[0],k=E[1],U=E[2],V=C[0],N=C[1],$=C[2];return Math.abs(O-V)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(V))&&Math.abs(k-N)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(N))&&Math.abs(U-$)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs($))},dt.forEach=dt.sqrLen=dt.len=dt.sqrDist=dt.dist=dt.div=dt.mul=dt.sub=void 0;var e=function(E,C){if(E&&E.__esModule)return E;if(E===null||o(E)!=="object"&&typeof E!="function")return{default:E};var O=n(void 0);if(O&&O.has(E))return O.get(E);var k={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in E)if(V!=="default"&&Object.prototype.hasOwnProperty.call(E,V)){var N=U?Object.getOwnPropertyDescriptor(E,V):null;N&&(N.get||N.set)?Object.defineProperty(k,V,N):k[V]=E[V]}return k.default=E,O&&O.set(E,k),k}(ne());function n(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,O=new WeakMap;return(n=function(k){return k?O:C})(E)}function a(){var E=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0),E}function u(E){return Math.hypot(E[0],E[1],E[2])}function c(E,C,O){return E[0]=C[0]-O[0],E[1]=C[1]-O[1],E[2]=C[2]-O[2],E}function f(E,C,O){return E[0]=C[0]*O[0],E[1]=C[1]*O[1],E[2]=C[2]*O[2],E}function y(E,C,O){return E[0]=C[0]/O[0],E[1]=C[1]/O[1],E[2]=C[2]/O[2],E}function b(E,C){return Math.hypot(C[0]-E[0],C[1]-E[1],C[2]-E[2])}function S(E,C){var O=C[0]-E[0],k=C[1]-E[1],U=C[2]-E[2];return O*O+k*k+U*U}function _(E){var C=E[0],O=E[1],k=E[2];return C*C+O*O+k*k}function w(E,C){return E[0]*C[0]+E[1]*C[1]+E[2]*C[2]}dt.sub=c,dt.mul=f,dt.div=y,dt.dist=b,dt.sqrDist=S,dt.len=u,dt.sqrLen=_;var M,T=(M=a(),function(E,C,O,k,U,V){var N,$;for(C||(C=3),O||(O=0),$=k?Math.min(k*C+O,E.length):E.length,N=O;N<$;N+=C)M[0]=E[N],M[1]=E[N+1],M[2]=E[N+2],U(M,M,V),E[N]=M[0],E[N+1]=M[1],E[N+2]=M[2];return E});return dt.forEach=T,dt}var nr,Cr,Zt={};function Tr(){if(nr)return Zt;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},o(T)}nr=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=a,Zt.clone=function(T){var E=new e.ARRAY_TYPE(4);return E[0]=T[0],E[1]=T[1],E[2]=T[2],E[3]=T[3],E},Zt.fromValues=function(T,E,C,O){var k=new e.ARRAY_TYPE(4);return k[0]=T,k[1]=E,k[2]=C,k[3]=O,k},Zt.copy=function(T,E){return T[0]=E[0],T[1]=E[1],T[2]=E[2],T[3]=E[3],T},Zt.set=function(T,E,C,O,k){return T[0]=E,T[1]=C,T[2]=O,T[3]=k,T},Zt.add=function(T,E,C){return T[0]=E[0]+C[0],T[1]=E[1]+C[1],T[2]=E[2]+C[2],T[3]=E[3]+C[3],T},Zt.subtract=u,Zt.multiply=c,Zt.divide=f,Zt.ceil=function(T,E){return T[0]=Math.ceil(E[0]),T[1]=Math.ceil(E[1]),T[2]=Math.ceil(E[2]),T[3]=Math.ceil(E[3]),T},Zt.floor=function(T,E){return T[0]=Math.floor(E[0]),T[1]=Math.floor(E[1]),T[2]=Math.floor(E[2]),T[3]=Math.floor(E[3]),T},Zt.min=function(T,E,C){return T[0]=Math.min(E[0],C[0]),T[1]=Math.min(E[1],C[1]),T[2]=Math.min(E[2],C[2]),T[3]=Math.min(E[3],C[3]),T},Zt.max=function(T,E,C){return T[0]=Math.max(E[0],C[0]),T[1]=Math.max(E[1],C[1]),T[2]=Math.max(E[2],C[2]),T[3]=Math.max(E[3],C[3]),T},Zt.round=function(T,E){return T[0]=Math.round(E[0]),T[1]=Math.round(E[1]),T[2]=Math.round(E[2]),T[3]=Math.round(E[3]),T},Zt.scale=function(T,E,C){return T[0]=E[0]*C,T[1]=E[1]*C,T[2]=E[2]*C,T[3]=E[3]*C,T},Zt.scaleAndAdd=function(T,E,C,O){return T[0]=E[0]+C[0]*O,T[1]=E[1]+C[1]*O,T[2]=E[2]+C[2]*O,T[3]=E[3]+C[3]*O,T},Zt.distance=y,Zt.squaredDistance=b,Zt.length=S,Zt.squaredLength=_,Zt.negate=function(T,E){return T[0]=-E[0],T[1]=-E[1],T[2]=-E[2],T[3]=-E[3],T},Zt.inverse=function(T,E){return T[0]=1/E[0],T[1]=1/E[1],T[2]=1/E[2],T[3]=1/E[3],T},Zt.normalize=function(T,E){var C=E[0],O=E[1],k=E[2],U=E[3],V=C*C+O*O+k*k+U*U;return V>0&&(V=1/Math.sqrt(V)),T[0]=C*V,T[1]=O*V,T[2]=k*V,T[3]=U*V,T},Zt.dot=function(T,E){return T[0]*E[0]+T[1]*E[1]+T[2]*E[2]+T[3]*E[3]},Zt.cross=function(T,E,C,O){var k=C[0]*O[1]-C[1]*O[0],U=C[0]*O[2]-C[2]*O[0],V=C[0]*O[3]-C[3]*O[0],N=C[1]*O[2]-C[2]*O[1],$=C[1]*O[3]-C[3]*O[1],Z=C[2]*O[3]-C[3]*O[2],K=E[0],ae=E[1],ie=E[2],se=E[3];return T[0]=ae*Z-ie*$+se*N,T[1]=-K*Z+ie*V-se*U,T[2]=K*$-ae*V+se*k,T[3]=-K*N+ae*U-ie*k,T},Zt.lerp=function(T,E,C,O){var k=E[0],U=E[1],V=E[2],N=E[3];return T[0]=k+O*(C[0]-k),T[1]=U+O*(C[1]-U),T[2]=V+O*(C[2]-V),T[3]=N+O*(C[3]-N),T},Zt.random=function(T,E){var C,O,k,U,V,N;E=E||1;do V=(C=2*e.RANDOM()-1)*C+(O=2*e.RANDOM()-1)*O;while(V>=1);do N=(k=2*e.RANDOM()-1)*k+(U=2*e.RANDOM()-1)*U;while(N>=1);var $=Math.sqrt((1-V)/N);return T[0]=E*C,T[1]=E*O,T[2]=E*k*$,T[3]=E*U*$,T},Zt.transformMat4=function(T,E,C){var O=E[0],k=E[1],U=E[2],V=E[3];return T[0]=C[0]*O+C[4]*k+C[8]*U+C[12]*V,T[1]=C[1]*O+C[5]*k+C[9]*U+C[13]*V,T[2]=C[2]*O+C[6]*k+C[10]*U+C[14]*V,T[3]=C[3]*O+C[7]*k+C[11]*U+C[15]*V,T},Zt.transformQuat=function(T,E,C){var O=E[0],k=E[1],U=E[2],V=C[0],N=C[1],$=C[2],Z=C[3],K=Z*O+N*U-$*k,ae=Z*k+$*O-V*U,ie=Z*U+V*k-N*O,se=-V*O-N*k-$*U;return T[0]=K*Z+se*-V+ae*-$-ie*-N,T[1]=ae*Z+se*-N+ie*-V-K*-$,T[2]=ie*Z+se*-$+K*-N-ae*-V,T[3]=E[3],T},Zt.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=0,T},Zt.str=function(T){return"vec4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+")"},Zt.exactEquals=function(T,E){return T[0]===E[0]&&T[1]===E[1]&&T[2]===E[2]&&T[3]===E[3]},Zt.equals=function(T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=E[0],N=E[1],$=E[2],Z=E[3];return Math.abs(C-V)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(V))&&Math.abs(O-N)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(N))&&Math.abs(k-$)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs($))&&Math.abs(U-Z)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(Z))},Zt.forEach=Zt.sqrLen=Zt.len=Zt.sqrDist=Zt.dist=Zt.div=Zt.mul=Zt.sub=void 0;var e=function(T,E){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var C=n(void 0);if(C&&C.has(T))return C.get(T);var O={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(U!=="default"&&Object.prototype.hasOwnProperty.call(T,U)){var V=k?Object.getOwnPropertyDescriptor(T,U):null;V&&(V.get||V.set)?Object.defineProperty(O,U,V):O[U]=T[U]}return O.default=T,C&&C.set(T,O),O}(ne());function n(T){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(n=function(O){return O?C:E})(T)}function a(){var T=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0,T[3]=0),T}function u(T,E,C){return T[0]=E[0]-C[0],T[1]=E[1]-C[1],T[2]=E[2]-C[2],T[3]=E[3]-C[3],T}function c(T,E,C){return T[0]=E[0]*C[0],T[1]=E[1]*C[1],T[2]=E[2]*C[2],T[3]=E[3]*C[3],T}function f(T,E,C){return T[0]=E[0]/C[0],T[1]=E[1]/C[1],T[2]=E[2]/C[2],T[3]=E[3]/C[3],T}function y(T,E){return Math.hypot(E[0]-T[0],E[1]-T[1],E[2]-T[2],E[3]-T[3])}function b(T,E){var C=E[0]-T[0],O=E[1]-T[1],k=E[2]-T[2],U=E[3]-T[3];return C*C+O*O+k*k+U*U}function S(T){return Math.hypot(T[0],T[1],T[2],T[3])}function _(T){var E=T[0],C=T[1],O=T[2],k=T[3];return E*E+C*C+O*O+k*k}Zt.sub=u,Zt.mul=c,Zt.div=f,Zt.dist=y,Zt.sqrDist=b,Zt.len=S,Zt.sqrLen=_;var w,M=(w=a(),function(T,E,C,O,k,U){var V,N;for(E||(E=4),C||(C=0),N=O?Math.min(O*E+C,T.length):T.length,V=C;V<N;V+=E)w[0]=T[V],w[1]=T[V+1],w[2]=T[V+2],w[3]=T[V+3],k(w,w,U),T[V]=w[0],T[V+1]=w[1],T[V+2]=w[2],T[V+3]=w[3];return T});return Zt.forEach=M,Zt}function vr(){if(Cr)return lt;function o(le){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(xe){return typeof xe}:function(xe){return xe&&typeof Symbol=="function"&&xe.constructor===Symbol&&xe!==Symbol.prototype?"symbol":typeof xe},o(le)}Cr=1,Object.defineProperty(lt,"__esModule",{value:!0}),lt.create=y,lt.identity=function(le){return le[0]=0,le[1]=0,le[2]=0,le[3]=1,le},lt.setAxisAngle=b,lt.getAxisAngle=function(le,xe){var Me=2*Math.acos(xe[3]),Se=Math.sin(Me/2);return Se>e.EPSILON?(le[0]=xe[0]/Se,le[1]=xe[1]/Se,le[2]=xe[2]/Se):(le[0]=1,le[1]=0,le[2]=0),Me},lt.getAngle=function(le,xe){var Me=C(le,xe);return Math.acos(2*Me*Me-1)},lt.multiply=S,lt.rotateX=function(le,xe,Me){Me*=.5;var Se=xe[0],Pe=xe[1],Ce=xe[2],Fe=xe[3],Le=Math.sin(Me),Ne=Math.cos(Me);return le[0]=Se*Ne+Fe*Le,le[1]=Pe*Ne+Ce*Le,le[2]=Ce*Ne-Pe*Le,le[3]=Fe*Ne-Se*Le,le},lt.rotateY=function(le,xe,Me){Me*=.5;var Se=xe[0],Pe=xe[1],Ce=xe[2],Fe=xe[3],Le=Math.sin(Me),Ne=Math.cos(Me);return le[0]=Se*Ne-Ce*Le,le[1]=Pe*Ne+Fe*Le,le[2]=Ce*Ne+Se*Le,le[3]=Fe*Ne-Pe*Le,le},lt.rotateZ=function(le,xe,Me){Me*=.5;var Se=xe[0],Pe=xe[1],Ce=xe[2],Fe=xe[3],Le=Math.sin(Me),Ne=Math.cos(Me);return le[0]=Se*Ne+Pe*Le,le[1]=Pe*Ne-Se*Le,le[2]=Ce*Ne+Fe*Le,le[3]=Fe*Ne-Ce*Le,le},lt.calculateW=function(le,xe){var Me=xe[0],Se=xe[1],Pe=xe[2];return le[0]=Me,le[1]=Se,le[2]=Pe,le[3]=Math.sqrt(Math.abs(1-Me*Me-Se*Se-Pe*Pe)),le},lt.exp=_,lt.ln=w,lt.pow=function(le,xe,Me){return w(le,xe),E(le,le,Me),_(le,le),le},lt.slerp=M,lt.random=function(le){var xe=e.RANDOM(),Me=e.RANDOM(),Se=e.RANDOM(),Pe=Math.sqrt(1-xe),Ce=Math.sqrt(xe);return le[0]=Pe*Math.sin(2*Math.PI*Me),le[1]=Pe*Math.cos(2*Math.PI*Me),le[2]=Ce*Math.sin(2*Math.PI*Se),le[3]=Ce*Math.cos(2*Math.PI*Se),le},lt.invert=function(le,xe){var Me=xe[0],Se=xe[1],Pe=xe[2],Ce=xe[3],Fe=Me*Me+Se*Se+Pe*Pe+Ce*Ce,Le=Fe?1/Fe:0;return le[0]=-Me*Le,le[1]=-Se*Le,le[2]=-Pe*Le,le[3]=Ce*Le,le},lt.conjugate=function(le,xe){return le[0]=-xe[0],le[1]=-xe[1],le[2]=-xe[2],le[3]=xe[3],le},lt.fromMat3=T,lt.fromEuler=function(le,xe,Me,Se){var Pe=.5*Math.PI/180;xe*=Pe,Me*=Pe,Se*=Pe;var Ce=Math.sin(xe),Fe=Math.cos(xe),Le=Math.sin(Me),Ne=Math.cos(Me),ot=Math.sin(Se),it=Math.cos(Se);return le[0]=Ce*Ne*it-Fe*Le*ot,le[1]=Fe*Le*it+Ce*Ne*ot,le[2]=Fe*Ne*ot-Ce*Le*it,le[3]=Fe*Ne*it+Ce*Le*ot,le},lt.str=function(le){return"quat("+le[0]+", "+le[1]+", "+le[2]+", "+le[3]+")"},lt.setAxes=lt.sqlerp=lt.rotationTo=lt.equals=lt.exactEquals=lt.normalize=lt.sqrLen=lt.squaredLength=lt.len=lt.length=lt.lerp=lt.dot=lt.scale=lt.mul=lt.add=lt.set=lt.copy=lt.fromValues=lt.clone=void 0;var e=f(ne()),n=f(ft()),a=f(mt()),u=f(Tr());function c(le){if(typeof WeakMap!="function")return null;var xe=new WeakMap,Me=new WeakMap;return(c=function(Se){return Se?Me:xe})(le)}function f(le,xe){if(le&&le.__esModule)return le;if(le===null||o(le)!=="object"&&typeof le!="function")return{default:le};var Me=c(xe);if(Me&&Me.has(le))return Me.get(le);var Se={},Pe=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ce in le)if(Ce!=="default"&&Object.prototype.hasOwnProperty.call(le,Ce)){var Fe=Pe?Object.getOwnPropertyDescriptor(le,Ce):null;Fe&&(Fe.get||Fe.set)?Object.defineProperty(Se,Ce,Fe):Se[Ce]=le[Ce]}return Se.default=le,Me&&Me.set(le,Se),Se}function y(){var le=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(le[0]=0,le[1]=0,le[2]=0),le[3]=1,le}function b(le,xe,Me){Me*=.5;var Se=Math.sin(Me);return le[0]=Se*xe[0],le[1]=Se*xe[1],le[2]=Se*xe[2],le[3]=Math.cos(Me),le}function S(le,xe,Me){var Se=xe[0],Pe=xe[1],Ce=xe[2],Fe=xe[3],Le=Me[0],Ne=Me[1],ot=Me[2],it=Me[3];return le[0]=Se*it+Fe*Le+Pe*ot-Ce*Ne,le[1]=Pe*it+Fe*Ne+Ce*Le-Se*ot,le[2]=Ce*it+Fe*ot+Se*Ne-Pe*Le,le[3]=Fe*it-Se*Le-Pe*Ne-Ce*ot,le}function _(le,xe){var Me=xe[0],Se=xe[1],Pe=xe[2],Ce=xe[3],Fe=Math.sqrt(Me*Me+Se*Se+Pe*Pe),Le=Math.exp(Ce),Ne=Fe>0?Le*Math.sin(Fe)/Fe:0;return le[0]=Me*Ne,le[1]=Se*Ne,le[2]=Pe*Ne,le[3]=Le*Math.cos(Fe),le}function w(le,xe){var Me=xe[0],Se=xe[1],Pe=xe[2],Ce=xe[3],Fe=Math.sqrt(Me*Me+Se*Se+Pe*Pe),Le=Fe>0?Math.atan2(Fe,Ce)/Fe:0;return le[0]=Me*Le,le[1]=Se*Le,le[2]=Pe*Le,le[3]=.5*Math.log(Me*Me+Se*Se+Pe*Pe+Ce*Ce),le}function M(le,xe,Me,Se){var Pe,Ce,Fe,Le,Ne,ot=xe[0],it=xe[1],Bt=xe[2],_t=xe[3],At=Me[0],ct=Me[1],rr=Me[2],Ot=Me[3];return(Ce=ot*At+it*ct+Bt*rr+_t*Ot)<0&&(Ce=-Ce,At=-At,ct=-ct,rr=-rr,Ot=-Ot),1-Ce>e.EPSILON?(Pe=Math.acos(Ce),Fe=Math.sin(Pe),Le=Math.sin((1-Se)*Pe)/Fe,Ne=Math.sin(Se*Pe)/Fe):(Le=1-Se,Ne=Se),le[0]=Le*ot+Ne*At,le[1]=Le*it+Ne*ct,le[2]=Le*Bt+Ne*rr,le[3]=Le*_t+Ne*Ot,le}function T(le,xe){var Me,Se=xe[0]+xe[4]+xe[8];if(Se>0)Me=Math.sqrt(Se+1),le[3]=.5*Me,le[0]=(xe[5]-xe[7])*(Me=.5/Me),le[1]=(xe[6]-xe[2])*Me,le[2]=(xe[1]-xe[3])*Me;else{var Pe=0;xe[4]>xe[0]&&(Pe=1),xe[8]>xe[3*Pe+Pe]&&(Pe=2);var Ce=(Pe+1)%3,Fe=(Pe+2)%3;Me=Math.sqrt(xe[3*Pe+Pe]-xe[3*Ce+Ce]-xe[3*Fe+Fe]+1),le[Pe]=.5*Me,le[3]=(xe[3*Ce+Fe]-xe[3*Fe+Ce])*(Me=.5/Me),le[Ce]=(xe[3*Ce+Pe]+xe[3*Pe+Ce])*Me,le[Fe]=(xe[3*Fe+Pe]+xe[3*Pe+Fe])*Me}return le}lt.clone=u.clone,lt.fromValues=u.fromValues,lt.copy=u.copy,lt.set=u.set,lt.add=u.add,lt.mul=S;var E=u.scale;lt.scale=E;var C=u.dot;lt.dot=C,lt.lerp=u.lerp;var O=u.length;lt.length=O,lt.len=O;var k=u.squaredLength;lt.squaredLength=k,lt.sqrLen=k;var U=u.normalize;lt.normalize=U,lt.exactEquals=u.exactEquals,lt.equals=u.equals;var V,N,$,Z=(V=a.create(),N=a.fromValues(1,0,0),$=a.fromValues(0,1,0),function(le,xe,Me){var Se=a.dot(xe,Me);return Se<-.999999?(a.cross(V,N,xe),a.len(V)<1e-6&&a.cross(V,$,xe),a.normalize(V,V),b(le,V,Math.PI),le):Se>.999999?(le[0]=0,le[1]=0,le[2]=0,le[3]=1,le):(a.cross(V,xe,Me),le[0]=V[0],le[1]=V[1],le[2]=V[2],le[3]=1+Se,U(le,le))});lt.rotationTo=Z;var K,ae,ie=(K=y(),ae=y(),function(le,xe,Me,Se,Pe,Ce){return M(K,xe,Pe,Ce),M(ae,Me,Se,Ce),M(le,K,ae,2*Ce*(1-Ce)),le});lt.sqlerp=ie;var se,ve=(se=n.create(),function(le,xe,Me,Se){return se[0]=Me[0],se[3]=Me[1],se[6]=Me[2],se[1]=Se[0],se[4]=Se[1],se[7]=Se[2],se[2]=-xe[0],se[5]=-xe[1],se[8]=-xe[2],U(le,T(le,se))});return lt.setAxes=ve,lt}var Ur,lr={};function qr(){if(Ur)return lr;function o(M){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},o(M)}Ur=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.create=function(){var M=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0,M[4]=0,M[5]=0,M[6]=0,M[7]=0),M[3]=1,M},lr.clone=function(M){var T=new e.ARRAY_TYPE(8);return T[0]=M[0],T[1]=M[1],T[2]=M[2],T[3]=M[3],T[4]=M[4],T[5]=M[5],T[6]=M[6],T[7]=M[7],T},lr.fromValues=function(M,T,E,C,O,k,U,V){var N=new e.ARRAY_TYPE(8);return N[0]=M,N[1]=T,N[2]=E,N[3]=C,N[4]=O,N[5]=k,N[6]=U,N[7]=V,N},lr.fromRotationTranslationValues=function(M,T,E,C,O,k,U){var V=new e.ARRAY_TYPE(8);V[0]=M,V[1]=T,V[2]=E,V[3]=C;var N=.5*O,$=.5*k,Z=.5*U;return V[4]=N*C+$*E-Z*T,V[5]=$*C+Z*M-N*E,V[6]=Z*C+N*T-$*M,V[7]=-N*M-$*T-Z*E,V},lr.fromRotationTranslation=f,lr.fromTranslation=function(M,T){return M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=.5*T[0],M[5]=.5*T[1],M[6]=.5*T[2],M[7]=0,M},lr.fromRotation=function(M,T){return M[0]=T[0],M[1]=T[1],M[2]=T[2],M[3]=T[3],M[4]=0,M[5]=0,M[6]=0,M[7]=0,M},lr.fromMat4=function(M,T){var E=n.create();a.getRotation(E,T);var C=new e.ARRAY_TYPE(3);return a.getTranslation(C,T),f(M,E,C),M},lr.copy=y,lr.identity=function(M){return M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=0,M[5]=0,M[6]=0,M[7]=0,M},lr.set=function(M,T,E,C,O,k,U,V,N){return M[0]=T,M[1]=E,M[2]=C,M[3]=O,M[4]=k,M[5]=U,M[6]=V,M[7]=N,M},lr.getDual=function(M,T){return M[0]=T[4],M[1]=T[5],M[2]=T[6],M[3]=T[7],M},lr.setDual=function(M,T){return M[4]=T[0],M[5]=T[1],M[6]=T[2],M[7]=T[3],M},lr.getTranslation=function(M,T){var E=T[4],C=T[5],O=T[6],k=T[7],U=-T[0],V=-T[1],N=-T[2],$=T[3];return M[0]=2*(E*$+k*U+C*N-O*V),M[1]=2*(C*$+k*V+O*U-E*N),M[2]=2*(O*$+k*N+E*V-C*U),M},lr.translate=function(M,T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=.5*E[0],N=.5*E[1],$=.5*E[2],Z=T[4],K=T[5],ae=T[6],ie=T[7];return M[0]=C,M[1]=O,M[2]=k,M[3]=U,M[4]=U*V+O*$-k*N+Z,M[5]=U*N+k*V-C*$+K,M[6]=U*$+C*N-O*V+ae,M[7]=-C*V-O*N-k*$+ie,M},lr.rotateX=function(M,T,E){var C=-T[0],O=-T[1],k=-T[2],U=T[3],V=T[4],N=T[5],$=T[6],Z=T[7],K=V*U+Z*C+N*k-$*O,ae=N*U+Z*O+$*C-V*k,ie=$*U+Z*k+V*O-N*C,se=Z*U-V*C-N*O-$*k;return n.rotateX(M,T,E),M[4]=K*(U=M[3])+se*(C=M[0])+ae*(k=M[2])-ie*(O=M[1]),M[5]=ae*U+se*O+ie*C-K*k,M[6]=ie*U+se*k+K*O-ae*C,M[7]=se*U-K*C-ae*O-ie*k,M},lr.rotateY=function(M,T,E){var C=-T[0],O=-T[1],k=-T[2],U=T[3],V=T[4],N=T[5],$=T[6],Z=T[7],K=V*U+Z*C+N*k-$*O,ae=N*U+Z*O+$*C-V*k,ie=$*U+Z*k+V*O-N*C,se=Z*U-V*C-N*O-$*k;return n.rotateY(M,T,E),M[4]=K*(U=M[3])+se*(C=M[0])+ae*(k=M[2])-ie*(O=M[1]),M[5]=ae*U+se*O+ie*C-K*k,M[6]=ie*U+se*k+K*O-ae*C,M[7]=se*U-K*C-ae*O-ie*k,M},lr.rotateZ=function(M,T,E){var C=-T[0],O=-T[1],k=-T[2],U=T[3],V=T[4],N=T[5],$=T[6],Z=T[7],K=V*U+Z*C+N*k-$*O,ae=N*U+Z*O+$*C-V*k,ie=$*U+Z*k+V*O-N*C,se=Z*U-V*C-N*O-$*k;return n.rotateZ(M,T,E),M[4]=K*(U=M[3])+se*(C=M[0])+ae*(k=M[2])-ie*(O=M[1]),M[5]=ae*U+se*O+ie*C-K*k,M[6]=ie*U+se*k+K*O-ae*C,M[7]=se*U-K*C-ae*O-ie*k,M},lr.rotateByQuatAppend=function(M,T,E){var C=E[0],O=E[1],k=E[2],U=E[3],V=T[0],N=T[1],$=T[2],Z=T[3];return M[0]=V*U+Z*C+N*k-$*O,M[1]=N*U+Z*O+$*C-V*k,M[2]=$*U+Z*k+V*O-N*C,M[3]=Z*U-V*C-N*O-$*k,M[4]=(V=T[4])*U+(Z=T[7])*C+(N=T[5])*k-($=T[6])*O,M[5]=N*U+Z*O+$*C-V*k,M[6]=$*U+Z*k+V*O-N*C,M[7]=Z*U-V*C-N*O-$*k,M},lr.rotateByQuatPrepend=function(M,T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=E[0],N=E[1],$=E[2],Z=E[3];return M[0]=C*Z+U*V+O*$-k*N,M[1]=O*Z+U*N+k*V-C*$,M[2]=k*Z+U*$+C*N-O*V,M[3]=U*Z-C*V-O*N-k*$,M[4]=C*(Z=E[7])+U*(V=E[4])+O*($=E[6])-k*(N=E[5]),M[5]=O*Z+U*N+k*V-C*$,M[6]=k*Z+U*$+C*N-O*V,M[7]=U*Z-C*V-O*N-k*$,M},lr.rotateAroundAxis=function(M,T,E,C){if(Math.abs(C)<e.EPSILON)return y(M,T);var O=Math.hypot(E[0],E[1],E[2]);C*=.5;var k=Math.sin(C),U=k*E[0]/O,V=k*E[1]/O,N=k*E[2]/O,$=Math.cos(C),Z=T[0],K=T[1],ae=T[2],ie=T[3];M[0]=Z*$+ie*U+K*N-ae*V,M[1]=K*$+ie*V+ae*U-Z*N,M[2]=ae*$+ie*N+Z*V-K*U,M[3]=ie*$-Z*U-K*V-ae*N;var se=T[4],ve=T[5],le=T[6],xe=T[7];return M[4]=se*$+xe*U+ve*N-le*V,M[5]=ve*$+xe*V+le*U-se*N,M[6]=le*$+xe*N+se*V-ve*U,M[7]=xe*$-se*U-ve*V-le*N,M},lr.add=function(M,T,E){return M[0]=T[0]+E[0],M[1]=T[1]+E[1],M[2]=T[2]+E[2],M[3]=T[3]+E[3],M[4]=T[4]+E[4],M[5]=T[5]+E[5],M[6]=T[6]+E[6],M[7]=T[7]+E[7],M},lr.multiply=b,lr.scale=function(M,T,E){return M[0]=T[0]*E,M[1]=T[1]*E,M[2]=T[2]*E,M[3]=T[3]*E,M[4]=T[4]*E,M[5]=T[5]*E,M[6]=T[6]*E,M[7]=T[7]*E,M},lr.lerp=function(M,T,E,C){var O=1-C;return S(T,E)<0&&(C=-C),M[0]=T[0]*O+E[0]*C,M[1]=T[1]*O+E[1]*C,M[2]=T[2]*O+E[2]*C,M[3]=T[3]*O+E[3]*C,M[4]=T[4]*O+E[4]*C,M[5]=T[5]*O+E[5]*C,M[6]=T[6]*O+E[6]*C,M[7]=T[7]*O+E[7]*C,M},lr.invert=function(M,T){var E=w(T);return M[0]=-T[0]/E,M[1]=-T[1]/E,M[2]=-T[2]/E,M[3]=T[3]/E,M[4]=-T[4]/E,M[5]=-T[5]/E,M[6]=-T[6]/E,M[7]=T[7]/E,M},lr.conjugate=function(M,T){return M[0]=-T[0],M[1]=-T[1],M[2]=-T[2],M[3]=T[3],M[4]=-T[4],M[5]=-T[5],M[6]=-T[6],M[7]=T[7],M},lr.normalize=function(M,T){var E=w(T);if(E>0){E=Math.sqrt(E);var C=T[0]/E,O=T[1]/E,k=T[2]/E,U=T[3]/E,V=T[4],N=T[5],$=T[6],Z=T[7],K=C*V+O*N+k*$+U*Z;M[0]=C,M[1]=O,M[2]=k,M[3]=U,M[4]=(V-C*K)/E,M[5]=(N-O*K)/E,M[6]=($-k*K)/E,M[7]=(Z-U*K)/E}return M},lr.str=function(M){return"quat2("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+", "+M[4]+", "+M[5]+", "+M[6]+", "+M[7]+")"},lr.exactEquals=function(M,T){return M[0]===T[0]&&M[1]===T[1]&&M[2]===T[2]&&M[3]===T[3]&&M[4]===T[4]&&M[5]===T[5]&&M[6]===T[6]&&M[7]===T[7]},lr.equals=function(M,T){var E=M[0],C=M[1],O=M[2],k=M[3],U=M[4],V=M[5],N=M[6],$=M[7],Z=T[0],K=T[1],ae=T[2],ie=T[3],se=T[4],ve=T[5],le=T[6],xe=T[7];return Math.abs(E-Z)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Z))&&Math.abs(C-K)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(K))&&Math.abs(O-ae)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(ae))&&Math.abs(k-ie)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(ie))&&Math.abs(U-se)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(se))&&Math.abs(V-ve)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(ve))&&Math.abs(N-le)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(le))&&Math.abs($-xe)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(xe))},lr.sqrLen=lr.squaredLength=lr.len=lr.length=lr.dot=lr.mul=lr.setReal=lr.getReal=void 0;var e=c(ne()),n=c(vr()),a=c(Et());function u(M){if(typeof WeakMap!="function")return null;var T=new WeakMap,E=new WeakMap;return(u=function(C){return C?E:T})(M)}function c(M,T){if(M&&M.__esModule)return M;if(M===null||o(M)!=="object"&&typeof M!="function")return{default:M};var E=u(T);if(E&&E.has(M))return E.get(M);var C={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in M)if(k!=="default"&&Object.prototype.hasOwnProperty.call(M,k)){var U=O?Object.getOwnPropertyDescriptor(M,k):null;U&&(U.get||U.set)?Object.defineProperty(C,k,U):C[k]=M[k]}return C.default=M,E&&E.set(M,C),C}function f(M,T,E){var C=.5*E[0],O=.5*E[1],k=.5*E[2],U=T[0],V=T[1],N=T[2],$=T[3];return M[0]=U,M[1]=V,M[2]=N,M[3]=$,M[4]=C*$+O*N-k*V,M[5]=O*$+k*U-C*N,M[6]=k*$+C*V-O*U,M[7]=-C*U-O*V-k*N,M}function y(M,T){return M[0]=T[0],M[1]=T[1],M[2]=T[2],M[3]=T[3],M[4]=T[4],M[5]=T[5],M[6]=T[6],M[7]=T[7],M}function b(M,T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=E[4],N=E[5],$=E[6],Z=E[7],K=T[4],ae=T[5],ie=T[6],se=T[7],ve=E[0],le=E[1],xe=E[2],Me=E[3];return M[0]=C*Me+U*ve+O*xe-k*le,M[1]=O*Me+U*le+k*ve-C*xe,M[2]=k*Me+U*xe+C*le-O*ve,M[3]=U*Me-C*ve-O*le-k*xe,M[4]=C*Z+U*V+O*$-k*N+K*Me+se*ve+ae*xe-ie*le,M[5]=O*Z+U*N+k*V-C*$+ae*Me+se*le+ie*ve-K*xe,M[6]=k*Z+U*$+C*N-O*V+ie*Me+se*xe+K*le-ae*ve,M[7]=U*Z-C*V-O*N-k*$+se*Me-K*ve-ae*le-ie*xe,M}lr.getReal=n.copy,lr.setReal=n.copy,lr.mul=b;var S=n.dot;lr.dot=S;var _=n.length;lr.length=_,lr.len=_;var w=n.squaredLength;return lr.squaredLength=w,lr.sqrLen=w,lr}var ur,ir,$t={};function vi(){if(ur)return $t;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},o(T)}ur=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.create=a,$t.clone=function(T){var E=new e.ARRAY_TYPE(2);return E[0]=T[0],E[1]=T[1],E},$t.fromValues=function(T,E){var C=new e.ARRAY_TYPE(2);return C[0]=T,C[1]=E,C},$t.copy=function(T,E){return T[0]=E[0],T[1]=E[1],T},$t.set=function(T,E,C){return T[0]=E,T[1]=C,T},$t.add=function(T,E,C){return T[0]=E[0]+C[0],T[1]=E[1]+C[1],T},$t.subtract=u,$t.multiply=c,$t.divide=f,$t.ceil=function(T,E){return T[0]=Math.ceil(E[0]),T[1]=Math.ceil(E[1]),T},$t.floor=function(T,E){return T[0]=Math.floor(E[0]),T[1]=Math.floor(E[1]),T},$t.min=function(T,E,C){return T[0]=Math.min(E[0],C[0]),T[1]=Math.min(E[1],C[1]),T},$t.max=function(T,E,C){return T[0]=Math.max(E[0],C[0]),T[1]=Math.max(E[1],C[1]),T},$t.round=function(T,E){return T[0]=Math.round(E[0]),T[1]=Math.round(E[1]),T},$t.scale=function(T,E,C){return T[0]=E[0]*C,T[1]=E[1]*C,T},$t.scaleAndAdd=function(T,E,C,O){return T[0]=E[0]+C[0]*O,T[1]=E[1]+C[1]*O,T},$t.distance=y,$t.squaredDistance=b,$t.length=S,$t.squaredLength=_,$t.negate=function(T,E){return T[0]=-E[0],T[1]=-E[1],T},$t.inverse=function(T,E){return T[0]=1/E[0],T[1]=1/E[1],T},$t.normalize=function(T,E){var C=E[0],O=E[1],k=C*C+O*O;return k>0&&(k=1/Math.sqrt(k)),T[0]=E[0]*k,T[1]=E[1]*k,T},$t.dot=function(T,E){return T[0]*E[0]+T[1]*E[1]},$t.cross=function(T,E,C){var O=E[0]*C[1]-E[1]*C[0];return T[0]=T[1]=0,T[2]=O,T},$t.lerp=function(T,E,C,O){var k=E[0],U=E[1];return T[0]=k+O*(C[0]-k),T[1]=U+O*(C[1]-U),T},$t.random=function(T,E){E=E||1;var C=2*e.RANDOM()*Math.PI;return T[0]=Math.cos(C)*E,T[1]=Math.sin(C)*E,T},$t.transformMat2=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[2]*k,T[1]=C[1]*O+C[3]*k,T},$t.transformMat2d=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[2]*k+C[4],T[1]=C[1]*O+C[3]*k+C[5],T},$t.transformMat3=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[3]*k+C[6],T[1]=C[1]*O+C[4]*k+C[7],T},$t.transformMat4=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[4]*k+C[12],T[1]=C[1]*O+C[5]*k+C[13],T},$t.rotate=function(T,E,C,O){var k=E[0]-C[0],U=E[1]-C[1],V=Math.sin(O),N=Math.cos(O);return T[0]=k*N-U*V+C[0],T[1]=k*V+U*N+C[1],T},$t.angle=function(T,E){var C=T[0],O=T[1],k=E[0],U=E[1],V=Math.sqrt(C*C+O*O)*Math.sqrt(k*k+U*U);return Math.acos(Math.min(Math.max(V&&(C*k+O*U)/V,-1),1))},$t.zero=function(T){return T[0]=0,T[1]=0,T},$t.str=function(T){return"vec2("+T[0]+", "+T[1]+")"},$t.exactEquals=function(T,E){return T[0]===E[0]&&T[1]===E[1]},$t.equals=function(T,E){var C=T[0],O=T[1],k=E[0],U=E[1];return Math.abs(C-k)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(k))&&Math.abs(O-U)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(U))},$t.forEach=$t.sqrLen=$t.sqrDist=$t.dist=$t.div=$t.mul=$t.sub=$t.len=void 0;var e=function(T,E){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var C=n(void 0);if(C&&C.has(T))return C.get(T);var O={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(U!=="default"&&Object.prototype.hasOwnProperty.call(T,U)){var V=k?Object.getOwnPropertyDescriptor(T,U):null;V&&(V.get||V.set)?Object.defineProperty(O,U,V):O[U]=T[U]}return O.default=T,C&&C.set(T,O),O}(ne());function n(T){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(n=function(O){return O?C:E})(T)}function a(){var T=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0),T}function u(T,E,C){return T[0]=E[0]-C[0],T[1]=E[1]-C[1],T}function c(T,E,C){return T[0]=E[0]*C[0],T[1]=E[1]*C[1],T}function f(T,E,C){return T[0]=E[0]/C[0],T[1]=E[1]/C[1],T}function y(T,E){return Math.hypot(E[0]-T[0],E[1]-T[1])}function b(T,E){var C=E[0]-T[0],O=E[1]-T[1];return C*C+O*O}function S(T){return Math.hypot(T[0],T[1])}function _(T){var E=T[0],C=T[1];return E*E+C*C}$t.len=S,$t.sub=u,$t.mul=c,$t.div=f,$t.dist=y,$t.sqrDist=b,$t.sqrLen=_;var w,M=(w=a(),function(T,E,C,O,k,U){var V,N;for(E||(E=2),C||(C=0),N=O?Math.min(O*E+C,T.length):T.length,V=C;V<N;V+=E)w[0]=T[V],w[1]=T[V+1],k(w,w,U),T[V]=w[0],T[V+1]=w[1];return T});return $t.forEach=M,$t}function di(){if(ir)return H;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},o(T)}ir=1,Object.defineProperty(H,"__esModule",{value:!0}),H.vec4=H.vec3=H.vec2=H.quat2=H.quat=H.mat4=H.mat3=H.mat2d=H.mat2=H.glMatrix=void 0;var e=M(ne());H.glMatrix=e;var n=M(_e());H.mat2=n;var a=M(vt());H.mat2d=a;var u=M(ft());H.mat3=u;var c=M(Et());H.mat4=c;var f=M(vr());H.quat=f;var y=M(qr());H.quat2=y;var b=M(vi());H.vec2=b;var S=M(mt());H.vec3=S;var _=M(Tr());function w(T){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(w=function(O){return O?C:E})(T)}function M(T,E){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var C=w(E);if(C&&C.has(T))return C.get(T);var O={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(U!=="default"&&Object.prototype.hasOwnProperty.call(T,U)){var V=k?Object.getOwnPropertyDescriptor(T,U):null;V&&(V.get||V.set)?Object.defineProperty(O,U,V):O[U]=T[U]}return O.default=T,C&&C.set(T,O),O}return H.vec4=_,H}var yn,Rt,tr,Yt,te=di(),vn=function(){if(Rt)return yn;function o(e,n,a,u){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(u-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=a,this.p2y=u}return Rt=1,yn=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,u=0;u<8;u++){var c=this.sampleCurveX(a)-e;if(Math.abs(c)<n)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=c/f}var y=0,b=1;for(a=e,u=0;u<20&&(c=this.sampleCurveX(a),!(Math.abs(c-e)<n));u++)e>c?y=a:b=a,a=.5*(b-y)+y;return a},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},yn}(),ke=G(vn);function Ve(){if(Yt)return tr;function o(e,n){this.x=e,this.y=n}return Yt=1,tr=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,n){return this.clone()._rotateAround(e,n)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var n=e.x-this.x,a=e.y-this.y;return n*n+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,n){return Math.atan2(this.x*n-this.y*e,this.x*e+this.y*n)},_matMult:function(e){var n=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var n=Math.cos(e),a=Math.sin(e),u=a*this.x+n*this.y;return this.x=n*this.x-a*this.y,this.y=u,this},_rotateAround:function(e,n){var a=Math.cos(e),u=Math.sin(e),c=n.y+u*(this.x-n.x)+a*(this.y-n.y);return this.x=n.x+a*(this.x-n.x)-u*(this.y-n.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e},tr}var Ae=G(Ve());function wt(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let n=0;n<o.length;n++)if(!wt(o[n],e[n]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const n in o)if(!wt(o[n],e[n]))return!1;return!0}return o===e}const Vt=Math.PI/180,zt=180/Math.PI;function Dt(o){return o*Vt}function jt(o){return o*zt}const Jt=[[0,0],[1,0],[1,1],[0,1]];function Gt(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,n=e*o;return 4*(o<.5?n:3*(o-e)+n-.75)}function Pr(o,e,n,a){const u=new ke(o,e,n,a);return function(c){return u.solve(c)}}const cr=Pr(.25,.1,.25,1);function Ye(o,e,n){return Math.min(n,Math.max(e,o))}function Qt(o,e,n){return(n=Ye((n-o)/(e-o),0,1))*n*(3-2*n)}function Gr(o,e,n){const a=n-e,u=((o-e)%a+a)%a+e;return u===e?n:u}function xn(o,e,n){if(!o.length)return n(null,[]);let a=o.length;const u=new Array(o.length);let c=null;o.forEach((f,y)=>{e(f,(b,S)=>{b&&(c=b),u[y]=S,--a==0&&n(c,u)})})}function jr(o,...e){for(const n of e)for(const a in n)o[a]=n[a];return o}let xi=1;function ri(){return xi++}function Ji(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Ni(o,e){o.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function xs(o,e,n){const a={};for(const u in o)a[u]=e.call(this,o[u],u,o);return a}function wo(o,e,n){const a={};for(const u in o)e.call(this,o[u],u,o)&&(a[u]=o[u]);return a}function Jn(o){return Array.isArray(o)?o.map(Jn):typeof o=="object"&&o?xs(o,Jn):o}const Vi={};function Rr(o){Vi[o]||(typeof console<"u"&&console.warn(o),Vi[o]=!0)}function To(o,e,n){return(n.y-o.y)*(e.x-o.x)>(e.y-o.y)*(n.x-o.x)}function wl(o){let e=0;for(let n,a,u=0,c=o.length,f=c-1;u<c;f=u++)n=o[u],a=o[f],e+=(a.x-n.x)*(n.y+a.y);return e}function bs([o,e,n]){const a=Dt(e+90),u=Dt(n);return{x:o*Math.cos(a)*Math.sin(u),y:o*Math.sin(a)*Math.sin(u),z:o*Math.cos(u),azimuthal:e,polar:n}}function Ga(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ha(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,a,u,c)=>{const f=u||c;return e[a]=!f||f.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let zc=null;function Tl(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function Zu(o,e,n,a){for(;e<n;){const u=e+n>>1;o[u]<a?e=u+1:n=u}return e}function Xu(o,e,n,a){for(;e<n;){const u=e+n>>1;o[u]<=a?e=u+1:n=u}return e}function Lc(o){return o>0?1/(1.001-o):1+o}function Xe(o){return o>0?1-1/(1.001-o):-o}const Y={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Y.API_URL)return null;try{const o=new URL(Y.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function re(o){return Y.API_URL_REGEX.test(o)}function fe(o){return Y.API_SPRITE_REGEX.test(o)}let Te,be,Re,Ge,De,qe;function Ke(){return Te==null&&(Te=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Te}const We={now:()=>Ge!==void 0?Ge:performance.now(),setNow(o){Ge=o},restoreNow(){Ge=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:n,height:a}=o;De||(De=document.createElement("canvas"));const u=De.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>De.width||a>De.height)&&(De.width=n,De.height=a),u.clearRect(-e,-e,n+2*e,a+2*e),u.drawImage(o,0,0,n,a),u.getImageData(-e,-e,n+2*e,a+2*e)},resolveURL:o=>(be||(be=document.createElement("a")),be.href=o,be.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Re==null&&(Re=window.matchMedia("(prefers-reduced-motion: reduce)")),Re.matches)},hasCanvasFingerprintNoise(){if(qe!==void 0)return qe;if(!Ke())return qe=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let n=0;for(let u=0;u<o.width;++u)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(u,0,1,1);const a=e.getImageData(0,0,o.width,o.height);n=0;for(let u=0;u<a.data.length;++u)if(u%4!=3&&n++!==a.data[u])return qe=!0,!0;return qe=!1,!1}};function gt(o,e){const n=o.indexOf("?");if(n<0)return`${o}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(o.slice(n));for(const u in e)a.set(u,e[u]);return`${o.slice(0,n)}?${a.toString()}`}function Nt(o,e={persistentParams:[]}){const n=o.indexOf("?");if(n<0)return o;const a=new URLSearchParams,u=new URLSearchParams(o.slice(n));for(const f of e.persistentParams){const y=u.get(f);y&&a.set(f,y)}const c=a.toString();return`${o.slice(0,n)}${c.length>0?`?${c}`:""}`}const Ut="mapbox-tiles";let xr=500,Sr=50;const Ar=["language","worldview","jobid"];let Mr,Sn;function jn(){try{return caches}catch{}}function Or(){const o=jn();o&&Mr==null&&(Mr=o.open(Ut))}let hn=1/0;const cn={supported:!1,testSupport:function(o){!bi&&Qn&&(Ai?Ui(o):un=o)}};let un,Qn,bi=!1,Ai=!1;const Vo=typeof self<"u"?self:{};function Ui(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Qn),o.isContextLost())return;cn.supported=!0}catch{}o.deleteTexture(e),bi=!0}Vo.document&&(Qn=Vo.document.createElement("img"),Qn.onload=function(){un&&Ui(un),un=null,Ai=!0},Qn.onerror=function(){bi=!0,un=null},Qn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const mi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(mi);class ji extends Error{constructor(e,n,a){n===401&&re(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ma=Ga()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ws=function(o,e){if(!(/^file:/.test(n=o.url)||/^file:/.test(ma())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,u){const c=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:ma(),referrerPolicy:a.referrerPolicy,signal:c.signal});let y=!1,b=!1;const S=(_=f.url).indexOf("sku=")>0&&re(_);var _;a.type==="json"&&f.headers.set("Accept","application/json");const w=(T,E,C)=>{if(b)return;if(T&&T.message!=="SecurityError"&&Rr(T.toString()),E&&C)return M(E);const O=Date.now();fetch(f).then(k=>{if(k.ok){const U=S?k.clone():null;return M(k,U,O)}return u(new ji(k.statusText,k.status,a.url))}).catch(k=>{k.name!=="AbortError"&&u(new Error(`${k.message} ${a.url}`))})},M=(T,E,C)=>{(a.type==="arrayBuffer"?T.arrayBuffer():a.type==="json"?T.json():T.text()).then(O=>{b||(E&&C&&function(k,U,V){if(Or(),Mr==null)return;const N=Ha(U.headers.get("Cache-Control")||"");if(N["no-store"])return;const $={status:U.status,statusText:U.statusText,headers:new Headers};U.headers.forEach((ae,ie)=>$.headers.set(ie,ae)),N["max-age"]&&$.headers.set("Expires",new Date(V+1e3*N["max-age"]).toUTCString());const Z=$.headers.get("Expires");if(!Z||new Date(Z).getTime()-V<42e4)return;let K=Nt(k.url,{persistentParams:Ar});if(U.status===206){const ae=k.headers.get("Range");if(!ae)return;$.status=200,K=gt(K,{range:ae})}(function(ae,ie){if(Sn===void 0)try{new Response(new ReadableStream),Sn=!0}catch{Sn=!1}Sn?ie(ae.body):ae.blob().then(ie)})(U,ae=>{const ie=new Response((se=U.status)!==200&&se!==404&&[101,103,204,205,304].includes(se)?null:ae,$);var se;Or(),Mr!=null&&Mr.then(ve=>ve.put(K,ie)).catch(ve=>Rr(ve.message))})}(f,E,C),y=!0,u(null,O,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(O=>{b||u(new Error(O.message))})};return S?function(T,E){if(Or(),Mr==null)return E(null);Mr.then(C=>{let O=Nt(T.url,{persistentParams:Ar});const k=T.headers.get("Range");k&&(O=gt(O,{range:k})),C.match(O).then(U=>{const V=function(N){if(!N)return!1;const $=new Date(N.headers.get("Expires")||0),Z=Ha(N.headers.get("Cache-Control")||"");return $>Date.now()&&!Z["no-cache"]}(U);C.delete(O),V&&C.put(O,U.clone()),E(null,U,V)}).catch(E)}).catch(E)}(f,w):w(null,null),{cancel:()=>{b=!0,y||c.abort()}}}(o,e);if(Ga()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var n;return function(a,u){const c=new XMLHttpRequest;c.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const f in a.headers)c.setRequestHeader(f,a.headers[f]);return a.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=a.credentials==="include",c.onerror=()=>{u(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let f=c.response;if(a.type==="json")try{f=JSON.parse(c.response)}catch(y){return u(y)}u(null,f,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else u(new ji(c.statusText,c.status,a.url))},c.send(a.body),{cancel:()=>c.abort()}}(o,e)},qa=function(o,e){return ws(jr(o,{type:"arrayBuffer"}),e)};function Qd(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const ef="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Oc,kc;Oc=[],kc=0;const tf=function(o,e){if(cn.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),kc>=Y.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Oc.push(c),c}kc++;let n=!1;const a=()=>{if(!n)for(n=!0,kc--;Oc.length&&kc<Y.MAX_PARALLEL_IMAGE_REQUESTS;){const c=Oc.shift(),{requestParameters:f,callback:y,cancelled:b}=c;b||(c.cancel=tf(f,y).cancel)}},u=qa(o,(c,f,y,b)=>{a(),c?e(c):f&&(self.createImageBitmap?function(S,_){const w=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(w).then(M=>{_(null,M)}).catch(M=>{_(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(S,_)=>e(S,_,y,b)):function(S,_){const w=new Image;w.onload=()=>{_(null,w),URL.revokeObjectURL(w.src),w.onload=null,requestAnimationFrame(()=>{w.src=ef})},w.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(S)],{type:"image/png"});w.src=S.byteLength?URL.createObjectURL(M):ef}(f,(S,_)=>e(S,_,y,b)))});return{cancel:()=>{u.cancel(),a()}}};var Km,rf,nf,Zi={exports:{}},to={exports:{}},Uo={exports:{}},So=function(){if(nf)return Zi.exports;nf=1;var o=(Km||(Km=1,to.exports=function(n,a){var u,c,f,y,b,S,_,w;for(c=n.length-(u=3&n.length),f=a,b=3432918353,S=461845907,w=0;w<c;)_=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24,++w,f=27492+(65535&(y=5*(65535&(f=(f^=_=(65535&(_=(_=(65535&_)*b+(((_>>>16)*b&65535)<<16)&4294967295)<<15|_>>>17))*S+(((_>>>16)*S&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(_=0,u){case 3:_^=(255&n.charCodeAt(w+2))<<16;case 2:_^=(255&n.charCodeAt(w+1))<<8;case 1:f^=_=(65535&(_=(_=(65535&(_^=255&n.charCodeAt(w)))*b+(((_>>>16)*b&65535)<<16)&4294967295)<<15|_>>>17))*S+(((_>>>16)*S&65535)<<16)&4294967295}return f^=n.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),to.exports),e=(rf||(rf=1,Uo.exports=function(n,a){for(var u,c=n.length,f=a^c,y=0;c>=4;)u=1540483477*(65535&(u=255&n.charCodeAt(y)|(255&n.charCodeAt(++y))<<8|(255&n.charCodeAt(++y))<<16|(255&n.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),c-=4,++y;switch(c){case 3:f^=(255&n.charCodeAt(y+2))<<16;case 2:f^=(255&n.charCodeAt(y+1))<<8;case 1:f=1540483477*(65535&(f^=255&n.charCodeAt(y)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Uo.exports);return Zi.exports=o,Zi.exports.murmur3=o,Zi.exports.murmur2=e,Zi.exports}(),ro=G(So);class Eo{constructor(e,...n){jr(this,n[0]||{}),this.type=e}}class Ku extends Eo{constructor(e,n={}){super("error",jr({error:e},n))}}function sf(o,e,n){n[o]&&n[o].indexOf(e)!==-1||(n[o]=n[o]||[],n[o].push(e))}function _a(o,e,n){if(n&&n[o]){const a=n[o].indexOf(e);a!==-1&&n[o].splice(a,1)}}class ga{on(e,n){return this._listeners=this._listeners||{},sf(e,n,this._listeners),this}off(e,n){return _a(e,n,this._listeners),_a(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},sf(e,n,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,n){const a=typeof e=="string"?new Eo(e,n):e,u=a.type;if(this.listens(u)){a.target=this;const c=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of c)b.call(this,a);const f=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of f)_a(u,b,this._oneTimeListeners),b.call(this,a);const y=this._eventedParent;y&&(jr(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(a))}else a instanceof Ku&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}class Ts{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Ts(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[n,a]=e.split("");return new Ts({name:n,iconsetId:a})}static isEqual(e,n){return e.name===n.name&&e.iconsetId===n.iconsetId}toString(){return Ts.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ym,Ss={},of=function(){if(Ym)return Ss;Ym=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(c){return(c=Math.round(c))<0?0:c>255?255:c}function n(c){return e(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function a(c){return(f=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:f>1?1:f;var f}function u(c,f,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?c+(f-c)*y*6:2*y<1?f:3*y<2?c+(f-c)*(2/3-y)*6:c}try{Ss.parseCSSColor=function(c){var f,y=c.replace(/ /g,"").toLowerCase();if(y in o)return o[y].slice();if(y[0]==="#")return y.length===4?(f=parseInt(y.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:y.length===7&&(f=parseInt(y.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var b=y.indexOf("("),S=y.indexOf(")");if(b!==-1&&S+1===y.length){var _=y.substr(0,b),w=y.substr(b+1,S-(b+1)).split(","),M=1;switch(_){case"rgba":if(w.length!==4)return null;M=a(w.pop());case"rgb":return w.length!==3?null:[n(w[0]),n(w[1]),n(w[2]),M];case"hsla":if(w.length!==4)return null;M=a(w.pop());case"hsl":if(w.length!==3)return null;var T=(parseFloat(w[0])%360+360)%360/360,E=a(w[1]),C=a(w[2]),O=C<=.5?C*(E+1):C+E-C*E,k=2*C-O;return[e(255*u(k,O,T+1/3)),e(255*u(k,O,T)),e(255*u(k,O,T-1/3)),M];default:return null}}return null}}catch{}return Ss}();class nn{constructor(e,n,a,u=1){this.r=e,this.g=n,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof nn)return e;if(typeof e!="string")return;const n=of.parseCSSColor(e);return n?new nn(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toStringPremultipliedAlpha(){const[e,n,a,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(a)},${u})`}toString(){const[e,n,a,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*n)},${Math.round(255*a)},${u})`}toRenderColor(e){const{r:n,g:a,b:u,a:c}=this;return new Fc(e,n,a,u,c)}clone(){return new nn(this.r,this.g,this.b,this.a)}}class Fc{constructor(e,n,a,u,c){if(e){const f=e.image.height,y=f*f;n=c===0?0:n/c*(f-1),a=c===0?0:a/c*(f-1),u=c===0?0:u/c*(f-1);const b=Math.floor(n),S=Math.floor(a),_=Math.floor(u),w=Math.ceil(n),M=Math.ceil(a),T=Math.ceil(u),E=n-b,C=a-S,O=u-_,k=e.image.data,U=4*(b+S*y+_*f),V=4*(b+S*y+T*f),N=4*(b+M*y+_*f),$=4*(b+M*y+T*f),Z=4*(w+S*y+_*f),K=4*(w+S*y+T*f),ae=4*(w+M*y+_*f),ie=4*(w+M*y+T*f);if(U<0||ie>=k.length)throw new Error("out of range");this.r=ar(ar(ar(k[U],k[V],O),ar(k[N],k[$],O),C),ar(ar(k[Z],k[K],O),ar(k[ae],k[ie],O),C),E)/255*c,this.g=ar(ar(ar(k[U+1],k[V+1],O),ar(k[N+1],k[$+1],O),C),ar(ar(k[Z+1],k[K+1],O),ar(k[ae+1],k[ie+1],O),C),E)/255*c,this.b=ar(ar(ar(k[U+2],k[V+2],O),ar(k[N+2],k[$+2],O),C),ar(ar(k[Z+2],k[K+2],O),ar(k[ae+2],k[ie+2],O),C),E)/255*c,this.a=c}else this.r=n,this.g=a,this.b=u,this.a=c}toArray(){const{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*n/u,255*a/u,u]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:n,b:a,a:u}=this,c=Math.min(Math.max(e/u,0),1),f=Math.min(Math.max(n/u,0),1),y=Math.min(Math.max(a/u,0),1),b=Math.min(c,f,y),S=Math.max(c,f,y),_=(b+S)/2;if(b===S)return[0,0,100*_,u];const w=S-b,M=_>.5?w/(2-S-b):w/(S+b);let T=0;return S===c?T=(f-y)/w+(f<y?6:0):S===f?T=(y-c)/w+2:S===y&&(T=(c-f)/w+4),T*=60,[Math.min(Math.max(T,0),360),Math.min(Math.max(100*M,0),100),Math.min(Math.max(100*_,0),100),u]}toArray01(){const{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,n/u,a/u,u]}toArray01Scaled(e){const{r:n,g:a,b:u,a:c}=this;return c===0?[0,0,0]:[n/c*e,a/c*e,u/c*e]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:a,a:u}=this;return[e,n,a,u]}toArray01Linear(){const{r:e,g:n,b:a,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(n/u,2.2),Math.pow(a/u,2.2),u]}}function ar(o,e,n){return o*(1-n)+e*n}function Jm(o,e,n){return o.map((a,u)=>ar(a,e[u],n))}function af(o){return o*o*o*o*o}nn.black=new nn(0,0,0,1),nn.white=new nn(1,1,1,1),nn.transparent=new nn(0,0,0,0),nn.red=new nn(1,0,0,1),nn.blue=new nn(0,0,1,1);var Xr=Object.freeze({__proto__:null,array:Jm,color:function(o,e,n){return new nn(ar(o.r,e.r,n),ar(o.g,e.g,n),ar(o.b,e.b,n),ar(o.a,e.a,n))},easeIn:af,number:ar});function Yu(o,...e){for(const n of e)for(const a in n)o[a]=n[a];return o}class Hs extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class lf{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[a,u]of n)this.bindings[a]=u}concat(e){return new lf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Sl={kind:"null"},Ht={kind:"number"},sn={kind:"string"},Kr={kind:"boolean"},ss={kind:"color"},Wa={kind:"object"},Hr={kind:"value"},Ju={kind:"collator"},jo={kind:"formatted"},Za={kind:"resolvedImage"};function Di(o,e){return{kind:"array",itemType:o,N:e}}function Mn(o){if(o.kind==="array"){const e=Mn(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const Qm=[Sl,Ht,sn,Kr,ss,jo,Wa,Di(Hr),Za];function Bc(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Bc(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const n of Qm)if(!Bc(n,e))return null}}return`Expected ${Mn(o)} but found ${Mn(e)} instead.`}function Qu(o,e){return e.some(n=>n.kind===o.kind)}function El(o,e){return e.some(n=>n==="null"?o===null:n==="array"?Array.isArray(o):n==="object"?o&&!Array.isArray(o)&&typeof o=="object":n===typeof o)}class eh{constructor(e,n,a){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Nc{constructor(e,n,a,u,c){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=a,this.fontStack=u,this.textColor=c}}class $i{constructor(e){this.sections=e}static fromString(e){return new $i([new Nc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof $i?e:$i.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){const u=n.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(n.text);const a={};n.fontStack&&(a["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(a["font-scale"]=n.scale),n.textColor&&(a["text-color"]=["rgba"].concat(n.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class Ao{constructor(e,n={}){if(this.id=Ts.from(e),this.options=Object.assign({},n),n.transform){const{a,b:u,c,d:f,e:y,f:b}=n.transform;this.options.transform=new DOMMatrix([a,u,c,f,y,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:n,c:a,d:u,e:c,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:n,c:a,d:u,e:c,f}})}static parse(e){let n,a,u,c;try{({name:n,iconsetId:a,params:u,transform:c}=JSON.parse(e)||{})}catch{return null}if(!n)return null;const{a:f,b:y,c:b,d:S,e:_,f:w}=c||{};return new Ao({name:n,iconsetId:a},{params:u,transform:new DOMMatrix([f,y,b,S,_,w])})}scaleSelf(e){return this.options.transform.scaleSelf(e),this}}class Mi{constructor(e,n,a,u,c=!1){this.primaryId=Ts.from(e),this.primaryOptions=n,a&&(this.secondaryId=Ts.from(a)),this.secondaryOptions=u,this.available=c}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ao(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ao(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Mi.build({name:e}):e}static build(e,n,a,u){return!e||typeof e=="object"&&!("name"in e)?null:new Mi(e,a,n,u)}}function Xa(o,e,n,a){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[o,e,n,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[o,e,n,a]:[o,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ka(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof nn||o instanceof eh||o instanceof $i||o instanceof Mi)return!0;if(Array.isArray(o)){for(const e of o)if(!Ka(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!Ka(o[e]))return!1;return!0}return!1}function Fn(o){if(o===null)return Sl;if(typeof o=="string")return sn;if(typeof o=="boolean")return Kr;if(typeof o=="number")return Ht;if(o instanceof nn)return ss;if(o instanceof eh)return Ju;if(o instanceof $i)return jo;if(o instanceof Mi)return Za;if(Array.isArray(o)){const e=o.length;let n;for(const a of o){const u=Fn(a);if(n){if(n===u)continue;n=Hr;break}n=u}return Di(n||Hr,e)}return Wa}function no(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof nn?o.toStringPremultipliedAlpha():o instanceof $i||o instanceof Mi?o.toString():JSON.stringify(o)}class io{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ka(e[1]))return n.error("invalid value");const a=e[1];let u=Fn(a);const c=n.expectedType;return u.kind!=="array"||u.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(u=c),new io(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof nn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof $i?this.value.serialize():this.value}}class li{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Vc={string:sn,number:Ht,boolean:Kr,object:Wa};class qs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let a,u=1;const c=e[0];if(c==="array"){let y,b;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in Vc)||S==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);y=Vc[S],u++}else y=Hr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}a=Di(y,b)}else a=Vc[c];const f=[];for(;u<e.length;u++){const y=n.parse(e[u],u,Hr);if(!y)return null;f.push(y)}return new qs(a,f)}evaluate(e){for(let n=0;n<this.args.length;n++){const a=this.args[n].evaluate(e);if(!Bc(this.type,Fn(a)))return a;if(n===this.args.length-1)throw new li(`The expression ${JSON.stringify(this.args[n].serialize())} evaluated to ${Mn(Fn(a))} but was expected to be of type ${Mn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){n.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(a=>a.serialize()))}}class $o{constructor(e){this.type=jo,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return n.error("First argument must be an image or text section.");const u=[];let c=!1;for(let f=1;f<=e.length-1;++f){const y=e[f];if(c&&typeof y=="object"&&!Array.isArray(y)){c=!1;let b=null;if(y["font-scale"]&&(b=n.parseObjectValue(y["font-scale"],f,"font-scale",Ht),!b))return null;let S=null;if(y["text-font"]&&(S=n.parseObjectValue(y["text-font"],f,"text-font",Di(sn)),!S))return null;let _=null;if(y["text-color"]&&(_=n.parseObjectValue(y["text-color"],f,"text-color",ss),!_))return null;const w=u[u.length-1];w.scale=b,w.font=S,w.textColor=_}else{const b=n.parse(e[f],f,Hr);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new $o(u)}evaluate(e){return new $i(this.sections.map(n=>{const a=n.content.evaluate(e);return Fn(a)===Za?new Nc("",a,null,null,null):new Nc(no(a),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const a={};n.scale&&(a["font-scale"]=n.scale.serialize()),n.font&&(a["text-font"]=n.font.serialize()),n.textColor&&(a["text-color"]=n.textColor.serialize()),e.push(a)}return e}}class Al{constructor(e,n,a,u){this._imageWarnHistory={},this.type=Za,this.namePrimary=e,this.nameSecondary=n,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let a=1;const u=[];function c(){if(a<e.length){const y=n.parse(e[a],a++,sn);return y?(u.push({image:y,options:{}}),!0):(n.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(a<e.length){const b=e[a];if((y=b)===null||typeof y!="object"||Array.isArray(y))return!0;const S=b.params,_=b.iconset,w=n.concat(a);if(!S&&!_)return a++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return w.error('Image options "params" should be an object'),!1;const M={},T=w.concat(void 0,"params");for(const E in S){if(!E)return T.error("Image parameter name should be non-empty"),!1;const C=T.concat(void 0,E).parse(S[E],void 0,ss,void 0,{typeAnnotation:"coerce"});if(!C)return!1;M[E]=C}u[u.length-1].options.params=M}if(_){if(typeof _!="object"||_.constructor!==Object)return w.error('Image options "iconset" should be an object'),!1;if(!_.id)return w.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=_}return a++,!0}var y;return!0}for(let y=0;y<2;y++)if(!c()||!f())return;return new Al(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,n){const a={};if(n){for(const u in n)if(n[u])try{a[u]=n[u].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const n={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=Mi.build(n,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const c=u.getPrimary().id;if(u.available=e.availableImages.some(f=>Ts.isEqual(f,c)),u.available){const f=u.getSecondary()?u.getSecondary().id:null;f&&(u.available=e.availableImages.some(y=>Ts.isEqual(y,f)))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const n in this.paramsPrimary)this.paramsPrimary[n]&&e(this.paramsPrimary[n]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const n in this.paramsSecondary)this.paramsSecondary[n]&&e(this.paramsSecondary[n])}outputDefined(){return!1}serializeOptions(e,n){const a={};if(n&&(a.iconset={id:n}),e){a.params={};for(const u in e)e[u]&&(a.params[u]=e[u].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const n=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);n&&e.push(n)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const n=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);n&&e.push(n)}return e}}function Ya(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}const h0={"to-boolean":Kr,"to-color":ss,"to-number":Ht,"to-string":sn};class Go{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const a=e[0],u=[];let c=Sl;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);c=Di(n.expectedType.itemType,f)}else{if(!(f>0&&Ka(e[1][0])))return null;c=Di(Fn(e[1][0]),f)}for(let y=0;y<f;y++){const b=e[1][y];let S;if(Ya(b)==="array")S=n.parse(b,void 0,c.itemType);else{const _=Ya(b);if(_!==c.itemType.kind)return n.error(`Expected ${c.itemType.kind} but found ${_}.`);S=n.registry.literal.parse(["literal",b===void 0?null:b],n)}if(!S)return null;u.push(S)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return n.error("Expected one argument.");c=h0[a];for(let f=1;f<e.length;f++){const y=n.parse(e[f],f,Hr);if(!y)return null;u.push(y)}}return new Go(c,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,a;for(const u of this.args){if(n=u.evaluate(e),a=null,n instanceof nn)return n;if(typeof n=="string"){const c=e.parseColor(n);if(c)return c}else if(Array.isArray(n)&&(a=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Xa(n[0],n[1],n[2],n[3]),!a))return new nn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new li(a||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(const a of this.args){if(n=a.evaluate(e),n===null)return 0;const u=Number(n);if(!isNaN(u))return u}throw new li(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?$i.fromString(no(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Mi.build(no(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):no(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new $o([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Al(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}const e_=["Unknown","Point","LineString","Polygon"];class Uc{constructor(e,n){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=n}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?e_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*n-e[0])+this.featureDistanceData.bearing[1]*(u*n-e[1])}return 0}parseColor(e){let n=this._parseColorCache[e];return n||(n=this._parseColorCache[e]=nn.parse(e)),n}getConfig(e){return this.options?this.options.get(e):null}}class os{constructor(e,n,a,u,c){this.name=e,this.type=n,this._evaluate=a,this.args=u,this._overloadIndex=c}evaluate(e){if(!this._evaluate){const n=os.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const a=e[0],u=os.definitions[a];if(!u)return n.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(u)?u[0]:u.type,f=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=[];let b=null,S=-1;for(const[_,w]of f){if(Array.isArray(_)&&_.length!==e.length-1)continue;y.push(_),S++,b=new gf(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);const M=[];let T=!1;for(let E=1;E<e.length;E++){const C=e[E],O=Array.isArray(_)?_[E-1]:_.type,k=b.parse(C,1+M.length,O);if(!k){T=!0;break}M.push(k)}if(!T)if(Array.isArray(_)&&_.length!==M.length)b.error(`Expected ${_.length} arguments, but found ${M.length} instead.`);else{for(let E=0;E<M.length;E++){const C=Array.isArray(_)?_[E]:_.type,O=M[E];b.concat(E+1).checkSubtype(C,O.type)}if(b.errors.length===0)return new os(a,c,w,M,S)}}if(y.length===1)n.errors.push(...b.errors);else{const _=(y.length?y:f.map(([M])=>M)).map(th).join(" | "),w=[];for(let M=1;M<e.length;M++){const T=n.parse(e[M],1+w.length);if(!T)return null;w.push(Mn(T.type))}n.error(`Expected arguments of type ${_}, but found (${w.join(", ")}) instead.`)}return null}static register(e,n){os.definitions=n;for(const a in n)e[a]=os}}function th(o){return Array.isArray(o)?`(${o.map(Mn).join(", ")})`:`(${Mn(o.type)}...)`}class rh{constructor(e,n,a){this.type=Ju,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return n.error("Collator options argument must be an object.");const u=a["case-sensitive"]===void 0?n.parse(!1,1,Kr):n.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Kr);if(!u)return null;const c=a["diacritic-sensitive"]===void 0?n.parse(!1,1,Kr):n.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Kr);if(!c)return null;let f=null;return a.locale&&(f=n.parseObjectValue(a.locale,1,"locale",sn),!f)?null:new rh(u,c,f)}evaluate(e){return new eh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function t_(o,e,n=0,a=o.length-1,u=d0){for(;a>n;){if(a-n>600){const b=a-n+1,S=e-n+1,_=Math.log(b),w=.5*Math.exp(2*_/3),M=.5*Math.sqrt(_*w*(b-w)/b)*(S-b/2<0?-1:1);t_(o,e,Math.max(n,Math.floor(e-S*w/b+M)),Math.min(a,Math.floor(e+(b-S)*w/b+M)),u)}const c=o[e];let f=n,y=a;for(jc(o,n,e),u(o[a],c)>0&&jc(o,n,a);f<y;){for(jc(o,f,y),f++,y--;u(o[f],c)<0;)f++;for(;u(o[y],c)>0;)y--}u(o[n],c)===0?jc(o,n,y):(y++,jc(o,y,a)),y<=e&&(n=y+1),e<=y&&(a=y-1)}}function jc(o,e,n){const a=o[e];o[e]=o[n],o[n]=a}function d0(o,e){return o<e?-1:o>e?1:0}function f0(o){let e=0;for(let n,a,u=0,c=o.length,f=c-1;u<c;f=u++)n=o[u],a=o[f],e+=(a.x-n.x)*(n.y+a.y);return e}function $c(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function Gc(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function r_(o,e,n){const a=o[0]-e[0],u=o[1]-e[1],c=o[0]-n[0],f=o[1]-n[1];return a*f-c*u==0&&a*c<=0&&u*f<=0}function so(o,e,n=!1){let a=!1;for(let y=0,b=e.length;y<b;y++){const S=e[y];for(let _=0,w=S.length,M=w-1;_<w;M=_++){const T=S[M],E=S[_];if(r_(o,T,E))return n;(c=T)[1]>(u=o)[1]!=(f=E)[1]>u[1]&&u[0]<(f[0]-c[0])*(u[1]-c[1])/(f[1]-c[1])+c[0]&&(a=!a)}}var u,c,f;return a}function n_(o,e,n,a){const u=a[0]-n[0],c=a[1]-n[1],f=(o[0]-n[0])*c-u*(o[1]-n[1]),y=(e[0]-n[0])*c-u*(e[1]-n[1]);return f>0&&y<0||f<0&&y>0}function nh(o,e,n,a){return(u=[a[0]-n[0],a[1]-n[1]])[0]*(c=[e[0]-o[0],e[1]-o[1]])[1]-u[1]*c[0]!=0&&!(!n_(o,e,n,a)||!n_(n,a,o,e));var u,c}const Mo=8192;function p0(o,e){const n=(180+o[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*Mo),Math.round(a*u*Mo)]}function m0(o,e){for(let n=0;n<e.length;n++)if(so(o,e[n]))return!0;return!1}function _0(o,e,n){for(const a of n)for(let u=0,c=a.length,f=c-1;u<c;f=u++)if(nh(o,e,a[f],a[u]))return!0;return!1}function i_(o,e){for(let n=0;n<o.length;++n)if(!so(o[n],e))return!1;for(let n=0;n<o.length-1;++n)if(_0(o[n],o[n+1],e))return!1;return!0}function Ml(o,e){for(let n=0;n<e.length;n++)if(i_(o,e[n]))return!0;return!1}function Dr(o,e,n){const a=[];for(let u=0;u<o.length;u++){const c=[];for(let f=0;f<o[u].length;f++){const y=p0(o[u][f],n);$c(e,y),c.push(y)}a.push(c)}return a}function Xt(o,e,n){const a=[];for(let u=0;u<o.length;u++){const c=Dr(o[u],e,n);a.push(c)}return a}function ih(o,e,n,a){if(o[0]<n[0]||o[0]>n[2]){const u=.5*a;let c=o[0]-n[0]>u?-a:n[0]-o[0]>u?a:0;c===0&&(c=o[0]-n[2]>u?-a:n[2]-o[0]>u?a:0),o[0]+=c}$c(e,o)}function br(o,e,n,a){const u=Math.pow(2,a.z)*Mo,c=[a.x*Mo,a.y*Mo],f=[];if(!o)return f;for(const y of o)for(const b of y){const S=[b.x+c[0],b.y+c[1]];ih(S,e,n,u),f.push(S)}return f}function sh(o,e,n,a){const u=Math.pow(2,a.z)*Mo,c=[a.x*Mo,a.y*Mo],f=[];if(!o)return f;for(const b of o){const S=[];for(const _ of b){const w=[_.x+c[0],_.y+c[1]];$c(e,w),S.push(w)}f.push(S)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of f)for(const S of b)ih(S,e,n,u)}var y;return f}class Ho{constructor(e,n){this.type=Kr,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ka(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const c=a.features[u].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Ho(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ho(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new Ho(a,a)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,a){const u=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if(a.type==="Polygon"){const y=Dr(a.coordinates,c,f),b=br(n.geometry(),u,c,f);if(!Gc(u,c))return!1;for(const S of b)if(!so(S,y))return!1}if(a.type==="MultiPolygon"){const y=Xt(a.coordinates,c,f),b=br(n.geometry(),u,c,f);if(!Gc(u,c))return!1;for(const S of b)if(!m0(S,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,a){const u=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],f=n.canonicalID();if(!f)return!1;if(a.type==="Polygon"){const y=Dr(a.coordinates,c,f),b=sh(n.geometry(),u,c,f);if(!Gc(u,c))return!1;for(const S of b)if(!i_(S,y))return!1}if(a.type==="MultiPolygon"){const y=Xt(a.coordinates,c,f),b=sh(n.geometry(),u,c,f);if(!Gc(u,c))return!1;for(const S of b)if(!Ml(S,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const fr={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},cf=1/298.257223563,oh=cf*(2-cf),Il=Math.PI/180;class Cl{static fromTile(e,n,a){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,n)),c=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Il;return new Cl(c,a)}static get units(){return fr}constructor(e,n){if(e===void 0)throw new Error("No latitude given.");if(n&&!fr[n])throw new Error(`Unknown unit ${n}. Use one of: ${Object.keys(fr).join(", ")}`);const a=6378.137*Il*(n?fr[n]:1),u=Math.cos(e*Il),c=1/(1-oh*(1-u*u)),f=Math.sqrt(c);this.kx=a*f*u,this.ky=a*f*c*(1-oh)}distance(e,n){const a=as(e[0]-n[0])*this.kx,u=(e[1]-n[1])*this.ky;return Math.sqrt(a*a+u*u)}bearing(e,n){const a=as(n[0]-e[0])*this.kx;return Math.atan2(a,(n[1]-e[1])*this.ky)/Il}destination(e,n,a){const u=a*Il;return this.offset(e,Math.sin(u)*n,Math.cos(u)*n)}offset(e,n,a){return[e[0]+n/this.kx,e[1]+a/this.ky]}lineDistance(e){let n=0;for(let a=0;a<e.length-1;a++)n+=this.distance(e[a],e[a+1]);return n}area(e){let n=0;for(let a=0;a<e.length;a++){const u=e[a];for(let c=0,f=u.length,y=f-1;c<f;y=c++)n+=as(u[c][0]-u[y][0])*(u[c][1]+u[y][1])*(a?-1:1)}return Math.abs(n)/2*this.kx*this.ky}along(e,n){let a=0;if(n<=0)return e[0];for(let u=0;u<e.length-1;u++){const c=e[u],f=e[u+1],y=this.distance(c,f);if(a+=y,a>n)return zi(c,f,(n-(a-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,n,a){let[u,c]=n,f=as(a[0]-u)*this.kx,y=(a[1]-c)*this.ky;if(f!==0||y!==0){const b=(as(e[0]-u)*this.kx*f+(e[1]-c)*this.ky*y)/(f*f+y*y);b>1?(u=a[0],c=a[1]):b>0&&(u+=f/this.kx*b,c+=y/this.ky*b)}return f=as(e[0]-u)*this.kx,y=(e[1]-c)*this.ky,Math.sqrt(f*f+y*y)}pointOnLine(e,n){let a=1/0,u=e[0][0],c=e[0][1],f=0,y=0;for(let b=0;b<e.length-1;b++){let S=e[b][0],_=e[b][1],w=as(e[b+1][0]-S)*this.kx,M=(e[b+1][1]-_)*this.ky,T=0;w===0&&M===0||(T=(as(n[0]-S)*this.kx*w+(n[1]-_)*this.ky*M)/(w*w+M*M),T>1?(S=e[b+1][0],_=e[b+1][1]):T>0&&(S+=w/this.kx*T,_+=M/this.ky*T)),w=as(n[0]-S)*this.kx,M=(n[1]-_)*this.ky;const E=w*w+M*M;E<a&&(a=E,u=S,c=_,f=b,y=T)}return{point:[u,c],index:f,t:Math.max(0,Math.min(1,y))}}lineSlice(e,n,a){let u=this.pointOnLine(a,e),c=this.pointOnLine(a,n);if(u.index>c.index||u.index===c.index&&u.t>c.t){const S=u;u=c,c=S}const f=[u.point],y=u.index+1,b=c.index;!Hc(a[y],f[0])&&y<=b&&f.push(a[y]);for(let S=y+1;S<=b;S++)f.push(a[S]);return Hc(a[b],c.point)||f.push(c.point),f}lineSliceAlong(e,n,a){let u=0;const c=[];for(let f=0;f<a.length-1;f++){const y=a[f],b=a[f+1],S=this.distance(y,b);if(u+=S,u>e&&c.length===0&&c.push(zi(y,b,(e-(u-S))/S)),u>=n)return c.push(zi(y,b,(n-(u-S))/S)),c;u>e&&c.push(b)}return c}bufferPoint(e,n){const a=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-a,e[0]+u,e[1]+a]}bufferBBox(e,n){const a=n/this.ky,u=n/this.kx;return[e[0]-u,e[1]-a,e[2]+u,e[3]+a]}insideBBox(e,n){return as(e[0]-n[0])>=0&&as(e[0]-n[2])<=0&&e[1]>=n[1]&&e[1]<=n[3]}}function Hc(o,e){return o[0]===e[0]&&o[1]===e[1]}function zi(o,e,n){const a=as(e[0]-o[0]);return[o[0]+a*n,o[1]+(e[1]-o[1])*n]}function as(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class qo{constructor(e=[],n=(a,u)=>a<u?-1:a>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:a}=this,u=n[e];for(;e>0;){const c=e-1>>1,f=n[c];if(a(u,f)>=0)break;n[e]=f,e=c}n[e]=u}_down(e){const{data:n,compare:a}=this,u=this.length>>1,c=n[e];for(;e<u;){let f=1+(e<<1);const y=f+1;if(y<this.length&&a(n[y],n[f])<0&&(f=y),a(n[f],c)>=0)break;n[e]=n[f],e=f}n[e]=c}}var Ct=8192;function ya(o,e){return e.dist-o.dist}const Li=100,uf=50;function s_(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==o[n])return!1;return!0}function ah(o){return o[1]-o[0]+1}function Ws(o,e){const n=o[1]>=o[0]&&o[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function lh(o,e){if(o[0]>o[1])return[null,null];const n=ah(o);if(e){if(n===2)return[o,null];const a=Math.floor(n/2);return[[o[0],o[0]+a],[o[0]+a,o[1]]]}{if(n===1)return[o,null];const a=Math.floor(n/2)-1;return[[o[0],o[0]+a],[o[0]+a+1,o[1]]]}}function Wo(o,e){const n=[1/0,1/0,-1/0,-1/0];if(!Ws(e,o.length))return n;for(let a=e[0];a<=e[1];++a)$c(n,o[a]);return n}function ch(o){const e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<o.length;++n)for(let a=0;a<o[n].length;++a)$c(e,o[n][a]);return e}function Pl(o,e,n){if(s_(o)||s_(e))return NaN;let a=0,u=0;return o[2]<e[0]&&(a=e[0]-o[2]),o[0]>e[2]&&(a=o[0]-e[2]),o[1]>e[3]&&(u=o[1]-e[3]),o[3]<e[1]&&(u=e[1]-o[3]),n.distance([0,0],[a,u])}function g0(o){return 360*o-180}function y0(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function uh(o,e){const n=Math.pow(2,e.z),a=(o.y/Ct+e.y)/n;return[g0((o.x/Ct+e.x)/n),y0(a)]}function v0(o,e){const n=[];for(let a=0;a<o.length;++a)n.push(uh(o[a],e));return n}function o_(o,e,n){const a=n.pointOnLine(e,o).point;return n.distance(o,a)}function hf(o,e,n,a,u){const c=n.slice(a[0],a[1]+1);let f=1/0;for(let y=e[0];y<=e[1];++y)if((f=Math.min(f,o_(o[y],c,u)))===0)return 0;return f}function df(o,e,n,a,u){const c=Math.min(u.pointToSegmentDistance(o,n,a),u.pointToSegmentDistance(e,n,a)),f=Math.min(u.pointToSegmentDistance(n,o,e),u.pointToSegmentDistance(a,o,e));return Math.min(c,f)}function Ja(o,e,n,a,u){if(!Ws(e,o.length)||!Ws(a,n.length))return NaN;let c=1/0;for(let f=e[0];f<e[1];++f)for(let y=a[0];y<a[1];++y){if(nh(o[f],o[f+1],n[y],n[y+1]))return 0;c=Math.min(c,df(o[f],o[f+1],n[y],n[y+1],u))}return c}function x0(o,e,n,a,u){if(!Ws(e,o.length)||!Ws(a,n.length))return NaN;let c=1/0;for(let f=e[0];f<=e[1];++f)for(let y=a[0];y<=a[1];++y)if((c=Math.min(c,u.distance(o[f],n[y])))===0)return c;return c}function b0(o,e,n){if(so(o,e,!0))return 0;let a=1/0;for(const u of e){const c=u.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[c-1]&&(a=Math.min(a,n.pointToSegmentDistance(o,u[c-1],u[0])))===0||(a=Math.min(a,o_(o,u,n)))===0)return a}return a}function ff(o,e,n,a){if(!Ws(e,o.length))return NaN;for(let c=e[0];c<=e[1];++c)if(so(o[c],n,!0))return 0;let u=1/0;for(let c=e[0];c<e[1];++c)for(const f of n)for(let y=0,b=f.length,S=b-1;y<b;S=y++){if(nh(o[c],o[c+1],f[S],f[y]))return 0;u=Math.min(u,df(o[c],o[c+1],f[S],f[y],a))}return u}function pf(o,e){for(const n of o)for(let a=0;a<=n.length-1;++a)if(so(n[a],e,!0))return!0;return!1}function a_(o,e,n,a=1/0){const u=ch(o),c=ch(e);if(a!==1/0&&Pl(u,c,n)>=a)return a;if(Gc(u,c)){if(pf(o,e))return 0}else if(pf(e,o))return 0;let f=a;for(const y of o)for(let b=0,S=y.length,_=S-1;b<S;_=b++)for(const w of e)for(let M=0,T=w.length,E=T-1;M<T;E=M++){if(nh(y[_],y[b],w[E],w[M]))return 0;f=Math.min(f,df(y[_],y[b],w[E],w[M],n))}return f}function ls(o,e,n,a,u,c,f){if(c===null||f===null)return;const y=Pl(Wo(a,c),Wo(u,f),n);y<e&&o.push({dist:y,range1:c,range2:f})}function l_(o,e,n,a,u=1/0){let c=Math.min(a.distance(o[0],n[0][0]),u);if(c===0)return c;const f=new qo([{dist:0,range1:[0,o.length-1],range2:[0,0]}],ya),y=e?uf:Li,b=ch(n);for(;f.length;){const S=f.pop();if(S.dist>=c)continue;const _=S.range1;if(ah(_)<=y){if(!Ws(_,o.length))return NaN;if(e){const w=ff(o,_,n,a);if((c=Math.min(c,w))===0)return c}else for(let w=_[0];w<=_[1];++w){const M=b0(o[w],n,a);if((c=Math.min(c,M))===0)return c}}else{const w=lh(_,e);if(w[0]!==null){const M=Pl(Wo(o,w[0]),b,a);M<c&&f.push({dist:M,range1:w[0],range2:[0,0]})}if(w[1]!==null){const M=Pl(Wo(o,w[1]),b,a);M<c&&f.push({dist:M,range1:w[1],range2:[0,0]})}}}return c}function mf(o,e,n,a,u,c=1/0){let f=Math.min(c,u.distance(o[0],n[0]));if(f===0)return f;const y=new qo([{dist:0,range1:[0,o.length-1],range2:[0,n.length-1]}],ya),b=e?uf:Li,S=a?uf:Li;for(;y.length;){const _=y.pop();if(_.dist>=f)continue;const w=_.range1,M=_.range2;if(ah(w)<=b&&ah(M)<=S){if(!Ws(w,o.length)||!Ws(M,n.length))return NaN;if(e&&a?f=Math.min(f,Ja(o,w,n,M,u)):e||a?e&&!a?f=Math.min(f,hf(n,M,o,w,u)):!e&&a&&(f=Math.min(f,hf(o,w,n,M,u))):f=Math.min(f,x0(o,w,n,M,u)),f===0)return f}else{const T=lh(w,e),E=lh(M,a);ls(y,f,u,o,n,T[0],E[0]),ls(y,f,u,o,n,T[0],E[1]),ls(y,f,u,o,n,T[1],E[0]),ls(y,f,u,o,n,T[1],E[1])}}return f}function hh(o,e,n,a,u=1/0){let c=u;const f=Wo(o,[0,o.length-1]);for(const y of n)if(!(c!==1/0&&Pl(f,Wo(y,[0,y.length-1]),a)>=c)&&(c=Math.min(c,mf(o,e,y,!0,a,c)),c===0))return c;return c}function qc(o,e,n,a,u=1/0){let c=u;const f=Wo(o,[0,o.length-1]);for(const y of n){if(c!==1/0&&Pl(f,ch(y),a)>=c)continue;const b=l_(o,e,y,a,c);if(isNaN(b))return b;if((c=Math.min(c,b))===0)return c}return c}function dh(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class va{constructor(e,n){this.type=Ht,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ka(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let u=0;u<a.features.length;++u)if(dh(a.features[u].geometry.type))return new va(a,a.features[u].geometry)}else if(a.type==="Feature"){if(dh(a.geometry.type))return new va(a,a.geometry)}else if(dh(a.type))return new va(a,a)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const n=e.geometry(),a=e.canonicalID();if(n!=null&&a!=null){if(e.geometryType()==="Point")return function(u,c,f){const y=[];for(const S of u)for(const _ of S)y.push(uh(_,c));const b=new Cl(y[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?mf(y,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",b):f.type==="MultiLineString"?hh(y,!1,f.coordinates,b):f.type==="Polygon"||f.type==="MultiPolygon"?qc(y,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,b):null}(n,a,this.geometries);if(e.geometryType()==="LineString")return function(u,c,f){const y=[];for(const S of u){const _=[];for(const w of S)_.push(uh(w,c));y.push(_)}const b=new Cl(y[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return hh(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y,b);if(f.type==="MultiLineString"){let S=1/0;for(let _=0;_<f.coordinates.length;_++){const w=hh(f.coordinates[_],!0,y,b,S);if(isNaN(w))return w;if((S=Math.min(S,w))===0)return S}return S}if(f.type==="Polygon"||f.type==="MultiPolygon"){let S=1/0;for(let _=0;_<y.length;_++){const w=qc(y[_],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,b,S);if(isNaN(w))return w;if((S=Math.min(S,w))===0)return S}return S}return null}(n,a,this.geometries);if(e.geometryType()==="Polygon")return function(u,c,f){const y=[];for(const S of function(_,w){const M=_.length;if(M<=1)return[_];const T=[];let E,C;for(let O=0;O<M;O++){const k=f0(_[O]);k!==0&&(_[O].area=Math.abs(k),C===void 0&&(C=k<0),C===k<0?(E&&T.push(E),E=[_[O]]):E.push(_[O]))}return E&&T.push(E),T}(u)){const _=[];for(let w=0;w<S.length;++w)_.push(v0(S[w],c));y.push(_)}const b=new Cl(y[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return qc(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y,b);if(f.type==="MultiLineString"){let S=1/0;for(let _=0;_<f.coordinates.length;_++){const w=qc(f.coordinates[_],!0,y,b,S);if(isNaN(w))return w;if((S=Math.min(S,w))===0)return S}return S}return f.type==="Polygon"||f.type==="MultiPolygon"?function(S,_,w){let M=1/0;for(const T of S)for(const E of _){const C=a_(T,E,w,M);if(isNaN(C))return C;if((M=Math.min(M,C))===0)return M}return M}(f.type==="Polygon"?[f.coordinates]:f.coordinates,y,b):null}(n,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function fh(o,e){switch(o){case"string":return no(e);case"number":return+e;case"boolean":return!!e;case"color":return nn.parse(e);case"formatted":return $i.fromString(no(e));case"resolvedImage":return Mi.build(no(e))}return e}function _f(o,e,n,a){return a!==void 0&&(o=a*Math.round(o/a)),e!==void 0&&o<e&&(o=e),n!==void 0&&o>n&&(o=n),o}class Qa{constructor(e,n,a){this.type=e,this.key=n,this.scope=a}static parse(e,n){let a=n.expectedType;if(a==null&&(a=Hr),e.length<2||e.length>3)return n.error("Invalid number of arguments for 'config' expression.");const u=n.parse(e[1],1);if(!(u instanceof io))return n.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const c=n.parse(e[2],2);return c instanceof io?new Qa(a,no(u.value),no(c.value)):n.error("Scope of 'config' expression must be a string literal.")}return new Qa(a,no(u.value))}evaluate(e){const n=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(n);if(!a)return null;const{type:u,value:c,values:f,minValue:y,maxValue:b,stepValue:S}=a,_=a.default.evaluate(e);let w=_;if(c){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),w=c.evaluate(e),e.scope=M}return u&&(w=fh(u,w)),w===void 0||y===void 0&&b===void 0&&S===void 0||(typeof w=="number"?w=_f(w,y,b,S):Array.isArray(w)&&(w=w.map(M=>typeof M=="number"?_f(M,y,b,S):M))),c!==void 0&&w!==void 0&&f&&!f.includes(w)&&(w=_,u&&(w=fh(u,w))),(u&&u!==this.type||w!==void 0&&Fn(w)!==this.type)&&(w=fh(this.type.kind,w)),w}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Rl(o){if(o instanceof os&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Ho||o instanceof va)return!1;let e=!0;return o.eachChild(n=>{e&&!Rl(n)&&(e=!1)}),e}function Wc(o){if(o instanceof os&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(n=>{e&&!Wc(n)&&(e=!1)}),e}function el(o){if(o instanceof Qa)return new Set([o.key]);let e=new Set;return o.eachChild(n=>{e=new Set([...e,...el(n)])}),e}function Zo(o,e){if(o instanceof os&&e.indexOf(o.name)>=0)return!1;let n=!0;return o.eachChild(a=>{n&&!Zo(a,e)&&(n=!1)}),n}class tl{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const a=e[1];return n.scope.has(a)?new tl(a,n.scope.get(a)):n.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ph{constructor(e,n=[],a,u=new lf,c=[],f,y){this.registry=e,this.path=n,this.key=n.map(b=>typeof b=="string"?`['${b}']`:`[${b}]`).join(""),this.scope=u,this.errors=c,this.expectedType=a,this._scope=f,this.options=y}parse(e,n,a,u,c={}){return n||a?this.concat(n,null,a,u)._parse(e,c):this._parse(e,c)}parseObjectValue(e,n,a,u,c,f={}){return this.concat(n,a,u,c)._parse(e,f)}_parse(e,n){function a(u,c,f){return f==="assert"?new qs(c,[u]):f==="coerce"?new Go(c,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let c=u.parse(e,this);if(!c)return null;if(this.expectedType){const f=this.expectedType,y=c.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||y.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(f,y))return null}else c=a(c,f,n.typeAnnotation||"coerce");else c=a(c,f,n.typeAnnotation||"assert")}if(!(c instanceof io)&&c.type.kind!=="resolvedImage"&&mh(c)){const f=new Uc(this._scope,this.options);try{c=new io(c.type,c.evaluate(f))}catch(y){return this.error(y.message),null}}return c}return Go.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,a,u){let c=typeof e=="number"?this.path.concat(e):this.path;c=typeof n=="string"?c.concat(n):c;const f=u?this.scope.concat(u):this.scope;return new ph(this.registry,c,a||null,f,this.errors,this._scope,this.options)}error(e,...n){const a=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new Hs(a,e))}checkSubtype(e,n){const a=Bc(e,n);return a&&this.error(a),a}}var gf=ph;function mh(o){if(o instanceof tl)return mh(o.boundExpression);if(o instanceof os&&o.name==="error"||o instanceof rh||o instanceof Ho||o instanceof va||o instanceof Qa)return!1;const e=o instanceof Go||o instanceof qs;let n=!0;return o.eachChild(a=>{n=e?n&&mh(a):n&&a instanceof io}),!!n&&Rl(o)&&Zo(o,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Xo(o,e){const n=o.length-1;let a,u,c=0,f=n,y=0;for(;c<=f;)if(y=Math.floor((c+f)/2),a=o[y],u=o[y+1],a<=e){if(y===n||e<u)return y;c=y+1}else{if(!(a>e))throw new li("Input is not a number.");f=y-1}return 0}class kr{constructor(e,n,a){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,c]of a)this.labels.push(u),this.outputs.push(c)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const a=n.parse(e[1],1,Ht);if(!a)return null;const u=[];let c=null;n.expectedType&&n.expectedType.kind!=="value"&&(c=n.expectedType);for(let f=1;f<e.length;f+=2){const y=f===1?-1/0:e[f],b=e[f+1],S=f,_=f+1;if(typeof y!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(u.length&&u[u.length-1][0]>=y)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const w=n.parse(b,_,c);if(!w)return null;c=c||w.type,u.push([y,w])}return new kr(c,a,u)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return a[0].evaluate(e);const c=n.length;return u>=n[c-1]?a[c-1].evaluate(e):a[Xo(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}const c_=.95047,u_=1.08883,h_=4/29,rl=6/29,d_=3*rl*rl,Ln=rl*rl*rl,w0=Math.PI/180,T0=180/Math.PI;function yf(o){return o>Ln?Math.pow(o,1/3):o/d_+h_}function vf(o){return o>rl?o*o*o:d_*(o-h_)}function xf(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function bf(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function f_(o){const e=bf(o.r),n=bf(o.g),a=bf(o.b),u=yf((.4124564*e+.3575761*n+.1804375*a)/c_),c=yf((.2126729*e+.7151522*n+.072175*a)/1);return{l:116*c-16,a:500*(u-c),b:200*(c-yf((.0193339*e+.119192*n+.9503041*a)/u_)),alpha:o.a}}function p_(o){let e=(o.l+16)/116,n=isNaN(o.a)?e:e+o.a/500,a=isNaN(o.b)?e:e-o.b/200;return e=1*vf(e),n=c_*vf(n),a=u_*vf(a),new nn(xf(3.2404542*n-1.5371385*e-.4985314*a),xf(-.969266*n+1.8760108*e+.041556*a),xf(.0556434*n-.2040259*e+1.0572252*a),o.alpha)}function S0(o,e,n){const a=e-o;return o+n*(a>180||a<-180?a-360*Math.round(a/360):a)}const Zc={forward:f_,reverse:p_,interpolate:function(o,e,n){return{l:ar(o.l,e.l,n),a:ar(o.a,e.a,n),b:ar(o.b,e.b,n),alpha:ar(o.alpha,e.alpha,n)}}},Xc={forward:function(o){const{l:e,a:n,b:a}=f_(o),u=Math.atan2(a,n)*T0;return{h:u<0?u+360:u,c:Math.sqrt(n*n+a*a),l:e,alpha:o.a}},reverse:function(o){const e=o.h*w0,n=o.c;return p_({l:o.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:o.alpha})},interpolate:function(o,e,n){return{h:S0(o.h,e.h,n),c:ar(o.c,e.c,n),l:ar(o.l,e.l,n),alpha:ar(o.alpha,e.alpha,n)}}};var m_=Object.freeze({__proto__:null,hcl:Xc,lab:Zc});class Es{constructor(e,n,a,u,c){this.type=e,this.operator=n,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[f,y]of c)this.labels.push(f),this.outputs.push(y)}static interpolationFactor(e,n,a,u){let c=0;if(e.name==="exponential")c=wf(n,e.base,a,u);else if(e.name==="linear")c=wf(n,1,a,u);else if(e.name==="cubic-bezier"){const f=e.controlPoints;c=new ke(f[0],f[1],f[2],f[3]).solve(wf(n,1,a,u))}return c}static parse(e,n){let[a,u,c,...f]=e;if(!Array.isArray(u)||u.length===0)return n.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const S=u[1];if(typeof S!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:S}}else{if(u[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const S=u.slice(1);if(S.length!==4||S.some(_=>typeof _!="number"||_<0||_>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(c=n.parse(c,2,Ht),!c)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=ss:n.expectedType&&n.expectedType.kind!=="value"&&(b=n.expectedType);for(let S=0;S<f.length;S+=2){const _=f[S],w=f[S+1],M=S+3,T=S+4;if(typeof _!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(y.length&&y[y.length-1][0]>=_)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const E=n.parse(w,T,b);if(!E)return null;b=b||E.type,y.push([_,E])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Es(b,a,u,c,y):n.error(`Type ${Mn(b)} is not interpolatable.`)}evaluate(e){const n=this.labels,a=this.outputs;if(n.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return a[0].evaluate(e);const c=n.length;if(u>=n[c-1])return a[c-1].evaluate(e);const f=Xo(n,u),y=Es.interpolationFactor(this.interpolation,u,n[f],n[f+1]),b=a[f].evaluate(e),S=a[f+1].evaluate(e);return this.operator==="interpolate"?Xr[this.type.kind.toLowerCase()](b,S,y):this.operator==="interpolate-hcl"?Xc.reverse(Xc.interpolate(Xc.forward(b),Xc.forward(S),y)):Zc.reverse(Zc.interpolate(Zc.forward(b),Zc.forward(S),y))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const n=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)n.push(this.labels[a],this.outputs[a].serialize());return n}}function wf(o,e,n,a){const u=a-n,c=o-n;return u===0?0:e===1?c/u:(Math.pow(e,c)-1)/(Math.pow(e,u)-1)}class _h{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let a=null;const u=n.expectedType;u&&u.kind!=="value"&&(a=u);const c=[];for(const y of e.slice(1)){const b=n.parse(y,1+c.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,c.push(b)}const f=u&&c.some(y=>Bc(u,y.type));return new _h(f?Hr:a,c)}evaluate(e){let n,a=null,u=0;for(const c of this.args){if(u++,a=c.evaluate(e),a&&a instanceof Mi&&!a.available&&(n||(n=a),a=null,u===this.args.length))return n;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class gh{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let c=1;c<e.length-1;c+=2){const f=e[c];if(typeof f!="string")return n.error(`Expected string, but found ${typeof f} instead.`,c);if(/[^a-zA-Z0-9_]/.test(f))return n.error("Variable names must contain only alphanumeric characters or '_'.",c);const y=n.parse(e[c+1],c+1);if(!y)return null;a.push([f,y])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,a);return u?new gh(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,a]of this.bindings)e.push(n,a.serialize());return e.push(this.result.serialize()),e}}class Tf{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,Ht),u=n.parse(e[2],2,Di(n.expectedType||Hr));return a&&u?new Tf(u.type.itemType,a,u):null}evaluate(e){const n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new li(`Array index out of bounds: ${n} < 0.`);if(n>=a.length)throw new li(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n!==Math.floor(n))throw new li(`Array index must be an integer, but found ${n} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return a[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Sf{constructor(e,n,a){this.type=e,this.index=n,this.input=a}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,Ht),u=n.parse(e[2],2,Di(n.expectedType||Hr));return a&&u?new Sf(u.type.itemType,a,u):null}evaluate(e){const n=this.index.evaluate(e),a=this.input.evaluate(e);if(n<0)throw new li(`Array index out of bounds: ${n} < 0.`);if(n>a.length-1)throw new li(`Array index out of bounds: ${n} > ${a.length-1}.`);if(n===Math.floor(n))return a[n];const u=Math.floor(n),c=Math.ceil(n),f=a[u],y=a[c];if(typeof f!="number"||typeof y!="number")throw new li(`Cannot interpolate between non-number values at index ${n}.`);const b=n-u;return f*(1-b)+y*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Ef{constructor(e,n){this.type=Kr,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,Hr),u=n.parse(e[2],2,Hr);return a&&u?Qu(a.type,[Kr,sn,Ht,Sl,Hr])?new Ef(a,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(a.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!El(n,["boolean","string","number","null"]))throw new li(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(Fn(n))} instead.`);if(!El(a,["string","array"]))throw new li(`Expected second argument to be of type array or string, but found ${Mn(Fn(a))} instead.`);return a.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class yh{constructor(e,n,a){this.type=Ht,this.needle=e,this.haystack=n,this.fromIndex=a}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,Hr),u=n.parse(e[2],2,Hr);if(!a||!u)return null;if(!Qu(a.type,[Kr,sn,Ht,Sl,Hr]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(a.type)} instead`);if(e.length===4){const c=n.parse(e[3],3,Ht);return c?new yh(a,u,c):null}return new yh(a,u)}evaluate(e){const n=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!El(n,["boolean","string","number","null"]))throw new li(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(Fn(n))} instead.`);if(!El(a,["string","array"]))throw new li(`Expected second argument to be of type array or string, but found ${Mn(Fn(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(n,u)}return a.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Af{constructor(e,n,a,u,c,f){this.inputType=e,this.type=n,this.input=a,this.cases=u,this.outputs=c,this.otherwise=f}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let a,u;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);const c={},f=[];for(let S=2;S<e.length-1;S+=2){let _=e[S];const w=e[S+1];Array.isArray(_)||(_=[_]);const M=n.concat(S);if(_.length===0)return M.error("Expected at least one branch label.");for(const E of _){if(typeof E!="number"&&typeof E!="string")return M.error("Branch labels must be numbers or strings.");if(typeof E=="number"&&Math.abs(E)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof E=="number"&&Math.floor(E)!==E)return M.error("Numeric branch labels must be integer values.");if(a){if(M.checkSubtype(a,Fn(E)))return null}else a=Fn(E);if(c[String(E)]!==void 0)return M.error("Branch labels must be unique.");c[String(E)]=f.length}const T=n.parse(w,S,u);if(!T)return null;u=u||T.type,f.push(T)}const y=n.parse(e[1],1,Hr);if(!y)return null;const b=n.parse(e[e.length-1],e.length-1,u);return b?y.type.kind!=="value"&&n.concat(1).checkSubtype(a,y.type)?null:new Af(a,u,y,c,f,b):null}evaluate(e){const n=this.input.evaluate(e);return(Fn(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),a=[],u={};for(const f of n){const y=u[this.cases[f]];y===void 0?(u[this.cases[f]]=a.length,a.push([this.cases[f],[f]])):a[y][1].push(f)}const c=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,y]of a)e.push(y.length===1?c(y[0]):y.map(c)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class Mf{constructor(e,n,a){this.type=e,this.branches=n,this.otherwise=a}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let a;n.expectedType&&n.expectedType.kind!=="value"&&(a=n.expectedType);const u=[];for(let f=1;f<e.length-1;f+=2){const y=n.parse(e[f],f,Kr);if(!y)return null;const b=n.parse(e[f+1],f+1,a);if(!b)return null;u.push([y,b]),a=a||b.type}const c=n.parse(e[e.length-1],e.length-1,a);return c?new Mf(a,u,c):null}evaluate(e){for(const[n,a]of this.branches)if(n.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,a]of this.branches)e(n),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}class vh{constructor(e,n,a,u){this.type=e,this.input=n,this.beginIndex=a,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=n.parse(e[1],1,Hr),u=n.parse(e[2],2,Ht);if(!a||!u)return null;if(!Qu(a.type,[Di(Hr),sn,Hr]))return n.error(`Expected first argument to be of type array or string, but found ${Mn(a.type)} instead`);if(e.length===4){const c=n.parse(e[3],3,Ht);return c?new vh(a.type,a,u,c):null}return new vh(a.type,a,u)}evaluate(e){const n=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!El(n,["string","array"]))throw new li(`Expected first argument to be of type array or string, but found ${Mn(Fn(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return n.slice(a,u)}return n.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function __(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function g_(o,e,n,a){return a.compare(e,n)===0}function Dl(o,e,n){const a=o!=="=="&&o!=="!=";return class CI{constructor(c,f,y){this.type=Kr,this.lhs=c,this.rhs=f,this.collator=y,this.hasUntypedArgument=c.type.kind==="value"||f.type.kind==="value"}static parse(c,f){if(c.length!==3&&c.length!==4)return f.error("Expected two or three arguments.");const y=c[0];let b=f.parse(c[1],1,Hr);if(!b)return null;if(!__(y,b.type))return f.concat(1).error(`"${y}" comparisons are not supported for type '${Mn(b.type)}'.`);let S=f.parse(c[2],2,Hr);if(!S)return null;if(!__(y,S.type))return f.concat(2).error(`"${y}" comparisons are not supported for type '${Mn(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error(`Cannot compare types '${Mn(b.type)}' and '${Mn(S.type)}'.`);a&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new qs(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new qs(b.type,[S])));let _=null;if(c.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(_=f.parse(c[3],3,Ju),!_)return null}return new CI(b,S,_)}evaluate(c){const f=this.lhs.evaluate(c),y=this.rhs.evaluate(c);if(a&&this.hasUntypedArgument){const b=Fn(f),S=Fn(y);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new li(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Fn(f),S=Fn(y);if(b.kind!=="string"||S.kind!=="string")return e(c,f,y)}return this.collator?n(c,f,y,this.collator.evaluate(c)):e(c,f,y)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[o];return this.eachChild(f=>{c.push(f.serialize())}),c}}}const E0=Dl("==",function(o,e,n){return e===n},g_),A0=Dl("!=",function(o,e,n){return e!==n},function(o,e,n,a){return!g_(0,e,n,a)}),M0=Dl("<",function(o,e,n){return e<n},function(o,e,n,a){return a.compare(e,n)<0}),I0=Dl(">",function(o,e,n){return e>n},function(o,e,n,a){return a.compare(e,n)>0}),C0=Dl("<=",function(o,e,n){return e<=n},function(o,e,n,a){return a.compare(e,n)<=0}),If=Dl(">=",function(o,e,n){return e>=n},function(o,e,n,a){return a.compare(e,n)>=0});class Cf{constructor(e,n,a,u,c,f){this.type=sn,this.number=e,this.locale=n,this.currency=a,this.unit=u,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const a=n.parse(e[1],1,Ht);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let c=null;if(u.locale&&(c=n.parseObjectValue(u.locale,2,"locale",sn),!c))return null;let f=null;if(u.currency&&(f=n.parseObjectValue(u.currency,2,"currency",sn),!f))return null;let y=null;if(u.unit&&(y=n.parseObjectValue(u.unit,2,"unit",sn),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=n.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",Ht),!b))return null;let S=null;return u["max-fraction-digits"]&&(S=n.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",Ht),!S)?null:new Cf(a,c,f,y,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class xh{constructor(e){this.type=Ht,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=n.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Mn(a.type)} instead.`):new xh(a):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new li(`Expected value to be of type string or array, but found ${Mn(Fn(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function y_(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const zl={"==":E0,"!=":A0,">":I0,"<":M0,">=":If,"<=":C0,array:qs,at:Tf,"at-interpolated":Sf,boolean:qs,case:Mf,coalesce:_h,collator:rh,format:$o,image:Al,in:Ef,"index-of":yh,interpolate:Es,"interpolate-hcl":Es,"interpolate-lab":Es,length:xh,let:gh,literal:io,match:Af,number:qs,"number-format":Cf,object:qs,slice:vh,step:kr,string:qs,"to-boolean":Go,"to-color":Go,"to-number":Go,"to-string":Go,var:tl,within:Ho,distance:va,config:Qa};function v_(o,[e,n,a,u]){e=e.evaluate(o),n=n.evaluate(o),a=a.evaluate(o);const c=u?u.evaluate(o):1,f=Xa(e,n,a,c);if(f)throw new li(f);return new nn(e/255*c,n/255*c,a/255*c,c)}function Pf(o,[e,n,a,u]){e=e.evaluate(o),n=n.evaluate(o),a=a.evaluate(o);const c=u?u.evaluate(o):1,f=function(S,_,w,M){return typeof S=="number"&&S>=0&&S<=360?typeof _=="number"&&_>=0&&_<=100&&typeof w=="number"&&w>=0&&w<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[S,_,w,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[S,_,w,M]:[S,_,w]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[S,_,w,M]:[S,_,w]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,a,c);if(f)throw new li(f);const y=`hsla(${e}, ${n}%, ${a}%, ${c})`,b=nn.parse(y);if(!b)throw new li(`Failed to parse HSLA color: ${y}`);return b}function Rf(o,e){return o in e}function xa(o,e){const n=e[o];return n===void 0?null:n}function ba(o){return{type:o}}function Df(o){return{result:"success",value:o}}function wa(o){return{result:"error",value:o}}function Kc(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Ll(o){return o["property-type"]==="data-driven"}function x_(o){return Kc(o.expression,"measure-light")}function b_(o){return Kc(o.expression,"zoom")}function bh(o){return!!o.expression&&o.expression.interpolated}function wh(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function P0(o){return o}function w_(o,e){const n=e.type==="color",a=o.stops&&typeof o.stops[0][0]=="object",u=a||!(a||o.property!==void 0),c=o.type||(bh(e)?"exponential":"interval");if(n&&((o=Yu({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],nn.parse(S[1])])),o.default=nn.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!m_[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let f,y,b;if(c==="exponential")f=Jc;else if(c==="interval")f=S_;else if(c==="categorical"){f=T_,y=Object.create(null);for(const S of o.stops)y[S[0]]=S[1];b=typeof o.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);f=R0}if(a){const S={},_=[];for(let T=0;T<o.stops.length;T++){const E=o.stops[T],C=E[0].zoom;S[C]===void 0&&(S[C]={zoom:C,type:o.type,property:o.property,default:o.default,stops:[]},_.push(C)),S[C].stops.push([E[0].value,E[1]])}const w=[];for(const T of _)w.push([S[T].zoom,w_(S[T],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Es.interpolationFactor.bind(void 0,M),zoomStops:w.map(T=>T[0]),evaluate:({zoom:T},E)=>Jc({stops:w,base:o.base},e,T).evaluate(T,E)}}if(u){const S=c==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Es.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(_=>_[0]),evaluate:({zoom:_})=>f(o,e,_,y,b)}}return{kind:"source",evaluate(S,_){const w=_&&_.properties?_.properties[o.property]:void 0;return w===void 0?Yc(o.default,e.default):f(o,e,w,y,b)}}}function Yc(o,e,n){return o!==void 0?o:e!==void 0?e:n!==void 0?n:void 0}function T_(o,e,n,a,u){return Yc(typeof n===u?a[n]:void 0,o.default,e.default)}function S_(o,e,n){if(Ya(n)!=="number")return Yc(o.default,e.default);const a=o.stops.length;if(a===1||n<=o.stops[0][0])return o.stops[0][1];if(n>=o.stops[a-1][0])return o.stops[a-1][1];const u=Xo(o.stops.map(c=>c[0]),n);return o.stops[u][1]}function Jc(o,e,n){const a=o.base!==void 0?o.base:1;if(Ya(n)!=="number")return Yc(o.default,e.default);const u=o.stops.length;if(u===1||n<=o.stops[0][0])return o.stops[0][1];if(n>=o.stops[u-1][0])return o.stops[u-1][1];const c=Xo(o.stops.map(_=>_[0]),n),f=function(_,w,M,T){const E=T-M,C=_-M;return E===0?0:w===1?C/E:(Math.pow(w,C)-1)/(Math.pow(w,E)-1)}(n,a,o.stops[c][0],o.stops[c+1][0]),y=o.stops[c][1],b=o.stops[c+1][1];let S=Xr[e.type]||P0;if(o.colorSpace&&o.colorSpace!=="rgb"){const _=m_[o.colorSpace];S=(w,M)=>_.reverse(_.interpolate(_.forward(w),_.forward(M),f))}return typeof y.evaluate=="function"?{evaluate(..._){const w=y.evaluate.apply(void 0,_),M=b.evaluate.apply(void 0,_);if(w!==void 0&&M!==void 0)return S(w,M,f)}}:S(y,b,f)}function R0(o,e,n){return e.type==="color"?n=nn.parse(n):e.type==="formatted"?n=$i.fromString(n.toString()):e.type==="resolvedImage"?n=Mi.build(n.toString()):Ya(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Yc(n,o.default,e.default)}os.register(zl,{error:[{kind:"error"},[sn],(o,[e])=>{throw new li(e.evaluate(o))}],typeof:[sn,[Hr],(o,[e])=>Mn(Fn(e.evaluate(o)))],"to-rgba":[Di(Ht,4),[ss],(o,[e])=>e.evaluate(o).toRenderColor(null).toArray()],"to-hsla":[Di(Ht,4),[ss],(o,[e])=>e.evaluate(o).toRenderColor(null).toHslaArray()],rgb:[ss,[Ht,Ht,Ht],v_],rgba:[ss,[Ht,Ht,Ht,Ht],v_],hsl:[ss,[Ht,Ht,Ht],Pf],hsla:[ss,[Ht,Ht,Ht,Ht],Pf],has:{type:Kr,overloads:[[[sn],(o,[e])=>Rf(e.evaluate(o),o.properties())],[[sn,Wa],(o,[e,n])=>Rf(e.evaluate(o),n.evaluate(o))]]},get:{type:Hr,overloads:[[[sn],(o,[e])=>xa(e.evaluate(o),o.properties())],[[sn,Wa],(o,[e,n])=>xa(e.evaluate(o),n.evaluate(o))]]},"feature-state":[Hr,[sn],(o,[e])=>xa(e.evaluate(o),o.featureState||{})],properties:[Wa,[],o=>o.properties()],"geometry-type":[sn,[],o=>o.geometryType()],id:[Hr,[],o=>o.id()],zoom:[Ht,[],o=>o.globals.zoom],pitch:[Ht,[],o=>o.globals.pitch||0],"distance-from-center":[Ht,[],o=>o.distanceFromCenter()],"measure-light":[Ht,[sn],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[Ht,[],o=>o.globals.heatmapDensity||0],"line-progress":[Ht,[],o=>o.globals.lineProgress||0],"raster-value":[Ht,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[Ht,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ht,[],o=>o.globals.skyRadialProgress||0],accumulated:[Hr,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Ht,ba(Ht),(o,e)=>{let n=0;for(const a of e)n+=a.evaluate(o);return n}],"*":[Ht,ba(Ht),(o,e)=>{let n=1;for(const a of e)n*=a.evaluate(o);return n}],"-":{type:Ht,overloads:[[[Ht,Ht],(o,[e,n])=>e.evaluate(o)-n.evaluate(o)],[[Ht],(o,[e])=>-e.evaluate(o)]]},"/":[Ht,[Ht,Ht],(o,[e,n])=>e.evaluate(o)/n.evaluate(o)],"%":[Ht,[Ht,Ht],(o,[e,n])=>e.evaluate(o)%n.evaluate(o)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(o,[e,n])=>Math.pow(e.evaluate(o),n.evaluate(o))],sqrt:[Ht,[Ht],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[Ht,[Ht],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[Ht,[Ht],(o,[e])=>Math.log(e.evaluate(o))],log2:[Ht,[Ht],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[Ht,[Ht],(o,[e])=>Math.sin(e.evaluate(o))],cos:[Ht,[Ht],(o,[e])=>Math.cos(e.evaluate(o))],tan:[Ht,[Ht],(o,[e])=>Math.tan(e.evaluate(o))],asin:[Ht,[Ht],(o,[e])=>Math.asin(e.evaluate(o))],acos:[Ht,[Ht],(o,[e])=>Math.acos(e.evaluate(o))],atan:[Ht,[Ht],(o,[e])=>Math.atan(e.evaluate(o))],min:[Ht,ba(Ht),(o,e)=>Math.min(...e.map(n=>n.evaluate(o)))],max:[Ht,ba(Ht),(o,e)=>Math.max(...e.map(n=>n.evaluate(o)))],abs:[Ht,[Ht],(o,[e])=>Math.abs(e.evaluate(o))],round:[Ht,[Ht],(o,[e])=>{const n=e.evaluate(o);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ht,[Ht],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[Ht,[Ht],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[Kr,[sn,Hr],(o,[e,n])=>o.properties()[e.value]===n.value],"filter-id-==":[Kr,[Hr],(o,[e])=>o.id()===e.value],"filter-type-==":[Kr,[sn],(o,[e])=>o.geometryType()===e.value],"filter-<":[Kr,[sn,Hr],(o,[e,n])=>{const a=o.properties()[e.value],u=n.value;return typeof a==typeof u&&a<u}],"filter-id-<":[Kr,[Hr],(o,[e])=>{const n=o.id(),a=e.value;return typeof n==typeof a&&n<a}],"filter->":[Kr,[sn,Hr],(o,[e,n])=>{const a=o.properties()[e.value],u=n.value;return typeof a==typeof u&&a>u}],"filter-id->":[Kr,[Hr],(o,[e])=>{const n=o.id(),a=e.value;return typeof n==typeof a&&n>a}],"filter-<=":[Kr,[sn,Hr],(o,[e,n])=>{const a=o.properties()[e.value],u=n.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[Kr,[Hr],(o,[e])=>{const n=o.id(),a=e.value;return typeof n==typeof a&&n<=a}],"filter->=":[Kr,[sn,Hr],(o,[e,n])=>{const a=o.properties()[e.value],u=n.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[Kr,[Hr],(o,[e])=>{const n=o.id(),a=e.value;return typeof n==typeof a&&n>=a}],"filter-has":[Kr,[Hr],(o,[e])=>e.value in o.properties()],"filter-has-id":[Kr,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Kr,[Di(sn)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[Kr,[Di(Hr)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[Kr,[sn,Di(Hr)],(o,[e,n])=>n.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[Kr,[sn,Di(Hr)],(o,[e,n])=>function(a,u,c,f){for(;c<=f;){const y=c+f>>1;if(u[y]===a)return!0;u[y]>a?f=y-1:c=y+1}return!1}(o.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Kr,overloads:[[[Kr,Kr],(o,[e,n])=>e.evaluate(o)&&n.evaluate(o)],[ba(Kr),(o,e)=>{for(const n of e)if(!n.evaluate(o))return!1;return!0}]]},any:{type:Kr,overloads:[[[Kr,Kr],(o,[e,n])=>e.evaluate(o)||n.evaluate(o)],[ba(Kr),(o,e)=>{for(const n of e)if(n.evaluate(o))return!0;return!1}]]},"!":[Kr,[Kr],(o,[e])=>!e.evaluate(o)],"is-supported-script":[Kr,[sn],(o,[e])=>{const n=o.globals&&o.globals.isSupportedScript;return!n||n(e.evaluate(o))}],upcase:[sn,[sn],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[sn,[sn],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[sn,ba(Hr),(o,e)=>e.map(n=>no(n.evaluate(o))).join("")],"resolved-locale":[sn,[Ju],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[Ht,[Ht,Ht,Hr],(o,e)=>{const[n,a,u]=e.map(f=>f.evaluate(o));if(n>a||n===a)return n;let c;if(typeof u=="string")c=function(f){let y=0;if(f.length===0)return y;for(let b=0;b<f.length;b++)y=(y<<5)-y+f.charCodeAt(b),y|=0;return y}(u);else{if(typeof u!="number")throw new li(`Invalid seed input: ${u}`);c=u}return n+y_(c)()*(a-n)}]});class Th{constructor(e,n,a,u){this.expression=e,this._warningHistory={},this._evaluator=new Uc(a,u),this._defaultValue=n?function(c){return c.type==="color"&&(wh(c.default)||Array.isArray(c.default))?new nn(0,0,0,0):c.type==="color"?nn.parse(c.default)||null:c.default===void 0?null:c.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this.configDependencies=el(e)}evaluateWithoutErrorHandling(e,n,a,u,c,f,y,b){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,a,u,c,f,y,b){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new li(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function zf(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in zl}function Ol(o,e,n,a){const u=new gf(zl,[],e?function(f){const y={color:ss,string:sn,number:Ht,enum:sn,boolean:Kr,formatted:jo,resolvedImage:Za};return f.type==="array"?Di(y[f.value]||Hr,f.length):y[f.type]}(e):void 0,void 0,void 0,n,a),c=u.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Df(new Th(c,e,n,a)):wa(u.errors)}class Sh{constructor(e,n,a,u){this.kind=e,this._styleExpression=n,this.isLightConstant=a,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!Wc(n.expression),this.configDependencies=el(n.expression)}evaluateWithoutErrorHandling(e,n,a,u,c,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,u,c,f)}evaluate(e,n,a,u,c,f){return this._styleExpression.evaluate(e,n,a,u,c,f)}}class kl{constructor(e,n,a,u,c,f){this.kind=e,this.zoomStops=a,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Wc(n.expression),this.isLightConstant=c,this.isLineProgressConstant=f,this.configDependencies=el(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,a,u,c,f){return this._styleExpression.evaluateWithoutErrorHandling(e,n,a,u,c,f)}evaluate(e,n,a,u,c,f){return this._styleExpression.evaluate(e,n,a,u,c,f)}interpolationFactor(e,n,a){return this.interpolationType?Es.interpolationFactor(this.interpolationType,e,n,a):0}}function E_(o,e,n,a){if((o=Ol(o,e,n,a)).result==="error")return o;const u=o.value.expression,c=Rl(u);if(!c&&!Ll(e))return wa([new Hs("","data expressions not supported")]);const f=Zo(u,["zoom","pitch","distance-from-center"]);if(!f&&!b_(e))return wa([new Hs("","zoom expressions not supported")]);const y=Zo(u,["measure-light"]);if(!y&&!x_(e))return wa([new Hs("","measure-light expression not supported")]);const b=Zo(u,["line-progress"]);if(!b&&!function(w){return Kc(w.expression,"line-progress")}(e))return wa([new Hs("","line-progress expression not supported")]);const S=e.expression&&e.expression.relaxZoomRestriction,_=Fl(u);return _||f||S?_ instanceof Hs?wa([_]):_ instanceof Es&&!bh(e)?wa([new Hs("",'"interpolate" expressions cannot be used with this property')]):Df(_?new kl(c&&b?"camera":"composite",o.value,_.labels,_ instanceof Es?_.interpolation:void 0,y,b):new Sh(c&&b?"constant":"source",o.value,y,b)):wa([new Hs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Eh{constructor(e,n){this._parameters=e,this._specification=n,Yu(this,w_(this._parameters,this._specification))}static deserialize(e){return new Eh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Fl(o){let e=null;if(o instanceof gh)e=Fl(o.result);else if(o instanceof _h){for(const n of o.args)if(e=Fl(n),e)break}else(o instanceof kr||o instanceof Es)&&o.input instanceof os&&o.input.name==="zoom"&&(e=o);return e instanceof Hs||o.eachChild(n=>{const a=Fl(n);a instanceof Hs?e=a:e&&a&&e!==a&&(e=new Hs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Lf,Of,D0=function(){if(Of)return Lf;Of=1,Lf=e;var o=3;function e(n,a,u){var c=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;var f=new Int32Array(this.arrayBuffer);n=f[0],this.d=(a=f[1])+2*(u=f[2]);for(var y=0;y<this.d*this.d;y++){var b=f[o+y],S=f[o+y+1];c.push(b===S?null:f.subarray(b,S))}var _=f[o+c.length+1];this.keys=f.subarray(f[o+c.length],_),this.bboxes=f.subarray(_),this.insert=this._insertReadonly}else{this.d=a+2*u;for(var w=0;w<this.d*this.d;w++)c.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=n,this.padding=u,this.scale=a/n,this.uid=0;var M=u/a*n;this.min=-M,this.max=n+M}return e.prototype.insert=function(n,a,u,c,f){this._forEachCell(a,u,c,f,this._insertCell,this.uid++),this.keys.push(n),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(n,a,u,c,f,y){this.cells[f].push(y)},e.prototype.query=function(n,a,u,c,f){var y=this.min,b=this.max;if(n<=y&&a<=y&&b<=u&&b<=c&&!f)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(n,a,u,c,this._queryCell,S,{},f),S},e.prototype._queryCell=function(n,a,u,c,f,y,b,S){var _=this.cells[f];if(_!==null)for(var w=this.keys,M=this.bboxes,T=0;T<_.length;T++){var E=_[T];if(b[E]===void 0){var C=4*E;(S?S(M[C+0],M[C+1],M[C+2],M[C+3]):n<=M[C+2]&&a<=M[C+3]&&u>=M[C+0]&&c>=M[C+1])?(b[E]=!0,y.push(w[E])):b[E]=!1}}},e.prototype._forEachCell=function(n,a,u,c,f,y,b,S){for(var _=this._convertToCellCoord(n),w=this._convertToCellCoord(a),M=this._convertToCellCoord(u),T=this._convertToCellCoord(c),E=_;E<=M;E++)for(var C=w;C<=T;C++){var O=this.d*C+E;if((!S||S(this._convertFromCellCoord(E),this._convertFromCellCoord(C),this._convertFromCellCoord(E+1),this._convertFromCellCoord(C+1)))&&f.call(this,n,a,u,c,O,y,b,S))return}},e.prototype._convertFromCellCoord=function(n){return(n-this.padding)/this.scale},e.prototype._convertToCellCoord=function(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var n=this.cells,a=o+this.cells.length+1+1,u=0,c=0;c<this.cells.length;c++)u+=this.cells[c].length;var f=new Int32Array(a+u+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var y=a,b=0;b<n.length;b++){var S=n[b];f[o+b]=y,f.set(S,y),y+=S.length}return f[o+n.length]=y,f.set(this.keys,y),f[o+n.length+1]=y+=this.keys.length,f.set(this.bboxes,y),y+=this.bboxes.length,f.buffer},Lf}(),Bl=G(D0);const Qc={};function Ft(o,e,n={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),Qc[e]={klass:o,omit:n.omit||[]}}Ft(Object,"Object"),Bl.serialize=function(o,e){const n=o.toArrayBuffer();return e&&e.add(n),{buffer:n}},Bl.deserialize=function(o){return new Bl(o.buffer)},Object.defineProperty(Bl,"name",{value:"Grid"}),Ft(Bl,"Grid"),typeof DOMMatrix<"u"&&Ft(DOMMatrix,"DOMMatrix"),Ft(nn,"Color"),Ft(Error,"Error"),Ft($i,"Formatted"),Ft(Nc,"FormattedSection"),Ft(ji,"AJAXError"),Ft(Mi,"ResolvedImage"),Ft(Eh,"StylePropertyFunction"),Ft(Th,"StyleExpression",{omit:["_evaluator"]}),Ft(Ts,"ImageId"),Ft(Ao,"ImageVariant"),Ft(kl,"ZoomDependentExpression"),Ft(Sh,"ZoomConstantExpression"),Ft(os,"CompoundExpression",{omit:["_evaluate"]});for(const o in zl)Qc[zl[o]._classRegistryKey]||Ft(zl[o],`Expression${o}`);function kf(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function A_(o){return self.ImageBitmap&&o instanceof ImageBitmap}function As(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(kf(o)||A_(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const n=[];for(const a of o)n.push(As(a,e));return n}if(o instanceof Map){const n={$name:"Map",entries:[]};for(const[a,u]of o.entries())n.entries.push(As(a),As(u));return n}if(o instanceof Set){const n={$name:"Set"};let a=0;for(const u of o.values())n[++a]=As(u);return n}if(o instanceof DOMMatrix){const n={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const u of a)n[u]=o[u];return n}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const n=o.constructor,a=n._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${n.name}".`);const u=n.serialize?n.serialize(o,e):{};if(!n.serialize){for(const c in o)o.hasOwnProperty(c)&&(Qc[a].omit.indexOf(c)>=0||(u[c]=As(o[c],e)));o instanceof Error&&(u.message=o.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof o)}function Ta(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||kf(o)||A_(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(Ta);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const u=o.entries||[],c=new Map;for(let f=0;f<u.length;f+=2)c.set(Ta(u[f]),Ta(u[f+1]));return c}if(e==="Set"){const u=new Set;for(const c of Object.keys(o))c!=="$name"&&u.add(Ta(o[c]));return u}if(e==="DOMMatrix"){let u;return u=o.is2D?[o.a,o.b,o.c,o.d,o.e,o.f]:[o.m11,o.m12,o.m13,o.m14,o.m21,o.m22,o.m23,o.m24,o.m31,o.m32,o.m33,o.m34,o.m41,o.m42,o.m43,o.m44],new DOMMatrix(u)}if(e==="BigInt")return BigInt(o.value);const{klass:n}=Qc[e];if(!n)throw new Error(`Can't deserialize unregistered class "${e}".`);if(n.deserialize)return n.deserialize(o);const a=Object.create(n.prototype);for(const u of Object.keys(o))u!=="$name"&&(a[u]=Ta(o[u]));return a}throw new Error("can't deserialize object of type "+typeof o)}const er={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function Ff(o){for(const e of o)if(Ah(e.charCodeAt(0)))return!0;return!1}function M_(o){for(const e of o)if(!I_(e.charCodeAt(0)))return!1;return!0}function I_(o){return!(er.Arabic(o)||er["Arabic Supplement"](o)||er["Arabic Extended-A"](o)||er["Arabic Presentation Forms-A"](o)||er["Arabic Presentation Forms-B"](o))}function Ah(o){return!(o!==746&&o!==747&&(o<4352||!(er["Bopomofo Extended"](o)||er.Bopomofo(o)||er["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||er["CJK Compatibility Ideographs"](o)||er["CJK Compatibility"](o)||er["CJK Radicals Supplement"](o)||er["CJK Strokes"](o)||!(!er["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||er["CJK Unified Ideographs Extension A"](o)||er["CJK Unified Ideographs"](o)||er["Enclosed CJK Letters and Months"](o)||er["Hangul Compatibility Jamo"](o)||er["Hangul Jamo Extended-A"](o)||er["Hangul Jamo Extended-B"](o)||er["Hangul Jamo"](o)||er["Hangul Syllables"](o)||er.Hiragana(o)||er["Ideographic Description Characters"](o)||er.Kanbun(o)||er["Kangxi Radicals"](o)||er["Katakana Phonetic Extensions"](o)||er.Katakana(o)&&o!==12540||!(!er["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!er["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||er["Unified Canadian Aboriginal Syllabics"](o)||er["Unified Canadian Aboriginal Syllabics Extended"](o)||er["Vertical Forms"](o)||er["Yijing Hexagram Symbols"](o)||er["Yi Syllables"](o)||er["Yi Radicals"](o))))}function Bf(o){return!(Ah(o)||function(e){return!!(er["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||er["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||er["Letterlike Symbols"](e)||er["Number Forms"](e)||er["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||er["Control Pictures"](e)&&e!==9251||er["Optical Character Recognition"](e)||er["Enclosed Alphanumerics"](e)||er["Geometric Shapes"](e)||er["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||er["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||er["CJK Symbols and Punctuation"](e)||er.Katakana(e)||er["Private Use Area"](e)||er["CJK Compatibility Forms"](e)||er["Small Form Variants"](e)||er["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(o))}function Nf(o){return er.Arabic(o)||er["Arabic Supplement"](o)||er["Arabic Extended-A"](o)||er["Arabic Presentation Forms-A"](o)||er["Arabic Presentation Forms-B"](o)}function Mh(o){return o>=1424&&o<=2303||er["Arabic Presentation Forms-A"](o)||er["Arabic Presentation Forms-B"](o)}function C_(o,e){return!(!e&&Mh(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||er.Khmer(o))}function z0(o){for(const e of o)if(Mh(e.charCodeAt(0)))return!0;return!1}const Io="deferred",Vf="loading",Uf="loaded";let Ih=null,cs="unavailable",oo=null;const jf=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(cs="error"),Ih&&Ih(o)};function Nl(){Ch.fire(new Eo("pluginStateChange",{pluginStatus:cs,pluginURL:oo}))}const Ch=new ga,$f=function(){return cs},P_=function(){if(cs!==Io||!oo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");cs=Vf,Nl(),oo&&qa({url:oo},o=>{o?jf(o):(cs=Uf,Nl())})},us={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>cs===Uf||us.applyArabicShaping!=null,isLoading:()=>cs===Vf,setState(o){cs=o.pluginStatus,oo=o.pluginURL},isParsed:()=>us.applyArabicShaping!=null&&us.processBidirectionalText!=null&&us.processStyledBidirectionalText!=null,getPluginURL:()=>oo};class bn{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,a){for(const u of n)if(!C_(u.charCodeAt(0),a))return!1;return!0}(e,us.isLoaded())}}class Ph{constructor(e,n,a,u){this.property=e,this.value=n,this.expression=function(c,f,y,b){if(wh(c))return new Eh(c,f);if(zf(c)||Array.isArray(c)&&c.length>0){const S=E_(c,f,y,b);if(S.result==="error")throw new Error(S.value.map(_=>`${_.key}: ${_.message}`).join(", "));return S.value}{let S=c;return typeof c=="string"&&f.type==="color"&&(S=nn.parse(c)),{kind:"constant",configDependencies:new Set,evaluate:()=>S}}}(n===void 0?e.specification.default:n,e.specification,a,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,a){return this.property.possiblyEvaluate(this,e,n,a)}}class Rh{constructor(e,n,a){this.property=e,this.value=new Ph(e,void 0,n,a)}transitioned(e,n){return new eu(this.property,this.value,n,jr({},e.transition,this.transition),e.now)}untransitioned(){return new eu(this.property,this.value,null,{},0)}}class Dh{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=a,this.configDependencies=new Set}getValue(e){return Jn(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Rh(this._values[e].property,this._scope,this._options)),this._values[e].value=new Ph(this._values[e].property,n===null?void 0:Jn(n),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,n){n&&(this._options=n);const a=this._properties.properties;if(e)for(const u in e){const c=e[u];if(u.endsWith("-transition")){const f=u.slice(0,-11);a[f]&&this.setTransition(f,c)}else a.hasOwnProperty(u)&&this.setValue(u,c)}}getTransition(e){return Jn(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Rh(this._values[e].property)),this._values[e].transition=Jn(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a);const u=this.getTransition(n);u!==void 0&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){const a=new nl(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,n._values[u]);return a}untransitioned(){const e=new nl(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class eu{constructor(e,n,a,u,c){const f=u.delay||0,y=u.duration||0;c=c||0,this.property=e,this.value=n,this.begin=c+f,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,n,a){const u=e.now||0,c=this.value.possiblyEvaluate(e,n,a),f=this.prior;if(f){if(u>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(u<this.begin)return f.possiblyEvaluate(e,n,a);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,n,a),c,Gt(y))}}return c}}class nl{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,a){const u=new Ul(this._properties);for(const c of Object.keys(this._values))u._values[c]=this._values[c].possiblyEvaluate(e,n,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class L0{constructor(e,n,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=a,this.configDependencies=new Set}getValue(e){return Jn(this._values[e].value)}setValue(e,n){this._values[e]=new Ph(this._values[e].property,n===null?void 0:Jn(n),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const n of Object.keys(this._values)){const a=this.getValue(n);a!==void 0&&(e[n]=a)}return e}possiblyEvaluate(e,n,a){const u=new Ul(this._properties);for(const c of Object.keys(this._values))u._values[c]=this._values[c].possiblyEvaluate(e,n,a);return u}}class Vl{constructor(e,n,a){this.property=e,this.value=n,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,a,u){return this.property.evaluate(this.value,this.parameters,e,n,a,u)}}class Ul{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Tt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,a){const u=Xr[this.specification.type];return u?u(e,n,a):e}}class kt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,a,u){return new Vl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},a,u)}:e.expression,n)}interpolate(e,n,a){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Vl(this,{kind:"constant",value:void 0},e.parameters);const u=Xr[this.specification.type];return u?new Vl(this,{kind:"constant",value:u(e.value.value,n.value.value,a)},e.parameters):e}evaluate(e,n,a,u,c,f){return e.kind==="constant"?e.value:e.evaluate(n,a,u,c,f)}}class il{constructor(e){this.specification=e}possiblyEvaluate(e,n,a,u){return!!e.expression.evaluate(n,null,{},a,u)}interpolate(){return!1}}class $n{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new bn(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const c=this.defaultPropertyValues[a]=new Ph(u,void 0),f=this.defaultTransitionablePropertyValues[a]=new Rh(u);this.defaultTransitioningPropertyValues[a]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=c.possiblyEvaluate(n)}}}Ft(kt,"DataDrivenProperty"),Ft(Tt,"DataConstantProperty"),Ft(il,"ColorRampProperty");var Ue=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function R_(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function zh(o){if(Array.isArray(o))return o.map(zh);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const n in o)e[n]=zh(o[n]);return e}return R_(o)}function Gf(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!Gf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Hf(o,e="",n=null,a="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Gf(o)||(o=Ko(o));const u=o;let c=!0;try{c=function(_){if(!jl(_))return _;let w=zh(_);return z_(w),w=D_(w),w}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let f=null,y=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){y=Ue[`filter_${a}`];const _=Ol(c,y,e,n);if(_.result==="error")throw new Error(_.value.map(w=>`${w.key}: ${w.message}`).join(", "));f=(w,M,T)=>_.value.evaluate(w,M,{},T)}let b=null,S=null;if(c!==u){const _=Ol(u,y,e,n);if(_.result==="error")throw new Error(_.value.map(w=>`${w.key}: ${w.message}`).join(", "));b=(w,M,T,E,C)=>_.value.evaluate(w,M,{},T,void 0,void 0,E,C),S=!Rl(_.value.expression)}return{filter:f,dynamicFilter:b||void 0,needGeometry:L_(c),needFeature:!!S}}function D_(o){if(!Array.isArray(o))return o;const e=function(n){if(O0.has(n[0])){for(let a=1;a<n.length;a++)if(jl(n[a]))return!0}return n}(o);return e===!0?e:e.map(n=>D_(n))}function z_(o){let e=!1;const n=[];if(o[0]==="case"){for(let a=1;a<o.length-1;a+=2)e=e||jl(o[a]),n.push(o[a+1]);n.push(o[o.length-1])}else if(o[0]==="match"){e=e||jl(o[1]);for(let a=2;a<o.length-1;a+=2)n.push(o[a+1]);n.push(o[o.length-1])}else if(o[0]==="step"){e=e||jl(o[1]);for(let a=1;a<o.length-1;a+=2)n.push(o[a+1])}e&&(o.length=0,o.push("any",...n));for(let a=1;a<o.length;a++)z_(o[a])}function jl(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<o.length;n++)if(jl(o[n]))return!0;return!1}const O0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function k0(o,e){return o<e?-1:o>e?1:0}function L_(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(L_(o[e]))return!0;return!1}function Ko(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?Lh(o[1],o[2],"=="):e==="!="?Oh(Lh(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Lh(o[1],o[2],e):e==="any"?(n=o.slice(1),["any"].concat(n.map(Ko))):e==="all"?["all"].concat(o.slice(1).map(Ko)):e==="none"?["all"].concat(o.slice(1).map(Ko).map(Oh)):e==="in"?qf(o[1],o.slice(2)):e==="!in"?Oh(qf(o[1],o.slice(2))):e==="has"?tu(o[1]):e!=="!has"||Oh(tu(o[1]));var n}function Lh(o,e,n){switch(o){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,o,e]}}function qf(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",o,["literal",e.sort(k0)]]:["filter-in-small",o,["literal",e]]}}function tu(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Oh(o){return["!",o]}const kh="";function Ms(o,e){return e?`${o}${kh}${e}`:o}const Wf="-transition",$l=new Set(["fill","line","background","hillshade","raster"]);class Qi extends ga{constructor(e,n,a,u,c){if(super(),this.id=e.id,this.fqid=Ms(this.id,a),this.type=e.type,this.scope=a,this.lut=u,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=Ol(this.filter,Ue[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new L0(n.layout,this.scope,c),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),n.paint){this._transitionablePaint=new Dh(n.paint,this.scope,c);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ul(n.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&$l.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n){if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Wf)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n){const a=this._transitionablePaint,u=a._properties.properties;if(e.endsWith(Wf)){const w=e.slice(0,-11);return u[w]&&a.setTransition(w,n||void 0),!1}if(!u[e])return!1;const c=a._values[e],f=c.value.isDataDriven(),y=c.value;a.setValue(e,n),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=a._values[e].value,S=b.isDataDriven(),_=e.endsWith("pattern")||e==="line-dasharray";return S||f||_||this._handleOverridablePaintPropertyUpdate(e,y,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n,a){return null}_handleOverridablePaintPropertyUpdate(e,n,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return wo({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}is3D(e){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Vl&&Ll(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Hf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,n,a,u,c,f,y,b,S){}}const F0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ru{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class En{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Jr(o,e=1){let n=0,a=0;return{members:o.map(u=>{const c=F0[u.type].BYTES_PER_ELEMENT,f=n=Zf(n,Math.max(e,c)),y=u.components||1;return a=Math.max(a,c),n+=c*y,{name:u.name,type:u.type,components:y,offset:f}}),size:Zf(n,Math.max(a,e)),alignment:e}}function Zf(o,e){return Math.ceil(o/e)*e}class Co extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=a,e}}Co.prototype.bytesPerElement=4,Ft(Co,"StructArrayLayout2i4");class sl extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const c=3*e;return this.int16[c+0]=n,this.int16[c+1]=a,this.int16[c+2]=u,e}}sl.prototype.bytesPerElement=6,Ft(sl,"StructArrayLayout3i6");class ol extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a,u)}emplace(e,n,a,u,c){const f=4*e;return this.int16[f+0]=n,this.int16[f+1]=a,this.int16[f+2]=u,this.int16[f+3]=c,e}}ol.prototype.bytesPerElement=8,Ft(ol,"StructArrayLayout4i8");class Sa extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Sa.prototype.bytesPerElement=4,Ft(Sa,"StructArrayLayout1f4");class Xf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const c=4*e,f=2*e;return this.int16[c+0]=n,this.int16[c+1]=a,this.float32[f+1]=u,e}}Xf.prototype.bytesPerElement=8,Ft(Xf,"StructArrayLayout2i1f8");class Zs extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const c=4*e;return this.int16[c+0]=n,this.int16[c+1]=a,this.int16[c+2]=u,e}}Zs.prototype.bytesPerElement=8,Ft(Zs,"StructArrayLayout3i8");class Kf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,u,c)}emplace(e,n,a,u,c,f){const y=5*e;return this.int16[y+0]=n,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=c,this.int16[y+4]=f,e}}Kf.prototype.bytesPerElement=10,Ft(Kf,"StructArrayLayout5i10");class Fh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,c,f,y)}emplace(e,n,a,u,c,f,y,b){const S=6*e,_=12*e,w=3*e;return this.int16[S+0]=n,this.int16[S+1]=a,this.uint8[_+4]=u,this.uint8[_+5]=c,this.uint8[_+6]=f,this.uint8[_+7]=y,this.float32[w+2]=b,e}}Fh.prototype.bytesPerElement=12,Ft(Fh,"StructArrayLayout2i4ub1f12");class Po extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const c=3*e;return this.float32[c+0]=n,this.float32[c+1]=a,this.float32[c+2]=u,e}}Po.prototype.bytesPerElement=12,Ft(Po,"StructArrayLayout3f12");class Ea extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,u,c)}emplace(e,n,a,u,c,f){const y=6*e,b=3*e;return this.uint16[y+0]=n,this.uint16[y+1]=a,this.uint16[y+2]=u,this.uint16[y+3]=c,this.float32[b+2]=f,e}}Ea.prototype.bytesPerElement=12,Ft(Ea,"StructArrayLayout4ui1f12");class Bh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a,u)}emplace(e,n,a,u,c){const f=4*e;return this.uint16[f+0]=n,this.uint16[f+1]=a,this.uint16[f+2]=u,this.uint16[f+3]=c,e}}Bh.prototype.bytesPerElement=8,Ft(Bh,"StructArrayLayout4ui8");class Nh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,c,f)}emplace(e,n,a,u,c,f,y){const b=6*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+3]=c,this.int16[b+4]=f,this.int16[b+5]=y,e}}Nh.prototype.bytesPerElement=12,Ft(Nh,"StructArrayLayout6i12");class Yf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y,b,S,_,w,M){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,a,u,c,f,y,b,S,_,w,M)}emplace(e,n,a,u,c,f,y,b,S,_,w,M,T){const E=12*e;return this.int16[E+0]=n,this.int16[E+1]=a,this.int16[E+2]=u,this.int16[E+3]=c,this.uint16[E+4]=f,this.uint16[E+5]=y,this.uint16[E+6]=b,this.uint16[E+7]=S,this.int16[E+8]=_,this.int16[E+9]=w,this.int16[E+10]=M,this.int16[E+11]=T,e}}Yf.prototype.bytesPerElement=24,Ft(Yf,"StructArrayLayout4i4ui4i24");class Jf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,c,f)}emplace(e,n,a,u,c,f,y){const b=10*e,S=5*e;return this.int16[b+0]=n,this.int16[b+1]=a,this.int16[b+2]=u,this.float32[S+2]=c,this.float32[S+3]=f,this.float32[S+4]=y,e}}Jf.prototype.bytesPerElement=20,Ft(Jf,"StructArrayLayout3i3f20");class al extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a,u)}emplace(e,n,a,u,c){const f=4*e;return this.float32[f+0]=n,this.float32[f+1]=a,this.float32[f+2]=u,this.float32[f+3]=c,e}}al.prototype.bytesPerElement=16,Ft(al,"StructArrayLayout4f16");class Qf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Qf.prototype.bytesPerElement=4,Ft(Qf,"StructArrayLayout1ul4");class Aa extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=a,e}}Aa.prototype.bytesPerElement=4,Ft(Aa,"StructArrayLayout2ui4");class Vh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y,b,S,_,w,M,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,n,a,u,c,f,y,b,S,_,w,M,T)}emplace(e,n,a,u,c,f,y,b,S,_,w,M,T,E){const C=20*e,O=10*e;return this.int16[C+0]=n,this.int16[C+1]=a,this.int16[C+2]=u,this.int16[C+3]=c,this.int16[C+4]=f,this.float32[O+3]=y,this.float32[O+4]=b,this.float32[O+5]=S,this.float32[O+6]=_,this.int16[C+14]=w,this.uint32[O+8]=M,this.uint16[C+18]=T,this.uint16[C+19]=E,e}}Vh.prototype.bytesPerElement=40,Ft(Vh,"StructArrayLayout5i4f1i1ul2ui40");class Uh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,c,f,y)}emplace(e,n,a,u,c,f,y,b){const S=8*e;return this.int16[S+0]=n,this.int16[S+1]=a,this.int16[S+2]=u,this.int16[S+4]=c,this.int16[S+5]=f,this.int16[S+6]=y,this.int16[S+7]=b,e}}Uh.prototype.bytesPerElement=16,Ft(Uh,"StructArrayLayout3i2i2i16");class ep extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,u,c)}emplace(e,n,a,u,c,f){const y=4*e,b=8*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=u,this.int16[b+6]=c,this.int16[b+7]=f,e}}ep.prototype.bytesPerElement=16,Ft(ep,"StructArrayLayout2f1f2i16");class tp extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,a,u,c,f)}emplace(e,n,a,u,c,f,y){const b=20*e,S=5*e;return this.uint8[b+0]=n,this.uint8[b+1]=a,this.float32[S+1]=u,this.float32[S+2]=c,this.float32[S+3]=f,this.float32[S+4]=y,e}}tp.prototype.bytesPerElement=20,Ft(tp,"StructArrayLayout2ub4f20");class wi extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,a)}emplace(e,n,a,u){const c=3*e;return this.uint16[c+0]=n,this.uint16[c+1]=a,this.uint16[c+2]=u,e}}wi.prototype.bytesPerElement=6,Ft(wi,"StructArrayLayout3ui6");class jh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$)}emplace(e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$,Z){const K=30*e,ae=15*e,ie=60*e;return this.int16[K+0]=n,this.int16[K+1]=a,this.int16[K+2]=u,this.float32[ae+2]=c,this.float32[ae+3]=f,this.uint16[K+8]=y,this.uint16[K+9]=b,this.uint32[ae+5]=S,this.uint32[ae+6]=_,this.uint32[ae+7]=w,this.uint16[K+16]=M,this.uint16[K+17]=T,this.uint16[K+18]=E,this.float32[ae+10]=C,this.float32[ae+11]=O,this.uint8[ie+48]=k,this.uint8[ie+49]=U,this.uint8[ie+50]=V,this.uint32[ae+13]=N,this.int16[K+28]=$,this.uint8[ie+58]=Z,e}}jh.prototype.bytesPerElement=60,Ft(jh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ro extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$,Z,K,ae,ie,se,ve,le,xe,Me,Se,Pe,Ce){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$,Z,K,ae,ie,se,ve,le,xe,Me,Se,Pe,Ce)}emplace(e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$,Z,K,ae,ie,se,ve,le,xe,Me,Se,Pe,Ce,Fe){const Le=20*e,Ne=40*e,ot=80*e;return this.float32[Le+0]=n,this.float32[Le+1]=a,this.int16[Ne+4]=u,this.int16[Ne+5]=c,this.int16[Ne+6]=f,this.int16[Ne+7]=y,this.int16[Ne+8]=b,this.int16[Ne+9]=S,this.int16[Ne+10]=_,this.int16[Ne+11]=w,this.int16[Ne+12]=M,this.uint16[Ne+13]=T,this.uint16[Ne+14]=E,this.uint16[Ne+15]=C,this.uint16[Ne+16]=O,this.uint16[Ne+17]=k,this.uint16[Ne+18]=U,this.uint16[Ne+19]=V,this.uint16[Ne+20]=N,this.uint16[Ne+21]=$,this.uint16[Ne+22]=Z,this.uint16[Ne+23]=K,this.uint16[Ne+24]=ae,this.uint16[Ne+25]=ie,this.uint16[Ne+26]=se,this.uint16[Ne+27]=ve,this.uint32[Le+14]=le,this.float32[Le+15]=xe,this.float32[Le+16]=Me,this.float32[Le+17]=Se,this.float32[Le+18]=Pe,this.uint8[ot+76]=Ce,this.uint16[Ne+39]=Fe,e}}Ro.prototype.bytesPerElement=80,Ft(Ro,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Ma extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,a,u,c)}emplace(e,n,a,u,c,f){const y=5*e;return this.float32[y+0]=n,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=c,this.float32[y+4]=f,e}}Ma.prototype.bytesPerElement=20,Ft(Ma,"StructArrayLayout5f20");class rp extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,c,f,y)}emplace(e,n,a,u,c,f,y,b){const S=7*e;return this.float32[S+0]=n,this.float32[S+1]=a,this.float32[S+2]=u,this.float32[S+3]=c,this.float32[S+4]=f,this.float32[S+5]=y,this.float32[S+6]=b,e}}rp.prototype.bytesPerElement=28,Ft(rp,"StructArrayLayout7f28");class np extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y,b,S,_,w){const M=this.length;return this.resize(M+1),this.emplace(M,e,n,a,u,c,f,y,b,S,_,w)}emplace(e,n,a,u,c,f,y,b,S,_,w,M){const T=11*e;return this.float32[T+0]=n,this.float32[T+1]=a,this.float32[T+2]=u,this.float32[T+3]=c,this.float32[T+4]=f,this.float32[T+5]=y,this.float32[T+6]=b,this.float32[T+7]=S,this.float32[T+8]=_,this.float32[T+9]=w,this.float32[T+10]=M,e}}np.prototype.bytesPerElement=44,Ft(np,"StructArrayLayout11f44");class ip extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y,b,S){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,a,u,c,f,y,b,S)}emplace(e,n,a,u,c,f,y,b,S,_){const w=9*e;return this.float32[w+0]=n,this.float32[w+1]=a,this.float32[w+2]=u,this.float32[w+3]=c,this.float32[w+4]=f,this.float32[w+5]=y,this.float32[w+6]=b,this.float32[w+7]=S,this.float32[w+8]=_,e}}ip.prototype.bytesPerElement=36,Ft(ip,"StructArrayLayout9f36");class Ia extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,n)}emplace(e,n,a){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=a,e}}Ia.prototype.bytesPerElement=8,Ft(Ia,"StructArrayLayout2f8");class $h extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,n,a,u)}emplace(e,n,a,u,c){const f=6*e;return this.uint32[3*e+0]=n,this.uint16[f+2]=a,this.uint16[f+3]=u,this.uint16[f+4]=c,e}}$h.prototype.bytesPerElement=12,Ft($h,"StructArrayLayout1ul3ui12");class Gh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Gh.prototype.bytesPerElement=2,Ft(Gh,"StructArrayLayout1ui2");class sp extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O){const k=this.length;return this.resize(k+1),this.emplace(k,e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O)}emplace(e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k){const U=16*e;return this.float32[U+0]=n,this.float32[U+1]=a,this.float32[U+2]=u,this.float32[U+3]=c,this.float32[U+4]=f,this.float32[U+5]=y,this.float32[U+6]=b,this.float32[U+7]=S,this.float32[U+8]=_,this.float32[U+9]=w,this.float32[U+10]=M,this.float32[U+11]=T,this.float32[U+12]=E,this.float32[U+13]=C,this.float32[U+14]=O,this.float32[U+15]=k,e}}sp.prototype.bytesPerElement=64,Ft(sp,"StructArrayLayout16f64");class nu extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,a,u,c,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,a,u,c,f,y)}emplace(e,n,a,u,c,f,y,b){const S=10*e,_=5*e;return this.uint16[S+0]=n,this.uint16[S+1]=a,this.uint16[S+2]=u,this.uint16[S+3]=c,this.float32[_+2]=f,this.float32[_+3]=y,this.float32[_+4]=b,e}}nu.prototype.bytesPerElement=20,Ft(nu,"StructArrayLayout4ui3f20");class op extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.int16[1*e+0]=n,e}}op.prototype.bytesPerElement=2,Ft(op,"StructArrayLayout1i2");class Hh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Hh.prototype.bytesPerElement=1,Ft(Hh,"StructArrayLayout1ub1");class iu extends ru{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}iu.prototype.size=40;class O_ extends Vh{get(e){return new iu(this,e)}}Ft(O_,"CollisionBoxArray");class k_ extends ru{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}k_.prototype.size=60;class F_ extends jh{get(e){return new k_(this,e)}}Ft(F_,"PlacedSymbolArray");class B_ extends ru{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}B_.prototype.size=80;class N_ extends Ro{get(e){return new B_(this,e)}}Ft(N_,"SymbolInstanceArray");class su extends Sa{getoffsetX(e){return this.float32[1*e+0]}}Ft(su,"GlyphOffsetArray");class ou extends Co{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ft(ou,"SymbolLineVertexArray");class hs extends ru{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}hs.prototype.size=12;class au extends $h{get(e){return new hs(this,e)}}Ft(au,"FeatureIndexArray");class V_ extends Aa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ft(V_,"FillExtrusionCentroidArray");class U_ extends ru{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}U_.prototype.size=6;class j_ extends sl{get(e){return new U_(this,e)}}Ft(j_,"FillExtrusionWallArray");const B0=Jr([{name:"a_pos",components:2,type:"Int16"}],4),ap=Jr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Gn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,a,u){let c=this.segments[this.segments.length-1];return e>Gn.MAX_VERTEX_ARRAY_LENGTH&&Rr(`Max vertices per segment is ${Gn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>Gn.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==u)&&(c={vertexOffset:n,primitiveOffset:a,vertexLength:0,primitiveLength:0},u!==void 0&&(c.sortKey=u),this.segments.push(c)),c}prepareSegment(e,n,a,u){return this._prepareSegment(e,n.length,a.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,a,u){return new Gn([{vertexOffset:e,primitiveOffset:n,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function qh(o,e){return 256*(o=Ye(Math.floor(o),0,255))+Ye(Math.floor(e),0,255)}Gn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ft(Gn,"SegmentVector");const N0=Jr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),V0=Jr([{name:"a_dash",components:4,type:"Uint16"}]);class Gl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,a,u){this.ids.push(Wh(e)),this.positions.push(n,a,u)}eachPosition(e,n){const a=Wh(e);let u=0,c=this.ids.length-1;for(;u<c;){const f=u+c>>1;this.ids[f]>=a?c=f:u=f+1}for(;this.ids[u]===a;)n(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,n){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return lp(a,u,0,a.length-1),n&&(n.add(a.buffer),n.add(u.buffer)),{ids:a,positions:u}}static deserialize(e){const n=new Gl;let a;n.ids=e.ids,n.positions=e.positions;for(const u of n.ids)u!==a&&n.uniqueIds.push(u),a=u;return n.indexed=!0,n}}function Wh(o){const e=+o;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ro(String(o))}function lp(o,e,n,a){for(;n<a;){const u=o[n+a>>1];let c=n-1,f=a+1;for(;;){do c++;while(o[c]<u);do f--;while(o[f]>u);if(c>=f)break;lu(o,c,f),lu(e,3*c,3*f),lu(e,3*c+1,3*f+1),lu(e,3*c+2,3*f+2)}f-n<a-f?(lp(o,e,n,f),n=f+1):(lp(o,e,f+1,a),a=f)}}function lu(o,e,n){const a=o[e];o[e]=o[n],o[n]=a}Ft(Gl,"FeaturePositionMap");class Do{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}set(e,n,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Zh extends Do{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class ei extends Do{constructor(e){super(e),this.current=0}set(e,n,a){this.fetchUniformLocation(e,n)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Is extends Do{constructor(e){super(e),this.current=[0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Xh extends Do{constructor(e){super(e),this.current=[0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Kh extends Do{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,a){this.fetchUniformLocation(e,n)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class cp extends Do{constructor(e){super(e),this.current=nn.transparent.toRenderColor(null)}set(e,n,a){this.fetchUniformLocation(e,n)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const U0=new Float32Array(16);class ll extends Do{constructor(e){super(e),this.current=U0}set(e,n,a){if(this.fetchUniformLocation(e,n)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const j0=new Float32Array(9),$0=new Float32Array(4);class up extends Do{constructor(e){super(e),this.current=$0}set(e,n,a){if(this.fetchUniformLocation(e,n)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function hp(o){return[qh(255*o.r,255*o.g),qh(255*o.b,255*o.a)]}class Hl{constructor(e,n,a,u){this.value=e,this.uniformNames=n.map(c=>`u_${c}`),this.type=a,this.context=u}setUniform(e,n,a,u,c){const f=u.constantOr(this.value);n.set(e,c,f instanceof nn?f.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,n){return this.type==="color"?new cp(e):new ei(e)}}class ql{constructor(e,n){this.uniformNames=n.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,a,u,c){const f=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;f&&n.set(e,c,f)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Kh(e):new ei(e)}}class Yo{constructor(e,n,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=n.map(c=>({name:`a_${c}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,a,u,c,f,y){const b=this.paintVertexArray.length,S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new bn(0,{brightness:f}),n,{},c,u,y):this.expression.kind==="constant"&&this.expression.value,_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bn(0,{brightness:f}),n,{},c,u,y):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(b,e,S,_?null:this.context.lut)}updatePaintArray(e,n,a,u,c,f,y){const b=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:y},a,u,void 0,c):this.expression.kind==="constant"&&this.expression.value,S=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bn(0,{brightness:y}),a,u,void 0,c):this.lutExpression.value)==="none";this._setPaintValue(e,n,b,S?null:this.context.lut)}_setPaintValue(e,n,a,u){if(this.type==="color"){const c=hp(a.toRenderColor(u));for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<n;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ao{constructor(e,n,a,u,c,f){this.expression=e,this.uniformNames=n.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=u,this.context=c,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,n,a,u,c,f,y){const b=this.expression.evaluate(new bn(this.context.zoom,{brightness:f}),n,{},c,u,y),S=this.expression.evaluate(new bn(this.context.zoom+1,{brightness:f}),n,{},c,u,y),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bn(0,{brightness:f}),n,{},c,u,y):this.lutExpression.value)==="none",w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,b,S,_?null:this.context.lut)}updatePaintArray(e,n,a,u,c,f,y){const b=this.expression.evaluate({zoom:this.context.zoom,brightness:y},a,u,void 0,c),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y},a,u,void 0,c),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bn(0,{brightness:y}),a,u,void 0,c):this.lutExpression.value)==="none";this._setPaintValue(e,n,b,S,_?null:this.context.lut)}_setPaintValue(e,n,a,u,c){if(this.type==="color"){const f=hp(a.toRenderColor(c)),y=hp(a.toRenderColor(c));for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,f[0],f[1],y[0],y[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,a,u,c){const f=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=Ye(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);n.set(e,c,y)}getBinding(e,n){return new ei(e)}}class Ca{constructor(e,n,a,u,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(a==="array"?V0:N0).members;for(let f=0;f<n.length;++f);this.paintVertexArray=new u}populatePaintArray(e,n,a,u){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,n.patterns&&n.patterns[this.layerId],a)}updatePaintArray(e,n,a,u,c,f,y){this._setPaintValues(e,n,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(e,n,a,u){if(!u||!a)return;const c=u[a];if(!c)return;const{tl:f,br:y,pixelRatio:b}=c;for(let S=e;S<n;S++)this.paintVertexArray.emplace(S,f[0],f[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cl{constructor(e,n,a=()=>!0){this.binders={},this._buffers=[],this.context=n;const u=[];for(const c in e.paint._values){const f=e.paint.get(c);if(c.endsWith("-use-theme")||!a(c)||!(f instanceof Vl&&Ll(f.property.specification)))continue;const y=H0(c,e.type),b=f.value,S=f.property.specification.type,_=!!f.property.useIntegerZoom,w=c==="line-dasharray"||c.endsWith("pattern"),M=e.paint.get(`${c}-use-theme`),T=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(b.kind!=="constant"||T)if(b.kind==="source"||T||w){const E=$_(c,S,"source");this.binders[c]=w?new Ca(b,y,S,E,e.id):new Yo(b,y,S,E),u.push(`/a_${c}`)}else{const E=$_(c,S,"composite");this.binders[c]=new ao(b,y,S,_,n,E),u.push(`/z_${c}`)}else this.binders[c]=w?new ql(b.value,y):new Hl(b.value,y,S,n),u.push(`/u_${c}`);M&&(this.binders[c].lutExpression=M.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Yo||n instanceof ao?n.maxValue:0}populatePaintArrays(e,n,a,u,c,f,y){for(const b in this.binders){const S=this.binders[b];S.context=this.context,(S instanceof Yo||S instanceof ao||S instanceof Ca)&&S.populatePaintArray(e,n,a,u,c,f,y)}}setConstantPatternPositions(e){for(const n in this.binders){const a=this.binders[n];a instanceof ql&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,n,a,u,c,f,y,b,S){let _=!1;const w=Object.keys(e),M=w.length!==0&&!b,T=M?w:n.uniqueIds;this.context.lut=c.lut;for(const E in this.binders){const C=this.binders[E];if(C.context=this.context,(C instanceof Yo||C instanceof ao||C instanceof Ca)&&C.expression&&C.expression.kind&&C.expression.kind!=="constant"&&(C.expression.isStateDependent===!0||C.expression.isLightConstant===!1)){const O=c.paint.get(E);C.expression=O.value;for(const k of T){const U=e[k.toString()];n.eachPosition(k,(V,N,$)=>{const Z=u.feature(V);C.updatePaintArray(N,$,Z,U,f,y,S)})}if(!M)for(const k of a.uniqueIds){const U=e[k.toString()];a.eachPosition(k,(V,N,$)=>{const Z=u.feature(V);C.updatePaintArray(N,$,Z,U,f,y,S)})}_=!0}}return _}defines(){const e=[];for(const n in this.binders){const a=this.binders[n];(a instanceof Hl||a instanceof ql)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Yo||a instanceof ao||a instanceof Ca)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof Hl||a instanceof ql||a instanceof ao)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof Hl||u instanceof ql||u instanceof ao)for(const c of u.uniformNames)n.push({name:c,property:a,binding:u.getBinding(e,c)})}return n}setUniforms(e,n,a,u,c){for(const{name:f,property:y,binding:b}of a)this.binders[y].setUniform(e,b,c,u.get(y),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Yo||n instanceof ao||n instanceof Ca)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const a=this.binders[n];(a instanceof Yo||a instanceof ao||a instanceof Ca)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Yo||n instanceof ao||n instanceof Ca)&&n.destroy()}}}class Pa{constructor(e,n,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new cl(u,n,a);this.needsUpload=!1,this._featureMap=new Gl,this._featureMapWithoutIds=new Gl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,a,u,c,f,y,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,n,u,c,f,y,b);n.id!==void 0?this._featureMap.add(n.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,a,u,c,f,y){for(const b of a)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,b,u,c,f,y||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const G0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function H0(o,e){return G0[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const Yh={"line-pattern":{source:Ea,composite:Ea},"fill-pattern":{source:Ea,composite:Ea},"fill-extrusion-pattern":{source:Ea,composite:Ea},"line-dasharray":{source:Bh,composite:Bh}},q0={color:{source:Ia,composite:al},number:{source:Sa,composite:Ia}};function $_(o,e,n){const a=Yh[o];return a&&a[n]||q0[e][n]}Ft(Hl,"ConstantBinder"),Ft(ql,"PatternConstantBinder"),Ft(Yo,"SourceExpressionBinder"),Ft(Ca,"PatternCompositeBinder"),Ft(ao,"CompositeExpressionBinder"),Ft(cl,"ProgramConfiguration",{omit:["_buffers"]}),Ft(Pa,"ProgramConfigurationSet");const Ii=Ct/Math.PI/2,dp=5,fp=6,W0=16383,ul=64,pp=[ul,32,16],Cs=-Ii,Xs=Ii;function Wl(o,e,n,a=Ii){return n=Dt(n),[o*Math.sin(n)*a,-e*a,o*Math.cos(n)*a]}function Ra(o,e,n){return Wl(Math.cos(Dt(o)),Math.sin(Dt(o)),e,n)}const Zl=63710088e-1,mp=2*Math.PI*Zl;class Qr{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qr(Gr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,a=this.lat*n,u=e.lat*n,c=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return Zl*Math.acos(Math.min(c,1))}toBounds(e=0){const n=360*e/40075017,a=n/Math.cos(Math.PI/180*this.lat);return new Da({lng:this.lng-a,lat:this.lat-n},{lng:this.lng+a,lat:this.lat+n})}toEcef(e){return Ra(this.lat,this.lng,Ii+e*Ii/Zl)}static convert(e){if(e instanceof Qr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Qr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Qr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Da{constructor(e,n){if(e)if(n)this.setSouthWest(e).setNorthEast(n);else if(e.length===4){const a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{const a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof Qr?new Qr(e.lng,e.lat):Qr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Qr?new Qr(e.lng,e.lat):Qr.convert(e),this}extend(e){const n=this._sw,a=this._ne;let u,c;if(e instanceof Qr)u=e,c=e;else{if(!(e instanceof Da))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Da.convert(e)):this.extend(Qr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Qr.convert(e)):this;if(u=e._sw,c=e._ne,!u||!c)return this}return n||a?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),a.lng=Math.max(c.lng,a.lng),a.lat=Math.max(c.lat,a.lat)):(this._sw=new Qr(u.lng,u.lat),this._ne=new Qr(c.lng,c.lat)),this}getCenter(){return new Qr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qr(this.getWest(),this.getNorth())}getSouthEast(){return new Qr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=Qr.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){if(e)return e instanceof Da?e:new Da(e)}}const Z0=0,G_=25.5;function cu(o){return mp*Math.cos(o*Math.PI/180)}function Ps(o){return(180+o)/360}function lo(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Xi(o,e){return o/cu(e)}function ds(o){return 360*o-180}function Ci(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function _p(o,e){return o*cu(Ci(e))}const es=85.051129;function gp(o){return Math.cos(Dt(Ye(o,-85.051129,es)))}function Xl(o,e){const n=Ye(e,Z0,G_),a=Math.pow(2,n);return gp(o)*mp/(512*a)}function d(o){return 1/Math.cos(o*Math.PI/180)}function t(o,e=0){const n=Math.exp(Math.PI*(1-(o.y+e/Ct)/(1<<o.z)*2));return 80150034*n/(n*n+1)/Ct/(1<<o.z)}class s{constructor(e,n,a=0){this.x=+e,this.y=+n,this.z=+a}static fromLngLat(e,n=0){const a=Qr.convert(e);return new s(Ps(a.lng),lo(a.lat),Xi(n,a.lat))}toLngLat(){return new Qr(ds(this.x),Ci(this.y))}toAltitude(){return _p(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/mp*d(Ci(this.y))}}function h(o,e,n,a,u,c,f,y,b){const S=(e+a)/2,_=(n+u)/2,w=new Ae(S,_);y(w),function(M,T,E,C,O,k){const U=E-O,V=C-k;return Math.abs((C-T)*U-(E-M)*V)/Math.hypot(U,V)}(w.x,w.y,c.x,c.y,f.x,f.y)>=b?(h(o,e,n,S,_,c,w,y,b),h(o,S,_,a,u,w,f,y,b)):o.push(f)}function m(o,e,n){let a=o[0],u=a.x,c=a.y;e(a);const f=[a];for(let y=1;y<o.length;y++){const b=o[y],{x:S,y:_}=b;e(b),h(f,u,c,S,_,a,b,e,n),u=S,c=_,a=b}return f}function g(o,e,n,a){if(a(e,n)){const u=e.add(n)._mult(.5);g(o,e,u,a),g(o,u,n,a)}else o.push(n)}function x(o,e){let n=o[0];const a=[n];for(let u=1;u<o.length;u++){const c=o[u];g(a,n,c,e),n=c}return a}const I=Math.pow(2,14)-1,P=-I-1;function z(o,e){const n=Math.round(o.x*e),a=Math.round(o.y*e);return o.x=Ye(n,P,I),o.y=Ye(a,P,I),(n<o.x||n>o.x+1||a<o.y||a>o.y+1)&&Rr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function L(o,e,n){const a=o.loadGeometry(),u=o.extent,c=Ct/u;if(e&&n&&n.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:y,x:b,y:S,projection:_}=n,w=M=>{const T=ds((e.x+M.x/u)/f),E=Ci((e.y+M.y/u)/f),C=_.project(T,E);M.x=(C.x*y-b)*u,M.y=(C.y*y-S)*u};for(let M=0;M<a.length;M++)if(o.type!==1)a[M]=m(a[M],w,1);else{const T=[];for(const E of a[M])E.x<0||E.x>=u||E.y<0||E.y>=u||(w(E),T.push(E));a[M]=T}}for(const f of a)for(const y of f)z(y,c);return a}function F(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?L(o):[]}}function B(o,e,n,a,u){o.emplaceBack(2*e+(a+1)/2,2*n+(u+1)/2)}function j(o,e,n){o.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class X{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Co,this.indexArray=new wi,this.segments=new Gn,this.programConfigurations=new Pa(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}updateFootprints(e,n){}populate(e,n,a,u){const c=this.layers[0],f=[];let y=null;c.type==="circle"&&(y=c.layout.get("circle-sort-key"));for(const{feature:S,id:_,index:w,sourceLayerIndex:M}of e){const T=this.layers[0]._featureFilter.needGeometry,E=F(S,T);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),E,a))continue;const C=y?y.evaluate(E,{},a):void 0,O={id:_,properties:S.properties,type:S.type,sourceLayerIndex:M,index:w,geometry:T?E.geometry:L(S,a,u),patterns:{},sortKey:C};f.push(O)}y&&f.sort((S,_)=>S.sortKey-_.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Nh,b=u.projection);for(const S of f){const{geometry:_,index:w,sourceLayerIndex:M}=S,T=e[w].feature;this.addFeature(S,_,w,n.availableImages,a,b,n.brightness),n.featureIndex.insert(T,_,w,M,this.index)}}update(e,n,a,u,c,f,y){this.programConfigurations.updatePaintArrays(e,n,c,a,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,B0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ap.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,a,u,c,f,y){for(const b of n)for(const S of b){const _=S.x,w=S.y;if(_<0||_>=Ct||w<0||w>=Ct)continue;if(f){const E=f.projectTilePoint(_,w,c),C=f.upVector(c,_,w),O=this.globeExtVertexArray;j(O,E,C),j(O,E,C),j(O,E,C),j(O,E,C)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),T=M.vertexLength;B(this.layoutVertexArray,_,w,-1,-1),B(this.layoutVertexArray,_,w,1,-1),B(this.layoutVertexArray,_,w,1,1),B(this.layoutVertexArray,_,w,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+2,T+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,c,y)}}function q(o,e){for(let n=0;n<o.length;n++)if(me(e,o[n]))return!0;for(let n=0;n<e.length;n++)if(me(o,e[n]))return!0;return!!ue(o,e)}function J(o,e,n){return!!me(o,e)||!!ye(e,o,n)}function Q(o,e){if(o.length===1)return ge(e,o[0]);for(let n=0;n<e.length;n++){const a=e[n];for(let u=0;u<a.length;u++)if(me(o,a[u]))return!0}for(let n=0;n<o.length;n++)if(ge(e,o[n]))return!0;for(let n=0;n<e.length;n++)if(ue(o,e[n]))return!0;return!1}function oe(o,e,n){if(o.length>1){if(ue(o,e))return!0;for(let a=0;a<e.length;a++)if(ye(e[a],o,n))return!0}for(let a=0;a<o.length;a++)if(ye(o[a],e,n))return!0;return!1}function ue(o,e){if(o.length===0||e.length===0)return!1;for(let n=0;n<o.length-1;n++){const a=o[n],u=o[n+1];for(let c=0;c<e.length-1;c++)if(ce(a,u,e[c],e[c+1]))return!0}return!1}function ce(o,e,n,a){return To(o,n,a)!==To(e,n,a)&&To(o,e,n)!==To(o,e,a)}function ye(o,e,n){const a=n*n;if(e.length===1)return o.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(pe(o,e[u-1],e[u])<a)return!0;return!1}function pe(o,e,n){const a=e.distSqr(n);if(a===0)return o.distSqr(e);const u=((o.x-e.x)*(n.x-e.x)+(o.y-e.y)*(n.y-e.y))/a;return o.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function ge(o,e){let n,a,u,c=!1;for(let f=0;f<o.length;f++){n=o[f];for(let y=0,b=n.length-1;y<n.length;b=y++)a=n[y],u=n[b],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(c=!c)}return c}function me(o,e){let n=!1;for(let a=0,u=o.length-1;a<o.length;u=a++){const c=o[a],f=o[u];c.y>e.y!=f.y>e.y&&e.x<(f.x-c.x)*(e.y-c.y)/(f.y-c.y)+c.x&&(n=!n)}return n}function we(o,e,n,a,u){for(const f of o)if(e<=f.x&&n<=f.y&&a>=f.x&&u>=f.y)return!0;const c=[new Ae(e,n),new Ae(e,u),new Ae(a,u),new Ae(a,n)];if(o.length>2){for(const f of c)if(me(o,f))return!0}for(let f=0;f<o.length-1;f++)if(Ee(o[f],o[f+1],c))return!0;return!1}function Ee(o,e,n){const a=n[0],u=n[2];if(o.x<a.x&&e.x<a.x||o.x>u.x&&e.x>u.x||o.y<a.y&&e.y<a.y||o.y>u.y&&e.y>u.y)return!1;const c=To(o,e,n[0]);return c!==To(o,e,n[1])||c!==To(o,e,n[2])||c!==To(o,e,n[3])}function He(o,e,n,a,u,c){let f=e.y-o.y,y=o.x-e.x;if(c=c||0){const b=f*f+y*y;if(b===0)return!0;const S=Math.sqrt(b);f/=S,y/=S}return!((n.x-o.x)*f+(n.y-o.y)*y-c<0||(a.x-o.x)*f+(a.y-o.y)*y-c<0||(u.x-o.x)*f+(u.y-o.y)*y-c<0)}function Be(o,e,n,a,u,c,f){return!(He(o,e,a,u,c,f)||He(e,n,a,u,c,f)||He(n,o,a,u,c,f)||He(a,u,o,e,n,f)||He(u,c,o,e,n,f)||He(c,a,o,e,n,f))}function rt(o,e,n){const a=e.paint.get(o).value;return a.kind==="constant"?a.value:n.programConfigurations.get(e.id).getMaxValue(o)}function nt(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function yt(o,e,n,a,u){if(!e[0]&&!e[1])return o;const c=Ae.convert(e)._mult(u);n==="viewport"&&c._rotate(-a);const f=[];for(let y=0;y<o.length;y++)f.push(o[y].sub(c));return f}function Oe(o,e,n,a){const u=Ae.convert(o)._mult(a);return e==="viewport"&&u._rotate(-n),u}let tt,ze;Ft(X,"CircleBucket",{omit:["layers"]});var Qe,Ze={exports:{}},at=(Qe||(Qe=1,function(o,e){(function(n){function a(c,f,y){var b=u(256*c,256*(f=Math.pow(2,y)-f-1),y),S=u(256*(c+1),256*(f+1),y);return b[0]+","+b[1]+","+S[0]+","+S[1]}function u(c,f,y){var b=2*Math.PI*6378137/256/Math.pow(2,y);return[c*b-2*Math.PI*6378137/2,f*b-2*Math.PI*6378137/2]}n.getURL=function(c,f,y,b,S,_){return _=_||{},c+"?"+["bbox="+a(y,b,S),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+f].join("&")},n.getTileBBox=a,n.getMercCoords=u,Object.defineProperty(n,"__esModule",{value:!0})})(e)}(0,Ze.exports)),Ze.exports);class $e{constructor(e,n,a){this.z=e,this.x=n,this.y=a,this.key=Mt(0,e,e,n,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const a=at.getTileBBox(this.x,this.y,this.z),u=function(c,f,y){let b,S="";for(let _=c;_>0;_--)b=1<<_-1,S+=(f&b?1:0)+(y&b?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ut{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Mt(e,n.z,n.z,n.x,n.y)}}class St{constructor(e,n,a,u,c){this.overscaledZ=e,this.wrap=n,this.canonical=new $e(a,+u,+c),this.key=n===0&&e===a?this.canonical.key:Mt(n,e,a,u,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new St(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new St(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Mt(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Mt(this.wrap*+n,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new St(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new St(n,this.wrap,n,a,u),new St(n,this.wrap,n,a+1,u),new St(n,this.wrap,n,a,u+1),new St(n,this.wrap,n,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new St(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new St(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ut(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Mt(o,e,n,a,u){const c=1<<Math.min(n,22);let f=c*(u%c)+a%c;return o&&n<22&&(f+=c*c*((o<0?-2*o-1:2*o)%(1<<2*(22-n)))),16*(32*f+n)+(e-n)}const Lt=[o=>{let e=o.canonical.x-1,n=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,n--),new St(o.overscaledZ,n,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,n=o.wrap;return e===1<<o.canonical.z&&(e=0,n++),new St(o.overscaledZ,n,o.canonical.z,e,o.canonical.y)},o=>new St(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new St(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Ft($e,"CanonicalTileID"),Ft(St,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Wt=Jr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:pr}=Wt,sr=Jr([{name:"a_pos_3",components:3,type:"Int16"}]);var mr=Jr([{name:"a_pos",type:"Int16",components:2}]);class hr{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){const u=te.vec2.dot(n,this.dir);if(Math.abs(u)<1e-6)return!1;const c=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1])/u;return a[0]=this.pos[0]+this.dir[0]*c,a[1]=this.pos[1]+this.dir[1]*c,!0}}class Br{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,a){const u=te.vec3.dot(n,this.dir);if(Math.abs(u)<1e-6)return!1;const c=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return a[0]=this.pos[0]+this.dir[0]*c,a[1]=this.pos[1]+this.dir[1]*c,a[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,n,a){if(te.vec3.equals(this.pos,e)||n===0)return a[0]=a[1]=a[2]=0,!1;const[u,c,f]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],S=this.pos[2]-e[2],_=u*u+c*c+f*f,w=2*(y*u+b*c+S*f),M=w*w-4*_*(y*y+b*b+S*S-n*n);if(M<0){const T=Math.max(-w/2,0),E=y+u*T,C=b+c*T,O=S+f*T,k=Math.hypot(E,C,O);return a[0]=E*n/k,a[1]=C*n/k,a[2]=O*n/k,!1}{const T=(-w-Math.sqrt(M))/(2*_);if(T<0){const E=Math.hypot(y,b,S);return a[0]=y*n/E,a[1]=b*n/E,a[2]=S*n/E,!1}return a[0]=y+u*T,a[1]=b+c*T,a[2]=S+f*T,!0}}}class on{constructor(e,n,a,u,c){this.TL=e,this.TR=n,this.BR=a,this.BL=u,this.horizon=c}static fromInvProjectionMatrix(e,n,a){const u=[-1,1,1],c=[1,1,1],f=[1,-1,1],y=[-1,-1,1],b=te.vec3.transformMat4(u,u,e),S=te.vec3.transformMat4(c,c,e),_=te.vec3.transformMat4(f,f,e),w=te.vec3.transformMat4(y,y,e);return new on(b,S,_,w,n/a)}}function mn(o,e,n){let a=1/0,u=-1/0;const c=[];for(const f of o){te.vec3.sub(c,f,e);const y=te.vec3.dot(c,n);a=Math.min(a,y),u=Math.max(u,y)}return[a,u]}function zr(o,e){let n=!0;for(let a=0;a<o.planes.length;a++){const u=o.planes[a];let c=0;for(let f=0;f<e.length;f++)c+=te.vec3.dot(u,e[f])+u[3]>=0;if(c===0)return 0;c!==e.length&&(n=!1)}return n?2:1}function On(o,e){for(const n of o.projections){const a=mn(e,o.points[0],n.axis);if(n.projection[1]<a[0]||n.projection[0]>a[1])return 0}return 1}function wr(o,e){let n=0;const a=[0,0,0,0];for(let u=0;u<o.length;u++)a[0]=o[u][0],a[1]=o[u][1],a[2]=o[u][2],a[3]=1,te.vec4.dot(a,e)>=0&&n++;return n}class gr{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=or.fromPoints(this.points),this.projections=[],this.frustumEdges=[te.vec3.sub([],this.points[2],this.points[3]),te.vec3.sub([],this.points[0],this.points[3]),te.vec3.sub([],this.points[4],this.points[0]),te.vec3.sub([],this.points[5],this.points[1]),te.vec3.sub([],this.points[6],this.points[2]),te.vec3.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const u=[0,-a[2],a[1]],c=[a[2],0,-a[0]];this.projections.push({axis:u,projection:mn(this.points,this.points[0],u)}),this.projections.push({axis:c,projection:mn(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(e,n,a,u){const c=Math.pow(2,a),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const _=te.vec4.transformMat4([],S,e),w=1/_[3]/n*c;return te.vec4.mul(_,_,[w,w,u?1/_[3]:w,w])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const _=te.vec3.sub([],f[S[0]],f[S[1]]),w=te.vec3.sub([],f[S[2]],f[S[1]]),M=te.vec3.normalize([],te.vec3.cross([],_,w)),T=-te.vec3.dot(M,f[S[1]]);return M.concat(T)}),b=[];for(let S=0;S<f.length;S++)b.push([f[S][0],f[S][1],f[S][2]]);return new gr(b,y)}intersectsPrecise(e,n,a){for(let u=0;u<n.length;u++)if(!wr(e,n[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!wr(e,this.planes[u]))return 0;for(const u of a)for(const c of this.frustumEdges){const f=te.vec3.cross([],u,c),y=te.vec3.length(f);if(y===0)continue;te.vec3.scale(f,f,1/y);const b=mn(this.points,this.points[0],f),S=mn(e,this.points[0],f);if(b[0]>S[1]||S[0]>b[1])return 0}return 1}containsPoint(e){for(const n of this.planes){const a=n[3];if(te.vec3.dot([n[0],n[1],n[2]],e)+a<0)return!1}return!0}}class or{static fromPoints(e){const n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of e)te.vec3.min(n,n,u),te.vec3.max(a,a,u);return new or(n,a)}static fromTileIdAndHeight(e,n,a){const u=1<<e.canonical.z,c=e.canonical.x,f=e.canonical.y;return new or([c/u,f/u,n],[(c+1)/u,(f+1)/u,a])}static applyTransform(e,n){const a=e.getCorners();for(let u=0;u<a.length;++u)te.vec3.transformMat4(a[u],a[u],n);return or.fromPoints(a)}static applyTransformFast(e,n){const a=[n[12],n[13],n[14]],u=[...a];for(let c=0;c<3;c++)for(let f=0;f<3;f++){const y=n[4*f+c],b=y*e.min[f],S=y*e.max[f];a[c]+=Math.min(b,S),u[c]+=Math.max(b,S)}return new or(a,u)}static projectAabbCorners(e,n){const a=e.getCorners();for(let u=0;u<a.length;++u)te.vec3.transformMat4(a[u],a[u],n);return a}constructor(e,n){this.min=e,this.max=n,this.center=te.vec3.scale([],te.vec3.add([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],a=te.vec3.clone(this.min),u=te.vec3.clone(this.max);for(let c=0;c<n.length;c++)a[c]=n[c]?this.min[c]:this.center[c],u[c]=n[c]?this.center[c]:this.max[c];return u[2]=this.max[2],new or(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?zr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?zr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?On(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?On(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function en(o){return o*Ii/Zl}Ft(or,"Aabb");const tn=[new or([Cs,Cs,Cs],[Xs,Xs,Xs]),new or([Cs,Cs,Cs],[0,0,Xs]),new or([0,Cs,Cs],[Xs,0,Xs]),new or([Cs,0,Cs],[0,Xs,Xs]),new or([0,0,Cs],[Xs,Xs,Xs])];function Wn(o,e,n,a=!0){const u=te.vec3.scale([],o._camera.position,o.worldSize),c=[e,n,1,1];te.vec4.transformMat4(c,c,o.pixelMatrixInverse),te.vec4.scale(c,c,1/c[3]);const f=te.vec3.sub([],c,u),y=te.vec3.normalize([],f),b=o.globeMatrix,S=[b[12],b[13],b[14]],_=te.vec3.sub([],S,u),w=te.vec3.length(_),M=te.vec3.normalize([],_),T=o.worldSize/(2*Math.PI),E=te.vec3.dot(M,y),C=Math.asin(T/w);if(C<Math.acos(E)){if(!a)return null;const ve=[],le=[];te.vec3.scale(ve,y,w/E),te.vec3.normalize(le,te.vec3.sub(le,ve,_)),te.vec3.normalize(y,te.vec3.add(y,_,te.vec3.scale(y,le,Math.tan(C)*w)))}const O=[];new Br(u,y).closestPointOnSphere(S,T,O);const k=te.vec3.normalize([],Tl(b,0)),U=te.vec3.normalize([],Tl(b,1)),V=te.vec3.normalize([],Tl(b,2)),N=te.vec3.dot(k,O),$=te.vec3.dot(U,O),Z=te.vec3.dot(V,O),K=jt(Math.asin(-$/T));let ae=jt(Math.atan2(N,Z));ae=o.center.lng+function(ve,le){const xe=(le-ve+180)%360-180;return xe<-180?xe+360:xe}(o.center.lng,ae);const ie=Ps(ae),se=Ye(lo(K),0,1);return new s(ie,se)}class fi{constructor(e,n,a){this.a=te.vec3.sub([],e,a),this.b=te.vec3.sub([],n,a),this.center=a;const u=te.vec3.normalize([],this.a),c=te.vec3.normalize([],this.b);this.angle=Math.acos(te.vec3.dot(u,c))}}function ts(o,e){if(o.angle===0)return null;let n;return n=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),n<0||n>1?null:function(a,u,c,f){const y=Math.sin(c);return a*(Math.sin((1-f)*c)/y)+u*(Math.sin(f*c)/y)}(o.a[e],o.b[e],o.angle,Ye(n,0,1))+o.center[e]}function pi(o){if(o.z<=1)return tn[o.z+2*o.y+o.x];const e=an(Rn(o));return or.fromPoints(e)}function Ti(o,e,n){return te.vec3.scale(o,o,1-n),te.vec3.scaleAndAdd(o,o,e,n)}function Gi(o,e,n){for(const a of o)te.vec3.transformMat4(a,a,e),te.vec3.scale(a,a,n)}function rn(o,e,n,a){const u=e/o.worldSize,c=o.globeMatrix;if(n.z<=1){const ie=pi(n).getCorners();return Gi(ie,c,u),or.fromPoints(ie)}const f=Rn(n,a),y=an(f,Ii+en(o._tileCoverLift));Gi(y,c,u);const b=Number.MAX_VALUE,S=[-b,-b,-b],_=[b,b,b];if(f.contains(o.center)){for(const ve of y)te.vec3.min(_,_,ve),te.vec3.max(S,S,ve);S[2]=0;const ie=o.point,se=[ie.x*u,ie.y*u,0];return te.vec3.min(_,_,se),te.vec3.max(S,S,se),new or(_,S)}if(o._tileCoverLift>0){for(const ie of y)te.vec3.min(_,_,ie),te.vec3.max(S,S,ie);return new or(_,S)}const w=[c[12]*u,c[13]*u,c[14]*u],M=f.getCenter(),T=Ye(o.center.lat,-85.051129,es),E=Ye(M.lat,-85.051129,es),C=Ps(o.center.lng),O=lo(T);let k=C-Ps(M.lng);const U=O-lo(E);k>.5?k-=1:k<-.5&&(k+=1);let V=0;if(Math.abs(k)>Math.abs(U))V=k>=0?1:3;else{V=U>=0?0:2;const ie=[c[4]*u,c[5]*u,c[6]*u],se=-Math.sin(Dt(U>=0?f.getSouth():f.getNorth()))*Ii;te.vec3.scaleAndAdd(w,w,ie,se)}const N=y[V],$=y[(V+1)%4],Z=new fi(N,$,w),K=[ts(Z,0)||N[0],ts(Z,1)||N[1],ts(Z,2)||N[2]],ae=Oi(o.zoom);if(ae>0){const ie=function({x:ve,y:le,z:xe},Me,Se,Pe,Ce){const Fe=1/(1<<xe);let Le=ve*Fe,Ne=Le+Fe,ot=le*Fe,it=ot+Fe,Bt=0;const _t=(Le+Ne)/2-Pe;return _t>.5?Bt=-1:_t<-.5&&(Bt=1),Le=((Le+Bt)*Me-(Pe*=Me))*Se+Pe,Ne=((Ne+Bt)*Me-Pe)*Se+Pe,ot=(ot*Me-(Ce*=Me))*Se+Ce,it=(it*Me-Ce)*Se+Ce,[[Le,it,0],[Ne,it,0],[Ne,ot,0],[Le,ot,0]]}(n,e,o._pixelsPerMercatorPixel,C,O);for(let ve=0;ve<y.length;ve++)Ti(y[ve],ie[ve],ae);const se=te.vec3.add([],ie[V],ie[(V+1)%4]);te.vec3.scale(se,se,.5),Ti(K,se,ae)}for(const ie of y)te.vec3.min(_,_,ie),te.vec3.max(S,S,ie);return _[2]=Math.min(N[2],$[2]),te.vec3.min(_,_,K),te.vec3.max(S,S,K),new or(_,S)}function Rn({x:o,y:e,z:n},a=!1){const u=1/(1<<n),c=new Qr(ds(o*u),e===(1<<n)-1&&a?-90:Ci((e+1)*u)),f=new Qr(ds((o+1)*u),e===0&&a?90:Ci(e*u));return new Da(c,f)}function an(o,e=Ii){const n=Dt(o.getNorth()),a=Dt(o.getSouth()),u=Math.cos(n),c=Math.cos(a),f=Math.sin(n),y=Math.sin(a),b=o.getWest(),S=o.getEast();return[Wl(c,y,b,e),Wl(c,y,S,e),Wl(u,f,S,e),Wl(u,f,b,e)]}function _n(o,e,n,a){const u=1<<n.z,c=(o/Ct+n.x)/u;return Ra(Ci((e/Ct+n.y)/u),ds(c),a)}function _i({min:o,max:e}){return W0/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const Bn=new Float64Array(16);function ci(o){const e=_i(o),n=te.mat4.fromScaling(Bn,[e,e,e]);return te.mat4.translate(n,n,te.vec3.negate([],o.min))}function zo(o){const e=te.mat4.fromTranslation(Bn,o.min),n=1/_i(o);return te.mat4.scale(e,e,[n,n,n])}function rs(o){const e=Ct/(2*Math.PI);return o/(2*Math.PI)/e}function Ks(o,e){return Ct/(512*Math.pow(2,o))*_i(pi(e))}function Jo(o,e,n,a,u){const c=rs(n),f=[o,e,-n/(2*Math.PI)],y=te.mat4.identity(new Float64Array(16));return te.mat4.translate(y,y,f),te.mat4.scale(y,y,[c,c,c]),te.mat4.rotateX(y,y,Dt(-u)),te.mat4.rotateY(y,y,Dt(-a)),y}function Oi(o){return Qt(dp,fp,o)}function Rs(o,e){const n=Ra(e.lat,e.lng),a=function(c){const f=Ra(c._center.lat,c._center.lng),y=te.vec3.fromValues(0,1,0);let b=te.vec3.cross([],y,f);const S=te.mat4.fromRotation([],-c.angle,f);b=te.vec3.transformMat4(b,b,S),te.mat4.fromRotation(S,-c._pitch,b);const _=te.vec3.normalize([],f);return te.vec3.scale(_,_,en(c.cameraToCenterDistance/c.pixelsPerMeter)),te.vec3.transformMat4(_,_,S),te.vec3.add([],f,_)}(o),u=te.vec3.subtract([],a,n);return te.vec3.angle(u,n)}function Lo(o,e){return Rs(o,e)>Math.PI/2*1.01}const co=Dt(85),Qo=Math.cos(co),yp=Math.sin(co),uu=te.mat4.create(),Jh=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Qh(o,e,n,a,u,c,f,y,b){if(c&&o.queryGeometry.isAboveHorizon)return!1;c&&(b*=o.pixelToTileUnitsFactor);const S=o.tileID.canonical,_=n.projection.upVectorScale(S,n.center.lat,n.worldSize).metersToTile;for(const w of e)for(const M of w){const T=M.add(y),E=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(T.x,T.y,!0):0,C=n.projection.projectTilePoint(T.x,T.y,S);if(E>0){const V=n.projection.upVector(S,T.x,T.y);C.x+=V[0]*_*E,C.y+=V[1]*_*E,C.z+=V[2]*_*E}const O=c?T:H3(C.x,C.y,C.z,a),k=c?o.tilespaceRays.map(V=>W3(V,E)):o.queryGeometry.screenGeometry,U=te.vec4.transformMat4([],[C.x,C.y,C.z,1],a);if(!f&&c?b*=U[3]/n.cameraToCenterDistance:f&&!c&&(b*=n.cameraToCenterDistance/U[3]),c){const V=Ci((M.y/Ct+S.y)/(1<<S.z));b/=n.projection.pixelsPerMeter(V,1)/Xi(1,V)}if(J(k,O,b))return!0}return!1}function H3(o,e,n,a){const u=te.vec4.transformMat4([],[o,e,n,1],a);return new Ae(u[0]/u[3],u[1]/u[3])}const yb=te.vec3.fromValues(0,0,0),q3=te.vec3.fromValues(0,0,1);function W3(o,e){const n=te.vec3.create();return yb[2]=e,o.intersectsPlane(yb,q3,n),new Ae(n[0],n[1])}class vb extends X{}let xb,bb,wb,Tb;function Sb(o,{width:e,height:n},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*a);return o.width=e,o.height=n,o.data=u,o}function Eb(o,e,n){const{width:a,height:u}=e;a===o.width&&u===o.height||(X0(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,a),height:Math.min(o.height,u)},n,null),o.width=a,o.height=u,o.data=e.data)}function X0(o,e,n,a,u,c,f,y){if(u.width===0||u.height===0)return e;if(u.width>o.width||u.height>o.height||n.x>o.width-u.width||n.y>o.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const b=o.data,S=e.data,_=c===4&&y;for(let w=0;w<u.height;w++){const M=((n.y+w)*o.width+n.x)*c,T=((a.y+w)*e.width+a.x)*c;if(_)for(let E=0;E<u.width;E++){const C=M+E*c+3,O=T+E*c;S[O+0]=255,S[O+1]=255,S[O+2]=255,S[O+3]=b[C]}else if(f)for(let E=0;E<u.width;E++){const C=M+E*c,O=T+E*c,k=b[C+3],U=new nn(b[C+0]/255*k,b[C+1]/255*k,b[C+2]/255*k,k).toRenderColor(f).toArray();S[O+0]=U[0],S[O+1]=U[1],S[O+2]=U[2],S[O+3]=U[3]}else for(let E=0;E<u.width*c;E++)S[T+E]=b[M+E]}return e}Ft(vb,"HeatmapBucket",{omit:["layers"]});class Kl{constructor(e,n){Sb(this,e,1,n)}resize(e){Eb(this,new Kl(e),1)}clone(){return new Kl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,u,c){X0(e,n,a,u,c,1,null)}}class ki{constructor(e,n){Sb(this,e,4,n)}resize(e){Eb(this,new ki(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ki({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,a,u,c,f,y){X0(e,n,a,u,c,4,f,y)}}class Ab{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}function vp(o){const e={},n=o.resolution||256,a=o.clips?o.clips.length:1,u=o.image||new ki({width:n,height:a}),c=(f,y,b)=>{e[o.evaluationKey]=b;const S=o.expression.evaluate(e);S&&(u.data[f+y+0]=Math.floor(255*S.r/S.a),u.data[f+y+1]=Math.floor(255*S.g/S.a),u.data[f+y+2]=Math.floor(255*S.b/S.a),u.data[f+y+3]=Math.floor(255*S.a))};if(o.clips)for(let f=0,y=0;f<a;++f,y+=4*n)for(let b=0,S=0;b<n;b++,S+=4){const _=b/(n-1),{start:w,end:M}=o.clips[f];c(y,S,w*(1-_)+M*_)}else for(let f=0,y=0;f<n;f++,y+=4)c(0,y,f/(n-1));return u}Ft(Kl,"AlphaImage"),Ft(ki,"RGBAImage");const Z3=Jr([{name:"a_pos",components:2,type:"Int16"}],4),X3=Jr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),K3=Jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Y3=Jr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function xp(o,e,n=2){const a=e&&e.length,u=a?e[0]*n:o.length;let c=Mb(o,0,u,n,!0);const f=[];if(!c||c.next===c.prev)return f;let y,b,S;if(a&&(c=function(_,w,M,T){const E=[];for(let C=0,O=w.length;C<O;C++){const k=Mb(_,w[C]*T,C<O-1?w[C+1]*T:_.length,T,!1);k===k.next&&(k.steiner=!0),E.push(sP(k))}E.sort(rP);for(let C=0;C<E.length;C++)M=nP(E[C],M);return M}(o,e,c,n)),o.length>80*n){y=1/0,b=1/0;let _=-1/0,w=-1/0;for(let M=n;M<u;M+=n){const T=o[M],E=o[M+1];T<y&&(y=T),E<b&&(b=E),T>_&&(_=T),E>w&&(w=E)}S=Math.max(_-y,w-b),S=S!==0?32767/S:0}return bp(c,f,n,y,b,S,0),f}function Mb(o,e,n,a,u){let c;if(u===function(f,y,b,S){let _=0;for(let w=y,M=b-S;w<b;w+=S)_+=(f[M]-f[w])*(f[w+1]+f[M+1]),M=w;return _}(o,e,n,a)>0)for(let f=e;f<n;f+=a)c=Pb(f/a|0,o[f],o[f+1],c);else for(let f=n-a;f>=e;f-=a)c=Pb(f/a|0,o[f],o[f+1],c);return c&&H_(c,c.next)&&(Tp(c),c=c.next),c}function hu(o,e){if(!o)return o;e||(e=o);let n,a=o;do if(n=!1,a.steiner||!H_(a,a.next)&&gi(a.prev,a,a.next)!==0)a=a.next;else{if(Tp(a),a=e=a.prev,a===a.next)break;n=!0}while(n||a!==e);return e}function bp(o,e,n,a,u,c,f){if(!o)return;!f&&c&&function(b,S,_,w){let M=b;do M.z===0&&(M.z=K0(M.x,M.y,S,_,w)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==b);M.prevZ.nextZ=null,M.prevZ=null,function(T){let E,C=1;do{let O,k=T;T=null;let U=null;for(E=0;k;){E++;let V=k,N=0;for(let Z=0;Z<C&&(N++,V=V.nextZ,V);Z++);let $=C;for(;N>0||$>0&&V;)N!==0&&($===0||!V||k.z<=V.z)?(O=k,k=k.nextZ,N--):(O=V,V=V.nextZ,$--),U?U.nextZ=O:T=O,O.prevZ=U,U=O;k=V}U.nextZ=null,C*=2}while(E>1)}(M)}(o,a,u,c);let y=o;for(;o.prev!==o.next;){const b=o.prev,S=o.next;if(c?Q3(o,a,u,c):J3(o))e.push(b.i,o.i,S.i),Tp(o),o=S.next,y=S.next;else if((o=S)===y){f?f===1?bp(o=eP(hu(o),e),e,n,a,u,c,2):f===2&&tP(o,e,n,a,u,c):bp(hu(o),e,n,a,u,c,1);break}}}function J3(o){const e=o.prev,n=o,a=o.next;if(gi(e,n,a)>=0)return!1;const u=e.x,c=n.x,f=a.x,y=e.y,b=n.y,S=a.y,_=u<c?u<f?u:f:c<f?c:f,w=y<b?y<S?y:S:b<S?b:S,M=u>c?u>f?u:f:c>f?c:f,T=y>b?y>S?y:S:b>S?b:S;let E=a.next;for(;E!==e;){if(E.x>=_&&E.x<=M&&E.y>=w&&E.y<=T&&ed(u,y,c,b,f,S,E.x,E.y)&&gi(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function Q3(o,e,n,a){const u=o.prev,c=o,f=o.next;if(gi(u,c,f)>=0)return!1;const y=u.x,b=c.x,S=f.x,_=u.y,w=c.y,M=f.y,T=y<b?y<S?y:S:b<S?b:S,E=_<w?_<M?_:M:w<M?w:M,C=y>b?y>S?y:S:b>S?b:S,O=_>w?_>M?_:M:w>M?w:M,k=K0(T,E,e,n,a),U=K0(C,O,e,n,a);let V=o.prevZ,N=o.nextZ;for(;V&&V.z>=k&&N&&N.z<=U;){if(V.x>=T&&V.x<=C&&V.y>=E&&V.y<=O&&V!==u&&V!==f&&ed(y,_,b,w,S,M,V.x,V.y)&&gi(V.prev,V,V.next)>=0||(V=V.prevZ,N.x>=T&&N.x<=C&&N.y>=E&&N.y<=O&&N!==u&&N!==f&&ed(y,_,b,w,S,M,N.x,N.y)&&gi(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;V&&V.z>=k;){if(V.x>=T&&V.x<=C&&V.y>=E&&V.y<=O&&V!==u&&V!==f&&ed(y,_,b,w,S,M,V.x,V.y)&&gi(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;N&&N.z<=U;){if(N.x>=T&&N.x<=C&&N.y>=E&&N.y<=O&&N!==u&&N!==f&&ed(y,_,b,w,S,M,N.x,N.y)&&gi(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function eP(o,e){let n=o;do{const a=n.prev,u=n.next.next;!H_(a,u)&&Ib(a,n,n.next,u)&&wp(a,u)&&wp(u,a)&&(e.push(a.i,n.i,u.i),Tp(n),Tp(n.next),n=o=u),n=n.next}while(n!==o);return hu(n)}function tP(o,e,n,a,u,c){let f=o;do{let y=f.next.next;for(;y!==f.prev;){if(f.i!==y.i&&oP(f,y)){let b=Cb(f,y);return f=hu(f,f.next),b=hu(b,b.next),bp(f,e,n,a,u,c,0),void bp(b,e,n,a,u,c,0)}y=y.next}f=f.next}while(f!==o)}function rP(o,e){return o.x-e.x}function nP(o,e){const n=function(u,c){let f=c;const y=u.x,b=u.y;let S,_=-1/0;do{if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){const C=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(C<=y&&C>_&&(_=C,S=f.x<f.next.x?f:f.next,C===y))return S}f=f.next}while(f!==c);if(!S)return null;const w=S,M=S.x,T=S.y;let E=1/0;f=S;do{if(y>=f.x&&f.x>=M&&y!==f.x&&ed(b<T?y:_,b,M,T,b<T?_:y,b,f.x,f.y)){const C=Math.abs(b-f.y)/(y-f.x);wp(f,u)&&(C<E||C===E&&(f.x>S.x||f.x===S.x&&iP(S,f)))&&(S=f,E=C)}f=f.next}while(f!==w);return S}(o,e);if(!n)return e;const a=Cb(n,o);return hu(a,a.next),hu(n,n.next)}function iP(o,e){return gi(o.prev,o,e.prev)<0&&gi(e.next,o,o.next)<0}function K0(o,e,n,a,u){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-n)*u|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function sP(o){let e=o,n=o;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==o);return n}function ed(o,e,n,a,u,c,f,y){return(u-f)*(e-y)>=(o-f)*(c-y)&&(o-f)*(a-y)>=(n-f)*(e-y)&&(n-f)*(c-y)>=(u-f)*(a-y)}function oP(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(n,a){let u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==a.i&&u.next.i!==a.i&&Ib(u,u.next,n,a))return!0;u=u.next}while(u!==n);return!1}(o,e)&&(wp(o,e)&&wp(e,o)&&function(n,a){let u=n,c=!1;const f=(n.x+a.x)/2,y=(n.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&f<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(c=!c),u=u.next;while(u!==n);return c}(o,e)&&(gi(o.prev,o,e.prev)||gi(o,e.prev,e))||H_(o,e)&&gi(o.prev,o,o.next)>0&&gi(e.prev,e,e.next)>0)}function gi(o,e,n){return(e.y-o.y)*(n.x-e.x)-(e.x-o.x)*(n.y-e.y)}function H_(o,e){return o.x===e.x&&o.y===e.y}function Ib(o,e,n,a){const u=W_(gi(o,e,n)),c=W_(gi(o,e,a)),f=W_(gi(n,a,o)),y=W_(gi(n,a,e));return u!==c&&f!==y||!(u!==0||!q_(o,n,e))||!(c!==0||!q_(o,a,e))||!(f!==0||!q_(n,o,a))||!(y!==0||!q_(n,e,a))}function q_(o,e,n){return e.x<=Math.max(o.x,n.x)&&e.x>=Math.min(o.x,n.x)&&e.y<=Math.max(o.y,n.y)&&e.y>=Math.min(o.y,n.y)}function W_(o){return o>0?1:o<0?-1:0}function wp(o,e){return gi(o.prev,o,o.next)<0?gi(o,e,o.next)>=0&&gi(o,o.prev,e)>=0:gi(o,e,o.prev)<0||gi(o,o.next,e)<0}function Cb(o,e){const n=Y0(o.i,o.x,o.y),a=Y0(e.i,e.x,e.y),u=o.next,c=e.prev;return o.next=e,e.prev=o,n.next=u,u.prev=n,a.next=n,n.prev=a,c.next=a,a.prev=c,a}function Pb(o,e,n,a){const u=Y0(o,e,n);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Tp(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Y0(o,e,n){return{i:o,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Z_(o,e){const n=o.length;if(n<=1)return[o];const a=[];let u,c;for(let f=0;f<n;f++){const y=wl(o[f]);y!==0&&(o[f].area=Math.abs(y),c===void 0&&(c=y<0),c===y<0?(u&&a.push(u),u=[o[f]]):u.push(o[f]))}if(u&&a.push(u),e>1)for(let f=0;f<a.length;f++)a[f].length<=e||(t_(a[f],e,1,a[f].length-1,aP),a[f]=a[f].slice(0,e));return a}function aP(o,e){return e.area-o.area}function Rb(o,e,n=1){if(!o)return null;const a=typeof o=="string"?Mi.from(o).getPrimary():o.getPrimary(),u=a.id.toString();return e.has(u)||e.set(u,[]),a.scaleSelf(n),e.get(u).push(a),a.toString()}function J0(o,e,n,a){const u=a.patternDependencies;let c=!1;for(const f of e){const y=f.paint.get(`${o}-pattern`);y.isConstant()||(c=!0),Rb(y.constantOr(null),u,n)&&(c=!0)}return c}function Q0(o,e,n,a,u,c){const f=c.patternDependencies;for(const y of e){const b=y.paint.get(`${o}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:a},n,{},c.availableImages);S=S&&S.name?S.name:S;const _=Rb(S,f,u);_&&(n.patterns[y.id]=_)}}return n}var ev,Db,tv,zb,rv,Lb,Ob,X_={};function kb(){if(Db)return ev;Db=1;var o=Ve();function e(u,c,f,y,b){this.properties={},this.extent=f,this.type=0,this._pbf=u,this._geometry=-1,this._keys=y,this._values=b,u.readFields(n,this,c)}function n(u,c,f){u==1?c.id=f.readVarint():u==2?function(y,b){for(var S=y.readVarint()+y.pos;y.pos<S;){var _=b._keys[y.readVarint()],w=b._values[y.readVarint()];b.properties[_]=w}}(f,c):u==3?c.type=f.readVarint():u==4&&(c._geometry=f.pos)}function a(u){for(var c,f,y=0,b=0,S=u.length,_=S-1;b<S;_=b++)y+=((f=u[_]).x-(c=u[b]).x)*(c.y+f.y);return y}return ev=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var c,f=u.readVarint()+u.pos,y=1,b=0,S=0,_=0,w=[];u.pos<f;){if(b<=0){var M=u.readVarint();y=7&M,b=M>>3}if(b--,y===1||y===2)S+=u.readSVarint(),_+=u.readSVarint(),y===1&&(c&&w.push(c),c=[]),c.push(new o(S,_));else{if(y!==7)throw new Error("unknown command "+y);c&&c.push(c[0].clone())}}return c&&w.push(c),w},e.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var c=u.readVarint()+u.pos,f=1,y=0,b=0,S=0,_=1/0,w=-1/0,M=1/0,T=-1/0;u.pos<c;){if(y<=0){var E=u.readVarint();f=7&E,y=E>>3}if(y--,f===1||f===2)(b+=u.readSVarint())<_&&(_=b),b>w&&(w=b),(S+=u.readSVarint())<M&&(M=S),S>T&&(T=S);else if(f!==7)throw new Error("unknown command "+f)}return[_,M,w,T]},e.prototype.toGeoJSON=function(u,c,f){var y,b,S=this.extent*Math.pow(2,f),_=this.extent*u,w=this.extent*c,M=this.loadGeometry(),T=e.types[this.type];function E(k){for(var U=0;U<k.length;U++){var V=k[U];k[U]=[360*(V.x+_)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+w)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(y=0;y<M.length;y++)C[y]=M[y][0];E(M=C);break;case 2:for(y=0;y<M.length;y++)E(M[y]);break;case 3:for(M=function(k){var U=k.length;if(U<=1)return[k];for(var V,N,$=[],Z=0;Z<U;Z++){var K=a(k[Z]);K!==0&&(N===void 0&&(N=K<0),N===K<0?(V&&$.push(V),V=[k[Z]]):V.push(k[Z]))}return V&&$.push(V),$}(M),y=0;y<M.length;y++)for(b=0;b<M[y].length;b++)E(M[y][b])}M.length===1?M=M[0]:T="Multi"+T;var O={type:"Feature",geometry:{type:T,coordinates:M},properties:this.properties};return"id"in this&&(O.id=this.id),O},ev}function Fb(){if(zb)return tv;zb=1;var o=kb();function e(a,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(n,this,u),this.length=this._features.length}function n(a,u,c){a===15?u.version=c.readVarint():a===1?u.name=c.readString():a===5?u.extent=c.readVarint():a===2?u._features.push(c.pos):a===3?u._keys.push(c.readString()):a===4&&u._values.push(function(f){for(var y=null,b=f.readVarint()+f.pos;f.pos<b;){var S=f.readVarint()>>3;y=S===1?f.readString():S===2?f.readFloat():S===3?f.readDouble():S===4?f.readVarint64():S===5?f.readVarint():S===6?f.readSVarint():S===7?f.readBoolean():null}return y}(c))}return tv=e,e.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var u=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,u,this.extent,this._keys,this._values)},tv}function Bb(){return Ob||(Ob=1,X_.VectorTile=function(){if(Lb)return rv;Lb=1;var o=Fb();function e(n,a,u){if(n===3){var c=new o(u,u.readVarint()+u.pos);c.length&&(a[c.name]=c)}}return rv=function(n,a){this.layers=n.readFields(e,{},a)},rv}(),X_.VectorTileFeature=kb(),X_.VectorTileLayer=Fb()),X_}var Yl=Bb();const du="3d_elevation_id",Nb="level";class lP{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,n){return this._valid&&e(n(this._geometry)),this}require(e,n,a){return this.get(e,!0,n,a)}optional(e,n,a){return this.get(e,!1,n,a)}success(){return this._valid}get(e,n,a,u){const c=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&c!==void 0?a(u?u(c):c):n&&(this._valid=!1),this}}class Vb{constructor(e,n){this.featureFunc=e,this.vertexFunc=n}parseFeature(e,n,a){return this.featureFunc(e,n,a)}parseVertex(e,n,a){return this.vertexFunc(e,n,a)}}const cP=new Vb((o,e,n)=>o.reset(e).require(du,a=>{n.id=a}).optional("fixed_height_relative",a=>{n.constantHeight=a},hl.decodeRelativeHeight).geometry(a=>{n.bounds=a},hl.computeBounds).success(),(o,e,n)=>o.reset(e).require(du,a=>{n.id=a}).require("elevation_idx",a=>{n.idx=a}).require("extent",a=>{n.extent=a}).require("height_relative",a=>{n.height=a},hl.decodeRelativeHeight).geometry(a=>{n.position=a},hl.getPoint).success()),uP=new Vb((o,e,n)=>o.reset(e).require(du,a=>{n.id=a}).optional("fixed_height",a=>{n.constantHeight=a},hl.decodeMetricHeight).geometry(a=>{n.bounds=a},hl.computeBounds).success(),(o,e,n)=>o.reset(e).require(du,a=>{n.id=a}).require("elevation_idx",a=>{n.idx=a}).require("extent",a=>{n.extent=a}).require("height",a=>{n.height=a},hl.decodeMetricHeight).geometry(a=>{n.position=a},hl.getPoint).success());class hl{static computeBounds(e){const n=new Ae(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new Ae(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of e[0])n.x>u.x&&(n.x=u.x),n.y>u.y&&(n.y=u.y),a.x<u.x&&(a.x=u.x),a.y<u.y&&(a.y=u.y);return{min:n,max:a}}static getPoint(e){return te.vec2.fromValues(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const n=[],a=[],u=e.length,c=new lP;for(let y=0;y<u;y++){const b=e.feature(y),S=b.properties.hasOwnProperty("version")?String(b.properties.version):void 0,_=(f=S)?f==="1.0.1"?uP:void 0:cP;if(_===void 0){Rr(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const w=b.properties.hasOwnProperty("type")?b.properties.type:void 0;if(w){if(Yl.VectorTileFeature.types[b.type]==="Point"&&w==="curve_point"){const M={};_.parseVertex(c,b,M)&&n.push(M)}else if(Yl.VectorTileFeature.types[b.type]==="Polygon"&&w==="curve_meta"){const M={};_.parseFeature(c,b,M)&&a.push(M)}}}var f;return{vertices:n,features:a}}}class nv{constructor(e,n,a,u,c,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:a,max:a},this.safeArea=n,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=c,this.edges=this.edges.filter(y=>y.a<this.vertices.length&&y.b<this.vertices.length&&!te.vec2.exactEquals(this.vertices[y.a].position,this.vertices[y.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const y of this.vertices)this.vertexProps.push({dir:te.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,y.height),this.heightRange.max=Math.max(this.heightRange.max,y.height);for(const y of this.edges){const b=this.vertices[y.a].position,S=this.vertices[y.b].position,_=te.vec2.subtract(te.vec2.create(),S,b),w=te.vec2.length(_),M=te.vec2.scale(te.vec2.create(),_,1/w);this.edgeProps.push({vec:_,dir:M,len:w});const T=this.vertexProps[y.a].dir,E=this.vertexProps[y.b].dir;te.vec2.add(T,T,M),te.vec2.add(E,E,M)}for(const y of this.vertexProps)y.dir[0]===0&&y.dir[1]===0||te.vec2.normalize(y.dir,y.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const n=this.getClosestEdge(e);if(n==null)return 0;const[a,u]=n;return((c,f,y)=>(1-y)*c+y*f)(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,u)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let n=0,a=Number.POSITIVE_INFINITY,u=0;const c=te.vec2.fromValues(e.x,e.y);for(let f=0;f<this.edges.length;f++){const y=this.edges[f],b=this.edgeProps[f].dir,S=new hr(c,this.edgeProps[f].dir),_=this.vertices[y.a].position,w=this.vertices[y.b].position,M=te.vec2.create(),T=te.vec2.create(),E=S.intersectsPlane(_,this.vertexProps[y.a].dir,M),C=S.intersectsPlane(w,this.vertexProps[y.b].dir,T);if(!E||!C)continue;const O=te.vec2.subtract(te.vec2.create(),T,M),k=te.vec2.subtract(te.vec2.create(),c,M),U=te.vec2.dot(O,O),V=U>0?te.vec2.dot(k,O)/U:0,N=Ye(V,0,1),$=Math.abs((V-N)*this.edgeProps[f].len),Z=te.vec2.subtract(te.vec2.create(),c,_),K=$+Math.abs(te.vec2.dot(Z,te.vec2.fromValues(b[1],-b[0])));K<a&&(n=f,a=K,u=N)}return[n,u]}tessellate(e){for(let n=this.edges.length-1;n>=0;--n){const a=this.edges[n].a,u=this.edges[n].b,{position:c,height:f,extent:y}=this.vertices[a],{position:b,height:S,extent:_}=this.vertices[u],w=this.vertexProps[a].dir,M=this.vertexProps[u].dir,T=te.vec3.fromValues(c[0]/e,c[1]/e,f),E=te.vec3.fromValues(b[0]/e,b[1]/e,S),C=te.vec3.fromValues(w[1],-w[0],0);te.vec3.scale(C,C,y);const O=te.vec3.fromValues(M[1],-M[0],0);if(te.vec3.scale(O,O,_),this.distSqLines(te.vec3.fromValues(T[0]+.5*C[0],T[1]+.5*C[1],T[2]+.5*C[2]),te.vec3.fromValues(E[0]-.5*O[0],E[1]-.5*O[1],E[2]-.5*O[2]),te.vec3.fromValues(T[0]-.5*C[0],T[1]-.5*C[1],T[2]-.5*C[2]),te.vec3.fromValues(E[0]+.5*O[0],E[1]+.5*O[1],E[2]+.5*O[2]))<=.05*.05)continue;const k=this.vertices.length,U=te.vec2.add(te.vec2.create(),c,b);this.vertices.push({position:te.vec2.scale(U,U,.5),height:.5*(f+S),extent:.5*(y+_)});const V=te.vec2.add(te.vec2.create(),w,M);this.vertexProps.push({dir:te.vec2.normalize(V,V)}),this.edges.splice(n,1),this.edgeProps.splice(n,1),this.edges.push({a,b:k}),this.edges.push({a:k,b:u});const N=te.vec2.subtract(te.vec2.create(),this.vertices[k].position,c),$=te.vec2.length(N),Z={vec:N,dir:te.vec2.scale(te.vec2.create(),N,1/$),len:$};this.edgeProps.push(Z),this.edgeProps.push(Z)}}distSqLines(e,n,a,u){const c=te.vec3.subtract(te.vec3.create(),n,e),f=te.vec3.subtract(te.vec3.create(),u,a),y=te.vec3.subtract(te.vec3.create(),e,a),b=te.vec3.dot(c,c),S=te.vec3.dot(c,f),_=te.vec3.dot(c,y),w=te.vec3.dot(f,f),M=te.vec3.dot(f,y),T=b*w-S*S;if(T===0){const U=te.vec3.dot(y,f)/te.vec3.dot(f,f),V=te.vec3.lerp(te.vec3.create(),a,u,U);return te.vec3.squaredDistance(V,e)}const E=(S*M-_*w)/T,C=(b*M-S*_)/T,O=te.vec3.lerp(te.vec3.create(),e,n,E),k=te.vec3.lerp(te.vec3.create(),a,u,C);return te.vec3.squaredDistance(O,k)}}class hP{constructor(e,n){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(n)||(this.zScale=Math.pow(2,n.z-e.z),this.xOffset=(e.x*this.zScale-n.x)*Ct,this.yOffset=(e.y*this.zScale-n.y)*Ct)}constantElevation(e,n){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,n)}pointElevation(e,n,a){const u=this.constantElevation(n,a);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(n.pointElevation(e),a))}computeBiasedHeight(e,n){return n<=0?e:e+n*Qt(0,n,e>=0?e:Math.abs(.5*e))}}Ft(nv,"ElevationFeature");class Ub{constructor(){this.polygons=new Map}add(e,...n){this.polygons.has(e)?this.polygons.get(e).push(...n):this.polygons.set(e,n)}merge(e){for(const[n,a]of e.polygons)this.add(n,...a)}}class fu{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new fu;let n=[];for(const S of e)n.push(...S.portals);if(n.length===0)return new fu;const a=(S,_)=>S<=0&&_<=0||S>=Ct&&_>=Ct;for(const S of n){const _=S.va,w=S.vb;(a(_.x,w.x)||a(_.y,w.y))&&(S.type="border")}const u=n.filter(S=>S.type!=="unevaluated"),c=n.filter(S=>S.type==="unevaluated");if(c.length===0)return new fu;c.sort((S,_)=>S.hash===_.hash?S.isTunnel===_.isTunnel?0:S.isTunnel?-1:1:S.hash<_.hash?1:-1),n=u.concat(c);let f=u.length,y=f,b=f;do if(y++,y===n.length||n[f].hash!==n[y].hash){if(y-f==2){b<f&&(n[b]=n[f],n[f]=null);const S=n[b],_=n[y-1];S.type=S.isTunnel!==_.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:_.connection.a},b++}f=y}while(f!==n.length);return n.splice(b),n.sort((S,_)=>S.hash<_.hash?1:-1),{portals:n}}}Ft(fu,"ElevationPortalGraph"),Ft(Ub,"ElevationPolygons");class dP{constructor(e,n,a){this.outPositions=e,this.outNormals=n,this.outIndices=a,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,n,a){let u=e[2];a!=null&&(u*=a);const c=this.getVec3Bits(e)<<96n|this.getVec3Bits(n),f=this.vertexLookup.get(c);if(f!=null)return f;const y=this.outPositions.length;this.vertexLookup.set(c,y);const b=Math.trunc(16384*n[0]),S=Math.trunc(16384*n[1]),_=Math.trunc(16384*n[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(b,S,_),y}addVertices(e,n,...a){const u=[];for(const c of a){const f=this.addVertex(c,e,n);u.push(f)}return u}addTriangles(e,n,a){if(n&&a){const u=a.length===1,c=te.vec3.fromValues(0,0,0);for(let f=0;f<e.length;f+=3){const y=n[e[f+0]],b=n[e[f+1]],S=n[e[f+2]],_=u?a[0]:a[e[f+1]],w=u?a[0]:a[e[f+2]],M=this.addVertex(te.vec3.fromValues(y.x,y.y,u?a[0]:a[e[f+0]]),c),T=this.addVertex(te.vec3.fromValues(b.x,b.y,_),c),E=this.addVertex(te.vec3.fromValues(S.x,S.y,w),c);this.outIndices.emplaceBack(M,T,E)}}else for(let u=0;u<e.length;u+=3)this.outIndices.emplaceBack(e[u+0],e[u+1],e[u+2])}addQuad(e,n){const a=this.addVertices(n,void 0,...e.map(b=>te.vec3.fromValues(b.coord.x,b.coord.y,b.height))),[u,c,f,y]=a;this.addTriangles([u,c,f,f,y,u])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class ea{constructor(e){this.unevaluatedPortals=new fu,this.portalPolygons=new Ub,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Xf,this.vertexNormals=new Zs,this.indexArray=new wi,this.tileToMeters=t(e)}addVertices(e,n){const a=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(n[u]);return a}addTriangles(e,n,a){const u=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const c of e)u.push(c+n)}addRenderableRing(e,n,a,u,c){const f=[new Ae(c.min.x,c.min.y),new Ae(c.max.x,c.min.y),new Ae(c.max.x,c.max.y),new Ae(c.min.x,c.max.y)];for(let y=0;y<a-1;y++){const b=n+y,S=b+1,_=this.unevalVertices[b],w=this.unevalVertices[S];if(!(_.x>=c.min.x&&_.x<=c.max.x&&_.y>=c.min.y&&_.y<=c.max.y||w.x>=c.min.x&&w.x<=c.max.x&&w.y>=c.min.y&&w.y<=c.max.y||Ee(_,w,f))||this.isOnBorder(_.x,w.x)||this.isOnBorder(_.y,w.y))continue;const M=ea.computeEdgeHash(this.unevalVertices[b],this.unevalVertices[S]);let T,E=this.vertexHashLookup.get(ea.computePosHash(_));E!=null?T=E.next:(E=this.vertexHashLookup.get(ea.computePosHash(w)),T=E!=null?E.prev:M),this.unevalEdges.push({polygonIdx:e,a:b,b:S,hash:M,portalHash:T,isTunnel:u,type:"unevaluated"})}}addPortalCandidates(e,n,a,u,c){if(n.length===0)return;this.portalPolygons.add(e,{geometry:n,zLevel:c});const f=n[0];this.vertexHashLookup.clear();let y=ea.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let b=0;b<f.length-1;b++){const S=f[b+0],_=f[b+1],w=te.vec2.fromValues(_.x-S.x,_.y-S.y),M=te.vec2.length(w);if(M===0)continue;let T="unevaluated";const E=u.pointElevation(S),C=u.pointElevation(_);Math.abs(E)<.01&&Math.abs(C)<.01?T="entrance":(this.isOnBorder(S.x,_.x)||this.isOnBorder(S.y,_.y))&&(T="border");const O=ea.computeEdgeHash(S,_);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:S,vb:_,vab:w,length:M,hash:O,isTunnel:a,type:T});const k=ea.computePosHash(S);this.vertexHashLookup.set(k,{prev:y,next:O}),y=O}}construct(e){if(this.unevalVertices.length===0)return;const n=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=w=>{w.primitiveLength=this.indexArray.length-w.primitiveOffset},u=new dP(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const c=n(),f=n(),y=n(),b=(w,M)=>{w.sort((E,C)=>E.type===M&&C.type!==M?-1:E.type!==M&&C.type===M?1:0);const T=w.findIndex(E=>E.type!==M);return T>=0?T:w.length};let S=0;this.unevalEdges.length>0&&(S=b(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters));const _=n();if(this.unevalEdges.length>0){const w=this.unevalEdges.splice(S),M=b(w,"tunnel")+S;this.unevalEdges.push(...w),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:M})}a(y),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(_),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(f),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(c),this.maskSegments=Gn.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.depthSegments=Gn.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableSegments=Gn.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.shadowCasterSegments=Gn.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,K3.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Y3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,n,a,u){const c=new Map;for(let f=a;f<u;f++){const y=n[f],b=y.a,S=y.b;c.has(b)||c.set(b,{}),c.has(S)||c.set(S,{});const _=c.get(b),w=c.get(S);e[S]>0&&(_.to=S),e[b]>0&&(w.from=b)}return c}constructBridgeStructures(e,n,a,u,c,f){const y=this.computeVertexConnections(a,u,c.min,c.max),b=1/f,S=.5*b,_=M=>te.vec3.fromValues(n[M].x,n[M].y,a[M]*b),w=M=>{const T=y.get(M),E=T.from,C=T.to;if(!E||!C)return;const O=_(E),k=_(M),U=_(C),V=te.vec3.fromValues(0,0,0);if(!te.vec3.exactEquals(O,k)){const $=te.vec3.sub(te.vec3.create(),k,O);te.vec3.add(V,V,te.vec3.normalize($,$))}if(!te.vec3.exactEquals(U,k)){const $=te.vec3.sub(te.vec3.create(),U,k);te.vec3.add(V,V,te.vec3.normalize($,$))}const N=te.vec3.len(V);return N>0?te.vec3.scale(V,V,1/N):void 0};for(let M=c.min;M<c.max;M++){const T=u[M],E=this.prepareEdgePoints(n,a,T,(ct,rr)=>ct>=rr);if(E==null)continue;const C=E[0],O=E[1],k=te.vec3.fromValues(C.coord.x,C.coord.y,b*C.height),U=te.vec3.fromValues(O.coord.x,O.coord.y,b*O.height);if(te.vec3.exactEquals(k,U))continue;const V=te.vec3.sub(te.vec3.create(),U,k);te.vec3.normalize(V,V);const N=ct=>te.vec3.normalize(ct,ct),$=w(T.a)||V,Z=w(T.b)||V,K=N(te.vec3.fromValues($[1],-$[0],0)),ae=N(te.vec3.fromValues(Z[1],-Z[0],0)),ie=N(te.vec3.cross(te.vec3.create(),K,$)),se=N(te.vec3.cross(te.vec3.create(),ae,Z)),ve=te.vec3.create(),le=[te.vec3.add(te.vec3.create(),k,te.vec3.scale(ve,te.vec3.sub(ve,K,ie),S)),te.vec3.add(te.vec3.create(),k,te.vec3.scale(ve,te.vec3.add(ve,K,ie),S)),te.vec3.add(te.vec3.create(),k,te.vec3.scale(ve,ie,S)),k],xe=[te.vec3.add(te.vec3.create(),U,te.vec3.scale(ve,te.vec3.sub(ve,ae,se),S)),te.vec3.add(te.vec3.create(),U,te.vec3.scale(ve,te.vec3.add(ve,ae,se),S)),te.vec3.add(te.vec3.create(),U,te.vec3.scale(ve,se,S)),U],[Me,Se]=e.addVertices(K,f,le[0],le[1]),[Pe,Ce]=e.addVertices(ae,f,xe[0],xe[1]);e.addTriangles([Me,Se,Pe,Se,Ce,Pe]);const[Fe,Le]=e.addVertices(ie,f,le[1],le[2]),[Ne,ot]=e.addVertices(se,f,xe[1],xe[2]);e.addTriangles([Fe,Le,Ne,Le,ot,Ne]);const[it,Bt]=e.addVertices(te.vec3.negate(K,K),f,le[2],le[3]),[_t,At]=e.addVertices(te.vec3.negate(ae,ae),f,xe[2],xe[3]);e.addTriangles([it,Bt,_t,Bt,At,_t])}}constructTunnelStructures(e,n,a,u,c,f){const y=b=>te.vec3.normalize(b,b);for(let b=c.min;b<c.max;b++){const S=this.prepareEdgePoints(n,a,u[b],(T,E)=>T<=E);if(S==null)continue;const[_,w]=S,M=y(te.vec3.fromValues(w.coord.y-_.coord.y,-(w.coord.x-_.coord.x),0));e.addQuad([_,w,{coord:w.coord,height:u[b].isTunnel?-.1:0},{coord:_.coord,height:u[b].isTunnel?-.1:0}],M)}for(let b=f.min;b<f.max;b++){const S=u[b],_=n[S.a],w=n[S.b],M=y(te.vec3.fromValues(w.y-_.y,-(w.x-_.x),0));e.addQuad([{coord:w,height:0},{coord:_,height:0},{coord:_,height:a[S.a]+4},{coord:w,height:a[S.b]+4}],M),e.addQuad([{coord:_,height:0},{coord:w,height:0},{coord:w,height:a[S.b]+4},{coord:_,height:a[S.a]+4}],M)}}prepareEdgePoints(e,n,a,u){const c=e[a.a],f=e[a.b];let y=n[a.a],b=n[a.b];if(!(y!==0&&u(y,0)||b!==0&&u(b,0)))return;const S=c.clone(),_=f.clone();if(u(y,0)){if(!u(b,0)){const w=b/(b-y);_.x=ar(_.x,S.x,w),_.y=ar(_.y,S.y,w),b=ar(b,y,w)}}else{const w=y/(y-b);S.x=ar(S.x,_.x,w),S.y=ar(S.y,_.y,w),y=ar(y,b,w)}return[{coord:S,height:y},{coord:_,height:b}]}prepareEdges(e,n){if(n.length===0)return;n.sort((y,b)=>y.hash===b.hash?b.polygonIdx-y.polygonIdx:b.hash>y.hash?1:-1);let a=0,u=0,c=0,f=n[a].polygonIdx;do u++,(u===n.length||n[a].hash!==n[u].hash)&&((u-a==1||n[u-1].polygonIdx!==f)&&(c<a&&(n[c]=n[a],n[a]=null),n[c].type="none",c++),a=u,a!==n.length&&(f=n[a].polygonIdx));while(a!==n.length);if(n.splice(c),n.length!==0&&e.length!==0){n.sort((S,_)=>S.hash<_.hash?1:-1);let y=0,b=0;for(;y!==n.length&&b!==e.length;){const S=n[y],_=e[b];S.portalHash>_.hash?y++:_.hash>S.portalHash?b++:(S.type=_.type,y++)}}}isOnBorder(e,n){return e<=0&&n<=0||e>=Ct&&n>=Ct}static computeEdgeHash(e,n){return(e.y===n.y&&e.x>n.x||e.y>n.y)&&([e,n]=[n,e]),BigInt(ea.computePosHash(e))<<32n|BigInt(ea.computePosHash(n))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}class iv{constructor(e,n){this.layoutVertexArray=new Co,this.indexArray=new wi,this.lineIndexArray=new Aa,this.triangleSegments=new Gn,this.lineSegments=new Gn,this.programConfigurations=new Pa(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,n&&(this.elevatedLayoutVertexArray=new Sa)}update(e,n,a,u,c,f,y){this.programConfigurations.updatePaintArrays(e,n,c,a,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Z3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,X3.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,n,a,u,c,f){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,a,u,c,f)}}class sv{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new iv(e,!1),this.elevationBufferData=new iv(e,!0),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,n){}populate(e,n,a,u){this.hasPattern=J0("fill",this.layers,this.pixelRatio,n);const c=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:y,id:b,index:S,sourceLayerIndex:_}of e){const w=this.layers[0]._featureFilter.needGeometry,M=F(y,w);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),M,a))continue;const T=c?c.evaluate(M,{},a,n.availableImages):void 0,E={id:b,properties:y.properties,type:y.type,sourceLayerIndex:_,index:S,geometry:w?M.geometry:L(y,a,u),patterns:{},sortKey:T};f.push(E)}c&&f.sort((y,b)=>y.sortKey-b.sortKey);for(const y of f){const{geometry:b,index:S,sourceLayerIndex:_}=y;if(this.hasPattern){const w=Q0("fill",this.layers,y,this.zoom,this.pixelRatio,n);this.patternFeatures.push(w)}else this.addFeature(y,b,S,a,{},n.availableImages,n.brightness,n.elevationFeatures);n.featureIndex.insert(e[S].feature,b,S,_,this.index)}}update(e,n,a,u,c,f,y){this.bufferData.update(e,n,a,u,c,f,y),this.elevationBufferData.update(e,n,a,u,c,f,y)}addFeatures(e,n,a,u,c,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,a,u,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,n,a,u,c,f=[],y,b){const S=Z_(n,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,S,u,a,b):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(e,a,c,f,u,y),this.elevationBufferData.populatePaintArrays(e,a,c,f,u,y)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,n,a,u,c){const f=new Array,y=this.getElevationFeature(e,c);if(y){f.push({polygons:n,elevationFeature:y,elevationTileID:a});for(const b of f)if(b.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ea(b.elevationTileID));const _=b.elevationFeature.isTunnel();let w=0;e.properties.hasOwnProperty(Nb)&&(w=+e.properties[Nb]);for(const M of b.polygons)this.elevatedStructures.addPortalCandidates(b.elevationFeature.id,M,_,b.elevationFeature,w)}const S=new hP(a,b.elevationTileID);this.addElevatedGeometry(b.polygons,S,b.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u)}}else this.addGeometry(n,this.bufferData)}addElevatedGeometry(e,n,a,u,c){const f={elevation:a,elevationSampler:n,bias:u,index:c},[y,b]=this.addGeometry(e,this.elevationBufferData,f);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:y,max:b}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,y),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,b))}addGeometry(e,n,a){let u=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=null;a&&(f=a.elevationSampler.constantElevation(a.elevation,a.bias),f!=null&&(u=f,c=f));const y=(b,S,_)=>{if(a!=null)if(S.push(b),f!=null)n.elevatedLayoutVertexArray.emplaceBack(f),_.push(f);else{const w=a.elevationSampler.pointElevation(b,a.elevation,a.bias);n.elevatedLayoutVertexArray.emplaceBack(w),_.push(w),u=Math.min(u,w),c=Math.max(c,w)}};for(const b of e){let S=0;for(const V of b)S+=V.length;const _=n.triangleSegments.prepareSegment(S,n.layoutVertexArray,n.indexArray),w=_.vertexLength,M=[],T=[],E=[],C=[],O=[],k=n.layoutVertexArray.length;for(const V of b){if(V.length===0)continue;V!==b[0]&&T.push(M.length/2);const N=n.lineSegments.prepareSegment(V.length,n.layoutVertexArray,n.lineIndexArray),$=N.vertexLength;a&&O.push(n.layoutVertexArray.length-k),y(V[0],E,C),n.layoutVertexArray.emplaceBack(V[0].x,V[0].y),n.lineIndexArray.emplaceBack($+V.length-1,$),M.push(V[0].x),M.push(V[0].y);for(let Z=1;Z<V.length;Z++)y(V[Z],E,C),n.layoutVertexArray.emplaceBack(V[Z].x,V[Z].y),n.lineIndexArray.emplaceBack($+Z-1,$+Z),M.push(V[Z].x),M.push(V[Z].y);N.vertexLength+=V.length,N.primitiveLength+=V.length}const U=xp(M,T);for(let V=0;V<U.length;V+=3)n.indexArray.emplaceBack(w+U[V],w+U[V+1],w+U[V+2]);if(a&&this.elevationMode==="hd-road-base"){const V=a.elevation.isTunnel(),N=a.elevation.safeArea,$=this.elevatedStructures.addVertices(E,C);this.elevatedStructures.addTriangles(U,$,V);const Z=O.length;if(Z>0){for(let K=0;K<Z-1;K++)this.elevatedStructures.addRenderableRing(a.index,O[K]+$,O[K+1]-O[K],V,N);this.elevatedStructures.addRenderableRing(a.index,O[Z-1]+$,E.length-O[Z-1],V,N)}}_.vertexLength+=S,_.primitiveLength+=U.length/3}return[u,c]}getElevationFeature(e,n){if(!n)return;const a=+e.properties[du];return a!=null?n.find(u=>u.id===a):void 0}}let jb,$b,Gb,Hb;Ft(sv,"FillBucket",{omit:["layers","patternFeatures"]}),Ft(iv,"FillBufferData"),Ft(ea,"ElevatedStructures");class ov{constructor(e,n,a,u){if(this.triangleCount=n.length/3,this.min=new Ae(0,0),this.max=new Ae(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[c,f]=[e[0].clone(),e[0].clone()];for(let w=1;w<e.length;++w){const M=e[w];c.x=Math.min(c.x,M.x),c.y=Math.min(c.y,M.y),f.x=Math.max(f.x,M.x),f.y=Math.max(f.y,M.y)}if(u){const w=Math.ceil(Math.max(f.x-c.x,f.y-c.y)/u);a=Math.max(a,w)}if(a===0)return;this.min=c,this.max=f;const y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);const b=Math.max(y.x,y.y)/a;this.cellsX=Math.max(1,Math.ceil(y.x/b)),this.cellsY=Math.max(1,Math.ceil(y.y/b)),this.xScale=1/b,this.yScale=1/b;const S=[];for(let w=0;w<this.triangleCount;w++){const M=e[n[3*w+0]].sub(this.min),T=e[n[3*w+1]].sub(this.min),E=e[n[3*w+2]].sub(this.min),C=za(Math.floor(Math.min(M.x,T.x,E.x)),this.xScale,this.cellsX),O=za(Math.floor(Math.max(M.x,T.x,E.x)),this.xScale,this.cellsX),k=za(Math.floor(Math.min(M.y,T.y,E.y)),this.yScale,this.cellsY),U=za(Math.floor(Math.max(M.y,T.y,E.y)),this.yScale,this.cellsY),V=new Ae(0,0),N=new Ae(0,0),$=new Ae(0,0),Z=new Ae(0,0);for(let K=k;K<=U;++K){V.y=N.y=K*b,$.y=Z.y=(K+1)*b;for(let ae=C;ae<=O;++ae)V.x=$.x=ae*b,N.x=Z.x=(ae+1)*b,(Be(M,T,E,V,N,Z)||Be(M,T,E,V,Z,$))&&S.push({cellIdx:K*this.cellsX+ae,triIdx:w})}}if(S.length===0)return;S.sort((w,M)=>w.cellIdx-M.cellIdx||w.triIdx-M.triIdx);let _=0;for(;_<S.length;){const w=S[_].cellIdx,M={start:this.payload.length,len:0};for(;_<S.length&&S[_].cellIdx===w;)++M.len,this.payload.push(S[_++].triIdx);this.cells[w]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=za(e.x-this.min.x,this.xScale,this.cellsX),u=za(e.y-this.min.y,this.yScale,this.cellsY),c=this.cells[u*this.cellsX+a];if(c){this._lazyInitLookup();for(let f=0;f<c.len;f++){const y=this.payload[c.start+f],b=Math.floor(y/8),S=1<<y%8;if(!(this.lookup[b]&S)&&(this.lookup[b]|=S,n.push(y),n.length===this.triangleCount))return}}}query(e,n,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this._lazyInitLookup();const u=za(e.x-this.min.x,this.xScale,this.cellsX),c=za(n.x-this.min.x,this.xScale,this.cellsX),f=za(e.y-this.min.y,this.yScale,this.cellsY),y=za(n.y-this.min.y,this.yScale,this.cellsY);for(let b=f;b<=y;b++)for(let S=u;S<=c;S++){const _=this.cells[b*this.cellsX+S];if(_)for(let w=0;w<_.len;w++){const M=this.payload[_.start+w],T=Math.floor(M/8),E=1<<M%8;if(!(this.lookup[T]&E)&&(this.lookup[T]|=E,a.push(M),a.length===this.triangleCount))return}}}}function za(o,e,n){return Math.max(0,Math.min(n-1,Math.floor(o*e)))}Ft(ov,"TriangleGridIndex");class qb{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.footprints=[]}updateFootprints(e,n){for(const a of this.footprints)n.push({footprint:a,id:e})}populate(e,n,a,u){const c=[];for(const{feature:f,id:y,index:b,sourceLayerIndex:S}of e){const _=this.layers[0]._featureFilter.needGeometry,w=F(f,_);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),w,a))continue;const M={id:y,properties:f.properties,type:f.type,sourceLayerIndex:S,index:b,geometry:_?w.geometry:L(f,a,u),patterns:{}};c.push(M)}for(const f of c){const{geometry:y,index:b,sourceLayerIndex:S}=f;this.addFeature(f,y,b,a,{},n.availableImages,n.brightness),n.featureIndex.insert(e[b].feature,y,b,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,n,a,u,c,f,y){}destroy(){}addFeature(e,n,a,u,c,f=[],y){for(const b of Z_(n,2)){const S=[],_=[],w=[],M=new Ae(1/0,1/0),T=new Ae(-1/0,-1/0);for(const O of b)if(O.length!==0){O!==b[0]&&w.push(_.length/2);for(let k=0;k<O.length;k++)_.push(O[k].x),_.push(O[k].y),S.push(O[k]),M.x=Math.min(M.x,O[k].x),M.y=Math.min(M.y,O[k].y),T.x=Math.max(T.x,O[k].x),T.y=Math.max(T.y,O[k].y)}const E=xp(_,w),C=new ov(S,E,8,256);this.footprints.push({vertices:S,indices:E,grid:C,min:M,max:T})}}}Ft(qb,"ClipBucket",{omit:["layers"]});const fP=Jr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pP=Jr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),mP=Jr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),_P=Jr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),gP=Jr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),yP=Jr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:vP}=fP;class pu extends Ae{constructor(e,n,a){super(e,n),this.z=a}}class Wb extends pu{constructor(e,n,a,u){super(e,n,a),this.w=u}}function K_(o,e,n,a){const u=[],c=a===0?(f,y,b,S,_,w)=>{f.push(new Ae(w,b+(w-y)/(S-y)*(_-b)))}:(f,y,b,S,_,w)=>{f.push(new Ae(y+(w-b)/(_-b)*(S-y),w))};for(const f of o){const y=[];for(const b of f){if(b.length<=2)continue;const S=[];for(let M=0;M<b.length-1;M++){const T=b[M].x,E=b[M].y,C=b[M+1].x,O=b[M+1].y,k=a===0?T:E,U=a===0?C:O;k<e?U>e&&c(S,T,E,C,O,e):k>n?U<n&&c(S,T,E,C,O,n):S.push(b[M]),U<e&&k>=e&&c(S,T,E,C,O,e),U>n&&k<=n&&c(S,T,E,C,O,n)}let _=b[b.length-1];const w=a===0?_.x:_.y;w>=e&&w<=n&&S.push(_),S.length&&(_=S[S.length-1],S[0].x===_.x&&S[0].y===_.y||S.push(S[0]),y.push(S))}y.length&&u.push(y)}return u}function Zb(o,e,n,a){const u=n==="x"?"y":"x",c=(a-o[n])/(e[n]-o[n]);o[u]=o[u]+(e[u]-o[u])*c,o[n]=a,o.hasOwnProperty("z")&&(o.z=ar(o.z,e.z,c)),o.hasOwnProperty("w")&&(o.w=ar(o.w,e.w,c))}function Xb(o,e,n,a){const u=n,c=a;for(const f of["x","y"]){let y=o,b=e;y[f]>=b[f]&&(y=e,b=o),y[f]<u&&b[f]>u&&Zb(y,b,f,u),y[f]<c&&b[f]>c&&Zb(b,y,f,c)}}const Y_=Number.MAX_SAFE_INTEGER;function Kb(o,e,n,a){return o.order<e||o.order===Y_||!(o.clipMask&n)||function(u,c){return c.length!==0&&c.find(f=>f===u)===void 0}(a,o.clipScope)}function J_(o,e){return o.x-e.x||o.y-e.y}function Yb(o,e){return J_(o.min,e.min)===0&&J_(o.max,e.max)===0}function av(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function lv(o,e){if(o.length!==e.length)return!1;for(let n=0;n<o.length;n++)if(o[n].sourceId!==e[n].sourceId||!Yb(o[n],e[n])||o[n].order!==e[n].order||o[n].clipMask!==e[n].clipMask||!wt(o[n].clipScope,e[n].clipScope))return!1;return!0}function Jb(o,e,n){const a=1/Ct,u=1/(1<<n.canonical.z),c=(e.x*a+n.canonical.x)*u+n.wrap,f=(e.y*a+n.canonical.y)*u;return{min:new Ae((o.x*a+n.canonical.x)*u+n.wrap,(o.y*a+n.canonical.y)*u),max:new Ae(c,f)}}function xP(o,e,n){const a=1<<n.canonical.z,u=((e.x-n.wrap)*a-n.canonical.x)*Ct,c=(e.y*a-n.canonical.y)*Ct;return{min:new Ae(((o.x-n.wrap)*a-n.canonical.x)*Ct,(o.y*a-n.canonical.y)*Ct),max:new Ae(u,c)}}function Qb(o,e,n,a,u,c,f){const y=o.indices,b=o.vertices,S=[];for(let _=a;_<a+u;_+=3){const w=e[n[_+0]+c],M=e[n[_+1]+c],T=e[n[_+2]+c],E=Math.min(w.x,M.x,T.x),C=Math.max(w.x,M.x,T.x),O=Math.min(w.y,M.y,T.y),k=Math.max(w.y,M.y,T.y);S.length=0,o.grid.query(new Ae(E,O),new Ae(C,k),S);for(let U=0;U<S.length;U++){const V=S[U];if(Be(b[y[3*V+0]],b[y[3*V+1]],b[y[3*V+2]],w,M,T,f))return!0}}return!1}function ew(o,e,n,a){if(!o||!n)return!1;let u=o.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(n.vertices.length<o.vertices.length)return ew(n,a,o,e);const c=e.canonical,f=a.canonical,y=Math.pow(2,f.z-c.z);u=o.vertices.map(b=>new Ae((b.x+c.x*Ct)*y-f.x*Ct,(b.y+c.y*Ct)*y-f.y*Ct))}return Qb(n,u,o.indices,0,o.indices.length,0,0)}function tw(o,e,n,a){const u=Math.pow(2,a.z-n.z);return new Ae((o+n.x*Ct)*u-a.x*Ct,(e+n.y*Ct)*u-a.y*Ct)}function rw(o,e){const n=[];e.grid.queryPoint(o,n);const a=e.indices,u=e.vertices;for(let c=0;c<n.length;c++){const f=n[c];if(me([u[a[3*f+0]],u[a[3*f+1]],u[a[3*f+2]]],o))return!0}return!1}const cv=[new Ae(0,0),new Ae(Ct,0),new Ae(Ct,Ct),new Ae(0,Ct)];function nw(o,e){const n=[];let a=[];if(!e||o.length<2)return[o];if(o.length===2)return Ee(o[0],o[1],cv)?[o]:[];for(let u=0;u<o.length+2;u++){const c=o[u%o.length],f=o[(u+1)%o.length],y=Ee(u===0?o[o.length-1]:o[(u-1)%o.length],c,cv),b=Ee(c,f,cv),S=y||b;S&&a.push(c),S&&b||a.length>0&&(a.length>1&&n.push(a),a=[])}return a.length>1&&n.push(a),n}const uv=Yl.VectorTileFeature.types,bP=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],wP=["fill-extrusion-flood-light-ground-radius"],TP=Math.pow(2,13),SP=Math.pow(2,15)-1,iw=new Ae(0,1),Jl=2147483648;function Sp(o,e,n,a,u,c,f,y){o.emplaceBack((e<<1)+f,(n<<1)+c,(Math.floor(a*TP)<<1)+u,Math.round(y))}function Ep(o,e,n){o.emplaceBack(e.x*Ct,e.y*Ct,n?1:0)}function Q_(o,e,n,a,u,c){o.emplaceBack(e.x,e.y,(n.x<<1)+a,(n.y<<1)+u,c)}function Ap(o,e,n){o.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class sw{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ow{constructor(){this.centroidXY=new Ae(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ae(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ae(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ae(this.max.x-this.min.x,this.max.y-this.min.y)}}class aw{constructor(){this.acc=new Ae(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,a){this.accCount++,this.acc._add(n);let u=!!this.borders;n.x<e.min.x?(e.min.x=n.x,u=!0):n.x>e.max.x&&(e.max.x=n.x,u=!0),n.y<e.min.y?(e.min.y=n.y,u=!0):n.y>e.max.y&&(e.max.y=n.y,u=!0),((n.x===0||n.x===Ct)&&n.x===a.x)!=((n.y===0||n.y===Ct)&&n.y===a.y)&&this.processBorderOverlap(n,a),u&&this.checkBorderIntersection(n,a)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,ar(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Ct!=e.x>Ct&&this.addBorderIntersection(1,ar(n.y,e.y,(Ct-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,ar(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Ct!=e.y>Ct&&this.addBorderIntersection(3,ar(n.x,e.x,(Ct-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];n<a[0]&&(a[0]=n),n>a[1]&&(a[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,n.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,n.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Ae(0,0):new Ae(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function lw(o,e){const n=o.add(e)._unit(),a=Ye(o.x*n.x+o.y*n.y,-1,1);var u,c,f;return f=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(f)))/4*SP*((u=o).x*(c=e).y-u.y*c.x<0?-1:1)}const EP=[o=>o.x<0,o=>o.x>Ct,o=>o.y<0,o=>o.y>Ct];function AP(o,e,n,a){const u=[4];if(a===0)return u;n._mult(a);const c=o.sub(n),f=e.sub(n),y=[o,e,c,f];for(let b=0;b<4;b++)for(const S of y)if(EP[b](S)){u.push(b);break}return u}class cw{constructor(e){this.vertexArray=new Kf,this.indexArray=new wi,this.programConfigurations=new Pa(e.layers,{zoom:e.zoom,lut:e.lut},n=>wP.includes(n)),this._segments=new Gn,this.hiddenByLandmarkVertexArray=new Hh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Gn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,a,u=!1){const c=e.length;if(c>2){let f=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let b;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const S=e[0],_=e[1];b=lw(S.sub(e[c-1])._perp()._unit(),_.sub(S)._perp()._unit())}for(let S=0;S<c;S++){const _=S===c-1?0:S+1,w=e[S],M=e[_],T=e[_===c-1?0:_+1],E=M.sub(w)._perp()._unit(),C=lw(E,T.sub(M)._perp()._unit()),O=b,k=C;if(hv(w,M,n)||u&&dw(w,n)&&dw(M,n)){b=C;continue}const U=y.vertexLength;Q_(this.vertexArray,w,M,1,1,O),Q_(this.vertexArray,w,M,1,0,O),Q_(this.vertexArray,w,M,0,1,k),Q_(this.vertexArray,w,M,0,0,k),y.vertexLength+=4;const V=AP(w,M,E,a);for(const N of V)this._segmentToGroundQuads[f].push({id:U,region:N}),this._segmentToRegionTriCounts[f][N]+=2,y.primitiveLength+=2;b=C}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),n=e.length;for(let a=0;a<n;a++)this._segmentToGroundQuads[a].sort((u,c)=>u.region-c.region);for(let a=0;a<n;a++){const u=this._segmentToGroundQuads[a],c=e[a],f=this._segmentToRegionTriCounts[a];f.reduce((b,S)=>b+S,0);let y=0;for(let b=0;b<=4;b++){const S=f[b];if(S!==0){let _=this.regionSegments[b];_||(_=this.regionSegments[b]=new Gn);const w={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+y,vertexLength:c.vertexLength,primitiveLength:S};_.get().push(w)}y+=S}for(let b=0;b<u.length;b++){const S=u[b].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,a,u,c,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,a,u,c,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,pP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,a,u,c,f,y){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,a,u,c,f,y)}updateHiddenByLandmark(e){if(!this.hasData())return;const n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&Jl?1:0;for(let u=e.groundVertexArrayOffset;u<n;++u)this.hiddenByLandmarkVertexArray.emplace(u,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,gP.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const n=this.regionSegments[e];n&&n.destroy()}}}}class eg{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new wi,this.footprintVertices=new Co,this.footprintSegments=[],this.layoutVertexArray=new ol,this.centroidVertexArray=new V_,this.wallVertexArray=new j_,this.indexArray=new wi,this.programConfigurations=new Pa(e.layers,{zoom:e.zoom,lut:e.lut},n=>bP.includes(n)),this.segments=new Gn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new cw(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,n){}populate(e,n,a,u){this.features=[],this.hasPattern=J0("fill-extrusion",this.layers,this.pixelRatio,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=t(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:c,id:f,index:y,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,_=F(c,S);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),_,a))continue;const w={id:f,sourceLayerIndex:b,index:y,geometry:S?_.geometry:L(c,a,u),properties:c.properties,type:c.type,patterns:{}},M=this.layoutVertexArray.length,T=uv[w.type]==="Polygon";if(this.hasPattern)this.features.push(Q0("fill-extrusion",this.layers,w,this.zoom,this.pixelRatio,n));else if(this.wallMode)for(const E of w.geometry)for(const C of nw(E,T))this.addFeature(w,[C],y,a,{},n.availableImages,u,n.brightness);else this.addFeature(w,w.geometry,y,a,{},n.availableImages,u,n.brightness);n.featureIndex.insert(c,w.geometry,y,b,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,a,u,c,f){for(const y of this.features){const b=uv[y.type]==="Polygon",{geometry:S}=y;if(this.wallMode)for(const _ of S)for(const w of nw(_,b))this.addFeature(y,[w],y.index,n,a,u,c,f);else this.addFeature(y,S,y.index,n,a,u,c,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,a,u,c,f,y){this.programConfigurations.updatePaintArrays(e,n,c,a,u,f,y),this.groundEffect.update(e,n,c,a,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,_P.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,yP.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,mP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,a,u,c,f,y,b){const S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,_=[new Ae(0,0),new Ae(Ct,Ct)],w=y.projection,M=w.name==="globe",T=this.wallMode||uv[e.type]==="Polygon",E=new aw;E.centroidDataIndex=this.centroidData.length;const C=new ow,O=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,k=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);let U;if(C.height=k,C.vertexArrayOffset=this.layoutVertexArray.length,C.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Nh),this.wallMode){if(M)return void Rr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(n.length!==1)return;U=function(se){const ve=se[0].x===se[se.length-1].x&&se[0].y===se[se.length-1].y;(function(At){let ct=0;const rr=At.length;for(let Ot=0;Ot<rr;Ot++)ct+=(At[(Ot+1)%rr].x-At[Ot].x)*(At[(Ot+1)%rr].y+At[Ot].y);return ct>=0})(se)||(se=se.reverse());const xe={geometry:[],joinNormals:[],indices:[]},Me=[],Se=[],Pe=[];let Ce=se.length;for(;Ce>=2&&se[Ce-1].equals(se[Ce-2]);)Ce--;if(Ce<(ve?3:2))return xe;let Fe,Le,Ne,ot,it,Bt=0;for(;Bt<Ce-1&&se[Bt].equals(se[Bt+1]);)Bt++;ve&&(Fe=se[Ce-2],it=se[Bt].sub(Fe)._unit()._perp());for(let At=Bt;At<Ce;At++){if(Ne=At===Ce-1?ve?se[Bt+1]:void 0:se[At+1],Ne&&se[At].equals(Ne))continue;it&&(ot=it),Fe&&(Le=Fe),Fe=se[At],it=Ne?Ne.sub(Fe)._unit()._perp():ot,ot=ot||it;let ct=ot.add(it);ct.x===0&&ct.y===0||ct._unit();const rr=ct.x*it.x+ct.y*it.y,Ot=rr!==0?1/rr:1/0,qt=ot.x*it.y-ot.y*it.x>0;let dr="miter";const Ir=2;dr==="miter"&&Ot>Ir&&(dr="bevel"),dr==="bevel"&&(Ot>100&&(dr="flipbevel"),Ot<Ir&&(dr="miter"));const yr=(Lr,Er,Fr,Yr)=>{const wn=new Ae(Lr.x,Lr.y),_r=new Ae(Lr.x,Lr.y);wn.x+=Er.x*Yr,wn.y+=Er.y*Yr,_r.x-=Er.x*Math.max(Fr,1),_r.y-=Er.y*Math.max(Fr,1),Pe.push(Er),Me.push(wn),Se.push(_r)};if(dr==="miter")ct._mult(Ot),yr(Fe,ct,0,0);else if(dr==="flipbevel")ct=it.mult(-1),yr(Fe,ct,0,0),yr(Fe,ct.mult(-1),0,0);else{const Lr=-Math.sqrt(Ot*Ot-1),Er=qt?Lr:0,Fr=qt?0:Lr;Le&&yr(Fe,ot,Er,Fr),Ne&&yr(Fe,it,Er,Fr)}}xe.geometry=[...Me,...Se.reverse(),Me[0]],xe.joinNormals=[...Pe,...Pe.reverse(),Pe[Pe.length-1]];const _t=xe.geometry.length-1;for(let At=0;At<_t/2;At++)if(At+1<_t/2){let ct=At,rr=At+1,Ot=_t-1-At,qt=_t-2-At;ct=ct===0?_t-1:ct-1,rr=rr===0?_t-1:rr-1,Ot=Ot===0?_t-1:Ot-1,qt=qt===0?_t-1:qt-1,xe.indices.push(Ot),xe.indices.push(rr),xe.indices.push(ct),xe.indices.push(Ot),xe.indices.push(qt),xe.indices.push(rr)}return xe}(n[0]),n=[U.geometry]}const V=(se,ve)=>se<(ve.length-1)/2||se===ve.length-1,N=this.wallMode?[n]:Z_(n,500);for(let se=N.length-1;se>=0;se--){const ve=N[se];(ve.length===0||($=ve[0]).every(le=>le.x<=0)||$.every(le=>le.x>=Ct)||$.every(le=>le.y<=0)||$.every(le=>le.y>=Ct))&&N.splice(se,1)}var $;let Z;if(M)Z=_w(N,_,u);else{Z=[];for(const se of N)Z.push({polygon:se,bounds:_})}const K=T?this.edgeRadius:0,ae=K>0&&this.zoom<17,ie=(se,ve)=>{if(se.length===0)return!1;const le=se[se.length-1];return ve.x===le.x&&ve.y===le.y};for(const{polygon:se,bounds:ve}of Z){let le=0,xe=0;for(const Ce of se)T&&!Ce[0].equals(Ce[Ce.length-1])&&Ce.push(Ce[0]),xe+=T?Ce.length-1:Ce.length;const Me=this.segments.prepareSegment((T?5:4)*xe,this.layoutVertexArray,this.indexArray);C.footprintSegIdx<0&&(C.footprintSegIdx=this.footprintSegments.length),C.polygonSegIdx<0&&(C.polygonSegIdx=this.polygonSegments.length);const Se={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Pe=new sw;if(Pe.vertexOffset=this.footprintVertices.length,Pe.indexOffset=3*this.footprintIndices.length,Pe.ringIndices=[],T){const Ce=[],Fe=[];le=Me.vertexLength;for(let Ne=0;Ne<se.length;Ne++){const ot=se[Ne];ot.length&&Ne!==0&&Fe.push(Ce.length/2);const it=[];let Bt,_t;Bt=ot[1].sub(ot[0])._perp()._unit(),Pe.ringIndices.push(ot.length-1);for(let At=1;At<ot.length;At++){const ct=ot[At],rr=ot[At===ot.length-1?1:At+1],Ot=ct.clone();if(K){_t=rr.sub(ct)._perp()._unit();const qt=Bt.add(_t)._unit(),dr=K*Math.min(4,1/(Bt.x*qt.x+Bt.y*qt.y));Ot.x+=dr*qt.x,Ot.y+=dr*qt.y,Ot.x=Math.round(Ot.x),Ot.y=Math.round(Ot.y),Bt=_t}if(!O||K!==0&&!ae||ie(it,Ot)||it.push(Ot),Sp(this.layoutVertexArray,Ot.x,Ot.y,0,0,1,1,0),this.wallMode){const qt=V(At,ot);Ep(this.wallVertexArray,U.joinNormals[At],!qt)}Me.vertexLength++,this.footprintVertices.emplaceBack(ct.x,ct.y),Ce.push(ct.x,ct.y),M&&Ap(this.layoutVertexExtArray,w.projectTilePoint(Ot.x,Ot.y,u),w.upVector(u,Ot.x,Ot.y))}O&&(K===0||ae)&&(it.length!==0&&ie(it,it[0])&&it.pop(),this.groundEffect.addData(it,ve,S))}const Le=this.wallMode?U.indices:xp(Ce,Fe);for(let Ne=0;Ne<Le.length;Ne+=3)this.footprintIndices.emplaceBack(Pe.vertexOffset+Le[Ne+0],Pe.vertexOffset+Le[Ne+1],Pe.vertexOffset+Le[Ne+2]),this.indexArray.emplaceBack(le+Le[Ne],le+Le[Ne+2],le+Le[Ne+1]),Me.primitiveLength++;Pe.indexCount+=Le.length,Pe.vertexCount+=this.footprintVertices.length-Pe.vertexOffset}for(let Ce=0;Ce<se.length;Ce++){const Fe=se[Ce];E.startRing(C,Fe[0]);let Le=Fe.length>4&&fw(Fe[Fe.length-2],Fe[0],Fe[1]),Ne=K?MP(Fe[Fe.length-2],Fe[0],Fe[1],K):0;const ot=[];let it,Bt,_t;Bt=Fe[1].sub(Fe[0])._perp()._unit();let At=!0;for(let ct=1,rr=0;ct<Fe.length;ct++){let Ot=Fe[ct-1],qt=Fe[ct];const dr=Fe[ct===Fe.length-1?1:ct+1];if(E.appendEdge(C,qt,Ot),hv(qt,Ot,ve)){K&&(Bt=dr.sub(qt)._perp()._unit(),At=!At);continue}const Ir=qt.sub(Ot)._perp(),yr=Ir.x/(Math.abs(Ir.x)+Math.abs(Ir.y)),Lr=Ir.y>0?1:0,Er=Ot.dist(qt);if(rr+Er>32768&&(rr=0),K){_t=dr.sub(qt)._perp()._unit();let _r=hw(Ot,qt,dr,uw(Bt,_t),K);isNaN(_r)&&(_r=0);const $r=qt.sub(Ot)._unit();Ot=Ot.add($r.mult(Ne))._round(),qt=qt.add($r.mult(-_r))._round(),Ne=_r,Bt=_t,O&&this.zoom>=17&&(ie(ot,Ot)||ot.push(Ot),ie(ot,qt)||ot.push(qt))}const Fr=Me.vertexLength,Yr=Fe.length>4&&fw(Ot,qt,dr);let wn=pw(rr,Le,At);if(Sp(this.layoutVertexArray,Ot.x,Ot.y,yr,Lr,0,0,wn),Sp(this.layoutVertexArray,Ot.x,Ot.y,yr,Lr,0,1,wn),this.wallMode){const _r=V(ct-1,Fe),$r=U.joinNormals[ct-1];Ep(this.wallVertexArray,$r,_r),Ep(this.wallVertexArray,$r,_r)}if(rr+=Er,wn=pw(rr,Yr,!At),Le=Yr,Sp(this.layoutVertexArray,qt.x,qt.y,yr,Lr,0,0,wn),Sp(this.layoutVertexArray,qt.x,qt.y,yr,Lr,0,1,wn),this.wallMode){const _r=V(ct,Fe),$r=U.joinNormals[ct];Ep(this.wallVertexArray,$r,_r),Ep(this.wallVertexArray,$r,_r)}if(Me.vertexLength+=4,this.indexArray.emplaceBack(Fr+0,Fr+1,Fr+2),this.indexArray.emplaceBack(Fr+1,Fr+3,Fr+2),Me.primitiveLength+=2,K){const _r=le+(ct===1?Fe.length-2:ct-2),$r=ct===1?le:_r+1;if(this.indexArray.emplaceBack(Fr+1,_r,Fr+3),this.indexArray.emplaceBack(_r,$r,Fr+3),Me.primitiveLength+=2,it===void 0&&(it=Fr),!hv(dr,Fe[ct],ve)){const Dn=ct===Fe.length-1?it:Me.vertexLength;this.indexArray.emplaceBack(Fr+2,Fr+3,Dn),this.indexArray.emplaceBack(Fr+3,Dn+1,Dn),this.indexArray.emplaceBack(Fr+3,$r,Dn+1),Me.primitiveLength+=3}At=!At}if(M){const _r=this.layoutVertexExtArray,$r=w.projectTilePoint(Ot.x,Ot.y,u),Dn=w.projectTilePoint(qt.x,qt.y,u),Nn=w.upVector(u,Ot.x,Ot.y),Zn=w.upVector(u,qt.x,qt.y);Ap(_r,$r,Nn),Ap(_r,$r,Nn),Ap(_r,Dn,Zn),Ap(_r,Dn,Zn)}}T&&(le+=Fe.length-1),O&&K&&this.zoom>=17&&(ot.length!==0&&ie(ot,ot[0])&&ot.pop(),this.groundEffect.addData(ot,ve,S,K>0))}this.footprintSegments.push(Pe),Se.triangleCount=this.indexArray.length-Se.triangleArrayOffset,this.polygonSegments.push(Se),++C.footprintSegLen,++C.polygonSegLen}if(C.vertexCount=this.layoutVertexArray.length-C.vertexArrayOffset,C.groundVertexCount=this.groundEffect.vertexArray.length-C.groundVertexArrayOffset,C.vertexCount!==0){if(C.centroidXY=E.borders?iw:this.encodeCentroid(E,C),this.centroidData.push(C),E.borders){this.featuresOnBorder.push(E);const se=this.featuresOnBorder.length-1;for(let ve=0;ve<E.borders.length;ve++)E.borders[ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ve].push(se)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,c,f,u,b),this.groundEffect.addPaintPropertiesData(e,a,c,f,u,b),this.maxHeight=Math.max(this.maxHeight,k)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,a)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],S=+(b.min.y+b.max.y>Ct),_=2*S+(+(b.min.x+b.max.x>Ct)^S);for(let w=0;w<b.polygonSegLen;w++){const M=b.polygonSegIdx+w;e.push({centroidIdx:y,subtile:_,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const n=new wi;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let a=0,u=0,c=0;for(const y of e){if(y.triangleSegmentIdx!==a)break;c++}const f=e.length;for(;u!==e.length;){a=e[u].triangleSegmentIdx;let y=0,b=u,S=u;for(let _=b;_<c&&e[_].subtile===y;_++)S++;for(;b!==c;){const _=e[b];y=_.subtile;const w=this.centroidData[_.centroidIdx].min.clone(),M=this.centroidData[_.centroidIdx].max.clone(),T={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let E=b;E<S;E++){const C=e[E],O=this.polygonSegments[C.polygonSegmentIdx],k=this.centroidData[C.centroidIdx].min,U=this.centroidData[C.centroidIdx].max,V=this.indexArray.uint16;for(let N=O.triangleArrayOffset;N<O.triangleArrayOffset+O.triangleCount;N++)n.emplaceBack(V[3*N],V[3*N+1],V[3*N+2]);T.primitiveLength+=O.triangleCount,w.x=Math.min(w.x,k.x),w.y=Math.min(w.y,k.y),M.x=Math.max(M.x,U.x),M.y=Math.max(M.y,U.y)}T.primitiveLength>0&&this.triangleSubSegments.push({segment:T,min:w,max:M}),b=S;for(let E=b;E<c&&e[E].subtile===e[b].subtile;E++)S++}u=c;for(let _=u;_<f&&e[_].triangleSegmentIdx===e[u].triangleSegmentIdx;_++)c++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,a){const u=new Gn;if(this.wallMode){for(const C of this.triangleSubSegments)u.segments.push(C.segment);return u}let c=0,f=0;const y=1<<e.canonical.z;if(n){const C=n.getMinMaxForTile(e);C&&(c=C.min,f=C.max)}f+=this.maxHeight;const b=e.toUnwrapped();let S;const _=[b.canonical.x/y+b.wrap,b.canonical.y/y],w=[(b.canonical.x+1)/y+b.wrap,(b.canonical.y+1)/y],M=(C,O,k)=>[C[0]*(1-k[0])+O[0]*k[0],C[1]*(1-k[1])+O[1]*k[1]],T=[],E=[];for(const C of this.triangleSubSegments){T[0]=C.min.x/Ct,T[1]=C.min.y/Ct,E[0]=C.max.x/Ct,E[1]=C.max.y/Ct;const O=M(_,w,T),k=M(_,w,E);if(new or([O[0],O[1],c],[k[0],k[1],f]).intersectsPrecise(a)===0){S&&(u.segments.push(S),S=void 0);continue}const U=C.segment;S&&S.vertexOffset!==U.vertexOffset&&(u.segments.push(S),S=void 0),S?(S.vertexLength+=U.vertexLength,S.primitiveLength+=U.primitiveLength):S={vertexOffset:U.vertexOffset,primitiveLength:U.primitiveLength,vertexLength:U.vertexLength,primitiveOffset:U.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&u.segments.push(S),u}encodeCentroid(e,n){const a=e.centroid(),u=n.span(),c=Math.min(7,Math.round(u.x*this.tileToMeter/10)),f=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Ae(Ye(a.x,1,Ct-1)<<3|c,Ye(a.y,1,Ct-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Ae(0,0);const n=e.borders,a=Number.MAX_VALUE;if(n[0][0]!==a||n[1][0]!==a){const u=n[0][0]!==a?0:1;return new Ae(6|(n[0][0]!==a?0:65528),(n[u][0]+n[u][1])/2<<3|6)}{const u=n[2][0]!==a?2:3;return new Ae((n[u][0]+n[u][1])/2<<3|6,6|(n[2][0]!==a?0:65528))}}showCentroid(e){const n=this.centroidData[e.centroidDataIndex];n.flags&=Jl,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const n=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,u=e.flags&Jl?iw:e.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==u.y||c!==u.x){for(let f=n;f<a;++f)this.centroidVertexArray.emplace(f,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n,a){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const u=n.getReplacementRegionsForTile(e.toUnwrapped());if(lv(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const c=[];for(const f of this.activeReplacements){if(f.order<a)continue;const y=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const b of this.centroidData)if(!(b.flags&Jl||f.min.x>b.max.x||b.min.x>f.max.x||f.min.y>b.max.y||b.min.y>f.max.y))for(let S=0;S<b.footprintSegLen;S++){const _=this.footprintSegments[b.footprintSegIdx+S];if(c.length=0,IP(this.footprintVertices,_.vertexOffset,_.vertexCount,f.footprintTileId.canonical,e.canonical,c),Qb(f.footprint,c,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-y)){b.flags|=Jl;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,a){let u=!1;for(let c=0;c<a.footprintSegLen;c++){const f=this.footprintSegments[a.footprintSegIdx+c];let y=0;for(const b of f.ringIndices){for(let S=y,_=b+y-1;S<b+y;_=S++){const w=this.footprintVertices.int16[2*(S+f.vertexOffset)+0],M=this.footprintVertices.int16[2*(S+f.vertexOffset)+1],T=this.footprintVertices.int16[2*(_+f.vertexOffset)+1];M>n!=T>n&&e<(this.footprintVertices.int16[2*(_+f.vertexOffset)+0]-w)*(n-M)/(T-M)+w&&(u=!u)}y=b}}return u}getHeightAtTileCoord(e,n){let a=Number.NEGATIVE_INFINITY,u=!0;const c=4*(e+Ct)*Ct+(n+Ct);if(this.partLookup.hasOwnProperty(c)){const f=this.partLookup[c];return f?{height:f.height,hidden:!!(f.flags&Jl)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||n>f.max.y||f.min.y>n||this.footprintContainsPoint(e,n,f)&&f&&f.height>a&&(a=f.height,this.partLookup[c]=f,u=!!(f.flags&Jl));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.partLookup[c]=void 0}}function uw(o,e){const n=o.add(e)._unit();return o.x*n.x+o.y*n.y}function MP(o,e,n,a){const u=e.sub(o)._perp()._unit(),c=n.sub(e)._perp()._unit();return hw(o,e,n,uw(u,c),a)}function hw(o,e,n,a,u){const c=Math.sqrt(1-a*a);return Math.min(o.dist(e)/3,e.dist(n)/3,u*c/a)}function hv(o,e,n){return o.x<n[0].x&&e.x<n[0].x||o.x>n[1].x&&e.x>n[1].x||o.y<n[0].y&&e.y<n[0].y||o.y>n[1].y&&e.y>n[1].y}function dw(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function fw(o,e,n){if(o.x<0||o.x>=Ct||e.x<0||e.x>=Ct||n.x<0||n.x>=Ct)return!1;const a=n.sub(e),u=a.perp(),c=o.sub(e);return(a.x*c.x+a.y*c.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(c.x*c.x+c.y*c.y))>-.866&&u.x*c.x+u.y*c.y<0}function pw(o,e,n){const a=e?2|o:-3&o;return n?1|a:-2&a}function mw(){const o=Math.PI/32,e=Math.tan(o),n=Zl;return n*Math.sqrt(1+2*e*e)-n}function _w(o,e,n){const a=1<<n.z,u=ds(n.x/a),c=ds((n.x+1)/a),f=Ci(n.y/a),y=Ci((n.y+1)/a);return function(b,S,_,w,M=0,T){const E=[];if(!b.length||!_||!w)return E;const C=(Z,K)=>{for(const ae of Z)E.push({polygon:ae,bounds:K})},O=Math.ceil(Math.log2(_)),k=Math.ceil(Math.log2(w)),U=O-k,V=[];for(let Z=0;Z<Math.abs(U);Z++)V.push(U>0?0:1);for(let Z=0;Z<Math.min(O,k);Z++)V.push(0),V.push(1);let N=b;if(N=K_(N,S[0].y-M,S[1].y+M,1),N=K_(N,S[0].x-M,S[1].x+M,0),!N.length)return E;const $=[];for(V.length?$.push({polygons:N,bounds:S,depth:0}):C(N,S);$.length;){const Z=$.pop(),K=Z.depth,ae=V[K],ie=Z.bounds[0],se=Z.bounds[1],ve=ae===0?ie.x:ie.y,le=ae===0?se.x:se.y,xe=T?T(ae,ve,le):.5*(ve+le),Me=K_(Z.polygons,ve-M,xe+M,ae),Se=K_(Z.polygons,xe-M,le+M,ae);if(Me.length){const Pe=[ie,new Ae(ae===0?xe:se.x,ae===1?xe:se.y)];V.length>K+1?$.push({polygons:Me,bounds:Pe,depth:K+1}):C(Me,Pe)}if(Se.length){const Pe=[new Ae(ae===0?xe:ie.x,ae===1?xe:ie.y),se];V.length>K+1?$.push({polygons:Se,bounds:Pe,depth:K+1}):C(Se,Pe)}}return E}(o,e,Math.ceil((c-u)/11.25),Math.ceil((f-y)/11.25),1,(b,S,_)=>{if(b===0)return .5*(S+_);{const w=Ci((n.y+S/Ct)/a);return(lo(.5*(Ci((n.y+_/Ct)/a)+w))*a-n.y)*Ct}})}function IP(o,e,n,a,u,c){const f=Math.pow(2,a.z-u.z);for(let y=0;y<n;y++){let b=o.int16[2*(y+e)+0],S=o.int16[2*(y+e)+1];b=(b+u.x*Ct)*f-a.x*Ct,S=(S+u.y*Ct)*f-a.y*Ct,c.push(new Ae(b,S))}}let gw,yw;function Mp(o,e){return o.x*e.x+o.y*e.y}function vw(o,e){if(o.length===1){let n=0;const a=e[n++];let u;for(;!u||a.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const c=e[n],f=o[0],y=u.sub(a),b=c.sub(a),S=f.sub(a),_=Mp(y,y),w=Mp(y,b),M=Mp(b,b),T=Mp(S,y),E=Mp(S,b),C=_*M-w*w,O=(M*T-w*E)/C,k=(_*E-w*T)/C,U=a.z*(1-O-k)+u.z*O+c.z*k;if(isFinite(U))return U}return 1/0}{let n=1/0;for(const a of e)n=Math.min(n,a.z);return n}}function xw(o,e,n,a,u,c,f,y){const b=f*u.getElevationAt(o,e,!0,!0),S=c[0]!==0,_=S?c[1]===0?f*(c[0]/7-450):f*function(w,M,T){const E=Math.floor(M[0]/8),C=Math.floor(M[1]/8),O=10*(M[0]-8*E),k=10*(M[1]-8*C),U=w.getElevationAt(E,C,!0,!0),V=w.getMeterToDEM(T),N=Math.floor(.5*(O*V-1)),$=Math.floor(.5*(k*V-1)),Z=w.tileCoordToPixel(E,C),K=2*N+1,ae=2*$+1,ie=function(Se,Pe,Ce,Fe,Le){return[Se.getElevationAtPixel(Pe,Ce,!0),Se.getElevationAtPixel(Pe+Le,Ce,!0),Se.getElevationAtPixel(Pe,Ce+Le,!0),Se.getElevationAtPixel(Pe+Fe,Ce+Le,!0)]}(w,Z.x-N,Z.y-$,K,ae),se=Math.abs(ie[0]-ie[1]),ve=Math.abs(ie[2]-ie[3]),le=Math.abs(ie[0]-ie[2])+Math.abs(ie[1]-ie[3]),xe=Math.min(.25,.5*V*(se+ve)/K),Me=Math.min(.25,.5*V*le/ae);return U+Math.max(xe*O,Me*k)}(u,c,y):b;return{base:b+(n===0?-1:n),top:S?Math.max(_+a,b+n+2):b+a}}Ft(eg,"FillExtrusionBucket",{omit:["layers","features"]}),Ft(ow,"PartData"),Ft(sw,"FootprintSegment"),Ft(aw,"BorderCentroidData"),Ft(cw,"GroundEffect");const CP=Jr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),PP=Jr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:RP}=CP,DP=Jr([{name:"a_packed",components:3,type:"Float32"}]),{members:zP}=DP,LP=Jr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:OP}=LP;class bw{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Kl({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const a=this.getKey(e,n);return this.positions[a]}trim(){const e=this.width,n=this.height=Ji(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,a){const u=[];let c=e.length%2==1?-e[e.length-1]*a:0,f=e[0]*a,y=!0;u.push({left:c,right:f,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let S=1;S<e.length;S++){y=!y;const _=e[S];c=b*a,b+=_,f=b*a,u.push({left:c,right:f,isDash:y,zeroLength:_===0})}return u}addRoundDash(e,n,a){const u=n/2;for(let c=-a;c<=a;c++){const f=this.width*(this.nextRow+a+c);let y=0,b=e[y];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++y]);const _=Math.abs(S-b.left),w=Math.abs(S-b.right),M=Math.min(_,w);let T;const E=c/a*(u+1);if(b.isDash){const C=u-Math.abs(E);T=Math.sqrt(M*M+C*C)}else T=u-Math.sqrt(M*M+E*E);this.image.data[f+S]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(e,n){for(let b=e.length-1;b>=0;--b){const S=e[b],_=e[b+1];S.zeroLength?e.splice(b,1):_&&_.isDash===S.isDash&&(_.left=S.left,e.splice(b,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const c=this.width*this.nextRow;let f=0,y=e[f];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++f]);const S=Math.abs(b-y.left),_=Math.abs(b-y.right),w=Math.min(S,_);this.image.data[c+b]=Math.max(0,Math.min(255,(y.isDash?w:-w)+n+128))}}addDash(e,n){const a=this.getKey(e,n);if(this.positions[a])return this.positions[a];const u=n==="round",c=u?7:0,f=2*c+1;if(this.nextRow+f>this.height)return Rr("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let _=0;_<e.length;_++)e[_]<0&&(Rr("Negative value is found in line dasharray, replacing values with 0"),e[_]=0),y+=e[_];if(y!==0){const _=this.width/y,w=this.getDashRanges(e,this.width,_);u?this.addRoundDash(w,_,c):this.addRegularDash(w,n==="square"?.5*_:0)}const b=this.nextRow+c;this.nextRow+=f;const S={tl:[b,c],br:[y,0]};return this.positions[a]=S,S}}Ft(bw,"LineAtlas");const kP=Yl.VectorTileFeature.types,FP=Math.cos(Math.PI/180*37.5),BP=Math.cos(Math.PI/180*5);class dv{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Fh,this.layoutVertexArray2=new Po,this.patternVertexArray=new Po,this.indexArray=new wi,this.programConfigurations=new Pa(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Gn,this.maxLineLength=0,this.zOffsetVertexArray=new Po,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Ct/64}updateFootprints(e,n){}populate(e,n,a,u){this.hasPattern=J0("line",this.layers,this.pixelRatio,n);const c=this.layers[0].layout.get("line-sort-key");this.tileToMeter=t(a);const f=this.layers[0].layout.get("line-z-offset"),y=f.isConstant()&&!f.constantOr(0),b=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=b==="sea"||b==="ground"||!y&&b==="none",this.hasZOffset&&b==="none"&&Rr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&S!==void 0;const _=[];for(const{feature:E,id:C,index:O,sourceLayerIndex:k}of e){const U=this.layers[0]._featureFilter.needGeometry,V=F(E,U);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),V,a))continue;const N=c?c.evaluate(V,{},a):void 0,$={id:C,properties:E.properties,type:E.type,sourceLayerIndex:k,index:O,geometry:U?V.geometry:L(E,a,u),patterns:{},sortKey:N};_.push($)}c&&_.sort((E,C)=>E.sortKey-C.sortKey);const{lineAtlas:w,featureIndex:M}=n,T=this.addConstantDashes(w);for(const E of _){const{geometry:C,index:O,sourceLayerIndex:k}=E;if(T&&this.addFeatureDashes(E,w),this.hasPattern){const U=Q0("line",this.layers,E,this.zoom,this.pixelRatio,n);this.patternFeatures.push(U)}else this.addFeature(E,C,O,a,w.positions,n.availableImages,n.brightness);M.insert(e[O].feature,C,O,k,this.index)}}addConstantDashes(e){let n=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,c=a.layout.get("line-cap").value;if(u.kind!=="constant"||c.kind!=="constant")n=!0;else{const f=c.value,y=u.value;if(!y)continue;e.addDash(y,f)}}return n}addFeatureDashes(e,n){const a=this.zoom;for(const u of this.layers){const c=u.paint.get("line-dasharray").value,f=u.layout.get("line-cap").value;if(c.kind==="constant"&&f.kind==="constant")continue;let y,b;if(c.kind==="constant"){if(y=c.value,!y)continue}else y=c.evaluate({zoom:a},e);b=f.kind==="constant"?f.value:f.evaluate({zoom:a},e),n.addDash(y,b),e.patterns[u.id]=n.getKey(y,b)}}update(e,n,a,u,c,f,y){this.programConfigurations.updatePaintArrays(e,n,c,a,u,f,y)}addFeatures(e,n,a,u,c,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,a,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,zP)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,OP)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,PP.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,RP),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,a,u,c,f,y){const b=this.layers[0].layout,S=b.get("line-join").evaluate(e,{}),_=b.get("line-cap").evaluate(e,{}),w=b.get("line-miter-limit"),M=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=b.get("line-z-offset").value;const T=this.layers[0].paint.get("line-width").value;T.kind!=="constant"&&T.isLineProgressConstant===!1&&(this.variableWidthValue=T);for(const E of n)this.addLine(E,e,u,S,_,w,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,c,f,u,y)}addLine(e,n,a,u,c,f,y){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const b=u==="none";if(this.patternJoinNone=this.hasPattern&&b,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let V=0;V<e.length-1;V++)this.totalDistance+=e[V].dist(e[V+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=kP[n.type]==="Polygon";let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let w=0;for(;w<_-1&&e[w].equals(e[w+1]);)w++;if(_<(S?3:2))return;u==="bevel"&&(f=1.05);const M=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let T,E,C,O,k,U;this.e1=this.e2=-1,S&&(T=e[_-2],k=e[w].sub(T)._unit()._perp());for(let V=w;V<_;V++){if(C=V===_-1?S?e[w+1]:void 0:e[V+1],C&&e[V].equals(C))continue;k&&(O=k),T&&(E=T),T=e[V],U=this.evaluateLineProgressFeatures(E?E.dist(T):0),k=C?C.sub(T)._unit()._perp():O,O=O||k;const N=E&&C;let $=N?u:S||b?"butt":c;const Z=O.x*k.x+O.y*k.y;if(b){const Me=function(Se){if(Se.patternJoinNone){const Pe=Se.segmentPoints.length/2,Ce=Se.lineSoFar-Se.segmentStart;for(let Fe=0;Fe<Pe;++Fe){const Le=Se.segmentPoints[2*Fe+1],Ne=Math.round(Se.segmentPoints[2*Fe])+.5+.25*Le;Se.patternVertexArray.emplaceBack(Ne,Ce,Se.segmentStart),Se.patternVertexArray.emplaceBack(Ne,Ce,Se.segmentStart)}Se.segmentPoints.length=0}Se.e1=Se.e2=-1};if(N&&Z<BP){this.updateDistance(E,T),this.addCurrentVertex(T,O,1,1,M,U),Me(this),this.addCurrentVertex(T,k,-1,-1,M,U);continue}if(E){if(!C){this.updateDistance(E,T),this.addCurrentVertex(T,O,1,1,M,U),Me(this);continue}$="miter"}}let K=O.add(k);K.x===0&&K.y===0||K._unit();const ae=K.x*k.x+K.y*k.y,ie=ae!==0?1/ae:1/0,se=2*Math.sqrt(2-2*ae),ve=ae<FP&&E&&C,le=O.x*k.y-O.y*k.x>0,xe=this.overscaling<=16?15*Ct/(512*this.overscaling):0;if(N&&$==="round"){if(ie<y)$="miter";else if(ie<=2){const Me=fv(T,-10,Ct+10);$=this.hasZOffset&&(Me||this.hasCrossSlope)?"miter":"fakeround"}}if($==="miter"&&ie>f&&($="bevel"),$==="bevel"&&(ie>2&&($="flipbevel"),ie<f&&($="miter")),E&&!($==="miter"&&ve)&&this.updateDistance(E,T),$==="miter")if(ve){const Me=T.dist(E);if(Me>2*xe){const Pe=T.sub(T.sub(E)._mult(xe/Me)._round());this.updateDistance(E,Pe),this.addCurrentVertex(Pe,O,0,0,M,U),E=Pe}this.updateDistance(E,T),K._mult(ie),this.addCurrentVertex(T,K,0,0,M,U);const Se=T.dist(C);if(Se>2*xe){const Pe=T.add(C.sub(T)._mult(xe/Se)._round());this.updateDistance(T,Pe),this.addCurrentVertex(Pe,k,0,0,M,U),T=Pe}}else K._mult(ie),this.addCurrentVertex(T,K,0,0,M,U);else if($==="flipbevel"){if(ie>100)K=k.mult(-1);else{const Me=ie*O.add(k).mag()/O.sub(k).mag();K._perp()._mult(Me*(le?-1:1))}this.addCurrentVertex(T,K,0,0,M,U),this.addCurrentVertex(T,K.mult(-1),0,0,M,U)}else if($==="bevel"||$==="fakeround"){U!=null&&E&&this.addCurrentVertex(T,O,-1,-1,M,U);const Me=T.dist(E)<=2*xe&&$!=="bevel",Se=K.mult(le?1:-1);Se._mult(ie);const Pe=k.mult(le?-1:1),Ce=O.mult(le?-1:1),Fe=this.evaluateLineProgressFeatures(this.distance);if(U==null&&(this.addHalfVertex(T,Se.x,Se.y,!1,!le,0,M,Fe),Me||this.addHalfVertex(T,Se.x+2*Ce.x,Se.y+2*Ce.y,!1,le,0,M,Fe)),$==="fakeround"){const Le=Math.round(180*se/Math.PI/20);this.addHalfVertex(T,Ce.x,Ce.y,!1,le,0,M,Fe);for(let Ne=0;Ne<Le;Ne++){let ot=Ne/Le;if(ot!==.5){const Bt=ot-.5;ot+=ot*Bt*(ot-1)*((1.0904+Z*(Z*(3.55645-1.43519*Z)-3.2452))*Bt*Bt+(.848013+Z*(.215638*Z-1.06021)))}const it=Pe.sub(Ce)._mult(ot)._add(Ce)._unit();this.addHalfVertex(T,it.x,it.y,!1,le,0,M,Fe)}this.addHalfVertex(T,Pe.x,Pe.y,!1,le,0,M,Fe)}Me||U!=null||this.addHalfVertex(T,Se.x+2*Pe.x,Se.y+2*Pe.y,!1,le,0,M,Fe),U!=null&&C&&this.addCurrentVertex(T,k,1,1,M,U)}else $==="butt"?this.addCurrentVertex(T,K,0,0,M,U):$==="square"?(E||this.addCurrentVertex(T,K,-1,-1,M,U),this.addCurrentVertex(T,K,0,0,M,U),E&&this.addCurrentVertex(T,K,1,1,M,U)):$==="round"&&(E&&(this.addCurrentVertex(T,O,0,0,M,U),this.addCurrentVertex(T,O,1,1,M,U,!0)),C&&(this.addCurrentVertex(T,k,-1,-1,M,U,!0),this.addCurrentVertex(T,k,0,0,M,U)))}}addVerticesTo(e,n,a,u,c,f,y,b,S,_){const w=(n.w-e.w)/this.tessellationStep|0;let M=0;const T=this.scaledDistance;if(w>1){this.lineSoFar=e.w;const C=(n.x-e.x)/w,O=(n.y-e.y)/w,k=(n.z-e.z)/w,U=(n.w-e.w)/w;for(let V=1;V<w;++V){e.x+=C,e.y+=O,e.z+=k,this.lineSoFar+=U,M+=U;const N=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(e,a,u,_,!1,y,S,N),this.addHalfVertex(e,c,f,_,!0,-b,S,N)}}this.lineSoFar=n.w,this.scaledDistance=T;const E=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(n,a,u,_,!1,y,S,E),this.addHalfVertex(n,c,f,_,!0,-b,S,E)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Rr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let n=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(n=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:n}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:n}:{zOffset:0,variableWidth:n}}addCurrentVertex(e,n,a,u,c,f,y=!1){const b=n.x+n.y*a,S=n.y-n.x*a,_=n.y*u-n.x,w=-n.y-n.x*u;if(f!=null){const M=this.hasZOffset,T=-10,E=Ct+10,C=f.zOffset,O=new Wb(e.x,e.y,C,this.lineSoFar),k=!!M&&fv(e,T,E),U=this.lineSoFar,V=this.distance;if(this.currentVertex)if(k){const N=this.currentVertexIsOutside,$=this.currentVertex,Z=new Wb(e.x,e.y,C,this.lineSoFar);if(Xb($,Z,T,E),!fv(Z,T,E)){if(N){this.e1=this.e2=-1,this.distance-=$.dist(O),this.lineSoFar=$.w;const K=this.evaluateLineProgressFeatures($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,b,S,y,!1,a,c,K),this.addHalfVertex($,_,w,y,!0,-u,c,K),this.prevDistance=this.distance}this.distance=this.prevDistance+$.dist(Z),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo($,Z,b,S,_,w,a,u,c,y),this.distance=V,this.scaledDistance=this.distance/this.totalDistance}}else{const N=this.currentVertex;if(this.currentVertexIsOutside){Xb(N,O,T,E),this.e1=this.e2=-1,this.distance-=N.dist(O),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=N.w;const $=this.evaluateLineProgressFeatures(N.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(N,b,S,y,!1,a,c,$),this.addHalfVertex(N,_,w,y,!0,-u,c,$),this.prevDistance=this.distance,this.distance=V,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(N,O,b,S,_,w,a,u,c,y)}else k||(this.addHalfVertex(e,b,S,y,!1,a,c,f),this.addHalfVertex(e,_,w,y,!0,-u,c,f));this.currentVertex=O,this.currentVertexIsOutside=k,this.lineSoFar=U}else this.addHalfVertex(e,b,S,y,!1,a,c,f),this.addHalfVertex(e,_,w,y,!0,-u,c,f)}addHalfVertex({x:e,y:n},a,u,c,f,y,b,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(n<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const w=ar(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,w)}const _=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),b.primitiveLength++),f?this.e2=_:this.e1=_,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,n){this.prevDistance=this.distance,this.distance+=e.dist(n),this.updateScaledDistance()}}function fv(o,e,n){return o.x<e||o.x>n||o.y<e||o.y>n}let ww,Tw;function Sw(o,e,n){return e*(Ct/(o.tileSize*Math.pow(2,n-o.tileID.overscaledZ)))}Ft(dv,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Ew=(o,e,n)=>(1-n)*o+n*e;function Aw(o,e){return 1/Sw(o,1,e.tileZoom)}function Mw(o,e,n,a){return o.translatePosMatrix(a||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Iw=o=>{const e=[];Cw(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=o.paint.get("line-trim-offset");n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=o.layout.get("line-join").constantOr("miter")==="none",u=!!o.paint.get("line-pattern").constantOr(1);return a&&u&&e.push("LINE_JOIN_NONE"),e};function Cw(o){const e=o.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let pv;const Pw=()=>pv||(pv={layout:ww||(ww=new $n({"line-cap":new kt(Ue.layout_line["line-cap"]),"line-join":new kt(Ue.layout_line["line-join"]),"line-miter-limit":new Tt(Ue.layout_line["line-miter-limit"]),"line-round-limit":new Tt(Ue.layout_line["line-round-limit"]),"line-sort-key":new kt(Ue.layout_line["line-sort-key"]),"line-z-offset":new kt(Ue.layout_line["line-z-offset"]),"line-elevation-reference":new Tt(Ue.layout_line["line-elevation-reference"]),"line-cross-slope":new Tt(Ue.layout_line["line-cross-slope"]),visibility:new Tt(Ue.layout_line.visibility),"line-width-unit":new Tt(Ue.layout_line["line-width-unit"])})),paint:Tw||(Tw=new $n({"line-opacity":new kt(Ue.paint_line["line-opacity"]),"line-color":new kt(Ue.paint_line["line-color"]),"line-translate":new Tt(Ue.paint_line["line-translate"]),"line-translate-anchor":new Tt(Ue.paint_line["line-translate-anchor"]),"line-width":new kt(Ue.paint_line["line-width"]),"line-gap-width":new kt(Ue.paint_line["line-gap-width"]),"line-offset":new kt(Ue.paint_line["line-offset"]),"line-blur":new kt(Ue.paint_line["line-blur"]),"line-dasharray":new kt(Ue.paint_line["line-dasharray"]),"line-pattern":new kt(Ue.paint_line["line-pattern"]),"line-gradient":new il(Ue.paint_line["line-gradient"]),"line-trim-offset":new Tt(Ue.paint_line["line-trim-offset"]),"line-trim-fade-range":new Tt(Ue.paint_line["line-trim-fade-range"]),"line-trim-color":new Tt(Ue.paint_line["line-trim-color"]),"line-emissive-strength":new Tt(Ue.paint_line["line-emissive-strength"]),"line-border-width":new kt(Ue.paint_line["line-border-width"]),"line-border-color":new kt(Ue.paint_line["line-border-color"]),"line-occlusion-opacity":new Tt(Ue.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},pv);class NP extends kt{possiblyEvaluate(e,n){return n=new bn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,a,u){return n=jr({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,a,u)}}let Ip;function Rw(o,e){return e>0?e+2*o:o}const VP=Jr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),UP=Jr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),jP=Jr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Jr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $P=Jr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),GP=Jr([{name:"a_texb",components:2,type:"Uint16"}]),HP=Jr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),qP=Jr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Jr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Dw=Jr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),WP=Jr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Jr([{name:"triangle",components:3,type:"Uint16"}]),Jr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Jr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Jr([{type:"Float32",name:"offsetX"}]),Jr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Fi=24;const ta=128;function zw(o,e,n,a,u){if(o.kind==="camera")return o.maxSize;if(o.kind==="composite"){const c=e.possiblyEvaluate(new bn(o.maxZoom),n).evaluate(u,{},n),f=e.possiblyEvaluate(new bn(o.minZoom),n).evaluate(u,{},n);return Math.max(c,f)}return e.possiblyEvaluate(new bn(a)).evaluate(u,{},n)}function mv(o,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new bn(o+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=n;let c=0;for(;c<a.length&&a[c]<=o;)c++;c=Math.max(0,c-1);let f=c;for(;f<a.length&&a[f]<o+1;)f++;f=Math.min(a.length-1,f);const y=a[c],b=a[f];return n.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:b,minSize:n.evaluate(new bn(y)),maxSize:n.evaluate(new bn(b)),interpolationType:u}}}function tg(o,{uSize:e,uSizeT:n},{lowerSize:a,upperSize:u}){return o.kind==="source"?a/ta:o.kind==="composite"?ar(a/ta,u/ta,n):e}function td(o,e,n=1){let a=0,u=0;if(o.kind==="constant")u=o.layoutSize*n;else if(o.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:y}=o,b=c?Ye(Es.interpolationFactor(c,e,f,y),0,1):0;o.kind==="camera"?u=ar(o.minSize,o.maxSize,b)*n:a=b*n}return{uSizeT:a,uSize:u}}var ZP=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:ta,evaluateSizeForFeature:tg,evaluateSizeForZoom:td,getRasterizedIconSize:zw,getSizeData:mv});function XP(o,e,n){return o.sections.forEach(a=>{a.text=function(u,c,f){const y=c.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),us.applyArabicShaping&&(u=us.applyArabicShaping(u)),u}(a.text,e,n)}),o}const Cp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function KP(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}function YP(o){return o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""||o===""}var Lw,_v,Ow,gv={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function JP(){return Lw||(Lw=1,gv.read=function(o,e,n,a,u){var c,f,y=8*u-a-1,b=(1<<y)-1,S=b>>1,_=-7,w=n?u-1:0,M=n?-1:1,T=o[e+w];for(w+=M,c=T&(1<<-_)-1,T>>=-_,_+=y;_>0;c=256*c+o[e+w],w+=M,_-=8);for(f=c&(1<<-_)-1,c>>=-_,_+=a;_>0;f=256*f+o[e+w],w+=M,_-=8);if(c===0)c=1-S;else{if(c===b)return f?NaN:1/0*(T?-1:1);f+=Math.pow(2,a),c-=S}return(T?-1:1)*f*Math.pow(2,c-a)},gv.write=function(o,e,n,a,u,c){var f,y,b,S=8*c-u-1,_=(1<<S)-1,w=_>>1,M=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=a?0:c-1,E=a?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,f=_):(f=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-f))<1&&(f--,b*=2),(e+=f+w>=1?M/b:M*Math.pow(2,1-w))*b>=2&&(f++,b/=2),f+w>=_?(y=0,f=_):f+w>=1?(y=(e*b-1)*Math.pow(2,u),f+=w):(y=e*Math.pow(2,w-1)*Math.pow(2,u),f=0));u>=8;o[n+T]=255&y,T+=E,y/=256,u-=8);for(f=f<<u|y,S+=u;S>0;o[n+T]=255&f,T+=E,f/=256,S-=8);o[n+T-E]|=128*C}),gv}function kw(){if(Ow)return _v;Ow=1,_v=e;var o=JP();function e(N){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(N)?N:new Uint8Array(N||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var n=4294967296,a=1/n,u=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function c(N){return N.type===e.Bytes?N.readVarint()+N.pos:N.pos+1}function f(N,$,Z){return Z?4294967296*$+(N>>>0):4294967296*($>>>0)+(N>>>0)}function y(N,$,Z){var K=$<=16383?1:$<=2097151?2:$<=268435455?3:Math.floor(Math.log($)/(7*Math.LN2));Z.realloc(K);for(var ae=Z.pos-1;ae>=N;ae--)Z.buf[ae+K]=Z.buf[ae]}function b(N,$){for(var Z=0;Z<N.length;Z++)$.writeVarint(N[Z])}function S(N,$){for(var Z=0;Z<N.length;Z++)$.writeSVarint(N[Z])}function _(N,$){for(var Z=0;Z<N.length;Z++)$.writeFloat(N[Z])}function w(N,$){for(var Z=0;Z<N.length;Z++)$.writeDouble(N[Z])}function M(N,$){for(var Z=0;Z<N.length;Z++)$.writeBoolean(N[Z])}function T(N,$){for(var Z=0;Z<N.length;Z++)$.writeFixed32(N[Z])}function E(N,$){for(var Z=0;Z<N.length;Z++)$.writeSFixed32(N[Z])}function C(N,$){for(var Z=0;Z<N.length;Z++)$.writeFixed64(N[Z])}function O(N,$){for(var Z=0;Z<N.length;Z++)$.writeSFixed64(N[Z])}function k(N,$){return(N[$]|N[$+1]<<8|N[$+2]<<16)+16777216*N[$+3]}function U(N,$,Z){N[Z]=$,N[Z+1]=$>>>8,N[Z+2]=$>>>16,N[Z+3]=$>>>24}function V(N,$){return(N[$]|N[$+1]<<8|N[$+2]<<16)+(N[$+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(N,$,Z){for(Z=Z||this.length;this.pos<Z;){var K=this.readVarint(),ae=K>>3,ie=this.pos;this.type=7&K,N(ae,$,this),this.pos===ie&&this.skip(K)}return $},readMessage:function(N,$){return this.readFields(N,$,this.readVarint()+this.pos)},readFixed32:function(){var N=k(this.buf,this.pos);return this.pos+=4,N},readSFixed32:function(){var N=V(this.buf,this.pos);return this.pos+=4,N},readFixed64:function(){var N=k(this.buf,this.pos)+k(this.buf,this.pos+4)*n;return this.pos+=8,N},readSFixed64:function(){var N=k(this.buf,this.pos)+V(this.buf,this.pos+4)*n;return this.pos+=8,N},readFloat:function(){var N=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,N},readDouble:function(){var N=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,N},readVarint:function(N){var $,Z,K=this.buf;return $=127&(Z=K[this.pos++]),Z<128?$:($|=(127&(Z=K[this.pos++]))<<7,Z<128?$:($|=(127&(Z=K[this.pos++]))<<14,Z<128?$:($|=(127&(Z=K[this.pos++]))<<21,Z<128?$:function(ae,ie,se){var ve,le,xe=se.buf;if(ve=(112&(le=xe[se.pos++]))>>4,le<128||(ve|=(127&(le=xe[se.pos++]))<<3,le<128)||(ve|=(127&(le=xe[se.pos++]))<<10,le<128)||(ve|=(127&(le=xe[se.pos++]))<<17,le<128)||(ve|=(127&(le=xe[se.pos++]))<<24,le<128)||(ve|=(1&(le=xe[se.pos++]))<<31,le<128))return f(ae,ve,ie);throw new Error("Expected varint not more than 10 bytes")}($|=(15&(Z=K[this.pos]))<<28,N,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var N=this.readVarint();return N%2==1?(N+1)/-2:N/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var N=this.readVarint()+this.pos,$=this.pos;return this.pos=N,N-$>=12&&u?function(Z,K,ae){return u.decode(Z.subarray(K,ae))}(this.buf,$,N):function(Z,K,ae){for(var ie="",se=K;se<ae;){var ve,le,xe,Me=Z[se],Se=null,Pe=Me>239?4:Me>223?3:Me>191?2:1;if(se+Pe>ae)break;Pe===1?Me<128&&(Se=Me):Pe===2?(192&(ve=Z[se+1]))==128&&(Se=(31&Me)<<6|63&ve)<=127&&(Se=null):Pe===3?(le=Z[se+2],(192&(ve=Z[se+1]))==128&&(192&le)==128&&((Se=(15&Me)<<12|(63&ve)<<6|63&le)<=2047||Se>=55296&&Se<=57343)&&(Se=null)):Pe===4&&(le=Z[se+2],xe=Z[se+3],(192&(ve=Z[se+1]))==128&&(192&le)==128&&(192&xe)==128&&((Se=(15&Me)<<18|(63&ve)<<12|(63&le)<<6|63&xe)<=65535||Se>=1114112)&&(Se=null)),Se===null?(Se=65533,Pe=1):Se>65535&&(Se-=65536,ie+=String.fromCharCode(Se>>>10&1023|55296),Se=56320|1023&Se),ie+=String.fromCharCode(Se),se+=Pe}return ie}(this.buf,$,N)},readBytes:function(){var N=this.readVarint()+this.pos,$=this.buf.subarray(this.pos,N);return this.pos=N,$},readPackedVarint:function(N,$){if(this.type!==e.Bytes)return N.push(this.readVarint($));var Z=c(this);for(N=N||[];this.pos<Z;)N.push(this.readVarint($));return N},readPackedSVarint:function(N){if(this.type!==e.Bytes)return N.push(this.readSVarint());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readSVarint());return N},readPackedBoolean:function(N){if(this.type!==e.Bytes)return N.push(this.readBoolean());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readBoolean());return N},readPackedFloat:function(N){if(this.type!==e.Bytes)return N.push(this.readFloat());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readFloat());return N},readPackedDouble:function(N){if(this.type!==e.Bytes)return N.push(this.readDouble());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readDouble());return N},readPackedFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed32());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readFixed32());return N},readPackedSFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed32());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readSFixed32());return N},readPackedFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed64());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readFixed64());return N},readPackedSFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed64());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readSFixed64());return N},skip:function(N){var $=7&N;if($===e.Varint)for(;this.buf[this.pos++]>127;);else if($===e.Bytes)this.pos=this.readVarint()+this.pos;else if($===e.Fixed32)this.pos+=4;else{if($!==e.Fixed64)throw new Error("Unimplemented type: "+$);this.pos+=8}},writeTag:function(N,$){this.writeVarint(N<<3|$)},realloc:function(N){for(var $=this.length||16;$<this.pos+N;)$*=2;if($!==this.length){var Z=new Uint8Array($);Z.set(this.buf),this.buf=Z,this.length=$}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(N){this.realloc(4),U(this.buf,N,this.pos),this.pos+=4},writeSFixed32:function(N){this.realloc(4),U(this.buf,N,this.pos),this.pos+=4},writeFixed64:function(N){this.realloc(8),U(this.buf,-1&N,this.pos),U(this.buf,Math.floor(N*a),this.pos+4),this.pos+=8},writeSFixed64:function(N){this.realloc(8),U(this.buf,-1&N,this.pos),U(this.buf,Math.floor(N*a),this.pos+4),this.pos+=8},writeVarint:function(N){(N=+N||0)>268435455||N<0?function($,Z){var K,ae;if($>=0?(K=$%4294967296|0,ae=$/4294967296|0):(ae=~(-$/4294967296),4294967295^(K=~(-$%4294967296))?K=K+1|0:(K=0,ae=ae+1|0)),$>=18446744073709552e3||$<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Z.realloc(10),function(ie,se,ve){ve.buf[ve.pos++]=127&ie|128,ie>>>=7,ve.buf[ve.pos++]=127&ie|128,ie>>>=7,ve.buf[ve.pos++]=127&ie|128,ie>>>=7,ve.buf[ve.pos++]=127&ie|128,ve.buf[ve.pos]=127&(ie>>>=7)}(K,0,Z),function(ie,se){var ve=(7&ie)<<4;se.buf[se.pos++]|=ve|((ie>>>=3)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie)))))}(ae,Z)}(N,this):(this.realloc(4),this.buf[this.pos++]=127&N|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=N>>>7&127))))},writeSVarint:function(N){this.writeVarint(N<0?2*-N-1:2*N)},writeBoolean:function(N){this.writeVarint(!!N)},writeString:function(N){N=String(N),this.realloc(4*N.length),this.pos++;var $=this.pos;this.pos=function(K,ae,ie){for(var se,ve,le=0;le<ae.length;le++){if((se=ae.charCodeAt(le))>55295&&se<57344){if(!ve){se>56319||le+1===ae.length?(K[ie++]=239,K[ie++]=191,K[ie++]=189):ve=se;continue}if(se<56320){K[ie++]=239,K[ie++]=191,K[ie++]=189,ve=se;continue}se=ve-55296<<10|se-56320|65536,ve=null}else ve&&(K[ie++]=239,K[ie++]=191,K[ie++]=189,ve=null);se<128?K[ie++]=se:(se<2048?K[ie++]=se>>6|192:(se<65536?K[ie++]=se>>12|224:(K[ie++]=se>>18|240,K[ie++]=se>>12&63|128),K[ie++]=se>>6&63|128),K[ie++]=63&se|128)}return ie}(this.buf,N,this.pos);var Z=this.pos-$;Z>=128&&y($,Z,this),this.pos=$-1,this.writeVarint(Z),this.pos+=Z},writeFloat:function(N){this.realloc(4),o.write(this.buf,N,this.pos,!0,23,4),this.pos+=4},writeDouble:function(N){this.realloc(8),o.write(this.buf,N,this.pos,!0,52,8),this.pos+=8},writeBytes:function(N){var $=N.length;this.writeVarint($),this.realloc($);for(var Z=0;Z<$;Z++)this.buf[this.pos++]=N[Z]},writeRawMessage:function(N,$){this.pos++;var Z=this.pos;N($,this);var K=this.pos-Z;K>=128&&y(Z,K,this),this.pos=Z-1,this.writeVarint(K),this.pos+=K},writeMessage:function(N,$,Z){this.writeTag(N,e.Bytes),this.writeRawMessage($,Z)},writePackedVarint:function(N,$){$.length&&this.writeMessage(N,b,$)},writePackedSVarint:function(N,$){$.length&&this.writeMessage(N,S,$)},writePackedBoolean:function(N,$){$.length&&this.writeMessage(N,M,$)},writePackedFloat:function(N,$){$.length&&this.writeMessage(N,_,$)},writePackedDouble:function(N,$){$.length&&this.writeMessage(N,w,$)},writePackedFixed32:function(N,$){$.length&&this.writeMessage(N,T,$)},writePackedSFixed32:function(N,$){$.length&&this.writeMessage(N,E,$)},writePackedFixed64:function(N,$){$.length&&this.writeMessage(N,C,$)},writePackedSFixed64:function(N,$){$.length&&this.writeMessage(N,O,$)},writeBytesField:function(N,$){this.writeTag(N,e.Bytes),this.writeBytes($)},writeFixed32Field:function(N,$){this.writeTag(N,e.Fixed32),this.writeFixed32($)},writeSFixed32Field:function(N,$){this.writeTag(N,e.Fixed32),this.writeSFixed32($)},writeFixed64Field:function(N,$){this.writeTag(N,e.Fixed64),this.writeFixed64($)},writeSFixed64Field:function(N,$){this.writeTag(N,e.Fixed64),this.writeSFixed64($)},writeVarintField:function(N,$){this.writeTag(N,e.Varint),this.writeVarint($)},writeSVarintField:function(N,$){this.writeTag(N,e.Varint),this.writeSVarint($)},writeStringField:function(N,$){this.writeTag(N,e.Bytes),this.writeString($)},writeFloatField:function(N,$){this.writeTag(N,e.Fixed32),this.writeFloat($)},writeDoubleField:function(N,$){this.writeTag(N,e.Fixed64),this.writeDouble($)},writeBooleanField:function(N,$){this.writeVarintField(N,!!$)}},_v}var rg=G(kw());const yv=3;function QP(o,e,n){e.glyphs=[],o===1&&n.readMessage(eR,e)}function eR(o,e,n){if(o===3){const{id:a,bitmap:u,width:c,height:f,left:y,top:b,advance:S}=n.readMessage(tR,{});e.glyphs.push({id:a,bitmap:new Kl({width:c+2*yv,height:f+2*yv},u),metrics:{width:c,height:f,left:y,top:b,advance:S}})}else o===4?e.ascender=n.readSVarint():o===5&&(e.descender=n.readSVarint())}function tR(o,e,n){o===1?e.id=n.readVarint():o===2?e.bitmap=n.readBytes():o===3?e.width=n.readVarint():o===4?e.height=n.readVarint():o===5?e.left=n.readSVarint():o===6?e.top=n.readSVarint():o===7&&(e.advance=n.readVarint())}const rR=yv,Ds={horizontal:1,vertical:2,horizontalOnly:3};class Pp{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,n){const a=new Pp;return a.scale=e||1,a.fontStack=n,a}static forImage(e){const n=new Pp;return n.image=e,n}}class rd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n,a){const u=new rd;for(let c=0;c<e.sections.length;c++){const f=e.sections[c];f.image?u.addImageSection(f,a):u.addTextSection(f,n)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,a){let u="";for(let c=0;c<n.length;c++){const f=n.charCodeAt(c+1)||null,y=n.charCodeAt(c-1)||null;u+=!a&&(f&&Bf(f)&&!Cp[n[c+1]]||y&&Bf(y)&&!Cp[n[c-1]])||!Cp[n[c]]?n[c]:Cp[n[c]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&ng[this.text.charCodeAt(a)];a++)e++;let n=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&ng[this.text.charCodeAt(a)];a--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const a=new rd;return a.text=this.text.substring(e,n),a.sectionIndex=this.sectionIndex.slice(e,n),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Pp.forText(e.scale,e.fontStack||n));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e,n){const a=e.image?e.image.getPrimary():null;if(!a)return void Rr("Can't add FormattedSection with an empty image.");a.scaleSelf(n);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(Pp.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Rr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vv(o,e,n,a,u,c,f,y,b,S,_,w,M,T,E,C=1){const O=rd.fromFeature(o,u,C);w===Ds.vertical&&O.verticalizePunctuation(M);let k=[];const U=function(K,ae,ie,se,ve,le){if(!K)return[];const xe=[],Me=function(Fe,Le,Ne,ot,it,Bt){let _t=0;for(let At=0;At<Fe.length();At++){const ct=Fe.getSection(At);_t+=Fw(Fe.getCodePoint(At),ct,ot,it,Le,Bt)}return _t/Math.max(1,Math.ceil(_t/Ne))}(K,ae,ie,se,ve,le),Se=K.text.indexOf("")>=0;let Pe=0;for(let Fe=0;Fe<K.length();Fe++){const Le=K.getSection(Fe),Ne=K.getCodePoint(Fe);if(ng[Ne]||(Pe+=Fw(Ne,Le,se,ve,ae,le)),Fe<K.length()-1){const ot=!((Ce=Ne)<11904||!(er["Bopomofo Extended"](Ce)||er.Bopomofo(Ce)||er["CJK Compatibility Forms"](Ce)||er["CJK Compatibility Ideographs"](Ce)||er["CJK Compatibility"](Ce)||er["CJK Radicals Supplement"](Ce)||er["CJK Strokes"](Ce)||er["CJK Symbols and Punctuation"](Ce)||er["CJK Unified Ideographs Extension A"](Ce)||er["CJK Unified Ideographs"](Ce)||er["Enclosed CJK Letters and Months"](Ce)||er["Halfwidth and Fullwidth Forms"](Ce)||er.Hiragana(Ce)||er["Ideographic Description Characters"](Ce)||er["Kangxi Radicals"](Ce)||er["Katakana Phonetic Extensions"](Ce)||er.Katakana(Ce)||er["Vertical Forms"](Ce)||er["Yi Radicals"](Ce)||er["Yi Syllables"](Ce)));(nR[Ne]||ot||Le.image)&&xe.push(Nw(Fe+1,Pe,Me,xe,iR(Ne,K.getCodePoint(Fe+1),ot&&Se),!1))}}var Ce;return Vw(Nw(K.length(),Pe,Me,xe,0,!0))}(O,S,c,e,a,T),{processBidirectionalText:V,processStyledBidirectionalText:N}=us;if(V&&O.sections.length===1){const K=V(O.toString(),U);for(const ae of K){const ie=new rd;ie.text=ae,ie.sections=O.sections;for(let se=0;se<ae.length;se++)ie.sectionIndex.push(0);k.push(ie)}}else if(N){const K=N(O.text,O.sectionIndex,U);for(const ae of K){const ie=new rd;ie.text=ae[0],ie.sectionIndex=ae[1],ie.sections=O.sections,k.push(ie)}}else k=function(K,ae){const ie=[],se=K.text;let ve=0;for(const le of ae)ie.push(K.substring(ve,le)),ve=le;return ve<se.length&&ie.push(K.substring(ve,se.length)),ie}(O,U);const $=[],Z={positionedLines:$,text:O.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:w,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(K,ae,ie,se,ve,le,xe,Me,Se,Pe,Ce,Fe){let Le=0,Ne=0,ot=0;const it=Me==="right"?1:Me==="left"?0:.5;let Bt=!1;for(const qt of ve){const dr=qt.getSections();for(const Ir of dr){if(Ir.image)continue;const yr=ae[Ir.fontStack];if(yr&&(Bt=yr.ascender!==void 0&&yr.descender!==void 0,!Bt))break}if(!Bt)break}let _t=0;for(const qt of ve){qt.trim();const dr=qt.getMaxScale(),Ir=(dr-1)*Fi,yr={positionedGlyphs:[],lineOffset:0};K.positionedLines[_t]=yr;const Lr=yr.positionedGlyphs;let Er=0;if(!qt.length()){Ne+=le,++_t;continue}let Fr=0,Yr=0;for(let _r=0;_r<qt.length();_r++){const $r=qt.getSection(_r),Dn=qt.getSectionIndex(_r),Nn=qt.getCodePoint(_r);let Zn=$r.scale,Xn=null,gn=null,yi=null,ns=Fi,oi=0;Se===Ds.vertical&&((At=Nn)===12312||At===12313||At===12316||At===12540||At===12448)&&(Se=Ds.horizontal);const hi=!(Se===Ds.horizontal||!Ce&&!Ah(Nn)||Ce&&(ng[Nn]||Nf(Nn)));if($r.image){const Hi=se.get($r.image.toString());if(!Hi)continue;yi=$r.image,K.iconsInText=K.iconsInText||!0,gn=Hi.paddedRect;const Pi=Hi.displaySize;Zn=Zn*Fi/Fe,Xn={width:Pi[0],height:Pi[1],left:0,top:-3,advance:hi?Pi[1]:Pi[0],localGlyph:!1},oi=Bt?-Xn.height*Zn:dr*Fi-17-Pi[1]*Zn,ns=Xn.advance;const ho=(hi?Pi[0]:Pi[1])*Zn-Fi*dr;ho>0&&ho>Er&&(Er=ho)}else{const Hi=ie[$r.fontStack];if(!Hi)continue;Hi[Nn]&&(gn=Hi[Nn]);const Pi=ae[$r.fontStack];if(!Pi)continue;const ho=Pi.glyphs[Nn];if(!ho)continue;if(Xn=ho.metrics,ns=Nn!==8203?Fi:0,Bt){const nc=Pi.ascender!==void 0?Math.abs(Pi.ascender):0,ko=Pi.descender!==void 0?Math.abs(Pi.descender):0,oa=(nc+ko)*Zn;Fr<oa&&(Fr=oa,Yr=(nc-ko)/2*Zn),oi=-nc*Zn}else oi=(dr-Zn)*Fi-17}hi?(K.verticalizable=!0,Lr.push({glyph:Nn,image:yi,x:Le,y:Ne+oi,vertical:hi,scale:Zn,localGlyph:Xn.localGlyph,fontStack:$r.fontStack,sectionIndex:Dn,metrics:Xn,rect:gn}),Le+=ns*Zn+Pe):(Lr.push({glyph:Nn,image:yi,x:Le,y:Ne+oi,vertical:hi,scale:Zn,localGlyph:Xn.localGlyph,fontStack:$r.fontStack,sectionIndex:Dn,metrics:Xn,rect:gn}),Le+=Xn.advance*Zn+Pe)}Lr.length!==0&&(ot=Math.max(Le-Pe,ot),Bt?Uw(Lr,it,Er,Yr,le*dr/2):Uw(Lr,it,Er,0,le/2)),Le=0;const wn=le*dr+Er;yr.lineOffset=Math.max(Er,Ir),Ne+=wn,++_t}var At;const ct=Ne,{horizontalAlign:rr,verticalAlign:Ot}=xv(xe);(function(qt,dr,Ir,yr,Lr,Er){const Fr=(dr-Ir)*Lr,Yr=-Er*yr;for(const wn of qt)for(const _r of wn.positionedGlyphs)_r.x+=Fr,_r.y+=Yr})(K.positionedLines,it,rr,Ot,ot,ct),K.top+=-Ot*ct,K.bottom=K.top+ct,K.left+=-rr*ot,K.right=K.left+ot,K.hasBaseline=Bt}(Z,e,n,a,k,f,y,b,w,S,M,E),!function(K){for(const ae of K)if(ae.positionedGlyphs.length!==0)return!1;return!0}($))return Z}const ng={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},nR={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Fw(o,e,n,a,u,c){if(e.image){const f=a.get(e.image.toString());return f?f.displaySize[0]*e.scale*Fi/c+u:0}{const f=n[e.fontStack],y=f&&f.glyphs[o];return y?y.metrics.advance*e.scale+u:0}}function Bw(o,e,n,a){const u=Math.pow(o-e,2);return a?o<e?u/2:2*u:u+Math.abs(n)*n}function iR(o,e,n){let a=0;return o===10&&(a-=1e4),n&&(a+=150),o!==40&&o!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Nw(o,e,n,a,u,c){let f=null,y=Bw(e,n,u,c);for(const b of a){const S=Bw(e-b.x,n,u,c)+b.badness;S<=y&&(f=b,y=S)}return{index:o,x:e,priorBreak:f,badness:y}}function Vw(o){return o?Vw(o.priorBreak).concat(o.index):[]}function xv(o){let e=.5,n=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Uw(o,e,n,a,u){if(!(e||n||a||u))return;const c=o.length-1,f=o[c],y=(f.x+f.metrics.advance*f.scale)*e;for(let b=0;b<=c;b++)o[b].x-=y,o[b].y+=n+a+u}function sR(o,e,n,a){const{horizontalAlign:u,verticalAlign:c}=xv(a),f=n[0]-o.displaySize[0]*u,y=n[1]-o.displaySize[1]*c;return{imagePrimary:o,imageSecondary:e,top:y,bottom:y+o.displaySize[1],left:f,right:f+o.displaySize[0]}}function jw(o,e,n,a,u,c){const f=o.imagePrimary;let y;if(f.content){const O=f.content,k=f.pixelRatio||1;y=[O[0]/k,O[1]/k,f.displaySize[0]-O[2]/k,f.displaySize[1]-O[3]/k]}const b=e.left*c,S=e.right*c;let _,w,M,T;n==="width"||n==="both"?(T=u[0]+b-a[3],w=u[0]+S+a[1]):(T=u[0]+(b+S-f.displaySize[0])/2,w=T+f.displaySize[0]);const E=e.top*c,C=e.bottom*c;return n==="height"||n==="both"?(_=u[1]+E-a[0],M=u[1]+C+a[2]):(_=u[1]+(E+C-f.displaySize[1])/2,M=_+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:_,right:w,bottom:M,left:T,collisionPadding:y}}class dl extends Ae{constructor(e,n,a,u,c){super(e,n),this.angle=u,this.z=a,c!==void 0&&(this.segment=c)}clone(){return new dl(this.x,this.y,this.z,this.angle,this.segment)}}function $w(o,e,n,a,u){if(e.segment===void 0)return!0;let c=e,f=e.segment+1,y=0;for(;y>-n/2;){if(f--,f<0)return!1;y-=o[f].dist(c),c=o[f]}y+=o[f].dist(o[f+1]),f++;const b=[];let S=0;for(;y<n/2;){const _=o[f],w=o[f+1];if(!w)return!1;let M=o[f-1].angleTo(_)-_.angleTo(w);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:M}),S+=M;y-b[0].distance>a;)S-=b.shift().angleDelta;if(S>u)return!1;f++,y+=_.dist(w)}return!0}function Gw(o){let e=0;for(let n=0;n<o.length-1;n++)e+=o[n].dist(o[n+1]);return e}function Hw(o,e,n){return o?.6*e*n:0}function qw(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function oR(o,e,n,a,u,c){const f=Hw(n,u,c),y=qw(n,a)*c;let b=0;const S=Gw(o)/2;for(let _=0;_<o.length-1;_++){const w=o[_],M=o[_+1],T=w.dist(M);if(b+T>S){const E=(S-b)/T,C=ar(w.x,M.x,E),O=ar(w.y,M.y,E),k=new dl(C,O,0,M.angleTo(w),_);return!f||$w(o,k,y,f,e)?k:void 0}b+=T}}function aR(o,e,n,a,u,c,f,y,b){const S=Hw(a,c,f),_=qw(a,u),w=_*f,M=o[0].x===0||o[0].x===b||o[0].y===0||o[0].y===b;return e-w<e/4&&(e=w+e/4),Ww(o,M?e/2*y%e:(_/2+2*c)*f*y%e,e,S,n,w,M,!1,b)}function Ww(o,e,n,a,u,c,f,y,b){const S=c/2,_=Gw(o);let w=0,M=e-n,T=[];for(let E=0;E<o.length-1;E++){const C=o[E],O=o[E+1],k=C.dist(O),U=O.angleTo(C);for(;M+n<w+k;){M+=n;const V=(M-w)/k,N=ar(C.x,O.x,V),$=ar(C.y,O.y,V);if(N>=0&&N<b&&$>=0&&$<b&&M-S>=0&&M+S<=_){const Z=new dl(N,$,0,U,E);a&&!$w(o,Z,c,a,u)||T.push(Z)}}w+=k}return y||T.length||f||(T=Ww(o,w/2,n,a,u,c,f,!0,b)),T}function Zw(o,e,n,a,u){const c=[];for(let f=0;f<o.length;f++){const y=o[f];let b;for(let S=0;S<y.length-1;S++){let _=y[S],w=y[S+1];_.x<e&&w.x<e||(_.x<e?_=new Ae(e,_.y+(e-_.x)/(w.x-_.x)*(w.y-_.y))._round():w.x<e&&(w=new Ae(e,_.y+(e-_.x)/(w.x-_.x)*(w.y-_.y))._round()),_.y<n&&w.y<n||(_.y<n?_=new Ae(_.x+(n-_.y)/(w.y-_.y)*(w.x-_.x),n)._round():w.y<n&&(w=new Ae(_.x+(n-_.y)/(w.y-_.y)*(w.x-_.x),n)._round()),_.x>=a&&w.x>=a||(_.x>=a?_=new Ae(a,_.y+(a-_.x)/(w.x-_.x)*(w.y-_.y))._round():w.x>=a&&(w=new Ae(a,_.y+(a-_.x)/(w.x-_.x)*(w.y-_.y))._round()),_.y>=u&&w.y>=u||(_.y>=u?_=new Ae(_.x+(u-_.y)/(w.y-_.y)*(w.x-_.x),u)._round():w.y>=u&&(w=new Ae(_.x+(u-_.y)/(w.y-_.y)*(w.x-_.x),u)._round()),b&&_.equals(b[b.length-1])||(b=[_],c.push(b)),b.push(w)))))}}return c}function Xw(o){let e=0,n=0;for(const f of o)e+=f.w*f.h,n=Math.max(n,f.w);o.sort((f,y)=>y.h-f.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,c=0;for(const f of o)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,c=Math.max(c,f.y+f.h),u=Math.max(u,f.x+f.w),f.w===b.w&&f.h===b.h){const S=a.pop();y<a.length&&(a[y]=S)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(a.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:u,h:c,fill:e/(u*c)||0}}Ft(dl,"Anchor");const nd=1;class Rp{static getImagePositionScale(e,n,a){if(n&&e&&e.options&&e.options.transform){const u=e.options.transform;return{x:u.a,y:u.d}}return{x:a,y:a}}constructor(e,n,a,u){this.paddedRect=e;const{pixelRatio:c,version:f,stretchX:y,stretchY:b,content:S,sdf:_,usvg:w}=n;this.pixelRatio=c,this.stretchX=y,this.stretchY=b,this.content=S,this.version=f,this.padding=a,this.sdf=_,this.scale=Rp.getImagePositionScale(u,w,c)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Kw(o,e,n){const a=Ao.parse(o),u=function(c,f,y=[1,1]){return{x:0,y:0,w:(c.data?c.data.width:c.width*y[0])+2*f,h:(c.data?c.data.height:c.height*y[1])+2*f}}(e,n,[a.options.transform.a,a.options.transform.d]);return{bin:u,imagePosition:new Rp(u,e,n,a),imageVariant:a}}class Yw{constructor(e,n,a){const u=new Map,c=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,u,nd,f),this.addImages(n,c,2,f);const{w:y,h:b}=Xw(f),S=new ki({width:y||1,height:b||1});for(const[_,w]of e.entries()){const M=u.get(_).paddedRect;ki.copy(w.data,S,{x:0,y:0},{x:M.x+nd,y:M.y+nd},w.data,a,w.sdf)}for(const[_,w]of n.entries()){const M=c.get(_),T=M.paddedRect;let E=M.padding;const C=T.x+E,O=T.y+E,k=w.data.width,U=w.data.height;E=E>1?E-1:E,ki.copy(w.data,S,{x:0,y:0},{x:C,y:O},w.data,a),ki.copy(w.data,S,{x:0,y:U-E},{x:C,y:O-E},{width:k,height:E},a),ki.copy(w.data,S,{x:0,y:0},{x:C,y:O+U},{width:k,height:E},a),ki.copy(w.data,S,{x:k-E,y:0},{x:C-E,y:O},{width:E,height:U},a),ki.copy(w.data,S,{x:0,y:0},{x:C+k,y:O},{width:E,height:U},a),ki.copy(w.data,S,{x:k-E,y:U-E},{x:C-E,y:O-E},{width:E,height:E},a),ki.copy(w.data,S,{x:0,y:U-E},{x:C+k,y:O-E},{width:E,height:E},a),ki.copy(w.data,S,{x:0,y:0},{x:C+k,y:O+U},{width:E,height:E},a),ki.copy(w.data,S,{x:k-E,y:0},{x:C-E,y:O+U},{width:E,height:E},a)}this.lut=a,this.image=S,this.iconPositions=u,this.patternPositions=c}addImages(e,n,a,u){for(const[c,f]of e.entries()){const{bin:y,imagePosition:b,imageVariant:S}=Kw(c,f,a);n.set(c,b),u.push(y),f.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,n,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const u of e.getUpdatedImages(a)){for(const c of this.iconPositions.keys()){const f=Ao.parse(c);if(Ts.isEqual(f.id,u)){const y=e.getImage(u,a);this.patchUpdatedImage(this.iconPositions.get(c),y,n)}}for(const c of this.patternPositions.keys()){const f=Ao.parse(c);if(Ts.isEqual(f.id,u)){const y=e.getImage(u,a);this.patchUpdatedImage(this.patternPositions.get(c),y,n)}}}}patchUpdatedImage(e,n,a){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,c]=e.tl,f=e.sdf;if(this.lut||f){const y={width:n.data.width,height:n.data.height},b=new ki(y);ki.copy(n.data,b,{x:0,y:0},{x:0,y:0},y,this.lut,f),a.update(b,{position:{x:u,y:c}})}else a.update(n.data,{position:{x:u,y:c}})}}Ft(Rp,"ImagePosition"),Ft(Yw,"ImageAtlas");const ig=1e20;function Jw(o,e,n,a,u,c,f,y,b){for(let S=e;S<e+a;S++)Qw(o,n*c+S,c,u,f,y,b);for(let S=n;S<n+u;S++)Qw(o,S*c+e,1,a,f,y,b)}function Qw(o,e,n,a,u,c,f){c[0]=0,f[0]=-1e20,f[1]=ig,u[0]=o[e];for(let y=1,b=0,S=0;y<a;y++){u[y]=o[e+y*n];const _=y*y;do{const w=c[b];S=(u[y]-u[w]+_-w*w)/(y-w)/2}while(S<=f[b]&&--b>-1);b++,c[b]=y,f[b]=S,f[b+1]=ig}for(let y=0,b=0;y<a;y++){for(;f[b+1]<y;)b++;const S=c[b],_=y-S;o[e+y*n]=u[S]+_*_}}const ra=2,bv={none:0,ideographs:1,all:2};class id{constructor(e,n,a){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,a){const u=[],c=this.urls[n]||Y.GLYPHS_URL;for(const f in e)for(const y of e[f])u.push({stack:f,id:y});xn(u,({stack:f,id:y},b)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=S.glyphs[y];if(_!==void 0)return void b(null,{stack:f,id:y,glyph:_});if(_=this._tinySDF(S,f,y),_)return S.glyphs[y]=_,void b(null,{stack:f,id:y,glyph:_});const w=Math.floor(y/256);if(256*w>65535)return Rr("glyphs > 65535 not supported"),void b(null,{stack:f,id:y,glyph:_});if(S.ranges[w])return void b(null,{stack:f,id:y,glyph:_});let M=S.requests[w];M||(M=S.requests[w]=[],id.loadGlyphRange(f,w,c,this.requestManager,(T,E)=>{if(E){S.ascender=E.ascender,S.descender=E.descender;for(const C in E.glyphs)this._doesCharSupportLocalGlyph(+C)||(S.glyphs[+C]=E.glyphs[+C]);S.ranges[w]=!0}for(const C of M)C(T,E);delete S.requests[w]})),M.push((T,E)=>{T?b(T):E&&b(null,{stack:f,id:y,glyph:E.glyphs[y]||null})})},(f,y)=>{if(f)a(f);else if(y){const b={};for(const{stack:S,id:_,glyph:w}of y)b[S]===void 0&&(b[S]={}),b[S].glyphs===void 0&&(b[S].glyphs={}),b[S].glyphs[_]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},b[S].ascender=this.entries[S].ascender,b[S].descender=this.entries[S].descender;a(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==bv.none&&(this.localGlyphMode===bv.all?!!this.localFontFamily:!!this.localFontFamily&&(er["CJK Unified Ideographs"](e)||er["Hangul Syllables"](e)||er.Hiragana(e)||er.Katakana(e)||er["CJK Symbols and Punctuation"](e)||er["CJK Unified Ideographs Extension A"](e)||er["CJK Unified Ideographs Extension B"](e)||er.Osage(e)))}_tinySDF(e,n,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let c=e.tinySDF;if(!c){let C="400";/bold/i.test(n)?C="900":/medium/i.test(n)?C="500":/light/i.test(n)&&(C="200"),c=e.tinySDF=new id.TinySDF({fontFamily:u,fontWeight:C,fontSize:24*ra,buffer:3*ra,radius:8*ra}),c.fontWeight=C}if(this.localGlyphs[c.fontWeight][a])return this.localGlyphs[c.fontWeight][a];const f=String.fromCodePoint(a),{data:y,width:b,height:S,glyphWidth:_,glyphHeight:w,glyphLeft:M,glyphTop:T,glyphAdvance:E}=c.draw(f);return this.localGlyphs[c.fontWeight][a]={id:a,bitmap:new Kl({width:b,height:S},y),metrics:{width:_/ra,height:w/ra,left:M/ra,top:T/ra-27,advance:E/ra,localGlyph:!0}}}}id.loadGlyphRange=function(o,e,n,a,u){const c=256*e,f=c+255,y=a.transformRequest(a.normalizeGlyphsURL(n).replace("{fontstack}",o).replace("{range}",`${c}-${f}`),mi.Glyphs);qa(y,(b,S)=>{if(b)u(b);else if(S){const _={},w=function(M){return new rg(M).readFields(QP,{})}(S);for(const M of w.glyphs)_[M.id]=M;u(null,{glyphs:_,ascender:w.ascender,descender:w.descender})}})},id.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:c="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=n;const y=this.size=o+4*e,b=this._createCanvas(y),S=this.ctx=b.getContext("2d",{willReadFrequently:!0});S.font=`${f} ${c} ${o}px ${u}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:c}=this.ctx.measureText(o),f=Math.ceil(n),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-u))),b=Math.min(this.size-this.buffer,f+Math.ceil(a)),S=y+2*this.buffer,_=b+2*this.buffer,w=Math.max(S*_,0),M=new Uint8ClampedArray(w),T={data:M,width:S,height:_,glyphWidth:y,glyphHeight:b,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return T;const{ctx:E,buffer:C,gridInner:O,gridOuter:k}=this;E.clearRect(C,C,y,b),E.fillText(o,C,C+f);const U=E.getImageData(C,C,y,b);k.fill(ig,0,w),O.fill(0,0,w);for(let V=0;V<b;V++)for(let N=0;N<y;N++){const $=U.data[4*(V*y+N)+3]/255;if($===0)continue;const Z=(V+C)*S+N+C;if($===1)k[Z]=0,O[Z]=ig;else{const K=.5-$;k[Z]=K>0?K*K:0,O[Z]=K<0?K*K:0}}Jw(k,0,0,S,_,S,this.f,this.v,this.z),Jw(O,C,C,y,b,S,this.f,this.v,this.z);for(let V=0;V<w;V++){const N=Math.sqrt(k[V])-Math.sqrt(O[V]);M[V]=Math.round(255-255*(N/this.radius+this.cutoff))}return T}};const mu=nd;function e2(o,e){return o+e[1]-e[0]}function t2(o,e,n,a,u=1){const c=[],f=o.imagePrimary,y=f.pixelRatio,b=f.paddedRect.w-2*mu,S=f.paddedRect.h-2*mu,_=(o.right-o.left)*u,w=(o.bottom-o.top)*u,M=f.stretchX||[[0,b]],T=f.stretchY||[[0,S]],E=M.reduce(e2,0),C=T.reduce(e2,0),O=b-E,k=S-C;let U=0,V=E,N=0,$=C,Z=0,K=O,ae=0,ie=k;if(f.content&&a){const ve=f.content;U=sg(M,0,ve[0]),N=sg(T,0,ve[1]),V=sg(M,ve[0],ve[2]),$=sg(T,ve[1],ve[3]),Z=ve[0]-U,ae=ve[1]-N,K=ve[2]-ve[0]-V,ie=ve[3]-ve[1]-$}const se=(ve,le,xe,Me)=>{const Se=og(ve.stretch-U,V,_,o.left*u),Pe=ag(ve.fixed-Z,K,ve.stretch,E),Ce=og(le.stretch-N,$,w,o.top*u),Fe=ag(le.fixed-ae,ie,le.stretch,C),Le=og(xe.stretch-U,V,_,o.left*u),Ne=ag(xe.fixed-Z,K,xe.stretch,E),ot=og(Me.stretch-N,$,w,o.top*u),it=ag(Me.fixed-ae,ie,Me.stretch,C),Bt=new Ae(Se,Ce),_t=new Ae(Le,Ce),At=new Ae(Le,ot),ct=new Ae(Se,ot),rr=new Ae(Pe/y,Fe/y),Ot=new Ae(Ne/y,it/y),qt=e*Math.PI/180;if(qt){const Fr=Math.sin(qt),Yr=Math.cos(qt),wn=[Yr,-Fr,Fr,Yr];Bt._matMult(wn),_t._matMult(wn),ct._matMult(wn),At._matMult(wn)}const dr=ve.stretch+ve.fixed,Ir=xe.stretch+xe.fixed,yr=le.stretch+le.fixed,Lr=Me.stretch+Me.fixed,Er=o.imageSecondary;return{tl:Bt,tr:_t,bl:ct,br:At,texPrimary:{x:f.paddedRect.x+mu+dr,y:f.paddedRect.y+mu+yr,w:Ir-dr,h:Lr-yr},texSecondary:Er?{x:Er.paddedRect.x+mu+dr,y:Er.paddedRect.y+mu+yr,w:Ir-dr,h:Lr-yr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:rr,pixelOffsetBR:Ot,minFontScaleX:K/y/_,minFontScaleY:ie/y/w,isSDF:n}};if(a&&(f.stretchX||f.stretchY)){const ve=r2(M,O,E),le=r2(T,k,C);for(let xe=0;xe<ve.length-1;xe++){const Me=ve[xe],Se=ve[xe+1];for(let Pe=0;Pe<le.length-1;Pe++)c.push(se(Me,le[Pe],Se,le[Pe+1]))}}else c.push(se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return c}function sg(o,e,n){let a=0;for(const u of o)a+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return a}function r2(o,e,n){const a=[{fixed:-1,stretch:0}];for(const[u,c]of o){const f=a[a.length-1];a.push({fixed:u-f.stretch,stretch:f.stretch}),a.push({fixed:u-f.stretch,stretch:f.stretch+(c-u)})}return a.push({fixed:e+mu,stretch:n}),a}function og(o,e,n,a){return o/e*n+a}function ag(o,e,n,a){return o-e*n/a}function lR(o,e,n,a){const u=e+o.positionedLines[a].lineOffset;return a===0?n+u/2:n+(u+(e+o.positionedLines[a-1].lineOffset))/2}function cR(o,e=1,n=!1){let a=1/0,u=1/0,c=-1/0,f=-1/0;const y=o[0];for(let T=0;T<y.length;T++){const E=y[T];(!T||E.x<a)&&(a=E.x),(!T||E.y<u)&&(u=E.y),(!T||E.x>c)&&(c=E.x),(!T||E.y>f)&&(f=E.y)}const b=Math.min(c-a,f-u);let S=b/2;const _=new qo([],uR);if(b===0)return new Ae(a,u);for(let T=a;T<c;T+=b)for(let E=u;E<f;E+=b)_.push(new sd(T+S,E+S,S,o));let w=function(T){let E=0,C=0,O=0;const k=T[0];for(let U=0,V=k.length,N=V-1;U<V;N=U++){const $=k[U],Z=k[N],K=$.x*Z.y-Z.x*$.y;C+=($.x+Z.x)*K,O+=($.y+Z.y)*K,E+=3*K}return new sd(C/E,O/E,0,T)}(o),M=_.length;for(;_.length;){const T=_.pop();(T.d>w.d||!w.d)&&(w=T,n&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,M)),T.max-w.d<=e||(S=T.h/2,_.push(new sd(T.p.x-S,T.p.y-S,S,o)),_.push(new sd(T.p.x+S,T.p.y-S,S,o)),_.push(new sd(T.p.x-S,T.p.y+S,S,o)),_.push(new sd(T.p.x+S,T.p.y+S,S,o)),M+=4)}return n&&(console.log(`num probes: ${M}`),console.log(`best distance: ${w.d}`)),w.p}function uR(o,e){return e.max-o.max}class sd{constructor(e,n,a,u){this.p=new Ae(e,n),this.h=a,this.d=function(c,f){let y=!1,b=1/0;for(let S=0;S<f.length;S++){const _=f[S];for(let w=0,M=_.length,T=M-1;w<M;T=w++){const E=_[w],C=_[T];E.y>c.y!=C.y>c.y&&c.x<(C.x-E.x)*(c.y-E.y)/(C.y-E.y)+E.x&&(y=!y),b=Math.min(b,pe(c,E,C))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const wv=Number.POSITIVE_INFINITY,hR=Math.sqrt(2);function n2(o,[e,n]){let a=0,u=0;if(n===wv){e<0&&(e=0);const c=e/hR;switch(o){case"top-right":case"top-left":u=c-7;break;case"bottom-right":case"bottom-left":u=7-c;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(o){case"top-right":case"bottom-right":a=-c;break;case"top-left":case"bottom-left":a=c;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),o){case"top-right":case"top-left":case"top":u=n-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-n}switch(o){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function i2(o,e,n,a,u,c,f,y){if(!o)return;const b=zw(e,n,a,u,c);return o.scaleSelf(b*y*f)}function s2(o,e,n,a,u,c,f,y){return{iconPrimary:i2(o.getPrimary(),e,n,a,u,c,f,y),iconSecondary:i2(o.getSecondary(),e,n,a,u,c,f,y)}}function o2(o,e,n,a){if(!o)return;const u=e.get(n.toString());if(o.imagePrimary=u,a){const c=e.get(a.toString());o.imageSecondary=c}}function dR(o,e){for(const n in o.horizontal)a2(o.horizontal[n],e);a2(o.vertical,e)}function a2(o,e){if(o){for(const n of o.positionedLines)for(const a of n.positionedGlyphs)if(a.image!==null){const u=a.image.toString();a.rect=e.get(u).paddedRect}}}function Tv(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function fR(o,e,n,a,u,c,f,y,b){const S=Sv(c.horizontal)||c.vertical,_=n.get("icon-text-fit-padding").evaluate(a,{},u);let w,M=e;return e&&b!=="none"&&(o.allowVerticalPlacement&&c.vertical&&(w=jw(e,c.vertical,b,_,y,f)),S&&(M=jw(e,S,b,_,y,f))),{defaultShapedIcon:M,verticallyShapedIcon:w}}function pR(o,e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V){let N=f.textMaxSize.evaluate(e,{},M);N===void 0?N=y*f.textScaleFactor:N*=f.textScaleFactor;const $=o.layers[0].layout,Z=Sv(n.horizontal)||n.vertical,K=T.name==="globe",ae=Fi,ie=o.tilePixelRatio*N/ae,se=(Pe=o.overscaling,o.zoom>18&&Pe>2&&(Pe>>=1),Math.max(Ct/(512*Pe),1)*$.get("symbol-spacing")),ve=$.get("text-padding")*o.tilePixelRatio,le=$.get("icon-padding")*o.tilePixelRatio,xe=Dt($.get("text-max-angle")),Me=$.get("icon-rotation-alignment")==="map"&&V!=="point",Se=se/2;var Pe;o.hasAnyIconTextFit===!1&&O!=="none"&&(o.hasAnyIconTextFit=!0);const Ce=e.properties?+e.properties[du]:null,Fe=Ce&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(Ce):65535,Le=(Ne,ot,it)=>{if(ot.x<0||ot.x>=Ct||ot.y<0||ot.y>=Ct)return;let Bt=null;if(K){const{x:_t,y:At,z:ct}=T.projectTilePoint(ot.x,ot.y,it);Bt={anchor:new dl(_t,At,ct,0,void 0),up:T.upVector(it,ot.x,ot.y)}}(function(_t,At,ct,rr,Ot,qt,dr,Ir,yr,Lr,Er,Fr,Yr,wn,_r,$r,Dn,Nn,Zn,Xn,gn,yi,ns,oi,hi,Hi,Pi,ho,nc){const ko=_t.addToLineVertexArray(At,rr);let oa,ic,sc,xu,$T,GT,HT,qT=0,WT=0,ZT=0,XT=0,nx=-1,ix=-1;const La={};let KT=ro("");const bu=ct?ct.anchor:At,sx=ho!=="none";let ox=0,ax=0;if(yr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ox,ax]=yr.layout.get("text-offset").evaluate(gn,{},hi).map(fo=>fo*Fi):(ox=yr.layout.get("text-radial-offset").evaluate(gn,{},hi)*Fi,ax=wv),_t.allowVerticalPlacement&&Ot.vertical){const fo=Ot.vertical;if(_r)GT=Ev(fo),Ir&&(HT=Ev(Ir));else{const zs=yr.layout.get("text-rotate").evaluate(gn,{},hi)+90;sc=lg(Lr,bu,At,Er,Fr,Yr,fo,wn,zs,$r),Ir&&(xu=lg(Lr,bu,At,Er,Fr,Yr,Ir,Nn,zs))}}if(qt){const fo=_t.iconSizeData,zs=yr.layout.get("icon-rotate").evaluate(gn,{},hi),Kp=t2(qt,zs,ns,sx,yi.iconScaleFactor),cx=Ir?t2(Ir,zs,ns,sx,yi.iconScaleFactor):void 0;ic=lg(Lr,bu,At,Er,Fr,Yr,qt,Nn,zs,null),qT=4*Kp.length;let wu=null;fo.kind==="source"?(wu=[ta*yr.layout.get("icon-size").evaluate(gn,{},hi)*yi.iconScaleFactor],wu[0]>Ql&&Rr(`${_t.layerIds[0]}: Value for "icon-size" is >= ${Dp}. Reduce your "icon-size".`)):fo.kind==="composite"&&(wu=[ta*yi.compositeIconSizes[0].evaluate(gn,{},hi)*yi.iconScaleFactor,ta*yi.compositeIconSizes[1].evaluate(gn,{},hi)*yi.iconScaleFactor],(wu[0]>Ql||wu[1]>Ql)&&Rr(`${_t.layerIds[0]}: Value for "icon-size" is >= ${Dp}. Reduce your "icon-size".`)),_t.addSymbols(_t.icon,Kp,wu,Xn,Zn,gn,!1,ct,At,ko.lineStartIndex,ko.lineLength,-1,oi,hi,Hi,Pi),nx=_t.icon.placedSymbolArray.length-1,cx&&(WT=4*cx.length,_t.addSymbols(_t.icon,cx,wu,Xn,Zn,gn,Ds.vertical,ct,At,ko.lineStartIndex,ko.lineLength,-1,oi,hi,Hi,Pi),ix=_t.icon.placedSymbolArray.length-1)}for(const fo in Ot.horizontal){const zs=Ot.horizontal[fo];oa||(KT=ro(zs.text),_r?$T=Ev(zs):oa=lg(Lr,bu,At,Er,Fr,Yr,zs,wn,yr.layout.get("text-rotate").evaluate(gn,{},hi),$r));const Kp=zs.positionedLines.length===1;if(ZT+=l2(_t,ct,At,zs,dr,yr,_r,gn,$r,ko,Ot.vertical?Ds.horizontal:Ds.horizontalOnly,Kp?Object.keys(Ot.horizontal):[fo],La,nx,yi,oi,hi,Hi),Kp)break}Ot.vertical&&(XT+=l2(_t,ct,At,Ot.vertical,dr,yr,_r,gn,$r,ko,Ds.vertical,["vertical"],La,ix,yi,oi,hi,Hi));let oc=-1;const lx=(fo,zs)=>fo?Math.max(fo,zs):zs;oc=lx($T,oc),oc=lx(GT,oc),oc=lx(HT,oc);const qD=oc>-1?1:0;_t.glyphOffsetArray.length>=65535&&Rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gn.sortKey!==void 0&&_t.addToSortKeyRanges(_t.symbolInstances.length,gn.sortKey),_t.symbolInstances.emplaceBack(At.x,At.y,bu.x,bu.y,bu.z,La.right>=0?La.right:-1,La.center>=0?La.center:-1,La.left>=0?La.left:-1,La.vertical>=0?La.vertical:-1,nx,ix,KT,oa!==void 0?oa:_t.collisionBoxArray.length,oa!==void 0?oa+1:_t.collisionBoxArray.length,sc!==void 0?sc:_t.collisionBoxArray.length,sc!==void 0?sc+1:_t.collisionBoxArray.length,ic!==void 0?ic:_t.collisionBoxArray.length,ic!==void 0?ic+1:_t.collisionBoxArray.length,xu||_t.collisionBoxArray.length,xu?xu+1:_t.collisionBoxArray.length,Er,ZT,XT,qT,WT,qD,0,ox,ax,oc,0,sx?1:0,nc)})(o,ot,Bt,Ne,n,a,c,u,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,ve,U,S,0,le,Me,k,e,f,_,w,M,E,C,O,Fe)};if(V==="line")for(const Ne of Zw(e.geometry,0,0,Ct,Ct)){const ot=aR(Ne,se,xe,n.vertical||Z,a,ae,ie,o.overscaling,Ct);for(const it of ot)Z&&mR(o,Z.text,Se,it)||Le(Ne,it,M)}else if(V==="line-center"){for(const Ne of e.geometry)if(Ne.length>1){const ot=oR(Ne,xe,n.vertical||Z,a,ae,ie);ot&&Le(Ne,ot,M)}}else if(e.type==="Polygon")for(const Ne of Z_(e.geometry,0)){const ot=cR(Ne,16);Le(Ne[0],new dl(ot.x,ot.y,0,0,void 0),M)}else if(e.type==="LineString")for(const Ne of e.geometry)Le(Ne,new dl(Ne[0].x,Ne[0].y,0,0,void 0),M);else if(e.type==="Point")for(const Ne of e.geometry)for(const ot of Ne)Le([ot],new dl(ot.x,ot.y,0,0,void 0),M)}const Dp=255,Ql=Dp*ta;function l2(o,e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k){const U=function($,Z,K,ae,ie,se,ve,le){const xe=[];if(Z.positionedLines.length===0)return xe;const Me=ae.layout.get("text-rotate").evaluate(se,{})*Math.PI/180,Se=function(Ne){const ot=Ne[0],it=Ne[1],Bt=ot*it;return Bt>0?[ot,-it]:Bt<0?[-ot,it]:ot===0?[it,ot]:[it,-ot]}(K);let Pe=Math.abs(Z.top-Z.bottom);for(const Ne of Z.positionedLines)Pe-=Ne.lineOffset;const Ce=Z.positionedLines.length,Fe=Pe/Ce;let Le=Z.top-K[1];for(let Ne=0;Ne<Ce;++Ne){const ot=Z.positionedLines[Ne];Le=lR(Z,Fe,Le,Ne);for(const it of ot.positionedGlyphs){if(!it.rect)continue;const Bt=it.rect||{};let _t=rR+1,At=!0,ct=1,rr=0;if(it.image){const gn=ve.get(it.image.toString());if(!gn)continue;if(gn.sdf){Rr("SDF images are not supported in formatted text and will be ignored.");continue}At=!1,ct=gn.pixelRatio,_t=nd/ct}const Ot=(ie||le)&&it.vertical,qt=it.metrics.advance*it.scale/2,dr=it.metrics,Ir=it.rect;if(Ir===null)continue;le&&Z.verticalizable&&(rr=it.image?qt-it.metrics.width*it.scale/2:0);const yr=ie?[it.x+qt,it.y]:[0,0];let Lr=[0,0],Er=[0,0],Fr=!1;ie||(Ot?(Er=[it.x+qt+Se[0],it.y+Se[1]-rr],Fr=!0):Lr=[it.x+qt+K[0],it.y+K[1]-rr]);const Yr=Ir.w*it.scale/(ct*(it.localGlyph?ra:1)),wn=Ir.h*it.scale/(ct*(it.localGlyph?ra:1));let _r,$r,Dn,Nn;if(Ot){const gn=it.y-Le,yi=new Ae(-qt,qt-gn),ns=-Math.PI/2,oi=new Ae(...Er);_r=new Ae(-qt+Lr[0],Lr[1]),_r._rotateAround(ns,yi)._add(oi),_r.x+=-gn+qt,_r.y-=(dr.left-_t)*it.scale;const hi=it.image?dr.advance*it.scale:Fi*it.scale,Hi=String.fromCodePoint(it.glyph);KP(Hi)?_r.x+=(1-_t)*it.scale:YP(Hi)?_r.x+=hi-dr.height*it.scale+(-_t-1)*it.scale:_r.x+=it.image||dr.width+2*_t===Ir.w&&dr.height+2*_t===Ir.h?(hi-wn)/2:(hi-(dr.height+2*_t)*it.scale)/2,$r=new Ae(_r.x,_r.y-Yr),Dn=new Ae(_r.x+wn,_r.y),Nn=new Ae(_r.x+wn,_r.y-Yr)}else{const gn=(dr.left-_t)*it.scale-qt+Lr[0],yi=(-dr.top-_t)*it.scale+Lr[1],ns=gn+Yr,oi=yi+wn;_r=new Ae(gn,yi),$r=new Ae(ns,yi),Dn=new Ae(gn,oi),Nn=new Ae(ns,oi)}if(Me){let gn;gn=ie?new Ae(0,0):Fr?new Ae(Se[0],Se[1]):new Ae(K[0],K[1]),_r._rotateAround(Me,gn),$r._rotateAround(Me,gn),Dn._rotateAround(Me,gn),Nn._rotateAround(Me,gn)}const Zn=new Ae(0,0),Xn=new Ae(0,0);xe.push({tl:_r,tr:$r,bl:Dn,br:Nn,texPrimary:Bt,texSecondary:void 0,writingMode:Z.writingMode,glyphOffset:yr,sectionIndex:it.sectionIndex,isSDF:At,pixelOffsetTL:Zn,pixelOffsetBR:Xn,minFontScaleX:0,minFontScaleY:0})}}return xe}(0,a,b,c,f,y,u,o.allowVerticalPlacement),V=o.textSizeData;let N=null;V.kind==="source"?(N=[ta*c.layout.get("text-size").evaluate(y,{},O)*E.textScaleFactor],N[0]>Ql&&Rr(`${o.layerIds[0]}: Value for "text-size" is >= ${Dp}. Reduce your "text-size".`)):V.kind==="composite"&&(N=[ta*E.compositeTextSizes[0].evaluate(y,{},O)*E.textScaleFactor,ta*E.compositeTextSizes[1].evaluate(y,{},O)*E.textScaleFactor],(N[0]>Ql||N[1]>Ql)&&Rr(`${o.layerIds[0]}: Value for "text-size" is >= ${Dp}. Reduce your "text-size".`)),o.addSymbols(o.text,U,N,b,f,y,_,e,n,S.lineStartIndex,S.lineLength,T,C,O,k,!1);for(const $ of w)M[$]=o.text.placedSymbolArray.length-1;return 4*U.length}function Sv(o){for(const e in o)return o[e];return null}function lg(o,e,n,a,u,c,f,y,b,S){let _=f.top,w=f.bottom,M=f.left,T=f.right;const E=f.collisionPadding;if(E&&(M-=E[0],_-=E[1],T+=E[2],w+=E[3]),b){const C=new Ae(M,_),O=new Ae(T,_),k=new Ae(M,w),U=new Ae(T,w),V=Dt(b);let N=new Ae(0,0);S&&(N=new Ae(S[0],S[1])),C._rotateAround(V,N),O._rotateAround(V,N),k._rotateAround(V,N),U._rotateAround(V,N),M=Math.min(C.x,O.x,k.x,U.x),T=Math.max(C.x,O.x,k.x,U.x),_=Math.min(C.y,O.y,k.y,U.y),w=Math.max(C.y,O.y,k.y,U.y)}return o.emplaceBack(e.x,e.y,e.z,n.x,n.y,M,_,T,w,y,a,u,c),o.length-1}function Ev(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function mR(o,e,n,a){const u=o.compareText;if(e in u){const c=u[e];for(let f=c.length-1;f>=0;f--)if(a.dist(c[f])<n)return!0}else u[e]=[];return u[e].push(a),!1}function c2(o,e){const n=o.fovAboveCenter,a=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,u=(o._camera.position[2]*o.worldSize-a)/Math.cos(o._pitch),c=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-o._pitch-n,.01));let f=Math.sin(o._pitch)*c+u;const y=u*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let b=Math.max(o.zoom-17,0);o.isOrthographic&&(b/=10),f*=1+b}return Math.min(1.01*f,y)}function zp(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const n=Math.pow(2,-o.z),a=o.x*n,u=(o.x+1)*n,c=o.y*n,f=(o.y+1)*n,y=ds(a),b=ds(u),S=Ci(c),_=Ci(f),w=e.project(y,S),M=e.project(b,S),T=e.project(b,_),E=e.project(y,_);let C=Math.min(w.x,M.x,T.x,E.x),O=Math.min(w.y,M.y,T.y,E.y),k=Math.max(w.x,M.x,T.x,E.x),U=Math.max(w.y,M.y,T.y,E.y);const V=n/16;function N(Z,K,ae,ie,se,ve){const le=(ae+se)/2,xe=(ie+ve)/2,Me=e.project(ds(le),Ci(xe)),Se=Math.max(0,C-Me.x,O-Me.y,Me.x-k,Me.y-U);C=Math.min(C,Me.x),k=Math.max(k,Me.x),O=Math.min(O,Me.y),U=Math.max(U,Me.y),Se>V&&(N(Z,Me,ae,ie,le,xe),N(Me,K,le,xe,se,ve))}N(w,M,a,c,u,c),N(M,T,u,c,u,f),N(T,E,u,f,a,f),N(E,w,a,f,a,c),C-=V,O-=V,k+=V,U+=V;const $=1/Math.max(k-C,U-O);return{scale:$,x:C*$,y:O*$,x2:k*$,y2:U*$,projection:e}}function u2(o,{x:e,y:n},a=0){return new Ae(((e-a)*o.scale-o.x)*Ct,(n*o.scale-o.y)*Ct)}const _R=te.mat4.identity(new Float32Array(16));class ec{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Qr(0,0)}projectTilePoint(e,n,a){return{x:e,y:n,z:0}}locationPoint(e,n,a,u=!0){return e._coordinatePoint(e.locationCoordinate(n,a),u)}pixelsPerMeter(e,n){return Xi(1,e)*n}pixelSpaceConversion(e,n,a){return 1}farthestPixelDistance(e){return c2(e,e.pixelsPerMeter)}pointCoordinate(e,n,a,u){const c=e.horizonLineFromTop(!1),f=new Ae(n,Math.max(c,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,u))}pointCoordinate3D(e,n,a){const u=new Ae(n,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const c=this.pointCoordinate(e,u.x,u.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,n){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,n.x,n.y);const a=e.horizonLineFromTop();return n.y<a}createInversionMatrix(e,n){return _R}createTileMatrix(e,n,a){let u,c,f;const y=a.canonical,b=te.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=zp(y,this);u=1,c=S.x+a.wrap*S.scale,f=S.y,te.mat4.scale(b,b,[u/S.scale,u/S.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(y.z),c=(y.x+Math.pow(2,y.z)*a.wrap)*u,f=y.y*u;return te.mat4.translate(b,b,[c,f,0]),te.mat4.scale(b,b,[u/Ct,u/Ct,1]),b}upVector(e,n,a){return[0,0,1]}upVectorScale(e,n,a){return{metersToTile:1}}}class gR extends ec{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Dt(n));this.n=(u+Math.sin(Dt(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:a,c:u,r0:c}=this,f=Dt(e-this.center[0]),y=Dt(n),b=Math.sqrt(u-2*a*Math.sin(y))/a;return{x:b*Math.sin(f*a),y:b*Math.cos(f*a)-c,z:0}}unproject(e,n){const{n:a,c:u,r0:c}=this,f=c+n;let y=Math.atan2(e,Math.abs(f))*Math.sign(f);f*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(f));const b=Dt(this.center[0])*a;y=Gr(y,-Math.PI-b,Math.PI-b);const S=Ye(jt(y/a)+this.center[0],-180,180),_=Math.asin(Ye((u-(e*e+f*f)*a*a)/(2*a),-1,1)),w=Ye(jt(_),-85.051129,es);return new Qr(S,w)}}const Lp=1.340264,Op=-.081106,kp=893e-6,Fp=.003796,cg=Math.sqrt(3)/2;class yR extends ec{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(cg*Math.sin(n)),u=a*a,c=u*u*u;return{x:.5*(e*Math.cos(a)/(cg*(Lp+3*Op*u+c*(7*kp+9*Fp*u)))/Math.PI+.5),y:1-.5*(a*(Lp+Op*u+c*(kp+Fp*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,u=a*a,c=u*u*u;for(let _,w,M,T=0;T<12&&(w=a*(Lp+Op*u+c*(kp+Fp*u))-n,M=Lp+3*Op*u+c*(7*kp+9*Fp*u),_=w/M,a=Ye(a-_,-Math.PI/3,Math.PI/3),u=a*a,c=u*u*u,!(Math.abs(_)<1e-12));++T);const f=cg*e*(Lp+3*Op*u+c*(7*kp+9*Fp*u))/Math.cos(a),y=Math.asin(Math.sin(a)/cg),b=Ye(180*f/Math.PI,-180,180),S=Ye(180*y/Math.PI,-85.051129,es);return new Qr(b,S)}}class vR extends ec{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const a=360*(e-.5),u=Ye(360*(.5-n),-85.051129,es);return new Qr(a,u)}}const od=Math.PI/2;function ug(o){return Math.tan((od+o)/2)}class xR extends ec{constructor(e){super(e),this.center=e.center||[0,30];const[n,a]=this.parallels=e.parallels||[30,30];let u=Dt(n),c=Dt(a);this.southernCenter=u+c<0,this.southernCenter&&(u=-u,c=-c);const f=Math.cos(u),y=ug(u);this.n=u===c?Math.sin(u):Math.log(f/Math.cos(c))/Math.log(ug(c)/y),this.f=f*Math.pow(ug(u),this.n)/this.n}project(e,n){n=Dt(n),this.southernCenter&&(n=-n),e=Dt(e-this.center[0]);const a=1e-6,{n:u,f:c}=this;c>0?n<-od+a&&(n=-od+a):n>od-a&&(n=od-a);const f=c/Math.pow(ug(n),u);let y=f*Math.sin(u*e),b=c-f*Math.cos(u*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:a,f:u}=this,c=u-n,f=Math.sign(c),y=Math.sign(a)*Math.sqrt(e*e+c*c);let b=Math.atan2(e,Math.abs(c))*f;c*a<0&&(b-=Math.PI*Math.sign(e)*f);const S=Ye(jt(b/a)+this.center[0],-180,180),_=Ye(jt(2*Math.atan(Math.pow(u/y,1/a))-od),-85.051129,es);return new Qr(S,this.southernCenter?-_:_)}}class h2 extends ec{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ps(e),y:lo(n),z:0}}unproject(e,n){const a=ds(e),u=Ci(n);return new Qr(a,u)}}const d2=Dt(es);class bR extends ec{project(e,n){const a=(n=Dt(n))*n,u=a*a;return{x:.5*((e=Dt(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let a=n=(2*(1-n)-1)*Math.PI,u=25,c=0,f=a*a;do{f=a*a;const S=f*f;c=(a*(1.007226+f*(.015085+S*(.028874*f-.044475-.005916*S)))-n)/(1.007226+f*(.045255+S*(.259866*f-.311325-.005916*11*S))),a=Ye(a-c,-d2,d2)}while(Math.abs(c)>1e-6&&--u>0);f=a*a;const y=Ye(jt(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),b=jt(a);return new Qr(y,b)}}const f2=Dt(es);class wR extends ec{project(e,n){n=Dt(n),e=Dt(e);const a=Math.cos(n),u=2/Math.PI,c=Math.acos(a*Math.cos(e/2)),f=Math.sin(c)/c,y=.5*(e*u+2*a*Math.sin(e/2)/f)||0,b=.5*(n+Math.sin(n)/f)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,n){let a=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,c=25;const f=1e-6;let y=0,b=0;do{const S=Math.cos(u),_=Math.sin(u),w=2*_*S,M=_*_,T=S*S,E=Math.cos(a/2),C=Math.sin(a/2),O=2*E*C,k=C*C,U=1-T*E*E,V=U?1/U:0,N=U?Math.acos(S*E)*Math.sqrt(1/U):0,$=.5*(2*N*S*C+2*a/Math.PI)-e,Z=.5*(N*_+u)-n,K=.5*V*(T*k+N*S*E*M)+1/Math.PI,ae=V*(O*w/4-N*_*C),ie=.125*V*(w*C-N*_*T*O),se=.5*V*(M*E+N*k*S)+.5,ve=ae*ie-se*K;y=(Z*ae-$*se)/ve,b=($*ie-Z*K)/ve,a=Ye(a-y,-Math.PI,Math.PI),u=Ye(u-b,-f2,f2)}while((Math.abs(y)>f||Math.abs(b)>f)&&--c>0);return new Qr(jt(a),jt(u))}}class p2 extends ec{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Dt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:a,cosPhi:u}=this;return{x:Dt(e)*u*a+.5,y:-Math.sin(Dt(n))/u*a+.5,z:0}}unproject(e,n){const{scale:a,cosPhi:u}=this,c=-(n-.5)/a,f=Ye(jt((e-.5)/a)/u,-180,180),y=Math.asin(Ye(c*u,-1,1)),b=Ye(jt(y),-85.051129,es);return new Qr(f,b)}}class TR extends h2{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,a){const u=_n(e,n,a),c=ci(pi(a));return te.vec3.transformMat4(u,u,c),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n,a){const u=Ra(n.lat,n.lng),c=te.vec3.normalize([],u),f=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,y=Xi(1,0)*Ct*f;te.vec3.scaleAndAdd(u,u,c,y);const b=te.mat4.identity(new Float64Array(16));return te.mat4.multiply(b,e.pixelMatrix,e.globeMatrix),te.vec3.transformMat4(u,u,b),new Ae(u[0],u[1])}pixelsPerMeter(e,n){return Xi(1,0)*n}pixelSpaceConversion(e,n,a){const u=Xi(1,e)*n,c=ar(Xi(1,45)*n,u,a);return this.pixelsPerMeter(e,n)/c}createTileMatrix(e,n,a){const u=zo(pi(a.canonical));return te.mat4.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){const{center:a}=e,u=ci(pi(n));return te.mat4.rotateY(u,u,Dt(a.lng)),te.mat4.rotateX(u,u,Dt(a.lat)),te.mat4.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,a,u){return Wn(e,n,a,!0)||new s(0,0)}pointCoordinate3D(e,n,a){const u=this.pointCoordinate(e,n,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!Wn(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(u,c){const f=u.cameraToCenterDistance,y=u._centerAltitude*c,b=u._camera,S=u._camera.forward(),_=te.vec3.add([],te.vec3.scale([],S,-f),[0,0,y]),w=u.worldSize/(2*Math.PI),M=[0,0,-w],T=u.width/u.height,E=Math.tan(u.fovAboveCenter),C=te.vec3.scale([],b.up(),E),O=te.vec3.scale([],b.right(),E*T),k=te.vec3.normalize([],te.vec3.add([],te.vec3.add([],S,C),O)),U=[];let V;if(new Br(_,k).closestPointOnSphere(M,w,U)){const N=te.vec3.add([],U,M),$=te.vec3.sub([],N,_);V=Math.cos(u.fovAboveCenter)*te.vec3.length($)}else{const N=te.vec3.sub([],_,M),$=te.vec3.sub([],M,_);te.vec3.normalize($,$);const Z=te.vec3.length(N)-w;V=Math.sqrt(Z*(Z+2*w));const K=Math.acos(V/(w+Z))-Math.acos(te.vec3.dot(S,$));V*=Math.cos(K)}return 1.01*V}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Oi(e.zoom);if(a>0){const u=c2(e,Xi(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ar(n,u+c*(1-Math.cos(f)),Math.pow(a,10))}return n}upVector(e,n,a){return _n(n,a,e,1)}upVectorScale(e){return{metersToTile:en(_i(pi(e)))}}}function m2(o){const e=o.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new h2(o);case"equirectangular":return new vR(o);case"naturalEarth":return new bR(o);case"equalEarth":return new yR(o);case"winkelTripel":return new wR(o);case"albers":return n?new p2(o):new gR(o);case"lambertConformalConic":return n?new p2(o):new xR(o);case"globe":return new TR(o)}throw new Error(`Invalid projection name: ${o.name}`)}const SR=Yl.VectorTileFeature.types,ER=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hg(o,e,n,a,u,c,f,y,b,S,_,w,M){const T=y?Math.min(Ql,Math.round(y[0])):0,E=y?Math.min(Ql,Math.round(y[1])):0;o.emplaceBack(e,n,Math.round(32*a),Math.round(32*u),c,f,(T<<1)+(b?1:0),E,16*S,16*_,256*w,256*M)}function dg(o,e,n){o.emplaceBack(e,n)}function fg(o,e,n,a,u,c,f){o.emplaceBack(e,n,a,u,c,f)}function pg(o,e,n,a,u){o.emplaceBack(e,n,a,u),o.emplaceBack(e,n,a,u),o.emplaceBack(e,n,a,u),o.emplaceBack(e,n,a,u)}function AR(o){for(const e of o.sections)if(z0(e.text))return!0;return!1}class Av{constructor(e){this.layoutVertexArray=new Yf,this.indexArray=new wi,this.programConfigurations=e,this.segments=new Gn,this.dynamicLayoutVertexArray=new al,this.opacityVertexArray=new Qf,this.placedSymbolArray=new F_,this.iconTransitioningVertexArray=new Aa,this.globeExtVertexArray=new Jf,this.zOffsetVertexArray=new Sa}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,a,u,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,VP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,jP.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ER,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,GP.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,UP.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,$P.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ft(Av,"SymbolBuffers");class Mv{constructor(e,n,a){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new a,this.segments=new Gn,this.collisionVertexArray=new tp,this.collisionVertexArrayExt=new al}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,HP.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,qP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ft(Mv,"CollisionBuffers");class mg{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=te.mat4.identity([]),this.placementViewportMatrix=te.mat4.identity([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=mv(this.zoom,n["text-size"]),this.iconSizeData=mv(this.zoom,n["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),c=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(f=>Ds[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Av(new Pa(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Av(new Pa(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new su,this.lineVertexArray=new ou,this.symbolInstances=new N_}calculateGlyphDependencies(e,n,a,u,c){for(const f of e){const y=f.codePointAt(0);if(y===void 0)break;if(n[y]=!0,u&&c&&y<=65535){const b=Cp[f];b&&(n[b.charCodeAt(0)]=!0)}}}updateFootprints(e,n){}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!lv(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,n,a,u){const c=this.layers[0],f=c.layout,y=this.projection.name==="globe",b=f.get("text-font"),S=f.get("text-field"),_=f.get("icon-image"),[w,M]=f.get("icon-size-scale-range"),T=Ye(n.scaleFactor||1,w,M),E=(S.value.kind!=="constant"||S.value.value instanceof $i&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),C=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,O=f.get("symbol-sort-key");if(this.features=[],!E&&!C)return;const k=n.iconDependencies,U=n.glyphDependencies,V=n.availableImages,N=new bn(this.zoom);for(const{feature:$,id:Z,index:K,sourceLayerIndex:ae}of e){const ie=c._featureFilter.needGeometry,se=F($,ie);if(!c._featureFilter.filter(N,se,a))continue;if(ie||(se.geometry=L($,a,u)),y&&$.type!==1&&a.z<=5){const Se=se.geometry,Pe=.98078528056,Ce=(Fe,Le)=>{const Ne=_n(Fe.x,Fe.y,a,1),ot=_n(Le.x,Le.y,a,1);return te.vec3.dot(Ne,ot)<Pe};for(let Fe=0;Fe<Se.length;Fe++)Se[Fe]=x(Se[Fe],Ce)}let ve,le;if(E){const Se=c.getValueAndResolveTokens("text-field",se,a,V),Pe=$i.factory(Se);AR(Pe)&&(this.hasRTLText=!0),(!this.hasRTLText||$f()==="unavailable"||this.hasRTLText&&us.isParsed())&&(ve=XP(Pe,c,se))}if(C){const Se=c.getValueAndResolveTokens("icon-image",se,a,V);le=Se instanceof Mi?Se:Mi.build(Se)}if(!ve&&!le)continue;const xe=this.sortFeaturesByKey?O.evaluate(se,{},a):void 0,Me={id:Z,text:ve,icon:le,index:K,sourceLayerIndex:ae,geometry:se.geometry,properties:$.properties,type:SR[$.type],sortKey:xe};if(this.features.push(Me),le){const Se=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Pe,iconSecondary:Ce}=s2(le,this.iconSizeData,Se["icon-size"],a,this.zoom,Me,this.pixelRatio,T),Fe=Pe.id.toString();if(k.has(Fe)?k.get(Fe).push(Pe):k.set(Fe,[Pe]),Ce){const Le=Ce.id.toString();k.has(Le)?k.get(Le).push(Ce):k.set(Le,[Ce])}}if(ve){const Se=b.evaluate(se,{},a).join(","),Pe=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ds.vertical)>=0;for(const Ce of ve.sections)if(Ce.image){const Fe=Ce.image.getPrimary().scaleSelf(this.pixelRatio),Le=Fe.id.toString(),Ne=k.get(Le)||[];Ne.push(Fe),k.set(Le,Ne)}else{const Fe=Ff(ve.toString()),Le=Ce.fontStack||Se,Ne=U[Le]=U[Le]||{};this.calculateGlyphDependencies(Ce.text,Ne,Pe,this.allowVerticalPlacement,Fe)}}}if(f.get("symbol-placement")==="line"&&(this.features=function($){const Z={},K={},ae=[];let ie=0;function se(Me){ae.push($[Me]),ie++}function ve(Me,Se,Pe){const Ce=K[Me];return delete K[Me],K[Se]=Ce,ae[Ce].geometry[0].pop(),ae[Ce].geometry[0]=ae[Ce].geometry[0].concat(Pe[0]),Ce}function le(Me,Se,Pe){const Ce=Z[Se];return delete Z[Se],Z[Me]=Ce,ae[Ce].geometry[0].shift(),ae[Ce].geometry[0]=Pe[0].concat(ae[Ce].geometry[0]),Ce}function xe(Me,Se,Pe){const Ce=Pe?Se[0][Se[0].length-1]:Se[0][0];return`${Me}:${Ce.x}:${Ce.y}`}for(let Me=0;Me<$.length;Me++){const Se=$[Me],Pe=Se.geometry,Ce=Se.text?Se.text.toString():null;if(!Ce){se(Me);continue}const Fe=xe(Ce,Pe),Le=xe(Ce,Pe,!0);if(Fe in K&&Le in Z&&K[Fe]!==Z[Le]){const Ne=le(Fe,Le,Pe),ot=ve(Fe,Le,ae[Ne].geometry);delete Z[Fe],delete K[Le],K[xe(Ce,ae[ot].geometry,!0)]=ot,ae[Ne].geometry=null}else Fe in K?ve(Fe,Le,Pe):Le in Z?le(Fe,Le,Pe):(se(Me),Z[Fe]=ie-1,K[Le]=ie-1)}return ae.filter(Me=>Me.geometry)}(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",n.elevationFeatures){!this.elevationFeatures&&n.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const $ of n.elevationFeatures)this.elevationFeatureIdToIndex.set($.id,this.elevationFeatures.length),this.elevationFeatures.push($)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(($,Z)=>$.sortKey-Z.sortKey)}update(e,n,a,u,c,f,y){this.text.programConfigurations.updatePaintArrays(e,n,c,a,u,f,y),this.icon.programConfigurations.updatePaintArrays(e,n,c,a,u,f,y)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);if(a.elevationFeatureIndex===65535)continue;const u=this.elevationFeatures[a.elevationFeatureIndex];if(u){const c=.05+u.pointElevation(new Ae(a.tileAnchorX,a.tileAnchorY));a.zOffset!==c&&(e=!0,a.zOffset=c)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(c,f,y)=>{a+=f,a>c.length&&c.resize(a);for(let b=-f;b<0;b++)c.emplace(b+a,y)},n=(c,f,y)=>{u+=f,u>c.length&&c.resize(u);for(let b=-f;b<0;b++)c.emplace(b+u,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,u=0;for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:S}=f,_=f.zOffset,w=S>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,_),e(this.text.zOffsetVertexArray,b,_)),w){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:T}=f;M>=0&&n(this.icon.zOffsetVertexArray,S,_),T>=0&&n(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=m2(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:c}of n)this.lineVertexArray.emplaceBack(u,c);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,n,a,u,c,f,y,b,S,_,w,M,T,E,C,O){const k=e.indexArray,U=e.layoutVertexArray,V=e.globeExtVertexArray,N=e.segments.prepareSegment(4*n.length,U,k,this.canOverlap?f.sortKey:void 0),$=this.glyphOffsetArray.length,Z=N.vertexLength,K=this.allowVerticalPlacement&&y===Ds.vertical?Math.PI/2:0,ae=f.text&&f.text.sections;for(let se=0;se<n.length;se++){const{tl:ve,tr:le,bl:xe,br:Me,texPrimary:Se,texSecondary:Pe,pixelOffsetTL:Ce,pixelOffsetBR:Fe,minFontScaleX:Le,minFontScaleY:Ne,glyphOffset:ot,isSDF:it,sectionIndex:Bt}=n[se],_t=N.vertexLength,At=ot[1];if(hg(U,S.x,S.y,ve.x,At+ve.y,Se.x,Se.y,a,it,Ce.x,Ce.y,Le,Ne),hg(U,S.x,S.y,le.x,At+le.y,Se.x+Se.w,Se.y,a,it,Fe.x,Ce.y,Le,Ne),hg(U,S.x,S.y,xe.x,At+xe.y,Se.x,Se.y+Se.h,a,it,Ce.x,Fe.y,Le,Ne),hg(U,S.x,S.y,Me.x,At+Me.y,Se.x+Se.w,Se.y+Se.h,a,it,Fe.x,Fe.y,Le,Ne),b){const{x:ct,y:rr,z:Ot}=b.anchor,[qt,dr,Ir]=b.up;fg(V,ct,rr,Ot,qt,dr,Ir),fg(V,ct,rr,Ot,qt,dr,Ir),fg(V,ct,rr,Ot,qt,dr,Ir),fg(V,ct,rr,Ot,qt,dr,Ir),pg(e.dynamicLayoutVertexArray,ct,rr,Ot,K)}else pg(e.dynamicLayoutVertexArray,S.x,S.y,S.z,K);if(O){const ct=Pe||Se;dg(e.iconTransitioningVertexArray,ct.x,ct.y),dg(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y),dg(e.iconTransitioningVertexArray,ct.x,ct.y+ct.h),dg(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y+ct.h)}k.emplaceBack(_t,_t+1,_t+2),k.emplaceBack(_t+1,_t+2,_t+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),se!==n.length-1&&Bt===n[se+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,f,f.index,{},T,E,C,ae&&ae[Bt])}const ie=b?b.anchor:S;e.placedSymbolArray.emplaceBack(ie.x,ie.y,ie.z,S.x,S.y,$,this.glyphOffsetArray.length-$,Z,_,w,S.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],y,0,!1,0,M,0)}_commitLayoutVertex(e,n,a,u,c,f,y){e.emplaceBack(n,a,u,c,f,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,n,a,u,c,f,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),S=b.vertexLength,_=y.tileAnchorX,w=y.tileAnchorY;for(let T=0;T<4;T++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,n,e.padding,y.zOffset),this._commitLayoutVertex(a.layoutVertexArray,u,c,f,_,w,new Ae(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,c,f,_,w,new Ae(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,c,f,_,w,new Ae(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,c,f,_,w,new Ae(e.x1,e.y2)),b.vertexLength+=4;const M=a.indexArray;M.emplaceBack(S,S+1),M.emplaceBack(S+1,S+2),M.emplaceBack(S+2,S+3),M.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,a,u,c,f){for(let y=u;y<c;y++){const b=a.get(y),S=this.getSymbolInstanceTextSize(e,f,n,y);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,n,a,u,c,f){for(let y=u;y<c;y++){const b=a.get(y),S=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,n,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Mv(Uh,Dw.members,Aa),this.iconCollisionBox=new Mv(Uh,Dw.members,Aa);const u=td(this.iconSizeData,e),c=td(this.textSizeData,e,a);for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(c,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(c,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,n,a,u){const c=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),f=tg(this.textSizeData,e,c)/Fi;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,n,a){const u=this.icon.placedSymbolArray.get(a),c=tg(this.iconSizeData,e,u);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,n,a,u){e.emplaceBack(n,-a,-a,u),e.emplaceBack(n,a,-a,u),e.emplaceBack(n,a,a,u),e.emplaceBack(n,-a,a,u)}_updateTextDebugCollisionBoxes(e,n,a,u,c,f,y){for(let b=u;b<c;b++){const S=a.get(b),_=this.getSymbolInstanceTextSize(e,f,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,S.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,n,a,u,c,f,y){for(let b=u;b<c;b++){const S=a.get(b),_=this.getSymbolInstanceIconSize(e,n,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,S.padding,f.zOffset)}}updateCollisionDebugBuffers(e,n,a,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=td(this.iconSizeData,e,u),f=td(this.textSizeData,e,a);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(f,e,n,b.textBoxStartIndex,b.textBoxEndIndex,b,a),this._updateTextDebugCollisionBoxes(f,e,n,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,a),this._updateIconDebugCollisionBoxes(c,e,n,b.iconBoxStartIndex,b.iconBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(c,e,n,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,a,u,c,f,y,b,S){const _={};if(n<a){const{x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(n);_.textBox={x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.textFeatureIndex=$}if(u<c){const{x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(u);_.verticalTextBox={x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.verticalTextFeatureIndex=$}if(f<y){const{x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(f);_.iconBox={x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.iconFeatureIndex=$}if(b<S){const{x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(b);_.verticalIconBox={x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.verticalIconFeatureIndex=$}return _}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const a=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){const a=e.placedSymbolArray.get(n),u=a.vertexStartIndex+4*a.numGlyphs;for(let c=a.vertexStartIndex;c<u;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),a=Math.cos(e),u=[],c=[],f=[];for(let y=0;y<this.symbolInstances.length;++y){f.push(y);const b=this.symbolInstances.get(y);u.push(0|Math.round(n*b.tileAnchorX+a*b.tileAnchorY)),c.push(b.featureIndex)}return f.sort((y,b)=>u[y]-u[b]||c[b]-c[y]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===n?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const a=this.symbolInstances.get(n);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:S}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),c>=0&&c!==u&&this.addIndicesForPlacedSymbol(this.text,c),f>=0&&f!==c&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let _2,g2,Iv;Ft(mg,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),mg.addDynamicAttributes=pg;class y2{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Sl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ft(y2,"FormatSectionOverride",{omit:["defaultValue"]});const Cv=()=>Iv||(Iv={layout:_2||(_2=new $n({"symbol-placement":new Tt(Ue.layout_symbol["symbol-placement"]),"symbol-spacing":new Tt(Ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Tt(Ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(Ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Tt(Ue.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Tt(Ue.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Tt(Ue.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Tt(Ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Tt(Ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new Tt(Ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Tt(Ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(Ue.layout_symbol["icon-size"]),"icon-size-scale-range":new Tt(Ue.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new kt(Ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kt(Ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(Ue.layout_symbol["icon-image"]),"icon-rotate":new kt(Ue.layout_symbol["icon-rotate"]),"icon-padding":new Tt(Ue.layout_symbol["icon-padding"]),"icon-keep-upright":new Tt(Ue.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(Ue.layout_symbol["icon-offset"]),"icon-anchor":new kt(Ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Tt(Ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Tt(Ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Tt(Ue.layout_symbol["text-rotation-alignment"]),"text-field":new kt(Ue.layout_symbol["text-field"]),"text-font":new kt(Ue.layout_symbol["text-font"]),"text-size":new kt(Ue.layout_symbol["text-size"]),"text-size-scale-range":new Tt(Ue.layout_symbol["text-size-scale-range"]),"text-max-width":new kt(Ue.layout_symbol["text-max-width"]),"text-line-height":new kt(Ue.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(Ue.layout_symbol["text-letter-spacing"]),"text-justify":new kt(Ue.layout_symbol["text-justify"]),"text-radial-offset":new kt(Ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Tt(Ue.layout_symbol["text-variable-anchor"]),"text-anchor":new kt(Ue.layout_symbol["text-anchor"]),"text-max-angle":new Tt(Ue.layout_symbol["text-max-angle"]),"text-writing-mode":new Tt(Ue.layout_symbol["text-writing-mode"]),"text-rotate":new kt(Ue.layout_symbol["text-rotate"]),"text-padding":new Tt(Ue.layout_symbol["text-padding"]),"text-keep-upright":new Tt(Ue.layout_symbol["text-keep-upright"]),"text-transform":new kt(Ue.layout_symbol["text-transform"]),"text-offset":new kt(Ue.layout_symbol["text-offset"]),"text-allow-overlap":new Tt(Ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Tt(Ue.layout_symbol["text-ignore-placement"]),"text-optional":new Tt(Ue.layout_symbol["text-optional"]),visibility:new Tt(Ue.layout_symbol.visibility)})),paint:g2||(g2=new $n({"icon-opacity":new kt(Ue.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new kt(Ue.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new kt(Ue.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new kt(Ue.paint_symbol["text-emissive-strength"]),"icon-color":new kt(Ue.paint_symbol["icon-color"]),"icon-halo-color":new kt(Ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(Ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(Ue.paint_symbol["icon-halo-blur"]),"icon-translate":new Tt(Ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new Tt(Ue.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new kt(Ue.paint_symbol["icon-image-cross-fade"]),"text-opacity":new kt(Ue.paint_symbol["text-opacity"]),"text-occlusion-opacity":new kt(Ue.paint_symbol["text-occlusion-opacity"]),"text-color":new kt(Ue.paint_symbol["text-color"],{runtimeType:ss,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new kt(Ue.paint_symbol["text-halo-color"]),"text-halo-width":new kt(Ue.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(Ue.paint_symbol["text-halo-blur"]),"text-translate":new Tt(Ue.paint_symbol["text-translate"]),"text-translate-anchor":new Tt(Ue.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Tt(Ue.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Tt(Ue.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Tt(Ue.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Tt(Ue.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new kt(Ue.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},Iv);class _g extends Qi{constructor(e,n,a,u){super(e,Cv(),n,a,u),this._colorAdjustmentMatrix=te.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const c of a)u.indexOf(c)<0&&u.push(c);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,n,a,u){return this._saturation===e&&this._contrast===n&&this._brightnessMin===a&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(c,f,y,b){c=Xe(c),f=Lc(f);const S=te.mat4.create(),_=c/3,w=1-2*_,M=[w,_,_,0,_,w,_,0,_,_,w,0,0,0,0,1],T=.5-.5*f,E=b-y;return te.mat4.multiply(S,[E,0,0,0,0,E,0,0,0,0,E,0,y,y,y,1],[f,0,0,0,0,f,0,0,0,0,f,0,T,T,T,1]),te.mat4.multiply(S,S,M),S}(e,n,a,u),this._saturation=e,this._contrast=n,this._brightnessMin=a,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,n,a,u){const c=this.layout.get(e).evaluate(n,{},a,u),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||zf(f.value)||!c?c:function(y,b){return b.replace(/{([^{}]+)}/g,(S,_)=>_ in y?String(y[_]):"")}(n.properties,c)}createBucket(e){return new mg(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Cv().paint.overridableProperties){if(!_g.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),a=new y2(n),u=new Th(a,n.property.specification,this.scope,this.options);let c=null;c=n.value.kind==="constant"||n.value.kind==="source"?new Sh("source",u):new kl("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Vl(n.property,c,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven())&&_g.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const a=e.get("text-field"),u=Cv().paint.properties[n];let c=!1;const f=y=>{for(const b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(c=!0)};if(a.value.kind==="constant"&&a.value.value instanceof $i)f(a.value.value.sections);else if(a.value.kind==="source"){const y=S=>{c||(S instanceof io&&Fn(S.value)===jo?f(S.value.sections):S instanceof $o?f(S.sections):S.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return c}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,n,a){return{config:new cl(this,{zoom:n,lut:a}),overrideFog:!1}}}let v2,x2,b2,w2;var Pv=Jr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Rv(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Dv(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class zv{constructor(e,n,a,u){this.context=e,this.format=a,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(n,{premultiply:u&&u.premultiply})}update(e,n){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:c}=this,{gl:f}=c,{x:y,y:b}=n&&n.position?n.position:{x:0,y:0},S=y+a,_=b+u;!this.size||this.size[0]===S&&this.size[1]===_||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!n||n.premultiply!==!1));const w=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&S>0&&_>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(S,_)))+1:1;f.texStorage2D(f.TEXTURE_2D,M,this.format,S,_),this.size=[S,_]}if(this.size)if(w)f.texSubImage2D(f.TEXTURE_2D,0,y,b,Rv(this.format),Dv(this.format),e);else{const M=e.data;M&&f.texSubImage2D(f.TEXTURE_2D,0,y,b,a,u,Rv(this.format),Dv(this.format),M)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,n,a=!1){const{context:u}=this,{gl:c}=u;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,n),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,a,u){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),this.wrapS=a),u!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class gg{constructor(e,n){this.context=e,this.texture=n}bind(e,n){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}}function yg(o,e,n,a,u,c,f,y){const b=[o,e,1,n,a,1,u,c,1],S=[f,y,1],_=te.mat3.adjoint([],b),[w,M,T]=te.vec3.transformMat3(S,S,_);return te.mat3.multiply(b,b,[w,0,0,0,M,0,0,0,T])}function T2(o,e,n,a,u,c,f,y){const b=function(S,_,w,M,T,E,C,O){const k=yg(0,0,1,0,1,1,0,1),U=yg(S,_,w,M,T,E,C,O),V=te.mat3.adjoint([],k);return te.mat3.multiply(U,U,V)}(o,e,n,a,u,c,f,y);return[b[2]/b[8]/Ct,b[5]/b[8]/Ct]}function vg(o){return[o[0],Math.min(Math.max(o[1],-85.051129),es)]}class S2 extends ga{constructor(e,n,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Eo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=tf(this.map._requestManager.transformRequest(this.url,mi.Image),(a,u)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Ku(a)):u&&(this.image=u instanceof HTMLImageElement?We.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new gg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Eo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof gg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],a=e[0][1];for(const c of e)c[1]>a&&(a=c[1]),c[1]<n&&(n=c[1]);const u=(a+n)/2;if(u>es?this.onNorthPole=!0:u<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=e.map(s.fromLngLat);this.tileID=function(f){let y=1/0,b=1/0,S=-1/0,_=-1/0;for(const C of f)y=Math.min(y,C.x),b=Math.min(b,C.y),S=Math.max(S,C.x),_=Math.max(_,C.y);const w=Math.max(S-y,_-b),M=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),T=Math.pow(2,M);let E=Math.floor((y+S)/2*T);return E>1&&(E-=1),new $e(M,E,Math.floor((b+_)/2*T))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Eo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const k in this.tiles){const U=this.tiles[k];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const n=zp(new $e(0,0,0),this.map.transform.projection),a=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(k){const U=k[1].x-k[0].x,V=k[1].y-k[0].y,N=k[2].x-k[1].x,$=k[2].y-k[1].y,Z=k[3].x-k[2].x,K=k[3].y-k[2].y,ae=k[0].x-k[3].x,ie=k[0].y-k[3].y,se=U*$-N*V,ve=N*K-Z*$,le=Z*ie-ae*K,xe=ae*V-U*ie;return se>0&&ve>0&&le>0&&xe>0||se<0&&ve<0&&le<0&&xe<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=zp(this.tileID,this.map.transform.projection),[c,f,y,b]=this.coordinates.map(k=>{const U=u.projection.project(k[0],k[1]);return u2(u,U)._round()});this.perspectiveTransform=T2(c.x,c.y,f.x,f.y,y.x,y.y,b.x,b.y);const S=this._boundsArray=new ol;S.emplaceBack(c.x,c.y,0,0),S.emplaceBack(f.x,f.y,Ct,0),S.emplaceBack(b.x,b.y,0,Ct),S.emplaceBack(y.x,y.y,Ct,Ct),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,Pv.members),this.boundsSegments=Gn.simpleSegment(0,0,4,2);const _=[],w=[vg((M=this.coordinates)[0]),vg(M[1]),vg(M[2]),vg(M[3])];var M;const[T,E,C,O]=function(k){let U=k[0][0],V=U,N=k[0][1],$=N;for(let Z=1;Z<k.length;Z++)k[Z][0]<U?U=k[Z][0]:k[Z][0]>V&&(V=k[Z][0]),k[Z][1]<N?N=k[Z][1]:k[Z][1]>$&&($=k[Z][1]);return[U,N,V-U,$-N]}(w);{const k=new ol,[U,V,N,$]=function(Ce){let Fe=Ce[0].x,Le=Fe,Ne=Ce[0].y,ot=Ne;for(let it=1;it<Ce.length;it++)Ce[it].x<Fe?Fe=Ce[it].x:Ce[it].x>Le&&(Le=Ce[it].x),Ce[it].y<Ne?Ne=Ce[it].y:Ce[it].y>ot&&(ot=Ce[it].y);return[Fe,Ne,Le-Fe,ot-Ne]}(a),Z=Ce=>[(Ce.x-U)/N,(Ce.y-V)/$],[K,ae,ie,se]=a.map(Z),ve=function(Ce,Fe,Le,Ne,ot,it,Bt,_t){const At=yg(0,0,1,0,1,1,0,1),ct=yg(Ce,Fe,Le,Ne,ot,it,Bt,_t),rr=te.mat3.adjoint([],ct);return te.mat3.multiply(At,At,rr)}(K[0],K[1],ae[0],ae[1],ie[0],ie[1],se[0],se[1]);this.elevatedGlobePerspectiveTransform=T2(K[0],K[1],ae[0],ae[1],ie[0],ie[1],se[0],se[1]);const le=(Ce,Fe)=>{_.push(Ce.lng);const Le=Math.round((Ce.lng-T)/C*Ct),Ne=Math.round((Ce.lat-E)/O*Ct),ot=Z(Fe),it=te.vec3.transformMat3([],[ot[0],ot[1],1],ve),Bt=Math.round(it[0]/it[2]*Ct),_t=Math.round(it[1]/it[2]*Ct);k.emplaceBack(Le,Ne,Bt,_t)},xe=a[3].x-a[0].x,Me=a[3].y-a[0].y,Se=a[2].x-a[1].x,Pe=a[2].y-a[1].y;for(let Ce=0;Ce<65;Ce++){const Fe=Ce/64,Le=[a[0].x+Fe*xe,a[0].y+Fe*Me],Ne=[a[1].x+Fe*Se,a[1].y+Fe*Pe],ot=Ne[0]-Le[0],it=Ne[1]-Le[1];for(let Bt=0;Bt<65;Bt++){const _t=Bt/64,At={x:Le[0]+ot*_t,y:Le[1]+it*_t};le(n.projection.unproject(At.x,At.y),At)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(k,Pv.members)}{this.maxLongitudeTriangleSize=0;let k=[],U=new wi;const V=(N,$,Z)=>{U.emplaceBack(N,$,Z);const K=_[N],ae=_[$],ie=_[Z],se=Math.min(Math.min(K,ae),ie),ve=Math.max(Math.max(K,ae),ie)-se;ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ve),k.push(se+ve/2)};for(let N=0;N<64;N++)for(let $=0;$<64;$++){const Z=65*N+$,K=Z+1,ae=Z+65,ie=ae+1;V(Z,ae,K),V(K,ae,ie)}[k,U]=function(N,$){const Z=Array.from({length:N.length},(ie,se)=>se);Z.sort((ie,se)=>N[ie]-N[se]);const K=[],ae=new wi;for(let ie=0;ie<Z.length;ie++){const se=Z[ie];K.push(N[se]);const ve=3*se,le=ve+1;ae.emplaceBack($.uint16[ve],$.uint16[le],$.uint16[le+1])}return[K,ae]}(k,U),this.elevatedGlobeTrianglesCenterLongitudes=k,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(U)}this.elevatedGlobeSegments=Gn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,C/Ct,0,O/Ct,0,0,E,T,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const n=this.map.painter.context,a=n.gl;!this._dirty||this.texture instanceof gg||(this.texture?this.texture.update(this.image):(this.texture=new zv(n,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let u=(c=e+180)+360*Math.round((a[0]-c)/360);var c;const f=new Gn,y=(w,M)=>{f.segments.push({vertexOffset:0,primitiveOffset:w,vertexLength:n.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-u)<=b){const w=Xu(a,0,a.length,u+b);return w===a.length||y(w,Zu(a,w+1,a.length,u+360-b)-w),f}u<a[0]&&(u+=360);const S=Zu(a,0,a.length,u-b);if(S===a.length)return y(0,a.length),f;y(0,S-0);const _=Xu(a,S+1,a.length,u+b);return _!==a.length&&y(_,a.length-_),f}}const MR=(Math.pow(256,2)-1)/16907520;class E2 extends Qi{constructor(e,n,a,u){super(e,{layout:b2||(b2=new $n({visibility:new Tt(Ue.layout_raster.visibility)})),paint:w2||(w2=new $n({"raster-opacity":new Tt(Ue.paint_raster["raster-opacity"]),"raster-color":new il(Ue.paint_raster["raster-color"]),"raster-color-mix":new Tt(Ue.paint_raster["raster-color-mix"]),"raster-color-range":new Tt(Ue.paint_raster["raster-color-range"]),"raster-hue-rotate":new Tt(Ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Tt(Ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Tt(Ue.paint_raster["raster-brightness-max"]),"raster-saturation":new Tt(Ue.paint_raster["raster-saturation"]),"raster-contrast":new Tt(Ue.paint_raster["raster-contrast"]),"raster-resampling":new Tt(Ue.paint_raster["raster-resampling"]),"raster-fade-duration":new Tt(Ue.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Tt(Ue.paint_raster["raster-emissive-strength"]),"raster-array-band":new Tt(Ue.paint_raster["raster-array-band"]),"raster-elevation":new Tt(Ue.paint_raster["raster-elevation"]),"raster-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},n,a,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof S2&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const n=this._transitionablePaint._values["raster-color"].value.expression,[a,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(u)||a===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=vp({expression:n,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,u])}}let A2,M2,I2,C2,P2;class R2 extends Qi{constructor(e,n,a,u){super(e,{layout:A2||(A2=new $n({visibility:new Tt(Ue["layout_raster-particle"].visibility)})),paint:M2||(M2=new $n({"raster-particle-array-band":new Tt(Ue["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Tt(Ue["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new il(Ue["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Tt(Ue["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Tt(Ue["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Tt(Ue["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Tt(Ue["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Tt(Ue["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},n,a,u),this._updateColorRamp(),this.lastInvalidatedAt=We.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,n=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=vp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:n}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=We.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class IR extends Qi{constructor(e,n){super(e,{},n,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Lv(o,e,n){const a=[0,0,1],u=te.quat.identity([]);return te.quat.rotateY(u,u,n?-Dt(o)+Math.PI:Dt(o)),te.quat.rotateX(u,u,-Dt(e)),te.vec3.transformQuat(a,a,u),te.vec3.normalize(a,a)}function D2(o,e){const n=xg(o.projection,o.zoom,o.width,o.height),a=function(c,f,y,b,S){const _=new Qr(y.lng-180*tc,y.lat),w=new Qr(y.lng+180*tc,y.lat),M=c.project(_.lng,_.lat),T=c.project(w.lng,w.lat),E=-Math.atan2(T.y-M.y,T.x-M.x),C=s.fromLngLat(y);C.y=Ye(C.y,-1+tc,1-tc);const O=C.toLngLat(),k=c.project(O.lng,O.lat),U=s.fromLngLat(O);U.x+=tc;const V=U.toLngLat(),N=c.project(V.lng,V.lat),$=L2(N.x-k.x,N.y-k.y,E),Z=s.fromLngLat(O);Z.y+=tc;const K=Z.toLngLat(),ae=c.project(K.lng,K.lat),ie=L2(ae.x-k.x,ae.y-k.y,E),se=Math.abs($.x)/Math.abs(ie.y),ve=te.mat4.identity([]);te.mat4.rotateZ(ve,ve,-E*(1-(S?0:b)));const le=te.mat4.identity([]);return te.mat4.scale(le,le,[1,1-(1-se)*b,1]),le[4]=-ie.x/ie.y*b,te.mat4.rotateZ(le,le,E),te.mat4.multiply(le,ve,le),le}(o.projection,0,o.center,n,e),u=z2(o);return te.mat4.scale(a,a,[u,u,1]),a}function z2(o){const e=o.projection,n=xg(o.projection,o.zoom,o.width,o.height),a=Ov(e,o.center),u=Ov(e,Qr.convert(e.center));return Math.pow(2,a*n+(1-n)*u)}function xg(o,e,n,a,u=1/0){const c=o.range;if(!c)return 0;const f=Math.min(u,Math.max(n,a)),y=Math.log(f/1024)/Math.LN2;return Qt(c[0]+y,c[1]+y,e)}const tc=1/4e4;function Ov(o,e){const n=Ye(e.lat,-85.051129,es),a=new Qr(e.lng-180*tc,n),u=new Qr(e.lng+180*tc,n),c=o.project(a.lng,n),f=o.project(u.lng,n),y=s.fromLngLat(a),b=s.fromLngLat(u),S=f.x-c.x,_=f.y-c.y,w=b.x-y.x,M=b.y-y.y,T=Math.sqrt((w*w+M*M)/(S*S+_*_));return Math.log(T)/Math.LN2}function L2(o,e,n){const a=Math.cos(n),u=Math.sin(n);return{x:o*a-e*u,y:o*u+e*a}}function O2(o,e,n){te.mat4.identity(o),te.mat4.rotateZ(o,o,Dt(e[2])),te.mat4.rotateX(o,o,Dt(e[0])),te.mat4.rotateY(o,o,Dt(e[1])),te.mat4.scale(o,o,n),te.mat4.multiply(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function bg(o,e,n,a,u,c,f,y){const b=[n[0]-e[0],n[1]-e[1],0],S=[a[0]-e[0],a[1]-e[1],0];if(te.vec3.length(b)<1e-12||te.vec3.length(S)<1e-12)return te.quat.identity(o);const _=te.vec3.cross([],b,S);te.vec3.normalize(_,_),te.vec3.subtract(S,a,e),b[2]=(c-u)*y,S[2]=(f-u)*y;const w=b;return te.vec3.cross(w,b,S),te.vec3.normalize(w,w),te.quat.rotationTo(o,_,w)}function kv(o,e,n=!1){const a=Oi(e.zoom),u=function(c,f,y){const b=f.worldSize,S=[c[12],c[13],c[14]],_=Ci(S[1]/b),w=ds(S[0]/b),M=te.mat4.identity([]),T=Xi(1,_)*b,E=Xi(1,0)*b*Xl(_,f.zoom),C=1/rs(b);let O=E*C;if(y){const N=xg(f.projection,f.zoom,f.width,f.height,1024);O=C*f.projection.pixelSpaceConversion(f.center.lat,b,N)}const k=Ra(_,w);te.vec3.add(k,k,te.vec3.scale([],te.vec3.normalize([],k),T*O*S[2]));const U=function(N){const $=[N[0],N[1],N[2]];let Z=[0,1,0];const K=te.vec3.cross([],Z,$);return te.vec3.cross(Z,$,K),te.vec3.squaredLength(Z)===0&&(Z=[0,1,0],te.vec3.cross(K,$,Z)),te.vec3.normalize(K,K),te.vec3.normalize(Z,Z),te.vec3.normalize($,$),[K[0],K[1],K[2],0,Z[0],Z[1],Z[2],0,$[0],$[1],$[2],0,N[0],N[1],N[2],1]}(k);te.mat4.scale(M,M,[O,O,O*T]),te.mat4.translate(M,M,[-S[0],-S[1],-S[2]]);const V=te.mat4.multiply([],f.globeMatrix,U);return te.mat4.multiply(V,V,M),te.mat4.multiply(V,V,c),V}(o,e,n);if(a>0){const c=function(f,y){const b=y.worldSize,S=Xi(1,0)*b*Xl(y.center.lat,y.zoom)/rs(b),_=Xi(1,y.center.lat)*b,w=te.mat4.identity([]);return te.mat4.rotateY(w,w,Dt(y.center.lng)),te.mat4.rotateX(w,w,Dt(y.center.lat)),te.mat4.translate(w,w,[0,0,Ii]),te.mat4.scale(w,w,[S,S,S*_]),te.mat4.translate(w,w,[y.point.x-.5*b,y.point.y-.5*b,0]),te.mat4.multiply(w,w,f),te.mat4.multiply(w,y.globeMatrix,w)}(o,e);return function(f,y,b){const S=(E,C,O)=>{const k=te.vec3.length(E),U=te.vec3.length(C),V=Ti(E,C,O);return te.vec3.scale(V,V,1/te.vec3.length(V)*ar(k,U,O))},_=S([f[0],f[1],f[2]],[y[0],y[1],y[2]],b),w=S([f[4],f[5],f[6]],[y[4],y[5],y[6]],b),M=S([f[8],f[9],f[10]],[y[8],y[9],y[10]],b),T=Ti([f[12],f[13],f[14]],[y[12],y[13],y[14]],b);return[_[0],_[1],_[2],0,w[0],w[1],w[2],0,M[0],M[1],M[2],0,T[0],T[1],T[2],1]}(u,c,a)}return u}function k2(o,e,n,a){const u=or.projectAabbCorners(a,n);let c=Number.MAX_VALUE,f=-1;for(let S=0;S<u.length;++S){const _=u[S];_[0]=(.5*_[0]+.5)*e.width,_[1]=(.5-.5*_[1])*e.height,_[2]<c&&(f=S,c=_[2])}const y=S=>new Ae(u[S][0],u[S][1]);let b;switch(f){case 0:case 6:b=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:b=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:b=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:b=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(q(o,b))return c}const CR=Jr([{name:"a_pos_3f",components:3,type:"Float32"}]),PR=Jr([{name:"a_color_3f",components:3,type:"Float32"}]),RR=Jr([{name:"a_color_4f",components:4,type:"Float32"}]),DR=Jr([{name:"a_uv_2f",components:2,type:"Float32"}]),zR=Jr([{name:"a_normal_3f",components:3,type:"Float32"}]),LR=Jr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),OR=Jr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),F2={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class wg{constructor(e,n,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),n!=null&&n.__line__&&(this.line=n.__line__)}}function B2(o,e){const n=o.indexOf("://")===-1;try{return new URL(o,n&&e?"http://example.com":void 0),!0}catch{return!1}}class N2{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class V2{constructor(){this.instancedDataArray=new sp,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Fv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,n){}populate(e,n,a,u){this.tileToMeter=t(a);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:y,index:b,sourceLayerIndex:S}of e){const _=y??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),w=F(f,c);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),w,a))continue;const M={id:_,sourceLayerIndex:S,index:b,geometry:c?w.geometry:L(f,a,u),properties:f.properties,type:f.type,patterns:{}},T=this.addFeature(M,M.geometry,w);T&&n.featureIndex.insert(f,M.geometry,b,S,this.index,this.instancesPerModel[T].instancedDataArray.length,Ct/32)}this.lookup=null}update(e,n,a,u){for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];for(const y in e)f.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(f.features[f.idToFeaturesIndex[y]],e[y],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];for(const u of a.features){const c=this.layers[0],f=u.feature,y=this.canonical,b=c.paint.get("model-rotation").evaluate(f,{},y),S=c.paint.get("model-scale").evaluate(f,{},y),_=c.paint.get("model-translation").evaluate(f,{},y);te.vec3.exactEquals(u.rotation,b)&&te.vec3.exactEquals(u.scale,S)&&te.vec3.exactEquals(u.translation,_)||(this.evaluate(u,u.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,n,a,u){if(n.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=n.updateTime;const c=n.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(lv(this.activeReplacements,c))return!1;this.activeReplacements=c;let f=!1;for(const y in this.instancesPerModel){const b=this.instancesPerModel[y],S=b.instancedDataArray;for(const _ of b.features){const w=_.instancedDataOffset,M=_.instancedDataCount;for(let T=0;T<M;T++){const E=16*(T+w);let C=S.float32[E+0];const O=C>Ct;C=O?C-Ct:C;const k=Math.floor(C),U=S.float32[E+1];let V=!1;for(const N of this.activeReplacements)if(!Kb(N,a,F2.Model,u)&&!(N.min.x>k||k>N.max.x||N.min.y>U||U>N.max.y)&&(V=rw(tw(k,U,e.canonical,N.footprintTileId.canonical),N.footprint),V))break;S.float32[E]=V?C+Ct:C,f=f||V!==O}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,LR.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const n in this.instancesPerModel){const a=this.instancesPerModel[n];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const n of this.modelUris)e.removeModel(n,"")}addFeature(e,n,a){const u=this.layers[0],c=u.layout.get("model-id").evaluate(a,{},this.canonical);if(!c)return Rr(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),c;B2(c,!1)&&(this.modelUris.includes(c)||this.modelUris.push(c)),this.instancesPerModel[c]||(this.instancesPerModel[c]=new V2);const f=this.instancesPerModel[c],y=f.instancedDataArray,b=new N2(a,y.length);for(const S of n)for(const _ of S){if(_.x<0||_.x>=Ct||_.y<0||_.y>=Ct)continue;const w=(this.lookupDim-1)/Ct,M=this.lookupDim*(_.y*w|0)+_.x*w|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const T=y.length;y.resize(T+1),f.instancesEvaluatedElevation.push(0),y.float32[16*T]=_.x,y.float32[16*T+1]=_.y}return b.instancedDataCount=f.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(b),this.evaluate(b,{},f,!1)),c}getModelUris(){return this.modelUris}evaluate(e,n,a,u){const c=this.layers[0],f=e.feature,y=this.canonical,b=e.rotation=c.paint.get("model-rotation").evaluate(f,n,y),S=e.scale=c.paint.get("model-scale").evaluate(f,n,y),_=e.translation=c.paint.get("model-translation").evaluate(f,n,y),w=c.paint.get("model-color").evaluate(f,n,y);w.a=c.paint.get("model-color-mix-intensity").evaluate(f,n,y);const M=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),O2(M,b,S);const T=Math.round(100*w.a)+w.b/1.05;for(let E=0;E<e.instancedDataCount;++E){const C=e.instancedDataOffset+E,O=16*C,k=a.instancedDataArray.float32;let U=0;u&&(U=k[O+6]-a.instancesEvaluatedElevation[C]);const V=0|k[O+1];k[O]=(0|k[O])+w.r/1.05,k[O+1]=V+w.g/1.05,k[O+2]=T,k[O+3]=1/(y.z>10?this.tileToMeter:t(y,V)),k[O+4]=_[0],k[O+5]=_[1],k[O+6]=_[2]+U,k[O+7]=M[0],k[O+8]=M[1],k[O+9]=M[2],k[O+10]=M[4],k[O+11]=M[5],k[O+12]=M[6],k[O+13]=M[8],k[O+14]=M[9],k[O+15]=M[10],a.instancesEvaluatedElevation[C]=_[2]}}}let U2,j2;Ft(Fv,"ModelBucket",{omit:["layers"]}),Ft(V2,"PerModelAttributes"),Ft(N2,"ModelFeature");const _u=64,ad={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function $2(o,e,n,a,u,c,f,y,b,S=!1){const _=n.zoom,w=n.project(a),M=Xl(a.lat,_),T=1/M;te.mat4.identity(o),te.mat4.translate(o,o,[w.x+f[0]*T,w.y+f[1]*T,f[2]]);let E=1,C=1;const O=n.worldSize;if(S){if(n.projection.name==="mercator"){let N=0;n.elevation&&(N=n.elevation.getAtPointOrZero(new s(w.x/O,w.y/O),0));const $=te.vec4.transformMat4([],[w.x,w.y,N,1],n.projMatrix)[3]/n.cameraToCenterDistance;E=$,C=$*Xl(n.center.lat,_)}else if(n.projection.name==="globe"){const N=kv(o,n),$=te.mat4.multiply([],n.projMatrix,N),Z=[0,0,0,1];te.vec4.transformMat4(Z,Z,$);const K=Z[3]/n.cameraToCenterDistance,ae=Oi(_),ie=n.projection.pixelsPerMeter(a.lat,O)*Xl(a.lat,_),se=n.projection.pixelsPerMeter(n.center.lat,O)*Xl(n.center.lat,_);E=K/ar(ie,gp(n.center.lat),ae),C=K*M/ie,E*=se,C*=se}}else E=T;te.mat4.scale(o,o,[E,E,C]);const k=[...o],U=e.orientation,V=[];if(O2(V,[U[0]+u[0],U[1]+u[1],U[2]+u[2]],c),te.mat4.multiply(o,k,V),y&&n.elevation){let N=0;const $=[];if(b&&n.elevation){N=function(ae,ie,se,ve,le){const xe=ie.elevation;if(!xe)return 0;const Me=or.projectAabbCorners(se,ve),Se=Xi(1,le.lat)*ie.worldSize,Pe=function(rr,Ot){const qt=[0,0,1],dr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ir of dr){const yr=rr[Ir.corners[0]],Lr=rr[Ir.corners[1]],Er=rr[Ir.corners[2]],Fr=[Lr[0]-yr[0],Lr[1]-yr[1],Ot*(Lr[2]-yr[2])],Yr=te.vec3.cross(Fr,Fr,[Er[0]-yr[0],Er[1]-yr[1],Ot*(Er[2]-yr[2])]);te.vec3.normalize(Yr,Yr),Ir.dotProductWithUp=te.vec3.dot(Yr,qt)}return dr.sort((Ir,yr)=>Ir.dotProductWithUp-yr.dotProductWithUp),dr[0].corners}(Me,Se),Ce=Me[Pe[0]],Fe=Me[Pe[1]],Le=Me[Pe[2]],Ne=Me[Pe[3]],ot=xe.getAtPointOrZero(new s(Ce[0]/ie.worldSize,Ce[1]/ie.worldSize),0),it=xe.getAtPointOrZero(new s(Fe[0]/ie.worldSize,Fe[1]/ie.worldSize),0),Bt=xe.getAtPointOrZero(new s(Le[0]/ie.worldSize,Le[1]/ie.worldSize),0),_t=xe.getAtPointOrZero(new s(Ne[0]/ie.worldSize,Ne[1]/ie.worldSize),0),At=(ot+_t)/2,ct=(it+Bt)/2;return At>ct?it<Bt?bg(ae,Fe,Ne,Ce,it,_t,ot,Se):bg(ae,Le,Ce,Ne,Bt,ot,_t,Se):ot<_t?bg(ae,Ce,Fe,Le,ot,it,Bt,Se):bg(ae,Ne,Le,Fe,_t,Bt,it,Se),Math.max(At,ct)}($,n,e.aabb,o,a);const Z=te.mat4.fromQuat([],$),K=te.mat4.multiply([],Z,V);te.mat4.multiply(o,k,K)}else N=n.elevation.getAtPointOrZero(new s(w.x/O,w.y/O),0);N!==0&&(o[14]+=N)}}function Bp(o,e,n=!1){o.uploaded||(o.gfxTexture=new zv(e,o.image,n?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function kR(o,e,n){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,CR.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,zR.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,DR.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?PR:RR).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,OR.members,!0)),o.segments=Gn.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const a=o.material;a.pbrMetallicRoughness.baseColorTexture&&Bp(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Bp(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Bp(a.normalTexture,e),a.occlusionTexture&&Bp(a.occlusionTexture,e,n),a.emissionTexture&&Bp(a.emissionTexture,e)}function Bv(o,e,n){if(o.meshes)for(const a of o.meshes)kR(a,e,n);if(o.children)for(const a of o.children)Bv(a,e,n)}function Tg(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)Tg(e)}function Nv(o){if(o.meshes)for(const n of o.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const n of o.children)Nv(n)}class ld{constructor(e,n,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=a}static create(e,n,a){const u=a||e.findDEMTileFor(n);if(!u||!u.dem)return;const c=u.dem,f=u.tileID,y=1<<n.canonical.z-f.canonical.z;return new ld(u,c.dim/Ct/y,[(n.canonical.x/y-f.canonical.x)*c.dim,(n.canonical.y/y-f.canonical.y)*c.dim])}tileCoordToPixel(e,n){const a=n*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(a);return new Ae(u,c)}getElevationAt(e,n,a,u){const c=e*this._scale+this._offset[0],f=n*this._scale+this._offset[1],y=Math.floor(c),b=Math.floor(f),S=this._dem;return u=!!u,a?ar(ar(S.get(y,b,u),S.get(y,b+1,u),f-b),ar(S.get(y+1,b,u),S.get(y+1,b+1,u),f-b),c-y):S.get(y,b,u)}getElevationAtPixel(e,n,a){return this._dem.get(e,n,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Xi(1,e)*this._dem.stride}}const Vv=new Float32Array(262144),gu=new Uint8Array(262144);function G2(o){let e=0;if(o.meshes)for(const n of o.meshes)e=Math.max(e,n.aabb.max[2]);if(o.children)for(const n of o.children)e=Math.max(e,G2(n));return e}function H2(o,e,n){if(o.meshes)for(const a of o.meshes){if(a.aabb.min[0]===1/0)continue;const u=or.applyTransform(a.aabb,o.matrix);n.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(o.children)for(const a of o.children)H2(a,e,n)}const q2=["","wall","door","roof","window","lamp","logo"];class W2{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:G2(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const n=new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=or.applyTransformFast(a.aabb,this.node.matrix),n.encapsulate(a.transformedAabb)),e++;this.aabb=n}return this.aabb}}class Sg{constructor(e,n,a,u,c,f,y){this.id=a,this.layers=e,this.layerIds=this.layers.map(b=>b.fqid),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.modelTraits|=ad.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=ad.HasMapboxMeshFeatures),c&&(this.modelTraits|=ad.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const b of n)this.nodesInfo.push(new W2(b)),H2(b,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,n){for(const a of this.getNodesInfo()){const u=a.node;u.footprint&&n.push({footprint:u.footprint,id:e})}}update(e){const n=Object.keys(e).length!==0;if(n&&!this.stateDependentLayers.length)return;const a=n?this.stateDependentLayers:this.layers;if(!wt(e,this.states))for(const u of a)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const n=this.getNodesInfo();for(const a of n){const u=a.node;this.uploaded?this.updatePbrBuffer(u):Bv(u,e,!0)}for(const a of n)Tg(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),n=!0);return n}needsReEvaluation(e,n,a){const u=e.transform.projectionOptions,c=e.style.getBrightness(),f=this.brightness!==c;if(!this.uploaded||this.dirty||u.name!==this.projection.name||Np(a.paint.get("model-color").value,f)||Np(a.paint.get("model-color-mix-intensity").value,f)||Np(a.paint.get("model-roughness").value,f)||Np(a.paint.get("model-emissive-strength").value,f)||Np(a.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=u,this.brightness=c;const y=this.getNodesInfo();for(const b of y)b.state=null;return!0}return!1}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),u=this.id.canonical;for(const c of a){const f=c.feature;c.evaluatedScale=n.paint.get("model-scale").evaluate(f,{},u)}}evaluate(e,n){const a=this.getNodesInfo();for(const u of a){if(!u.node.meshes)continue;const c=u.feature,f=n&&n[c.id];if(wt(f,u.state))continue;u.state=structuredClone(f);const y=u.node.meshes&&u.node.meshes[0].featureData,b=u.evaluatedColor[2],S=u.evaluatedRMEA[2],_=this.id.canonical;if(u.hasTranslucentParts=!1,y){for(let w=0;w<q2.length;w++){const M=q2[w];M.length&&(c.properties.part=M);const T=e.paint.get("model-color").evaluate(c,f,_).toRenderColor(null),E=e.paint.get("model-color-mix-intensity").evaluate(c,f,_);u.evaluatedColor[w]=[T.r,T.g,T.b,E],u.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(c,f,_),u.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(c,f,_),u.evaluatedRMEA[w][3]=T.a,u.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,f,_),!u.hasTranslucentParts&&T.a<1&&(u.hasTranslucentParts=!0)}delete c.properties.part,BR(u,b!==u.evaluatedColor[2]||S!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,f,_);u.evaluatedScale=e.paint.get("model-scale").evaluate(c,f,_),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,a,u){const c=e.findDEMTileFor(a);if(c&&(c.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const f=ld.create(e,a,c);if(!f)return;this.modelTraits&ad.HasMapboxMeshFeatures&&this.updateDEM(e,f,a,u);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const S=b.footprint.vertices;let _=f.getElevationAt(S[0].x,S[0].y,!0,!0);for(let w=1;w<S.length;w++)_=Math.min(_,f.getElevationAt(S[w].x,S[w].y,!0,!0));b.elevation=_}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,a,u){let c=n._dem._modifiedForSources[u];if(c===void 0&&(n._dem._modifiedForSources[u]=[],c=n._dem._modifiedForSources[u]),c.includes(a.canonical))return;const f=n._dem.dim;c.push(a.canonical);let y=!1;for(const b of this.getNodesInfo()){const S=b.node;if(!S.footprint||!S.footprint.grid)continue;const _=S.footprint.grid,w=n.tileCoordToPixel(_.min.x,_.min.y),M=n.tileCoordToPixel(_.max.x,_.max.y),T=Math.min(Math.min(f-M.y,w.x),Math.min(w.y,f-M.x));if(T<0)continue;const E=Ye(T,2,5);let C=Math.max(0,w.x-E),O=Math.max(0,w.y-E),k=Math.min(M.x+E,f-1),U=Math.min(M.y+E,f-1);for(let Z=O;Z<=U;++Z)for(let K=C;K<=k;++K)gu[Z*f+K]=255;let V=0,N=0;for(let Z=0;Z<_.cellsY;++Z)for(let K=0;K<_.cellsX;++K){if(!_.cells[Z*_.cellsX+K])continue;const ae=n.tileCoordToPixel(_.min.x+K/_.xScale,_.min.y+Z/_.yScale),ie=n.tileCoordToPixel(_.min.x+(K+1)/_.xScale,_.min.y+(Z+1)/_.yScale);for(let se=ae.y;se<=Math.min(ie.y+1,f-1);++se)for(let ve=ae.x;ve<=Math.min(ie.x+1,f-1);++ve)gu[se*f+ve]===255&&(gu[se*f+ve]=0,V+=n.getElevationAtPixel(ve,se),N++)}const $=V/N;C=Math.max(1,w.x-E),O=Math.max(1,w.y-E),k=Math.min(M.x+E,f-2),U=Math.min(M.y+E,f-2),y=!0;for(let Z=O;Z<=U;++Z)for(let K=C;K<=k;++K)gu[Z*f+K]===0&&(Vv[Z*f+K]=n._dem.set(K,Z,$));for(let Z=1;Z<E;++Z){C=Math.max(1,w.x-Z),O=Math.max(1,w.y-Z),k=Math.min(M.x+Z,f-2),U=Math.min(M.y+Z,f-2);for(let K=O;K<=U;++K)for(let ae=C;ae<=k;++ae){const ie=K*f+ae;if(gu[ie]===255){let se=0,ve=0,le=-1,xe=-1;for(let Me=-1;Me<=1;++Me)for(let Se=-1;Se<=1;++Se){const Pe=(K+Me)*f+ae+Se;if(gu[Pe]>=Z)continue;const Ce=Vv[Pe],Fe=Math.abs(Ce);Fe>ve&&(se=Ce,ve=Fe,le=Se,xe=Me)}if(ve>.1){const Me=1-(Z+.5*Math.abs(le*xe))/E;let Se=n._dem.get(ae,K)+se*Me;const Pe=n._dem.get(ae+le,K+xe),Ce=n._dem.get(ae-le,K-xe,!0);(Se-Pe)*(Se-Ce)>0&&(Se=(Pe+Ce)/2),Vv[ie]=n._dem.set(ae,K,Se),gu[ie]=Z}}}}}y&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=We.now())}setFilter(e){this.filter=e?Hf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new bn(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const n of e)Tg(n.node),Nv(n.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;const a=n.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const f=u[c].node;u[c].hiddenByReplacement=!!f.footprint&&!a.find(y=>y.footprint===f.footprint)}}getHeightAtTileCoord(e,n){const a=this.getNodesInfo(),u=[],c=[0,0,0],f=te.mat4.identity([]);for(let y=0;y<this.nodesInfo.length;y++){const b=a[y],S=b.node.meshes[0],_=S.transformedAabb;if(e<_.min[0]||n<_.min[1]||e>_.max[0]||n>_.max[1])continue;if(b.node.hidden===!0)return{height:1/0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};te.mat4.invert(f,b.node.matrix),c[0]=e,c[1]=n,te.vec3.transformMat4(c,c,f);const w=(c[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*_u|0,M=Math.min(63,(c[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*_u|0)*_u+Math.min(63,w),T=S.heightmap[M];if(!(T<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:T,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Ae(e,n),new Ae(e,n),u),u.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function Np(o,e){return!o.isLightConstant&&e}function FR(o,e,n,a,u,c,f,y){let b=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,_=240&e|(240&e)>>4;n[3]>0&&(b=ar(b,255*n[0],n[3]),S=ar(S,255*n[1],n[3]),_=ar(_,255*n[2],n[3]));const w=b<<8|S,M=_<<8|Math.floor(255*a[3]),T=function(Z){const K=Ye(Z,0,2);return Math.min(Math.round(.5*K*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],E=Ye(u[0],0,1),C=Ye(u[1],0,1),O=Ye(u[2],0,1),k=Ye(u[3],0,1);let U,V,N,$;if(E!==C&&f!==c&&C!==E){const Z=f-c;V=1/(Z*(C-E)),N=-(c+Z*E)/(Z*(C-E));const K=Ye(u[4],-1,1);$=Math.pow(10,K),U=255*O<<8|255*k}else U=65535,V=0,N=1,$=1;if(o.emplaceBack(w,M,T,U,V,N,$),y){const Z=y.length;y.clear();for(let K=0;K<Z;K++)y.emplaceBack(w,M,T,U,V,N,$)}}function BR(o,e,n){const a=o.node;let u=0;const c=n&ad.HasMeshoptCompression;for(const f of a.meshes){if(a.lights&&a.lightMeshIndex===u||!f.featureData)continue;f.featureArray=new nu,f.featureArray.reserve(f.featureData.length);let y=e;for(const b of f.featureData){const S=c?65535&b:b>>16&65535,_=c?b>>16&65535:65535&b,w=(15&_)<8?15&_:0,M=o.evaluatedRMEA[w],T=o.evaluatedColor[w],E=o.emissionHeightBasedParams[w];let C;if(y&&w===2&&a.lights&&(C=new nu,C.resize(10*a.lights.length)),FR(f.featureArray,S,T,M,E,f.aabb.min[2],f.aabb.max[2],C),C&&y){y=!1;const O=a.meshes[a.lightMeshIndex];O.featureArray=C,O.featureArray._trim()}}f.featureArray._trim(),u++}}function Z2(o,e,n,a){const u=1<<o.z;e.lat=Ci((a/Ct+o.y)/u),e.lng=ds((n/Ct+o.x)/u)}Ft(Sg,"Tiled3dModelBucket",{omit:["layers"]}),Ft(W2,"Tiled3dModelFeature");const NR={circle:class extends Qi{constructor(o,e,n,a){super(o,{layout:tt||(tt=new $n({"circle-sort-key":new kt(Ue.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Tt(Ue.layout_circle["circle-elevation-reference"]),visibility:new Tt(Ue.layout_circle.visibility)})),paint:ze||(ze=new $n({"circle-radius":new kt(Ue.paint_circle["circle-radius"]),"circle-color":new kt(Ue.paint_circle["circle-color"]),"circle-blur":new kt(Ue.paint_circle["circle-blur"]),"circle-opacity":new kt(Ue.paint_circle["circle-opacity"]),"circle-translate":new Tt(Ue.paint_circle["circle-translate"]),"circle-translate-anchor":new Tt(Ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Tt(Ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Tt(Ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(Ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(Ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(Ue.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Tt(Ue.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}createBucket(o){return new X(o)}queryRadius(o){const e=o;return rt("circle-radius",this,e)+rt("circle-stroke-width",this,e)+nt(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,n,a,u,c,f,y){const b=Oe(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Qh(o,a,c,f,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,n){const a=Jh(this);return{config:new cl(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}},heatmap:class extends Qi{createBucket(o){return new vb(o)}constructor(o,e,n,a){super(o,{layout:xb||(xb=new $n({visibility:new Tt(Ue.layout_heatmap.visibility)})),paint:bb||(bb=new $n({"heatmap-radius":new kt(Ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(Ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Tt(Ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new il(Ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Tt(Ue.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return rt("heatmap-radius",this,o)}queryIntersectsFeature(o,e,n,a,u,c,f,y){const b=this.paint.get("heatmap-radius").evaluate(e,n);return Qh(o,a,c,f,y,!0,!0,new Ae(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,n){return o==="heatmap"?{config:new cl(this,{zoom:e,lut:n}),overrideFog:!1}:{}}},hillshade:class extends Qi{constructor(o,e,n,a){super(o,{layout:wb||(wb=new $n({visibility:new Tt(Ue.layout_hillshade.visibility)})),paint:Tb||(Tb=new $n({"hillshade-illumination-direction":new Tt(Ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Tt(Ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Tt(Ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Tt(Ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Tt(Ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Tt(Ue.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Tt(Ue.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,n){return{overrideFog:!1}}},fill:class extends Qi{constructor(o,e,n,a){super(o,{layout:jb||(jb=new $n({"fill-sort-key":new kt(Ue.layout_fill["fill-sort-key"]),visibility:new Tt(Ue.layout_fill.visibility),"fill-elevation-reference":new Tt(Ue.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new kt(Ue.layout_fill["fill-construct-bridge-guard-rail"])})),paint:$b||($b=new $n({"fill-antialias":new Tt(Ue.paint_fill["fill-antialias"]),"fill-opacity":new kt(Ue.paint_fill["fill-opacity"]),"fill-color":new kt(Ue.paint_fill["fill-color"]),"fill-outline-color":new kt(Ue.paint_fill["fill-outline-color"]),"fill-translate":new Tt(Ue.paint_fill["fill-translate"]),"fill-translate-anchor":new Tt(Ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(Ue.paint_fill["fill-pattern"]),"fill-emissive-strength":new Tt(Ue.paint_fill["fill-emissive-strength"]),"fill-z-offset":new kt(Ue.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new kt(Ue.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new kt(Ue.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(o,e,n){return{config:new cl(this,{zoom:e,lut:n}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new sv(o)}queryRadius(){return nt(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,n,a,u,c){return!o.queryGeometry.isAboveHorizon&&Q(yt(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}},"fill-extrusion":class extends Qi{constructor(o,e,n,a){super(o,{layout:gw||(gw=new $n({visibility:new Tt(Ue["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Tt(Ue["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:yw||(yw=new $n({"fill-extrusion-opacity":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Tt(Ue["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new eg(o)}queryRadius(){return nt(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,n,a,u,c,f,y,b){const S=Oe(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(e,n),w=this.paint.get("fill-extrusion-base").evaluate(e,n),M=[0,0],T=y&&c.elevation,E=c.elevation?c.elevation.exaggeration():1,C=o.tile.getBucket(this);if(T&&C instanceof eg){const N=C.centroidVertexArray,$=b+1;$<N.length&&(M[0]=N.geta_centroid_pos0($),M[1]=N.geta_centroid_pos1($))}if(M[0]===0&&M[1]===1)return!1;c.projection.name==="globe"&&(a=_w([a],[new Ae(0,0),new Ae(Ct,Ct)],o.tileID.canonical).map(N=>N.polygon).flat());const O=T?y:null,[k,U]=function(N,$,Z,K,ae,ie,se,ve,le,xe,Me){return N.projection.name==="globe"?function(Se,Pe,Ce,Fe,Le,Ne,ot,it,Bt,_t,At){const ct=[],rr=[],Ot=Se.projection.upVectorScale(At,Se.center.lat,Se.worldSize).metersToTile,qt=[0,0,0,1],dr=[0,0,0,1],Ir=(Lr,Er,Fr,Yr)=>{Lr[0]=Er,Lr[1]=Fr,Lr[2]=Yr,Lr[3]=1},yr=mw();Ce>0&&(Ce+=yr),Fe+=yr;for(const Lr of Pe){const Er=[],Fr=[];for(const Yr of Lr){const wn=Yr.x+Le.x,_r=Yr.y+Le.y,$r=Se.projection.projectTilePoint(wn,_r,At),Dn=Se.projection.upVector(At,Yr.x,Yr.y);let Nn=Ce,Zn=Fe;if(ot){const Xn=xw(wn,_r,Ce,Fe,ot,it,Bt,_t);Nn+=Xn.base,Zn+=Xn.top}Ce!==0?Ir(qt,$r.x+Dn[0]*Ot*Nn,$r.y+Dn[1]*Ot*Nn,$r.z+Dn[2]*Ot*Nn):Ir(qt,$r.x,$r.y,$r.z),Ir(dr,$r.x+Dn[0]*Ot*Zn,$r.y+Dn[1]*Ot*Zn,$r.z+Dn[2]*Ot*Zn),te.vec3.transformMat4(qt,qt,Ne),te.vec3.transformMat4(dr,dr,Ne),Er.push(new pu(qt[0],qt[1],qt[2])),Fr.push(new pu(dr[0],dr[1],dr[2]))}ct.push(Er),rr.push(Fr)}return[ct,rr]}(N,$,Z,K,ae,ie,se,ve,le,xe,Me):se?function(Se,Pe,Ce,Fe,Le,Ne,ot,it,Bt){const _t=[],At=[],ct=[0,0,0,1];for(const rr of Se){const Ot=[],qt=[];for(const dr of rr){const Ir=dr.x+Fe.x,yr=dr.y+Fe.y,Lr=xw(Ir,yr,Pe,Ce,Ne,ot,it,Bt);ct[0]=Ir,ct[1]=yr,ct[2]=Lr.base,ct[3]=1,te.vec4.transformMat4(ct,ct,Le),ct[3]=Math.max(ct[3],1e-5);const Er=new pu(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ct[0]=Ir,ct[1]=yr,ct[2]=Lr.top,ct[3]=1,te.vec4.transformMat4(ct,ct,Le),ct[3]=Math.max(ct[3],1e-5);const Fr=new pu(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);Ot.push(Er),qt.push(Fr)}_t.push(Ot),At.push(qt)}return[_t,At]}($,Z,K,ae,ie,se,ve,le,xe):function(Se,Pe,Ce,Fe,Le){const Ne=[],ot=[],it=Le[8]*Pe,Bt=Le[9]*Pe,_t=Le[10]*Pe,At=Le[11]*Pe,ct=Le[8]*Ce,rr=Le[9]*Ce,Ot=Le[10]*Ce,qt=Le[11]*Ce;for(const dr of Se){const Ir=[],yr=[];for(const Lr of dr){const Er=Lr.x+Fe.x,Fr=Lr.y+Fe.y,Yr=Le[0]*Er+Le[4]*Fr+Le[12],wn=Le[1]*Er+Le[5]*Fr+Le[13],_r=Le[2]*Er+Le[6]*Fr+Le[14],$r=Le[3]*Er+Le[7]*Fr+Le[15],Dn=Yr+it,Nn=wn+Bt,Zn=_r+_t,Xn=Math.max($r+At,1e-5),gn=Yr+ct,yi=wn+rr,ns=_r+Ot,oi=Math.max($r+qt,1e-5);Ir.push(new pu(Dn/Xn,Nn/Xn,Zn/Xn)),yr.push(new pu(gn/oi,yi/oi,ns/oi))}Ne.push(Ir),ot.push(yr)}return[Ne,ot]}($,Z,K,ae,ie)}(c,a,w,_,S,f,O,M,E,c.center.lat,o.tileID.canonical),V=o.queryGeometry;return function(N,$,Z){let K=1/0;Q(Z,$)&&(K=vw(Z,$[0]));for(let ae=0;ae<$.length;ae++){const ie=$[ae],se=N[ae];for(let ve=0;ve<ie.length-1;ve++){const le=ie[ve],xe=[le,ie[ve+1],se[ve+1],se[ve],le];q(Z,xe)&&(K=Math.min(K,vw(Z,xe)))}}return K!==1/0&&K}(k,U,V.isPointQuery()?V.screenBounds:V.screenGeometry)}},line:class extends Qi{constructor(o,e,n,a){const u=Pw();super(o,u,e,n,a),u.layout&&(this.layout=new Ul(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof kr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(Ip)return Ip;const n=Pw();return Ip=new NP(n.paint.properties["line-width"].specification),Ip.useIntegerZoom=!0,Ip})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new dv(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,n){const a=Iw(this);return{config:new cl(this,{zoom:e,lut:n}),defines:a,overrideFog:!1}}queryRadius(o){const e=o,n=Rw(rt("line-width",this,e),rt("line-gap-width",this,e)),a=rt("line-offset",this,e);return n/2+Math.abs(a)+nt(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,n,a,u,c){if(o.queryGeometry.isAboveHorizon)return!1;const f=yt(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),y=o.pixelToTileUnitsFactor/2*Rw(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),b=this.paint.get("line-offset").evaluate(e,n);return b&&(a=function(S,_){const w=[],M=new Ae(0,0);for(let T=0;T<S.length;T++){const E=S[T],C=[];for(let O=0;O<E.length;O++){const k=E[O],U=E[O+1],V=O===0?M:k.sub(E[O-1])._unit()._perp(),N=O===E.length-1?M:U.sub(k)._unit()._perp(),$=V._add(N)._unit();$._mult(1/($.x*N.x+$.y*N.y)),C.push($._mult(_)._add(k))}w.push(C)}return w}(a,b*o.pixelToTileUnitsFactor)),function(S,_,w){for(let M=0;M<_.length;M++){const T=_[M];if(S.length>=3){for(let E=0;E<T.length;E++)if(me(S,T[E]))return!0}if(oe(S,T,w))return!0}return!1}(f,a,y)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets}},symbol:_g,background:class extends Qi{constructor(o,e,n,a){super(o,{layout:v2||(v2=new $n({visibility:new Tt(Ue.layout_background.visibility)})),paint:x2||(x2=new $n({"background-pitch-alignment":new Tt(Ue.paint_background["background-pitch-alignment"]),"background-color":new Tt(Ue.paint_background["background-color"]),"background-pattern":new Tt(Ue.paint_background["background-pattern"]),"background-opacity":new Tt(Ue.paint_background["background-opacity"]),"background-emissive-strength":new Tt(Ue.paint_background["background-emissive-strength"]),"background-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,n){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:E2,"raster-particle":R2,sky:class extends Qi{constructor(o,e,n,a){super(o,{layout:I2||(I2=new $n({visibility:new Tt(Ue.layout_sky.visibility)})),paint:C2||(C2=new $n({"sky-type":new Tt(Ue.paint_sky["sky-type"]),"sky-atmosphere-sun":new Tt(Ue.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Tt(Ue.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Tt(Ue.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Tt(Ue.paint_sky["sky-gradient-radius"]),"sky-gradient":new il(Ue.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Tt(Ue.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Tt(Ue.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Tt(Ue.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,c=o.style.light,f=c.properties.get("position");return u&&c.properties.get("anchor")==="viewport"&&Rr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Lv(f.azimuthal,90-f.polar,e):Lv(a[0],90-a[1],e)}const n=this.paint.get("sky-gradient-center");return Lv(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Qi{constructor(o,e,n,a){super(o,{paint:P2||(P2=new $n({}))},e,null)}},model:class extends Qi{constructor(o,e,n,a){super(o,{layout:U2||(U2=new $n({visibility:new Tt(Ue.layout_model.visibility),"model-id":new kt(Ue.layout_model["model-id"])})),paint:j2||(j2=new $n({"model-opacity":new kt(Ue.paint_model["model-opacity"]),"model-rotation":new kt(Ue.paint_model["model-rotation"]),"model-scale":new kt(Ue.paint_model["model-scale"]),"model-translation":new kt(Ue.paint_model["model-translation"]),"model-color":new kt(Ue.paint_model["model-color"]),"model-color-mix-intensity":new kt(Ue.paint_model["model-color-mix-intensity"]),"model-type":new Tt(Ue.paint_model["model-type"]),"model-cast-shadows":new Tt(Ue.paint_model["model-cast-shadows"]),"model-receive-shadows":new Tt(Ue.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Tt(Ue.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new kt(Ue.paint_model["model-emissive-strength"]),"model-roughness":new kt(Ue.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new kt(Ue.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Tt(Ue.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Tt(Ue.paint_model["model-front-cutoff"]),"model-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,n,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Fv(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof Sg?Ct-1:0}queryIntersectsFeature(o,e,n,a,u,c){if(!this.modelManager)return!1;const f=this.modelManager,y=o.tile.getBucket(this);if(!(y&&y instanceof Fv))return!1;for(const b in y.instancesPerModel){const S=y.instancesPerModel[b],_=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(S.idToFeaturesIndex.hasOwnProperty(_)){const w=S.features[S.idToFeaturesIndex[_]],M=f.getModel(b,this.scope);if(!M)return!1;let T=te.mat4.create();const E=new Qr(0,0),C=y.canonical;let O=Number.MAX_VALUE;for(let k=0;k<w.instancedDataCount;++k){const U=16*(w.instancedDataOffset+k),V=S.instancedDataArray.float32,N=[V[U+4],V[U+5],V[U+6]];Z2(C,E,V[U],0|V[U+1]),$2(T,M,c,E,w.rotation,w.scale,N,!1,!1,!1),c.projection.name==="globe"&&(T=kv(T,c));const $=te.mat4.multiply([],c.projMatrix,T),Z=o.queryGeometry,K=k2(Z.isPointQuery()?Z.screenBounds:Z.screenGeometry,c,$,M.aabb);K!=null&&(O=Math.min(K,O))}return O!==Number.MAX_VALUE&&O}}return!1}_handleOverridablePaintPropertyUpdate(o,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof kl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Qi{constructor(o,e,n,a){super(o,{layout:Gb||(Gb=new $n({"clip-layer-types":new Tt(Ue.layout_clip["clip-layer-types"]),"clip-layer-scope":new Tt(Ue.layout_clip["clip-layer-scope"])})),paint:Hb||(Hb=new $n({}))},e,n,a)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new qb(o)}is3D(o){return!0}}};class VR{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class UR{constructor(){this.tasks={},this.taskQueue=[],Ni(["process"],this),this.invoker=new VR(this.process),this.nextId=0}add(e,n){const a=this.nextId++,u=function({type:c,isSymbolTile:f,zoom:y}){return y=y||0,c==="message"?0:c!=="maybePrepare"||f?c!=="parseTile"||f?c==="parseTile"&&f?300-y:c==="maybePrepare"&&f?400-y:500:200-y:100-y}(n);if(u===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:n,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const c=this.tasks[this.taskQueue[u]];c.priority<n&&(n=c.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class X2{constructor(e,n,a){this.target=e,this.parent=n,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Ni(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new UR}send(e,n,a,u,c=!1,f){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=f,this.callbacks[y]=a);const b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!a,targetMapId:u,mustQueue:c,sourceMapId:this.mapId,data:As(n,b)},b),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const n=e.data;if(!n)return;const a=n.id;if(a&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(n.mustQueue||Ga()){const u=this.callbacks[a],c=this.scheduler.add(()=>this.processTask(a,n),u&&u.metadata||{type:"message"});c&&(this.cancelCallbacks[a]=c)}else this.processTask(a,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(n.error?a(Ta(n.error)):a(null,Ta(n.data)))}else{const a=new Set,u=n.hasCallback?(f,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?As(f):null,data:As(y,a)},a)}:()=>{},c=Ta(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,c,u);else if(this.parent.getWorkerSource){const f=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,f[0],c.source,c.scope)[f[1]](c,u)}else u(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Vp={workerUrl:"",workerClass:null,workerParams:void 0};const Uv="mapboxgl_preloaded_worker_pool";class yu{constructor(){this.active={}}acquire(e,n=yu.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<n;)this.workers.push(Vp.workerClass!=null?new Vp.workerClass:new self.Worker(Vp.workerUrl,Vp.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Uv]}numActive(){return Object.keys(this.active).length}}yu.workerCount=2;class cd{constructor(e,n,a="Worker",u=yu.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ri();const c=this.workerPool.acquire(this.id,u);for(let f=0;f<c.length;f++){const y=new cd.Actor(c[f],n,this.id);y.name=`${a} ${f}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,a){xn(this.actors,(u,c)=>{u.send(e,n,c)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Up,jv;function Eg(){return Up||(Up=new yu),Up}cd.Actor=X2;const $v=new nn(0,0,0);var Gv=(o=>(o[o.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",o[o.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",o[o.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",o))(Gv||{}),Ag=(o=>(o[o.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",o[o.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",o[o.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",o[o.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",o))(Ag||{}),jp=(o=>(o[o.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",o[o.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",o[o.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",o[o.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",o[o.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",o))(jp||{}),K2=(o=>(o[o.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",o[o.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",o[o.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",o))(K2||{}),ud=(o=>(o[o.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",o[o.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",o[o.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",o[o.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",o[o.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",o[o.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",o))(ud||{}),Y2=(o=>(o[o.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",o[o.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",o[o.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",o))(Y2||{});function jR(o,e,n){o===1&&e.icons.push(function(a,u){return function(c){if(c.usvg_tree.height||(c.usvg_tree.height=c.usvg_tree.width),!c.metadata)return c;const{metadata:f}=c;if(f.content_area){const{content_area:y}=f;y.top==null&&(y.top=y.left),y.width==null&&(y.width=c.usvg_tree.width),y.height==null&&(y.height=y.width)}return f.stretch_x&&f.stretch_x.length&&J2(f,"x"),f.stretch_y&&f.stretch_y.length&&J2(f,"y"),c}(a.readFields($R,{name:void 0},u))}(n,n.readVarint()+n.pos))}function J2(o,e){const n=[],a=o[`stretch_${e}`];let u=null;for(let c=0;c<a.length;c++)u===null?u=n.length===0?a[0]:n[n.length-1][1]+a[c]:(n.push([u,u+a[c]]),u=null);o[`stretch_${e}_areas`]=n}function $R(o,e,n){o===1?e.name=n.readString():o===2?e.metadata=function(a,u){return a.readFields(GR,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)}(n,n.readVarint()+n.pos):o===3&&(e.usvg_tree=function(a,u){return a.readFields(WR,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)}(n,n.readVarint()+n.pos),e.data="usvg_tree")}function GR(o,e,n){o===1?e.stretch_x=n.readPackedVarint():o===2?e.stretch_y=n.readPackedVarint():o===3?e.content_area=function(a,u){return a.readFields(HR,{left:0},u)}(n,n.readVarint()+n.pos):o===4&&e.variables.push(function(a,u){return a.readFields(qR,{name:void 0},u)}(n,n.readVarint()+n.pos))}function HR(o,e,n){o===1?e.left=n.readVarint():o===2?e.width=n.readVarint():o===3?e.top=n.readVarint():o===4&&(e.height=n.readVarint())}function qR(o,e,n){o===1?e.name=n.readString():o===2&&(e.rgb_color=Cg(n.readVarint()),e.value="rgb_color")}function WR(o,e,n){o===1?e.width=e.height=n.readVarint():o===2?e.height=n.readVarint():o===3?e.children.push(Mg(n,n.readVarint()+n.pos)):o===4?e.linear_gradients.push(function(a,u){return a.readFields(eD,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)}(n,n.readVarint()+n.pos)):o===5?e.radial_gradients.push(function(a,u){return a.readFields(rD,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)}(n,n.readVarint()+n.pos)):o===7?e.clip_paths.push(function(a,u){return a.readFields(nD,{children:[]},u)}(n,n.readVarint()+n.pos)):o===8&&e.masks.push(function(a,u){const c=a.readFields(iD,{left:0,width:20,mask_type:1,children:[]},u);return c.height==null&&(c.height=c.width),c.top==null&&(c.top=c.left),c}(n,n.readVarint()+n.pos))}function Mg(o,e){return o.readFields(ZR,{},e)}function ZR(o,e,n){o===1?(e.group=function(a,u){return a.readFields(XR,{opacity:255,children:[]},u)}(n,n.readVarint()+n.pos),e.node="group"):o===2&&(e.path=function(a,u){return a.readFields(YR,{paint_order:1,commands:[],step:1,diffs:[],rule:1},u)}(n,n.readVarint()+n.pos),e.node="path")}function XR(o,e,n){o===1?e.transform=Ig(n,n.readVarint()+n.pos):o===2?e.opacity=n.readVarint():o===5?e.clip_path_idx=n.readVarint():o===6?e.mask_idx=n.readVarint():o===7&&e.children.push(Mg(n,n.readVarint()+n.pos))}function Ig(o,e){return o.readFields(KR,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function KR(o,e,n){o===1?e.sx=n.readFloat():o===2?e.ky=n.readFloat():o===3?e.kx=n.readFloat():o===4?e.sy=n.readFloat():o===5?e.tx=n.readFloat():o===6&&(e.ty=n.readFloat())}function YR(o,e,n){o===1?e.fill=function(a,u){return a.readFields(JR,{rgb_color:$v,paint:"rgb_color",opacity:255},u)}(n,n.readVarint()+n.pos):o===2?e.stroke=function(a,u){return a.readFields(QR,{rgb_color:$v,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)}(n,n.readVarint()+n.pos):o===3?e.paint_order=n.readVarint():o===5?n.readPackedVarint(e.commands):o===6?e.step=n.readFloat():o===7?n.readPackedSVarint(e.diffs):o===8&&(e.rule=n.readVarint())}function JR(o,e,n){o===1?(e.rgb_color=Cg(n.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=n.readVarint())}function Cg(o){return new nn((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function QR(o,e,n){o===1?(e.rgb_color=Cg(n.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=n.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=n.readVarint(),e.paint="radial_gradient_idx"):o===5?n.readPackedFloat(e.dasharray):o===6?e.dashoffset=n.readFloat():o===7?e.miterlimit=n.readFloat():o===8?e.opacity=n.readVarint():o===9?e.width=n.readFloat():o===10?e.linecap=n.readVarint():o===11&&(e.linejoin=n.readVarint())}function eD(o,e,n){o===1?e.transform=Ig(n,n.readVarint()+n.pos):o===2?e.spread_method=n.readVarint():o===3?e.stops.push(Q2(n,n.readVarint()+n.pos)):o===4?e.x1=n.readFloat():o===5?e.y1=n.readFloat():o===6?e.x2=n.readFloat():o===7&&(e.y2=n.readFloat())}function Q2(o,e){return o.readFields(tD,{offset:0,opacity:255,rgb_color:$v},e)}function tD(o,e,n){o===1?e.offset=n.readFloat():o===2?e.opacity=n.readVarint():o===3&&(e.rgb_color=Cg(n.readVarint()))}function rD(o,e,n){o===1?e.transform=Ig(n,n.readVarint()+n.pos):o===2?e.spread_method=n.readVarint():o===3?e.stops.push(Q2(n,n.readVarint()+n.pos)):o===4?e.cx=n.readFloat():o===5?e.cy=n.readFloat():o===6?e.r=n.readFloat():o===7?e.fx=n.readFloat():o===8?e.fy=n.readFloat():o===9&&(e.fr=n.readFloat())}function nD(o,e,n){o===1?e.transform=Ig(n,n.readVarint()+n.pos):o===2?e.clip_path_idx=n.readVarint():o===3&&e.children.push(Mg(n,n.readVarint()+n.pos))}function iD(o,e,n){o===1?e.left=e.top=n.readFloat():o===2?e.width=e.height=n.readFloat():o===3?e.top=n.readFloat():o===4?e.height=n.readFloat():o===5?e.mask_type=n.readVarint():o===6?e.mask_idx=n.readVarint():o===7&&e.children.push(Mg(n,n.readVarint()+n.pos))}class sD{static calculate(e={},n=[]){const a=new Map,u=new Map;if(Object.keys(e).length===0)return a;n.forEach(c=>{u.set(c.name,c.rgb_color||new nn(0,0,0))});for(const[c,f]of Object.entries(e))u.has(c)?a.set(u.get(c).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${c}"`);return a}}function hd(o,e=255,n){const a=e/255,u=o.toStringPremultipliedAlpha(),c=n.has(u)?n.get(u).clone():o.clone();return c.a*=a,c.toString()}function $p(o,e){if(!Ke()){const n=document.createElement("canvas");return n.width=o,n.height=e,n}return new OffscreenCanvas(o,e)}function oD(o,e){const n=sD.calculate(e.params,o.metadata?o.metadata.variables:[]),a=o.usvg_tree,u=a.width,c=a.height,f=e.transform?e.transform:new DOMMatrix,y=Math.max(1,Math.round(u*f.a)),b=Math.max(1,Math.round(c*f.d)),S=new DOMMatrix([y/u,0,0,b/c,0,0]),_=$p(y,b).getContext("2d");return Hv(_,S,a,a,n),_.getImageData(0,0,y,b)}function Hv(o,e,n,a,u){for(const c of a.children)eT(o,e,n,c,u)}function eT(o,e,n,a,u){a.group?(o.save(),function(c,f,y,b,S){const _=b.mask_idx!=null?y.masks[b.mask_idx]:null,w=b.clip_path_idx!=null?y.clip_paths[b.clip_path_idx]:null;if(b.transform&&(f=Pg(b.transform).preMultiplySelf(f)),!function(E,C,O){return E.opacity!==255||C||O}(b,w!=null,_!=null))return void Hv(c,f,y,b,S);const M=$p(c.canvas.width,c.canvas.height),T=M.getContext("2d");Hv(T,f,y,b,S),w&&aT(T,f,y,w),_&&lT(T,f,y,_,S),c.globalAlpha=b.opacity/255,c.drawImage(M,0,0)}(o,e,n,a.group,u),o.restore()):a.path&&(o.save(),function(c,f,y,b,S){const _=cT(b);c.setTransform(f),b.paint_order===K2.PAINT_ORDER_FILL_AND_STROKE?(tT(c,y,b,_,S),nT(c,y,b,_,S)):(nT(c,y,b,_,S),tT(c,y,b,_,S))}(o,e,n,a.path,u),o.restore())}function tT(o,e,n,a,u){const c=n.fill;if(!c)return;const f=c.opacity/255;switch(c.paint){case"rgb_color":o.fillStyle=hd(c.rgb_color,c.opacity,u);break;case"linear_gradient_idx":o.fillStyle=iT(o,e.linear_gradients[c.linear_gradient_idx],f,u);break;case"radial_gradient_idx":o.fillStyle=sT(o,e.radial_gradients[c.radial_gradient_idx],f,u)}o.fill(a,rT(n))}function rT(o){return o.rule===Gv.PATH_RULE_NON_ZERO?"nonzero":o.rule===Gv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function nT(o,e,n,a,u){const c=n.stroke;if(!c)return;o.lineWidth=c.width,o.miterLimit=c.miterlimit,o.setLineDash(c.dasharray),o.lineDashOffset=c.dashoffset;const f=c.opacity/255;switch(c.paint){case"rgb_color":o.strokeStyle=hd(c.rgb_color,c.opacity,u);break;case"linear_gradient_idx":o.strokeStyle=iT(o,e.linear_gradients[c.linear_gradient_idx],f,u);break;case"radial_gradient_idx":o.strokeStyle=sT(o,e.radial_gradients[c.radial_gradient_idx],f,u)}switch(c.linejoin){case jp.LINE_JOIN_MITER_CLIP:case jp.LINE_JOIN_MITER:o.lineJoin="miter";break;case jp.LINE_JOIN_ROUND:o.lineJoin="round";break;case jp.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(c.linecap){case Ag.LINE_CAP_BUTT:o.lineCap="butt";break;case Ag.LINE_CAP_ROUND:o.lineCap="round";break;case Ag.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(a)}function iT(o,e,n,a){if(e.stops.length===1){const M=e.stops[0];return hd(M.rgb_color,M.opacity*n,a)}const u=Pg(e.transform),{x1:c,y1:f,x2:y,y2:b}=e,S=u.transformPoint(new DOMPoint(c,f)),_=u.transformPoint(new DOMPoint(y,b)),w=o.createLinearGradient(S.x,S.y,_.x,_.y);for(const M of e.stops)w.addColorStop(M.offset,hd(M.rgb_color,M.opacity*n,a));return w}function sT(o,e,n,a){if(e.stops.length===1){const M=e.stops[0];return hd(M.rgb_color,M.opacity*n,a)}const u=Pg(e.transform),{fx:c,fy:f,cx:y,cy:b}=e,S=u.transformPoint(new DOMPoint(c,f)),_=u.transformPoint(new DOMPoint(y,b)),w=o.createRadialGradient(S.x,S.y,0,_.x,_.y,e.r*((u.a+u.d)/2));for(const M of e.stops)w.addColorStop(M.offset,hd(M.rgb_color,M.opacity*n,a));return w}function oT(o,e,n,a){const u=a.transform?Pg(a.transform).preMultiplySelf(e):e,c=$p(o.canvas.width,o.canvas.height),f=c.getContext("2d");for(const b of a.children)if(b.group)oT(f,u,n,b.group);else if(b.path){const S=b.path,_=new Path2D;_.addPath(cT(S),u),f.fill(_,rT(S))}const y=a.clip_path_idx!=null?n.clip_paths[a.clip_path_idx]:null;y&&aT(f,u,n,y),o.globalCompositeOperation="source-over",o.drawImage(c,0,0)}function aT(o,e,n,a){const u=$p(o.canvas.width,o.canvas.height);oT(u.getContext("2d"),e,n,a),o.globalCompositeOperation="destination-in",o.drawImage(u,0,0)}function lT(o,e,n,a,u){if(a.children.length===0)return;const c=a.mask_idx!=null?n.masks[a.mask_idx]:null;c&&lT(o,e,n,c,u);const f=o.canvas.width,y=o.canvas.height,b=$p(f,y),S=b.getContext("2d"),_=a.width,w=a.height,M=a.left,T=a.top,E=new Path2D,C=new Path2D;C.rect(M,T,_,w),E.addPath(C,e),S.clip(E);for(const U of a.children)eT(S,e,n,U,u);const O=S.getImageData(0,0,f,y),k=O.data;if(a.mask_type===Y2.MASK_TYPE_LUMINANCE)for(let U=0;U<k.length;U+=4)k[U+3]=k[U+3]/255*(.2126*k[U]+.7152*k[U+1]+.0722*k[U+2]);S.putImageData(O,0,0),o.globalCompositeOperation="destination-in",o.drawImage(b,0,0)}function Pg(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function cT(o){const e=new Path2D,n=o.step;let a=o.diffs[0]*n,u=o.diffs[1]*n;e.moveTo(a,u);for(let c=0,f=2;c<o.commands.length;c++)switch(o.commands[c]){case ud.PATH_COMMAND_MOVE:a+=o.diffs[f++]*n,u+=o.diffs[f++]*n,e.moveTo(a,u);break;case ud.PATH_COMMAND_LINE:a+=o.diffs[f++]*n,u+=o.diffs[f++]*n,e.lineTo(a,u);break;case ud.PATH_COMMAND_QUAD:{const y=a+o.diffs[f++]*n,b=u+o.diffs[f++]*n;a=y+o.diffs[f++]*n,u=b+o.diffs[f++]*n,e.quadraticCurveTo(y,b,a,u);break}case ud.PATH_COMMAND_CUBIC:{const y=a+o.diffs[f++]*n,b=u+o.diffs[f++]*n,S=y+o.diffs[f++]*n,_=b+o.diffs[f++]*n;a=S+o.diffs[f++]*n,u=_+o.diffs[f++]*n,e.bezierCurveTo(y,b,S,_,a,u);break}case ud.PATH_COMMAND_CLOSE:e.closePath()}return e}class Rg{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const n=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,n),n}put(e,n){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,n)}delete(e){this.cache.delete(e)}}Ft(Rg,"LRUCache");class qv{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new ki(e,e.data)}getFromCache(e,n,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new Rg(150)),this.cacheMap.get(a).get(Ms(e.toString(),n))}setInCache(e,n,a,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new Rg(150));const c=this.cacheDependenciesMap.get(u),f=Ms(e.id.toString(),a);c.get(f)||c.set(f,new Set);const y=this.cacheMap.get(u),b=e.toString();c.get(f).add(b),y.put(Ms(e.toString(),a),n)}removeImagesFromCacheByIds(e,n,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const u=this.cacheMap.get(a),c=this.cacheDependenciesMap.get(a);for(const f of e){const y=Ms(f.toString(),n);if(c.has(y)){for(const b of c.get(y))u.delete(b);c.delete(y)}}}rasterize(e,n,a,u,c=oD){const f=this.getFromCache(e,a,u);if(f)return f.clone();const y=c(n.icon,e.options),b=qv._getImage(y);return this.setInCache(e,b,a,u),b.clone()}}class uT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const a=this.toIdx(e,n);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function hT(o,e,n,a){let u=0,c=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(a[f])<1e-15){if(n[f]<o[f]||n[f]>e[f])return null}else{const y=1/a[f];let b=(o[f]-n[f])*y,S=(e[f]-n[f])*y;if(b>S){const _=b;b=S,S=_}if(b>u&&(u=b),S<c&&(c=S),u>c)return null}return u}function dT(o,e,n,a,u,c,f,y,b,S,_){const w=a-o,M=u-e,T=c-n,E=f-o,C=y-e,O=b-n,k=_[1]*O-_[2]*C,U=_[2]*E-_[0]*O,V=_[0]*C-_[1]*E,N=w*k+M*U+T*V;if(Math.abs(N)<1e-15)return null;const $=1/N,Z=S[0]-o,K=S[1]-e,ae=S[2]-n,ie=(Z*k+K*U+ae*V)*$;if(ie<0||ie>1)return null;const se=K*T-ae*M,ve=ae*w-Z*T,le=Z*M-K*w,xe=(_[0]*se+_[1]*ve+_[2]*le)*$;return xe<0||ie+xe>1?null:(E*se+C*ve+O*le)*$}function fT(o,e,n){return(o-e)/(n-e)}function pT(o,e,n,a,u,c,f,y,b){const S=1<<n,_=c-a,w=f-u,M=(o+1)/S*_+a,T=(e+0)/S*w+u,E=(e+1)/S*w+u;y[0]=(o+0)/S*_+a,y[1]=T,b[0]=M,b[1]=E}class mT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(c){const f=Math.ceil(Math.log2(c.dim/8)),y=[];let b=Math.ceil(Math.pow(2,f));const S=1/b,_=(T,E,C,O,k)=>{const U=O?1:0,V=(T+1)*C-U,N=E*C,$=(E+1)*C-U;k[0]=T*C,k[1]=N,k[2]=V,k[3]=$};let w=new uT(b);const M=[];for(let T=0;T<b*b;T++){_(T%b,Math.floor(T/b),S,!1,M);const E=rc(M[0],M[1],c),C=rc(M[2],M[1],c),O=rc(M[2],M[3],c),k=rc(M[0],M[3],c);w.minimums.push(Math.min(E,C,O,k)),w.maximums.push(Math.max(E,C,O,k)),w.leaves.push(1)}for(y.push(w),b/=2;b>=1;b/=2){const T=y[y.length-1];w=new uT(b);for(let E=0;E<b*b;E++){_(E%b,Math.floor(E/b),2,!0,M);const C=T.getElevation(M[0],M[1]),O=T.getElevation(M[2],M[1]),k=T.getElevation(M[2],M[3]),U=T.getElevation(M[0],M[3]),V=T.isLeaf(M[0],M[1]),N=T.isLeaf(M[2],M[1]),$=T.isLeaf(M[2],M[3]),Z=T.isLeaf(M[0],M[3]),K=Math.min(C.min,O.min,k.min,U.min),ae=Math.max(C.max,O.max,k.max,U.max),ie=V&&N&&$&&Z;w.maximums.push(ae),w.minimums.push(K),w.leaves.push(ae-K<=5&&ie?1:0)}y.push(w)}return y}(this.dem),a=n.length-1,u=n[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,a,0)}raycastRoot(e,n,a,u,c,f,y=1){return hT([e,n,-100],[a,u,this.maximums[0]*y],c,f)}raycast(e,n,a,u,c,f,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,n,a,u,c,f,y);if(b==null)return null;const S=[],_=[],w=[],M=[],T=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;T.length>0;){const{idx:E,t:C,nodex:O,nodey:k,depth:U}=T.pop();if(this.leaves[E]){pT(O,k,U,e,n,a,u,w,M);const N=1<<U,$=(O+0)/N,Z=(O+1)/N,K=(k+0)/N,ae=(k+1)/N,ie=rc($,K,this.dem)*y,se=rc(Z,K,this.dem)*y,ve=rc(Z,ae,this.dem)*y,le=rc($,ae,this.dem)*y,xe=dT(w[0],w[1],ie,M[0],w[1],se,M[0],M[1],ve,c,f),Me=dT(M[0],M[1],ve,w[0],M[1],le,w[0],w[1],ie,c,f),Se=Math.min(xe!==null?xe:Number.MAX_VALUE,Me!==null?Me:Number.MAX_VALUE);if(Se!==Number.MAX_VALUE)return Se;{const Pe=te.vec3.scaleAndAdd([],c,f,C);if(_T(ie,se,le,ve,fT(Pe[0],w[0],M[0]),fT(Pe[1],w[1],M[1]))>=Pe[2])return C}continue}let V=0;for(let N=0;N<this._siblingOffset.length;N++){pT((O<<1)+this._siblingOffset[N][0],(k<<1)+this._siblingOffset[N][1],U+1,e,n,a,u,w,M),w[2]=-100,M[2]=this.maximums[this.childOffsets[E]+N]*y;const $=hT(w,M,c,f);if($!=null){const Z=$;S[N]=Z;let K=!1;for(let ae=0;ae<V&&!K;ae++)Z>=S[_[ae]]&&(_.splice(ae,0,N),K=!0);K||(_[V]=N),V++}}for(let N=0;N<V;N++){const $=_[N];T.push({idx:this.childOffsets[E]+$,t:S[$],nodex:(O<<1)+this._siblingOffset[$][0],nodey:(k<<1)+this._siblingOffset[$][1],depth:U+1})}}return null}_addNode(e,n,a){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,a,u,c){if(e[u].isLeaf(n,a)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const f=u-1,y=e[f];let b=0,S=0;for(let _=0;_<this._siblingOffset.length;_++){const w=2*n+this._siblingOffset[_][0],M=2*a+this._siblingOffset[_][1],T=y.getElevation(w,M),E=y.isLeaf(w,M),C=this._addNode(T.min,T.max,E);E&&(b|=1<<_),S||(S=C)}for(let _=0;_<this._siblingOffset.length;_++)b&1<<_||this._construct(e,2*n+this._siblingOffset[_][0],2*a+this._siblingOffset[_][1],f,S+_)}}function _T(o,e,n,a,u,c){return ar(ar(o,n,c),ar(e,a,c),u)}function rc(o,e,n){const a=n.dim,u=Ye(o*a-.5,0,a-1),c=Ye(e*a-.5,0,a-1),f=Math.floor(u),y=Math.floor(c),b=Math.min(f+1,a-1),S=Math.min(y+1,a-1);return _T(n.get(f,y),n.get(b,y),n.get(f,S),n.get(b,S),u-f,c-y)}const aD={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function lD(o,e,n){return(256*o*256+256*e+n)/10-1e4}function cD(o,e,n){return 256*o+e+n/256-32768}class Dg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,a,u=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Rr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const c=this.dim=n.height-2,f=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<c;b++)f[this._idx(-1,b)]=f[this._idx(0,b)],f[this._idx(c,b)]=f[this._idx(c-1,b)],f[this._idx(b,-1)]=f[this._idx(b,0)],f[this._idx(b,c)]=f[this._idx(b,c-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(c,-1)]=f[this._idx(c-1,0)],f[this._idx(-1,c)]=f[this._idx(0,c-1)],f[this._idx(c,c)]=f[this._idx(c-1,c-1)]}const y=a==="terrarium"?cD:lD;for(let b=0;b<f.length;++b){const S=4*b;this.floatView[b]=y(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=We.now()}_buildQuadTree(){this._tree=new mT(this)}get(e,n,a=!1){a&&(e=Ye(e,-1,this.dim),n=Ye(n,-1,this.dim));const u=this._idx(e,n);return this.floatView[u]}set(e,n,a){const u=this._idx(e,n),c=this.floatView[u];return this.floatView[u]=a,a-c}static getUnpackVector(e){return aD[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const a=[0,0,0,0],u=Dg.getUnpackVector(n);let c=Math.floor((e+u[3])/u[2]);return a[2]=c%256,c=Math.floor(c/256),a[1]=c%256,c=Math.floor(c/256),a[0]=c,a}getPixels(){return new Ab({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,c=n*this.dim+this.dim,f=a*this.dim,y=a*this.dim+this.dim;switch(n){case-1:u=c-1;break;case 1:c=u+1}switch(a){case-1:f=y-1;break;case 1:y=f+1}const b=-n*this.dim,S=-a*this.dim;for(let _=f;_<y;_++)for(let w=u;w<c;w++){const M=4*this._idx(w,_),T=4*this._idx(w+b,_+S);this.pixels[M+0]=e.pixels[T+0],this.pixels[M+1]=e.pixels[T+1],this.pixels[M+2]=e.pixels[T+2],this.pixels[M+3]=e.pixels[T+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function uD(o,e,n){o===1?e.headerLength=n.readFixed32():o===2?e.x=n.readVarint():o===3?e.y=n.readVarint():o===4?e.z=n.readVarint():o===5&&e.layers.push(function(a,u){return a.readFields(mD,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)}(n,n.readVarint()+n.pos))}function hD(o,e,n){o===1?(e.delta_filter=function(a,u){return a.readFields(dD,{blockSize:0},u)}(n,n.readVarint()+n.pos),e.filter="delta_filter"):o===2?(n.readVarint(),e.filter="zigzag_filter"):o===3?(n.readVarint(),e.filter="bitshuffle_filter"):o===4&&(n.readVarint(),e.filter="byteshuffle_filter")}function dD(o,e,n){o===1&&(e.blockSize=n.readVarint())}function fD(o,e,n){o===1?(n.readVarint(),e.codec="gzip_data"):o===2?(n.readVarint(),e.codec="jpeg_image"):o===3?(n.readVarint(),e.codec="webp_image"):o===4&&(n.readVarint(),e.codec="png_image")}function pD(o,e,n){let a=0,u=0;o===1?e.firstByte=n.readFixed64():o===2?e.lastByte=n.readFixed64():o===3?e.filters.push(function(c,f){return c.readFields(hD,{},f)}(n,n.readVarint()+n.pos)):o===4?e.codec=function(c,f){return c.readFields(fD,{},f)}(n,n.readVarint()+n.pos):o===5?u=n.readFloat():o===6?a=n.readFloat():o===7?e.bands.push(n.readString()):o===8?e.offset=n.readDouble():o===9&&(e.scale=n.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=a)}function mD(o,e,n){o===1?e.version=n.readVarint():o===2?e.name=n.readString():o===3?e.units=n.readString():o===4?e.tileSize=n.readVarint():o===5?e.buffer=n.readVarint():o===6?e.pixelFormat=n.readVarint():o===7&&e.dataIndex.push(function(a,u){return a.readFields(pD,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(n,n.readVarint()+n.pos))}function _D(o,e,n){if(o===2)(function(a,u,c){a.readFields(gD,c,u)})(n,n.readVarint()+n.pos,e);else if(o===3)throw new Error("Not implemented")}function gD(o,e,n){if(o===1){let a=0;const u=n.readVarint()+n.pos;for(;n.pos<u;)e[a++]=n.readVarint()}}function yD(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let n=e[3];for(let a=2;a>=1;a--){const u=a===1?1:0,c=a===2?1:0;for(let f=0;f<e[0];f++){const y=e[1]*f;for(let b=u;b<e[1];b++){const S=e[2]*(b+y);for(let _=c;_<e[2];_++){const w=e[3]*(_+S);for(let M=0;M<e[3];M++){const T=w+M;o[T]+=o[T-n]}}}}n*=e[a]}return o}function vD(o){for(let e=0,n=o.length;e<n;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function xD(o,e){switch(e){case"uint32":return o;case"uint16":for(let n=0;n<o.length;n+=2){const a=o[n],u=o[n+1];o[n]=(240&a)>>4|(61440&a)>>8|(240&u)<<4|61440&u,o[n+1]=15&a|(3840&a)>>4|(15&u)<<8|(3840&u)<<4}return o;case"uint8":for(let n=0;n<o.length;n+=4){const a=o[n],u=o[n+1],c=o[n+2],f=o[n+3];o[n+0]=(192&a)>>6|(192&u)>>4|(192&c)>>2|192&f,o[n+1]=(48&a)>>4|(48&u)>>2|48&c|(48&f)<<2,o[n+2]=(12&a)>>2|12&u|(12&c)<<2|(12&f)<<4,o[n+3]=3&a|(3&u)<<2|(3&c)<<4|(3&f)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ft(Dg,"DEMData"),Ft(mT,"DemMinMaxQuadTree",{omit:["dem"]});var uo=Uint8Array,Gp=Uint16Array,bD=Int32Array,gT=new uo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),yT=new uo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),wD=new uo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),vT=function(o,e){for(var n=new Gp(31),a=0;a<31;++a)n[a]=e+=1<<o[a-1];var u=new bD(n[30]);for(a=1;a<30;++a)for(var c=n[a];c<n[a+1];++c)u[c]=c-n[a]<<5|a;return{b:n,r:u}},xT=vT(gT,2),bT=xT.b,TD=xT.r;bT[28]=258,TD[258]=28;for(var SD=vT(yT,0).b,wT=new Gp(32768),ui=0;ui<32768;++ui){var dd=(43690&ui)>>1|(21845&ui)<<1;wT[ui]=((65280&(dd=(61680&(dd=(52428&dd)>>2|(13107&dd)<<2))>>4|(3855&dd)<<4))>>8|(255&dd)<<8)>>1}var Hp=function(o,e,n){for(var a=o.length,u=0,c=new Gp(e);u<a;++u)o[u]&&++c[o[u]-1];var f,y=new Gp(e);for(u=1;u<e;++u)y[u]=y[u-1]+c[u-1]<<1;f=new Gp(1<<e);var b=15-e;for(u=0;u<a;++u)if(o[u])for(var S=u<<4|o[u],_=e-o[u],w=y[o[u]-1]++<<_,M=w|(1<<_)-1;w<=M;++w)f[wT[w]>>b]=S;return f},qp=new uo(288);for(ui=0;ui<144;++ui)qp[ui]=8;for(ui=144;ui<256;++ui)qp[ui]=9;for(ui=256;ui<280;++ui)qp[ui]=7;for(ui=280;ui<288;++ui)qp[ui]=8;var TT=new uo(32);for(ui=0;ui<32;++ui)TT[ui]=5;var ED=Hp(qp,9),AD=Hp(TT,5),Wv=function(o){for(var e=o[0],n=1;n<o.length;++n)o[n]>e&&(e=o[n]);return e},na=function(o,e,n){var a=e/8|0;return(o[a]|o[a+1]<<8)>>(7&e)&n},Zv=function(o,e){var n=e/8|0;return(o[n]|o[n+1]<<8|o[n+2]<<16)>>(7&e)},MD=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ia=function(o,e,n){var a=new Error(e||MD[o]);if(a.code=o,Error.captureStackTrace&&Error.captureStackTrace(a,ia),!n)throw a;return a},ID=new uo(0),CD=typeof TextDecoder<"u"&&new TextDecoder;try{CD.decode(ID,{stream:!0})}catch{}const PD={gzip_data:"gzip"};class Oo extends Error{constructor(e){super(e),this.name="MRTError"}}const RD={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},ST={uint32:1,uint16:2,uint8:4},DD={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Xv;class zg{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const n=this.layers[e];if(!n)throw new Oo(`Layer '${e}' not found`);return n}getHeaderLength(e){const n=new Uint8Array(e),a=new DataView(e);if(n[0]!==13)throw new Oo("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const n=new Uint8Array(e),a=this.getHeaderLength(e);if(n.length<a)throw new Oo(`Expected header with length >= ${a} but got buffer of length ${n.length}`);const u=function(c,f){return c.readFields(uD,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Xv(n.subarray(0,a)));if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Oo(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const c of u.layers)this.layers[c.name]=new ET(c,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const n=[],a=this.getLayer(e.layerName);for(let u of e.blockIndices){const c=a.dataIndex[u],f=c.firstByte-e.firstByte,y=c.lastByte-e.firstByte;if(a._blocksInProgress.has(u))continue;const b={layerName:a.name,firstByte:f,lastByte:y,pixelFormat:a.pixelFormat,blockIndex:u,blockShape:[c.bands.length].concat(a.bandShape),buffer:a.buffer,codec:c.codec.codec,filters:c.filters.map(S=>S.filter)};a._blocksInProgress.add(u),n.push(b)}return new AT(n,()=>{n.forEach(u=>a._blocksInProgress.delete(u.blockIndex))},(u,c)=>{if(n.forEach(f=>a._blocksInProgress.delete(f.blockIndex)),u)throw u;c.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class ET{constructor({version:e,name:n,units:a,tileSize:u,pixelFormat:c,buffer:f,dataIndex:y},b){if(this.version=e,this.version!==1)throw new Oo(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=n,this.units=a,this.tileSize=u,this.buffer=f,this.pixelFormat=RD[c],this.dataIndex=y,this.bandShape=[u+2*f,u+2*f,ST[this.pixelFormat]],this._decodedBlocks=new Rg(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return ST[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const n=e.blockIndex.toString();this._decodedBlocks.get(n)||this._decodedBlocks.put(n,e.data)}getBlockForBand(e){let n=0;switch(typeof e){case"string":for(const[a,u]of this.dataIndex.entries()){for(const[c,f]of u.bands.entries())if(f===e)return{bandIndex:n+c,blockIndex:a,blockBandIndex:c};n+=u.bands.length}break;case"number":for(const[a,u]of this.dataIndex.entries()){if(e>=n&&e<n+u.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-n};n+=u.bands.length}break;default:throw new Oo(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Oo(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let n=1/0,a=-1/0;const u=[],c=new Set;for(const f of e){const{blockIndex:y}=this.getBlockForBand(f);if(y<0)throw new Oo(`Invalid band: ${JSON.stringify(f)}`);const b=this.dataIndex[y];u.includes(y)||u.push(y),c.add(y),n=Math.min(n,b.firstByte),a=Math.max(a,b.lastByte)}if(c.size>this.cacheSize)throw new Oo(`Number of blocks to decode (${c.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:n,lastByte:a,blockIndices:u}}hasBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0}hasDataForBand(e){const{blockIndex:n}=this.getBlockForBand(e);return n>=0&&!!this._decodedBlocks.get(n.toString())}getBandView(e){const{blockIndex:n,blockBandIndex:a}=this.getBlockForBand(e),u=this._decodedBlocks.get(n.toString());if(!u)throw new Oo(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const c=this.dataIndex[n],f=this.bandShape.reduce((S,_)=>S*_,1),y=a*f,b=u.subarray(y,y+f);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:c.offset,scale:c.scale}}}zg.setPbf=function(o){Xv=o};class AT{constructor(e,n,a){this.tasks=e,this._onCancel=n,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,n){this._finalized||(this._onComplete(e,n),this._finalized=!0)}}zg.performDecoding=function(o,e){const n=new Uint8Array(o);return Promise.all(e.tasks.map(a=>{const{layerName:u,firstByte:c,lastByte:f,pixelFormat:y,blockShape:b,blockIndex:S,filters:_,codec:w}=a,M=n.subarray(c,f+1),T=new Uint32Array(b[0]*b[1]*b[2]);let E;if(w!=="gzip_data")throw new Oo(`Unhandled codec: ${w}`);return E=function(C,O){if(!globalThis.DecompressionStream&&O==="gzip_data")return Promise.resolve(((N=function(K){K[0]==31&&K[1]==139&&K[2]==8||ia(6,"invalid gzip data");var ae=K[3],ie=10;4&ae&&(ie+=2+(K[10]|K[11]<<8));for(var se=(ae>>3&1)+(ae>>4&1);se>0;se-=!K[ie++]);return ie+(2&ae)}(V=C))+8>V.length&&ia(6,"invalid gzip data"),function(K,ae,ie,se){var ve=K.length;if(!ve||ae.f&&!ae.l)return ie||new uo(0);var le=!ie,xe=le||ae.i!=2,Me=ae.i;le&&(ie=new uo(3*ve));var Se,Pe,Ce=function(ic){var sc=ie.length;if(ic>sc){var xu=new uo(Math.max(2*sc,ic));xu.set(ie),ie=xu}},Fe=ae.f||0,Le=ae.p||0,Ne=ae.b||0,ot=ae.l,it=ae.d,Bt=ae.m,_t=ae.n,At=8*ve;do{if(!ot){Fe=na(K,Le,1);var ct=na(K,Le+1,3);if(Le+=3,!ct){var rr=K[(_r=4+((Le+7)/8|0))-4]|K[_r-3]<<8,Ot=_r+rr;if(Ot>ve){Me&&ia(0);break}xe&&Ce(Ne+rr),ie.set(K.subarray(_r,Ot),Ne),ae.b=Ne+=rr,ae.p=Le=8*Ot,ae.f=Fe;continue}if(ct==1)ot=ED,it=AD,Bt=9,_t=5;else if(ct==2){var qt=na(K,Le,31)+257,dr=na(K,Le+10,15)+4,Ir=qt+na(K,Le+5,31)+1;Le+=14;for(var yr=new uo(Ir),Lr=new uo(19),Er=0;Er<dr;++Er)Lr[wD[Er]]=na(K,Le+3*Er,7);Le+=3*dr;var Fr=Wv(Lr),Yr=(1<<Fr)-1,wn=Hp(Lr,Fr);for(Er=0;Er<Ir;){var _r,$r=wn[na(K,Le,Yr)];if(Le+=15&$r,(_r=$r>>4)<16)yr[Er++]=_r;else{var Dn=0,Nn=0;for(_r==16?(Nn=3+na(K,Le,3),Le+=2,Dn=yr[Er-1]):_r==17?(Nn=3+na(K,Le,7),Le+=3):_r==18&&(Nn=11+na(K,Le,127),Le+=7);Nn--;)yr[Er++]=Dn}}var Zn=yr.subarray(0,qt),Xn=yr.subarray(qt);Bt=Wv(Zn),_t=Wv(Xn),ot=Hp(Zn,Bt),it=Hp(Xn,_t)}else ia(1);if(Le>At){Me&&ia(0);break}}xe&&Ce(Ne+131072);for(var gn=(1<<Bt)-1,yi=(1<<_t)-1,ns=Le;;ns=Le){var oi=(Dn=ot[Zv(K,Le)&gn])>>4;if((Le+=15&Dn)>At){Me&&ia(0);break}if(Dn||ia(2),oi<256)ie[Ne++]=oi;else{if(oi==256){ns=Le,ot=null;break}var hi=oi-254;oi>264&&(hi=na(K,Le,(1<<(ho=gT[Er=oi-257]))-1)+bT[Er],Le+=ho);var Hi=it[Zv(K,Le)&yi],Pi=Hi>>4;if(Hi||ia(3),Le+=15&Hi,Xn=SD[Pi],Pi>3){var ho=yT[Pi];Xn+=Zv(K,Le)&(1<<ho)-1,Le+=ho}if(Le>At){Me&&ia(0);break}xe&&Ce(Ne+131072);var nc=Ne+hi;if(Ne<Xn){var ko=0-Xn,oa=Math.min(Xn,nc);for(ko+Ne<0&&ia(3);Ne<oa;++Ne)ie[Ne]=(void 0)[ko+Ne]}for(;Ne<nc;++Ne)ie[Ne]=ie[Ne-Xn]}}ae.l=ot,ae.p=ns,ae.b=Ne,ae.f=Fe,ot&&(Fe=1,ae.m=Bt,ae.d=it,ae.n=_t)}while(!Fe);return Ne!=ie.length&&le?(Se=ie,((Pe=Ne)==null||Pe>Se.length)&&(Pe=Se.length),new uo(Se.subarray(0,Pe))):ie.subarray(0,Ne)}(V.subarray(N,-8),{i:2},new uo(((k=V)[(U=k.length)-4]|k[U-3]<<8|k[U-2]<<16|k[U-1]<<24)>>>0))));var k,U,V,N;const $=PD[O];if(!$)throw new Error(`Unhandled codec: ${O}`);const Z=new globalThis.DecompressionStream($);return new Response(new Blob([C]).stream().pipeThrough(Z)).arrayBuffer().then(K=>new Uint8Array(K))}(M,w).then(C=>(function(O,k){O.readFields(_D,k)}(new Xv(C),T),new DD[y](T.buffer))),E.then(C=>{for(let O=_.length-1;O>=0;O--)switch(_[O]){case"delta_filter":yD(C,b);break;case"zigzag_filter":vD(C);break;case"bitshuffle_filter":xD(C,y);break;default:throw new Oo(`Unhandled filter "${_[O]}"`)}return{layerName:u,blockIndex:S,data:C}}).catch(C=>{throw C})}))},Ft(AT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ft(zg,"MapboxRasterTile"),Ft(ET,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Wp,Kv,sa,fd,Yv,pd=null;function MT(){return Ga()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Kv||Y.DRACO_URL}function IT(){if(Ga()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(fd)return fd;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return fd=WebAssembly.validate(o)?Y.MESHOPT_SIMD_URL:Y.MESHOPT_URL,fd}const Lg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},zD={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Zp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function CT(o,e,n){const a=n.json.bufferViews.length,u=n.buffers.length;e.bufferView=a,n.json.bufferViews[a]={buffer:u,byteLength:o.byteLength},n.buffers[u]=o}const Jv="KHR_draco_mesh_compression";function LD(o,e){const n=o.extensions&&o.extensions[Jv];if(!n)return;const a=new sa.Decoder,u=zT(e,n.bufferView),c=new sa.Mesh;if(!a.DecodeArrayToMesh(u,u.byteLength,c))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[o.indices],y=Lg[f.componentType],b=f.count*y.BYTES_PER_ELEMENT,S=sa._malloc(b);y===Uint16Array?a.GetTrianglesUInt16Array(c,b,S):a.GetTrianglesUInt32Array(c,b,S),CT(sa.memory.buffer.slice(S,S+b),f,e),sa._free(S);for(const _ of Object.keys(n.attributes)){const w=a.GetAttributeByUniqueId(c,n.attributes[_]),M=e.json.accessors[o.attributes[_]],T=zD[M.componentType],E=M.count*Zp[M.type]*Lg[M.componentType].BYTES_PER_ELEMENT,C=sa._malloc(E);a.GetAttributeDataArrayForAllPoints(c,w,sa[T],E,C),CT(sa.memory.buffer.slice(C,C+E),M,e),sa._free(C)}a.destroy(),c.destroy(),delete o.extensions[Jv]}const Og="EXT_meshopt_compression";function OD(o,e){if(!o.extensions||!o.extensions[Og])return;const n=o.extensions[Og],a=new Uint8Array(e.buffers[n.buffer],n.byteOffset||0,n.byteLength||0),u=new Uint8Array(n.count*n.byteStride);Yv.decodeGltfBuffer(u,n.count,n.byteStride,a,n.mode,n.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=u.buffer,delete o.extensions[Og]}const PT=1179937895,RT=new TextDecoder("utf8");function DT(o,e){return new URL(o,e).href}function kD(o,e,n,a){return fetch(DT(o.uri,a)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[n]=u})}function zT(o,e){const n=o.json.bufferViews[e];return new Uint8Array(o.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function FD(o,e,n,a){if(o.uri){const u=DT(o.uri,a);return fetch(u).then(c=>c.blob()).then(c=>createImageBitmap(c)).then(c=>{e.images[n]=c})}if(o.bufferView!==void 0){const u=zT(e,o.bufferView),c=new Blob([u],{type:o.mimeType});return createImageBitmap(c).then(f=>{e.images[n]=f})}}function LT(o,e=0,n){const a={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===PT){const _=new Uint32Array(o,e);let w=2;const M=(_[w++]>>2)-3,T=_[w++]>>2;if(w++,a.json=JSON.parse(RT.decode(_.subarray(w,w+T))),w+=T,w<M){const E=_[w++];w++;const C=e+(w<<2);a.buffers[0]=o.slice(C,C+E)}}else a.json=JSON.parse(RT.decode(new Uint8Array(o,e)));const{buffers:u,images:c,meshes:f,extensionsUsed:y,bufferViews:b}=a.json;let S=Promise.resolve();if(u){const _=[];for(let w=0;w<u.length;w++){const M=u[w];M.uri?_.push(kD(M,a,w,n)):a.buffers[w]||(a.buffers[w]=null)}S=Promise.all(_)}return S.then(()=>{const _=[],w=y&&y.includes(Jv),M=y&&y.includes(Og);if(w&&_.push(function(){if(!sa)return Wp??(Wp=function(T){let E,C=null;function O(){E=new Uint8Array(C.buffer)}function k(){throw new Error("Unexpected Draco error.")}const U={a:{a:k,d:function(V,N,$){return E.copyWithin(V,N,N+$)},c:function(V){const N=E.length,$=Math.max(V>>>0,Math.ceil(1.2*N)),Z=Math.ceil(($-N)/65536);try{return C.grow(Z),O(),!0}catch{return!1}},b:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(T,U):T.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,U))).then(V=>{const{Rb:N,Qb:$,P:Z,T:K,X:ae,Ja:ie,La:se,Qa:ve,Va:le,Wa:xe,eb:Me,jb:Se,f:Pe,e:Ce,yb:Fe,zb:Le,Ab:Ne,Bb:ot,Db:it,Gb:Bt}=V.instance.exports;C=Ce;const _t=(()=>{let At=0,ct=0,rr=0,Ot=0;return qt=>{rr&&(N(Ot),N(At),ct+=rr,rr=At=0),At||(ct+=128,At=$(ct));const dr=qt.length+7&-8;let Ir=At;dr>=ct&&(rr=dr,Ir=Ot=$(dr));for(let yr=0;yr<qt.length;yr++)E[Ir+yr]=qt[yr];return Ir}})();return O(),Pe(),{memory:Ce,_free:N,_malloc:$,Mesh:class{constructor(){this.ptr=Z()}destroy(){K(this.ptr)}},Decoder:class{constructor(){this.ptr=ie()}destroy(){Se(this.ptr)}DecodeArrayToMesh(At,ct,rr){const Ot=_t(At),qt=se(this.ptr,Ot,ct,rr.ptr);return!!ae(qt)}GetAttributeByUniqueId(At,ct){return{ptr:ve(this.ptr,At.ptr,ct)}}GetTrianglesUInt16Array(At,ct,rr){le(this.ptr,At.ptr,ct,rr)}GetTrianglesUInt32Array(At,ct,rr){xe(this.ptr,At.ptr,ct,rr)}GetAttributeDataArrayForAllPoints(At,ct,rr,Ot,qt){Me(this.ptr,At.ptr,ct.ptr,rr,Ot,qt)}},DT_INT8:Fe(),DT_UINT8:Le(),DT_INT16:Ne(),DT_UINT16:ot(),DT_UINT32:it(),DT_FLOAT32:Bt()}})}(fetch(MT())),Wp.then(T=>{sa=T,Wp=void 0}))}()),M&&_.push(function(){if(Yv)return;const T=function(E){let C;const O=WebAssembly.instantiateStreaming(E,{}).then(V=>{C=V.instance,C.exports.__wasm_call_ctors()}),k={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},U={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:O,supported:!0,decodeGltfBuffer(V,N,$,Z,K,ae){(function(ie,se,ve,le,xe,Me,Se){const Pe=ie.exports.sbrk,Ce=le+3&-4,Fe=Pe(Ce*xe),Le=Pe(Me.length),Ne=new Uint8Array(ie.exports.memory.buffer);Ne.set(Me,Le);const ot=se(Fe,le,xe,Le,Me.length);if(ot===0&&Se&&Se(Fe,Ce,xe),ve.set(Ne.subarray(Fe,Fe+le*xe)),Pe(Fe-Pe(0)),ot!==0)throw new Error(`Malformed buffer data: ${ot}`)})(C,C.exports[U[K]],V,N,$,Z,C.exports[k[ae]])}}}(fetch(IT()));return T.ready.then(()=>{Yv=T})}()),c)for(let T=0;T<c.length;T++)_.push(FD(c[T],a,T,n));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(w&&f)for(const{primitives:T}of f)for(const E of T)LD(E,a);if(M&&f&&b)for(const T of b)OD(T,a);return a})})}function vu(o,e){const n=o.json.bufferViews[e.bufferView],a=Lg[e.componentType];return new a(o.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*(n.byteStride&&n.byteStride!==Zp[e.type]*a.BYTES_PER_ELEMENT?n.byteStride/a.BYTES_PER_ELEMENT:Zp[e.type]))}function Qv(o,e,n,a){const u=Lg[e.componentType],c=function(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),f=o.json.bufferViews[e.bufferView],y=f.byteStride?f.byteStride/u.BYTES_PER_ELEMENT:Zp[e.type],b=n.float32,S=b.length/n.capacity;for(let _=0,w=0;_<e.count*y;_+=y,w+=S)for(let M=0;M<S;M++)b[w+M]=a[_+M]*c;n._trim()}function BD(o,e,n){const a=o.indices,u=o.attributes,c={};c.indexArray=new wi;const f=e.json.accessors[a],y=f.count/3;c.indexArray.reserve(y);const b=vu(e,f);for(let M=0;M<y;M++)c.indexArray.emplaceBack(b[3*M],b[3*M+1],b[3*M+2]);c.indexArray._trim(),c.vertexArray=new Po;const S=e.json.accessors[u.POSITION];c.vertexArray.reserve(S.count);const _=vu(e,S);for(let M=0;M<S.count;M++)c.vertexArray.emplaceBack(_[3*M],_[3*M+1],_[3*M+2]);if(c.vertexArray._trim(),c.aabb=new or(S.min,S.max),c.centroid=function(M,T){const E=[0,0,0],C=M.length;if(C>0){for(let O=0;O<C;O++){const k=3*M[O];E[0]+=T[k],E[1]+=T[k+1],E[2]+=T[k+2]}E[0]/=C,E[1]/=C,E[2]/=C}return E}(b,_),u.COLOR_0!==void 0){const M=e.json.accessors[u.COLOR_0],T=Zp[M.type],E=vu(e,M);c.colorArray=T===3?new Po:new al,c.colorArray.resize(M.count),Qv(e,M,c.colorArray,E)}if(u.NORMAL!==void 0){c.normalArray=new Po;const M=e.json.accessors[u.NORMAL];c.normalArray.resize(M.count);const T=vu(e,M);Qv(e,M,c.normalArray,T)}if(u.TEXCOORD_0!==void 0&&n.length>0){c.texcoordArray=new Ia;const M=e.json.accessors[u.TEXCOORD_0];c.texcoordArray.resize(M.count);const T=vu(e,M);Qv(e,M,c.texcoordArray,T)}if(u._FEATURE_ID_RGBA4444!==void 0){const M=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(c.featureData=vu(e,M))}u._FEATURE_RGBA4444!==void 0&&(c.featureData=new Uint32Array(vu(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const w=o.material;return c.material=function(M,T){const{emissiveFactor:E=[0,0,0],alphaMode:C="OPAQUE",alphaCutoff:O=.5,normalTexture:k,occlusionTexture:U,emissiveTexture:V,doubleSided:N}=M,{baseColorFactor:$=[1,1,1,1],metallicFactor:Z=1,roughnessFactor:K=1,baseColorTexture:ae,metallicRoughnessTexture:ie}=M.pbrMetallicRoughness||{},se=U?T[U.index]:void 0;if(U&&U.extensions&&U.extensions.KHR_texture_transform&&se){const ve=U.extensions.KHR_texture_transform;se.offsetScale=[ve.offset[0],ve.offset[1],ve.scale[0],ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new nn(...$),metallicFactor:Z,roughnessFactor:K,baseColorTexture:ae?T[ae.index]:void 0,metallicRoughnessTexture:ie?T[ie.index]:void 0},doubleSided:N,emissiveFactor:E,alphaMode:C,alphaCutoff:O,normalTexture:k?T[k.index]:void 0,occlusionTexture:se,emissionTexture:V?T[V.index]:void 0,defined:M.defined===void 0}}(w!==void 0?e.json.materials[w]:{defined:!1},n),c}function OT(o,e,n){const{matrix:a,rotation:u,translation:c,scale:f,mesh:y,extras:b,children:S}=o,_={};if(_.matrix=a||te.mat4.fromRotationTranslationScale([],u||[0,0,0,1],c||[0,0,0],f||[1,1,1]),y!==void 0){_.meshes=n[y];const w=_.anchor=[0,0];for(const M of _.meshes){const{min:T,max:E}=M.aabb;w[0]+=T[0]+E[0],w[1]+=T[1]+E[1]}w[0]=Math.floor(w[0]/_.meshes.length/2),w[1]=Math.floor(w[1]/_.meshes.length/2)}if(b&&(b.id&&(_.id=b.id),b.lights&&(_.lights=function(w){if(!w.length)return[];const M=function(k){const U=atob(k),V=new Uint8Array(U.length);for(let N=0;N<U.length;N++)V[N]=U.codePointAt(N);return V}(w),T=[],E=M.length/24,C=new Uint16Array(M.buffer),O=new Float32Array(M.buffer);for(let k=0;k<E;k++){const U=C[2*k*6]/30,V=C[2*k*6+1]/30,N=C[2*k*6+10]/100,$=O[6*k+1],Z=O[6*k+2],K=O[6*k+3],ae=O[6*k+4],ie=K-$,se=ae-Z,ve=Math.hypot(ie,se);T.push({pos:[$+.5*ie,Z+.5*se,V],normal:[se/ve,-ie/ve,0],width:ve,height:U,depth:N,points:[$,Z,K,ae]})}return T}(b.lights))),S){const w=[];for(const M of S)w.push(OT(e.json.nodes[M],e,n));_.children=w}return _}function ND(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new ov(o.vertices,o.indices,8,256),[n,a]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:n,max:a}}function VD(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;const a=[];for(const f of n){if(!Array.isArray(f)||f.length!==2)continue;const y=f[0],b=f[1];typeof y=="number"&&typeof b=="number"&&a.push(new Ae(y,b))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let u=0;for(let f=0;f<a.length;f++){const y=a[f],b=a[(f+1)%a.length],S=a[(f+2)%a.length];u+=(y.x-b.x)*(S.y-b.y)-(S.x-b.x)*(y.y-b.y)}u>0&&a.reverse();const c=xp(a.flatMap(f=>[f.x,f.y]),[]);return c.length===0?null:{vertices:a,indices:c}}function UD(o,e){const n=[],a=[];let u=0;const c=[];for(const f of o){u=n.length;const y=f.vertexArray.float32,b=f.indexArray.uint16;for(let S=0;S<f.vertexArray.length;S++)c[0]=y[3*S+0],c[1]=y[3*S+1],c[2]=y[3*S+2],te.vec3.transformMat4(c,c,e),n.push(new Ae(c[0],c[1]));for(let S=0;S<3*f.indexArray.length;S++)a.push(b[S]+u)}if(a.length%3!=0)return null;for(let f=0;f<a.length;f+=3){const y=n[a[f+0]],b=n[a[f+1]],S=n[a[f+2]];(y.x-b.x)*(S.y-b.y)-(S.x-b.x)*(y.y-b.y)>0&&([a[f+1],a[f+2]]=[a[f+2],a[f+1]])}return{vertices:n,indices:a}}function kT(o){const e=function(b,S){const _=[],w=WebGL2RenderingContext;if(b.json.textures)for(const M of b.json.textures){const T={magFilter:w.LINEAR,minFilter:w.NEAREST,wrapS:w.REPEAT,wrapT:w.REPEAT};M.sampler!==void 0&&Object.assign(T,b.json.samplers[M.sampler]),_.push({image:S[M.source],sampler:T,uploaded:!1})}return _}(o,o.images),n=function(b,S){const _=[];for(const w of b.json.meshes){const M=[];for(const T of w.primitives)M.push(BD(T,b,S));_.push(M)}return _}(o,e),{scenes:a,scene:u,nodes:c}=o.json,f=a?a[u||0].nodes:c,y=[];for(const b of f)y.push(OT(c[b],o,n));return function(b,S,_){const w={},M=new Set;for(let T=0;T<b.length;T++){const E=_[S[T]];if(!E.extras)continue;const C=E.extras["mapbox:footprint:version"],O=E.extras["mapbox:footprint:id"];(C||O)&&M.add(T),C==="1.0.0"&&O&&(w[O]=T)}for(let T=0;T<b.length;T++){if(M.has(T))continue;const E=b[T],C=_[S[T]];if(!C.extras)continue;let O=null;E.id in w&&(O=UD(b[w[E.id]].meshes,E.matrix)),O||(O=VD(C)),O&&(E.footprint=ND(O))}if(M.size>0){const T=Array.from(M.values()).sort((E,C)=>E-C);for(let E=T.length-1;E>=0;E--)b.splice(T[E],1)}}(y,f,o.json.nodes),y}function jD(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,n=o.aabb.min[0]-1,a=o.aabb.min[1]-1,u=_u/(o.aabb.max[0]-n+2),c=_u/(o.aabb.max[1]-a+2);for(let f=0;f<e.length;f+=3){const y=e[f+2],b=(e[f+0]-n)*u|0,S=(e[f+1]-a)*c|0;y>o.heightmap[S*_u+b]&&(o.heightmap[S*_u+b]=y)}}function $D(o,e){const n={};n.indexArray=new wi,n.indexArray.reserve(4*o.length),n.vertexArray=new Po,n.vertexArray.reserve(10*o.length),n.colorArray=new al,n.vertexArray.reserve(10*o.length);let a=0;for(const f of o){const y=Math.min(10,Math.max(4,1.3*f.height))*e,b=[-f.normal[1],f.normal[0],0],S=Math.min(.29,.1*f.width/f.depth),_=f.width-2*f.depth*e*(S+.01),w=te.vec3.scaleAndAdd([],f.pos,b,_/2),M=te.vec3.scaleAndAdd([],f.pos,b,-_/2),T=[w[0],w[1],w[2]+f.height],E=[M[0],M[1],M[2]+f.height],C=te.vec3.scaleAndAdd([],f.normal,b,S);te.vec3.scale(C,C,y);const O=te.vec3.scaleAndAdd([],f.normal,b,-S);te.vec3.scale(O,O,y),te.vec3.add(C,w,C),te.vec3.add(O,M,O),w[2]+=.1,M[2]+=.1,n.vertexArray.emplaceBack(C[0],C[1],C[2]),n.vertexArray.emplaceBack(O[0],O[1],O[2]),n.vertexArray.emplaceBack(w[0],w[1],w[2]),n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(E[0],E[1],E[2]),n.vertexArray.emplaceBack(w[0],w[1],w[2]),n.vertexArray.emplaceBack(M[0],M[1],M[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]),n.vertexArray.emplaceBack(O[0],O[1],O[2]);const k=_/y/2;n.colorArray.emplaceBack(-k-S,-1,k,.8),n.colorArray.emplaceBack(k+S,-1,k,.8),n.colorArray.emplaceBack(-k,0,k,1.3),n.colorArray.emplaceBack(k,0,k,1.3),n.colorArray.emplaceBack(k+S,-.8,k,.7),n.colorArray.emplaceBack(k+S,-.8,k,.7),n.colorArray.emplaceBack(0,0,k,1.3),n.colorArray.emplaceBack(0,0,k,1.3),n.colorArray.emplaceBack(k+S,-1.2,k,.8),n.colorArray.emplaceBack(k+S,-1.2,k,.8),n.indexArray.emplaceBack(6+a,4+a,8+a),n.indexArray.emplaceBack(7+a,9+a,5+a),n.indexArray.emplaceBack(0+a,1+a,2+a),n.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const u={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=nn.white,u.pbrMetallicRoughness=c,n.material=u,n.aabb=new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}class FT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const a=e[n];this._stringToNumber[a]=n,this._numberToString[n]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const GD=["id","tile","layer","source","sourceLayer","state"];class md{constructor(e,n,a,u,c){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=a,this._y=u,this.properties=e.properties,this.id=c}clone(){const e=new md(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const n of GD)this[n]!==void 0&&(e[n]=this[n]);return e}}class BT{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Bl(Ct,16,0),this.featureIndexArray=new au,this.promoteId=n,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,n,a,u,c,f=0,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,c,f);const S=this.grid;for(let _=0;_<n.length;_++){const w=n[_],M=[1/0,1/0,-1/0,-1/0];for(let T=0;T<w.length;T++){const E=w[T];M[0]=Math.min(M[0],E.x),M[1]=Math.min(M[1],E.y),M[2]=Math.max(M[2],E.x),M[3]=Math.max(M[3],E.y)}y!==0&&(M[0]-=y,M[1]-=y,M[2]+=y,M[3]+=y),M[0]<Ct&&M[1]<Ct&&M[2]>=0&&M[3]>=0&&S.insert(b,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Yl.VectorTile(new rg(this.rawTileData)).layers,this.sourceLayerCoder=new FT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n){const{tilespaceGeometry:a,transform:u,tileTransform:c,pixelPosMatrix:f,availableImages:y}=n;this.loadVTLayers(),this.serializedLayersCache.clear();const b=a.bufferedTilespaceBounds,S=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(T,E,C,O)=>we(a.bufferedTilespaceGeometry,T,E,C,O));S.sort(HD);let _=null;u.elevation&&S.length>0&&(_=ld.create(u.elevation,this.tileID));const w={};let M;for(let T=0;T<S.length;T++){const E=S[T];if(E===M)continue;M=E;const C=this.featureIndexArray.get(E);let O=null;this.is3DTile?this.loadMatchingModelFeature(w,C,e,a,u):this.loadMatchingFeature(w,C,e,y,(k,U,V,N=0)=>(O||(O=L(k,this.tileID.canonical,c)),U.queryIntersectsFeature(a,k,V,O,this.z,u,f,_,N)))}return w}loadMatchingFeature(e,n,a,u,c){const{featureIndex:f,bucketIndex:y,sourceLayerIndex:b,layoutVertexArrayOffset:S}=n,_=this.bucketLayerIDs[y],w=a.layers,M=Object.keys(w);if(M.length&&!function(k,U){for(let V=0;V<k.length;V++)if(U.indexOf(k[V])>=0)return!0;return!1}(M,_))return;const T=a.sourceCache,E=this.sourceLayerCoder.decode(b),C=this.vtLayers[E].feature(f),O=this.getId(C,E);for(let k=0;k<_.length;k++){const U=_[k];if(!w[U])continue;const{styleLayer:V,targets:N}=w[U];let $={};O!==void 0&&($=T.getFeatureState(V.sourceLayer,O));const Z=!c||c(C,V,$,S);if(!Z)continue;const K=new md(C,this.z,this.x,this.y,O);K.tile=this.tileID.canonical,K.state=$;let ae=this.serializedLayersCache.get(U);ae||(ae=V.serialize(),ae.id=U,this.serializedLayersCache.set(U,ae)),K.source=ae.source,K.sourceLayer=ae["source-layer"],K.layer=jr({},ae),K.layer.paint=NT(ae.paint,V.paint,C,$,u),K.layer.layout=NT(ae.layout,V.layout,C,$,u);let ie=!1;for(const se of N){this.updateFeatureProperties(K,se);const{filter:ve}=se;if(ve){if(C.properties=K.properties,ve.needGeometry){const le=F(C,!0);if(!ve.filter(new bn(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!ve.filter(new bn(this.tileID.overscaledZ),C))continue}ie=!0,se.targetId&&this.addFeatureVariant(K,se)}ie&&this.appendToResult(e,U,f,K,Z)}}loadMatchingModelFeature(e,n,a,u,c){const f=this.bucketLayerIDs[0][0],y=a.layers;if(!y[f])return;const{styleLayer:b,targets:S}=y[f];if(b.type!=="model")return;const _=u.tile,w=n.featureIndex,M=_.getBucket(b);if(!(M&&M instanceof Sg))return;const T=function(ae,ie,se,ve){const le=ae.getNodesInfo()[ie];if(le.hiddenByReplacement||!le.node.meshes)return;let xe=Number.MAX_VALUE;const Me=le.node,Se=se.tile,Pe=ve.calculatePosMatrix(Se.tileID.toUnwrapped(),ve.worldSize),Ce=le.evaluatedScale;let Fe=0;ve.elevation&&Me.elevation&&(Fe=Me.elevation*ve.elevation.exaggeration()),te.mat4.translate(Pe,Pe,[(Me.anchor?Me.anchor[0]:0)*(Ce[0]-1),(Me.anchor?Me.anchor[1]:0)*(Ce[1]-1),Fe]),te.mat4.scale(Pe,Pe,Ce);const Le=se.queryGeometry,Ne=Le.isPointQuery()?Le.screenBounds:Le.screenGeometry,ot=function(Bt){const _t=te.mat4.multiply([],Pe,Bt.matrix);te.mat4.multiply(_t,ve.expandedFarZProjMatrix,_t);for(let At=0;At<Bt.meshes.length;++At){const ct=Bt.meshes[At];if(At===Bt.lightMeshIndex)continue;const rr=k2(Ne,ve,_t,ct.aabb);rr!=null&&(xe=Math.min(rr,xe))}if(Bt.children)for(const At of Bt.children)ot(At)};if(ot(Me),xe===Number.MAX_VALUE)return;const it=new Qr(0,0);return Z2(Se.tileID.canonical,it,le.node.anchor[0],le.node.anchor[1]),{intersectionZ:xe,position:it,feature:le.feature}}(M,w,u,c);if(!T)return;const{z:E,x:C,y:O}=_.tileID.canonical,{feature:k,intersectionZ:U,position:V}=T;let N={};k.id!==void 0&&(N=a.sourceCache.getFeatureState(b.sourceLayer,k.id));const $=new md({},E,C,O,k.id);$.tile=this.tileID.canonical,$.state=N,$.properties=k.properties,$.geometry={type:"Point",coordinates:[V.lng,V.lat]};let Z=this.serializedLayersCache.get(f);Z||(Z=b.serialize(),Z.id=f,this.serializedLayersCache.set(f,Z)),$.source=Z.source,$.sourceLayer=Z["source-layer"],$.layer=jr({},Z);let K=!1;for(const ae of S){this.updateFeatureProperties($,ae);const{filter:ie}=ae;if(ie){if(k.properties=$.properties,ie.needGeometry){if(!ie.filter(new bn(this.tileID.overscaledZ),k,this.tileID.canonical))continue}else if(!ie.filter(new bn(this.tileID.overscaledZ),k))continue}K=!0,ae.targetId&&this.addFeatureVariant($,ae)}K&&this.appendToResult(e,f,w,$,U)}updateFeatureProperties(e,n,a){if(n.properties){const u={};for(const c in n.properties){const f=n.properties[c].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);f!=null&&(u[c]=f)}e.properties=u}}addFeatureVariant(e,n,a){const u={target:n.target,namespace:n.namespace,uniqueFeatureID:n.uniqueFeatureID};n.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[n.targetId]=e.variants[n.targetId]||[],e.variants[n.targetId].push(u)}appendToResult(e,n,a,u,c){let f=e[n];f===void 0&&(f=e[n]=[]),f.push({featureIndex:a,feature:u,intersectionZ:c})}lookupSymbolFeatures(e,n,a,u,c){const f={};this.loadVTLayers();for(const y of e)this.loadMatchingFeature(f,{bucketIndex:n,sourceLayerIndex:a,featureIndex:y,layoutVertexArrayOffset:0},u,c);return f}loadFeature(e){const{featureIndex:n,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),c=this.vtFeatures[u];if(c[n])return c[n];const f=this.vtLayers[u].feature(n);return c[n]=f,f}hasLayer(e){for(const n of this.bucketLayerIDs)for(const a of n)if(e===a)return!0;return!1}getId(e,n){let a=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[n];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const c=Ol(u);if(c.result!=="success"){const f=c.value.map(y=>`${y.key}: ${y.message}`).join(", ");return void Rr(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=c.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Uc),a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[u];typeof a=="boolean"&&(a=Number(a))}return a}}function NT(o,e,n,a,u){return xs(o,(c,f)=>{const y=e instanceof Ul?e.get(f):null;return y&&y.evaluate?y.evaluate(n,a,u):y})}function HD(o,e){return e-o}Ft(BT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const VT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ex{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,a]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const c=VT[15&a];if(!c)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new ex(y,f,c,e)}constructor(e,n=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=VT.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=n,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return tx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:y}=this,b=[0,c.length-1,0],S=[];for(;b.length;){const _=b.pop()||0,w=b.pop()||0,M=b.pop()||0;if(w-M<=y){for(let O=M;O<=w;O++){const k=f[2*O],U=f[2*O+1];k>=e&&k<=a&&U>=n&&U<=u&&S.push(c[O])}continue}const T=M+w>>1,E=f[2*T],C=f[2*T+1];E>=e&&E<=a&&C>=n&&C<=u&&S.push(c[T]),(_===0?e<=E:n<=C)&&(b.push(M),b.push(T-1),b.push(1-_)),(_===0?a>=E:u>=C)&&(b.push(T+1),b.push(w),b.push(1-_))}return S}within(e,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:c,nodeSize:f}=this,y=[0,u.length-1,0],b=[],S=a*a;for(;y.length;){const _=y.pop()||0,w=y.pop()||0,M=y.pop()||0;if(w-M<=f){for(let O=M;O<=w;O++)jT(c[2*O],c[2*O+1],e,n)<=S&&b.push(u[O]);continue}const T=M+w>>1,E=c[2*T],C=c[2*T+1];jT(E,C,e,n)<=S&&b.push(u[T]),(_===0?e-a<=E:n-a<=C)&&(y.push(M),y.push(T-1),y.push(1-_)),(_===0?e+a>=E:n+a>=C)&&(y.push(T+1),y.push(w),y.push(1-_))}return b}}function tx(o,e,n,a,u,c){if(u-a<=n)return;const f=a+u>>1;UT(o,e,f,a,u,c),tx(o,e,n,a,f-1,1-c),tx(o,e,n,f+1,u,1-c)}function UT(o,e,n,a,u,c){for(;u>a;){if(u-a>600){const S=u-a+1,_=n-a+1,w=Math.log(S),M=.5*Math.exp(2*w/3),T=.5*Math.sqrt(w*M*(S-M)/S)*(_-S/2<0?-1:1);UT(o,e,n,Math.max(a,Math.floor(n-_*M/S+T)),Math.min(u,Math.floor(n+(S-_)*M/S+T)),c)}const f=e[2*n+c];let y=a,b=u;for(Xp(o,e,a,n),e[2*u+c]>f&&Xp(o,e,a,u);y<b;){for(Xp(o,e,y,b),y++,b--;e[2*y+c]<f;)y++;for(;e[2*b+c]>f;)b--}e[2*a+c]===f?Xp(o,e,a,b):(b++,Xp(o,e,b,u)),b<=n&&(a=b+1),n<=b&&(u=b-1)}}function Xp(o,e,n,a){rx(o,n,a),rx(e,2*n,2*a),rx(e,2*n+1,2*a+1)}function rx(o,e,n){const a=o[e];o[e]=o[n],o[n]=a}function jT(o,e,n,a){const u=o-n,c=e-a;return u*u+c*c}i.$=os,i.A=Eo,i.B=Ao,i.C=Ms,i.D=cd,i.E=ga,i.F=2,i.G=Rp,i.H=Xw,i.I=Ts,i.J=class extends wg{},i.K=Ya,i.L=Yu,i.M=R_,i.N=bh,i.O=Ll,i.P=Ae,i.Q=b_,i.R=mi,i.S=zf,i.T=zv,i.U=zh,i.V=wg,i.W=E_,i.X=Ol,i.Y=Wc,i.Z=Zo,i._=Rl,i.a=function(o){return Y.API_CDN_URL_REGEX.test(o)},i.a$=F,i.a0=of,i.a1=Gf,i.a2=wh,i.a3=x_,i.a4=function(o){const e=o.value;let n=[];if(!e)return n;const a=Ya(e);return a!=="string"?(n=n.concat([new wg(o.key,e,`string expected, "${a}" found`)]),n):(B2(e,!0)||(n=n.concat([new wg(o.key,e,`invalid url "${e}"`)])),n)},i.a5=Ue,i.a6=Dh,i.a7=$n,i.a8=Tt,i.a9=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return bs(o.expression.evaluate(e))}interpolate(o,e,n){return{x:ar(o.x,e.x,n),y:ar(o.y,e.y,n),z:ar(o.z,e.z,n),azimuthal:ar(o.azimuthal,e.azimuthal,n),polar:ar(o.polar,e.polar,n)}}},i.aA=function(o,e){const n={};for(let a=0;a<e.length;a++){const u=e[a];u in o&&(n[u]=o[u])}return n},i.aB=Da,i.aC=lo,i.aD=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,n,a){const u=this.entries[o]=this.entries[o]||{callbacks:[]};if(u.result){const[c,f]=u.result;return this.scheduler?this.scheduler.add(()=>{a(c,f)},e):a(c,f),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=n((c,f)=>{u.result=[c,f];for(const y of u.callbacks)this.scheduler?this.scheduler.add(()=>{y(c,f)},e):y(c,f);setTimeout(()=>delete this.entries[o],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(c=>c!==a),u.callbacks.length||(u.cancel(),delete this.entries[o]))}}},i.aE=function(o,e,n){const a=JSON.stringify(o.request);return o.data&&(this.deduped.entries[a]={result:[null,o.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},u=>{const c=qa(o.request,(f,y,b,S)=>{f?u(f):y&&u(null,{vectorTile:n?void 0:new Yl.VectorTile(new rg(y)),rawData:y,cacheControl:b,expires:S})});return()=>{c.cancel(),u()}},e)},i.aF=function(o){hn++,hn>Sr&&(o.getActor().send("enforceCacheSizeLimit",xr),hn=0)},i.aG=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},i.aH=St,i.aI=E2,i.aJ=R2,i.aK=S2,i.aL=function(o,e){const n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let a=0;a<o.length;a++){const u=document.createElement("source");Qd(o[a])||(n.crossOrigin="Anonymous"),u.src=o[a],n.appendChild(u)}return{cancel:()=>{}}},i.aM=gg,i.aN=function(o){return fetch(o).then(e=>e.arrayBuffer()).then(e=>LT(e,0,o))},i.aO=kT,i.aP=class{constructor(o,e,n,a){this.id=o,this.position=e!=null?new Qr(e[0],e[1]):new Qr(0,0),this.orientation=n??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(te.mat4.multiply(o.matrix,e,o.matrix),o.meshes)for(const n of o.meshes){const a=or.applyTransformFast(n.aabb,o.matrix);this.aabb.encapsulate(a)}if(o.children)for(const n of o.children)this._applyTransformations(n,o.matrix)}computeBoundsAndApplyParent(){const o=te.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,n,a,u,c,f=!1){$2(this.matrix,this,o.transform,this.position,e,n,a,u,c,f)}upload(o){if(!this.uploaded){for(const e of this.nodes)Bv(e,o);for(const e of this.nodes)Tg(e);this.uploaded=!0}}destroy(){for(const o of this.nodes)Nv(o)}},i.aQ=Ni,i.aR=zp,i.aS=ds,i.aT=Ci,i.aU=ol,i.aV=wi,i.aW=ri,i.aX=O_,i.aY=mg,i.aZ=function(){us.isLoading()||us.isLoaded()||$f()!=="deferred"||P_()},i.a_=Hf,i.aa=bn,i.ab=kl,i.ac=s,i.ad=te,i.ae=Qt,i.af=Ul,i.ag=Oi,i.ah=ar,i.ai=Ct,i.aj=Jm,i.ak=Dt,i.al=nn,i.am=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return function([n,a]){const u=bs([1,n,a]);return{x:u.x,y:u.y,z:u.z}}(o.expression.evaluate(e))}interpolate(o,e,n){return{x:ar(o.x,e.x,n),y:ar(o.y,e.y,n),z:ar(o.z,e.z,n)}}},i.an=function(o,e,n=0,a=!0){const u=new Ae(n,n),c=o.sub(u),f=e.add(u),y=[c,new Ae(f.x,c.y),f,new Ae(c.x,f.y)];return a&&y.push(c.clone()),y},i.ao=function(o,e){const n=[];for(let a=0;a<o.length;a++){const u=Gr(a-1,-1,o.length-1),c=Gr(a+1,-1,o.length-1),f=o[a],y=o[c],b=o[u].sub(f).unit(),S=y.sub(f).unit(),_=S.angleWithSep(b.x,b.y),w=b.add(S).unit().mult(-1*e/Math.sin(_/2));n.push(f.add(w))}return n},i.ap=u2,i.aq=we,i.ar=function(o,e,n=0){return te.vec3.fromValues(((e.x-n)*o.scale-o.x)*Ct,(e.y*o.scale-o.y)*Ct,_p(e.z,e.y))},i.as=Br,i.at=Sw,i.au=function(o){let e=1/0,n=1/0,a=-1/0,u=-1/0;for(const c of o)e=Math.min(e,c.x),n=Math.min(n,c.y),a=Math.max(a,c.x),u=Math.max(u,c.y);return{min:new Ae(e,n),max:new Ae(a,u)}},i.av=Ps,i.aw=me,i.ax=m,i.ay=Ye,i.az=Ii,i.b=function(o){return Y.API_FONTS_REGEX.test(o)},i.b$=xg,i.b0=md,i.b1=Ha,i.b2=dv,i.b3=sv,i.b4=L,i.b5=Co,i.b6=Gh,i.b7=mr,i.b8=Gn,i.b9=xp,i.bA=rw,i.bB=Tv,i.bC=n2,i.bD=xv,i.bE=ex,i.bF=Gr,i.bG=Tl,i.bH=Xi,i.bI=function(o,e,n){o[4*e+0]=n[0],o[4*e+1]=n[1],o[4*e+2]=n[2],o[4*e+3]=n[3]},i.bJ=ll,i.bK=Is,i.bL=Xh,i.bM=ei,i.bN=Zh,i.bO=Qr,i.bP=m2,i.bQ=ut,i.bR=gr,i.bS=z2,i.bT=$e,i.bU=rn,i.bV=function(o,e,n,a,u,c,f,y,b){if(b.name==="globe")return rn(o,e,new $e(n,a,u),!1);const S=zp({z:n,x:a,y:u},b);return new or([(c+S.x/S.scale)*e,e*(S.y/S.scale),f],[(c+S.x2/S.scale)*e,e*(S.y2/S.scale),y])},i.bW=function(o,e,n){let a=0;for(let u=0;u<2;++u)o[u]>0&&(a+=(o[u]-0)*(o[u]-0)),e[u]<0&&(a+=(0-e[u])*(0-e[u]));return a},i.bX=es,i.bY=fp,i.bZ=function(o){const e=te.mat4.identity(new Float64Array(16));te.mat4.multiply(e,o.pixelMatrix,o.globeMatrix);const n=[0,Cs,0],a=[0,Xs,0];return te.vec3.transformMat4(n,n,e),te.vec3.transformMat4(a,a,e),[n[0]>0&&n[0]<=o.width&&n[1]>0&&n[1]<=o.height&&!Lo(o,new Qr(o.center.lat,90)),a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!Lo(o,new Qr(o.center.lat,-90))]},i.b_=function(o,e){const{scale:n}=o.tileTransform,a=n*Ct/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return te.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},i.ba=Pv,i.bb=function(o,e){const n=Oi(e.zoom);if(n===0)return pi(o);const a=Rn(o),u=an(a),c=Ps(a.getWest())*e.worldSize,f=Ps(a.getEast())*e.worldSize,y=lo(a.getNorth())*e.worldSize,b=lo(a.getSouth())*e.worldSize,S=[c,y,0],_=[f,y,0],w=[c,b,0],M=[f,b,0],T=te.mat4.invert([],e.globeMatrix);return te.vec3.transformMat4(S,S,T),te.vec3.transformMat4(_,_,T),te.vec3.transformMat4(w,w,T),te.vec3.transformMat4(M,M,T),u[0]=Ti(u[0],w,n),u[1]=Ti(u[1],M,n),u[2]=Ti(u[2],_,n),u[3]=Ti(u[3],S,n),or.fromPoints(u)},i.bc=ci,i.bd=_n,i.be=Ti,i.bf=sl,i.bg=sr,i.bh=zg,i.bi=rg,i.bj=qa,i.bk=function(o,e){const n=[];for(const a in o)a in e||n.push(a);return n},i.bl=xn,i.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bn=wt,i.bo=function(o,e){const{x:n,y:a}=o.point,u=Jo(n,a,o.worldSize/o._pixelsPerMercatorPixel,0,0);return te.mat4.multiply(u,u,zo(pi(e)))},i.bp=td,i.bq=Ds,i.br=tg,i.bs=function(o,e,n,a,u){const c=5*e+2;o.float32[c+0]=n,o.float32[c+1]=a,o.float32[c+2]=u},i.bt=pg,i.bu=Zw,i.bv=q,i.bw=Fi,i.bx=Kb,i.by=F2,i.bz=tw,i.c=fe,i.c$=Iw,i.c0=D2,i.c1=function(o){const e=D2(o,!0);return te.mat2.invert([],[e[0],e[1],e[4],e[5]])},i.c2=on,i.c3=function(o){const{x:e,y:n}=o.point,{lng:a,lat:u}=o._center;return Jo(e,n,o.worldSize,a,u)},i.c4=jt,i.c5=Mt,i.c6=dp,i.c7=function(o){const e=Math.round((o+45+360)%360/90)%4;return Jt[e]},i.c8=45,i.c9=af,i.cA=cp,i.cB=class extends Do{constructor(o){super(o),this.current=j0}set(o,e,n){if(this.fetchUniformLocation(o,e)){for(let a=0;a<9;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},i.cC=Gt,i.cD=function(o,e,n){const a=Oi(n.zoom),u=o.style.map._antialias,c=o.terrain&&o.terrain.exaggeration()>0;return a===0&&!u&&!c},i.cE=function(o){const e=o.pixelsPerMeter,n=e/Xi(1,o.center.lat),a=te.mat4.identity(new Float64Array(16));return te.mat4.translate(a,a,[o.point.x,o.point.y,0]),te.mat4.scale(a,a,[n,n,e]),Float32Array.from(a)},i.cF=Rn,i.cG=function(o){const e=es-5;o=Ye(o,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Dt(o))),3);return Math.round(n*(pp.length-1))},i.cH=function(o,e,n,a){const u=e.getNorth(),c=e.getSouth(),f=e.getWest(),y=e.getEast(),b=1<<o.z,S=y-f,_=u-c,w=S/ul,M=-_/pp[n],T=[0,w,0,M,0,0,u,f,0];if(o.z>0){const E=180/a;te.mat3.multiply(T,T,[E/S+1,0,0,0,E/_+1,0,-.5*E/w,.5*E/M,1])}return T[2]=b,T[5]=o.x,T[8]=o.y,T},i.cI=pi,i.cJ=function(o,e,n){const a=te.mat4.identity(new Float64Array(16)),u=(e/(1<<o)-.5)*Math.PI*2;return te.mat4.rotateY(a,n.globeMatrix,u),Float32Array.from(a)},i.cK=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const n=e.getSource().maxzoom,a=1<<n,u=Math.floor(o.x),c=Math.floor((o.x-u)*a),f=Math.floor(o.y*a),y=this.findDEMTileFor(new St(n,u,n,c,f));return!(!y||!y.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||o.y<0||o.y>1)return e;const u=a.getSource().maxzoom,c=1<<u,f=Math.floor(o.x),y=o.x-f,b=new St(u,f,u,Math.floor(y*c),Math.floor(o.y*c)),S=this.findDEMTileFor(b);if(!S||!S.dem)return e;const _=S.dem,w=1<<S.tileID.canonical.z,M=(y*w-S.tileID.canonical.x)*_.dim,T=(o.y*w-S.tileID.canonical.y)*_.dim,E=Math.floor(M),C=Math.floor(T);return(n?this.exaggeration():1)*ar(ar(_.get(E,C),_.get(E,C+1),T-C),ar(_.get(E+1,C),_.get(E+1,C+1),T-C),M-E)}getAtTileOffset(o,e,n){const a=1<<o.canonical.z;return this.getAtPointOrZero(new s(o.wrap+(o.canonical.x+e/Ct)/a,(o.canonical.y+n/Ct)/a))}getAtTileOffsetFunc(o,e,n,a){return u=>{const c=this.getAtTileOffset(o,u.x,u.y),f=a.upVector(o.canonical,u.x,u.y),y=a.upVectorScale(o.canonical,e,n).metersToTile;return te.vec3.scale(f,f,c*y),f}}getForTilePoints(o,e,n,a){if(this.isUsingMockSource())return!1;const u=ld.create(this,o,a);return!!u&&(e.forEach(c=>{c[2]=this.exaggeration()*u.getElevationAt(c[0],c[1],n)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const n=e.dem.tree,a=e.tileID,u=1<<o.canonical.z-a.canonical.z;let c=o.canonical.x/u-a.canonical.x,f=o.canonical.y/u-a.canonical.y,y=0;for(let b=0;b<o.canonical.z-a.canonical.z&&!n.leaves[y];b++){c*=2,f*=2;const S=2*Math.floor(f)+Math.floor(c);y=n.childOffsets[y]+S,c%=1,f%=1}return{min:this.exaggeration()*n.minimums[y],max:this.exaggeration()*n.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const u of o){const c=this.getMinMaxForTile(u.tileID);c&&(n=Math.min(n,c.min),a=Math.max(a,c.max),e=!0)}return e?{min:n,max:a}:null}},i.cL=Ab,i.cM=en,i.cN=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},i.cO=Ks,i.cP=Xe,i.cQ=Lc,i.cR=256,i.cS=function(o,e){const n=[0,0,0],a=ci(pi(e.canonical));return te.vec3.transformMat4(n,n,a),te.vec3.transformMat4(n,n,o),n},i.cT=o=>({u_camera_to_center_distance:new ei(o),u_extrude_scale:new up(o),u_device_pixel_ratio:new ei(o),u_matrix:new ll(o),u_inv_rot_matrix:new ll(o),u_merc_center:new Is(o),u_tile_id:new Xh(o),u_zoom_transition:new ei(o),u_up_dir:new Xh(o),u_emissive_strength:new ei(o)}),i.cU=o=>({u_matrix:new ll(o),u_pixels_to_tile_units:new up(o),u_device_pixel_ratio:new ei(o),u_width_scale:new ei(o),u_floor_width_scale:new ei(o),u_units_to_pixels:new Is(o),u_dash_image:new Zh(o),u_gradient_image:new Zh(o),u_image_height:new ei(o),u_texsize:new Is(o),u_tile_units_to_pixels:new ei(o),u_alpha_discard_threshold:new ei(o),u_trim_offset:new Is(o),u_trim_fade_range:new Is(o),u_trim_color:new Kh(o),u_emissive_strength:new ei(o),u_zbias_factor:new ei(o),u_tile_to_meter:new ei(o)}),i.cV=o=>({u_matrix:new ll(o),u_texsize:new Is(o),u_pixels_to_tile_units:new up(o),u_device_pixel_ratio:new ei(o),u_width_scale:new ei(o),u_floor_width_scale:new ei(o),u_image:new Zh(o),u_units_to_pixels:new Is(o),u_tile_units_to_pixels:new ei(o),u_alpha_discard_threshold:new ei(o),u_trim_offset:new Is(o),u_trim_fade_range:new Is(o),u_trim_color:new Kh(o),u_emissive_strength:new ei(o),u_zbias_factor:new ei(o),u_tile_to_meter:new ei(o)}),i.cW=ep,i.cX=WP,i.cY=ZP,i.cZ=Jh,i.c_=(o,e,n,a,u,c)=>{const f=o.transform,y=f.projection.name==="globe";let b;if(c.paint.get("circle-pitch-alignment")==="map")if(y){const _=Ks(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;b=Float32Array.from([_,0,0,_])}else b=f.calculatePixelsToTileUnitsMatrix(n);else b=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(f.projection),u_matrix:o.translatePosMatrix(e.projMatrix,n,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:We.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:uu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(y){S.u_inv_rot_matrix=a,S.u_merc_center=u,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=Oi(f.zoom);const _=u[0]*Ct,w=u[1]*Ct;S.u_up_dir=f.projection.upVector(new $e(0,0,0),_,w)}return S},i.ca=cu,i.cb=Kh,i.cc=function(o,e,n){const a=Math.sqrt(o*o+e*e+n*n),u=a>0?Math.acos(n/a)*zt:0;let c=o!==0||e!==0?Math.atan2(-e,-o)*zt+90:0;return c<0&&(c+=360),[a,c,u]},i.cd=t,i.ce=or,i.cf=bs,i.cg=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},i.ch=function(o,e){return o.readFields(jR,{icons:[]},e)},i.ci=function(o){return o({pluginStatus:cs,pluginURL:oo}),Ch.on("pluginStateChange",o),o},i.cj=Eg,i.ck=id,i.cl=bv,i.cm=ma,i.cn=jf,i.co=Nt,i.cp=ro,i.cq=Jn,i.cr=function(o){const e=o.indexOf(kh);return e>=0?o.slice(0,e):o},i.cs=function(o){return o.indexOf(kh)>=0},i.ct=function(o){const e=o.indexOf(kh);return e>=0?o.slice(e+1):""},i.cu=function(o){const e=[],n=o.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},i.cv=function(o,e,n,a){return o.type==="custom"?new IR(o,e):new NR[o.type](o,e,n,a)},i.cw=wo,i.cx=class extends md{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},i.cy=Ch,i.cz=ws,i.d=function(o){return Y.API_TILEJSON_REGEX.test(o)},i.d$=FT,i.d0=Mi,i.d1=(o,e,n,a,u,c,f,y)=>{const b=o.transform,S=b.pitch<15?Ew(.07,.7,Ye((14-b.zoom)/5,0,1)):.07,_=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Mw(o,e,n,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:c,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:Aw(e,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(_?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:S,u_tile_to_meter:t(e.tileID.canonical,0)}},i.d2=(o,e,n,a,u,c,f,y,b)=>{const S=o.transform,_=S.calculatePixelsToTileUnitsMatrix(e),w=n.paint.get("line-trim-color-use-theme").constantOr("default")==="none",M=S.pitch<15?Ew(.07,.7,Ye((14-S.zoom)/5,0,1)):.07;return{u_matrix:Mw(o,e,n,a),u_pixels_to_tile_units:_,u_device_pixel_ratio:c,u_width_scale:f,u_floor_width_scale:y,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:Cw(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Aw(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:n.paint.get("line-trim-fade-range"),u_trim_color:n.paint.get("line-trim-color").toRenderColor(w?null:n.lut).toArray01(),u_emissive_strength:n.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:t(e.tileID.canonical,0)}},i.d3=Ji,i.d4=vp,i.d5=_p,i.d6=mw,i.d7=Lt,i.d8=eg,i.d9=Jl,i.dA=Y_,i.dB=Pr,i.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.dD=cr,i.dE=d,i.dF=Ra,i.dG=function([o,e,n]){const a=Math.hypot(o,e,n),u=Math.atan2(o,n),c=.5*Math.PI-Math.acos(-e/a);return new Qr(jt(u),jt(c))},i.dH=Ov,i.dI=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!function(n){if(zc==null){const a=n.navigator?n.navigator.userAgent:null;zc=!!n.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return zc}(o)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dJ=function(o,e){xr=o,Sr=e},i.dK=Lo,i.dL=Rs,i.dM=function(o){const e=[0,0,0],n=te.mat4.identity(new Float64Array(16));return te.mat4.multiply(n,o.pixelMatrix,o.globeMatrix),te.vec3.transformMat4(e,e,n),new Ae(e[0],e[1])},i.dN=function(o,e,n=!1){if(cs===Io||cs===Vf||cs===Uf)throw new Error("setRTLTextPlugin cannot be called multiple times.");oo=We.resolveURL(o),cs=Io,Ih=e,Nl(),n||P_()},i.dO=$f,i.dP=function(){Eg().acquire(Uv)},i.dQ=function(){const o=Up;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(Uv),Up=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dR=yu,i.dS=function(o){const e=jn();if(!e)return;const n=e.delete(Ut);o&&n.catch(o).then(()=>o())},i.dT=Vp,i.dU=MT,i.dV=function(o){Kv=We.resolveURL(o),pd||(pd=new cd(Eg(),new ga)),pd.broadcast("setDracoUrl",Kv)},i.dW=IT,i.dX=function(o){fd=We.resolveURL(o),pd||(pd=new cd(Eg(),new ga)),pd.broadcast("setMeshoptUrl",fd)},i.dY=Ft,i.dZ=Kl,i.d_=ra,i.da=450,i.db=7,i.dc=MR,i.dd=Jr,i.de=op,i.df=256,i.dg=zo,i.dh=Po,i.di=Ma,i.dj=rp,i.dk=function(o,e,n,a,u){return Ye((o-e)/(n-e)*(u-a)+a,a,u)},i.dl=y_,i.dm=Xl,i.dn=class{constructor(o,e,n,a){this.context=o,this.format=a,this.size=n,this.texture=o.gl.createTexture();const[u,c,f]=this.size,{gl:y}=o;y.bindTexture(y.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),y.texImage3D(y.TEXTURE_3D,0,this.format,u,c,f,0,Rv(this.format),Dv(this.format),e.data)}bind(o,e){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_3D,this.texture),o!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,o),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},i.dp=kv,i.dq=[1,1,1],i.dr=ld,i.ds=ad,i.dt=Aa,i.du=Ia,i.dv=Zl,i.dw=ip,i.dx=np,i.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ae(1/0,1/0),max:new Ae(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const n=Jb(new Ae(0,0),new Ae(Ct,Ct),o),a=[];if(e&&!av(n,this._globalClipBounds))return a;for(const u of this._activeRegions){if(u.hiddenByOverlap||!av(n,u))continue;const c=xP(u.min,u.max,o);a.push({min:c.min,max:c.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return a}setSources(o){this._setSources(o.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const n=[];for(const a of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(a).buckets[e.layer];u&&u.updateFootprints(a.toUnwrapped(),n)}return n},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const n=o.getOrder(),a=o.getClipMask(),u=o.getClipScope();for(const c of e){if(!c.footprint)continue;const f=Jb(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:n,clipMask:a,clipScope:u})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||J_(e.min,n.min)||J_(e.max,n.max)||e.order-n.order||e.clipMask-n.clipMask||function(a,u){const c=(f,y)=>f+y;return a.length-u.length||a.reduce(c,"").localeCompare(u.reduce(c,""))}(e.clipScope,n.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const n=this._activeRegions[e],a=this._prevRegions[e];o=n.priority!==a.priority||!Yb(n,a)||n.order!==a.order||n.clipMask!==a.clipMask||!wt(n.clipScope,a.clipScope),++e}}if(o){++this._updateTime;for(const n of this._activeRegions)n.order!==Y_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,n.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,n.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,n.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,n.max.y));const e=n=>{const a=this._activeRegions;if(n>=a.length)return n;const u=a[n].priority;for(;n<a.length&&a[n].priority===u;)++n;return n};if(this._sourceIds.length>1){let n=0,a=e(n);for(;n!==a;){let u=n;const c=n;for(;u!==a;){const f=this._activeRegions[u];f.hiddenByOverlap=!1;for(let y=0;y<c;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&f.order===Y_&&av(f,b)&&(f.hiddenByOverlap=ew(f.footprint,f.tileId,b.footprint,b.tileId),f.hiddenByOverlap))break}++u}n=a,a=e(n)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},i.dz=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const n=new Co,a=new wi,u=[],c=o+1+2,f=e[0]+1,y=e[0]+1+(1+e.length),b=(S,_,w)=>{let M=S===c-1?S-2:S===0?S:S-1;return M+=w?24575:0,[M,_]};for(let S=0;S<c;++S)n.emplaceBack(...b(S,0,!0));for(let S=0;S<f;++S)for(let _=0;_<c;++_)n.emplaceBack(...b(_,S,(_===0||_===c-1)&&!0));for(let S=0;S<e.length;++S){const _=e[S];for(let w=0;w<c;++w)n.emplaceBack(...b(w,_,!0))}for(let S=0;S<e.length;++S){const _=a.length,w=e[S]+1+2,M=new wi;for(let C=0;C<w-1;C++){const O=C===w-2,k=O?c*(y-e.length+S-C):c;for(let U=0;U<c-1;U++){const V=C*c+U;C===0||O||U===0||U===c-2?(M.emplaceBack(V+1,V,V+k),M.emplaceBack(V+k,V+k+1,V+1)):(a.emplaceBack(V+1,V,V+k),a.emplaceBack(V+k,V+k+1,V+1))}}const T=Gn.simpleSegment(0,_,n.length,a.length-_);for(let C=0;C<M.uint16.length;C+=3)a.emplaceBack(M.uint16[C],M.uint16[C+1],M.uint16[C+2]);const E=Gn.simpleSegment(0,_,n.length,a.length-_);u.push({withoutSkirts:T,withSkirts:E})}return{vertices:n,indices:a,segments:u}}_createGrid(o){const e=this._fillGridMeshWithLods(ul,pp);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,mr.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new wi;for(let f=0;f<=ul;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const n=new Ma,a=new Ma,u=new Ma,c=new Ma;this._poleSegments=[];for(let f=0,y=0;f<dp;f++){const b=360/(1<<f);n.emplaceBack(0,-Ii,0,.5,0),a.emplaceBack(0,-Ii,0,.5,1),u.emplaceBack(0,-Ii,0,.5,.5),c.emplaceBack(0,-Ii,0,.5,.5);for(let S=0;S<=ul;S++){let _=S/ul,w=0;const M=ar(0,b,_),[T,E,C]=Wl(Qo,yp,M,Ii);n.emplaceBack(T,E,C,_,w),a.emplaceBack(T,E,C,_,1-w);const O=Dt(M);_=.5+.5*Math.sin(O),w=.5+.5*Math.cos(O),u.emplaceBack(T,E,C,_,w),c.emplaceBack(T,E,C,_,1-w)}this._poleSegments.push(Gn.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(n,pr,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(a,pr,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(u,pr,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(c,pr,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},i.e=Y,i.e0=BT,i.e1=bw,i.e2=du,i.e3="hd_road_elevation",i.e4=class{static parseFrom(o,e){const n=hl.parse(o);if(!n)return[];let{vertices:a,features:u}=n;const c=1/t(e);u.sort((S,_)=>S.id-_.id),a.sort((S,_)=>S.id-_.id||S.idx-_.idx),a=a.filter((S,_,w)=>_===w.findIndex(M=>M.id===S.id&&M.idx===S.idx));const f=new Array;let y=0;const b=a.length;for(const S of u){if(S.constantHeight){f.push(new nv(S.id,S.bounds,S.constantHeight));continue}for(;y!==b&&a[y].id<S.id;)y++;if(y===b||a[y].id!==S.id)continue;const _=new Array,w=new Array,M=y;for(;y!==b&&a[y].id===S.id;){const T=a[y];if(_.push({position:T.position,height:T.height,extent:T.extent}),y!==M&&a[y-1].idx===T.idx-1){const E=y-M;w.push({a:E-1,b:E})}y++}f.push(new nv(S.id,S.bounds,void 0,_,w,c))}return f}},i.e5=xs,i.e6=fu,i.e7=Kw,i.e8=nd,i.e9=function(o,e,n,a,u,c,f,y=1,b){o.createArrays(),o.tilePixelRatio=Ct/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const S=o.layers[0].layout,_=o.layers[0]._unevaluatedLayout._values,w={};w.scaleFactor=y,w.textSizeScaleRange=S.get("text-size-scale-range"),w.iconSizeScaleRange=S.get("icon-size-scale-range");const[M,T]=w.textSizeScaleRange,[E,C]=w.iconSizeScaleRange;w.textScaleFactor=Ye(w.scaleFactor,M,T),w.iconScaleFactor=Ye(w.scaleFactor,E,C);const O=_["text-size"],k=_["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:K,maxZoom:ae}=o.textSizeData;w.compositeTextSizes=[O.possiblyEvaluate(new bn(K),c),O.possiblyEvaluate(new bn(ae),c)]}if(o.iconSizeData.kind==="composite"){const{minZoom:K,maxZoom:ae}=o.iconSizeData;w.compositeIconSizes=[k.possiblyEvaluate(new bn(K),c),k.possiblyEvaluate(new bn(ae),c)]}w.layoutTextSize=O.possiblyEvaluate(new bn(f+1),c),w.layoutIconSize=k.possiblyEvaluate(new bn(f+1),c),w.textMaxSize=O.possiblyEvaluate(new bn(18),c);const U=S.get("symbol-placement"),V=S.get("text-rotation-alignment")==="map"&&U!=="point",N=S.get("text-size");let $=!1;const Z=[];for(const K of o.features){const ae=S.get("text-font").evaluate(K,{},c).join(","),ie=N.evaluate(K,{},c)*w.textScaleFactor,se=w.layoutTextSize.evaluate(K,{},c)*w.textScaleFactor,ve=w.layoutIconSize.evaluate(K,{},c)*w.iconScaleFactor,le={horizontal:{},vertical:void 0},xe=K.text;let Me,Se=[0,0];if(xe){const ct=xe.toString(),rr=S.get("text-letter-spacing").evaluate(K,{},c)*Fi,Ot=S.get("text-line-height").evaluate(K,{},c)*Fi,qt=M_(ct)?rr:0,dr=S.get("text-anchor").evaluate(K,{},c),Ir=S.get("text-variable-anchor");if(!Ir){const Yr=S.get("text-radial-offset").evaluate(K,{},c);Se=Yr?n2(dr,[Yr*Fi,wv]):S.get("text-offset").evaluate(K,{},c).map(wn=>wn*Fi)}let yr=V?"center":S.get("text-justify").evaluate(K,{},c);const Lr=U==="point",Er=Lr?S.get("text-max-width").evaluate(K,{},c)*Fi:1/0,Fr=Yr=>{o.allowVerticalPlacement&&Ff(ct)&&(le.vertical=vv(xe,e,n,u,ae,Er,Ot,dr,Yr,qt,Se,Ds.vertical,!0,se,ie,b))};if(!V&&Ir){const Yr=yr==="auto"?Ir.map(_r=>Tv(_r)):[yr];let wn=!1;for(let _r=0;_r<Yr.length;_r++){const $r=Yr[_r];if(!le.horizontal[$r])if(wn)le.horizontal[$r]=le.horizontal[0];else{const Dn=vv(xe,e,n,u,ae,Er,Ot,"center",$r,qt,Se,Ds.horizontal,!1,se,ie,b);Dn&&(le.horizontal[$r]=Dn,wn=Dn.positionedLines.length===1)}}Fr("left")}else{if(yr==="auto"&&(yr=Tv(dr)),Lr||S.get("text-writing-mode").indexOf("horizontal")>=0||!Ff(ct)){const Yr=vv(xe,e,n,u,ae,Er,Ot,dr,yr,qt,Se,Ds.horizontal,!1,se,ie,b);Yr&&(le.horizontal[yr]=Yr)}Fr(Lr?"left":yr)}}let Pe,Ce,Fe,Le,Ne,ot=!1;if(K.icon&&K.icon.hasPrimary()){const ct=s2(K.icon,o.iconSizeData,_["icon-size"],c,o.zoom,K,b,w.iconScaleFactor);Pe=ct.iconPrimary,Ce=ct.iconSecondary;const rr=Pe.toString(),Ot=a.get(rr);Ot&&(Fe=S.get("icon-offset").evaluate(K,{},c),Le=S.get("icon-anchor").evaluate(K,{},c),Ne=S.get("icon-text-fit").evaluate(K,{},c),Me=sR(u.get(rr),Ce?u.get(Ce.toString()):void 0,Fe,Le),ot=Ot.sdf,o.sdfIcons===void 0?o.sdfIcons=Ot.sdf:o.sdfIcons!==Ot.sdf&&Rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ot.pixelRatio!==o.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}$=$||!(!K.icon||!K.icon.hasSecondary());const it=Sv(le.horizontal)||le.vertical;o.iconsInText||(o.iconsInText=!!it&&it.iconsInText);const Bt=se*w.textScaleFactor/Fi,{defaultShapedIcon:_t,verticallyShapedIcon:At}=fR(o,Me,S,K,c,le,Bt,Fe,Ne);Me=_t,Z.push({feature:K,shapedTextOrientations:le,shapedText:it,shapedIcon:Me,iconPrimary:Pe,iconSecondary:Ce,iconOffset:Fe,iconAnchor:Le,verticallyShapedIcon:At,layoutTextSize:se,layoutIconSize:ve,textOffset:Se,isSDFIcon:ot,iconTextFit:Ne})}return{featureData:Z,sizes:w,hasAnySecondaryIcon:$,textAlongLine:V,symbolPlacement:U}},i.ea=Yw,i.eb=function(o,e,n,a,u,c,f,y,b,S){const{featureData:_,hasAnySecondaryIcon:w,sizes:M,textAlongLine:T,symbolPlacement:E}=e;for(const C of _){const{shapedIcon:O,verticallyShapedIcon:k,feature:U,shapedTextOrientations:V,shapedText:N,layoutTextSize:$,textOffset:Z,isSDFIcon:K,iconPrimary:ae,iconSecondary:ie,iconTextFit:se,iconOffset:ve}=C;o2(O,S.iconPositions,ae,ie),o2(k,S.iconPositions,ae,ie),dR(V,S.iconPositions),(N||O)&&pR(o,U,V,O,k,b,M,$,0,Z,K,a,u,f,y,w,se,ve,T,E)}n&&o.generateCollisionDebugBuffers(c,o.collisionBoxArray,M.textScaleFactor)},i.ec=Yl,i.ed=Dg,i.ee=Ve,i.ef=Bb,i.eg=kw,i.eh=G,i.ei=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==PT){const n=new Uint32Array(o,0,7),[,,a,u,c,f]=n;e=n.byteLength+u+c+f+c,(a!==o.byteLength||e>=o.byteLength)&&Rr("Invalid b3dm header information.")}return LT(o,e)},i.ej=function(o,e){const n=kT(o);for(const a of n){for(const u of a.meshes)jD(u);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push($D(a.lights,e)))}return n},i.ek=Sg,i.el=X2,i.em=us,i.en=function(o){Or(),Mr!=null&&Mr.then(e=>{e.keys().then(n=>{for(let a=0;a<n.length-o;a++)e.delete(n[a])})})},i.f=function(o){return o.indexOf("mapbox:")===0},i.g=function(o,e){return ws(jr(o,{method:"GET"}),e)},i.h=re,i.i=function(o){return Y.API_STYLE_REGEX.test(o)&&!fe(o)},i.j=function(o){return decodeURIComponent(atob(o).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(e,n)=>String.fromCharCode(+("0x"+n))))},i.l=jr,i.m=cn,i.n=function(o,e){return ws(jr(o,{type:"json"}),e)},i.o=tf,i.p=function(o,e){return ws(jr(o,{method:"POST"}),e)},i.q=We,i.r=ki,i.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=Ke,i.u=function(){return function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()},i.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},i.w=Rr,i.x=function(){return jv||(jv=new yu),jv},i.y=qv,i.z=Ku}),R(["./shared"],function(i){function G(Xe){const Y=Xe?Xe.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function W(Xe){if(typeof Xe=="number"||typeof Xe=="boolean"||typeof Xe=="string"||Xe==null)return JSON.stringify(Xe);if(Array.isArray(Xe)){let re="[";for(const fe of Xe)re+=`${W(fe)},`;return`${re}]`}let Y="{";for(const re of Object.keys(Xe).sort())Y+=`${re}:${W(Xe[re])},`;return`${Y}}`}function H(Xe){let Y="";for(const re of i.bm)(Xe.type!=="model"||re!=="minzoom"&&re!=="maxzoom")&&(Y+=`/${W(Xe[re])}`);return Y}class ee{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,re){this._layerConfigs={},this._layers={},this.update(Y,[],re)}update(Y,re,fe){this._options=fe;for(const be of Y)this._layerConfigs[be.id]=be,(this._layers[be.id]=i.cv(be,this.scope,null,this._options)).compileFilter(fe),this.keyCache[be.id]&&delete this.keyCache[be.id];for(const be of re)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};const Te=function(be,Re){const Ge={};for(let qe=0;qe<be.length;qe++){const Ke=be[qe];let We=Re&&Re[Ke.id];!We&&(We=H(Ke),Ke.type==="line"&&Ke.paint)&&function Nt(Ut){return typeof Ut=="string"&&Ut==="line-progress"||(Array.isArray(Ut)?Ut.some(Nt):!(!Ut||typeof Ut!="object")&&Object.values(Ut).some(Nt))}(Ke.paint["line-width"])&&(We+=`/${W(Ke.paint["line-width"])}`),Re&&(Re[Ke.id]=We);let gt=Ge[We];gt||(gt=Ge[We]=[]),gt.push(Ke)}const De=[];for(const qe in Ge)De.push(Ge[qe]);return De}(Object.values(this._layerConfigs),this.keyCache);for(const be of Te){const Re=be.map(gt=>this._layers[gt.id]),Ge=Re[0];if(Ge.visibility==="none")continue;const De=Ge.source||"";let qe=this.familiesBySource[De];qe||(qe=this.familiesBySource[De]={});const Ke=Ge.sourceLayer||"_geojsonTileLayer";let We=qe[Ke];We||(We=qe[Ke]=[]),We.push(Re)}}}const ne=1*i.d_;class de{constructor(Y){const re={},fe=[];for(const Ge in Y){const De=Y[Ge],qe=re[Ge]={};for(const Ke in De.glyphs){const We=De.glyphs[+Ke];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const gt=We.metrics.localGlyph?ne:1,Nt={x:0,y:0,w:We.bitmap.width+2*gt,h:We.bitmap.height+2*gt};fe.push(Nt),qe[Ke]=Nt}}const{w:Te,h:be}=i.H(fe),Re=new i.dZ({width:Te||1,height:be||1});for(const Ge in Y){const De=Y[Ge];for(const qe in De.glyphs){const Ke=De.glyphs[+qe];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const We=re[Ge][qe],gt=Ke.metrics.localGlyph?ne:1;i.dZ.copy(Ke.bitmap,Re,{x:0,y:0},{x:We.x+gt,y:We.y+gt},Ke.bitmap)}}this.image=Re,this.positions=re}}i.dY(de,"GlyphAtlas");class he{constructor(Y){this.tileID=new i.aH(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=i.aR(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor}parse(Y,re,fe,Te,be){this.status="parsing",this.data=Y,this.collisionBoxArray=new i.aX;const Re=new i.d$(Object.keys(Y.layers).sort()),Ge=new i.e0(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const De={},qe=new i.e1(256,256),Ke={featureIndex:Ge,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:qe,availableImages:fe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},We=re.familiesBySource[this.source];for(const Or in We){const hn=Y.layers[Or];if(!hn)continue;let cn=!1,un=!1,Qn=!1;for(const Ui of We[Or])Ui[0].type==="symbol"?cn=!0:un=!0,Ui[0].is3D()&&Ui[0].type!=="model"&&(Qn=!0);if(this.extraShadowCaster&&!Qn||this.isSymbolTile===!0&&!cn||this.isSymbolTile===!1&&!un)continue;hn.version===1&&i.w(`Vector tile source "${this.source}" layer "${Or}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bi=Re.encode(Or),Ai=[];let Vo=!1;for(let Ui=0,mi=0;Ui<hn.length;Ui++){const ji=hn.feature(Ui),ma=Ge.getId(ji,Or);if(this.localizableLayerIds&&this.localizableLayerIds.has(Or)){const ws=ji.properties?ji.properties.worldview:null;if(this.worldview&&typeof ws=="string")if(ws==="all")ji.properties.$localized=!0;else{if(!ws.split(",").includes(this.worldview))continue;ji.properties.$localized=!0,ji.properties.worldview=this.worldview}}!Vo&&ji.properties&&ji.properties.hasOwnProperty(i.e2)&&(Vo=!0),Ai.push({feature:ji,id:ma,index:mi,sourceLayerIndex:bi}),mi++}Vo&&!Ke.elevationFeatures&&Y.layers.hasOwnProperty(i.e3)&&(Ke.elevationFeatures=i.e4.parseFrom(Y.layers[i.e3],this.canonical));for(const Ui of We[Or]){const mi=Ui[0];(!this.extraShadowCaster||mi.is3D()&&mi.type!=="model")&&(this.isSymbolTile!==void 0&&mi.type==="symbol"!==this.isSymbolTile||mi.minzoom&&this.zoom<Math.floor(mi.minzoom)||mi.maxzoom&&this.zoom>=mi.maxzoom||mi.visibility!=="none"&&(_e(Ui,this.zoom,Ke.brightness,fe),(De[mi.id]=mi.createBucket({index:Ge.bucketLayerIDs.length,layers:Ui,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Ai,Ke,this.tileID.canonical,this.tileTransform),Ge.bucketLayerIDs.push(Ui.map(ji=>i.C(ji.id,ji.scope)))))}}let gt,Nt,Ut,xr,Sr,Ar;qe.trim();const Mr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Sn=()=>{if(gt)return this.status="done",be(gt);if(this.extraShadowCaster)this.status="done",be(null,{buckets:Object.values(De).filter(Or=>!Or.isEmpty()),featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ke.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Nt&&Ut&&xr){const Or=new de(Nt),hn=new Map;for(const[Qn,bi]of Ut.entries()){const{imagePosition:Ai}=i.e7(Qn,bi,i.e8);hn.set(Qn,Ai)}const cn={};for(const Qn in De){const bi=De[Qn];bi instanceof i.aY&&(_e(bi.layers,this.zoom,Ke.brightness,fe),cn[Qn]=i.e9(bi,Nt,Or.positions,Ut,hn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const un={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Te,Ut,Sr,()=>{un.iconsPending=!1,jn(cn,Or,un)}),this.rasterizeIfNeeded(Te,xr,Ar,()=>{un.patternsPending=!1,jn(cn,Or,un)})}},jn=(Or,hn,cn,un)=>{if(cn.iconsPending||cn.patternsPending)return;const Qn=new i.ea(Ut,xr,this.lut);for(const bi in De){const Ai=De[bi];if(bi in Or)i.eb(Ai,Or[bi],this.showCollisionBoxes,fe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Ut,Qn);else if(Ai.hasPattern&&(Ai instanceof i.b2||Ai instanceof i.b3||Ai instanceof i.d8)){_e(Ai.layers,this.zoom,Ke.brightness,fe);const Vo=Object.fromEntries(Qn.patternPositions);Ai.addFeatures(Ke,this.tileID.canonical,Vo,fe,this.tileTransform,this.brightness)}}this.status="done",be(null,{buckets:Object.values(De).filter(bi=>!bi.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:hn.image,lineAtlas:qe,imageAtlas:Qn,brightness:Ke.brightness})};if(!this.extraShadowCaster){const Or=i.e5(Ke.glyphDependencies,un=>Object.keys(un).map(Number));Object.keys(Or).length?Te.send("getGlyphs",{uid:this.uid,stacks:Or,scope:this.scope},(un,Qn)=>{gt||(gt=un,Nt=Qn,Sn())},void 0,!1,Mr):Nt={};const hn=Array.from(Ke.iconDependencies.keys()).map(un=>i.I.parse(un));hn.length?Te.send("getImages",{images:hn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(un,Qn)=>{gt||(gt=un,Ut=new Map,Sr=this.updateImageMapAndGetImageTaskQueue(Ut,Qn,Ke.iconDependencies),Sn())},void 0,!1,Mr):(Ut=new Map,Sr=new Map);const cn=Array.from(Ke.patternDependencies.keys()).map(un=>i.I.parse(un));cn.length?Te.send("getImages",{images:cn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(un,Qn)=>{gt||(gt=un,xr=new Map,Ar=this.updateImageMapAndGetImageTaskQueue(xr,Qn,Ke.patternDependencies),Sn())},void 0,!1,Mr):(xr=new Map,Ar=new Map)}if(Ke.elevationFeatures&&Ke.elevationFeatures.length>0){const Or=[];for(const cn of Object.values(De))if(cn instanceof i.b3){const un=cn.getUnevaluatedPortalGraph();un&&Or.push(un)}const hn=i.e6.evaluate(Or);for(const cn of Object.values(De))cn instanceof i.b3&&cn.setEvaluatedPortalGraph(hn)}Sn()}rasterizeIfNeeded(Y,re,fe,Te){Array.from(re.values()).some(be=>be.usvg)?this.rasterize(Y,re,fe,Te):Te()}updateImageMapAndGetImageTaskQueue(Y,re,fe){const Te=new Map;for(const be of re.keys()){const Re=fe.get(be)||[];for(const Ge of Re){const De=Ge.toString(),qe=re.get(Ge.id.toString());qe.usvg?Te.has(De)||(Te.set(De,Ge),Y.set(De,Object.assign({},qe))):Y.set(De,qe)}}return Te}rasterize(Y,re,fe,Te){this.rasterizeTask=Y.send("rasterizeImages",{scope:this.scope,tasks:fe},(be,Re)=>{if(!be)for(const[Ge,De]of Re.entries()){const qe=Object.assign(re.get(Ge),{data:De});re.set(Ge,qe)}Te()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function _e(Xe,Y,re,fe){const Te=new i.aa(Y,{brightness:re});for(const be of Xe)be.recalculate(Te,fe)}class Ie extends i.E{constructor(Y,re,fe,Te,be,Re){super(),this.actor=Y,this.layerIndex=re,this.availableImages=fe,this.loadVectorData=be||i.aE,this.loading={},this.loaded={},this.deduped=new i.aD(Y.scheduler),this.isSpriteLoaded=Te,this.scheduler=Y.scheduler,this.brightness=Re}loadTile(Y,re){const fe=Y.uid,Te=Y&&Y.request,be=Te&&Te.collectResourceTiming,Re=this.loading[fe]=new he(Y);Re.abort=this.loadVectorData(Y,(Ge,De)=>{const qe=!this.loading[fe];if(delete this.loading[fe],Re.cancelRasterize(),qe||Ge||!De)return Re.status="done",qe||(this.loaded[fe]=Re),re(Ge);const Ke=De.rawData,We={};De.expires&&(We.expires=De.expires),De.cacheControl&&(We.cacheControl=De.cacheControl),Re.vectorTile=De.vectorTile||new i.ec.VectorTile(new i.bi(Ke));const gt=()=>{Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.actor,(Nt,Ut)=>{if(Nt||!Ut)return re(Nt);const xr={};if(be){const Sr=G(Te);Sr.length>0&&(xr.resourceTiming=JSON.parse(JSON.stringify(Sr)))}re(null,i.l({rawTileData:Ke.slice(0)},Ut,We,xr))})};this.isSpriteLoaded?gt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(gt,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):gt()}),this.loaded=this.loaded||{},this.loaded[fe]=Re})}reloadTile(Y,re){const fe=this.loaded,Te=Y.uid;if(fe&&fe[Te]){const be=fe[Te];be.scaleFactor=Y.scaleFactor,be.showCollisionBoxes=Y.showCollisionBoxes,be.projection=Y.projection,be.brightness=Y.brightness,be.tileTransform=i.aR(Y.tileID.canonical,Y.projection),be.extraShadowCaster=Y.extraShadowCaster,be.lut=Y.lut;const Re=(Ge,De)=>{const qe=be.reloadCallback;qe&&(delete be.reloadCallback,be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,qe)),re(Ge,De)};be.status==="parsing"?be.reloadCallback=Re:be.status==="done"&&(be.vectorTile?be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,Re):Re())}else re(null,void 0)}abortTile(Y,re){const fe=Y.uid,Te=this.loading[fe];Te&&(Te.abort&&Te.abort(),delete this.loading[fe]),re()}removeTile(Y,re){const fe=this.loaded,Te=Y.uid;fe&&fe[Te]&&delete fe[Te],re()}}class je{loadTile(Y,re){const{uid:fe,encoding:Te,rawImageData:be,padding:Re}=Y,Ge=ImageBitmap&&be instanceof ImageBitmap?this.getImageData(be,Re):be;re(null,new i.ed(fe,Ge,Te,Re<1))}reloadTile(Y,re){re(null,null)}abortTile(Y,re){re()}removeTile(Y,re){re()}getImageData(Y,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const fe=this.offscreenCanvasContext.getImageData(-re,-re,Y.width+2*re,Y.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),fe}}i.bh.setPbf(i.bi);class vt{constructor(Y){this._mrt=new i.bh(Y.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Y.uid,this.tileID=Y.tileID,this.source=Y.source}parse(Y,re){const fe=this._mrt;this.status="parsing",this._entireBuffer=Y;try{fe.parseHeader(Y),this._isHeaderLoaded=!0;const Te=[];for(const be in fe.layers){const Re=fe.getLayer(be),Ge=Re.getDataRange(Re.getBandList()),De=fe.createDecodingTask(Ge),qe=Y.slice(Ge.firstByte,Ge.lastByte+1),Ke=i.bh.performDecoding(qe,De).then(We=>De.complete(null,We)).catch(We=>De.complete(We,null));Te.push(Ke)}Promise.allSettled(Te).then(()=>re(null,fe))}catch(Te){re(Te)}}}class Pt{constructor(Y){this.actor=Y,this.loading={},this.loaded={}}loadTile(Y,re){const fe=Y.uid,Te=Y.request,be=this.loading[fe]=new vt(Y),{cancel:Re}=i.bj(Te,(Ge,De,qe,Ke)=>{const We=!this.loading[fe];if(delete this.loading[fe],We||Ge||!De)return be.status="done",We||(this.loaded[fe]=be),re(Ge);be.parse(De,(gt,Nt)=>{if(gt||!Nt)return re(gt);re(null,Nt,qe,Ke)}),this.loaded[fe]=be});be.abort=Re}reloadTile(Y,re){re(null,void 0)}abortTile(Y,re){const fe=Y.uid,Te=this.loading[fe];Te&&(Te.abort&&Te.abort(),delete this.loading[fe]),re()}removeTile(Y,re){const fe=Y.uid;this.loaded[fe]&&delete this.loaded[fe],re()}decodeRasterArray({task:Y,buffer:re},fe){i.bh.performDecoding(re,Y).then(Te=>fe(null,Te)).catch(Te=>fe(Te))}}const ht=i.ec.VectorTileFeature.prototype.toGeoJSON;class ft{constructor(Y){this._feature=Y,this.extent=i.ai,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const re of this._feature.geometry)Y.push([new i.P(re[0],re[1])]);return Y}{const Y=[];for(const re of this._feature.geometry){const fe=[];for(const Te of re)fe.push(new i.P(Te[0],Te[1]));Y.push(fe)}return Y}}toGeoJSON(Y,re,fe){return ht.call(this,Y,re,fe)}}class bt{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.ai,this.length=Y.length,this._features=Y}feature(Y){return new ft(this._features[Y])}}const Je=64/4096,Et=128;class pt{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],re){for(const fe of Y){const Te=fe.id;if(Te==null)continue;let be=this.features.get(Te);be&&this.updateCache(be,re),fe.geometry?(be=dt(fe),this.updateCache(be,re),this.features.set(Te,be)):this.features.delete(Te),this.updateCache(be,re)}}updateCache(Y,re){for(const{canonical:fe,uid:Te}of Object.values(re)){const{z:be,x:Re,y:Ge}=fe;lt(Y,Math.pow(2,be),Re,Ge)&&delete re[Te]}}getTile(Y,re,fe){const Te=Math.pow(2,Y),be=[];for(const Re of this.features.values())lt(Re,Te,re,fe)&&be.push(Zt(Re,Te,re,fe));return{features:be}}getFeatures(){return[...this.features.values()]}}function lt({minX:Xe,minY:Y,maxX:re,maxY:fe},Te,be,Re){return Xe<(be+1+Je)/Te&&Y<(Re+1+Je)/Te&&re>(be-Je)/Te&&fe>(Re-Je)/Te}function dt(Xe){const{id:Y,geometry:re,properties:fe}=Xe;if(!re)return;if(re.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Te,coordinates:be}=re,Re={id:Y,type:1,geometry:[],tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ge=Re.geometry;if(Te==="Point")mt(be,Ge,Re);else if(Te==="MultiPoint")for(const De of be)mt(De,Ge,Re);else if(Te==="LineString")Re.type=2,nr(be,Ge,Re);else if(Te==="MultiLineString")Re.type=2,Cr(be,Ge,Re);else if(Te==="Polygon")Re.type=3,Cr(be,Ge,Re,!0);else{if(Te!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Re.type=3;for(const De of be)Cr(De,Ge,Re,!0)}return Re}function mt([Xe,Y],re,fe){const Te=i.av(Xe);let be=i.aC(Y);be=be<0?0:be>1?1:be,re.push(Te,be),fe.minX=Math.min(fe.minX,Te),fe.minY=Math.min(fe.minY,be),fe.maxX=Math.max(fe.maxX,Te),fe.maxY=Math.max(fe.maxY,be)}function nr(Xe,Y,re,fe=!1,Te=!1){const be=[];for(const Re of Xe)mt(Re,be,re);Y.push(be),fe&&function(Re,Ge){let De=0;for(let qe=0,Ke=Re.length,We=Ke-2;qe<Ke;We=qe,qe+=2)De+=(Re[qe]-Re[We])*(Re[qe+1]+Re[We+1]);if(De>0===Ge)for(let qe=0,Ke=Re.length;qe<Ke/2;qe+=2){const We=Re[qe],gt=Re[qe+1];Re[qe]=Re[Ke-2-qe],Re[qe+1]=Re[Ke-1-qe],Re[Ke-2-qe]=We,Re[Ke-1-qe]=gt}}(be,Te)}function Cr(Xe,Y,re,fe=!1){for(let Te=0;Te<Xe.length;Te++)nr(Xe[Te],Y,re,fe,Te===0)}function Zt(Xe,Y,re,fe){const{id:Te,type:be,geometry:Re,tags:Ge}=Xe,De=[];if(be===1)(function(qe,Ke,We,gt,Nt){for(let Ut=0;Ut<qe.length;Ut+=2){const xr=Math.round(i.ai*(qe[Ut+0]*Ke-We)),Sr=Math.round(i.ai*(qe[Ut+1]*Ke-gt));Nt.push([xr,Sr])}})(Re,Y,re,fe,De);else for(const qe of Re)Tr(qe,Y,re,fe,De);return{id:Te,type:be,geometry:De,tags:Ge}}function Tr(Xe,Y,re,fe,Te){const Re=i.ai+Et;let Ge;for(let De=0;De<Xe.length-2;De+=2){let qe=Math.round(i.ai*(Xe[De+0]*Y-re)),Ke=Math.round(i.ai*(Xe[De+1]*Y-fe)),We=Math.round(i.ai*(Xe[De+2]*Y-re)),gt=Math.round(i.ai*(Xe[De+3]*Y-fe));const Nt=We-qe,Ut=gt-Ke;qe<-128&&We<-128||(qe<-128?(Ke+=Math.round(Ut*((-128-qe)/Nt)),qe=-128):We<-128&&(gt=Ke+Math.round(Ut*((-128-qe)/Nt)),We=-128),Ke<-128&&gt<-128||(Ke<-128?(qe+=Math.round(Nt*((-128-Ke)/Ut)),Ke=-128):gt<-128&&(We=qe+Math.round(Nt*((-128-Ke)/Ut)),gt=-128),qe>=Re&&We>=Re||(qe>=Re?(Ke+=Math.round(Ut*((Re-qe)/Nt)),qe=Re):We>=Re&&(gt=Ke+Math.round(Ut*((Re-qe)/Nt)),We=Re),Ke>=Re&&gt>=Re||(Ke>=Re?(qe+=Math.round(Nt*((Re-Ke)/Ut)),Ke=Re):gt>=Re&&(We=qe+Math.round(Nt*((Re-Ke)/Ut)),gt=Re),Ge&&qe===Ge[Ge.length-1][0]&&Ke===Ge[Ge.length-1][1]||(Ge=[[qe,Ke]],Te.push(Ge)),Ge.push([We,gt])))))}}var vr,Ur,lr,qr={exports:{}},ur=function(){if(lr)return qr.exports;lr=1;var Xe=i.eg(),Y=function(){if(Ur)return vr;Ur=1;var Ke=i.ee(),We=i.ef().VectorTileFeature;function gt(Ut,xr){this.options=xr||{},this.features=Ut,this.length=Ut.length}function Nt(Ut,xr){this.id=typeof Ut.id=="number"?Ut.id:void 0,this.type=Ut.type,this.rawGeometry=Ut.type===1?[Ut.geometry]:Ut.geometry,this.properties=Ut.tags,this.extent=xr||4096}return vr=gt,gt.prototype.feature=function(Ut){return new Nt(this.features[Ut],this.options.extent)},Nt.prototype.loadGeometry=function(){var Ut=this.rawGeometry;this.geometry=[];for(var xr=0;xr<Ut.length;xr++){for(var Sr=Ut[xr],Ar=[],Mr=0;Mr<Sr.length;Mr++)Ar.push(new Ke(Sr[Mr][0],Sr[Mr][1]));this.geometry.push(Ar)}return this.geometry},Nt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ut=this.geometry,xr=1/0,Sr=-1/0,Ar=1/0,Mr=-1/0,Sn=0;Sn<Ut.length;Sn++)for(var jn=Ut[Sn],Or=0;Or<jn.length;Or++){var hn=jn[Or];xr=Math.min(xr,hn.x),Sr=Math.max(Sr,hn.x),Ar=Math.min(Ar,hn.y),Mr=Math.max(Mr,hn.y)}return[xr,Ar,Sr,Mr]},Nt.prototype.toGeoJSON=We.prototype.toGeoJSON,vr}();function re(Ke){var We=new Xe;return function(gt,Nt){for(var Ut in gt.layers)Nt.writeMessage(3,fe,gt.layers[Ut])}(Ke,We),We.finish()}function fe(Ke,We){var gt;We.writeVarintField(15,Ke.version||1),We.writeStringField(1,Ke.name||""),We.writeVarintField(5,Ke.extent||4096);var Nt={keys:[],values:[],keycache:{},valuecache:{}};for(gt=0;gt<Ke.length;gt++)Nt.feature=Ke.feature(gt),We.writeMessage(2,Te,Nt);var Ut=Nt.keys;for(gt=0;gt<Ut.length;gt++)We.writeStringField(3,Ut[gt]);var xr=Nt.values;for(gt=0;gt<xr.length;gt++)We.writeMessage(4,qe,xr[gt])}function Te(Ke,We){var gt=Ke.feature;gt.id!==void 0&&We.writeVarintField(1,gt.id),We.writeMessage(2,be,Ke),We.writeVarintField(3,gt.type),We.writeMessage(4,De,gt)}function be(Ke,We){var gt=Ke.feature,Nt=Ke.keys,Ut=Ke.values,xr=Ke.keycache,Sr=Ke.valuecache;for(var Ar in gt.properties){var Mr=gt.properties[Ar],Sn=xr[Ar];if(Mr!==null){Sn===void 0&&(Nt.push(Ar),xr[Ar]=Sn=Nt.length-1),We.writeVarint(Sn);var jn=typeof Mr;jn!=="string"&&jn!=="boolean"&&jn!=="number"&&(Mr=JSON.stringify(Mr));var Or=jn+":"+Mr,hn=Sr[Or];hn===void 0&&(Ut.push(Mr),Sr[Or]=hn=Ut.length-1),We.writeVarint(hn)}}}function Re(Ke,We){return(We<<3)+(7&Ke)}function Ge(Ke){return Ke<<1^Ke>>31}function De(Ke,We){for(var gt=Ke.loadGeometry(),Nt=Ke.type,Ut=0,xr=0,Sr=gt.length,Ar=0;Ar<Sr;Ar++){var Mr=gt[Ar],Sn=1;Nt===1&&(Sn=Mr.length),We.writeVarint(Re(1,Sn));for(var jn=Nt===3?Mr.length-1:Mr.length,Or=0;Or<jn;Or++){Or===1&&Nt!==1&&We.writeVarint(Re(2,jn-1));var hn=Mr[Or].x-Ut,cn=Mr[Or].y-xr;We.writeVarint(Ge(hn)),We.writeVarint(Ge(cn)),Ut+=hn,xr+=cn}Nt===3&&We.writeVarint(Re(7,1))}}function qe(Ke,We){var gt=typeof Ke;gt==="string"?We.writeStringField(1,Ke):gt==="boolean"?We.writeBooleanField(7,Ke):gt==="number"&&(Ke%1!=0?We.writeDoubleField(3,Ke):Ke<0?We.writeSVarintField(6,Ke):We.writeVarintField(5,Ke))}return qr.exports=re,qr.exports.fromVectorTileJs=re,qr.exports.fromGeojsonVt=function(Ke,We){We=We||{};var gt={};for(var Nt in Ke)gt[Nt]=new Y(Ke[Nt].features,We),gt[Nt].name=Nt,gt[Nt].version=We.version,gt[Nt].extent=We.extent;return re({layers:gt})},qr.exports.GeoJSONWrapper=Y,qr.exports}(),ir=i.eh(ur);const $t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xe=>Xe},vi=Math.fround||(di=new Float32Array(1),Xe=>(di[0]=+Xe,di[0]));var di;const yn=3,Rt=5,tr=6;class Yt{constructor(Y){this.options=Object.assign(Object.create($t),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:re,minZoom:fe,maxZoom:Te}=this.options;re&&console.time("total time");const be=`prepare ${Y.length} points`;re&&console.time(be),this.points=Y;const Re=[];for(let De=0;De<Y.length;De++){const qe=Y[De];if(!qe.geometry)continue;const[Ke,We]=qe.geometry.coordinates,gt=vi(ke(Ke)),Nt=vi(Ve(We));Re.push(gt,Nt,1/0,De,-1,1),this.options.reduce&&Re.push(0)}let Ge=this.trees[Te+1]=this._createTree(Re);re&&console.timeEnd(be);for(let De=Te;De>=fe;De--){const qe=+Date.now();Ge=this.trees[De]=this._createTree(this._cluster(Ge,De)),re&&console.log("z%d: %d clusters in %dms",De,Ge.numItems,+Date.now()-qe)}return re&&console.timeEnd("total time"),this}getClusters(Y,re){let fe=((Y[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,Y[1]));let be=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)fe=-180,be=180;else if(fe>be){const We=this.getClusters([fe,Te,180,Re],re),gt=this.getClusters([-180,Te,be,Re],re);return We.concat(gt)}const Ge=this.trees[this._limitZoom(re)],De=Ge.range(ke(fe),Ve(Re),ke(be),Ve(Te)),qe=Ge.data,Ke=[];for(const We of De){const gt=this.stride*We;Ke.push(qe[gt+Rt]>1?te(qe,gt,this.clusterProps):this.points[qe[gt+yn]])}return Ke}getChildren(Y){const re=this._getOriginId(Y),fe=this._getOriginZoom(Y),Te="No cluster with the specified id.",be=this.trees[fe];if(!be)throw new Error(Te);const Re=be.data;if(re*this.stride>=Re.length)throw new Error(Te);const Ge=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),De=be.within(Re[re*this.stride],Re[re*this.stride+1],Ge),qe=[];for(const Ke of De){const We=Ke*this.stride;Re[We+4]===Y&&qe.push(Re[We+Rt]>1?te(Re,We,this.clusterProps):this.points[Re[We+yn]])}if(qe.length===0)throw new Error(Te);return qe}getLeaves(Y,re,fe){const Te=[];return this._appendLeaves(Te,Y,re=re||10,fe=fe||0,0),Te}getTile(Y,re,fe){const Te=this.trees[this._limitZoom(Y)],be=Math.pow(2,Y),{extent:Re,radius:Ge}=this.options,De=Ge/Re,qe=(fe-De)/be,Ke=(fe+1+De)/be,We={features:[]};return this._addTileFeatures(Te.range((re-De)/be,qe,(re+1+De)/be,Ke),Te.data,re,fe,be,We),re===0&&this._addTileFeatures(Te.range(1-De/be,qe,1,Ke),Te.data,be,fe,be,We),re===be-1&&this._addTileFeatures(Te.range(0,qe,De/be,Ke),Te.data,-1,fe,be,We),We.features.length?We:null}getClusterExpansionZoom(Y){let re=this._getOriginZoom(Y)-1;for(;re<=this.options.maxZoom;){const fe=this.getChildren(Y);if(re++,fe.length!==1)break;Y=fe[0].properties.cluster_id}return re}_appendLeaves(Y,re,fe,Te,be){const Re=this.getChildren(re);for(const Ge of Re){const De=Ge.properties;if(De&&De.cluster?be+De.point_count<=Te?be+=De.point_count:be=this._appendLeaves(Y,De.cluster_id,fe,Te,be):be<Te?be++:Y.push(Ge),Y.length===fe)break}return be}_createTree(Y){const re=new i.bE(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<Y.length;fe+=this.stride)re.add(Y[fe],Y[fe+1]);return re.finish(),re.data=Y,re}_addTileFeatures(Y,re,fe,Te,be,Re){for(const Ge of Y){const De=Ge*this.stride,qe=re[De+Rt]>1;let Ke,We,gt;if(qe)Ke=vn(re,De,this.clusterProps),We=re[De],gt=re[De+1];else{const xr=this.points[re[De+yn]];Ke=xr.properties;const[Sr,Ar]=xr.geometry.coordinates;We=ke(Sr),gt=Ve(Ar)}const Nt={type:1,geometry:[[Math.round(this.options.extent*(We*be-fe)),Math.round(this.options.extent*(gt*be-Te))]],tags:Ke};let Ut;Ut=qe||this.options.generateId?re[De+yn]:this.points[re[De+yn]].id,Ut!==void 0&&(Nt.id=Ut),Re.features.push(Nt)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,re){const{radius:fe,extent:Te,reduce:be,minPoints:Re}=this.options,Ge=fe/(Te*Math.pow(2,re)),De=Y.data,qe=[],Ke=this.stride;for(let We=0;We<De.length;We+=Ke){if(De[We+2]<=re)continue;De[We+2]=re;const gt=De[We],Nt=De[We+1],Ut=Y.within(De[We],De[We+1],Ge),xr=De[We+Rt];let Sr=xr;for(const Ar of Ut){const Mr=Ar*Ke;De[Mr+2]>re&&(Sr+=De[Mr+Rt])}if(Sr>xr&&Sr>=Re){let Ar,Mr=gt*xr,Sn=Nt*xr,jn=-1;const Or=(We/Ke<<5)+(re+1)+this.points.length;for(const hn of Ut){const cn=hn*Ke;if(De[cn+2]<=re)continue;De[cn+2]=re;const un=De[cn+Rt];Mr+=De[cn]*un,Sn+=De[cn+1]*un,De[cn+4]=Or,be&&(Ar||(Ar=this._map(De,We,!0),jn=this.clusterProps.length,this.clusterProps.push(Ar)),be(Ar,this._map(De,cn)))}De[We+4]=Or,qe.push(Mr/Sr,Sn/Sr,1/0,Or,-1,Sr),be&&qe.push(jn)}else{for(let Ar=0;Ar<Ke;Ar++)qe.push(De[We+Ar]);if(Sr>1)for(const Ar of Ut){const Mr=Ar*Ke;if(!(De[Mr+2]<=re)){De[Mr+2]=re;for(let Sn=0;Sn<Ke;Sn++)qe.push(De[Mr+Sn])}}}}return qe}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,re,fe){if(Y[re+Rt]>1){const Re=this.clusterProps[Y[re+tr]];return fe?Object.assign({},Re):Re}const Te=this.points[Y[re+yn]].properties,be=this.options.map(Te);return fe&&be===Te?Object.assign({},be):be}}function te(Xe,Y,re){return{type:"Feature",id:Xe[Y+yn],properties:vn(Xe,Y,re),geometry:{type:"Point",coordinates:[(fe=Xe[Y],360*(fe-.5)),Ae(Xe[Y+1])]}};var fe}function vn(Xe,Y,re){const fe=Xe[Y+Rt],Te=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,be=Xe[Y+tr],Re=be===-1?{}:Object.assign({},re[be]);return Object.assign(Re,{cluster:!0,cluster_id:Xe[Y+yn],point_count:fe,point_count_abbreviated:Te})}function ke(Xe){return Xe/360+.5}function Ve(Xe){const Y=Math.sin(Xe*Math.PI/180),re=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return re<0?0:re>1?1:re}function Ae(Xe){const Y=(180-360*Xe)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function wt(Xe,Y,re,fe){let Te=fe;const be=Y+(re-Y>>1);let Re,Ge=re-Y;const De=Xe[Y],qe=Xe[Y+1],Ke=Xe[re],We=Xe[re+1];for(let gt=Y+3;gt<re;gt+=3){const Nt=Vt(Xe[gt],Xe[gt+1],De,qe,Ke,We);if(Nt>Te)Re=gt,Te=Nt;else if(Nt===Te){const Ut=Math.abs(gt-be);Ut<Ge&&(Re=gt,Ge=Ut)}}Te>fe&&(Re-Y>3&&wt(Xe,Y,Re,fe),Xe[Re+2]=Te,re-Re>3&&wt(Xe,Re,re,fe))}function Vt(Xe,Y,re,fe,Te,be){let Re=Te-re,Ge=be-fe;if(Re!==0||Ge!==0){const De=((Xe-re)*Re+(Y-fe)*Ge)/(Re*Re+Ge*Ge);De>1?(re=Te,fe=be):De>0&&(re+=Re*De,fe+=Ge*De)}return Re=Xe-re,Ge=Y-fe,Re*Re+Ge*Ge}function zt(Xe,Y,re,fe){const Te={id:Xe??null,type:Y,geometry:re,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")Dt(Te,re);else if(Y==="Polygon")Dt(Te,re[0]);else if(Y==="MultiLineString")for(const be of re)Dt(Te,be);else if(Y==="MultiPolygon")for(const be of re)Dt(Te,be[0]);return Te}function Dt(Xe,Y){for(let re=0;re<Y.length;re+=3)Xe.minX=Math.min(Xe.minX,Y[re]),Xe.minY=Math.min(Xe.minY,Y[re+1]),Xe.maxX=Math.max(Xe.maxX,Y[re]),Xe.maxY=Math.max(Xe.maxY,Y[re+1])}function jt(Xe,Y,re,fe){if(!Y.geometry)return;const Te=Y.geometry.coordinates;if(Te&&Te.length===0)return;const be=Y.geometry.type,Re=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2);let Ge=[],De=Y.id;if(re.promoteId?De=Y.properties[re.promoteId]:re.generateId&&(De=fe||0),be==="Point")Jt(Te,Ge);else if(be==="MultiPoint")for(const qe of Te)Jt(qe,Ge);else if(be==="LineString")Gt(Te,Ge,Re,!1);else if(be==="MultiLineString"){if(re.lineMetrics){for(const qe of Te)Ge=[],Gt(qe,Ge,Re,!1),Xe.push(zt(De,"LineString",Ge,Y.properties));return}Pr(Te,Ge,Re,!1)}else if(be==="Polygon")Pr(Te,Ge,Re,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(const qe of Y.geometry.geometries)jt(Xe,{id:De,geometry:qe,properties:Y.properties},re,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const qe of Te){const Ke=[];Pr(qe,Ke,Re,!0),Ge.push(Ke)}}Xe.push(zt(De,be,Ge,Y.properties))}function Jt(Xe,Y){Y.push(cr(Xe[0]),Ye(Xe[1]),0)}function Gt(Xe,Y,re,fe){let Te,be,Re=0;for(let De=0;De<Xe.length;De++){const qe=cr(Xe[De][0]),Ke=Ye(Xe[De][1]);Y.push(qe,Ke,0),De>0&&(Re+=fe?(Te*Ke-qe*be)/2:Math.sqrt(Math.pow(qe-Te,2)+Math.pow(Ke-be,2))),Te=qe,be=Ke}const Ge=Y.length-3;Y[2]=1,wt(Y,0,Ge,re),Y[Ge+2]=1,Y.size=Math.abs(Re),Y.start=0,Y.end=Y.size}function Pr(Xe,Y,re,fe){for(let Te=0;Te<Xe.length;Te++){const be=[];Gt(Xe[Te],be,re,fe),Y.push(be)}}function cr(Xe){return Xe/360+.5}function Ye(Xe){const Y=Math.sin(Xe*Math.PI/180),re=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return re<0?0:re>1?1:re}function Qt(Xe,Y,re,fe,Te,be,Re,Ge){if(fe/=Y,be>=(re/=Y)&&Re<fe)return Xe;if(Re<re||be>=fe)return null;const De=[];for(const qe of Xe){const Ke=qe.geometry;let We=qe.type;const gt=Te===0?qe.minX:qe.minY,Nt=Te===0?qe.maxX:qe.maxY;if(gt>=re&&Nt<fe){De.push(qe);continue}if(Nt<re||gt>=fe)continue;let Ut=[];if(We==="Point"||We==="MultiPoint")Gr(Ke,Ut,re,fe,Te);else if(We==="LineString")xn(Ke,Ut,re,fe,Te,!1,Ge.lineMetrics);else if(We==="MultiLineString")xi(Ke,Ut,re,fe,Te,!1);else if(We==="Polygon")xi(Ke,Ut,re,fe,Te,!0);else if(We==="MultiPolygon")for(const xr of Ke){const Sr=[];xi(xr,Sr,re,fe,Te,!0),Sr.length&&Ut.push(Sr)}if(Ut.length){if(Ge.lineMetrics&&We==="LineString"){for(const xr of Ut)De.push(zt(qe.id,We,xr,qe.tags));continue}We!=="LineString"&&We!=="MultiLineString"||(Ut.length===1?(We="LineString",Ut=Ut[0]):We="MultiLineString"),We!=="Point"&&We!=="MultiPoint"||(We=Ut.length===3?"Point":"MultiPoint"),De.push(zt(qe.id,We,Ut,qe.tags))}}return De.length?De:null}function Gr(Xe,Y,re,fe,Te){for(let be=0;be<Xe.length;be+=3){const Re=Xe[be+Te];Re>=re&&Re<=fe&&ri(Y,Xe[be],Xe[be+1],Xe[be+2])}}function xn(Xe,Y,re,fe,Te,be,Re){let Ge=jr(Xe);const De=Te===0?Ji:Ni;let qe,Ke,We=Xe.start;for(let Sr=0;Sr<Xe.length-3;Sr+=3){const Ar=Xe[Sr],Mr=Xe[Sr+1],Sn=Xe[Sr+2],jn=Xe[Sr+3],Or=Xe[Sr+4],hn=Te===0?Ar:Mr,cn=Te===0?jn:Or;let un=!1;Re&&(qe=Math.sqrt(Math.pow(Ar-jn,2)+Math.pow(Mr-Or,2))),hn<re?cn>re&&(Ke=De(Ge,Ar,Mr,jn,Or,re),Re&&(Ge.start=We+qe*Ke)):hn>fe?cn<fe&&(Ke=De(Ge,Ar,Mr,jn,Or,fe),Re&&(Ge.start=We+qe*Ke)):ri(Ge,Ar,Mr,Sn),cn<re&&hn>=re&&(Ke=De(Ge,Ar,Mr,jn,Or,re),un=!0),cn>fe&&hn<=fe&&(Ke=De(Ge,Ar,Mr,jn,Or,fe),un=!0),!be&&un&&(Re&&(Ge.end=We+qe*Ke),Y.push(Ge),Ge=jr(Xe)),Re&&(We+=qe)}let gt=Xe.length-3;const Nt=Xe[gt],Ut=Xe[gt+1],xr=Te===0?Nt:Ut;xr>=re&&xr<=fe&&ri(Ge,Nt,Ut,Xe[gt+2]),gt=Ge.length-3,be&&gt>=3&&(Ge[gt]!==Ge[0]||Ge[gt+1]!==Ge[1])&&ri(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&Y.push(Ge)}function jr(Xe){const Y=[];return Y.size=Xe.size,Y.start=Xe.start,Y.end=Xe.end,Y}function xi(Xe,Y,re,fe,Te,be){for(const Re of Xe)xn(Re,Y,re,fe,Te,be,!1)}function ri(Xe,Y,re,fe){Xe.push(Y,re,fe)}function Ji(Xe,Y,re,fe,Te,be){const Re=(be-Y)/(fe-Y);return ri(Xe,be,re+(Te-re)*Re,1),Re}function Ni(Xe,Y,re,fe,Te,be){const Re=(be-re)/(Te-re);return ri(Xe,Y+(fe-Y)*Re,be,1),Re}function xs(Xe,Y){const re=[];for(let fe=0;fe<Xe.length;fe++){const Te=Xe[fe],be=Te.type;let Re;if(be==="Point"||be==="MultiPoint"||be==="LineString")Re=wo(Te.geometry,Y);else if(be==="MultiLineString"||be==="Polygon"){Re=[];for(const Ge of Te.geometry)Re.push(wo(Ge,Y))}else if(be==="MultiPolygon"){Re=[];for(const Ge of Te.geometry){const De=[];for(const qe of Ge)De.push(wo(qe,Y));Re.push(De)}}re.push(zt(Te.id,be,Re,Te.tags))}return re}function wo(Xe,Y){const re=[];re.size=Xe.size,Xe.start!==void 0&&(re.start=Xe.start,re.end=Xe.end);for(let fe=0;fe<Xe.length;fe+=3)re.push(Xe[fe]+Y,Xe[fe+1],Xe[fe+2]);return re}function Jn(Xe,Y){if(Xe.transformed)return Xe;const re=1<<Xe.z,fe=Xe.x,Te=Xe.y;for(const be of Xe.features){const Re=be.geometry,Ge=be.type;if(be.geometry=[],Ge===1)for(let De=0;De<Re.length;De+=2)be.geometry.push(Vi(Re[De],Re[De+1],Y,re,fe,Te));else for(let De=0;De<Re.length;De++){const qe=[];for(let Ke=0;Ke<Re[De].length;Ke+=2)qe.push(Vi(Re[De][Ke],Re[De][Ke+1],Y,re,fe,Te));be.geometry.push(qe)}}return Xe.transformed=!0,Xe}function Vi(Xe,Y,re,fe,Te,be){return[Math.round(re*(Xe*fe-Te)),Math.round(re*(Y*fe-be))]}function Rr(Xe,Y,re,fe,Te){const be=Y===Te.maxZoom?0:Te.tolerance/((1<<Y)*Te.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:Xe.length,source:null,x:re,y:fe,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of Xe)To(Re,Ge,be,Te);return Re}function To(Xe,Y,re,fe){const Te=Y.geometry,be=Y.type,Re=[];if(Xe.minX=Math.min(Xe.minX,Y.minX),Xe.minY=Math.min(Xe.minY,Y.minY),Xe.maxX=Math.max(Xe.maxX,Y.maxX),Xe.maxY=Math.max(Xe.maxY,Y.maxY),be==="Point"||be==="MultiPoint")for(let Ge=0;Ge<Te.length;Ge+=3)Re.push(Te[Ge],Te[Ge+1]),Xe.numPoints++,Xe.numSimplified++;else if(be==="LineString")wl(Re,Te,Xe,re,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(let Ge=0;Ge<Te.length;Ge++)wl(Re,Te[Ge],Xe,re,be==="Polygon",Ge===0);else if(be==="MultiPolygon")for(let Ge=0;Ge<Te.length;Ge++){const De=Te[Ge];for(let qe=0;qe<De.length;qe++)wl(Re,De[qe],Xe,re,!0,qe===0)}if(Re.length){let Ge=Y.tags||null;if(be==="LineString"&&fe.lineMetrics){Ge={};for(const qe in Y.tags)Ge[qe]=Y.tags[qe];Ge.mapbox_clip_start=Te.start/Te.size,Ge.mapbox_clip_end=Te.end/Te.size}const De={geometry:Re,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:Ge};Y.id!==null&&(De.id=Y.id),Xe.features.push(De)}}function wl(Xe,Y,re,fe,Te,be){const Re=fe*fe;if(fe>0&&Y.size<(Te?Re:fe))return void(re.numPoints+=Y.length/3);const Ge=[];for(let De=0;De<Y.length;De+=3)(fe===0||Y[De+2]>Re)&&(re.numSimplified++,Ge.push(Y[De],Y[De+1])),re.numPoints++;Te&&function(De,qe){let Ke=0;for(let We=0,gt=De.length,Nt=gt-2;We<gt;Nt=We,We+=2)Ke+=(De[We]-De[Nt])*(De[We+1]+De[Nt+1]);if(Ke>0===qe)for(let We=0,gt=De.length;We<gt/2;We+=2){const Nt=De[We],Ut=De[We+1];De[We]=De[gt-2-We],De[We+1]=De[gt-1-We],De[gt-2-We]=Nt,De[gt-1-We]=Ut}}(Ge,be),Xe.push(Ge)}const bs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ga{constructor(Y,re){const fe=(re=this.options=function(be,Re){for(const Ge in Re)be[Ge]=Re[Ge];return be}(Object.create(bs),re)).debug;if(fe&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let Te=function(be,Re){const Ge=[];if(be.type==="FeatureCollection")for(let De=0;De<be.features.length;De++)jt(Ge,be.features[De],Re,De);else jt(Ge,be.type==="Feature"?be:{geometry:be},Re);return Ge}(Y,re);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=function(be,Re){const Ge=Re.buffer/Re.extent;let De=be;const qe=Qt(be,1,-1-Ge,Ge,0,-1,2,Re),Ke=Qt(be,1,1-Ge,2+Ge,0,-1,2,Re);return(qe||Ke)&&(De=Qt(be,1,-Ge,1+Ge,0,-1,2,Re)||[],qe&&(De=xs(qe,1).concat(De)),Ke&&(De=De.concat(xs(Ke,-1)))),De}(Te,re),Te.length&&this.splitTile(Te,0,0,0),fe&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,re,fe,Te,be,Re,Ge){const De=[Y,re,fe,Te],qe=this.options,Ke=qe.debug;for(;De.length;){Te=De.pop(),fe=De.pop(),re=De.pop(),Y=De.pop();const We=1<<re,gt=Ha(re,fe,Te);let Nt=this.tiles[gt];if(!Nt&&(Ke>1&&console.time("creation"),Nt=this.tiles[gt]=Rr(Y,re,fe,Te,qe),this.tileCoords.push({z:re,x:fe,y:Te}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,fe,Te,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));const un=`z${re}`;this.stats[un]=(this.stats[un]||0)+1,this.total++}if(Nt.source=Y,be==null){if(re===qe.indexMaxZoom||Nt.numPoints<=qe.indexMaxPoints)continue}else{if(re===qe.maxZoom||re===be)continue;if(be!=null){const un=be-re;if(fe!==Re>>un||Te!==Ge>>un)continue}}if(Nt.source=null,Y.length===0)continue;Ke>1&&console.time("clipping");const Ut=.5*qe.buffer/qe.extent,xr=.5-Ut,Sr=.5+Ut,Ar=1+Ut;let Mr=null,Sn=null,jn=null,Or=null,hn=Qt(Y,We,fe-Ut,fe+Sr,0,Nt.minX,Nt.maxX,qe),cn=Qt(Y,We,fe+xr,fe+Ar,0,Nt.minX,Nt.maxX,qe);Y=null,hn&&(Mr=Qt(hn,We,Te-Ut,Te+Sr,1,Nt.minY,Nt.maxY,qe),Sn=Qt(hn,We,Te+xr,Te+Ar,1,Nt.minY,Nt.maxY,qe),hn=null),cn&&(jn=Qt(cn,We,Te-Ut,Te+Sr,1,Nt.minY,Nt.maxY,qe),Or=Qt(cn,We,Te+xr,Te+Ar,1,Nt.minY,Nt.maxY,qe),cn=null),Ke>1&&console.timeEnd("clipping"),De.push(Mr||[],re+1,2*fe,2*Te),De.push(Sn||[],re+1,2*fe,2*Te+1),De.push(jn||[],re+1,2*fe+1,2*Te),De.push(Or||[],re+1,2*fe+1,2*Te+1)}}getTile(Y,re,fe){Y=+Y,re=+re,fe=+fe;const Te=this.options,{extent:be,debug:Re}=Te;if(Y<0||Y>24)return null;const Ge=1<<Y,De=Ha(Y,re=re+Ge&Ge-1,fe);if(this.tiles[De])return Jn(this.tiles[De],be);Re>1&&console.log("drilling down to z%d-%d-%d",Y,re,fe);let qe,Ke=Y,We=re,gt=fe;for(;!qe&&Ke>0;)Ke--,We>>=1,gt>>=1,qe=this.tiles[Ha(Ke,We,gt)];return qe&&qe.source?(Re>1&&(console.log("found parent tile z%d-%d-%d",Ke,We,gt),console.time("drilling down")),this.splitTile(qe.source,Ke,We,gt,Y,re,fe),Re>1&&console.timeEnd("drilling down"),this.tiles[De]?Jn(this.tiles[De],be):null):null}}function Ha(Xe,Y,re){return 32*((1<<Xe)*re+Y)+Xe}function zc(Xe,Y){const re=Xe.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);const fe=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!fe)return void Y(null,null);const Te=new bt(fe.features);let be=ir(Te);be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),Y(null,{vectorTile:Te,rawData:be.buffer})}class Tl extends Ie{constructor(Y,re,fe,Te,be,Re){super(Y,re,fe,Te,zc,Re),be&&(this.loadGeoJSON=be),this._dynamicIndex=new pt}loadData(Y,re){const fe=Y&&Y.request,Te=fe&&fe.collectResourceTiming;this.loadGeoJSON(Y,(be,Re)=>{if(be||!Re)return re(be);if(typeof Re!="object")return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){const De=i.X(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(qe=>`${qe.key}: ${qe.message}`).join(", "));Re.features=Re.features.filter(qe=>De.value.evaluate({zoom:0},qe))}Y.dynamic?(Re.type==="Feature"&&(Re={type:"FeatureCollection",features:[Re]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Re.features,this.loaded),Y.cluster&&(Re.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new Yt(function({superclusterOptions:De,clusterProperties:qe}){if(!qe||!De)return De;const Ke={},We={},gt={accumulated:null,zoom:0},Nt={properties:null},Ut=Object.keys(qe);for(const xr of Ut){const[Sr,Ar]=qe[xr],Mr=i.X(Ar),Sn=i.X(typeof Sr=="string"?[Sr,["accumulated"],["get",xr]]:Sr);Ke[xr]=Mr.value,We[xr]=Sn.value}return De.map=xr=>{Nt.properties=xr;const Sr={};for(const Ar of Ut)Sr[Ar]=Ke[Ar].evaluate(gt,Nt);return Sr},De.reduce=(xr,Sr)=>{Nt.properties=Sr;for(const Ar of Ut)gt.accumulated=xr[Ar],xr[Ar]=We[Ar].evaluate(gt,Nt)},De}(Y)).load(Re.features):Y.dynamic?this._dynamicIndex:function(De,qe){return new Ga(De,qe)}(Re,Y.geojsonVtOptions)}catch(De){return re(De)}const Ge={};if(Te){const De=G(fe);De&&(Ge.resourceTiming={},Ge.resourceTiming[Y.source]=JSON.parse(JSON.stringify(De)))}re(null,Ge)}})}reloadTile(Y,re){const fe=this.loaded;return fe&&fe[Y.uid]?Y.partial?re(null,void 0):super.reloadTile(Y,re):this.loadTile(Y,re)}loadGeoJSON(Y,re){if(Y.request)i.n(Y.request,re);else{if(typeof Y.data!="string")return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(Y.data))}catch{return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(fe){re(fe)}}getClusterChildren(Y,re){try{re(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(fe){re(fe)}}getClusterLeaves(Y,re){try{re(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(fe){re(fe)}}}class Zu{constructor(Y,re){this.tileID=new i.aH(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=re}parse(Y,re,fe,Te){this.status="parsing";const be=new i.aH(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),Re=[],Ge=re.familiesBySource[fe.source],De=new i.e0(be,fe.promoteId);return De.bucketLayerIDs=[],De.is3DTile=!0,i.ei(Y).then(qe=>{if(!qe)return Te(new Error("Could not parse tile"));const Ke=i.ej(qe,1/i.cd(fe.tileID.canonical)),We=qe.json.extensionsUsed&&qe.json.extensionsUsed.includes("MAPBOX_mesh_features")||qe.json.asset.extras&&qe.json.asset.extras.MAPBOX_mesh_features,gt=qe.json.extensionsUsed&&qe.json.extensionsUsed.includes("EXT_meshopt_compression"),Nt=new i.aa(this.zoom,{brightness:this.brightness});for(const Ut in Ge)for(const xr of Ge[Ut]){const Sr=xr[0];De.bucketLayerIDs.push(xr.map(Mr=>i.C(Mr.id,Mr.scope))),Sr.recalculate(Nt,[]);const Ar=new i.ek(xr,Ke,be,We,gt,this.brightness,De);We||(Ar.needsUpload=!0),Re.push(Ar),Ar.evaluate(Sr)}this.status="done",Te(null,{buckets:Re,featureIndex:De,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(qe=>Te(new Error(qe.message)))}}class Xu{constructor(Y,re,fe,Te,be,Re){this.actor=Y,this.layerIndex=re,this.availableImages=fe,this.brightness=Re,this.loading={},this.loaded={}}loadTile(Y,re){const fe=Y.uid,Te=this.loading[fe]=new Zu(Y,this.brightness);i.bj(Y.request,(be,Re)=>{const Ge=!this.loading[fe];return delete this.loading[fe],Ge||be?(Te.status="done",Ge||(this.loaded[fe]=Te),re(be)):Re&&Re.byteLength!==0?void Te.parse(Re,this.layerIndex,Y,(De,qe)=>{Te.status="done",this.loaded=this.loaded||{},this.loaded[fe]=Te,De||!qe?re(De):re(null,qe)}):(Te.status="done",this.loaded[fe]=Te,re())})}reloadTile(Y,re){const fe=this.loaded,Te=Y.uid;if(fe&&fe[Te]){const be=fe[Te];be.projection=Y.projection,be.brightness=Y.brightness;const Re=(Ge,De)=>{be.reloadCallback&&(delete be.reloadCallback,this.loadTile(Y,re)),re(Ge,De)};be.status==="parsing"?be.reloadCallback=Re:be.status==="done"&&this.loadTile(Y,re)}}abortTile(Y,re){const fe=Y.uid;this.loading[fe]&&delete this.loading[fe],re()}removeTile(Y,re){const fe=this.loaded,Te=Y.uid;fe&&fe[Te]&&delete fe[Te],re()}}class Lc{constructor(Y){this.self=Y,this.actor=new i.el(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.projections={},this.defaultProjection=i.bP({name:"mercator"}),this.workerSourceTypes={vector:Ie,geojson:Tl,"raster-dem":je,"raster-array":Pt,"batched-model":Xu},this.workerSources={},this.self.registerWorkerSource=(re,fe)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=fe},this.self.registerRTLTextPlugin=re=>{if(i.em.isParsed())throw new Error("RTL text plugin already registered.");i.em.applyArabicShaping=re.applyArabicShaping,i.em.processBidirectionalText=re.processBidirectionalText,i.em.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(Y,re,fe){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],fe()}checkIfReady(Y,re,fe){fe()}setReferrer(Y,re){this.referrer=re}spriteLoaded(Y,{scope:re,isLoaded:fe}){if(this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.isSpriteLoaded[Y][re]=fe,this.workerSources[Y]&&this.workerSources[Y][re])for(const Te in this.workerSources[Y][re]){const be=this.workerSources[Y][re][Te];for(const Re in be){const Ge=be[Re];Ge instanceof Ie&&(Ge.isSpriteLoaded=fe,Ge.fire(new i.A("isSpriteLoaded")))}}}setImages(Y,{scope:re,images:fe},Te){if(this.availableImages[Y]||(this.availableImages[Y]={}),this.availableImages[Y][re]=fe,this.workerSources[Y]&&this.workerSources[Y][re]){for(const be in this.workerSources[Y][re]){const Re=this.workerSources[Y][re][be];for(const Ge in Re)Re[Ge].availableImages=fe}Te()}else Te()}setProjection(Y,re){this.projections[Y]=i.bP(re)}setBrightness(Y,re,fe){this.brightness=re,fe()}setLayers(Y,re,fe){this.getLayerIndex(Y,re.scope).replace(re.layers,re.options),fe()}updateLayers(Y,re,fe){this.getLayerIndex(Y,re.scope).update(re.layers,re.removedIds,re.options),fe()}loadTile(Y,re,fe){re.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,re.type,re.source,re.scope).loadTile(re,fe)}decodeRasterArray(Y,re,fe){this.getWorkerSource(Y,re.type,re.source,re.scope).decodeRasterArray(re,fe)}reloadTile(Y,re,fe){re.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,re.type,re.source,re.scope).reloadTile(re,fe)}abortTile(Y,re,fe){this.getWorkerSource(Y,re.type,re.source,re.scope).abortTile(re,fe)}removeTile(Y,re,fe){this.getWorkerSource(Y,re.type,re.source,re.scope).removeTile(re,fe)}removeSource(Y,re,fe){if(!(this.workerSources[Y]&&this.workerSources[Y][re.scope]&&this.workerSources[Y][re.scope][re.type]&&this.workerSources[Y][re.scope][re.type][re.source]))return;const Te=this.workerSources[Y][re.scope][re.type][re.source];delete this.workerSources[Y][re.scope][re.type][re.source],Te.removeSource!==void 0?Te.removeSource(re,fe):fe()}loadWorkerSource(Y,re,fe){try{this.self.importScripts(re.url),fe()}catch(Te){fe(Te.toString())}}syncRTLPluginState(Y,re,fe){try{i.em.setState(re);const Te=i.em.getPluginURL();if(i.em.isLoaded()&&!i.em.isParsed()&&Te!=null){this.self.importScripts(Te);const be=i.em.isParsed();fe(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Te}`),be)}}catch(Te){fe(Te.toString())}}setDracoUrl(Y,re){this.dracoUrl=re}getAvailableImages(Y,re){this.availableImages[Y]||(this.availableImages[Y]={});let fe=this.availableImages[Y][re];return fe||(fe=[]),fe}getLayerIndex(Y,re){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let fe=this.layerIndexes[Y][re];return fe||(fe=this.layerIndexes[Y][re]=new ee,fe.scope=re),fe}getWorkerSource(Y,re,fe,Te){const be=this.workerSources;return be[Y]||(be[Y]={}),be[Y][Te]||(be[Y][Te]={}),be[Y][Te][re]||(be[Y][Te][re]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),be[Y][Te][re][fe]||(be[Y][Te][re][fe]=new this.workerSourceTypes[re]({send:(Re,Ge,De,qe,Ke,We)=>{this.actor.send(Re,Ge,De,Y,Ke,We)},scheduler:this.actor.scheduler},this.getLayerIndex(Y,Te),this.getAvailableImages(Y,Te),this.isSpriteLoaded[Y][Te],void 0,this.brightness)),be[Y][Te][re][fe]}rasterizeImages(Y,re,fe){const Te=new Map;for(const[be,{image:Re,imageVariant:Ge}]of re.tasks.entries()){const De=this.imageRasterizer.rasterize(Ge,Re,re.scope,Y);Te.set(be,De)}fe(void 0,Te)}removeRasterizedImages(Y,re,fe){this.imageRasterizer.removeImagesFromCacheByIds(re.imageIds,re.scope,Y),fe()}enforceCacheSizeLimit(Y,re){i.en(re)}getWorkerPerformanceMetrics(Y,re,fe){fe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Lc(self)),Lc}),R(["./shared"],function(i){var G="3.11.0";const W={create:"create",load:"load",fullLoad:"fullLoad"},H={mark(d){performance.mark(d)},measure(d,t,s){performance.measure(d,t,s)}};function ee(d){const t=d.name.split("?")[0];return i.a(t)&&t.includes("mapbox-gl.js")?"javascript":i.a(t)&&t.includes("mapbox-gl.css")?"css":i.b(t)?"fontRange":i.c(t)?"sprite":i.i(t)?"style":i.d(t)?"tilejson":"other"}var ne,de={},he=function(){if(ne)return de;function d(h){return!t(h)}function t(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,I=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(I);try{x=new Worker(P),g=!0}catch{g=!1}return x&&x.terminate(),URL.revokeObjectURL(P),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var I=x.getImageData(0,0,1,1);return I&&I.width===g.width}()?(s[m=h&&h.failIfMajorPerformanceCaveat]===void 0&&(s[m]=function(g){var x,I=function(P){var z=document.createElement("canvas"),L=Object.create(d.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=P,z.getContext("webgl2",L)}(g);if(!I)return!1;try{x=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!x||I.isContextLost())&&(I.shaderSource(x,"void main() {}"),I.compileShader(x),I.getShaderParameter(x,I.COMPILE_STATUS)===!0)}(m)),s[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}ne=1,de.supported=d,de.notSupportedReason=t;var s={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},de}();function _e(d,t,s){const h=document.createElement(d);return t!=null&&(h.className=t),s&&s.appendChild(h),h}function Ie(d,t,s){const h=document.createElementNS("http://www.w3.org/2000/svg",d);for(const m of Object.keys(t))h.setAttributeNS(null,m,String(t[m]));return s&&s.appendChild(h),h}const je=typeof document<"u"?document.documentElement&&document.documentElement.style:null,vt=je&&je.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Pt;function ht(){je&&vt&&(Pt=je[vt],je[vt]="none")}function ft(){je&&vt&&(je[vt]=Pt)}function bt(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",bt,!0)}function Je(){window.addEventListener("click",bt,!0),window.setTimeout(()=>{window.removeEventListener("click",bt,!0)},0)}function Et(d,t){const s=d.getBoundingClientRect();return dt(d,s,t)}function pt(d,t){const s=d.getBoundingClientRect(),h=[];for(let m=0;m<t.length;m++)h.push(dt(d,s,t[m]));return h}function lt(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function dt(d,t,s){const h=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new i.P((s.clientX-t.left)*h,(s.clientY-t.top)*h)}const mt="01",nr="NO_ACCESS_TOKEN";class Cr{constructor(t,s,h){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const t=function(){let s="";for(let h=0;h<10;h++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",mt,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!i.f(t))return t;const h=Tr(t);return h.params.push(`sdk=js-${G}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!i.f(t))return t;const h=Tr(t);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeModelURL(t,s){if(!i.f(t))return t;const h=Tr(t);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeSourceURL(t,s,h,m){if(!i.f(t))return t;const g=Tr(t);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),h&&g.params.push(`language=${h}`),m&&g.params.push(`worldview=${m}`),this._makeAPIURL(g,this._customAccessToken||s)}normalizeIconsetURL(t,s){const h=Tr(t);return i.f(t)?(h.path=`/styles/v1${h.path}/iconset.pbf`,this._makeAPIURL(h,this._customAccessToken||s)):vr(h)}normalizeSpriteURL(t,s,h,m){const g=Tr(t);return i.f(t)?(g.path=`/styles/v1${g.path}/sprite${s}${h}`,this._makeAPIURL(g,this._customAccessToken||m)):(g.path+=`${s}${h}`,vr(g))}normalizeTileURL(t,s,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!i.f(t))return t;const m=Tr(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||h&&m.authority!=="raster"&&h===512?"@2x":""}${i.m.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${i.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${i.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${i.e.TILE_URL_VERSION}${m.path}`);const g=this._customAccessToken||function(x){for(const I of x){const P=I.match(/^access_token=(.*)$/);if(P)return P[1]}return null}(m.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,g)}canonicalizeTileURL(t,s){const h=Tr(t);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return t;let m="mapbox://";h.path.match(/^\/raster\/v1\//)?m+=`raster/${h.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${h.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${h.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let g=h.params;return s&&(g=g.filter(x=>!x.match(/^access_token=/))),g.length&&(m+=`?${g.join("&")}`),m}canonicalizeTileset(t,s){const h=!!s&&i.f(s),m=[];for(const g of t.tiles||[])i.h(g)?m.push(this.canonicalizeTileURL(g,h)):m.push(g);return m}_makeAPIURL(t,s){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=Tr(i.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){const g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return vr(t);if(s=s||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return t.params=t.params.filter(g=>g.indexOf("access_token")===-1),t.params.push(`access_token=${s||""}`),vr(t)}}const Zt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Tr(d){const t=d.match(Zt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function vr(d){const t=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${t}`}const Ur="mapbox.eventData";function lr(d){if(!d)return null;const t=d.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(i.j(t[1]))}catch{return null}}class qr{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=lr(i.e.ACCESS_TOKEN);let h="";return h=s&&s.u?i.k(s.u):i.e.ACCESS_TOKEN||"",t?`${Ur}.${t}:${h}`:`${Ur}:${h}`}fetchEventData(){const t=i.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{const m=localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));const g=localStorage.getItem(h);g&&(this.anonId=g)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const t=i.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid"),m=this.anonId;if(t&&m)try{localStorage.setItem(h,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,h,m){if(!i.e.EVENTS_URL)return;const g=Tr(i.e.EVENTS_URL);g.params.push(`access_token=${m||i.e.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(t).toISOString()},I=s?i.l(x,s):x,P={url:vr(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=i.p(P,z=>{this.pendingRequest=null,h(z),this.saveEventData(),this.processRequests(m)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const ur=new class extends qr{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,t){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(s=>i.f(s)||i.h(s))&&this.queueRequest(Date.now(),t)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=lr(i.e.ACCESS_TOKEN),s=t?t.u:i.e.ACCESS_TOKEN;let h=s!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),h=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),x=new Date(m),I=(m-this.eventData.lastSuccess)/864e5;h=h||I>=1||I<-1||g.getDate()!==x.getDate()}else h=!0;h?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:mt,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=m,this.eventData.tokenU=s)},d):this.processRequests()}},ir=ur.postTurnstileEvent.bind(ur),$t=new class extends qr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,t,s,h){this.skuToken=t,this.errorCb=h,i.e.EVENTS_URL&&(s||i.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},s):this.errorCb(new Error(nr)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:mt,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},d))}remove(){this.errorCb=null}},vi=$t.postMapLoadEvent.bind($t),di=new class extends qr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let t=this.mapInstanceIdMap.get(d);return t||(t=i.u(),this.mapInstanceIdMap.set(d,t)),t}getEventId(d){const t=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,t+1),t}postStyleLoadEvent(d,t){const{map:s,style:h,importedStyles:m}=t;if(!i.e.EVENTS_URL||!d&&!i.e.ACCESS_TOKEN)return;const g=this.getMapInstanceId(s),x={mapInstanceId:g,eventId:this.getEventId(g),style:h};m.length&&(x.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:x},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,()=>{},d)}},yn=di.postStyleLoadEvent.bind(di),Rt=new class extends qr{constructor(){super("gljs.performance")}postPerformanceEvent(d,t){i.e.EVENTS_URL&&(d||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),h=function(m){const g=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),I=function(j){const X={};if(j){for(const q in j)if(q!=="other")for(const J of j[q]){const Q=`${q}ResolveRangeMin`,oe=`${q}ResolveRangeMax`,ue=`${q}RequestCount`,ce=`${q}RequestCachedCount`;X[Q]=Math.min(X[Q]||1/0,J.startTime),X[oe]=Math.max(X[oe]||-1/0,J.responseEnd);const ye=pe=>{X[pe]===void 0&&(X[pe]=0),++X[pe]};J.transferSize!==void 0&&J.transferSize===0&&ye(ce),ye(ue)}}return X}(function(j,X){const q={};if(j)for(const J of j){const Q=X(J);q[Q]===void 0&&(q[Q]=[]),q[Q].push(J)}return q}(g,ee)),P=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=z?z.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},B=(j,X,q)=>{q!=null&&j.push({name:X,value:q.toString()})};for(const j in I)B(F.counters,j,I[j]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(B(F.counters,"interactionRangeMin",m.interactionRange[0]),B(F.counters,"interactionRangeMax",m.interactionRange[1])),x)for(const j of Object.keys(W)){const X=W[j],q=x.find(J=>J.name===X);q&&B(F.counters,X,q.startTime)}return B(F.counters,"visibilityHidden",m.visibilityHidden),B(F.attributes,"style",function(j){if(j)for(const X of j){const q=X.name.split("?")[0];if(i.i(q)){const J=q.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}}(g)),B(F.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),B(F.attributes,"fogEnabled",m.fogEnabled?"true":"false"),B(F.attributes,"projection",m.projection),B(F.attributes,"zoom",m.zoom),B(F.metadata,"devicePixelRatio",P),B(F.metadata,"connectionEffectiveType",L),B(F.metadata,"navigatorUserAgent",navigator.userAgent),B(F.metadata,"screenWidth",window.screen.width),B(F.metadata,"screenHeight",window.screen.height),B(F.metadata,"windowWidth",window.innerWidth),B(F.metadata,"windowHeight",window.innerHeight),B(F.metadata,"mapWidth",m.width/P),B(F.metadata,"mapHeight",m.height/P),B(F.metadata,"webglRenderer",m.renderer),B(F.metadata,"webglVendor",m.vendor),B(F.metadata,"sdkVersion",G),B(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(s);for(const m of h.metadata);for(const m of h.counters);for(const m of h.attributes);this.postEvent(t,h,()=>{},d)}},tr=Rt.postPerformanceEvent.bind(Rt),Yt=new class extends qr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,t,s,h){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const m=Tr(i.e.API_URL+i.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${h||i.e.ACCESS_TOKEN||""}`);const g={url:vr(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(g,x=>{this.pendingRequest=null,s(x),this.saveEventData(),this.processRequests(h)})}getSessionAPI(d,t,s,h){this.skuToken=t,this.errorCb=h,i.e.SESSION_PATH&&i.e.API_URL&&(s||i.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},s):this.errorCb(new Error(nr)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},d)}remove(){this.errorCb=null}},te=Yt.getSessionAPI.bind(Yt),vn=new Set;class ke{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(i.I.toString(t)),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ve(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ae extends i.E{constructor(t){super(),this._images={},this._iconsets={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.patternsInFlight=new Set,this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}createScope(t){this._images[t]={},this._iconsets[t]={},this.loaded[t]=!1,this.updatedImages[t]=new Set,this.patterns[t]={},this.callbackDispatchedThisFrame[t]=new Set,this.atlasImage[t]=new i.r({width:1,height:1})}createIconset(t,s){this._iconsets[t][s]={}}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,s){if(this.loaded[s]!==t&&(this.loaded[s]=t,t)){for(const{ids:h,callback:m}of this.requestors)this._notify(h,s,m);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return(t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s])[t.name]}addImage(t,s,h){const m=t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s];this._validate(t,h)&&(m[t.name]=h)}_validate(t,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new i.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new i.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new i.z(new Error(`Image "${t.name}" has invalid "content" value`))),h=!1),h}_validateStretch(t,s){if(!t)return!0;let h=0;for(const m of t){if(m[0]<h||m[1]<m[0]||s<m[1])return!1;h=m[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,h){const m=t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s];h.version=m[t.name].version+1,m[t.name]=h,this.updatedImages[s].add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages[t].clear()}removeFromImageRasterizerCache(t,s){if(this.spriteFormat!=="raster")if(i.t()){const h={imageIds:[t],scope:s};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",h)}else this.imageRasterizer.removeImagesFromCacheByIds([t],s)}removeImage(t,s){const h=t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s],m=h[t.name];delete h[t.name],delete this.patterns[s][t.name],this.removeFromImageRasterizerCache(t,s),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(t){const s=[];for(const h of Object.keys(this._images[t]))s.push(new i.I(h));for(const h in this._iconsets[t])for(const m of Object.keys(this._iconsets[t][h]))s.push(new i.I({name:m,iconsetId:h}));return s}getImages(t,s,h){let m=!0;const g=!!this.loaded[s];if(!g)for(const x of t)(x.iconsetId?this._iconsets[s][x.iconsetId]:this._images[s])[x.name]||(m=!1);g||m?this._notify(t,s,h):this.requestors.push({ids:t,scope:s,callback:h})}rasterizeImages({scope:t,tasks:s},h){const m=new Map;for(const[g,x]of s.entries()){const I=this.getImage(x.id,t);I&&m.set(g,{image:I,imageVariant:x})}this._rasterizeImages(t,m,h)}_rasterizeImages(t,s,h){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:s,scope:t},h);else{const m=new Map;for(const[g,{image:x,imageVariant:I}]of s.entries())m.set(g,this.imageRasterizer.rasterize(I,x,t,0));h(void 0,m)}}getUpdatedImages(t){return this.updatedImages[t]||new Set}_notify(t,s,h){const m=new Map;for(const g of t){g.iconsetId&&(this._iconsets[s][g.iconsetId]=this._iconsets[s][g.iconsetId]||{});const x=(g.iconsetId?this._iconsets[s][g.iconsetId]:this._images[s])[g.name];if(!x){if(g.iconsetId)continue;i.w(`Image "${g.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new i.A("styleimagemissing",{id:g.name}));continue}const I={data:x.usvg?null:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,usvg:x.usvg,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)};x.usvg&&Object.assign(I,{width:x.icon.usvg_tree.width,height:x.icon.usvg_tree.height}),m.set(i.I.toString(g),I)}h(null,m)}getPixelSize(t){const{width:s,height:h}=this.atlasImage[t];return{width:s,height:h}}getPattern(t,s,h){const m=this.patterns[s][t.name],g=this.getImage(t,s);if(!g)return null;if(m){if(m.position.version===g.version)return m.position;m.position.version=g.version}else{if(g.usvg&&!g.data){const x=this.getPatternInFlightId(t.toString(),s);if(this.patternsInFlight.has(x))return null;this.patternsInFlight.add(x);const I=new i.B(t).scaleSelf(i.q.devicePixelRatio),P=new Map([[I.toString(),{image:g,imageVariant:I}]]);return this._rasterizeImages(s,P,(z,L)=>this.storePatternImage(I,s,g,h,L)),null}this.storePattern(t,s,g)}return this._updatePatternAtlas(s,h),this.patterns[s][t.name].position}getPatternInFlightId(t,s){return i.C(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,h,m,g){const x=t.toString(),I=g?g.get(x):void 0;I&&(h.data=I,this.storePattern(t.id,s,h),this._updatePatternAtlas(s,m),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,h){const m={w:h.data.width+2*i.F,h:h.data.height+2*i.F,x:0,y:0},g=new i.G(m,h,i.F);this.patterns[s][t.name]={bin:m,position:g}}bind(t,s){const h=t.gl;let m=this.atlasTexture[s];m?this.dirty&&(m.update(this.atlasImage[s]),this.dirty=!1):(m=new i.T(t,this.atlasImage[s],h.RGBA8),this.atlasTexture[s]=m),m.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const h=[];for(const I in this.patterns[t])h.push(this.patterns[t][I].bin);const{w:m,h:g}=i.H(h),x=this.atlasImage[t];x.resize({width:m||1,height:g||1});for(const I in this.patterns[t]){const{bin:P,position:z}=this.patterns[t][I];let L=z.padding;const F=P.x+L,B=P.y+L,j=this._images[t][I].data,X=j.width,q=j.height;L=L>1?L-1:L,i.r.copy(j,x,{x:0,y:0},{x:F,y:B},{width:X,height:q},s),i.r.copy(j,x,{x:0,y:q-L},{x:F,y:B-L},{width:X,height:L},s),i.r.copy(j,x,{x:0,y:0},{x:F,y:B+q},{width:X,height:L},s),i.r.copy(j,x,{x:X-L,y:0},{x:F-L,y:B},{width:L,height:q},s),i.r.copy(j,x,{x:0,y:0},{x:F+X,y:B},{width:L,height:q},s),i.r.copy(j,x,{x:X-L,y:q-L},{x:F-L,y:B-L},{width:L,height:L},s),i.r.copy(j,x,{x:0,y:q-L},{x:F+X,y:B-L},{width:L,height:L},s),i.r.copy(j,x,{x:0,y:0},{x:F+X,y:B+q},{width:L,height:L},s),i.r.copy(j,x,{x:X-L,y:0},{x:F-L,y:B+q},{width:L,height:L},s)}this.dirty=!0}beginFrame(){for(const t in this._images)this.callbackDispatchedThisFrame[t]=new Set}dispatchRenderCallbacks(t,s){for(const h of t){if(this.callbackDispatchedThisFrame[s].has(h.toString()))continue;this.callbackDispatchedThisFrame[s].add(h.toString());const m=(h.iconsetId?this._iconsets[s][h.iconsetId]:this._images[s])[h.name];Ve(m)&&this.updateImage(h,s,m)}}}function wt(d){const t=d.key,s=d.value,h=d.valueSpec||{},m=d.objectElementValidators||{},g=d.style,x=d.styleSpec;let I=[];const P=i.K(s);if(P!=="object")return[new i.V(t,s,`object expected, ${P} found`)];for(const z in s){const L=z.split(".")[0];let F;m[L]?F=m[L]:h[L]?F=Rr:m["*"]?F=m["*"]:h["*"]&&(F=Rr),F?I=I.concat(F({key:(t&&`${t}.`)+z,value:s[z],valueSpec:h[L]||h["*"],style:g,styleSpec:x,object:s,objectKey:z},s)):I.push(new i.J(t,s[z],`unknown property "${z}"`))}for(const z in h)m[z]||h[z].required&&h[z].default===void 0&&s[z]===void 0&&I.push(new i.V(t,s,`missing required property "${z}"`));return I}function Vt(d){const t=d.value,s=d.valueSpec,h=d.style,m=d.styleSpec,g=d.key,x=d.arrayElementValidator||Rr;if(i.K(t)!=="array")return[new i.V(g,t,`array expected, ${i.K(t)} found`)];if(s.length&&t.length!==s.length)return[new i.V(g,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new i.V(g,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let I={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};m.$version<7&&(I.function=s.function),i.K(s.value)==="object"&&(I=s.value);let P=[];for(let z=0;z<t.length;z++)P=P.concat(x({array:t,arrayIndex:z,value:t[z],valueSpec:I,style:h,styleSpec:m,key:`${g}[${z}]`},!0));return P}function zt(d){const t=d.key,s=d.value,h=d.valueSpec;let m=i.K(s);if(m==="number"&&s!=s&&(m="NaN"),m!=="number")return[new i.V(t,s,`number expected, ${m} found`)];if("minimum"in h){let g=h.minimum;if(i.K(h.minimum)==="array"&&(g=h.minimum[d.arrayIndex]),s<g)return[new i.V(t,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in h){let g=h.maximum;if(i.K(h.maximum)==="array"&&(g=h.maximum[d.arrayIndex]),s>g)return[new i.V(t,s,`${s} is greater than the maximum value ${g}`)]}return[]}function Dt(d){const t=d.valueSpec,s=i.M(d.value.type);let h,m,g,x={};const I=s!=="categorical"&&d.value.property===void 0,P=!I,z=i.K(d.value.stops)==="array"&&i.K(d.value.stops[0])==="array"&&i.K(d.value.stops[0][0])==="object",L=wt({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(j){if(s==="identity")return[new i.V(j.key,j.value,'identity function may not have a "stops" property')];let X=[];const q=j.value;return X=X.concat(Vt({key:j.key,value:q,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:F})),i.K(q)==="array"&&q.length===0&&X.push(new i.V(j.key,q,"array must have at least one stop")),X},default:function(j){return Rr({key:j.key,value:j.value,valueSpec:t,style:j.style,styleSpec:j.styleSpec})}}});return s==="identity"&&I&&L.push(new i.V(d.key,d.value,'missing required property "property"')),s==="identity"||d.value.stops||L.push(new i.V(d.key,d.value,'missing required property "stops"')),s==="exponential"&&d.valueSpec.expression&&!i.N(d.valueSpec)&&L.push(new i.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(P&&!i.O(d.valueSpec)?L.push(new i.V(d.key,d.value,"property functions not supported")):I&&!i.Q(d.valueSpec)&&L.push(new i.V(d.key,d.value,"zoom functions not supported"))),s!=="categorical"&&!z||d.value.property!==void 0||L.push(new i.V(d.key,d.value,'"property" property is required')),L;function F(j){let X=[];const q=j.value,J=j.key;if(i.K(q)!=="array")return[new i.V(J,q,`array expected, ${i.K(q)} found`)];if(q.length!==2)return[new i.V(J,q,`array length 2 expected, length ${q.length} found`)];if(z){if(i.K(q[0])!=="object")return[new i.V(J,q,`object expected, ${i.K(q[0])} found`)];if(q[0].zoom===void 0)return[new i.V(J,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new i.V(J,q,"object stop key must have value")];const Q=i.M(q[0].zoom);if(typeof Q!="number")return[new i.V(J,q[0].zoom,"stop zoom values must be numbers")];if(g&&g>Q)return[new i.V(J,q[0].zoom,"stop zoom values must appear in ascending order")];Q!==g&&(g=Q,m=void 0,x={}),X=X.concat(wt({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:zt,value:B}}))}else X=X.concat(B({key:`${J}[0]`,value:q[0],style:j.style,styleSpec:j.styleSpec},q));return i.S(i.U(q[1]))?X.concat([new i.V(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):X.concat(Rr({key:`${J}[1]`,value:q[1],valueSpec:t,style:j.style,styleSpec:j.styleSpec}))}function B(j,X){const q=i.K(j.value),J=i.M(j.value),Q=j.value!==null?j.value:X;if(h){if(q!==h)return[new i.V(j.key,Q,`${q} stop domain type must match previous stop domain type ${h}`)]}else h=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof J!="number"&&typeof J!="string"&&typeof J!="boolean")return[new i.V(j.key,Q,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&s!=="categorical"){let oe=`number expected, ${q} found`;return i.O(t)&&s===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(j.key,Q,oe)]}return s!=="categorical"||q!=="number"||typeof J=="number"&&isFinite(J)&&Math.floor(J)===J?s!=="categorical"&&q==="number"&&typeof J=="number"&&typeof m=="number"&&m!==void 0&&J<m?[new i.V(j.key,Q,"stop domain values must appear in ascending order")]:(m=J,s==="categorical"&&J in x?[new i.V(j.key,Q,"stop domain values must be unique")]:(x[J]=!0,[])):[new i.V(j.key,Q,`integer expected, found ${String(J)}`)]}}function jt(d){const t=(d.expressionContext==="property"?i.W:i.X)(i.U(d.value),d.valueSpec);if(t.result==="error")return t.value.map(h=>new i.V(`${d.key}${h.key}`,d.value,h.message));const s=t.value.expression||t.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!s.outputDefined())return[new i.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!i.Y(s))return[new i.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Jt(s,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!i.Z(s,["zoom","feature-state"]))return[new i.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!i._(s))return[new i.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jt(d,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)s.delete(m);if(s.size===0)return[];const h=[];return d instanceof i.$&&s.has(d.name)?[new i.V(t.key,t.value,`["${d.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(d.eachChild(m=>{h.push(...Jt(m,t))}),h)}function Gt(d){const t=d.key,s=d.value,h=d.valueSpec,m=[];return Array.isArray(h.values)?h.values.indexOf(i.M(s))===-1&&m.push(new i.V(t,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(i.M(s))===-1&&m.push(new i.V(t,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function Pr(d){return i.a1(i.U(d.value))?jt(i.L({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):cr(d)}function cr(d){const t=d.value,s=d.key;if(i.K(t)!=="array")return[new i.V(s,t,`array expected, ${i.K(t)} found`)];const h=d.styleSpec;let m,g=[];if(t.length<1)return[new i.V(s,t,"filter array must have at least 1 element")];switch(g=g.concat(Gt({key:`${s}[0]`,value:t[0],valueSpec:h.filter_operator,style:d.style,styleSpec:d.styleSpec})),i.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&i.M(t[1])==="$type"&&g.push(new i.V(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new i.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=i.K(t[1]),m!=="string"&&g.push(new i.V(`${s}[1]`,t[1],`string expected, ${m} found`)));for(let x=2;x<t.length;x++)m=i.K(t[x]),i.M(t[1])==="$type"?g=g.concat(Gt({key:`${s}[${x}]`,value:t[x],valueSpec:h.geometry_type,style:d.style,styleSpec:d.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&g.push(new i.V(`${s}[${x}]`,t[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)g=g.concat(cr({key:`${s}[${x}]`,value:t[x],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":m=i.K(t[1]),t.length!==2?g.push(new i.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&g.push(new i.V(`${s}[1]`,t[1],`string expected, ${m} found`))}return g}function Ye(d,t){const s=d.key,h=d.style,m=d.layer,g=d.styleSpec,x=d.value,I=d.objectKey,P=g[`${t}_${d.layerType}`];if(!P)return[];const z=I.match(/^(.*)-use-theme$/);if(t==="paint"&&z&&P[z[1]])return i.S(x)?[].concat(Rr({key:d.key,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:I})):Rr({key:s,value:x,valueSpec:{type:"string"},style:h,styleSpec:g});const L=I.match(/^(.*)-transition$/);if(t==="paint"&&L&&P[L[1]]&&P[L[1]].transition)return Rr({key:s,value:x,valueSpec:g.transition,style:h,styleSpec:g});const F=d.valueSpec||P[I];if(!F)return[new i.J(s,x,`unknown property "${I}"`)];let B;if(i.K(x)==="string"&&i.O(F)&&!F.tokens&&(B=/^{([^}]+)}$/.exec(x))){const X=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new i.V(s,x,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${X}.`)]}const j=[];if(d.layerType==="symbol")I!=="text-field"||!h||h.glyphs||h.imports||j.push(new i.V(s,x,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&i.a2(i.U(x))&&i.M(x.type)==="identity"&&j.push(new i.V(s,x,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&i.O(F)&&(i.a3(F)||i.Q(F))){const X=i.W(i.U(x),F),q=X.value.expression||X.value._styleExpression.expression;q&&!i.Z(q,["measure-light"])&&(I==="model-emissive-strength"&&i._(q)&&i.Y(q)||j.push(new i.V(s,x,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(Rr({key:d.key,value:x,valueSpec:F,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:I}))}function Qt(d){return Ye(d,"paint")}function Gr(d){return Ye(d,"layout")}function xn(d){let t=[];const s=d.value,h=d.key,m=d.style,g=d.styleSpec;s.type||s.ref||t.push(new i.V(h,s,'either "type" or "ref" is required'));let x=i.M(s.type);const I=i.M(s.ref);if(s.id){const P=i.M(s.id);for(let z=0;z<d.arrayIndex;z++){const L=m.layers[z];i.M(L.id)===P&&t.push(new i.V(h,s.id,`duplicate layer id "${s.id}", previously used at line ${L.id.__line__}`))}}if("ref"in s){let P;["type","source","source-layer","filter","layout"].forEach(z=>{z in s&&t.push(new i.V(h,s[z],`"${z}" is prohibited for ref layers`))}),m.layers.forEach(z=>{i.M(z.id)===I&&(P=z)}),P?P.ref?t.push(new i.V(h,s.ref,"ref cannot reference another ref layer")):x=i.M(P.type):typeof I=="string"&&t.push(new i.V(h,s.ref,`ref layer "${I}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(s.source){const P=m.sources&&m.sources[s.source],z=P&&i.M(P.type);P?z==="vector"&&x==="raster"?t.push(new i.V(h,s.source,`layer "${s.id}" requires a raster source`)):z==="raster"&&x!=="raster"?t.push(new i.V(h,s.source,`layer "${s.id}" requires a vector source`)):z!=="vector"||s["source-layer"]?z==="raster-dem"&&x!=="hillshade"?t.push(new i.V(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||z==="geojson"&&P.lineMetrics?x==="raster-particle"&&z!=="raster-array"&&t.push(new i.V(h,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new i.V(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new i.V(h,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new i.V(h,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new i.V(h,s.source,`source "${s.source}" not found`))}else t.push(new i.V(h,s,'missing required property "source"'));return t=t.concat(wt({key:h,value:s,valueSpec:g.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Rr({key:`${h}.type`,value:s.type,valueSpec:g.layer.type,style:d.style,styleSpec:d.styleSpec,object:s,objectKey:"type"}),filter:P=>Pr(i.L({layerType:x},P)),layout:P=>wt({layer:s,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":z=>Gr(i.L({layerType:x},z))}}),paint:P=>wt({layer:s,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":z=>Qt(i.L({layerType:x,layer:s},z))}})}})),t}function jr(d){const t=d.value,s=d.key,h=i.K(t);return h!=="string"?[new i.V(s,t,`string expected, ${h} found`)]:[]}const xi={promoteId:function d({key:t,value:s}){if(i.K(s)==="string")return jr({key:t,value:s});if(Array.isArray(s)){const h=[],m=i.U(s),g=i.X(m);return g.result==="error"&&g.value.forEach(x=>{h.push(new i.V(`${t}${x.key}`,null,`${x.message}`))}),i.Z(g.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||h.push(new i.V(`${t}`,null,"promoteId expression should be only feature dependent")),h}{const h=[];for(const m in s)h.push(...d({key:`${t}.${m}`,value:s[m]}));return h}}};function ri(d){const t=d.value,s=d.key,h=d.styleSpec,m=d.style;if(!t.type)return[new i.V(s,t,'"type" is required')];const g=i.M(t.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&(t.url||t.tiles||x.push(new i.J(s,t,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(wt({key:s,value:t,valueSpec:h[`source_${g.replace("-","_")}`],style:d.style,styleSpec:h,objectElementValidators:xi})),x;case"geojson":if(x=wt({key:s,value:t,valueSpec:h.source_geojson,style:m,styleSpec:h,objectElementValidators:xi}),t.cluster)for(const I in t.clusterProperties){const[P,z]=t.clusterProperties[I],L=typeof P=="string"?[P,["accumulated"],["get",I]]:P;x.push(...jt({key:`${s}.${I}.map`,value:z,expressionContext:"cluster-map"})),x.push(...jt({key:`${s}.${I}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return wt({key:s,value:t,valueSpec:h.source_video,style:m,styleSpec:h});case"image":return wt({key:s,value:t,valueSpec:h.source_image,style:m,styleSpec:h});case"canvas":return[new i.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gt({key:`${s}.type`,value:t.type,valueSpec:{values:Ji(h)}})}}function Ji(d){return d.source.reduce((t,s)=>{const h=d[s];return h.type.type==="enum"&&(t=t.concat(Object.keys(h.type.values))),t},[])}function Ni(d){const t=d.value,s=d.styleSpec,h=s.light,m=d.style;let g=[];const x=i.K(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new i.V("light",t,`object expected, ${x} found`)]),g;for(const I in t){const P=I.match(/^(.*)-transition$/),z=I.match(/^(.*)-use-theme$/);g=g.concat(z&&h[z[1]]?Rr({key:I,value:t[I],valueSpec:{type:"string"},style:m,styleSpec:s}):P&&h[P[1]]&&h[P[1]].transition?Rr({key:I,value:t[I],valueSpec:s.transition,style:m,styleSpec:s}):h[I]?Rr({key:I,value:t[I],valueSpec:h[I],style:m,styleSpec:s}):[new i.V(I,t[I],`unknown property "${I}"`)])}return g}function xs(d){const t=d.value;let s=[];if(!t)return s;const h=i.K(t);if(h!=="object")return s=s.concat([new i.V("light-3d",t,`object expected, ${h} found`)]),s;const m=d.styleSpec,g=m["light-3d"],x=d.key,I=d.style,P=d.style.lights;for(const F of["type","id"])if(!(F in t))return s=s.concat([new i.V("light-3d",t,`missing property ${F} on light`)]),s;if(t.type&&P)for(let F=0;F<d.arrayIndex;F++){const B=i.M(t.type),j=P[F];i.M(j.type)===B&&s.push(new i.V(x,t.id,`duplicate light type "${t.type}", previously defined at line ${j.id.__line__}`))}const z=`properties_light_${t.type}`;if(!(z in m))return s=s.concat([new i.V("light-3d",t,`Invalid light type ${t.type}`)]),s;const L=m[z];for(const F in t)if(F==="properties"){const B=t[F],j=i.K(B);if(j!=="object")return s=s.concat([new i.V("properties",B,`object expected, ${j} found`)]),s;for(const X in B)s=s.concat(L[X]?Rr({key:X,value:B[X],valueSpec:L[X],style:I,styleSpec:m}):[new i.J(d.key,B[X],`unknown property "${X}"`)])}else{const B=F.match(/^(.*)-transition$/),j=F.match(/^(.*)-use-theme$/);s=s.concat(j&&g[j[1]]?Rr({key:F,value:t[F],valueSpec:{type:"string"},style:I,styleSpec:m}):B&&g[B[1]]&&g[B[1]].transition?Rr({key:F,value:t[F],valueSpec:m.transition,style:I,styleSpec:m}):g[F]?Rr({key:F,value:t[F],valueSpec:g[F],style:I,styleSpec:m}):[new i.J(F,t[F],`unknown property "${F}"`)])}return s}function wo(d){const t=d.value,s=d.key,h=d.style,m=d.styleSpec,g=m.terrain;let x=[];const I=i.K(t);if(t===void 0||I==="null")return x;if(I!=="object")return x=x.concat([new i.V("terrain",t,`object expected, ${I} found`)]),x;for(const P in t){const z=P.match(/^(.*)-transition$/),L=P.match(/^(.*)-use-theme$/);x=x.concat(L&&g[L[1]]?Rr({key:P,value:t[P],valueSpec:{type:"string"},style:h,styleSpec:m}):z&&g[z[1]]&&g[z[1]].transition?Rr({key:P,value:t[P],valueSpec:m.transition,style:h,styleSpec:m}):g[P]?Rr({key:P,value:t[P],valueSpec:g[P],style:h,styleSpec:m}):[new i.J(P,t[P],`unknown property "${P}"`)])}if(t.source){const P=h.sources&&h.sources[t.source],z=P&&i.M(P.type);P?z!=="raster-dem"&&x.push(new i.V(s,t.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):x.push(new i.V(s,t.source,`source "${t.source}" not found`))}else x.push(new i.V(s,t,'terrain is missing required property "source"'));return x}function Jn(d){const t=d.value,s=d.style,h=d.styleSpec,m=h.fog;let g=[];const x=i.K(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new i.V("fog",t,`object expected, ${x} found`)]),g;for(const I in t){const P=I.match(/^(.*)-transition$/),z=I.match(/^(.*)-use-theme$/);g=g.concat(z&&m[z[1]]?Rr({key:I,value:t[I],valueSpec:{type:"string"},style:s,styleSpec:h}):P&&m[P[1]]&&m[P[1]].transition?Rr({key:I,value:t[I],valueSpec:h.transition,style:s,styleSpec:h}):m[I]?Rr({key:I,value:t[I],valueSpec:m[I],style:s,styleSpec:h}):[new i.J(I,t[I],`unknown property "${I}"`)])}return g}const Vi={"*":()=>[],array:Vt,boolean:function(d){const t=d.value,s=d.key,h=i.K(t);return h!=="boolean"?[new i.V(s,t,`boolean expected, ${h} found`)]:[]},number:zt,color:function(d){const t=d.key,s=d.value,h=i.K(s);return h!=="string"?[new i.V(t,s,`color expected, ${h} found`)]:i.a0.parseCSSColor(s)===null?[new i.V(t,s,`color expected, "${s}" found`)]:[]},enum:Gt,filter:Pr,function:Dt,layer:xn,object:wt,source:ri,model:i.a4,light:Ni,"light-3d":xs,terrain:wo,fog:Jn,string:jr,formatted:function(d){return jr(d).length===0?[]:jt(d)},resolvedImage:function(d){return jr(d).length===0?[]:jt(d)},projection:function(d){const t=d.value,s=d.styleSpec,h=s.projection,m=d.style;let g=[];const x=i.K(t);if(x==="object")for(const I in t)g=g.concat(Rr({key:I,value:t[I],valueSpec:h[I],style:m,styleSpec:s}));else x!=="string"&&(g=g.concat([new i.V("projection",t,`object or string expected, ${x} found`)]));return g},import:function(d){const{value:t,styleSpec:s}=d,{data:h,...m}=t;Object.defineProperty(m,"__line__",{value:t.__line__,enumerable:!1});let g=wt(i.L({},d,{value:m,valueSpec:s.import}));return i.M(m.id)===""&&g.push(new i.V(`${d.key}.id`,m,"import id can't be an empty string")),h&&(g=g.concat(wl(h,s,{key:`${d.key}.data`}))),g},iconset:function(d){const t=d.value,s=d.key,h=d.styleSpec,m=d.style;if(!t.type)return[new i.V(s,t,'"type" is required')];const g=i.M(t.type);let x=[];if(x=x.concat(wt({key:s,value:t,valueSpec:h[`iconset_${g}`],style:m,styleSpec:h})),g==="source"&&t.source){const I=m.sources&&m.sources[t.source],P=I&&i.M(I.type);I?P!=="raster-array"&&x.push(new i.V(s,t.source,`iconset cannot be used with a source of type ${String(P)}, it only be used with a "raster-array" source type`)):x.push(new i.V(s,t.source,`source "${t.source}" not found`))}return x}};function Rr(d,t=!1){const s=d.value,h=d.valueSpec,m=d.styleSpec;if(h.expression&&i.a2(i.M(s)))return Dt(d);if(h.expression&&i.S(i.U(s)))return jt(d);if(h.type&&Vi[h.type]){const g=Vi[h.type](d);return t===!0&&g.length>0&&i.K(d.value)==="array"?jt(d):g}return wt(i.L({},d,{valueSpec:h.type?m[h.type]:h}))}function To(d){const t=d.value,s=d.key,h=jr(d);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new i.V(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new i.V(s,t,'"glyphs" url must include a "{range}" token'))),h}function wl(d,t=i.a5,s={}){return Rr({key:s.key||"",value:d,valueSpec:t.$root,styleSpec:t,style:d,objectElementValidators:{glyphs:To,"*":()=>[]}})}function bs(d,t=i.a5){return be(wl(d,t))}const Ga=d=>be(ri(d)),Ha=d=>be(Ni(d)),zc=d=>be(xs(d)),Tl=d=>be(wo(d)),Zu=d=>be(Jn(d)),Xu=d=>be(function(t){const s=t.value,h=t.style,m=t.styleSpec,g=m.snow;let x=[];const I=i.K(s);if(s===void 0)return x;if(I!=="object")return x=x.concat([new i.V("snow",s,`object expected, ${I} found`)]),x;for(const P in s){const z=P.match(/^(.*)-transition$/);x=x.concat(z&&g[z[1]]&&g[z[1]].transition?Rr({key:P,value:s[P],valueSpec:m.transition,style:h,styleSpec:m}):g[P]?Rr({key:P,value:s[P],valueSpec:g[P],style:h,styleSpec:m}):[new i.J(P,s[P],`unknown property "${P}"`)])}return x}(d)),Lc=d=>be(function(t){const s=t.value,h=t.style,m=t.styleSpec,g=m.rain;let x=[];const I=i.K(s);if(s===void 0)return x;if(I!=="object")return x=x.concat([new i.V("rain",s,`object expected, ${I} found`)]),x;for(const P in s){const z=P.match(/^(.*)-transition$/);x=x.concat(z&&g[z[1]]&&g[z[1]].transition?Rr({key:P,value:s[P],valueSpec:m.transition,style:h,styleSpec:m}):g[P]?Rr({key:P,value:s[P],valueSpec:g[P],style:h,styleSpec:m}):[new i.J(P,s[P],`unknown property "${P}"`)])}return x}(d)),Xe=d=>be(xn(d)),Y=d=>be(Pr(d)),re=d=>be(Qt(d)),fe=d=>be(Gr(d)),Te=d=>be(i.a4(d));function be(d){return d.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function Re(d,t){let s=!1;if(t&&t.length)for(const h of t)h instanceof i.J?i.w(h.message):(d.fire(new i.z(new Error(h.message))),s=!0);return s}let Ge;class De extends i.E{constructor(t,s="flat"){super(),this._transitionable=new i.a6(Ge||(Ge=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,h={}){this._validate(Ha,t,h)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Re(this,t.call(bs,i.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let qe=class extends i.E{constructor(d,t,s,h){super(),this.scope=s,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),s,h),this._transitionable.setTransitionOrValue(d,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(d,t){this._transitionable.setTransitionOrValue(d,t)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new i.aa(d)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const t=d.value.expression;if(!t)return null;let s=-1,h=-1,m=1;for(const g of t.zoomStops)m=t.evaluate(new i.aa(g)),m>.01?(s=g,h=-1):h=g;return m<.01&&s>0&&h>s?[s,h]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof i.ab}};const Ke=45,We=65,gt=.05;function Nt(d,t,s,h){const m=i.ae(Ke,We,s),[g,x]=Ut(d,h);let I=1-Math.min(1,Math.exp((t-g)/(x-g)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*m*d.alpha}function Ut(d,t){const s=.5/Math.tan(.5*t);return[d.range[0]+s,d.range[1]+s]}function xr(d,t,s,h,m){const g=i.ad.vec3.transformMat4([],[t,s,h],m.mercatorFogMatrix);return Nt(d,i.ad.vec3.length(g),m.pitch,m._fov)}function Sr(d,t,s,h,m,g,x){const I=[[s,h,0],[m,h,0],[m,g,0],[s,g,0]];let P=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const L of I){const F=i.ad.vec3.transformMat4([],L,t),B=i.ad.vec3.length(F);P=Math.min(P,B),z=Math.max(z,B)}return[Nt(d,P,x.pitch,x._fov),Nt(d,z,x.pitch,x._fov)]}class Ar extends i.E{constructor(t,s,h,m){super();const g=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(g,h,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new i.af(g),this.scope=h}get state(){const t=this._transform,s=t.projection.name==="globe",h=i.ag(t.zoom),m=this.properties.get("range"),g=[.5,3];return{range:s?[i.ah(g[0],m[0],h),i.ah(g[1],m[1],h)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,h={}){if(this._validate(Zu,t,h))return;const m=i.l({},t);for(const g of Object.keys(i.a5.fog))m[g]===void 0&&(m[g]=i.a5.fog[g].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ae(Ke,We,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(h,m,g){const x=i.ac.fromLngLat(m),I=g.elevation?g.elevation.getAtPointOrZero(x):0;return xr(h,x.x,x.y,I,g)}(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Sr(this.state,s,0,0,i.ai,i.ai,this._transform)}getOpacityForBounds(t,s,h,m,g){return this._transform.projection.supportsFog?Sr(this.state,t,s,h,m,g,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ut(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const h of s){const m=t.points[h];let g;if(m[2]>=0)g=m;else{const x=t.points[h-4];g=i.aj(x,m,x[2]/(x[2]-m[2]))}if(xr(this.state,g[0],g[1],0,this._transform)>=gt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Re(this,t.call(bs,i.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Mr,Sn,jn,Or,hn=class extends i.E{constructor(d,t,s,h){super();const m=Mr||(Mr=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(m,s,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(m),this.scope=s}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=i.ak(s[0]),m=-Math.max(i.ak(s[1]),.01),g=[Math.cos(h)*Math.cos(m),Math.sin(h)*Math.cos(m),Math.sin(m)],x=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(t.r,t.g,t.b,t.a*d),direction:g,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(d,t,s={}){if(this._validate(Xu,d,s))return;const h=i.l({},d);for(const m of Object.keys(i.a5.snow))h[m]===void 0&&(h[m]=i.a5.snow[m].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,s){return(!s||s.validate!==!1)&&Re(this,d.call(bs,i.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},cn=class extends i.E{constructor(d,t,s,h){super();const m=Sn||(Sn=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(m,s,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(m),this.scope=s}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=i.ak(s[0]),m=-Math.max(i.ak(s[1]),.01),g=[Math.cos(h)*Math.cos(m),Math.sin(h)*Math.cos(m),Math.sin(m)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(t.r,t.g,t.b,t.a*d),direction:g,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(d,t,s={}){if(this._validate(Lc,d,s))return;const h=i.l({},d);for(const m of Object.keys(i.a5.rain))h[m]===void 0&&(h[m]=i.a5.rain[m].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,s){return(!s||s.validate!==!1)&&Re(this,d.call(bs,i.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class un extends i.E{constructor(t,s,h,m){super(),this.scope=h,this._options=t,this.properties=new i.af(s),this._transitionable=new i.a6(s,h,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Qn{constructor(t,s,h,m){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(t,s){let h,m;if(t instanceof i.P||typeof t[0]=="number"){const g=i.P.convert(t);h=[g],m=s.isPointAboveHorizon(g)}else{const g=i.P.convert(t[0]),x=i.P.convert(t[1]);h=[g,x],m=i.an(g,x).every(I=>s.isPointAboveHorizon(I))}return new Qn(h,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return i.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],m=i.an(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),i.ao(m,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],m=i.an(s,h,t),g=this.cameraPoint.clone();switch(3*((g.y>s.y)+(g.y>h.y))+((g.x>s.x)+(g.x>h.x))){case 0:m[0]=g,m[4]=g.clone();break;case 1:m.splice(1,0,g);break;case 2:m[1]=g;break;case 3:m.splice(4,0,g);break;case 5:m.splice(2,0,g);break;case 6:m[3]=g;break;case 7:m.splice(3,0,g);break;case 8:m[2]=g}return m}containsTile(t,s,h,m=0){const g=t.queryPadding/s._pixelsPerMercatorPixel+1,x=h?this._bufferedCameraMercator(g,s):this._bufferedScreenMercator(g,s);let I=t.tileID.wrap+(x.unwrapped?m:0);const P=x.polygon.map(J=>i.ap(t.tileTransform,J,I));if(!i.aq(P,0,0,i.ai,i.ai))return;I=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const z=this.screenGeometryMercator.polygon.map(J=>i.ar(t.tileTransform,J,I)),L=z.map(J=>new i.P(J[0],J[1])),F=s.getFreeCameraOptions().position||new i.ac(0,0,0),B=i.ar(t.tileTransform,F,I),j=z.map(J=>{const Q=i.ad.vec3.sub(J,J,B);return i.ad.vec3.normalize(Q,Q),new i.as(B,Q)}),X=i.at(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:j,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(q=i.au(P),q.min.x=i.ay(q.min.x,0,i.ai),q.min.y=i.ay(q.min.y,0,i.ai),q.max.x=i.ay(q.max.x,0,i.ai),q.max.y=i.ay(q.max.y,0,i.ai),q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:X};var q}_bufferedScreenMercator(t,s){const h=Vo(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map(g=>s.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(t,s){const h=Vo(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map(g=>s.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[h]=m,m}}_projectAndResample(t,s){const h=function(g,x){const I=i.ad.mat4.multiply([],x.pixelMatrix,x.globeMatrix),P=[0,-i.az,0,1],z=[0,i.az,0,1],L=[0,0,0,1];i.ad.vec4.transformMat4(P,P,I),i.ad.vec4.transformMat4(z,z,I),i.ad.vec4.transformMat4(L,L,I);const F=new i.P(P[0]/P[3],P[1]/P[3]),B=new i.P(z[0]/z[3],z[1]/z[3]),j=i.aw(g,F)&&P[3]<L[3],X=i.aw(g,B)&&z[3]<L[3];if(!j&&!X)return null;const q=function(ge,me,we){for(let Ee=1;Ee<ge.length;Ee++){const He=Ai(me.pointCoordinate3D(ge[Ee-1]).x),Be=Ai(me.pointCoordinate3D(ge[Ee]).x);if(we<0){if(He<Be)return{idx:Ee,t:-He/(Be-1-He)}}else if(Be<He)return{idx:Ee,t:(1-He)/(Be+1-He)}}return null}(g,x,j?-1:1);if(!q)return null;const{idx:J,t:Q}=q;let oe=J>1?bi(g.slice(0,J),x):[],ue=J<g.length?bi(g.slice(J),x):[];oe=oe.map(ge=>new i.P(Ai(ge.x),ge.y)),ue=ue.map(ge=>new i.P(Ai(ge.x),ge.y));const ce=[...oe];ce.length===0&&ce.push(ue[ue.length-1]);const ye=i.ah(ce[ce.length-1].y,(ue.length===0?oe[0]:ue[0]).y,Q);let pe;return pe=j?[new i.P(0,ye),new i.P(0,0),new i.P(1,0),new i.P(1,ye)]:[new i.P(1,ye),new i.P(1,1),new i.P(0,1),new i.P(0,ye)],ce.push(...pe),ue.length===0?ce.push(oe[0]):ce.push(...ue),{polygon:ce.map(ge=>new i.ac(ge.x,ge.y)),unwrapped:!1}}(t,s);if(h)return h;const m=function(g,x){let I=!1,P=-1/0,z=0;for(let F=0;F<g.length-1;F++)g[F].x>P&&(P=g[F].x,z=F);for(let F=0;F<g.length-1;F++){const B=(z+F)%(g.length-1),j=g[B],X=g[B+1];Math.abs(j.x-X.x)>.5&&(j.x<X.x?(j.x+=1,B===0&&(g[g.length-1].x+=1)):(X.x+=1,B+1===g.length-1&&(g[0].x+=1)),I=!0)}const L=i.av(x.center.lng);return I&&L<Math.abs(L-1)&&g.forEach(F=>{F.x-=1}),{polygon:g,unwrapped:I}}(bi(t,s).map(g=>new i.P(Ai(g.x),g.y)),s);return{polygon:m.polygon.map(g=>new i.ac(g.x,g.y)),unwrapped:m.unwrapped}}}function bi(d,t){return i.ax(d,s=>{const h=t.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function Ai(d){return d<0?1+d%1:d%1}function Vo(d){return 100*d|0}function Ui(d,t,s,h,m){const g=function(I,P){if(I)return m(I);if(P){if(d.url&&P.tiles&&d.tiles&&delete d.tiles,P.variants){if(!Array.isArray(P.variants))return m(new Error("variants must be an array"));for(const L of P.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return m(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){P=i.l(P,L);break}}}const z=i.aA(i.l({},P,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=t.canonicalizeTileset(z,d.url),m(null,z)}},x=function(I,P,z){if(!I)return null;if(!P&&!z)return I;z=z||I.worldview_default;const L=Object.values(I.language||{});if(L.length===0)return null;const F=Object.values(I.worldview||{});if(F.length===0)return null;const B=L.every(X=>X===P),j=F.every(X=>X===z);return B&&j?I:P in(I.language_options||{})||z in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(d.data,s,h);return x?i.q.frame(()=>g(null,x)):d.url?i.n(t.transformRequest(t.normalizeSourceURL(d.url,null,s,h),i.R.Source),g):i.q.frame(()=>{const{data:I,...P}=d;g(null,P)})}class mi{constructor(t,s,h){this.bounds=i.aB.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),h=Math.floor(i.av(this.bounds.getWest())*s),m=Math.floor(i.aC(this.bounds.getNorth())*s),g=Math.ceil(i.av(this.bounds.getEast())*s),x=Math.ceil(i.aC(this.bounds.getSouth())*s);return t.x>=h&&t.x<g&&t.y>=m&&t.y<x}}class ji extends i.E{constructor(t,s,h,m){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.aA(s,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new i.aD}load(t){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Ui(this._options,this.map._requestManager,s,h,(m,g)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new i.z(m));else if(g){if(i.l(this,g),this.hasWorldviews=!!g.worldview_options,g.worldview_default&&(this.worldviewDefault=g.worldview_default),g.vector_layers){this.vectorLayers=g.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const x of g.vector_layers)this.vectorLayerIds.push(x.id),g.worldview&&g.worldview[x.source]&&this.localizableLayerIds.add(x.id)}g.bounds&&(this.tileBounds=new mi(g.bounds,this.minzoom,this.maxzoom)),ir(g.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(t,s){const h=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(h),g=this.map._requestManager.transformRequest(m,i.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,I=x?{image:x.image.clone()}:null,P={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&i.f(h)&&(P.worldview=this.map.getWorldview()||this.worldviewDefault,P.localizableLayerIds=this.localizableLayerIds),P.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",P,z.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",P,z.bind(this),void 0,!0);else{const L=i.aE.call({deduped:this._deduped},P,(F,B)=>{F||!B?z.call(this,F):(P.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},t.actor&&t.actor.send("loadTile",P,z.bind(this),void 0,!0))},!0);t.request={cancel:L}}function z(L,F){return delete t.request,t.aborted?s(null):L&&L.status!==404?s(L):(F&&F.resourceTiming&&(t.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&t.setExpiryData(F),t.loadVectorData(F,this.map.painter),i.aF(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ma extends i.E{constructor(t,s,h,m){super(),this.id=t,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},s),i.l(this,i.aA(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Ui(this._options,this.map._requestManager,null,null,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new i.z(s)):h&&(i.l(this,h),h.raster_layers&&(this.rasterLayers=h.raster_layers,this.rasterLayerIds=this.rasterLayers.map(m=>m.id)),h.bounds&&(this.tileBounds=new mi(h.bounds,this.minzoom,this.maxzoom)),ir(h.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(s)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const h=i.q.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=i.o(this.map._requestManager.transformRequest(m,i.R.Tile),(g,x,I,P)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):g?(t.state="errored",s(g)):x?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:I,expires:P}),t.setTexture(x,this.map.painter),t.state="loaded",i.aF(this.dispatcher),void s(null)):s(null)))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof i.T?(t.destroy(!0),t.texture&&t.texture instanceof i.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ws extends ma{constructor(t,s,h,m){super(t,s,h,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this.iconsets={},this._options=i.l({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);s&&s.enabled&&h&&s._clearRenderCacheForTile(h.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(h,i.R.Tile),g={request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor());const x=(I,P,z,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(I)return I.name==="AbortError"?void 0:(t.state="errored",s(I));if(this.map._refreshExpiredTiles&&P&&t.setExpiryData({cacheControl:z,expires:L}),this.partial)t.state="empty";else{if(!P)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=P;const F=new Map;for(const B in t._mrt.layers){const j=t.getLayer(B);if(j)for(const X of j.getBandList()){const{bytes:q,tileSize:J,buffer:Q}=j.getBandView(X),oe=J+2*Q,ue={data:new i.r({width:oe,height:oe},q),pixelRatio:2,sdf:!1,usvg:!1,version:0};F.set(`${B}/${X}`,ue)}}for(const B in this.iconsets)this.iconsets[B].addIcons(F)}s(null)};t.request=this.partial?t.fetchHeader(void 0,x.bind(this)):t.actor.send("loadTile",g,x.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const h=t.texture;h&&h instanceof i.T?(t.destroy(!0),this.map.painter.saveTileTexture(h)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,s,h){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(s,h,(m,g)=>{if(m)return t.state="errored",this.fire(new i.z(m)),void this.triggerRepaint(t);g&&(t._isHeaderLoaded=!0,t.setTexture(g,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:g})=>g===t),h=s&&s.fields,m=h&&h.bands&&h.bands;return m?m[0]:0}getTextureDescriptor(t,s,h){if(!t)return;const m=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let g=null;s instanceof i.aI?g=s.paint.get("raster-array-band"):s instanceof i.aJ&&(g=s.paint.get("raster-particle-array-band"));const x=g||this.getInitialBand(m);if(x!=null)if(t.textureDescriptor){if(!t.updateNeeded(m,x)||h)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,m,x)}addIconset(t,s){this.iconsets[t]=s,this.partial=!1}}const qa={vector:ji,raster:ma,"raster-dem":class extends ma{constructor(d,t,s,h){super(d,t,s,h),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(d,t){const s=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,g){m&&(d.state="errored",t(m)),g&&(d.dem=g,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=i.o(this.map._requestManager.transformRequest(s,i.R.Tile),(function(m,g,x,I){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(m)d.state="errored",t(m);else if(g){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:x,expires:I});const P=ImageBitmap&&g instanceof ImageBitmap&&i.t(),z=1-(g.width-i.aG(g.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const L=P?g:i.q.getImageData(g,z),F={uid:d.uid,tileID:d.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:z};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadTile",F,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const t=d.canonical,s=Math.pow(2,t.z),h=(t.x-1+s)%s,m=t.x===0?d.wrap-1:d.wrap,g=(t.x+1+s)%s,x=t.x+1===s?d.wrap+1:d.wrap,I={};return I[new i.aH(d.overscaledZ,m,t.z,h,t.y).key]={backfilled:!1},I[new i.aH(d.overscaledZ,x,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(I[new i.aH(d.overscaledZ,m,t.z,h,t.y-1).key]={backfilled:!1},I[new i.aH(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},I[new i.aH(d.overscaledZ,x,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<s&&(I[new i.aH(d.overscaledZ,m,t.z,h,t.y+1).key]={backfilled:!1},I[new i.aH(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},I[new i.aH(d.overscaledZ,x,t.z,g,t.y+1).key]={backfilled:!1}),I}},"raster-array":ws,geojson:class extends i.E{constructor(d,t,s,h){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=t.data,this._options=i.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=i.ai/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:i.ai,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:i.ai,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of d.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterLeaves(d,t,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:t,offset:s},h),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=i.l({append:d},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(i.q.resolveURL(s),i.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(h,m)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new i.z(h));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(g.resourceTiming=m.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new i.A("data",g)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const d=i.C(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,t){const s=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const h=this.map.style?this.map.style.getLut(this.scope):null,m=h?{image:h.image.clone()}:null,g=this._partialReload,x={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:g};d.request=this.actor.send(s,x,(I,P)=>g&&!P?(d.state="loaded",t(null)):(delete d.request,d.destroy(),d.aborted?t(null):I?t(I):(d.loadVectorData(P,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,t){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aK{constructor(d,t,s,h){super(d,t,s,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,i.R.Source).url);i.aL(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new i.z(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,t=d.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(d,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aK,model:class extends i.E{constructor(d,t,s,h){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const d=[];for(const t in this._options.models){const s=this._options.models[t],h=i.aN(this.map._requestManager.transformRequest(s.uri,i.R.Model).url).then(m=>{if(!m)return;const g=i.aO(m),x=new i.aP(t,s.position,s.orientation,g);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(m=>{this.fire(new i.z(new Error(`Could not load model ${t} from ${s.uri}: ${m.message}`)))});d.push(h)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new i.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,t){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(d,t,s,h){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=Ui(this._options,this.map._requestManager,t,s,(h,m)=>{this._tileJSONRequest=null,this._loaded=!0,h?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new i.z(h))):m&&(i.l(this,m),m.bounds&&(this.tileBounds=new mi(m.bounds,this.minzoom,this.maxzoom)),ir(m.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),d&&d(h)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,t){const s=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,i.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=t;else{if(d.buckets){const g=Object.values(d.buckets);for(const x of g)x.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",h,m.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",h,m.bind(this),void 0,!0);function m(g,x){return d.aborted?t(null):g&&g.status!==404?t(g):(this.map._refreshExpiredTiles&&x&&d.setExpiryData(x),d.loadModelData(x,this.map.painter),d.state="loaded",void t(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aK{constructor(d,t,s,h){super(d,t,s,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(g=>typeof g!="number"))||this.fire(new i.z(new i.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${d}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof i.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends i.E{constructor(d,t,s,h){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new mi(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.aA(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:t,y:s,z:h}=d.canonical;return this._implementation.hasTile({x:t,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,t){const{x:s,y:h,z:m}=d.tileID.canonical,g=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:s,y:h,z:m},{signal:g.signal})).then((function(x){return delete d.request,d.aborted?(d.state="unloaded",t(null)):x===void 0?(d.state="errored",t(null)):x===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",t(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(x)?(this.loadTileData(d,x),d.state="loaded",void t(null)):(d.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.name!=="AbortError"&&(d.state="errored",t(x))}),d.request.cancel=()=>g.abort()}loadTileData(d,t){d.setTexture(t,this.map.painter)}unloadTile(d,t){if(d.texture&&d.texture instanceof i.T?(d.destroy(!0),d.texture&&d.texture instanceof i.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:s,y:h,z:m}=d.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:m})}t&&t()}abortTile(d,t){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=i.C(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},Qd=function(d,t,s,h){const m=new qa[t.type](d,t,s,h);if(m.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${m.id}`);return i.aQ(["load","abort","unload","serialize","prepare"],m),m};function ef(d,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${function(h){if("layerId"in h)return`layer:${h.layerId}`;{const{featuresetId:m,importId:g}=h;return`featureset:${m}${g?`:import:${g}`:""}`}}(d.target)}`}function Oc(d,t,s,h=""){if(d.uniqueFeatureID){const m=ef(d,t,h);if(s.has(m))return!0;s.add(m)}return!1}function kc(d,t,s,h,m=!1){const g=t.sourceCache.transform,x=t.sourceCache.tilesIn(d,t.has3DLayers,m);x.sort(rf);const I=[];for(const P of x){const z=P.tile.queryRenderedFeatures(t,P,s,h,g,m);Object.keys(z).length&&I.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:z})}return I.length===0?{}:function(P){const z={},L={};for(const F of P){const B=F.queryResults,j=F.wrappedTileID,X=L[j]=L[j]||{};for(const q in B){const J=B[q],Q=X[q]=X[q]||{},oe=z[q]=z[q]||[];for(const ue of J)Q[ue.featureIndex]||(Q[ue.featureIndex]=!0,oe.push(ue))}}return z}(I)}function tf(d,t,s,h,m){const g={},x=h.queryRenderedSymbols(d),I=[];for(const P of Object.keys(x).map(Number))I.push(m[P]);I.sort(rf);for(const P of I){const z=P.featureIndex.lookupSymbolFeatures(x[P.bucketInstanceId],P.bucketIndex,P.sourceLayerIndex,t,s);for(const L in z){const F=g[L]=g[L]||[],B=z[L];B.sort((j,X)=>{const q=P.featureSortOrder;if(q){const J=q.indexOf(j.featureIndex);return q.indexOf(X.featureIndex)-J}return X.featureIndex-j.featureIndex});for(const j of B)F.push(j)}}return g}function Km(d,t){const s=d.getRenderableIds().map(g=>d.getTileByID(g)),h=[],m={};for(let g=0;g<s.length;g++){const x=s[g],I=x.tileID.canonical.key;m[I]||(m[I]=!0,x.querySourceFeatures(h,t))}return h}function rf(d,t){const s=d.tileID,h=t.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function nf(d,t){const s={};if(!t)return s;for(const h of d){const m=h.layerIds.map(g=>t.getLayer(g)).filter(Boolean);if(m.length!==0){h.layers=m,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(g=>m.filter(x=>x.id===g)[0]));for(const g of m)s[g.fqid]=h}}return s}const Zi=32,to=33,Uo=new Uint16Array(8184);for(let d=0;d<2046;d++){let t=d+2,s=0,h=0,m=0,g=0,x=0,I=0;for(1&t?m=g=x=Zi:s=h=I=Zi;(t>>=1)>1;){const z=s+m>>1,L=h+g>>1;1&t?(m=s,g=h,s=x,h=I):(s=m,h=g,m=x,g=I),x=z,I=L}const P=4*d;Uo[P+0]=s,Uo[P+1]=h,Uo[P+2]=m,Uo[P+3]=g}const So=new Uint16Array(2178),ro=new Uint8Array(1089),Eo=new Uint16Array(1089);function Ku(d){return d===0?-.03125:d===32?.03125:0}const sf={type:2,extent:i.ai,loadGeometry:()=>[[new i.P(0,0),new i.P(i.ai+1,0),new i.P(i.ai+1,i.ai+1),new i.P(0,i.ai+1),new i.P(0,0)]]};class _a{constructor(t,s,h,m,g){this.tileID=t,this.uid=i.aW(),this.uses=0,this.tileSize=s,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(t){const s=t+this.timeAdded;s<i.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=nf(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const g=this.buckets[m];if(g instanceof i.aY){if(this.hasSymbolBuckets=!0,!h)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const g=this.buckets[m];if(g instanceof i.aY&&g.hasRTLText){this.hasRTLText=!0,i.aZ();break}}this.queryPadding=0;for(const m in this.buckets){const g=this.buckets[m],x=s.style.getOwnLayer(m);if(!x)continue;const I=x.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,I)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new i.aX}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,h){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,nf(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(t)}const s=t.gl,h=this.imageAtlas;h&&!h.uploaded&&(this.imageAtlasTexture=new i.T(t,h.image,s.RGBA8,{useMipmap:!!h.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(t,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(t,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,h),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=s.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(t,s,h,m,g,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=function(P,z){const L=i.ad.mat4.fromScaling([],[.5*P.width,.5*-P.height,1]);return i.ad.mat4.translate(L,L,[1,-1,0]),i.ad.mat4.multiply(L,L,P.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(L)}(g,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:I,transform:m,availableImages:h,tileTransform:this.tileTransform})}querySourceFeatures(t,s){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const m=h.loadVTLayers(),g=s?s.sourceLayer:"",x=m._geojsonTileLayer||m[g];if(!x)return;const I=i.a_(s&&s.filter),{z:P,x:z,y:L}=this.tileID.canonical,F={z:P,x:z,y:L};for(let B=0;B<x.length;B++){const j=x.feature(B);if(I.needGeometry){const J=i.a$(j,!0);if(!I.filter(new i.aa(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!I.filter(new i.aa(this.tileID.overscaledZ),j))continue;const X=h.getId(j,g),q=new i.b0(j,P,z,L,X);q.tile=F,t.push(q)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const h=i.b1(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let m=!1;if(this.expirationTime>h)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const g=this.expirationTime-s;g?this.expirationTime=h+Math.max(g,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const h=this.latestFeatureIndex.loadVTLayers(),m=t.style.listImages(),g=t.style.getBrightness();for(const x in this.buckets){if(!t.style.hasLayer(x))continue;const I=this.buckets[x],P=I.layers[0],z=P.sourceLayer||"_geojsonTileLayer",L=h[z],F=t.style.getLayerSourceCache(P);let B={};F&&(B=F._state.getState(z,void 0));const j=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},X=Object.keys(B).length>0&&!s;X&&!I.stateDependentLayers.length&&!s||I.update(B,L,m,j,X?I.stateDependentLayers:I.layers,s,g),(I instanceof i.b2||I instanceof i.b3)&&t._terrain&&t._terrain.enabled&&F&&I.uploadPending()&&t._terrain._clearRenderCacheForTile(F.id,this.tileID);const q=t&&t.style&&t.style.getOwnLayer(x);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=i.q.now()+t}setTexture(t,s){const h=s.context,m=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t):(this.texture=new i.T(h,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,s){const h={};for(const m of s)h[m]=!0;this.dependencies[t]=h}hasDependency(t,s){for(const h of t){const m=this.dependencies[h];if(m){for(const g of s)if(m[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const h=i.b4(sf,this.tileID.canonical,this.tileTransform)[0],m=new i.b5,g=new i.b6;for(let x=0;x<h.length;x++){const{x:I,y:P}=h[x];m.emplaceBack(I,P),g.emplaceBack(x)}g.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(m,i.b7.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,m.length,g.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const h=i.b4(sf,this.tileID.canonical,this.tileTransform)[0];let m,g;if(this.isRaster){const x=function(I,P){const z=i.aR(I,P),L=Math.pow(2,I.z);for(let J=0;J<to;J++)for(let Q=0;Q<to;Q++){const oe=i.aS((I.x+(Q+Ku(Q))/Zi)/L),ue=i.aT((I.y+(J+Ku(J))/Zi)/L),ce=P.project(oe,ue),ye=J*to+Q;So[2*ye+0]=Math.round((ce.x*z.scale-z.x)*i.ai),So[2*ye+1]=Math.round((ce.y*z.scale-z.y)*i.ai)}ro.fill(0),Eo.fill(0);for(let J=2045;J>=0;J--){const Q=4*J,oe=Uo[Q+0],ue=Uo[Q+1],ce=Uo[Q+2],ye=Uo[Q+3],pe=oe+ce>>1,ge=ue+ye>>1,me=pe+ge-ue,we=ge+oe-pe,Ee=ue*to+oe,He=ye*to+ce,Be=ge*to+pe,rt=Math.hypot((So[2*Ee+0]+So[2*He+0])/2-So[2*Be+0],(So[2*Ee+1]+So[2*He+1])/2-So[2*Be+1])>=16;ro[Be]=ro[Be]||(rt?1:0),J<1022&&(ro[Be]=ro[Be]||ro[(ue+we>>1)*to+(oe+me>>1)]||ro[(ye+we>>1)*to+(ce+me>>1)])}const F=new i.aU,B=new i.aV;let j=0;function X(J,Q){const oe=Q*to+J;return Eo[oe]===0&&(F.emplaceBack(So[2*oe+0],So[2*oe+1],J*i.ai/Zi,Q*i.ai/Zi),Eo[oe]=++j),Eo[oe]-1}function q(J,Q,oe,ue,ce,ye){const pe=J+oe>>1,ge=Q+ue>>1;if(Math.abs(J-ce)+Math.abs(Q-ye)>1&&ro[ge*to+pe])q(ce,ye,J,Q,pe,ge),q(oe,ue,ce,ye,pe,ge);else{const me=X(J,Q),we=X(oe,ue),Ee=X(ce,ye);B.emplaceBack(me,we,Ee)}}return q(0,0,Zi,Zi,Zi,0),q(Zi,Zi,0,0,0,Zi),{vertices:F,indices:B}}(this.tileID.canonical,s);m=x.vertices,g=x.indices}else{m=new i.aU,g=new i.aV;for(const{x:I,y:P}of h)m.emplaceBack(I,P,0,0);const x=i.b9(m.int16,void 0,4);for(let I=0;I<x.length;I+=3)g.emplaceBack(x[I],x[I+1],x[I+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,i.ba.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(g),this._tileBoundsSegments=i.b8.simpleSegment(0,0,m.length,g.length)}_makeGlobeTileDebugBuffers(t,s){const h=s.projection;if(!h||h.name!=="globe"||s.freezeTileCoverage)return;const m=this.tileID.canonical,g=i.bb(m,s),x=i.bc(g),I=i.ag(s.zoom);let P;I>0&&(P=i.ad.mat4.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,s,x,P,I),this._makeGlobeTileDebugTextBuffer(t,m,s,x,P,I)}_globePoint(t,s,h,m,g,x,I){let P=i.bd(t,s,h);if(x){const z=1<<h.z,L=i.av(m.center.lng),F=i.aC(m.center.lat),B=(h.x+.5)/z-L;let j=0;B>.5?j=-1:B<-.5&&(j=1);let X=(t/i.ai+h.x)/z+j,q=(s/i.ai+h.y)/z;X=(X-L)*m._pixelsPerMercatorPixel+L,q=(q-F)*m._pixelsPerMercatorPixel+F;const J=[X*m.worldSize,q*m.worldSize,0];i.ad.vec3.transformMat4(J,J,x),P=i.be(P,J,I)}return i.ad.vec3.transformMat4(P,P,g)}_makeGlobeTileDebugBorderBuffer(t,s,h,m,g,x){const I=new i.b5,P=new i.b6,z=new i.bf,L=(B,j,X,q,J)=>{const Q=(X-B)/(J-1),oe=(q-j)/(J-1),ue=I.length;for(let ce=0;ce<J;ce++){const ye=B+ce*Q,pe=j+ce*oe;I.emplaceBack(ye,pe);const ge=this._globePoint(ye,pe,s,h,m,g,x);z.emplaceBack(ge[0],ge[1],ge[2]),P.emplaceBack(ue+ce)}},F=i.ai;L(0,0,F,0,16),L(F,0,F,F,16),L(F,F,0,F,16),L(0,F,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(P),this._tileDebugBuffer=t.createVertexBuffer(I,i.b7.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(z,i.bg.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,I.length,P.length)}_makeGlobeTileDebugTextBuffer(t,s,h,m,g,x){const I=i.ai/4,P=new i.b5,z=new i.aV,L=new i.bf,F=25;z.reserve(32),P.reserve(F),L.reserve(F);const B=(j,X)=>F*j+X;for(let j=0;j<F;j++){const X=j*I;for(let q=0;q<F;q++){const J=q*I;P.emplaceBack(J,X);const Q=this._globePoint(J,X,s,h,m,g,x);L.emplaceBack(Q[0],Q[1],Q[2])}}for(let j=0;j<4;j++)for(let X=0;X<4;X++){const q=B(j,X),J=B(j,X+1),Q=B(j+1,X),oe=B(j+1,X+1);z.emplaceBack(q,J,Q),z.emplaceBack(Q,J,oe)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(z),this._tileDebugTextBuffer=t.createVertexBuffer(P,i.b7.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(L,i.bg.members),this._tileDebugTextSegments=i.b8.simpleSegment(0,0,F,32)}destroy(t=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bh.setPbf(i.bi);class ga extends _a{constructor(t,s,h,m,g){super(t,s,h,m,g),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,s){const h=s.context,m=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t,{premultiply:!1}):this.texture=new i.T(h,t,m.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,s){const h=this._mrt=new i.bh(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=i.bj(m,(g,x,I,P)=>{if(g)s(g);else try{const z=h.getHeaderLength(x);if(z>t)return void(this.request=this.fetchHeader(z,s));h.parseHeader(x),this._isHeaderLoaded=!0;let L=0;for(const F of Object.values(h.layers))L=Math.max(L,F.dataIndex[F.dataIndex.length-1].lastByte);x.byteLength>=L&&(this.entireBuffer=x),s(null,this.entireBuffer||x,I,P)}catch(z){s(z)}}),this.request}fetchBand(t,s,h){const m=this._mrt;if(!this._isHeaderLoaded||!m)return void h(new Error("Tile header is not ready"));const g=this.actor;if(!g)return void h(new Error("Can't fetch tile band without an actor"));let x;const I=(F,B)=>{x.complete(F,B),F?h(F):(this.updateTextureDescriptor(t,s),h(null,this.textureDescriptor&&this.textureDescriptor.img))},P=(F,B)=>{if(F)return h(F);const j=g.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:B,task:x},I,void 0,!0);this._workQueue.push(()=>{j&&j.cancel(),x.cancel()})},z=m.getLayer(t);if(!z)return void h(new Error(`Unknown sourceLayer "${t}"`));if(z.hasDataForBand(s))return this.updateTextureDescriptor(t,s),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);const L=z.getDataRange([s]);if(x=m.createDecodingTask(L),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)P(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{const F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),B=i.bj(F,P);this._fetchQueue.push(()=>{B.cancel(),x.cancel()})}else h(null)}updateNeeded(t,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,s){if(!this._mrt)return;const h=this._mrt.getLayer(t);if(!h||!h.hasBand(s)||!h.hasDataForBand(s))return;const{bytes:m,tileSize:g,buffer:x,offset:I,scale:P}=h.getBandView(s),z=g+2*x,L=new i.r({width:z,height:z},m),F=this.texture;F&&F instanceof i.T&&F.update(L,{premultiply:!1}),this.textureDescriptor={layer:t,band:s,img:L,buffer:x,offset:I,tileSize:g,format:h.pixelFormat,mix:[P,256*P,65536*P,16777216*P]}}}class Ts{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,h){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const g={value:s,timeout:void 0};if(h!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},h)),this.data[m].push(g),this.order.push(m),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const h=t.wrapped().key,m=s===void 0?0:this.data[h].indexOf(s),g=this.data[h][m];return this.data[h].splice(m,1),g.timeout&&clearTimeout(g.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(g.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const h in this.data)for(const m of this.data[h])t(m.value)||s.push(m);for(const h of s)this.remove(h.value.tileID,h)}}class Ym{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,h){const m=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},i.l(this.stateChanges[t][m],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==m&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const g in this.state[t][m])h[g]||(this.deletedStates[t][m][g]=null)}else for(const g in h)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][g]===null&&delete this.deletedStates[t][m][g]}removeFeatureState(t,s,h){if(this.deletedStates[t]===null)return;const m=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&s!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][h]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(h in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][h]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,s){const h=this.state[t]||{},m=this.stateChanges[t]||{},g=this.deletedStates[t];if(g===null)return{};if(s!==void 0){const I=String(s),P=i.l({},h[I],m[I]);if(g){const z=g[s];if(z===null)return{};for(const L in z)delete P[L]}return P}const x=i.l({},h,m);if(g)for(const I in g)delete x[I];return x}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const h={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const g={};for(const x in this.stateChanges[m])this.state[m][x]||(this.state[m][x]={}),i.l(this.state[m][x],this.stateChanges[m][x]),g[x]=this.state[m][x];h[m]=g}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const g={};if(this.deletedStates[m]===null)for(const x in this.state[m])g[x]={},this.state[m][x]={};else for(const x in this.deletedStates[m]){if(this.deletedStates[m][x]===null)this.state[m][x]={};else if(this.state[m][x])for(const I of Object.keys(this.deletedStates[m][x]))delete this.state[m][x][I];g[x]=this.state[m][x]}h[m]=h[m]||{},i.l(h[m],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const m in t)t[m].refreshFeatureState(s)}}class Ss extends i.E{constructor(t,s,h){super(),this.id=t,this._onlySymbols=h,s.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new Ts(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ym,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const h=this._tiles[s];h.upload(t),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(of).map(t=>t.key)}getRenderableIds(t,s){const h=[];for(const m in this._tiles)this._isIdRenderable(+m,t,s)&&h.push(this._tiles[m]);return t?h.sort((m,g)=>{const x=m.tileID,I=g.tileID,P=new i.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),z=new i.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-I.overscaledZ||z.y-P.y||z.x-P.x}).map(m=>m.tileID.key):h.map(m=>m.tileID).sort(of).map(m=>m.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(h||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=s),this._loadTile(h,this._tileLoaded.bind(this,h,t,s)))}_tileLoaded(t,s,h,m){if(m)if(t.state="errored",m.status!==404)this._source.fire(new i.z(m,{tile:t}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=i.q.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const g=s[m];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);h(t,x),h(x,t)}}function h(m,g){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let x=g.tileID.canonical.x-m.tileID.canonical.x;const I=g.tileID.canonical.y-m.tileID.canonical.y,P=Math.pow(2,m.tileID.canonical.z),z=g.tileID.key;x===0&&I===0||Math.abs(I)>1||(Math.abs(x)>1&&(Math.abs(x+P)===1?x+=P:Math.abs(x-P)===1&&(x-=P)),g.dem&&m.dem&&(m.dem.backfillBorder(g.dem,x,I),m.neighboringTiles&&m.neighboringTiles[z]&&(m.neighboringTiles[z].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,h,m){for(const g in this._tiles){let x=this._tiles[g];if(m[g]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>h)continue;let I=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const z=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[z.key],x&&x.hasData()&&(I=z)}let P=I;for(;P.overscaledZ>s;)if(P=P.scaledTo(P.overscaledZ-1),t[P.key]){m[I.key]=I;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=s?h:null}for(let h=t.overscaledZ-1;h>=s;h--){const m=t.scaledTo(h),g=this._getLoadedTile(m);if(g)return g}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const h=Math.ceil(t.width/s)+1,m=Math.ceil(t.height/s)+1,g=Math.floor(h*m*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(I)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const h={};for(const m in this._tiles){const g=this._tiles[m];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),h[g.tileID.key]=g}this._tiles=h;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,s,h,m){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const g=this._source.type==="batched-model";let x,I=this._source.maxzoom;const P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){const F=P.attenuationRange()[0],B=Math.floor(F)-Math.log2(P.getDemUpscale());I>B&&(I=B)}if(this.used||this.usedForTerrain){if(this._source.tileID)x=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new i.aH(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y));else if(this.tileCoverLift!==0){const F=t.clone();F.tileCoverLift=this.tileCoverLift,x=F.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.minzoom<=1&&t.projection.name==="globe"&&(x.push(new i.aH(1,0,1,0,0)),x.push(new i.aH(1,0,1,1,0)),x.push(new i.aH(1,0,1,0,1)),x.push(new i.aH(1,0,1,1,1)))}else if(x=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.hasTile){const F=this._source.hasTile.bind(this._source);x=x.filter(B=>F(B))}}else x=[];if(x.length>0&&this.castsShadows&&m&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!nn(this._source.type)){const F=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),B=Math.min(F,this._source.maxzoom);if(g){const j=t.extendTileCover(x,B);for(const X of j)x.push(X)}else{const j=t.extendTileCover(x,B,m);for(const X of j)this._shadowCasterTiles[X.key]=!0,x.push(X)}}const z=this._updateRetainedTiles(x);if(nn(this._source.type)&&x.length!==0){const F={},B={},j=Object.keys(z);for(const q of j){const J=z[q],Q=this._tiles[q];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=i.q.now())continue;const oe=this.findLoadedParent(J,Math.max(J.overscaledZ-Ss.maxOverzooming,this._source.minzoom));oe&&(this._addTile(oe.tileID),F[oe.tileID.key]=oe.tileID),B[q]=J}const X=x[x.length-1].overscaledZ;for(const q in this._tiles){const J=this._tiles[q];if(z[q]||!J.hasData())continue;let Q=J.tileID;for(;Q.overscaledZ>X;){Q=Q.scaledTo(Q.overscaledZ-1);const oe=this._tiles[Q.key];if(oe&&oe.hasData()&&B[Q.key]){z[q]=J.tileID;break}}}for(const q in F)z[q]||(this._coveredTiles[q]=!0,z[q]=F[q])}for(const F in z)this._tiles[F].clearFadeHold();const L=i.bk(this._tiles,z);for(const F of L){const B=this._tiles[F];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const h={},m=t.reduce((z,L)=>Math.min(z,L.overscaledZ),1/0),g=t[0].overscaledZ,x=Math.max(g-Ss.maxOverzooming,this._source.minzoom),I=Math.max(g+Ss.maxUnderzooming,this._source.minzoom),P={};for(const z of t){const L=this._addTile(z);s[z.key]=z,L.hasData()||m<this._source.maxzoom&&(P[z.key]=z)}this._retainLoadedChildren(P,m,I,s);for(const z of t){let L=this._tiles[z.key];if(L.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const B=z.children(this._source.maxzoom)[0],j=this.getTile(B);if(j&&j.hasData()){s[B.key]=B;continue}}else{const B=z.children(this._source.maxzoom);if(s[B[0].key]&&s[B[1].key]&&s[B[2].key]&&s[B[3].key])continue}let F=L.wasRequested();for(let B=z.overscaledZ-1;B>=x;--B){const j=z.scaledTo(B);if(h[j.key]||(h[j.key]=!0,L=this.getTile(j),!L&&F&&(L=this._addTile(j)),L&&(s[j.key]=j,F=L.wasRequested(),L.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let h,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){h=this._loadedParentTiles[m.key];break}s.push(m.key);const g=m.scaledTo(m.overscaledZ-1);if(h=this._getLoadedTile(g),h)break;m=g}for(const g of s)this._loadedParentTiles[g]=h}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const h=!!s;if(!h){const m=this.map?this.map.painter:null,g=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new ga(t,g,this.transform.tileZoom,m,this._isRaster):new _a(t,g,this.transform.tileZoom,m,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s?(s.uses++,this._tiles[t.key]=s,h||this._source.fire(new i.A("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=s.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,h){const m=[],g=this.transform;if(!g)return m;const x=g.projection.name==="globe",I=i.av(g.center.lng);for(const P in this._tiles){const z=this._tiles[P];if(h&&z.clearQueryDebugViz(),z.holdingForFade())continue;let L;if(x){const F=z.tileID.canonical;if(F.z===0){const B=[Math.abs(i.ay(I,...Fc(F,-1))-I),Math.abs(i.ay(I,...Fc(F,1))-I)];L=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(i.ay(I,...Fc(F,-1))-I),Math.abs(i.ay(I,...Fc(F,0))-I),Math.abs(i.ay(I,...Fc(F,1))-I)];L=[B.indexOf(Math.min(...B))-1]}}else L=[0];for(const F of L){const B=t.containsTile(z,g,s,F);B&&m.push(B)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const h=this.getRenderableIds(t,s).map(g=>this._tiles[g].tileID),m=this.transform.projection.name==="globe";for(const g of h)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=m?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return h}sortCoordinatesByDistance(t){const s=t.slice(),h=this.transform._camera.position,m=this.transform._camera.forward(),g={};for(const x of s){const I=1/(1<<x.canonical.z);g[x.key]=((x.canonical.x+.5)*I+x.wrap-h[0])*m[0]+((x.canonical.y+.5)*I-h[1])*m[1]-h[2]*m[2]}return s.sort((x,I)=>g[x.key]-g[I.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(nn(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(t,s,h){this._state.updateState(t=t||"_geojsonTileLayer",s,h)}removeFeatureState(t,s,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,h)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,h){const m=this._tiles[t];m&&m.setDependencies(s,h)}reloadTilesForDependencies(t,s){for(const h in this._tiles)this._tiles[h].hasDependency(t,s)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(t,s))}_preloadTiles(t,s){if(!this._sourceLoaded){const P=()=>{this._sourceLoaded&&(this._source.off("data",P),this._preloadTiles(t,s))};return void this._source.on("data",P)}const h=new Map,m=Array.isArray(t)?t:[t],g=this.map.painter.terrain,x=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const P of m){const z=P.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of z)h.set(L.key,L);this.usedForTerrain&&P.updateElevation(!1)}const I=Array.from(h.values());i.bl(I,(P,z)=>{const L=new _a(P,this._source.tileSize*P.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,F=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),z(F,L)})},s)}}function of(d,t){const s=Math.abs(2*d.wrap)-+(d.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||h-s||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function nn(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Fc(d,t){const s=1<<d.z;return[d.x/s+t,(d.x+1)/s+t]}Ss.maxOverzooming=10,Ss.maxUnderzooming=3;class ar{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const h in this.style._mergedLayers){const m=this.style._mergedLayers[h];if(m.type==="fill-extrusion")this.layers.push({layer:m,visible:t,visibilityChanged:s});else if(m.type==="model"){const g=this.style.getLayerSource(m);g&&g.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const h=s.layer;let m=!1;h.type==="fill-extrusion"?m=!h.isHidden(t)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="model"&&(m=!h.isHidden(t)&&h.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&s.visible,s.visible=m}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const m of this.layers){const g=m.layer,x=this.style.getLayerSourceCache(g);let I=1;g.type==="fill-extrusion"&&(I=m.visible?g.paint.get("fill-extrusion-vertical-scale"):0);let P=x?x.getTile(s):null;if(!P&&x&&s.canonical.z>x.getSource().minzoom){let z=s.scaledTo(Math.min(x.getSource().maxzoom,s.overscaledZ-1));for(;z.overscaledZ>=x.getSource().minzoom&&(P=x.getTile(z),!P&&z.overscaledZ!==0);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:P?P.getBucket(g):null,tileID:P?P.tileID:s,verticalScale:I})}t.hasAnyZOffset=!1;let h=!1;for(let m=0;m<t.symbolInstances.length;m++){const g=t.symbolInstances.get(m),x=g.zOffset,I=this._getHeightAtTileOffset(s,g.tileAnchorX,g.tileAnchorY);g.zOffset=I!==Number.NEGATIVE_INFINITY?I:x,h||x===g.zOffset||(h=!0),t.hasAnyZOffset||g.zOffset===0||(t.hasAnyZOffset=!0)}h&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,h,m){let g=s,x=h;if(t.canonical.z!==m.canonical.z){const I=m.canonical,P=1/(1<<t.canonical.z-I.z);g=(s+t.canonical.x*i.ai)*P-I.x*i.ai|0,x=(h+t.canonical.y*i.ai)*P-I.y*i.ai|0}return{tileX:g,tileY:x}}_getHeightAtTileOffset(t,s,h){let m,g;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;const{bucket:I,tileID:P,verticalScale:z}=this.currentBuildingBuckets[x];if(!I)continue;const{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(t,s,h,P),B=I.getHeightAtTileCoord(L,F);B&&B.height!==void 0&&(B.hidden?m=B.height:g=Math.max(B.height*z,g||0))}if(g!==void 0)return g;for(let x=0;x<this.layers.length;++x){const I=this.layers[x];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:P,tileID:z}=this.currentBuildingBuckets[x];if(!P)continue;const{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(t,s,h,z),B=P.getHeightAtTileCoord(L,F);if(B&&!B.hidden)return B.height===void 0&&m!==void 0?Math.min(B.maxHeight,m)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Jm(d,t){const s={};for(const h in d)h!=="ref"&&(s[h]=d[h]);return i.bm.forEach(h=>{h in t&&(s[h]=t[h])}),s}function af(d){d=d.slice();const t=Object.create(null);for(let s=0;s<d.length;s++)t[d[s].id]=d[s];for(let s=0;s<d.length;s++)"ref"in d[s]&&(d[s]=Jm(d[s],t[d[s].ref]));return d}const Xr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Yu(d,t,s){s.push({command:Xr.addSource,args:[d,t[d]]})}function Hs(d,t,s){t.push({command:Xr.removeSource,args:[d]}),s[d]=!0}function lf(d,t,s,h){Hs(d,s,h),Yu(d,t,s)}function Sl(d,t,s){let h;for(h in d[s])if(d[s].hasOwnProperty(h)&&h!=="data"&&!i.bn(d[s][h],t[s][h]))return!1;for(h in t[s])if(t[s].hasOwnProperty(h)&&h!=="data"&&!i.bn(d[s][h],t[s][h]))return!1;return!0}function Ht(d,t,s,h,m,g){let x;for(x in t=t||{},d=d||{})d.hasOwnProperty(x)&&(i.bn(d[x],t[x])||s.push({command:g,args:[h,x,t[x],m]}));for(x in t)t.hasOwnProperty(x)&&!d.hasOwnProperty(x)&&(i.bn(d[x],t[x])||s.push({command:g,args:[h,x,t[x],m]}))}function sn(d){return d.id}function Kr(d,t){return d[t.id]=t,d}class ss{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=i.ay(t,0,1);let s=1,h=this._distances[s];const m=t*this.paddedLength+this.padding;for(;h<m&&s<this._distances.length;)h=this._distances[++s];const g=s-1,x=this._distances[g],I=h-x,P=I>0?(m-x)/I:0;return this.points[g].mult(1-P).add(this.points[s].mult(P))}}class Wa{constructor(t,s,h){const m=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(s/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)m.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,h,m,g){this._forEachCell(s,h,m,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(g)}insertCircle(t,s,h,m){this._forEachCell(s-m,h-m,s+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(h),this.circles.push(m)}_insertBoxCell(t,s,h,m,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,s,h,m,g,x){this.circleCells[g].push(x)}_query(t,s,h,m,g,x){if(h<0||t>this.width||m<0||s>this.height)return!g&&[];const I=[];if(t<=0&&s<=0&&this.width<=h&&this.height<=m){if(g)return!0;for(let P=0;P<this.boxKeys.length;P++)I.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],L=this.circles[3*P+1],F=this.circles[3*P+2];I.push({key:this.circleKeys[P],x1:z-F,y1:L-F,x2:z+F,y2:L+F})}return x?I.filter(x):I}return this._forEachCell(t,s,h,m,this._queryCell,I,{hitTest:g,seenUids:{box:{},circle:{}}},x),g?I.length>0:I}_queryCircle(t,s,h,m,g){const x=t-h,I=t+h,P=s-h,z=s+h;if(I<0||x>this.width||z<0||P>this.height)return!m&&[];const L=[];return this._forEachCell(x,P,I,z,this._queryCellCircle,L,{hitTest:m,circle:{x:t,y:s,radius:h},seenUids:{box:{},circle:{}}},g),m?L.length>0:L}query(t,s,h,m,g){return this._query(t,s,h,m,!1,g)}hitTest(t,s,h,m,g){return this._query(t,s,h,m,!0,g)}hitTestCircle(t,s,h,m){return this._queryCircle(t,s,h,!0,m)}_queryCell(t,s,h,m,g,x,I,P){const z=I.seenUids,L=this.boxCells[g];if(L!==null){const B=this.bboxes;for(const j of L)if(!z.box[j]){z.box[j]=!0;const X=4*j;if(t<=B[X+2]&&s<=B[X+3]&&h>=B[X+0]&&m>=B[X+1]&&(!P||P(this.boxKeys[j]))){if(I.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[j],x1:B[X],y1:B[X+1],x2:B[X+2],y2:B[X+3]})}}}const F=this.circleCells[g];if(F!==null){const B=this.circles;for(const j of F)if(!z.circle[j]){z.circle[j]=!0;const X=3*j;if(this._circleAndRectCollide(B[X],B[X+1],B[X+2],t,s,h,m)&&(!P||P(this.circleKeys[j]))){if(I.hitTest)return x.push(!0),!0;{const q=B[X],J=B[X+1],Q=B[X+2];x.push({key:this.circleKeys[j],x1:q-Q,y1:J-Q,x2:q+Q,y2:J+Q})}}}}}_queryCellCircle(t,s,h,m,g,x,I,P){const z=I.circle,L=I.seenUids,F=this.boxCells[g];if(F!==null){const j=this.bboxes;for(const X of F)if(!L.box[X]){L.box[X]=!0;const q=4*X;if(this._circleAndRectCollide(z.x,z.y,z.radius,j[q+0],j[q+1],j[q+2],j[q+3])&&(!P||P(this.boxKeys[X])))return x.push(!0),!0}}const B=this.circleCells[g];if(B!==null){const j=this.circles;for(const X of B)if(!L.circle[X]){L.circle[X]=!0;const q=3*X;if(this._circlesCollide(j[q],j[q+1],j[q+2],z.x,z.y,z.radius)&&(!P||P(this.circleKeys[X])))return x.push(!0),!0}}}_forEachCell(t,s,h,m,g,x,I,P){const z=this._convertToXCellCoord(t),L=this._convertToYCellCoord(s),F=this._convertToXCellCoord(h),B=this._convertToYCellCoord(m);for(let j=z;j<=F;j++)for(let X=L;X<=B;X++)if(g.call(this,t,s,h,m,this.xCellCount*X+j,x,I,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,h,m,g,x){const I=m-t,P=g-s,z=h+x;return z*z>I*I+P*P}_circleAndRectCollide(t,s,h,m,g,x,I){const P=(x-m)/2,z=Math.abs(t-(m+P));if(z>P+h)return!1;const L=(I-g)/2,F=Math.abs(s-(g+L));if(F>L+h)return!1;if(z<=P||F<=L)return!0;const B=z-P,j=F-L;return B*B+j*j<=h*h}}const Hr={unknown:0,flipRequired:1,flipNotRequired:2},Ju=Math.tan(85*Math.PI/180);function jo(d,t,s,h,m,g,x){const I=i.ad.mat4.create();if(s)if(g.name==="globe"){const P=i.bo(m,t);i.ad.mat4.multiply(I,I,P)}else{const P=i.ad.mat2.invert([],x);I[0]=P[0],I[1]=P[1],I[4]=P[2],I[5]=P[3],h||i.ad.mat4.rotateZ(I,I,m.angle)}else i.ad.mat4.multiply(I,m.labelPlaneMatrix,d);return I}function Za(d,t,s,h,m,g,x){const I=jo(d,t,s,h,m,g,x);return g.name==="globe"&&s||(I[2]=I[6]=I[10]=I[14]=0),I}function Di(d,t,s,h,m,g,x){if(s){if(g.name==="globe"){const I=jo(d,t,s,h,m,g,x);return i.ad.mat4.invert(I,I),i.ad.mat4.multiply(I,d,I),I}{const I=i.ad.mat4.clone(d),P=i.ad.mat4.identity([]);return P[0]=x[0],P[1]=x[1],P[4]=x[2],P[5]=x[3],i.ad.mat4.multiply(I,I,P),h||i.ad.mat4.rotateZ(I,I,-m.angle),I}}return m.glCoordMatrix}function Mn(d,t,s,h){const m=[d,t,s,1];s?i.ad.vec4.transformMat4(m,m,h):Ka(m,m,h);const g=m[3];return m[0]/=g,m[1]/=g,m[2]/=g,m}function Qm(d,t){return Math.min(.5+d/t*.5,1.5)}function Bc(d,t){const s=d[0]/d[3],h=d[1]/d[3];return s>=-t[0]&&s<=t[0]&&h>=-t[1]&&h<=t[1]}function Qu(d,t,s,h,m,g,x,I,P,z){const L=s.transform,F=h?d.textSizeData:d.iconSizeData,B=i.bp(F,s.transform.zoom),j=L.projection.name==="globe",X=[256/s.width*2+1,256/s.height*2+1],q=h?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;q.clear();let J=null;j&&(J=h?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const Q=d.lineVertexArray,oe=h?d.text.placedSymbolArray:d.icon.placedSymbolArray,ue=s.transform.width/s.transform.height;let ce,ye=!1;for(let pe=0;pe<oe.length;pe++){const ge=oe.get(pe),{numGlyphs:me,writingMode:we}=ge;if(we!==i.bq.vertical||ye||ce===i.bq.horizontal||(ye=!0),ce=we,(ge.hidden||we===i.bq.vertical)&&!ye){Xa(me,q);continue}ye=!1;const Ee=new i.P(ge.tileAnchorX,ge.tileAnchorY);let{x:He,y:Be,z:rt}=L.projection.projectTilePoint(Ee.x,Ee.y,z.canonical);if(P){const[Mt,Lt,Wt]=P(Ee);He+=Mt,Be+=Lt,rt+=Wt}const nt=[He,Be,rt,1];if(i.ad.vec4.transformMat4(nt,nt,t),!Bc(nt,X)){Xa(me,q);continue}const yt=nt[3],Oe=Qm(s.transform.getCameraToCenterDistance(L.projection),yt),tt=i.br(F,B,ge),ze=x?tt/Oe:tt*Oe,Qe=Mn(He,Be,rt,m);if(Qe[3]<=0){Xa(me,q);continue}let Ze={};const at=i.ak(d.layers[0].layout.get("text-max-angle")),$e=Math.cos(at),ut=x?null:P,St=Nc(ge,ze,!1,I,t,m,g,d.glyphOffsetArray,Q,q,J,Qe,Ee,Ze,ue,ut,L.projection,z,x,$e);ye=St.useVertical,ut&&St.needsFlipping&&(Ze={}),(St.notEnoughRoom||ye||St.needsFlipping&&Nc(ge,ze,!0,I,t,m,g,d.glyphOffsetArray,Q,q,J,Qe,Ee,Ze,ue,ut,L.projection,z,x,$e).notEnoughRoom)&&Xa(me,q)}h?(d.text.dynamicLayoutVertexBuffer.updateData(q),J&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(J)):(d.icon.dynamicLayoutVertexBuffer.updateData(q),J&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(J))}function El(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J){const{lineStartIndex:Q,glyphStartIndex:oe,segment:ue}=I,ce=oe+I.numGlyphs,ye=Q+I.lineLength,pe=t.getoffsetX(oe),ge=t.getoffsetX(ce-1),me=Mi(d*pe,s,h,m,g,x,ue,Q,ye,P,z,L,F,B,!0,j,X,q,J);if(!me)return null;const we=Mi(d*ge,s,h,m,g,x,ue,Q,ye,P,z,L,F,B,!0,j,X,q,J);return we?{first:me,last:we}:null}function eh(d,t,s,h){return d===i.bq.horizontal&&Math.abs(h)>Math.abs(s)?{useVertical:!0}:d===i.bq.vertical?h>0?{needsFlipping:!0}:null:t!==Hr.unknown&&function(m,g){return m===0||Math.abs(g/m)>Ju}(s,h)?t===Hr.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Nc(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe,ue){const ce=t/24,ye=d.lineOffsetX*ce,pe=d.lineOffsetY*ce,{lineStartIndex:ge,glyphStartIndex:me,numGlyphs:we,segment:Ee,writingMode:He,flipState:Be}=d,rt=ge+d.lineLength,nt=yt=>{if(L){const[Qe,Ze,at]=yt.up,$e=z.length;i.bs(L,$e+0,Qe,Ze,at),i.bs(L,$e+1,Qe,Ze,at),i.bs(L,$e+2,Qe,Ze,at),i.bs(L,$e+3,Qe,Ze,at)}const[Oe,tt,ze]=yt.point;i.bt(z,Oe,tt,ze,yt.angle)};if(we>1){const yt=El(ce,I,ye,pe,s,F,B,d,P,g,j,q,!1,J,Q,oe,ue);if(!yt)return{notEnoughRoom:!0};if(h&&!s){let[Oe,tt,ze]=yt.first.point,[Qe,Ze,at]=yt.last.point;[Oe,tt]=Mn(Oe,tt,ze,x),[Qe,Ze]=Mn(Qe,Ze,at,x);const $e=eh(He,Be,(Qe-Oe)*X,Ze-tt);if(d.flipState=$e&&$e.needsFlipping?Hr.flipRequired:Hr.flipNotRequired,$e)return $e}nt(yt.first);for(let Oe=me+1;Oe<me+we-1;Oe++){const tt=Mi(ce*I.getoffsetX(Oe),ye,pe,s,F,B,Ee,ge,rt,P,g,j,q,!1,!1,J,Q,oe,ue);if(!tt)return z.length-=4*(Oe-me),{notEnoughRoom:!0};nt(tt)}nt(yt.last)}else{if(h&&!s){const Oe=Mn(B.x,B.y,0,m),tt=ge+Ee+1,ze=new i.P(P.getx(tt),P.gety(tt)),Qe=Mn(ze.x,ze.y,0,m),Ze=Qe[3]>0?Qe:Ao(B,ze,Oe,1,m,void 0,J,Q.canonical),at=eh(He,Be,(Ze[0]-Oe[0])*X,Ze[1]-Oe[1]);if(d.flipState=at&&at.needsFlipping?Hr.flipRequired:Hr.flipNotRequired,at)return at}const yt=Mi(ce*I.getoffsetX(me),ye,pe,s,F,B,Ee,ge,rt,P,g,j,q,!1,!1,J,Q,oe,ue);if(!yt)return{notEnoughRoom:!0};nt(yt)}return{}}function $i(d,t,s,h,m){const{x:g,y:x,z:I}=h.projectTilePoint(d.x,d.y,t);if(!m)return Mn(g,x,I,s);const[P,z,L]=m(d);return Mn(g+P,x+z,I+L,s)}function Ao(d,t,s,h,m,g,x,I){const P=$i(d.sub(t)._unit()._add(d),I,m,x,g);return i.ad.vec3.sub(P,s,P),i.ad.vec3.normalize(P,P),i.ad.vec3.scaleAndAdd(P,s,P,h)}function Mi(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe){const ue=h?d-t:d+t;let ce=ue>0?1:-1,ye=0;h&&(ce*=-1,ye=Math.PI),ce<0&&(ye+=Math.PI);let pe=I+x+(ce>0?0:1)|0,ge=m,me=m,we=0,Ee=0;const He=Math.abs(ue),Be=[],rt=[];let nt=g,yt=nt,Oe=i.ad.vec3.zero([]);const tt=()=>Ao(yt,nt,me,He-we+1,L,B,q,J.canonical);for(;we+Ee<=He;){if(pe+=ce,pe<I||pe>=P)return null;if(me=ge,yt=nt,Be.push(me),j&&rt.push(yt),nt=new i.P(z.getx(pe),z.gety(pe)),ge=F[pe],!ge){const Wt=$i(nt,J.canonical,L,q,B);ge=Wt[3]>0?F[pe]=Wt:tt()}we+=Ee;const Mt=i.ad.vec3.sub([],ge,me),Lt=i.ad.vec3.distance(me,ge);if(s&&Lt>0&&Ee>0&&i.ad.vec3.dot(Oe,Mt)/(Ee*Lt)<oe)return null;Ee=Lt,Oe=Mt}X&&B&&(F[pe]&&(ge=tt(),Ee=i.ad.vec3.distance(me,ge),Oe=i.ad.vec3.sub([],ge,me)),F[pe]=ge);const ze=(He-we)/Ee,Qe=nt.sub(yt)._mult(ze)._add(yt),Ze=i.ad.vec3.scaleAndAdd([],me,Oe,ze);let at=[0,0,1],$e=Oe[0],ut=Oe[1];if(Q&&(at=q.upVector(J.canonical,Qe.x,Qe.y),at[0]!==0||at[1]!==0||at[2]!==1)){const Mt=[at[2],0,-at[0]],Lt=i.ad.vec3.cross([],at,Mt);i.ad.vec3.normalize(Mt,Mt),i.ad.vec3.normalize(Lt,Lt),$e=i.ad.vec3.dot(Oe,Mt),ut=i.ad.vec3.dot(Oe,Lt)}if(s){const Mt=i.ad.vec3.cross([],at,Oe);i.ad.vec3.normalize(Mt,Mt),i.ad.vec3.scaleAndAdd(Ze,Ze,Mt,s*ce)}const St=ye+Math.atan2(ut,$e);return Be.push(Ze),j&&rt.push(Qe),{point:Ze,angle:St,path:Be,tilePath:rt,up:at}}function Xa(d,t){const s=t.length,h=s+4*d;t.resize(h),t.float32.fill(-1/0,4*s,4*h)}function Ka(d,t,s){const h=t[0],m=t[1];return d[0]=s[0]*h+s[4]*m+s[12],d[1]=s[1]*h+s[5]*m+s[13],d[3]=s[3]*h+s[7]*m+s[15],d}const Fn=100;class no{constructor(t,s,h=new Wa(t.width+200,t.height+200,25),m=new Wa(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Fn,this.screenBottomBoundary=t.height+Fn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,h,m,g,x,I,P){let z=h.projectedAnchorX,L=h.projectedAnchorY,F=h.projectedAnchorZ;const B=h.elevation,j=h.tileID,X=t.getProjection();if(B&&j){const[pe,ge,me]=X.upVector(j.canonical,h.tileAnchorX,h.tileAnchorY),we=X.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=pe*B*we,L+=ge*B*we,F+=me*B*we}const q=this.projectAndGetPerspectiveRatio(I,z,L,F,h.tileID,X.name==="globe"||!!B||this.transform.pitch>0,X),J=x*q.perspectiveRatio,Q=(h.x1*s+m.x-h.padding)*J+q.point.x,oe=(h.y1*s+m.y-h.padding)*J+q.point.y,ue=(h.x2*s+m.x+h.padding)*J+q.point.x,ce=(h.y2*s+m.y+h.padding)*J+q.point.y,ye=q.perspectiveRatio<=.55||q.occluded;return!this.isInsideGrid(Q,oe,ue,ce)||!g&&this.grid.hitTest(Q,oe,ue,ce,P)||ye?{box:[],offscreen:!1,occluded:q.occluded}:{box:[Q,oe,ue,ce],offscreen:this.isOffscreen(Q,oe,ue,ce),occluded:!1}}placeCollisionCircles(t,s,h,m,g,x,I,P,z,L,F,B,j,X,q){const J=[],Q=this.transform.elevation,oe=t.getProjection(),ue=Q?Q.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,oe):null,ce=new i.P(h.tileAnchorX,h.tileAnchorY);let{x:ye,y:pe,z:ge}=oe.projectTilePoint(ce.x,ce.y,q.canonical);if(ue){const[at,$e,ut]=ue(ce);ye+=at,pe+=$e,ge+=ut}const me=oe.name==="globe",we=this.projectAndGetPerspectiveRatio(I,ye,pe,ge,q,me||!!Q||this.transform.pitch>0,oe),{perspectiveRatio:Ee}=we,He=(F?x/Ee:x*Ee)/i.bw,Be=Mn(ye,pe,ge,P),rt=h.lineOffsetX*He,nt=h.lineOffsetY*He,yt=i.ak(t.layers[0].layout.get("text-max-angle")),Oe=Math.cos(yt),tt=we.signedDistanceFromCamera>0?El(He,g,rt,nt,!1,Be,ce,h,m,P,{},Q&&!F?ue:null,F&&!!Q,oe,q,F,Oe):null;let ze=!1,Qe=!1,Ze=!0;if(tt&&!we.occluded){const at=.5*j*Ee+X,$e=new i.P(-100,-100),ut=new i.P(this.screenRightBoundary,this.screenBottomBoundary),St=new ss,{first:Mt,last:Lt}=tt,Wt=Mt.path.length;let pr=[];for(let hr=Wt-1;hr>=1;hr--)pr.push(Mt.path[hr]);for(let hr=1;hr<Lt.path.length;hr++)pr.push(Lt.path[hr]);const sr=2.5*at;z&&(pr=pr.map(([hr,Br,on],mn)=>(ue&&!me&&(on=ue(mn<Wt-1?Mt.tilePath[Wt-1-mn]:Lt.tilePath[mn-Wt+2])[2]),Mn(hr,Br,on,z))),pr.some(hr=>hr[3]<=0)&&(pr=[]));let mr=[];if(pr.length>0){let hr=1/0,Br=-1/0,on=1/0,mn=-1/0;for(const zr of pr)hr=Math.min(hr,zr[0]),on=Math.min(on,zr[1]),Br=Math.max(Br,zr[0]),mn=Math.max(mn,zr[1]);Br>=$e.x&&hr<=ut.x&&mn>=$e.y&&on<=ut.y&&(mr=[pr.map(zr=>new i.P(zr[0],zr[1]))],(hr<$e.x||Br>ut.x||on<$e.y||mn>ut.y)&&(mr=i.bu(mr,$e.x,$e.y,ut.x,ut.y)))}for(const hr of mr){St.reset(hr,.25*at);let Br=0;Br=St.length<=.5*at?1:Math.ceil(St.paddedLength/sr)+1;for(let on=0;on<Br;on++){const mn=on/Math.max(Br-1,1),zr=St.lerp(mn),On=zr.x+Fn,wr=zr.y+Fn;J.push(On,wr,at,0);const gr=On-at,or=wr-at,en=On+at,tn=wr+at;if(Ze=Ze&&this.isOffscreen(gr,or,en,tn),Qe=Qe||this.isInsideGrid(gr,or,en,tn),!s&&this.grid.hitTestCircle(On,wr,at,B)&&(ze=!0,!L))return{circles:[],offscreen:!1,collisionDetected:ze,occluded:!1}}}}return{circles:!L&&ze||!Qe?[]:J,offscreen:Ze,collisionDetected:ze,occluded:we.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,m=1/0,g=-1/0,x=-1/0;for(const L of t){const F=new i.P(L.x+Fn,L.y+Fn);h=Math.min(h,F.x),m=Math.min(m,F.y),g=Math.max(g,F.x),x=Math.max(x,F.y),s.push(F)}const I=this.grid.query(h,m,g,x).concat(this.ignoredGrid.query(h,m,g,x)),P={},z={};for(const L of I){const F=L.key;if(P[F.bucketInstanceId]===void 0&&(P[F.bucketInstanceId]={}),P[F.bucketInstanceId][F.featureIndex])continue;const B=[new i.P(L.x1,L.y1),new i.P(L.x2,L.y1),new i.P(L.x2,L.y2),new i.P(L.x1,L.y2)];i.bv(s,B)&&(P[F.bucketInstanceId][F.featureIndex]=!0,z[F.bucketInstanceId]===void 0&&(z[F.bucketInstanceId]=[]),z[F.bucketInstanceId].push(F.featureIndex))}return z}insertCollisionBox(t,s,h,m,g){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,h,m,g){const x=s?this.ignoredGrid:this.grid,I={bucketInstanceId:h,featureIndex:m,collisionGroupID:g};for(let P=0;P<t.length;P+=4)x.insertCircle(I,t[P],t[P+1],t[P+2])}projectAndGetPerspectiveRatio(t,s,h,m,g,x,I){const P=[s,h,m,1];let z=!1;m||this.transform.pitch>0?(i.ad.vec4.transformMat4(P,P,t),this.fogState&&g&&I.name!=="globe"&&(z=function(B,j,X,q,J,Q){const oe=Q.calculateFogTileMatrix(J),ue=[j,X,q];return i.ad.vec3.transformMat4(ue,ue,oe),Nt(B,i.ad.vec3.length(ue),Q.pitch,Q._fov)}(this.fogState,s,h,m,g.toUnwrapped(),this.transform)>.9)):Ka(P,P,t);const L=P[3];return{point:new i.P((P[0]/L+1)/2*this.transform.width+Fn,(-P[1]/L+1)/2*this.transform.height+Fn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/L*.5,1.5),signedDistanceFromCamera:L,occluded:x&&P[2]>L||z}}isOffscreen(t,s,h,m){return h<Fn||t>=this.screenRightBoundary||m<Fn||s>this.screenBottomBoundary}isInsideGrid(t,s,h,m){return h>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=i.ad.mat4.identity([]);return i.ad.mat4.translate(t,t,[-100,-100,0]),t}}function io(d,t,s){const h=t.createTileMatrix(d,d.worldSize,s.toUnwrapped());return i.ad.mat4.multiply(new Float32Array(16),d.projMatrix,h)}function li(d,t,s){if(t.projection.name===s.projection.name)return d.projMatrix;const h=s.clone();return h.setProjection(t.projection),io(h,t.getProjection(),d)}function Vc(d,t,s){return t.name===s.projection.name?d.projMatrix:io(s,t,d)}class qs{constructor(t,s,h,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class $o{constructor(t,s,h,m,g,x=!1){this.text=new qs(t?t.text:null,s,h,g),this.icon=new qs(t?t.icon:null,s,m,g),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Al{constructor(t,s,h,m=!1){this.text=t,this.icon=s,this.skipFade=h,this.clipped=m}}class Ya{constructor(){this.invProjMatrix=i.ad.mat4.create(),this.viewportMatrix=i.ad.mat4.create(),this.circles=[]}}class h0{constructor(t,s,h,m,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=g}}class Go{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[t]}}function e_(d,t,s,h,m){const{horizontalAlign:g,verticalAlign:x}=i.bD(d),I=-(g-.5)*t,P=-(x-.5)*s,z=i.bC(d,h);return new i.P(I+z[0]*m,P+z[1]*m)}function Uc(d,t,s,h,m){const g=new i.P(d,t);return s&&g._rotate(h?m:-m),g}class os{constructor(t,s,h,m,g,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new no(this.transform,g),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Go(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,h,m,g=1){const x=h.getBucket(s),I=h.latestFeatureIndex;if(!x||!I||s.fqid!==x.layerIds[0])return;const P=x.layers[0].layout,z=x.layers[0].paint,L=h.collisionBoxArray,F=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),B=h.tileSize/i.ai,j=h.tileID.toUnwrapped();this.transform.setProjection(x.projection);const X=(q=h.tileID,J=x.getProjection(),Q=this.transform,J.name===this.projection?Q.calculateProjMatrix(q.toUnwrapped()):io(Q,J,q));var q,J,Q;const oe=P.get("text-pitch-alignment")==="map",ue=P.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const ce=s.dynamicFilter(),ye=s.dynamicFilterNeedsFeature(),pe=this.transform.calculatePixelsToTileUnitsMatrix(h),ge=Za(X,h.tileID.canonical,oe,ue,this.transform,x.getProjection(),pe);let me=null;if(oe){const tt=Di(X,h.tileID.canonical,oe,ue,this.transform,x.getProjection(),pe);me=i.ad.mat4.multiply([],this.transform.labelPlaneMatrix,tt)}let we=null;ce&&h.latestFeatureIndex&&(we={unwrappedTileID:j,dynamicFilter:ce,dynamicFilterNeedsFeature:ye}),this.retainedQueryData[x.bucketInstanceId]=new h0(x.bucketInstanceId,I,x.sourceLayerIndex,x.index,h.tileID);const[Ee,He]=x.layers[0].layout.get("text-size-scale-range"),Be=i.ay(g,Ee,He),[rt,nt]=P.get("icon-size-scale-range"),yt=i.ay(g,rt,nt),Oe={bucket:x,layout:P,paint:z,posMatrix:X,textLabelPlaneMatrix:ge,labelToScreenMatrix:me,clippingData:we,scale:F,textPixelRatio:B,holdingForFade:h.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:i.bp(x.textSizeData,this.transform.zoom,Be),partiallyEvaluatedIconSize:i.bp(x.iconSizeData,this.transform.zoom,yt),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(m)for(const tt of x.sortKeyRanges){const{sortKey:ze,symbolInstanceStart:Qe,symbolInstanceEnd:Ze}=tt;t.push({sortKey:ze,symbolInstanceStart:Qe,symbolInstanceEnd:Ze,parameters:Oe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Oe})}attemptAnchorPlacement(t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe){const{textOffset0:ue,textOffset1:ce,crossTileID:ye}=B,pe=[ue,ce],ge=e_(t,h,m,pe,g),me=this.collisionIndex.placeCollisionBox(X,g,s,Uc(ge.x,ge.y,x,I,this.transform.angle),F,P,z,L.predicate);if(J){const we=X.getSymbolInstanceIconSize(oe,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,we,J,Uc(ge.x,ge.y,x,I,this.transform.angle),F,P,z,L.predicate).box.length===0)return}if(me.box.length>0){let we;return this.prevPlacement&&this.prevPlacement.variableOffsets[ye]&&this.prevPlacement.placements[ye]&&this.prevPlacement.placements[ye].text&&(we=this.prevPlacement.variableOffsets[ye].anchor),this.variableOffsets[ye]={textOffset:pe,width:h,height:m,anchor:t,textScale:g,prevAnchor:we},this.markUsedJustification(X,t,B,q),X.allowVerticalPlacement&&(this.markUsedOrientation(X,q,B),this.placedOrientations[ye]=q),{shift:ge,placedGlyphBoxes:me}}}placeLayerBucketPart(t,s,h,m,g=1){const{bucket:x,layout:I,paint:P,posMatrix:z,textLabelPlaneMatrix:L,labelToScreenMatrix:F,clippingData:B,textPixelRatio:j,holdingForFade:X,collisionBoxArray:q,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:Q,collisionGroup:oe,latestFeatureIndex:ue}=t.parameters,ce=I.get("text-optional"),ye=I.get("icon-optional"),pe=I.get("text-allow-overlap"),ge=I.get("icon-allow-overlap"),me=I.get("text-rotation-alignment")==="map",we=I.get("text-pitch-alignment")==="map",Ee=P.get("symbol-z-offset"),He=I.get("symbol-elevation-reference")==="sea",[Be,rt]=I.get("text-size-scale-range"),[nt,yt]=I.get("icon-size-scale-range"),Oe=i.ay(g,Be,rt),tt=i.ay(g,nt,yt);this.transform.setProjection(x.projection);let ze=pe&&(ge||!x.hasIconData()||ye),Qe=ge&&(pe||!x.hasTextData()||ce);const Ze=!Ee.isConstant();!x.collisionArrays&&q&&x.deserializeCollisionBoxes(q),h&&m&&x.updateCollisionDebugBuffers(this.transform.zoom,q,Oe,tt);const at=($e,ut,St)=>{const{crossTileID:Mt,numVerticalGlyphVertices:Lt}=$e;let Wt=null;if(B&&B.dynamicFilterNeedsFeature||Ze){const rn=this.retainedQueryData[x.bucketInstanceId];Wt=ue.loadFeature({featureIndex:$e.featureIndex,bucketIndex:rn.bucketIndex,sourceLayerIndex:rn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Wt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new i.P($e.tileAnchorX,$e.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Mt]=new Al(!1,!1,!1,!0),void s.add(Mt);const pr=Ee.evaluate(Wt,{});if(s.has(Mt))return;if(X)return void(this.placements[Mt]=new Al(!1,!1,!1));let sr=!1,mr=!1,hr=!0,Br=!1,on=!1,mn=null,zr={box:null,offscreen:null,occluded:null},On={box:null},wr=null,gr=null,or=null,en=0,tn=0,Wn=0;St.textFeatureIndex?en=St.textFeatureIndex:$e.useRuntimeCollisionCircles&&(en=$e.featureIndex),St.verticalTextFeatureIndex&&(tn=St.verticalTextFeatureIndex);const fi=rn=>{rn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const Rn=this.transform.elevation;rn.elevation=He?pr:pr+(Rn?Rn.getAtTileOffset(rn.tileID,rn.tileAnchorX,rn.tileAnchorY):0),rn.elevation+=$e.zOffset},ts=St.textBox;if(ts){fi(ts);const rn=an=>{let _n=i.bq.horizontal;if(x.allowVerticalPlacement&&!an&&this.prevPlacement){const _i=this.prevPlacement.placedOrientations[Mt];_i&&(this.placedOrientations[Mt]=_i,_n=_i,this.markUsedOrientation(x,_n,$e))}return _n},Rn=(an,_n)=>{if(x.allowVerticalPlacement&&Lt>0&&St.verticalTextBox){for(const _i of x.writingModes)if(_i===i.bq.vertical?(zr=_n(),On=zr):zr=an(),zr&&zr.box&&zr.box.length)break}else zr=an()};if(I.get("text-variable-anchor")){let an=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Mt]){const Bn=this.prevPlacement.variableOffsets[Mt];an.indexOf(Bn.anchor)>0&&(an=an.filter(ci=>ci!==Bn.anchor),an.unshift(Bn.anchor))}const _n=(Bn,ci,zo)=>{const rs=x.getSymbolInstanceTextSize(J,$e,this.transform.zoom,ut),Ks=(Bn.x2-Bn.x1)*rs+2*Bn.padding,Jo=(Bn.y2-Bn.y1)*rs+2*Bn.padding,Oi=$e.hasIconTextFit&&!ge?ci:null;Oi&&fi(Oi);let Rs={box:[],offscreen:!1,occluded:!1};const Lo=pe?2*an.length:an.length;for(let co=0;co<Lo;++co){const Qo=this.attemptAnchorPlacement(an[co%an.length],Bn,Ks,Jo,rs,me,we,j,z,oe,co>=an.length,$e,ut,x,zo,Oi,J,Q);if(Qo&&(Rs=Qo.placedGlyphBoxes,Rs&&Rs.box&&Rs.box.length)){sr=!0,mn=Qo.shift;break}}return Rs};Rn(()=>_n(ts,St.iconBox,i.bq.horizontal),()=>{const Bn=St.verticalTextBox;return Bn&&fi(Bn),x.allowVerticalPlacement&&!(zr&&zr.box&&zr.box.length)&&Lt>0&&Bn?_n(Bn,St.verticalIconBox,i.bq.vertical):{box:null,offscreen:null,occluded:null}}),zr&&(sr=zr.box,hr=zr.offscreen,Br=zr.occluded);const _i=rn(!(!zr||!zr.box));if(!sr&&this.prevPlacement){const Bn=this.prevPlacement.variableOffsets[Mt];Bn&&(this.variableOffsets[Mt]=Bn,this.markUsedJustification(x,Bn.anchor,$e,_i))}}else{const an=(_n,_i)=>{const Bn=x.getSymbolInstanceTextSize(J,$e,this.transform.zoom,ut,g),ci=this.collisionIndex.placeCollisionBox(x,Bn,_n,new i.P(0,0),pe,j,z,oe.predicate);return ci&&ci.box&&ci.box.length&&(this.markUsedOrientation(x,_i,$e),this.placedOrientations[Mt]=_i),ci};Rn(()=>an(ts,i.bq.horizontal),()=>{const _n=St.verticalTextBox;return x.allowVerticalPlacement&&Lt>0&&_n?(fi(_n),an(_n,i.bq.vertical)):{box:null,offscreen:null,occluded:null}}),rn(!!(zr&&zr.box&&zr.box.length))}}if(wr=zr,sr=wr&&wr.box&&wr.box.length>0,hr=wr&&wr.offscreen,Br=wr&&wr.occluded,$e.useRuntimeCollisionCircles){const rn=x.text.placedSymbolArray.get($e.centerJustifiedTextSymbolIndex>=0?$e.centerJustifiedTextSymbolIndex:$e.verticalPlacedTextSymbolIndex),Rn=i.br(x.textSizeData,J,rn),an=I.get("text-padding");gr=this.collisionIndex.placeCollisionCircles(x,pe,rn,x.lineVertexArray,x.glyphOffsetArray,Rn,z,L,F,h,we,oe.predicate,$e.collisionCircleDiameter*Rn/i.bw,an,this.retainedQueryData[x.bucketInstanceId].tileID),sr=pe||gr.circles.length>0&&!gr.collisionDetected,hr=hr&&gr.offscreen,Br=gr.occluded}if(St.iconFeatureIndex&&(Wn=St.iconFeatureIndex),St.iconBox){const rn=Rn=>{fi(Rn);const an=$e.hasIconTextFit&&mn?Uc(mn.x,mn.y,me,we,this.transform.angle):new i.P(0,0),_n=x.getSymbolInstanceIconSize(Q,this.transform.zoom,$e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,_n,Rn,an,ge,j,z,oe.predicate)};On&&On.box&&On.box.length&&St.verticalIconBox?(or=rn(St.verticalIconBox),mr=or.box.length>0):(or=rn(St.iconBox),mr=or.box.length>0),hr=hr&&or.offscreen,on=or.occluded}const pi=ce||$e.numHorizontalGlyphVertices===0&&Lt===0,Ti=ye||$e.numIconVertices===0;if(pi||Ti?Ti?pi||(mr=mr&&sr):sr=mr&&sr:mr=sr=mr&&sr,sr&&wr&&wr.box&&this.collisionIndex.insertCollisionBox(wr.box,I.get("text-ignore-placement"),x.bucketInstanceId,On&&On.box&&tn?tn:en,oe.ID),mr&&or&&this.collisionIndex.insertCollisionBox(or.box,I.get("icon-ignore-placement"),x.bucketInstanceId,Wn,oe.ID),gr&&(sr&&this.collisionIndex.insertCollisionCircles(gr.circles,I.get("text-ignore-placement"),x.bucketInstanceId,en,oe.ID),h)){const rn=x.bucketInstanceId;let Rn=this.collisionCircleArrays[rn];Rn===void 0&&(Rn=this.collisionCircleArrays[rn]=new Ya);for(let an=0;an<gr.circles.length;an+=4)Rn.circles.push(gr.circles[an+0]),Rn.circles.push(gr.circles[an+1]),Rn.circles.push(gr.circles[an+2]),Rn.circles.push(gr.collisionDetected?1:0)}const Gi=x.projection.name!=="globe";ze=ze&&(Gi||!Br),Qe=Qe&&(Gi||!on),this.placements[Mt]=new Al(sr||ze,mr||Qe,hr||x.justReloaded),s.add(Mt)};if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.elevationType==="road"&&x.updateRoadElevation(),x.updateZOffset(),x.sortFeaturesByY){const $e=x.getSortedSymbolIndexes(this.transform.angle);for(let ut=$e.length-1;ut>=0;--ut){const St=$e[ut];at(x.symbolInstances.get(St),St,x.collisionArrays[St])}x.hasAnyZOffset&&i.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const $e=x.getSortedIndexesByZOffset();for(let ut=0;ut<$e.length;++ut){const St=$e[ut];at(x.symbolInstances.get(St),St,x.collisionArrays[St])}}else for(let $e=t.symbolInstanceStart;$e<t.symbolInstanceEnd;$e++)at(x.symbolInstances.get($e),$e,x.collisionArrays[$e]);if(h&&x.bucketInstanceId in this.collisionCircleArrays){const $e=this.collisionCircleArrays[x.bucketInstanceId];i.ad.mat4.invert($e.invProjMatrix,z),$e.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,s,h,m){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:P,crossTileID:z}=h,L=i.bB(s),F=m===i.bq.vertical?P:L==="left"?g:L==="center"?x:L==="right"?I:-1;g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=F>=0&&g!==F?0:z),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:z),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=F>=0&&I!==F?0:z),P>=0&&(t.text.placedSymbolArray.get(P).crossTileID=F>=0&&P!==F?0:z)}markUsedOrientation(t,s,h){const m=s===i.bq.horizontal||s===i.bq.horizontalOnly?s:0,g=s===i.bq.vertical?s:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:z}=h,L=t.text.placedSymbolArray;x>=0&&(L.get(x).placedOrientation=m),I>=0&&(L.get(I).placedOrientation=m),P>=0&&(L.get(P).placedOrientation=m),z>=0&&(L.get(z).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},x=s?s.variableOffsets:{},I=s?s.placedOrientations:{};for(const P in this.placements){const z=this.placements[P],L=g[P];L?(this.opacities[P]=new $o(L,m,z.text,z.icon,null,z.clipped),h=h||z.text!==L.text.placed||z.icon!==L.icon.placed):(this.opacities[P]=new $o(null,m,z.text,z.icon,z.skipFade,z.clipped),h=h||z.text||z.icon)}for(const P in g){const z=g[P];if(!this.opacities[P]){const L=new $o(z,m,!1,!1);L.isHidden()||(this.opacities[P]=L,h=h||z.text.placed||z.icon.placed)}}for(const P in x)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=x[P]);for(const P in I)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=I[P]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,h,m){const g=new Set;for(const x of s){const I=x.getBucket(t);I&&x.latestFeatureIndex&&t.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,g,x,x.collisionBoxArray,h,m,x.tileID,t.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,x.tileID),I.elevationType==="road"&&I.updateRoadElevation(),I.updateZOffset())}}updateBucketOpacities(t,s,h,m,g,x,I,P){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const z=t.layers[0].layout,L=t.layers[0].paint,F=!!t.layers[0].dynamicFilter(),B=new $o(null,0,!1,!1,!0),j=z.get("text-allow-overlap"),X=z.get("icon-allow-overlap"),q=z.get("text-variable-anchor"),J=z.get("text-rotation-alignment")==="map",Q=z.get("text-pitch-alignment")==="map",oe=L.get("symbol-z-offset"),ue=z.get("symbol-elevation-reference")==="sea",ce=!oe.isConstant(),ye=new $o(null,0,j&&(X||!t.hasIconData()||z.get("icon-optional")),X&&(j||!t.hasTextData()||z.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const pe=(me,we,Ee)=>{for(let He=0;He<we/4;He++)me.opacityVertexArray.emplaceBack(Ee)};let ge=0;x&&t.updateReplacement(I,x);for(let me=0;me<t.symbolInstances.length;me++){const we=t.symbolInstances.get(me),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:He,crossTileID:Be,numIconVertices:rt,tileAnchorX:nt,tileAnchorY:yt}=we;let Oe=null;const tt=this.retainedQueryData[t.bucketInstanceId];ce&&we&&tt&&(Oe=h.latestFeatureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:tt.bucketIndex,sourceLayerIndex:tt.sourceLayerIndex,layoutVertexArrayOffset:0}));const ze=oe.evaluate(Oe,{}),Qe=s.has(Be);let Ze=this.opacities[Be];Qe?Ze=B:Ze||(Ze=ye,this.opacities[Be]=Ze),s.add(Be);const at=Ee>0||He>0,$e=rt>0,ut=this.placedOrientations[Be],St=ut===i.bq.vertical,Mt=ut===i.bq.horizontal||ut===i.bq.horizontalOnly;!at&&!$e||Ze.isHidden()||ge++;let Lt=!1;if((at||$e)&&x)for(const Wt of t.activeReplacements){if(i.bx(Wt,g,i.by.Symbol,P)||Wt.min.x>nt||nt>Wt.max.x||Wt.min.y>yt||yt>Wt.max.y)continue;const pr=i.bz(nt,yt,I.canonical,Wt.footprintTileId.canonical);if(Lt=i.bA(pr,Wt.footprint),Lt)break}if(at){const Wt=Lt?so:r_(Ze.text);pe(t.text,Ee,St?so:Wt),pe(t.text,He,Mt?so:Wt);const pr=Ze.text.isHidden(),{leftJustifiedTextSymbolIndex:sr,centerJustifiedTextSymbolIndex:mr,rightJustifiedTextSymbolIndex:hr,verticalPlacedTextSymbolIndex:Br}=we,on=t.text.placedSymbolArray,mn=pr||St?1:0;sr>=0&&(on.get(sr).hidden=mn),mr>=0&&(on.get(mr).hidden=mn),hr>=0&&(on.get(hr).hidden=mn),Br>=0&&(on.get(Br).hidden=pr||Mt?1:0);const zr=this.variableOffsets[Be];zr&&this.markUsedJustification(t,zr.anchor,we,ut);const On=this.placedOrientations[Be];On&&(this.markUsedJustification(t,"left",we,On),this.markUsedOrientation(t,On,we))}if($e){const Wt=Lt?so:r_(Ze.icon),{placedIconSymbolIndex:pr,verticalPlacedIconSymbolIndex:sr}=we,mr=t.icon.placedSymbolArray,hr=Ze.icon.isHidden()?1:0;pr>=0&&(pe(t.icon,rt,St?so:Wt),mr.get(pr).hidden=hr),sr>=0&&(pe(t.icon,we.numVerticalIconVertices,Mt?so:Wt),mr.get(sr).hidden=hr)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Wt=t.collisionArrays[me];if(Wt){let pr=new i.P(0,0),sr=!0;if(Wt.textBox||Wt.verticalTextBox){if(q){const hr=this.variableOffsets[Be];hr?(pr=e_(hr.anchor,hr.width,hr.height,hr.textOffset,hr.textScale),J&&pr._rotate(Q?this.transform.angle:-this.transform.angle)):sr=!1}F&&(sr=!Ze.clipped),Wt.textBox&&th(t.textCollisionBox.collisionVertexArray,Ze.text.placed,!sr||St,ze,ue,pr.x,pr.y),Wt.verticalTextBox&&th(t.textCollisionBox.collisionVertexArray,Ze.text.placed,!sr||Mt,ze,ue,pr.x,pr.y)}const mr=sr&&!!(!Mt&&Wt.verticalIconBox);Wt.iconBox&&th(t.iconCollisionBox.collisionVertexArray,Ze.icon.placed,mr,ze,ue,we.hasIconTextFit?pr.x:0,we.hasIconTextFit?pr.y:0),Wt.verticalIconBox&&th(t.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!mr,ze,ue,we.hasIconTextFit?pr.x:0,we.hasIconTextFit?pr.y:0)}}}if(t.fullyClipped=ge===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=me.invProjMatrix,t.placementViewportMatrix=me.viewportMatrix,t.collisionCircleArray=me.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function th(d,t,s,h,m,g,x){d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0),d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0),d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0),d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0)}const rh=Math.pow(2,25),t_=Math.pow(2,24),jc=Math.pow(2,17),d0=Math.pow(2,16),f0=Math.pow(2,9),$c=Math.pow(2,8),Gc=Math.pow(2,1);function r_(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,s=Math.floor(127*d.opacity);return s*rh+t*t_+s*jc+t*d0+s*f0+t*$c+s*Gc+t}const so=0;class n_{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,h,m,g,x){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(I,m,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((P,z)=>P.sortKey-z.sortKey));this._currentPartIndex<I.length;){const P=I[this._currentPartIndex];if(s.placeLayerBucketPart(P,this._seenCrossTileIDs,h,P.symbolInstanceStart===0,x),this._currentPartIndex++,g())return!0}return!1}}class nh{constructor(t,s,h,m,g,x,I,P,z){this.placement=new os(t,g,x,I,P,z),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,h,m,g){const x=i.q.now(),I=()=>{const P=i.q.now()-x;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=s[t[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=z)&&(!P.maxzoom||P.maxzoom>z)){const L=P,F=L.layout.get("symbol-z-elevate"),B=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=L.layout.get("symbol-z-order"),X=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&B),q=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),J=X&&q,Q=this._inProgressLayer=this._inProgressLayer||new n_(L),oe=i.C(P.source,P.scope);if(Q.continuePlacement(F||J?m[oe]:h[oe],this.placement,this._showCollisionBoxes,P,I,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Mo=512/i.ai/2;class p0{constructor(t,s,h){this.tileID=t,this.bucketInstanceId=h,this.index=new i.bE(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=t.canonical.x*i.ai,g=t.canonical.y*i.ai;for(let x=0;x<s.length;x++){const{key:I,crossTileID:P,tileAnchorX:z,tileAnchorY:L}=s.get(x),F=Math.floor((m+z)*Mo),B=Math.floor((g+L)*Mo);this.index.add(F,B),this.keys.push(I),this.crossTileIDs.push(P)}this.index.finish()}findMatches(t,s,h){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),g=Mo/Math.pow(2,s.canonical.z-this.tileID.canonical.z),x=s.canonical.x*i.ai,I=s.canonical.y*i.ai;for(let P=0;P<t.length;P++){const z=t.get(P);if(z.crossTileID)continue;const{key:L,tileAnchorX:F,tileAnchorY:B}=z,j=Math.floor((x+F)*g),X=Math.floor((I+B)*g),q=this.index.range(j-m,X-m,j+m,X+m);for(const J of q){const Q=this.crossTileIDs[J];if(this.keys[J]===L&&!h.has(Q)){h.add(Q),z.crossTileID=Q;break}}}}}class m0{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const h in this.indexes){const m=this.indexes[h],g={};for(const x in m){const I=m[x];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+s),g[I.tileID.key]=I}this.indexes[h]=g}this.lng=t}addBucket(t,s,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const m=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const I in x){const P=x[I];P.tileID.isChildOf(t)&&P.findMatches(s.symbolInstances,t,m)}else{const I=x[t.scaledTo(Number(g)).key];I&&I.findMatches(s.symbolInstances,t,m)}}for(let g=0;g<s.symbolInstances.length;g++){const x=s.symbolInstances.get(g);x.crossTileID||(x.crossTileID=h.generate(),m.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new p0(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const h of s.crossTileIDs)this.usedCrossTileIDs[t].delete(h)}removeStaleBuckets(t){let s=!1;for(const h in this.indexes){const m=this.indexes[h];for(const g in m)t[m[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[g]),delete m[g],s=!0)}return s}}class i_{constructor(){this.layerIndexes={},this.crossTileIDs=new m0,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,h,m){let g=this.layerIndexes[t.fqid];g===void 0&&(g=this.layerIndexes[t.fqid]=new _0);let x=!1;const I={};m.name!=="globe"&&g.handleWrapJump(h);for(const P of s){const z=P.getBucket(t);z&&t.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(P.tileID,z,this.crossTileIDs)&&(x=!0),I[z.bucketInstanceId]=!0)}return g.removeStaleBuckets(I)&&(x=!0),x}pruneUnusedLayers(t){const s={};t.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const Ml=771;class Dr{constructor(t,s,h,m){this.blendFunction=t,this.blendColor=s,this.mask=h,this.blendEquation=m}}Dr.Replace=[1,0,1,0],Dr.disabled=new Dr(Dr.Replace,i.al.transparent,[!1,!1,!1,!1]),Dr.unblended=new Dr(Dr.Replace,i.al.transparent,[!0,!0,!0,!0]),Dr.alphaBlended=new Dr([1,Ml,1,Ml],i.al.transparent,[!0,!0,!0,!0]),Dr.alphaBlendedNonPremultiplied=new Dr([770,Ml,770,Ml],i.al.transparent,[!0,!0,!0,!0]),Dr.multiply=new Dr([774,0,774,0],i.al.transparent,[!0,!0,!0,!0]);class Xt{constructor(t,s,h){this.func=t,this.mask=s,this.range=h}}Xt.ReadOnly=!1,Xt.ReadWrite=!0,Xt.disabled=new Xt(519,Xt.ReadOnly,[0,1]);const ih=7680;class br{constructor(t,s,h,m,g,x){this.test=t,this.ref=s,this.mask=h,this.fail=m,this.depthFail=g,this.pass=x}}br.disabled=new br({func:519,mask:0},0,0,ih,ih,ih);const sh=1029,Ho=2305;class fr{constructor(t,s,h){this.enable=t,this.mode=s,this.frontFace=h}}function cf(d,t){const s=i.bG(d,3);i.ad.mat4.fromQuat(d,t),i.bI(d,3,s)}function oh(d,t){const s=i.ad.quat.identity([]);return i.ad.quat.rotateZ(s,s,-t),i.ad.quat.rotateX(s,s,-d),s}function Il(d,t){const s=[d[0],d[1],0],h=[t[0],t[1],0];if(i.ad.vec3.length(s)>=1e-15){const x=i.ad.vec3.normalize([],s);i.ad.vec3.scale(h,x,i.ad.vec3.dot(h,x)),t[0]=h[0],t[1]=h[1]}const m=i.ad.vec3.cross([],t,d);if(i.ad.vec3.len(m)<1e-15)return null;const g=Math.atan2(-m[1],m[0]);return oh(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),g)}fr.disabled=new fr(!1,sh,Ho),fr.backCCW=new fr(!0,sh,Ho),fr.backCW=new fr(!0,sh,2304),fr.frontCW=new fr(!0,1028,2304),fr.frontCCW=new fr(!0,1028,Ho);class Cl{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof i.ac?t:new i.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=i.bF(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const h=this.position,m=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(t)):0,g=i.ac.fromLngLat(t,m),x=[g.x-h.x,g.y-h.y,g.z-h.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Il(x,s)}setPitchBearing(t,s){this.orientation=oh(i.ak(t),i.ak(-s))}}class Hc{constructor(t,s){this._transform=i.ad.mat4.identity([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new i.ac(t[0],t[1],t[2])}get position(){const t=i.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&i.bI(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||i.ad.quat.identity([]),t&&cf(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=oh(t,s),cf(this._transform,this._orientation)}forward(){const t=i.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=i.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=i.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const h=new Float64Array(16);return i.ad.mat4.invert(h,this.getWorldToCamera(t,s)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,h){const m=this.position;i.ad.vec3.scale(m,m,-t);const g=new Float64Array(16);return i.ad.mat4.fromScaling(g,[h,h,h]),i.ad.mat4.translate(g,g,m),g[10]*=s,g}getWorldToCamera(t,s){const h=new Float64Array(16),m=new Float64Array(4),g=this.position;return i.ad.quat.conjugate(m,this._orientation),i.ad.vec3.scale(g,g,-t),i.ad.mat4.fromQuat(h,m),i.ad.mat4.translate(h,h,g),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(t,s,h,m){const g=new Float64Array(16);return i.ad.mat4.perspective(g,t,s,h,m),g}getCameraToClipOrthographic(t,s,h,m,g,x){const I=new Float64Array(16);return i.ad.mat4.ortho(I,t,s,h,m,g,x),I}getDistanceToElevation(t,s=!1){const h=t===0?0:i.bH(t,s?i.aT(this.position[1]):this.position[1]),m=this.forward();return(h-this.position[2])/m[2]}clone(){return new Hc([...this.position],[...this.orientation])}}const zi={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class as{constructor(t=0,s=0,h=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=h,this.right=m}interpolate(t,s,h){return s.top!=null&&t.top!=null&&(this.top=i.ah(t.top,s.top,h)),s.bottom!=null&&t.bottom!=null&&(this.bottom=i.ah(t.bottom,s.bottom,h)),s.left!=null&&t.left!=null&&(this.left=i.ah(t.left,s.left,h)),s.right!=null&&t.right!=null&&(this.right=i.ah(t.right,s.right,h)),this}getCenter(t,s){const h=i.ay((this.left+t-this.right)/2,0,t),m=i.ay((this.top+s-this.bottom)/2,0,s);return new i.P(h,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new as(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const qo=15;class Ct{constructor(t,s,h,m,g,x,I){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=h??0,this._maxPitch=m??60,this.setProjection(x),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new i.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new as,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Hc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Ct(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<qo}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(t||h)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return i.aA(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=i.bP(this.projectionOptions);const h=this.getProjection(),m=!i.bn(s,h);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bP({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=i.ad.mat2.create(),i.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=i.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=i.ak(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,g=0;for(let x=0;x<s.length;x++){const I=new i.P(s[x][0]*this.width,h+s[x][1]*(this.height-h)),P=t.pointCoordinate(I);if(!P)continue;const z=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);m+=P[3]*z,g+=z}return g===0?NaN:m/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),x=Math.max(m-h,g);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,h));return i.ay(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!i.ad.quat.exactEquals(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];i.ad.vec3.exactEquals(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new Cl;return s.position=new i.ac(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!i.ad.quat.length(t))return!1;i.ad.quat.normalize(t,t);const s=i.ad.vec3.transformQuat([],[0,0,-1],t),h=i.ad.vec3.transformQuat([],[0,-1,0],t);if(h[2]<0)return!1;const m=Il(s,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=i.ay(t[2],m/h,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,h){this._unmodified=!1,this._edgeInsets.interpolate(t,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new i.bQ(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new i.P(0,0)),m=this.pointCoordinate(new i.P(this.width,0)),g=this.pointCoordinate(new i.P(this.width,this.height)),x=this.pointCoordinate(new i.P(0,this.height)),I=Math.floor(Math.min(h.x,m.x,g.x,x.x)),P=Math.floor(Math.max(h.x,m.x,g.x,x.x)),z=1;for(let L=I-z;L<=P+z;L++)L!==0&&s.push(new i.bQ(L,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,h){let m=[];const g=h!==void 0,x=!g;if(x&&this.zoom<s||g&&h[0]===0&&h[1]===0)return m;const I=new Set,P=(L,F,B,j,X)=>{const q=i.c5(F,L,B,j,X);I.has(q)||(m.push(new i.aH(L,F,B,j,X)),I.add(q))};for(let L=0;L<t.length;L++){const F=t[L];if(x&&F.canonical.z!==s)continue;const B=F.canonical,j=F.overscaledZ,X=F.wrap,q=1<<B.z,J=B.x+1<q,Q=B.x>0,oe=B.y+1<q,ue=B.y>0,ce=F.wrap-(Q?0:1),ye=F.wrap+(J?0:1),pe=Q?B.x-1:q-1,ge=J?B.x+1:0;if(g)h[0]<0?(P(j,ye,B.z,ge,B.y),h[1]<0&&oe&&(P(j,X,B.z,B.x,B.y+1),P(j,ye,B.z,ge,B.y+1)),h[1]>0&&ue&&(P(j,X,B.z,B.x,B.y-1),P(j,ye,B.z,ge,B.y-1))):h[0]>0?(P(j,ce,B.z,pe,B.y),h[1]<0&&oe&&(P(j,X,B.z,B.x,B.y+1),P(j,ce,B.z,pe,B.y+1)),h[1]>0&&ue&&(P(j,X,B.z,B.x,B.y-1),P(j,ce,B.z,pe,B.y-1))):h[1]<0&&oe?P(j,X,B.z,B.x,B.y+1):ue&&P(j,X,B.z,B.x,B.y-1);else{const me=F.visibleQuadrants;1&me&&(P(j,ce,B.z,pe,B.y),ue&&(P(j,X,B.z,B.x,B.y-1),P(j,ce,B.z,pe,B.y-1))),2&me&&(P(j,ye,B.z,ge,B.y),ue&&(P(j,X,B.z,B.x,B.y-1),P(j,ye,B.z,ge,B.y-1))),4&me&&(P(j,ce,B.z,pe,B.y),oe&&(P(j,X,B.z,B.x,B.y+1),P(j,ce,B.z,pe,B.y+1))),8&me&&(P(j,ye,B.z,ge,B.y),oe&&(P(j,X,B.z,B.x,B.y+1),P(j,ye,B.z,ge,B.y+1)))}}const z=[];for(const L of m)m.some(F=>L.isChildOf(F))||z.push(L);if(m=z.filter(L=>!t.some(F=>!!(L.overscaledZ<s&&F.isChildOf(L))||L.equals(F)||L.isChildOf(F))),x){const L=1<<s,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[L*F.x,L*F.y],j=4,X=j*j;m=m.filter(q=>{const J=q.canonical.x+.5-B[0],Q=q.canonical.y+.5-B[1];return J*J+Q*Q<X})}return m}coveringTiles(t){let s=this.coveringZoomLevel(t);const h=s,m=this.elevation&&this.elevation.exaggeration(),g=m&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const I=this.locationCoordinate(this.center),P=this.center.lat,z=1<<s,L=[z*I.x,z*I.y,0],F=this.projection.name==="globe",B=!F,j=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,B),X=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=z*i.bH(1,this.center.lat),J=this._camera.position[2]/i.bH(1,this.center.lat),Q=[z*X.x,z*X.y,J*(B?1:q)],oe=F||m,ue=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ce=this.isLODDisabled(!0)?s:0;let ye;if(this._elevation&&t.isTerrainDEM)ye=1e4*this._elevation.exaggeration();else if(this._elevation){const ze=this._elevation.getMinMaxForVisibleTiles();ye=ze?ze.max:this._centerAltitude}else ye=this._centerAltitude;const pe=t.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,ge=this.projection.isReprojectedInTileSpace?i.bS(this):1,me=ze=>{const Ze=new i.ac(ze.x+25e-6,ze.y,ze.z),at=new i.ac(ze.x,ze.y+25e-6,ze.z),$e=ze.toLngLat(),ut=Ze.toLngLat(),St=at.toLngLat(),Mt=this.locationCoordinate($e),Lt=this.locationCoordinate(ut),Wt=this.locationCoordinate(St),pr=Math.hypot(Lt.x-Mt.x,Lt.y-Mt.y),sr=Math.hypot(Wt.x-Mt.x,Wt.y-Mt.y);return Math.sqrt(pr*sr)*ge/25e-6},we=ze=>{const Qe=ye,Ze=pe;return{aabb:i.bV(this,z,0,0,0,ze,Ze,Qe,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:Qe,wrap:ze,fullyVisible:!1}},Ee=[];let He=[];const Be=s,rt=t.reparseOverscaled?h:s,nt=(J-this._centerAltitude)*q,yt=ze=>{if(!this._elevation||!ze.tileID||!x)return;const Qe=this._elevation.getMinMaxForTile(ze.tileID),Ze=ze.aabb;Qe?(Ze.min[2]=Qe.min,Ze.max[2]=Qe.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(ze.shouldSplit=tt(ze),ze.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},Oe=(ze,Qe)=>{if(.707*Qe<ze)return 1;const Ze=Qe/ze;return Ze/(1.4144271570014144+(Math.pow(1.1,Ze-1.4144271570014144+1)-1)/(1.1-1)-1)},tt=ze=>{if(ze.zoom<ce)return!0;if(ze.zoom===Be)return!1;if(ze.shouldSplit!=null)return ze.shouldSplit;const Qe=ze.aabb.distanceX(Q),Ze=ze.aabb.distanceY(Q);let at=nt,$e=1;if(F){at=ze.aabb.distanceZ(Q);const sr=Math.pow(2,ze.zoom),mr=i.aT((ze.y+1)/sr),hr=i.aT(ze.y/sr),Br=Math.min(Math.max(P,mr),hr),on=i.ca(Br)/i.ca(P);if($e=Br===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,on/this._mercatorScaleRatio),this.zoom<=i.c6&&ze.zoom===Be-1&&on>=.9)return!0}else if(g&&(at=ze.aabb.distanceZ(Q)*q),this.projection.isReprojectedInTileSpace&&h<=5){const sr=Math.pow(2,ze.zoom),mr=me(new i.ac((ze.x+.5)/sr,(ze.y+.5)/sr));$e=mr>.85?1:mr}if(!x){const sr=Math.sqrt(Qe*Qe+Ze*Ze+at*at);let mr=(1<<Be-ze.zoom)*ue*$e;return mr*=Oe(Math.max(at,nt),sr),sr<mr}let ut=Number.MAX_VALUE,St=0;const Mt=ze.aabb.getCorners(),Lt=[];for(const sr of Mt){i.ad.vec3.sub(Lt,sr,Q),F||(g?Lt[2]*=q:Lt[2]=nt);const mr=i.ad.vec3.dot(Lt,this._camera.forward());mr<ut&&(ut=mr,St=Math.abs(Lt[2]))}let Wt=(1<<Be-ze.zoom)*ue*$e;if(Wt*=Oe(Math.max(St,nt),ut),ut<Wt)return!0;const pr=ze.aabb.closestPoint(L);return pr[0]===L[0]&&pr[1]===L[1]};if(this.renderWorldCopies)for(let ze=1;ze<=3;ze++)Ee.push(we(-ze)),Ee.push(we(ze));for(Ee.push(we(0));Ee.length>0;){const ze=Ee.pop(),Qe=ze.x,Ze=ze.y;let at=ze.fullyVisible;const $e=()=>this.projection.name==="globe"&&(ze.y===0||ze.y===(1<<ze.zoom)-1);if(!at){let ut=oe?ze.aabb.intersects(j):ze.aabb.intersectsFlat(j);if(ut===0&&$e()){const St=new i.bT(ze.zoom,Qe,Ze);ut=i.bU(this,z,St,!0).intersects(j)}if(ut===0)continue;at=ut===2}if(ze.zoom!==Be&&tt(ze))for(let ut=0;ut<4;ut++){const St=(Qe<<1)+ut%2,Mt=(Ze<<1)+(ut>>1),Lt={aabb:x?ze.aabb.quadrant(ut):i.bV(this,z,ze.zoom+1,St,Mt,ze.wrap,ze.minZ,ze.maxZ,this.projection),zoom:ze.zoom+1,x:St,y:Mt,wrap:ze.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:ze.minZ,maxZ:ze.maxZ};g&&!F&&(Lt.tileID=new i.aH(ze.zoom+1===Be?rt:ze.zoom+1,ze.wrap,ze.zoom+1,St,Mt),yt(Lt)),Ee.push(Lt)}else{const ut=ze.zoom===Be?rt:ze.zoom;if(t.minzoom&&t.minzoom>ut)continue;let St=0;if(!at){let pr=oe?ze.aabb.intersectsPrecise(j):ze.aabb.intersectsPreciseFlat(j);if(pr===0&&$e()){const sr=new i.bT(ze.zoom,Qe,Ze);pr=i.bU(this,z,sr,!0).intersectsPrecise(j)}if(pr===0)continue;if(t.calculateQuadrantVisibility)if(j.containsPoint(ze.aabb.center))St=15;else for(let sr=0;sr<4;sr++)ze.aabb.quadrant(sr).intersects(j)!==0&&(St|=1<<sr)}const Mt=L[0]-(.5+Qe+(ze.wrap<<ze.zoom))*(1<<s-ze.zoom),Lt=L[1]-.5-Ze,Wt=ze.tileID?ze.tileID:new i.aH(ut,ze.wrap,ze.zoom,Qe,Ze);t.calculateQuadrantVisibility&&(Wt.visibleQuadrants=St),He.push({tileID:Wt,distanceSq:Mt*Mt+Lt*Lt})}}if(this.fogCullDistSq){const ze=this.fogCullDistSq,Qe=this.horizonLineFromTop();He=He.filter(Ze=>{const at=[0,0,0,1],$e=[i.ai,i.ai,0,1],ut=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());i.ad.vec4.transformMat4(at,at,ut),i.ad.vec4.transformMat4($e,$e,ut);const St=i.ad.vec4.min([],at,$e),Mt=i.ad.vec4.max([],at,$e),Lt=i.bW(St,Mt);if(Lt===0)return!0;let Wt=!1;const pr=this._elevation;if(pr&&Lt>ze&&Qe!==0){const sr=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let mr;t.isTerrainDEM||(mr=pr.getMinMaxForTile(Ze.tileID)),mr||(mr={min:pe,max:ye});const hr=i.c7(this.rotation),Br=[hr[0]*i.ai,hr[1]*i.ai,mr.max];i.ad.vec3.transformMat4(Br,Br,sr),Wt=(1-Br[1])*this.height*.5<Qe}return Lt<ze||Wt})}return He.sort((ze,Qe)=>ze.distanceSq-Qe.distanceSq).map(ze=>ze.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=i.ay(t.lat,-i.bX,i.bX),h=this.projection.project(t.lng,s);return new i.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let h,m;const g=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;h=(s.x-g.x)/I,m=(s.y-g.y)/I}else{const I=this.pointCoordinate(s),P=this.pointCoordinate(g);h=I.x-P.x,m=I.y-P.y}const x=this.locationCoordinate(t);this.setLocation(new i.ac(x.x-h,x.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const h=s?i.bH(s,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new i.ac(m.x,m.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const h=s??this._centerAltitude,m=[t.x,t.y,0,1],g=[t.x,t.y,1,1];i.ad.vec4.transformMat4(m,m,this.pixelMatrixInverse),i.ad.vec4.transformMat4(g,g,this.pixelMatrixInverse);const x=g[3];i.ad.vec4.scale(m,m,1/m[3]),i.ad.vec4.scale(g,g,1/x);const I=m[2],P=g[2];return{p0:m,p1:g,t:I===P?0:(h-I)/(P-I)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return i.ad.vec4.transformMat4(s,s,this.pixelMatrixInverse),i.ad.vec4.transformMat4(h,h,this.pixelMatrixInverse),i.ad.vec4.scale(s,s,1/s[3]),i.ad.vec4.scale(h,h,1/h[3]),s[2]=i.bH(s[2],this._center.lat)*this.worldSize,h[2]=i.bH(h[2],this._center.lat)*this.worldSize,i.ad.vec4.scale(s,s,1/this.worldSize),i.ad.vec4.scale(h,h,1/this.worldSize),new i.as([s[0],s[1],s[2]],i.ad.vec3.normalize([],i.ad.vec3.sub([],h,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:h,t:m}=t,g=i.bH(s[2],this._center.lat),x=i.bH(h[2],this._center.lat);return new i.ac(i.ah(s[0],h[0],m)/this.worldSize,i.ah(s[1],h[1],m)/this.worldSize,i.ah(g,x,m))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let h=this.projection.pointCoordinate3D(this,t.x,t.y);if(h)return new i.ac(h[0],h[1],h[2]);let m=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t,s);const x=.02*g,I=t.clone();for(let P=0;P<10&&g-m>x;P++){I.y=i.ah(m,g,.66);const z=this.projection.pointCoordinate3D(this,I.x,I.y);z?(g=I.y,h=z):m=I.y}return h?new i.ac(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=i.bY)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return i.ad.vec4.transformMat4(m,m,this.pixelMatrix),m[3]>0?new i.P(m[0]/m[3],m[1]/m[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,g=this.pointLocation3D(new i.P(s,t)),x=this.pointLocation3D(new i.P(m,t)),I=this.pointLocation3D(new i.P(m,h)),P=this.pointLocation3D(new i.P(s,h));let z=Math.min(g.lng,x.lng,I.lng,P.lng),L=Math.max(g.lng,x.lng,I.lng,P.lng),F=Math.min(g.lat,x.lat,I.lat,P.lat),B=Math.max(g.lat,x.lat,I.lat,P.lat);const j=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,q=(J,Q,oe,ue,ce)=>{const ye=(J+oe)/2,pe=(Q+ue)/2,ge=new i.P(ye,pe),{lng:me,lat:we}=this.pointLocation3D(ge),Ee=Math.max(0,z-me,F-we,me-L,we-B);z=Math.min(z,me),L=Math.max(L,me),F=Math.min(F,we),B=Math.max(B,we),(ce<X||Ee>j)&&(q(J,Q,ye,pe,ce+1),q(ye,pe,oe,ue,ce+1))};if(q(s,t,m,t,1),q(m,t,m,h,1),q(m,h,s,h,1),q(s,h,s,t,1),this.projection.name==="globe"){const[J,Q]=i.bZ(this);J?(B=90,L=180,z=-180):Q&&(F=-90,L=180,z=-180)}return new i.aB(new i.bO(z,F),new i.bO(L,B))}_getBoundsRectangular(t,s){const{top:h,left:m}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,I=new i.P(m,h),P=new i.P(x,h),z=new i.P(x,g),L=new i.P(m,g);let F=this.pointCoordinate(I,t),B=this.pointCoordinate(P,t);const j=this.pointCoordinate(z,s),X=this.pointCoordinate(L,s),q=(J,Q)=>(Q.y-J.y)/(Q.x-J.x);return F.y>1&&B.y>=0?F=new i.ac((1-X.y)/q(X,F)+X.x,1):F.y<0&&B.y<=1&&(F=new i.ac(-X.y/q(X,F)+X.x,0)),B.y>1&&F.y>=0?B=new i.ac((1-j.y)/q(j,B)+j.x,1):B.y<0&&F.y<=1&&(B=new i.ac(-j.y/q(j,B)+j.x,0)),new i.aB().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce((h,m)=>{if(m.dem){const g=m.dem.tree;h.min=Math.min(h.min,g.minimums[0]),h.max=Math.max(h.max,g.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-i.bX,this.maxLat=i.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.av(this.minLng)*this.tileSize,this.worldMaxX=i.av(this.maxLng)*this.tileSize,this.worldMinY=i.aC(this.maxLat)*this.tileSize,this.worldMaxY=i.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,h=this._distanceTileDataCache;if(h[s])return h[s];const m=t.canonical,g=1/this.height,x=this.cameraWorldSize,I=x/this.zoomScale(m.z),P=(m.x+Math.pow(2,m.z)*t.wrap)*I,z=m.y*I,L=this.point;L.x*=x/this.worldSize,L.y*=x/this.worldSize;const F=this.angle,B=Math.sin(-F),j=-Math.cos(-F);return h[s]={bearing:[B,j],center:[(L.x-P)*g,(L.y-z)*g],scale:I/i.ai*g},h[s]}calculateFogTileMatrix(t){const s=t.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return i.ad.mat4.multiply(m,this.worldToFogMatrix,m),h[s]=new Float32Array(m),h[s]}calculateProjMatrix(t,s=!1,h=!1){const m=t.key;let g;if(g=h?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,g[m])return g[m];const x=this.calculatePosMatrix(t,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,i.ad.mat4.multiply(x,I,x),g[m]=new Float32Array(x),g[m]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const m=i.b_(t,this);return h[s]=m,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=i.ad.mat4.fromScaling([],[t,t,t]);return i.ad.mat4.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=i.bH(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=this._camera.forward(),g=i.bH(1,this._center.lat);h[2]/=g,m[2]/=g,i.ad.vec3.normalize(m,m);const x=t.raycast(h,m,t.exaggeration());if(x){const I=i.ad.vec3.scaleAndAdd([],h,m,x),P=new i.ac(I[0],I[1],i.bH(I[2],i.aT(I[1]))),z=(P.z+i.ad.vec3.length([P.x-h[0],P.y-h[1],P.z-h[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,h=i.bH(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(h),g=s.getAtPointOrZero(new i.ac(...m)),x=this.pixelsPerMeter/this.worldSize*g,I=this._minimumHeightOverTerrain(),P=m[2]-x;if(P<=I)if(P<0||t){const z=this.locationCoordinate(this._center,this._centerAltitude),L=[m[0],m[1],z.z-m[2]],F=i.ad.vec3.length(L);L[2]-=(I-P)/this._pixelsPerMercatorPixel;const B=i.ad.vec3.length(L);if(B===0)return;i.ad.vec3.scale(L,L,F/B*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],z.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=i.ay(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=i.ay(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:m}=this.point;let g=0,x=h,I=m;const P=this.width/2,z=this.height/2,L=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(m-z<L&&(I=L+z),m+z>F&&(I=F-z),F-L<this.height&&(g=Math.max(g,this.height/(F-L)),I=(F+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,X=this.worldSize/2-(B+j)/2;x=(h+X+this.worldSize)%this.worldSize-X,x-P<B&&(x=B+P),x+P>j&&(x=j-P),j-B<this.width&&(g=Math.max(g,this.width/(j-B)),x=(j+B)/2)}x===h&&I===m||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(x,I))),g&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bH(1,this.center.lat)/i.bH(1,i.c8));const m=i.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?h:1,x=this._camera.getWorldToCamera(this.worldSize,g);let I;const P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(P[8]=2*-t.x/this.width,P[9]=2*t.y/this.height,this.isOrthographic){let we=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ee=we*this.aspect,He=-Ee,Be=-we;Ee-=t.x,He-=t.x,we+=t.y,Be+=t.y,I=this._camera.getCameraToClipOrthographic(He,Ee,Be,we,this._nearZ,this._farZ),((rt,nt,yt,Oe)=>{for(let tt=0;tt<16;tt++)rt[tt]=i.ah(nt[tt],yt[tt],Oe)})(I,I,P,i.c9(this.pitch>=qo?1:this.pitch/qo))}else I=P;const z=i.ad.mat4.mul([],P,x);let L=i.ad.mat4.mul([],I,x);if(this.projection.isReprojectedInTileSpace){const we=this.locationCoordinate(this.center),Ee=i.ad.mat4.identity([]);i.ad.mat4.translate(Ee,Ee,[we.x*this.worldSize,we.y*this.worldSize,0]),i.ad.mat4.multiply(Ee,Ee,i.c0(this)),i.ad.mat4.translate(Ee,Ee,[-we.x*this.worldSize,-we.y*this.worldSize,0]),i.ad.mat4.multiply(L,L,Ee),i.ad.mat4.multiply(z,z,Ee),this.inverseAdjustmentMatrix=i.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ad.mat4.scale([],L,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=L,this.invProjMatrix=i.ad.mat4.invert(new Float64Array(16),this.projMatrix),s){const we=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);we[8]=2*-t.x/this.width,we[9]=2*t.y/this.height,this.expandedFarZProjMatrix=i.ad.mat4.mul([],we,x)}else this.expandedFarZProjMatrix=this.projMatrix;const F=i.ad.mat4.invert([],I);this.frustumCorners=i.c2.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const B=new Float32Array(16);i.ad.mat4.identity(B),i.ad.mat4.scale(B,B,[1,-1,1]),i.ad.mat4.rotateX(B,B,this._pitch),i.ad.mat4.rotateZ(B,B,this.angle);const j=i.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ad.mat4.clone(j);const X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-t.x/this.width,j[9]=2*(t.y+X)/this.height,this.skyboxMatrix=i.ad.mat4.multiply(B,j,B);const q=this.point,J=q.x,Q=q.y,oe=this.width%2/2,ue=this.height%2/2,ce=Math.cos(this.angle),ye=Math.sin(this.angle),pe=J-Math.round(J)+ce*oe+ye*ue,ge=Q-Math.round(Q)+ce*ue+ye*oe,me=new Float64Array(L);if(i.ad.mat4.translate(me,me,[pe>.5?pe-1:pe,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=me,L=i.ad.mat4.create(),i.ad.mat4.scale(L,L,[this.width/2,-this.height/2,1]),i.ad.mat4.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=i.ad.mat4.create(),i.ad.mat4.scale(L,L,[1,-1,1]),i.ad.mat4.translate(L,L,[-1,-1,0]),i.ad.mat4.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=i.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},L=i.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.c3(this);const we=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad.vec3.transformMat4(we,we,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,s];i.ad.vec3.scale(g,g,m),i.ad.vec3.scale(h,h,-1),i.ad.vec3.multiply(h,h,g);const x=i.ad.mat4.create();i.ad.mat4.translate(x,x,h),i.ad.mat4.scale(x,x,g),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),m=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-h[0]*g,m.y/this.worldSize-h[1]*g,t/this.worldSize*this._centerAltitude-h[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],m=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(g=Math.min((s-h)/m,1)),this._camera.position=i.ad.vec3.scaleAndAdd([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),g=i.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ak(this._maxPitch)),I=Math.max((t[2]-g)/Math.cos(h),x),P=this._zoomFromMercatorZ(I);i.ad.vec3.scaleAndAdd(t,t,s,I),this._pitch=i.ay(h,i.ak(this.minPitch),i.ak(this.maxPitch)),this.angle=i.bF(m,-Math.PI,Math.PI),this._setZoom(i.ay(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,h=i.bY,m=0,g=1/0;for(;h-s>1e-6&&h>s;){const x=s+.5*(h-s),I=this.tileSize*Math.pow(2,x),P=this.getCameraToCenterDistance(this.projection,x,I),z=this.scaleZoom(P/(t*this.tileSize)),L=Math.abs(x-z);L<g&&(g=L,m=x),x<z?s=x:h=x}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const h=Math.min(t.x,s.x),m=Math.max(t.x,s.x),g=Math.min(t.y,s.y),x=Math.max(t.y,s.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new i.P(h,g),new i.P(m,x),new i.P(h,x),new i.P(m,g)],P=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const L of I){const F=this.pointRayIntersection(L);if(F.t<0)return!0;const B=this.rayIntersectionCoordinate(F);if(B.x<P||B.y<0||B.x>z||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(t,s){const h=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([s,h,m],g){const x=[s,h,m,1];i.ad.vec4.transformMat4(x,x,g);const I=x[3]=Math.max(x[3],1e-6);return x[0]/=I,x[1]/=I,x[2]/=I,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,h=this.worldSize){const m=i.b$(t,s,this.width,this.height,1024),g=t.pixelSpaceConversion(this.center.lat,h,m);let x=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(x=i.ah(1,x,i.c9(this.pitch>=qo?1:this.pitch/qo))),x}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ad.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const ya=(d,t)=>{if(t>0&&d.terrain&&i.w("Cutoff is currently disabled on terrain"),t<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=d.transform,h=Math.max(Math.abs(s._zoom-(d.minCutoffZoom-1)),1),m=s.isLODDisabled(!1)?i.ae(60,45,s.pitch):i.ae(30,15,s.pitch),g=s._farZ-s._nearZ,x=t*s.height,I=((1-(P=m))*s.cameraToCenterDistance+P*(s._farZ+x))*h;var P;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(I-s._nearZ)/g,(I-x-s._nearZ)/g]}}},Li={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class uf{constructor(t,s){this.aabb=t,this.lastCascade=s}}class s_{add(t,s){const h=this.receivers[t.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],s.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],s.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],s.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],s.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],s.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],s.max[2])):this.receivers[t.key]=new uf(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,h){const m=i.ce.fromPoints(t.points);let g=0;for(const x in this.receivers){const I=this.receivers[x];if(!I||!m.intersectsAabb(I.aabb))continue;I.aabb.min=m.closestPoint(I.aabb.min),I.aabb.max=m.closestPoint(I.aabb.max);const P=I.aabb.getCorners();for(let z=0;z<h.length;z++){let L=!0;for(const F of P){const B=[F[0]*s,F[1]*s,F[2]];if(i.ad.vec3.transformMat4(B,B,h[z].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){L=!1;break}}if(I.lastCascade=z,g=Math.max(g,z),L)break}}return g+1}}class ah{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new s_,this._depthMode=new Xt(t.context.gl.LEQUAL,Xt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Li,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Li,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Li,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const m=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||m<=0||(this._shadowLayerCount=h.style.order.reduce((X,q)=>{const J=h.style._mergedLayers[q];return X+(J.hasShadowPass()&&!J.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const g=h.context,x=Li.shadowMapResolution,I=Li.shadowMapResolution;if(this._cascades.length===0||Li.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let X=0;X<Li.cascadeCount;++X){const q=h._shadowMapDebug,J=g.gl,Q=g.createFramebuffer(x,I,q,"texture"),oe=new i.T(g,{width:x,height:I,data:null},J.DEPTH_COMPONENT16);if(Q.depthAttachment.set(oe.texture),q){const ue=new i.T(g,{width:x,height:I,data:null},J.RGBA8);Q.colorAttachment.set(ue.texture)}this._cascades.push({framebuffer:Q,texture:oe,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bR,scale:0})}}this.shadowDirection=lh(s);let P=0;if(t.elevation){const X=t.elevation,q=[1e4,-1e4];X.visibleDemTiles.filter(J=>J.dem).forEach(J=>{const Q=J.dem.tree;q[0]=Math.min(q[0],Q.minimums[0]),q[1]=Math.max(q[1],Q.maximums[0])}),q[0]!==1e4&&(P=(q[1]-q[0])*X.exaggeration())}const z=1.5*t.cameraToCenterDistance,L=3*z,F=new Float64Array(16);for(let X=0;X<this._cascades.length;++X){const q=this._cascades[X];let J=t.height/50,Q=1;Li.cascadeCount===1?Q=L:X===0?Q=z:(J=z,Q=L);const[oe,ue]=ch(t,this.shadowDirection,J,Q,Li.shadowMapResolution,P);q.scale=t.scale,q.matrix=oe,q.boundingSphereRadius=ue,i.ad.mat4.invert(F,q.matrix),q.frustum=i.bR.fromInvProjectionMatrix(F,1,0,!0),q.far=Q}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Li.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Li.shadowMapResolution,this._uniformValues.u_shadowmap_0=zi.ShadowMap0,this._uniformValues.u_shadowmap_1=zi.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=h.transform.elevation;for(const X of this._groundShadowTiles){let q={min:0,max:0};if(j){const J=j.getMinMaxForTile(X);J&&(q=J)}this.addShadowReceiver(X.toUnwrapped(),q.min,q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const h=this.painter,m=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),m.viewport.set([0,0,Li.shadowMapResolution,Li.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){h.currentShadowCascade=g,m.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),m.clear({color:i.al.white,depth:1});for(const x of t.order){const I=t._mergedLayers[x];if(!I.hasShadowPass()||I.isHidden(h.transform.zoom))continue;const P=t.getLayerSourceCache(I),z=P?s[P.id]:void 0;(I.type==="model"||z&&z.length)&&h.renderLayer(h,P,I,z)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,h=t.context,m=s.directionalLight,g=s.ambientLight;if(!m||!g)return;const x=[],I=ya(t,t.longestCutoffRange);I.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&x.push("NORMAL_OFFSET");const P=Wo(s,m,g),z=new Xt(h.gl.LEQUAL,Xt.ReadOnly,t.depthRangeFor3D);for(const L of this._groundShadowTiles){const F=L.toUnwrapped(),B=t.isTileAffectedByFog(L),j=t.getOrCreateProgram("groundShadow",{defines:x,overrideFog:B});this.setupShadows(F,j),t.uploadCommonUniforms(h,j,F,null,I);const X={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:P};j.draw(t,h.gl.TRIANGLES,z,br.disabled,Dr.multiply,fr.disabled,X,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Dr.unblended:Dr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,h=s.calculatePosMatrix(t,s.worldSize);return i.ad.mat4.multiply(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(t){return i.ad.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,s,h,m=0){if(!this.enabled)return;const g=this.painter.transform,x=this.painter.context,I=x.gl,P=this._uniformValues,z=new Float64Array(16),L=g.calculatePosMatrix(t,g.worldSize);for(let F=0;F<this._cascades.length;F++)i.ad.mat4.multiply(z,this._cascades[F].matrix,L),P[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),x.activeTexture.set(I.TEXTURE0+zi.ShadowMap0+F),this._cascades[F].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!h,this.useNormalOffset){const F=i.cd(t.canonical),B=2/g.tileSize*i.ai/Li.shadowMapResolution,j=B*this._cascades[0].boundingSphereRadius,X=B*this._cascades[this._cascades.length-1].boundingSphereRadius,q=(h==="vector-tile"?1:3)/Math.pow(2,m-t.canonical.z-(1-g.zoom+Math.floor(g.zoom)));P.u_shadow_normal_offset=[F,j*q,X*q],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(x,P)}setupShadowsFromMatrix(t,s,h=!1){if(!this.enabled)return;const m=this.painter.context,g=m.gl,x=this._uniformValues,I=new Float64Array(16);for(let P=0;P<Li.cascadeCount;P++)i.ad.mat4.multiply(I,this._cascades[P].matrix,t),x[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),m.activeTexture.set(g.TEXTURE0+zi.ShadowMap0+P),this._cascades[P].texture.bind(g.NEAREST,g.CLAMP_TO_EDGE);if(this.useNormalOffset=h,h){const P=Li.normalOffset;x.u_shadow_normal_offset=[1,P,P],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(m,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,h,m){if(m[2]>=0)return{};const g=function(P,z,L){const F=L/(1<<P.canonical.z);return new i.ce([P.canonical.x*F+P.wrap*L,P.canonical.y*F+P.wrap*L,0],[(P.canonical.x+1)*F+P.wrap*L,(P.canonical.y+1)*F+P.wrap*L,z])}(t,s,h).getCorners(),x=s/-m[2];m[0]<0?(i.ad.vec3.add(g[0],g[0],[m[0]*x,0,0]),i.ad.vec3.add(g[3],g[3],[m[0]*x,0,0])):m[0]>0&&(i.ad.vec3.add(g[1],g[1],[m[0]*x,0,0]),i.ad.vec3.add(g[2],g[2],[m[0]*x,0,0])),m[1]<0?(i.ad.vec3.add(g[0],g[0],[0,m[1]*x,0]),i.ad.vec3.add(g[1],g[1],[0,m[1]*x,0])):m[1]>0&&(i.ad.vec3.add(g[2],g[2],[0,m[1]*x,0]),i.ad.vec3.add(g[3],g[3],[0,m[1]*x,0]));const I={};return I.vertices=g,I.planes=[Ws(g[1],g[0],g[4]),Ws(g[2],g[1],g[5]),Ws(g[3],g[2],g[6]),Ws(g[0],g[3],g[7])],I}addShadowReceiver(t,s,h){this._receivers.add(t,i.ce.fromTileIdAndHeight(t,s,h))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function Ws(d,t,s){const h=i.ad.vec3.sub([],s,t),m=i.ad.vec3.sub([],d,t),g=i.ad.vec3.cross([],h,m),x=i.ad.vec3.length(g);return x===0?[0,0,1,0]:(i.ad.vec3.scale(g,g,1/x),[g[0],g[1],g[2],-i.ad.vec3.dot(g,t)])}function lh(d){const t=d.properties.get("direction"),s=i.cc(t.x,t.y,t.z);s[2]=i.ay(s[2],0,75);const h=i.cf([s[0],s[1],s[2]]);return i.ad.vec3.fromValues(h.x,h.y,h.z)}function Wo(d,t,s){const h=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),g=t.properties.get("intensity"),x=t.properties.get("direction"),I=[x.x,x.y,x.z],P=s.properties.get("color-use-theme")==="none",z=s.properties.get("color"),L=s.properties.get("intensity"),F=Math.max(i.ad.vec3.dot([0,0,1],I),0),B=[0,0,0];i.ad.vec3.scale(B,z.toRenderColor(P?null:d.getLut(t.scope)).toArray01Linear().slice(0,3),L);const j=[0,0,0];return i.ad.vec3.scale(j,m.toRenderColor(h?null:d.getLut(s.scope)).toArray01Linear().slice(0,3),F*g),i.cg([B[0]>0?B[0]/(B[0]+j[0]):0,B[1]>0?B[1]/(B[1]+j[1]):0,B[2]>0?B[2]/(B[2]+j[2]):0])}function ch(d,t,s,h,m,g){const x=d.zoom,I=d.scale,P=d.worldSize,z=1/P,L=d.aspect,F=Math.sqrt(1+L*L)*Math.tan(.5*d.fovX),B=F*F,j=h-s,X=h+s;let q,J;B>j/X?(q=h,J=h*F):(q=.5*X*(1+B),J=.5*Math.sqrt(j*j+2*(h*h+s*s)*B+X*X*B*B));const Q=d.projection.pixelsPerMeter(d.center.lat,P),oe=d._camera.getCameraToWorldMercator(),ue=[0,0,-q*z];i.ad.vec3.transformMat4(ue,ue,oe);let ce=J*z;const ye=d._edgeInsets;if(!(ye.left===0&&ye.top===0&&ye.right===0&&ye.bottom===0||ye.left===ye.right&&ye.top===ye.bottom)){const at=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?Q:1),$e=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,s,h);$e[8]=2*-d.centerOffset.x/d.width,$e[9]=2*d.centerOffset.y/d.height;const ut=new Float64Array(16);i.ad.mat4.mul(ut,$e,at);const St=new Float64Array(16);i.ad.mat4.invert(St,ut);const Mt=i.bR.fromInvProjectionMatrix(St,P,x,!0);for(const Lt of Mt.points){const Wt=((pe=Lt)[0]/=I,pe[1]/=I,pe[2]=i.bH(pe[2],d._center.lat),pe);ce=Math.max(ce,i.ad.vec3.len(i.ad.vec3.subtract([],ue,Wt)))}}var pe;ce*=m/(m-1);const ge=Math.acos(t[2]),me=Math.atan2(-t[0],-t[1]),we=new Hc;we.position=ue,we.setPitchBearing(ge,me);const Ee=we.getWorldToCamera(P,Q),He=ce*P,Be=Math.min(d._mercatorZfromZoom(17)*P*-2,-2*He),rt=we.getCameraToClipOrthographic(-He,He,-He,He,Be,(He+g*Q)/t[2]),nt=new Float64Array(16);i.ad.mat4.multiply(nt,rt,Ee);const yt=i.ad.vec3.fromValues(Math.floor(1e6*ue[0])/1e6*P,Math.floor(1e6*ue[1])/1e6*P,0),Oe=.5*m,tt=[0,0,0];i.ad.vec3.transformMat4(tt,yt,nt),i.ad.vec3.scale(tt,tt,Oe);const ze=[Math.floor(tt[0]),Math.floor(tt[1]),Math.floor(tt[2])],Qe=[0,0,0];i.ad.vec3.sub(Qe,tt,ze),i.ad.vec3.scale(Qe,Qe,-1/Oe);const Ze=new Float64Array(16);return i.ad.mat4.identity(Ze),i.ad.mat4.translate(Ze,Ze,Qe),i.ad.mat4.multiply(nt,Ze,nt),[nt,He]}class Pl extends i.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,s){return i.aN(this.requestManager.transformRequest(s,i.R.Model).url).then(h=>{if(!h)return;const m=i.aO(h),g=new i.aP(t,void 0,void 0,m);return g.computeBoundsAndApplyParent(),g}).catch(h=>{if(h&&h.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${t} from ${s}: ${h.message}`)))})}load(t,s,h={keepNumReferences:!1}){this.models[s]||(this.models[s]={});const m=Object.keys(t);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+m.length;const g=[];for(const x of m)g.push(this.loadModel(x,t[x]));Promise.allSettled(g).then(x=>{for(let I=0;I<x.length;I++){const{status:P,value:z}=x[I];if(P==="fulfilled"&&z){const L=this.models[s][m[I]];this.models[s][m[I]]={model:z,numReferences:h.keepNumReferences&&L?L.numReferences:1}}}this.numModelsLoading[s]-=m.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(x=>{this.fire(new i.z(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s){return!!this.getModel(t,s)}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}addModel(t,s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={}),this.hasModel(t,h)&&this.models[h][t].numReferences++,this.modelUris[h][t]=this.requestManager.normalizeModelURL(s),this.load({[t]:this.modelUris[h][t]},h)}addModels(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h=this.modelUris[s];for(const m in t)this.models[s][m]={},h[m]=this.requestManager.normalizeModelURL(t[m]);this.load(h,s,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h={};for(const m of t)this.hasModel(m,s)?this.models[s][m].numReferences++:(this.modelUris[s][m]=this.requestManager.normalizeModelURL(m),h[m]=this.modelUris[s][m]);this.load(h,s)}removeModel(t,s){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0)){const h=this.models[s][t].model;delete this.models[s][t],delete this.modelUris[s][t],h.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const h in this.models[s])this.models[s][h].model&&this.models[s][h].model.upload(t.context)}}const g0=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),y0={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function uh(d){return d=d||{},Object.assign(d,y0)}class v0 extends i.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},i.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(x,I){const[P,z]=x,{center:L,radius:F}=I,[B,j]=L,X=Math.abs(P-B);return Math.sqrt((X>180?360-X:X)**2+(z-j)**2)<=F}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone")));const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=new i.P(this._map.transform.width/2,this._map.transform.height/2),m=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(t?m:h,s);g.length>0&&(this._selectedFloorplan&&g[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=g[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(g){const[[x,I],[P,z]]=g,L=(P-x+360)%360,F=L>180?360-L:L;return{center:[(x+F/2+360)%360,(I+z)/2],radius:Math.sqrt(F**2+(z-I)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const s=this._floorplanStates[this._indoorData.id].selectedBuilding,h=this._floorplanStates[this._indoorData.id].selectedLevel;let m;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const g of this._indoorData.levels)g.id===this._selectedLevel.id&&(m=g.id);if(this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:m})),s){const g=this._indoorData.buildings.find(x=>x.id===s);this._buildingSelected(g,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(h){const g=this._indoorData.levels.find(x=>x.id===h);this._updateLevels(g,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,s){s&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const h=this._indoorData.levels.filter(m=>t.levels.includes(m.id));this.fire(new i.A("buildingselected",{buildingId:t.id,levels:h}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const s=this._indoorData.levels.find(h=>h.id===t);this._updateLevels(s,!0)}this.fire(new i.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,s){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(s&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function h(z){const L=z.indexOf("/floor/");if(L===-1)return z;const F=L+7,B=z.indexOf("/",F);return B===-1?z.slice(F):z.slice(F,B)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const m=[],g={},x={},I={},P={};for(const z of this._indoorData.levels)if(m.push(z.id),g[z.id]=z.height,x[z.id]=z.base,t){if(this.mergeFloors){const L=h(t.id),F=h(z.id);I[z.id]=F===L?"true":"false"}else I[z.id]=z.id===t.id?"true":"false";P[z.id]=z.base<t.base?"true":"false"}else P[z.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",m]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",I]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",P]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),s&&t.extent)){const z=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),L=this._map.getZoom(),F=z.zoom?Math.abs(L-z.zoom):0;this._map.fitBounds(t.extent,F>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:L})}}selectFloorplan(t){const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],m=this._map.queryRenderedFeatures(h,s);if(m.length>0){for(const g of m)if(JSON.parse(g.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=g,this._floorplanSelected(!0);break}}}selectBuilding(t){const s=this._indoorData.buildings.find(h=>h.id===t);this._buildingSelected(s,!0)}selectLevel(t){this._levelSelected(t)}}function o_(d){if(!d.metadata||!d.metadata.content_area)return;const t=i.q.devicePixelRatio,{left:s,top:h,width:m,height:g}=d.metadata.content_area,x=s*t,I=h*t;return[x,I,x+m*t,I+g*t]}function hf(d){if(d)return d.map(([t,s])=>[t*i.q.devicePixelRatio,s*i.q.devicePixelRatio])}class df{constructor(t,s){this.id=t,this.style=s}addIcons(t){const s=new Map;for(const[h,m]of t.entries()){const g=i.I.from({name:h,iconsetId:this.id});s.set(g,m)}this.style.addImages(s)}}const Ja=(d,t)=>Re(d,t&&t.filter(s=>s.identifier!=="source.canvas")),x0=i.aA(Xr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),b0=i.aA(Xr,["setCenter","setZoom","setBearing","setPitch"]),ff=new Set(["background","sky","slot","custom"]),pf={version:8,layers:[],sources:{}},a_={duration:300,delay:0};class ls extends i.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=i.l({},a_),this._buildingIndex=new ar(this),this.crossTileSymbolIndex=new i_,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new ke,this.dispatcher=s.dispatcher?s.dispatcher:new i.D(i.cj(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Ae(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new i.ck(t._requestManager,s.localFontFamily?i.cl.all:s.localIdeographFontFamily?i.cl.ideographs:i.cl.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new Pl(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",i.cm());const h=this;this._rtlTextPluginCallback=ls.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(g,x)=>{if(i.cn(g),x&&x.every(I=>I))for(const I in h._sourceCaches){const P=h._sourceCaches[I],z=P.getSource().type;z!=="vector"&&z!=="geojson"||P.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.getOwnSource(m.sourceId);if(g&&g.vectorLayerIds)for(const x in this._layers){const I=this._layers[x];I.source===g.id&&this._validateLayer(I)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(i.f(t))return t;const s=i.co(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${i.cp(JSON.stringify(t))}`}_diffStyle(t,s,h){this.globalId=this._getGlobalId(t);const m=(g,x)=>{try{x(null,this.setState(g,h))}catch(I){x(I,!1)}};if(typeof t=="string"){const g=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(g,i.R.Style);i.n(x,(I,P)=>{I?this.fire(new i.z(I)):P&&m(P,s)})}else typeof t=="object"&&m(t,s)}loadURL(t,s={}){this.fire(new i.A("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!i.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const m=this.importsCache.get(t);if(m)return this._load(m,h);const g=this.map._requestManager.transformRequest(t,i.R.Style);this._request=i.n(g,(x,I)=>{if(this._request=null,x)this.fire(new i.z(x));else if(I)return this.importsCache.set(t,I),this._load(I,h)})}loadJSON(t,s={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=i.q.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(pf,!1)}_loadImports(t,s,h){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const g of t){const x=this._createFragmentStyle(g),I=new Promise(L=>{x.once("style.import.load",L),x.once("error",L)}).then(()=>this.mergeAll());if(m.push(I),this.resolvedImports.has(g.url)){x.loadEmpty();continue}const P=g.data||this.importsCache.get(g.url);P?(x.loadJSON(P,{validate:s}),this._isInternalStyle(P)&&(x.globalId=null)):g.url?x.loadURL(g.url,{validate:s}):x.loadEmpty();const z={style:x,id:g.id,config:g.config};if(h){const L=this.fragments.findIndex(({id:F})=>F===h);this.fragments=this.fragments.slice(0,L).concat(z).concat(this.fragments.slice(L))}else this.fragments.push(z)}return Promise.allSettled(m)}getImportGlobalIds(t=this,s=new Set){for(const h of t.fragments)h.style.globalId&&s.add(h.style.globalId),this.getImportGlobalIds(h.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?i.C(t.id,this.scope):t.id;let h;const m=this._initialConfig&&this._initialConfig[s];(t.config||m)&&(h=i.l({},t.config,m));const g=new ls(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){const h=t.indoor?uh(t.schema):t.schema;if(this._isInternalStyle(t)){const x=i.l({},pf,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(x,s)}if(this.updateConfig(this._config,h),s&&Ja(this,bs(t)))return;this._loaded=!0,this.stylesheet=i.cq(t);const m=()=>{for(const z in t.sources)this.addSource(z,t.sources[z],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const z in t.iconsets)this.addIconset(z,t.iconsets[z]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const x=af(this.stylesheet.layers);if(this._order=x.map(z=>z.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new De(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new De(this.stylesheet.light)),this._layers={};for(const z of x){const L=i.cv(z,this.scope,this._styleColorTheme.lut,this.options);L.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const F=this.getOwnLayerSourceCache(L),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&L.canCastShadows()&&B&&(F.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const P=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then(()=>{this._reloadImports(),this.fire(new i.A(P?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(P?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const x=this._evaluateColorThemeData(g);this._loadColorTheme(x).then(()=>{m()}).catch(I=>{i.w(`Couldn't load color theme from the stylesheet: ${I}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,s,h,m,g,x,I,P,z,L;const F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(t=B.light),B.stylesheet.lights)for(const j of B.stylesheet.lights)j.type==="ambient"&&B.ambientLight!=null&&(s=B.ambientLight),j.type==="directional"&&B.directionalLight!=null&&(h=B.directionalLight);m=this._prioritizeTerrain(m,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(g=B.fog),B.stylesheet.snow&&B.snow!=null&&(x=B.snow),B.stylesheet.rain&&B.rain!=null&&(I=B.rain),B.stylesheet.camera!=null&&(L=B.stylesheet.camera),B.stylesheet.projection!=null&&(P=B.stylesheet.projection),B.stylesheet.transition!=null&&(z=B.stylesheet.transition),F[B.scope]=B._styleColorTheme}}),this.light=t,this.ambientLight=s,this.directionalLight=h,this.fog=g,this.snow=x,this.rain=I,this._styleColorThemeForScope=F,m===null?delete this.terrain:this.terrain=m,this.camera=L||{"camera-projection":"perspective"},this.projection=P||{name:"mercator"},this.transition=i.l({},a_,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const s=h=>{for(const m of h.fragments)s(m.style);t(h)};s(this)}_prioritizeTerrain(t,s,h){const m=t&&t.drapeRenderMode===0;return h===null?s&&s.drapeRenderMode===0?s:m?t:null:s!=null&&(!t||m||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},h={};this.forEachFragmentStyle(m=>{for(const g in m._sourceCaches){const x=i.C(g,m.scope);t[x]=m._sourceCaches[g]}for(const g in m._otherSourceCaches){const x=i.C(g,m.scope);s[x]=m._otherSourceCaches[g]}for(const g in m._symbolSourceCaches){const x=i.C(g,m.scope);h[x]=m._symbolSourceCaches[g]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=h}mergeLayers(){const t={},s=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(g=>{for(const x of g._order){const I=g._layers[x];if(I.type==="slot"){const P=i.cr(x);if(t[P])continue;t[P]=[]}I.slot&&t[I.slot]?t[I.slot].push(I):s.push(I)}}),this._mergedOrder=[];const m=(g=[])=>{for(const x of g)if(x.type==="slot"){const I=i.cr(x.id);t[I]&&m(t[I]),this._mergedSlots.push(I)}else{const I=i.C(x.id,x.scope);this._mergedOrder.push(I),h[I]=x,x.is3D(!!this.terrain)&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0),x.type==="clip"&&(this._clipLayerPresent=!0)}};m(s),this._mergedOrder.sort((g,x)=>{const I=h[g],P=h[x];return I.hasInitialOcclusionOpacityProperties?P.is3D(!!this.terrain)?1:0:I.is3D(!!this.terrain)&&P.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=i.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(s,h,m){const g=i.l({},h);for(const I of Object.keys(i.a5.colorTheme))g[I]===void 0&&(g[I]=i.a5.colorTheme[I].default);const x=new i.a6(g0,s,new Map(m));return x.setTransitionOrValue(g,m),x.untransitioned().possiblyEvaluate(new i.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((h,m)=>{const g="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let x=t;x.startsWith(g)||(x=g+x);const I=i.I.from("mapbox-reserved-lut"),P=new Image;P.src=x,P.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},P.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void h();this._styleColorTheme.lutLoading=!1;const{width:z,height:L,data:F}=i.q.getImageData(P);if(L>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==L*L)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new i.r({width:z,height:L},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(I,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},h()):m(new Error("Missing LUT image."))}})}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(s,h,m){let g,x,I;const P=i.q.devicePixelRatio>1?"@2x":"";let z=i.n(h.transformRequest(h.normalizeSpriteURL(s,P,".json"),i.R.SpriteJSON),(B,j)=>{z=null,I||(I=B,g=j,F())}),L=i.o(h.transformRequest(h.normalizeSpriteURL(s,P,".png"),i.R.SpriteImage),(B,j)=>{L=null,I||(I=B,x=j,F())});function F(){if(I)m(I);else if(g&&x){const B=i.q.getImageData(x),j={};for(const X in g){const{width:q,height:J,x:Q,y:oe,sdf:ue,pixelRatio:ce,stretchX:ye,stretchY:pe,content:ge}=g[X],me=new i.r({width:q,height:J});i.r.copy(B,me,{x:Q,y:oe},{x:0,y:0},{width:q,height:J},null),j[X]={data:me,pixelRatio:ce,sdf:ue,stretchX:ye,stretchY:pe,content:ge,usvg:!1}}m(null,j)}}return{cancel(){z&&(z.cancel(),z=null),L&&(L.cancel(),L=null)}}}(t,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new i.z(s));else if(h){const m=new Map;for(const g in h)m.set(i.I.from(g),h[g]);this.addImages(m)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const h=this.getOwnSource(s.source);if(!h)return void this.fire(new i.z(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));if(h.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));this.imageManager.createIconset(this.scope,t);const m=new df(t,this);h.addIconset(t,m)}_loadIconset(t){if(!i.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var h,m;this._spriteRequest=(m=(g,x)=>{if(this._spriteRequest=null,g)s?this._loadSprite(t):this.fire(new i.z(g));else if(x){const I=new Map;for(const P in x)I.set(i.I.from(P),x[P]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.bj((h=this.map._requestManager).transformRequest(h.normalizeIconsetURL(t),i.R.Iconset),(g,x)=>{if(g)return void m(g);const I={},P=i.ch(new i.bi(x));for(const z of P.icons){const L={version:1,pixelRatio:i.q.devicePixelRatio,content:o_(z),stretchX:z.metadata?hf(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?hf(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};I[z.name]=L}m(null,I)}))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const h=t.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new i.z(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,s)=>{const h=this.fragments[s];return h&&h.style&&(t.data=h.style.serialize()),t})}_serializeSources(){const t={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();t[h.id]||(t[h.id]=h.serialize())}return t}_serializeLayers(t){const s=[];for(const h of t){const m=this._layers[h];m&&m.type!=="custom"&&s.push(m.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new i.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new i.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const h=this.map.painter;if(h)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){const g=t.getProgramIds();if(g)for(const x of g){const I=t.getDefaultProgramParams(x,s.zoom,this._styleColorTheme.lut);I&&(h.style=this,this.fog&&(h._fogVisible=!0,I.overrideFog=!0,h.getOrCreateProgram(x,I)),h._fogVisible=!1,I.overrideFog=!1,h.getOrCreateProgram(x,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,h.getOrCreateProgram(x,I)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const h=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const x=this._changes.getLayerUpdatesByScope();for(const I in x){const{updatedIds:P,removedIds:z}=x[I];(P||z)&&(this._updateWorkerLayers(I,P,z),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const g={};for(const x in this._mergedSourceCaches){const I=this._mergedSourceCaches[x];g[x]=I.used,I.used=!1,I.tileCoverLift=0}for(const x of this._mergedOrder){const I=this._mergedLayers[x];if(I.recalculate(t,this._availableImages),!I.isHidden(t.zoom)){const P=this.getLayerSourceCache(I);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,t)}):this.precompilePrograms(I,t))}for(const x in this._mergedSourceCaches){const I=this._mergedSourceCaches[x];if(!I)continue;const P=I._source;P.type==="raster-array"&&P.iconsets&&(I.used=!0)}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();for(const x in g){const I=this._mergedSourceCaches[x];g[x]!==I.used&&I.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),h&&this.fire(new i.A("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,s,h){const m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:s?m._serializeLayers(s):[],scope:t,removedIds:h||[],options:m.options})}setState(t,s){if(this._checkLoaded(),Ja(this,bs(t)))return!1;(t=i.cq(t)).layers=af(t.layers);const h=function(x,I){if(!x)return[{command:Xr.setStyle,args:[I]}];let P=[];try{if(!i.bn(x.version,I.version))return[{command:Xr.setStyle,args:[I]}];if(i.bn(x.center,I.center)||P.push({command:Xr.setCenter,args:[I.center]}),i.bn(x.zoom,I.zoom)||P.push({command:Xr.setZoom,args:[I.zoom]}),i.bn(x.bearing,I.bearing)||P.push({command:Xr.setBearing,args:[I.bearing]}),i.bn(x.pitch,I.pitch)||P.push({command:Xr.setPitch,args:[I.pitch]}),i.bn(x.sprite,I.sprite)||P.push({command:Xr.setSprite,args:[I.sprite]}),i.bn(x.glyphs,I.glyphs)||P.push({command:Xr.setGlyphs,args:[I.glyphs]}),i.bn(x.imports,I.imports)||function(j=[],X=[],q){X=X||[];const J=(j=j||[]).map(sn),Q=X.map(sn),oe=j.reduce(Kr,{}),ue=X.reduce(Kr,{}),ce=J.slice();let ye,pe,ge,me;for(ye=0,pe=0;ye<J.length;ye++)ge=J[ye],ue.hasOwnProperty(ge)?pe++:(q.push({command:Xr.removeImport,args:[ge]}),ce.splice(ce.indexOf(ge,pe),1));for(ye=0,pe=0;ye<Q.length;ye++)ge=Q[Q.length-1-ye],ce[ce.length-1-ye]!==ge&&(oe.hasOwnProperty(ge)?(q.push({command:Xr.removeImport,args:[ge]}),ce.splice(ce.lastIndexOf(ge,ce.length-pe),1)):pe++,me=ce[ce.length-ye],q.push({command:Xr.addImport,args:[ue[ge],me]}),ce.splice(ce.length-ye,0,ge));for(const we of X){const Ee=oe[we.id];Ee&&!i.bn(Ee,we)&&q.push({command:Xr.updateImport,args:[we.id,we]})}}(x.imports,I.imports,P),i.bn(x.transition,I.transition)||P.push({command:Xr.setTransition,args:[I.transition]}),i.bn(x.light,I.light)||P.push({command:Xr.setLight,args:[I.light]}),i.bn(x.fog,I.fog)||P.push({command:Xr.setFog,args:[I.fog]}),i.bn(x.snow,I.snow)||P.push({command:Xr.setSnow,args:[I.snow]}),i.bn(x.rain,I.rain)||P.push({command:Xr.setRain,args:[I.rain]}),i.bn(x.projection,I.projection)||P.push({command:Xr.setProjection,args:[I.projection]}),i.bn(x.lights,I.lights)||P.push({command:Xr.setLights,args:[I.lights]}),i.bn(x.camera,I.camera)||P.push({command:Xr.setCamera,args:[I.camera]}),!i.bn(x["color-theme"],I["color-theme"]))return[{command:Xr.setStyle,args:[I]}];const z={},L=[];(function(j,X,q,J){let Q;for(Q in X=X||{},j=j||{})j.hasOwnProperty(Q)&&(X.hasOwnProperty(Q)||Hs(Q,q,J));for(Q in X){if(!X.hasOwnProperty(Q))continue;const oe=X[Q];j.hasOwnProperty(Q)?i.bn(j[Q],oe)||(j[Q].type==="geojson"&&oe.type==="geojson"&&Sl(j,X,Q)?q.push({command:Xr.setGeoJSONSourceData,args:[Q,oe.data]}):lf(Q,X,q,J)):Yu(Q,X,q)}})(x.sources,I.sources,L,z);const F=[];x.layers&&x.layers.forEach(j=>{j.source&&z[j.source]?P.push({command:Xr.removeLayer,args:[j.id]}):F.push(j)});let B=x.terrain;B&&z[B.source]&&(P.push({command:Xr.setTerrain,args:[void 0]}),B=void 0),P=P.concat(L),i.bn(B,I.terrain)||P.push({command:Xr.setTerrain,args:[I.terrain]}),function(j,X,q){X=X||[];const J=(j=j||[]).map(sn),Q=X.map(sn),oe=j.reduce(Kr,{}),ue=X.reduce(Kr,{}),ce=J.slice(),ye=Object.create(null);let pe,ge,me,we,Ee,He,Be;for(pe=0,ge=0;pe<J.length;pe++)me=J[pe],ue.hasOwnProperty(me)?ge++:(q.push({command:Xr.removeLayer,args:[me]}),ce.splice(ce.indexOf(me,ge),1));for(pe=0,ge=0;pe<Q.length;pe++)me=Q[Q.length-1-pe],ce[ce.length-1-pe]!==me&&(oe.hasOwnProperty(me)?(q.push({command:Xr.removeLayer,args:[me]}),ce.splice(ce.lastIndexOf(me,ce.length-ge),1)):ge++,He=ce[ce.length-pe],q.push({command:Xr.addLayer,args:[ue[me],He]}),ce.splice(ce.length-pe,0,me),ye[me]=!0);for(pe=0;pe<Q.length;pe++)if(me=Q[pe],we=oe[me],Ee=ue[me],!ye[me]&&!i.bn(we,Ee))if(i.bn(we.source,Ee.source)&&i.bn(we["source-layer"],Ee["source-layer"])&&i.bn(we.type,Ee.type)){for(Be in Ht(we.layout,Ee.layout,q,me,null,Xr.setLayoutProperty),Ht(we.paint,Ee.paint,q,me,null,Xr.setPaintProperty),i.bn(we.slot,Ee.slot)||q.push({command:Xr.setSlot,args:[me,Ee.slot]}),i.bn(we.filter,Ee.filter)||q.push({command:Xr.setFilter,args:[me,Ee.filter]}),i.bn(we.minzoom,Ee.minzoom)&&i.bn(we.maxzoom,Ee.maxzoom)||q.push({command:Xr.setLayerZoomRange,args:[me,Ee.minzoom,Ee.maxzoom]}),we)we.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?Ht(we[Be],Ee[Be],q,me,Be.slice(6),Xr.setPaintProperty):i.bn(we[Be],Ee[Be])||q.push({command:Xr.setLayerProperty,args:[me,Be,Ee[Be]]}));for(Be in Ee)Ee.hasOwnProperty(Be)&&!we.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?Ht(we[Be],Ee[Be],q,me,Be.slice(6),Xr.setPaintProperty):i.bn(we[Be],Ee[Be])||q.push({command:Xr.setLayerProperty,args:[me,Be,Ee[Be]]}))}else q.push({command:Xr.removeLayer,args:[me]}),He=ce[ce.lastIndexOf(me)+1],q.push({command:Xr.addLayer,args:[Ee,He]})}(F,I.layers,P)}catch(z){console.warn("Unable to compute style diff:",z),P=[{command:Xr.setStyle,args:[I]}]}return P}(this.serialize(),t).filter(x=>!(x.command in b0));if(h.length===0)return!1;const m=h.filter(x=>!(x.command in x0));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);const g=[];return h.forEach(x=>{g.push(this[x.command].apply(this,x.args))}),s&&Promise.all(g).then(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}addImages(t){for(const[s,h]of t.entries()){if(this.getImage(s)&&!s.iconsetId)return this.fire(new i.z(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,h),this._changes.updateImage(s)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)&&!t.iconsetId?this.fire(new i.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(t,s,h=!1){this.imageManager.updateImage(t,this.scope,s),h&&(this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,s,h={}){return this._checkLoaded(),this._validate(Te,`models.${t}`,s,null,h)||(this.modelManager.addModel(t,s,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,s,h={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(Ga,`sources.${t}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=Qd(t,s,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const g=x=>{const I=(x?"symbol:":"other:")+m.id,P=i.C(I,this.scope),z=this._sourceCaches[I]=new Ss(P,m,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=z,z.onAdd(this.map)};g(!1),s.type!=="vector"&&s.type!=="geojson"||g(!0),m.onAdd&&m.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new i.z(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new i.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const h=this.getOwnSourceCaches(t);for(const m of h){const g=i.cr(m.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(m.id),m.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const h=this.getOwnSourceCache(s);h&&t.push(h.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const h=t[s]._tiles;for(const m in h){const g=h[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const m of t){if(this._validate(zc,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){const g=this.ambientLight;g.set(m),g.updateTransitions(s)}else this.ambientLight=new un(m,jn||(jn=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const g=this.directionalLight;g.set(m),g.updateTransitions(s)}else this.directionalLight=new un(m,Or||(Or=new i.a7({direction:new i.am(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const h=new i.aa(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const h=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),m=t.properties.get("color").toRenderColor(null).toArray01(),g=t.properties.get("intensity"),x=t.properties.get("direction"),I=1-i.cc(x.x,x.y,x.z)[2]/90,P=h(m)*g*I,z=s.properties.get("color").toRenderColor(null).toArray01(),L=s.properties.get("intensity"),F=h(z)*L;return Number(((P+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(i.cs(t)){const s=i.ct(t),h=this.fragments.find(({id:g})=>g===s);if(!h)throw new Error(`Style import '${t}' not found`);const m=i.cr(t);return h.style.getFragmentStyle(m)}{const s=this.fragments.find(({id:h})=>h===t);return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},h=(m,g="")=>`${m}::${g}`;this._featuresetSelectors={};for(const m in t){const g=this._featuresetSelectors[m]=[];for(const x of t[m].selectors){if(x.featureNamespace){const P=this.getOwnLayer(x.layer);if(!P){i.w(`Layer is undefined for selector: ${x.layer}`);continue}const z=h(P.source,P.sourceLayer);if(z in s&&s[z]!==x.featureNamespace){i.w(`"featureNamespace ${x.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}s[z]=x.featureNamespace}let I;if(x.properties)for(const P in x.properties){const z=i.X(x.properties[P]);z.result==="success"&&(I=I||{},I[P]=z.value)}g.push({layerId:x.layer,namespace:x.featureNamespace,properties:I,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const h=[];for(const m in s.stylesheet.featuresets)h.push({featuresetId:m,importId:s.scope?s.scope:void 0});return h}getFeaturesetLayers(t,s){const h=this.getFragmentStyle(s),m=h.stylesheet.featuresets;if(!m||!m[t])return this.fire(new i.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const g=[];for(const x of m[t].selectors){const I=h.getOwnLayer(x.layer);I&&g.push(I)}return g}getConfigProperty(t,s){const h=this.getFragmentStyle(t);if(!h)return null;const m=i.C(s,h.scope),g=h.options.get(m),x=g?g.value||g.default:null;return x?x.serialize():null}setConfigProperty(t,s,h){const m=this.getFragmentStyle(t);if(!m)return;const g=m.stylesheet.indoor?uh(m.stylesheet.schema):m.stylesheet.schema;if(!g||!g[s])return;const x=i.X(h);if(x.result!=="success")return void Ja(this,x.value);const I=x.value.expression,P=i.C(s,m.scope),z=m.options.get(P);if(!z)return;let L;const{minValue:F,maxValue:B,stepValue:j,type:X,values:q}=g[s],J=i.X(g[s].default);J.result==="success"&&(L=J.value.expression),L?(this.options.set(P,Object.assign({},z,{value:I,default:L,minValue:F,maxValue:B,stepValue:j,type:X,values:q})),this.updateConfigDependencies(s)):this.fire(new i.z(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const h=s.stylesheet.schema;if(!h)return null;const m={};for(const g in h){const x=i.C(g,s.scope),I=s.options.get(x),P=I?I.value||I.default:null;m[g]=P?P.serialize():null}return m}setConfig(t,s){const h=this.getFragmentStyle(t);h&&(h.updateConfig(s,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const h=this.getFragmentStyle(t);h&&(h.stylesheet.schema=s,h.updateConfig(h._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const h in s){let m,g;const x=i.X(s[h].default);if(x.result==="success"&&(m=x.value.expression),t&&t[h]!==void 0){const B=i.X(t[h]);B.result==="success"&&(g=B.value.expression)}const{minValue:I,maxValue:P,stepValue:z,type:L,values:F}=s[h];if(m){const B=i.C(h,this.scope);this.options.set(B,{default:m,value:g,minValue:I,maxValue:P,stepValue:z,type:L,values:F})}else this.fire(new i.z(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const s of this._configDependentLayers){const h=this.getLayer(s);if(h){if(t&&!h.configDependencies.has(t))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const h=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(h){const m=s._evaluateColorThemeData(h);(!s._styleColorTheme.lut&&m!==""||s._styleColorTheme.lut&&m!==s._styleColorTheme.lut.data)&&s.setColorTheme(h)}}),this._changes.setDirty()}addLayer(t,s,h={}){this._checkLoaded();const m=t.id;if(this._layers[m])return void this.fire(new i.z(new Error(`Layer with id "${m}" already exists on this map`)));let g;if(t.type==="custom"){if(Ja(this,i.cu(t)))return;g=i.cv(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=i.cq(t),t=i.l(t,{source:m})),this._validate(Xe,`layers.${m}`,t,{arrayIndex:-1},h))return;g=i.cv(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:m}})}g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid);let x=this._order.length;if(s){const L=this._order.indexOf(s);if(L===-1)return void this.fire(new i.z(new Error(`Layer with id "${s}" does not exist on this map.`)));g.slot===this._layers[s].slot?x=L:i.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,m),this._layerOrderChanged=!0,this._layers[m]=g;const I=this.getOwnLayerSourceCache(g),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&g.canCastShadows()&&P&&(I.castsShadows=!0);const z=this._changes.getRemovedLayer(g);if(z&&g.source&&I&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const L=i.C(g.source,g.scope);z.type!==g.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),I.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const h=this._checkLayer(t);if(!h||t===s)return;const m=this._order.indexOf(t);this._order.splice(m,1);let g=this._order.length;if(s){const x=this._order.indexOf(s);if(x===-1)return void this.fire(new i.z(new Error(`Layer with id "${s}" does not exist on this map.`)));h.slot===this._layers[s].slot?g=x:i.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const m=this.getOwnLayerSourceCache(s);if(m&&m.castsShadows){let g=!1;for(const x in this._layers)if(this._layers[x].source===s.source&&this._layers[x].canCastShadows()){g=!0;break}m.castsShadows=g}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,h){this._checkLoaded();const m=this._checkLayer(t);m&&(m.minzoom===s&&m.maxzoom===h||(s!=null&&(m.minzoom=s),h!=null&&(m.maxzoom=h),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const h=this._checkLayer(t);h&&h.slot!==s&&(h.slot=s,this._updateLayer(h))}setFilter(t,s,h={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!i.bn(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(Y,`layers.${m.id}.filter`,s,{layerType:m.type},h)||(m.filter=i.cq(s),this._updateLayer(m)))}getFilter(t){const s=this._checkLayer(t);if(s)return i.cq(s.filter)}setLayoutProperty(t,s,h,m={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!i.bn(g.getLayoutProperty(s),h)){if(h!=null&&(!m||m.validate!==!1)&&Ja(g,fe.call(bs,{key:`layers.${t}.layout.${s}`,layerType:g.type,objectKey:s,value:h,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(s,h),g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(t,s){const h=this._checkLayer(t);if(h)return h.getLayoutProperty(s)}setPaintProperty(t,s,h,m={}){this._checkLoaded();const g=this._checkLayer(t);if(!g||i.bn(g.getPaintProperty(s),h)||h!=null&&(!m||m.validate!==!1)&&Ja(g,re.call(bs,{key:`layers.${t}.paint.${s}`,layerType:g.type,objectKey:s,value:h,styleSpec:i.a5})))return;const x=g.setPaintProperty(s,h);g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),x&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(t,s){const h=this._checkLayer(t);if(h)return h.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:P,importId:z}=t.target,L=this.getFragmentStyle(z),F=L.getFeaturesetLayers(P);for(const{source:B,sourceLayer:j}of F)L.setFeatureState({id:t.id,source:B,sourceLayer:j},s)}else if("layerId"in t.target){const{layerId:P}=t.target,z=this.getLayer(P);this.setFeatureState({id:t.id,source:z.source,sourceLayer:z.sourceLayer},s)}return}const h=t.source,m=t.sourceLayer,g=this._checkSource(h);if(!g)return;const x=g.type;if(x==="geojson"&&m)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!m)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(h);for(const P of I)P.setFeatureState(m,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:P,importId:z}=t.target,L=this.getFragmentStyle(z),F=L.getFeaturesetLayers(P);for(const{source:B,sourceLayer:j}of F)L.removeFeatureState({id:t.id,source:B,sourceLayer:j},s)}else if("layerId"in t.target){const{layerId:P}=t.target,z=this.getLayer(P);this.removeFeatureState({id:t.id,source:z.source,sourceLayer:z.sourceLayer},s)}return}const h=t.source,m=this._checkSource(h);if(!m)return;const g=m.type,x=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!x)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(h);for(const P of I)P.removeFeatureState(x,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let g;if("featuresetId"in t.target){const{featuresetId:x,importId:I}=t.target,P=this.getFragmentStyle(I),z=P.getFeaturesetLayers(x);for(const{source:L,sourceLayer:F}of z){const B=P.getFeatureState({id:t.id,source:L,sourceLayer:F});if(B&&!g)g=B;else if(!i.bn(g,B))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:x}=t.target,I=this.getLayer(x);g=this.getFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer})}return g}const s=t.source,h=t.sourceLayer,m=this._checkSource(s);if(m){if(m.type!=="vector"||h)return t.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(h,t.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=i.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return i.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),h=i.C(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[h]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=I=>this._mergedLayers[I].is3D(!!this.terrain),h=this.order,m={},g=[];for(let I=h.length-1;I>=0;I--){const P=h[I];if(s(P)){m[P]=I;for(const z of t){const L=z[P];if(L)for(const F of L)g.push(F)}}}g.sort((I,P)=>P.intersectionZ-I.intersectionZ);const x=[];for(let I=h.length-1;I>=0;I--){const P=h[I];if(s(P))for(let z=g.length-1;z>=0;z--){const L=g[z].feature;if(L.layer&&m[L.layer.id]<I)break;x.push(L),g.pop()}else for(const z of t){const L=z[P];if(L)for(const F of L)x.push(F.feature)}}return x}queryRenderedFeatures(t,s,h){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(Y,"queryRenderedFeatures.filter",s.filter,null,s),m=i.a_(s.filter));const g={},x=L=>{if(ff.has(L.type))return;const F=this.getOwnLayerSourceCache(L),B=g[F.id]=g[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[L.fqid]=B.layers[L.fqid]||{styleLayer:L,targets:[]},B.layers[L.fqid].targets.push({filter:m})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const L of s.layers){const F=this._layers[L];if(!F)return this.fire(new i.z(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];x(F)}}else for(const L in this._layers)x(this._layers[L]);const I=this._queryRenderedFeatures(t,g,h),P=this._flattenAndSortRenderedFeatures(I),z=[];for(const L of P)i.ct(L.layer.id)===this.scope&&z.push(L);return z}queryRenderedFeatureset(t,s,h){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(Y,"queryRenderedFeatures.filter",s.filter,null,s),m=i.a_(s.filter));const g="mock",x=[];if(s&&s.target)x.push(Object.assign({},s,{targetId:g,filter:m}));else{const L=this.getFeaturesetDescriptors();for(const F of L)x.push({targetId:g,filter:m,target:F});for(const{style:F}of this.fragments){const B=F.getFeaturesetDescriptors();for(const j of B)x.push({targetId:g,filter:m,target:j})}}const I=this.queryRenderedTargets(t,x,h),P=[],z=new Set;for(const L of I)for(const F of L.variants[g])Oc(F,L,z)||P.push(new i.cx(L,F));return P}queryRenderedTargets(t,s,h){const m={},g=(I,P,z,L)=>{const F=m[P.id]=m[P.id]||{sourceCache:P,layers:{},has3DLayers:!1};if(F.layers[I.fqid]=F.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(F.has3DLayers=!0),!L)return z.uniqueFeatureID=!1,void F.layers[I.fqid].targets.push(z);F.layers[I.fqid].targets.push(Object.assign({},z,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const I of s)if("featuresetId"in I.target){const{featuresetId:P,importId:z}=I.target,L=this.getFragmentStyle(z);if(!L||!L._featuresetSelectors)continue;const F=L._featuresetSelectors[P];if(!F){this.fire(new i.z(new Error(`The featureset '${P}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of F){const j=L.getOwnLayer(B.layerId);j&&!ff.has(j.type)&&g(j,L.getOwnLayerSourceCache(j),I,B)}}else if("layerId"in I.target){const{layerId:P}=I.target,z=this.getLayer(P);if(!z||ff.has(z.type))continue;g(z,this.getLayerSourceCache(z),I)}const x=this._queryRenderedFeatures(t,m,h);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(t,s,h){const m=[],g=!!this.map._showQueryGeometry,x=Qn.createFromScreenPoints(t,h);for(const I in s){const P=kc(x,s[I],this._availableImages,h,g);Object.keys(P).length&&m.push(P)}if(this.placement)for(const I in s){if(!s[I].sourceCache._onlySymbols)continue;const P=tf(x.screenGeometry,s[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(P).length&&m.push(P)}return m}querySourceFeatures(t,s){const h=s&&s.filter;h&&this._validate(Y,"querySourceFeatures.filter",h,null,s);let m=[];const g=this.getOwnSourceCaches(t);for(const x of g)m=m.concat(Km(x,s));return m}addSourceType(t,s,h){return ls.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(ls.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,h={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const I in t)if(!i.bn(t[I],m[I])){g=!0;break}if(!g)return;const x=this._getTransitionParameters();this.light.setLight(t,s,h),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=t;const m=t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){const I="terrain-dem-src";this.addSource(I,h.source),h=i.cq(h),h=i.l(h,{source:I})}const g=i.l({},h),x={};if(this.terrain&&m){g.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(x.style=I.serialize())}if(this._validate(Tl,"terrain",g,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&s!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,s),this.fire(new i.A("data",{dataType:"style"}))}else{const g=this.terrain,x=g.get();for(const I of Object.keys(i.a5.terrain))!h.hasOwnProperty(I)&&i.a5.terrain[I].default&&(h[I]=i.a5.terrain[I].default);for(const I in t)if(!i.bn(t[I],x[I])){g.set(t,this.options),this.stylesheet.terrain=t;const P=this._getTransitionParameters({duration:0});g.updateTransitions(P),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Ar(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createSnow(t){const s=this.snow=new hn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createRain(t){const s=this.rain=new cn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const h=this._evaluateColorThemeData(s);this._loadColorTheme(h).then(()=>{this.fire(new i.A("colorthemeset")),t()}).catch(m=>{i.w(`Couldn't set color theme: ${m}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const h=this.getFragmentStyle(t);h&&(h._styleColorTheme.colorThemeOverride=s,h._reloadColorTheme())}_getTransitionParameters(t){return{now:i.q.now(),transition:i.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?t.push(h):s.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const h=this.terrain=new qe(t,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});h.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,h,m,g={}){if(g&&g.validate===!1)return!1;const x=i.l({},this.serialize());return Ja(this,t.call(bs,i.l({key:s,style:x,value:h,styleSpec:i.a5},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const h of s)h.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const s=this.getSourceCaches(t);for(const h of s)h.resume(),h.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let s;this.directionalLight&&(s=lh(this.directionalLight));for(const h in this._mergedSourceCaches)this._mergedSourceCaches[h].update(t,void 0,void 0,s)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,h,m,g,x,I=!1){let P=!1,z=!1;const L={},F={};for(const B of this._mergedOrder){const j=this._mergedLayers[B];if(j.type!=="symbol")continue;const X=i.C(j.source,j.scope);let q=L[X];if(!q){const Q=this.getLayerSourceCache(j);if(!Q)continue;const oe=Q.getRenderableIds(!0).map(ue=>Q.getTileByID(ue));F[X]=oe.slice(),q=L[X]=oe.sort((ue,ce)=>ce.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(ce.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(j,q,s.center.lng,s.projection);P=P||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),s.zoom))&&(this.pauseablePlacement=new nh(s,this._mergedOrder,I,h,m,g,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),z=!0),P&&this.pauseablePlacement.placement.setStale()),z||P){this._buildingIndex.onNewFrame(s.zoom);for(let B=0;B<this._mergedOrder.length;B++){const j=this._mergedLayers[this._mergedOrder[B]];if(j.type!=="symbol")continue;const X=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,L[i.C(j.source,j.scope)],B,X?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:g})=>g===t.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return h.push(t),this._loadImports([t],!0);const m=h.findIndex(({id:g})=>g===s);return m===-1&&this.fire(new i.z(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,m).concat(t).concat(h.slice(m)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==h[m].url&&this.setImportUrl(t,s.url),i.bn(s.config,h[m].config)||this.setImportConfig(t,s.config,s.data.schema),i.bn(s.data,h[m].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let h=this.stylesheet.imports||[];const m=this.getImportIndex(t);if(m===-1)return this;const g=this.getImportIndex(s);if(g===-1)return this;const x=h[m],I=this.fragments[m];return h=h.filter(({id:P})=>P!==t),this.fragments=this.fragments.filter(({id:P})=>P!==t),this.stylesheet.imports=h.slice(0,g).concat(x).concat(h.slice(g)),this.fragments=this.fragments.slice(0,g).concat(I).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;h[m].url=s;const g=this.fragments[m];return g.style=this._createFragmentStyle(h[m]),g.style.on("style.import.load",()=>this.mergeAll()),g.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const h=this.getImportIndex(t),m=this.stylesheet.imports||[];return h===-1?this:s?(this.fragments[h].style.setState(s),this._reloadImports(),this):(delete m[h].data,this.setImportUrl(t,m[h].url))}setImportConfig(t,s,h){this._checkLoaded();const m=this.getImportIndex(t),g=this.stylesheet.imports||[];if(m===-1)return this;s?g[m].config=s:delete g[m].config;const x=this.fragments[m];h&&x.style.stylesheet&&(x.style.stylesheet.schema=h);const I=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=s,x.style.updateConfig(s,I),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],h=this.getImportIndex(t);h!==-1&&(s.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex(h=>h.id===t);return s===-1&&this.fire(new i.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[s];h&&t.push(h.getSource())}return t}getSource(t,s){const h=this.getSourceCache(t,s);return h&&h.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const h=i.C(t,s);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(t){const s=i.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const h=t[s];h==="reload"?this.reloadSource(s):h==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const h of s){const m=this.getLayer(h);m&&m.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,s,h){this.imageManager.getImages(s.images,s.scope,h),this._updateTilesForChangedImages();const m=x=>{if(x){const I=s.images.map(P=>i.I.toString(P));x.setDependencies(s.tileID.key,s.type,I)}},g=i.C(s.source,s.scope);m(this._mergedOtherSourceCaches[g]),m(this._mergedSymbolSourceCaches[g])}rasterizeImages(t,s,h){this.imageManager.rasterizeImages(s,h)}getGlyphs(t,s,h){this.glyphManager.getGlyphs(s.stacks,s.scope,h)}getResource(t,s,h){return i.cz(s,h)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${t}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const h=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(h||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ls.getSourceType=function(d){return qa[d]},ls.setSourceType=function(d,t){qa[d]=t},ls.registerForPluginStateChange=i.ci;var l_=`
#define EPSILON 0.0000001\r
#define PI 3.141592653589793\r
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {\r
float near=cutoff_params.x;\r
float far=cutoff_params.y;\r
float cutoffStart=cutoff_params.z;\r
float cutoffEnd=cutoff_params.w;\r
float linearDepth=(depth-near)/(far-near);\r
return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);\r
}\r
#endif`,mf=`
out vec4 glFragColor;\r
highp float unpack_depth(highp vec4 rgba_depth)\r
{\r
const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r
return dot(rgba_depth,bit_shift)*2.0-1.0;\r
}highp vec4 pack_depth(highp float ndc_z) {\r
highp float depth=ndc_z*0.5+0.5;\r
const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\r
const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\r
highp vec4 res=fract(depth*bit_shift);\r
res-=res.xxyz*bit_mask;\r
return res;\r
}\r
#ifdef INDICATOR_CUTOUT\r
uniform vec3 u_indicator_cutout_centers;\r
uniform vec4 u_indicator_cutout_params;\r
#endif\r
vec4 applyCutout(vec4 color,float height) {\r
#ifdef INDICATOR_CUTOUT\r
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));\r
float holeRadius=max(u_indicator_cutout_params.y,0.0);\r
float holeAspectRatio=u_indicator_cutout_params.z;\r
float fadeStart=u_indicator_cutout_params.w;\r
float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));\r
return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\r
#else\r
return color;\r
#endif\r
}\r
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\\r
glFragColor=vec4(0.7,0.0,0.0,0.7); \\\r
gl_FragDepth=gl_FragCoord.z-0.0001;
#else\r
#define HANDLE_WIREFRAME_DEBUG\r
#endif\r
#ifdef RENDER_CUTOFF\r
uniform highp vec4 u_cutoff_params;\r
in float v_cutoff_opacity;\r
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {\r
highp vec2 size=vec2(textureSize(image,0));\r
highp vec2 dx=dFdx(lod_coord.xy*size);\r
highp vec2 dy=dFdy(lod_coord.xy*size);\r
highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));\r
highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);\r
}\r
vec4 applyLUT(highp sampler3D lut,vec4 col) {\r
vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;\r
return vec4(texture(lut,uvw).rgb,col.a);\r
}\r
vec3 applyLUT(highp sampler3D lut,vec3 col) {\r
return applyLUT(lut,vec4(col,1.0)).rgb;\r
}`,hh=`
#define EXTENT 8192.0\r
#define RAD_TO_DEG 180.0/PI\r
#define DEG_TO_RAD PI/180.0\r
#define GLOBE_RADIUS EXTENT/PI/2.0\r
float wrap(float n,float min,float max) {\r
float d=max-min;\r
float w=mod(mod(n-min,d)+d,d)+min;\r
return (w==min) ? max : w;\r
}\r
#ifdef PROJECTION_GLOBE_VIEW\r
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\r
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;\r
vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;\r
mercator-=mercator_center;\r
mercator.x=wrap(mercator.x,-0.5,0.5);\r
vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);\r
mercator_tile=matrix*mercator_tile;\r
return mercator_tile.xyz;\r
#else\r
return vec3(0.0);\r
#endif\r
}\r
vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\r
return mix(globe,mercator,t);\r
}\r
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {\r
vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));\r
vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));\r
vec3 yAxis=normalize(cross(normal,xAxis));\r
return mat3(xAxis,yAxis,normal);\r
}\r
#endif
vec2 unpack_float(const float packedValue) {\r
int packedIntValue=int(packedValue);\r
int v0=packedIntValue/256;\r
return vec2(v0,packedIntValue-v0*256);\r
}\r
vec2 unpack_opacity(const float packedOpacity) {\r
int intOpacity=int(packedOpacity)/2;\r
return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));\r
}vec4 decode_color(const vec2 encodedColor) {\r
return vec4(\r
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\r
);\r
}float unpack_mix_vec2(const vec2 packedValue,const float t) {\r
return mix(packedValue[0],packedValue[1],t);\r
}vec4 unpack_mix_color(const vec4 packedColors,const float t) {\r
vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));\r
vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));\r
return mix(minColor,maxColor,t);\r
}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {\r
vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);\r
return (units_to_pixels*pos+offset)/pattern_size;\r
}\r
vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {\r
return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);\r
}\r
float mercatorXfromLng(float lng) {\r
return (180.0+lng)/360.0;\r
}\r
float mercatorYfromLat(float lat) {\r
return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;\r
}\r
vec3 latLngToECEF(vec2 latLng) {\r
latLng=DEG_TO_RAD*latLng;\r
float cosLat=cos(latLng[0]);\r
float sinLat=sin(latLng[0]);\r
float cosLng=cos(latLng[1]);\r
float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;\r
float sy=-sinLat*GLOBE_RADIUS;\r
float sz=cosLat*cosLng*GLOBE_RADIUS;\r
return vec3(sx,sy,sz);\r
}\r
#ifdef RENDER_CUTOFF\r
uniform vec4 u_cutoff_params;\r
out float v_cutoff_opacity;\r
#endif\r
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;\r
vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\r
{\r
float skirt=float(posWithComposedSkirt.x >=skirtOffset);\r
vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);\r
return vec3(pos,skirt);\r
}`,qc=`in highp vec3 a_pos_3f;\r
uniform lowp mat4 u_matrix;\r
out highp vec3 v_uv;\r
void main() {\r
const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);\r
v_uv=half_neg_pi_around_x*a_pos_3f;\r
vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;\r
}`,dh=`
#define ELEVATION_SCALE 7.0\r
#define ELEVATION_OFFSET 450.0\r
#ifdef PROJECTION_GLOBE_VIEW\r
uniform vec3 u_tile_tl_up;\r
uniform vec3 u_tile_tr_up;\r
uniform vec3 u_tile_br_up;\r
uniform vec3 u_tile_bl_up;\r
uniform float u_tile_up_scale;\r
vec3 elevationVector(vec2 pos) {\r
vec2 uv=pos/EXTENT;\r
vec3 up=normalize(mix(\r
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));\r
return up*u_tile_up_scale;\r
}\r
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\r
#endif
#ifdef TERRAIN\r
uniform highp sampler2D u_dem;\r
uniform highp sampler2D u_dem_prev;\r
uniform vec2 u_dem_tl;\r
uniform vec2 u_dem_tl_prev;\r
uniform float u_dem_scale;\r
uniform float u_dem_scale_prev;\r
uniform float u_dem_size;uniform float u_dem_lerp;\r
uniform float u_exaggeration;\r
uniform float u_meter_to_dem;\r
uniform mat4 u_label_plane_matrix_inv;\r
vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {\r
vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;\r
vec2 f=fract(pos);\r
return vec4((pos-f+0.5)/(dem_size+2.0),f);\r
}\r
float currentElevation(vec2 apos) {\r
#ifdef TERRAIN_DEM_FLOAT_FORMAT\r
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);\r
return u_exaggeration*texture(u_dem,pos).r;\r
#else
float dd=1.0/(u_dem_size+2.0);\r
vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);\r
vec2 pos=r.xy;\r
vec2 f=r.zw;\r
float tl=texture(u_dem,pos).r;\r
float tr=texture(u_dem,pos+vec2(dd,0)).r;\r
float bl=texture(u_dem,pos+vec2(0,dd)).r;\r
float br=texture(u_dem,pos+vec2(dd,dd)).r;\r
return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\r
#endif
}\r
float prevElevation(vec2 apos) {\r
#ifdef TERRAIN_DEM_FLOAT_FORMAT\r
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);\r
return u_exaggeration*texture(u_dem_prev,pos).r;\r
#else
float dd=1.0/(u_dem_size+2.0);\r
vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);\r
vec2 pos=r.xy;\r
vec2 f=r.zw;\r
float tl=texture(u_dem_prev,pos).r;\r
float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;\r
float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;\r
float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;\r
return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\r
#endif
}\r
#ifdef TERRAIN_VERTEX_MORPHING\r
float elevation(vec2 apos) {\r
#ifdef ZERO_EXAGGERATION\r
return 0.0;\r
#endif
float nextElevation=currentElevation(apos);\r
float prevElevation=prevElevation(apos);\r
return mix(prevElevation,nextElevation,u_dem_lerp);\r
}\r
#else
float elevation(vec2 apos) {\r
#ifdef ZERO_EXAGGERATION\r
return 0.0;\r
#endif
return currentElevation(apos);\r
}\r
#endif
vec4 fourSample(vec2 pos,vec2 off) {\r
float tl=texture(u_dem,pos).r;\r
float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;\r
float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;\r
float br=texture(u_dem,pos+off).r;\r
return vec4(tl,tr,bl,br);\r
}\r
float flatElevation(vec2 pack) {\r
vec2 apos=floor(pack/8.0);\r
vec2 span=10.0*(pack-apos*8.0);\r
vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;\r
float size=u_dem_size+2.0;\r
float dd=1.0/size;\r
vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;\r
vec2 f=fract(pos);\r
pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));\r
float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);\r
vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));\r
vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));\r
vec4 diff=abs(h.xzxy-h.ywzw);\r
vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));\r
vec2 fix=slope*span;\r
float base=z+max(fix.x,fix.y);\r
return u_exaggeration*base;\r
}\r
float elevationFromUint16(float word) {\r
return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);\r
}
#else
float elevation(vec2 pos) { return 0.0; }\r
#endif\r
#ifdef DEPTH_OCCLUSION\r
uniform highp sampler2D u_depth;\r
uniform highp vec2 u_depth_size_inv;\r
uniform highp vec2 u_depth_range_unpack;\r
uniform highp float u_occluder_half_size;\r
uniform highp float u_occlusion_depth_offset;\r
#ifdef DEPTH_D24\r
float unpack_depth(float depth) {\r
return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;\r
}\r
vec4 unpack_depth4(vec4 depth) {\r
return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);\r
}\r
#else
highp float unpack_depth_rgba(vec4 rgba_depth)\r
{\r
const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r
return dot(rgba_depth,bit_shift)*2.0-1.0;\r
}\r
#endif
bool isOccluded(vec4 frag) {\r
vec3 coord=frag.xyz/frag.w;\r
#ifdef DEPTH_D24\r
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\r
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\r
#endif
return coord.z+u_occlusion_depth_offset > depth;\r
}\r
highp vec4 getCornerDepths(vec2 coord) {\r
highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);\r
highp vec2 uv=0.5*coord.xy+0.5;\r
#ifdef DEPTH_D24\r
highp vec4 depth=vec4(\r
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\r
);\r
depth=unpack_depth4(depth);\r
#else
highp vec4 depth=vec4(\r
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\r
);\r
#endif
return depth;\r
}highp float occlusionFadeMultiSample(vec4 frag) {\r
highp vec3 coord=frag.xyz/frag.w;\r
highp vec2 uv=0.5*coord.xy+0.5;\r
int NX=3;\r
int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;\r
highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);\r
highp float res=0.0;\r
for (int y=0; y < NY;++y) {\r
for (int x=0; x < NX;++x) {\r
#ifdef DEPTH_D24\r
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\r
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\r
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);\r
}\r
}\r
res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);\r
return res;\r
}highp float occlusionFade(vec4 frag) {\r
highp vec3 coord=frag.xyz/frag.w;\r
highp vec4 depth=getCornerDepths(coord.xy);\r
return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));\r
}\r
#else
bool isOccluded(vec4 frag) { return false; }\r
highp float occlusionFade(vec4 frag) { return 1.0; }\r
highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\r
#endif//DEPTH_OCCLUSION`,va=`#ifdef FOG\r
uniform mediump vec4 u_fog_color;\r
uniform mediump vec2 u_fog_range;\r
uniform mediump float u_fog_horizon_blend;\r
uniform mediump mat4 u_fog_matrix;\r
out vec3 v_fog_pos;\r
float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);\r
}float fog_horizon_blending(vec3 camera_dir) {\r
float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);\r
}float fog_opacity(float t) {\r
const float decay=6.0;\r
float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);\r
}\r
vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;\r
}\r
vec3 fog_position(vec2 pos) {\r
return fog_position(vec3(pos,0.0));\r
}\r
float fog(vec3 pos) {\r
float depth=length(pos);\r
float opacity=fog_opacity(fog_range(depth));\r
return opacity*fog_horizon_blending(pos/depth);\r
}\r
#endif`,fh=`#ifdef FOG\r
uniform mediump vec4 u_fog_color;\r
uniform mediump vec2 u_fog_range;\r
uniform mediump float u_fog_horizon_blend;\r
uniform mediump vec2 u_fog_vertical_limit;\r
uniform mediump float u_fog_temporal_offset;\r
in vec3 v_fog_pos;\r
uniform highp vec3 u_frustum_tl;\r
uniform highp vec3 u_frustum_tr;\r
uniform highp vec3 u_frustum_br;\r
uniform highp vec3 u_frustum_bl;\r
uniform highp vec3 u_globe_pos;\r
uniform highp float u_globe_radius;\r
uniform highp vec2 u_viewport;\r
uniform float u_globe_transition;\r
uniform int u_is_globe;\r
float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);\r
}float fog_horizon_blending(vec3 camera_dir) {\r
float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);\r
}float fog_opacity(float t) {\r
const float decay=6.0;\r
float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);\r
}\r
float globe_glow_progress() {\r
highp vec2 uv=gl_FragCoord.xy/u_viewport;\r
highp vec3 ray_dir=mix(\r
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);\r
highp vec3 dir=normalize(ray_dir);\r
highp vec3 closest_point=dot(u_globe_pos,dir)*dir;\r
highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;\r
return sdf+PI*0.5;\r
}float fog_opacity(vec3 pos) {\r
float depth=length(pos);\r
return fog_opacity(fog_range(depth));\r
}\r
vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {\r
float depth=length(pos);\r
float opacity;\r
if (u_is_globe==1) {\r
float glow_progress=globe_glow_progress();\r
float t=mix(glow_progress,depth,u_globe_transition);\r
opacity=fog_opacity(fog_range(t));\r
} else {\r
opacity=fog_opacity(fog_range(depth));\r
opacity*=fog_horizon_blending(pos/depth);\r
}\r
return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));\r
}\r
vec3 fog_apply(vec3 color,vec3 pos) {\r
return fog_apply(color,pos,1.0);\r
}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {\r
float alpha=EPSILON+color.a;\r
color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;\r
return color;\r
}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {\r
float horizon_blend=fog_horizon_blending(normalize(camera_ray));\r
return mix(sky_color,u_fog_color.rgb,horizon_blend);\r
}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {\r
float alpha=EPSILON+color.a;\r
color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;\r
return color;\r
}\r
vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {\r
float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));\r
return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));\r
}\r
vec3 fog_dither(vec3 color) {\r
return color;\r
}\r
vec4 fog_dither(vec4 color) {\r
return vec4(fog_dither(color.rgb),color.a);\r
}\r
#endif`,_f=`#ifdef RASTER_ARRAY\r
uniform highp sampler2D u_image0;\r
uniform sampler2D u_image1;\r
const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {\r
texCoord=texCoord*texResolution-0.5;\r
fxy=fract(texCoord);\r
texCoord-=fxy;\r
return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);\r
}\r
vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);\r
vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);\r
vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);\r
vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);\r
return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);\r
}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec2 fxy;\r
ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);\r
return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\r
);\r
}\r
vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec2 fxy;\r
ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);\r
return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\r
);\r
}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);\r
return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);\r
}\r
vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);\r
return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);\r
}\r
#endif`,Qa=`#ifdef RASTER_ARRAY\r
uniform sampler2D u_velocity;\r
uniform mediump vec2 u_velocity_res;\r
uniform mediump float u_max_speed;\r
const vec4 NO_DATA=vec4(1);\r
const vec2 INVALID_VELOCITY=vec2(-1);\r
uniform highp vec2 u_uv_offset;\r
uniform highp float u_data_offset;\r
uniform highp vec2 u_data_scale;\r
ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {\r
texCoord=texCoord*texResolution-0.5;\r
fxy=fract(texCoord);\r
texCoord-=fxy;\r
return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);\r
}\r
highp vec2 lookup_velocity(highp vec2 uv) {\r
uv=u_uv_offset.x+u_uv_offset.y*uv;\r
highp vec2 fxy;\r
ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);\r
highp vec4 tl=texelFetch(u_velocity,c.yz,0);\r
highp vec4 tr=texelFetch(u_velocity,c.xz,0);\r
highp vec4 bl=texelFetch(u_velocity,c.yw,0);\r
highp vec4 br=texelFetch(u_velocity,c.xw,0);\r
if (tl==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
if (tr==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
if (bl==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
if (br==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\r
highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));\r
velocity.y=-velocity.y;\r
velocity/=max(u_max_speed,length(velocity));\r
return velocity;\r
}\r
#endif\r
uniform highp float u_particle_pos_scale;\r
uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {\r
highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;\r
highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));\r
return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);\r
}\r
highp vec2 unpack_pos_from_rgba(highp vec4 v) {\r
v=floor(v*255.0+0.5)/255.0;\r
highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));\r
return u_particle_pos_scale*p-u_particle_pos_offset;\r
}`,Rl=`#ifdef RENDER_SHADOWS\r
uniform mediump vec3 u_shadow_direction;\r
uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {\r
float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);\r
float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;\r
return n*dotScale;\r
}\r
vec3 shadow_normal_offset_model(vec3 normal) {\r
vec3 transformed_normal=vec3(-normal.xy,normal.z);\r
float NDotL=dot(normalize(transformed_normal),u_shadow_direction);\r
float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;\r
return normal*dotScale;\r
}\r
float shadow_normal_offset_multiplier0() {\r
return u_shadow_normal_offset[1];\r
}\r
float shadow_normal_offset_multiplier1() {\r
return u_shadow_normal_offset[2];\r
}\r
#endif//RENDER_SHADOWS`,Wc=`#ifdef RENDER_SHADOWS\r
#ifdef DEPTH_TEXTURE\r
uniform highp sampler2D u_shadowmap_0;\r
uniform highp sampler2D u_shadowmap_1;\r
#else\r
uniform sampler2D u_shadowmap_0;\r
uniform sampler2D u_shadowmap_1;\r
#endif\r
uniform float u_shadow_intensity;\r
uniform float u_shadow_map_resolution;\r
uniform float u_shadow_texel_size;\r
uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;\r
uniform mediump vec3 u_shadow_direction;\r
uniform highp vec3 u_shadow_bias;\r
highp float shadow_sample_1(highp vec2 uv,highp float compare) {\r
highp float shadow_depth;\r
#ifdef DEPTH_TEXTURE\r
shadow_depth=texture(u_shadowmap_1,uv).r;\r
#else\r
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\r
#endif\r
return step(shadow_depth,compare);\r
}\r
highp float shadow_sample_0(highp vec2 uv,highp float compare) {\r
highp float shadow_depth;\r
#ifdef DEPTH_TEXTURE\r
shadow_depth=texture(u_shadowmap_0,uv).r;\r
#else\r
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\r
#endif\r
return step(shadow_depth,compare);\r
}\r
float shadow_occlusion_1(highp vec4 pos,highp float bias) {\r
highp vec2 uv=pos.xy;\r
return shadow_sample_1(uv,pos.z-bias);\r
}\r
float shadow_occlusion_0(highp vec4 pos,highp float bias) {\r
highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER\r
highp vec2 uv=pos.xy;\r
highp vec4 samples=textureGather(u_shadowmap_0,uv,0);\r
lowp vec4 stepSamples=step(samples,vec4(compare0));\r
#else\r
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);\r
highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);\r
highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);\r
highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);\r
lowp vec4 stepSamples=vec4(\r
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\r
);\r
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));\r
lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);\r
return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);\r
}\r
float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\r
#ifdef SHADOWS_SINGLE_CASCADE\r
light_view_pos0.xyz/=light_view_pos0.w;\r
vec2 abs_bounds=abs(light_view_pos0.xy);\r
if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {\r
return 0.0;\r
}\r
light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;\r
return shadow_occlusion_0(light_view_pos0,bias);\r
#else
light_view_pos0.xyz/=light_view_pos0.w;\r
light_view_pos1.xyz/=light_view_pos1.w;\r
vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);\r
vec4 abs_bounds=abs(uv);\r
if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {\r
light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;\r
return shadow_occlusion_0(light_view_pos0,bias);\r
}\r
if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {\r
return 0.0;\r
}\r
light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;\r
float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\r
#endif
}\r
highp float calculate_shadow_bias(float NDotL) {\r
#ifdef NORMAL_OFFSET\r
return 0.5*u_shadow_bias.x;\r
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\r
#endif\r
}\r
float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float NDotL=dot(N,u_shadow_direction);\r
float bias=calculate_shadow_bias(NDotL);\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r
}\r
float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {\r
float NDotL=dot(N,u_shadow_direction);\r
float bias=calculate_shadow_bias(NDotL);\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;\r
return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r
}\r
float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float NDotL=dot(N,u_shadow_direction);\r
float bias=0.0;\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r
}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\r
{\r
highp vec2 biasUV=vec2(\r
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);\r
biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));\r
return biasUV;\r
}\r
float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;\r
highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);\r
highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);\r
highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);\r
highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return 1.0-(u_shadow_intensity*occlusion);\r
}\r
float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float bias=0.0;\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return 1.0-(u_shadow_intensity*occlusion);\r
}\r
float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float bias=calculate_shadow_bias(ndotl);\r
return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
}\r
#endif`;const el=[];Xo(l_,el),Xo(hh,el),Xo(mf,el);const Zo={"_prelude_fog.vertex.glsl":va,"_prelude_terrain.vertex.glsl":dh,"_prelude_shadow.vertex.glsl":Rl,"_prelude_fog.fragment.glsl":fh,"_prelude_shadow.fragment.glsl":Wc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;\r
uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;\r
uniform mediump vec3 u_ground_radiance;\r
float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;\r
float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));\r
float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;\r
float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);\r
return vertical_factor*ambient_directional_factor;\r
}vec3 linearProduct(vec3 srgbIn,vec3 k) {\r
return srgbIn*pow(k,vec3(1./2.2));\r
}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);\r
vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;\r
vec3 directional_contrib=u_lighting_directional_color*dir_factor;\r
return linearProduct(color,ambient_contrib+directional_contrib);\r
}\r
vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {\r
return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);\r
}vec3 apply_lighting(vec3 color,vec3 normal) {\r
float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);\r
return apply_lighting(color.rgb,normal,dir_factor);\r
}\r
vec4 apply_lighting(vec4 color,vec3 normal) {\r
float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);\r
return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);\r
}\r
vec3 apply_lighting_ground(vec3 color) {\r
return color*u_ground_radiance;\r
}\r
vec4 apply_lighting_ground(vec4 color) {\r
return vec4(apply_lighting_ground(color.rgb),color.a);\r
}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);\r
}\r
vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {\r
return mix(apply_lighting_ground(color),color,emissive_strength);\r
}\r
vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);\r
float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);\r
return mix(fully_occluded_color,flood_light_color,occlusion_ramp);\r
}\r
vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {\r
vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);\r
return mix(fully_occluded_color,unlit_color,1.0-occlusion);\r
}\r
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":_f,"_prelude_raster_particle.glsl":Qa},tl={};kr("",dh),kr(fh,va),kr(Wc,Rl),kr(_f,""),kr(Qa,"");const ph=kr(mf,hh),gf=l_;var mh={background:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform vec4 u_color;\r
uniform float u_opacity;\r
#ifdef LIGHTING_3D_MODE\r
in vec4 v_color;\r
#endif\r
void main() {\r
vec4 out_color;\r
#ifdef LIGHTING_3D_MODE\r
out_color=v_color;\r
#else\r
out_color=u_color;\r
#endif\r
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*u_opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_lighting.glsl"\r
in vec2 a_pos;\r
uniform mat4 u_matrix;\r
#ifdef LIGHTING_3D_MODE\r
uniform mediump vec4 u_color;\r
out vec4 v_color;\r
uniform float u_emissive_strength;\r
#endif\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
#ifdef LIGHTING_3D_MODE\r
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),backgroundPattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform vec2 u_pattern_tl;\r
uniform vec2 u_pattern_br;\r
uniform vec2 u_texsize;\r
uniform float u_opacity;\r
uniform float u_emissive_strength;\r
uniform sampler2D u_image;\r
in highp vec2 v_pos;\r
void main() {\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);\r
vec4 out_color=textureLodCustom(u_image,pos,v_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*u_opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_pattern_size;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform vec2 u_pattern_units_to_pixels;\r
in vec2 a_pos;\r
out highp vec2 v_pos;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),circle:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
in vec3 v_data;\r
in float v_visibility;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define mediump float radius\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp vec4 stroke_color\r
#pragma mapbox: define mediump float stroke_width\r
#pragma mapbox: define lowp float stroke_opacity\r
uniform float u_emissive_strength;\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize mediump float radius\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp vec4 stroke_color\r
#pragma mapbox: initialize mediump float stroke_width\r
#pragma mapbox: initialize lowp float stroke_opacity\r
vec2 extrude=v_data.xy;\r
float blur_positive=blur < 0.0 ? 0.0 : 1.0;\r
lowp float antialiasblur=v_data.z;\r
float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);\r
float antialiased_blur=-max(abs(blur),antialiasblur);\r
float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);\r
float opacity_t=blur_positive==1.0 ? \r
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \r
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;\r
float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\r
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\r
);\r
vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
out_color=fog_apply_premultiplied(out_color,v_fog_pos);\r
#endif\r
glFragColor=out_color*(v_visibility*opacity_t);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
#define NUM_VISIBILITY_RINGS 2\r
#define INV_SQRT2 0.70710678\r
#define ELEVATION_BIAS 0.0001\r
#define NUM_SAMPLES_PER_RING 16\r
uniform mat4 u_matrix;\r
uniform mat2 u_extrude_scale;\r
uniform lowp float u_device_pixel_ratio;\r
uniform highp float u_camera_to_center_distance;\r
in vec2 a_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
#endif\r
#ifdef ELEVATED_ROADS\r
in float a_circle_z_offset;\r
#endif\r
out vec3 v_data;\r
out float v_visibility;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define mediump float radius\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp vec4 stroke_color\r
#pragma mapbox: define mediump float stroke_width\r
#pragma mapbox: define lowp float stroke_opacity\r
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {\r
return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;\r
}\r
float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {\r
vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);\r
vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);\r
vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);\r
vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);\r
float h1=elevation(c1)+ELEVATION_BIAS;\r
float h2=elevation(c2)+ELEVATION_BIAS;\r
float h3=elevation(c3)+ELEVATION_BIAS;\r
float h4=elevation(c4)+ELEVATION_BIAS;\r
return max(h4,max(h3,max(h1,h2)));\r
}\r
float circle_elevation(vec2 pos) {\r
#if defined(TERRAIN)\r
return elevation(pos)+ELEVATION_BIAS;\r
#else\r
return 0.0;\r
#endif\r
}\r
vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {\r
vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\r
#ifdef PITCH_WITH_MAP\r
#ifdef PROJECTION_GLOBE_VIEW\r
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\r
#else\r
return u_matrix*( world_center+vec4(sample_offset,0,0) );\r
#endif\r
#else\r
return projected_center+vec4(sample_offset,0,0);\r
#endif\r
}\r
float get_sample_step() {\r
#ifdef PITCH_WITH_MAP\r
return 2.0*PI/float(NUM_SAMPLES_PER_RING);\r
#else
return PI/float(NUM_SAMPLES_PER_RING);\r
#endif\r
}\r
void main(void) {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize mediump float radius\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp vec4 stroke_color\r
#pragma mapbox: initialize mediump float stroke_width\r
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\r
vec4 world_center;\r
mat3 surface_vectors;\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;\r
surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);\r
vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];\r
vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);\r
vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;\r
vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;\r
vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
world_center=vec4(pos,1);\r
#else \r
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);\r
world_center=vec4(circle_center,height,1);\r
#endif\r
#ifdef ELEVATED_ROADS\r
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;\r
#endif\r
vec4 projected_center=u_matrix*world_center;\r
float view_scale=0.0;\r
#ifdef PITCH_WITH_MAP\r
#ifdef SCALE_WITH_MAP\r
view_scale=1.0;\r
#else
view_scale=projected_center.w/u_camera_to_center_distance;\r
#endif\r
#else\r
#ifdef SCALE_WITH_MAP\r
view_scale=u_camera_to_center_distance;\r
#else\r
view_scale=projected_center.w;\r
#endif\r
#endif\r
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);\r
float visibility=0.0;\r
#ifdef TERRAIN\r
float step=get_sample_step();\r
vec4 occlusion_world_center;\r
vec4 occlusion_projected_center;\r
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);\r
occlusion_world_center=vec4(circle_center,cantilevered_height,1);\r
occlusion_projected_center=u_matrix*occlusion_world_center;\r
#else\r
occlusion_world_center=world_center;\r
occlusion_projected_center=projected_center;\r
#endif\r
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {\r
float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);\r
for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {\r
vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;\r
vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);\r
visibility+=float(!isOccluded(frag_pos));\r
}\r
}\r
visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\r
#else\r
visibility=1.0;\r
#endif
#ifdef PROJECTION_GLOBE_VIEW\r
visibility=1.0;\r
#endif\r
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);\r
v_data=vec3(extrude.x,extrude.y,antialiasblur);\r
#ifdef FOG\r
v_fog_pos=fog_position(world_center.xyz);\r
#endif\r
}`),clippingMask:kr(`void main() {\r
glFragColor=vec4(1.0);\r
}`,`in vec2 a_pos;\r
uniform mat4 u_matrix;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
}`),heatmap:kr(`#include "_prelude_fog.fragment.glsl"\r
uniform highp float u_intensity;\r
in vec2 v_extrude;\r
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327\r
void main() {\r
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);\r
float val=weight*u_intensity*GAUSS_COEF*exp(d);\r
glFragColor=vec4(val,1.0,1.0,1.0);\r
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\r
}\r
#endif\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform float u_extrude_scale;\r
uniform float u_opacity;\r
uniform float u_intensity;\r
in vec2 a_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
#endif\r
out vec2 v_extrude;\r
#pragma mapbox: define highp float weight\r
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327\r
void main(void) {\r
#pragma mapbox: initialize highp float weight\r
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\r
vec3 pos;\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;\r
mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);\r
vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];\r
vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);\r
vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;\r
vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;\r
pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
#else\r
pos=vec3(tilePos+extrude,elevation(tilePos));\r
#endif\r
gl_Position=u_matrix*vec4(pos,1);\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
}`),heatmapTexture:kr(`uniform sampler2D u_image;\r
uniform sampler2D u_color_ramp;\r
uniform float u_opacity;\r
in vec2 v_pos;\r
void main() {\r
float t=texture(u_image,v_pos).r;\r
vec4 color=texture(u_color_ramp,vec2(t,0.5));\r
glFragColor=color*u_opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(0.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`in vec2 a_pos;\r
out vec2 v_pos;\r
void main() {\r
gl_Position=vec4(a_pos,0,1);\r
v_pos=a_pos*0.5+0.5;\r
}`),collisionBox:kr(`in float v_placed;\r
in float v_notUsed;\r
void main() {\r
vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;\r
glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in vec3 a_pos;\r
in vec2 a_anchor_pos;\r
in vec2 a_extrude;\r
in vec2 a_placed;\r
in vec2 a_shift;\r
in vec2 a_elevation_from_sea;\r
in float a_size_scale;\r
in vec2 a_padding;\r
in float a_auto_z_offset;\r
uniform mat4 u_matrix;\r
uniform vec2 u_extrude_scale;\r
uniform float u_camera_to_center_distance;\r
out float v_placed;\r
out float v_notUsed;\r
void main() {\r
float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;\r
float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));\r
vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);\r
highp float camera_to_anchor_distance=projectedPoint.w;\r
highp float collision_perspective_ratio=clamp(\r
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);\r
gl_Position=projectedPoint;\r
gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;\r
v_placed=a_placed.x;\r
v_notUsed=a_placed.y;\r
}`),collisionCircle:kr(`in float v_radius;\r
in vec2 v_extrude;\r
in float v_perspective_ratio;\r
in float v_collision;\r
void main() {\r
float alpha=0.5*min(v_perspective_ratio,1.0);\r
float stroke_radius=0.9*max(v_perspective_ratio,1.0);\r
float distance_to_center=length(v_extrude);\r
float distance_to_edge=abs(distance_to_center-v_radius);\r
float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);\r
vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);\r
glFragColor=color*alpha*opacity_t;\r
}`,`in vec2 a_pos_2f;\r
in float a_radius;\r
in vec2 a_flags;\r
uniform mat4 u_matrix;\r
uniform mat4 u_inv_matrix;\r
uniform vec2 u_viewport_size;\r
uniform float u_camera_to_center_distance;\r
out float v_radius;\r
out vec2 v_extrude;\r
out float v_perspective_ratio;\r
out float v_collision;\r
vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);\r
vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);\r
rayStart.xyz/=rayStart.w;\r
rayEnd.xyz  /=rayEnd.w;\r
highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);\r
return mix(rayStart.xyz,rayEnd.xyz,t);\r
}\r
void main() {\r
vec2 quadCenterPos=a_pos_2f;\r
float radius=a_radius;\r
float collision=a_flags.x;\r
float vertexIdx=a_flags.y;\r
vec2 quadVertexOffset=vec2(\r
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));\r
vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);\r
vec4 clipPos=u_matrix*vec4(tilePos,1.0);\r
highp float camera_to_anchor_distance=clipPos.w;\r
highp float collision_perspective_ratio=clamp(\r
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;\r
v_radius=radius;\r
v_extrude=quadVertexExtent*padding_factor;\r
v_perspective_ratio=collision_perspective_ratio;\r
v_collision=collision;\r
gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);\r
}`),debug:kr(`uniform highp vec4 u_color;\r
uniform sampler2D u_overlay;\r
in vec2 v_uv;\r
void main() {\r
vec4 overlay_color=texture(u_overlay,v_uv);\r
glFragColor=mix(u_color,overlay_color,overlay_color.a);\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in vec2 a_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;\r
#endif\r
out vec2 v_uv;\r
uniform mat4 u_matrix;\r
uniform float u_overlay_scale;\r
void main() {float h=elevation(a_pos);\r
v_uv=a_pos/8192.0;\r
#ifdef PROJECTION_GLOBE_VIEW\r
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\r
#else\r
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\r
#endif\r
}`),elevatedStructuresDepth:kr(`void main() {\r
#ifndef DEPTH_TEXTURE\r
glFragColor=vec4(0.);\r
#endif\r
}`,`in vec2 a_pos;\r
in float a_height;\r
uniform mat4 u_matrix;\r
uniform float u_depth_bias;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,a_height,1);\r
gl_Position.z=gl_Position.z+u_depth_bias;\r
}`),elevatedStructuresDepthReconstruct:kr(`#ifdef DEPTH_RECONSTRUCTION\r
in float v_height;\r
#endif\r
void main() {\r
#ifdef DEPTH_RECONSTRUCTION\r
if (v_height >=0.0)\r
discard;\r
#endif\r
glFragColor=vec4(1.0,0.0,0.0,1.0);\r
}`,`in vec2 a_pos;\r
in float a_height;\r
uniform mat4 u_matrix;\r
uniform vec3 u_camera_pos;\r
uniform highp float u_depth_bias;\r
uniform lowp float u_height_scale;\r
uniform lowp float u_reset_depth;\r
#ifdef DEPTH_RECONSTRUCTION\r
out float v_height;\r
#endif\r
void main() {\r
vec3 vpos=vec3(a_pos,a_height*u_height_scale);\r
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {\r
vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));\r
}\r
v_height=a_height;\r
#endif\r
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;\r
}`),elevatedStructures:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
in vec3 v_normal;\r
in float v_height;\r
#ifdef RENDER_SHADOWS\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in float v_depth;\r
#endif\r
void main() {\r
vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);\r
#ifdef LIGHTING_3D_MODE\r
vec3 normal=normalize(v_normal);\r
#ifdef RENDER_SHADOWS\r
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\r
#else
color=apply_lighting(color,normal);\r
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);\r
float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);\r
color=color*(1.0-pow(occlusion,2.0)*0.3);\r
}\r
#endif
#ifdef FOG\r
color=fog_apply(color,v_fog_pos);\r
#endif\r
vec4 out_color=vec4(color,1.0);\r
#ifdef INDICATOR_CUTOUT\r
out_color=applyCutout(out_color,v_height);\r
#endif\r
glFragColor=out_color;\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec2 a_pos;\r
in float a_height;\r
in vec3 a_pos_normal_3;\r
uniform mat4 u_matrix;\r
out vec3 v_normal;\r
out float v_height;\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out float v_depth;\r
#endif\r
void main() {\r
v_normal=a_pos_normal_3/16384.0;\r
v_height=a_height;\r
vec3 pos=vec3(a_pos,a_height);\r
gl_Position=u_matrix*vec4(pos,1);\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=pos;\r
vec3 shd_pos1=pos;\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(v_normal);\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fill:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float opacity\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float opacity\r
vec4 out_color=color;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
out_color*=opacity;\r
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {\r
out_color=applyCutout(out_color,v_z_offset);\r
}\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif\r
uniform mat4 u_matrix;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp float z_offset\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=z_offset;\r
#endif\r
}`),fillOutline:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
in highp vec2 v_pos;\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
#pragma mapbox: define highp vec4 outline_color\r
#pragma mapbox: define lowp float opacity\r
void main() {\r
#pragma mapbox: initialize highp vec4 outline_color\r
#pragma mapbox: initialize lowp float opacity\r
float dist=length(v_pos-gl_FragCoord.xy);\r
float alpha=1.0-smoothstep(0.0,1.0,dist);\r
vec4 out_color=outline_color;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*(alpha*opacity);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
uniform mat4 u_matrix;\r
uniform vec2 u_world;\r
out highp vec2 v_pos;\r
#pragma mapbox: define highp vec4 outline_color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize highp vec4 outline_color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp float z_offset\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fillOutlinePattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform vec2 u_texsize;\r
uniform sampler2D u_image;\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
in highp vec2 v_pos;\r
in highp vec2 v_pos_world;\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r
highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);\r
float alpha=1.0-smoothstep(0.0,1.0,dist);\r
vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*(alpha*opacity);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_world;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform float u_tile_units_to_pixels;\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
out highp vec2 v_pos;\r
out highp vec2 v_pos_world;\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
#pragma mapbox: define lowp float pixel_ratio\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize lowp float pixel_ratio\r
#pragma mapbox: initialize highp float z_offset\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\r
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fillPattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform vec2 u_texsize;\r
uniform sampler2D u_image;\r
in highp vec2 v_pos;\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r
highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);\r
vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform float u_tile_units_to_pixels;\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
out highp vec2 v_pos;\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
#pragma mapbox: define lowp float pixel_ratio\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize lowp float pixel_ratio\r
#pragma mapbox: initialize highp float z_offset\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fillExtrusion:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
in vec4 v_color;\r
in vec4 v_flat;\r
#ifdef RENDER_SHADOWS\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
#endif\r
uniform lowp float u_opacity;\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
in vec2 v_ao;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r
in vec4 v_roof_color;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
in highp vec3 v_normal;\r
#endif\r
uniform vec3 u_flood_light_color;\r
uniform highp float u_vertical_scale;\r
uniform float u_flood_light_intensity;\r
uniform vec3 u_ground_shadow_factor;\r
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\r
in float v_flood_radius;\r
in float v_has_floodlight;\r
#endif\r
in float v_height;\r
#pragma mapbox: define highp float emissive_strength\r
void main() {\r
#pragma mapbox: initialize highp float emissive_strength\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
vec3 normal=normalize(v_normal);\r
#endif\r
float z;\r
vec4 color=v_color;\r
#ifdef ZERO_ROOF_RADIUS\r
z=float(normal.z > 0.00001);\r
#ifdef LIGHTING_3D_MODE\r
normal=mix(normal,vec3(0.0,0.0,1.0),z);\r
#else
color=mix(v_color,v_roof_color,z);\r
#endif
#endif
float h=max(0.0,v_height);\r
float ao_shade=1.0;\r
#ifdef FAUX_AO\r
float intensity=u_ao[0];\r
float h_floors=h/(u_ao[1]*u_vertical_scale);\r
float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);\r
ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\r
#ifdef ZERO_ROOF_RADIUS\r
concave*=(1.0-z);\r
#endif\r
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);\r
ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\r
#ifdef LIGHTING_3D_MODE\r
#ifdef FLOOD_LIGHT\r
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;\r
#endif
#else
color.rgb*=ao_shade;\r
#endif
#endif
#ifdef LIGHTING_3D_MODE\r
float flood_radiance=0.0;\r
#ifdef FLOOD_LIGHT\r
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\r
#endif
#ifdef RENDER_SHADOWS\r
#ifdef FLOOD_LIGHT\r
float ndotl_unclamped=dot(normal,u_shadow_direction);\r
float ndotl=max(0.0,ndotl_unclamped);\r
float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);\r
vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);\r
color.rgb=mix(litColor,floodLitColor,flood_radiance);\r
#else
float shadowed_lighting_factor;\r
#ifdef RENDER_CUTOFF\r
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);\r
if (v_cutoff_opacity==0.0) {\r
discard;\r
}\r
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\r
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\r
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);\r
#ifdef FLOOD_LIGHT\r
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\r
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);\r
color*=u_opacity;\r
#endif
#ifdef FOG\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
color=applyCutout(color,h);\r
#endif\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform mat4 u_matrix;\r
uniform vec3 u_lightcolor;\r
uniform lowp vec3 u_lightpos;\r
uniform lowp float u_lightintensity;\r
uniform float u_vertical_gradient;\r
uniform lowp float u_opacity;\r
uniform float u_edge_radius;\r
uniform float u_width_scale;\r
in vec4 a_pos_normal_ed;\r
in vec2 a_centroid_pos;\r
#ifdef RENDER_WALL_MODE\r
in vec3 a_join_normal_inside;\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
uniform float u_height_lift;\r
#endif\r
#ifdef TERRAIN\r
uniform int u_height_type;\r
uniform int u_base_type;\r
#endif\r
uniform highp float u_vertical_scale;\r
out vec4 v_color;\r
out vec4 v_flat;\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r
out vec4 v_roof_color;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
out highp vec3 v_normal;\r
#endif\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
out vec2 v_ao;\r
#endif\r
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\r
out float v_flood_radius;\r
out float v_has_floodlight;\r
#endif\r
out float v_height;vec3 linearTosRGB(vec3 color) {\r
return pow(color,vec3(1./2.2));\r
}\r
vec3 sRGBToLinear(vec3 srgbIn) {\r
return pow(srgbIn,vec3(2.2));\r
}\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define highp float flood_light_wall_radius\r
#pragma mapbox: define highp float line_width\r
#pragma mapbox: define highp float emissive_strength\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize highp float flood_light_wall_radius\r
#pragma mapbox: initialize highp float line_width\r
#pragma mapbox: initialize highp float emissive_strength\r
base*=u_vertical_scale;\r
height*=u_vertical_scale;\r
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;\r
vec3 top_up_ny=top_up_ny_start.xyz;\r
float x_normal=pos_nx.z/8192.0;\r
vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
v_normal=normal;\r
#endif\r
base=max(0.0,base);\r
float attr_height=height;\r
height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);\r
float t=top_up_ny.x;\r
vec2 centroid_pos=vec2(0.0);\r
#if defined(HAS_CENTROID) || defined(TERRAIN)\r
centroid_pos=a_centroid_pos;\r
#endif\r
float ele=0.0;\r
float h=0.0;\r
float c_ele=0.0;\r
vec3 pos;\r
#ifdef TERRAIN\r
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;\r
bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;\r
ele=elevation(pos_nx.xy);\r
c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;\r
float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;\r
float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);\r
h=t > 0.0 ? max(h_base,h_height) : h_base;\r
pos=vec3(pos_nx.xy,h);\r
#else\r
h=t > 0.0 ? height : base;\r
pos=vec3(pos_nx.xy,h);\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;\r
h+=lift;\r
vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));\r
vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;\r
pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
#endif\r
float cutoff=1.0;\r
vec3 scaled_pos=pos;\r
#ifdef RENDER_CUTOFF\r
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);\r
vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);\r
vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);\r
cutoff=cutoff_opacity(u_cutoff_params,ground.z);\r
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {\r
vec3 g=floor(ground_pos);\r
vec3 mod_=centroid_random-g*8.0;\r
float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));\r
if (cutoff < 0.8-seed) {\r
cutoff=0.0;\r
}\r
}\r
float cutoff_scale=cutoff;\r
v_cutoff_opacity=cutoff;\r
scaled_pos.z=mix(c_ele,h,cutoff_scale);\r
#endif\r
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\r
#ifdef RENDER_WALL_MODE\r
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);\r
scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;\r
scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\r
#endif\r
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);\r
h=h-ele;\r
v_height=h;\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=pos;\r
vec3 shd_pos1=pos;\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(normal);\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
#endif\r
float NdotL=0.0;\r
float colorvalue=0.0;\r
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);\r
color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {\r
float r=0.84;\r
r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\r
(1.0-u_vertical_gradient)+
(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));\r
}\r
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;\r
float start=top_up_ny_start.w;\r
float y_ground=1.0-clamp(t+base,0.0,1.0);\r
float top_height=height;\r
#ifdef TERRAIN\r
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;\r
y_ground+=y_ground*5.0/max(3.0,top_height);\r
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);\r
NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW\r
top_height+=u_height_lift;\r
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\r
#endif
#ifdef LIGHTING_3D_MODE\r
#ifdef FLOOD_LIGHT\r
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);\r
v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);\r
v_flood_radius=flood_light_wall_radius*u_vertical_scale;\r
#endif
v_color=vec4(color.rgb,1.0);\r
float ndotl=calculate_NdotL(normal);\r
v_flat.rgb=sRGBToLinear(color.rgb);\r
v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);\r
v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\r
#else
v_color=vec4(0.0,0.0,0.0,1.0);\r
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r
v_color*=u_opacity;\r
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);\r
roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);\r
v_roof_color=vec4(0.0,0.0,0.0,1.0);\r
v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r
v_roof_color*=u_opacity;\r
#endif
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
}`),fillExtrusionDepth:kr(`in highp float v_depth;\r
void main() {\r
#ifndef DEPTH_TEXTURE\r
glFragColor=pack_depth(v_depth);\r
#endif\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform float u_edge_radius;\r
uniform float u_width_scale;\r
uniform float u_vertical_scale;\r
#ifdef TERRAIN\r
uniform int u_height_type;\r
uniform int u_base_type;\r
#endif\r
in vec4 a_pos_normal_ed;\r
in vec2 a_centroid_pos;\r
#ifdef RENDER_WALL_MODE\r
in vec3 a_join_normal_inside;\r
#endif\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define highp float line_width\r
#pragma mapbox: define highp vec4 color\r
out highp float v_depth;\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize highp float line_width\r
#pragma mapbox: initialize highp vec4 color\r
base*=u_vertical_scale;\r
height*=u_vertical_scale;\r
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;\r
base=max(0.0,base);\r
height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);\r
float t=top_up_ny.x;\r
vec2 centroid_pos=vec2(0.0);\r
#if defined(HAS_CENTROID) || defined(TERRAIN)\r
centroid_pos=a_centroid_pos;\r
#endif\r
vec3 pos;\r
#ifdef TERRAIN\r
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;\r
bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;\r
float ele=elevation(pos_nx.xy);\r
float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;\r
float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;\r
float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);\r
float h=t > 0.0 ? max(h_base,h_height) : h_base;\r
pos=vec3(pos_nx.xy,h);\r
#else\r
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\r
#endif\r
#ifdef RENDER_WALL_MODE\r
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);\r
pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;\r
pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\r
#endif\r
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));\r
gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\r
v_depth=gl_Position.z/gl_Position.w;\r
}`),fillExtrusionPattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform vec2 u_texsize;\r
uniform sampler2D u_image;\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
in vec3 v_ao;\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
in vec3 v_normal;\r
#endif\r
in highp vec2 v_pos;\r
in vec4 v_lighting;\r
uniform lowp float u_opacity;\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define highp float pixel_ratio\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize highp float pixel_ratio\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r
highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);\r
vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\r
#else\r
out_color=out_color*v_lighting;\r
#endif\r
#ifdef FAUX_AO\r
float intensity=u_ao[0];\r
float h=max(0.0,v_ao.z);\r
float h_floors=h/u_ao[1];\r
float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);\r
float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\r
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);\r
shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\r
out_color.rgb=out_color.rgb*shade;\r
#endif\r
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform float u_height_factor;\r
uniform float u_tile_units_to_pixels;\r
uniform float u_vertical_gradient;\r
uniform lowp float u_opacity;\r
uniform float u_width_scale;\r
uniform vec3 u_lightcolor;\r
uniform lowp vec3 u_lightpos;\r
uniform lowp float u_lightintensity;\r
in vec4 a_pos_normal_ed;\r
in vec2 a_centroid_pos;\r
#ifdef RENDER_WALL_MODE\r
in vec3 a_join_normal_inside;\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
uniform float u_height_lift;\r
#endif\r
#ifdef TERRAIN\r
uniform int u_height_type;\r
uniform int u_base_type;\r
#endif\r
out highp vec2 v_pos;\r
out vec4 v_lighting;\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
out vec3 v_ao;\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
out vec3 v_normal;\r
#endif\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define highp float pixel_ratio\r
#pragma mapbox: define highp float line_width\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize highp float pixel_ratio\r
#pragma mapbox: initialize highp float line_width\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;\r
mediump vec3 top_up_ny=top_up_ny_start.xyz;\r
float x_normal=pos_nx.z/8192.0;\r
vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\r
float edgedistance=a_pos_normal_ed.w;\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
base=max(0.0,base);\r
height=max(0.0,height);\r
float t=top_up_ny.x;\r
float z=t > 0.0 ? height : base;\r
vec2 centroid_pos=vec2(0.0);\r
#if defined(HAS_CENTROID) || defined(TERRAIN)\r
centroid_pos=a_centroid_pos;\r
#endif\r
float ele=0.0;\r
float h=z;\r
vec3 p;\r
float c_ele;\r
#ifdef TERRAIN\r
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;\r
bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;\r
ele=elevation(pos_nx.xy);\r
c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;\r
float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;\r
float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);\r
h=t > 0.0 ? max(h_base,h_height) : h_base;\r
p=vec3(pos_nx.xy,h);\r
#else\r
p=vec3(pos_nx.xy,z);\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;\r
h+=lift;\r
vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));\r
vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;\r
p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
#endif\r
#ifdef RENDER_WALL_MODE\r
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);\r
p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;\r
p.xy-=a_join_normal_inside.z*wall_offset*0.5;\r
#endif\r
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));\r
gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);\r
vec2 pos=normal.z==1.0\r
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);\r
v_lighting=vec4(0.0,0.0,0.0,1.0);\r
float NdotL=0.0;\r
#ifdef LIGHTING_3D_MODE\r
NdotL=calculate_NdotL(normal);\r
#else\r
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);\r
NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\r
#endif\r
if (normal.y !=0.0) {\r
float r=0.84;\r
#ifndef LIGHTING_3D_MODE\r
r=mix(0.7,0.98,1.0-u_lightintensity);\r
#endif
NdotL*=(\r
(1.0-u_vertical_gradient)+
(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));\r
}\r
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;\r
float start=top_up_ny_start.w;\r
float y_ground=1.0-clamp(t+base,0.0,1.0);\r
float top_height=height;\r
#ifdef TERRAIN\r
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;\r
y_ground+=y_ground*5.0/max(3.0,top_height);\r
#endif\r
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);\r
NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW\r
top_height+=u_height_lift;\r
#endif\r
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
v_normal=normal;\r
#else\r
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r
v_lighting*=u_opacity;\r
#endif \r
#ifdef FOG\r
v_fog_pos=fog_position(p);\r
#endif\r
}`),groundShadow:kr(`#include "_prelude_shadow.fragment.glsl"\r
precision highp float;\r
uniform vec3 u_ground_shadow_factor;\r
in vec4 v_pos_light_view_0;\r
in vec4 v_pos_light_view_1;\r
#ifdef FOG\r
in float v_fog_opacity;\r
#endif\r
void main() {\r
float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\r
vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#ifdef RENDER_CUTOFF\r
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\r
#endif\r
#ifdef FOG\r
shadow=mix(shadow,vec3(1.0),v_fog_opacity);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\r
#endif\r
glFragColor=vec4(shadow,1.0);\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
in vec2 a_pos;\r
out vec4 v_pos_light_view_0;\r
out vec4 v_pos_light_view_1;\r
#ifdef FOG\r
out float v_fog_opacity;\r
#endif\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0.0,1.0);\r
v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);\r
v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
v_fog_opacity=fog(v_fog_pos);\r
#endif\r
}`),fillExtrusionGroundEffect:kr(`uniform highp float u_ao_pass;\r
uniform highp float u_opacity;\r
uniform highp float u_flood_light_intensity;\r
uniform highp vec3 u_flood_light_color;\r
uniform highp float u_attenuation;\r
uniform sampler2D u_fb;\r
uniform float u_fb_size;\r
#ifdef SDF_SUBPASS\r
in highp vec2 v_pos;\r
in highp vec4 v_line_segment;\r
in highp float v_flood_light_radius_tile;\r
in highp vec2 v_ao;\r
float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {\r
highp vec2 ba=b-a;\r
highp vec2 pa=p-a;\r
highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);\r
return length(pa-r*ba);\r
}\r
#ifdef FOG\r
in highp float v_fog;\r
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS\r
vec4 color=vec4(1.0);\r
#ifdef CLEAR_FROM_TEXTURE\r
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\r
#endif
glFragColor=color;\r
#else
#ifdef SDF_SUBPASS\r
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);\r
highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);\r
d/=effect_radius;\r
d=min(d,1.0);\r
d=1.0-pow(1.0-d,u_attenuation);\r
highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);\r
highp float fog=1.0;\r
#ifdef FOG\r
fog=v_fog;\r
#endif
#ifdef RENDER_CUTOFF\r
fog*=v_cutoff_opacity;\r
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\r
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\r
#ifdef OVERDRAW_INSPECTOR\r
color=vec4(1.0);\r
#endif\r
glFragColor=color;\r
#endif
HANDLE_WIREFRAME_DEBUG;\r
#endif
}`,`#include "_prelude_fog.vertex.glsl"\r
in highp vec4 a_pos_end;\r
in highp float a_angular_offset_factor;\r
in highp float a_hidden_by_landmark;\r
#ifdef SDF_SUBPASS\r
out highp vec2 v_pos;\r
out highp vec4 v_line_segment;\r
out highp float v_flood_light_radius_tile;\r
out highp vec2 v_ao;\r
#ifdef FOG\r
out highp float v_fog;\r
#endif\r
#endif\r
uniform highp float u_flood_light_intensity;\r
uniform highp mat4 u_matrix;\r
uniform highp float u_ao_pass;\r
uniform highp float u_meter_to_tile;\r
uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;\r
uniform highp vec2 u_ao;\r
#pragma mapbox: define highp float flood_light_ground_radius\r
const float TANGENT_CUTOFF=4.0;\r
const float NORM=32767.0;\r
void main() {\r
#pragma mapbox: initialize highp float flood_light_ground_radius\r
vec2 p=a_pos_end.xy;\r
vec2 q=floor(a_pos_end.zw*0.5);\r
vec2 start_bottom=a_pos_end.zw-q*2.0;\r
float fl_ground_radius=flood_light_ground_radius;\r
fl_ground_radius=abs(flood_light_ground_radius);\r
float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;\r
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;\r
vec2 v=normalize(q-p);\r
float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;\r
float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;\r
float angular_offset=direction*angular_offset_factor*effect_radius;\r
float top=1.0-start_bottom.y;\r
float side=(0.5-start_bottom.x)*2.0;\r
vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);\r
vec2 perp=vec2(v.y,-v.x);\r
vec2 extrusion_perp=direction*perp*effect_radius*top;\r
vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);\r
pos.xy+=extrusion_parallel+extrusion_perp;\r
#ifdef SDF_SUBPASS\r
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;\r
v_flood_light_radius_tile=flood_radius_tile;\r
v_ao=vec2(u_ao.x,ao_radius);\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
v_fog=1.0-fog(v_fog_pos);\r
#endif\r
#endif\r
float hidden_by_landmark=0.0;\r
#ifdef HAS_CENTROID\r
hidden_by_landmark=a_hidden_by_landmark;\r
#endif\r
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);\r
float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);\r
hidden+=hidden_by_landmark;\r
gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\r
#ifdef RENDER_CUTOFF\r
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\r
#endif\r
}`),hillshadePrepare:kr(`precision highp float;\r
uniform sampler2D u_image;\r
in vec2 v_pos;\r
uniform vec2 u_dimension;\r
uniform float u_zoom;\r
float getElevation(vec2 coord) {\r
return texture(u_image,coord).r/4.0;\r
}\r
void main() {\r
vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));\r
float b=getElevation(v_pos+vec2(0,-epsilon.y));\r
float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));\r
float d=getElevation(v_pos+vec2(-epsilon.x,0));\r
float e=getElevation(v_pos+vec2(epsilon.x,0));\r
float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));\r
float g=getElevation(v_pos+vec2(0,epsilon.y));\r
float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\r
float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;\r
vec2 deriv=vec2(\r
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\r
)/pow(2.0,exaggeration+(19.2562-u_zoom));\r
glFragColor=clamp(vec4(\r
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\r
}`,`uniform mat4 u_matrix;\r
uniform vec2 u_dimension;\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
out vec2 v_pos;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
highp vec2 epsilon=1.0/u_dimension;\r
float scale=(u_dimension.x-2.0)/u_dimension.x;\r
v_pos=(a_texture_pos/8192.0)*scale+epsilon;\r
}`),hillshade:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform sampler2D u_image;\r
in vec2 v_pos;\r
uniform vec2 u_latrange;\r
uniform vec2 u_light;\r
uniform vec4 u_shadow;\r
uniform vec4 u_highlight;\r
uniform vec4 u_accent;\r
uniform float u_emissive_strength;\r
void main() {\r
vec4 pixel=texture(u_image,v_pos);\r
vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);\r
float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);\r
float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;\r
float maxValue=0.5*PI;\r
float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);\r
float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);\r
vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);\r
glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\r
#ifdef LIGHTING_3D_MODE\r
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\r
#endif\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
out vec2 v_pos;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
v_pos=a_texture_pos/8192.0;\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),line:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform lowp float u_device_pixel_ratio;\r
uniform highp float u_width_scale;\r
uniform highp float u_floor_width_scale;\r
uniform float u_alpha_discard_threshold;\r
uniform highp vec2 u_trim_offset;\r
uniform highp vec2 u_trim_fade_range;\r
uniform lowp vec4 u_trim_color;\r
in vec2 v_width2;\r
in vec2 v_normal;\r
in float v_gamma_scale;\r
in highp vec3 v_uv;\r
#ifdef ELEVATED_ROADS\r
in highp float v_road_z_offset;\r
#endif\r
#ifdef RENDER_LINE_DASH\r
uniform sampler2D u_dash_image;\r
in vec2 v_tex;\r
#endif\r
#ifdef RENDER_LINE_GRADIENT\r
uniform sampler2D u_gradient_image;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;\r
}\r
uniform float u_emissive_strength;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float floorwidth\r
#pragma mapbox: define lowp vec4 dash\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp float border_width\r
#pragma mapbox: define lowp vec4 border_color\r
float linearstep(float edge0,float edge1,float x) {\r
return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);\r
}\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float floorwidth\r
#pragma mapbox: initialize lowp vec4 dash\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize lowp float border_width\r
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r
float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r
#ifdef RENDER_LINE_DASH\r
float sdfdist=texture(u_dash_image,v_tex).r;\r
float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;\r
float scaled_floorwidth=(floorwidth*u_floor_width_scale);\r
alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\r
#endif\r
highp vec4 out_color;\r
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);\r
#else\r
out_color=color;\r
#endif\r
float trim_alpha=1.0;\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
highp float trim_start=u_trim_offset[0];\r
highp float trim_end=u_trim_offset[1];\r
highp float line_progress=v_uv[2];if (trim_end > trim_start) {\r
highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));\r
highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));\r
highp float transition_factor=min(start_transition,end_transition);\r
out_color=mix(out_color,u_trim_color,transition_factor);\r
trim_alpha=1.0-transition_factor;\r
}\r
#endif\r
if (u_alpha_discard_threshold !=0.0) {\r
if (alpha < u_alpha_discard_threshold) {\r
discard;\r
}\r
}\r
#ifdef RENDER_LINE_BORDER\r
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);\r
float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);\r
if (alpha2 < 1.) {\r
float smoothAlpha=smoothstep(0.6,1.0,alpha2);\r
if (border_color.a==0.0) {\r
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;\r
if (out_color.a > 0.25 && Y < 0.25) {\r
vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;\r
out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));\r
} else {\r
out_color.rgb*=(0.6 +0.4*smoothAlpha);\r
}\r
} else {\r
out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);\r
}\r
}\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
#ifdef ELEVATED_ROADS\r
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\r
#else\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
out_color*=(alpha*opacity);\r
#ifdef INDICATOR_CUTOUT\r
out_color=applyCutout(out_color,v_z_offset);\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016\r
in vec2 a_pos_normal;\r
in vec4 a_data;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\r
in vec3 a_z_offset_width;\r
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\r
in highp vec3 a_packed;\r
#endif\r
#ifdef RENDER_LINE_DASH\r
in float a_linesofar;\r
#endif\r
uniform mat4 u_matrix;\r
uniform mat2 u_pixels_to_tile_units;\r
uniform vec2 u_units_to_pixels;\r
uniform lowp float u_device_pixel_ratio;\r
uniform float u_width_scale;\r
uniform highp float u_floor_width_scale;\r
#ifdef ELEVATED\r
uniform lowp float u_zbias_factor;\r
uniform lowp float u_tile_to_meter;\r
float sample_elevation(vec2 apos) {\r
#ifdef ELEVATION_REFERENCE_SEA\r
return 0.0;\r
#else\r
return elevation(apos);\r
#endif\r
}\r
#endif\r
out vec2 v_normal;\r
out vec2 v_width2;\r
out float v_gamma_scale;\r
out highp vec3 v_uv;\r
#ifdef ELEVATED_ROADS\r
out highp float v_road_z_offset;\r
#endif\r
#ifdef RENDER_LINE_DASH\r
uniform vec2 u_texsize;\r
uniform float u_tile_units_to_pixels;\r
out vec2 v_tex;\r
#endif\r
#ifdef RENDER_LINE_GRADIENT\r
uniform float u_image_height;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float floorwidth\r
#pragma mapbox: define lowp vec4 dash\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define mediump float gapwidth\r
#pragma mapbox: define lowp float offset\r
#pragma mapbox: define mediump float width\r
#pragma mapbox: define lowp float border_width\r
#pragma mapbox: define lowp vec4 border_color\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float floorwidth\r
#pragma mapbox: initialize lowp vec4 dash\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump float gapwidth\r
#pragma mapbox: initialize lowp float offset\r
#pragma mapbox: initialize mediump float width\r
#pragma mapbox: initialize lowp float border_width\r
#pragma mapbox: initialize lowp vec4 border_color\r
float a_z_offset;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS)\r
a_z_offset=a_z_offset_width.x;\r
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r
vec2 a_extrude=a_data.xy-128.0;\r
float a_direction=mod(a_data.z,4.0)-1.0;\r
vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r
normal.y=normal.y*2.0-1.0;\r
v_normal=normal;gapwidth=gapwidth/2.0;\r
float halfwidth;\r
#ifdef VARIABLE_LINE_WIDTH\r
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);\r
halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\r
#else\r
halfwidth=(u_width_scale*width)/2.0;\r
#endif\r
offset=-1.0*offset*u_width_scale;\r
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r
float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;\r
mediump float t=1.0-abs(u);\r
mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);\r
float hidden=float(opacity==0.0);\r
vec2 extrude=dist*u_pixels_to_tile_units;\r
vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);\r
vec2 projected_extrude_xy=projected_extrude.xy;\r
#ifdef ELEVATED_ROADS\r
v_road_z_offset=a_z_offset;\r
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\r
#else\r
#ifdef ELEVATED\r
vec2 offsetTile=offset2*u_pixels_to_tile_units;\r
vec2 offset_pos=pos+offsetTile;\r
float ele=0.0;\r
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);\r
float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;\r
ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\r
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,max(ele1,ele2));\r
ele=ele_max+a_z_offset;\r
#else
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,0.5*(ele1+ele2));\r
ele=ele_max-ele0+ele1+a_z_offset;\r
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;\r
float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);\r
float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);\r
gl_Position.z-=(gl_Position.w*zbias);\r
gl_Position=mix(gl_Position,AWAY,hidden);\r
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\r
#endif
#endif
#ifdef ELEVATED_ROADS\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);\r
vec3 shd_pos0=shd_pos;\r
vec3 shd_pos1=shd_pos;\r
#ifdef NORMAL_OFFSET\r
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#endif\r
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);\r
float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);\r
v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\r
#else\r
v_gamma_scale=1.0;\r
#endif\r
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\r
highp float a_uv_x=a_packed[0];\r
float a_split_index=a_packed[1];\r
highp float line_progress=a_packed[2];\r
#ifdef RENDER_LINE_GRADIENT\r
highp float texel_height=1.0/u_image_height;\r
highp float half_texel_height=0.5*texel_height;\r
v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\r
#else\r
v_uv=vec3(a_uv_x,0.0,line_progress);\r
#endif\r
#endif\r
#ifdef RENDER_LINE_DASH\r
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;\r
float height=dash.y;\r
v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\r
#endif\r
v_width2=vec2(outset,inset);\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=a_z_offset;\r
#endif\r
}`),linePattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform highp float u_device_pixel_ratio;\r
uniform highp float u_width_scale;\r
uniform highp float u_alpha_discard_threshold;\r
uniform highp vec2 u_texsize;\r
uniform highp float u_tile_units_to_pixels;\r
uniform highp vec2 u_trim_offset;\r
uniform highp vec2 u_trim_fade_range;\r
uniform lowp vec4 u_trim_color;\r
uniform sampler2D u_image;\r
in vec2 v_normal;\r
in vec2 v_width2;\r
in highp float v_linesofar;\r
in float v_gamma_scale;\r
in float v_width;\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
in highp vec3 v_uv;\r
#endif\r
#ifdef ELEVATED_ROADS\r
in highp float v_road_z_offset;\r
#endif\r
#ifdef LINE_JOIN_NONE\r
in vec2 v_pattern_data;
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
uniform float u_emissive_strength;\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define mediump float pixel_ratio\r
#pragma mapbox: define mediump float blur\r
#pragma mapbox: define mediump float opacity\r
void main() {\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize mediump float pixel_ratio\r
#pragma mapbox: initialize mediump float blur\r
#pragma mapbox: initialize mediump float opacity\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
highp float pattern_size=display_size.x/u_tile_units_to_pixels;\r
float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r
float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r
highp float pattern_x=v_linesofar/pattern_size*aspect;\r
highp float x=mod(pattern_x,1.0);\r
highp float y=0.5*v_normal.y+0.5;\r
vec2 texel_size=1.0/u_texsize;\r
highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));\r
highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));\r
vec4 color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
highp float trim_start=u_trim_offset[0];\r
highp float trim_end=u_trim_offset[1];\r
highp float line_progress=v_uv[2];if (trim_end > trim_start) {\r
highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));\r
highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));\r
highp float transition_factor=min(start_transition,end_transition);\r
color=mix(color,color.a*u_trim_color,transition_factor);\r
}\r
#endif\r
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;\r
highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;\r
highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;\r
visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;\r
if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {\r
color=vec4(0.0);\r
}\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
color=apply_lighting_with_emission_ground(color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
#ifdef ELEVATED_ROADS\r
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\r
#else\r
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#endif\r
#ifdef FOG\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r
#endif\r
color*=(alpha*opacity);\r
if (u_alpha_discard_threshold !=0.0) {\r
if (color.a < u_alpha_discard_threshold) {\r
discard;\r
}\r
}\r
#ifdef INDICATOR_CUTOUT\r
color=applyCutout(color,v_z_offset);\r
#endif\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016\r
in vec2 a_pos_normal;\r
in vec4 a_data;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS)\r
in vec3 a_z_offset_width;\r
#endif
#ifdef RENDER_LINE_TRIM_OFFSET\r
in highp vec3 a_packed;\r
#endif\r
in highp float a_linesofar;\r
#ifdef LINE_JOIN_NONE\r
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif\r
uniform mat4 u_matrix;\r
uniform float u_tile_units_to_pixels;\r
uniform vec2 u_units_to_pixels;\r
uniform mat2 u_pixels_to_tile_units;\r
uniform float u_device_pixel_ratio;\r
uniform float u_width_scale;\r
uniform float u_floor_width_scale;\r
#ifdef ELEVATED\r
uniform lowp float u_zbias_factor;\r
uniform lowp float u_tile_to_meter;\r
float sample_elevation(vec2 apos) {\r
#ifdef ELEVATION_REFERENCE_SEA\r
return 0.0;\r
#else\r
return elevation(apos);\r
#endif\r
}\r
#endif\r
out vec2 v_normal;\r
out vec2 v_width2;\r
out highp float v_linesofar;\r
out float v_gamma_scale;\r
out float v_width;\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
out highp vec3 v_uv;\r
#endif\r
#ifdef ELEVATED_ROADS\r
out highp float v_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
#pragma mapbox: define mediump float blur\r
#pragma mapbox: define mediump float opacity\r
#pragma mapbox: define mediump float offset\r
#pragma mapbox: define mediump float gapwidth\r
#pragma mapbox: define mediump float width\r
#pragma mapbox: define mediump float floorwidth\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define mediump float pixel_ratio\r
void main() {\r
#pragma mapbox: initialize mediump float blur\r
#pragma mapbox: initialize mediump float opacity\r
#pragma mapbox: initialize mediump float offset\r
#pragma mapbox: initialize mediump float gapwidth\r
#pragma mapbox: initialize mediump float width\r
#pragma mapbox: initialize mediump float floorwidth\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize mediump float pixel_ratio\r
float a_z_offset;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS)\r
a_z_offset=a_z_offset_width.x;\r
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r
vec2 a_extrude=a_data.xy-128.0;\r
float a_direction=mod(a_data.z,4.0)-1.0;\r
vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;\r
normal.y=normal.y*2.0-1.0;\r
v_normal=normal;gapwidth=gapwidth/2.0;\r
float halfwidth=(u_width_scale*width)/2.0;\r
offset=-1.0*offset*u_width_scale;\r
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r
float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;\r
float t=1.0-abs(u);\r
vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r
float hidden=float(opacity==0.0);\r
vec2 extrude=dist*u_pixels_to_tile_units;\r
vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);\r
vec2 projected_extrude_xy=projected_extrude.xy;\r
#ifdef ELEVATED_ROADS\r
v_road_z_offset=a_z_offset;\r
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\r
#else\r
#ifdef ELEVATED\r
vec2 offsetTile=offset2*u_pixels_to_tile_units;\r
vec2 offset_pos=pos+offsetTile;\r
float ele=0.0;\r
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);\r
float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;\r
ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\r
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,max(ele1,ele2));\r
ele=ele_max+a_z_offset;\r
#else
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,0.5*(ele1+ele2));\r
ele=ele_max-ele0+ele1+a_z_offset;\r
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;\r
float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);\r
float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);\r
gl_Position.z-=(gl_Position.w*zbias);\r
gl_Position=mix(gl_Position,AWAY,hidden);\r
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\r
#endif
#endif
#ifdef ELEVATED_ROADS\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);\r
vec3 shd_pos0=shd_pos;\r
vec3 shd_pos1=shd_pos;\r
#ifdef NORMAL_OFFSET\r
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#endif\r
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);\r
float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);\r
v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\r
#else\r
v_gamma_scale=1.0;\r
#endif\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
highp float a_uv_x=a_packed[0];\r
highp float line_progress=a_packed[2];\r
v_uv=vec3(a_uv_x,0.0,line_progress);\r
#endif\r
v_linesofar=a_linesofar;\r
v_width2=vec2(outset,inset);\r
v_width=(floorwidth*u_floor_width_scale);\r
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;\r
mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;\r
mediump float pixel_ratio_inverse=1.0/pixel_ratio;\r
mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;\r
highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;\r
float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;\r
v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;\r
v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=a_z_offset;\r
#endif\r
}`),raster:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_raster_array.glsl"\r
uniform float u_fade_t;\r
uniform float u_opacity;\r
uniform highp float u_raster_elevation;\r
uniform highp float u_zoom_transition;\r
in vec2 v_pos0;\r
in vec2 v_pos1;\r
in float v_depth;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in float v_split_fade;\r
#endif\r
uniform float u_brightness_low;\r
uniform float u_brightness_high;\r
uniform float u_saturation_factor;\r
uniform float u_contrast_factor;\r
uniform vec3 u_spin_weights;\r
uniform float u_emissive_strength;\r
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;\r
uniform sampler2D u_image1;\r
#endif\r
#ifdef RASTER_COLOR\r
uniform sampler2D u_color_ramp;\r
uniform highp vec4 u_colorization_mix;\r
uniform highp float u_colorization_offset;\r
uniform vec2 u_texture_res;\r
#endif\r
void main() {\r
vec4 color0,color1,color;\r
vec2 value;\r
#ifdef RASTER_COLOR\r
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR\r
value=mix(\r
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\r
);\r
#else\r
value=mix(\r
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\r
);\r
#endif
if (value.y > 0.0) value.x/=value.y;\r
#else\r
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);\r
value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\r
#endif\r
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;\r
color.a*=value.y;\r
#else
color0=texture(u_image0,v_pos0);\r
color1=texture(u_image1,v_pos1);\r
if (color0.a > 0.0) color0.rgb/=color0.a;\r
if (color1.a > 0.0) color1.rgb/=color1.a;\r
color=mix(color0,color1,u_fade_t);\r
#endif\r
color.a*=u_opacity;\r
#ifdef GLOBE_POLES\r
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\r
#endif\r
vec3 rgb=color.rgb;rgb=vec3(\r
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;\r
rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);\r
vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);\r
vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\r
#endif\r
#ifdef FOG\r
highp float fog_limit_high_meters=1000000.0;\r
highp float fog_limit_low_meters=600000.0;\r
float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);\r
out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\r
#endif\r
glFragColor=vec4(out_color*color.a,color.a);\r
#ifdef PROJECTION_GLOBE_VIEW\r
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\r
#endif\r
#ifdef RENDER_CUTOFF\r
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\r
#endif\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform mat4 u_normalize_matrix;\r
uniform mat4 u_globe_matrix;\r
uniform mat4 u_merc_matrix;\r
uniform mat3 u_grid_matrix;\r
uniform vec2 u_tl_parent;\r
uniform float u_scale_parent;\r
uniform vec2 u_perspective_transform;\r
uniform vec2 u_texture_offset;\r
uniform float u_raster_elevation;\r
uniform float u_zoom_transition;\r
uniform vec2 u_merc_center;\r
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\r
#ifdef GLOBE_POLES\r
in vec3 a_globe_pos;\r
in vec2 a_uv;\r
#else\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
#endif\r
out vec2 v_pos0;\r
out vec2 v_pos1;\r
out float v_depth;\r
#ifdef PROJECTION_GLOBE_VIEW\r
out float v_split_fade;\r
#endif\r
void main() {\r
vec2 uv;\r
#ifdef GLOBE_POLES\r
vec3 globe_pos=a_globe_pos;\r
globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;\r
gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);\r
uv=a_uv;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\r
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\r
#ifdef PROJECTION_GLOBE_VIEW\r
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);\r
vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);\r
vec3 globe_pos=latLngToECEF(latLng.xy);\r
globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;\r
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
vec4 merc_world_pos=vec4(0.0);\r
float mercatorY=mercatorYfromLat(latLng[0]);\r
float mercatorX=mercatorXfromLng(latLng[1]);    \r
v_split_fade=0.0;\r
if (u_zoom_transition > 0.0) {\r
vec2 merc_pos=vec2(mercatorX,mercatorY);\r
merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);\r
merc_world_pos.xy-=u_merc_center;\r
merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);\r
merc_world_pos=u_merc_matrix*merc_world_pos;\r
float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);\r
float dist_from_poles=(abs(mercatorY-0.5)*2.0);\r
float range=0.1;\r
v_split_fade=abs(opposite_merc_center-mercatorX);\r
v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);\r
v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));\r
}\r
float tiles=u_grid_matrix[0][2];\r
if (tiles > 0.0) {\r
float idx=u_grid_matrix[1][2];\r
float idy=u_grid_matrix[2][2];\r
float uvY=mercatorY*tiles-idy;\r
float uvX=mercatorX*tiles-idx;\r
uv=vec2(uvX,uvY);\r
}\r
vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);\r
gl_Position=u_matrix*interpolated_pos;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\r
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif
#endif
#endif
v_pos0=uv;\r
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;\r
v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\r
#ifdef RENDER_CUTOFF\r
v_depth=gl_Position.z;\r
#endif\r
}`),rasterParticle:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform float u_fade_t;\r
uniform float u_opacity;\r
uniform highp float u_raster_elevation;\r
in vec2 v_pos0;\r
in vec2 v_pos1;\r
uniform sampler2D u_image0;\r
uniform sampler2D u_image1;\r
void main() {\r
vec4 color0,color1,color;color0=texture(u_image0,v_pos0);\r
color1=texture(u_image1,v_pos1);\r
if (color0.a > 0.0) color0.rgb/=color0.a;\r
if (color1.a > 0.0) color1.rgb/=color1.a;\r
color=mix(color0,color1,u_fade_t);\r
color.a*=u_opacity;\r
vec3 out_color=color.rgb;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\r
#endif\r
#ifdef FOG\r
highp float fog_limit_high_meters=1000000.0;\r
highp float fog_limit_low_meters=600000.0;\r
float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);\r
out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\r
#endif\r
glFragColor=vec4(out_color*color.a,color.a);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform mat4 u_normalize_matrix;\r
uniform mat4 u_globe_matrix;\r
uniform mat4 u_merc_matrix;\r
uniform mat3 u_grid_matrix;\r
uniform vec2 u_tl_parent;\r
uniform float u_scale_parent;\r
uniform float u_raster_elevation;\r
uniform float u_zoom_transition;\r
uniform vec2 u_merc_center;\r
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
out vec2 v_pos0;\r
out vec2 v_pos1;\r
void main() {\r
float w=1.0;\r
vec2 uv;\r
#ifdef PROJECTION_GLOBE_VIEW\r
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);\r
vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);\r
float mercatorY=mercatorYfromLat(latLng[0]);\r
float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];\r
float idx=u_grid_matrix[1][2];\r
float idy=u_grid_matrix[2][2];\r
float uvX=mercatorX*tiles-idx;\r
float uvY=mercatorY*tiles-idy;\r
uv=vec2(uvX,uvY);\r
vec3 globe_pos=latLngToECEF(latLng.xy);\r
globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;\r
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
vec4 merc_world_pos=vec4(0.0);\r
if (u_zoom_transition > 0.0) {\r
vec2 merc_pos=vec2(mercatorX,mercatorY);\r
merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);\r
merc_world_pos.xy-=u_merc_center;\r
merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);\r
merc_world_pos=u_merc_matrix*merc_world_pos;\r
}\r
vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);\r
gl_Position=u_matrix*interpolated_pos;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\r
#endif
#else
uv=a_texture_pos/8192.0;\r
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif
#endif
v_pos0=uv;\r
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\r
}`),rasterParticleDraw:kr(`uniform sampler2D u_color_ramp;\r
in float v_particle_speed;\r
void main() {\r
glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));\r
}`,`#include "_prelude_raster_particle.glsl"\r
in float a_index;\r
uniform sampler2D u_particle_texture;\r
uniform float u_particle_texture_side_len;\r
uniform vec2 u_tile_offset;\r
out float v_particle_speed;\r
void main() {\r
ivec2 pixel_coord=ivec2(\r
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);\r
vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);\r
vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;\r
vec2 tex_coord=fract(pos);\r
vec2 velocity=lookup_velocity(tex_coord);\r
if (velocity==INVALID_VELOCITY) {\r
gl_Position=AWAY;\r
v_particle_speed=0.0;\r
} else {\r
gl_Position=vec4(2.0*pos-1.0,0,1);\r
v_particle_speed=length(velocity);\r
}\r
gl_PointSize=1.0;\r
}`),rasterParticleTexture:kr(`uniform sampler2D u_texture;\r
uniform float u_opacity;\r
in vec2 v_tex_pos;\r
void main() {\r
vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);\r
}`,`in vec2 a_pos;\r
out vec2 v_tex_pos;\r
void main() {\r
vec2 uv=0.5*a_pos+vec2(0.5);\r
v_tex_pos=uv;\r
gl_Position=vec4(a_pos,0.0,1.0);\r
}`),rasterParticleUpdate:kr(`#include "_prelude_raster_particle.glsl"\r
uniform sampler2D u_particle_texture;\r
uniform mediump float u_particle_texture_side_len;\r
uniform mediump float u_speed_factor;\r
uniform highp float u_reset_rate;\r
uniform highp float u_rand_seed;\r
in highp vec2 v_tex_coord;\r
vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {\r
return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));\r
}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);\r
highp float rand(const highp vec2 co) {\r
highp float t=dot(rand_constants.xy,co);\r
return fract(sin(t)*(rand_constants.z+t));\r
}\r
void main() {\r
ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);\r
highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);\r
highp vec2 pos=unpack_pos_from_rgba(pixel);\r
highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));\r
highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\r
pos=pos+dp;\r
highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;\r
highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\r
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*
linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\r
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;\r
highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));\r
highp vec2 next_pos=mix(pos,random_pos,drop);\r
glFragColor=pack_pos_to_rgba(next_pos);\r
}`,`in vec2 a_pos;\r
out vec2 v_tex_coord;\r
void main() {\r
v_tex_coord=0.5*(a_pos+vec2(1.0));\r
gl_Position=vec4(a_pos,0.0,1.0);\r
}`),symbol:kr(`#include "_prelude_lighting.glsl"\r
#define SDF_PX 8.0\r
#define SDF 1.0\r
#define ICON 0.0\r
uniform sampler2D u_texture;\r
uniform sampler2D u_texture_icon;\r
uniform highp float u_gamma_scale;\r
uniform lowp float u_device_pixel_ratio;\r
uniform bool u_is_text;\r
uniform bool u_is_halo;\r
uniform lowp float u_scale_factor;\r
#ifdef ICON_TRANSITION\r
uniform float u_icon_transition;\r
#endif\r
#ifdef COLOR_ADJUSTMENT\r
uniform mat4 u_color_adj_mat;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
in vec2 v_tex_a;\r
#ifdef ICON_TRANSITION\r
in vec2 v_tex_b;\r
#endif\r
in float v_draw_halo;\r
in vec3 v_gamma_scale_size_fade_opacity;\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
in float is_sdf;\r
in vec2 v_tex_a_icon;\r
#endif\r
#pragma mapbox: define highp vec4 fill_color\r
#pragma mapbox: define highp vec4 halo_color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp float halo_width\r
#pragma mapbox: define lowp float halo_blur\r
#pragma mapbox: define lowp float emissive_strength\r
void main() {\r
#pragma mapbox: initialize highp vec4 fill_color\r
#pragma mapbox: initialize highp vec4 halo_color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize lowp float halo_width\r
#pragma mapbox: initialize lowp float halo_blur\r
#pragma mapbox: initialize lowp float emissive_strength\r
vec4 out_color;\r
float fade_opacity=v_gamma_scale_size_fade_opacity[2];\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
if (is_sdf==ICON) {\r
vec2 tex_icon=v_tex_a_icon;\r
lowp float alpha=opacity*fade_opacity;\r
glFragColor=texture(u_texture_icon,tex_icon)*alpha;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
return;\r
}\r
#endif\r
#ifdef RENDER_SDF\r
float EDGE_GAMMA=0.105/u_device_pixel_ratio;\r
float gamma_scale=v_gamma_scale_size_fade_opacity.x;\r
float size=v_gamma_scale_size_fade_opacity.y;\r
float fontScale=u_is_text ? size/24.0 : size;\r
out_color=fill_color;\r
highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);\r
lowp float buff=(256.0-64.0)/256.0;\r
bool draw_halo=v_draw_halo > 0.0;\r
if (draw_halo) {\r
out_color=halo_color;\r
gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);\r
buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;\r
}\r
lowp float dist=texture(u_texture,v_tex_a).r;\r
highp float gamma_scaled=gamma*gamma_scale;\r
highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);\r
out_color*=alpha;\r
#else
#ifdef ICON_TRANSITION\r
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);\r
vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;\r
out_color=(a+b);\r
#else\r
out_color=texture(u_texture,v_tex_a);\r
#endif\r
#ifdef COLOR_ADJUSTMENT\r
out_color=u_color_adj_mat*out_color;\r
#endif\r
#endif\r
out_color*=opacity*fade_opacity;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out_color=applyCutout(out_color,v_z_offset);\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in vec4 a_pos_offset;\r
in vec4 a_tex_size;\r
in vec4 a_pixeloffset;\r
in vec4 a_projected_pos;\r
in float a_fade_opacity;\r
#ifdef Z_OFFSET\r
in float a_auto_z_offset;\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_globe_anchor;\r
in vec3 a_globe_normal;\r
#endif\r
#ifdef ICON_TRANSITION\r
in vec2 a_texb;\r
#endif\r
#ifdef OCCLUSION_QUERIES\r
in float a_occlusion_query_opacity;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif
uniform bool u_is_size_zoom_constant;\r
uniform bool u_is_size_feature_constant;\r
uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;\r
uniform mat4 u_label_plane_matrix;\r
uniform mat4 u_coord_matrix;\r
uniform bool u_is_text;\r
uniform bool u_elevation_from_sea;\r
uniform bool u_pitch_with_map;\r
uniform bool u_rotate_symbol;\r
uniform highp float u_aspect_ratio;\r
uniform highp float u_camera_to_center_distance;\r
uniform float u_fade_change;\r
uniform vec2 u_texsize;\r
uniform vec3 u_up_vector;\r
uniform vec2 u_texsize_icon;\r
uniform bool u_is_halo;\r
#ifdef PROJECTION_GLOBE_VIEW\r
uniform vec3 u_tile_id;\r
uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_camera_forward;\r
uniform float u_zoom_transition;\r
uniform vec3 u_ecef_origin;\r
uniform mat4 u_tile_matrix;\r
#endif\r
out vec2 v_tex_a;\r
#ifdef ICON_TRANSITION\r
out vec2 v_tex_b;\r
#endif\r
out float v_draw_halo;\r
out vec3 v_gamma_scale_size_fade_opacity;\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
out float is_sdf;\r
out vec2 v_tex_a_icon;\r
#endif\r
#pragma mapbox: define highp vec4 fill_color\r
#pragma mapbox: define highp vec4 halo_color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp float halo_width\r
#pragma mapbox: define lowp float halo_blur\r
#pragma mapbox: define lowp float emissive_strength\r
#pragma mapbox: define lowp float occlusion_opacity\r
#pragma mapbox: define lowp float z_offset\r
void main() {\r
#pragma mapbox: initialize highp vec4 fill_color\r
#pragma mapbox: initialize highp vec4 halo_color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize lowp float halo_width\r
#pragma mapbox: initialize lowp float halo_blur\r
#pragma mapbox: initialize lowp float emissive_strength\r
#pragma mapbox: initialize lowp float occlusion_opacity\r
#pragma mapbox: initialize lowp float z_offset\r
vec2 a_pos=a_pos_offset.xy;\r
vec2 a_offset=a_pos_offset.zw;\r
vec2 a_tex=a_tex_size.xy;\r
vec2 a_size=a_tex_size.zw;\r
float a_size_min=floor(a_size[0]*0.5);\r
vec2 a_pxoffset=a_pixeloffset.xy;\r
vec2 a_min_font_scale=a_pixeloffset.zw/256.0;\r
highp float segment_angle=-a_projected_pos[3];\r
float size;\r
if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r
size=mix(a_size_min,a_size[1],u_size_t)/128.0;\r
} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r
size=a_size_min/128.0;\r
} else {\r
size=u_size;\r
}\r
vec2 tile_anchor=a_pos;\r
float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\r
#ifdef Z_OFFSET\r
e+=a_auto_z_offset;\r
#endif\r
vec3 h=elevationVector(tile_anchor)*e;\r
float globe_occlusion_fade;\r
vec3 world_pos;\r
vec3 mercator_pos;\r
vec3 world_pos_globe;\r
#ifdef PROJECTION_GLOBE_VIEW\r
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);\r
world_pos_globe=a_globe_anchor+h;\r
world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);\r
vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);\r
vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\r
#else\r
world_pos=vec3(tile_anchor,0)+h;\r
globe_occlusion_fade=1.0;\r
#endif\r
vec4 projected_point=u_matrix*vec4(world_pos,1);\r
highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\r
camera_to_anchor_distance/u_camera_to_center_distance :\r
u_camera_to_center_distance/camera_to_anchor_distance;\r
highp float perspective_ratio=clamp(\r
0.5+0.5*distance_ratio,0.0,1.5);\r
size*=perspective_ratio;\r
float font_scale=u_is_text ? size/24.0 : size;\r
highp float symbol_rotation=0.0;\r
if (u_rotate_symbol) {vec4 offsetprojected_point;\r
vec2 a;\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);\r
offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\r
vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);\r
a=projected_point_globe.xy/projected_point_globe.w;\r
#else\r
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\r
a=projected_point.xy/projected_point.w;\r
#endif\r
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;\r
symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r
}\r
vec4 projected_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
#ifdef PROJECTED_POS_ON_VIEWPORT\r
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\r
#else\r
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;\r
projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \r
#endif\r
#else\r
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\r
#endif\r
highp float angle_sin=sin(segment_angle+symbol_rotation);\r
highp float angle_cos=cos(segment_angle+symbol_rotation);\r
mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r
float z=0.0;\r
vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\r
#ifdef TERRAIN\r
#ifdef PITCH_WITH_MAP_TERRAIN\r
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);\r
z=elevation(tile_pos.xy);\r
#endif\r
#endif\r
#ifdef Z_OFFSET\r
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;\r
#else\r
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;\r
#endif
float occlusion_fade=globe_occlusion_fade;\r
vec2 fade_opacity=unpack_opacity(a_fade_opacity);\r
float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r
float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\r
#ifdef DEPTH_OCCLUSION\r
float depth_occlusion=occlusionFadeMultiSample(projected_point);\r
float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);\r
out_fade_opacity*=depth_occlusion_multplier;\r
#endif\r
#ifdef OCCLUSION_QUERIES\r
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);\r
out_fade_opacity*=occludedFadeMultiplier;\r
#endif\r
float alpha=opacity*out_fade_opacity;\r
float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);\r
vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);\r
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\r
#else\r
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\r
#endif\r
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\r
v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);\r
v_tex_a=a_tex/u_texsize;\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
is_sdf=a_size[0]-2.0*a_size_min;\r
v_tex_a_icon=a_tex/u_texsize_icon;\r
#endif\r
#ifdef ICON_TRANSITION\r
v_tex_b=a_texb/u_texsize;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=e;\r
#endif\r
}`),terrainRaster:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform sampler2D u_image0;\r
in vec2 v_pos0;\r
#ifdef FOG\r
in float v_fog_opacity;\r
#endif\r
#ifdef RENDER_SHADOWS\r
in vec4 v_pos_light_view_0;\r
in vec4 v_pos_light_view_1;\r
#endif\r
uniform vec3 u_ground_shadow_factor;\r
void main() {\r
vec4 image_color=texture(u_image0,v_pos0);\r
vec4 color;\r
#ifdef LIGHTING_3D_MODE\r
const vec3 normal=vec3(0.0,0.0,1.0);\r
#ifdef RENDER_SHADOWS\r
float cutoffOpacity=1.0;\r
#ifdef RENDER_CUTOFF\r
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\r
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);\r
vec3 emissive_base=image_color.rgb*image_color.a;\r
float ndotl=u_shadow_direction.z;\r
float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);\r
ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));\r
vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);\r
color.rgb=lit+emissive;\r
color.a=1.0;\r
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\r
color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\r
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;\r
color=apply_lighting(image_color,normal,lighting_factor);\r
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);\r
color.a=1.0;\r
#endif
#endif
#else
color=image_color;\r
#endif
#ifdef FOG\r
#ifdef ZERO_EXAGGERATION\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r
#else\r
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\r
#endif\r
#endif\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform float u_skirt_height;\r
in vec2 a_pos;\r
out vec2 v_pos0;\r
#ifdef FOG\r
out float v_fog_opacity;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out vec4 v_pos_light_view_0;\r
out vec4 v_pos_light_view_1;\r
out float v_depth;\r
#endif\r
void main() {\r
vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);\r
float skirt=decomposedPosAndSkirt.z;\r
vec2 decodedPos=decomposedPosAndSkirt.xy;\r
float elevation=elevation(decodedPos)-skirt*u_skirt_height;\r
v_pos0=decodedPos/8192.0;\r
gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\r
#ifdef FOG\r
#ifdef ZERO_EXAGGERATION\r
v_fog_pos=fog_position(decodedPos);\r
#else\r
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\r
#endif\r
#endif\r
#ifdef RENDER_SHADOWS\r
vec3 pos=vec3(decodedPos,elevation);\r
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);\r
v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\r
#endif\r
}`),terrainDepth:kr(`precision highp float;\r
in float v_depth;\r
void main() {\r
glFragColor=pack_depth(v_depth);\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_matrix;\r
in vec2 a_pos;\r
out float v_depth;\r
void main() {\r
float elevation=elevation(a_pos);\r
gl_Position=u_matrix*vec4(a_pos,elevation,1.0);\r
v_depth=gl_Position.z/gl_Position.w;\r
}`),skybox:kr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;\r
uniform lowp samplerCube u_cubemap;\r
uniform lowp float u_opacity;\r
uniform highp float u_temporal_offset;\r
uniform highp vec3 u_sun_direction;\r
float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {\r
highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;\r
const highp float smoothstep_delta=1e-5;\r
return smoothstep(\r
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);\r
}\r
float map(float value,float start,float end,float new_start,float new_end) {\r
return ((value-start)*(new_end-new_start))/(end-start)+new_start;\r
}\r
void main() {\r
vec3 uv=v_uv;const float y_bias=0.015;\r
uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);\r
vec3 sky_color=texture(u_cubemap,uv).rgb;\r
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\r
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);\r
glFragColor=vec4(sky_color*u_opacity,u_opacity);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
}`,qc),skyboxGradient:kr(`#include "_prelude_fog.fragment.glsl"\r
in highp vec3 v_uv;\r
uniform lowp sampler2D u_color_ramp;\r
uniform highp vec3 u_center_direction;\r
uniform lowp float u_radius;\r
uniform lowp float u_opacity;\r
uniform highp float u_temporal_offset;\r
void main() {\r
float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;\r
vec4 color=texture(u_color_ramp,vec2(progress,0.5));\r
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\r
#endif\r
color*=u_opacity;\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
}`,qc),skyboxCapture:kr(`
in highp vec3 v_position;\r
uniform highp float u_sun_intensity;\r
uniform highp float u_luminance;\r
uniform lowp vec3 u_sun_direction;\r
uniform highp vec4 u_color_tint_r;\r
uniform highp vec4 u_color_tint_m;\r
precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)\r
#define MIE_G                   0.76\r
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10\r
#define DENSITY_STEPS           4\r
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {\r
float a=dot(dir,dir);\r
float b=2.0*dot(dir,orig);\r
float c=dot(orig,orig)-radius*radius;\r
float d=sqrt(b*b-4.0*a*c);\r
return (-b+d)/(2.0*a);\r
}\r
vec3 extinction(vec2 density) {\r
return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));\r
}\r
vec2 local_density(vec3 point) {\r
float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);\r
float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);\r
return vec2(exp_r,exp_m);\r
}\r
float phase_ray(float cos_angle) {\r
return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);\r
}\r
float phase_mie(float cos_angle) {\r
return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/
((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));\r
}\r
vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {\r
float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);\r
float step_len=ray_len/float(DENSITY_STEPS);\r
vec2 density_point_to_atmosphere=vec2(0.0);\r
for (int i=0; i < DENSITY_STEPS;++i) {\r
vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);\r
density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;\r
}\r
return density_point_to_atmosphere;\r
}\r
vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {\r
vec2 density_orig_to_point=vec2(0.0);\r
vec3 scatter_r=vec3(0.0);\r
vec3 scatter_m=vec3(0.0);\r
vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);\r
float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);\r
float step_len=ray_len/float(SAMPLE_STEPS);\r
for (int i=0; i < SAMPLE_STEPS;++i) {\r
vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;\r
density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;\r
vec3 extinction=extinction(density_orig_to_atmosphere);\r
scatter_r+=density.x*extinction;\r
scatter_m+=density.y*extinction;\r
}float cos_angle=dot(ray_dir,sun_direction);\r
float phase_r=phase_ray(cos_angle);\r
float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;\r
vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;\r
return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;\r
}\r
const float A=0.15;\r
const float B=0.50;\r
const float C=0.10;\r
const float D=0.20;\r
const float E=0.02;\r
const float F=0.30;\r
vec3 uncharted2_tonemap(vec3 x) {\r
return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\r
}\r
void main() {\r
vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;\r
ray_direction.y+=y_bias;\r
vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;\r
glFragColor=vec4(color,1.0);\r
}`,`in highp vec3 a_pos_3f;\r
uniform mat3 u_matrix_3f;\r
out highp vec3 v_position;\r
float map(float value,float start,float end,float new_start,float new_end) {\r
return ((value-start)*(new_end-new_start))/(end-start)+new_start;\r
}\r
void main() {\r
vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);\r
v_position=pos.xyz;\r
v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);\r
gl_Position=vec4(a_pos_3f.xy,0.0,1.0);\r
}`),globeRaster:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform sampler2D u_image0;\r
uniform float u_far_z_cutoff;\r
in vec2 v_pos0;\r
#ifndef FOG\r
uniform highp vec3 u_frustum_tl;\r
uniform highp vec3 u_frustum_tr;\r
uniform highp vec3 u_frustum_br;\r
uniform highp vec3 u_frustum_bl;\r
uniform highp vec3 u_globe_pos;\r
uniform highp float u_globe_radius;\r
uniform vec2 u_viewport;\r
#endif\r
void main() {\r
vec4 color;\r
#ifdef CUSTOM_ANTIALIASING\r
highp vec2 uv=gl_FragCoord.xy/u_viewport;\r
highp vec3 ray_dir=mix(\r
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);\r
highp vec3 dir=normalize(ray_dir);\r
highp vec3 closest_point=dot(u_globe_pos,dir)*dir;\r
highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;\r
const float antialias_pixel=2.0;\r
highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);\r
highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);\r
vec4 raster=texture(u_image0,v_pos0);\r
#ifdef LIGHTING_3D_MODE\r
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r
raster=apply_lighting_with_emission_ground(raster,raster.a);\r
color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\r
#else
raster=apply_lighting_ground(raster);\r
color=vec4(raster.rgb*antialias,raster.a*antialias);\r
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);\r
#endif
#else
color=texture(u_image0,v_pos0);\r
#ifdef LIGHTING_3D_MODE\r
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r
color=apply_lighting_with_emission_ground(color,color.a);\r
color.a=1.0;\r
#else
color=apply_lighting_ground(color);\r
#endif
#endif
#endif
#ifdef FOG\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r
#endif\r
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_proj_matrix;\r
uniform mat4 u_normalize_matrix;\r
uniform mat4 u_globe_matrix;\r
uniform mat4 u_merc_matrix;\r
uniform float u_zoom_transition;\r
uniform vec2 u_merc_center;\r
uniform mat3 u_grid_matrix;\r
uniform float u_skirt_height;\r
#ifdef GLOBE_POLES\r
in vec3 a_globe_pos;\r
in vec2 a_uv;\r
#else\r
in vec2 a_pos;
#endif\r
out vec2 v_pos0;\r
void main() {\r
#ifdef GLOBE_POLES\r
vec3 globe_pos=a_globe_pos;\r
vec2 uv=a_uv;\r
#else
float tiles=u_grid_matrix[0][2];\r
float idx=u_grid_matrix[1][2];\r
float idy=u_grid_matrix[2][2];\r
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);\r
vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);\r
float mercatorY=mercatorYfromLat(latLng[0]);\r
float uvY=mercatorY*tiles-idy;\r
float mercatorX=mercatorXfromLng(latLng[1]);\r
float uvX=mercatorX*tiles-idx;\r
vec3 globe_pos=latLngToECEF(latLng.xy);\r
vec2 merc_pos=vec2(mercatorX,mercatorY);\r
vec2 uv=vec2(uvX,uvY);\r
#endif\r
v_pos0=uv;\r
vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\r
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;\r
#else\r
vec3 up_vector=elevationVector(tile_pos);\r
#endif\r
float height=elevation(tile_pos);\r
globe_pos+=up_vector*height;\r
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\r
#endif\r
#ifdef GLOBE_POLES\r
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
#else\r
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
vec4 merc_world_pos=vec4(0.0);\r
if (u_zoom_transition > 0.0) {\r
merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);\r
merc_world_pos.xy-=u_merc_center;\r
merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);\r
merc_world_pos=u_merc_matrix*merc_world_pos;\r
}\r
vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\r
#endif\r
gl_Position=u_proj_matrix*interpolated_pos;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\r
#endif\r
}`),globeAtmosphere:kr(`#include "_prelude_fog.fragment.glsl"\r
uniform float u_transition;\r
uniform highp float u_fadeout_range;\r
uniform highp float u_temporal_offset;\r
uniform vec4 u_color;\r
uniform vec4 u_high_color;\r
uniform vec4 u_space_color;\r
uniform float u_horizon_angle;\r
in highp vec3 v_ray_dir;\r
in highp vec3 v_horizon_dir;\r
void main() {\r
highp vec3 dir=normalize(v_ray_dir);\r
float globe_pos_dot_dir;\r
#ifdef PROJECTION_GLOBE_VIEW\r
globe_pos_dot_dir=dot(u_globe_pos,dir);\r
highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;\r
float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\r
#ifdef ALPHA_PASS\r
glFragColor=vec4(0,0,0,0);\r
return;\r
#else\r
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);\r
#else\r
glFragColor=vec4(0,0,0,1);\r
#endif\r
return;\r
#endif\r
}\r
#endif\r
highp vec3 horizon_dir=normalize(v_horizon_dir);\r
float horizon_angle_mercator=dir.y < horizon_dir.y ?\r
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);\r
float horizon_angle;\r
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;\r
highp float closest_point_to_center=length(closest_point-u_globe_pos);\r
highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\r
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);\r
horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\r
#else\r
horizon_angle=horizon_angle_mercator;\r
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);\r
float alpha_0=u_color.a;\r
float alpha_1=u_high_color.a;\r
float alpha_2=u_space_color.a;\r
vec3 color_stop_0=u_color.rgb;\r
vec3 color_stop_1=u_high_color.rgb;\r
vec3 color_stop_2=u_space_color.rgb;\r
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);\r
float a1=mix(a0,1.0,alpha_0);\r
float a2=mix(a0,a1,t);\r
float a =mix(alpha_2,a2,t);\r
glFragColor=vec4(1.0,1.0,1.0,a);\r
#else\r
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);\r
vec3 c1=mix(c0,color_stop_0,alpha_0);\r
vec3 c2=mix(c0,c1,t);\r
vec3 c=c2;glFragColor=vec4(c*t,t);\r
#endif\r
}`,`in vec3 a_pos;\r
in vec2 a_uv;uniform vec3 u_frustum_tl;\r
uniform vec3 u_frustum_tr;\r
uniform vec3 u_frustum_br;\r
uniform vec3 u_frustum_bl;\r
uniform float u_horizon;\r
out highp vec3 v_ray_dir;\r
out highp vec3 v_horizon_dir;\r
void main() {\r
v_ray_dir=mix(\r
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);\r
v_horizon_dir=mix(\r
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);\r
gl_Position=vec4(a_pos,1.0);\r
}`),model:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform float u_opacity;\r
uniform vec3 u_lightcolor;\r
uniform vec3 u_lightpos;\r
uniform float u_lightintensity;\r
uniform vec4 u_baseColorFactor;\r
uniform vec4 u_emissiveFactor;\r
uniform float u_metallicFactor;\r
uniform float u_roughnessFactor;\r
uniform float u_emissive_strength;\r
in highp vec4 v_position_height;\r
in lowp vec4 v_color_mix;\r
#ifdef RENDER_SHADOWS\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in float v_depth_shadows;\r
#endif\r
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;\r
#endif\r
#pragma mapbox: define-attribute highp vec3 normal_3f\r
#pragma mapbox: define-attribute highp vec3 color_3f\r
#pragma mapbox: define-attribute highp vec4 color_4f\r
#pragma mapbox: define-attribute highp vec2 uv_2f\r
#pragma mapbox: initialize-attribute highp vec3 normal_3f\r
#pragma mapbox: initialize-attribute highp vec3 color_3f\r
#pragma mapbox: initialize-attribute highp vec4 color_4f\r
#pragma mapbox: initialize-attribute highp vec2 uv_2f\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
in lowp vec4 v_roughness_metallic_emissive_alpha;\r
in mediump vec4 v_height_based_emission_params;\r
#endif\r
#ifdef HAS_TEXTURE_u_baseColorTexture\r
uniform sampler2D u_baseColorTexture;\r
uniform bool u_baseTextureIsAlpha;\r
uniform bool u_alphaMask;\r
uniform float u_alphaCutoff;\r
#endif\r
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\r
uniform sampler2D u_metallicRoughnessTexture;\r
#endif\r
#ifdef HAS_TEXTURE_u_occlusionTexture\r
uniform sampler2D u_occlusionTexture;\r
uniform float u_aoIntensity;\r
#endif\r
#ifdef HAS_TEXTURE_u_normalTexture\r
uniform sampler2D u_normalTexture;\r
#endif\r
#ifdef HAS_TEXTURE_u_emissionTexture\r
uniform sampler2D u_emissionTexture;\r
#endif\r
#ifdef APPLY_LUT_ON_GPU\r
uniform highp sampler3D u_lutTexture;\r
#endif\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
in highp float v_depth;\r
uniform highp sampler2D u_depthTexture;\r
uniform highp vec2 u_inv_depth_size;\r
uniform highp vec2 u_depth_range_unpack;\r
#ifdef DEPTH_D24\r
highp float unpack_depth(highp float depth) {\r
return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;\r
}\r
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)\r
{\r
const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r
return dot(rgba_depth,bit_shift)*2.0-1.0;\r
}\r
#endif\r
bool isOccluded() {\r
highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\r
#ifdef DEPTH_D24\r
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);\r
#else\r
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\r
#endif
return v_depth > depth+0.0005;\r
}\r
#endif\r
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {\r
return pow(color,vec3(1./2.2));\r
}\r
vec3 sRGBToLinear(vec3 srgbIn) {\r
return pow(srgbIn,vec3(2.2));\r
}\r
float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);\r
}\r
vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\r
{\r
#ifdef LIGHTING_3D_MODE\r
vec3 transformed_normal=vec3(-normal.xy,normal.z);\r
float lighting_factor;\r
#ifdef RENDER_SHADOWS\r
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\r
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\r
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);\r
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);\r
vec3 c=vec3(0.03,0.03,0.03);\r
float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);\r
directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);\r
vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));\r
return c3;\r
#endif
}\r
vec4 getBaseColor() {\r
vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f\r
albedo*=vec4(color_3f,1.0);\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
#else\r
#ifdef HAS_ATTRIBUTE_a_color_4f\r
albedo*=color_4f;\r
#endif\r
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\r
vec4 texColor=texture(u_baseColorTexture,uv_2f);\r
if(u_alphaMask) {\r
if (texColor.w < u_alphaCutoff) {\r
discard;\r
}\r
}\r
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {\r
texColor.rgb/=texColor.w;\r
}\r
texColor.w=1.0;\r
#endif\r
if(u_baseTextureIsAlpha) {\r
if (texColor.r < 0.5) {\r
discard;\r
}\r
} else {texColor.rgb=sRGBToLinear(texColor.rgb);\r
albedo*=texColor;\r
}\r
#endif\r
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\r
#ifdef APPLY_LUT_ON_GPU\r
color=applyLUT(u_lutTexture,color);\r
#endif\r
return color;\r
}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\r
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));\r
highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));\r
highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));\r
highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );\r
highp vec3 dp1perp=cross( N,dp1 );\r
highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;\r
highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);\r
highp float lengthB=dot(B,B);\r
highp float maxLength=max(lengthT,lengthB);\r
highp float invmax=inversesqrt( maxLength );\r
highp mat3 res=mat3( T*invmax,B*invmax,N );\r
return res;\r
#else\r
return mat3(1.0);\r
#endif\r
}\r
highp vec3 getNormal(){\r
highp vec3 n;\r
#ifdef HAS_ATTRIBUTE_a_normal_3f\r
n=normalize(normal_3f);\r
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));\r
highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\r
#endif\r
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;\r
nMap=normalize(2.0*nMap-vec3(1.0));\r
highp vec3 v=normalize(-v_position_height.xyz);\r
highp mat3 TBN=cotangentFrame(n,v,uv_2f);\r
n=normalize(TBN*nMap);\r
#endif\r
return n;\r
}\r
struct Material {\r
float perceptualRoughness;\r
float alphaRoughness;\r
float metallic;\r
vec3 f90;\r
vec4 baseColor;\r
vec3 diffuseColor;\r
vec3 specularColor;\r
highp vec3 normal;\r
};\r
Material getPBRMaterial() {\r
Material mat;\r
mat.baseColor=getBaseColor();\r
mat.perceptualRoughness=u_roughnessFactor;\r
mat.metallic=u_metallicFactor;\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;\r
mat.metallic=v_roughness_metallic_emissive_alpha.y;\r
mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\r
#endif\r
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \r
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);\r
mat.perceptualRoughness*=mrSample.g;\r
mat.metallic*=mrSample.b;\r
#endif\r
const float c_minRoughness=0.04;\r
mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);\r
mat.metallic=saturate(mat.metallic);\r
mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);\r
mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);\r
mat.diffuseColor*=1.0-mat.metallic;\r
mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);\r
highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);\r
mat.f90=vec3(reflectance90);\r
mat.normal=getNormal();\r
return mat;\r
}float V_GGX(float NdotL,float NdotV,float roughness)\r
{\r
float a2=roughness*roughness;\r
float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);\r
float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);\r
return 0.5/(GGXV+GGXL);\r
}float V_GGXFast(float NdotL,float NdotV,float roughness) {\r
float a=roughness;\r
float GGXV=NdotL*(NdotV*(1.0-a)+a);\r
float GGXL=NdotV*(NdotL*(1.0-a)+a);\r
return 0.5/(GGXV+GGXL);\r
}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\r
{\r
return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);\r
}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\r
{\r
float x=1.0-VdotH;\r
float x4=x*x*x*x;\r
return specularColor+(1.0-specularColor)*x4*x;\r
}float D_GGX(highp float NdotH,float alphaRoughness)\r
{\r
highp float a4=alphaRoughness*alphaRoughness;\r
highp float f=(NdotH*a4-NdotH)*NdotH+1.0;\r
return a4/(PI*f*f);\r
}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\r
{\r
float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;\r
return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));\r
}\r
vec3 diffuseLambertian(Material mat)\r
{\r
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;\r
#else\r
return mat.diffuseColor/PI;\r
#endif\r
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\r
{\r
vec4 c0=vec4(-1,-0.0275,-0.572,0.022);\r
vec4 c1=vec4(1,0.0425,1.04,-0.04);\r
highp vec4 r=roughness*c0+c1;\r
highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;\r
vec2 AB=vec2(-1.04,1.04)*a004+r.zw;\r
return specularColor*AB.x+AB.y;\r
}\r
vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\r
{\r
vec3 env_light=vec3(0.65,0.65,0.65);\r
#ifdef LIGHTING_3D_MODE\r
float ambient_factor=calculate_ambient_directional_factor(normal);\r
env_light=u_lighting_ambient_color*ambient_factor;\r
#endif\r
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);\r
vec3 indirectSpecular= envBRDF*env_light;\r
vec3 indirectDiffuse=mat.diffuseColor*env_light;\r
return indirectSpecular+indirectDiffuse;\r
}\r
vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\r
{\r
highp vec3 n=mat.normal;\r
highp vec3 v=normalize(-v_position_height.xyz);\r
highp vec3 l=normalize(lightPosition);\r
highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);\r
float NdotL=saturate(dot(n,l));\r
highp float NdotH=saturate(dot(n,h));\r
float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;\r
vec3 transformed_normal=vec3(-n.xy,n.z);\r
float lighting_factor;\r
#ifdef RENDER_SHADOWS\r
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\r
#else\r
lighting_factor=NdotL;\r
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;\r
vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);\r
vec3 color=(saturate(directLightColor)+indirectLightColor);\r
float intensityFactor=1.0;\r
#if !defined(LIGHTING_3D_MODE)\r
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\r
#endif
color*=intensityFactor;\r
return color;\r
}\r
void main() {\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
if (isOccluded()) {\r
discard;\r
}\r
#endif\r
vec3 lightDir=u_lightpos;\r
vec3 lightColor=u_lightcolor;\r
#ifdef LIGHTING_3D_MODE\r
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;\r
lightColor=u_lighting_directional_color;\r
#endif\r
vec4 finalColor;\r
#ifdef DIFFUSE_SHADED\r
vec3 N=getNormal();\r
vec3 baseColor=getBaseColor().rgb;\r
vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;\r
diffuse*=ao;\r
#endif\r
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\r
#else
Material mat=getPBRMaterial();\r
vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\r
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\r
#ifdef OCCLUSION_TEXTURE_TRANSFORM\r
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\r
#else\r
vec2 uv=uv_2f;\r
#endif\r
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;\r
color*=ao;\r
#endif
vec4 emissive=u_emissiveFactor;\r
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\r
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\r
#endif\r
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);\r
emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\r
#endif\r
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
float resEmission=v_roughness_metallic_emissive_alpha.z;\r
resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);\r
vec3 color_mix=v_color_mix.rgb;\r
#ifdef APPLY_LUT_ON_GPU\r
color_mix=applyLUT(u_lutTexture,color_mix);\r
#endif\r
color=mix(color,color_mix,min(1.0,resEmission));\r
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));\r
distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));\r
opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\r
#endif\r
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;\r
color=mix(color,unlitColor,u_emissive_strength);\r
color=linearTosRGB(color);\r
color*=opacity;\r
finalColor=vec4(color,opacity);\r
#endif
#ifdef FOG\r
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\r
#endif\r
#ifdef RENDER_CUTOFF\r
finalColor*=v_cutoff_opacity;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
finalColor=applyCutout(finalColor,v_position_height.w);\r
#endif\r
glFragColor=finalColor;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec3 a_pos_3f;\r
#pragma mapbox: define-attribute highp vec3 normal_3f\r
#pragma mapbox: define-attribute highp vec2 uv_2f\r
#pragma mapbox: define-attribute highp vec3 color_3f\r
#pragma mapbox: define-attribute highp vec4 color_4f\r
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\r
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;\r
uniform mat4 u_node_matrix;\r
uniform mat4 u_lighting_matrix;\r
uniform vec3 u_camera_pos;\r
uniform vec4 u_color_mix;\r
#ifdef INSTANCED_ARRAYS\r
in vec4 a_normal_matrix0;\r
in vec4 a_normal_matrix1;\r
in vec4 a_normal_matrix2;\r
in vec4 a_normal_matrix3;\r
#else\r
uniform highp mat4 u_normal_matrix;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out float v_depth_shadows;\r
#endif\r
out vec4 v_position_height;\r
out lowp vec4 v_color_mix;\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
out highp float v_depth;\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
out lowp vec4 v_roughness_metallic_emissive_alpha;\r
out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {\r
return pow(srgbIn,vec3(2.2));\r
}\r
void main() {\r
#pragma mapbox: initialize-attribute highp vec3 normal_3f\r
#pragma mapbox: initialize-attribute highp vec2 uv_2f\r
#pragma mapbox: initialize-attribute highp vec3 color_3f\r
#pragma mapbox: initialize-attribute highp vec4 color_4f\r
#pragma mapbox: initialize-attribute-custom highp vec4 pbr\r
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\r
highp mat4 normal_matrix;\r
#ifdef INSTANCED_ARRAYS\r
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\r
#else\r
normal_matrix=u_normal_matrix;\r
#endif\r
vec3 local_pos;\r
mat3 rs;\r
#ifdef MODEL_POSITION_ON_GPU\r
vec3 pos_color=normal_matrix[0].xyz;\r
vec4 translate=normal_matrix[1];\r
vec3 pos_a=floor(pos_color);\r
vec3 rgb=1.05*(pos_color-pos_a);\r
float hidden=float(pos_a.x > EXTENT);\r
float color_mix=pos_a.z/100.0;\r
v_color_mix=vec4(sRGBToLinear(rgb),color_mix);\r
float meter_to_tile=normal_matrix[0].w;\r
vec4 pos=vec4(pos_a.xy,translate.z,1.0);\r
rs[0].x=normal_matrix[1].w;\r
rs[0].yz=normal_matrix[2].xy;\r
rs[1].xy=normal_matrix[2].zw;\r
rs[1].z=normal_matrix[3].x;\r
rs[2].xyz=normal_matrix[3].yzw;\r
vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);\r
vec3 rotated_pos_node=rs*pos_node.xyz;\r
vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);\r
pos.xyz+=pos_model_tile;\r
local_pos=pos.xyz;\r
gl_Position=mix(u_matrix*pos,AWAY,hidden);\r
pos.z*=meter_to_tile;\r
v_position_height.xyz=pos.xyz-u_camera_pos;\r
#else\r
local_pos=a_pos_3f;\r
gl_Position=u_matrix*vec4(a_pos_3f,1);\r
v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));\r
v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\r
#endif\r
v_position_height.w=a_pos_3f.z;\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
vec4 albedo_c=decode_color(pbr.xy);\r
vec2 e_r_m=unpack_float(pbr.z);\r
vec2 r_m= unpack_float(e_r_m.y*16.0);\r
r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);\r
v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;\r
v_height_based_emission_params.x=heightBasedRelativeIntepolation;\r
v_height_based_emission_params.y=heightBasedEmissiveStrength.z;\r
vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;\r
v_height_based_emission_params.z=emissionMultiplierValues.x;\r
v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(local_pos);\r
#endif\r
#ifdef RENDER_CUTOFF\r
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\r
#endif\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
v_depth=gl_Position.z/gl_Position.w;\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_normal_3f\r
#ifdef MODEL_POSITION_ON_GPU\r
float x_squared_scale=dot(rs[0],rs[0]);\r
float y_squared_scale=dot(rs[1],rs[1]);\r
float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);\r
normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);\r
normal_3f=normalize(normal_3f);\r
#else\r
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));\r
#endif\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
#ifdef HAS_ATTRIBUTE_a_color_4f\r
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\r
#endif\r
#endif\r
#ifdef RENDER_SHADOWS\r
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\r
#ifdef NORMAL_OFFSET\r
#ifdef HAS_ATTRIBUTE_a_normal_3f\r
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));\r
shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\r
#else\r
vec3 offset=shadow_normal_offset_model(normal_3f);\r
shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\r
#endif\r
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;\r
v_pos_light_view_1=u_light_matrix_1*shadow_pos;\r
v_depth_shadows=gl_Position.w;\r
#endif
}`),modelDepth:kr(`in highp float v_depth;\r
void main() {\r
#ifndef DEPTH_TEXTURE\r
glFragColor=pack_depth(v_depth);\r
#endif\r
}`,`in vec3 a_pos_3f;\r
uniform mat4 u_matrix;\r
out highp float v_depth;\r
#ifdef MODEL_POSITION_ON_GPU\r
#ifdef INSTANCED_ARRAYS\r
in vec4 a_normal_matrix0;\r
in vec4 a_normal_matrix1;\r
in vec4 a_normal_matrix2;\r
in vec4 a_normal_matrix3;\r
#else\r
uniform highp mat4 u_instance;\r
#endif\r
uniform highp mat4 u_node_matrix;\r
#endif\r
void main() {\r
#ifdef MODEL_POSITION_ON_GPU\r
highp mat4 instance;\r
#ifdef INSTANCED_ARRAYS\r
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\r
#else\r
instance=u_instance;\r
#endif\r
vec3 pos_color=instance[0].xyz;\r
vec4 translate=instance[1];\r
vec3 pos_a=floor(pos_color);\r
float hidden=float(pos_a.x > EXTENT);\r
float meter_to_tile=instance[0].w;\r
vec4 pos=vec4(pos_a.xy,translate.z,1.0);\r
mat3 rs;\r
rs[0].x=instance[1].w;\r
rs[0].yz=instance[2].xy;\r
rs[1].xy=instance[2].zw;\r
rs[1].z=instance[3].x;\r
rs[2].xyz=instance[3].yzw;\r
vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);\r
vec3 rotated_pos_node=rs*pos_node.xyz;\r
vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);\r
pos.xyz+=pos_model_tile;\r
gl_Position=mix(u_matrix*pos,AWAY,hidden);\r
#else\r
gl_Position=u_matrix*vec4(a_pos_3f,1);\r
#endif\r
v_depth=gl_Position.z/gl_Position.w;\r
}`),stars:kr(`in highp vec2 v_uv;\r
in mediump float v_intensity;float shapeCircle(in vec2 uv)\r
{float beginFade=0.6;float lengthFromCenter=length(v_uv);\r
return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);\r
}\r
void main() {\r
float alpha=shapeCircle(v_uv);\r
vec3 color=vec3(1.0,1.0,1.0);\r
alpha*=v_intensity;\r
glFragColor=vec4(color*alpha,alpha);\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;\r
uniform vec3 u_right;uniform float u_intensity_multiplier;\r
out highp vec2 v_uv;\r
out mediump float v_intensity;\r
void main() {\r
v_uv=a_uv;\r
v_intensity=a_fade_opacity*u_intensity_multiplier;\r
vec3 pos=a_pos_3f;\r
pos+=a_uv.x*u_right*a_size_scale;\r
pos+=a_uv.y*u_up*a_size_scale;\r
gl_Position=u_matrix*vec4(pos,1.0);\r
}`),snowParticle:kr(`in highp vec2 uv;\r
in highp float alphaMultiplier;\r
uniform vec4 u_particleColor;\r
uniform vec2 u_simpleShapeParameters;void main() {\r
float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);\r
float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));\r
alpha*=alphaMultiplier;\r
alpha*=u_particleColor.a;\r
vec3 color=u_particleColor.rgb*alpha;\r
glFragColor=vec4(color,alpha) ;\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`
in highp vec3 a_pos_3f;in highp vec2 a_uv;\r
in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;\r
uniform mat4 u_projection;\r
uniform vec3 u_cam_pos;\r
uniform vec2 u_screenSize;\r
uniform float u_time;\r
uniform float u_boxSize;\r
uniform float u_velocityConeAperture; \r
uniform float u_velocity;uniform vec3 u_direction;\r
uniform float u_horizontalOscillationRadius; \r
uniform float u_horizontalOscillationRate; \r
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;\r
uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;\r
out highp vec2 uv;\r
out highp float alphaMultiplier;\r
void main() {\r
vec3 pos=a_pos_3f;\r
float halfBoxSize=0.5*u_boxSize;\r
pos.xyz*=halfBoxSize;\r
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);\r
float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;\r
float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);\r
vec3 localZ=normalize(u_direction);\r
vec3 localX=normalize(cross(localZ,vec3(1,0,0)));\r
vec3 localY=normalize(cross(localZ,localX));vec3 direction;\r
direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
direction.z=cos(coneAnglePichRad);\r
direction=normalize(direction);\r
vec3 simPosLocal=vec3(0,0,0);\r
float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;\r
simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;\r
float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);\r
simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));\r
vec3 simPos=localX*simPosLocal.x+\r
localY*simPosLocal.y+
localZ*simPosLocal.z;\r
pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);\r
float clipZ=-u_cam_pos.z+pos.z;\r
vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;\r
alphaMultiplier=1.0;\r
vec4 posScreen=u_projection*posView;\r
posScreen/=posScreen.w;\r
posScreen.xy=vec2(0.5)+posScreen.xy*0.5;\r
posScreen.xy*=u_screenSize;\r
vec2 thinningCenterPos=u_thinningCenterPos.xy;\r
thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;\r
float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));\r
screenDist+=a_snowParticleData.x*u_thinningParticleOffset;\r
float scaleFactorMode=0.0;\r
float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;\r
if (screenDist < thinningShapeDist) {\r
float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);\r
thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);\r
if (a_snowParticleData.x < u_thinningAffectedRatio) {\r
scaleFactorMode=1.0-thinningFadeRatio;\r
alphaMultiplier=thinningFadeRatio;\r
}\r
}\r
vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);\r
posScreen1/=posScreen1.w;\r
vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);\r
posScreen2/=posScreen2.w;\r
posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;\r
posScreen1.xy*=u_screenSize;\r
posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;\r
posScreen2.xy*=u_screenSize;\r
float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;\r
float scaleFactor=1.0;\r
if (screenLength < screenEpsilon) {\r
scaleFactor=screenEpsilon/max(screenLength,0.01);\r
scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);\r
}float screenEpsilon2=15.0;\r
if (screenLength > screenEpsilon2) {\r
scaleFactor=screenEpsilon2/max(screenLength,0.01);\r
}\r
size*=scaleFactor;\r
vec2 right=size*vec2(1,0);\r
vec2 up=size*vec2(0,1);\r
posView.xy+=right*a_uv.x;\r
posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;\r
}`),rainParticle:kr(`in highp vec2 uv;\r
in highp float particleRandomValue;\r
uniform sampler2D u_texScreen;\r
uniform float u_distortionStrength;\r
uniform vec4 u_color;uniform vec2 u_thinningCenterPos;\r
uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;\r
uniform float u_thinningParticleOffset;\r
uniform float u_shapeDirectionalPower;\r
uniform float u_mode;void main() {\r
vec2 st=uv*0.5+vec2(0.5);\r
vec2 uvm=uv;\r
uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);\r
float shape=clamp(1.0-length(uvm),0.0,1.0);\r
float alpha=abs(shape)*u_color.a;\r
vec2 screenSize=vec2(textureSize(u_texScreen,0));\r
vec2 thinningCenterPos=u_thinningCenterPos.xy;\r
thinningCenterPos.y=screenSize.y-thinningCenterPos.y;\r
float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));\r
screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;\r
float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;\r
float thinningAlpha=1.0;\r
if (screenDist < thinningShapeDist) {\r
float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);\r
thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);\r
thinningAlpha*=thinningFadeRatio;\r
}\r
vec2 offsetXY=normalize(uvm)*abs(shape);\r
vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;\r
vec3 colorScreen=texture(u_texScreen,stScreen).rgb;\r
alpha*=thinningAlpha;\r
glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`
in highp vec3 a_pos_3f;in highp vec2 a_uv;\r
in highp vec4 a_rainParticleData;uniform mat4 u_modelview;\r
uniform mat4 u_projection;uniform vec3 u_cam_pos;\r
uniform float u_time;\r
uniform float u_boxSize;\r
uniform float u_velocityConeAperture; \r
uniform float u_velocity; \r
uniform vec2 u_rainDropletSize;\r
uniform vec3 u_rainDirection;\r
out highp vec2 uv;\r
out highp float particleRandomValue;\r
void main() {\r
vec3 pos=a_pos_3f;\r
float halfBoxSize=0.5*u_boxSize;\r
pos*=halfBoxSize; \r
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);\r
float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;\r
float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);\r
vec3 localX=normalize(cross(localZ,vec3(1,0,0)));\r
vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;\r
directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
directionLocal.z=cos(coneAnglePichRad);\r
directionLocal=normalize(directionLocal);\r
vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;\r
float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;\r
vec3 simPosLocal=vec3(0,0,0);\r
simPosLocal+=directionLocal*velocityScale*u_time;\r
vec3 simPos=localX*simPosLocal.x+\r
localY*simPosLocal.y+
localZ*simPosLocal.z;\r
pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);\r
vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);\r
vec3 side=cross(directionView,normalize(posView.xyz));\r
posView.xyz+=side*a_uv.x*u_rainDropletSize.x;\r
posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;\r
particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;\r
}`),vignette:kr(`uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;\r
in vec2 st;\r
void main() {\r
float screenDist=length(st);\r
float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);\r
alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;\r
vec3 color=u_vignetteColor.rgb;\r
glFragColor=vec4(color*alpha,alpha) ;\r
}`,`in vec2 a_pos_2f;\r
out vec2 st;\r
void main() {\r
st=a_pos_2f;\r
gl_Position=vec4(a_pos_2f,0,1);\r
}`),occlusion:kr(`uniform vec4 u_color;\r
void main() {\r
glFragColor=u_color;\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in highp vec2 a_offset_xy;\r
uniform highp vec3 u_anchorPos;\r
uniform mat4 u_matrix;\r
uniform vec2 u_screenSizePx;\r
uniform vec2 u_occluderSizePx;\r
void main() {\r
vec3 world_pos=u_anchorPos;\r
#ifdef TERRAIN\r
float e=elevation(world_pos.xy);\r
world_pos.z+=e;\r
#endif\r
vec4 projected_point=u_matrix*vec4(world_pos,1.0);\r
projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;\r
gl_Position=projected_point;\r
}`)};function Xo(d,t){const s=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=h.split(" ");for(const g of m)t.includes(g)||t.push(g)}}function kr(d,t){const s=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let m=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(z=>{const L=z.split(" ");return L[L.length-1]}),m=[...new Set(m)]);const g={},x=[],I=[];if(d=d.replace(s,(z,L)=>(I.push(L),"")),(t=t.replace(s,(z,L)=>(x.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let P=[...el];Xo(d,P),Xo(t,P);for(const z of[...x,...I])Zo[z]||console.error(`Undefined include: ${z}`),tl[z]||(tl[z]=[],Xo(Zo[z],tl[z])),P=[...P,...tl[z]];return{fragmentSource:d=d.replace(h,(z,L,F,B,j)=>(g[j]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${F} ${B} ${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${F} ${B} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${B} ${j};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(h,(z,L,F,B,j)=>{const X=B==="float"?"vec2":B,q=j.match(/color/)?"color":X;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${F} ${B} a_${j};
#endif
`:g[j]?L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${X} a_${j};
out ${F} ${B} ${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="initialize"?q==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${F} ${B} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${q}(a_${j}, u_${j}_t);
#else
    ${F} ${B} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${B} a_${j};
    out ${F} ${B} ${j};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${X} a_${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="define-instanced"?q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${F} ${B} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${X} a_${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${F} ${B} ${j} = a_${j};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${B} ${j} = a_${j};
#else
    ${F} ${B} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${B} ${j} = unpack_mix_${q}(a_${j}, u_${j}_t);
#else
    ${F} ${B} ${j} = u_${j};
#endif
`}),staticAttributes:m,usedDefines:P,vertexIncludes:x,fragmentIncludes:I}}class c_{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,h,m,g,x,I,P){this.context=t;let z=this.boundPaintVertexBuffers.length!==m.length;for(let F=0;!z&&F<m.length;F++)this.boundPaintVertexBuffers[F]!==m[F]&&(z=!0);let L=this.boundDynamicVertexBuffers.length!==I.length;for(let F=0;!L&&F<I.length;F++)this.boundDynamicVertexBuffers[F]!==I[F]&&(L=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||z||L||this.boundIndexBuffer!==g||this.boundVertexOffset!==x)this.freshBind(s,h,m,g,x,I,P);else{t.bindVertexArrayOES.set(this.vao);for(const F of I)F&&(F.bind(),P&&F.instanceCount&&F.setVertexAttribDivisor(t.gl,s,P));g&&g.dynamicDraw&&g.bind()}}freshBind(t,s,h,m,g,x,I){const P=t.numAttributes,z=this.context,L=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=x,s.enableAttributes(L,t),s.bind(),s.setVertexAttribPointers(L,t,g);for(const F of h)F.enableAttributes(L,t),F.bind(),F.setVertexAttribPointers(L,t,g);for(const F of x)F&&(F.enableAttributes(L,t),F.bind(),F.setVertexAttribPointers(L,t,g),I&&F.instanceCount&&F.setVertexAttribDivisor(L,t,I));m&&m.bind(),z.currentNumAttributes=P}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function u_(d,t){const s=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new i.ac(0,h/s).toLngLat().lat,new i.ac(0,(h+1)/s).toLngLat().lat]}function h_(d,t,s,h,m,g,x){const I=d.context,P=I.gl,z=s.hillshadeFBO;if(!z)return;d.prepareDrawTile();const L=d.isTileAffectedByFog(t),F=d.getOrCreateProgram("hillshade",{overrideFog:L});I.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,z.colorAttachment.get());const B=((J,Q,oe,ue)=>{const ce=oe.paint.get("hillshade-shadow-color"),ye=oe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",pe=oe.paint.get("hillshade-highlight-color"),ge=oe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",me=oe.paint.get("hillshade-accent-color"),we=oe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ee=oe.paint.get("hillshade-emissive-strength");let He=i.ak(oe.paint.get("hillshade-illumination-direction"));if(oe.paint.get("hillshade-illumination-anchor")==="viewport")He-=J.transform.angle;else if(J.style&&J.style.enable3dLights()&&J.style.directionalLight){const rt=J.style.directionalLight.properties.get("direction"),nt=i.cc(rt.x,rt.y,rt.z);He=i.ak(nt[1])}const Be=!J.options.moving;return{u_matrix:ue||J.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),Be),u_image:0,u_latrange:u_(0,Q.tileID),u_light:[oe.paint.get("hillshade-exaggeration"),He],u_shadow:ce.toRenderColor(ye?null:oe.lut),u_highlight:pe.toRenderColor(ge?null:oe.lut),u_emissive_strength:Ee,u_accent:me.toRenderColor(we?null:oe.lut)}})(d,s,h,d.terrain?t.projMatrix:null);d.uploadCommonUniforms(I,F,t.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:q}=d.getTileBoundsBuffers(s);F.draw(d,P.TRIANGLES,m,g,x,fr.disabled,B,h.id,j,X,q)}function rl(d,t,s){if(!t.needsDEMTextureUpload)return;const h=d.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(s.stride);const g=s.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new i.T(h,g,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function d_(d,t,s){const h=d.context,m=h.gl;if(!t.dem)return;const g=t.dem;if(h.activeTexture.set(m.TEXTURE1),rl(d,t,g),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const x=g.dim;h.activeTexture.set(m.TEXTURE0);let I=t.hillshadeFBO;if(!I){const B=new i.T(h,{width:x,height:x,data:null},m.RGBA8);B.bind(m.LINEAR,m.CLAMP_TO_EDGE),I=t.hillshadeFBO=h.createFramebuffer(x,x,!0,"renderbuffer"),I.colorAttachment.set(B.texture)}h.bindFramebuffer.set(I.framebuffer),h.viewport.set([0,0,x,x]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:z,tileBoundsSegments:L}=d.getMercatorTileBoundsBuffers(),F=[];d.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(d,m.TRIANGLES,Xt.disabled,br.disabled,Dr.unblended,fr.disabled,((B,j)=>{const X=j.stride,q=i.ad.mat4.create();return i.ad.mat4.ortho(q,0,i.ai,-i.ai,0,0,1),i.ad.mat4.translate(q,q,[0,-i.ai,0]),{u_matrix:q,u_image:1,u_dimension:[X,X],u_zoom:B.overscaledZ}})(t.tileID,g),s.id,P,z,L),t.needsHillshadePrepare=!1}class Ln{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class w0 extends Ln{getDefault(){return i.al.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class T0 extends Ln{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class yf extends Ln{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class vf extends Ln{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class xf extends Ln{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class bf extends Ln{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class f_ extends Ln{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class p_ extends Ln{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class S0 extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Zc extends Ln{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Xc extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class m_ extends Ln{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Es extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class wf extends Ln{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class _h extends Ln{getDefault(){return i.al.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class gh extends Ln{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Tf extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class Sf extends Ln{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Ef extends Ln{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let yh=class extends Ln{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class Af extends Ln{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Mf extends Ln{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class vh extends Ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class __ extends Ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class g_ extends Ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Dl extends Ln{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class E0 extends Ln{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class A0 extends Ln{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class M0 extends Ln{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class I0 extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class C0 extends Ln{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class If extends Ln{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class Cf extends If{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class xh extends If{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class y_ extends If{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class zl extends xh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const v_=(d,t,s)=>({u_matrix:d,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:s}),Pf=(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:g,u_image0:0,u_frustum_tl:x,u_frustum_tr:I,u_frustum_br:P,u_frustum_bl:z,u_globe_pos:L,u_globe_radius:F,u_viewport:B,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:X});function Rf(d,t){return d!=null&&t!=null&&!(!d.hasData()||!t.hasData())&&d.demTexture!=null&&t.demTexture!=null&&d.tileID.key!==t.tileID.key}const xa=new class{constructor(){this.operations={}}newMorphing(d,t,s,h,m){if(d in this.operations){const g=this.operations[d];g.to.tileID.key!==s.tileID.key&&(g.queued=s)}else this.operations[d]={startTime:h,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(const t in this.operations){const s=this.operations[t];for(s.phase=(d-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},ba={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Df(d,t,s){if(t===0)return 0;const h=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-d)*Math.max(t,1)*h}function wa(d,t){const s=1<<d.z;return!t&&(d.x===0||d.x===s-1)||d.y===0||d.y===s-1}const Kc=d=>({u_matrix:d});function Ll(d,t,s,h,m){if(m>0){const g=i.q.now(),x=(g-d.timeAdded)/m,I=t?(g-t.timeAdded)/m:-1,P=s.getSource(),z=h.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),F=L&&d.refreshedUponExpiration?1:i.ay(L?x:1-I,0,1);return d.refreshedUponExpiration&&x>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class x_ extends Ss{constructor(t){const s={type:"raster-dem",maxzoom:t.transform.maxZoom},h=new i.D(i.cj(),null),m=Qd("mock-dem",s,h,t.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class b_ extends Ss{constructor(t){const s=Qd("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new i.D(i.cj(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,h){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,x)=>{if(g[x.key]="",!this._tiles[x.key]){const I=new _a(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);I.state="loaded",this._tiles[x.key]=I}return g},{});for(const g in this._tiles)g in m||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class bh extends i.aH{constructor(t,s,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class wh extends i.cK{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,g]=function(P){const z=new i.b5,L=new i.aV,F=131;z.reserve(17161),L.reserve(33800);const B=i.ai/128,j=i.ai+B/2,X=j+B;for(let J=-B;J<X;J+=B)for(let Q=-B;Q<X;Q+=B){const oe=Q<0||Q>j||J<0||J>j?24575:0,ue=i.ay(Math.round(Q),0,i.ai),ce=i.ay(Math.round(J),0,i.ai);z.emplaceBack(ue+oe,ce)}const q=(J,Q)=>{const oe=Q*F+J;L.emplaceBack(oe+1,oe,oe+F),L.emplaceBack(oe+F,oe+F+1,oe+1)};for(let J=1;J<129;J++)for(let Q=1;Q<129;Q++)q(Q,J);return[0,129].forEach(J=>{for(let Q=0;Q<130;Q++)q(Q,J),q(J,Q)}),[z,L,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(h,i.b7.members),this.gridIndexBuffer=x.createIndexBuffer(m),this.gridSegments=i.b8.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=i.b8.simpleSegment(0,0,h.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new b_(s.map),this.orthoMatrix=i.ad.mat4.create(),i.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.ai,0,i.ai,0,1);const I=x.gl;this._overlapStencilMode=new br({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new x_(s.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,s,h){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const m=t.terrain.properties,g=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const I=t.terrain&&t.terrain.scope,P=m.get("source"),z=g?this._mockSourceCache:t.getSourceCache(P,I);if(!z)return void i.w(`Couldn't find terrain source "${P}".`);if(this.sourceCache=z,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(s):m.get("exaggeration"),!s.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(s,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),s.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,h=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=h;const m=s!=null?h-s:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const g=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(g);let I=g-this._previousZoom;const P=this._previousUpdateTimestamp;let z=g;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(g-z)>.5&&(I=.5*(g-z+I)),I*m<0&&(z+=I)),this._evaluationZoom=z;const L=x.getExaggeration(z),F=L===x.getExaggeration(Math.max(0,z-.1));if(F&&Math.abs(L-this._exaggeration)<.01)return L;let B=Math.min(.1,.00375*(this._updateTimestamp-P));return(F||L<.1||Math.abs(I)<1e-4)&&(B=Math.min(.2,4*B)),i.ah(this._exaggeration,L,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(P=>{const z=s.getTileByID(P).tileID;return z.projMatrix=h.calculateProjMatrix(z.toUnwrapped()),z});(function(P,z){const L=z.transform.pointCoordinate(z.transform.getCameraPoint()),F=new i.P(L.x,L.y);P.sort((B,j)=>{if(j.overscaledZ-B.overscaledZ)return j.overscaledZ-B.overscaledZ;const X=new i.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),q=new i.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),J=F.mult(1<<B.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(X)-J.distSqr(q)})})(m,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},m.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const P in x){const z=x[P];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,t[P],g),z.usedForTerrain))continue;const L=t[P];z.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[s.id]=m.map(P=>new bh(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const z=this.terrainTileForTile[P.key];if(!z)continue;const L=z.tileID.key;L in I||(this._visibleDemTiles.push(z),I[L]=L)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],g=m.dem;!g||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),rl(this.painter,m,g))}}_prepareDemTileUniforms(t,s,h,m){if(!s||s.demTexture==null)return!1;const g=t.tileID.canonical,x=Math.pow(2,s.tileID.canonical.z-g.z),I=m||"";return h[`u_dem_tl${I}`]=[g.x*x%1,g.y*x%1],h[`u_dem_scale${I}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const g=m.dem.tree.minimums[0];return g>0&&t++,h+g},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),m=new i.cL({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(m,{premultiply:!1}):g=this._emptyDEMTexture=new i.T(t,m,s.R32F,{premultiply:!1}),g}setupElevationDraw(t,s,h){const m=this.painter.context,g=m.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let I=null,P=null,z=1;if(h&&h.morphing&&this._useVertexMorphing){const j=h.morphing.srcDemTile,X=h.morphing.dstDemTile;z=h.morphing.phase,j&&X&&(this._prepareDemTileUniforms(t,j,x,"_prev")&&(P=j),this._prepareDemTileUniforms(t,X,x)&&(I=X))}const L=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST;let F=null;var B;if(this.enabled?P&&I?(F=I.demTexture,m.activeTexture.set(g.TEXTURE4),P.demTexture.bind(L(P),g.CLAMP_TO_EDGE),x.u_dem_lerp=z):(I=this.terrainTileForTile[t.tileID.key],F=this._prepareDemTileUniforms(t,I,x)?I.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,m.activeTexture.set(g.TEXTURE2),F&&(x.u_dem_size=(B=F).size[0]===1?1:B.size[0]-2,F.bind(L(I),g.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,s,x),h&&h.useMeterToDem&&I){const j=(1<<I.tileID.canonical.z)*i.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=j}if(h&&h.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(m,x),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,t.tileID.canonical,h&&h.useDenormalizedUpVectorScale);s.setGlobeUniformValues(m,j)}}globeUniformValues(t,s,h){const m=t.projection;return{u_tile_tl_up:m.upVector(s,0,0),u_tile_tr_up:m.upVector(s,i.ai,0),u_tile_br_up:m.upVector(s,i.ai,i.ai),u_tile_bl_up:m.upVector(s,0,i.ai),u_tile_up_scale:h?i.cM(1):m.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,g,x,I,P){if(m.transform.projection.name==="globe")(function(z,L,F,B,j){const X=z.context,q=X.gl;let J,Q;const oe=z.transform,ue=i.cD(z,X,oe),ce=(rt,nt)=>{if(Q===nt)return;const yt=[ba[nt],"PROJECTION_GLOBE_VIEW"];ue&&yt.push("CUSTOM_ANTIALIASING");const Oe=z.isTileAffectedByFog(rt);J=z.getOrCreateProgram("globeRaster",{defines:yt,overrideFog:Oe}),Q=nt},ye=z.colorModeForRenderPass(),pe=new Xt(q.LEQUAL,Xt.ReadWrite,z.depthRangeFor3D);xa.update(j);const ge=i.cE(oe),me=[i.av(oe.center.lng),i.aC(oe.center.lat)],we=z.globeSharedBuffers,Ee=[oe.width*i.q.devicePixelRatio,oe.height*i.q.devicePixelRatio],He=Float32Array.from(oe.globeMatrix),Be={useDenormalizedUpVectorScale:!0};{const rt=z.transform,nt=Df(rt.zoom,L.exaggeration(),L.sourceCache._source.tileSize);Q=-1;const yt=q.TRIANGLES;for(const Oe of B){const tt=F.getTile(Oe),ze=br.disabled,Qe=L.prevTerrainTileForTile[Oe.key],Ze=L.terrainTileForTile[Oe.key];Rf(Qe,Ze)&&xa.newMorphing(Oe.key,Qe,Ze,j,250),X.activeTexture.set(q.TEXTURE0),tt.texture&&tt.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const at=xa.getMorphValuesForProxy(Oe.key),$e=at?1:0;at&&i.L(Be,{morphing:{srcDemTile:at.from,dstDemTile:at.to,phase:i.cC(at.phase)}});const ut=i.cF(Oe.canonical),St=i.cG(ut.getCenter().lat),Mt=i.cH(Oe.canonical,ut,St,rt.worldSize/rt._pixelsPerMercatorPixel),Lt=i.bc(i.cI(Oe.canonical)),Wt=Pf(rt.expandedFarZProjMatrix,He,ge,Lt,i.ag(rt.zoom),me,rt.frustumCorners.TL,rt.frustumCorners.TR,rt.frustumCorners.BR,rt.frustumCorners.BL,rt.globeCenterInViewSpace,rt.globeRadius,Ee,nt,rt._farZ,Mt);if(ce(Oe,$e),J&&(L.setupElevationDraw(tt,J,Be),z.uploadCommonUniforms(X,J,Oe.toUnwrapped()),we)){const[pr,sr,mr]=we.getGridBuffers(St,nt!==0);J.draw(z,yt,pe,ze,ye,fr.backCCW,Wt,"globe_raster",pr,sr,mr)}}}if(we&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const rt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&rt.push("CUSTOM_ANTIALIASING"),J=z.getOrCreateProgram("globeRaster",{defines:rt});for(const nt of B){const{x:yt,y:Oe,z:tt}=nt.canonical,ze=Oe===0,Qe=Oe===(1<<tt)-1,[Ze,at,$e,ut]=we.getPoleBuffers(tt,!1);if(ut&&(ze||Qe)){const St=F.getTile(nt);X.activeTexture.set(q.TEXTURE0),St.texture&&St.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let Mt=i.cJ(tt,yt,oe);const Lt=i.bc(i.cI(nt.canonical)),Wt=(pr,sr)=>pr.draw(z,q.TRIANGLES,pe,br.disabled,ye,fr.disabled,Pf(oe.expandedFarZProjMatrix,Mt,Mt,Lt,0,me,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Ee,0,oe._farZ),"globe_pole_raster",sr,$e,ut);L.setupElevationDraw(St,J,Be),z.uploadCommonUniforms(X,J,nt.toUnwrapped()),ze&&z.renderDefaultNorthPole&&Wt(J,Ze),Qe&&z.renderDefaultSouthPole&&(Mt=i.ad.mat4.scale(i.ad.mat4.create(),Mt,[1,-1,1]),Wt(J,at))}}}})(m,g,x,I,P);else{const z=m.context,L=z.gl;let F,B;const j=m.shadowRenderer,X=ya(m,m.longestCutoffRange),q=ye=>{if(B===ye)return;const pe=[];pe.push(ba[ye]),X.shouldRenderCutoff&&pe.push("RENDER_CUTOFF"),j&&(pe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&pe.push("NORMAL_OFFSET")),F=m.getOrCreateProgram("terrainRaster",{defines:pe}),B=ye},J=m.colorModeForRenderPass(),Q=new Xt(L.LEQUAL,Xt.ReadWrite,m.depthRangeFor3D);xa.update(P);const oe=m.transform,ue=Df(oe.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let ce=[0,0,0];if(j){const ye=m.style.directionalLight,pe=m.style.ambientLight;ye&&pe&&(ce=Wo(m.style,ye,pe))}{B=-1;const ye=L.TRIANGLES,[pe,ge]=[g.gridIndexBuffer,g.gridSegments];for(const me of I){const we=x.getTile(me),Ee=br.disabled,He=g.prevTerrainTileForTile[me.key],Be=g.terrainTileForTile[me.key];Rf(He,Be)&&xa.newMorphing(me.key,He,Be,P,250),z.activeTexture.set(L.TEXTURE0),we.texture&&we.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const rt=xa.getMorphValuesForProxy(me.key),nt=rt?1:0;let yt;rt&&(yt={morphing:{srcDemTile:rt.from,dstDemTile:rt.to,phase:i.cC(rt.phase)}});const Oe=v_(me.projMatrix,wa(me.canonical,oe.renderWorldCopies)?ue/10:ue,ce);if(q(nt),!F)continue;g.setupElevationDraw(we,F,yt);const tt=me.toUnwrapped();j&&j.setupShadows(tt,F),m.uploadCommonUniforms(z,F,tt,null,X),F.draw(m,ye,Q,Ee,J,fr.backCCW,Oe,"terrain_raster",g.gridBuffer,pe,ge)}}}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,m=this.proxySourceCache,g=this.proxiedCoords[m.id],x=this._drapedRenderBatches.shift(),I=s.style.order,P=[];let z=0;for(const L of g){const F=m.getTileByID(L.proxyTileKey),B=m.proxyCachedFBO[L.key]?m.proxyCachedFBO[L.key][t]:void 0,j=B!==void 0?m.renderCache[B]:this.pool[z++],X=B!==void 0;if(F.texture=j.tex,X&&!j.dirty){P.push(F.tileID);continue}let q;h.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(h.clear({color:i.al.transparent,stencil:0}),j.dirty=!1);for(let J=x.start;J<=x.end;++J){const Q=s.style._mergedLayers[I[J]];if(Q.isHidden(s.transform.zoom))continue;const oe=s.style.getLayerSourceCache(Q),ue=oe?this.proxyToSource[L.key][oe.id]:[L];if(!ue)continue;const ce=ue;h.viewport.set([0,0,j.fb.width,j.fb.height]),q!==(oe?oe.id:null)&&(this._setupStencil(j,ue,Q,oe),q=oe?oe.id:null),s.renderLayer(s,oe,Q,ce)}if(this._drapedRenderBatches.length===0)for(const J of this._pendingGroundEffectLayers){const Q=s.style._mergedLayers[I[J]];if(Q.isHidden(s.transform.zoom))continue;const oe=s.style.getLayerSourceCache(Q),ue=oe?this.proxyToSource[L.key][oe.id]:[L];if(!ue)continue;const ce=ue;h.viewport.set([0,0,j.fb.width,j.fb.height]),q!==(oe?oe.id:null)&&(this._setupStencil(j,ue,Q,oe),q=oe?oe.id:null),s.renderLayer(s,oe,Q,ce)}this.renderedToTile?(j.dirty=!0,P.push(F.tileID)):X||--z,z===5&&(z=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let h=-1,m=s;for(let g=0;g<s;++g)this._style.isLayerDraped(t._mergedLayers[t.order[g]])?h=Math.max(h,g):m=Math.min(m,g);return m>h}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const x=g.tileID,I=1<<x.overscaledZ,{x:P,y:z}=x.canonical,L=P/I,F=(P+1)/I,B=z/I,j=(z+1)/I;return{minx:L,miny:B,maxx:F,maxy:j,t:g.dem.tree.raycastRoot(L,B,F,j,t,s,h),tile:g}});m.sort((g,x)=>(g.t!==null?g.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const g of m){if(g.t==null)return null;const x=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,s,h);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,s=t.gl,h=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new i.T(t,{width:h[0],height:h[1],data:null},s.RGBA8);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const g=t.createFramebuffer(h[0],h[1],!0,null);return g.colorAttachment.set(m.texture),g.depthAttachment=new zl(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._mergedLayers[t],h=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!h&&s.shouldRedrape():!h&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const h of this._style.getSources())if(h instanceof ji){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const m=this._style._mergedLayers[this._style.order[h]],g=this._style.getLayerSourceCache(m);if(g&&!s[g.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof i.ab){s[g.id]=!0;for(const x of this.proxyCoords){const I=this.proxyToSource[x.key][g.id];if(I)for(const P of I)this._clearRenderCacheForTile(g.id,P)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof ma){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const m=this._style._mergedLayers[this._style.order[h]],g=this._style.getLayerSourceCache(m);if(!g||s[g.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const x=m.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const P=this.proxyToSource[I.key][g.id];if(P)for(const z of P){const L=Ll(g.getTile(z),g.findLoadedParent(z,0),g,this.painter.transform,x);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(g.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const h=[];this._pendingGroundEffectLayers=[];let m,g=0,x=this._style._mergedLayers[t[g]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++g<s;)x=this._style._mergedLayers[t[g]];for(;g<s;++g){const I=this._style._mergedLayers[t[g]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?m===void 0&&(m=g):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),m!==void 0&&(h.push({start:m,end:g-1}),m=void 0)))}if(m!==void 0&&h.push({start:m,end:g-1}),h.length!==0){const I=h[h.length-1];this._pendingGroundEffectLayers.every(P=>P>I.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const x=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let I=0;I<x.length;++I){const P=Object.values(x[I]);s.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let x=h.length-1;x>=0;x--){const I=h[x];if(s.getTileByID(I.key),s.proxyCachedFBO[I.key]!==void 0){const P=t[I.key],z=this.proxyToSource[I.key];let L=0;for(const F in z){const B=z[F],j=P[F];if(!j||j.length!==B.length||B.some((X,q)=>X!==j[q]||m[F]&&m[F].hasOwnProperty(X.key))){L=-1;break}++L}for(const F in s.proxyCachedFBO[I.key])s.renderCache[s.proxyCachedFBO[I.key][F]].dirty=L<0||L!==Object.values(P).length}}const g=[...this._drapedRenderBatches];g.sort((x,I)=>I.end-I.start-(x.end-x.start));for(const x of g)for(const I of h){if(s.proxyCachedFBO[I.key])continue;let P=s.renderCachePool.pop();P===void 0&&s.renderCache.length<50&&(P=s.renderCache.length,s.renderCache.push(this._createFBO())),P!==void 0&&(s.proxyCachedFBO[I.key]={},s.proxyCachedFBO[I.key][x.start]=P,s.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,x=g.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let I;if(h.isTileClipped())I=s.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):br.disabled}_renderTileClippingMasks(t,s){const h=this.painter,m=this.painter.context,g=m.gl;h._tileClippingMaskIDs={},m.setColorMode(Dr.disabled),m.setDepthMode(Xt.disabled);const x=h.getOrCreateProgram("clippingMask");for(const I of t){const P=h._tileClippingMaskIDs[I.key]=--s;x.draw(h,g.TRIANGLES,Xt.disabled,new br({func:g.ALWAYS,mask:0},P,255,g.KEEP,g.KEEP,g.REPLACE),Dr.disabled,fr.disabled,Kc(I.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const h=[t.x,t.y,1,1];i.ad.vec4.transformMat4(h,h,s.pixelMatrixInverse),i.ad.vec4.scale(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const m=s._camera.position,g=i.bH(1,s.center.lat),x=[m[0],m[1],m[2]/g,0],I=i.ad.vec3.subtract([],h.slice(0,3),x);i.ad.vec3.normalize(I,I);const P=this.raycast(x,I,this._exaggeration);return P!==null&&P?(i.ad.vec3.scaleAndAdd(x,x,I,P),x[3]=x[2],x[2]*=g,x):null}_setupProxiedCoordsForOrtho(t,s,h){if(t.getSource()instanceof i.aK)return this._setupProxiedCoordsForImageSource(t,s,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let P=0;P<g.length;P++){const z=g[P],L=this._findTileCoveringTileID(z,t);if(L){const F=this._createProxiedId(z,L,h[z.key]&&h[z.key][t.id]);m.push(F),this.proxyToSource[z.key][t.id]=[F]}}let x=!1;const I=new Set;for(let P=0;P<s.length;P++){const z=t.getTile(s[P]);if(!z||!z.hasData())continue;const L=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==z.tileID.canonical.z){const F=this.proxyToSource[L.tileID.key][t.id],B=this._createProxiedId(L.tileID,z,h[L.tileID.key]&&h[L.tileID.key][t.id]);F?F.splice(F.length-1,0,B):this.proxyToSource[L.tileID.key][t.id]=[B];const j=this.proxyToSource[L.tileID.key][t.id];I.has(j)||I.add(j),m.push(B),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const P of I)P.sort((z,L)=>L.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(t,s,h){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords,x=t.getSource(),I=x.tileID;if(!I)return;const P=new i.P(I.x,I.y)._div(1<<I.z),z=x.coordinates.map(i.ac.fromLngLat).reduce((F,B)=>(F.min.x=Math.min(F.min.x,B.x-P.x),F.min.y=Math.min(F.min.y,B.y-P.y),F.max.x=Math.max(F.max.x,B.x-P.x),F.max.y=Math.max(F.max.y,B.y-P.y),F),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(F,B)=>{const j=F.wrap+F.canonical.x/(1<<F.canonical.z),X=F.canonical.y/(1<<F.canonical.z),q=i.ai/(1<<F.canonical.z),J=B.wrap+B.canonical.x/(1<<B.canonical.z),Q=B.canonical.y/(1<<B.canonical.z);return j+q<J+z.min.x||j>J+z.max.x||X+q<Q+z.min.y||X>Q+z.max.y};for(let F=0;F<g.length;F++){const B=g[F];for(let j=0;j<s.length;j++){const X=t.getTile(s[j]);if(!X||!X.hasData()||L(B,X.tileID))continue;const q=this._createProxiedId(B,X,h[B.key]&&h[B.key][t.id]),J=this.proxyToSource[B.key][t.id];J?J.push(q):this.proxyToSource[B.key][t.id]=[q],m.push(q)}}}_createProxiedId(t,s,h){let m=this.orthoMatrix;if(h){const g=h.find(x=>x.key===s.tileID.key);if(g)return g}if(s.tileID.key!==t.key){const g=t.canonical.z-s.tileID.canonical.z;let x,I,P;m=i.ad.mat4.create();const z=s.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(x=i.ai>>g,I=x*((s.tileID.canonical.x<<g)-t.canonical.x+z),P=x*((s.tileID.canonical.y<<g)-t.canonical.y)):(x=i.ai<<-g,I=i.ai*(s.tileID.canonical.x-(t.canonical.x+z<<-g)),P=i.ai*(s.tileID.canonical.y-(t.canonical.y<<-g))),i.ad.mat4.ortho(m,0,x,0,x,0,1),i.ad.mat4.translate(m,m,[I,P,0])}return new bh(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let h=s.getTile(t);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[s.id],g=m[t.key];if(h=g?s.getTileByID(g):null,h&&h.hasData()||g===null)return h;let x=h?h.tileID:t,I=x.overscaledZ;const P=s.getSource().minzoom,z=[];if(!g){const F=s.getSource().maxzoom;if(t.canonical.z>=F){const B=t.canonical.z-F;s.getSource().reparseOverscaled?(I=Math.max(t.canonical.z+2,s.transform.tileZoom),x=new i.aH(I,t.wrap,F,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(I=F,x=new i.aH(I,t.wrap,F,t.canonical.x>>B,t.canonical.y>>B))}x.key!==t.key&&(z.push(x.key),h=s.getTile(x))}const L=F=>{z.forEach(B=>{m[B]=F}),z.length=0};for(I-=1;I>=P&&(!h||!h.hasData());I--){h&&L(h.tileID.key);const F=x.calculateScaledKey(I);if(h=s.getTileByID(F),h&&h.hasData())break;const B=m[F];if(B===null)break;B===void 0?z.push(F):h=s.getTileByID(B)}return L(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[s.key]=!0}}function P0(d,t,s){const h=function(I,P,z){const L=i.ad.vec3.dot(P,I),F=i.ad.vec3.dot(z,[.2126,.7152,.0722]),B=(X,q,J)=>(1-J)*X+J*q,j=B(1-.3*Math.min(F,1),1,Math.min(L+1,1));return B(.92,1,Math.asin(i.ay(P[2],-1,1))/Math.PI+.5)*j}(d,[0,0,1],t),m=[0,0,0];i.ad.vec3.scale(m,s.slice(0,3),h);const g=[0,0,0];i.ad.vec3.scale(g,t.slice(0,3),d[2]);const x=[0,0,0];return i.ad.vec3.add(x,m,g),i.cg(x)}const w_=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Yc=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class T_{static cacheKey(t,s,h,m){let g=`${s}${m?m.cacheKey:""}`;for(const x of h)t.usedDefines.includes(x)&&(g+=`/${x}`);return g}constructor(t,s,h,m,g,x){const I=t.gl;this.program=I.createProgram(),this.configuration=m,this.name=s,this.fixedDefines=[...x];const P=m?m.getBinderAttributes():[],z=(h.staticAttributes||[]).concat(P);let L=m?m.defines():[];L=L.concat(x.map(J=>`#define ${J}`));const F=`#version 300 es
`;let B=F+L.concat("precision mediump float;",gf,ph.fragmentSource).join(`
`);for(const J of h.fragmentIncludes)B+=`
${Zo[J]}`;B+=`
${h.fragmentSource}`;let j=F+L.concat("precision highp float;",gf,ph.vertexSource).join(`
`);for(const J of h.vertexIncludes)j+=`
${Zo[J]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&h.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(j+=`
uniform int u_instanceID;
`),j+=`
${h.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(j=j.replaceAll("gl_InstanceID","u_instanceID"));const X=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(X,B),I.compileShader(X),I.attachShader(this.program,X);const q=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(q,j),I.compileShader(q),I.attachShader(this.program,q),this.attributes={},this.numAttributes=z.length;for(let J=0;J<this.numAttributes;J++)if(z[J]){const Q=z[J].startsWith("a_")?z[J]:`a_${z[J]}`;I.bindAttribLocation(this.program,J,Q),this.attributes[Q]=J}I.linkProgram(this.program),I.deleteShader(q),I.deleteShader(X),this.fixedUniforms=g(t),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(J=>({u_instanceID:new i.bN(J)}))(t)),(x.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(J=>({u_dem:new i.bN(J),u_dem_prev:new i.bN(J),u_dem_tl:new i.bK(J),u_dem_scale:new i.bM(J),u_dem_tl_prev:new i.bK(J),u_dem_scale_prev:new i.bM(J),u_dem_size:new i.bM(J),u_dem_lerp:new i.bM(J),u_exaggeration:new i.bM(J),u_depth:new i.bN(J),u_depth_size_inv:new i.bK(J),u_depth_range_unpack:new i.bK(J),u_occluder_half_size:new i.bM(J),u_occlusion_depth_offset:new i.bM(J),u_meter_to_dem:new i.bM(J),u_label_plane_matrix_inv:new i.bJ(J)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new i.bL(J),u_tile_tr_up:new i.bL(J),u_tile_br_up:new i.bL(J),u_tile_bl_up:new i.bL(J),u_tile_up_scale:new i.bM(J)}))(t)),x.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new i.bJ(J),u_fog_range:new i.bK(J),u_fog_color:new i.cb(J),u_fog_horizon_blend:new i.bM(J),u_fog_vertical_limit:new i.bK(J),u_fog_temporal_offset:new i.bM(J),u_frustum_tl:new i.bL(J),u_frustum_tr:new i.bL(J),u_frustum_br:new i.bL(J),u_frustum_bl:new i.bL(J),u_globe_pos:new i.bL(J),u_globe_radius:new i.bM(J),u_globe_transition:new i.bM(J),u_is_globe:new i.bN(J),u_viewport:new i.bK(J)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new i.cb(J)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new i.bL(J),u_lighting_directional_dir:new i.bL(J),u_lighting_directional_color:new i.bL(J),u_ground_radiance:new i.bL(J)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new i.bJ(J),u_light_matrix_1:new i.bJ(J),u_fade_range:new i.bK(J),u_shadow_normal_offset:new i.bL(J),u_shadow_intensity:new i.bM(J),u_shadow_texel_size:new i.bM(J),u_shadow_map_resolution:new i.bM(J),u_shadow_direction:new i.bL(J),u_shadow_bias:new i.bL(J),u_shadowmap_0:new i.bN(J),u_shadowmap_1:new i.bN(J)}))(t))}}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m]&&h[m].set(this.program,m,s[m])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m]&&h[m].set(this.program,m,s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}_drawDebugWireframe(t,s,h,m,g,x,I,P,z,L){const F=t.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const B=t.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||t._terrain&&t._terrain.renderingToTexture||!w_.includes(this.name))||!(!F.layers3D||!Yc.includes(this.name))))return;const j=B.gl,X=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,g,B);if(!X)return;const q=[...this.fixedDefines];q.push("DEBUG_WIREFRAME");const J=t.getOrCreateProgram(this.name,{config:this.configuration,defines:q});B.program.set(J.program);const Q=(ce,ye,pe)=>{if(ye[ce]&&pe[ce])for(const ge in ye[ce])pe[ce][ge]&&pe[ce][ge].set(pe.program,ge,ye[ce][ge].current)};z&&z.setUniforms(J.program,B,J.binderUniforms,I,{zoom:P}),Q("fixedUniforms",this,J),Q("terrainUniforms",this,J),Q("globeUniforms",this,J),Q("fogUniforms",this,J),Q("lightsUniforms",this,J),Q("shadowUniforms",this,J),X.bind(),B.setColorMode(new Dr([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],i.al.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Xt(s.func===j.LESS?j.LEQUAL:s.func,Xt.ReadOnly,s.range)),B.setStencilMode(br.disabled);const oe=3*x.primitiveLength*2,ue=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=L||1;for(let ye=0;ye<ce;++ye)J.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),j.drawElements(j.LINES,oe,j.UNSIGNED_SHORT,ue)}else L&&L>1?j.drawElementsInstanced(j.LINES,oe,j.UNSIGNED_SHORT,ue,L):j.drawElements(j.LINES,oe,j.UNSIGNED_SHORT,ue);g.bind(),B.program.set(this.program),B.setDepthMode(s),B.setStencilMode(h),B.setColorMode(m)}checkUniforms(t,s,h){if(this.fixedDefines.includes(s)){for(const m of Object.keys(h))if(!h[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${s} being defined`)}}draw(t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J){const Q=t.context,oe=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(h),Q.setStencilMode(m),Q.setColorMode(g),Q.setCullFace(x);for(const ye of Object.keys(this.fixedUniforms))this.fixedUniforms[ye].set(this.program,ye,I[ye]);X&&X.setUniforms(this.program,Q,this.binderUniforms,B,{zoom:j});const ue={[oe.POINTS]:1,[oe.LINES]:2,[oe.TRIANGLES]:3,[oe.LINE_STRIP]:1}[s];this.checkUniforms(P,"RENDER_SHADOWS",this.shadowUniforms);const ce=J&&J>0?1:void 0;for(const ye of F.get()){const pe=ye.vaos||(ye.vaos={});if((pe[P]||(pe[P]=new c_)).bind(Q,this,z,X?X.getPaintVertexBuffers():[],L,ye.vertexOffset,q||[],ce),this.forceManualRenderingForInstanceIDShaders){const ge=J||1;for(let me=0;me<ge;++me)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",me),L?oe.drawElements(s,ye.primitiveLength*ue,oe.UNSIGNED_SHORT,ye.primitiveOffset*ue*2):oe.drawArrays(s,ye.vertexOffset,ye.vertexLength)}else J&&J>1?oe.drawElementsInstanced(s,ye.primitiveLength*ue,oe.UNSIGNED_SHORT,ye.primitiveOffset*ue*2,J):L?oe.drawElements(s,ye.primitiveLength*ue,oe.UNSIGNED_SHORT,ye.primitiveOffset*ue*2):oe.drawArrays(s,ye.vertexOffset,ye.vertexLength);s===oe.TRIANGLES&&L&&this._drawDebugWireframe(t,h,m,g,L,ye,B,j,X,J)}}}function S_(d,t){const s=Math.pow(2,t.tileID.overscaledZ),h=t.tileSize*Math.pow(2,d.transform.tileZoom)/s,m=h*(t.tileID.canonical.x+t.tileID.wrap*s),g=h*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.at(t,1,d.transform.tileZoom),u_pixel_coord_upper:[m>>16,g>>16],u_pixel_coord_lower:[65535&m,65535&g]}}const Jc={terrain:0,flat:1},R0=i.ad.mat4.create(),Th=(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q)=>{const oe=t.style.light,ue=oe.properties.get("position"),ce=[ue.x,ue.y,ue.z],ye=i.ad.mat3.create();oe.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(ye,-t.transform.angle),i.ad.vec3.transformMat3(ce,ce,ye));const pe=oe.properties.get("color"),ge=t.transform,me={u_matrix:d,u_lightpos:ce,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:R0,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Jc[z],u_base_type:Jc[L],u_ao:m,u_edge_radius:g,u_width_scale:x,u_flood_light_color:X,u_vertical_scale:q,u_flood_light_intensity:J,u_ground_shadow_factor:Q};return ge.projection.name==="globe"&&(me.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],me.u_zoom_transition=F,me.u_inv_rot_matrix=j,me.u_merc_center=B,me.u_up_dir=ge.projection.upVector(new i.bT(0,0,0),B[0]*i.ai,B[1]*i.ai),me.u_height_lift=P),me},zf=(d,t,s,h,m,g)=>({u_matrix:d,u_edge_radius:t,u_width_scale:s,u_vertical_scale:h,u_height_type:Jc[m],u_base_type:Jc[g]}),Ol=(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J)=>{const Q=Th(d,t,s,h,m,g,x,I,z,L,F,B,j,X,q,J,1,[0,0,0]),oe={u_height_factor:-Math.pow(2,I.overscaledZ)/P.tileSize/8};return i.l(Q,S_(t,P),oe)},Sh=(d,t)=>({u_matrix:d,u_emissive_strength:t}),kl=(d,t,s,h)=>i.l(Sh(d,t),S_(s,h)),E_=(d,t,s)=>({u_matrix:d,u_world:s,u_emissive_strength:t}),Eh=(d,t,s,h,m)=>i.l(kl(d,t,s,h),{u_world:m}),Fl=(d,t,s,h,m)=>({u_matrix:d,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:h,u_reset_depth:m}),Lf=(d,t,s,h)=>{const m=i.ai/s.tileSize;return{u_matrix:d,u_camera_to_center_distance:t.getCameraToCenterDistance(h),u_extrude_scale:[t.pixelsToGLUnits[0]/m,t.pixelsToGLUnits[1]/m]}},Of=(d,t,s=1)=>({u_matrix:d,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),D0=i.ad.mat4.create(),Bl=(d,t,s,h,m,g,x)=>{const I=d.transform,P=I.projection.name==="globe",z=P?i.cO(I.zoom,t.canonical)*I._pixelsPerMercatorPixel:i.at(s,1,g),L={u_matrix:t.projMatrix,u_extrude_scale:z,u_intensity:x,u_inv_rot_matrix:D0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){L.u_inv_rot_matrix=h,L.u_merc_center=m,L.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],L.u_zoom_transition=i.ag(I.zoom);const F=m[0]*i.ai,B=m[1]*i.ai;L.u_up_dir=I.projection.upVector(new i.bT(0,0,0),F,B)}return L};function Qc(d,[t,s,h,m],[g,x]){if(g===x)return[0,0,0,0];const I=255*(d-1)/(d*(x-g));return[t*I,s*I,h*I,m*I]}function Ft(d,t,[s,h]){return s===h?0:.5/d+(t-s)*(d-1)/(d*(h-s))}const kf=(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe,ue,ce)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:z,u_fade_t:L.mix,u_opacity:L.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:i.cP(F.paint.get("raster-saturation")),u_contrast_factor:i.cQ(F.paint.get("raster-contrast")),u_spin_weights:A_(F.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:j,u_zoom_transition:x,u_merc_center:I,u_cutoff_params:P,u_colorization_mix:Qc(i.cR,q,Q),u_colorization_offset:Ft(i.cR,J,Q),u_color_ramp:X,u_texture_offset:[ue/(oe+2*ue),oe/(oe+2*ue)],u_texture_res:[oe+2*ue,oe+2*ue],u_emissive_strength:ce});function A_(d){d*=Math.PI/180;const t=Math.sin(d),s=Math.cos(d);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const As=.05,Ta=(d,t,s,h,m,g,x,I,P,z,L,F)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:z,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:x,u_merc_center:I,u_cutoff_params:P}),er=(d,t,s,h,m,g,x,I,P,z)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:h,u_color_ramp:g,u_velocity_res:m,u_max_speed:x,u_uv_offset:I,u_data_scale:[255*P[0],255*P[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[As,As]}),Ff=(d,t,s,h,m,g,x,I,P,z)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:h,u_max_speed:m,u_speed_factor:g,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*P[0],255*P[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[As,As]}),M_=i.ad.mat4.create(),I_=(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe,ue,ce,ye)=>{const pe=m.transform,ge={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:pe.getCameraToCenterDistance(oe),u_rotate_symbol:+s,u_aspect_ratio:pe.width/pe.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:I,u_is_text:+z,u_elevation_from_sea:P?1:0,u_pitch_with_map:+h,u_texsize:L,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:M_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:M_,u_up_vector:[0,-1,0],u_color_adj_mat:ue,u_icon_transition:ce||0,u_gamma_scale:h?m.transform.getCameraToCenterDistance(oe)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:ye||1};return oe.name==="globe"&&(ge.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],ge.u_zoom_transition=X,ge.u_inv_rot_matrix=J,ge.u_merc_center=q,ge.u_camera_forward=pe._camera.forward(),ge.u_ecef_origin=i.cS(pe.globeMatrix,j.toUnwrapped()),ge.u_tile_matrix=Float32Array.from(pe.globeMatrix),ge.u_up_vector=Q),ge},Ah=(d,t,s,h)=>({u_matrix:d,u_emissive_strength:t,u_opacity:s,u_color:h}),Bf=(d,t,s,h,m,g,x,I,P)=>i.l(function(z,L,F,B,j,X){const{width:q,height:J}=B.imageManager.getPixelSize(L),Q=Math.pow(2,X.tileID.overscaledZ),oe=X.tileSize*Math.pow(2,B.transform.tileZoom)/Q,ue=oe*(X.tileID.canonical.x+X.tileID.wrap*Q),ce=oe*X.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[q,J],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:j?[B.transform.width,-1*B.transform.height]:[1/i.at(X,1,B.transform.tileZoom),1/i.at(X,1,B.transform.tileZoom)],u_pixel_coord_upper:[ue>>16,ce>>16],u_pixel_coord_lower:[65535&ue,65535&ce]}}(0,g,x,h,I,P),{u_matrix:d,u_emissive_strength:t,u_opacity:s}),Nf=new Float32Array(i.ad.mat4.identity([])),Mh=(d,t,s,h,m,g,x,I,P,z,L,F,B,j=[0,0,0],X)=>{const q=m.style.light,J=q.properties.get("position"),Q=[-J.x,-J.y,J.z],oe=i.ad.mat3.create();q.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(oe,-m.transform.angle),i.ad.vec3.transformMat3(Q,Q,oe));const ue=L.alphaMode==="MASK",ce=q.properties.get("color").toRenderColor(null),ye=B.paint.get("model-ambient-occlusion-intensity"),pe=B.paint.get("model-color").constantOr(i.al.white).toRenderColor(null),ge=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:h||Nf,u_lightpos:Q,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:j,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+ue,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:P,u_roughnessFactor:z,u_baseColorTexture:zi.BaseColor,u_metallicRoughnessTexture:zi.MetallicRoughness,u_normalTexture:zi.Normal,u_occlusionTexture:zi.Occlusion,u_emissionTexture:zi.Emission,u_lutTexture:zi.LUT,u_color_mix:[pe.r,pe.g,pe.b,ge],u_aoIntensity:ye,u_emissive_strength:F,u_occlusionTextureTransform:X||[0,0,0,0]}},C_=(d,t=Nf,s=Nf)=>({u_matrix:d,u_instance:t,u_node_matrix:s}),z0={fillExtrusion:d=>({u_matrix:new i.bJ(d),u_lightpos:new i.bL(d),u_lightintensity:new i.bM(d),u_lightcolor:new i.bL(d),u_vertical_gradient:new i.bM(d),u_opacity:new i.bM(d),u_edge_radius:new i.bM(d),u_width_scale:new i.bM(d),u_ao:new i.bK(d),u_height_type:new i.bN(d),u_base_type:new i.bN(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_up_dir:new i.bL(d),u_height_lift:new i.bM(d),u_flood_light_color:new i.bL(d),u_vertical_scale:new i.bM(d),u_flood_light_intensity:new i.bM(d),u_ground_shadow_factor:new i.bL(d)}),fillExtrusionDepth:d=>({u_matrix:new i.bJ(d),u_edge_radius:new i.bM(d),u_width_scale:new i.bM(d),u_vertical_scale:new i.bM(d),u_height_type:new i.bN(d),u_base_type:new i.bN(d)}),fillExtrusionPattern:d=>({u_matrix:new i.bJ(d),u_lightpos:new i.bL(d),u_lightintensity:new i.bM(d),u_lightcolor:new i.bL(d),u_vertical_gradient:new i.bM(d),u_height_factor:new i.bM(d),u_edge_radius:new i.bM(d),u_width_scale:new i.bM(d),u_ao:new i.bK(d),u_height_type:new i.bN(d),u_base_type:new i.bN(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_up_dir:new i.bL(d),u_height_lift:new i.bM(d),u_image:new i.bN(d),u_texsize:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_tile_units_to_pixels:new i.bM(d),u_opacity:new i.bM(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new i.bJ(d),u_opacity:new i.bM(d),u_ao_pass:new i.bM(d),u_meter_to_tile:new i.bM(d),u_ao:new i.bK(d),u_flood_light_intensity:new i.bM(d),u_flood_light_color:new i.bL(d),u_attenuation:new i.bM(d),u_edge_radius:new i.bM(d),u_fb:new i.bN(d),u_fb_size:new i.bM(d),u_dynamic_offset:new i.bM(d)}),fill:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d)}),fillPattern:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_image:new i.bN(d),u_texsize:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_tile_units_to_pixels:new i.bM(d)}),fillOutline:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_world:new i.bK(d)}),fillOutlinePattern:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_world:new i.bK(d),u_image:new i.bN(d),u_texsize:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_tile_units_to_pixels:new i.bM(d)}),elevatedStructures:d=>({u_matrix:new i.bJ(d)}),elevatedStructuresDepthReconstruct:d=>({u_matrix:new i.bJ(d),u_camera_pos:new i.bL(d),u_depth_bias:new i.bM(d),u_height_scale:new i.bM(d),u_reset_depth:new i.bM(d)}),circle:i.cT,collisionBox:d=>({u_matrix:new i.bJ(d),u_camera_to_center_distance:new i.bM(d),u_extrude_scale:new i.bK(d)}),collisionCircle:d=>({u_matrix:new i.bJ(d),u_inv_matrix:new i.bJ(d),u_camera_to_center_distance:new i.bM(d),u_viewport_size:new i.bK(d)}),debug:d=>({u_color:new i.cA(d),u_matrix:new i.bJ(d),u_overlay:new i.bN(d),u_overlay_scale:new i.bM(d)}),clippingMask:d=>({u_matrix:new i.bJ(d)}),heatmap:d=>({u_extrude_scale:new i.bM(d),u_intensity:new i.bM(d),u_matrix:new i.bJ(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_up_dir:new i.bL(d)}),heatmapTexture:d=>({u_image:new i.bN(d),u_color_ramp:new i.bN(d),u_opacity:new i.bM(d)}),hillshade:d=>({u_matrix:new i.bJ(d),u_image:new i.bN(d),u_latrange:new i.bK(d),u_light:new i.bK(d),u_shadow:new i.cA(d),u_highlight:new i.cA(d),u_emissive_strength:new i.bM(d),u_accent:new i.cA(d)}),hillshadePrepare:d=>({u_matrix:new i.bJ(d),u_image:new i.bN(d),u_dimension:new i.bK(d),u_zoom:new i.bM(d)}),line:i.cU,linePattern:i.cV,raster:d=>({u_matrix:new i.bJ(d),u_normalize_matrix:new i.bJ(d),u_globe_matrix:new i.bJ(d),u_merc_matrix:new i.bJ(d),u_grid_matrix:new i.cB(d),u_tl_parent:new i.bK(d),u_scale_parent:new i.bM(d),u_fade_t:new i.bM(d),u_opacity:new i.bM(d),u_image0:new i.bN(d),u_image1:new i.bN(d),u_brightness_low:new i.bM(d),u_brightness_high:new i.bM(d),u_saturation_factor:new i.bM(d),u_contrast_factor:new i.bM(d),u_spin_weights:new i.bL(d),u_perspective_transform:new i.bK(d),u_raster_elevation:new i.bM(d),u_zoom_transition:new i.bM(d),u_merc_center:new i.bK(d),u_cutoff_params:new i.cb(d),u_colorization_mix:new i.cb(d),u_colorization_offset:new i.bM(d),u_color_ramp:new i.bN(d),u_texture_offset:new i.bK(d),u_texture_res:new i.bK(d),u_emissive_strength:new i.bM(d)}),rasterParticle:d=>({u_matrix:new i.bJ(d),u_normalize_matrix:new i.bJ(d),u_globe_matrix:new i.bJ(d),u_merc_matrix:new i.bJ(d),u_grid_matrix:new i.cB(d),u_tl_parent:new i.bK(d),u_scale_parent:new i.bM(d),u_fade_t:new i.bM(d),u_opacity:new i.bM(d),u_image0:new i.bN(d),u_image1:new i.bN(d),u_raster_elevation:new i.bM(d),u_zoom_transition:new i.bM(d),u_merc_center:new i.bK(d),u_cutoff_params:new i.cb(d)}),rasterParticleTexture:d=>({u_texture:new i.bN(d),u_opacity:new i.bM(d)}),rasterParticleDraw:d=>({u_particle_texture:new i.bN(d),u_particle_texture_side_len:new i.bM(d),u_tile_offset:new i.bK(d),u_velocity:new i.bN(d),u_color_ramp:new i.bN(d),u_velocity_res:new i.bK(d),u_max_speed:new i.bM(d),u_uv_offset:new i.bK(d),u_data_scale:new i.bK(d),u_data_offset:new i.bM(d),u_particle_pos_scale:new i.bM(d),u_particle_pos_offset:new i.bK(d)}),rasterParticleUpdate:d=>({u_particle_texture:new i.bN(d),u_particle_texture_side_len:new i.bM(d),u_velocity:new i.bN(d),u_velocity_res:new i.bK(d),u_max_speed:new i.bM(d),u_speed_factor:new i.bM(d),u_reset_rate:new i.bM(d),u_rand_seed:new i.bM(d),u_uv_offset:new i.bK(d),u_data_scale:new i.bK(d),u_data_offset:new i.bM(d),u_particle_pos_scale:new i.bM(d),u_particle_pos_offset:new i.bK(d)}),symbol:d=>({u_is_size_zoom_constant:new i.bN(d),u_is_size_feature_constant:new i.bN(d),u_size_t:new i.bM(d),u_size:new i.bM(d),u_camera_to_center_distance:new i.bM(d),u_rotate_symbol:new i.bN(d),u_aspect_ratio:new i.bM(d),u_fade_change:new i.bM(d),u_matrix:new i.bJ(d),u_label_plane_matrix:new i.bJ(d),u_coord_matrix:new i.bJ(d),u_is_text:new i.bN(d),u_elevation_from_sea:new i.bN(d),u_pitch_with_map:new i.bN(d),u_texsize:new i.bK(d),u_texsize_icon:new i.bK(d),u_texture:new i.bN(d),u_texture_icon:new i.bN(d),u_gamma_scale:new i.bM(d),u_device_pixel_ratio:new i.bM(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_camera_forward:new i.bL(d),u_tile_matrix:new i.bJ(d),u_up_vector:new i.bL(d),u_ecef_origin:new i.bL(d),u_is_halo:new i.bN(d),u_icon_transition:new i.bM(d),u_color_adj_mat:new i.bJ(d),u_scale_factor:new i.bM(d)}),background:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_opacity:new i.bM(d),u_color:new i.cA(d)}),backgroundPattern:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_opacity:new i.bM(d),u_image:new i.bN(d),u_pattern_tl:new i.bK(d),u_pattern_br:new i.bK(d),u_texsize:new i.bK(d),u_pattern_size:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_pattern_units_to_pixels:new i.bK(d)}),terrainRaster:d=>({u_matrix:new i.bJ(d),u_image0:new i.bN(d),u_skirt_height:new i.bM(d),u_ground_shadow_factor:new i.bL(d)}),skybox:d=>({u_matrix:new i.bJ(d),u_sun_direction:new i.bL(d),u_cubemap:new i.bN(d),u_opacity:new i.bM(d),u_temporal_offset:new i.bM(d)}),skyboxGradient:d=>({u_matrix:new i.bJ(d),u_color_ramp:new i.bN(d),u_center_direction:new i.bL(d),u_radius:new i.bM(d),u_opacity:new i.bM(d),u_temporal_offset:new i.bM(d)}),skyboxCapture:d=>({u_matrix_3f:new i.cB(d),u_sun_direction:new i.bL(d),u_sun_intensity:new i.bM(d),u_color_tint_r:new i.cb(d),u_color_tint_m:new i.cb(d),u_luminance:new i.bM(d)}),globeRaster:d=>({u_proj_matrix:new i.bJ(d),u_globe_matrix:new i.bJ(d),u_normalize_matrix:new i.bJ(d),u_merc_matrix:new i.bJ(d),u_zoom_transition:new i.bM(d),u_merc_center:new i.bK(d),u_image0:new i.bN(d),u_grid_matrix:new i.cB(d),u_skirt_height:new i.bM(d),u_far_z_cutoff:new i.bM(d),u_frustum_tl:new i.bL(d),u_frustum_tr:new i.bL(d),u_frustum_br:new i.bL(d),u_frustum_bl:new i.bL(d),u_globe_pos:new i.bL(d),u_globe_radius:new i.bM(d),u_viewport:new i.bK(d)}),globeAtmosphere:d=>({u_frustum_tl:new i.bL(d),u_frustum_tr:new i.bL(d),u_frustum_br:new i.bL(d),u_frustum_bl:new i.bL(d),u_horizon:new i.bM(d),u_transition:new i.bM(d),u_fadeout_range:new i.bM(d),u_color:new i.cb(d),u_high_color:new i.cb(d),u_space_color:new i.cb(d),u_temporal_offset:new i.bM(d),u_horizon_angle:new i.bM(d)}),model:d=>({u_matrix:new i.bJ(d),u_lighting_matrix:new i.bJ(d),u_normal_matrix:new i.bJ(d),u_node_matrix:new i.bJ(d),u_lightpos:new i.bL(d),u_lightintensity:new i.bM(d),u_lightcolor:new i.bL(d),u_camera_pos:new i.bL(d),u_opacity:new i.bM(d),u_baseColorFactor:new i.cb(d),u_emissiveFactor:new i.cb(d),u_metallicFactor:new i.bM(d),u_roughnessFactor:new i.bM(d),u_baseTextureIsAlpha:new i.bN(d),u_alphaMask:new i.bN(d),u_alphaCutoff:new i.bM(d),u_baseColorTexture:new i.bN(d),u_metallicRoughnessTexture:new i.bN(d),u_normalTexture:new i.bN(d),u_occlusionTexture:new i.bN(d),u_emissionTexture:new i.bN(d),u_lutTexture:new i.bN(d),u_color_mix:new i.cb(d),u_aoIntensity:new i.bM(d),u_emissive_strength:new i.bM(d),u_occlusionTextureTransform:new i.cb(d)}),modelDepth:d=>({u_matrix:new i.bJ(d),u_instance:new i.bJ(d),u_node_matrix:new i.bJ(d)}),groundShadow:d=>({u_matrix:new i.bJ(d),u_ground_shadow_factor:new i.bL(d)}),stars:d=>({u_matrix:new i.bJ(d),u_up:new i.bL(d),u_right:new i.bL(d),u_intensity_multiplier:new i.bM(d)}),snowParticle:d=>({u_modelview:new i.bJ(d),u_projection:new i.bJ(d),u_time:new i.bM(d),u_cam_pos:new i.bL(d),u_velocityConeAperture:new i.bM(d),u_velocity:new i.bM(d),u_horizontalOscillationRadius:new i.bM(d),u_horizontalOscillationRate:new i.bM(d),u_boxSize:new i.bM(d),u_billboardSize:new i.bM(d),u_simpleShapeParameters:new i.bK(d),u_screenSize:new i.bK(d),u_thinningCenterPos:new i.bK(d),u_thinningShape:new i.bL(d),u_thinningAffectedRatio:new i.bM(d),u_thinningParticleOffset:new i.bM(d),u_particleColor:new i.cb(d),u_direction:new i.bL(d)}),rainParticle:d=>({u_modelview:new i.bJ(d),u_projection:new i.bJ(d),u_time:new i.bM(d),u_cam_pos:new i.bL(d),u_texScreen:new i.bN(d),u_velocityConeAperture:new i.bM(d),u_velocity:new i.bM(d),u_boxSize:new i.bM(d),u_rainDropletSize:new i.bK(d),u_distortionStrength:new i.bM(d),u_rainDirection:new i.bL(d),u_color:new i.cb(d),u_screenSize:new i.bK(d),u_thinningCenterPos:new i.bK(d),u_thinningShape:new i.bL(d),u_thinningAffectedRatio:new i.bM(d),u_thinningParticleOffset:new i.bM(d),u_shapeDirectionalPower:new i.bM(d),u_shapeNormalPower:new i.bM(d),u_mode:new i.bM(d)}),vignette:d=>({u_vignetteShape:new i.bL(d),u_vignetteColor:new i.cb(d)}),occlusion:d=>({u_matrix:new i.bJ(d),u_anchorPos:new i.bL(d),u_screenSizePx:new i.bK(d),u_occluderSizePx:new i.bK(d),u_color:new i.cb(d)})};class Io{constructor(t,s,h,m){this.id=Io.uniqueIdxCounter,Io.uniqueIdxCounter++,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||m||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Io.uniqueIdxCounter,Io.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Io.uniqueIdxCounter=0;const Vf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Uf{constructor(t,s,h,m,g,x){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.instanceCount=x,this.context=t;const I=t.gl;this.buffer=I.createBuffer(),t.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||g||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let h=0;h<this.attributes.length;h++){const m=s.attributes[this.attributes[h].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,h){for(let m=0;m<this.attributes.length;m++){const g=this.attributes[m],x=s.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[Vf[g.type]],!1,this.itemSize,g.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(t,s,h){for(let m=0;m<this.attributes.length;m++){const g=s.attributes[this.attributes[m].name];g!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(g,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ih{constructor(t,s,h,m,g){this.context=t,this.width=s,this.height=h;const x=this.framebuffer=t.gl.createFramebuffer();m&&(this.colorAttachment=new Cf(t,x)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new xh(t,x):new y_(t,x))}destroy(){const t=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class cs{constructor(t,s){this.gl=t,this.clearColor=new w0(this),this.clearDepth=new T0(this),this.clearStencil=new yf(this),this.colorMask=new vf(this),this.depthMask=new xf(this),this.stencilMask=new bf(this),this.stencilFunc=new f_(this),this.stencilOp=new p_(this),this.stencilTest=new S0(this),this.depthRange=new Zc(this),this.depthTest=new Xc(this),this.depthFunc=new m_(this),this.blend=new Es(this),this.blendFunc=new wf(this),this.blendColor=new _h(this),this.blendEquation=new gh(this),this.cullFace=new Tf(this),this.cullFaceSide=new Sf(this),this.frontFace=new Ef(this),this.program=new yh(this),this.activeTexture=new Af(this),this.viewport=new Mf(this),this.bindFramebuffer=new vh(this),this.bindRenderbuffer=new __(this),this.bindTexture=new g_(this),this.bindVertexBuffer=new Dl(this),this.bindElementBuffer=new E0(this),this.bindVertexArrayOES=new A0(this),this.pixelStoreUnpack=new M0(this),this.pixelStoreUnpackPremultiplyAlpha=new I0(this),this.pixelStoreUnpackFlipY=new C0(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,h){return new Io(this,t,s,h)}createVertexBuffer(t,s,h,m,g){return new Uf(this,t,s,h,m,g)}createRenderbuffer(t,s,h){const m=this.gl,g=m.createRenderbuffer();return this.bindRenderbuffer.set(g),m.renderbufferStorage(m.RENDERBUFFER,t,s,h),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,h,m){return new Ih(this,t,s,h,m)}clear({color:t,depth:s,stencil:h,colorMask:m}){const g=this.gl;let x=0;t&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(m||[!0,!0,!0,!0])),s!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),g.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){i.bn(t.blendFunction,Dr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let oo;function jf(d,t,s,h,m,g,x){const I=d.context,P=I.gl,z=d.transform,L=d.getOrCreateProgram("collisionBox"),F=[];let B=0,j=0;for(let ce=0;ce<h.length;ce++){const ye=h[ce],pe=t.getTile(ye),ge=pe.getBucket(s);if(!ge)continue;const me=li(ye,ge,z);let we=me;m[0]===0&&m[1]===0||(we=d.translatePosMatrix(me,pe,m,g));const Ee=x?ge.textCollisionBox:ge.iconCollisionBox,He=ge.collisionCircleArray;if(He.length>0){const Be=i.ad.mat4.create(),rt=we;i.ad.mat4.mul(Be,ge.placementInvProjMatrix,z.glCoordMatrix),i.ad.mat4.mul(Be,Be,ge.placementViewportMatrix),F.push({circleArray:He,circleOffset:j,transform:rt,invTransform:Be,projection:ge.getProjection()}),B+=He.length/4,j=B}Ee&&(d.terrain&&d.terrain.setupElevationDraw(pe,L),L.draw(d,P.LINES,Xt.disabled,br.disabled,d.colorModeForRenderPass(),fr.disabled,Lf(we,z,pe,ge.getProjection()),s.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,z.zoom,null,[Ee.collisionVertexBuffer,Ee.collisionVertexBufferExt]))}if(!x||!F.length)return;const X=d.getOrCreateProgram("collisionCircle"),q=new i.cW;q.resize(4*B),q._trim();let J=0;for(const ce of F)for(let ye=0;ye<ce.circleArray.length/4;ye++){const pe=4*ye,ge=ce.circleArray[pe+0],me=ce.circleArray[pe+1],we=ce.circleArray[pe+2],Ee=ce.circleArray[pe+3];q.emplace(J++,ge,me,we,Ee,0),q.emplace(J++,ge,me,we,Ee,1),q.emplace(J++,ge,me,we,Ee,2),q.emplace(J++,ge,me,we,Ee,3)}(!oo||oo.length<2*B)&&(oo=function(ce){const ye=2*ce,pe=new i.aV;pe.resize(ye),pe._trim();for(let ge=0;ge<ye;ge++){const me=6*ge;pe.uint16[me+0]=4*ge+0,pe.uint16[me+1]=4*ge+1,pe.uint16[me+2]=4*ge+2,pe.uint16[me+3]=4*ge+2,pe.uint16[me+4]=4*ge+3,pe.uint16[me+5]=4*ge+0}return pe}(B));const Q=I.createIndexBuffer(oo,!0),oe=I.createVertexBuffer(q,i.cX.members,!0);for(const ce of F){const ye={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(ue=z).getCameraToCenterDistance(ce.projection),u_viewport_size:[ue.width,ue.height]};X.draw(d,P.TRIANGLES,Xt.disabled,br.disabled,d.colorModeForRenderPass(),fr.disabled,ye,s.id,oe,Q,i.b8.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,z.zoom)}var ue;oe.destroy(),Q.destroy()}const Nl=i.ad.mat4.create();function Ch(d){const t=d._camera.getWorldToCamera(d.worldSize,1),s=i.ad.mat4.multiply([],t,d.globeMatrix);i.ad.mat4.invert(s,s);const h=[0,0,0],m=[0,1,0,0];return i.ad.vec4.transformMat4(m,m,s),h[0]=m[0],h[1]=m[1],h[2]=m[2],i.ad.vec3.normalize(h,h),h}function $f({width:d,height:t,anchor:s,textOffset:h,textScale:m},g){const{horizontalAlign:x,verticalAlign:I}=i.bD(s),P=-(x-.5)*d,z=-(I-.5)*t,L=i.bC(s,h);return new i.P((P/m+L[0])*g,(z/m+L[1])*g)}function P_(d,t,s,h,m,g,x,I,P,z,L){const F=d.text.placedSymbolArray,B=d.text.dynamicLayoutVertexArray,j=d.icon.dynamicLayoutVertexArray,X={},q=d.getProjection(),J=Vc(I,q,g),Q=g.elevation,oe=q.upVectorScale(I.canonical,g.center.lat,g.worldSize).metersToTile;B.clear();for(let ue=0;ue<F.length;ue++){const ce=F.get(ue),{tileAnchorX:ye,tileAnchorY:pe,numGlyphs:ge}=ce,me=ce.hidden||!ce.crossTileID||d.allowVerticalPlacement&&!ce.placedOrientation?null:h[ce.crossTileID];if(me){let we=0,Ee=0,He=0;if(Q){const Ze=Q?Q.getAtTileOffset(I,ye,pe):0,[at,$e,ut]=q.upVector(I.canonical,ye,pe);we=Ze*at*oe,Ee=Ze*$e*oe,He=Ze*ut*oe}let[Be,rt,nt,yt]=Mn(ce.projectedAnchorX+we,ce.projectedAnchorY+Ee,ce.projectedAnchorZ+He,s?J:x);const Oe=Qm(g.getCameraToCenterDistance(q),yt);let tt=m.evaluateSizeForFeature(d.textSizeData,z,ce)*Oe/i.bw;s&&(tt*=d.tilePixelRatio/P);const ze=$f(me,tt);s?({x:Be,y:rt,z:nt}=q.projectTilePoint(ye+ze.x,pe+ze.y,I.canonical),[Be,rt,nt]=Mn(Be+we,rt+Ee,nt+He,x)):(t&&ze._rotate(-g.angle),Be+=ze.x,rt+=ze.y,nt=0);const Qe=d.allowVerticalPlacement&&ce.placedOrientation===i.bq.vertical?Math.PI/2:0;for(let Ze=0;Ze<ge;Ze++)i.bt(B,Be,rt,nt,Qe);L&&ce.associatedIconIndex>=0&&(X[ce.associatedIconIndex]={x:Be,y:rt,z:nt,angle:Qe})}else Xa(ge,B)}if(L){j.clear();const ue=d.icon.placedSymbolArray;for(let ce=0;ce<ue.length;ce++){const ye=ue.get(ce),{numGlyphs:pe}=ye,ge=X[ce];if(ye.hidden||!ge)Xa(pe,j);else{const{x:me,y:we,z:Ee,angle:He}=ge;for(let Be=0;Be<pe;Be++)i.bt(j,me,we,Ee,He)}}d.icon.dynamicLayoutVertexBuffer.updateData(j)}d.text.dynamicLayoutVertexBuffer.updateData(B)}function us(d,t,s,h,m,g,x={}){const I=s.paint.get("icon-translate"),P=s.paint.get("text-translate"),z=s.paint.get("icon-translate-anchor"),L=s.paint.get("text-translate-anchor"),F=s.layout.get("icon-rotation-alignment"),B=s.layout.get("text-rotation-alignment"),j=s.layout.get("icon-pitch-alignment"),X=s.layout.get("text-pitch-alignment"),q=s.layout.get("icon-keep-upright"),J=s.layout.get("text-keep-upright"),Q=s.paint.get("icon-color-saturation"),oe=s.paint.get("icon-color-contrast"),ue=s.paint.get("icon-color-brightness-min"),ce=s.paint.get("icon-color-brightness-max"),ye=s.layout.get("symbol-elevation-reference")==="sea",pe=d.context,ge=pe.gl,me=d.transform,we=F==="map",Ee=B==="map",He=j==="map",Be=X==="map",rt=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let nt=!1;const yt=d.depthModeForSublayer(0,Xt.ReadOnly),Oe=[i.av(me.center.lng),i.aC(me.center.lat)],tt=s.layout.get("text-variable-anchor"),ze=me.projection.name==="globe",Qe=[],Ze=[0,-1,0];for(const at of h){const $e=t.getTile(at),ut=$e.getBucket(s);if(!ut||ut.projection.name==="mercator"&&ze||ut.fullyClipped)continue;const St=ut.projection.name==="globe",Mt=St?i.ag(me.zoom):0,Lt=Vc(at,ut.getProjection(),me),Wt=me.calculatePixelsToTileUnitsMatrix($e),pr=tt&&ut.hasTextData(),sr=ut.hasIconTextFit()&&pr&&ut.hasIconData(),mr=ut.getProjection().createInversionMatrix(me,at.canonical),hr=en=>{me.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||d.terrain)&&(en.push("DEPTH_D24"),en.push("DEPTH_OCCLUSION"))},Br=()=>{const en=we&&s.layout.get("symbol-placement")!=="point",tn=[];hr(tn);const Wn=en||sr,fi=s.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&He&&tn.push("PITCH_WITH_MAP_TERRAIN"),St&&(tn.push("PROJECTION_GLOBE_VIEW"),Wn&&tn.push("PROJECTED_POS_ON_VIEWPORT")),fi>0&&tn.push("ICON_TRANSITION"),ut.icon.zOffsetVertexBuffer&&tn.push("Z_OFFSET"),Q===0&&oe===0&&ue===0&&ce===1||tn.push("COLOR_ADJUSTMENT"),ut.sdfIcons&&tn.push("RENDER_SDF");const ts=ut.icon.programConfigurations.get(s.id),pi=d.getOrCreateProgram("symbol",{config:ts,defines:tn}),Ti=$e.imageAtlasTexture?$e.imageAtlasTexture.size:[0,0],Gi=ut.iconSizeData,rn=i.bp(Gi,me.zoom),Rn=He||me.pitch!==0,an=jo(Lt,$e.tileID.canonical,He,we,me,ut.getProjection(),Wt),_n=Di(Lt,$e.tileID.canonical,He,we,me,ut.getProjection(),Wt),_i=d.translatePosMatrix(_n,$e,I,z,!0),Bn=d.translatePosMatrix(Lt,$e,I,z),ci=Wn?Nl:an,zo=we&&!He&&!en;let rs=Ze;!ze&&!me.mercatorFromTransition||we||(rs=Ch(me));const Ks=St?rs:Ze,Jo=s.getColorAdjustmentMatrix(Q,oe,ue,ce),Oi=I_(Gi.kind,rn,zo,He,d,Bn,ci,_i,ye,!1,Ti,[0,0],!0,at,Mt,Oe,mr,Ks,ut.getProjection(),Jo,fi),Rs=$e.imageAtlasTexture?$e.imageAtlasTexture:null,Lo=s.layout.get("icon-size").constantOr(0)!==1||ut.iconsNeedLinear,co=ut.sdfIcons||d.options.rotating||d.options.zooming||Lo||Rn?ge.LINEAR:ge.NEAREST,Qo=ut.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,yp=d.terrain&&He&&en?i.ad.mat4.invert(i.ad.mat4.create(),an):Nl;if(en&&ut.icon){const uu=me.elevation,Jh=uu?uu.getAtTileOffsetFunc(at,me.center.lat,me.worldSize,ut.getProjection()):null,Qh=Za(Lt,$e.tileID.canonical,He,we,me,ut.getProjection(),Wt);Qu(ut,Lt,d,!1,Qh,_n,He,q,Jh,at)}return{program:pi,buffers:ut.icon,uniformValues:Oi,atlasTexture:Rs,atlasTextureIcon:null,atlasInterpolation:co,atlasInterpolationIcon:null,isSDF:ut.sdfIcons,hasHalo:Qo,tile:$e,labelPlaneMatrixInv:yp}},on=()=>{const en=Ee&&s.layout.get("symbol-placement")!=="point",tn=[],Wn=en||tt||sr;d.terrainRenderModeElevated()&&Be&&tn.push("PITCH_WITH_MAP_TERRAIN"),St&&(tn.push("PROJECTION_GLOBE_VIEW"),Wn&&tn.push("PROJECTED_POS_ON_VIEWPORT")),ut.text.zOffsetVertexBuffer&&tn.push("Z_OFFSET"),ut.iconsInText&&tn.push("RENDER_TEXT_AND_SYMBOL"),tn.push("RENDER_SDF"),hr(tn);const fi=ut.text.programConfigurations.get(s.id),ts=d.getOrCreateProgram("symbol",{config:fi,defines:tn});let pi,Ti=[0,0],Gi=null;const rn=ut.textSizeData;ut.iconsInText&&(Ti=$e.imageAtlasTexture?$e.imageAtlasTexture.size:[0,0],Gi=$e.imageAtlasTexture?$e.imageAtlasTexture:null,pi=Be||me.pitch!==0||d.options.rotating||d.options.zooming||rn.kind==="composite"||rn.kind==="camera"?ge.LINEAR:ge.NEAREST);const Rn=$e.glyphAtlasTexture?$e.glyphAtlasTexture.size:[0,0],an=s.layout.get("text-size-scale-range"),_n=i.ay(d.scaleFactor,an[0],an[1]),_i=i.bp(rn,me.zoom,_n),Bn=jo(Lt,$e.tileID.canonical,Be,Ee,me,ut.getProjection(),Wt),ci=Di(Lt,$e.tileID.canonical,Be,Ee,me,ut.getProjection(),Wt),zo=d.translatePosMatrix(ci,$e,P,L,!0),rs=d.translatePosMatrix(Lt,$e,P,L),Ks=Wn?Nl:Bn,Jo=Ee&&!Be&&!en;let Oi=Ze;!ze&&!me.mercatorFromTransition||Ee||(Oi=Ch(me));const Rs=I_(rn.kind,_i,Jo,Be,d,rs,Ks,zo,ye,!0,Rn,Ti,!0,at,Mt,Oe,mr,St?Oi:Ze,ut.getProjection(),null,null,_n),Lo=$e.glyphAtlasTexture?$e.glyphAtlasTexture:null,co=ge.LINEAR,Qo=s.paint.get("text-halo-width").constantOr(1)!==0,yp=d.terrain&&Be&&en?i.ad.mat4.invert(i.ad.mat4.create(),Bn):Nl;if(en&&ut.text){const uu=me.elevation,Jh=uu?uu.getAtTileOffsetFunc(at,me.center.lat,me.worldSize,ut.getProjection()):null,Qh=Za(Lt,$e.tileID.canonical,Be,Ee,me,ut.getProjection(),Wt);Qu(ut,Lt,d,!0,Qh,ci,Be,J,Jh,at)}return{program:ts,buffers:ut.text,uniformValues:Rs,atlasTexture:Lo,atlasTextureIcon:Gi,atlasInterpolation:co,atlasInterpolationIcon:pi,isSDF:!0,hasHalo:Qo,tile:$e,labelPlaneMatrixInv:yp}},mn=ut.icon.segments.get().length,zr=ut.text.segments.get().length,On=mn&&!x.onlyText?Br():null,wr=zr&&!x.onlyIcons?on():null,gr=s.paint.get("icon-opacity").constantOr(1),or=s.paint.get("text-opacity").constantOr(1);if(rt&&ut.canOverlap){nt=!0;const en=gr&&!x.onlyText?ut.icon.segments.get():[],tn=or&&!x.onlyIcons?ut.text.segments.get():[];for(const Wn of en)Qe.push({segments:new i.b8([Wn]),sortKey:Wn.sortKey,state:On});for(const Wn of tn)Qe.push({segments:new i.b8([Wn]),sortKey:Wn.sortKey,state:wr})}else x.onlyText||Qe.push({segments:gr?ut.icon.segments:new i.b8([]),sortKey:0,state:On}),x.onlyIcons||Qe.push({segments:or?ut.text.segments:new i.b8([]),sortKey:0,state:wr})}nt&&Qe.sort((at,$e)=>at.sortKey-$e.sortKey);for(const at of Qe){const $e=at.state;if($e)if(d.terrain?d.terrain.setupElevationDraw($e.tile,$e.program,{useDepthForOcclusion:me.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:$e.labelPlaneMatrixInv}):d.setupDepthForOcclusion(me.depthOcclusionForSymbolsAndCircles,$e.program),pe.activeTexture.set(ge.TEXTURE0),$e.atlasTexture&&$e.atlasTexture.bind($e.atlasInterpolation,ge.CLAMP_TO_EDGE,!0),$e.atlasTextureIcon&&(pe.activeTexture.set(ge.TEXTURE1),$e.atlasTextureIcon&&$e.atlasTextureIcon.bind($e.atlasInterpolationIcon,ge.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,$e.program),$e.hasHalo){const ut=$e.uniformValues;ut.u_is_halo=1,bn($e.buffers,at.segments,s,d,$e.program,yt,m,g,ut,2),ut.u_is_halo=0}else{if($e.isSDF){const ut=$e.uniformValues;$e.hasHalo&&(ut.u_is_halo=1,bn($e.buffers,at.segments,s,d,$e.program,yt,m,g,ut,1)),ut.u_is_halo=0}bn($e.buffers,at.segments,s,d,$e.program,yt,m,g,$e.uniformValues,1)}}}function bn(d,t,s,h,m,g,x,I,P,z){const L=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];m.draw(h,h.context.gl.TRIANGLES,g,x,I,fr.disabled,P,s.id,d.layoutVertexBuffer,d.indexBuffer,t,s.paint,h.transform.zoom,d.programConfigurations.get(s.id),L,z)}function Ph(d,t){const s=1<<d.canonical.z,h=(t.x*s-d.canonical.x-d.wrap*s)*i.ai,m=(t.y*s-d.canonical.y)*i.ai,g=i.d5(t.z,t.y);return i.ad.vec3.fromValues(h,m,g)}function Rh(d,t,s,h,m){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const g=d.context.gl,x=new Xt(d.context.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D),I=new Xt(d.context.gl.GREATER,Xt.ReadWrite,d.depthRangeFor3D),P=function(j){const X=i.c4(j.pitch);let q=.01;return j.isOrthographic&&(q=i.ah(1e-4,q,i.c9(X>=qo?1:X/qo))),2*q}(d.transform),z=d.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",F=d.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),B=d.getOrCreateProgram(L);for(const j of h){const X=t.getTile(j),q=X.getBucket(s);if(!q)continue;const J=q.elevatedStructures;if(!J)continue;const Q=q.elevationBufferData.heightRange,oe=Ph(j.toUnwrapped(),z),ue=d.translatePosMatrix(j.projMatrix,X,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let ce,ye,pe,ge;if(m==="initialize"){if(!Q||Q.min>=1||J.depthSegments.segments[0].primitiveLength===0)continue;ce=Fl(ue,oe,P,1,0),ye=x,pe=J.depthSegments,ge=F}else if(m==="reset"){if(!Q||Q.min>=0||J.maskSegments.segments[0].primitiveLength===0)continue;ce=Fl(ue,oe,0,0,1),ye=I,pe=J.maskSegments,ge=F}else if(m==="geometry"){if(J.depthSegments.segments[0].primitiveLength===0)continue;ce=Fl(ue,oe,P,1,0),ye=x,pe=J.depthSegments,ge=B}ge.draw(d,g.TRIANGLES,ye,br.disabled,Dr.disabled,fr.disabled,ce,s.id,J.vertexBuffer,J.indexBuffer,pe,s.paint,d.transform.zoom)}}function Dh(d,t,s){const{painter:h,sourceCache:m,layer:g,coords:x,colorMode:I,elevationType:P,terrainEnabled:z,pass:L}=d,F=h.context.gl,B=g.paint.get("fill-pattern");let j=P;P!=="road"||t&&!z||(j="none");const X=j==="road",q=new Xt(h.context.gl.LEQUAL,Xt.ReadWrite,h.depthRangeFor3D),J=B&&B.constantOr(1),Q=(oe,ue)=>{let ce,ye,pe,ge,me;ue?(ye=J&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ce=F.LINES):(ye=J?"fillPattern":"fill",ce=F.TRIANGLES);for(const we of x){const Ee=m.getTile(we);if(J&&!Ee.patternsLoaded())continue;const He=Ee.getBucket(g);if(!He)continue;const Be=t?He.elevationBufferData:He.bufferData;if(Be.isEmpty())continue;h.prepareDrawTile();const rt=Be.programConfigurations.get(g.id),nt=h.isTileAffectedByFog(we),yt=[],Oe=[];X&&(yt.push("ELEVATED_ROADS"),Oe.push(Be.elevatedLayoutVertexBuffer));const tt=h.getOrCreateProgram(ye,{config:rt,overrideFog:nt,defines:yt});J&&(h.context.activeTexture.set(F.TEXTURE0),Ee.imageAtlasTexture&&Ee.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),rt.updatePaintBuffers());const ze=B.constantOr(null);if(ze&&Ee.imageAtlas){const at=Ee.imageAtlas,$e=i.d0.from(ze).getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),ut=at.patternPositions.get($e);ut&&rt.setConstantPatternPositions(ut)}const Qe=h.translatePosMatrix(we.projMatrix,Ee,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor")),Ze=g.paint.get("fill-emissive-strength");if(ue){ge=Be.lineIndexBuffer,me=Be.lineSegments;const at=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];pe=ye==="fillOutlinePattern"&&J?Eh(Qe,Ze,h,Ee,at):E_(Qe,Ze,at)}else ge=Be.indexBuffer,me=Be.triangleSegments,pe=J?kl(Qe,Ze,h,Ee):Sh(Qe,Ze);h.uploadCommonUniforms(h.context,tt,we.toUnwrapped()),tt.draw(h,ce,j!=="none"?q:oe,s||h.stencilModeForClipping(we),I,fr.disabled,pe,g.id,Be.layoutVertexBuffer,ge,me,g.paint,h.transform.zoom,rt,Oe)}};h.renderPass===L&&Q(h.depthModeForSublayer(1,h.renderPass==="opaque"?Xt.ReadWrite:Xt.ReadOnly),!1),j==="none"&&h.renderPass==="translucent"&&g.paint.get("fill-antialias")&&Q(h.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,Xt.ReadOnly),!0)}function eu(d,t,s,h,m,g,x,I){s.resetLayerRenderingStats(d);const P=d.context,z=P.gl,L=d.transform,F=s.paint.get("fill-extrusion-pattern"),B=F.constantOr(1),j=s.paint.get("fill-extrusion-opacity"),X=d.style.enable3dLights(),q=s.paint.get(X&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),J=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],Q=s.layout.get("fill-extrusion-edge-radius"),oe=Q>0&&!s.paint.get("fill-extrusion-rounded-roof"),ue=oe?0:Q,ce=L.projection.name==="globe"?i.d6():0,ye=L.projection.name==="globe",pe=ye?i.ag(L.zoom):0,ge=[i.av(L.center.lng),i.aC(L.center.lat)],me=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",we=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(me?null:s.lut).toArray01().slice(0,3),Ee=s.paint.get("fill-extrusion-flood-light-intensity"),He=s.paint.get("fill-extrusion-vertical-scale"),Be=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,rt=s.paint.get("fill-extrusion-height-alignment"),nt=s.paint.get("fill-extrusion-base-alignment"),yt=ya(d,s.paint.get("fill-extrusion-cutoff-fade-range")),Oe=[];let tt;ye&&Oe.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&Oe.push("FAUX_AO"),oe&&Oe.push("ZERO_ROOF_RADIUS"),I&&Oe.push("HAS_CENTROID"),Ee>0&&Oe.push("FLOOD_LIGHT"),yt.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),Be&&Oe.push("RENDER_WALL_MODE");const ze=d.renderPass==="shadow",Qe=d.shadowRenderer,Ze=ze&&!!Qe;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let at=[0,0,0];if(Qe){const St=d.style.directionalLight,Mt=d.style.ambientLight;St&&Mt&&(at=Wo(d.style,St,Mt)),ze||(Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Qe.useNormalOffset&&Oe.push("NORMAL_OFFSET")),tt=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const $e=Ze?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",ut=s.getLayerRenderingStats();for(const St of h){const Mt=t.getTile(St),Lt=Mt.getBucket(s);if(!Lt||Lt.projection.name!==L.projection.name)continue;let Wt=!1;Qe&&(Wt=Qe.getMaxCascadeForTile(St.toUnwrapped())===0);const pr=d.isTileAffectedByFog(St),sr=Lt.programConfigurations.get(s.id),mr=d.getOrCreateProgram($e,{config:sr,defines:Wt?tt:Oe,overrideFog:pr});if(d.terrain&&d.terrain.setupElevationDraw(Mt,mr,{useMeterToDem:!0}),!Lt.centroidVertexBuffer){const wr=mr.attributes.a_centroid_pos;wr!==void 0&&z.vertexAttrib2f(wr,0,0)}!ze&&Qe&&Qe.setupShadows(Mt.tileID.toUnwrapped(),mr,"vector-tile",Mt.tileID.overscaledZ),B&&(d.context.activeTexture.set(z.TEXTURE0),Mt.imageAtlasTexture&&Mt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),sr.updatePaintBuffers());const hr=F.constantOr(null);if(hr&&Mt.imageAtlas){const wr=Mt.imageAtlas,gr=i.d0.from(hr).getPrimary().scaleSelf(i.q.devicePixelRatio),or=wr.patternPositions.get(gr.toString());or&&sr.setConstantPatternPositions(or)}const Br=s.paint.get("fill-extrusion-vertical-gradient"),on=1/Lt.tileToMeter;let mn;if(ze&&Qe){if(kt(Mt.tileID,Lt,d))continue;const wr=Qe.calculateShadowPassMatrixFromTile(Mt.tileID.toUnwrapped());mn=zf(wr,ue,on,He,rt,nt)}else{const wr=d.translatePosMatrix(St.expandedProjMatrix,Mt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),gr=L.projection.createInversionMatrix(L,St.canonical);mn=B?Ol(wr,d,Br,j,J,ue,on,St,Mt,ce,rt,nt,pe,ge,gr,we,He):Th(wr,d,Br,j,J,ue,on,St,ce,rt,nt,pe,ge,gr,we,He,Ee,at)}d.uploadCommonUniforms(P,mr,St.toUnwrapped(),null,yt);let zr=Lt.segments;if(L.projection.name==="mercator"&&!ze&&(zr=Lt.getVisibleSegments(Mt.tileID,d.terrain,d.transform.getFrustum(0)),!zr.get().length))continue;if(ut)if(ze)for(const wr of zr.get())ut.numRenderedVerticesInShadowPass+=wr.primitiveLength;else for(const wr of zr.get())ut.numRenderedVerticesInTransparentPass+=wr.primitiveLength;const On=[];(d.terrain||I)&&On.push(Lt.centroidVertexBuffer),ye&&On.push(Lt.layoutVertexExtBuffer),Be&&On.push(Lt.wallVertexBuffer),mr.draw(d,P.gl.TRIANGLES,m,g,x,fr.backCCW,mn,s.id,Lt.layoutVertexBuffer,Lt.indexBuffer,zr,s.paint,d.transform.zoom,sr,On)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function nl(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe){const ue=d.context,ce=ue.gl,ye=d.transform,pe=d.transform.zoom,ge=[],me=ya(d,s.paint.get("fill-extrusion-cutoff-fade-range"));z==="clear"?(ge.push("CLEAR_SUBPASS"),oe&&(ge.push("CLEAR_FROM_TEXTURE"),ue.activeTexture.set(ce.TEXTURE0),oe.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):z==="sdf"&&ge.push("SDF_SUBPASS"),J&&ge.push("HAS_CENTROID"),me.shouldRenderCutoff&&ge.push("RENDER_CUTOFF");const we=s.layout.get("fill-extrusion-edge-radius"),Ee=(He,Be,rt,nt,yt)=>{const Oe=Be.programConfigurations.get(s.id),tt=d.isTileAffectedByFog(He),ze=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:Oe,defines:ge,overrideFog:tt}),Qe=((at,$e,ut,St,Mt,Lt,Wt,pr,sr,mr,hr)=>({u_matrix:$e,u_opacity:ut,u_ao_pass:St?1:0,u_meter_to_tile:Mt,u_ao:Lt,u_flood_light_intensity:Wt,u_flood_light_color:pr,u_attenuation:sr,u_edge_radius:mr,u_fb:0,u_fb_size:hr,u_dynamic_offset:1}))(0,nt,L,P,yt,[F,B*yt],j,X,q,pe>=17?0:we*yt,oe?oe.size[0]:0),Ze=[];J&&Ze.push(Be.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(ue,ze,He.toUnwrapped(),null,me),ze.draw(d,ue.gl.TRIANGLES,m,g,x,I,Qe,s.id,Be.vertexBuffer,Be.indexBuffer,rt,s.paint,pe,Oe,Ze)};for(const He of h){const Be=t.getTile(He),rt=Be.getBucket(s);if(!rt||rt.projection.name!==ye.projection.name||!rt.groundEffect||rt.groundEffect&&!rt.groundEffect.hasData())continue;const nt=rt.groundEffect,yt=1/rt.tileToMeter;{const Oe=d.translatePosMatrix(He.projMatrix,Be,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),tt=nt.getDefaultSegment();Ee(He,nt,tt,Oe,yt)}if(Q)for(let Oe=0;Oe<4;Oe++){const tt=i.d7[Oe](He),ze=t.getTile(tt);if(!ze)continue;const Qe=ze.getBucket(s);if(!Qe||Qe.projection.name!==ye.projection.name||!Qe.groundEffect||Qe.groundEffect&&!Qe.groundEffect.hasData())continue;const Ze=Qe.groundEffect;let at,$e;Oe===0?(at=[-i.ai,0,0],$e=1):Oe===1?(at=[i.ai,0,0],$e=0):Oe===2?(at=[0,-i.ai,0],$e=3):(at=[0,i.ai,0],$e=2);const ut=Ze.regionSegments[$e];if(!ut)continue;const St=new Float32Array(16);i.ad.mat4.translate(St,He.projMatrix,at),Ee(He,Ze,ut,d.translatePosMatrix(St,Be,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),yt)}}}function L0(d,t,s,h,m,g,x){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const I=g?g.findDEMTileFor(s):null;if(!(I&&I.dem||x))return;g&&I&&I.dem&&h.selfDEMTileTimestamp!==I.dem._timestamp&&(h.borderDoneWithNeighborZ=[-1,-1,-1,-1],h.selfDEMTileTimestamp=I.dem._timestamp);const P=Q=>new i.P(Math.ceil((Q+i.da)*i.db),0),z=Q=>{const oe=t.getSource().minzoom,ue=ye=>{const pe=t.getTileByID(ye);if(pe&&pe.hasData())return pe.getBucket(m)},ce=[0,-1,1];for(const ye of ce){if(Q.overscaledZ+ye<oe)continue;const pe=ue(Q.calculateScaledKey(Q.overscaledZ+ye));if(pe)return pe}},L=[0,0,0],F=(Q,oe)=>(L[0]=Math.min(Q.min.y,oe.min.y),L[1]=Math.max(Q.max.y,oe.max.y),L[2]=i.ai-oe.min.x>Q.max.x?oe.min.x-i.ai:Q.max.x,L),B=(Q,oe)=>(L[0]=Math.min(Q.min.x,oe.min.x),L[1]=Math.max(Q.max.x,oe.max.x),L[2]=i.ai-oe.min.y>Q.max.y?oe.min.y-i.ai:Q.max.y,L),j=[(Q,oe)=>F(Q,oe),(Q,oe)=>F(oe,Q),(Q,oe)=>B(Q,oe),(Q,oe)=>B(oe,Q)],X=(Q,oe,ue,ce,ye,pe,ge)=>{if(!g)return 0;const me=[[pe?ue:Q,pe?Q:ue,0],[pe?ue:oe,pe?oe:ue,0]],we=ge<0?i.ai+ge:ge,Ee=[pe?we:(Q+oe)/2,pe?(Q+oe)/2:we,0];return ue===0&&ge<0||ue!==0&&ge>0?g.getForTilePoints(ye,[Ee],!0,ce):me.push(Ee),g.getForTilePoints(s,me,!0,I),Math.max(me[0][2],me[1][2],Ee[2])/g.exaggeration()};for(let Q=0;Q<4;Q++){const oe=h.borderFeatureIndices[Q];if(oe.length===0)continue;const ue=i.d7[Q](s),ce=z(ue);if(!(ce&&ce instanceof i.d8))continue;const ye=g?g.findDEMTileFor(ue):null;if(!(ye&&ye.dem||x)||(g&&ye&&ye.dem&&h.borderDEMTileTimestamp[Q]!==ye.dem._timestamp&&(h.borderDoneWithNeighborZ[Q]=-1,h.borderDEMTileTimestamp[Q]=ye.dem._timestamp),h.borderDoneWithNeighborZ[Q]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const pe=(Q<2?1:5)-Q,ge=ce.borderDoneWithNeighborZ[pe]!==h.canonical.z,me=ce.borderFeatureIndices[pe];let we=0;if(h.canonical.z!==ce.canonical.z){for(const Ee of oe)h.showCentroid(h.featuresOnBorder[Ee]);if(ge)for(const Ee of me)ce.showCentroid(ce.featuresOnBorder[Ee]);h.borderDoneWithNeighborZ[Q]=ce.canonical.z,ce.borderDoneWithNeighborZ[pe]=h.canonical.z}for(const Ee of oe){const He=h.featuresOnBorder[Ee],Be=h.centroidData[He.centroidDataIndex],rt=He.borders[Q];let nt;for(;we<me.length;){nt=ce.featuresOnBorder[me[we]];const yt=nt.borders[pe];if(yt[1]>rt[0]+3||yt[0]>rt[0]-3)break;ce.showCentroid(nt),we++}if(nt&&we<me.length){const yt=we;let Oe=0;for(;!(nt.borders[pe][0]>rt[1]-3)&&(Oe++,++we!==me.length);)nt=ce.featuresOnBorder[me[we]];nt=ce.featuresOnBorder[me[yt]];let tt=!1;if(Oe>=1){const Ze=nt.borders[pe];Math.abs(rt[0]-Ze[0])<3&&Math.abs(rt[1]-Ze[1])<3&&(Oe=1,tt=!0,we=yt+1)}else if(Oe===0){h.showCentroid(He);continue}const ze=ce.centroidData[nt.centroidDataIndex];x&&tt&&(((q=Be).flags|(J=ze).flags)&i.d9?(q.flags|=i.d9,J.flags|=i.d9):(q.flags&=~i.d9,J.flags&=~i.d9));const Qe=He.intersectsCount()>1||nt.intersectsCount()>1;if(Oe>1)we=yt,Be.centroidXY=ze.centroidXY=new i.P(0,0);else if(ye&&ye.dem&&!Qe){const Ze=j[Q](Be,ze),at=Q%2?i.ai-1:0,$e=X(Ze[0],Math.min(i.ai-1,Ze[1]),at,ye,ue,Q<2,Ze[2]);Be.centroidXY=ze.centroidXY=P($e)}else Qe?Be.centroidXY=ze.centroidXY=new i.P(0,0):(Be.centroidXY=h.encodeBorderCentroid(He),ze.centroidXY=ce.encodeBorderCentroid(nt));h.writeCentroidToBuffer(Be),ce.writeCentroidToBuffer(ze)}else h.showCentroid(He)}h.borderDoneWithNeighborZ[Q]=ce.canonical.z,ce.borderDoneWithNeighborZ[pe]=h.canonical.z}var q,J;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(d)}const Vl=[1,0,0],Ul=[0,1,0],Tt=[0,0,1];function kt(d,t,s){const h=s.transform,m=s.shadowRenderer;if(!m)return!0;const g=d.toUnwrapped(),x=h.tileSize*m._cascades[s.currentShadowCascade].scale;let I=t.maxHeight;if(h.elevation){const q=h.elevation.getMinMaxForTile(d);q&&(I+=q.max)}const P=[...m.shadowDirection];P[2]=-P[2];const z=m.computeSimplifiedTileShadowVolume(g,I,x,P);if(!z)return!1;const L=[Vl,Ul,Tt,P,[P[0],0,P[2]],[0,P[1],P[2]]],F=h.projection.name==="globe",B=h.scaleZoom(x),j=i.bR.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,B,!F),X=m.getCurrentCascadeFrustum();return j.intersectsPrecise(z.vertices,z.planes,L)===0||X.intersectsPrecise(z.vertices,z.planes,L)===0}function il(d){return[d[0]*i.dc,d[1]*i.dc,d[2]*i.dc,0]}function $n(d,t,s,h,m,g,x,I,P){const z=h.getSource(),L=s.globeSharedBuffers;if(!L)return;let F,B,j;if(t&&(F=h.getTile(t)),z instanceof i.aK?(B=z.texture,j=i.cJ(0,0,s.transform)):F&&t&&(B=F.texture,j=i.cJ(t.canonical.z,t.canonical.x,s.transform)),!B||!j)return;d||(j=i.ad.mat4.scale(i.ad.mat4.create(),j,[1,-1,1]));const X=s.context,q=X.gl,J=m.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR,Q=s.colorModeForDrapableLayerRenderPass(g),oe=x.defines;oe.push("GLOBE_POLES");const ue=new Xt(q.LEQUAL,Xt.ReadWrite,s.depthRangeFor3D),ce=Float32Array.from(s.transform.expandedFarZProjMatrix),ye=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),X.activeTexture.set(q.TEXTURE0),B.bind(J,q.CLAMP_TO_EDGE),X.activeTexture.set(q.TEXTURE1),B.bind(J,q.CLAMP_TO_EDGE),"useMipmap"in B&&X.extTextureFilterAnisotropic&&s.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const[pe,ge,me,we]=t?L.getPoleBuffers(t.canonical.z,!1):L.getPoleBuffers(0,!0),Ee=m.paint.get("raster-elevation");let He;d?(He=pe,s.renderDefaultNorthPole=Ee!==0):(He=ge,s.renderDefaultSouthPole=Ee!==0);const Be=il(x.mix),rt=((yt,Oe,tt,ze,Qe,Ze,at,$e,ut,St,Mt,Lt,Wt)=>kf(yt,Oe,tt,new Float32Array(16),new Float32Array(9),[0,0],ze,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],$e,2,St,Mt,Lt,1,0,Wt))(ce,ye,j,i.ag(s.transform.zoom),0,m,0,Ee,0,Be,x.offset,x.range,g),nt=s.getOrCreateProgram("raster",{defines:oe});s.uploadCommonUniforms(X,nt,null),nt.draw(s,q.TRIANGLES,ue,P,Q,I,rt,m.id,He,me,we)}function Ue(d){const t=d._nearZ,s=d.projection.farthestPixelDistance(d),h=s-t,m=.2*d.height,g=t+m;return[t,s,(g-m-t)/h,(g-t)/h]}function R_(d,t,s,h){if(d)return t instanceof ws&&d instanceof ga?t.getTextureDescriptor(d,s,!0):{texture:d.texture,mix:il(h.mix),offset:h.offset,buffer:0,tileSize:1}}var zh=i.dd([{name:"a_index",type:"Int16",components:1}]);class Gf{constructor(t,s,h,m){const g={width:h[0],height:h[1],data:null},x=t.gl;this.targetColorTexture=new i.T(t,g,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(t,g,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,m),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const h=this.context.gl,m=s.width*s.height;this.particleTexture0=new i.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1});const g=new i.de;g.reserve(m);for(let x=0;x<m;x++)g.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(g,zh.members,!0),this.particleSegment=i.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Hf(d,t,s){if(!d)return null;const h=t.getTextureDescriptor(d,s,!0);if(!h)return null;let{texture:m,mix:g,offset:x,tileSize:I,buffer:P,format:z}=h;if(!m||!z)return null;let L=!1;return z==="uint32"&&(L=!0,g[3]=0,g=Qc(i.df,g,[0,s.paint.get("raster-particle-max-speed")]),x=Ft(i.df,x,[0,s.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[P/(I+2*P),I/(I+2*P)],tileSize:I,scalarData:L,scale:g,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function D_(d){const t=d._nearZ,s=d.projection.farthestPixelDistance(d),h=s-t,m=.2*d.height,g=t+m;return[t,s,(g-m-t)/h,(g-t)/h]}const z_=new i.al(1,0,0,1),jl=new i.al(0,1,0,1),O0=new i.al(0,0,1,1),k0=new i.al(1,0,1,1),L_=new i.al(0,1,1,1);function Ko(d,t,s,h,m,g,x){const I=d.context,P=d.transform,z=I.gl,L=P.projection.name==="globe",F=L?["PROJECTION_GLOBE_VIEW"]:[];let B=i.ad.mat4.clone(s.projMatrix);if(L&&i.ag(P.zoom)>0){const Be=i.bb(s.canonical,P),rt=i.dg(Be);B=i.ad.mat4.multiply(new Float32Array(16),P.globeMatrix,rt),i.ad.mat4.multiply(B,P.projMatrix,B)}const j=i.ad.mat4.create();j[12]+=2*m/(i.q.devicePixelRatio*P.width),j[13]+=2*g/(i.q.devicePixelRatio*P.height),i.ad.mat4.multiply(B,j,B);const X=d.getOrCreateProgram("debug",{defines:F}),q=t.getTileByID(s.key);d.terrain&&d.terrain.setupElevationDraw(q,X);const J=Xt.disabled,Q=br.disabled,oe=d.colorModeForRenderPass(),ue="$debug";I.activeTexture.set(z.TEXTURE0),d.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),L?q._makeGlobeTileDebugBuffers(d.context,P):q._makeDebugTileBoundsBuffers(d.context,P.projection);const ce=q._tileDebugBuffer||d.debugBuffer,ye=q._tileDebugIndexBuffer||d.debugIndexBuffer,pe=q._tileDebugSegments||d.debugSegments;if(X.draw(d,z.LINE_STRIP,J,Q,oe,fr.disabled,Of(B,h),ue,ce,ye,pe,null,null,null,[q._globeTileDebugBorderBuffer]),x){const Be=q.latestRawTileData,rt=Math.floor((Be&&Be.byteLength||0)/1024);let nt=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(nt+=` => ${s.overscaledZ}`),nt+=` ${q.state}`,nt+=` ${rt}kb`,function(yt,Oe){yt.initDebugOverlayCanvas();const tt=yt.debugOverlayCanvas,ze=yt.context.gl,Qe=yt.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,tt.width,tt.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(Oe,5,5),Qe.strokeText(Oe,5,5),yt.debugOverlayTexture.update(tt),yt.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)}(d,nt)}const ge=t.getTile(s).tileSize,me=512/Math.min(ge,512)*(s.overscaledZ/P.zoom)*.5,we=q._tileDebugTextBuffer||d.debugBuffer,Ee=q._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,He=q._tileDebugTextSegments||d.debugSegments;X.draw(d,z.TRIANGLES,J,Q,Dr.alphaBlended,fr.disabled,Of(B,i.al.transparent,me),ue,we,Ee,He,null,null,null,[q._globeTileDebugTextBuffer])}function Lh(d,t,s,h){tu(d,0,t+s/2,d.transform.width,s,h)}function qf(d,t,s,h){tu(d,t-s/2,0,s,d.transform.height,h)}function tu(d,t,s,h,m,g){const x=d.context,I=x.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*i.q.devicePixelRatio,s*i.q.devicePixelRatio,h*i.q.devicePixelRatio,m*i.q.devicePixelRatio),x.clear({color:g}),I.disable(I.SCISSOR_TEST)}const Oh=i.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:kh}=Oh;function Ms(d,t,s,h){d.emplaceBack(t,s,h)}class Wf{constructor(t){this.vertexArray=new i.dh,this.indices=new i.aV,Ms(this.vertexArray,-1,-1,1),Ms(this.vertexArray,1,-1,1),Ms(this.vertexArray,-1,1,1),Ms(this.vertexArray,1,1,1),Ms(this.vertexArray,-1,-1,-1),Ms(this.vertexArray,1,-1,-1),Ms(this.vertexArray,-1,1,-1),Ms(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,kh),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=i.b8.simpleSegment(0,0,36,12)}}function $l(d,t,s,h,m,g){const x=d.context.gl,I=t.paint.get("sky-atmosphere-color"),P=t.paint.get("sky-atmosphere-halo-color"),z=t.paint.get("sky-atmosphere-sun-intensity"),L=((F,B,j,X,q)=>({u_matrix_3f:F,u_sun_direction:B,u_sun_intensity:j,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[q.r,q.g,q.b,q.a],u_luminance:5e-5}))(i.ad.mat3.fromMat4(i.ad.mat3.create(),h),m,z,I,P);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),s.draw(d,x.TRIANGLES,Xt.disabled,br.disabled,Dr.unblended,fr.frontCW,L,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Qi=i.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class F0{constructor(t){const s=new i.di;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new i.aV;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,Qi.members),this.indexBuffer=t.createIndexBuffer(h),this.segments=i.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ru=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class En{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Jr{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Dr([1,Ml,1,Ml],i.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Dr([1,0,1,0],i.al.transparent,[!1,!1,!1,!0]),this.params=new En,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new F0(s);const h=this.params.sizeRange,m=this.params.intensityRange,g=function(L){const F=i.dl(30),B=[];for(let j=0;j<L;++j){const X=2*Math.PI*F(),q=Math.acos(1-2*F())-.5*Math.PI;B.push(i.ad.vec3.fromValues(Math.cos(q)*Math.cos(X),Math.cos(q)*Math.sin(X),Math.sin(q)))}return B}(this.params.starsCount),x=i.dl(300),I=new i.dj,P=new i.aV;let z=0;for(let L=0;L<g.length;++L){const F=i.ad.vec3.scale([],g[L],200),B=Math.max(0,1+.01*h*(1*x()-.5)),j=Math.max(0,1+.01*m*(1*x()-.5));I.emplaceBack(F[0],F[1],F[2],-1,-1,B,j),I.emplaceBack(F[0],F[1],F[2],1,-1,B,j),I.emplaceBack(F[0],F[1],F[2],1,1,B,j),I.emplaceBack(F[0],F[1],F[2],-1,1,B,j),P.emplaceBack(z+0,z+1,z+2),P.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=s.createVertexBuffer(I,ru.members),this.starsIdx=s.createIndexBuffer(P),this.starsSegments=i.b8.simpleSegment(0,0,I.length,P.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const h=t.context,m=h.gl,g=t.transform,x=new Xt(m.LEQUAL,Xt.ReadOnly,[0,1]),I=i.ag(g.zoom),P=t.style.getLut(s.scope),z=s.properties.get("color-use-theme")==="none",L=s.properties.get("color").toRenderColor(z?null:P).toArray01(),F=s.properties.get("high-color-use-theme")==="none",B=s.properties.get("high-color").toRenderColor(F?null:P).toArray01(),j=s.properties.get("space-color-use-theme")==="none",X=s.properties.get("space-color").toRenderColor(j?null:P).toArray01PremultipliedAlpha(),q=5e-4,J=i.dk(s.properties.get("horizon-blend"),0,1,q,.25),Q=i.cD(t,h,g)&&J===q?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,oe=t.frameCounter/1e3%1,ue=i.ad.vec3.length(g.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(ue,2)-Math.pow(Q,2)),ye=Math.acos(ce/ue),pe=ge=>{const me=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ge&&me.push("ALPHA_PASS");const we=t.getOrCreateProgram("globeAtmosphere",{defines:me}),Ee=((Be,rt,nt,yt,Oe,tt,ze,Qe,Ze,at,$e,ut)=>({u_frustum_tl:Be,u_frustum_tr:rt,u_frustum_br:nt,u_frustum_bl:yt,u_horizon:Oe,u_transition:tt,u_fadeout_range:ze,u_color:Qe,u_high_color:Ze,u_space_color:at,u_temporal_offset:$e,u_horizon_angle:ut}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,I,J,L,B,X,oe,ye);t.uploadCommonUniforms(h,we);const He=this.atmosphereBuffer;He&&we.draw(t,m.TRIANGLES,x,br.disabled,ge?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,fr.backCW,Ee,ge?"atmosphere_glow_alpha":"atmosphere_glow",He.vertexBuffer,He.indexBuffer,He.segments)};pe(!1),pe(!0)}drawStars(t,s){const h=i.ay(s.properties.get("star-intensity"),0,1);if(h===0)return;const m=t.context,g=m.gl,x=t.transform,I=t.getOrCreateProgram("stars"),P=i.ad.quat.identity([]);i.ad.quat.rotateX(P,P,-x._pitch),i.ad.quat.rotateZ(P,P,-x.angle),i.ad.quat.rotateX(P,P,i.ak(x._center.lat)),i.ad.quat.rotateY(P,P,-i.ak(x._center.lng));const z=i.ad.mat4.fromQuat(new Float32Array(16),P),L=i.ad.mat4.multiply([],x.starsProjMatrix,z),F=i.ad.mat3.fromMat4([],z),B=i.ad.mat3.invert([],F),j=[0,1,0];i.ad.vec3.transformMat3(j,j,B),i.ad.vec3.scale(j,j,this.params.sizeMultiplier);const X=[1,0,0];i.ad.vec3.transformMat3(X,X,B),i.ad.vec3.scale(X,X,this.params.sizeMultiplier);const q=(J=j,Q=X,oe=h,{u_matrix:Float32Array.from(L),u_up:J,u_right:Q,u_intensity_multiplier:oe});var J,Q,oe;t.uploadCommonUniforms(m,I),this.starsVx&&this.starsIdx&&I.draw(t,g.TRIANGLES,Xt.disabled,br.disabled,this.colorModeAlphaBlendedWriteRGB,fr.disabled,q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Zf(d,t){const s=[...d],h=t.cameraWorldSizeForFog/t.worldSize,m=i.ad.mat4.identity([]);return i.ad.mat4.scale(m,m,[h,h,1]),i.ad.mat4.multiply(s,m,s),i.ad.mat4.multiply(s,t.worldToFogMatrix,s),s}function Co(d,t,s,h,m){const g=s.material,x=h.context,{baseColorTexture:I,metallicRoughnessTexture:P}=g.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:L,emissionTexture:F}=g;function B(X,q,J){if(X&&(d.push(q),x.activeTexture.set(x.gl.TEXTURE0+J),X.gfxTexture)){const{minFilter:Q,magFilter:oe,wrapS:ue,wrapT:ce}=X.sampler;X.gfxTexture.bindExtraParam(Q,oe,ue,ce)}}B(I,"HAS_TEXTURE_u_baseColorTexture",zi.BaseColor),B(P,"HAS_TEXTURE_u_metallicRoughnessTexture",zi.MetallicRoughness),B(z,"HAS_TEXTURE_u_normalTexture",zi.Normal),B(L,"HAS_TEXTURE_u_occlusionTexture",zi.Occlusion),B(F,"HAS_TEXTURE_u_emissionTexture",zi.Emission),m&&(m.texture||(m.texture=new i.dn(h.context,m.image,[m.image.height,m.image.height,m.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+zi.LUT),m.texture&&m.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(d.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||d.push("DIFFUSE_SHADED");const j=h.shadowRenderer;j&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&d.push("NORMAL_OFFSET"))}function sl(d,t,s,h,m,g){const x=s.paint.get("model-opacity").constantOr(1),I=t.context,P=new Xt(t.context.gl.LEQUAL,Xt.ReadWrite,t.depthRangeFor3D),z=t.transform,L=d.mesh,F=L.material,B=F.pbrMetallicRoughness,j=t.style.fog;let X;X=t.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:i.ad.mat4.multiply([],h.zScaleMatrix,d.nodeModelMatrix),i.ad.mat4.multiply(X,h.negCameraPosMatrix,X);const q=i.ad.mat4.invert([],X);i.ad.mat4.transpose(q,q);const J=s.paint.get("model-color-use-theme").constantOr("default")==="none",Q=s.paint.get("model-emissive-strength").constantOr(0),oe=Mh(new Float32Array(d.worldViewProjection),new Float32Array(X),new Float32Array(q),null,t,x,B.baseColorFactor.toRenderColor(null),F.emissiveFactor,B.metallicFactor,B.roughnessFactor,F,Q,s),ue={defines:[]},ce=[],ye=t.shadowRenderer;ye&&(ye.useNormalOffset=!1),Co(ue.defines,ce,L,t,J?null:s.lut);let pe=null;if(j){const we=Zf(d.nodeModelMatrix,t.transform);if(pe=new Float32Array(we),z.projection.name!=="globe"){const Ee=L.aabb.min,He=L.aabb.max,[Be,rt]=j.getOpacityForBounds(we,Ee[0],Ee[1],He[0],He[1]);ue.overrideFog=Be>=gt||rt>=gt}}const ge=ya(t,s.paint.get("model-cutoff-fade-range"));ge.shouldRenderCutoff&&ue.defines.push("RENDER_CUTOFF");const me=t.getOrCreateProgram("model",ue);t.uploadCommonUniforms(I,me,null,pe,ge),t.renderPass!=="shadow"&&ye&&ye.setupShadowsFromMatrix(d.nodeModelMatrix,me),me.draw(t,I.gl.TRIANGLES,P,m,g,L.material.doubleSided?fr.disabled:fr.backCCW,oe,s.id,L.vertexBuffer,L.indexBuffer,L.segments,s.paint,t.transform.zoom,void 0,ce)}function ol(d,t,s,h,m,g,x){let I;I=d.projection.name==="globe"?i.dp(s,d):[...s],i.ad.mat4.multiply(I,I,t.matrix);const P=i.ad.mat4.multiply([],h,I);if(t.meshes)for(const z of t.meshes){if(z.material.alphaMode!=="BLEND"){x.push({mesh:z,depth:0,modelIndex:m,worldViewProjection:P,nodeModelMatrix:I});continue}const L=i.ad.vec3.transformMat4([],z.centroid,P);!d.isOrthographic&&L[2]<=0||g.push({mesh:z,depth:L[2],modelIndex:m,worldViewProjection:P,nodeModelMatrix:I})}if(t.children)for(const z of t.children)ol(d,z,s,h,m,g,x)}function Sa(d,t,s,h){const m=s.shadowRenderer;if(!m)return;const g=m.getShadowPassDepthMode(),x=m.getShadowPassColorMode(),I=m.calculateShadowPassMatrixFromMatrix(t),P=C_(I);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,g,br.disabled,x,fr.backCCW,P,h.id,d.vertexBuffer,d.indexBuffer,d.segments,h.paint,s.transform.zoom,void 0,void 0)}function Xf(d,t,s){const h=t.updateZoomBasedPaintProperties(),m=function(g,x,I){let P,z,L,F=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&F>0){const B=g.terrain,j=B.findDEMTileFor(I);j&&j.dem?P=i.dr.create(B,I,j):F=0}if(F===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),F===x.validForExaggeration&&(F===0||P&&P._demTile&&P._demTile.tileID===x.validForDEMTile.id&&P._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const B in x.instancesPerModel){const j=x.instancesPerModel[B];for(let X=0;X<j.instancedDataArray.length;++X){const q=(P?F*P.getElevationAt(0|j.instancedDataArray.float32[16*X],0|j.instancedDataArray.float32[16*X+1],!0,!0):0)+j.instancesEvaluatedElevation[X];j.instancedDataArray.float32[16*X+6]=q,z=z?Math.min(x.terrainElevationMin,q):q,L=L?Math.max(x.terrainElevationMax,q):q}}return x.terrainElevationMin=z||0,x.terrainElevationMax=L||0,x.validForExaggeration=F,x.validForDEMTile=P&&P._demTile?{id:P._demTile.tileID,timestamp:P._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,t,s);(h||m)&&(t.uploaded=!1,t.upload(d.context))}const Zs={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.ce([0,0,0],[i.ai,i.ai,0])};function Kf(d,t){const s=1<<d.canonical.z,h=t.getFreeCameraOptions().position,m=t.elevation,g=d.canonical.x/s,x=(d.canonical.x+1)/s,I=d.canonical.y/s,P=(d.canonical.y+1)/s;let z=t._centerAltitude;if(m){const j=m.getMinMaxForTile(d);j&&j.max>z&&(z=j.max)}const L=i.ay(h.x,g,x)-h.x,F=i.ay(h.y,I,P)-h.y,B=i.bH(z,t.center.lat)-h.z;return t._zoomFromMercatorZ(Math.sqrt(L*L+F*F+B*B))}function Fh(d,t,s,h,m,g,x){const I=d.context,P=d.renderPass==="shadow",z=d.shadowRenderer,L=P&&z?z.getShadowPassDepthMode():new Xt(I.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D),F=d.isTileAffectedByFog(g);if(s.meshes)for(const B of s.meshes){const j=["MODEL_POSITION_ON_GPU"],X=[];let q,J,Q;h.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const oe=ya(d,t.paint.get("model-cutoff-fade-range"));if(oe.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),P&&z)q=d.getOrCreateProgram("modelDepth",{defines:j}),J=C_(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(s.matrix)),Q=z.getShadowPassColorMode();else{Co(j,X,B,d,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),q=d.getOrCreateProgram("model",{defines:j,overrideFog:F});const ce=B.material,ye=ce.pbrMetallicRoughness,pe=t.paint.get("model-opacity").constantOr(1),ge=t.paint.get("model-emissive-strength").constantOr(0);J=Mh(g.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,d,pe,ye.baseColorFactor.toRenderColor(null),ce.emissiveFactor,ye.metallicFactor,ye.roughnessFactor,ce,ge,t,m),z&&(x.shadowUniformsInitialized?q.setShadowUniformValues(I,z.getShadowUniformValues()):(z.setupShadows(g.toUnwrapped(),q,"model-tile",g.overscaledZ),x.shadowUniformsInitialized=!0)),Q=oe.shouldRenderCutoff||pe<1||ce.alphaMode!=="OPAQUE"?Dr.alphaBlended:Dr.unblended}d.uploadCommonUniforms(I,q,g.toUnwrapped(),null,oe);const ue=B.material.doubleSided?fr.disabled:fr.backCCW;if(h.instancedDataArray.length>20)X.push(h.instancedDataBuffer),q.draw(d,I.gl.TRIANGLES,L,br.disabled,Q,ue,J,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,d.transform.zoom,void 0,X,h.instancedDataArray.length);else{const ce=P?"u_instance":"u_normal_matrix";for(let ye=0;ye<h.instancedDataArray.length;++ye)J[ce]=new Float32Array(h.instancedDataArray.arrayBuffer,64*ye,16),q.draw(d,I.gl.TRIANGLES,L,br.disabled,Q,ue,J,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,d.transform.zoom,void 0,X)}}if(s.children)for(const B of s.children)Fh(d,t,B,h,m,g,x)}const Po=[1,-1,1];function Ea(d,t,s,h){if(!s.modelManager)return!0;const m=s.modelManager;if(!s.shadowRenderer)return!0;const g=s.shadowRenderer,x=t.aabb;let I=!0,P=d.maxHeight;if(P===0){let L=0;for(const F in d.instancesPerModel){const B=m.getModel(F,h);B?L=Math.max(L,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):I=!1}P=d.maxScale*L*1.41+d.maxVerticalOffset,I&&(d.maxHeight=P)}x.max[2]=P,x.min[2]+=d.terrainElevationMin,x.max[2]+=d.terrainElevationMax,i.ad.vec3.transformMat4(x.min,x.min,t.tileMatrix),i.ad.vec3.transformMat4(x.max,x.max,t.tileMatrix);const z=x.intersects(g.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=z===2),z===0}function Bh(d,t){const s=d.uniformValues.u_cutoff_params[0],h=d.uniformValues.u_cutoff_params[1],m=d.uniformValues.u_cutoff_params[2],g=d.uniformValues.u_cutoff_params[3];return h===s||g===m?1:i.ay(((t-s)/(h-s)-m)/(g-m),0,1)}function Nh(d,t,s,h){if(t.pitch<20)return 1;const m=t.getWorldToCameraMatrix();i.ad.mat4.multiply(m,m,d);const g=i.ad.vec4.fromValues(s.min[0],s.min[1],s.min[2],1);let x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),I=x,P=x;g[1]=s.max[1],x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),I=x[1]<I[1]?x:I,P=x[1]>P[1]?x:P,g[0]=s.max[0],x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),I=x[1]<I[1]?x:I,P=x[1]>P[1]?x:P,g[1]=s.min[1],x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),I=x[1]<I[1]?x:I,P=x[1]>P[1]?x:P;const z=i.ay(h[0],0,1),L=100*t.pixelsPerMeter*i.ay(h[1],0,1),F=i.ay(h[2],0,1),B=i.ad.vec4.lerp(i.ad.vec4.create(),I,P,z),j=Math.tan(.5*t.fovX),X=-B[2]*j;if(L===0)return B[1]<-Math.abs(X)?F:1;const q=(-Math.abs(X)-B[1])/L,J=(oe,ue,ce)=>(1-ce)*oe+ce*ue,Q=i.ay(J(1,F,q),F,1);return J(1,Q,i.ay((t.pitch-20)/20,0,1))}class Yf{}class Jf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,h){{const F=this._storage.get(s.id);if(F)return F.lastUsedFrameIdx=t,F.buf}const m=h.gl,g=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),x=new ArrayBuffer(g),I=new Int16Array(x);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const P=new i.dt;for(let F=0;F<g/2;F+=3){const B=I[F],j=I[F+1],X=I[F+2];P.emplaceBack(B,j),P.emplaceBack(j,X),P.emplaceBack(X,B)}const z=h.bindVertexArrayOES.current,L=new Yf;return L.buf=new Io(h,P),L.lastUsedFrameIdx=t,this._storage.set(s.id,L),h.bindVertexArrayOES.set(z),L.buf}update(t){for(const[s,h]of this._storage)t-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class al{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Qf=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Aa{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Vh{constructor(t,s){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Uh=i.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class ep{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const h=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const x=new i.du,I=new i.aV;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(x,Uh.members),this.vignetteIdx=t.context.createIndexBuffer(I)}const m=i.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,h);const x={u_vignetteShape:(g={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:g.vignetteColor};h.draw(t,t.context.gl.TRIANGLES,Xt.disabled,br.disabled,Dr.alphaBlended,fr.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,m)}var g}}class tp{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const h=t.getFreeCameraOptions().position,m=h.toAltitude(),g=h.toLngLat(),x=i.ak(g.lng),I=i.ak(g.lat),P=t.pixelsPerMeter/s,z=x*i.dv,L=i.dv*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const F=-this._offsetYPrev+L,B=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*P,this._accumulatedOffsetY+=F*P,this._accumulatedElevation+=B*P,this._offsetXPrev=z,this._offsetYPrev=L,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function wi(d,t){return[-(d[0]-Math.floor(d[0]/t)*t),-(d[1]-Math.floor(d[1]/t)*t),-(d[2]-Math.floor(d[2]/t)*t)]}function jh(d){const t=i.dl(1323123451230),s=[];for(let h=0;h<d;++h){const m=2*t()-1,g=2*t()-1,x=2*t()-1;s.push(i.ad.vec3.fromValues(m,g,x))}return s}function Ro(d,t,s,h,m){const g=i.ay((m-s)/(h-s),0,1);return(1-g)*d+g*t}class Ma{constructor(t){this._movement=new tp,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new ep,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const h=t.transform;this._movement.update(h,this._ppmScaleFactor);const m=h.starsProjMatrix,g=i.ad.quat.identity([]);i.ad.quat.rotateX(g,g,i.ak(90)-h._pitch),i.ad.quat.rotateZ(g,g,-h.angle);const x=i.ad.mat4.fromQuat(new Float32Array(16),g),I=i.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),P=i.ad.mat4.transpose([],I),z=i.ad.mat4.multiply([],P,x),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*s,this._prevTime=L,{projectionMatrix:m,modelviewMatrix:z}}}class rp extends Ma{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Vh(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=jh(this.particlesCount),m=new i.dw,g=new i.aV;let x=0;const I=i.dl(1323123451230);for(let P=0;P<h.length;++P){const z=h[P],L=[2*I()-1,I(),I(),I()];m.emplaceBack(z[0],z[1],z[2],-1,-1,...L),m.emplaceBack(z[0],z[1],z[2],1,-1,...L),m.emplaceBack(z[0],z[1],z[2],1,1,...L),m.emplaceBack(z[0],z[1],z[2],-1,1,...L),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=s.createVertexBuffer(m,Qf.members),this.particlesIdx=s.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},h=t.transform.zoom;if(s.revealStart>h)return;const m=Ro(0,1,s.revealStart,s.revealStart+s.revealRange,h);if(!this.particlesVx||!this.particlesIdx)return;const g=structuredClone(this._params);let x=[-g.direction.x,g.direction.y,-100];i.ad.vec3.normalize(x,x);const I=structuredClone(this._vignetteParams);I.strength*=m,g.overrideStyleParameters||(g.intensity=t.style.rain.state.density,g.timeFactor=t.style.rain.state.intensity,g.color=structuredClone(t.style.rain.state.color),x=structuredClone(t.style.rain.state.direction),g.screenThinning.intensity=t.style.rain.state.centerThinning,g.dropletSizeX=t.style.rain.state.dropletSize[0],g.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],g.distortionStrength=100*t.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(t.style.rain.state.vignetteColor));const P=this.updateOnRender(t,g.timeFactor),z=t.context,L=z.gl,F=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new i.T(z,{width:t.width,height:t.height,data:null},L.RGBA8)),g.distortionStrength>0&&(z.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const B=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(z,B),z.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const j=[g.color.r,g.color.g,g.color.b,g.color.a],X=(q,J)=>{const Q=wi(this._movement.getPosition(),q),oe=g.dropletSizeX,ue=g.dropletSizeX*g.dropletSizeYScale,ce=t.width/2,ye=t.height/2,pe=Ro(0,g.screenThinning.start,0,1,g.screenThinning.intensity),ge=Ro(.001,g.screenThinning.range,0,1,g.screenThinning.intensity),me=Ro(0,g.screenThinning.particleOffset,0,1,g.screenThinning.intensity),we=(Ee={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Q,velocityConeAperture:g.velocityConeAperture,velocity:g.velocity,boxSize:q,rainDropletSize:[oe,ue],distortionStrength:g.distortionStrength,rainDirection:x,color:j,screenSize:[F.width,F.height],thinningCenterPos:[ce,ye],thinningShape:[pe,ge,Math.pow(10,g.screenThinning.fadePower)],thinningAffectedRatio:g.screenThinning.affectedRatio,thinningParticleOffset:me,shapeDirectionalPower:g.shapeDirPower,shapeNormalPower:g.shapeNormalPower,mode:J?0:1},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_texScreen:0,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_boxSize:Ee.boxSize,u_rainDropletSize:Ee.rainDropletSize,u_distortionStrength:Ee.distortionStrength,u_rainDirection:Ee.rainDirection,u_color:Ee.color,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_shapeDirectionalPower:Ee.shapeDirectionalPower,u_shapeNormalPower:Ee.shapeNormalPower,u_mode:Ee.mode});var Ee;const He=Math.round(g.intensity*this.particlesCount),Be=i.b8.simpleSegment(0,0,4*He,2*He);B.draw(t,L.TRIANGLES,Xt.disabled,br.disabled,Dr.alphaBlended,fr.disabled,we,"rain_particles",this.particlesVx,this.particlesIdx,Be)};g.distortionStrength>0&&X(g.boxSize,!0),X(g.boxSize,!1),this._vignette.draw(t,I)}}const np=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ip extends Ma{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Vh(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=jh(this.particlesCount),m=new i.dx,g=new i.aV;let x=0;const I=i.dl(1323123451230);for(let P=0;P<h.length;++P){const z=h[P],L=I(),F=I(),B=I(),j=[P/h.length,L,F,B],X=[I(),I()];m.emplaceBack(z[0],z[1],z[2],-1,-1,...j,...X),m.emplaceBack(z[0],z[1],z[2],1,-1,...j,...X),m.emplaceBack(z[0],z[1],z[2],1,1,...j,...X),m.emplaceBack(z[0],z[1],z[2],-1,1,...j,...X),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=s.createVertexBuffer(m,np.members),this.particlesIdx=s.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let h=[-s.direction.x,s.direction.y,-100];i.ad.vec3.normalize(h,h);const m=structuredClone(this._vignetteParams),g=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=t.transform.zoom;if(g.revealStart>x)return;const I=Ro(0,1,g.revealStart,g.revealStart+g.revealRange,x);m.strength*=I,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),h=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));const P=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=t.context,L=z.gl,F=t.transform,B=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(z,B),((j,X,q)=>{const J=wi(this._movement.getPosition(),j),Q=F.width/2,oe=F.height/2,ue=Ro(0,q.screenThinning.start,0,1,q.screenThinning.intensity),ce=Ro(.001,q.screenThinning.range,0,1,q.screenThinning.intensity),ye=Ro(0,q.screenThinning.particleOffset,0,1,q.screenThinning.intensity),pe=(ge={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:q.velocityConeAperture,velocity:q.velocity,horizontalOscillationRadius:q.horizontalOscillationRadius,horizontalOscillationRate:q.horizontalOscillationRate,boxSize:j,billboardSize:1*q.billboardSize,simpleShapeParameters:[q.shapeFadeStart,q.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[Q,oe],thinningShape:[ue,ce,Math.pow(10,q.screenThinning.fadePower)],thinningAffectedRatio:q.screenThinning.affectedRatio,thinningParticleOffset:ye,color:[q.color.r,q.color.g,q.color.b,q.color.a],direction:h},{u_modelview:Float32Array.from(ge.modelview),u_projection:Float32Array.from(ge.projection),u_time:ge.time,u_cam_pos:ge.camPos,u_velocityConeAperture:ge.velocityConeAperture,u_velocity:ge.velocity,u_horizontalOscillationRadius:ge.horizontalOscillationRadius,u_horizontalOscillationRate:ge.horizontalOscillationRate,u_boxSize:ge.boxSize,u_billboardSize:ge.billboardSize,u_simpleShapeParameters:ge.simpleShapeParameters,u_screenSize:ge.screenSize,u_thinningCenterPos:ge.thinningCenterPos,u_thinningShape:ge.thinningShape,u_thinningAffectedRatio:ge.thinningAffectedRatio,u_thinningParticleOffset:ge.thinningParticleOffset,u_particleColor:ge.color,u_direction:ge.direction});var ge;const me=Math.round(q.intensity*this.particlesCount),we=i.b8.simpleSegment(0,0,4*me,2*me);this.particlesVx&&this.particlesIdx&&B.draw(t,L.TRIANGLES,Xt.disabled,br.disabled,Dr.alphaBlended,fr.disabled,pe,"snow_particles",this.particlesVx,this.particlesIdx,we)})(s.boxSize,0,s),this._vignette.draw(t,m)}}const Ia={symbol:function(d,t,s,h,m){if(d.renderPass!=="translucent")return;const g=br.disabled,x=d.colorModeForRenderPass(),I=s.layout.get("text-variable-anchor"),P=s.layout.get("text-size-scale-range"),z=i.ay(d.scaleFactor,P[0],P[1]);I&&function(B,j,X,q,J,Q,oe,ue){const ce=j.transform,ye=J==="map",pe=Q==="map";for(const ge of B){const me=q.getTile(ge),we=me.getBucket(X);if(!we||!we.text||!we.text.segments.get().length)continue;const Ee=i.bp(we.textSizeData,ce.zoom,ue),He=Vc(ge,we.getProjection(),ce),Be=ce.calculatePixelsToTileUnitsMatrix(me),rt=jo(He,me.tileID.canonical,pe,ye,ce,we.getProjection(),Be),nt=we.hasIconTextFit()&&we.hasIconData();if(Ee){const yt=Math.pow(2,ce.zoom-me.tileID.overscaledZ);P_(we,ye,pe,oe,i.cY,ce,rt,ge,yt,Ee,nt)}}}(h,d,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m,z);const L=s.paint.get("icon-opacity").constantOr(1)!==0,F=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||F)?us(d,t,s,h,g,x):(L&&us(d,t,s,h,g,x,{onlyIcons:!0}),F&&us(d,t,s,h,g,x,{onlyText:!0})),t.map.showCollisionBoxes&&(jf(d,t,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),jf(d,t,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,s,h){if(d.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),g=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),I=s.layout.get("circle-sort-key").constantOr(1)!==void 0,P=s.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const z=d.context,L=z.gl,F=d.transform,B=d.depthModeForSublayer(0,Xt.ReadOnly),j=br.disabled,X=d.colorModeForDrapableLayerRenderPass(P),q=F.projection.name==="globe",J=[i.av(F.center.lng),i.aC(F.center.lat)],Q=[];for(let ue=0;ue<h.length;ue++){const ce=h[ue],ye=t.getTile(ce),pe=ye.getBucket(s);if(!pe||pe.projection.name!==F.projection.name)continue;const ge=pe.programConfigurations.get(s.id),me=i.cZ(s),we=d.isTileAffectedByFog(ce);q&&me.push("PROJECTION_GLOBE_VIEW"),me.push("DEPTH_D24"),d.terrain&&F.depthOcclusionForSymbolsAndCircles&&me.push("DEPTH_OCCLUSION");const Ee=d.getOrCreateProgram("circle",{config:ge,defines:me,overrideFog:we}),He=pe.layoutVertexBuffer,Be=pe.globeExtVertexBuffer,rt=pe.indexBuffer,nt=F.projection.createInversionMatrix(F,ce.canonical),yt={programConfiguration:ge,program:Ee,layoutVertexBuffer:He,globeExtVertexBuffer:Be,indexBuffer:rt,uniformValues:i.c_(d,ce,ye,nt,J,s),tile:ye};if(I){const Oe=pe.segments.get();for(const tt of Oe)Q.push({segments:new i.b8([tt]),sortKey:tt.sortKey,state:yt})}else Q.push({segments:pe.segments,sortKey:0,state:yt})}I&&Q.sort((ue,ce)=>ue.sortKey-ce.sortKey);const oe={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const ue of Q){const{programConfiguration:ce,program:ye,layoutVertexBuffer:pe,globeExtVertexBuffer:ge,indexBuffer:me,uniformValues:we,tile:Ee}=ue.state,He=ue.segments;d.terrain&&d.terrain.setupElevationDraw(Ee,ye,oe),d.uploadCommonUniforms(z,ye,Ee.tileID.toUnwrapped()),ye.draw(d,L.TRIANGLES,B,j,X,fr.disabled,we,s.id,pe,me,He,s.paint,F.zoom,ce,[ge])}},heatmap:function(d,t,s,h){if(s.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const m=d.context,g=m.gl,x=br.disabled,I=new Dr([g.ONE,g.ONE,g.ONE,g.ONE],i.al.transparent,[!0,!0,!0,!0]);(function(j,X,q,J){const Q=j.gl,oe=X.width*J,ue=X.height*J;j.activeTexture.set(Q.TEXTURE1),j.viewport.set([0,0,oe,ue]);let ce=q.heatmapFbo;if(!ce||ce&&(ce.width!==oe||ce.height!==ue)){ce&&ce.destroy();const ye=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,ye),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),ce=q.heatmapFbo=j.createFramebuffer(oe,ue,!0,null),function(pe,ge,me,we,Ee,He){const Be=pe.gl;Be.texImage2D(Be.TEXTURE_2D,0,pe.extRenderToTextureHalfFloat?Be.RGBA16F:Be.RGBA,Ee,He,0,Be.RGBA,pe.extRenderToTextureHalfFloat?Be.HALF_FLOAT:Be.UNSIGNED_BYTE,null),we.colorAttachment.set(me)}(j,0,ye,ce,oe,ue)}else Q.bindTexture(Q.TEXTURE_2D,ce.colorAttachment.get()),j.bindFramebuffer.set(ce.framebuffer)})(m,d,s,d.transform.projection.name==="globe"?.5:.25),m.clear({color:i.al.transparent});const P=d.transform,z=P.projection.name==="globe",L=z?["PROJECTION_GLOBE_VIEW"]:[],F=z?fr.frontCCW:fr.disabled,B=[i.av(P.center.lng),i.aC(P.center.lat)];for(let j=0;j<h.length;j++){const X=h[j];if(t.hasRenderableParent(X))continue;const q=t.getTile(X),J=q.getBucket(s);if(!J||J.projection.name!==P.projection.name)continue;const Q=d.isTileAffectedByFog(X),oe=J.programConfigurations.get(s.id),ue=d.getOrCreateProgram("heatmap",{config:oe,defines:L,overrideFog:Q}),{zoom:ce}=d.transform;d.terrain&&d.terrain.setupElevationDraw(q,ue),d.uploadCommonUniforms(m,ue,X.toUnwrapped());const ye=P.projection.createInversionMatrix(P,X.canonical);ue.draw(d,g.TRIANGLES,Xt.disabled,x,I,F,Bl(d,X,q,ye,B,ce,s.paint.get("heatmap-intensity")),s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,d.transform.zoom,oe,z?[J.globeExtVertexBuffer]:null)}m.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(m,g){const x=m.context,I=x.gl,P=g.heatmapFbo;if(!P)return;x.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get()),x.activeTexture.set(I.TEXTURE1);let z=g.colorRampTexture;z||(z=g.colorRampTexture=new i.T(x,g.colorRamp,I.RGBA8)),z.bind(I.LINEAR,I.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,I.TRIANGLES,Xt.disabled,br.disabled,m.colorModeForRenderPass(),fr.disabled,((L,F,B,j)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,g),g.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,g.paint,m.transform.zoom)}(d,s))},line:function(d,t,s,h){if(d.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),g=s.paint.get("line-width");if(m.constantOr(1)===0||g.constantOr(1)===0)return;const x=s.paint.get("line-emissive-strength"),I=s.paint.get("line-occlusion-opacity"),P=s.layout.get("line-elevation-reference"),z=s.layout.get("line-width-unit")==="meters",L=P==="sea",F=d.context,B=F.gl;if(s.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const j=s.layout.get("line-cross-slope"),X=j!==void 0,q=j<1,J=d.colorModeForDrapableLayerRenderPass(x),Q=d.terrain&&d.terrain.renderingToTexture,oe=Q?1:i.q.devicePixelRatio,ue=s.paint.get("line-dasharray"),ce=ue.constantOr(1),ye=s.layout.get("line-cap"),pe=ue.constantOr(null),ge=ye.constantOr(null),me=s.paint.get("line-pattern"),we=me.constantOr(1),Ee=me.constantOr(null),He=s.paint.get("line-opacity").constantOr(1);let Be=!we&&He!==1||d.depthOcclusion&&I>0&&I<1;const rt=s.paint.get("line-gradient"),nt=we?"linePattern":"line",yt=i.c$(s);let Oe;if(Q&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Be=!1),I!==0&&d.depthOcclusion){const ze=s.paint._values["line-opacity"];ze&&ze.value&&ze.value.kind==="constant"?Oe=ze.value:i.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}g.value.kind!=="constant"&&g.value.isLineProgressConstant===!1&&yt.push("VARIABLE_LINE_WIDTH");const tt=(ze,Qe,Ze,at,$e,ut)=>{for(const St of ze){const Mt=t.getTile(St);if(we&&!Mt.patternsLoaded())continue;const Lt=Mt.getBucket(s);if(!Lt||Lt.hasZOffset&&!$e||!Lt.hasZOffset&&$e)continue;d.prepareDrawTile();const Wt=Lt.programConfigurations.get(s.id),pr=d.isTileAffectedByFog(St),sr=d.getOrCreateProgram(nt,{config:Wt,defines:Qe,overrideFog:pr,overrideRtt:!$e&&void 0});if(Ee&&Mt.imageAtlas){const wr=i.d0.from(Ee).getPrimary().scaleSelf(oe).toString(),gr=Mt.imageAtlas.patternPositions.get(wr);gr&&Wt.setConstantPatternPositions(gr)}if(!we&&pe&&ge&&Mt.lineAtlas){const wr=Mt.lineAtlas.getDash(pe,ge);wr&&Wt.setConstantPatternPositions(wr)}let[mr,hr]=s.paint.get("line-trim-offset");(ge==="round"||ge==="square")&&mr!==hr&&(mr===0&&(mr-=1),hr===1&&(hr+=1));const Br=Q?St.projMatrix:null,on=z?1/Lt.tileToMeter/i.at(Mt,1,d.transform.zoom):1,mn=z?1/Lt.tileToMeter/i.at(Mt,1,Math.floor(d.transform.zoom)):1,zr=we?i.d1(d,Mt,s,Br,oe,on,mn,[mr,hr]):i.d2(d,Mt,s,Br,Lt.lineClipsArray.length,oe,on,mn,[mr,hr]);if(rt){const wr=Lt.gradients[s.id];let gr=wr.texture;if(s.gradientVersion!==wr.version){let or=256;if(s.stepInterpolant){const en=t.getSource().maxzoom,tn=St.canonical.z===en?Math.ceil(1<<d.transform.maxZoom-St.canonical.z):1;or=i.ay(i.d3(Lt.maxLineLength/i.ai*1024*tn),256,F.maxTextureSize)}wr.gradient=i.d4({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:or,image:wr.gradient||void 0,clips:Lt.lineClipsArray}),wr.texture?wr.texture.update(wr.gradient):wr.texture=new i.T(F,wr.gradient,B.RGBA8),wr.version=s.gradientVersion,gr=wr.texture}F.activeTexture.set(B.TEXTURE1),gr.bind(s.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}ce&&(F.activeTexture.set(B.TEXTURE0),Mt.lineAtlasTexture&&Mt.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),Wt.updatePaintBuffers()),we&&(F.activeTexture.set(B.TEXTURE0),Mt.imageAtlasTexture&&Mt.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Wt.updatePaintBuffers()),$e&&!L&&d.terrain.setupElevationDraw(Mt,sr),d.uploadCommonUniforms(F,sr,St.toUnwrapped());const On=wr=>{Oe!=null&&(Oe.value=He*I),sr.draw(d,B.TRIANGLES,Ze,wr,J,fr.disabled,zr,s.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,s.paint,d.transform.zoom,Wt,[Lt.layoutVertexBuffer2,Lt.patternVertexBuffer,Lt.zOffsetVertexBuffer]),Oe!=null&&(Oe.value=He)};if(Be&&!$e){const wr=d.stencilModeForClipping(St).ref;wr===0&&Q&&F.clear({stencil:0});const gr={func:B.EQUAL,mask:255};zr.u_alpha_discard_threshold=.8,On(new br(gr,wr,255,B.KEEP,B.KEEP,B.INVERT)),zr.u_alpha_discard_threshold=0,On(new br(gr,wr,255,B.KEEP,B.KEEP,B.KEEP))}else zr.u_alpha_discard_threshold=Be&&$e&&ut?.8:0,On($e?at:d.stencilModeForClipping(St))}};if(s.hasNonElevatedBuckets){const ze=!Q&&d.terrain;I!==0&&ze?i.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):ze?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):tt(h,yt,d.depthModeForSublayer(0,Xt.ReadOnly),br.disabled,!1,!0)}if(s.hasElevatedBuckets){yt.push("ELEVATED"),X&&yt.push(q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&yt.push("ELEVATION_REFERENCE_SEA");const ze=Be?d.stencilModeFor3D():br.disabled,Qe=new Xt(d.depthOcclusion?B.GREATER:B.LEQUAL,Xt.ReadOnly,d.depthRangeFor3D);d.forceTerrainMode=!0,tt(h,yt,Qe,ze,!0,!0),Be&&tt(h,yt,Qe,ze,!0,!1),d.forceTerrainMode=!1}Be&&(d.resetStencilClippingMasks(),Q&&F.clear({stencil:0})),I===0||d.depthOcclusion||Q||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,t,s,h){const m=s.paint.get("fill-color"),g=s.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const x=s.paint.get("fill-emissive-strength"),I=d.colorModeForDrapableLayerRenderPass(x),P=s.paint.get("fill-pattern"),z=d.opaquePassEnabledForLayer()&&!P.constantOr(1)&&m.constantOr(i.al.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";let L="none";s.layout.get("fill-elevation-reference")!=="none"?L="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const F=!(!d.terrain||!d.terrain.enabled),B={painter:d,sourceCache:t,layer:s,coords:h,colorMode:I,elevationType:L,terrainEnabled:F,pass:z};if(L!=="offset"){if(Dh(B,!1),L==="road"){const j=!F&&d.renderPass==="translucent";j&&Rh(d,t,s,h,"geometry"),Dh(B,!0,br.disabled),j&&function(X){const{painter:q,sourceCache:J,layer:Q,coords:oe,colorMode:ue}=X,ce=q.context.gl,ye=new Xt(q.context.gl.LEQUAL,Xt.ReadOnly,q.depthRangeFor3D);for(const pe of oe){const ge=J.getTile(pe),me=ge.getBucket(Q);if(!me)continue;const we=me.elevatedStructures;if(!we||!we.renderableSegments||we.renderableSegments.segments[0].primitiveLength===0)continue;q.prepareDrawTile();const Ee=me.bufferData.programConfigurations.get(Q.id),He=q.isTileAffectedByFog(pe),Be=q.getOrCreateProgram("elevatedStructures",{config:Ee,overrideFog:He,defines:["NORMAL_OFFSET"]}),rt={u_matrix:q.translatePosMatrix(pe.projMatrix,ge,Q.paint.get("fill-translate"),Q.paint.get("fill-translate-anchor"))};q.uploadCommonUniforms(q.context,Be,pe.toUnwrapped()),Be.draw(q,ce.TRIANGLES,ye,br.disabled,ue,fr.backCCW,rt,Q.id,we.vertexBuffer,we.indexBuffer,we.renderableSegments,Q.paint,q.transform.zoom,Ee,[we.vertexBufferNormal])}}(B)}}else Dh(B,!1,d.stencilModeFor3D())},"fill-extrusion":function(d,t,s,h){const m=s.paint.get("fill-extrusion-opacity"),g=d.context,x=g.gl,I=d.terrain,P=I&&I.renderingToTexture;if(m===0)return;const z=d.conflationActive&&d.style.isLayerClipped(s,t.getSource()),L=d.style.order.indexOf(s.fqid);if(z&&function(F,B,j,X,q){for(const J of X){const Q=B.getTile(J).getBucket(j);Q&&(Q.updateReplacement(J,F.replacementSource,q),Q.uploadCentroid(F.context))}}(d,t,s,h,L),I||z)for(const F of h){const B=t.getTile(F).getBucket(s);B&&L0(d.context,t,F,B,s,I,z)}if(d.renderPass==="shadow"&&d.shadowRenderer){const F=d.shadowRenderer;if(I&&m<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const B=F.getShadowPassDepthMode(),j=F.getShadowPassColorMode();eu(d,t,s,h,B,br.disabled,j,z)}else if(d.renderPass==="translucent"){const F=!s.paint.get("fill-extrusion-pattern").constantOr(1),B=s.paint.get("fill-extrusion-color").constantOr(i.al.white);if(!P&&B.a!==0){const j=new Xt(d.context.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D);m===1&&F?eu(d,t,s,h,j,br.disabled,Dr.unblended,z):(eu(d,t,s,h,j,br.disabled,Dr.disabled,z),eu(d,t,s,h,j,d.stencilModeFor3D(),d.colorModeForRenderPass(),z),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&F&&(!I&&d.transform.projection.name!=="globe"||P)){const j=s.paint.get("fill-extrusion-opacity"),X=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),J=s.paint.get("fill-extrusion-flood-light-intensity"),Q=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",oe=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(Q?null:s.lut).toArray01().slice(0,3),ue=X>0&&q>0,ce=J>0,ye=(ge,me,we)=>(1-we)*ge+we*me,pe=ge=>{const me=d.depthModeForSublayer(1,Xt.ReadOnly,x.LEQUAL,!0),we=s.paint.get(ge?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ee=ye(.1,3,we),He=d._showOverdrawInspector;if(!He){const Be=new br({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),rt=new Dr([x.ONE,x.ONE,x.ONE,x.ONE],i.al.transparent,[!1,!1,!1,!0],x.MIN);nl(d,t,s,h,me,Be,rt,fr.disabled,ge,"sdf",j,X,q,J,oe,Ee,z,!1)}{const Be=He?br.disabled:new br({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),rt=He?d.colorModeForRenderPass():new Dr([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],i.al.transparent,[!0,!0,!0,!0]);nl(d,t,s,h,me,Be,rt,fr.disabled,ge,"color",j,X,q,J,oe,Ee,z,!1)}};if(P){const ge=(me,we,Ee)=>{const He=d.depthModeForSublayer(1,Xt.ReadOnly,x.LEQUAL,!1),Be=s.paint.get(me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),rt=ye(.1,3,Be);{const nt=new Dr([x.ONE,x.ONE,x.ONE,x.ONE],i.al.transparent,[!1,!1,!1,!0]);nl(d,t,s,h,He,br.disabled,nt,fr.disabled,me,"clear",j,X,q,J,oe,rt,z,we)}{const nt=new br({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),yt=new Dr([x.ONE,x.ONE,x.ONE,x.ONE],i.al.transparent,[!1,!1,!1,!0],x.MIN);nl(d,t,s,h,He,nt,yt,fr.disabled,me,"sdf",j,X,q,J,oe,rt,z,we)}{const nt=me?x.ZERO:x.ONE_MINUS_DST_ALPHA,yt=new br({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Oe=new Dr([nt,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],i.al.transparent,[!0,!0,!0,!0]);nl(d,t,s,h,He,yt,Oe,fr.disabled,me,"color",j,X,q,J,oe,rt,z,we)}{const nt=new Dr([x.ONE,x.ONE,x.ONE,me?x.ZERO:x.ONE],i.al.transparent,[!1,!1,!1,!0],me?x.FUNC_ADD:x.MAX);nl(d,t,s,h,He,br.disabled,nt,fr.disabled,me,"clear",j,X,q,J,oe,rt,z,we,Ee)}};if(ue||ce){let me;if(d.prepareDrawTile(),I){const we=I.drapeBufferSize[0],Ee=I.drapeBufferSize[1];me=I.framebufferCopyTexture,me&&(!me||me.size[0]===we&&me.size[1]===Ee)||(me&&me.destroy(),me=I.framebufferCopyTexture=new i.T(g,new i.r({width:we,height:Ee}),x.RGBA8)),me.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,we,Ee)}ue&&ge(!0,!1,me),ce&&ge(!1,!0,me)}}else ue&&pe(!0),ce&&pe(!1),(ue||ce)&&d.resetStencilClippingMasks()}}},hillshade:function(d,t,s,h){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const m=d.context,g=d.terrain&&d.terrain.renderingToTexture,[x,I]=d.renderPass!=="translucent"||g?[{},h]:d.stencilConfigForOverlap(h);for(const P of I){const z=t.getTile(P);if(z.needsHillshadePrepare&&d.renderPass==="offscreen")d_(d,z,s);else if(d.renderPass==="translucent"){const L=d.depthModeForSublayer(0,Xt.ReadOnly),F=s.paint.get("hillshade-emissive-strength"),B=d.colorModeForDrapableLayerRenderPass(F),j=g&&d.terrain?d.terrain.stencilModeForRTTOverlap(P):x[P.overscaledZ];h_(d,P,z,s,L,j,B)}}m.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,t,s,h,m,g){if(d.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const x=d.transform.projection.name==="globe",I=s.paint.get("raster-elevation")!==0,P=I&&x;if(d.renderElevatedRasterBackface&&!P)return;const z=d.context,L=z.gl,F=t.getSource(),B=function(pe,ge,me,we){const Ee=ge.paint.get("raster-color"),He=pe.type==="raster-array",Be=[],rt=ge.paint.get("raster-resampling"),nt=ge.paint.get("raster-color-mix");let yt=ge.paint.get("raster-color-range");const Oe=[nt[0],nt[1],nt[2],0],tt=nt[3];let ze=rt==="nearest"?we.NEAREST:we.LINEAR;if(He&&(Be.push("RASTER_ARRAY"),Ee||Be.push("RASTER_COLOR"),rt==="linear"&&Be.push("RASTER_ARRAY_LINEAR"),ze=we.NEAREST,!yt&&pe.rasterLayers)){const Qe=pe.rasterLayers.find(({id:Ze})=>Ze===ge.sourceLayer);Qe&&Qe.fields&&Qe.fields.range&&(yt=Qe.fields.range)}if(yt=yt||[0,1],Ee){Be.push("RASTER_COLOR"),me.activeTexture.set(we.TEXTURE2),ge.updateColorRamp(yt);let Qe=ge.colorRampTexture;Qe||(Qe=ge.colorRampTexture=new i.T(me,ge.colorRamp,we.RGBA8)),Qe.bind(we.LINEAR,we.CLAMP_TO_EDGE)}return{mix:Oe,range:yt,offset:tt,defines:Be,resampling:ze}}(F,s,z,L);if(F instanceof i.aK&&!h.length&&!x)return;const j=s.paint.get("raster-emissive-strength"),X=d.colorModeForDrapableLayerRenderPass(j),q=d.terrain&&d.terrain.renderingToTexture,J=!d.options.moving,Q=s.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(F instanceof i.aK&&!h.length&&(F.onNorthPole||F.onSouthPole)){const pe=I?d.stencilModeFor3D():br.disabled;return void $n(!!F.onNorthPole,null,d,t,s,j,B,fr.disabled,pe)}if(!h.length)return;const[oe,ue]=F instanceof i.aK||q?[{},h]:d.stencilConfigForOverlap(h),ce=ue[ue.length-1].overscaledZ;P&&B.defines.push("PROJECTION_GLOBE_VIEW"),I&&B.defines.push("RENDER_CUTOFF");const ye=(pe,ge,me)=>{for(const we of pe){const Ee=we.toUnwrapped(),He=t.getTile(we);if(q&&(!He||!He.hasData()))continue;z.activeTexture.set(L.TEXTURE0);const Be=R_(He,F,s,B);if(!Be||!Be.texture)continue;const{texture:rt,mix:nt,offset:yt,tileSize:Oe,buffer:tt}=Be;let ze,Qe;q?(ze=Xt.disabled,Qe=we.projMatrix):I?(ze=new Xt(L.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D),Qe=x?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(Ee,J)):(ze=d.depthModeForSublayer(we.overscaledZ-ce,s.paint.get("raster-opacity")===1?Xt.ReadWrite:Xt.ReadOnly,L.LESS),Qe=d.transform.calculateProjMatrix(Ee,J));const Ze=d.terrain&&q?d.terrain.stencilModeForRTTOverlap(we):oe[we.overscaledZ],at=g?0:s.paint.get("raster-fade-duration");He.registerFadeDuration(at);const $e=t.findLoadedParent(we,0),ut=Ll(He,$e,t,d.transform,at);let St,Mt;d.terrain&&d.terrain.prepareDrawTile(),z.activeTexture.set(L.TEXTURE0),rt.bind(Q,L.CLAMP_TO_EDGE),z.activeTexture.set(L.TEXTURE1),$e?($e.texture&&$e.texture.bind(Q,L.CLAMP_TO_EDGE),St=Math.pow(2,$e.tileID.overscaledZ-He.tileID.overscaledZ),Mt=[He.tileID.canonical.x*St%1,He.tileID.canonical.y*St%1]):rt.bind(Q,L.CLAMP_TO_EDGE),"useMipmap"in rt&&z.extTextureFilterAnisotropic&&d.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Lt=d.transform;let Wt;const pr=I?Ue(Lt):[0,0,0,0];let sr,mr,hr,Br,on,mn=0;if(P&&F instanceof i.aK&&F.coordinates.length>3)sr=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0)))),mr=Float32Array.from(Lt.globeMatrix),hr=Float32Array.from(i.cE(Lt)),Br=[i.av(Lt.center.lng),i.aC(Lt.center.lat)],Wt=F.elevatedGlobePerspectiveTransform,on=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(P){const gr=i.cF(we.canonical);mn=i.cG(gr.getCenter().lat),sr=Float32Array.from(i.bc(i.cI(we.canonical))),mr=Float32Array.from(Lt.globeMatrix),hr=Float32Array.from(i.cE(Lt)),Br=[i.av(Lt.center.lng),i.aC(Lt.center.lat)],Wt=[0,0],on=Float32Array.from(i.cH(we.canonical,gr,mn,Lt.worldSize/Lt._pixelsPerMercatorPixel))}else Wt=F instanceof i.aK?F.perspectiveTransform:[0,0],sr=new Float32Array(16),mr=new Float32Array(9),hr=new Float32Array(16),Br=[0,0],on=new Float32Array(9);const zr=kf(Qe,sr,mr,hr,on,Mt||[0,0],i.ag(d.transform.zoom),Br,pr,St||1,ut,s,Wt,I?s.paint.get("raster-elevation"):0,2,nt,yt,B.range,Oe,tt,j),On=d.isTileAffectedByFog(we),wr=d.getOrCreateProgram("raster",{defines:B.defines,overrideFog:On});if(d.uploadCommonUniforms(z,wr,Ee),F instanceof i.aK){const gr=F.elevatedGlobeVertexBuffer,or=F.elevatedGlobeIndexBuffer;if(q||!x)F.boundsBuffer&&F.boundsSegments&&wr.draw(d,L.TRIANGLES,ze,br.disabled,X,fr.disabled,zr,s.id,F.boundsBuffer,d.quadTriangleIndexBuffer,F.boundsSegments);else if(gr&&or){const en=Lt.zoom<=i.c6?F.elevatedGlobeSegments:F.getSegmentsForLongitude(Lt.center.lng);en&&wr.draw(d,L.TRIANGLES,ze,br.disabled,X,ge,zr,s.id,gr,or,en)}}else if(P){ze=new Xt(L.LEQUAL,Xt.ReadOnly,d.depthRangeFor3D);const gr=d.globeSharedBuffers;if(gr){const[or,en,tn]=gr.getGridBuffers(mn,!1);wr.draw(d,L.TRIANGLES,ze,me||Ze,d.colorModeForRenderPass(),ge,zr,s.id,or,en,tn)}}else{const{tileBoundsBuffer:gr,tileBoundsIndexBuffer:or,tileBoundsSegments:en}=d.getTileBoundsBuffers(He);wr.draw(d,L.TRIANGLES,ze,Ze,X,fr.disabled,zr,s.id,gr,or,en)}}if(!(F instanceof i.aK)&&P)for(const we of pe){const Ee=we.canonical.y===(1<<we.canonical.z)-1;we.canonical.y===0&&$n(!0,we,d,t,s,j,B,ge,me||br.disabled),Ee&&$n(!1,we,d,t,s,j,B,ge===fr.frontCW?fr.backCW:fr.frontCW,me||br.disabled)}};P?ye(ue,d.renderElevatedRasterBackface?fr.backCW:fr.frontCW,d.stencilModeFor3D()):ye(ue,fr.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,t,s,h,m,g){d.renderPass==="offscreen"&&function(x,I,P,z){if(!z.length)return;const L=x.context,F=L.gl,B=I.getSource();if(!(B instanceof ws))return;const j=Math.ceil(Math.sqrt(P.paint.get("raster-particle-count")));let X=P.particlePositionRGBAImage;if(!X||X.width!==j){const ue=function(ce){const ye=ce*ce,pe=new Uint8Array(4*ye),ge=function(we){return we|=0,we=Math.imul(2747636419^we,2654435769),we=Math.imul(we^we>>>16,2654435769),((we=Math.imul(we^we>>>16,2654435769))>>>0)/4294967296},me=1/1.1;for(let we=0;we<ye;we++){const Ee=me*(ge(2*we+0)+As),He=me*(ge(2*we+1)+As),Be=255*Ee%1,rt=255*He%1,nt=Be,yt=He-rt/255,Oe=rt;pe[4*we+0]=255*(Ee-Be/255),pe[4*we+1]=255*nt,pe[4*we+2]=255*yt,pe[4*we+3]=255*Oe}return pe}(j);X=P.particlePositionRGBAImage=new i.r({width:j,height:j},ue)}let q=P.particleFramebuffer;q?q.width!==j&&(q.destroy(),q=P.particleFramebuffer=L.createFramebuffer(j,j,!0,null)):q=P.particleFramebuffer=L.createFramebuffer(j,j,!0,null);const J=[];for(const ue of z){const ce=I.getTile(ue);if(!(ce instanceof ga))continue;const ye=Hf(ce,B,P);if(!ye)continue;const pe=[ce.tileSize,ce.tileSize];let ge=P.tileFramebuffer;ge||(ge=P.tileFramebuffer=L.createFramebuffer(pe[0],pe[1],!0,null));let me=ce.rasterParticleState;me||(me=ce.rasterParticleState=new Gf(L,ue,pe,X));const we=me.update(P.lastInvalidatedAt);me.particleTextureDimension!==j&&me.updateParticleTexture(ue,X);const Ee=me.targetColorTexture;me.targetColorTexture=me.backgroundColorTexture,me.backgroundColorTexture=Ee;const He=me.particleTexture0;me.particleTexture0=me.particleTexture1,me.particleTexture1=He,J.push([ue,ye,me,we])}if(J.length===0)return;const Q=i.q.now(),oe=P.previousDrawTimestamp?.001*(Q-P.previousDrawTimestamp):.0167;if(P.previousDrawTimestamp=Q,P.hasColorMap()){L.activeTexture.set(F.TEXTURE0+2);let ue=P.colorRampTexture;ue||(ue=P.colorRampTexture=new i.T(L,P.colorRamp,F.RGBA8)),ue.bind(F.LINEAR,F.CLAMP_TO_EDGE)}L.bindFramebuffer.set(P.tileFramebuffer.framebuffer),function(ue,ce,ye){const pe=ue.context,ge=pe.gl,me=ce.tileFramebuffer;pe.activeTexture.set(ge.TEXTURE0);const we={u_texture:0,u_opacity:1.05*(He=ce.paint.get("raster-particle-fade-opacity-factor"))/(He+.05)},Ee=ue.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var He;for(const Be of ye){const[,,rt,nt]=Be;me.colorAttachment.set(rt.targetColorTexture.texture),pe.viewport.set([0,0,me.width,me.height]),pe.clear({color:i.al.transparent}),nt&&(rt.backgroundColorTexture.bind(ge.NEAREST,ge.CLAMP_TO_EDGE),Ee.draw(ue,ge.TRIANGLES,Xt.disabled,br.disabled,Dr.alphaBlended,fr.disabled,we,ce.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments))}}(x,P,J),function(ue,ce,ye,pe){const ge=ue.context,me=ge.gl,we=ye.tileFramebuffer,Ee=ue.transform.projection.name==="globe",He=ye.paint.get("raster-particle-max-speed");for(const Be of pe){const[rt,nt,yt]=Be;ge.activeTexture.set(me.TEXTURE0+0),nt.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),we.colorAttachment.set(yt.targetColorTexture.texture);const Oe=ue.getOrCreateProgram("rasterParticleDraw",{defines:nt.defines,overrideFog:!1});ge.activeTexture.set(me.TEXTURE0+1);const tt=nt.scalarData?[]:[0,1,2,3].map(Ze=>i.d7[Ze](rt));tt.push(rt);const ze=rt.canonical.x,Qe=rt.canonical.y;for(const Ze of tt){const at=ce.getTile(Ee?Ze.wrapped():Ze);if(!at)continue;const $e=at.rasterParticleState;if(!$e)continue;const ut=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-rt.wrap),St=Ze.canonical.y;$e.particleTexture0.bind(me.NEAREST,me.CLAMP_TO_EDGE);const Mt=er(1,$e.particleTexture0.size[0],[ut-ze,St-Qe],0,nt.texture.size,2,He,nt.textureOffset,nt.scale,nt.offset);Oe.draw(ue,me.POINTS,Xt.disabled,br.disabled,Dr.alphaBlended,fr.disabled,Mt,ye.id,$e.particleIndexBuffer,void 0,$e.particleSegment)}}}(x,I,P,J),L.bindFramebuffer.set(P.particleFramebuffer.framebuffer),function(ue,ce,ye,pe){const ge=ue.context,me=ge.gl,we=ce.paint.get("raster-particle-max-speed"),Ee=pe*ce.paint.get("raster-particle-speed-factor")*.15,He=function(rt){return Math.pow(rt,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Be=ce.particleFramebuffer;ge.viewport.set([0,0,Be.width,Be.height]);for(const rt of ye){const[,nt,yt]=rt;ge.activeTexture.set(me.TEXTURE0+0),nt.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),ge.activeTexture.set(me.TEXTURE0+1);const Oe=yt.particleTexture0;Oe.bind(me.NEAREST,me.CLAMP_TO_EDGE);const tt=Ff(1,Oe.size[0],0,nt.texture.size,we,Ee,He,nt.textureOffset,nt.scale,nt.offset);Be.colorAttachment.set(yt.particleTexture1.texture),ge.clear({color:i.al.transparent}),ue.getOrCreateProgram("rasterParticleUpdate",{defines:nt.defines}).draw(ue,me.TRIANGLES,Xt.disabled,br.disabled,Dr.unblended,fr.disabled,tt,ce.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments)}}(x,P,J,oe)}(d,t,s,h),d.renderPass==="translucent"&&(function(x,I,P,z,L){const F=x.context,B=F.gl,j=I.getSource().tileSize,X=5*(1-i.ae(i.bY,i.bY+1,x.transform.zoom))*j+P.paint.get("raster-particle-elevation"),q=!x.options.moving,J=x.transform.projection.name==="globe";if(!z.length)return;const[Q,oe]=x.stencilConfigForOverlap(z),ue=[];J&&ue.push("PROJECTION_GLOBE_VIEW");const ce=x.stencilModeFor3D();for(const ye of oe){const pe=ye.toUnwrapped(),ge=I.getTile(ye);if(!ge.rasterParticleState)continue;const me=ge.rasterParticleState,we=100;ge.registerFadeDuration(we);const Ee=I.findLoadedParent(ye,0),He=Ll(ge,Ee,I,x.transform,we);let Be,rt;x.terrain&&x.terrain.prepareDrawTile(),F.activeTexture.set(B.TEXTURE0),me.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),F.activeTexture.set(B.TEXTURE1),Ee&&Ee.rasterParticleState?(Ee.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Be=Math.pow(2,Ee.tileID.overscaledZ-ge.tileID.overscaledZ),rt=[ge.tileID.canonical.x*Be%1,ge.tileID.canonical.y*Be%1]):me.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const nt=J?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(pe,q),yt=x.transform,Oe=D_(yt),tt=i.cF(ye.canonical),ze=i.cG(tt.getCenter().lat);let Qe,Ze,at,$e,ut;J?(Qe=Float32Array.from(i.bc(i.cI(ye.canonical))),Ze=Float32Array.from(yt.globeMatrix),at=Float32Array.from(i.cE(yt)),$e=[i.av(yt.center.lng),i.aC(yt.center.lat)],ut=Float32Array.from(i.cH(ye.canonical,tt,ze,yt.worldSize/yt._pixelsPerMercatorPixel))):(Qe=new Float32Array(16),Ze=new Float32Array(9),at=new Float32Array(16),$e=[0,0],ut=new Float32Array(9));const St=Ta(nt,Qe,Ze,at,ut,rt||[0,0],i.ag(x.transform.zoom),$e,Oe,Be||1,He,X),Mt=x.isTileAffectedByFog(ye),Lt=x.getOrCreateProgram("rasterParticle",{defines:ue,overrideFog:Mt});if(x.uploadCommonUniforms(F,Lt,pe),J){const Wt=new Xt(B.LEQUAL,Xt.ReadOnly,x.depthRangeFor3D),pr=0,sr=x.globeSharedBuffers;if(sr){const[mr,hr,Br]=sr.getGridBuffers(ze,pr!==0);Lt.draw(x,B.TRIANGLES,Wt,ce,Dr.alphaBlended,x.renderElevatedRasterBackface?fr.frontCCW:fr.backCCW,St,P.id,mr,hr,Br)}}else{const Wt=x.depthModeForSublayer(0,Xt.ReadOnly),pr=Q[ye.overscaledZ],{tileBoundsBuffer:sr,tileBoundsIndexBuffer:mr,tileBoundsSegments:hr}=x.getTileBoundsBuffers(ge);Lt.draw(x,B.TRIANGLES,Wt,pr,Dr.alphaBlended,fr.disabled,St,P.id,sr,mr,hr)}}x.resetStencilClippingMasks()}(d,t,s,h),d.style.map.triggerRepaint())},background:function(d,t,s,h){const m=s.paint.get("background-color"),g=s.paint.get("background-color-use-theme").constantOr("default")==="none",x=s.paint.get("background-opacity"),I=s.paint.get("background-emissive-strength"),P=s.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const z=d.context,L=z.gl,F=d.transform,B=F.tileSize,j=s.paint.get("background-pattern");let X;if(j!==void 0&&(j===null||(X=d.imageManager.getPattern(i.I.from(j.toString()),s.scope,d.style.getLut(s.scope)),!X)))return;const q=!j&&m.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==q)return;const J=br.disabled,Q=d.depthModeForSublayer(0,q==="opaque"?Xt.ReadWrite:Xt.ReadOnly),oe=d.colorModeForDrapableLayerRenderPass(I),ue=j?"backgroundPattern":"background";let ce,ye=h;if(ye||(ce=d.getBackgroundTiles(),ye=Object.values(ce).map(pe=>pe.tileID)),j&&(z.activeTexture.set(L.TEXTURE0),d.imageManager.bind(d.context,s.scope)),P){const pe=d.getOrCreateProgram(ue,{overrideFog:!1,overrideRtt:!0}),ge=new Float32Array(i.ad.mat4.identity([])),me=new i.aH(0,0,0,0,0),we=j?Bf(ge,I,x,d,0,s.scope,X,P,{tileID:me,tileSize:B}):Ah(ge,I,x,m.toRenderColor(g?null:s.lut));pe.draw(d,L.TRIANGLES,Q,J,oe,fr.disabled,we,s.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const pe of ye){const ge=d.isTileAffectedByFog(pe),me=d.getOrCreateProgram(ue,{overrideFog:ge}),we=pe.toUnwrapped(),Ee=h?pe.projMatrix:d.transform.calculateProjMatrix(we);d.prepareDrawTile();const He=t?t.getTile(pe):ce?ce[pe.key]:new _a(pe,B,F.zoom,d),Be=j?Bf(Ee,I,x,d,0,s.scope,X,P,{tileID:pe,tileSize:B}):Ah(Ee,I,x,m.toRenderColor(g?null:s.lut));d.uploadCommonUniforms(z,me,we);const{tileBoundsBuffer:rt,tileBoundsIndexBuffer:nt,tileBoundsSegments:yt}=d.getTileBoundsBuffers(He);me.draw(d,L.TRIANGLES,Q,J,oe,fr.disabled,Be,s.id,rt,nt,yt)}},sky:function(d,t,s){const h=d._atmosphere?i.ag(d.transform.zoom):1,m=s.paint.get("sky-opacity")*h;if(m===0)return;const g=d.context,x=s.paint.get("sky-type"),I=new Xt(g.gl.LEQUAL,Xt.ReadOnly,[0,1]),P=d.frameCounter/1e3%1;x==="atmosphere"?d.renderPass==="offscreen"?s.needsSkyboxCapture(d)&&(function(z,L,F,B){const j=z.context,X=j.gl;let q=L.skyboxFbo;if(!q){q=L.skyboxFbo=j.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Wf(j),L.skyboxTexture=j.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,L.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let ue=0;ue<6;++ue)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(q.framebuffer),j.viewport.set([0,0,32,32]);const J=L.getCenter(z,!0),Q=z.getOrCreateProgram("skyboxCapture"),oe=new Float64Array(16);i.ad.mat4.identity(oe),i.ad.mat4.rotateY(oe,oe,.5*-Math.PI),$l(z,L,Q,oe,J,0),i.ad.mat4.identity(oe),i.ad.mat4.rotateY(oe,oe,.5*Math.PI),$l(z,L,Q,oe,J,1),i.ad.mat4.identity(oe),i.ad.mat4.rotateX(oe,oe,.5*-Math.PI),$l(z,L,Q,oe,J,2),i.ad.mat4.identity(oe),i.ad.mat4.rotateX(oe,oe,.5*Math.PI),$l(z,L,Q,oe,J,3),i.ad.mat4.identity(oe),$l(z,L,Q,oe,J,4),i.ad.mat4.identity(oe),i.ad.mat4.rotateY(oe,oe,Math.PI),$l(z,L,Q,oe,J,5),j.viewport.set([0,0,z.width,z.height])}(d,s),s.markSkyboxValid(d)):d.renderPass==="sky"&&function(z,L,F,B,j){const X=z.context,q=X.gl,J=z.transform,Q=z.getOrCreateProgram("skybox");X.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,L.skyboxTexture);const oe=((ue,ce,ye,pe,ge)=>({u_matrix:ue,u_sun_direction:ce,u_cubemap:0,u_opacity:pe,u_temporal_offset:ge}))(J.skyboxMatrix,L.getCenter(z,!1),0,B,j);z.uploadCommonUniforms(X,Q),Q.draw(z,q.TRIANGLES,F,br.disabled,z.colorModeForRenderPass(),fr.backCW,oe,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,s,I,m,P):x==="gradient"&&d.renderPass==="sky"&&function(z,L,F,B,j){const X=z.context,q=X.gl,J=z.transform,Q=z.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Wf(X)),X.activeTexture.set(q.TEXTURE0);let oe=L.colorRampTexture;oe||(oe=L.colorRampTexture=new i.T(X,L.colorRamp,q.RGBA8)),oe.bind(q.LINEAR,q.CLAMP_TO_EDGE);const ue=((ce,ye,pe,ge,me)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:ye,u_radius:i.ak(pe),u_opacity:ge,u_temporal_offset:me}))(J.skyboxMatrix,L.getCenter(z,!1),L.paint.get("sky-gradient-radius"),B,j);z.uploadCommonUniforms(X,Q),Q.draw(z,q.TRIANGLES,F,br.disabled,z.colorModeForRenderPass(),fr.backCW,ue,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,s,I,m,P)},debug:function(d,t,s,h,m,g){for(let x=0;x<s.length;x++)if(m){const z=new i.al(h.r*.8,h.g*.8,h.b*.8,1);Ko(d,t,s[x],h,-1,-1,g),Ko(d,t,s[x],h,-1,1,g),Ko(d,t,s[x],h,1,1,g),Ko(d,t,s[x],h,1,-1,g),Ko(d,t,s[x],z,0,0,g)}else Ko(d,t,s[x],h,0,0,g)},custom:function(d,t,s,h){const m=d.context,g=s.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&s.isDraped(t)){if(d.renderPass==="offscreen"){const x=g.prerender;if(x){if(d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const I=d.transform.pointMerc;x.call(g,m.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.ag(d.transform.zoom),[I.x,I.y],d.transform.pixelsPerMeterRatio)}else x.call(g,m.gl,d.transform.customLayerMatrix());m.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const I=g.renderToTile;if(I){const P=h[0].canonical,z=new i.ac(P.x+h[0].wrap*(1<<P.z),P.y,P.z);m.setDepthMode(Xt.disabled),m.setStencilMode(br.disabled),m.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),I.call(g,m.gl,z),m.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),m.setStencilMode(br.disabled);const x=g.renderingMode==="3d"?new Xt(d.context.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Xt.ReadOnly);if(m.setDepthMode(x),d.transform.projection.name==="globe"){const I=d.transform.pointMerc;g.render(m.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.ag(d.transform.zoom),[I.x,I.y],d.transform.pixelsPerMeterRatio)}else g.render(m.gl,d.transform.customLayerMatrix());m.setDirty(),d.setBaseState(),m.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,t,s,h){if(d.renderPass==="opaque")return;const m=s.paint.get("model-opacity").constantOr(1);if(m===0)return;const g=s.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!g||d.terrain&&m<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const x=d.shadowRenderer,I=s.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,I||(x.enabled=!1));const P=()=>{x&&(x.useNormalOffset=!0,I||(x.enabled=!0))},z=t.getSource();if(d.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(Q,oe,ue,ce,ye){const pe=Q.transform;if(pe.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${pe.projection.name} projection is not yet implemented`);const ge=pe.getFreeCameraOptions().position;if(!Q.modelManager)return;const me=Q.modelManager;ue.modelManager=me;const we=Q.shadowRenderer;if(!ue._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ee=ue._unevaluatedLayout._values["model-id"],He=Object.assign({},ue.layout.get("model-id").parameters),Be=Q.style.order.indexOf(ue.fqid);for(const rt of ce){const nt=oe.getTile(rt).getBucket(ue);if(!nt||nt.projection.name!==pe.projection.name)continue;const yt=nt.getModelUris();yt&&!nt.modelsRequested&&(me.addModelsFromBucket(yt,ye),nt.modelsRequested=!0);const Oe=Kf(rt,pe);He.zoom=Oe;const tt=Ee.possiblyEvaluate(He);if(Xf(Q,nt,rt),Zs.shadowUniformsInitialized=!1,Zs.useSingleShadowCascade=!!we&&we.getMaxCascadeForTile(rt.toUnwrapped())===0,Q.renderPass==="shadow"&&we){if(Q.currentShadowCascade===1&&nt.isInsideFirstShadowMapFrustum)continue;const Ze=pe.calculatePosMatrix(rt.toUnwrapped(),pe.worldSize);if(Zs.tileMatrix.set(Ze),Zs.shadowTileMatrix=Float32Array.from(we.calculateShadowPassMatrixFromMatrix(Ze)),Zs.aabb.min.fill(0),Zs.aabb.max[0]=Zs.aabb.max[1]=i.ai,Zs.aabb.max[2]=0,Ea(nt,Zs,Q,ue.scope))continue}const ze=1<<rt.canonical.z,Qe=[((ge.x-rt.wrap)*ze-rt.canonical.x)*i.ai,(ge.y*ze-rt.canonical.y)*i.ai,ge.z*ze*i.ai];Q.conflationActive&&Object.keys(nt.instancesPerModel).length>0&&Q.style.isLayerClipped(ue,oe.getSource())&&nt.updateReplacement(rt,Q.replacementSource,Be,ye)&&(nt.uploaded=!1,nt.upload(Q.context));for(let Ze in nt.instancesPerModel){const at=nt.instancesPerModel[Ze];at.features.length>0&&(Ze=tt.evaluate(at.features[0].feature,{}));const $e=me.getModel(Ze,ye);if($e&&$e.uploaded)for(const ut of $e.nodes)Fh(Q,ue,ut,at,Qe,rt,Zs)}}}(d,t,s,h,z.type==="vector"?s.scope:""),void P();if(!z.loaded())return;if(z.type==="batched-model")return function(Q,oe,ue,ce){ue.resetLayerRenderingStats(Q);const ye=Q.context,pe=Q.transform,ge=Q.style.fog,me=Q.shadowRenderer;if(pe.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${pe.projection.name} projection is not yet implemented`);const we=Q.transform.getFreeCameraOptions().position,Ee=i.ad.vec3.scale([],[we.x,we.y,we.z],Q.transform.worldSize),He=i.ad.vec3.negate([],Ee),Be=i.ad.mat4.identity([]),rt=i.dm(pe.center.lat,pe.zoom),nt=i.ad.mat4.fromScaling([],[1,1,1/rt]);i.ad.mat4.translate(Be,Be,He);const yt=ue.paint.get("model-opacity").constantOr(1),Oe=new Xt(ye.gl.LEQUAL,Xt.ReadWrite,Q.depthRangeFor3D),tt=new Xt(ye.gl.LEQUAL,Xt.ReadOnly,Q.depthRangeFor3D),ze=new i.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Qe=Q.renderPass==="shadow",Ze=Qe&&me?me.getCurrentCascadeFrustum():pe.getFrustum(pe.scaleZoom(pe.worldSize)),at=ue.paint.get("model-front-cutoff"),$e=at[2]<1,ut=ya(Q,ue.paint.get("model-cutoff-fade-range")),St=ue.getLayerRenderingStats();(function(Mt,Lt,Wt,pr){const sr=Mt.terrain?Mt.terrain.exaggeration():0,mr=Mt.transform.zoom;for(const hr of pr){const Br=Lt.getTile(hr).getBucket(Wt);Br&&(Br.setFilter(Wt.filter),Mt.conflationActive&&Br.updateReplacement(hr,Mt.replacementSource),Br.evaluateScale(Mt,Wt),Mt.terrain&&sr>0&&Br.elevationUpdate(Mt.terrain,sr,hr,Wt.source),Br.needsReEvaluation(Mt,mr,Wt)&&Br.evaluate(Wt))}})(Q,oe,ue,ce),function(){let Mt,Lt,Wt;$e?(Mt=ce.length-1,Lt=-1,Wt=-1):(Mt=0,Lt=ce.length,Wt=1);const pr=new Float64Array(16),sr=i.ad.vec3.create(),mr=new i.P(0,0);for(let hr=Mt;hr!==Lt;hr+=Wt){const Br=ce[hr],on=oe.getTile(Br).getBucket(ue);if(!on||!on.uploaded)continue;let mn=!1;me&&(mn=me.getMaxCascadeForTile(Br.toUnwrapped())===0);const zr=pe.calculatePosMatrix(Br.toUnwrapped(),pe.worldSize),On=on.modelTraits;!Qe&&$e&&(i.ad.mat4.invert(pr,zr),i.ad.vec3.transformMat4(sr,Ee,pr),mr.x=sr[0],mr.y=sr[1]);const wr=[];on.setFilter(ue.filter);for(const gr of on.getNodesInfo()){if(gr.hiddenByReplacement||!gr.node.meshes)continue;const or=gr.node;let en=0;Q.terrain&&or.elevation&&(en=or.elevation*Q.terrain.exaggeration());const tn=(()=>{const _n=gr.aabb;return ze.min=[..._n.min],ze.max=[..._n.max],ze.min[2]+=en,ze.max[2]+=en,i.ad.vec3.transformMat4(ze.min,ze.min,zr),i.ad.vec3.transformMat4(ze.max,ze.max,zr),ze})(),Wn=gr.evaluatedScale;if(Wn[0]<=1&&Wn[1]<=1&&Wn[2]<=1&&tn.intersects(Ze)===0)continue;if(!Qe&&$e){const _n=.16666666666666666;gr.cameraCollisionOpacity=Ee[0]>tn.min[0]&&Ee[0]<tn.max[0]&&Ee[1]>tn.min[1]&&Ee[1]<tn.max[1]&&Ee[2]*rt<tn.max[2]&&or.footprint&&i.bA(mr,or.footprint)?Math.max(gr.cameraCollisionOpacity-_n,0):Math.min(1,gr.cameraCollisionOpacity+_n)}const fi=[...zr],ts=or.anchor?or.anchor[0]:0,pi=or.anchor?or.anchor[1]:0;i.ad.mat4.translate(fi,fi,[ts*(Wn[0]-1),pi*(Wn[1]-1),en]),i.ad.vec3.exactEquals(Wn,i.dq)||i.ad.mat4.scale(fi,fi,Wn);const Ti=i.ad.mat4.multiply([],fi,or.matrix),Gi=i.ad.mat4.multiply([],pe.expandedFarZProjMatrix,Ti),rn=i.ad.mat4.multiply([],pe.expandedFarZProjMatrix,fi),Rn=i.ad.vec4.transformMat4([],[ts,pi,en,1],Gi)[2];or.hidden=!1;let an=yt;Qe||($e&&(an*=gr.cameraCollisionOpacity,an*=Nh(fi,pe,gr.aabb,at)),an*=Bh(ut,Rn)),an!==0?wr.push({nodeInfo:gr,depth:Rn,opacity:an,wvpForNode:Gi,wvpForTile:rn,nodeModelMatrix:Ti,tileModelMatrix:fi}):or.hidden=!0}Qe||wr.sort((gr,or)=>!$e||gr.opacity===1&&or.opacity===1?gr.depth<or.depth?-1:1:gr.opacity===1?-1:or.opacity===1?1:gr.depth>or.depth?-1:1);for(const gr of wr){const or=gr.nodeInfo,en=or.node;let tn=i.ad.mat4.multiply([],nt,gr.tileModelMatrix);i.ad.mat4.multiply(tn,Be,tn);const Wn=i.ad.mat4.invert([],tn);i.ad.mat4.transpose(Wn,Wn),i.ad.mat4.scale(Wn,Wn,Po),tn=i.ad.mat4.multiply(tn,tn,en.matrix);const fi=Q.renderPass==="light-beam",ts=ue.paint.get("model-color-use-theme").constantOr("default")==="none",pi=On&i.ds.HasMapboxMeshFeatures,Ti=pi?0:or.evaluatedRMEA[0][2];for(let Gi=0;Gi<en.meshes.length;++Gi){const rn=en.meshes[Gi],Rn=Gi===en.lightMeshIndex;let an=gr.wvpForNode;if(Rn){if(!fi&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}an=gr.wvpForTile}else if(fi)continue;const _n={defines:[]},_i=[];if(!Qe&&me&&(me.useNormalOffset=!!rn.normalBuffer),Co(_n.defines,_i,rn,Q,ts?null:ue.lut),pi||_n.defines.push("DIFFUSE_SHADED"),mn&&_n.defines.push("SHADOWS_SINGLE_CASCADE"),St&&(Qe?St.numRenderedVerticesInShadowPass+=rn.vertexArray.length:St.numRenderedVerticesInTransparentPass+=rn.vertexArray.length),Qe){Sa(rn,gr.nodeModelMatrix,Q,ue);continue}let Bn=null;if(ge){const Oi=Zf(gr.nodeModelMatrix,Q.transform);if(Bn=new Float32Array(Oi),pe.projection.name!=="globe"){const Rs=rn.aabb.min,Lo=rn.aabb.max,[co,Qo]=ge.getOpacityForBounds(Oi,Rs[0],Rs[1],Lo[0],Lo[1]);_n.overrideFog=co>=gt||Qo>=gt}}const ci=rn.material;let zo;ci.occlusionTexture&&ci.occlusionTexture.offsetScale&&(zo=ci.occlusionTexture.offsetScale,_n.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const rs=Q.getOrCreateProgram("model",_n);!Qe&&me&&me.setupShadowsFromMatrix(gr.tileModelMatrix,rs,me.useNormalOffset),Q.uploadCommonUniforms(ye,rs,null,Bn);const Ks=ci.pbrMetallicRoughness;Ks.metallicFactor=.9,Ks.roughnessFactor=.5;const Jo=Mh(new Float32Array(an),new Float32Array(tn),new Float32Array(Wn),new Float32Array(en.matrix),Q,gr.opacity,Ks.baseColorFactor.toRenderColor(null),ci.emissiveFactor,Ks.metallicFactor,Ks.roughnessFactor,ci,Ti,ue,[0,0,0],zo);!Rn&&(or.hasTranslucentParts||gr.opacity<1)&&rs.draw(Q,ye.gl.TRIANGLES,Oe,br.disabled,Dr.disabled,fr.backCCW,Jo,ue.id,rn.vertexBuffer,rn.indexBuffer,rn.segments,ue.paint,Q.transform.zoom,void 0,_i),rs.draw(Q,ye.gl.TRIANGLES,Rn?tt:Oe,br.disabled,Rn||gr.opacity<1||or.hasTranslucentParts?Dr.alphaBlended:Dr.unblended,fr.backCCW,Jo,ue.id,rn.vertexBuffer,rn.indexBuffer,rn.segments,ue.paint,Q.transform.zoom,void 0,_i)}}}}()}(d,t,s,h),void P();if(z.type!=="model")return;const L=z.getModels(),F=[],B=d.transform.getFreeCameraOptions().position,j=i.ad.vec3.scale([],[B.x,B.y,B.z],d.transform.worldSize);i.ad.vec3.negate(j,j);const X=[],q=[];let J=0;for(const Q of L){const oe=s.paint.get("model-rotation").constantOr(null),ue=s.paint.get("model-scale").constantOr(null),ce=s.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(d,oe,ue,ce,!0,!0,!1);const ye=i.ad.mat4.identity([]),pe=i.dm(Q.position.lat,d.transform.zoom),ge=i.ad.mat4.fromScaling([],[1,1,1/pe]);i.ad.mat4.translate(ye,ye,j),F.push({zScaleMatrix:ge,negCameraPosMatrix:ye});for(const me of Q.nodes)ol(d.transform,me,Q.matrix,d.transform.expandedFarZProjMatrix,J,X,q);J++}if(X.sort((Q,oe)=>oe.depth-Q.depth),d.renderPass!=="shadow"){if(m===1)for(const Q of q)sl(Q,d,s,F[Q.modelIndex],br.disabled,d.colorModeForRenderPass());else{for(const Q of q)sl(Q,d,s,F[Q.modelIndex],br.disabled,Dr.disabled);for(const Q of q)sl(Q,d,s,F[Q.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const Q of X)sl(Q,d,s,F[Q.modelIndex],br.disabled,d.colorModeForRenderPass());P()}else{for(const Q of q)Sa(Q.mesh,Q.nodeModelMatrix,d,s);for(const Q of X)Sa(Q.mesh,Q.nodeModelMatrix,d,s);P()}}},$h={line:function(d,t,s){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const h=t.getVisibleCoordinates();for(const m of h){const g=t.getTile(m).getBucket(d);if(g&&(g.hasZOffset?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,t,s){const h=t.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,h.type==="vector"?d.scope:""));if(h.type==="batched-model"||h.type!=="model")return;const m=h.getModels();for(const g of m)g.upload(s.context)},raster:function(d,t,s){const h=t.getSource();if(!(h instanceof ws&&h.loaded()))return;const m=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!m)return;const g=d.paint.get("raster-array-band")||h.getInitialBand(m);if(g==null)return;const x=t.getIds().map(I=>t.getTileByID(I));for(const I of x)I.updateNeeded(m,g)&&h.prepareTile(I,m,g)},"raster-particle":function(d,t,s){const h=t.getSource();if(!(h instanceof ws&&h.loaded()))return;const m=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!m)return;const g=d.paint.get("raster-particle-array-band")||h.getInitialBand(m);if(g==null)return;const x=t.getIds().map(I=>t.getTileByID(I));for(const I of x)I.updateNeeded(m,g)&&h.prepareTile(I,m,g)}},Gh={fill:Rh};class sp{constructor(t,s,h,m,g){this.context=new cs(t,s),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const P of x)this._debugParams.enabledLayers[P]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const P of x)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],P);this.occlusionParams=new al(g),this.setup(),this.numSublayers=Ss.maxUnderzooming+Ss.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ah(this),this._wireframeDebugCache=new Jf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,I,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m}updateTerrain(t,s){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new wh(this,t));const m=this._terrain;this.transform.elevation=h?m:null,m.update(t,this.transform,s),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=s.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const g=h+.78*(m-h);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new wh(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*i.q.devicePixelRatio,this.height=s*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const t=this.context,s=new i.b5;s.emplaceBack(0,0),s.emplaceBack(i.ai,0),s.emplaceBack(0,i.ai),s.emplaceBack(i.ai,i.ai),this.tileExtentBuffer=t.createVertexBuffer(s,i.b7.members),this.tileExtentSegments=i.b8.simpleSegment(0,0,4,2);const h=new i.b5;h.emplaceBack(0,0),h.emplaceBack(i.ai,0),h.emplaceBack(0,i.ai),h.emplaceBack(i.ai,i.ai),this.debugBuffer=t.createVertexBuffer(h,i.b7.members),this.debugSegments=i.b8.simpleSegment(0,0,4,5);const m=new i.b5;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,i.b7.members),this.viewportSegments=i.b8.simpleSegment(0,0,4,2);const g=new i.aU;g.emplaceBack(0,0,0,0),g.emplaceBack(i.ai,0,i.ai,0),g.emplaceBack(0,i.ai,0,i.ai),g.emplaceBack(i.ai,i.ai,i.ai,i.ai),this.mercatorBoundsBuffer=t.createVertexBuffer(g,i.ba.members),this.mercatorBoundsSegments=i.b8.simpleSegment(0,0,4,2);const x=new i.aV;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const I=new i.b6;for(const z of[0,1,3,2,0])I.emplaceBack(z);this.debugIndexBuffer=t.createIndexBuffer(I),this.emptyTexture=new i.T(t,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=i.ad.mat4.create();const P=this.context.gl;this.stencilClearMode=new br({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Xt.disabled,this.stencilClearMode,Dr.disabled,fr.disabled,Kc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,h){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const P of h)if(this._tileClippingMaskIDs[P.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=s.id;const m=this.context,g=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(Dr.disabled),m.setDepthMode(Xt.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of h){const P=s.getTile(I),z=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:F,tileBoundsSegments:B}=this.getTileBoundsBuffers(P);x.draw(this,g.TRIANGLES,Xt.disabled,new br({func:g.ALWAYS,mask:0},z,255,g.KEEP,g.KEEP,g.REPLACE),Dr.disabled,fr.disabled,Kc(I.projMatrix),"$clipping",L,F,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new br({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new br({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,h=t.sort((x,I)=>I.overscaledZ-x.overscaledZ),m=h[h.length-1].overscaledZ,g=h[0].overscaledZ-m+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let I=0;I<g;I++)x[I+m]=new br({func:s.GEQUAL,mask:255},I+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[x,h]}return[{[m]:br.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Dr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new i.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Dr.unblended:Dr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Dr([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new i.al(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,s,h,m=!1){if(this.depthOcclusion)return new Xt(this.context.gl.GREATER,Xt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return Xt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Xt(h||this.context.gl.LEQUAL,s,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),h=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),g=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&h!==0&&(this.depthFBO=new Ih(this.context,s,h,!1,"texture"),this.depthTexture=new i.T(this.context,{width:s,height:h,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,g),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,h,0,0,s,h,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,s)=>t+s/this._fpsHistory.length,0))}render(t,s){const h=i.q.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const m=this.style._mergedLayers,g=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(g).filter(Oe=>{const tt=m[Oe];return!(tt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[tt.type]});let I=x(),P=!1,z=!1;for(const Oe of I){const tt=m[Oe];tt.type==="circle"&&(P=!0),tt.type==="symbol"&&(tt.hasInitialOcclusionOpacityProperties?z=!0:P=!0)}let L=I.map(Oe=>m[Oe]);const F=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let B=0,j=!1;for(const Oe in F){const tt=F[Oe];tt.used&&(tt.prepare(this.context),tt.getSource().usedInConflation&&++B)}let X=!1;for(const Oe of L)Oe.isHidden(this.transform.zoom)||(Oe.type==="clip"&&(X=!0),this.prepareLayer(Oe));const q={},J={},Q={},oe={},ue={};for(const Oe in F){const tt=F[Oe];q[Oe]=tt.getVisibleCoordinates(),J[Oe]=q[Oe].slice().reverse(),Q[Oe]=tt.getVisibleCoordinates(!0).reverse(),oe[Oe]=tt.getShadowCasterCoordinates(),ue[Oe]=tt.sortCoordinatesByDistance(q[Oe])}const ce=Oe=>{const tt=this.style.getLayerSourceCache(Oe);return tt&&tt.used?tt.getSource():null};if(B||X||this._clippingActiveLastFrame){const Oe=[],tt=[];let ze=0;for(const Qe of L)this.isSourceForClippingOrConflation(Qe,ce(Qe))&&(Oe.push(Qe),tt.push(ze)),ze++;if(Oe&&(X||Oe.length>1)||this._clippingActiveLastFrame){X=!1;const Qe=[];for(let Ze=0;Ze<Oe.length;Ze++){const at=Oe[Ze],$e=tt[Ze],ut=this.style.getLayerSourceCache(at);if(!ut||!ut.used||!ut.getSource().usedInConflation&&at.type!=="clip")continue;let St=i.dA,Mt=i.by.None;const Lt=[];let Wt=!0;if(at.type==="clip"){St=$e;for(const pr of at.layout.get("clip-layer-types"))Mt|=pr==="model"?i.by.Model:pr==="symbol"?i.by.Symbol:i.by.FillExtrusion;for(const pr of at.layout.get("clip-layer-scope"))Lt.push(pr);at.isHidden(this.transform.zoom)?Wt=!1:X=!0}Wt&&Qe.push({layer:at.fqid,cache:ut,order:St,clipMask:Mt,clipScope:Lt})}this.replacementSource.setSources(Qe),j=!0}}this._clippingActiveLastFrame=X,j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Oe=0;Oe<L.length;Oe++){const tt=L[Oe],ze=tt.cutoffRange();if(this.longestCutoffRange=Math.max(ze,this.longestCutoffRange),ze>0){const Qe=ce(tt);Qe&&(this.minCutoffZoom=Math.max(Qe.minzoom,this.minCutoffZoom)),tt.minzoom&&(this.minCutoffZoom=Math.max(tt.minzoom,this.minCutoffZoom))}tt.is3D(g)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Oe),this._lastOcclusionLayer=Oe)}const ye=this.style&&this.style.fog;ye?(this._fogVisible=ye.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ye.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Q),this.opaquePassCutoff=0,I=x(),L=I.map(Oe=>m[Oe]));const pe=this._shadowRenderer;if(pe){pe.updateShadowParameters(this.transform,this.style.directionalLight);for(const Oe in F)for(const tt of q[Oe]){let ze={min:0,max:0};this.terrain&&(ze=this.terrain.getMinMaxForTile(tt)||ze),pe.addShadowReceiver(tt.toUnwrapped(),ze.min,ze.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Jr(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ge=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ge&&!this._snow&&(this._snow=new ip(this)),!ge&&this._snow&&(this._snow.destroy(),delete this._snow),me&&!this._rain&&(this._rain=new rp(this)),!me&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!vn.has(this.context.gl))return;this.renderPass="offscreen";for(const Oe of L){const tt=t.getLayerSourceCache(Oe);if(!Oe.hasOffscreenPass()||Oe.isHidden(this.transform.zoom))continue;const ze=tt?J[tt.id]:void 0;(Oe.type==="custom"||Oe.type==="raster"||Oe.type==="raster-particle"||Oe.isSky()||ze&&ze.length)&&this.renderLayer(this,tt,Oe,ze)}this.depthRangeFor3D=[0,1-(L.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,oe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const we=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ee=(()=>{if(s.showOverdrawInspector)return i.al.black;const Oe=this.style.fog;if(Oe&&this.transform.projection.supportsFog){const tt=this.style.getLut(Oe.scope);if(!we){const ze=Oe.properties.get("color-use-theme")==="none",Qe=Oe.properties.get("color").toRenderColor(ze?null:tt).toArray01();return new i.al(...Qe)}if(we){const ze=Oe.properties.get("space-color-use-theme")==="none",Qe=Oe.properties.get("space-color").toRenderColor(ze?null:tt).toArray01();return new i.al(...Qe)}}return i.al.transparent})();if(this.context.clear({color:Ee,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Oe=L[this.currentLayer],tt=t.getLayerSourceCache(Oe);if(Oe.isSky())continue;const ze=tt?(Oe.is3D(g)?ue:J)[tt.id]:void 0;this._renderTileClippingMasks(Oe,tt,ze),this.renderLayer(this,tt,Oe,ze)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Oe=L[this.currentLayer],tt=t.getLayerSourceCache(Oe);Oe.isSky()&&this.renderLayer(this,tt,Oe,tt?J[tt.id]:void 0)}function He(Oe,tt){let ze;return tt&&(ze=(Oe.type==="symbol"?Q:Oe.is3D(g)?ue:J)[tt.id]),ze}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const Oe=L[this.currentLayer];if(Oe.type==="raster"||Oe.type==="raster-particle"){const tt=t.getLayerSourceCache(Oe);this.renderLayer(this,tt,Oe,He(Oe,tt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Be=0;pe&&(Be=pe.getShadowCastingLayerCount());let rt=!1,nt=-1;for(let Oe=0;Oe<I.length;++Oe){const tt=L[Oe];tt.isHidden(this.transform.zoom)||tt.is3D(g)&&(nt=Oe)}z&&nt===-1&&(P=!0);let yt=!1;for(;this.currentLayer<I.length;){const Oe=L[this.currentLayer],tt=t.getLayerSourceCache(Oe);if(Oe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Oe)){if(Oe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!yt&&Oe.is3D(g)&&!g){const ze=this.currentLayer,Qe=Ze=>{for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const at=L[this.currentLayer];if(Gh[at.type]){const $e=this.style.getLayerSourceCache(at);Gh[at.type](this,$e,at,He(at,$e),Ze)}}};Qe("initialize"),Qe("reset"),this.currentLayer=ze,yt=!0}if(P&&!rt&&this.terrain&&!this.transform.isOrthographic&&(rt=!0,this.blitDepth()),z&&nt!==-1&&this.currentLayer===nt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Oe,tt,tt?q[tt.id]:void 0),this.renderLayer(this,tt,Oe,He(Oe,tt)),!this.terrain&&pe&&Be>0&&Oe.hasShadowPass()&&--Be==0&&(pe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ze=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ze;this.currentLayer++){const Qe=L[this.currentLayer];if(!Qe.hasLightBeamPass())continue;const Ze=t.getLayerSourceCache(Qe);this.renderLayer(this,Ze,Qe,Ze?J[Ze.id]:void 0)}this.currentLayer=ze,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ze=this.currentLayer;this.depthOcclusion=!0;for(const Qe of this.layersWithOcclusionOpacity){this.currentLayer=Qe;const Ze=L[this.currentLayer],at=t.getLayerSourceCache(Ze),$e=at?J[at.id]:void 0;this.terrain||this._renderTileClippingMasks(Ze,at,at?q[at.id]:void 0),this.renderLayer(this,at,Ze,$e)}this.depthOcclusion=!1,this.currentLayer=ze,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Oe=null;L.forEach(tt=>{const ze=t.getLayerSourceCache(tt);ze&&!tt.isHidden(this.transform.zoom)&&ze.getVisibleCoordinates().length&&(!Oe||Oe.getSource().maxzoom<ze.getSource().maxzoom)&&(Oe=ze)}),Oe&&this.options.showTileBoundaries&&Ia.debug(this,Oe,Oe.getVisibleCoordinates(),i.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ia.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Oe){const tt=Oe.transform.padding;Lh(Oe,Oe.transform.height-(tt.top||0),3,z_),Lh(Oe,tt.bottom||0,3,jl),qf(Oe,tt.left||0,3,O0),qf(Oe,Oe.transform.width-(tt.right||0),3,k0);const ze=Oe.transform.centerPoint;(function(Qe,Ze,at,$e){tu(Qe,Ze-1,at-10,2,20,$e),tu(Qe,Ze-10,at-1,20,2,$e)})(Oe,ze.x,Oe.transform.height-ze.y,L_)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,h=!s||!s.includes(t.type);if($h[t.type]&&(h||this.terrain&&t.type==="custom")){const m=this.style.getLayerSourceCache(t);$h[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,s,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)&&(!t.terrain||h.type!=="custom")||h.type==="clip"||Ia[h.type](t,s,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,h=this.context.gl;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:h.createQuery()}),m.calls++,h.beginQuery(s.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,h=s.createQuery();this.deferredRenderGpuTimeQueries.push(h),s.beginQuery(t.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const h in t){const m=t[h],g=this.context.extTimerQuery,x=g.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(m.query),s[h]=x}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let h=0;for(const m of t)h+=s.getQueryParameter(m,s.QUERY_RESULT)/1e6,s.deleteQuery(m);return h}translatePosMatrix(t,s,h,m,g){if(!h[0]&&!h[1])return t;const x=g?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(x){const z=Math.sin(x),L=Math.cos(x);h=[h[0]*L-h[1]*z,h[0]*z+h[1]*L]}const I=[g?h[0]:i.at(s,h[0],this.transform.zoom),g?h[1]:i.at(s,h[1],this.transform.zoom),0],P=new Float32Array(16);return i.ad.mat4.translate(P,t,I),P}saveTileTexture(t){const s=t.size[0],h=this._tileTextures[s];h?h.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,h){const m=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,g=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(g.push("LIGHTING_3D_MODE"),g.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||g.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||g.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(g.push("TERRAIN"),this.linearFloatFilteringSupported()&&g.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&g.push("GLOBE"),!this._fogVisible||m||s!==void 0&&!s||g.push("FOG","FOG_DITHERING"),m&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}getOrCreateProgram(t,s){this.cache=this.cache||{};const h=s&&s.defines||[],m=s&&s.config,g=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(h),x=T_.cacheKey(mh[t],t,g,m);return this.cache[x]||(this.cache[x]=new T_(this.context,t,mh[t],m,z0[t],g)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const h=this.style.directionalLight,m=this.style.ambientLight;if(h&&m){const g=((x,I,P)=>{const z=x.properties.get("direction"),L=x.properties.get("color-use-theme")==="none",F=x.properties.get("color").toRenderColor(L?null:P.getLut(x.scope)).toArray01(),B=x.properties.get("intensity"),j=I.properties.get("color-use-theme")==="none",X=I.properties.get("color").toRenderColor(j?null:P.getLut(I.scope)).toArray01(),q=I.properties.get("intensity"),J=[z.x,z.y,z.z],Q=i.cN(X,q),oe=i.cN(F,B);return{u_lighting_ambient_color:Q,u_lighting_directional_dir:J,u_lighting_directional_color:oe,u_ground_radiance:P0(J,oe,Q)}})(h,m,this.style);s.setLightsUniformValues(t,g)}}}uploadCommonUniforms(t,s,h,m,g){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const I=x.getOpacity(this.transform.pitch),P=((z,L,F,B,j,X,q,J,Q,oe,ue,ce)=>{const ye=z.transform,pe=L.properties.get("color-use-theme")==="none",ge=L.properties.get("color").toRenderColor(pe?null:z.style.getLut(L.scope)).toArray01();ge[3]=B;const me=z.frameCounter/1e3%1,[we,Ee]=L.properties.get("vertical-range");return{u_fog_matrix:F?ye.calculateFogTileMatrix(F):ce||z.identityMat,u_fog_range:L.getFovAdjustedRange(ye._fov),u_fog_color:ge,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(we,Ee),Ee],u_fog_temporal_offset:me,u_frustum_tl:j,u_frustum_tr:X,u_frustum_br:q,u_frustum_bl:J,u_globe_pos:Q,u_globe_radius:oe,u_viewport:ue,u_globe_transition:i.ag(ye.zoom),u_is_globe:+(ye.projection.name==="globe")}})(this,x,h,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],m);s.setFogUniformValues(t,P)}g&&s.setCutoffUniformValues(t,g.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const m of h)s[m.key]=t[m.key]||new _a(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=gt||s[1]>=gt}setupDepthForOcclusion(t,s,h){const m=this.context,g=m.gl,x=!!h;var I;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(g.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE0),x||s.setTerrainUniformValues(m,h)}}function nu(d,t){let s=!1,h=null;const m=()=>{h=null,s&&(d(),h=setTimeout(m,t),s=!1)};return()=>(s=!0,h||m(),h)}class op{constructor(t){this._hashName=t&&encodeURIComponent(t),i.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=nu(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=Hh(t);if(this._hashName){const h=this._hashName;let m=!1;const g=location.hash.slice(1).split("&").map(x=>{const I=x.split("=")[0];return I===h?(m=!0,`${I}=${s}`):x}).filter(x=>x);return m||g.push(`${h}=${s}`),`#${g.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Hh(d,t){const s=d.getCenter(),h=Math.round(100*d.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,m),x=Math.round(s.lng*g)/g,I=Math.round(s.lat*g)/g,P=d.getBearing(),z=d.getPitch();let L=t?`/${x}/${I}/${h}`:`${h}/${I}/${x}`;return(P||z)&&(L+="/"+Math.round(10*P)/10),z&&(L+=`/${Math.round(z)}`),L}const iu={linearity:.3,easing:i.dB(0,0,.3,1)},O_=i.l({deceleration:2500,maxSpeed:1400},iu),k_=i.l({deceleration:20,maxSpeed:1400},iu),F_=i.l({deceleration:1e3,maxSpeed:360},iu),B_=i.l({deceleration:1e3,maxSpeed:90},iu);class N_{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=i.q.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const g=ou(s.pan.mag(),h,i.l({},O_,t||{}));m.offset=s.pan.mult(g.amount/s.pan.mag()),m.center=this._map.transform.center,su(m,g)}if(s.zoom){const g=ou(s.zoom,h,k_);m.zoom=this._map.transform.zoom+g.amount,su(m,g)}if(s.bearing){const g=ou(s.bearing,h,F_);m.bearing=this._map.transform.bearing+i.ay(g.amount,-179,179),su(m,g)}if(s.pitch){const g=ou(s.pitch,h,B_);m.pitch=this._map.transform.pitch+g.amount,su(m,g)}if(m.zoom||m.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;m.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function su(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function ou(d,t,s){const{maxSpeed:h,linearity:m,deceleration:g}=s,x=i.ay(d*m/(t/1e3),-h,h),I=Math.abs(x)/(g*m);return{easing:s.easing,duration:1e3*I,amount:x*(I/2)}}class hs extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h,m={}){const g=Et(s.getCanvasContainer(),h),x=s.unproject(g);super(t,i.l({point:g,lngLat:x,originalEvent:h},m)),this._defaultPrevented=!1,this.target=s}}class au extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){const m=t==="touchend"?h.changedTouches:h.touches,g=pt(s.getCanvasContainer(),m),x=g.map(P=>s.unproject(P)),I=g.reduce((P,z,L,F)=>P.add(z.div(F.length)),new i.P(0,0));super(t,{points:g,point:I,lngLats:x,lngLat:s.unproject(I),originalEvent:h}),this._defaultPrevented=!1}}class V_ extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class U_{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new V_(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new hs(t.type,this._map,t))}mouseup(t){this._map.fire(new hs(t.type,this._map,t))}preclick(t){const s=i.l({},t);s.type="preclick",this._map.fire(new hs(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new hs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new hs(t.type,this._map,t))}mouseover(t){this._map.fire(new hs(t.type,this._map,t))}mouseout(t){this._map.fire(new hs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new au(t.type,this._map,t))}touchmove(t){this._map.fire(new au(t.type,this._map,t))}touchend(t){this._map.fire(new au(t.type,this._map,t))}touchcancel(t){this._map.fire(new au(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class j_{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new hs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new hs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new hs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class B0{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(ht(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const h=s,m=this._startPos,g=this._lastPos;if(!m||!g||g.equals(h)||!this._box&&h.dist(m)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=_e("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const x=Math.min(m.x,h.x),I=Math.max(m.x,h.x),P=Math.min(m.y,h.y),z=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${P}px)`,this._box.style.width=I-x+"px",this._box.style.height=z-P+"px")})}mouseupWindow(t,s){if(!this._active)return;const h=this._startPos,m=s;if(h&&t.button===0){if(this.reset(),Je(),h.x!==m.x||h.y!==m.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ft(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new i.A(t,{originalEvent:s}))}}function ap(d,t){const s={};for(let h=0;h<d.length;h++)s[d[h].identifier]=t[h];return s}class Gn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const g=new i.P(0,0);for(const x of m)g._add(x);return g.div(m.length)}(s),this.touches=ap(h,s)))}touchmove(t,s,h){if(this.aborted||!this.centroid)return;const m=ap(h,s);for(const g in this.touches){const x=m[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,s,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class qh{constructor(t){this.singleTap=new Gn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,h){this.singleTap.touchstart(t,s,h)}touchmove(t,s,h){this.singleTap.touchmove(t,s,h)}touchend(t,s,h){const m=this.singleTap.touchend(t,s,h);if(m){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(m)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class N0{constructor(){this._zoomIn=new qh({numTouches:1,numTaps:2}),this._zoomOut=new qh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,h){this._zoomIn.touchstart(t,s,h),this._zoomOut.touchstart(t,s,h)}touchmove(t,s,h){this._zoomIn.touchmove(t,s,h),this._zoomOut.touchmove(t,s,h)}touchend(t,s,h){const m=this._zoomIn.touchend(t,s,h),g=this._zoomOut.touchend(t,s,h);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(m)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const V0={0:1,2:2},Gl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Wh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const h=lt(t);this._correctButton(t,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(t,s){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(m,g){const x=V0[g];return m.buttons===void 0||(m.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(t){this._lastPoint&&lt(t)===this._eventButton&&(this._moved&&Je(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lp extends Wh{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class lu extends Wh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Gl[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=.8*(s.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Do extends Wh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Gl[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=-.5*(s.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Zh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),i.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(t,s,h){return this._calculateTransform(t,s,h)}touchmove(t,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!i.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,h)}}touchend(t,s,h){this._calculateTransform(t,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,h){h.length>0&&(this._active=!0);const m=ap(h,s),g=new i.P(0,0),x=new i.P(0,0);let I=0;for(const z in m){const L=m[z],F=this._touches[z];F&&(g._add(L),x._add(L.sub(F)),I++,m[z]=L)}if(this._touches=m,I<this._minTouches||!x.mag())return;const P=x.div(I);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(I),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=_e("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ei{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,h){return{}}touchstart(t,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,h){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[g,x]=m,I=Is(h,s,g),P=Is(h,s,x);if(!I||!P)return;const z=this._aroundCenter?null:I.add(P).div(2);return this._move([I,P],z,t)}touchend(t,s,h){if(!this._firstTwoTouches)return;const[m,g]=this._firstTwoTouches,x=Is(h,s,m),I=Is(h,s,g);x&&I||(this._active&&Je(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Is(d,t,s){for(let h=0;h<d.length;h++)if(d[h].identifier===s)return t[h]}function Xh(d,t){return Math.log(d/t)/Math.LN2}class Kh extends ei{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Xh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xh(this._distance,h),pinchAround:s}}}function cp(d,t){return 180*d.angleWith(t)/Math.PI}class U0 extends ei{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const h=this._vector;if(this._vector=t[0].sub(t[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:cp(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const m=cp(t,h);return Math.abs(m)<s}}function ll(d){return Math.abs(d.y)>Math.abs(d.x)}class j0 extends ei{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ll(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,h){const m=this._lastPoints;if(!m)return;const g=t[0].sub(m[0]),x=t[1].sub(m[1]);return this._map._cooperativeGestures&&!i.dC()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(g,x,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5})}gestureBeginsVertically(t,s,h){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,g=s.mag()>=2;if(!m&&!g)return;if(!m||!g)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return ll(t)&&ll(s)&&x}}const $0={panStep:100,bearingStep:15,pitchStep:10};class up{constructor(){const t=$0;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,h=0,m=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:I=>{const P=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:hp,zoom:s?Math.round(P)+s*(t.shiftKey?2:1):P,bearing:I.getBearing()+h*this._bearingStep,pitch:I.getPitch()+m*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:I.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function hp(d){return d*(2-d)}const Hl=4.000244140625,ql=1/450;class Yo{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ql,i.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||i.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=i.q.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%Hl==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Et(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Hl?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&L!==0&&(L=1/L);const F=s(),B=Math.pow(2,F),j=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(j*L))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,g=this._easing;let x,I=!1;if(this._type==="wheel"&&m&&g){const z=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),L=g(z);x=i.ah(m,h,L),z<1?this._frameId||(this._frameId=!0):I=!0}else x=h,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let P=x-s();return P*this._lastDelta<0&&(P=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:P,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=i.dD;if(this._prevEase){const h=this._prevEase,m=(i.q.now()-h.start)/h.duration,g=h.easing(m+.01)-h.easing(m),x=.27/Math.sqrt(g*g+1e-4)*.01,I=Math.sqrt(.0729-x*x);s=i.dB(x,I,.25,1)}return this._prevEase={start:i.q.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=_e("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ao{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ca{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cl{constructor(){this._tap=new qh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,s,h))}touchmove(t,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=s[0],g=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,h)}touchend(t,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,s,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Pa{constructor(t,s,h){this._el=t,this._mousePan=s,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class G0{constructor(t,s,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class H0{constructor(t,s,h,m){this._el=t,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Yh=d=>d.zoom||d.drag||d.pitch||d.rotate;class q0 extends i.A{}class $_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const h=i.ad.vec3.sub([],s,t);this.radius=i.ad.vec3.length(h[2]<0?i.ad.vec3.div([],h,this.constants):[h[0],h[1],0])}projectRay(t){i.ad.vec3.div(t,t,this.constants),i.ad.vec3.normalize(t,t),i.ad.vec3.mul(t,t,this.constants);const s=i.ad.vec3.scale([],t,this.radius);if(s[2]>0){const h=i.ad.vec3.scale([],[0,0,1],i.ad.vec3.dot(s,[0,0,1])),m=i.ad.vec3.scale([],i.ad.vec3.normalize([],[s[0],s[1],0]),this.radius),g=i.ad.vec3.add([],s,i.ad.vec3.scale([],i.ad.vec3.sub([],i.ad.vec3.add([],m,h),s),2));s[0]=g[0],s[1]=g[1]}return s}}function Ii(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class dp{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new N_(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new $_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),i.aQ(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,g,x]of this._listeners){const I=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(g,I,x)}}destroy(){for(const[t,s,h]of this._listeners){const m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,m,h)}}_addDefaultHandlers(t){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new U_(s,t));const m=s.boxZoom=new B0(s,t);this._add("boxZoom",m);const g=new N0,x=new Ca;s.doubleClickZoom=new ao(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const I=new cl;this._add("tapDragZoom",I);const P=s.touchPitch=new j0(s);this._add("touchPitch",P);const z=new lu(t),L=new Do(t);s.dragRotate=new G0(t,z,L),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const F=new lp(t),B=new Zh(s,t);s.dragPan=new Pa(h,F,B),this._add("mousePan",F),this._add("touchPan",B,["touchZoom","touchRotate"]);const j=new U0,X=new Kh;s.touchZoomRotate=new H0(h,X,j,I),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new j_(s));const q=s.scrollZoom=new Yo(s,this);this._add("scrollZoom",q,["mousePan"]);const J=s.keyboard=new up;this._add("keyboard",J);for(const Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Q]&&s[Q].enable(t[Q])}_add(t,s,h){this._handlers.push({handlerName:t,handler:s,allowed:h}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,h){for(const m in t)if(m!==h&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const h of t)this._el.contains(h.target)&&s.push(h);return s}handleEvent(t,s){this._updatingCamera=!0;const h=t.type==="renderFrame",m=h?void 0:t,g={needsRenderFrame:!1},x={},I={},P=t.touches?this._getMapTouches(t.touches):void 0,z=P?pt(this._el,P):h?void 0:Et(this._el,t);for(const{handlerName:B,handler:j,allowed:X}of this._handlers){if(!j.isEnabled())continue;let q;this._blockedByActive(I,X,B)?j.reset():j[s||t.type]&&(q=j[s||t.type](t,z,P),this.mergeHandlerResult(g,x,q,B,m),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||j.isActive())&&(I[B]=j)}const L={};for(const B in this._previousActiveHandlers)I[B]||(L[B]=m);this._previousActiveHandlers=I,(Object.keys(L).length||Ii(g))&&(this._changes.push([g,x,L]),this._triggerRenderFrame()),(Object.keys(I).length||Ii(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=g;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,s,h,m,g){if(!h)return;i.l(t,h);const x={handlerName:m,originalEvent:h.originalEvent||g};h.zoomDelta!==void 0&&(s.zoom=x),h.panDelta!==void 0&&(s.drag=x),h.pitchDelta!==void 0&&(s.pitch=x),h.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},h={};for(const[m,g,x]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new i.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),i.l(s,g),i.l(h,x);this._updateMapTransform(t,s,h),this._changes=[]}_updateMapTransform(t,s,h){const m=this._map,g=m.transform,x=oe=>[oe.x,oe.y,oe.z];if((oe=>{const ue=this._eventsInProgress.drag;return ue&&!this._handlersById[ue.handlerName].isActive()})()&&!Ii(t)){const oe=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),oe!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&m._stop(!0),!Ii(t))return void this._fireEvents(s,h,!0);let{panDelta:I,zoomDelta:P,bearingDelta:z,pitchDelta:L,around:F,aroundCoord:B,pinchAround:j}=t;g._isCameraConstrained&&(P>0&&(P=0),g._isCameraConstrained=!1),j!==void 0&&(F=j),(P||(oe=>s[oe]&&!this._eventsInProgress[oe])("drag"))&&F&&(this._dragOrigin=x(g.pointCoordinate3D(F)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",m._stop(!0),F=F||m.transform.centerPoint,z&&(g.bearing+=z),L&&(g.pitch+=L),g._updateCameraState();const X=[0,0,0];if(I)if(g.projection.name==="mercator"){const oe=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(F).dir),ue=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(F.sub(I)).dir);X[0]=ue[0]-oe[0],X[1]=ue[1]-oe[1]}else{const oe=g.pointCoordinate(F);if(g.projection.name==="globe"){I=I.rotate(-g.angle);const ue=g._pixelsPerMercatorPixel/g.worldSize;X[0]=-I.x*i.dE(i.aT(oe.y))*ue,X[1]=-I.y*i.dE(g.center.lat)*ue}else{const ue=g.pointCoordinate(F.sub(I));oe&&ue&&(X[0]=ue.x-oe.x,X[1]=ue.y-oe.y)}}const q=g.zoom,J=[0,0,0];if(P){const oe=x(B||g.pointCoordinate3D(F)),ue={dir:i.ad.vec3.normalize([],i.ad.vec3.sub([],oe,g._camera.position))};if(ue.dir[2]<0){const ce=g.zoomDeltaToMovement(oe,P);i.ad.vec3.scale(J,ue.dir,ce)}}const Q=i.ad.vec3.add(X,X,J);g._translateCameraConstrained(Q),P&&Math.abs(g.zoom-q)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,h,!0)}_fireEvents(t,s,h){const m=Yh(this._eventsInProgress),g=Yh(t),x={};for(const L in t){const{originalEvent:F}=t[L];this._eventsInProgress[L]||(x[`${L}start`]=F),this._eventsInProgress[L]=t[L]}!m&&g&&this._fireEvent("movestart",g.originalEvent);for(const L in x)this._fireEvent(L,x[L]);g&&this._fireEvent("move",g.originalEvent);for(const L in t){const{originalEvent:F}=t[L];this._fireEvent(L,F)}const I={};let P;for(const L in this._eventsInProgress){const{handlerName:F,originalEvent:B}=this._eventsInProgress[L];this._handlersById[F].isActive()||(delete this._eventsInProgress[L],P=s[F]||B,I[`${L}end`]=P)}for(const L in I)this._fireEvent(L,I[L]);const z=Yh(this._eventsInProgress);if(h&&(m||g)&&!z){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;L?(F(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:P})):(this._map.fire(new i.A("moveend",{originalEvent:P})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new i.A(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new q0("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const fp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class W0 extends i.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,i.aQ(["_renderFrameCallback"],this)}getCenter(){return new i.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,h){return t=i.P.convert(t).mult(-1),this.panTo(this.transform.center,i.l({offset:t},s),h)}panTo(t,s,h){return this.easeTo(i.l({center:t},s),h)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,h){return this.easeTo(i.l({zoom:t},s),h)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,h){return this.easeTo(i.l({bearing:t},s),h)}resetNorth(t,s){return this.rotateTo(0,i.l({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=i.aB.convert(t);const h=s&&s.bearing||0,m=s&&s.pitch||0,g=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,g,x,h,m,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?i.l({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:i.l({},s,t)}_extendCameraOptions(t){return(t=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const h=s.max[0]-s.min[0],m=s.max[1]-s.min[1];return h/m>t.aspect?h/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,h,m,g,x){const I=t.clone(),P=this._extendCameraOptions(x);I.bearing=m,I.pitch=g;const z=i.bO.convert(s),L=i.bO.convert(h),F=.5*(z.lat+L.lat),B=.5*(z.lng+L.lng),j=i.dF(F,B),X=i.ad.vec3.normalize([],j),q=i.ad.vec3.normalize([],i.ad.vec3.cross([],X,[0,1,0])),J=i.ad.vec3.cross([],q,X),Q=[q[0],q[1],q[2],0,J[0],J[1],J[2],0,X[0],X[1],X[2],0,0,0,0,1],oe=[j,i.dF(z.lat,z.lng),i.dF(L.lat,z.lng),i.dF(L.lat,L.lng),i.dF(z.lat,L.lng),i.dF(F,z.lng),i.dF(F,L.lng),i.dF(z.lat,B),i.dF(L.lat,B)];let ue=i.ce.fromPoints(oe.map(Ze=>[i.ad.vec3.dot(q,Ze),i.ad.vec3.dot(J,Ze),i.ad.vec3.dot(X,Ze)]));const ce=i.ad.vec3.transformMat4([],ue.center,Q);i.ad.vec3.squaredLength(ce)===0&&i.ad.vec3.set(ce,0,0,1),i.ad.vec3.normalize(ce,ce),i.ad.vec3.scale(ce,ce,i.az),I.center=i.dG(ce);const ye=I.getWorldToCameraMatrix(),pe=i.ad.mat4.invert(new Float64Array(16),ye);ue=i.ce.applyTransform(ue,i.ad.mat4.multiply([],ye,Q));const ge=this._extendAABB(ue,I,P,m);if(!ge)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=ge,i.ad.vec3.transformMat4(ce,ce,ye);const me=.5*(ue.max[2]-ue.min[2]),we=this._minimumAABBFrustumDistance(I,ue),Ee=i.ad.vec3.scale([],[0,0,1],me),He=i.ad.vec3.add(Ee,ce,Ee),Be=we+(I.pitch===0?0:i.ad.vec3.distance(ce,He)),rt=I.globeCenterInViewSpace,nt=i.ad.vec3.sub([],ce,[rt[0],rt[1],rt[2]]);i.ad.vec3.normalize(nt,nt),i.ad.vec3.scale(nt,nt,Be);const yt=i.ad.vec3.add([],ce,nt);i.ad.vec3.transformMat4(yt,yt,pe);const Oe=i.dv/i.az,tt=i.ad.vec3.length(yt),ze=i.bH(Math.max(tt*Oe-i.dv,Number.EPSILON),0),Qe=Math.min(I.zoomFromMercatorZAdjusted(ze),P.maxZoom);return Qe>.5*(i.c6+i.bY)?(I.setProjection({name:"mercator"}),I.zoom=Qe,this._cameraForBounds(I,s,h,m,g,x)):{center:I.center,zoom:Qe,bearing:m,pitch:g}}_extendAABB(t,s,h,m){const g=.5*((h.padding.left||0)+(h.padding.right||0)),x=.5*((h.padding.top||0)+(h.padding.bottom||0)),I=x,P=g,z=g,L=x,F=s.width-(P+z),B=s.height-(I+L),j=i.ad.vec3.sub([],t.max,t.min),X=Math.min(F/j[0],B/j[1]),q=Math.min(s.scaleZoom(s.scale*X),h.maxZoom);if(isNaN(q))return null;const J=s.scale/s.zoomScale(q),Q=new i.ce([t.min[0]-P*J,t.min[1]-L*J,t.min[2]],[t.max[0]+z*J,t.max[1]+I*J,t.max[2]]),oe=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new i.P(h.offset.x,h.offset.y):i.P.convert(h.offset)).rotate(-i.ak(m));return Q.center[0]-=oe.x*J,Q.center[1]+=oe.y*J,Q}queryTerrainElevation(t,s){const h=this.transform.elevation;return h?(s=i.l({},{exaggerated:!0},s),h.getAtPoint(i.ac.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,h,m,g,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,h,m,g,x);const I=t.clone(),P=this._extendCameraOptions(x);I.bearing=m,I.pitch=g;const z=i.bO.convert(s),L=i.bO.convert(h),F=new i.bO(z.lng,L.lat),B=new i.bO(L.lng,z.lat),j=I.project(z),X=I.project(L),q=this.queryTerrainElevation(z),J=this.queryTerrainElevation(L),Q=this.queryTerrainElevation(F),oe=this.queryTerrainElevation(B),ue=[[j.x,j.y,Math.min(q||0,J||0,Q||0,oe||0)],[X.x,X.y,Math.max(q||0,J||0,Q||0,oe||0)]];let ce=i.ce.fromPoints(ue);const ye=I.getWorldToCameraMatrix(),pe=i.ad.mat4.invert(new Float64Array(16),ye);ce=i.ce.applyTransform(ce,ye);const ge=this._extendAABB(ce,I,P,m);if(!ge)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=ge;const me=.5*i.ad.vec3.sub([],ce.max,ce.min)[2],we=this._minimumAABBFrustumDistance(I,ce),Ee=[0,0,1,0];i.ad.vec4.transformMat4(Ee,Ee,ye),i.ad.vec4.normalize(Ee,Ee);const He=i.ad.vec3.scale([],Ee,we+me),Be=i.ad.vec3.add([],ce.center,He);i.ad.vec3.transformMat4(ce.center,ce.center,pe),i.ad.vec3.transformMat4(Be,Be,pe);const rt=I.unproject(new i.P(ce.center[0],ce.center[1])),nt=i.dH(I.projection,rt),yt=Math.pow(2,nt),Oe=Math.min(I._zoomFromMercatorZ(Be[2]*I.pixelsPerMeter*yt/I.worldSize),P.maxZoom);return I.mercatorFromTransition&&Oe<.5*(i.c6+i.bY)?(I.setProjection({name:"globe"}),I.zoom=Oe,this._cameraForBounds(I,s,h,m,g,x)):{center:rt,zoom:Oe,bearing:m,pitch:g}}fitBounds(t,s,h){const m=this.cameraForBounds(t,s);return this._fitInternal(m,s,h)}fitScreenCoordinates(t,s,h,m,g){const x=i.P.convert(t),I=i.P.convert(s),P=new i.P(Math.min(x.x,I.x),Math.min(x.y,I.y)),z=new i.P(Math.max(x.x,I.x),Math.max(x.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,I))return this;const L=this.transform.pointLocation3D(P),F=this.transform.pointLocation3D(z),B=this.transform.pointLocation3D(new i.P(P.x,z.y)),j=this.transform.pointLocation3D(new i.P(z.x,P.y)),X=[Math.min(L.lng,F.lng,B.lng,j.lng),Math.min(L.lat,F.lat,B.lat,j.lat)],q=[Math.max(L.lng,F.lng,B.lng,j.lng),Math.max(L.lat,F.lat,B.lat,j.lat)],J=m&&m.pitch?m.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,X,q,h,J,m);return this._fitInternal(Q,m,g)}_fitInternal(t,s,h){return t?(s=i.l(t,s)).linear?this.easeTo(s,h):this.flyTo(s,h):this}jumpTo(t,s){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let m=!1,g=!1,x=!1;"zoom"in t&&h.zoom!==+t.zoom&&(m=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=i.bO.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(g=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(x=!0,h.pitch=+t.pitch);const I=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!h.isPaddingEqual(I))if(t.retainPadding===!1){const P=h.clone();P.padding=I,h.setLocationAtPoint(h.center,P.centerPoint)}else h.padding=I;return t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new i.A("movestart",s)).fire(new i.A("move",s)),m&&this.fire(new i.A("zoomstart",s)).fire(new i.A("zoom",s)).fire(new i.A("zoomend",s)),g&&this.fire(new i.A("rotatestart",s)).fire(new i.A("rotate",s)).fire(new i.A("rotateend",s)),x&&this.fire(new i.A("pitchstart",s)).fire(new i.A("pitch",s)).fire(new i.A("pitchend",s)),this.fire(new i.A("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(fp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return i.w(fp),this;this.stop();const m=h.zoom,g=h.pitch,x=h.bearing;h.setFreeCameraOptions(t);const I=m!==h.zoom,P=g!==h.pitch,z=x!==h.bearing;return this.fire(new i.A("movestart",s)).fire(new i.A("move",s)),I&&this.fire(new i.A("zoomstart",s)).fire(new i.A("zoom",s)).fire(new i.A("zoomend",s)),z&&this.fire(new i.A("rotatestart",s)).fire(new i.A("rotate",s)).fire(new i.A("rotateend",s)),P&&this.fire(new i.A("pitchstart",s)).fire(new i.A("pitch",s)).fire(new i.A("pitchend",s)),this.fire(new i.A("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=i.l({offset:[0,0],duration:500,easing:i.dD},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const h=this.transform,m=this.getZoom(),g=this.getBearing(),x=this.getPitch(),I=this.getPadding(),P="zoom"in t?+t.zoom:m,z="bearing"in t?this._normalizeBearing(t.bearing,g):g,L="pitch"in t?+t.pitch:x,F=this._extendPadding(t.padding),B=i.P.convert(t.offset);let j,X,q;if(h.projection.name==="globe"){const Ee=i.ac.fromLngLat(h.center),He=B.rotate(-h.angle);Ee.x+=He.x/h.worldSize,Ee.y+=He.y/h.worldSize;const Be=Ee.toLngLat(),rt=i.bO.convert(t.center||Be);this._normalizeCenter(rt),j=h.centerPoint.add(He),X=new i.P(Ee.x,Ee.y).mult(h.worldSize),q=new i.P(i.av(rt.lng),i.aC(rt.lat)).mult(h.worldSize).sub(X)}else{j=h.centerPoint.add(B);const Ee=h.pointLocation(j),He=i.bO.convert(t.center||Ee);this._normalizeCenter(He),X=h.project(Ee),q=h.project(He).sub(X)}const J=h.zoomScale(P-m);let Q,oe;t.around&&(Q=i.bO.convert(t.around),oe=h.locationPoint(Q));const ue=this._zooming||P!==m,ce=this._rotating||g!==z,ye=this._pitching||L!==x,pe=!h.isPaddingEqual(F),ge=t.retainPadding===!1?h.clone():h,me=Ee=>He=>{if(ue&&(Ee.zoom=i.ah(m,P,He)),ce&&(Ee.bearing=i.ah(g,z,He)),ye&&(Ee.pitch=i.ah(x,L,He)),pe&&(ge.interpolatePadding(I,F,He),j=ge.centerPoint.add(B)),Q)Ee.setLocationAtPoint(Q,oe);else{const Be=Ee.zoomScale(Ee.zoom-m),rt=P>m?Math.min(2,J):Math.max(.5,J),nt=Math.pow(rt,1-He),yt=Ee.unproject(X.add(q.mult(He*nt)).mult(Be));Ee.setLocationAtPoint(Ee.renderWorldCopies?yt.wrap():yt,j)}return t.preloadOnly||this._fireMoveEvents(s),Ee};if(t.preloadOnly){const Ee=this._emulate(me,t.duration,h);return this._preloadTiles(Ee),this}const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ue,this._rotating=ce,this._pitching=ye,this._padding=pe,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,we),this._ease(me(h),Ee=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(s,Ee)},t),this}_prepareEase(t,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||h.moving||this.fire(new i.A("movestart",t)),this._zooming&&!h.zooming&&this.fire(new i.A("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new i.A("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new i.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new i.A("move",t)),this._zooming&&this.fire(new i.A("zoom",t)),this._rotating&&this.fire(new i.A("rotate",t)),this._pitching&&this.fire(new i.A("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new i.A("zoomend",t)),m&&this.fire(new i.A("rotateend",t)),g&&this.fire(new i.A("pitchend",t)),this.fire(new i.A("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const Ze=i.aA(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ze,s)}this.stop(),t=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.dD},t);const h=this.transform,m=this.getZoom(),g=this.getBearing(),x=this.getPitch(),I=this.getPadding(),P="zoom"in t?i.ay(+t.zoom,h.minZoom,h.maxZoom):m,z="bearing"in t?this._normalizeBearing(t.bearing,g):g,L="pitch"in t?+t.pitch:x,F=this._extendPadding(t.padding),B=h.zoomScale(P-m),j=i.P.convert(t.offset);let X=h.centerPoint.add(j);const q=h.pointLocation(X),J=i.bO.convert(t.center||q);this._normalizeCenter(J);const Q=h.project(q),oe=h.project(J).sub(Q);let ue=t.curve;const ce=Math.max(h.width,h.height),ye=ce/B,pe=oe.mag();if("minZoom"in t){const Ze=i.ay(Math.min(t.minZoom,m,P),h.minZoom,h.maxZoom),at=ce/h.zoomScale(Ze-m);ue=Math.sqrt(at/pe*2)}const ge=ue*ue;function me(Ze){const at=(ye*ye-ce*ce+(Ze?-1:1)*ge*ge*pe*pe)/(2*(Ze?ye:ce)*ge*pe);return Math.log(Math.sqrt(at*at+1)-at)}function we(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Ee(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const He=me(0);let Be=function(Ze){return Ee(He)/Ee(He+ue*Ze)},rt=function(Ze){return ce*((Ee(He)*(we(at=He+ue*Ze)/Ee(at))-we(He))/ge)/pe;var at},nt=(me(1)-He)/ue;if(Math.abs(pe)<1e-6||!isFinite(nt)){if(Math.abs(ce-ye)<1e-6)return this.easeTo(t,s);const Ze=ye<ce?-1:1;nt=Math.abs(Math.log(ye/ce))/ue,rt=function(){return 0},Be=function(at){return Math.exp(Ze*ue*at)}}t.duration="duration"in t?+t.duration:1e3*nt/("screenSpeed"in t?+t.screenSpeed/ue:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const yt=g!==z,Oe=L!==x,tt=!h.isPaddingEqual(F),ze=t.retainPadding===!1?h.clone():h,Qe=Ze=>at=>{const $e=at*nt,ut=1/Be($e);Ze.zoom=at===1?P:m+Ze.scaleZoom(ut),yt&&(Ze.bearing=i.ah(g,z,at)),Oe&&(Ze.pitch=i.ah(x,L,at)),tt&&(ze.interpolatePadding(I,F,at),X=ze.centerPoint.add(j));const St=at===1?J:Ze.unproject(Q.add(oe.mult(rt($e))).mult(ut));return Ze.setLocationAtPoint(Ze.renderWorldCopies?St.wrap():St,X),Ze._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),Ze};if(t.preloadOnly){const Ze=this._emulate(Qe,t.duration,h);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=yt,this._pitching=Oe,this._padding=tt,this._prepareEase(s,!1),this._ease(Qe(h),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,s,h){h.animate===!1||h.duration===0?(t(1),s()):(this._easeStart=i.q.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=i.bF(t,-180,180);const h=Math.abs(t-s);return Math.abs(t-360-s)<h&&(t-=360),Math.abs(t+360-s)<h&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const h=t.lng-s.center.lng;t.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,h){const m=Math.ceil(15*s/1e3),g=[],x=t(h.clone());for(let I=0;I<=m;I++){const P=x(I/m);g.push(P.clone())}return g}_preloadTiles(t,s){}}class ul{constructor(t={}){this.options=t,i.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,h=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=_e("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=_e("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);const m=_e("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",h),this._innerContainer=_e("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(t){const h=s.reduce((m,g,x)=>(g.value&&(m+=`${g.key}=${g.value}${x<s.length-1?"&":""}`),m),"?");t.href=`${i.e.FEEDBACK_URL}/${h}#${Hh(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._mergedSourceCaches;for(const m in s){const g=s[m];if(g.used){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((m,g)=>m.length-g.length),t=t.filter((m,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class pp{constructor(){i.aQ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=_e("div","mapboxgl-ctrl");const s=_e("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const h=t[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Cs{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const m of h)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Xs{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=i.cC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,h){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+h}}const Wl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ra extends i.A{constructor(t,s,h,m){const{point:g,lngLat:x,originalEvent:I,target:P}=t;super(t.type,{point:g,lngLat:x,originalEvent:I,target:P}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=h,this.feature=m}}class Zl{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const h=s.filter;let m=s.type;h&&this.filters.set(t,i.a_(h)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const g=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):g.size===0&&this.map.on(m,this.handleType),g.size===0&&this.interactionsByType.set(m,g),g.set(t,s),this.typeById.set(t,m)}get(t){const s=this.typeById.get(t);if(!s)return;const h=this.interactionsByType.get(s);return h?h.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const h=this.interactionsByType.get(s);h&&(h.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):h.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const h=[];for(const[m,g]of s)g.target&&h.push({targetId:m,target:g.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,h,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const h=new Map;for(const[m,{feature:g}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||h.set(g.id,g);h.size&&(t.type="mouseleave",this.handleType(t,Array.from(h.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map(({feature:h})=>h);s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const h=Array.from(this.interactionsByType.get(t.type)).reverse(),m=!!s;s=s||this.queryTargets(t.point,h);const g=t.type==="mouseenter";let x=!1;const I=new Set;for(const P of s){for(const[z,L]of h){if(!L.target)continue;const F=P.variants?P.variants[z]:null;if(F){for(const B of F){if(Oc(B,P,I,z))continue;const j=new i.cx(P,B),X=ef(B,P,z);m&&(j.state=this.map.getFeatureState(j));const q=g?this.prevHoveredFeatures.get(X):null,J=new Ra(t,z,L,j),Q=q?q.stop:L.handler(J);if(g&&this.hoveredFeatures.set(X,{feature:P,stop:Q}),Q!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(const[P,z]of h){const{handler:L,target:F}=z;if(!F&&L(new Ra(t,P,z,null))!==!1)break}}}function mp(d,t){if(Array.isArray(d)&&Array.isArray(t)){const s=new Set(d),h=new Set(t);return s.size===h.size&&d.every(m=>h.has(m))}return i.bn(d,t)}const Qr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Da={showCompass:!0,showZoom:!0,visualizePitch:!1};class Z0{constructor(t,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new lu({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new Do({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),i.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),ht()}move(t,s){const h=this.map,m=this.mouseRotate.mousemoveWindow(t,s),g=m&&m.bearingDelta;if(g&&h.setBearing(h.getBearing()+g),this.mousePitch){const x=this.mousePitch.mousemoveWindow(t,s),I=x&&x.pitchDelta;I&&h.setPitch(h.getPitch()+I)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ft(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(i.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Et(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Et(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=pt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function G_(d,t,s){if(d=new i.bO(d.lng,d.lat),t){const h=new i.bO(d.lng-360,d.lat),m=new i.bO(d.lng+360,d.lat),g=360*Math.ceil(Math.abs(d.lng-s.center.lng)/360),x=s.locationPoint3D(d).distSqr(t),I=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(h).distSqr(t)<x&&(I||Math.abs(h.lng-s.center.lng)<g)?d=h:s.locationPoint3D(m).distSqr(t)<x&&(I||Math.abs(m.lng-s.center.lng)<g)&&(d=m)}for(;Math.abs(d.lng-s.center.lng)>180;){const h=s.locationPoint3D(d);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;d.lng>s.center.lng?d.lng-=360:d.lng+=360}return d}const cu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ps={anchor:"center",color:"#3FB1CE",scale:1,draggable:!1,clickTolerance:0,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class lo extends i.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=i.l({element:t},s)),i.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),t=i.l({},Ps,t),this._anchor=t.anchor,this._color=t.color,this._scale=t.scale,this._draggable=t.draggable,this._clickTolerance=t.clickTolerance,this._rotation=t.rotation,this._rotationAlignment=t.rotationAlignment,this._pitchAlignment=t.pitchAlignment,this._occludedOpacity=t.occludedOpacity,this._altitude=t.altitude,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=i.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const h=this._element.classList;for(const g in cu)h.remove(`mapboxgl-marker-anchor-${g}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`);const m=t&&t.className?t.className.trim().split(/\s+/):[];h.add(...m),this._popup=null}_createDefaultMarker(){const t=_e("div"),s=Ie("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const h=Ie("radialGradient",{id:"shadowGradient"},Ie("defs",{},s));Ie("stop",{offset:"10%","stop-opacity":.4},h),Ie("stop",{offset:"100%","stop-opacity":.05},h),Ie("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return Ie("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),Ie("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),Ie("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=i.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Ps.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,h=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const h=t.unproject(s,this._altitude),m=t.getFreeCameraOptions();if(!m.position)return!1;const g=m.position.toLngLat();return g.distanceTo(h)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(s,this._altitude);let m;t._showingGlobe()&&i.dK(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(h),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${cu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!t||h!=="map")return"";if(!s._showingGlobe()){const P=s.getPitch();return P?`rotateX(${P}deg)`:""}const m=i.c4(i.dL(s.transform,this._lngLat)),g=t.sub(i.dM(s.transform)),x=Math.abs(g.x)+Math.abs(g.y);if(x===0)return"";const I=m/x;return`rotateX(${-g.y*I}deg) rotateY(${g.x*I}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let h=0;const m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){const g=s.project(new i.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=s.project(new i.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(g);h=i.c4(Math.atan2(x.y,x.x))-90}else h=-s.getBearing();else if(m==="horizon"){const g=i.ae(4,6,s.getZoom()),x=i.dM(s.transform);x.y+=g*s.transform.height;const I=t.sub(x),P=i.c4(Math.atan2(I.y,I.x));h=(P>90?P-270:P+90)*(1-g)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=G_(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=i.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const h=this._pointerdownPos,m=this._positionDelta;if(h&&m){if(!this._isDragging){const g=this._clickTolerance||s._clickTolerance;if(t.point.dist(h)<g)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,h=this._pos;s&&h&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(h),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Ps.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Ps.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Ps.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Ps.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Xi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ds={maxWidth:100,unit:"metric"},Ci={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},_p={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},es=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function gp(d=new i.P(0,0),t="bottom"){if(typeof d=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(t){case"top":return new i.P(0,d);case"top-left":return new i.P(s,s);case"top-right":return new i.P(-s,s);case"bottom":return new i.P(0,-d);case"bottom-left":return new i.P(s,-s);case"bottom-right":return new i.P(-s,-s);case"left":return new i.P(d,0);case"right":return new i.P(-d,0)}return new i.P(0,0)}return d instanceof i.P||Array.isArray(d)?i.P.convert(d):i.P.convert(d[t]||[0,0])}return{version:G,supported:he.supported,setRTLTextPlugin:i.dN,getRTLTextPluginStatus:i.dO,Map:class extends W0{constructor(d){H.mark(W.create);const t=d;if((d=i.l({},Qr,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&i.dI(window)&&(d.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ct(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies,null,null),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Cs,this._domRenderTaskQueue=new Cs,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aW(),this._locale=i.l({},Wl,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Xs(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new Cr(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const s=document.getElementById(d.container);if(!s)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=s}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,i.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Aa),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new dp(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||i.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this.indoor=new v0(this),d.hash&&(this._hash=new op(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const s=d.bounds;s&&(this.resize(),this.fitBounds(s,i.l({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new ul({customAttribution:d.customAttribution})),this._logoControl=new pp,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new i.A(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new i.A(`${s.dataType}dataloading`,s))}),this._interactions=new Zl(this)}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=d.onAdd(this);this._controls.push(d);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new i.A("movestart",d)).fire(new i.A("move",d)),this.fire(new i.A("resize",d)),t&&this.fire(new i.A("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(i.aB.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(t=>t==="auto"?navigator.language:t):d}setLanguage(d){const t=this._parseLanguage(d);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,t=d.projection.name;let s;t==="globe"&&d.zoom>=i.bY?(d.setMercatorFromTransition(),s=!0):t==="mercator"&&d.zoom<i.bY&&(d.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,t){return this._updateProjection(d||t||{name:"mercator"})}_updateProjection(d){let t;return t=d.name==="globe"&&this.transform.zoom>=i.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d,t){return this.transform.locationPoint3D(i.bO.convert(d),t)}unproject(d,t){return this.transform.pointLocation3D(i.P.convert(d),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,t,s){const h=m=>{let g=[];if(Array.isArray(t)){const x=t.filter(I=>this.getLayer(I));g=x.length?this.queryRenderedFeatures(m,{layers:x}):[]}else g=this.queryRenderedFeatures(m,{target:t});return g};if(d==="mouseenter"||d==="mouseover"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:x=>{const I=h(x.point);I.length?m||(m=!0,s.call(this,new hs(d,this,x.originalEvent,{features:I}))):m=!1},mouseout:()=>{m=!1}}}}if(d==="mouseleave"||d==="mouseout"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:I=>{h(I.point).length?m=!0:m&&(m=!1,s.call(this,new hs(d,this,I.originalEvent)))},mouseout:I=>{m&&(m=!1,s.call(this,new hs(d,this,I.originalEvent)))}}}}{const m=g=>{const x=h(g.point);x.length&&(g.features=x,s.call(this,g),delete g.features)};return{listener:s,targets:t,delegates:{[d]:m}}}}on(d,t,s){if(typeof t=="function"||s===void 0)return super.on(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(d,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(d,t,s){if(typeof t=="function"||s===void 0)return super.once(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(d,t,s);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(d,t,s){if(typeof t=="function"||s===void 0)return super.off(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._delegatedListeners?this._delegatedListeners[d]:void 0;return h&&(m=>{for(let g=0;g<m.length;g++){const x=m[g];if(x.listener===s&&mp(x.targets,t)){for(const I in x.delegates)this.off(I,x.delegates[I]);return m.splice(g,1),this}}})(h),this}queryRenderedFeatures(d,t){if(!this.style)return[];if(d===void 0||d instanceof i.P||Array.isArray(d)||t!==void 0||(t=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!t){const g=this.style.queryRenderedFeatures(d,void 0,this.transform),x=this.style.queryRenderedFeatureset(d,void 0,this.transform);return g.concat(x)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(d,t,this.transform);let h=!0;if(t.layers&&Array.isArray(t.layers)){for(const g of t.layers)if(!this._isValidId(g)){h=!1;break}if(h&&!t.target)return this.style.queryRenderedFeatures(d,t,this.transform)}let m=[];return h&&(m=m.concat(this.style.queryRenderedFeatures(d,t,this.transform))),s&&(m=m.concat(this.style.queryRenderedFeatureset(d,t,this.transform))),m}querySourceFeatures(d,t){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,t)}isPointOnSurface(d){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&i.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(d))}addInteraction(d,t){return this._interactions.add(d,t),this}removeInteraction(d){return this._interactions.remove(d),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this}setStyle(d,t){return t=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&d&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(d,(s,h)=>{s?(i.w(`Unable to perform style diff: ${String(s.message||s.error||s)}. Rebuilding the style from scratch.`),this._updateStyle(d,t)):h&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const s=i.l({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new ls(this,s).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ls(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.cs(d)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const t of d)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(d)}addSource(d,t){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,s)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,t,{pixelRatio:s=1,sdf:h=!1,stretchX:m,stretchY:g,content:x}={}){this._lazyInitEmptyStyle();const I=i.I.from(d);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:P,height:z,data:L}=i.q.getImageData(t);this.style.addImage(I,{data:new i.r({width:P,height:z},L),pixelRatio:s,stretchX:m,stretchY:g,content:x,sdf:h,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:z}=t,L=t;this.style.addImage(I,{data:new i.r({width:P,height:z},new Uint8Array(L.data)),pixelRatio:s,stretchX:m,stretchY:g,content:x,sdf:h,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,d)}}updateImage(d,t){this._lazyInitEmptyStyle();const s=i.I.from(d),h=this.style.getImage(s);if(!h)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?i.q.getImageData(t):t,{width:g,height:x,data:I}=m;if(g===void 0||x===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(h.usvg?h.icon.usvg_tree.width:h.data.width)||x!==(h.usvg?h.icon.usvg_tree.height:h.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${g}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const P=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let z=!1;h.usvg?(h.data=new i.r({width:g,height:x},new Uint8Array(I)),h.usvg=!1,h.icon=void 0,z=!0):h.data.replace(I,P),this.style.updateImage(s,h,z)}hasImage(d){return d?!!this.style&&!!this.style.getImage(i.I.from(d)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(i.I.from(d))}loadImage(d,t){i.o(this._requestManager.transformRequest(d,i.R.Image),(s,h)=>{t(s,h instanceof HTMLImageElement?i.q.getImageData(h):h)})}listImages(){return this.style.listImages().map(d=>d.name)}addModel(d,t){this._lazyInitEmptyStyle(),this.style.addModel(d,t)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,t){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)):this}getSlot(d){const t=this.getLayer(d);return t&&t.slot||null}setSlot(d,t){return this.style.setSlot(d,t),this.style.mergeLayers(),this._update(!0)}addImport(d,t){return this.style.addImport(d,t),this}updateImport(d,t){return typeof t!="string"&&t.id!==d?(this.removeImport(d),this.addImport(t)):(this.style.updateImport(d,t),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,t){return this.style.moveImport(d,t),this._update(!0)}moveLayer(d,t){return this._isValidId(d)?(this.style.moveLayer(d,t),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const t=this.style.getOwnLayer(d);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,t,s){return this._isValidId(d)?(this.style.setLayerZoomRange(d,t,s),this._update(!0)):this}setFilter(d,t,s={}){return this._isValidId(d)?(this.style.setFilter(d,t,s),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,t,s,h={}){return this._isValidId(d)?(this.style.setPaintProperty(d,t,s,h),this._update(!0)):this}getPaintProperty(d,t){return this._isValidId(d)?this.style.getPaintProperty(d,t):null}setLayoutProperty(d,t,s,h={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,t,s,h),this._update(!0)):this}getLayoutProperty(d,t){return this._isValidId(d)?this.style.getLayoutProperty(d,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(d){return this.style.setGlyphsUrl(d),this._update(!0)}getSchema(d){return this.style.getSchema(d)}setSchema(d,t){return this.style.setSchema(d,t),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,t){return this.style.setConfig(d,t),this._update(!0)}getConfigProperty(d,t){return this.style.getConfigProperty(d,t)}setConfigProperty(d,t,s){return this.style.setConfigProperty(d,t,s),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const t=d[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,t),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bO.convert(d),this.transform):0}setFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,t),this._update())}removeFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,t),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,h,m,g=this._container;for(;g&&(!h||!m);){const x=window.getComputedStyle(g).transform;x&&x!=="none"&&(s=x.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),g=g.parentElement}this._containerWidth=h?Math.abs(d/h):d,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=_e("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=_e("div","mapboxgl-canvas-container",d);this._canvas=_e("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=_e("div","mapboxgl-control-container",d),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{h[m]=_e("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){const s=i.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(d),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const t=this._markers.indexOf(d);t!==-1&&this._markers.splice(t,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const t=this._popups.indexOf(d);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const d=i.l({},he.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",d);t?(function(s,h){vn.add(s)}(t),this.painter=new sp(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(t)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;this.fire(new i.A("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,h=i.q.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,L=this.transform.pitch,F=i.q.now(),B=new i.aa(z,{now:F,fadeDuration:g,pitch:L,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(h),this.style.updateSources(this.transform),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(h);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,H.mark(W.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const z=i.q.now()-h;m.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const L=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new i.A("gpu-timing-frame",{cpuTime:z,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(z);this.fire(new i.A("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(z);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:L}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(P||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(x=this._updateAverageElevation(h,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,H.mark(W.fullLoad),this._performanceMetricsCollection&&tr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const t of this._markers)d&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!d||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(d,t=!1){const s=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=d;const x=Math.abs(m-g);if(x>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(g),s(g);this._averageElevation.easeTo(g,d,300)}else if(x>1e-4)return this._averageElevation.jumpTo(g),s(g)}return!!this._averageElevation.isEasing(d)&&s(this._averageElevation.getValue(d))}_authenticate(){te(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{}),vi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&yn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function m(g){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,g,0);const x=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,x),x}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(m(d),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(d,t,s){let h=s[1]-s[0];const m=d.length/4;for(let g=0;g<t.length;g++){const x=t[g];let I=0;for(let P=0;P<x.length;P+=4)x[P]===d[P]&&x[P+1]===d[P+1]&&x[P+2]===d[P+2]&&x[P+3]===d[P+3]&&(I+=1);h+=(s[g+2]-s[g+1])*(1-I/m)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),vn.delete(this.painter.context.gl),Yt.remove(),$t.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=i.q.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(d){const t=this.style?this.style.getSourceCaches():[];return i.bl(t,(s,h)=>s._preloadTiles(d,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,t){i.dJ(d,t)}get version(){return G}},NavigationControl:class{constructor(d={}){this.options=i.l({},Da,d),this._container=_e("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(i.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),_e("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),_e("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=_e("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const t=d.getZoom(),s=t===d.getMaxZoom(),h=t===d.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Z0(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,t){const s=_e("button",d,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(d,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);d.setAttribute("aria-label",s),d.firstElementChild&&d.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends i.E{constructor(d={}){super();const t=navigator.geolocation;this.options=i.l({geolocation:t},Xi,d),i.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=nu(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=_e("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,d(s)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>t(s.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),s=d.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",d)),this._finish()}}_updateCamera(d){const t=new i.bO(d.coords.longitude,d.coords.latitude),s=d.coords.accuracy,h=this._map.getBearing(),m=i.l({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(d){if(d){const t=new i.bO(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,t=i.bH(1,d._center.lat)*d.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=_e("button","mapboxgl-ctrl-geolocate",this._container),_e("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=_e("div","mapboxgl-user-location"),this._dotElement.appendChild(_e("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(_e("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new lo({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=_e("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new lo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ul,ScaleControl:class{constructor(d={}){this.options=i.l({},ds,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,h=t._containerWidth/2-d/2,m=t.unproject([h,s]),g=t.unproject([h+d,s]),x=m.distanceTo(g);if(this.options.unit==="imperial"){const I=3.2808*x;I>5280?this._setScale(d,I/5280,"mile"):this._setScale(d,I,"foot")}else this.options.unit==="nautical"?this._setScale(d,x/1852,"nautical-mile"):x>=1e3?this._setScale(d,x/1e3,"kilometer"):this._setScale(d,x,"meter")}_setScale(d,t,s){this._map._requestDomTask(()=>{const h=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let I=g/x;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(P){const z=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*z)/z}(I),x*I}(t),m=h/t;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(h):`${h}&nbsp;${Ci[s]}`,this._container.style.width=d*m+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=_e("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:i.w("Full screen control 'container' must be a DOM element.")),i.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=_e("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=_e("button","mapboxgl-ctrl-fullscreen",this._controlContainer);_e("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(d){super(),this.options=i.l(Object.create(_p),d),this._altitude=this.options.altitude,i.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=i.bO.convert(d),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(d){return this._altitude=d,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),s=document.createElement("body");let h;for(s.innerHTML=d;h=s.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=_e("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(d),this.options.closeButton){const s=this._closeButton=_e("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let t;return this._classList.delete(d)?t=!1:(this._classList.add(d),t=!0),this._updateClassList(),t}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,h=this._pos;if(!t||!s||!h)return"bottom";const m=s.offsetWidth,g=s.offsetHeight,x=h.x<m/2,I=h.x>t.transform.width-m/2;if(h.y+d<g)return x?"top-left":I?"top-right":"top";if(h.y>t.transform.height-g){if(x)return"bottom-left";if(I)return"bottom-right"}return x?"left":I?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),d.className=t.join(" ")}_update(d){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=_e("div","mapboxgl-popup",t.getContainer()),this._tip=_e("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=G_(this._lngLat,this._pos,t.transform)),!this._trackPointer||d){const m=this._pos=this._trackPointer&&d instanceof i.P?d:t.project(this._lngLat,this._altitude),g=gp(this.options.offset),x=this._anchor=this._getAnchor(g.y),I=gp(this.options.offset,x),P=m.add(I).round();t._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${cu[x]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&t._showingGlobe()){const m=i.dK(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(es);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:lo,Style:ls,LngLat:i.bO,LngLatBounds:i.aB,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:Cl,Evented:i.E,config:i.e,prewarm:i.dP,clearPrewarmedResources:i.dQ,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(d){i.e.ACCESS_TOKEN=d},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(d){i.e.API_URL=d},get workerCount(){return i.dR.workerCount},set workerCount(d){i.dR.workerCount=d},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){i.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){i.dS(d)},get workerUrl(){return i.dT.workerUrl},set workerUrl(d){i.dT.workerUrl=d},get workerClass(){return i.dT.workerClass},set workerClass(d){i.dT.workerClass=d},get workerParams(){return i.dT.workerParams},set workerParams(d){i.dT.workerParams=d},get dracoUrl(){return i.dU()},set dracoUrl(d){i.dV(d)},get meshoptUrl(){return i.dW()},set meshoptUrl(d){i.dX(d)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var D=A;return D})}(Qg)),Qg.exports}var OO=LO();const Tj=DO(OO);function PI(r,l){return function(){return r.apply(l,arguments)}}const{toString:kO}=Object.prototype,{getPrototypeOf:G1}=Object,Hy=(r=>l=>{const p=kO.call(l);return r[p]||(r[p]=p.slice(8,-1).toLowerCase())})(Object.create(null)),pa=r=>(r=r.toLowerCase(),l=>Hy(l)===r),qy=r=>l=>typeof l===r,{isArray:jd}=Array,Tm=qy("undefined");function FO(r){return r!==null&&!Tm(r)&&r.constructor!==null&&!Tm(r.constructor)&&xo(r.constructor.isBuffer)&&r.constructor.isBuffer(r)}const RI=pa("ArrayBuffer");function BO(r){let l;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?l=ArrayBuffer.isView(r):l=r&&r.buffer&&RI(r.buffer),l}const NO=qy("string"),xo=qy("function"),DI=qy("number"),Wy=r=>r!==null&&typeof r=="object",VO=r=>r===!0||r===!1,ey=r=>{if(Hy(r)!=="object")return!1;const l=G1(r);return(l===null||l===Object.prototype||Object.getPrototypeOf(l)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)},UO=pa("Date"),jO=pa("File"),$O=pa("Blob"),GO=pa("FileList"),HO=r=>Wy(r)&&xo(r.pipe),qO=r=>{let l;return r&&(typeof FormData=="function"&&r instanceof FormData||xo(r.append)&&((l=Hy(r))==="formdata"||l==="object"&&xo(r.toString)&&r.toString()==="[object FormData]"))},WO=pa("URLSearchParams"),[ZO,XO,KO,YO]=["ReadableStream","Request","Response","Headers"].map(pa),JO=r=>r.trim?r.trim():r.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Fm(r,l,{allOwnKeys:p=!1}={}){if(r===null||typeof r>"u")return;let v,A;if(typeof r!="object"&&(r=[r]),jd(r))for(v=0,A=r.length;v<A;v++)l.call(null,r[v],v,r);else{const R=p?Object.getOwnPropertyNames(r):Object.keys(r),D=R.length;let i;for(v=0;v<D;v++)i=R[v],l.call(null,r[i],i,r)}}function zI(r,l){l=l.toLowerCase();const p=Object.keys(r);let v=p.length,A;for(;v-- >0;)if(A=p[v],l===A.toLowerCase())return A;return null}const Du=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,LI=r=>!Tm(r)&&r!==Du;function e1(){const{caseless:r}=LI(this)&&this||{},l={},p=(v,A)=>{const R=r&&zI(l,A)||A;ey(l[R])&&ey(v)?l[R]=e1(l[R],v):ey(v)?l[R]=e1({},v):jd(v)?l[R]=v.slice():l[R]=v};for(let v=0,A=arguments.length;v<A;v++)arguments[v]&&Fm(arguments[v],p);return l}const QO=(r,l,p,{allOwnKeys:v}={})=>(Fm(l,(A,R)=>{p&&xo(A)?r[R]=PI(A,p):r[R]=A},{allOwnKeys:v}),r),ek=r=>(r.charCodeAt(0)===65279&&(r=r.slice(1)),r),tk=(r,l,p,v)=>{r.prototype=Object.create(l.prototype,v),r.prototype.constructor=r,Object.defineProperty(r,"super",{value:l.prototype}),p&&Object.assign(r.prototype,p)},rk=(r,l,p,v)=>{let A,R,D;const i={};if(l=l||{},r==null)return l;do{for(A=Object.getOwnPropertyNames(r),R=A.length;R-- >0;)D=A[R],(!v||v(D,r,l))&&!i[D]&&(l[D]=r[D],i[D]=!0);r=p!==!1&&G1(r)}while(r&&(!p||p(r,l))&&r!==Object.prototype);return l},nk=(r,l,p)=>{r=String(r),(p===void 0||p>r.length)&&(p=r.length),p-=l.length;const v=r.indexOf(l,p);return v!==-1&&v===p},ik=r=>{if(!r)return null;if(jd(r))return r;let l=r.length;if(!DI(l))return null;const p=new Array(l);for(;l-- >0;)p[l]=r[l];return p},sk=(r=>l=>r&&l instanceof r)(typeof Uint8Array<"u"&&G1(Uint8Array)),ok=(r,l)=>{const v=(r&&r[Symbol.iterator]).call(r);let A;for(;(A=v.next())&&!A.done;){const R=A.value;l.call(r,R[0],R[1])}},ak=(r,l)=>{let p;const v=[];for(;(p=r.exec(l))!==null;)v.push(p);return v},lk=pa("HTMLFormElement"),ck=r=>r.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(p,v,A){return v.toUpperCase()+A}),sE=(({hasOwnProperty:r})=>(l,p)=>r.call(l,p))(Object.prototype),uk=pa("RegExp"),OI=(r,l)=>{const p=Object.getOwnPropertyDescriptors(r),v={};Fm(p,(A,R)=>{let D;(D=l(A,R,r))!==!1&&(v[R]=D||A)}),Object.defineProperties(r,v)},hk=r=>{OI(r,(l,p)=>{if(xo(r)&&["arguments","caller","callee"].indexOf(p)!==-1)return!1;const v=r[p];if(xo(v)){if(l.enumerable=!1,"writable"in l){l.writable=!1;return}l.set||(l.set=()=>{throw Error("Can not rewrite read-only method '"+p+"'")})}})},dk=(r,l)=>{const p={},v=A=>{A.forEach(R=>{p[R]=!0})};return jd(r)?v(r):v(String(r).split(l)),p},fk=()=>{},pk=(r,l)=>r!=null&&Number.isFinite(r=+r)?r:l;function mk(r){return!!(r&&xo(r.append)&&r[Symbol.toStringTag]==="FormData"&&r[Symbol.iterator])}const _k=r=>{const l=new Array(10),p=(v,A)=>{if(Wy(v)){if(l.indexOf(v)>=0)return;if(!("toJSON"in v)){l[A]=v;const R=jd(v)?[]:{};return Fm(v,(D,i)=>{const G=p(D,A+1);!Tm(G)&&(R[i]=G)}),l[A]=void 0,R}}return v};return p(r,0)},gk=pa("AsyncFunction"),yk=r=>r&&(Wy(r)||xo(r))&&xo(r.then)&&xo(r.catch),kI=((r,l)=>r?setImmediate:l?((p,v)=>(Du.addEventListener("message",({source:A,data:R})=>{A===Du&&R===p&&v.length&&v.shift()()},!1),A=>{v.push(A),Du.postMessage(p,"*")}))(`axios@${Math.random()}`,[]):p=>setTimeout(p))(typeof setImmediate=="function",xo(Du.postMessage)),vk=typeof queueMicrotask<"u"?queueMicrotask.bind(Du):typeof process<"u"&&process.nextTick||kI,It={isArray:jd,isArrayBuffer:RI,isBuffer:FO,isFormData:qO,isArrayBufferView:BO,isString:NO,isNumber:DI,isBoolean:VO,isObject:Wy,isPlainObject:ey,isReadableStream:ZO,isRequest:XO,isResponse:KO,isHeaders:YO,isUndefined:Tm,isDate:UO,isFile:jO,isBlob:$O,isRegExp:uk,isFunction:xo,isStream:HO,isURLSearchParams:WO,isTypedArray:sk,isFileList:GO,forEach:Fm,merge:e1,extend:QO,trim:JO,stripBOM:ek,inherits:tk,toFlatObject:rk,kindOf:Hy,kindOfTest:pa,endsWith:nk,toArray:ik,forEachEntry:ok,matchAll:ak,isHTMLForm:lk,hasOwnProperty:sE,hasOwnProp:sE,reduceDescriptors:OI,freezeMethods:hk,toObjectSet:dk,toCamelCase:ck,noop:fk,toFiniteNumber:pk,findKey:zI,global:Du,isContextDefined:LI,isSpecCompliantForm:mk,toJSONObject:_k,isAsyncFn:gk,isThenable:yk,setImmediate:kI,asap:vk};function fn(r,l,p,v,A){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=r,this.name="AxiosError",l&&(this.code=l),p&&(this.config=p),v&&(this.request=v),A&&(this.response=A,this.status=A.status?A.status:null)}It.inherits(fn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:It.toJSONObject(this.config),code:this.code,status:this.status}}});const FI=fn.prototype,BI={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(r=>{BI[r]={value:r}});Object.defineProperties(fn,BI);Object.defineProperty(FI,"isAxiosError",{value:!0});fn.from=(r,l,p,v,A,R)=>{const D=Object.create(FI);return It.toFlatObject(r,D,function(G){return G!==Error.prototype},i=>i!=="isAxiosError"),fn.call(D,r.message,l,p,v,A),D.cause=r,D.name=r.name,R&&Object.assign(D,R),D};const xk=null;function t1(r){return It.isPlainObject(r)||It.isArray(r)}function NI(r){return It.endsWith(r,"[]")?r.slice(0,-2):r}function oE(r,l,p){return r?r.concat(l).map(function(A,R){return A=NI(A),!p&&R?"["+A+"]":A}).join(p?".":""):l}function bk(r){return It.isArray(r)&&!r.some(t1)}const wk=It.toFlatObject(It,{},null,function(l){return/^is[A-Z]/.test(l)});function Zy(r,l,p){if(!It.isObject(r))throw new TypeError("target must be an object");l=l||new FormData,p=It.toFlatObject(p,{metaTokens:!0,dots:!1,indexes:!1},!1,function(_e,Ie){return!It.isUndefined(Ie[_e])});const v=p.metaTokens,A=p.visitor||H,R=p.dots,D=p.indexes,G=(p.Blob||typeof Blob<"u"&&Blob)&&It.isSpecCompliantForm(l);if(!It.isFunction(A))throw new TypeError("visitor must be a function");function W(he){if(he===null)return"";if(It.isDate(he))return he.toISOString();if(!G&&It.isBlob(he))throw new fn("Blob is not supported. Use a Buffer instead.");return It.isArrayBuffer(he)||It.isTypedArray(he)?G&&typeof Blob=="function"?new Blob([he]):Buffer.from(he):he}function H(he,_e,Ie){let je=he;if(he&&!Ie&&typeof he=="object"){if(It.endsWith(_e,"{}"))_e=v?_e:_e.slice(0,-2),he=JSON.stringify(he);else if(It.isArray(he)&&bk(he)||(It.isFileList(he)||It.endsWith(_e,"[]"))&&(je=It.toArray(he)))return _e=NI(_e),je.forEach(function(Pt,ht){!(It.isUndefined(Pt)||Pt===null)&&l.append(D===!0?oE([_e],ht,R):D===null?_e:_e+"[]",W(Pt))}),!1}return t1(he)?!0:(l.append(oE(Ie,_e,R),W(he)),!1)}const ee=[],ne=Object.assign(wk,{defaultVisitor:H,convertValue:W,isVisitable:t1});function de(he,_e){if(!It.isUndefined(he)){if(ee.indexOf(he)!==-1)throw Error("Circular reference detected in "+_e.join("."));ee.push(he),It.forEach(he,function(je,vt){(!(It.isUndefined(je)||je===null)&&A.call(l,je,It.isString(vt)?vt.trim():vt,_e,ne))===!0&&de(je,_e?_e.concat(vt):[vt])}),ee.pop()}}if(!It.isObject(r))throw new TypeError("data must be an object");return de(r),l}function aE(r){const l={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(r).replace(/[!'()~]|%20|%00/g,function(v){return l[v]})}function H1(r,l){this._pairs=[],r&&Zy(r,this,l)}const VI=H1.prototype;VI.append=function(l,p){this._pairs.push([l,p])};VI.toString=function(l){const p=l?function(v){return l.call(this,v,aE)}:aE;return this._pairs.map(function(A){return p(A[0])+"="+p(A[1])},"").join("&")};function Tk(r){return encodeURIComponent(r).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function UI(r,l,p){if(!l)return r;const v=p&&p.encode||Tk;It.isFunction(p)&&(p={serialize:p});const A=p&&p.serialize;let R;if(A?R=A(l,p):R=It.isURLSearchParams(l)?l.toString():new H1(l,p).toString(v),R){const D=r.indexOf("#");D!==-1&&(r=r.slice(0,D)),r+=(r.indexOf("?")===-1?"?":"&")+R}return r}class lE{constructor(){this.handlers=[]}use(l,p,v){return this.handlers.push({fulfilled:l,rejected:p,synchronous:v?v.synchronous:!1,runWhen:v?v.runWhen:null}),this.handlers.length-1}eject(l){this.handlers[l]&&(this.handlers[l]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(l){It.forEach(this.handlers,function(v){v!==null&&l(v)})}}const jI={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Sk=typeof URLSearchParams<"u"?URLSearchParams:H1,Ek=typeof FormData<"u"?FormData:null,Ak=typeof Blob<"u"?Blob:null,Mk={isBrowser:!0,classes:{URLSearchParams:Sk,FormData:Ek,Blob:Ak},protocols:["http","https","file","blob","url","data"]},q1=typeof window<"u"&&typeof document<"u",r1=typeof navigator=="object"&&navigator||void 0,Ik=q1&&(!r1||["ReactNative","NativeScript","NS"].indexOf(r1.product)<0),Ck=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Pk=q1&&window.location.href||"http://localhost",Rk=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:q1,hasStandardBrowserEnv:Ik,hasStandardBrowserWebWorkerEnv:Ck,navigator:r1,origin:Pk},Symbol.toStringTag,{value:"Module"})),ms={...Rk,...Mk};function Dk(r,l){return Zy(r,new ms.classes.URLSearchParams,Object.assign({visitor:function(p,v,A,R){return ms.isNode&&It.isBuffer(p)?(this.append(v,p.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},l))}function zk(r){return It.matchAll(/\w+|\[(\w*)]/g,r).map(l=>l[0]==="[]"?"":l[1]||l[0])}function Lk(r){const l={},p=Object.keys(r);let v;const A=p.length;let R;for(v=0;v<A;v++)R=p[v],l[R]=r[R];return l}function $I(r){function l(p,v,A,R){let D=p[R++];if(D==="__proto__")return!0;const i=Number.isFinite(+D),G=R>=p.length;return D=!D&&It.isArray(A)?A.length:D,G?(It.hasOwnProp(A,D)?A[D]=[A[D],v]:A[D]=v,!i):((!A[D]||!It.isObject(A[D]))&&(A[D]=[]),l(p,v,A[D],R)&&It.isArray(A[D])&&(A[D]=Lk(A[D])),!i)}if(It.isFormData(r)&&It.isFunction(r.entries)){const p={};return It.forEachEntry(r,(v,A)=>{l(zk(v),A,p,0)}),p}return null}function Ok(r,l,p){if(It.isString(r))try{return(l||JSON.parse)(r),It.trim(r)}catch(v){if(v.name!=="SyntaxError")throw v}return(p||JSON.stringify)(r)}const Bm={transitional:jI,adapter:["xhr","http","fetch"],transformRequest:[function(l,p){const v=p.getContentType()||"",A=v.indexOf("application/json")>-1,R=It.isObject(l);if(R&&It.isHTMLForm(l)&&(l=new FormData(l)),It.isFormData(l))return A?JSON.stringify($I(l)):l;if(It.isArrayBuffer(l)||It.isBuffer(l)||It.isStream(l)||It.isFile(l)||It.isBlob(l)||It.isReadableStream(l))return l;if(It.isArrayBufferView(l))return l.buffer;if(It.isURLSearchParams(l))return p.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),l.toString();let i;if(R){if(v.indexOf("application/x-www-form-urlencoded")>-1)return Dk(l,this.formSerializer).toString();if((i=It.isFileList(l))||v.indexOf("multipart/form-data")>-1){const G=this.env&&this.env.FormData;return Zy(i?{"files[]":l}:l,G&&new G,this.formSerializer)}}return R||A?(p.setContentType("application/json",!1),Ok(l)):l}],transformResponse:[function(l){const p=this.transitional||Bm.transitional,v=p&&p.forcedJSONParsing,A=this.responseType==="json";if(It.isResponse(l)||It.isReadableStream(l))return l;if(l&&It.isString(l)&&(v&&!this.responseType||A)){const D=!(p&&p.silentJSONParsing)&&A;try{return JSON.parse(l)}catch(i){if(D)throw i.name==="SyntaxError"?fn.from(i,fn.ERR_BAD_RESPONSE,this,null,this.response):i}}return l}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ms.classes.FormData,Blob:ms.classes.Blob},validateStatus:function(l){return l>=200&&l<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};It.forEach(["delete","get","head","post","put","patch"],r=>{Bm.headers[r]={}});const kk=It.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Fk=r=>{const l={};let p,v,A;return r&&r.split(`
`).forEach(function(D){A=D.indexOf(":"),p=D.substring(0,A).trim().toLowerCase(),v=D.substring(A+1).trim(),!(!p||l[p]&&kk[p])&&(p==="set-cookie"?l[p]?l[p].push(v):l[p]=[v]:l[p]=l[p]?l[p]+", "+v:v)}),l},cE=Symbol("internals");function tm(r){return r&&String(r).trim().toLowerCase()}function ty(r){return r===!1||r==null?r:It.isArray(r)?r.map(ty):String(r)}function Bk(r){const l=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let v;for(;v=p.exec(r);)l[v[1]]=v[2];return l}const Nk=r=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(r.trim());function Ax(r,l,p,v,A){if(It.isFunction(v))return v.call(this,l,p);if(A&&(l=p),!!It.isString(l)){if(It.isString(v))return l.indexOf(v)!==-1;if(It.isRegExp(v))return v.test(l)}}function Vk(r){return r.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(l,p,v)=>p.toUpperCase()+v)}function Uk(r,l){const p=It.toCamelCase(" "+l);["get","set","has"].forEach(v=>{Object.defineProperty(r,v+p,{value:function(A,R,D){return this[v].call(this,l,A,R,D)},configurable:!0})})}let eo=class{constructor(l){l&&this.set(l)}set(l,p,v){const A=this;function R(i,G,W){const H=tm(G);if(!H)throw new Error("header name must be a non-empty string");const ee=It.findKey(A,H);(!ee||A[ee]===void 0||W===!0||W===void 0&&A[ee]!==!1)&&(A[ee||G]=ty(i))}const D=(i,G)=>It.forEach(i,(W,H)=>R(W,H,G));if(It.isPlainObject(l)||l instanceof this.constructor)D(l,p);else if(It.isString(l)&&(l=l.trim())&&!Nk(l))D(Fk(l),p);else if(It.isHeaders(l))for(const[i,G]of l.entries())R(G,i,v);else l!=null&&R(p,l,v);return this}get(l,p){if(l=tm(l),l){const v=It.findKey(this,l);if(v){const A=this[v];if(!p)return A;if(p===!0)return Bk(A);if(It.isFunction(p))return p.call(this,A,v);if(It.isRegExp(p))return p.exec(A);throw new TypeError("parser must be boolean|regexp|function")}}}has(l,p){if(l=tm(l),l){const v=It.findKey(this,l);return!!(v&&this[v]!==void 0&&(!p||Ax(this,this[v],v,p)))}return!1}delete(l,p){const v=this;let A=!1;function R(D){if(D=tm(D),D){const i=It.findKey(v,D);i&&(!p||Ax(v,v[i],i,p))&&(delete v[i],A=!0)}}return It.isArray(l)?l.forEach(R):R(l),A}clear(l){const p=Object.keys(this);let v=p.length,A=!1;for(;v--;){const R=p[v];(!l||Ax(this,this[R],R,l,!0))&&(delete this[R],A=!0)}return A}normalize(l){const p=this,v={};return It.forEach(this,(A,R)=>{const D=It.findKey(v,R);if(D){p[D]=ty(A),delete p[R];return}const i=l?Vk(R):String(R).trim();i!==R&&delete p[R],p[i]=ty(A),v[i]=!0}),this}concat(...l){return this.constructor.concat(this,...l)}toJSON(l){const p=Object.create(null);return It.forEach(this,(v,A)=>{v!=null&&v!==!1&&(p[A]=l&&It.isArray(v)?v.join(", "):v)}),p}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([l,p])=>l+": "+p).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(l){return l instanceof this?l:new this(l)}static concat(l,...p){const v=new this(l);return p.forEach(A=>v.set(A)),v}static accessor(l){const v=(this[cE]=this[cE]={accessors:{}}).accessors,A=this.prototype;function R(D){const i=tm(D);v[i]||(Uk(A,D),v[i]=!0)}return It.isArray(l)?l.forEach(R):R(l),this}};eo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);It.reduceDescriptors(eo.prototype,({value:r},l)=>{let p=l[0].toUpperCase()+l.slice(1);return{get:()=>r,set(v){this[p]=v}}});It.freezeMethods(eo);function Mx(r,l){const p=this||Bm,v=l||p,A=eo.from(v.headers);let R=v.data;return It.forEach(r,function(i){R=i.call(p,R,A.normalize(),l?l.status:void 0)}),A.normalize(),R}function GI(r){return!!(r&&r.__CANCEL__)}function $d(r,l,p){fn.call(this,r??"canceled",fn.ERR_CANCELED,l,p),this.name="CanceledError"}It.inherits($d,fn,{__CANCEL__:!0});function HI(r,l,p){const v=p.config.validateStatus;!p.status||!v||v(p.status)?r(p):l(new fn("Request failed with status code "+p.status,[fn.ERR_BAD_REQUEST,fn.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p))}function jk(r){const l=/^([-+\w]{1,25})(:?\/\/|:)/.exec(r);return l&&l[1]||""}function $k(r,l){r=r||10;const p=new Array(r),v=new Array(r);let A=0,R=0,D;return l=l!==void 0?l:1e3,function(G){const W=Date.now(),H=v[R];D||(D=W),p[A]=G,v[A]=W;let ee=R,ne=0;for(;ee!==A;)ne+=p[ee++],ee=ee%r;if(A=(A+1)%r,A===R&&(R=(R+1)%r),W-D<l)return;const de=H&&W-H;return de?Math.round(ne*1e3/de):void 0}}function Gk(r,l){let p=0,v=1e3/l,A,R;const D=(W,H=Date.now())=>{p=H,A=null,R&&(clearTimeout(R),R=null),r.apply(null,W)};return[(...W)=>{const H=Date.now(),ee=H-p;ee>=v?D(W,H):(A=W,R||(R=setTimeout(()=>{R=null,D(A)},v-ee)))},()=>A&&D(A)]}const gy=(r,l,p=3)=>{let v=0;const A=$k(50,250);return Gk(R=>{const D=R.loaded,i=R.lengthComputable?R.total:void 0,G=D-v,W=A(G),H=D<=i;v=D;const ee={loaded:D,total:i,progress:i?D/i:void 0,bytes:G,rate:W||void 0,estimated:W&&i&&H?(i-D)/W:void 0,event:R,lengthComputable:i!=null,[l?"download":"upload"]:!0};r(ee)},p)},uE=(r,l)=>{const p=r!=null;return[v=>l[0]({lengthComputable:p,total:r,loaded:v}),l[1]]},hE=r=>(...l)=>It.asap(()=>r(...l)),Hk=ms.hasStandardBrowserEnv?((r,l)=>p=>(p=new URL(p,ms.origin),r.protocol===p.protocol&&r.host===p.host&&(l||r.port===p.port)))(new URL(ms.origin),ms.navigator&&/(msie|trident)/i.test(ms.navigator.userAgent)):()=>!0,qk=ms.hasStandardBrowserEnv?{write(r,l,p,v,A,R){const D=[r+"="+encodeURIComponent(l)];It.isNumber(p)&&D.push("expires="+new Date(p).toGMTString()),It.isString(v)&&D.push("path="+v),It.isString(A)&&D.push("domain="+A),R===!0&&D.push("secure"),document.cookie=D.join("; ")},read(r){const l=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return l?decodeURIComponent(l[3]):null},remove(r){this.write(r,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Wk(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}function Zk(r,l){return l?r.replace(/\/?\/$/,"")+"/"+l.replace(/^\/+/,""):r}function qI(r,l,p){let v=!Wk(l);return r&&(v||p==!1)?Zk(r,l):l}const dE=r=>r instanceof eo?{...r}:r;function $u(r,l){l=l||{};const p={};function v(W,H,ee,ne){return It.isPlainObject(W)&&It.isPlainObject(H)?It.merge.call({caseless:ne},W,H):It.isPlainObject(H)?It.merge({},H):It.isArray(H)?H.slice():H}function A(W,H,ee,ne){if(It.isUndefined(H)){if(!It.isUndefined(W))return v(void 0,W,ee,ne)}else return v(W,H,ee,ne)}function R(W,H){if(!It.isUndefined(H))return v(void 0,H)}function D(W,H){if(It.isUndefined(H)){if(!It.isUndefined(W))return v(void 0,W)}else return v(void 0,H)}function i(W,H,ee){if(ee in l)return v(W,H);if(ee in r)return v(void 0,W)}const G={url:R,method:R,data:R,baseURL:D,transformRequest:D,transformResponse:D,paramsSerializer:D,timeout:D,timeoutMessage:D,withCredentials:D,withXSRFToken:D,adapter:D,responseType:D,xsrfCookieName:D,xsrfHeaderName:D,onUploadProgress:D,onDownloadProgress:D,decompress:D,maxContentLength:D,maxBodyLength:D,beforeRedirect:D,transport:D,httpAgent:D,httpsAgent:D,cancelToken:D,socketPath:D,responseEncoding:D,validateStatus:i,headers:(W,H,ee)=>A(dE(W),dE(H),ee,!0)};return It.forEach(Object.keys(Object.assign({},r,l)),function(H){const ee=G[H]||A,ne=ee(r[H],l[H],H);It.isUndefined(ne)&&ee!==i||(p[H]=ne)}),p}const WI=r=>{const l=$u({},r);let{data:p,withXSRFToken:v,xsrfHeaderName:A,xsrfCookieName:R,headers:D,auth:i}=l;l.headers=D=eo.from(D),l.url=UI(qI(l.baseURL,l.url,l.allowAbsoluteUrls),r.params,r.paramsSerializer),i&&D.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):"")));let G;if(It.isFormData(p)){if(ms.hasStandardBrowserEnv||ms.hasStandardBrowserWebWorkerEnv)D.setContentType(void 0);else if((G=D.getContentType())!==!1){const[W,...H]=G?G.split(";").map(ee=>ee.trim()).filter(Boolean):[];D.setContentType([W||"multipart/form-data",...H].join("; "))}}if(ms.hasStandardBrowserEnv&&(v&&It.isFunction(v)&&(v=v(l)),v||v!==!1&&Hk(l.url))){const W=A&&R&&qk.read(R);W&&D.set(A,W)}return l},Xk=typeof XMLHttpRequest<"u",Kk=Xk&&function(r){return new Promise(function(p,v){const A=WI(r);let R=A.data;const D=eo.from(A.headers).normalize();let{responseType:i,onUploadProgress:G,onDownloadProgress:W}=A,H,ee,ne,de,he;function _e(){de&&de(),he&&he(),A.cancelToken&&A.cancelToken.unsubscribe(H),A.signal&&A.signal.removeEventListener("abort",H)}let Ie=new XMLHttpRequest;Ie.open(A.method.toUpperCase(),A.url,!0),Ie.timeout=A.timeout;function je(){if(!Ie)return;const Pt=eo.from("getAllResponseHeaders"in Ie&&Ie.getAllResponseHeaders()),ft={data:!i||i==="text"||i==="json"?Ie.responseText:Ie.response,status:Ie.status,statusText:Ie.statusText,headers:Pt,config:r,request:Ie};HI(function(Je){p(Je),_e()},function(Je){v(Je),_e()},ft),Ie=null}"onloadend"in Ie?Ie.onloadend=je:Ie.onreadystatechange=function(){!Ie||Ie.readyState!==4||Ie.status===0&&!(Ie.responseURL&&Ie.responseURL.indexOf("file:")===0)||setTimeout(je)},Ie.onabort=function(){Ie&&(v(new fn("Request aborted",fn.ECONNABORTED,r,Ie)),Ie=null)},Ie.onerror=function(){v(new fn("Network Error",fn.ERR_NETWORK,r,Ie)),Ie=null},Ie.ontimeout=function(){let ht=A.timeout?"timeout of "+A.timeout+"ms exceeded":"timeout exceeded";const ft=A.transitional||jI;A.timeoutErrorMessage&&(ht=A.timeoutErrorMessage),v(new fn(ht,ft.clarifyTimeoutError?fn.ETIMEDOUT:fn.ECONNABORTED,r,Ie)),Ie=null},R===void 0&&D.setContentType(null),"setRequestHeader"in Ie&&It.forEach(D.toJSON(),function(ht,ft){Ie.setRequestHeader(ft,ht)}),It.isUndefined(A.withCredentials)||(Ie.withCredentials=!!A.withCredentials),i&&i!=="json"&&(Ie.responseType=A.responseType),W&&([ne,he]=gy(W,!0),Ie.addEventListener("progress",ne)),G&&Ie.upload&&([ee,de]=gy(G),Ie.upload.addEventListener("progress",ee),Ie.upload.addEventListener("loadend",de)),(A.cancelToken||A.signal)&&(H=Pt=>{Ie&&(v(!Pt||Pt.type?new $d(null,r,Ie):Pt),Ie.abort(),Ie=null)},A.cancelToken&&A.cancelToken.subscribe(H),A.signal&&(A.signal.aborted?H():A.signal.addEventListener("abort",H)));const vt=jk(A.url);if(vt&&ms.protocols.indexOf(vt)===-1){v(new fn("Unsupported protocol "+vt+":",fn.ERR_BAD_REQUEST,r));return}Ie.send(R||null)})},Yk=(r,l)=>{const{length:p}=r=r?r.filter(Boolean):[];if(l||p){let v=new AbortController,A;const R=function(W){if(!A){A=!0,i();const H=W instanceof Error?W:this.reason;v.abort(H instanceof fn?H:new $d(H instanceof Error?H.message:H))}};let D=l&&setTimeout(()=>{D=null,R(new fn(`timeout ${l} of ms exceeded`,fn.ETIMEDOUT))},l);const i=()=>{r&&(D&&clearTimeout(D),D=null,r.forEach(W=>{W.unsubscribe?W.unsubscribe(R):W.removeEventListener("abort",R)}),r=null)};r.forEach(W=>W.addEventListener("abort",R));const{signal:G}=v;return G.unsubscribe=()=>It.asap(i),G}},Jk=function*(r,l){let p=r.byteLength;if(p<l){yield r;return}let v=0,A;for(;v<p;)A=v+l,yield r.slice(v,A),v=A},Qk=async function*(r,l){for await(const p of eF(r))yield*Jk(p,l)},eF=async function*(r){if(r[Symbol.asyncIterator]){yield*r;return}const l=r.getReader();try{for(;;){const{done:p,value:v}=await l.read();if(p)break;yield v}}finally{await l.cancel()}},fE=(r,l,p,v)=>{const A=Qk(r,l);let R=0,D,i=G=>{D||(D=!0,v&&v(G))};return new ReadableStream({async pull(G){try{const{done:W,value:H}=await A.next();if(W){i(),G.close();return}let ee=H.byteLength;if(p){let ne=R+=ee;p(ne)}G.enqueue(new Uint8Array(H))}catch(W){throw i(W),W}},cancel(G){return i(G),A.return()}},{highWaterMark:2})},Xy=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",ZI=Xy&&typeof ReadableStream=="function",tF=Xy&&(typeof TextEncoder=="function"?(r=>l=>r.encode(l))(new TextEncoder):async r=>new Uint8Array(await new Response(r).arrayBuffer())),XI=(r,...l)=>{try{return!!r(...l)}catch{return!1}},rF=ZI&&XI(()=>{let r=!1;const l=new Request(ms.origin,{body:new ReadableStream,method:"POST",get duplex(){return r=!0,"half"}}).headers.has("Content-Type");return r&&!l}),pE=64*1024,n1=ZI&&XI(()=>It.isReadableStream(new Response("").body)),yy={stream:n1&&(r=>r.body)};Xy&&(r=>{["text","arrayBuffer","blob","formData","stream"].forEach(l=>{!yy[l]&&(yy[l]=It.isFunction(r[l])?p=>p[l]():(p,v)=>{throw new fn(`Response type '${l}' is not supported`,fn.ERR_NOT_SUPPORT,v)})})})(new Response);const nF=async r=>{if(r==null)return 0;if(It.isBlob(r))return r.size;if(It.isSpecCompliantForm(r))return(await new Request(ms.origin,{method:"POST",body:r}).arrayBuffer()).byteLength;if(It.isArrayBufferView(r)||It.isArrayBuffer(r))return r.byteLength;if(It.isURLSearchParams(r)&&(r=r+""),It.isString(r))return(await tF(r)).byteLength},iF=async(r,l)=>{const p=It.toFiniteNumber(r.getContentLength());return p??nF(l)},sF=Xy&&(async r=>{let{url:l,method:p,data:v,signal:A,cancelToken:R,timeout:D,onDownloadProgress:i,onUploadProgress:G,responseType:W,headers:H,withCredentials:ee="same-origin",fetchOptions:ne}=WI(r);W=W?(W+"").toLowerCase():"text";let de=Yk([A,R&&R.toAbortSignal()],D),he;const _e=de&&de.unsubscribe&&(()=>{de.unsubscribe()});let Ie;try{if(G&&rF&&p!=="get"&&p!=="head"&&(Ie=await iF(H,v))!==0){let ft=new Request(l,{method:"POST",body:v,duplex:"half"}),bt;if(It.isFormData(v)&&(bt=ft.headers.get("content-type"))&&H.setContentType(bt),ft.body){const[Je,Et]=uE(Ie,gy(hE(G)));v=fE(ft.body,pE,Je,Et)}}It.isString(ee)||(ee=ee?"include":"omit");const je="credentials"in Request.prototype;he=new Request(l,{...ne,signal:de,method:p.toUpperCase(),headers:H.normalize().toJSON(),body:v,duplex:"half",credentials:je?ee:void 0});let vt=await fetch(he);const Pt=n1&&(W==="stream"||W==="response");if(n1&&(i||Pt&&_e)){const ft={};["status","statusText","headers"].forEach(pt=>{ft[pt]=vt[pt]});const bt=It.toFiniteNumber(vt.headers.get("content-length")),[Je,Et]=i&&uE(bt,gy(hE(i),!0))||[];vt=new Response(fE(vt.body,pE,Je,()=>{Et&&Et(),_e&&_e()}),ft)}W=W||"text";let ht=await yy[It.findKey(yy,W)||"text"](vt,r);return!Pt&&_e&&_e(),await new Promise((ft,bt)=>{HI(ft,bt,{data:ht,headers:eo.from(vt.headers),status:vt.status,statusText:vt.statusText,config:r,request:he})})}catch(je){throw _e&&_e(),je&&je.name==="TypeError"&&/fetch/i.test(je.message)?Object.assign(new fn("Network Error",fn.ERR_NETWORK,r,he),{cause:je.cause||je}):fn.from(je,je&&je.code,r,he)}}),i1={http:xk,xhr:Kk,fetch:sF};It.forEach(i1,(r,l)=>{if(r){try{Object.defineProperty(r,"name",{value:l})}catch{}Object.defineProperty(r,"adapterName",{value:l})}});const mE=r=>`- ${r}`,oF=r=>It.isFunction(r)||r===null||r===!1,KI={getAdapter:r=>{r=It.isArray(r)?r:[r];const{length:l}=r;let p,v;const A={};for(let R=0;R<l;R++){p=r[R];let D;if(v=p,!oF(p)&&(v=i1[(D=String(p)).toLowerCase()],v===void 0))throw new fn(`Unknown adapter '${D}'`);if(v)break;A[D||"#"+R]=v}if(!v){const R=Object.entries(A).map(([i,G])=>`adapter ${i} `+(G===!1?"is not supported by the environment":"is not available in the build"));let D=l?R.length>1?`since :
`+R.map(mE).join(`
`):" "+mE(R[0]):"as no adapter specified";throw new fn("There is no suitable adapter to dispatch the request "+D,"ERR_NOT_SUPPORT")}return v},adapters:i1};function Ix(r){if(r.cancelToken&&r.cancelToken.throwIfRequested(),r.signal&&r.signal.aborted)throw new $d(null,r)}function _E(r){return Ix(r),r.headers=eo.from(r.headers),r.data=Mx.call(r,r.transformRequest),["post","put","patch"].indexOf(r.method)!==-1&&r.headers.setContentType("application/x-www-form-urlencoded",!1),KI.getAdapter(r.adapter||Bm.adapter)(r).then(function(v){return Ix(r),v.data=Mx.call(r,r.transformResponse,v),v.headers=eo.from(v.headers),v},function(v){return GI(v)||(Ix(r),v&&v.response&&(v.response.data=Mx.call(r,r.transformResponse,v.response),v.response.headers=eo.from(v.response.headers))),Promise.reject(v)})}const YI="1.8.4",Ky={};["object","boolean","number","function","string","symbol"].forEach((r,l)=>{Ky[r]=function(v){return typeof v===r||"a"+(l<1?"n ":" ")+r}});const gE={};Ky.transitional=function(l,p,v){function A(R,D){return"[Axios v"+YI+"] Transitional option '"+R+"'"+D+(v?". "+v:"")}return(R,D,i)=>{if(l===!1)throw new fn(A(D," has been removed"+(p?" in "+p:"")),fn.ERR_DEPRECATED);return p&&!gE[D]&&(gE[D]=!0,console.warn(A(D," has been deprecated since v"+p+" and will be removed in the near future"))),l?l(R,D,i):!0}};Ky.spelling=function(l){return(p,v)=>(console.warn(`${v} is likely a misspelling of ${l}`),!0)};function aF(r,l,p){if(typeof r!="object")throw new fn("options must be an object",fn.ERR_BAD_OPTION_VALUE);const v=Object.keys(r);let A=v.length;for(;A-- >0;){const R=v[A],D=l[R];if(D){const i=r[R],G=i===void 0||D(i,R,r);if(G!==!0)throw new fn("option "+R+" must be "+G,fn.ERR_BAD_OPTION_VALUE);continue}if(p!==!0)throw new fn("Unknown option "+R,fn.ERR_BAD_OPTION)}}const ry={assertOptions:aF,validators:Ky},ka=ry.validators;let ku=class{constructor(l){this.defaults=l,this.interceptors={request:new lE,response:new lE}}async request(l,p){try{return await this._request(l,p)}catch(v){if(v instanceof Error){let A={};Error.captureStackTrace?Error.captureStackTrace(A):A=new Error;const R=A.stack?A.stack.replace(/^.+\n/,""):"";try{v.stack?R&&!String(v.stack).endsWith(R.replace(/^.+\n.+\n/,""))&&(v.stack+=`
`+R):v.stack=R}catch{}}throw v}}_request(l,p){typeof l=="string"?(p=p||{},p.url=l):p=l||{},p=$u(this.defaults,p);const{transitional:v,paramsSerializer:A,headers:R}=p;v!==void 0&&ry.assertOptions(v,{silentJSONParsing:ka.transitional(ka.boolean),forcedJSONParsing:ka.transitional(ka.boolean),clarifyTimeoutError:ka.transitional(ka.boolean)},!1),A!=null&&(It.isFunction(A)?p.paramsSerializer={serialize:A}:ry.assertOptions(A,{encode:ka.function,serialize:ka.function},!0)),p.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?p.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:p.allowAbsoluteUrls=!0),ry.assertOptions(p,{baseUrl:ka.spelling("baseURL"),withXsrfToken:ka.spelling("withXSRFToken")},!0),p.method=(p.method||this.defaults.method||"get").toLowerCase();let D=R&&It.merge(R.common,R[p.method]);R&&It.forEach(["delete","get","head","post","put","patch","common"],he=>{delete R[he]}),p.headers=eo.concat(D,R);const i=[];let G=!0;this.interceptors.request.forEach(function(_e){typeof _e.runWhen=="function"&&_e.runWhen(p)===!1||(G=G&&_e.synchronous,i.unshift(_e.fulfilled,_e.rejected))});const W=[];this.interceptors.response.forEach(function(_e){W.push(_e.fulfilled,_e.rejected)});let H,ee=0,ne;if(!G){const he=[_E.bind(this),void 0];for(he.unshift.apply(he,i),he.push.apply(he,W),ne=he.length,H=Promise.resolve(p);ee<ne;)H=H.then(he[ee++],he[ee++]);return H}ne=i.length;let de=p;for(ee=0;ee<ne;){const he=i[ee++],_e=i[ee++];try{de=he(de)}catch(Ie){_e.call(this,Ie);break}}try{H=_E.call(this,de)}catch(he){return Promise.reject(he)}for(ee=0,ne=W.length;ee<ne;)H=H.then(W[ee++],W[ee++]);return H}getUri(l){l=$u(this.defaults,l);const p=qI(l.baseURL,l.url,l.allowAbsoluteUrls);return UI(p,l.params,l.paramsSerializer)}};It.forEach(["delete","get","head","options"],function(l){ku.prototype[l]=function(p,v){return this.request($u(v||{},{method:l,url:p,data:(v||{}).data}))}});It.forEach(["post","put","patch"],function(l){function p(v){return function(R,D,i){return this.request($u(i||{},{method:l,headers:v?{"Content-Type":"multipart/form-data"}:{},url:R,data:D}))}}ku.prototype[l]=p(),ku.prototype[l+"Form"]=p(!0)});let lF=class JI{constructor(l){if(typeof l!="function")throw new TypeError("executor must be a function.");let p;this.promise=new Promise(function(R){p=R});const v=this;this.promise.then(A=>{if(!v._listeners)return;let R=v._listeners.length;for(;R-- >0;)v._listeners[R](A);v._listeners=null}),this.promise.then=A=>{let R;const D=new Promise(i=>{v.subscribe(i),R=i}).then(A);return D.cancel=function(){v.unsubscribe(R)},D},l(function(R,D,i){v.reason||(v.reason=new $d(R,D,i),p(v.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(l){if(this.reason){l(this.reason);return}this._listeners?this._listeners.push(l):this._listeners=[l]}unsubscribe(l){if(!this._listeners)return;const p=this._listeners.indexOf(l);p!==-1&&this._listeners.splice(p,1)}toAbortSignal(){const l=new AbortController,p=v=>{l.abort(v)};return this.subscribe(p),l.signal.unsubscribe=()=>this.unsubscribe(p),l.signal}static source(){let l;return{token:new JI(function(A){l=A}),cancel:l}}};function cF(r){return function(p){return r.apply(null,p)}}function uF(r){return It.isObject(r)&&r.isAxiosError===!0}const s1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(s1).forEach(([r,l])=>{s1[l]=r});function QI(r){const l=new ku(r),p=PI(ku.prototype.request,l);return It.extend(p,ku.prototype,l,{allOwnKeys:!0}),It.extend(p,l,null,{allOwnKeys:!0}),p.create=function(A){return QI($u(r,A))},p}const Ri=QI(Bm);Ri.Axios=ku;Ri.CanceledError=$d;Ri.CancelToken=lF;Ri.isCancel=GI;Ri.VERSION=YI;Ri.toFormData=Zy;Ri.AxiosError=fn;Ri.Cancel=Ri.CanceledError;Ri.all=function(l){return Promise.all(l)};Ri.spread=cF;Ri.isAxiosError=uF;Ri.mergeConfig=$u;Ri.AxiosHeaders=eo;Ri.formToJSON=r=>$I(It.isHTMLForm(r)?new FormData(r):r);Ri.getAdapter=KI.getAdapter;Ri.HttpStatusCode=s1;Ri.default=Ri;const{Axios:Aj,AxiosError:Mj,CanceledError:Ij,isCancel:Cj,CancelToken:Pj,VERSION:Rj,all:Dj,Cancel:zj,isAxiosError:Lj,spread:Oj,toFormData:kj,AxiosHeaders:Fj,HttpStatusCode:Bj,formToJSON:Nj,getAdapter:Vj,mergeConfig:Uj}=Ri,eC=pI("GameMap",{state:()=>({isinit:!1,marks:[],unshowMarks:[],pointsIds:[],showName:!1,loading:!0,showAddMarker:!1,editPointData:{mark_name:"",mark_type:"points",mark_position:[0,0]}}),getters:{fillterMarks(r){return r.marks.filter(l=>!r.unshowMarks.includes(l.id))}},actions:{async getMarksData(){const{data:r}=await Ri.get("/data/points.json");return this.marks=r,this.marks}}}),_s=typeof window<"u",W1=_s&&"IntersectionObserver"in window,hF=_s&&("ontouchstart"in window||window.navigator.maxTouchPoints>0);function yE(r,l,p){dF(r,l),l.set(r,p)}function dF(r,l){if(l.has(r))throw new TypeError("Cannot initialize the same private elements twice on an object")}function fF(r,l,p){return r.set(tC(r,l),p),p}function Au(r,l){return r.get(tC(r,l))}function tC(r,l,p){if(typeof r=="function"?r===l:r.has(l))return arguments.length<3?l:p;throw new TypeError("Private element is not present on this object")}function pF(r,l,p){const v=l.length-1;if(v<0)return r===void 0?p:r;for(let A=0;A<v;A++){if(r==null)return p;r=r[l[A]]}return r==null||r[l[v]]===void 0?p:r[l[v]]}function Yy(r,l){if(r===l)return!0;if(r instanceof Date&&l instanceof Date&&r.getTime()!==l.getTime()||r!==Object(r)||l!==Object(l))return!1;const p=Object.keys(r);return p.length!==Object.keys(l).length?!1:p.every(v=>Yy(r[v],l[v]))}function vE(r,l,p){return r==null||!l||typeof l!="string"?p:r[l]!==void 0?r[l]:(l=l.replace(/\[(\w+)\]/g,".$1"),l=l.replace(/^\./,""),pF(r,l.split("."),p))}function rC(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Array.from({length:r},(p,v)=>l+v)}function ni(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"px";if(r==null||r==="")return;const p=Number(r);return isNaN(p)?String(r):isFinite(p)?`${p}${l}`:void 0}function mF(r){return r!==null&&typeof r=="object"&&!Array.isArray(r)}function xE(r){let l;return r!==null&&typeof r=="object"&&((l=Object.getPrototypeOf(r))===Object.prototype||l===null)}function nC(r){if(r&&"$el"in r){const l=r.$el;return(l==null?void 0:l.nodeType)===Node.TEXT_NODE?l.nextElementSibling:l}return r}const bE=Object.freeze({enter:13,tab:9,delete:46,esc:27,space:32,up:38,down:40,left:37,right:39,end:35,home:36,del:46,backspace:8,insert:45,pageup:33,pagedown:34,shift:16});function Cx(r,l){return l.every(p=>r.hasOwnProperty(p))}function _F(r,l){const p={};for(const v of l)Object.hasOwn(r,v)&&(p[v]=r[v]);return p}function gF(r){return r==null?[]:Array.isArray(r)?r:[r]}function vy(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.max(l,Math.min(p,r))}function wE(r,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0";return r+p.repeat(Math.max(0,l-r.length))}function TE(r,l){return(arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0").repeat(Math.max(0,l-r.length))+r}function yF(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const p=[];let v=0;for(;v<r.length;)p.push(r.substr(v,l)),v+=l;return p}function gs(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const v={};for(const A in r)v[A]=r[A];for(const A in l){const R=r[A],D=l[A];if(xE(R)&&xE(D)){v[A]=gs(R,D,p);continue}if(p&&Array.isArray(R)&&Array.isArray(D)){v[A]=p(R,D);continue}v[A]=D}return v}function iC(r){return r.map(l=>l.type===ti?iC(l.children):l).flat()}function Fu(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";if(Fu.cache.has(r))return Fu.cache.get(r);const l=r.replace(/[^a-z]/gi,"-").replace(/\B([A-Z])/g,"-$1").toLowerCase();return Fu.cache.set(r,l),l}Fu.cache=new Map;function Sd(r,l){if(!l||typeof l!="object")return[];if(Array.isArray(l))return l.map(p=>Sd(r,p)).flat(1);if(l.suspense)return Sd(r,l.ssContent);if(Array.isArray(l.children))return l.children.map(p=>Sd(r,p)).flat(1);if(l.component){if(Object.getOwnPropertySymbols(l.component.provides).includes(r))return[l.component];if(l.component.subTree)return Sd(r,l.component.subTree).flat(1)}return[]}var Ug=new WeakMap,yd=new WeakMap;class vF{constructor(l){yE(this,Ug,[]),yE(this,yd,0),this.size=l}push(l){Au(Ug,this)[Au(yd,this)]=l,fF(yd,this,(Au(yd,this)+1)%this.size)}values(){return Au(Ug,this).slice(Au(yd,this)).concat(Au(Ug,this).slice(0,Au(yd,this)))}}function sC(r){const l=Ki({}),p=et(r);return Hu(()=>{for(const v in p.value)l[v]=p.value[v]},{flush:"sync"}),Fy(l)}function o1(r,l){return r.includes(l)}const SE=()=>[Function,Array];function EE(r,l){return l="on"+Mc(l),!!(r[l]||r[`${l}Once`]||r[`${l}Capture`]||r[`${l}OnceCapture`]||r[`${l}CaptureOnce`])}function xF(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const p=["button","[href]",'input:not([type="hidden"])',"select","textarea","[tabindex]"].map(v=>`${v}${l?':not([tabindex="-1"])':""}:not([disabled])`).join(", ");return[...r.querySelectorAll(p)]}function bF(r,l){if(!_s||r===0)return l(),()=>{};const p=window.setTimeout(l,r);return()=>window.clearTimeout(p)}function wF(){const r=Vn(),l=p=>{r.value=p};return Object.defineProperty(l,"value",{enumerable:!0,get:()=>r.value,set:p=>r.value=p}),Object.defineProperty(l,"el",{enumerable:!0,get:()=>nC(r.value)}),l}const TF=["top","bottom"],SF=["start","end","left","right"];function EF(r,l){let[p,v]=r.split(" ");return v||(v=o1(TF,p)?"start":o1(SF,p)?"top":"center"),{side:a1(p,l),align:a1(v,l)}}function a1(r,l){return r==="start"?l?"right":"left":r==="end"?l?"left":"right":r}const vd=2.4,AE=.2126729,ME=.7151522,IE=.072175,AF=.55,MF=.58,IF=.57,CF=.62,jg=.03,CE=1.45,PF=5e-4,RF=1.25,DF=1.25,zF=.078,PE=12.82051282051282,$g=.06,LF=.001;function RE(r,l){const p=(r.r/255)**vd,v=(r.g/255)**vd,A=(r.b/255)**vd,R=(l.r/255)**vd,D=(l.g/255)**vd,i=(l.b/255)**vd;let G=p*AE+v*ME+A*IE,W=R*AE+D*ME+i*IE;if(G<=jg&&(G+=(jg-G)**CE),W<=jg&&(W+=(jg-W)**CE),Math.abs(W-G)<PF)return 0;let H;if(W>G){const ee=(W**AF-G**MF)*RF;H=ee<LF?0:ee<zF?ee-ee*PE*$g:ee-$g}else{const ee=(W**CF-G**IF)*DF;H=ee>-.001?0:ee>-.078?ee-ee*PE*$g:ee+$g}return H*100}const xy=.20689655172413793,OF=r=>r>xy**3?Math.cbrt(r):r/(3*xy**2)+4/29,kF=r=>r>xy?r**3:3*xy**2*(r-4/29);function oC(r){const l=OF,p=l(r[1]);return[116*p-16,500*(l(r[0]/.95047)-p),200*(p-l(r[2]/1.08883))]}function aC(r){const l=kF,p=(r[0]+16)/116;return[l(p+r[1]/500)*.95047,l(p),l(p-r[2]/200)*1.08883]}const FF=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],BF=r=>r<=.0031308?r*12.92:1.055*r**(1/2.4)-.055,NF=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],VF=r=>r<=.04045?r/12.92:((r+.055)/1.055)**2.4;function lC(r){const l=Array(3),p=BF,v=FF;for(let A=0;A<3;++A)l[A]=Math.round(vy(p(v[A][0]*r[0]+v[A][1]*r[1]+v[A][2]*r[2]))*255);return{r:l[0],g:l[1],b:l[2]}}function Z1(r){let{r:l,g:p,b:v}=r;const A=[0,0,0],R=VF,D=NF;l=R(l/255),p=R(p/255),v=R(v/255);for(let i=0;i<3;++i)A[i]=D[i][0]*l+D[i][1]*p+D[i][2]*v;return A}function l1(r){return!!r&&/^(#|var\(--|(rgb|hsl)a?\()/.test(r)}function UF(r){return l1(r)&&!/^((rgb|hsl)a?\()?var\(--/.test(r)}const DE=/^(?<fn>(?:rgb|hsl)a?)\((?<values>.+)\)/,jF={rgb:(r,l,p,v)=>({r,g:l,b:p,a:v}),rgba:(r,l,p,v)=>({r,g:l,b:p,a:v}),hsl:(r,l,p,v)=>zE({h:r,s:l,l:p,a:v}),hsla:(r,l,p,v)=>zE({h:r,s:l,l:p,a:v}),hsv:(r,l,p,v)=>Sm({h:r,s:l,v:p,a:v}),hsva:(r,l,p,v)=>Sm({h:r,s:l,v:p,a:v})};function Va(r){if(typeof r=="number")return{r:(r&16711680)>>16,g:(r&65280)>>8,b:r&255};if(typeof r=="string"&&DE.test(r)){const{groups:l}=r.match(DE),{fn:p,values:v}=l,A=v.split(/,\s*/).map(R=>R.endsWith("%")&&["hsl","hsla","hsv","hsva"].includes(p)?parseFloat(R)/100:parseFloat(R));return jF[p](...A)}else if(typeof r=="string"){let l=r.startsWith("#")?r.slice(1):r;return[3,4].includes(l.length)?l=l.split("").map(p=>p+p).join(""):[6,8].includes(l.length),GF(l)}else if(typeof r=="object"){if(Cx(r,["r","g","b"]))return r;if(Cx(r,["h","s","l"]))return Sm(cC(r));if(Cx(r,["h","s","v"]))return Sm(r)}throw new TypeError(`Invalid color: ${r==null?r:String(r)||r.constructor.name}
Expected #hex, #hexa, rgb(), rgba(), hsl(), hsla(), object or number`)}function Sm(r){const{h:l,s:p,v,a:A}=r,R=i=>{const G=(i+l/60)%6;return v-v*p*Math.max(Math.min(G,4-G,1),0)},D=[R(5),R(3),R(1)].map(i=>Math.round(i*255));return{r:D[0],g:D[1],b:D[2],a:A}}function zE(r){return Sm(cC(r))}function cC(r){const{h:l,s:p,l:v,a:A}=r,R=v+p*Math.min(v,1-v),D=R===0?0:2-2*v/R;return{h:l,s:D,v:R,a:A}}function Gg(r){const l=Math.round(r).toString(16);return("00".substr(0,2-l.length)+l).toUpperCase()}function $F(r){let{r:l,g:p,b:v,a:A}=r;return`#${[Gg(l),Gg(p),Gg(v),A!==void 0?Gg(Math.round(A*255)):""].join("")}`}function GF(r){r=HF(r);let[l,p,v,A]=yF(r,2).map(R=>parseInt(R,16));return A=A===void 0?A:A/255,{r:l,g:p,b:v,a:A}}function HF(r){return r.startsWith("#")&&(r=r.slice(1)),r=r.replace(/([^0-9a-f])/gi,"F"),(r.length===3||r.length===4)&&(r=r.split("").map(l=>l+l).join("")),r.length!==6&&(r=wE(wE(r,6),8,"F")),r}function qF(r,l){const p=oC(Z1(r));return p[0]=p[0]+l*10,lC(aC(p))}function WF(r,l){const p=oC(Z1(r));return p[0]=p[0]-l*10,lC(aC(p))}function ZF(r){const l=Va(r);return Z1(l)[1]}function uC(r){const l=Math.abs(RE(Va(0),Va(r)));return Math.abs(RE(Va(16777215),Va(r)))>Math.min(l,50)?"#fff":"#000"}function ln(r,l){return p=>Object.keys(r).reduce((v,A)=>{const D=typeof r[A]=="object"&&r[A]!=null&&!Array.isArray(r[A])?r[A]:{type:r[A]};return p&&A in p?v[A]={...D,default:p[A]}:v[A]=D,l&&!v[A].source&&(v[A].source=l),v},{})}const Ei=ln({class:[String,Array,Object],style:{type:[String,Array,Object],default:null}},"component");function Gs(r,l){const p=$s();if(!p)throw new Error(`[Vuetify] ${r} must be called from inside a setup function`);return p}function Pc(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"composables";const l=Gs(r).type;return Fu((l==null?void 0:l.aliasName)||(l==null?void 0:l.name))}let hC=0,ny=new WeakMap;function Jy(){const r=Gs("getUid");if(ny.has(r))return ny.get(r);{const l=hC++;return ny.set(r,l),l}}Jy.reset=()=>{hC=0,ny=new WeakMap};function XF(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Gs("injectSelf");const{provides:p}=l;if(p&&r in p)return p[r]}const Fd=Symbol.for("vuetify:defaults");function KF(r){return dn(r)}function X1(){const r=Pn(Fd);if(!r)throw new Error("[Vuetify] Could not find defaults instance");return r}function Nm(r,l){const p=X1(),v=dn(r),A=et(()=>{if(xt(l==null?void 0:l.disabled))return p.value;const D=xt(l==null?void 0:l.scoped),i=xt(l==null?void 0:l.reset),G=xt(l==null?void 0:l.root);if(v.value==null&&!(D||i||G))return p.value;let W=gs(v.value,{prev:p.value});if(D)return W;if(i||G){const H=Number(i||1/0);for(let ee=0;ee<=H&&!(!W||!("prev"in W));ee++)W=W.prev;return W&&typeof G=="string"&&G in W&&(W=gs(gs(W,{prev:W}),W[G])),W}return W.prev?gs(W.prev,W):W});return vo(Fd,A),A}function YF(r,l){var p,v;return typeof((p=r.props)==null?void 0:p[l])<"u"||typeof((v=r.props)==null?void 0:v[Fu(l)])<"u"}function JF(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1?arguments[1]:void 0,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:X1();const v=Gs("useDefaults");if(l=l??v.type.name??v.type.__name,!l)throw new Error("[Vuetify] Could not determine component name");const A=et(()=>{var G;return(G=p.value)==null?void 0:G[r._as??l]}),R=new Proxy(r,{get(G,W){var ee,ne,de,he,_e,Ie,je;const H=Reflect.get(G,W);return W==="class"||W==="style"?[(ee=A.value)==null?void 0:ee[W],H].filter(vt=>vt!=null):typeof W=="string"&&!YF(v.vnode,W)?((ne=A.value)==null?void 0:ne[W])!==void 0?(de=A.value)==null?void 0:de[W]:((_e=(he=p.value)==null?void 0:he.global)==null?void 0:_e[W])!==void 0?(je=(Ie=p.value)==null?void 0:Ie.global)==null?void 0:je[W]:H:H}}),D=Vn();Hu(()=>{if(A.value){const G=Object.entries(A.value).filter(W=>{let[H]=W;return H.startsWith(H[0].toUpperCase())});D.value=G.length?Object.fromEntries(G):void 0}else D.value=void 0});function i(){const G=XF(Fd,v);vo(Fd,et(()=>D.value?gs((G==null?void 0:G.value)??{},D.value):G==null?void 0:G.value))}return{props:R,provideSubDefaults:i}}function Vm(r){if(r._setup=r._setup??r.setup,!r.name)return r;if(r._setup){r.props=ln(r.props??{},r.name)();const l=Object.keys(r.props).filter(p=>p!=="class"&&p!=="style");r.filterProps=function(v){return _F(v,l)},r.props._as=String,r.setup=function(v,A){const R=X1();if(!R.value)return r._setup(v,A);const{props:D,provideSubDefaults:i}=JF(v,v._as??r.name,R),G=r._setup(D,A);return i(),G}}return r}function si(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return l=>(r?Vm:pn)(l)}function QF(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"div",p=arguments.length>2?arguments[2]:void 0;return si()({name:p??Mc(js(r.replace(/__/g,"-"))),props:{tag:{type:String,default:l},...Ei()},setup(v,A){let{slots:R}=A;return()=>{var D;return bl(v.tag,{class:[r,v.class],style:v.style},(D=R.default)==null?void 0:D.call(R))}}})}function Bi(r){const l=Gs("useRender");l.render=r}const Gd=ln({border:[Boolean,Number,String]},"border");function Hd(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pc();return{borderClasses:et(()=>{const v=Yn(r)?r.value:r.border,A=[];if(v===!0||v==="")A.push(`${l}--border`);else if(typeof v=="string"||v===0)for(const R of String(v).split(" "))A.push(`border-${R}`);return A})}}const e5=[null,"default","comfortable","compact"],qd=ln({density:{type:String,default:"default",validator:r=>e5.includes(r)}},"density");function Um(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pc();return{densityClasses:et(()=>`${l}--density-${r.density}`)}}const jm=ln({elevation:{type:[Number,String],validator(r){const l=parseInt(r);return!isNaN(l)&&l>=0&&l<=24}}},"elevation");function $m(r){return{elevationClasses:et(()=>{const p=Yn(r)?r.value:r.elevation,v=[];return p==null||v.push(`elevation-${p}`),v})}}const Rc=ln({rounded:{type:[Boolean,Number,String],default:void 0},tile:Boolean},"rounded");function Dc(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pc();return{roundedClasses:et(()=>{const v=Yn(r)?r.value:r.rounded,A=Yn(r)?r.value:r.tile,R=[];if(v===!0||v==="")R.push(`${l}--rounded`);else if(typeof v=="string"||v===0)for(const D of String(v).split(" "))R.push(`rounded-${D}`);else(A||v===!1)&&R.push("rounded-0");return R})}}const vs=ln({tag:{type:String,default:"div"}},"tag"),by=Symbol.for("vuetify:theme"),ja=ln({theme:String},"theme");function LE(){return{defaultTheme:"light",variations:{colors:[],lighten:0,darken:0},themes:{light:{dark:!1,colors:{background:"#FFFFFF",surface:"#FFFFFF","surface-bright":"#FFFFFF","surface-light":"#EEEEEE","surface-variant":"#424242","on-surface-variant":"#EEEEEE",primary:"#1867C0","primary-darken-1":"#1F5592",secondary:"#48A9A6","secondary-darken-1":"#018786",error:"#B00020",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#000000","border-opacity":.12,"high-emphasis-opacity":.87,"medium-emphasis-opacity":.6,"disabled-opacity":.38,"idle-opacity":.04,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.12,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#F5F5F5","theme-on-code":"#000000"}},dark:{dark:!0,colors:{background:"#121212",surface:"#212121","surface-bright":"#ccbfd6","surface-light":"#424242","surface-variant":"#a3a3a3","on-surface-variant":"#424242",primary:"#2196F3","primary-darken-1":"#277CC1",secondary:"#54B6B2","secondary-darken-1":"#48A9A6",error:"#CF6679",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#FFFFFF","border-opacity":.12,"high-emphasis-opacity":1,"medium-emphasis-opacity":.7,"disabled-opacity":.5,"idle-opacity":.1,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.16,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#343434","theme-on-code":"#CCCCCC"}}}}}function t5(){var v,A;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:LE();const l=LE();if(!r)return{...l,isDisabled:!0};const p={};for(const[R,D]of Object.entries(r.themes??{})){const i=D.dark||R==="dark"?(v=l.themes)==null?void 0:v.dark:(A=l.themes)==null?void 0:A.light;p[R]=gs(i,D)}return gs(l,{...r,themes:p})}function r5(r){const l=t5(r),p=dn(l.defaultTheme),v=dn(l.themes),A=et(()=>{const H={};for(const[ee,ne]of Object.entries(v.value)){const de=H[ee]={...ne,colors:{...ne.colors}};if(l.variations)for(const he of l.variations.colors){const _e=de.colors[he];if(_e)for(const Ie of["lighten","darken"]){const je=Ie==="lighten"?qF:WF;for(const vt of rC(l.variations[Ie],1))de.colors[`${he}-${Ie}-${vt}`]=$F(je(Va(_e),vt))}}for(const he of Object.keys(de.colors)){if(/^on-[a-z]/.test(he)||de.colors[`on-${he}`])continue;const _e=`on-${he}`,Ie=Va(de.colors[he]);de.colors[_e]=uC(Ie)}}return H}),R=et(()=>A.value[p.value]),D=et(()=>{var he;const H=[];(he=R.value)!=null&&he.dark&&Mu(H,":root",["color-scheme: dark"]),Mu(H,":root",OE(R.value));for(const[_e,Ie]of Object.entries(A.value))Mu(H,`.v-theme--${_e}`,[`color-scheme: ${Ie.dark?"dark":"normal"}`,...OE(Ie)]);const ee=[],ne=[],de=new Set(Object.values(A.value).flatMap(_e=>Object.keys(_e.colors)));for(const _e of de)/^on-[a-z]/.test(_e)?Mu(ne,`.${_e}`,[`color: rgb(var(--v-theme-${_e})) !important`]):(Mu(ee,`.bg-${_e}`,[`--v-theme-overlay-multiplier: var(--v-theme-${_e}-overlay-multiplier)`,`background-color: rgb(var(--v-theme-${_e})) !important`,`color: rgb(var(--v-theme-on-${_e})) !important`]),Mu(ne,`.text-${_e}`,[`color: rgb(var(--v-theme-${_e})) !important`]),Mu(ne,`.border-${_e}`,[`--v-border-color: var(--v-theme-${_e})`]));return H.push(...ee,...ne),H.map((_e,Ie)=>Ie===0?_e:`    ${_e}`).join("")});function i(){return{style:[{textContent:D.value,id:"vuetify-theme-stylesheet",nonce:l.cspNonce||!1}]}}function G(H){if(l.isDisabled)return;const ee=H._context.provides.usehead;if(ee)if(ee.push){const ne=ee.push(i);_s&&Tn(D,()=>{ne.patch(i)})}else _s?(ee.addHeadObjs(et(i)),Hu(()=>ee.updateDOM())):ee.addHeadObjs(i());else{let de=function(){if(typeof document<"u"&&!ne){const he=document.createElement("style");he.type="text/css",he.id="vuetify-theme-stylesheet",l.cspNonce&&he.setAttribute("nonce",l.cspNonce),ne=he,document.head.appendChild(ne)}ne&&(ne.innerHTML=D.value)},ne=_s?document.getElementById("vuetify-theme-stylesheet"):null;_s?Tn(D,de,{immediate:!0}):de()}}const W=et(()=>l.isDisabled?void 0:`v-theme--${p.value}`);return{install:G,isDisabled:l.isDisabled,name:p,themes:v,current:R,computedThemes:A,themeClasses:W,styles:D,global:{name:p,current:R}}}function $a(r){Gs("provideTheme");const l=Pn(by,null);if(!l)throw new Error("Could not find Vuetify theme injection");const p=et(()=>r.theme??l.name.value),v=et(()=>l.themes.value[p.value]),A=et(()=>l.isDisabled?void 0:`v-theme--${p.value}`),R={...l,name:p,current:v,themeClasses:A};return vo(by,R),R}function Mu(r,l,p){r.push(`${l} {
`,...p.map(v=>`  ${v};
`),`}
`)}function OE(r){const l=r.dark?2:1,p=r.dark?1:2,v=[];for(const[A,R]of Object.entries(r.colors)){const D=Va(R);v.push(`--v-theme-${A}: ${D.r},${D.g},${D.b}`),A.startsWith("on-")||v.push(`--v-theme-${A}-overlay-multiplier: ${ZF(R)>.18?l:p}`)}for(const[A,R]of Object.entries(r.variables)){const D=typeof R=="string"&&R.startsWith("#")?Va(R):void 0,i=D?`${D.r}, ${D.g}, ${D.b}`:void 0;v.push(`--v-${A}: ${i??R}`)}return v}function K1(r){return sC(()=>{const l=[],p={};if(r.value.background)if(l1(r.value.background)){if(p.backgroundColor=r.value.background,!r.value.text&&UF(r.value.background)){const v=Va(r.value.background);if(v.a==null||v.a===1){const A=uC(v);p.color=A,p.caretColor=A}}}else l.push(`bg-${r.value.background}`);return r.value.text&&(l1(r.value.text)?(p.color=r.value.text,p.caretColor=r.value.text):l.push(`text-${r.value.text}`)),{colorClasses:l,colorStyles:p}})}function wy(r,l){const p=et(()=>({text:Yn(r)?r.value:l?r[l]:null})),{colorClasses:v,colorStyles:A}=K1(p);return{textColorClasses:v,textColorStyles:A}}function Cd(r,l){const p=et(()=>({background:Yn(r)?r.value:l?r[l]:null})),{colorClasses:v,colorStyles:A}=K1(p);return{backgroundColorClasses:v,backgroundColorStyles:A}}const n5=["elevated","flat","tonal","outlined","text","plain"];function Qy(r,l){return st(ti,null,[r&&st("span",{key:"overlay",class:`${l}__overlay`},null),st("span",{key:"underlay",class:`${l}__underlay`},null)])}const Wd=ln({color:String,variant:{type:String,default:"elevated",validator:r=>n5.includes(r)}},"variant");function e0(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pc();const p=et(()=>{const{variant:R}=xt(r);return`${l}--variant-${R}`}),{colorClasses:v,colorStyles:A}=K1(et(()=>{const{variant:R,color:D}=xt(r);return{[["elevated","flat"].includes(R)?"background":"text"]:D}}));return{colorClasses:v,colorStyles:A,variantClasses:p}}const dC=ln({baseColor:String,divided:Boolean,...Gd(),...Ei(),...qd(),...jm(),...Rc(),...vs(),...ja(),...Wd()},"VBtnGroup"),kE=si()({name:"VBtnGroup",props:dC(),setup(r,l){let{slots:p}=l;const{themeClasses:v}=$a(r),{densityClasses:A}=Um(r),{borderClasses:R}=Hd(r),{elevationClasses:D}=$m(r),{roundedClasses:i}=Dc(r);Nm({VBtn:{height:"auto",baseColor:Si(r,"baseColor"),color:Si(r,"color"),density:Si(r,"density"),flat:!0,variant:Si(r,"variant")}}),Bi(()=>st(r.tag,{class:["v-btn-group",{"v-btn-group--divided":r.divided},v.value,R.value,A.value,D.value,i.value,r.class],style:r.style},p))}});function fm(r,l){let p;function v(){p=x1(),p.run(()=>l.length?l(()=>{p==null||p.stop(),v()}):l())}Tn(r,A=>{A&&!p?v():A||(p==null||p.stop(),p=void 0)},{immediate:!0}),Oy(()=>{p==null||p.stop()})}function Gm(r,l,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ee=>ee,A=arguments.length>4&&arguments[4]!==void 0?arguments[4]:ee=>ee;const R=Gs("useProxiedModel"),D=dn(r[l]!==void 0?r[l]:p),i=Fu(l),W=et(i!==l?()=>{var ee,ne,de,he;return r[l],!!(((ee=R.vnode.props)!=null&&ee.hasOwnProperty(l)||(ne=R.vnode.props)!=null&&ne.hasOwnProperty(i))&&((de=R.vnode.props)!=null&&de.hasOwnProperty(`onUpdate:${l}`)||(he=R.vnode.props)!=null&&he.hasOwnProperty(`onUpdate:${i}`)))}:()=>{var ee,ne;return r[l],!!((ee=R.vnode.props)!=null&&ee.hasOwnProperty(l)&&((ne=R.vnode.props)!=null&&ne.hasOwnProperty(`onUpdate:${l}`)))});fm(()=>!W.value,()=>{Tn(()=>r[l],ee=>{D.value=ee})});const H=et({get(){const ee=r[l];return v(W.value?ee:D.value)},set(ee){const ne=A(ee),de=zn(W.value?r[l]:D.value);de===ne||v(de)===ee||(D.value=ne,R==null||R.emit(`update:${l}`,ne))}});return Object.defineProperty(H,"externalValue",{get:()=>W.value?r[l]:D.value}),H}const Y1=ln({modelValue:{type:null,default:void 0},multiple:Boolean,mandatory:[Boolean,String],max:Number,selectedClass:String,disabled:Boolean},"group"),fC=ln({value:null,disabled:Boolean,selectedClass:String},"group-item");function pC(r,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const v=Gs("useGroupItem");if(!v)throw new Error("[Vuetify] useGroupItem composable must be used inside a component setup function");const A=Jy();vo(Symbol.for(`${l.description}:id`),A);const R=Pn(l,null);if(!R){if(!p)return R;throw new Error(`[Vuetify] Could not find useGroup injection with symbol ${l.description}`)}const D=Si(r,"value"),i=et(()=>!!(R.disabled.value||r.disabled));R.register({id:A,value:D,disabled:i},v),Ua(()=>{R.unregister(A)});const G=et(()=>R.isSelected(A)),W=et(()=>R.items.value[0].id===A),H=et(()=>R.items.value[R.items.value.length-1].id===A),ee=et(()=>G.value&&[R.selectedClass.value,r.selectedClass]);return Tn(G,ne=>{v.emit("group:selected",{value:ne})},{flush:"sync"}),{id:A,isSelected:G,isFirst:W,isLast:H,toggle:()=>R.select(A,!G.value),select:ne=>R.select(A,ne),selectedClass:ee,value:D,disabled:i,group:R}}function J1(r,l){let p=!1;const v=Ki([]),A=Gm(r,"modelValue",[],ne=>ne==null?[]:mC(v,gF(ne)),ne=>{const de=s5(v,ne);return r.multiple?de:de[0]}),R=Gs("useGroup");function D(ne,de){const he=ne,_e=Symbol.for(`${l.description}:id`),je=Sd(_e,R==null?void 0:R.vnode).indexOf(de);xt(he.value)==null&&(he.value=je,he.useIndexAsValue=!0),je>-1?v.splice(je,0,he):v.push(he)}function i(ne){if(p)return;G();const de=v.findIndex(he=>he.id===ne);v.splice(de,1)}function G(){const ne=v.find(de=>!de.disabled);ne&&r.mandatory==="force"&&!A.value.length&&(A.value=[ne.id])}fa(()=>{G()}),Ua(()=>{p=!0}),D1(()=>{for(let ne=0;ne<v.length;ne++)v[ne].useIndexAsValue&&(v[ne].value=ne)});function W(ne,de){const he=v.find(_e=>_e.id===ne);if(!(de&&(he!=null&&he.disabled)))if(r.multiple){const _e=A.value.slice(),Ie=_e.findIndex(vt=>vt===ne),je=~Ie;if(de=de??!je,je&&r.mandatory&&_e.length<=1||!je&&r.max!=null&&_e.length+1>r.max)return;Ie<0&&de?_e.push(ne):Ie>=0&&!de&&_e.splice(Ie,1),A.value=_e}else{const _e=A.value.includes(ne);if(r.mandatory&&_e)return;A.value=de??!_e?[ne]:[]}}function H(ne){if(r.multiple,A.value.length){const de=A.value[0],he=v.findIndex(je=>je.id===de);let _e=(he+ne)%v.length,Ie=v[_e];for(;Ie.disabled&&_e!==he;)_e=(_e+ne)%v.length,Ie=v[_e];if(Ie.disabled)return;A.value=[v[_e].id]}else{const de=v.find(he=>!he.disabled);de&&(A.value=[de.id])}}const ee={register:D,unregister:i,selected:A,select:W,disabled:Si(r,"disabled"),prev:()=>H(v.length-1),next:()=>H(1),isSelected:ne=>A.value.includes(ne),selectedClass:et(()=>r.selectedClass),items:et(()=>v),getItemIndex:ne=>i5(v,ne)};return vo(l,ee),ee}function i5(r,l){const p=mC(r,[l]);return p.length?r.findIndex(v=>v.id===p[0]):-1}function mC(r,l){const p=[];return l.forEach(v=>{const A=r.find(D=>Yy(v,D.value)),R=r[v];(A==null?void 0:A.value)!=null?p.push(A.id):R!=null&&p.push(R.id)}),p}function s5(r,l){const p=[];return l.forEach(v=>{const A=r.findIndex(R=>R.id===v);if(~A){const R=r[A];p.push(R.value!=null?R.value:A)}}),p}const _C=Symbol.for("vuetify:v-btn-toggle"),o5=ln({...dC(),...Y1()},"VBtnToggle");si()({name:"VBtnToggle",props:o5(),emits:{"update:modelValue":r=>!0},setup(r,l){let{slots:p}=l;const{isSelected:v,next:A,prev:R,select:D,selected:i}=J1(r,_C);return Bi(()=>{const G=kE.filterProps(r);return st(kE,ys({class:["v-btn-toggle",r.class]},G,{style:r.style}),{default:()=>{var W;return[(W=p.default)==null?void 0:W.call(p,{isSelected:v,next:A,prev:R,select:D,selected:i})]}})}),{next:A,prev:R,select:D}}});const a5=ln({defaults:Object,disabled:Boolean,reset:[Number,String],root:[Boolean,String],scoped:Boolean},"VDefaultsProvider"),Bo=si(!1)({name:"VDefaultsProvider",props:a5(),setup(r,l){let{slots:p}=l;const{defaults:v,disabled:A,reset:R,root:D,scoped:i}=Fy(r);return Nm(v,{reset:R,root:D,scoped:i,disabled:A}),()=>{var G;return(G=p.default)==null?void 0:G.call(p)}}}),l5={collapse:"mdi-chevron-up",complete:"mdi-check",cancel:"mdi-close-circle",close:"mdi-close",delete:"mdi-close-circle",clear:"mdi-close-circle",success:"mdi-check-circle",info:"mdi-information",warning:"mdi-alert-circle",error:"mdi-close-circle",prev:"mdi-chevron-left",next:"mdi-chevron-right",checkboxOn:"mdi-checkbox-marked",checkboxOff:"mdi-checkbox-blank-outline",checkboxIndeterminate:"mdi-minus-box",delimiter:"mdi-circle",sortAsc:"mdi-arrow-up",sortDesc:"mdi-arrow-down",expand:"mdi-chevron-down",menu:"mdi-menu",subgroup:"mdi-menu-down",dropdown:"mdi-menu-down",radioOn:"mdi-radiobox-marked",radioOff:"mdi-radiobox-blank",edit:"mdi-pencil",ratingEmpty:"mdi-star-outline",ratingFull:"mdi-star",ratingHalf:"mdi-star-half-full",loading:"mdi-cached",first:"mdi-page-first",last:"mdi-page-last",unfold:"mdi-unfold-more-horizontal",file:"mdi-paperclip",plus:"mdi-plus",minus:"mdi-minus",calendar:"mdi-calendar",treeviewCollapse:"mdi-menu-down",treeviewExpand:"mdi-menu-right",eyeDropper:"mdi-eyedropper",upload:"mdi-cloud-upload"},c5={component:r=>bl(yC,{...r,class:"mdi"})},Us=[String,Function,Object,Array],c1=Symbol.for("vuetify:icons"),t0=ln({icon:{type:Us},tag:{type:String,required:!0}},"icon"),FE=si()({name:"VComponentIcon",props:t0(),setup(r,l){let{slots:p}=l;return()=>{const v=r.icon;return st(r.tag,null,{default:()=>{var A;return[r.icon?st(v,null,null):(A=p.default)==null?void 0:A.call(p)]}})}}}),gC=Vm({name:"VSvgIcon",inheritAttrs:!1,props:t0(),setup(r,l){let{attrs:p}=l;return()=>st(r.tag,ys(p,{style:null}),{default:()=>[st("svg",{class:"v-icon__svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true"},[Array.isArray(r.icon)?r.icon.map(v=>Array.isArray(v)?st("path",{d:v[0],"fill-opacity":v[1]},null):st("path",{d:v},null)):st("path",{d:r.icon},null)])]})}});Vm({name:"VLigatureIcon",props:t0(),setup(r){return()=>st(r.tag,null,{default:()=>[r.icon]})}});const yC=Vm({name:"VClassIcon",props:t0(),setup(r){return()=>st(r.tag,{class:r.icon},null)}});function u5(){return{svg:{component:gC},class:{component:yC}}}function h5(r){const l=u5(),p=(r==null?void 0:r.defaultSet)??"mdi";return p==="mdi"&&!l.mdi&&(l.mdi=c5),gs({defaultSet:p,sets:l,aliases:{...l5,vuetify:["M8.2241 14.2009L12 21L22 3H14.4459L8.2241 14.2009Z",["M7.26303 12.4733L7.00113 12L2 3H12.5261C12.5261 3 12.5261 3 12.5261 3L7.26303 12.4733Z",.6]],"vuetify-outline":"svg:M7.26 12.47 12.53 3H2L7.26 12.47ZM14.45 3 8.22 14.2 12 21 22 3H14.45ZM18.6 5 12 16.88 10.51 14.2 15.62 5ZM7.26 8.35 5.4 5H9.13L7.26 8.35Z","vuetify-play":["m6.376 13.184-4.11-7.192C1.505 4.66 2.467 3 4.003 3h8.532l-.953 1.576-.006.01-.396.677c-.429.732-.214 1.507.194 2.015.404.503 1.092.878 1.869.806a3.72 3.72 0 0 1 1.005.022c.276.053.434.143.523.237.138.146.38.635-.25 2.09-.893 1.63-1.553 1.722-1.847 1.677-.213-.033-.468-.158-.756-.406a4.95 4.95 0 0 1-.8-.927c-.39-.564-1.04-.84-1.66-.846-.625-.006-1.316.27-1.693.921l-.478.826-.911 1.506Z",["M9.093 11.552c.046-.079.144-.15.32-.148a.53.53 0 0 1 .43.207c.285.414.636.847 1.046 1.2.405.35.914.662 1.516.754 1.334.205 2.502-.698 3.48-2.495l.014-.028.013-.03c.687-1.574.774-2.852-.005-3.675-.37-.391-.861-.586-1.333-.676a5.243 5.243 0 0 0-1.447-.044c-.173.016-.393-.073-.54-.257-.145-.18-.127-.316-.082-.392l.393-.672L14.287 3h5.71c1.536 0 2.499 1.659 1.737 2.992l-7.997 13.996c-.768 1.344-2.706 1.344-3.473 0l-3.037-5.314 1.377-2.278.004-.006.004-.007.481-.831Z",.6]]}},r)}const d5=r=>{const l=Pn(c1);if(!l)throw new Error("Missing Vuetify Icons provide!");return{iconData:et(()=>{var G;const v=xt(r);if(!v)return{component:FE};let A=v;if(typeof A=="string"&&(A=A.trim(),A.startsWith("$")&&(A=(G=l.aliases)==null?void 0:G[A.slice(1)])),Array.isArray(A))return{component:gC,icon:A};if(typeof A!="string")return{component:FE,icon:A};const R=Object.keys(l.sets).find(W=>typeof A=="string"&&A.startsWith(`${W}:`)),D=R?A.slice(R.length+1):A;return{component:l.sets[R??l.defaultSet].component,icon:D}})}},f5=["x-small","small","default","large","x-large"],Hm=ln({size:{type:[String,Number],default:"default"}},"size");function qm(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pc();return sC(()=>{let p,v;return o1(f5,r.size)?p=`${l}--size-${r.size}`:r.size&&(v={width:ni(r.size),height:ni(r.size)}),{sizeClasses:p,sizeStyles:v}})}const p5=ln({color:String,disabled:Boolean,start:Boolean,end:Boolean,icon:Us,...Ei(),...Hm(),...vs({tag:"i"}),...ja()},"VIcon"),Qs=si()({name:"VIcon",props:p5(),setup(r,l){let{attrs:p,slots:v}=l;const A=dn(),{themeClasses:R}=$a(r),{iconData:D}=d5(et(()=>A.value||r.icon)),{sizeClasses:i}=qm(r),{textColorClasses:G,textColorStyles:W}=wy(Si(r,"color"));return Bi(()=>{var ne,de;const H=(ne=v.default)==null?void 0:ne.call(v);H&&(A.value=(de=iC(H).filter(he=>he.type===Ud&&he.children&&typeof he.children=="string")[0])==null?void 0:de.children);const ee=!!(p.onClick||p.onClickOnce);return st(D.value.component,{tag:r.tag,icon:D.value.icon,class:["v-icon","notranslate",R.value,i.value,G.value,{"v-icon--clickable":ee,"v-icon--disabled":r.disabled,"v-icon--start":r.start,"v-icon--end":r.end},r.class],style:[i.value?void 0:{fontSize:ni(r.size),height:ni(r.size),width:ni(r.size)},W.value,r.style],role:ee?"button":void 0,"aria-hidden":!ee,tabindex:ee?r.disabled?-1:0:void 0},{default:()=>[H]})}),{}}});function vC(r,l){const p=dn(),v=Vn(!1);if(W1){const A=new IntersectionObserver(R=>{v.value=!!R.find(D=>D.isIntersecting)},l);Ua(()=>{A.disconnect()}),Tn(p,(R,D)=>{D&&(A.unobserve(D),v.value=!1),R&&A.observe(R)},{flush:"post"})}return{intersectionRef:p,isIntersecting:v}}function Ty(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"content";const p=wF(),v=dn();if(_s){const A=new ResizeObserver(R=>{R.length&&(l==="content"?v.value=R[0].contentRect:v.value=R[0].target.getBoundingClientRect())});Ua(()=>{A.disconnect()}),Tn(()=>p.el,(R,D)=>{D&&(A.unobserve(D),v.value=void 0),R&&A.observe(R)},{flush:"post"})}return{resizeRef:p,contentRect:Vd(v)}}const m5=ln({bgColor:String,color:String,indeterminate:[Boolean,String],modelValue:{type:[Number,String],default:0},rotate:{type:[Number,String],default:0},width:{type:[Number,String],default:4},...Ei(),...Hm(),...vs({tag:"div"}),...ja()},"VProgressCircular"),_5=si()({name:"VProgressCircular",props:m5(),setup(r,l){let{slots:p}=l;const v=20,A=2*Math.PI*v,R=dn(),{themeClasses:D}=$a(r),{sizeClasses:i,sizeStyles:G}=qm(r),{textColorClasses:W,textColorStyles:H}=wy(Si(r,"color")),{textColorClasses:ee,textColorStyles:ne}=wy(Si(r,"bgColor")),{intersectionRef:de,isIntersecting:he}=vC(),{resizeRef:_e,contentRect:Ie}=Ty(),je=et(()=>Math.max(0,Math.min(100,parseFloat(r.modelValue)))),vt=et(()=>Number(r.width)),Pt=et(()=>G.value?Number(r.size):Ie.value?Ie.value.width:Math.max(vt.value,32)),ht=et(()=>v/(1-vt.value/Pt.value)*2),ft=et(()=>vt.value/Pt.value*ht.value),bt=et(()=>ni((100-je.value)/100*A));return Hu(()=>{de.value=R.value,_e.value=R.value}),Bi(()=>st(r.tag,{ref:R,class:["v-progress-circular",{"v-progress-circular--indeterminate":!!r.indeterminate,"v-progress-circular--visible":he.value,"v-progress-circular--disable-shrink":r.indeterminate==="disable-shrink"},D.value,i.value,W.value,r.class],style:[G.value,H.value,r.style],role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":r.indeterminate?void 0:je.value},{default:()=>[st("svg",{style:{transform:`rotate(calc(-90deg + ${Number(r.rotate)}deg))`},xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${ht.value} ${ht.value}`},[st("circle",{class:["v-progress-circular__underlay",ee.value],style:ne.value,fill:"transparent",cx:"50%",cy:"50%",r:v,"stroke-width":ft.value,"stroke-dasharray":A,"stroke-dashoffset":0},null),st("circle",{class:"v-progress-circular__overlay",fill:"transparent",cx:"50%",cy:"50%",r:v,"stroke-width":ft.value,"stroke-dasharray":A,"stroke-dashoffset":bt.value},null)]),p.default&&st("div",{class:"v-progress-circular__content"},[p.default({value:je.value})])]})),{}}}),Zd=ln({height:[Number,String],maxHeight:[Number,String],maxWidth:[Number,String],minHeight:[Number,String],minWidth:[Number,String],width:[Number,String]},"dimension");function Xd(r){return{dimensionStyles:et(()=>{const p={},v=ni(r.height),A=ni(r.maxHeight),R=ni(r.maxWidth),D=ni(r.minHeight),i=ni(r.minWidth),G=ni(r.width);return v!=null&&(p.height=v),A!=null&&(p.maxHeight=A),R!=null&&(p.maxWidth=R),D!=null&&(p.minHeight=D),i!=null&&(p.minWidth=i),G!=null&&(p.width=G),p})}}const g5={badge:"Badge",open:"Open",close:"Close",dismiss:"Dismiss",confirmEdit:{ok:"OK",cancel:"Cancel"},dataIterator:{noResultsText:"No matching records found",loadingText:"Loading items..."},dataTable:{itemsPerPageText:"Rows per page:",ariaLabel:{sortDescending:"Sorted descending.",sortAscending:"Sorted ascending.",sortNone:"Not sorted.",activateNone:"Activate to remove sorting.",activateDescending:"Activate to sort descending.",activateAscending:"Activate to sort ascending."},sortBy:"Sort by"},dataFooter:{itemsPerPageText:"Items per page:",itemsPerPageAll:"All",nextPage:"Next page",prevPage:"Previous page",firstPage:"First page",lastPage:"Last page",pageText:"{0}-{1} of {2}"},dateRangeInput:{divider:"to"},datePicker:{itemsSelected:"{0} selected",range:{title:"Select dates",header:"Enter dates"},title:"Select date",header:"Enter date",input:{placeholder:"Enter date"}},noDataText:"No data available",carousel:{prev:"Previous visual",next:"Next visual",ariaLabel:{delimiter:"Carousel slide {0} of {1}"}},calendar:{moreEvents:"{0} more",today:"Today"},input:{clear:"Clear {0}",prependAction:"{0} prepended action",appendAction:"{0} appended action",otp:"Please enter OTP character {0}"},fileInput:{counter:"{0} files",counterSize:"{0} files ({1} in total)"},fileUpload:{title:"Drag and drop files here",divider:"or",browse:"Browse Files"},timePicker:{am:"AM",pm:"PM",title:"Select Time"},pagination:{ariaLabel:{root:"Pagination Navigation",next:"Next page",previous:"Previous page",page:"Go to page {0}",currentPage:"Page {0}, Current page",first:"First page",last:"Last page"}},stepper:{next:"Next",prev:"Previous"},rating:{ariaLabel:{item:"Rating {0} of {1}"}},loading:"Loading...",infiniteScroll:{loadMore:"Load more",empty:"No more"}},BE="$vuetify.",NE=(r,l)=>r.replace(/\{(\d+)\}/g,(p,v)=>String(l[Number(v)])),xC=(r,l,p)=>function(v){for(var A=arguments.length,R=new Array(A>1?A-1:0),D=1;D<A;D++)R[D-1]=arguments[D];if(!v.startsWith(BE))return NE(v,R);const i=v.replace(BE,""),G=r.value&&p.value[r.value],W=l.value&&p.value[l.value];let H=vE(G,i,null);return H||(`${v}${r.value}`,H=vE(W,i,null)),H||(H=v),typeof H!="string"&&(H=v),NE(H,R)};function bC(r,l){return(p,v)=>new Intl.NumberFormat([r.value,l.value],v).format(p)}function Px(r,l,p){const v=Gm(r,l,r[l]??p.value);return v.value=r[l]??p.value,Tn(p,A=>{r[l]==null&&(v.value=p.value)}),v}function wC(r){return l=>{const p=Px(l,"locale",r.current),v=Px(l,"fallback",r.fallback),A=Px(l,"messages",r.messages);return{name:"vuetify",current:p,fallback:v,messages:A,t:xC(p,v,A),n:bC(p,v),provide:wC({current:p,fallback:v,messages:A})}}}function y5(r){const l=Vn((r==null?void 0:r.locale)??"en"),p=Vn((r==null?void 0:r.fallback)??"en"),v=dn({en:g5,...r==null?void 0:r.messages});return{name:"vuetify",current:l,fallback:p,messages:v,t:xC(l,p,v),n:bC(l,p),provide:wC({current:l,fallback:p,messages:v})}}const Sy=Symbol.for("vuetify:locale");function v5(r){return r.name!=null}function x5(r){const l=r!=null&&r.adapter&&v5(r==null?void 0:r.adapter)?r==null?void 0:r.adapter:y5(r),p=T5(l,r);return{...l,...p}}function b5(){const r=Pn(Sy);if(!r)throw new Error("[Vuetify] Could not find injected locale instance");return r}function w5(){return{af:!1,ar:!0,bg:!1,ca:!1,ckb:!1,cs:!1,de:!1,el:!1,en:!1,es:!1,et:!1,fa:!0,fi:!1,fr:!1,hr:!1,hu:!1,he:!0,id:!1,it:!1,ja:!1,km:!1,ko:!1,lv:!1,lt:!1,nl:!1,no:!1,pl:!1,pt:!1,ro:!1,ru:!1,sk:!1,sl:!1,srCyrl:!1,srLatn:!1,sv:!1,th:!1,tr:!1,az:!1,uk:!1,vi:!1,zhHans:!1,zhHant:!1}}function T5(r,l){const p=dn((l==null?void 0:l.rtl)??w5()),v=et(()=>p.value[r.current.value]??!1);return{isRtl:v,rtl:p,rtlClasses:et(()=>`v-locale--is-${v.value?"rtl":"ltr"}`)}}function Kd(){const r=Pn(Sy);if(!r)throw new Error("[Vuetify] Could not find injected rtl instance");return{isRtl:r.isRtl,rtlClasses:r.rtlClasses}}const VE={center:"center",top:"bottom",bottom:"top",left:"right",right:"left"},Q1=ln({location:String},"location");function eb(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,p=arguments.length>2?arguments[2]:void 0;const{isRtl:v}=Kd();return{locationStyles:et(()=>{if(!r.location)return{};const{side:R,align:D}=EF(r.location.split(" ").length>1?r.location:`${r.location} center`,v.value);function i(W){return p?p(W):0}const G={};return R!=="center"&&(l?G[VE[R]]=`calc(100% - ${i(R)}px)`:G[R]=0),D!=="center"?l?G[VE[D]]=`calc(100% - ${i(D)}px)`:G[D]=0:(R==="center"?G.top=G.left="50%":G[{top:"left",bottom:"left",left:"top",right:"top"}[R]]="50%",G.transform={top:"translateX(-50%)",bottom:"translateX(-50%)",left:"translateY(-50%)",right:"translateY(-50%)",center:"translate(-50%, -50%)"}[R]),G})}}const S5=ln({absolute:Boolean,active:{type:Boolean,default:!0},bgColor:String,bgOpacity:[Number,String],bufferValue:{type:[Number,String],default:0},bufferColor:String,bufferOpacity:[Number,String],clickable:Boolean,color:String,height:{type:[Number,String],default:4},indeterminate:Boolean,max:{type:[Number,String],default:100},modelValue:{type:[Number,String],default:0},opacity:[Number,String],reverse:Boolean,stream:Boolean,striped:Boolean,roundedBar:Boolean,...Ei(),...Q1({location:"top"}),...Rc(),...vs(),...ja()},"VProgressLinear"),E5=si()({name:"VProgressLinear",props:S5(),emits:{"update:modelValue":r=>!0},setup(r,l){var dt;let{slots:p}=l;const v=Gm(r,"modelValue"),{isRtl:A,rtlClasses:R}=Kd(),{themeClasses:D}=$a(r),{locationStyles:i}=eb(r),{textColorClasses:G,textColorStyles:W}=wy(r,"color"),{backgroundColorClasses:H,backgroundColorStyles:ee}=Cd(et(()=>r.bgColor||r.color)),{backgroundColorClasses:ne,backgroundColorStyles:de}=Cd(et(()=>r.bufferColor||r.bgColor||r.color)),{backgroundColorClasses:he,backgroundColorStyles:_e}=Cd(r,"color"),{roundedClasses:Ie}=Dc(r),{intersectionRef:je,isIntersecting:vt}=vC(),Pt=et(()=>parseFloat(r.max)),ht=et(()=>parseFloat(r.height)),ft=et(()=>vy(parseFloat(r.bufferValue)/Pt.value*100,0,100)),bt=et(()=>vy(parseFloat(v.value)/Pt.value*100,0,100)),Je=et(()=>A.value!==r.reverse),Et=et(()=>r.indeterminate?"fade-transition":"slide-x-transition"),pt=_s&&((dt=window.matchMedia)==null?void 0:dt.call(window,"(forced-colors: active)").matches);function lt(mt){if(!je.value)return;const{left:nr,right:Cr,width:Zt}=je.value.getBoundingClientRect(),Tr=Je.value?Zt-mt.clientX+(Cr-Zt):mt.clientX-nr;v.value=Math.round(Tr/Zt*Pt.value)}return Bi(()=>st(r.tag,{ref:je,class:["v-progress-linear",{"v-progress-linear--absolute":r.absolute,"v-progress-linear--active":r.active&&vt.value,"v-progress-linear--reverse":Je.value,"v-progress-linear--rounded":r.rounded,"v-progress-linear--rounded-bar":r.roundedBar,"v-progress-linear--striped":r.striped},Ie.value,D.value,R.value,r.class],style:[{bottom:r.location==="bottom"?0:void 0,top:r.location==="top"?0:void 0,height:r.active?ni(ht.value):0,"--v-progress-linear-height":ni(ht.value),...r.absolute?i.value:{}},r.style],role:"progressbar","aria-hidden":r.active?"false":"true","aria-valuemin":"0","aria-valuemax":r.max,"aria-valuenow":r.indeterminate?void 0:Math.min(parseFloat(v.value),Pt.value),onClick:r.clickable&&lt},{default:()=>[r.stream&&st("div",{key:"stream",class:["v-progress-linear__stream",G.value],style:{...W.value,[Je.value?"left":"right"]:ni(-ht.value),borderTop:`${ni(ht.value/2)} dotted`,opacity:parseFloat(r.bufferOpacity),top:`calc(50% - ${ni(ht.value/4)})`,width:ni(100-ft.value,"%"),"--v-progress-linear-stream-to":ni(ht.value*(Je.value?1:-1))}},null),st("div",{class:["v-progress-linear__background",pt?void 0:H.value],style:[ee.value,{opacity:parseFloat(r.bgOpacity),width:r.stream?0:void 0}]},null),st("div",{class:["v-progress-linear__buffer",pt?void 0:ne.value],style:[de.value,{opacity:parseFloat(r.bufferOpacity),width:ni(ft.value,"%")}]},null),st(Om,{name:Et.value},{default:()=>[r.indeterminate?st("div",{class:"v-progress-linear__indeterminate"},[["long","short"].map(mt=>st("div",{key:mt,class:["v-progress-linear__indeterminate",mt,pt?void 0:he.value],style:_e.value},null))]):st("div",{class:["v-progress-linear__determinate",pt?void 0:he.value],style:[_e.value,{width:ni(bt.value,"%")}]},null)]}),p.default&&st("div",{class:"v-progress-linear__content"},[p.default({value:bt.value,buffer:ft.value})])]})),{}}}),TC=ln({loading:[Boolean,String]},"loader");function SC(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pc();return{loaderClasses:et(()=>({[`${l}--loading`]:r.loading}))}}function A5(r,l){var v;let{slots:p}=l;return st("div",{class:`${r.name}__loader`},[((v=p.default)==null?void 0:v.call(p,{color:r.color,isActive:r.active}))||st(E5,{absolute:r.absolute,active:r.active,color:r.color,height:"2",indeterminate:!0},null)])}const M5=["static","relative","fixed","absolute","sticky"],EC=ln({position:{type:String,validator:r=>M5.includes(r)}},"position");function AC(r){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pc();return{positionClasses:et(()=>r.position?`${l}--${r.position}`:void 0)}}function I5(){const r=Gs("useRoute");return et(()=>{var l;return(l=r==null?void 0:r.proxy)==null?void 0:l.$route})}function C5(){var r,l;return(l=(r=Gs("useRouter"))==null?void 0:r.proxy)==null?void 0:l.$router}function tb(r,l){var ee,ne;const p=mo("RouterLink"),v=et(()=>!!(r.href||r.to)),A=et(()=>(v==null?void 0:v.value)||EE(l,"click")||EE(r,"click"));if(typeof p=="string"||!("useLink"in p)){const de=Si(r,"href");return{isLink:v,isClickable:A,href:de,linkProps:Ki({href:de})}}const R=et(()=>({...r,to:Si(()=>r.to||"")})),D=p.useLink(R.value),i=et(()=>r.to?D:void 0),G=I5(),W=et(()=>{var de,he,_e;return i.value?r.exact?G.value?((_e=i.value.isExactActive)==null?void 0:_e.value)&&Yy(i.value.route.value.query,G.value.query):((he=i.value.isExactActive)==null?void 0:he.value)??!1:((de=i.value.isActive)==null?void 0:de.value)??!1:!1}),H=et(()=>{var de;return r.to?(de=i.value)==null?void 0:de.route.value.href:r.href});return{isLink:v,isClickable:A,isActive:W,route:(ee=i.value)==null?void 0:ee.route,navigate:(ne=i.value)==null?void 0:ne.navigate,href:H,linkProps:Ki({href:H,"aria-current":et(()=>W.value?"page":void 0)})}}const rb=ln({href:String,replace:Boolean,to:[String,Object],exact:Boolean},"router");function P5(r,l){Tn(()=>{var p;return(p=r.isActive)==null?void 0:p.value},p=>{r.isLink.value&&p&&l&&Bs(()=>{l(!0)})},{immediate:!0})}const u1=Symbol("rippleStop"),R5=80;function UE(r,l){r.style.transform=l,r.style.webkitTransform=l}function h1(r){return r.constructor.name==="TouchEvent"}function MC(r){return r.constructor.name==="KeyboardEvent"}const D5=function(r,l){var ee;let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=0,A=0;if(!MC(r)){const ne=l.getBoundingClientRect(),de=h1(r)?r.touches[r.touches.length-1]:r;v=de.clientX-ne.left,A=de.clientY-ne.top}let R=0,D=.3;(ee=l._ripple)!=null&&ee.circle?(D=.15,R=l.clientWidth/2,R=p.center?R:R+Math.sqrt((v-R)**2+(A-R)**2)/4):R=Math.sqrt(l.clientWidth**2+l.clientHeight**2)/2;const i=`${(l.clientWidth-R*2)/2}px`,G=`${(l.clientHeight-R*2)/2}px`,W=p.center?i:`${v-R}px`,H=p.center?G:`${A-R}px`;return{radius:R,scale:D,x:W,y:H,centerX:i,centerY:G}},Ey={show(r,l){var de;let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!((de=l==null?void 0:l._ripple)!=null&&de.enabled))return;const v=document.createElement("span"),A=document.createElement("span");v.appendChild(A),v.className="v-ripple__container",p.class&&(v.className+=` ${p.class}`);const{radius:R,scale:D,x:i,y:G,centerX:W,centerY:H}=D5(r,l,p),ee=`${R*2}px`;A.className="v-ripple__animation",A.style.width=ee,A.style.height=ee,l.appendChild(v);const ne=window.getComputedStyle(l);ne&&ne.position==="static"&&(l.style.position="relative",l.dataset.previousPosition="static"),A.classList.add("v-ripple__animation--enter"),A.classList.add("v-ripple__animation--visible"),UE(A,`translate(${i}, ${G}) scale3d(${D},${D},${D})`),A.dataset.activated=String(performance.now()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{A.classList.remove("v-ripple__animation--enter"),A.classList.add("v-ripple__animation--in"),UE(A,`translate(${W}, ${H}) scale3d(1,1,1)`)})})},hide(r){var R;if(!((R=r==null?void 0:r._ripple)!=null&&R.enabled))return;const l=r.getElementsByClassName("v-ripple__animation");if(l.length===0)return;const p=l[l.length-1];if(p.dataset.isHiding)return;p.dataset.isHiding="true";const v=performance.now()-Number(p.dataset.activated),A=Math.max(250-v,0);setTimeout(()=>{p.classList.remove("v-ripple__animation--in"),p.classList.add("v-ripple__animation--out"),setTimeout(()=>{var i;r.getElementsByClassName("v-ripple__animation").length===1&&r.dataset.previousPosition&&(r.style.position=r.dataset.previousPosition,delete r.dataset.previousPosition),((i=p.parentNode)==null?void 0:i.parentNode)===r&&r.removeChild(p.parentNode)},300)},A)}};function IC(r){return typeof r>"u"||!!r}function Em(r){const l={},p=r.currentTarget;if(!(!(p!=null&&p._ripple)||p._ripple.touched||r[u1])){if(r[u1]=!0,h1(r))p._ripple.touched=!0,p._ripple.isTouch=!0;else if(p._ripple.isTouch)return;if(l.center=p._ripple.centered||MC(r),p._ripple.class&&(l.class=p._ripple.class),h1(r)){if(p._ripple.showTimerCommit)return;p._ripple.showTimerCommit=()=>{Ey.show(r,p,l)},p._ripple.showTimer=window.setTimeout(()=>{var v;(v=p==null?void 0:p._ripple)!=null&&v.showTimerCommit&&(p._ripple.showTimerCommit(),p._ripple.showTimerCommit=null)},R5)}else Ey.show(r,p,l)}}function jE(r){r[u1]=!0}function _o(r){const l=r.currentTarget;if(l!=null&&l._ripple){if(window.clearTimeout(l._ripple.showTimer),r.type==="touchend"&&l._ripple.showTimerCommit){l._ripple.showTimerCommit(),l._ripple.showTimerCommit=null,l._ripple.showTimer=window.setTimeout(()=>{_o(r)});return}window.setTimeout(()=>{l._ripple&&(l._ripple.touched=!1)}),Ey.hide(l)}}function CC(r){const l=r.currentTarget;l!=null&&l._ripple&&(l._ripple.showTimerCommit&&(l._ripple.showTimerCommit=null),window.clearTimeout(l._ripple.showTimer))}let Am=!1;function PC(r){!Am&&(r.keyCode===bE.enter||r.keyCode===bE.space)&&(Am=!0,Em(r))}function RC(r){Am=!1,_o(r)}function DC(r){Am&&(Am=!1,_o(r))}function zC(r,l,p){const{value:v,modifiers:A}=l,R=IC(v);if(R||Ey.hide(r),r._ripple=r._ripple??{},r._ripple.enabled=R,r._ripple.centered=A.center,r._ripple.circle=A.circle,mF(v)&&v.class&&(r._ripple.class=v.class),R&&!p){if(A.stop){r.addEventListener("touchstart",jE,{passive:!0}),r.addEventListener("mousedown",jE);return}r.addEventListener("touchstart",Em,{passive:!0}),r.addEventListener("touchend",_o,{passive:!0}),r.addEventListener("touchmove",CC,{passive:!0}),r.addEventListener("touchcancel",_o),r.addEventListener("mousedown",Em),r.addEventListener("mouseup",_o),r.addEventListener("mouseleave",_o),r.addEventListener("keydown",PC),r.addEventListener("keyup",RC),r.addEventListener("blur",DC),r.addEventListener("dragstart",_o,{passive:!0})}else!R&&p&&LC(r)}function LC(r){r.removeEventListener("mousedown",Em),r.removeEventListener("touchstart",Em),r.removeEventListener("touchend",_o),r.removeEventListener("touchmove",CC),r.removeEventListener("touchcancel",_o),r.removeEventListener("mouseup",_o),r.removeEventListener("mouseleave",_o),r.removeEventListener("keydown",PC),r.removeEventListener("keyup",RC),r.removeEventListener("dragstart",_o),r.removeEventListener("blur",DC)}function z5(r,l){zC(r,l,!1)}function L5(r){delete r._ripple,LC(r)}function O5(r,l){if(l.value===l.oldValue)return;const p=IC(l.oldValue);zC(r,l,p)}const nb={mounted:z5,unmounted:L5,updated:O5},k5=ln({active:{type:Boolean,default:void 0},activeColor:String,baseColor:String,symbol:{type:null,default:_C},flat:Boolean,icon:[Boolean,String,Function,Object],prependIcon:Us,appendIcon:Us,block:Boolean,readonly:Boolean,slim:Boolean,stacked:Boolean,ripple:{type:[Boolean,Object],default:!0},text:{type:[String,Number,Boolean],default:void 0},...Gd(),...Ei(),...qd(),...Zd(),...jm(),...fC(),...TC(),...Q1(),...EC(),...Rc(),...rb(),...Hm(),...vs({tag:"button"}),...ja(),...Wd({variant:"elevated"})},"VBtn"),iy=si()({name:"VBtn",props:k5(),emits:{"group:selected":r=>!0},setup(r,l){let{attrs:p,slots:v}=l;const{themeClasses:A}=$a(r),{borderClasses:R}=Hd(r),{densityClasses:D}=Um(r),{dimensionStyles:i}=Xd(r),{elevationClasses:G}=$m(r),{loaderClasses:W}=SC(r),{locationStyles:H}=eb(r),{positionClasses:ee}=AC(r),{roundedClasses:ne}=Dc(r),{sizeClasses:de,sizeStyles:he}=qm(r),_e=pC(r,r.symbol,!1),Ie=tb(r,p),je=et(()=>{var dt;return r.active!==void 0?r.active:Ie.isLink.value?(dt=Ie.isActive)==null?void 0:dt.value:_e==null?void 0:_e.isSelected.value}),vt=et(()=>je.value?r.activeColor??r.color:r.color),Pt=et(()=>{var mt,nr;return{color:(_e==null?void 0:_e.isSelected.value)&&(!Ie.isLink.value||((mt=Ie.isActive)==null?void 0:mt.value))||!_e||((nr=Ie.isActive)==null?void 0:nr.value)?vt.value??r.baseColor:r.baseColor,variant:r.variant}}),{colorClasses:ht,colorStyles:ft,variantClasses:bt}=e0(Pt),Je=et(()=>(_e==null?void 0:_e.disabled.value)||r.disabled),Et=et(()=>r.variant==="elevated"&&!(r.disabled||r.flat||r.border)),pt=et(()=>{if(!(r.value===void 0||typeof r.value=="symbol"))return Object(r.value)===r.value?JSON.stringify(r.value,null,0):r.value});function lt(dt){var mt;Je.value||Ie.isLink.value&&(dt.metaKey||dt.ctrlKey||dt.shiftKey||dt.button!==0||p.target==="_blank")||((mt=Ie.navigate)==null||mt.call(Ie,dt),_e==null||_e.toggle())}return P5(Ie,_e==null?void 0:_e.select),Bi(()=>{const dt=Ie.isLink.value?"a":r.tag,mt=!!(r.prependIcon||v.prepend),nr=!!(r.appendIcon||v.append),Cr=!!(r.icon&&r.icon!==!0);return Dd(st(dt,ys({type:dt==="a"?void 0:"button",class:["v-btn",_e==null?void 0:_e.selectedClass.value,{"v-btn--active":je.value,"v-btn--block":r.block,"v-btn--disabled":Je.value,"v-btn--elevated":Et.value,"v-btn--flat":r.flat,"v-btn--icon":!!r.icon,"v-btn--loading":r.loading,"v-btn--readonly":r.readonly,"v-btn--slim":r.slim,"v-btn--stacked":r.stacked},A.value,R.value,ht.value,D.value,G.value,W.value,ee.value,ne.value,de.value,bt.value,r.class],style:[ft.value,i.value,H.value,he.value,r.style],"aria-busy":r.loading?!0:void 0,disabled:Je.value||void 0,tabindex:r.loading||r.readonly?-1:void 0,onClick:lt,value:pt.value},Ie.linkProps),{default:()=>{var Zt;return[Qy(!0,"v-btn"),!r.icon&&mt&&st("span",{key:"prepend",class:"v-btn__prepend"},[v.prepend?st(Bo,{key:"prepend-defaults",disabled:!r.prependIcon,defaults:{VIcon:{icon:r.prependIcon}}},v.prepend):st(Qs,{key:"prepend-icon",icon:r.prependIcon},null)]),st("span",{class:"v-btn__content","data-no-activator":""},[!v.default&&Cr?st(Qs,{key:"content-icon",icon:r.icon},null):st(Bo,{key:"content-defaults",disabled:!Cr,defaults:{VIcon:{icon:r.icon}}},{default:()=>{var Tr;return[((Tr=v.default)==null?void 0:Tr.call(v))??Vs(r.text)]}})]),!r.icon&&nr&&st("span",{key:"append",class:"v-btn__append"},[v.append?st(Bo,{key:"append-defaults",disabled:!r.appendIcon,defaults:{VIcon:{icon:r.appendIcon}}},v.append):st(Qs,{key:"append-icon",icon:r.appendIcon},null)]),!!r.loading&&st("span",{key:"loader",class:"v-btn__loader"},[((Zt=v.loader)==null?void 0:Zt.call(v))??st(_5,{color:typeof r.loading=="boolean"?void 0:r.loading,indeterminate:!0,width:"2"},null)])]}}),[[nb,!Je.value&&r.ripple,"",{center:!!r.icon}]])}),{group:_e}}}),F5={class:"bottom"},B5={key:0,class:"marker-button"},N5={name:"MobileBottom"},V5=pn({...N5,setup(r){const l=II();return eC(),(p,v)=>(Kt(),Nr("div",F5,[!xt(l).drawer&&!xt(l).movileDrawer?(Kt(),Nr("div",B5,[st(iy,{"prepend-icon":"mdi-filter-menu",color:"#FFF176",onClick:v[0]||(v[0]=A=>xt(l).drawer=!xt(l).drawer)},{default:An(()=>v[1]||(v[1]=[Ru("  ")])),_:1})])):In("",!0)]))}}),U5=km(V5,[["__scopeId","data-v-9bd75689"]]),j5={name:"MobileHeader"},$5={class:"header"},G5={class:"map"};function H5(r,l,p,v,A,R){return Kt(),Nr("div",$5,[st(iy,{variant:"text",icon:"mdi-chevron-left"}),Wr("div",G5,[st(iy,{variant:"text","append-icon":"mdi-swap-horizontal"},{default:An(()=>l[0]||(l[0]=[Ru("")])),_:1})]),st(iy,{variant:"text",icon:"mdi-share"})])}const q5=km(j5,[["render",H5],["__scopeId","data-v-f737dab3"]]),OC=Symbol(),sy="el",W5="is-",Iu=(r,l,p,v,A)=>{let R=`${r}-${l}`;return p&&(R+=`-${p}`),v&&(R+=`__${v}`),A&&(R+=`--${A}`),R},kC=Symbol("namespaceContextKey"),FC=r=>{const l=r||($s()?Pn(kC,dn(sy)):dn(sy));return et(()=>xt(l)||sy)},Tc=(r,l)=>{const p=FC(l);return{namespace:p,b:(_e="")=>Iu(p.value,r,_e,"",""),e:_e=>_e?Iu(p.value,r,"",_e,""):"",m:_e=>_e?Iu(p.value,r,"","",_e):"",be:(_e,Ie)=>_e&&Ie?Iu(p.value,r,_e,Ie,""):"",em:(_e,Ie)=>_e&&Ie?Iu(p.value,r,"",_e,Ie):"",bm:(_e,Ie)=>_e&&Ie?Iu(p.value,r,_e,"",Ie):"",bem:(_e,Ie,je)=>_e&&Ie&&je?Iu(p.value,r,_e,Ie,je):"",is:(_e,...Ie)=>{const je=Ie.length>=1?Ie[0]:!0;return _e&&je?`${W5}${_e}`:""},cssVar:_e=>{const Ie={};for(const je in _e)_e[je]&&(Ie[`--${p.value}-${je}`]=_e[je]);return Ie},cssVarName:_e=>`--${p.value}-${_e}`,cssVarBlock:_e=>{const Ie={};for(const je in _e)_e[je]&&(Ie[`--${p.value}-${r}-${je}`]=_e[je]);return Ie},cssVarBlockName:_e=>`--${p.value}-${r}-${_e}`}};var Z5=typeof global=="object"&&global&&global.Object===Object&&global,X5=typeof self=="object"&&self&&self.Object===Object&&self,ib=Z5||X5||Function("return this")(),Sc=ib.Symbol,BC=Object.prototype,K5=BC.hasOwnProperty,Y5=BC.toString,rm=Sc?Sc.toStringTag:void 0;function J5(r){var l=K5.call(r,rm),p=r[rm];try{r[rm]=void 0;var v=!0}catch{}var A=Y5.call(r);return v&&(l?r[rm]=p:delete r[rm]),A}var Q5=Object.prototype,eB=Q5.toString;function tB(r){return eB.call(r)}var rB="[object Null]",nB="[object Undefined]",$E=Sc?Sc.toStringTag:void 0;function sb(r){return r==null?r===void 0?nB:rB:$E&&$E in Object(r)?J5(r):tB(r)}function ob(r){return r!=null&&typeof r=="object"}var iB="[object Symbol]";function ab(r){return typeof r=="symbol"||ob(r)&&sb(r)==iB}function sB(r,l){for(var p=-1,v=r==null?0:r.length,A=Array(v);++p<v;)A[p]=l(r[p],p,r);return A}var Wm=Array.isArray,GE=Sc?Sc.prototype:void 0,HE=GE?GE.toString:void 0;function NC(r){if(typeof r=="string")return r;if(Wm(r))return sB(r,NC)+"";if(ab(r))return HE?HE.call(r):"";var l=r+"";return l=="0"&&1/r==-1/0?"-0":l}function Ay(r){var l=typeof r;return r!=null&&(l=="object"||l=="function")}function oB(r){return r}var aB="[object AsyncFunction]",lB="[object Function]",cB="[object GeneratorFunction]",uB="[object Proxy]";function hB(r){if(!Ay(r))return!1;var l=sb(r);return l==lB||l==cB||l==aB||l==uB}var Rx=ib["__core-js_shared__"],qE=function(){var r=/[^.]+$/.exec(Rx&&Rx.keys&&Rx.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function dB(r){return!!qE&&qE in r}var fB=Function.prototype,pB=fB.toString;function mB(r){if(r!=null){try{return pB.call(r)}catch{}try{return r+""}catch{}}return""}var _B=/[\\^$.*+?()[\]{}|]/g,gB=/^\[object .+?Constructor\]$/,yB=Function.prototype,vB=Object.prototype,xB=yB.toString,bB=vB.hasOwnProperty,wB=RegExp("^"+xB.call(bB).replace(_B,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function TB(r){if(!Ay(r)||dB(r))return!1;var l=hB(r)?wB:gB;return l.test(mB(r))}function SB(r,l){return r==null?void 0:r[l]}function lb(r,l){var p=SB(r,l);return TB(p)?p:void 0}function EB(r,l,p){switch(p.length){case 0:return r.call(l);case 1:return r.call(l,p[0]);case 2:return r.call(l,p[0],p[1]);case 3:return r.call(l,p[0],p[1],p[2])}return r.apply(l,p)}var AB=800,MB=16,IB=Date.now;function CB(r){var l=0,p=0;return function(){var v=IB(),A=MB-(v-p);if(p=v,A>0){if(++l>=AB)return arguments[0]}else l=0;return r.apply(void 0,arguments)}}function PB(r){return function(){return r}}var My=function(){try{var r=lb(Object,"defineProperty");return r({},"",{}),r}catch{}}(),RB=My?function(r,l){return My(r,"toString",{configurable:!0,enumerable:!1,value:PB(l),writable:!0})}:oB,DB=CB(RB),zB=9007199254740991,LB=/^(?:0|[1-9]\d*)$/;function VC(r,l){var p=typeof r;return l=l??zB,!!l&&(p=="number"||p!="symbol"&&LB.test(r))&&r>-1&&r%1==0&&r<l}function OB(r,l,p){l=="__proto__"&&My?My(r,l,{configurable:!0,enumerable:!0,value:p,writable:!0}):r[l]=p}function UC(r,l){return r===l||r!==r&&l!==l}var kB=Object.prototype,FB=kB.hasOwnProperty;function BB(r,l,p){var v=r[l];(!(FB.call(r,l)&&UC(v,p))||p===void 0&&!(l in r))&&OB(r,l,p)}var WE=Math.max;function NB(r,l,p){return l=WE(l===void 0?r.length-1:l,0),function(){for(var v=arguments,A=-1,R=WE(v.length-l,0),D=Array(R);++A<R;)D[A]=v[l+A];A=-1;for(var i=Array(l+1);++A<l;)i[A]=v[A];return i[l]=p(D),EB(r,this,i)}}var VB=9007199254740991;function UB(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=VB}var jB="[object Arguments]";function ZE(r){return ob(r)&&sb(r)==jB}var jC=Object.prototype,$B=jC.hasOwnProperty,GB=jC.propertyIsEnumerable,$C=ZE(function(){return arguments}())?ZE:function(r){return ob(r)&&$B.call(r,"callee")&&!GB.call(r,"callee")},HB=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qB=/^\w*$/;function WB(r,l){if(Wm(r))return!1;var p=typeof r;return p=="number"||p=="symbol"||p=="boolean"||r==null||ab(r)?!0:qB.test(r)||!HB.test(r)||l!=null&&r in Object(l)}var Mm=lb(Object,"create");function ZB(){this.__data__=Mm?Mm(null):{},this.size=0}function XB(r){var l=this.has(r)&&delete this.__data__[r];return this.size-=l?1:0,l}var KB="__lodash_hash_undefined__",YB=Object.prototype,JB=YB.hasOwnProperty;function QB(r){var l=this.__data__;if(Mm){var p=l[r];return p===KB?void 0:p}return JB.call(l,r)?l[r]:void 0}var e6=Object.prototype,t6=e6.hasOwnProperty;function r6(r){var l=this.__data__;return Mm?l[r]!==void 0:t6.call(l,r)}var n6="__lodash_hash_undefined__";function i6(r,l){var p=this.__data__;return this.size+=this.has(r)?0:1,p[r]=Mm&&l===void 0?n6:l,this}function Gu(r){var l=-1,p=r==null?0:r.length;for(this.clear();++l<p;){var v=r[l];this.set(v[0],v[1])}}Gu.prototype.clear=ZB;Gu.prototype.delete=XB;Gu.prototype.get=QB;Gu.prototype.has=r6;Gu.prototype.set=i6;function s6(){this.__data__=[],this.size=0}function r0(r,l){for(var p=r.length;p--;)if(UC(r[p][0],l))return p;return-1}var o6=Array.prototype,a6=o6.splice;function l6(r){var l=this.__data__,p=r0(l,r);if(p<0)return!1;var v=l.length-1;return p==v?l.pop():a6.call(l,p,1),--this.size,!0}function c6(r){var l=this.__data__,p=r0(l,r);return p<0?void 0:l[p][1]}function u6(r){return r0(this.__data__,r)>-1}function h6(r,l){var p=this.__data__,v=r0(p,r);return v<0?(++this.size,p.push([r,l])):p[v][1]=l,this}function Yd(r){var l=-1,p=r==null?0:r.length;for(this.clear();++l<p;){var v=r[l];this.set(v[0],v[1])}}Yd.prototype.clear=s6;Yd.prototype.delete=l6;Yd.prototype.get=c6;Yd.prototype.has=u6;Yd.prototype.set=h6;var d6=lb(ib,"Map");function f6(){this.size=0,this.__data__={hash:new Gu,map:new(d6||Yd),string:new Gu}}function p6(r){var l=typeof r;return l=="string"||l=="number"||l=="symbol"||l=="boolean"?r!=="__proto__":r===null}function n0(r,l){var p=r.__data__;return p6(l)?p[typeof l=="string"?"string":"hash"]:p.map}function m6(r){var l=n0(this,r).delete(r);return this.size-=l?1:0,l}function _6(r){return n0(this,r).get(r)}function g6(r){return n0(this,r).has(r)}function y6(r,l){var p=n0(this,r),v=p.size;return p.set(r,l),this.size+=p.size==v?0:1,this}function qu(r){var l=-1,p=r==null?0:r.length;for(this.clear();++l<p;){var v=r[l];this.set(v[0],v[1])}}qu.prototype.clear=f6;qu.prototype.delete=m6;qu.prototype.get=_6;qu.prototype.has=g6;qu.prototype.set=y6;var v6="Expected a function";function cb(r,l){if(typeof r!="function"||l!=null&&typeof l!="function")throw new TypeError(v6);var p=function(){var v=arguments,A=l?l.apply(this,v):v[0],R=p.cache;if(R.has(A))return R.get(A);var D=r.apply(this,v);return p.cache=R.set(A,D)||R,D};return p.cache=new(cb.Cache||qu),p}cb.Cache=qu;var x6=500;function b6(r){var l=cb(r,function(v){return p.size===x6&&p.clear(),v}),p=l.cache;return l}var w6=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,T6=/\\(\\)?/g,S6=b6(function(r){var l=[];return r.charCodeAt(0)===46&&l.push(""),r.replace(w6,function(p,v,A,R){l.push(A?R.replace(T6,"$1"):v||p)}),l});function E6(r){return r==null?"":NC(r)}function i0(r,l){return Wm(r)?r:WB(r,l)?[r]:S6(E6(r))}function ub(r){if(typeof r=="string"||ab(r))return r;var l=r+"";return l=="0"&&1/r==-1/0?"-0":l}function GC(r,l){l=i0(l,r);for(var p=0,v=l.length;r!=null&&p<v;)r=r[ub(l[p++])];return p&&p==v?r:void 0}function HC(r,l,p){var v=r==null?void 0:GC(r,l);return v===void 0?p:v}function A6(r,l){for(var p=-1,v=l.length,A=r.length;++p<v;)r[A+p]=l[p];return r}var XE=Sc?Sc.isConcatSpreadable:void 0;function M6(r){return Wm(r)||$C(r)||!!(XE&&r&&r[XE])}function qC(r,l,p,v,A){var R=-1,D=r.length;for(p||(p=M6),A||(A=[]);++R<D;){var i=r[R];l>0&&p(i)?l>1?qC(i,l-1,p,v,A):A6(A,i):A[A.length]=i}return A}function I6(r){var l=r==null?0:r.length;return l?qC(r,1):[]}function C6(r){return DB(NB(r,void 0,I6),r+"")}function P6(r,l){return r!=null&&l in Object(r)}function R6(r,l,p){l=i0(l,r);for(var v=-1,A=l.length,R=!1;++v<A;){var D=ub(l[v]);if(!(R=r!=null&&p(r,D)))break;r=r[D]}return R||++v!=A?R:(A=r==null?0:r.length,!!A&&UB(A)&&VC(D,A)&&(Wm(r)||$C(r)))}function D6(r,l){return r!=null&&R6(r,l,P6)}function WC(r){for(var l=-1,p=r==null?0:r.length,v={};++l<p;){var A=r[l];v[A[0]]=A[1]}return v}function ZC(r){return r==null}function XC(r,l,p,v){if(!Ay(r))return r;l=i0(l,r);for(var A=-1,R=l.length,D=R-1,i=r;i!=null&&++A<R;){var G=ub(l[A]),W=p;if(G==="__proto__"||G==="constructor"||G==="prototype")return r;if(A!=D){var H=i[G];W=void 0,W===void 0&&(W=Ay(H)?H:VC(l[A+1])?[]:{})}BB(i,G,W),i=i[G]}return r}function z6(r,l,p){for(var v=-1,A=l.length,R={};++v<A;){var D=l[v],i=GC(r,D);p(i,D)&&XC(R,i0(D,r),i)}return R}function L6(r,l){return z6(r,l,function(p,v){return D6(r,v)})}var O6=C6(function(r,l){return r==null?{}:L6(r,l)});function k6(r,l,p){return r==null?r:XC(r,l,p)}const F6=r=>r===void 0,oy=r=>typeof r=="boolean",Bu=r=>typeof r=="number",jj=r=>!r&&r!==0||Vr(r)&&r.length===0||Un(r)&&!Object.keys(r).length,$j=r=>typeof Element>"u"?!1:r instanceof Element,Gj=r=>ZC(r),B6=r=>qn(r)?!Number.isNaN(Number(r)):!1;var N6=Object.defineProperty,V6=Object.defineProperties,U6=Object.getOwnPropertyDescriptors,KE=Object.getOwnPropertySymbols,j6=Object.prototype.hasOwnProperty,$6=Object.prototype.propertyIsEnumerable,YE=(r,l,p)=>l in r?N6(r,l,{enumerable:!0,configurable:!0,writable:!0,value:p}):r[l]=p,G6=(r,l)=>{for(var p in l||(l={}))j6.call(l,p)&&YE(r,p,l[p]);if(KE)for(var p of KE(l))$6.call(l,p)&&YE(r,p,l[p]);return r},H6=(r,l)=>V6(r,U6(l));function q6(r,l){var p;const v=Vn();return Hu(()=>{v.value=r()},H6(G6({},l),{flush:(p=void 0)!=null?p:"sync"})),Vd(v)}var JE;const Wu=typeof window<"u",W6=r=>typeof r=="string",Bd=()=>{},Z6=Wu&&((JE=window==null?void 0:window.navigator)==null?void 0:JE.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function Ec(r){return typeof r=="function"?r():xt(r)}function KC(r,l){function p(...v){return new Promise((A,R)=>{Promise.resolve(r(()=>l.apply(this,v),{fn:l,thisArg:this,args:v})).then(A).catch(R)})}return p}function X6(r,l={}){let p,v,A=Bd;const R=i=>{clearTimeout(i),A(),A=Bd};return i=>{const G=Ec(r),W=Ec(l.maxWait);return p&&R(p),G<=0||W!==void 0&&W<=0?(v&&(R(v),v=null),Promise.resolve(i())):new Promise((H,ee)=>{A=l.rejectOnCancel?ee:H,W&&!v&&(v=setTimeout(()=>{p&&R(p),v=null,H(i())},W)),p=setTimeout(()=>{v&&R(v),v=null,H(i())},G)})}}function K6(r,l=!0,p=!0,v=!1){let A=0,R,D=!0,i=Bd,G;const W=()=>{R&&(clearTimeout(R),R=void 0,i(),i=Bd)};return ee=>{const ne=Ec(r),de=Date.now()-A,he=()=>G=ee();return W(),ne<=0?(A=Date.now(),he()):(de>ne&&(p||!D)?(A=Date.now(),he()):l&&(G=new Promise((_e,Ie)=>{i=v?Ie:_e,R=setTimeout(()=>{A=Date.now(),D=!0,_e(he()),W()},Math.max(0,ne-de))})),!p&&!R&&(R=setTimeout(()=>D=!0,ne)),D=!1,G)}}function Y6(r){return r}function s0(r){return b1()?(Oy(r),!0):!1}function J6(r,l=200,p={}){return KC(X6(l,p),r)}function Hj(r,l=200,p={}){const v=dn(r.value),A=J6(()=>{v.value=r.value},l,p);return Tn(r,()=>A()),v}function qj(r,l=200,p=!1,v=!0,A=!1){return KC(K6(l,p,v,A),r)}function Q6(r,l=!0){$s()?fa(r):l?r():Bs(r)}function Wj(r,l,p={}){const{immediate:v=!0}=p,A=dn(!1);let R=null;function D(){R&&(clearTimeout(R),R=null)}function i(){A.value=!1,D()}function G(...W){D(),A.value=!0,R=setTimeout(()=>{A.value=!1,R=null,r(...W)},Ec(l))}return v&&(A.value=!0,Wu&&G()),s0(i),{isPending:Vd(A),start:G,stop:i}}function gc(r){var l;const p=Ec(r);return(l=p==null?void 0:p.$el)!=null?l:p}const Zm=Wu?window:void 0;function Pd(...r){let l,p,v,A;if(W6(r[0])||Array.isArray(r[0])?([p,v,A]=r,l=Zm):[l,p,v,A]=r,!l)return Bd;Array.isArray(p)||(p=[p]),Array.isArray(v)||(v=[v]);const R=[],D=()=>{R.forEach(H=>H()),R.length=0},i=(H,ee,ne,de)=>(H.addEventListener(ee,ne,de),()=>H.removeEventListener(ee,ne,de)),G=Tn(()=>[gc(l),Ec(A)],([H,ee])=>{D(),H&&R.push(...p.flatMap(ne=>v.map(de=>i(H,ne,de,ee))))},{immediate:!0,flush:"post"}),W=()=>{G(),D()};return s0(W),W}let QE=!1;function Zj(r,l,p={}){const{window:v=Zm,ignore:A=[],capture:R=!0,detectIframe:D=!1}=p;if(!v)return;Z6&&!QE&&(QE=!0,Array.from(v.document.body.children).forEach(ne=>ne.addEventListener("click",Bd)));let i=!0;const G=ne=>A.some(de=>{if(typeof de=="string")return Array.from(v.document.querySelectorAll(de)).some(he=>he===ne.target||ne.composedPath().includes(he));{const he=gc(de);return he&&(ne.target===he||ne.composedPath().includes(he))}}),H=[Pd(v,"click",ne=>{const de=gc(r);if(!(!de||de===ne.target||ne.composedPath().includes(de))){if(ne.detail===0&&(i=!G(ne)),!i){i=!0;return}l(ne)}},{passive:!0,capture:R}),Pd(v,"pointerdown",ne=>{const de=gc(r);de&&(i=!ne.composedPath().includes(de)&&!G(ne))},{passive:!0}),D&&Pd(v,"blur",ne=>{var de;const he=gc(r);((de=v.document.activeElement)==null?void 0:de.tagName)==="IFRAME"&&!(he!=null&&he.contains(v.document.activeElement))&&l(ne)})].filter(Boolean);return()=>H.forEach(ne=>ne())}function YC(r,l=!1){const p=dn(),v=()=>p.value=!!r();return v(),Q6(v,l),p}const eA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},tA="__vueuse_ssr_handlers__";eA[tA]=eA[tA]||{};function Xj(r,l,{window:p=Zm,initialValue:v=""}={}){const A=dn(v),R=et(()=>{var D;return gc(l)||((D=p==null?void 0:p.document)==null?void 0:D.documentElement)});return Tn([R,()=>Ec(r)],([D,i])=>{var G;if(D&&p){const W=(G=p.getComputedStyle(D).getPropertyValue(i))==null?void 0:G.trim();A.value=W||v}},{immediate:!0}),Tn(A,D=>{var i;(i=R.value)!=null&&i.style&&R.value.style.setProperty(Ec(r),D)}),A}var rA=Object.getOwnPropertySymbols,eN=Object.prototype.hasOwnProperty,tN=Object.prototype.propertyIsEnumerable,rN=(r,l)=>{var p={};for(var v in r)eN.call(r,v)&&l.indexOf(v)<0&&(p[v]=r[v]);if(r!=null&&rA)for(var v of rA(r))l.indexOf(v)<0&&tN.call(r,v)&&(p[v]=r[v]);return p};function nN(r,l,p={}){const v=p,{window:A=Zm}=v,R=rN(v,["window"]);let D;const i=YC(()=>A&&"ResizeObserver"in A),G=()=>{D&&(D.disconnect(),D=void 0)},W=Tn(()=>gc(r),ee=>{G(),i.value&&A&&ee&&(D=new ResizeObserver(l),D.observe(ee,R))},{immediate:!0,flush:"post"}),H=()=>{G(),W()};return s0(H),{isSupported:i,stop:H}}var nA=Object.getOwnPropertySymbols,iN=Object.prototype.hasOwnProperty,sN=Object.prototype.propertyIsEnumerable,oN=(r,l)=>{var p={};for(var v in r)iN.call(r,v)&&l.indexOf(v)<0&&(p[v]=r[v]);if(r!=null&&nA)for(var v of nA(r))l.indexOf(v)<0&&sN.call(r,v)&&(p[v]=r[v]);return p};function Kj(r,l,p={}){const v=p,{window:A=Zm}=v,R=oN(v,["window"]);let D;const i=YC(()=>A&&"MutationObserver"in A),G=()=>{D&&(D.disconnect(),D=void 0)},W=Tn(()=>gc(r),ee=>{G(),i.value&&A&&ee&&(D=new MutationObserver(l),D.observe(ee,R))},{immediate:!0}),H=()=>{G(),W()};return s0(H),{isSupported:i,stop:H}}var iA;(function(r){r.UP="UP",r.RIGHT="RIGHT",r.DOWN="DOWN",r.LEFT="LEFT",r.NONE="NONE"})(iA||(iA={}));var aN=Object.defineProperty,sA=Object.getOwnPropertySymbols,lN=Object.prototype.hasOwnProperty,cN=Object.prototype.propertyIsEnumerable,oA=(r,l,p)=>l in r?aN(r,l,{enumerable:!0,configurable:!0,writable:!0,value:p}):r[l]=p,uN=(r,l)=>{for(var p in l||(l={}))lN.call(l,p)&&oA(r,p,l[p]);if(sA)for(var p of sA(l))cN.call(l,p)&&oA(r,p,l[p]);return r};const hN={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};uN({linear:Y6},hN);class dN extends Error{constructor(l){super(l),this.name="ElementPlusError"}}function fN(r,l){throw new dN(`[${r}] ${l}`)}function Yj(r,l){}const aA={current:0},lA=dn(0),JC=2e3,cA=Symbol("elZIndexContextKey"),QC=Symbol("zIndexContextKey"),pN=r=>{const l=$s()?Pn(cA,aA):aA,p=r||($s()?Pn(QC,void 0):void 0),v=et(()=>{const D=xt(p);return Bu(D)?D:JC}),A=et(()=>v.value+lA.value),R=()=>(l.current++,lA.value=l.current,A.value);return!Wu&&Pn(cA),{initialZIndex:v,currentZIndex:A,nextZIndex:R}};var mN={name:"en",el:{breadcrumb:{label:"Breadcrumb"},colorpicker:{confirm:"OK",clear:"Clear",defaultLabel:"color picker",description:"current color is {color}. press enter to select a new color.",alphaLabel:"pick alpha value"},datepicker:{now:"Now",today:"Today",cancel:"Cancel",clear:"Clear",confirm:"OK",dateTablePrompt:"Use the arrow keys and enter to select the day of the month",monthTablePrompt:"Use the arrow keys and enter to select the month",yearTablePrompt:"Use the arrow keys and enter to select the year",selectedDate:"Selected date",selectDate:"Select date",selectTime:"Select time",startDate:"Start Date",startTime:"Start Time",endDate:"End Date",endTime:"End Time",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",year:"",month1:"January",month2:"February",month3:"March",month4:"April",month5:"May",month6:"June",month7:"July",month8:"August",month9:"September",month10:"October",month11:"November",month12:"December",week:"week",weeks:{sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat"},weeksFull:{sun:"Sunday",mon:"Monday",tue:"Tuesday",wed:"Wednesday",thu:"Thursday",fri:"Friday",sat:"Saturday"},months:{jan:"Jan",feb:"Feb",mar:"Mar",apr:"Apr",may:"May",jun:"Jun",jul:"Jul",aug:"Aug",sep:"Sep",oct:"Oct",nov:"Nov",dec:"Dec"}},inputNumber:{decrease:"decrease number",increase:"increase number"},select:{loading:"Loading",noMatch:"No matching data",noData:"No data",placeholder:"Select"},mention:{loading:"Loading"},dropdown:{toggleDropdown:"Toggle Dropdown"},cascader:{noMatch:"No matching data",loading:"Loading",placeholder:"Select",noData:"No data"},pagination:{goto:"Go to",pagesize:"/page",total:"Total {total}",pageClassifier:"",page:"Page",prev:"Go to previous page",next:"Go to next page",currentPage:"page {pager}",prevPages:"Previous {pager} pages",nextPages:"Next {pager} pages",deprecationWarning:"Deprecated usages detected, please refer to the el-pagination documentation for more details"},dialog:{close:"Close this dialog"},drawer:{close:"Close this dialog"},messagebox:{title:"Message",confirm:"OK",cancel:"Cancel",error:"Illegal input",close:"Close this dialog"},upload:{deleteTip:"press delete to remove",delete:"Delete",preview:"Preview",continue:"Continue"},slider:{defaultLabel:"slider between {min} and {max}",defaultRangeStartLabel:"pick start value",defaultRangeEndLabel:"pick end value"},table:{emptyText:"No Data",confirmFilter:"Confirm",resetFilter:"Reset",clearFilter:"All",sumText:"Sum"},tour:{next:"Next",previous:"Previous",finish:"Finish"},tree:{emptyText:"No Data"},transfer:{noMatch:"No matching data",noData:"No data",titles:["List 1","List 2"],filterPlaceholder:"Enter keyword",noCheckedFormat:"{total} items",hasCheckedFormat:"{checked}/{total} checked"},image:{error:"FAILED"},pageHeader:{title:"Back"},popconfirm:{confirmButtonText:"Yes",cancelButtonText:"No"},carousel:{leftArrow:"Carousel arrow left",rightArrow:"Carousel arrow right",indicator:"Carousel switch to index {index}"}}};const _N=r=>(l,p)=>gN(l,p,xt(r)),gN=(r,l,p)=>HC(p,r,r).replace(/\{(\w+)\}/g,(v,A)=>{var R;return`${(R=l==null?void 0:l[A])!=null?R:`{${A}}`}`}),yN=r=>{const l=et(()=>xt(r).name),p=Yn(r)?r:dn(r);return{lang:l,locale:p,t:_N(r)}},e3=Symbol("localeContextKey"),vN=r=>{const l=r||Pn(e3,dn());return yN(et(()=>l.value||mN))},t3="__epPropKey",Nu=r=>r,xN=r=>Un(r)&&!!r[t3],r3=(r,l)=>{if(!Un(r)||xN(r))return r;const{values:p,required:v,default:A,type:R,validator:D}=r,G={type:R,required:!!v,validator:p||D?W=>{let H=!1,ee=[];if(p&&(ee=Array.from(p),Hn(r,"default")&&ee.push(A),H||(H=ee.includes(W))),D&&(H||(H=D(W))),!H&&ee.length>0){const ne=[...new Set(ee)].map(de=>JSON.stringify(de)).join(", ");L4(`Invalid prop: validation failed${l?` for prop "${l}"`:""}. Expected one of [${ne}], got value ${JSON.stringify(W)}.`)}return H}:void 0,[t3]:!0};return Hn(r,"default")&&(G.default=A),G},Jd=r=>WC(Object.entries(r).map(([l,p])=>[l,r3(p,l)])),n3=["","default","small","large"],i3=r3({type:String,values:n3,required:!1}),s3=Symbol("size"),bN=()=>{const r=Pn(s3,{});return et(()=>xt(r.size)||"")},o3=Symbol("emptyValuesContextKey"),wN=["",void 0,null],TN=void 0,Jj=Jd({emptyValues:Array,valueOnClear:{type:[String,Number,Boolean,Function],default:void 0,validator:r=>Zr(r)?!r():!r}}),Qj=(r,l)=>{const p=$s()?Pn(o3,dn({})):dn({}),v=et(()=>r.emptyValues||p.value.emptyValues||wN),A=et(()=>Zr(r.valueOnClear)?r.valueOnClear():r.valueOnClear!==void 0?r.valueOnClear:Zr(p.value.valueOnClear)?p.value.valueOnClear():p.value.valueOnClear!==void 0?p.value.valueOnClear:TN),R=D=>v.value.includes(D);return v.value.includes(A.value),{emptyValues:v,valueOnClear:A,isEmptyValue:R}},uA=r=>Object.keys(r),e$=(r,l,p)=>({get value(){return HC(r,l,p)},set value(v){k6(r,l,v)}}),Iy=dn();function hb(r,l=void 0){const p=$s()?Pn(OC,Iy):Iy;return r?et(()=>{var v,A;return(A=(v=p.value)==null?void 0:v[r])!=null?A:l}):p}function t$(r,l){const p=hb(),v=Tc(r,et(()=>{var i;return((i=p.value)==null?void 0:i.namespace)||sy})),A=vN(et(()=>{var i;return(i=p.value)==null?void 0:i.locale})),R=pN(et(()=>{var i;return((i=p.value)==null?void 0:i.zIndex)||JC})),D=et(()=>{var i;return xt(l)||((i=p.value)==null?void 0:i.size)||""});return SN(et(()=>xt(p)||{})),{ns:v,locale:A,zIndex:R,size:D}}const SN=(r,l,p=!1)=>{var v;const A=!!$s(),R=A?hb():void 0,D=(v=void 0)!=null?v:A?vo:void 0;if(!D)return;const i=et(()=>{const G=xt(r);return R!=null&&R.value?EN(R.value,G):G});return D(OC,i),D(e3,et(()=>i.value.locale)),D(kC,et(()=>i.value.namespace)),D(QC,et(()=>i.value.zIndex)),D(s3,{size:et(()=>i.value.size||"")}),D(o3,et(()=>({emptyValues:i.value.emptyValues,valueOnClear:i.value.valueOnClear}))),(p||!Iy.value)&&(Iy.value=i.value),i},EN=(r,l)=>{const p=[...new Set([...uA(r),...uA(l)])],v={};for(const A of p)v[A]=l[A]!==void 0?l[A]:r[A];return v},Nd="update:modelValue",Im="change",Cm="input";var Xm=(r,l)=>{const p=r.__vccOpts||r;for(const[v,A]of l)p[v]=A;return p};const a3=(r="")=>r.split(" ").filter(l=>!!l.trim()),r$=(r,l)=>{if(!r||!l)return!1;if(l.includes(" "))throw new Error("className should not contain space.");return r.classList.contains(l)},n$=(r,l)=>{!r||!l.trim()||r.classList.add(...a3(l))},i$=(r,l)=>{!r||!l.trim()||r.classList.remove(...a3(l))},s$=(r,l)=>{var p;if(!Wu||!r||!l)return"";let v=js(l);v==="float"&&(v="cssFloat");try{const A=r.style[v];if(A)return A;const R=(p=document.defaultView)==null?void 0:p.getComputedStyle(r,"");return R?R[v]:""}catch{return r.style[v]}};function l3(r,l="px"){if(!r)return"";if(Bu(r)||B6(r))return`${r}${l}`;if(qn(r))return r}const o0=(r,l)=>{if(r.install=p=>{for(const v of[r,...Object.values(l??{})])p.component(v.name,v)},l)for(const[p,v]of Object.entries(l))r[p]=v;return r},o$=(r,l)=>(r.install=p=>{r._context=p._context,p.config.globalProperties[l]=r},r),a$=(r,l)=>(r.install=p=>{p.directive(l,r)},r),AN=r=>(r.install=yo,r),MN=Jd({size:{type:Nu([Number,String])},color:{type:String}}),IN=pn({name:"ElIcon",inheritAttrs:!1}),CN=pn({...IN,props:MN,setup(r){const l=r,p=Tc("icon"),v=et(()=>{const{size:A,color:R}=l;return!A&&!R?{}:{fontSize:F6(A)?void 0:l3(A),"--color":R}});return(A,R)=>(Kt(),Nr("i",ys({class:xt(p).b(),style:xt(v)},A.$attrs),[la(A.$slots,"default")],16))}});var PN=Xm(CN,[["__file","icon.vue"]]);const Js=o0(PN);/*! Element Plus Icons Vue v2.3.1 */var RN=pn({name:"ArrowDown",__name:"arrow-down",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.592 30.592 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.592 30.592 0 0 0-42.752 0z"})]))}}),l$=RN,DN=pn({name:"ArrowLeft",__name:"arrow-left",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M609.408 149.376 277.76 489.6a32 32 0 0 0 0 44.672l331.648 340.352a29.12 29.12 0 0 0 41.728 0 30.592 30.592 0 0 0 0-42.752L339.264 511.936l311.872-319.872a30.592 30.592 0 0 0 0-42.688 29.12 29.12 0 0 0-41.728 0z"})]))}}),c$=DN,zN=pn({name:"ArrowRight",__name:"arrow-right",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M340.864 149.312a30.592 30.592 0 0 0 0 42.752L652.736 512 340.864 831.872a30.592 30.592 0 0 0 0 42.752 29.12 29.12 0 0 0 41.728 0L714.24 534.336a32 32 0 0 0 0-44.672L382.592 149.376a29.12 29.12 0 0 0-41.728 0z"})]))}}),u$=zN,LN=pn({name:"Check",__name:"check",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),h$=LN,ON=pn({name:"CircleCheck",__name:"circle-check",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896"}),Wr("path",{fill:"currentColor",d:"M745.344 361.344a32 32 0 0 1 45.312 45.312l-288 288a32 32 0 0 1-45.312 0l-160-160a32 32 0 1 1 45.312-45.312L480 626.752l265.344-265.408z"})]))}}),kN=ON,FN=pn({name:"CircleCloseFilled",__name:"circle-close-filled",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336z"})]))}}),c3=FN,BN=pn({name:"CircleClose",__name:"circle-close",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"m466.752 512-90.496-90.496a32 32 0 0 1 45.248-45.248L512 466.752l90.496-90.496a32 32 0 1 1 45.248 45.248L557.248 512l90.496 90.496a32 32 0 1 1-45.248 45.248L512 557.248l-90.496 90.496a32 32 0 0 1-45.248-45.248z"}),Wr("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896"})]))}}),u3=BN,NN=pn({name:"Close",__name:"close",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"})]))}}),h3=NN,VN=pn({name:"CopyDocument",__name:"copy-document",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M768 832a128 128 0 0 1-128 128H192A128 128 0 0 1 64 832V384a128 128 0 0 1 128-128v64a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64z"}),Wr("path",{fill:"currentColor",d:"M384 128a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64V192a64 64 0 0 0-64-64zm0-64h448a128 128 0 0 1 128 128v448a128 128 0 0 1-128 128H384a128 128 0 0 1-128-128V192A128 128 0 0 1 384 64"})]))}}),d$=VN,UN=pn({name:"Delete",__name:"delete",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M160 256H96a32 32 0 0 1 0-64h256V95.936a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V192h256a32 32 0 1 1 0 64h-64v672a32 32 0 0 1-32 32H192a32 32 0 0 1-32-32zm448-64v-64H416v64zM224 896h576V256H224zm192-128a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32m192 0a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32"})]))}}),f$=UN,jN=pn({name:"Edit",__name:"edit",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M832 512a32 32 0 1 1 64 0v352a32 32 0 0 1-32 32H160a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h352a32 32 0 0 1 0 64H192v640h640z"}),Wr("path",{fill:"currentColor",d:"m469.952 554.24 52.8-7.552L847.104 222.4a32 32 0 1 0-45.248-45.248L477.44 501.44l-7.552 52.8zm422.4-422.4a96 96 0 0 1 0 135.808l-331.84 331.84a32 32 0 0 1-18.112 9.088L436.8 623.68a32 32 0 0 1-36.224-36.224l15.104-105.6a32 32 0 0 1 9.024-18.112l331.904-331.84a96 96 0 0 1 135.744 0z"})]))}}),p$=jN,$N=pn({name:"FullScreen",__name:"full-screen",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"m160 96.064 192 .192a32 32 0 0 1 0 64l-192-.192V352a32 32 0 0 1-64 0V96h64zm0 831.872V928H96V672a32 32 0 1 1 64 0v191.936l192-.192a32 32 0 1 1 0 64zM864 96.064V96h64v256a32 32 0 1 1-64 0V160.064l-192 .192a32 32 0 1 1 0-64l192-.192zm0 831.872-192-.192a32 32 0 0 1 0-64l192 .192V672a32 32 0 1 1 64 0v256h-64z"})]))}}),m$=$N,GN=pn({name:"Hide",__name:"hide",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M876.8 156.8c0-9.6-3.2-16-9.6-22.4-6.4-6.4-12.8-9.6-22.4-9.6-9.6 0-16 3.2-22.4 9.6L736 220.8c-64-32-137.6-51.2-224-60.8-160 16-288 73.6-377.6 176C44.8 438.4 0 496 0 512s48 73.6 134.4 176c22.4 25.6 44.8 48 73.6 67.2l-86.4 89.6c-6.4 6.4-9.6 12.8-9.6 22.4 0 9.6 3.2 16 9.6 22.4 6.4 6.4 12.8 9.6 22.4 9.6 9.6 0 16-3.2 22.4-9.6l704-710.4c3.2-6.4 6.4-12.8 6.4-22.4Zm-646.4 528c-76.8-70.4-128-128-153.6-172.8 28.8-48 80-105.6 153.6-172.8C304 272 400 230.4 512 224c64 3.2 124.8 19.2 176 44.8l-54.4 54.4C598.4 300.8 560 288 512 288c-64 0-115.2 22.4-160 64s-64 96-64 160c0 48 12.8 89.6 35.2 124.8L256 707.2c-9.6-6.4-19.2-16-25.6-22.4Zm140.8-96c-12.8-22.4-19.2-48-19.2-76.8 0-44.8 16-83.2 48-112 32-28.8 67.2-48 112-48 28.8 0 54.4 6.4 73.6 19.2zM889.599 336c-12.8-16-28.8-28.8-41.6-41.6l-48 48c73.6 67.2 124.8 124.8 150.4 169.6-28.8 48-80 105.6-153.6 172.8-73.6 67.2-172.8 108.8-284.8 115.2-51.2-3.2-99.2-12.8-140.8-28.8l-48 48c57.6 22.4 118.4 38.4 188.8 44.8 160-16 288-73.6 377.6-176C979.199 585.6 1024 528 1024 512s-48.001-73.6-134.401-176Z"}),Wr("path",{fill:"currentColor",d:"M511.998 672c-12.8 0-25.6-3.2-38.4-6.4l-51.2 51.2c28.8 12.8 57.6 19.2 89.6 19.2 64 0 115.2-22.4 160-64 41.6-41.6 64-96 64-160 0-32-6.4-64-19.2-89.6l-51.2 51.2c3.2 12.8 6.4 25.6 6.4 38.4 0 44.8-16 83.2-48 112-32 28.8-67.2 48-112 48Z"})]))}}),HN=GN,qN=pn({name:"InfoFilled",__name:"info-filled",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64m67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344M590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296-44.096 0-108.992 44.736-148.48 101.504 0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04 67.84 0 107.904-43.648 147.456-100.416z"})]))}}),d3=qN,WN=pn({name:"Link",__name:"link",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M715.648 625.152 670.4 579.904l90.496-90.56c75.008-74.944 85.12-186.368 22.656-248.896-62.528-62.464-173.952-52.352-248.96 22.656L444.16 353.6l-45.248-45.248 90.496-90.496c100.032-99.968 251.968-110.08 339.456-22.656 87.488 87.488 77.312 239.424-22.656 339.456l-90.496 90.496zm-90.496 90.496-90.496 90.496C434.624 906.112 282.688 916.224 195.2 828.8c-87.488-87.488-77.312-239.424 22.656-339.456l90.496-90.496 45.248 45.248-90.496 90.56c-75.008 74.944-85.12 186.368-22.656 248.896 62.528 62.464 173.952 52.352 248.96-22.656l90.496-90.496zm0-362.048 45.248 45.248L398.848 670.4 353.6 625.152z"})]))}}),_$=WN,ZN=pn({name:"Loading",__name:"loading",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32m0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32m448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32m-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32M195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0m-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"})]))}}),db=ZN,XN=pn({name:"Plus",__name:"plus",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M480 480V128a32 32 0 0 1 64 0v352h352a32 32 0 1 1 0 64H544v352a32 32 0 1 1-64 0V544H128a32 32 0 0 1 0-64z"})]))}}),g$=XN,KN=pn({name:"QuestionFilled",__name:"question-filled",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m23.744 191.488c-52.096 0-92.928 14.784-123.2 44.352-30.976 29.568-45.76 70.4-45.76 122.496h80.256c0-29.568 5.632-52.8 17.6-68.992 13.376-19.712 35.2-28.864 66.176-28.864 23.936 0 42.944 6.336 56.32 19.712 12.672 13.376 19.712 31.68 19.712 54.912 0 17.6-6.336 34.496-19.008 49.984l-8.448 9.856c-45.76 40.832-73.216 70.4-82.368 89.408-9.856 19.008-14.08 42.24-14.08 68.992v9.856h80.96v-9.856c0-16.896 3.52-31.68 10.56-45.76 6.336-12.672 15.488-24.64 28.16-35.2 33.792-29.568 54.208-48.576 60.544-55.616 16.896-22.528 26.048-51.392 26.048-86.592 0-42.944-14.08-76.736-42.24-101.376-28.16-25.344-65.472-37.312-111.232-37.312zm-12.672 406.208a54.272 54.272 0 0 0-38.72 14.784 49.408 49.408 0 0 0-15.488 38.016c0 15.488 4.928 28.16 15.488 38.016A54.848 54.848 0 0 0 523.072 768c15.488 0 28.16-4.928 38.72-14.784a51.52 51.52 0 0 0 16.192-38.72 51.968 51.968 0 0 0-15.488-38.016 55.936 55.936 0 0 0-39.424-14.784z"})]))}}),y$=KN,YN=pn({name:"RefreshLeft",__name:"refresh-left",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M289.088 296.704h92.992a32 32 0 0 1 0 64H232.96a32 32 0 0 1-32-32V179.712a32 32 0 0 1 64 0v50.56a384 384 0 0 1 643.84 282.88 384 384 0 0 1-383.936 384 384 384 0 0 1-384-384h64a320 320 0 1 0 640 0 320 320 0 0 0-555.712-216.448z"})]))}}),v$=YN,JN=pn({name:"RefreshRight",__name:"refresh-right",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})]))}}),x$=JN,QN=pn({name:"ScaleToOriginal",__name:"scale-to-original",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M813.176 180.706a60.235 60.235 0 0 1 60.236 60.235v481.883a60.235 60.235 0 0 1-60.236 60.235H210.824a60.235 60.235 0 0 1-60.236-60.235V240.94a60.235 60.235 0 0 1 60.236-60.235h602.352zm0-60.235H210.824A120.47 120.47 0 0 0 90.353 240.94v481.883a120.47 120.47 0 0 0 120.47 120.47h602.353a120.47 120.47 0 0 0 120.471-120.47V240.94a120.47 120.47 0 0 0-120.47-120.47zm-120.47 180.705a30.118 30.118 0 0 0-30.118 30.118v301.177a30.118 30.118 0 0 0 60.236 0V331.294a30.118 30.118 0 0 0-30.118-30.118zm-361.412 0a30.118 30.118 0 0 0-30.118 30.118v301.177a30.118 30.118 0 1 0 60.236 0V331.294a30.118 30.118 0 0 0-30.118-30.118M512 361.412a30.118 30.118 0 0 0-30.118 30.117v30.118a30.118 30.118 0 0 0 60.236 0V391.53A30.118 30.118 0 0 0 512 361.412M512 512a30.118 30.118 0 0 0-30.118 30.118v30.117a30.118 30.118 0 0 0 60.236 0v-30.117A30.118 30.118 0 0 0 512 512"})]))}}),b$=QN,eV=pn({name:"Search",__name:"search",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704"})]))}}),tV=eV,rV=pn({name:"SuccessFilled",__name:"success-filled",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336z"})]))}}),f3=rV,nV=pn({name:"View",__name:"view",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 160c320 0 512 352 512 352S832 864 512 864 0 512 0 512s192-352 512-352m0 64c-225.28 0-384.128 208.064-436.8 288 52.608 79.872 211.456 288 436.8 288 225.28 0 384.128-208.064 436.8-288-52.608-79.872-211.456-288-436.8-288zm0 64a224 224 0 1 1 0 448 224 224 0 0 1 0-448m0 64a160.192 160.192 0 0 0-160 160c0 88.192 71.744 160 160 160s160-71.808 160-160-71.744-160-160-160"})]))}}),iV=nV,sV=pn({name:"WarningFilled",__name:"warning-filled",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 192a58.432 58.432 0 0 0-58.24 63.744l23.36 256.384a35.072 35.072 0 0 0 69.76 0l23.296-256.384A58.432 58.432 0 0 0 512 256m0 512a51.2 51.2 0 1 0 0-102.4 51.2 51.2 0 0 0 0 102.4"})]))}}),p3=sV,oV=pn({name:"ZoomIn",__name:"zoom-in",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704m-32-384v-96a32 32 0 0 1 64 0v96h96a32 32 0 0 1 0 64h-96v96a32 32 0 0 1-64 0v-96h-96a32 32 0 0 1 0-64z"})]))}}),w$=oV,aV=pn({name:"ZoomOut",__name:"zoom-out",setup(r){return(l,p)=>(Kt(),Nr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704M352 448h256a32 32 0 0 1 0 64H352a32 32 0 0 1 0-64"})]))}}),T$=aV;const yc=Nu([String,Object,Function]),S$={Close:h3},E$={Close:h3,SuccessFilled:f3,InfoFilled:d3,WarningFilled:p3,CircleCloseFilled:c3},A$={success:f3,warning:p3,error:c3,info:d3},lV={validating:db,success:kN,error:u3},cV=()=>Wu&&/firefox/i.test(window.navigator.userAgent);let Ys;const uV={height:"0",visibility:"hidden",overflow:cV()?"":"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},hV=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"];function dV(r){const l=window.getComputedStyle(r),p=l.getPropertyValue("box-sizing"),v=Number.parseFloat(l.getPropertyValue("padding-bottom"))+Number.parseFloat(l.getPropertyValue("padding-top")),A=Number.parseFloat(l.getPropertyValue("border-bottom-width"))+Number.parseFloat(l.getPropertyValue("border-top-width"));return{contextStyle:hV.map(D=>[D,l.getPropertyValue(D)]),paddingSize:v,borderSize:A,boxSizing:p}}function hA(r,l=1,p){var v;Ys||(Ys=document.createElement("textarea"),document.body.appendChild(Ys));const{paddingSize:A,borderSize:R,boxSizing:D,contextStyle:i}=dV(r);i.forEach(([ee,ne])=>Ys==null?void 0:Ys.style.setProperty(ee,ne)),Object.entries(uV).forEach(([ee,ne])=>Ys==null?void 0:Ys.style.setProperty(ee,ne,"important")),Ys.value=r.value||r.placeholder||"";let G=Ys.scrollHeight;const W={};D==="border-box"?G=G+R:D==="content-box"&&(G=G-A),Ys.value="";const H=Ys.scrollHeight-A;if(Bu(l)){let ee=H*l;D==="border-box"&&(ee=ee+A+R),G=Math.max(ee,G),W.minHeight=`${ee}px`}if(Bu(p)){let ee=H*p;D==="border-box"&&(ee=ee+A+R),G=Math.min(ee,G)}return W.height=`${G}px`,(v=Ys.parentNode)==null||v.removeChild(Ys),Ys=void 0,W}const fV=r=>r,pV=Jd({ariaLabel:String,ariaOrientation:{type:String,values:["horizontal","vertical","undefined"]},ariaControls:String}),m3=r=>O6(pV,r),mV=Jd({id:{type:String,default:void 0},size:i3,disabled:Boolean,modelValue:{type:Nu([String,Number,Object]),default:""},maxlength:{type:[String,Number]},minlength:{type:[String,Number]},type:{type:String,default:"text"},resize:{type:String,values:["none","both","horizontal","vertical"]},autosize:{type:Nu([Boolean,Object]),default:!1},autocomplete:{type:String,default:"off"},formatter:{type:Function},parser:{type:Function},placeholder:{type:String},form:{type:String},readonly:Boolean,clearable:Boolean,showPassword:Boolean,showWordLimit:Boolean,suffixIcon:{type:yc},prefixIcon:{type:yc},containerRole:{type:String,default:void 0},tabindex:{type:[String,Number],default:0},validateEvent:{type:Boolean,default:!0},inputStyle:{type:Nu([Object,Array,String]),default:()=>fV({})},autofocus:Boolean,rows:{type:Number,default:2},...m3(["ariaLabel"])}),_V={[Nd]:r=>qn(r),input:r=>qn(r),change:r=>qn(r),focus:r=>r instanceof FocusEvent,blur:r=>r instanceof FocusEvent,clear:()=>!0,mouseleave:r=>r instanceof MouseEvent,mouseenter:r=>r instanceof MouseEvent,keydown:r=>r instanceof Event,compositionstart:r=>r instanceof CompositionEvent,compositionupdate:r=>r instanceof CompositionEvent,compositionend:r=>r instanceof CompositionEvent},gV=["class","style"],yV=/^on[A-Z]/,vV=(r={})=>{const{excludeListeners:l=!1,excludeKeys:p}=r,v=et(()=>((p==null?void 0:p.value)||[]).concat(gV)),A=$s();return et(A?()=>{var R;return WC(Object.entries((R=A.proxy)==null?void 0:R.$attrs).filter(([D])=>!v.value.includes(D)&&!(l&&yV.test(D))))}:()=>({}))},fb=Symbol("formContextKey"),_3=Symbol("formItemContextKey"),dA={prefix:Math.floor(Math.random()*1e4),current:0},xV=Symbol("elIdInjection"),bV=()=>$s()?Pn(xV,dA):dA,wV=r=>{const l=bV(),p=FC();return q6(()=>xt(r)||`${p.value}-id-${l.prefix}-${l.current++}`)},pb=()=>{const r=Pn(fb,void 0),l=Pn(_3,void 0);return{form:r,formItem:l}},g3=(r,{formItemContext:l,disableIdGeneration:p,disableIdManagement:v})=>{p||(p=dn(!1)),v||(v=dn(!1));const A=dn();let R;const D=et(()=>{var i;return!!(!(r.label||r.ariaLabel)&&l&&l.inputIds&&((i=l.inputIds)==null?void 0:i.length)<=1)});return fa(()=>{R=Tn([Si(r,"id"),p],([i,G])=>{const W=i??(G?void 0:wV().value);W!==A.value&&(l!=null&&l.removeInputId&&(A.value&&l.removeInputId(A.value),!(v!=null&&v.value)&&!G&&W&&l.addInputId(W)),A.value=W)},{immediate:!0})}),z1(()=>{R&&R(),l!=null&&l.removeInputId&&A.value&&l.removeInputId(A.value)}),{isLabeledByFormItem:D,inputId:A}},y3=r=>{const l=$s();return et(()=>{var p,v;return(v=(p=l==null?void 0:l.proxy)==null?void 0:p.$props)==null?void 0:v[r]})},mb=(r,l={})=>{const p=dn(void 0),v=l.prop?p:y3("size"),A=l.global?p:bN(),R=l.form?{size:void 0}:Pn(fb,void 0),D=l.formItem?{size:void 0}:Pn(_3,void 0);return et(()=>v.value||xt(r)||(D==null?void 0:D.size)||(R==null?void 0:R.size)||A.value||"")},a0=r=>{const l=y3("disabled"),p=Pn(fb,void 0);return et(()=>l.value||xt(r)||(p==null?void 0:p.disabled)||!1)};function TV(r,{beforeFocus:l,afterFocus:p,beforeBlur:v,afterBlur:A}={}){const R=$s(),{emit:D}=R,i=Vn(),G=dn(!1),W=ne=>{Zr(l)&&l(ne)||G.value||(G.value=!0,D("focus",ne),p==null||p())},H=ne=>{var de;Zr(v)&&v(ne)||ne.relatedTarget&&((de=i.value)!=null&&de.contains(ne.relatedTarget))||(G.value=!1,D("blur",ne),A==null||A())},ee=()=>{var ne,de;(ne=i.value)!=null&&ne.contains(document.activeElement)&&i.value!==document.activeElement||(de=r.value)==null||de.focus()};return Tn(i,ne=>{ne&&ne.setAttribute("tabindex","-1")}),Pd(i,"focus",W,!0),Pd(i,"blur",H,!0),Pd(i,"click",ee,!0),{isFocused:G,wrapperRef:i,handleFocus:W,handleBlur:H}}const SV=r=>/([\uAC00-\uD7AF\u3130-\u318F])+/gi.test(r);function EV({afterComposition:r,emit:l}){const p=dn(!1),v=i=>{l==null||l("compositionstart",i),p.value=!0},A=i=>{var G;l==null||l("compositionupdate",i);const W=(G=i.target)==null?void 0:G.value,H=W[W.length-1]||"";p.value=!SV(H)},R=i=>{l==null||l("compositionend",i),p.value&&(p.value=!1,Bs(()=>r(i)))};return{isComposing:p,handleComposition:i=>{i.type==="compositionend"?R(i):A(i)},handleCompositionStart:v,handleCompositionUpdate:A,handleCompositionEnd:R}}function AV(r){let l;function p(){if(r.value==null)return;const{selectionStart:A,selectionEnd:R,value:D}=r.value;if(A==null||R==null)return;const i=D.slice(0,Math.max(0,A)),G=D.slice(Math.max(0,R));l={selectionStart:A,selectionEnd:R,value:D,beforeTxt:i,afterTxt:G}}function v(){if(r.value==null||l==null)return;const{value:A}=r.value,{beforeTxt:R,afterTxt:D,selectionStart:i}=l;if(R==null||D==null||i==null)return;let G=A.length;if(A.endsWith(D))G=A.length-D.length;else if(A.startsWith(R))G=R.length;else{const W=R[i-1],H=A.indexOf(W,i-1);H!==-1&&(G=H+1)}r.value.setSelectionRange(G,G)}return[p,v]}const MV="ElInput",IV=pn({name:MV,inheritAttrs:!1}),CV=pn({...IV,props:mV,emits:_V,setup(r,{expose:l,emit:p}){const v=r,A=Wz(),R=vV(),D=IM(),i=et(()=>[v.type==="textarea"?_e.b():he.b(),he.m(ne.value),he.is("disabled",de.value),he.is("exceed",ir.value),{[he.b("group")]:D.prepend||D.append,[he.m("prefix")]:D.prefix||v.prefixIcon,[he.m("suffix")]:D.suffix||v.suffixIcon||v.clearable||v.showPassword,[he.bm("suffix","password-clear")]:Ur.value&&lr.value,[he.b("hidden")]:v.type==="hidden"},A.class]),G=et(()=>[he.e("wrapper"),he.is("focus",Et.value)]),{form:W,formItem:H}=pb(),{inputId:ee}=g3(v,{formItemContext:H}),ne=mb(),de=a0(),he=Tc("input"),_e=Tc("textarea"),Ie=Vn(),je=Vn(),vt=dn(!1),Pt=dn(!1),ht=dn(),ft=Vn(v.inputStyle),bt=et(()=>Ie.value||je.value),{wrapperRef:Je,isFocused:Et,handleFocus:pt,handleBlur:lt}=TV(bt,{beforeFocus(){return de.value},afterBlur(){var Ye;v.validateEvent&&((Ye=H==null?void 0:H.validate)==null||Ye.call(H,"blur").catch(Qt=>void 0))}}),dt=et(()=>{var Ye;return(Ye=W==null?void 0:W.statusIcon)!=null?Ye:!1}),mt=et(()=>(H==null?void 0:H.validateState)||""),nr=et(()=>mt.value&&lV[mt.value]),Cr=et(()=>Pt.value?iV:HN),Zt=et(()=>[A.style]),Tr=et(()=>[v.inputStyle,ft.value,{resize:v.resize}]),vr=et(()=>ZC(v.modelValue)?"":String(v.modelValue)),Ur=et(()=>v.clearable&&!de.value&&!v.readonly&&!!vr.value&&(Et.value||vt.value)),lr=et(()=>v.showPassword&&!de.value&&!!vr.value&&(!!vr.value||Et.value)),qr=et(()=>v.showWordLimit&&!!v.maxlength&&(v.type==="text"||v.type==="textarea")&&!de.value&&!v.readonly&&!v.showPassword),ur=et(()=>vr.value.length),ir=et(()=>!!qr.value&&ur.value>Number(v.maxlength)),$t=et(()=>!!D.suffix||!!v.suffixIcon||Ur.value||v.showPassword||qr.value||!!mt.value&&dt.value),[vi,di]=AV(Ie);nN(je,Ye=>{if(tr(),!qr.value||v.resize!=="both")return;const Qt=Ye[0],{width:Gr}=Qt.contentRect;ht.value={right:`calc(100% - ${Gr+15+6}px)`}});const yn=()=>{const{type:Ye,autosize:Qt}=v;if(!(!Wu||Ye!=="textarea"||!je.value))if(Qt){const Gr=Un(Qt)?Qt.minRows:void 0,xn=Un(Qt)?Qt.maxRows:void 0,jr=hA(je.value,Gr,xn);ft.value={overflowY:"hidden",...jr},Bs(()=>{je.value.offsetHeight,ft.value=jr})}else ft.value={minHeight:hA(je.value).minHeight}},tr=(Ye=>{let Qt=!1;return()=>{var Gr;if(Qt||!v.autosize)return;((Gr=je.value)==null?void 0:Gr.offsetParent)===null||(Ye(),Qt=!0)}})(yn),Yt=()=>{const Ye=bt.value,Qt=v.formatter?v.formatter(vr.value):vr.value;!Ye||Ye.value===Qt||(Ye.value=Qt)},te=async Ye=>{vi();let{value:Qt}=Ye.target;if(v.formatter&&v.parser&&(Qt=v.parser(Qt)),!ke.value){if(Qt===vr.value){Yt();return}p(Nd,Qt),p(Cm,Qt),await Bs(),Yt(),di()}},vn=Ye=>{let{value:Qt}=Ye.target;v.formatter&&v.parser&&(Qt=v.parser(Qt)),p(Im,Qt)},{isComposing:ke,handleCompositionStart:Ve,handleCompositionUpdate:Ae,handleCompositionEnd:wt}=EV({emit:p,afterComposition:te}),Vt=()=>{vi(),Pt.value=!Pt.value,setTimeout(di)},zt=()=>{var Ye;return(Ye=bt.value)==null?void 0:Ye.focus()},Dt=()=>{var Ye;return(Ye=bt.value)==null?void 0:Ye.blur()},jt=Ye=>{vt.value=!1,p("mouseleave",Ye)},Jt=Ye=>{vt.value=!0,p("mouseenter",Ye)},Gt=Ye=>{p("keydown",Ye)},Pr=()=>{var Ye;(Ye=bt.value)==null||Ye.select()},cr=()=>{p(Nd,""),p(Im,""),p("clear"),p(Cm,"")};return Tn(()=>v.modelValue,()=>{var Ye;Bs(()=>yn()),v.validateEvent&&((Ye=H==null?void 0:H.validate)==null||Ye.call(H,"change").catch(Qt=>void 0))}),Tn(vr,()=>Yt()),Tn(()=>v.type,async()=>{await Bs(),Yt(),yn()}),fa(()=>{!v.formatter&&v.parser,Yt(),Bs(yn)}),l({input:Ie,textarea:je,ref:bt,textareaStyle:Tr,autosize:Si(v,"autosize"),isComposing:ke,focus:zt,blur:Dt,select:Pr,clear:cr,resizeTextarea:yn}),(Ye,Qt)=>(Kt(),Nr("div",{class:kn([xt(i),{[xt(he).bm("group","append")]:Ye.$slots.append,[xt(he).bm("group","prepend")]:Ye.$slots.prepend}]),style:Vu(xt(Zt)),onMouseenter:Jt,onMouseleave:jt},[In(" input "),Ye.type!=="textarea"?(Kt(),Nr(ti,{key:0},[In(" prepend slot "),Ye.$slots.prepend?(Kt(),Nr("div",{key:0,class:kn(xt(he).be("group","prepend"))},[la(Ye.$slots,"prepend")],2)):In("v-if",!0),Wr("div",{ref_key:"wrapperRef",ref:Je,class:kn(xt(G))},[In(" prefix slot "),Ye.$slots.prefix||Ye.prefixIcon?(Kt(),Nr("span",{key:0,class:kn(xt(he).e("prefix"))},[Wr("span",{class:kn(xt(he).e("prefix-inner"))},[la(Ye.$slots,"prefix"),Ye.prefixIcon?(Kt(),Cn(xt(Js),{key:0,class:kn(xt(he).e("icon"))},{default:An(()=>[(Kt(),Cn(mo(Ye.prefixIcon)))]),_:1},8,["class"])):In("v-if",!0)],2)],2)):In("v-if",!0),Wr("input",ys({id:xt(ee),ref_key:"input",ref:Ie,class:xt(he).e("inner")},xt(R),{minlength:Ye.minlength,maxlength:Ye.maxlength,type:Ye.showPassword?Pt.value?"text":"password":Ye.type,disabled:xt(de),readonly:Ye.readonly,autocomplete:Ye.autocomplete,tabindex:Ye.tabindex,"aria-label":Ye.ariaLabel,placeholder:Ye.placeholder,style:Ye.inputStyle,form:Ye.form,autofocus:Ye.autofocus,role:Ye.containerRole,onCompositionstart:xt(Ve),onCompositionupdate:xt(Ae),onCompositionend:xt(wt),onInput:te,onChange:vn,onKeydown:Gt}),null,16,["id","minlength","maxlength","type","disabled","readonly","autocomplete","tabindex","aria-label","placeholder","form","autofocus","role","onCompositionstart","onCompositionupdate","onCompositionend"]),In(" suffix slot "),xt($t)?(Kt(),Nr("span",{key:1,class:kn(xt(he).e("suffix"))},[Wr("span",{class:kn(xt(he).e("suffix-inner"))},[!xt(Ur)||!xt(lr)||!xt(qr)?(Kt(),Nr(ti,{key:0},[la(Ye.$slots,"suffix"),Ye.suffixIcon?(Kt(),Cn(xt(Js),{key:0,class:kn(xt(he).e("icon"))},{default:An(()=>[(Kt(),Cn(mo(Ye.suffixIcon)))]),_:1},8,["class"])):In("v-if",!0)],64)):In("v-if",!0),xt(Ur)?(Kt(),Cn(xt(Js),{key:1,class:kn([xt(he).e("icon"),xt(he).e("clear")]),onMousedown:lI(xt(yo),["prevent"]),onClick:cr},{default:An(()=>[st(xt(u3))]),_:1},8,["class","onMousedown"])):In("v-if",!0),xt(lr)?(Kt(),Cn(xt(Js),{key:2,class:kn([xt(he).e("icon"),xt(he).e("password")]),onClick:Vt},{default:An(()=>[(Kt(),Cn(mo(xt(Cr))))]),_:1},8,["class"])):In("v-if",!0),xt(qr)?(Kt(),Nr("span",{key:3,class:kn(xt(he).e("count"))},[Wr("span",{class:kn(xt(he).e("count-inner"))},Vs(xt(ur))+" / "+Vs(Ye.maxlength),3)],2)):In("v-if",!0),xt(mt)&&xt(nr)&&xt(dt)?(Kt(),Cn(xt(Js),{key:4,class:kn([xt(he).e("icon"),xt(he).e("validateIcon"),xt(he).is("loading",xt(mt)==="validating")])},{default:An(()=>[(Kt(),Cn(mo(xt(nr))))]),_:1},8,["class"])):In("v-if",!0)],2)],2)):In("v-if",!0)],2),In(" append slot "),Ye.$slots.append?(Kt(),Nr("div",{key:1,class:kn(xt(he).be("group","append"))},[la(Ye.$slots,"append")],2)):In("v-if",!0)],64)):(Kt(),Nr(ti,{key:1},[In(" textarea "),Wr("textarea",ys({id:xt(ee),ref_key:"textarea",ref:je,class:[xt(_e).e("inner"),xt(he).is("focus",xt(Et))]},xt(R),{minlength:Ye.minlength,maxlength:Ye.maxlength,tabindex:Ye.tabindex,disabled:xt(de),readonly:Ye.readonly,autocomplete:Ye.autocomplete,style:xt(Tr),"aria-label":Ye.ariaLabel,placeholder:Ye.placeholder,form:Ye.form,autofocus:Ye.autofocus,rows:Ye.rows,role:Ye.containerRole,onCompositionstart:xt(Ve),onCompositionupdate:xt(Ae),onCompositionend:xt(wt),onInput:te,onFocus:xt(pt),onBlur:xt(lt),onChange:vn,onKeydown:Gt}),null,16,["id","minlength","maxlength","tabindex","disabled","readonly","autocomplete","aria-label","placeholder","form","autofocus","rows","role","onCompositionstart","onCompositionupdate","onCompositionend","onFocus","onBlur"]),xt(qr)?(Kt(),Nr("span",{key:0,style:Vu(ht.value),class:kn(xt(he).e("count"))},Vs(xt(ur))+" / "+Vs(Ye.maxlength),7)):In("v-if",!0)],64))],38))}});var PV=Xm(CV,[["__file","input.vue"]]);const RV=o0(PV),v3=Symbol("buttonGroupContextKey"),DV=({from:r,replacement:l,scope:p,version:v,ref:A,type:R="API"},D)=>{Tn(()=>xt(D),i=>{},{immediate:!0})},zV=(r,l)=>{DV({from:"type.text",replacement:"link",version:"3.0.0",scope:"props",ref:"https://element-plus.org/en-US/component/button.html#button-attributes"},et(()=>r.type==="text"));const p=Pn(v3,void 0),v=hb("button"),{form:A}=pb(),R=mb(et(()=>p==null?void 0:p.size)),D=a0(),i=dn(),G=IM(),W=et(()=>r.type||(p==null?void 0:p.type)||""),H=et(()=>{var he,_e,Ie;return(Ie=(_e=r.autoInsertSpace)!=null?_e:(he=v.value)==null?void 0:he.autoInsertSpace)!=null?Ie:!1}),ee=et(()=>r.tag==="button"?{ariaDisabled:D.value||r.loading,disabled:D.value||r.loading,autofocus:r.autofocus,type:r.nativeType}:{}),ne=et(()=>{var he;const _e=(he=G.default)==null?void 0:he.call(G);if(H.value&&(_e==null?void 0:_e.length)===1){const Ie=_e[0];if((Ie==null?void 0:Ie.type)===Ud){const je=Ie.children;return new RegExp("^\\p{Unified_Ideograph}{2}$","u").test(je.trim())}}return!1});return{_disabled:D,_size:R,_type:W,_ref:i,_props:ee,shouldAddSpace:ne,handleClick:he=>{if(D.value||r.loading){he.stopPropagation();return}r.nativeType==="reset"&&(A==null||A.resetFields()),l("click",he)}}},LV=["default","primary","success","warning","info","danger","text",""],OV=["button","submit","reset"],d1=Jd({size:i3,disabled:Boolean,type:{type:String,values:LV,default:""},icon:{type:yc},nativeType:{type:String,values:OV,default:"button"},loading:Boolean,loadingIcon:{type:yc,default:()=>db},plain:Boolean,text:Boolean,link:Boolean,bg:Boolean,autofocus:Boolean,round:Boolean,circle:Boolean,color:String,dark:Boolean,autoInsertSpace:{type:Boolean,default:void 0},tag:{type:Nu([String,Object]),default:"button"}}),kV={click:r=>r instanceof MouseEvent};function is(r,l){FV(r)&&(r="100%");var p=BV(r);return r=l===360?r:Math.min(l,Math.max(0,parseFloat(r))),p&&(r=parseInt(String(r*l),10)/100),Math.abs(r-l)<1e-6?1:(l===360?r=(r<0?r%l+l:r%l)/parseFloat(String(l)):r=r%l/parseFloat(String(l)),r)}function Hg(r){return Math.min(1,Math.max(0,r))}function FV(r){return typeof r=="string"&&r.indexOf(".")!==-1&&parseFloat(r)===1}function BV(r){return typeof r=="string"&&r.indexOf("%")!==-1}function x3(r){return r=parseFloat(r),(isNaN(r)||r<0||r>1)&&(r=1),r}function qg(r){return r<=1?"".concat(Number(r)*100,"%"):r}function zu(r){return r.length===1?"0"+r:String(r)}function NV(r,l,p){return{r:is(r,255)*255,g:is(l,255)*255,b:is(p,255)*255}}function fA(r,l,p){r=is(r,255),l=is(l,255),p=is(p,255);var v=Math.max(r,l,p),A=Math.min(r,l,p),R=0,D=0,i=(v+A)/2;if(v===A)D=0,R=0;else{var G=v-A;switch(D=i>.5?G/(2-v-A):G/(v+A),v){case r:R=(l-p)/G+(l<p?6:0);break;case l:R=(p-r)/G+2;break;case p:R=(r-l)/G+4;break}R/=6}return{h:R,s:D,l:i}}function Dx(r,l,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?r+(l-r)*(6*p):p<1/2?l:p<2/3?r+(l-r)*(2/3-p)*6:r}function VV(r,l,p){var v,A,R;if(r=is(r,360),l=is(l,100),p=is(p,100),l===0)A=p,R=p,v=p;else{var D=p<.5?p*(1+l):p+l-p*l,i=2*p-D;v=Dx(i,D,r+1/3),A=Dx(i,D,r),R=Dx(i,D,r-1/3)}return{r:v*255,g:A*255,b:R*255}}function pA(r,l,p){r=is(r,255),l=is(l,255),p=is(p,255);var v=Math.max(r,l,p),A=Math.min(r,l,p),R=0,D=v,i=v-A,G=v===0?0:i/v;if(v===A)R=0;else{switch(v){case r:R=(l-p)/i+(l<p?6:0);break;case l:R=(p-r)/i+2;break;case p:R=(r-l)/i+4;break}R/=6}return{h:R,s:G,v:D}}function UV(r,l,p){r=is(r,360)*6,l=is(l,100),p=is(p,100);var v=Math.floor(r),A=r-v,R=p*(1-l),D=p*(1-A*l),i=p*(1-(1-A)*l),G=v%6,W=[p,D,R,R,i,p][G],H=[i,p,p,D,R,R][G],ee=[R,R,i,p,p,D][G];return{r:W*255,g:H*255,b:ee*255}}function mA(r,l,p,v){var A=[zu(Math.round(r).toString(16)),zu(Math.round(l).toString(16)),zu(Math.round(p).toString(16))];return v&&A[0].startsWith(A[0].charAt(1))&&A[1].startsWith(A[1].charAt(1))&&A[2].startsWith(A[2].charAt(1))?A[0].charAt(0)+A[1].charAt(0)+A[2].charAt(0):A.join("")}function jV(r,l,p,v,A){var R=[zu(Math.round(r).toString(16)),zu(Math.round(l).toString(16)),zu(Math.round(p).toString(16)),zu($V(v))];return A&&R[0].startsWith(R[0].charAt(1))&&R[1].startsWith(R[1].charAt(1))&&R[2].startsWith(R[2].charAt(1))&&R[3].startsWith(R[3].charAt(1))?R[0].charAt(0)+R[1].charAt(0)+R[2].charAt(0)+R[3].charAt(0):R.join("")}function $V(r){return Math.round(parseFloat(r)*255).toString(16)}function _A(r){return po(r)/255}function po(r){return parseInt(r,16)}function GV(r){return{r:r>>16,g:(r&65280)>>8,b:r&255}}var f1={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function HV(r){var l={r:0,g:0,b:0},p=1,v=null,A=null,R=null,D=!1,i=!1;return typeof r=="string"&&(r=ZV(r)),typeof r=="object"&&(ml(r.r)&&ml(r.g)&&ml(r.b)?(l=NV(r.r,r.g,r.b),D=!0,i=String(r.r).substr(-1)==="%"?"prgb":"rgb"):ml(r.h)&&ml(r.s)&&ml(r.v)?(v=qg(r.s),A=qg(r.v),l=UV(r.h,v,A),D=!0,i="hsv"):ml(r.h)&&ml(r.s)&&ml(r.l)&&(v=qg(r.s),R=qg(r.l),l=VV(r.h,v,R),D=!0,i="hsl"),Object.prototype.hasOwnProperty.call(r,"a")&&(p=r.a)),p=x3(p),{ok:D,format:r.format||i,r:Math.min(255,Math.max(l.r,0)),g:Math.min(255,Math.max(l.g,0)),b:Math.min(255,Math.max(l.b,0)),a:p}}var qV="[-\\+]?\\d+%?",WV="[-\\+]?\\d*\\.\\d+%?",vc="(?:".concat(WV,")|(?:").concat(qV,")"),zx="[\\s|\\(]+(".concat(vc,")[,|\\s]+(").concat(vc,")[,|\\s]+(").concat(vc,")\\s*\\)?"),Lx="[\\s|\\(]+(".concat(vc,")[,|\\s]+(").concat(vc,")[,|\\s]+(").concat(vc,")[,|\\s]+(").concat(vc,")\\s*\\)?"),aa={CSS_UNIT:new RegExp(vc),rgb:new RegExp("rgb"+zx),rgba:new RegExp("rgba"+Lx),hsl:new RegExp("hsl"+zx),hsla:new RegExp("hsla"+Lx),hsv:new RegExp("hsv"+zx),hsva:new RegExp("hsva"+Lx),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function ZV(r){if(r=r.trim().toLowerCase(),r.length===0)return!1;var l=!1;if(f1[r])r=f1[r],l=!0;else if(r==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var p=aa.rgb.exec(r);return p?{r:p[1],g:p[2],b:p[3]}:(p=aa.rgba.exec(r),p?{r:p[1],g:p[2],b:p[3],a:p[4]}:(p=aa.hsl.exec(r),p?{h:p[1],s:p[2],l:p[3]}:(p=aa.hsla.exec(r),p?{h:p[1],s:p[2],l:p[3],a:p[4]}:(p=aa.hsv.exec(r),p?{h:p[1],s:p[2],v:p[3]}:(p=aa.hsva.exec(r),p?{h:p[1],s:p[2],v:p[3],a:p[4]}:(p=aa.hex8.exec(r),p?{r:po(p[1]),g:po(p[2]),b:po(p[3]),a:_A(p[4]),format:l?"name":"hex8"}:(p=aa.hex6.exec(r),p?{r:po(p[1]),g:po(p[2]),b:po(p[3]),format:l?"name":"hex"}:(p=aa.hex4.exec(r),p?{r:po(p[1]+p[1]),g:po(p[2]+p[2]),b:po(p[3]+p[3]),a:_A(p[4]+p[4]),format:l?"name":"hex8"}:(p=aa.hex3.exec(r),p?{r:po(p[1]+p[1]),g:po(p[2]+p[2]),b:po(p[3]+p[3]),format:l?"name":"hex"}:!1)))))))))}function ml(r){return!!aa.CSS_UNIT.exec(String(r))}var XV=function(){function r(l,p){l===void 0&&(l=""),p===void 0&&(p={});var v;if(l instanceof r)return l;typeof l=="number"&&(l=GV(l)),this.originalInput=l;var A=HV(l);this.originalInput=l,this.r=A.r,this.g=A.g,this.b=A.b,this.a=A.a,this.roundA=Math.round(100*this.a)/100,this.format=(v=p.format)!==null&&v!==void 0?v:A.format,this.gradientType=p.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=A.ok}return r.prototype.isDark=function(){return this.getBrightness()<128},r.prototype.isLight=function(){return!this.isDark()},r.prototype.getBrightness=function(){var l=this.toRgb();return(l.r*299+l.g*587+l.b*114)/1e3},r.prototype.getLuminance=function(){var l=this.toRgb(),p,v,A,R=l.r/255,D=l.g/255,i=l.b/255;return R<=.03928?p=R/12.92:p=Math.pow((R+.055)/1.055,2.4),D<=.03928?v=D/12.92:v=Math.pow((D+.055)/1.055,2.4),i<=.03928?A=i/12.92:A=Math.pow((i+.055)/1.055,2.4),.2126*p+.7152*v+.0722*A},r.prototype.getAlpha=function(){return this.a},r.prototype.setAlpha=function(l){return this.a=x3(l),this.roundA=Math.round(100*this.a)/100,this},r.prototype.isMonochrome=function(){var l=this.toHsl().s;return l===0},r.prototype.toHsv=function(){var l=pA(this.r,this.g,this.b);return{h:l.h*360,s:l.s,v:l.v,a:this.a}},r.prototype.toHsvString=function(){var l=pA(this.r,this.g,this.b),p=Math.round(l.h*360),v=Math.round(l.s*100),A=Math.round(l.v*100);return this.a===1?"hsv(".concat(p,", ").concat(v,"%, ").concat(A,"%)"):"hsva(".concat(p,", ").concat(v,"%, ").concat(A,"%, ").concat(this.roundA,")")},r.prototype.toHsl=function(){var l=fA(this.r,this.g,this.b);return{h:l.h*360,s:l.s,l:l.l,a:this.a}},r.prototype.toHslString=function(){var l=fA(this.r,this.g,this.b),p=Math.round(l.h*360),v=Math.round(l.s*100),A=Math.round(l.l*100);return this.a===1?"hsl(".concat(p,", ").concat(v,"%, ").concat(A,"%)"):"hsla(".concat(p,", ").concat(v,"%, ").concat(A,"%, ").concat(this.roundA,")")},r.prototype.toHex=function(l){return l===void 0&&(l=!1),mA(this.r,this.g,this.b,l)},r.prototype.toHexString=function(l){return l===void 0&&(l=!1),"#"+this.toHex(l)},r.prototype.toHex8=function(l){return l===void 0&&(l=!1),jV(this.r,this.g,this.b,this.a,l)},r.prototype.toHex8String=function(l){return l===void 0&&(l=!1),"#"+this.toHex8(l)},r.prototype.toHexShortString=function(l){return l===void 0&&(l=!1),this.a===1?this.toHexString(l):this.toHex8String(l)},r.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},r.prototype.toRgbString=function(){var l=Math.round(this.r),p=Math.round(this.g),v=Math.round(this.b);return this.a===1?"rgb(".concat(l,", ").concat(p,", ").concat(v,")"):"rgba(".concat(l,", ").concat(p,", ").concat(v,", ").concat(this.roundA,")")},r.prototype.toPercentageRgb=function(){var l=function(p){return"".concat(Math.round(is(p,255)*100),"%")};return{r:l(this.r),g:l(this.g),b:l(this.b),a:this.a}},r.prototype.toPercentageRgbString=function(){var l=function(p){return Math.round(is(p,255)*100)};return this.a===1?"rgb(".concat(l(this.r),"%, ").concat(l(this.g),"%, ").concat(l(this.b),"%)"):"rgba(".concat(l(this.r),"%, ").concat(l(this.g),"%, ").concat(l(this.b),"%, ").concat(this.roundA,")")},r.prototype.toName=function(){if(this.a===0)return"transparent";if(this.a<1)return!1;for(var l="#"+mA(this.r,this.g,this.b,!1),p=0,v=Object.entries(f1);p<v.length;p++){var A=v[p],R=A[0],D=A[1];if(l===D)return R}return!1},r.prototype.toString=function(l){var p=!!l;l=l??this.format;var v=!1,A=this.a<1&&this.a>=0,R=!p&&A&&(l.startsWith("hex")||l==="name");return R?l==="name"&&this.a===0?this.toName():this.toRgbString():(l==="rgb"&&(v=this.toRgbString()),l==="prgb"&&(v=this.toPercentageRgbString()),(l==="hex"||l==="hex6")&&(v=this.toHexString()),l==="hex3"&&(v=this.toHexString(!0)),l==="hex4"&&(v=this.toHex8String(!0)),l==="hex8"&&(v=this.toHex8String()),l==="name"&&(v=this.toName()),l==="hsl"&&(v=this.toHslString()),l==="hsv"&&(v=this.toHsvString()),v||this.toHexString())},r.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},r.prototype.clone=function(){return new r(this.toString())},r.prototype.lighten=function(l){l===void 0&&(l=10);var p=this.toHsl();return p.l+=l/100,p.l=Hg(p.l),new r(p)},r.prototype.brighten=function(l){l===void 0&&(l=10);var p=this.toRgb();return p.r=Math.max(0,Math.min(255,p.r-Math.round(255*-(l/100)))),p.g=Math.max(0,Math.min(255,p.g-Math.round(255*-(l/100)))),p.b=Math.max(0,Math.min(255,p.b-Math.round(255*-(l/100)))),new r(p)},r.prototype.darken=function(l){l===void 0&&(l=10);var p=this.toHsl();return p.l-=l/100,p.l=Hg(p.l),new r(p)},r.prototype.tint=function(l){return l===void 0&&(l=10),this.mix("white",l)},r.prototype.shade=function(l){return l===void 0&&(l=10),this.mix("black",l)},r.prototype.desaturate=function(l){l===void 0&&(l=10);var p=this.toHsl();return p.s-=l/100,p.s=Hg(p.s),new r(p)},r.prototype.saturate=function(l){l===void 0&&(l=10);var p=this.toHsl();return p.s+=l/100,p.s=Hg(p.s),new r(p)},r.prototype.greyscale=function(){return this.desaturate(100)},r.prototype.spin=function(l){var p=this.toHsl(),v=(p.h+l)%360;return p.h=v<0?360+v:v,new r(p)},r.prototype.mix=function(l,p){p===void 0&&(p=50);var v=this.toRgb(),A=new r(l).toRgb(),R=p/100,D={r:(A.r-v.r)*R+v.r,g:(A.g-v.g)*R+v.g,b:(A.b-v.b)*R+v.b,a:(A.a-v.a)*R+v.a};return new r(D)},r.prototype.analogous=function(l,p){l===void 0&&(l=6),p===void 0&&(p=30);var v=this.toHsl(),A=360/p,R=[this];for(v.h=(v.h-(A*l>>1)+720)%360;--l;)v.h=(v.h+A)%360,R.push(new r(v));return R},r.prototype.complement=function(){var l=this.toHsl();return l.h=(l.h+180)%360,new r(l)},r.prototype.monochromatic=function(l){l===void 0&&(l=6);for(var p=this.toHsv(),v=p.h,A=p.s,R=p.v,D=[],i=1/l;l--;)D.push(new r({h:v,s:A,v:R})),R=(R+i)%1;return D},r.prototype.splitcomplement=function(){var l=this.toHsl(),p=l.h;return[this,new r({h:(p+72)%360,s:l.s,l:l.l}),new r({h:(p+216)%360,s:l.s,l:l.l})]},r.prototype.onBackground=function(l){var p=this.toRgb(),v=new r(l).toRgb(),A=p.a+v.a*(1-p.a);return new r({r:(p.r*p.a+v.r*v.a*(1-p.a))/A,g:(p.g*p.a+v.g*v.a*(1-p.a))/A,b:(p.b*p.a+v.b*v.a*(1-p.a))/A,a:A})},r.prototype.triad=function(){return this.polyad(3)},r.prototype.tetrad=function(){return this.polyad(4)},r.prototype.polyad=function(l){for(var p=this.toHsl(),v=p.h,A=[this],R=360/l,D=1;D<l;D++)A.push(new r({h:(v+D*R)%360,s:p.s,l:p.l}));return A},r.prototype.equals=function(l){return this.toRgbString()===new r(l).toRgbString()},r}();function cc(r,l=20){return r.mix("#141414",l).toString()}function KV(r){const l=a0(),p=Tc("button");return et(()=>{let v={},A=r.color;if(A){const R=A.match(/var\((.*?)\)/);R&&(A=window.getComputedStyle(window.document.documentElement).getPropertyValue(R[1]));const D=new XV(A),i=r.dark?D.tint(20).toString():cc(D,20);if(r.plain)v=p.cssVarBlock({"bg-color":r.dark?cc(D,90):D.tint(90).toString(),"text-color":A,"border-color":r.dark?cc(D,50):D.tint(50).toString(),"hover-text-color":`var(${p.cssVarName("color-white")})`,"hover-bg-color":A,"hover-border-color":A,"active-bg-color":i,"active-text-color":`var(${p.cssVarName("color-white")})`,"active-border-color":i}),l.value&&(v[p.cssVarBlockName("disabled-bg-color")]=r.dark?cc(D,90):D.tint(90).toString(),v[p.cssVarBlockName("disabled-text-color")]=r.dark?cc(D,50):D.tint(50).toString(),v[p.cssVarBlockName("disabled-border-color")]=r.dark?cc(D,80):D.tint(80).toString());else{const G=r.dark?cc(D,30):D.tint(30).toString(),W=D.isDark()?`var(${p.cssVarName("color-white")})`:`var(${p.cssVarName("color-black")})`;if(v=p.cssVarBlock({"bg-color":A,"text-color":W,"border-color":A,"hover-bg-color":G,"hover-text-color":W,"hover-border-color":G,"active-bg-color":i,"active-border-color":i}),l.value){const H=r.dark?cc(D,50):D.tint(50).toString();v[p.cssVarBlockName("disabled-bg-color")]=H,v[p.cssVarBlockName("disabled-text-color")]=r.dark?"rgba(255, 255, 255, 0.5)":`var(${p.cssVarName("color-white")})`,v[p.cssVarBlockName("disabled-border-color")]=H}}}return v})}const YV=pn({name:"ElButton"}),JV=pn({...YV,props:d1,emits:kV,setup(r,{expose:l,emit:p}){const v=r,A=KV(v),R=Tc("button"),{_ref:D,_size:i,_type:G,_disabled:W,_props:H,shouldAddSpace:ee,handleClick:ne}=zV(v,p),de=et(()=>[R.b(),R.m(G.value),R.m(i.value),R.is("disabled",W.value),R.is("loading",v.loading),R.is("plain",v.plain),R.is("round",v.round),R.is("circle",v.circle),R.is("text",v.text),R.is("link",v.link),R.is("has-bg",v.bg)]);return l({ref:D,size:i,type:G,disabled:W,shouldAddSpace:ee}),(he,_e)=>(Kt(),Cn(mo(he.tag),ys({ref_key:"_ref",ref:D},xt(H),{class:xt(de),style:xt(A),onClick:xt(ne)}),{default:An(()=>[he.loading?(Kt(),Nr(ti,{key:0},[he.$slots.loading?la(he.$slots,"loading",{key:0}):(Kt(),Cn(xt(Js),{key:1,class:kn(xt(R).is("loading"))},{default:An(()=>[(Kt(),Cn(mo(he.loadingIcon)))]),_:1},8,["class"]))],64)):he.icon||he.$slots.icon?(Kt(),Cn(xt(Js),{key:1},{default:An(()=>[he.icon?(Kt(),Cn(mo(he.icon),{key:0})):la(he.$slots,"icon",{key:1})]),_:3})):In("v-if",!0),he.$slots.default?(Kt(),Nr("span",{key:2,class:kn({[xt(R).em("text","expand")]:xt(ee)})},[la(he.$slots,"default")],2)):In("v-if",!0)]),_:3},16,["class","style","onClick"]))}});var QV=Xm(JV,[["__file","button.vue"]]);const e8={size:d1.size,type:d1.type},t8=pn({name:"ElButtonGroup"}),r8=pn({...t8,props:e8,setup(r){const l=r;vo(v3,Ki({size:Si(l,"size"),type:Si(l,"type")}));const p=Tc("button");return(v,A)=>(Kt(),Nr("div",{class:kn(xt(p).b("group"))},[la(v.$slots,"default")],2))}});var b3=Xm(r8,[["__file","button-group.vue"]]);const n8=o0(QV,{ButtonGroup:b3});AN(b3);const i8=r=>["",...n3].includes(r),s8=Jd({modelValue:{type:[Boolean,String,Number],default:!1},disabled:Boolean,loading:Boolean,size:{type:String,validator:i8},width:{type:[String,Number],default:""},inlinePrompt:Boolean,inactiveActionIcon:{type:yc},activeActionIcon:{type:yc},activeIcon:{type:yc},inactiveIcon:{type:yc},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},beforeChange:{type:Nu(Function)},id:String,tabindex:{type:[String,Number]},...m3(["ariaLabel"])}),o8={[Nd]:r=>oy(r)||qn(r)||Bu(r),[Im]:r=>oy(r)||qn(r)||Bu(r),[Cm]:r=>oy(r)||qn(r)||Bu(r)},w3="ElSwitch",a8=pn({name:w3}),l8=pn({...a8,props:s8,emits:o8,setup(r,{expose:l,emit:p}){const v=r,{formItem:A}=pb(),R=mb(),D=Tc("switch"),{inputId:i}=g3(v,{formItemContext:A}),G=a0(et(()=>v.loading)),W=dn(v.modelValue!==!1),H=dn(),ee=dn(),ne=et(()=>[D.b(),D.m(R.value),D.is("disabled",G.value),D.is("checked",je.value)]),de=et(()=>[D.e("label"),D.em("label","left"),D.is("active",!je.value)]),he=et(()=>[D.e("label"),D.em("label","right"),D.is("active",je.value)]),_e=et(()=>({width:l3(v.width)}));Tn(()=>v.modelValue,()=>{W.value=!0});const Ie=et(()=>W.value?v.modelValue:!1),je=et(()=>Ie.value===v.activeValue);[v.activeValue,v.inactiveValue].includes(Ie.value)||(p(Nd,v.inactiveValue),p(Im,v.inactiveValue),p(Cm,v.inactiveValue)),Tn(je,ft=>{var bt;H.value.checked=ft,v.validateEvent&&((bt=A==null?void 0:A.validate)==null||bt.call(A,"change").catch(Je=>void 0))});const vt=()=>{const ft=je.value?v.inactiveValue:v.activeValue;p(Nd,ft),p(Im,ft),p(Cm,ft),Bs(()=>{H.value.checked=je.value})},Pt=()=>{if(G.value)return;const{beforeChange:ft}=v;if(!ft){vt();return}const bt=ft();[ay(bt),oy(bt)].includes(!0)||fN(w3,"beforeChange must return type `Promise<boolean>` or `boolean`"),ay(bt)?bt.then(Et=>{Et&&vt()}).catch(Et=>{}):bt&&vt()},ht=()=>{var ft,bt;(bt=(ft=H.value)==null?void 0:ft.focus)==null||bt.call(ft)};return fa(()=>{H.value.checked=je.value}),l({focus:ht,checked:je}),(ft,bt)=>(Kt(),Nr("div",{class:kn(xt(ne)),onClick:lI(Pt,["prevent"])},[Wr("input",{id:xt(i),ref_key:"input",ref:H,class:kn(xt(D).e("input")),type:"checkbox",role:"switch","aria-checked":xt(je),"aria-disabled":xt(G),"aria-label":ft.ariaLabel,name:ft.name,"true-value":ft.activeValue,"false-value":ft.inactiveValue,disabled:xt(G),tabindex:ft.tabindex,onChange:vt,onKeydown:hL(Pt,["enter"])},null,42,["id","aria-checked","aria-disabled","aria-label","name","true-value","false-value","disabled","tabindex","onKeydown"]),!ft.inlinePrompt&&(ft.inactiveIcon||ft.inactiveText)?(Kt(),Nr("span",{key:0,class:kn(xt(de))},[ft.inactiveIcon?(Kt(),Cn(xt(Js),{key:0},{default:An(()=>[(Kt(),Cn(mo(ft.inactiveIcon)))]),_:1})):In("v-if",!0),!ft.inactiveIcon&&ft.inactiveText?(Kt(),Nr("span",{key:1,"aria-hidden":xt(je)},Vs(ft.inactiveText),9,["aria-hidden"])):In("v-if",!0)],2)):In("v-if",!0),Wr("span",{ref_key:"core",ref:ee,class:kn(xt(D).e("core")),style:Vu(xt(_e))},[ft.inlinePrompt?(Kt(),Nr("div",{key:0,class:kn(xt(D).e("inner"))},[ft.activeIcon||ft.inactiveIcon?(Kt(),Cn(xt(Js),{key:0,class:kn(xt(D).is("icon"))},{default:An(()=>[(Kt(),Cn(mo(xt(je)?ft.activeIcon:ft.inactiveIcon)))]),_:1},8,["class"])):ft.activeText||ft.inactiveText?(Kt(),Nr("span",{key:1,class:kn(xt(D).is("text")),"aria-hidden":!xt(je)},Vs(xt(je)?ft.activeText:ft.inactiveText),11,["aria-hidden"])):In("v-if",!0)],2)):In("v-if",!0),Wr("div",{class:kn(xt(D).e("action"))},[ft.loading?(Kt(),Cn(xt(Js),{key:0,class:kn(xt(D).is("loading"))},{default:An(()=>[st(xt(db))]),_:1},8,["class"])):xt(je)?la(ft.$slots,"active-action",{key:1},()=>[ft.activeActionIcon?(Kt(),Cn(xt(Js),{key:0},{default:An(()=>[(Kt(),Cn(mo(ft.activeActionIcon)))]),_:1})):In("v-if",!0)]):xt(je)?In("v-if",!0):la(ft.$slots,"inactive-action",{key:2},()=>[ft.inactiveActionIcon?(Kt(),Cn(xt(Js),{key:0},{default:An(()=>[(Kt(),Cn(mo(ft.inactiveActionIcon)))]),_:1})):In("v-if",!0)])],2)],6),!ft.inlinePrompt&&(ft.activeIcon||ft.activeText)?(Kt(),Nr("span",{key:1,class:kn(xt(he))},[ft.activeIcon?(Kt(),Cn(xt(Js),{key:0},{default:An(()=>[(Kt(),Cn(mo(ft.activeIcon)))]),_:1})):In("v-if",!0),!ft.activeIcon&&ft.activeText?(Kt(),Nr("span",{key:1,"aria-hidden":!xt(je)},Vs(ft.activeText),9,["aria-hidden"])):In("v-if",!0)],2)):In("v-if",!0)],10,["onClick"]))}});var c8=Xm(l8,[["__file","switch.vue"]]);const u8=o0(c8);function h8(r){return{aspectStyles:et(()=>{const l=Number(r.aspectRatio);return l?{paddingBottom:String(1/l*100)+"%"}:void 0})}}const T3=ln({aspectRatio:[String,Number],contentClass:null,inline:Boolean,...Ei(),...Zd()},"VResponsive"),gA=si()({name:"VResponsive",props:T3(),setup(r,l){let{slots:p}=l;const{aspectStyles:v}=h8(r),{dimensionStyles:A}=Xd(r);return Bi(()=>{var R;return st("div",{class:["v-responsive",{"v-responsive--inline":r.inline},r.class],style:[A.value,r.style]},[st("div",{class:"v-responsive__sizer",style:v.value},null),(R=p.additional)==null?void 0:R.call(p),p.default&&st("div",{class:["v-responsive__content",r.contentClass]},[p.default()])])}),{}}}),d8=ln({transition:{type:[Boolean,String,Object],default:"fade-transition",validator:r=>r!==!0}},"transition"),Wg=(r,l)=>{let{slots:p}=l;const{transition:v,disabled:A,group:R,...D}=r,{component:i=R?U1:Om,...G}=typeof v=="object"?v:{};return bl(i,ys(typeof v=="string"?{name:A?"":v}:G,typeof v=="string"?{}:Object.fromEntries(Object.entries({disabled:A,group:R}).filter(W=>{let[H,ee]=W;return ee!==void 0})),D),p)};function f8(r,l){if(!W1)return;const p=l.modifiers||{},v=l.value,{handler:A,options:R}=typeof v=="object"?v:{handler:v,options:{}},D=new IntersectionObserver(function(){var ee;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],G=arguments.length>1?arguments[1]:void 0;const W=(ee=r._observe)==null?void 0:ee[l.instance.$.uid];if(!W)return;const H=i.some(ne=>ne.isIntersecting);A&&(!p.quiet||W.init)&&(!p.once||H||W.init)&&A(H,i,G),H&&p.once?S3(r,l):W.init=!0},R);r._observe=Object(r._observe),r._observe[l.instance.$.uid]={init:!1,observer:D},D.observe(r)}function S3(r,l){var v;const p=(v=r._observe)==null?void 0:v[l.instance.$.uid];p&&(p.observer.unobserve(r),delete r._observe[l.instance.$.uid])}const p8={mounted:f8,unmounted:S3},m8=ln({absolute:Boolean,alt:String,cover:Boolean,color:String,draggable:{type:[Boolean,String],default:void 0},eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},crossorigin:String,referrerpolicy:String,srcset:String,position:String,...T3(),...Ei(),...Rc(),...d8()},"VImg"),l0=si()({name:"VImg",directives:{intersect:p8},props:m8(),emits:{loadstart:r=>!0,load:r=>!0,error:r=>!0},setup(r,l){let{emit:p,slots:v}=l;const{backgroundColorClasses:A,backgroundColorStyles:R}=Cd(Si(r,"color")),{roundedClasses:D}=Dc(r),i=Gs("VImg"),G=Vn(""),W=dn(),H=Vn(r.eager?"loading":"idle"),ee=Vn(),ne=Vn(),de=et(()=>r.src&&typeof r.src=="object"?{src:r.src.src,srcset:r.srcset||r.src.srcset,lazySrc:r.lazySrc||r.src.lazySrc,aspect:Number(r.aspectRatio||r.src.aspect||0)}:{src:r.src,srcset:r.srcset,lazySrc:r.lazySrc,aspect:Number(r.aspectRatio||0)}),he=et(()=>de.value.aspect||ee.value/ne.value||0);Tn(()=>r.src,()=>{_e(H.value!=="idle")}),Tn(he,(mt,nr)=>{!mt&&nr&&W.value&&ht(W.value)}),SM(()=>_e());function _e(mt){if(!(r.eager&&mt)&&!(W1&&!mt&&!r.eager)){if(H.value="loading",de.value.lazySrc){const nr=new Image;nr.src=de.value.lazySrc,ht(nr,null)}de.value.src&&Bs(()=>{var nr;p("loadstart",((nr=W.value)==null?void 0:nr.currentSrc)||de.value.src),setTimeout(()=>{var Cr;if(!i.isUnmounted)if((Cr=W.value)!=null&&Cr.complete){if(W.value.naturalWidth||je(),H.value==="error")return;he.value||ht(W.value,null),H.value==="loading"&&Ie()}else he.value||ht(W.value),vt()})})}}function Ie(){var mt;i.isUnmounted||(vt(),ht(W.value),H.value="loaded",p("load",((mt=W.value)==null?void 0:mt.currentSrc)||de.value.src))}function je(){var mt;i.isUnmounted||(H.value="error",p("error",((mt=W.value)==null?void 0:mt.currentSrc)||de.value.src))}function vt(){const mt=W.value;mt&&(G.value=mt.currentSrc||mt.src)}let Pt=-1;Ua(()=>{clearTimeout(Pt)});function ht(mt){let nr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const Cr=()=>{if(clearTimeout(Pt),i.isUnmounted)return;const{naturalHeight:Zt,naturalWidth:Tr}=mt;Zt||Tr?(ee.value=Tr,ne.value=Zt):!mt.complete&&H.value==="loading"&&nr!=null?Pt=window.setTimeout(Cr,nr):(mt.currentSrc.endsWith(".svg")||mt.currentSrc.startsWith("data:image/svg+xml"))&&(ee.value=1,ne.value=1)};Cr()}const ft=et(()=>({"v-img__img--cover":r.cover,"v-img__img--contain":!r.cover})),bt=()=>{var Cr;if(!de.value.src||H.value==="idle")return null;const mt=st("img",{class:["v-img__img",ft.value],style:{objectPosition:r.position},crossorigin:r.crossorigin,src:de.value.src,srcset:de.value.srcset,alt:r.alt,referrerpolicy:r.referrerpolicy,draggable:r.draggable,sizes:r.sizes,ref:W,onLoad:Ie,onError:je},null),nr=(Cr=v.sources)==null?void 0:Cr.call(v);return st(Wg,{transition:r.transition,appear:!0},{default:()=>[Dd(nr?st("picture",{class:"v-img__picture"},[nr,mt]):mt,[[nI,H.value==="loaded"]])]})},Je=()=>st(Wg,{transition:r.transition},{default:()=>[de.value.lazySrc&&H.value!=="loaded"&&st("img",{class:["v-img__img","v-img__img--preload",ft.value],style:{objectPosition:r.position},crossorigin:r.crossorigin,src:de.value.lazySrc,alt:r.alt,referrerpolicy:r.referrerpolicy,draggable:r.draggable},null)]}),Et=()=>v.placeholder?st(Wg,{transition:r.transition,appear:!0},{default:()=>[(H.value==="loading"||H.value==="error"&&!v.error)&&st("div",{class:"v-img__placeholder"},[v.placeholder()])]}):null,pt=()=>v.error?st(Wg,{transition:r.transition,appear:!0},{default:()=>[H.value==="error"&&st("div",{class:"v-img__error"},[v.error()])]}):null,lt=()=>r.gradient?st("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${r.gradient})`}},null):null,dt=Vn(!1);{const mt=Tn(he,nr=>{nr&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{dt.value=!0})}),mt())})}return Bi(()=>{const mt=gA.filterProps(r);return Dd(st(gA,ys({class:["v-img",{"v-img--absolute":r.absolute,"v-img--booting":!dt.value},A.value,D.value,r.class],style:[{width:ni(r.width==="auto"?ee.value:r.width)},R.value,r.style]},mt,{aspectRatio:he.value,"aria-label":r.alt,role:r.alt?"img":void 0}),{additional:()=>st(ti,null,[st(bt,null,null),st(Je,null,null),st(lt,null,null),st(Et,null,null),st(pt,null,null)]),default:v.default}),[[O1("intersect"),{handler:_e,options:r.options},null,{once:!0}]])}),{currentSrc:G,image:W,state:H,naturalWidth:ee,naturalHeight:ne}}}),_8=ln({start:Boolean,end:Boolean,icon:Us,image:String,text:String,...Gd(),...Ei(),...qd(),...Rc(),...Hm(),...vs(),...ja(),...Wd({variant:"flat"})},"VAvatar"),Pm=si()({name:"VAvatar",props:_8(),setup(r,l){let{slots:p}=l;const{themeClasses:v}=$a(r),{borderClasses:A}=Hd(r),{colorClasses:R,colorStyles:D,variantClasses:i}=e0(r),{densityClasses:G}=Um(r),{roundedClasses:W}=Dc(r),{sizeClasses:H,sizeStyles:ee}=qm(r);return Bi(()=>st(r.tag,{class:["v-avatar",{"v-avatar--start":r.start,"v-avatar--end":r.end},v.value,A.value,R.value,G.value,W.value,H.value,i.value,r.class],style:[D.value,ee.value,r.style]},{default:()=>[p.default?st(Bo,{key:"content-defaults",defaults:{VImg:{cover:!0,src:r.image},VIcon:{icon:r.icon}}},{default:()=>[p.default()]}):r.image?st(l0,{key:"image",src:r.image,alt:"",cover:!0},null):r.icon?st(Qs,{key:"icon",icon:r.icon},null):r.text,Qy(!1,"v-avatar")]})),{}}}),g8=si()({name:"VCardActions",props:Ei(),setup(r,l){let{slots:p}=l;return Nm({VBtn:{slim:!0,variant:"text"}}),Bi(()=>{var v;return st("div",{class:["v-card-actions",r.class],style:r.style},[(v=p.default)==null?void 0:v.call(p)])}),{}}}),y8=ln({opacity:[Number,String],...Ei(),...vs()},"VCardSubtitle"),v8=si()({name:"VCardSubtitle",props:y8(),setup(r,l){let{slots:p}=l;return Bi(()=>st(r.tag,{class:["v-card-subtitle",r.class],style:[{"--v-card-subtitle-opacity":r.opacity},r.style]},p)),{}}}),x8=QF("v-card-title"),b8=ln({appendAvatar:String,appendIcon:Us,prependAvatar:String,prependIcon:Us,subtitle:{type:[String,Number,Boolean],default:void 0},title:{type:[String,Number,Boolean],default:void 0},...Ei(),...qd()},"VCardItem"),w8=si()({name:"VCardItem",props:b8(),setup(r,l){let{slots:p}=l;return Bi(()=>{var W;const v=!!(r.prependAvatar||r.prependIcon),A=!!(v||p.prepend),R=!!(r.appendAvatar||r.appendIcon),D=!!(R||p.append),i=!!(r.title!=null||p.title),G=!!(r.subtitle!=null||p.subtitle);return st("div",{class:["v-card-item",r.class],style:r.style},[A&&st("div",{key:"prepend",class:"v-card-item__prepend"},[p.prepend?st(Bo,{key:"prepend-defaults",disabled:!v,defaults:{VAvatar:{density:r.density,image:r.prependAvatar},VIcon:{density:r.density,icon:r.prependIcon}}},p.prepend):st(ti,null,[r.prependAvatar&&st(Pm,{key:"prepend-avatar",density:r.density,image:r.prependAvatar},null),r.prependIcon&&st(Qs,{key:"prepend-icon",density:r.density,icon:r.prependIcon},null)])]),st("div",{class:"v-card-item__content"},[i&&st(x8,{key:"title"},{default:()=>{var H;return[((H=p.title)==null?void 0:H.call(p))??Vs(r.title)]}}),G&&st(v8,{key:"subtitle"},{default:()=>{var H;return[((H=p.subtitle)==null?void 0:H.call(p))??Vs(r.subtitle)]}}),(W=p.default)==null?void 0:W.call(p)]),D&&st("div",{key:"append",class:"v-card-item__append"},[p.append?st(Bo,{key:"append-defaults",disabled:!R,defaults:{VAvatar:{density:r.density,image:r.appendAvatar},VIcon:{density:r.density,icon:r.appendIcon}}},p.append):st(ti,null,[r.appendIcon&&st(Qs,{key:"append-icon",density:r.density,icon:r.appendIcon},null),r.appendAvatar&&st(Pm,{key:"append-avatar",density:r.density,image:r.appendAvatar},null)])])])}),{}}}),T8=ln({opacity:[Number,String],...Ei(),...vs()},"VCardText"),E3=si()({name:"VCardText",props:T8(),setup(r,l){let{slots:p}=l;return Bi(()=>st(r.tag,{class:["v-card-text",r.class],style:[{"--v-card-text-opacity":r.opacity},r.style]},p)),{}}}),S8=ln({appendAvatar:String,appendIcon:Us,disabled:Boolean,flat:Boolean,hover:Boolean,image:String,link:{type:Boolean,default:void 0},prependAvatar:String,prependIcon:Us,ripple:{type:[Boolean,Object],default:!0},subtitle:{type:[String,Number,Boolean],default:void 0},text:{type:[String,Number,Boolean],default:void 0},title:{type:[String,Number,Boolean],default:void 0},...Gd(),...Ei(),...qd(),...Zd(),...jm(),...TC(),...Q1(),...EC(),...Rc(),...rb(),...vs(),...ja(),...Wd({variant:"elevated"})},"VCard"),E8=si()({name:"VCard",directives:{Ripple:nb},props:S8(),setup(r,l){let{attrs:p,slots:v}=l;const{themeClasses:A}=$a(r),{borderClasses:R}=Hd(r),{colorClasses:D,colorStyles:i,variantClasses:G}=e0(r),{densityClasses:W}=Um(r),{dimensionStyles:H}=Xd(r),{elevationClasses:ee}=$m(r),{loaderClasses:ne}=SC(r),{locationStyles:de}=eb(r),{positionClasses:he}=AC(r),{roundedClasses:_e}=Dc(r),Ie=tb(r,p),je=et(()=>r.link!==!1&&Ie.isLink.value),vt=et(()=>!r.disabled&&r.link!==!1&&(r.link||Ie.isClickable.value));return Bi(()=>{const Pt=je.value?"a":r.tag,ht=!!(v.title||r.title!=null),ft=!!(v.subtitle||r.subtitle!=null),bt=ht||ft,Je=!!(v.append||r.appendAvatar||r.appendIcon),Et=!!(v.prepend||r.prependAvatar||r.prependIcon),pt=!!(v.image||r.image),lt=bt||Et||Je,dt=!!(v.text||r.text!=null);return Dd(st(Pt,ys({class:["v-card",{"v-card--disabled":r.disabled,"v-card--flat":r.flat,"v-card--hover":r.hover&&!(r.disabled||r.flat),"v-card--link":vt.value},A.value,R.value,D.value,W.value,ee.value,ne.value,he.value,_e.value,G.value,r.class],style:[i.value,H.value,de.value,r.style],onClick:vt.value&&Ie.navigate,tabindex:r.disabled?-1:void 0},Ie.linkProps),{default:()=>{var mt;return[pt&&st("div",{key:"image",class:"v-card__image"},[v.image?st(Bo,{key:"image-defaults",disabled:!r.image,defaults:{VImg:{cover:!0,src:r.image}}},v.image):st(l0,{key:"image-img",cover:!0,src:r.image},null)]),st(A5,{name:"v-card",active:!!r.loading,color:typeof r.loading=="boolean"?void 0:r.loading},{default:v.loader}),lt&&st(w8,{key:"item",prependAvatar:r.prependAvatar,prependIcon:r.prependIcon,title:r.title,subtitle:r.subtitle,appendAvatar:r.appendAvatar,appendIcon:r.appendIcon},{default:v.item,prepend:v.prepend,title:v.title,subtitle:v.subtitle,append:v.append}),dt&&st(E3,{key:"text"},{default:()=>{var nr;return[((nr=v.text)==null?void 0:nr.call(v))??r.text]}}),(mt=v.default)==null?void 0:mt.call(v),v.actions&&st(g8,null,{default:v.actions}),Qy(vt.value,"v-card")]}}),[[O1("ripple"),vt.value&&r.ripple]])}),{}}}),A8=ln({disabled:Boolean,group:Boolean,hideOnLeave:Boolean,leaveAbsolute:Boolean,mode:String,origin:String},"transition");function bo(r,l,p){return si()({name:r,props:A8({mode:p,origin:l}),setup(v,A){let{slots:R}=A;const D={onBeforeEnter(i){v.origin&&(i.style.transformOrigin=v.origin)},onLeave(i){if(v.leaveAbsolute){const{offsetTop:G,offsetLeft:W,offsetWidth:H,offsetHeight:ee}=i;i._transitionInitialStyles={position:i.style.position,top:i.style.top,left:i.style.left,width:i.style.width,height:i.style.height},i.style.position="absolute",i.style.top=`${G}px`,i.style.left=`${W}px`,i.style.width=`${H}px`,i.style.height=`${ee}px`}v.hideOnLeave&&i.style.setProperty("display","none","important")},onAfterLeave(i){if(v.leaveAbsolute&&(i!=null&&i._transitionInitialStyles)){const{position:G,top:W,left:H,width:ee,height:ne}=i._transitionInitialStyles;delete i._transitionInitialStyles,i.style.position=G||"",i.style.top=W||"",i.style.left=H||"",i.style.width=ee||"",i.style.height=ne||""}}};return()=>{const i=v.group?U1:Om;return bl(i,{name:v.disabled?"":r,css:!v.disabled,...v.group?void 0:{mode:v.mode},...v.disabled?{}:D},R.default)}}})}function A3(r,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"in-out";return si()({name:r,props:{mode:{type:String,default:p},disabled:Boolean,group:Boolean},setup(v,A){let{slots:R}=A;const D=v.group?U1:Om;return()=>bl(D,{name:v.disabled?"":r,css:!v.disabled,...v.disabled?{}:l},R.default)}})}function M3(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";const p=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)?"width":"height",v=js(`offset-${p}`);return{onBeforeEnter(D){D._parent=D.parentNode,D._initialStyle={transition:D.style.transition,overflow:D.style.overflow,[p]:D.style[p]}},onEnter(D){const i=D._initialStyle;if(!i)return;D.style.setProperty("transition","none","important"),D.style.overflow="hidden";const G=`${D[v]}px`;D.style[p]="0",D.offsetHeight,D.style.transition=i.transition,r&&D._parent&&D._parent.classList.add(r),requestAnimationFrame(()=>{D.style[p]=G})},onAfterEnter:R,onEnterCancelled:R,onLeave(D){D._initialStyle={transition:"",overflow:D.style.overflow,[p]:D.style[p]},D.style.overflow="hidden",D.style[p]=`${D[v]}px`,D.offsetHeight,requestAnimationFrame(()=>D.style[p]="0")},onAfterLeave:A,onLeaveCancelled:A};function A(D){r&&D._parent&&D._parent.classList.remove(r),R(D)}function R(D){if(!D._initialStyle)return;const i=D._initialStyle[p];D.style.overflow=D._initialStyle.overflow,i!=null&&(D.style[p]=i),delete D._initialStyle}}bo("fab-transition","center center","out-in");bo("dialog-bottom-transition");bo("dialog-top-transition");const yA=bo("fade-transition");bo("scale-transition");bo("scroll-x-transition");bo("scroll-x-reverse-transition");bo("scroll-y-transition");bo("scroll-y-reverse-transition");bo("slide-x-transition");bo("slide-x-reverse-transition");bo("slide-y-transition");bo("slide-y-reverse-transition");A3("expand-transition",M3());const M8=A3("expand-x-transition",M3("",!0)),_b=["sm","md","lg","xl","xxl"],p1=Symbol.for("vuetify:display"),vA={mobileBreakpoint:"lg",thresholds:{xs:0,sm:600,md:960,lg:1280,xl:1920,xxl:2560}},I8=function(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:vA;return gs(vA,r)};function xA(r){return _s&&!r?window.innerWidth:typeof r=="object"&&r.clientWidth||0}function bA(r){return _s&&!r?window.innerHeight:typeof r=="object"&&r.clientHeight||0}function wA(r){const l=_s&&!r?window.navigator.userAgent:"ssr";function p(he){return!!l.match(he)}const v=p(/android/i),A=p(/iphone|ipad|ipod/i),R=p(/cordova/i),D=p(/electron/i),i=p(/chrome/i),G=p(/edge/i),W=p(/firefox/i),H=p(/opera/i),ee=p(/win/i),ne=p(/mac/i),de=p(/linux/i);return{android:v,ios:A,cordova:R,electron:D,chrome:i,edge:G,firefox:W,opera:H,win:ee,mac:ne,linux:de,touch:hF,ssr:l==="ssr"}}function C8(r,l){const{thresholds:p,mobileBreakpoint:v}=I8(r),A=Vn(bA(l)),R=Vn(wA(l)),D=Ki({}),i=Vn(xA(l));function G(){A.value=bA(),i.value=xA()}function W(){G(),R.value=wA()}return Hu(()=>{const H=i.value<p.sm,ee=i.value<p.md&&!H,ne=i.value<p.lg&&!(ee||H),de=i.value<p.xl&&!(ne||ee||H),he=i.value<p.xxl&&!(de||ne||ee||H),_e=i.value>=p.xxl,Ie=H?"xs":ee?"sm":ne?"md":de?"lg":he?"xl":"xxl",je=typeof v=="number"?v:p[v],vt=i.value<je;D.xs=H,D.sm=ee,D.md=ne,D.lg=de,D.xl=he,D.xxl=_e,D.smAndUp=!H,D.mdAndUp=!(H||ee),D.lgAndUp=!(H||ee||ne),D.xlAndUp=!(H||ee||ne||de),D.smAndDown=!(ne||de||he||_e),D.mdAndDown=!(de||he||_e),D.lgAndDown=!(he||_e),D.xlAndDown=!_e,D.name=Ie,D.height=A.value,D.width=i.value,D.mobile=vt,D.mobileBreakpoint=v,D.platform=R.value,D.thresholds=p}),_s&&window.addEventListener("resize",G,{passive:!0}),{...Fy(D),update:W,ssr:!!l}}const I3=ln({mobile:{type:Boolean,default:!1},mobileBreakpoint:[Number,String]},"display");function C3(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{mobile:null},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Pc();const p=Pn(p1);if(!p)throw new Error("Could not find Vuetify display injection");const v=et(()=>r.mobile?!0:typeof r.mobileBreakpoint=="number"?p.width.value<r.mobileBreakpoint:r.mobileBreakpoint?p.width.value<p.thresholds.value[r.mobileBreakpoint]:r.mobile===null?p.mobile.value:!1),A=et(()=>l?{[`${l}--mobile`]:v.value}:{});return{...p,displayClasses:A,mobile:v}}const P3=Symbol.for("vuetify:goto");function R3(){return{container:void 0,duration:300,layout:!1,offset:0,easing:"easeInOutCubic",patterns:{linear:r=>r,easeInQuad:r=>r**2,easeOutQuad:r=>r*(2-r),easeInOutQuad:r=>r<.5?2*r**2:-1+(4-2*r)*r,easeInCubic:r=>r**3,easeOutCubic:r=>--r**3+1,easeInOutCubic:r=>r<.5?4*r**3:(r-1)*(2*r-2)*(2*r-2)+1,easeInQuart:r=>r**4,easeOutQuart:r=>1- --r**4,easeInOutQuart:r=>r<.5?8*r**4:1-8*--r**4,easeInQuint:r=>r**5,easeOutQuint:r=>1+--r**5,easeInOutQuint:r=>r<.5?16*r**5:1+16*--r**5}}}function P8(r){return gb(r)??(document.scrollingElement||document.body)}function gb(r){return typeof r=="string"?document.querySelector(r):nC(r)}function Ox(r,l,p){if(typeof r=="number")return l&&p?-r:r;let v=gb(r),A=0;for(;v;)A+=l?v.offsetLeft:v.offsetTop,v=v.offsetParent;return A}function R8(r,l){return{rtl:l.isRtl,options:gs(R3(),r)}}async function TA(r,l,p,v){const A=p?"scrollLeft":"scrollTop",R=gs((v==null?void 0:v.options)??R3(),l),D=v==null?void 0:v.rtl.value,i=(typeof r=="number"?r:gb(r))??0,G=R.container==="parent"&&i instanceof HTMLElement?i.parentElement:P8(R.container),W=typeof R.easing=="function"?R.easing:R.patterns[R.easing];if(!W)throw new TypeError(`Easing function "${R.easing}" not found.`);let H;if(typeof i=="number")H=Ox(i,p,D);else if(H=Ox(i,p,D)-Ox(G,p,D),R.layout){const he=window.getComputedStyle(i).getPropertyValue("--v-layout-top");he&&(H-=parseInt(he,10))}H+=R.offset,H=z8(G,H,!!D,!!p);const ee=G[A]??0;if(H===ee)return Promise.resolve(H);const ne=performance.now();return new Promise(de=>requestAnimationFrame(function he(_e){const je=(_e-ne)/R.duration,vt=Math.floor(ee+(H-ee)*W(vy(je,0,1)));if(G[A]=vt,je>=1&&Math.abs(vt-G[A])<10)return de(H);if(je>2)return de(G[A]);requestAnimationFrame(he)}))}function D8(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=Pn(P3),{isRtl:p}=Kd();if(!l)throw new Error("[Vuetify] Could not find injected goto instance");const v={...l,rtl:et(()=>l.rtl.value||p.value)};async function A(R,D){return TA(R,gs(r,D),!1,v)}return A.horizontal=async(R,D)=>TA(R,gs(r,D),!0,v),A}function z8(r,l,p,v){const{scrollWidth:A,scrollHeight:R}=r,[D,i]=r===document.scrollingElement?[window.innerWidth,window.innerHeight]:[r.offsetWidth,r.offsetHeight];let G,W;return v?p?(G=-(A-D),W=0):(G=0,W=A-D):(G=0,W=R+-i),Math.max(Math.min(l,W),G)}function L8(r){let{selectedElement:l,containerElement:p,isRtl:v,isHorizontal:A}=r;const R=Rm(A,p),D=D3(A,v,p),i=Rm(A,l),G=z3(A,l),W=i*.4;return D>G?G-W:D+R<G+i?G-R+i+W:D}function O8(r){let{selectedElement:l,containerElement:p,isHorizontal:v}=r;const A=Rm(v,p),R=z3(v,l),D=Rm(v,l);return R-A/2+D/2}function SA(r,l){const p=r?"scrollWidth":"scrollHeight";return(l==null?void 0:l[p])||0}function k8(r,l){const p=r?"clientWidth":"clientHeight";return(l==null?void 0:l[p])||0}function D3(r,l,p){if(!p)return 0;const{scrollLeft:v,offsetWidth:A,scrollWidth:R}=p;return r?l?R-A+v:v:p.scrollTop}function Rm(r,l){const p=r?"offsetWidth":"offsetHeight";return(l==null?void 0:l[p])||0}function z3(r,l){const p=r?"offsetLeft":"offsetTop";return(l==null?void 0:l[p])||0}const F8=Symbol.for("vuetify:v-slide-group"),L3=ln({centerActive:Boolean,direction:{type:String,default:"horizontal"},symbol:{type:null,default:F8},nextIcon:{type:Us,default:"$next"},prevIcon:{type:Us,default:"$prev"},showArrows:{type:[Boolean,String],validator:r=>typeof r=="boolean"||["always","desktop","mobile"].includes(r)},...Ei(),...I3({mobile:null}),...vs(),...Y1({selectedClass:"v-slide-group-item--active"})},"VSlideGroup"),EA=si()({name:"VSlideGroup",props:L3(),emits:{"update:modelValue":r=>!0},setup(r,l){let{slots:p}=l;const{isRtl:v}=Kd(),{displayClasses:A,mobile:R}=C3(r),D=J1(r,r.symbol),i=Vn(!1),G=Vn(0),W=Vn(0),H=Vn(0),ee=et(()=>r.direction==="horizontal"),{resizeRef:ne,contentRect:de}=Ty(),{resizeRef:he,contentRect:_e}=Ty(),Ie=D8(),je=et(()=>({container:ne.el,duration:200,easing:"easeOutQuart"})),vt=et(()=>D.selected.value.length?D.items.value.findIndex(ur=>ur.id===D.selected.value[0]):-1),Pt=et(()=>D.selected.value.length?D.items.value.findIndex(ur=>ur.id===D.selected.value[D.selected.value.length-1]):-1);if(_s){let ur=-1;Tn(()=>[D.selected.value,de.value,_e.value,ee.value],()=>{cancelAnimationFrame(ur),ur=requestAnimationFrame(()=>{if(de.value&&_e.value){const ir=ee.value?"width":"height";W.value=de.value[ir],H.value=_e.value[ir],i.value=W.value+1<H.value}if(vt.value>=0&&he.el){const ir=he.el.children[Pt.value];ft(ir,r.centerActive)}})})}const ht=Vn(!1);function ft(ur,ir){let $t=0;ir?$t=O8({containerElement:ne.el,isHorizontal:ee.value,selectedElement:ur}):$t=L8({containerElement:ne.el,isHorizontal:ee.value,isRtl:v.value,selectedElement:ur}),bt($t)}function bt(ur){if(!_s||!ne.el)return;const ir=Rm(ee.value,ne.el),$t=D3(ee.value,v.value,ne.el);if(!(SA(ee.value,ne.el)<=ir||Math.abs(ur-$t)<16)){if(ee.value&&v.value&&ne.el){const{scrollWidth:di,offsetWidth:yn}=ne.el;ur=di-yn-ur}ee.value?Ie.horizontal(ur,je.value):Ie(ur,je.value)}}function Je(ur){const{scrollTop:ir,scrollLeft:$t}=ur.target;G.value=ee.value?$t:ir}function Et(ur){if(ht.value=!0,!(!i.value||!he.el)){for(const ir of ur.composedPath())for(const $t of he.el.children)if($t===ir){ft($t);return}}}function pt(ur){ht.value=!1}let lt=!1;function dt(ur){var ir;!lt&&!ht.value&&!(ur.relatedTarget&&((ir=he.el)!=null&&ir.contains(ur.relatedTarget)))&&Zt(),lt=!1}function mt(){lt=!0}function nr(ur){if(!he.el)return;function ir($t){ur.preventDefault(),Zt($t)}ee.value?ur.key==="ArrowRight"?ir(v.value?"prev":"next"):ur.key==="ArrowLeft"&&ir(v.value?"next":"prev"):ur.key==="ArrowDown"?ir("next"):ur.key==="ArrowUp"&&ir("prev"),ur.key==="Home"?ir("first"):ur.key==="End"&&ir("last")}function Cr(ur,ir){if(!ur)return;let $t=ur;do $t=$t==null?void 0:$t[ir==="next"?"nextElementSibling":"previousElementSibling"];while($t!=null&&$t.hasAttribute("disabled"));return $t}function Zt(ur){if(!he.el)return;let ir;if(!ur)ir=xF(he.el)[0];else if(ur==="next"){if(ir=Cr(he.el.querySelector(":focus"),ur),!ir)return Zt("first")}else if(ur==="prev"){if(ir=Cr(he.el.querySelector(":focus"),ur),!ir)return Zt("last")}else ur==="first"?(ir=he.el.firstElementChild,ir!=null&&ir.hasAttribute("disabled")&&(ir=Cr(ir,"next"))):ur==="last"&&(ir=he.el.lastElementChild,ir!=null&&ir.hasAttribute("disabled")&&(ir=Cr(ir,"prev")));ir&&ir.focus({preventScroll:!0})}function Tr(ur){const ir=ee.value&&v.value?-1:1,$t=(ur==="prev"?-ir:ir)*W.value;let vi=G.value+$t;if(ee.value&&v.value&&ne.el){const{scrollWidth:di,offsetWidth:yn}=ne.el;vi+=di-yn}bt(vi)}const vr=et(()=>({next:D.next,prev:D.prev,select:D.select,isSelected:D.isSelected})),Ur=et(()=>{switch(r.showArrows){case"always":return!0;case"desktop":return!R.value;case!0:return i.value||Math.abs(G.value)>0;case"mobile":return R.value||i.value||Math.abs(G.value)>0;default:return!R.value&&(i.value||Math.abs(G.value)>0)}}),lr=et(()=>Math.abs(G.value)>1),qr=et(()=>{if(!ne.value)return!1;const ur=SA(ee.value,ne.el),ir=k8(ee.value,ne.el);return ur-ir-Math.abs(G.value)>1});return Bi(()=>st(r.tag,{class:["v-slide-group",{"v-slide-group--vertical":!ee.value,"v-slide-group--has-affixes":Ur.value,"v-slide-group--is-overflowing":i.value},A.value,r.class],style:r.style,tabindex:ht.value||D.selected.value.length?-1:0,onFocus:dt},{default:()=>{var ur,ir,$t;return[Ur.value&&st("div",{key:"prev",class:["v-slide-group__prev",{"v-slide-group__prev--disabled":!lr.value}],onMousedown:mt,onClick:()=>lr.value&&Tr("prev")},[((ur=p.prev)==null?void 0:ur.call(p,vr.value))??st(yA,null,{default:()=>[st(Qs,{icon:v.value?r.nextIcon:r.prevIcon},null)]})]),st("div",{key:"container",ref:ne,class:"v-slide-group__container",onScroll:Je},[st("div",{ref:he,class:"v-slide-group__content",onFocusin:Et,onFocusout:pt,onKeydown:nr},[(ir=p.default)==null?void 0:ir.call(p,vr.value)])]),Ur.value&&st("div",{key:"next",class:["v-slide-group__next",{"v-slide-group__next--disabled":!qr.value}],onMousedown:mt,onClick:()=>qr.value&&Tr("next")},[(($t=p.next)==null?void 0:$t.call(p,vr.value))??st(yA,null,{default:()=>[st(Qs,{icon:v.value?r.prevIcon:r.nextIcon},null)]})])]}})),{selected:D.selected,scrollTo:Tr,scrollOffset:G,focus:Zt,hasPrev:lr,hasNext:qr}}}),O3=Symbol.for("vuetify:v-chip-group"),B8=ln({column:Boolean,filter:Boolean,valueComparator:{type:Function,default:Yy},...L3(),...Ei(),...Y1({selectedClass:"v-chip--selected"}),...vs(),...ja(),...Wd({variant:"tonal"})},"VChipGroup");si()({name:"VChipGroup",props:B8(),emits:{"update:modelValue":r=>!0},setup(r,l){let{slots:p}=l;const{themeClasses:v}=$a(r),{isSelected:A,select:R,next:D,prev:i,selected:G}=J1(r,O3);return Nm({VChip:{color:Si(r,"color"),disabled:Si(r,"disabled"),filter:Si(r,"filter"),variant:Si(r,"variant")}}),Bi(()=>{const W=EA.filterProps(r);return st(EA,ys(W,{class:["v-chip-group",{"v-chip-group--column":r.column},v.value,r.class],style:r.style}),{default:()=>{var H;return[(H=p.default)==null?void 0:H.call(p,{isSelected:A,select:R,next:D,prev:i,selected:G.value})]}})}),{}}});const N8=ln({activeClass:String,appendAvatar:String,appendIcon:Us,closable:Boolean,closeIcon:{type:Us,default:"$delete"},closeLabel:{type:String,default:"$vuetify.close"},draggable:Boolean,filter:Boolean,filterIcon:{type:Us,default:"$complete"},label:Boolean,link:{type:Boolean,default:void 0},pill:Boolean,prependAvatar:String,prependIcon:Us,ripple:{type:[Boolean,Object],default:!0},text:{type:[String,Number,Boolean],default:void 0},modelValue:{type:Boolean,default:!0},onClick:SE(),onClickOnce:SE(),...Gd(),...Ei(),...qd(),...jm(),...fC(),...Rc(),...rb(),...Hm(),...vs({tag:"span"}),...ja(),...Wd({variant:"tonal"})},"VChip"),V8=si()({name:"VChip",directives:{Ripple:nb},props:N8(),emits:{"click:close":r=>!0,"update:modelValue":r=>!0,"group:selected":r=>!0,click:r=>!0},setup(r,l){let{attrs:p,emit:v,slots:A}=l;const{t:R}=b5(),{borderClasses:D}=Hd(r),{colorClasses:i,colorStyles:G,variantClasses:W}=e0(r),{densityClasses:H}=Um(r),{elevationClasses:ee}=$m(r),{roundedClasses:ne}=Dc(r),{sizeClasses:de}=qm(r),{themeClasses:he}=$a(r),_e=Gm(r,"modelValue"),Ie=pC(r,O3,!1),je=tb(r,p),vt=et(()=>r.link!==!1&&je.isLink.value),Pt=et(()=>!r.disabled&&r.link!==!1&&(!!Ie||r.link||je.isClickable.value)),ht=et(()=>({"aria-label":R(r.closeLabel),onClick(Je){Je.preventDefault(),Je.stopPropagation(),_e.value=!1,v("click:close",Je)}}));function ft(Je){var Et;v("click",Je),Pt.value&&((Et=je.navigate)==null||Et.call(je,Je),Ie==null||Ie.toggle())}function bt(Je){(Je.key==="Enter"||Je.key===" ")&&(Je.preventDefault(),ft(Je))}return()=>{var Zt;const Je=je.isLink.value?"a":r.tag,Et=!!(r.appendIcon||r.appendAvatar),pt=!!(Et||A.append),lt=!!(A.close||r.closable),dt=!!(A.filter||r.filter)&&Ie,mt=!!(r.prependIcon||r.prependAvatar),nr=!!(mt||A.prepend),Cr=!Ie||Ie.isSelected.value;return _e.value&&Dd(st(Je,ys({class:["v-chip",{"v-chip--disabled":r.disabled,"v-chip--label":r.label,"v-chip--link":Pt.value,"v-chip--filter":dt,"v-chip--pill":r.pill,[`${r.activeClass}`]:r.activeClass&&((Zt=je.isActive)==null?void 0:Zt.value)},he.value,D.value,Cr?i.value:void 0,H.value,ee.value,ne.value,de.value,W.value,Ie==null?void 0:Ie.selectedClass.value,r.class],style:[Cr?G.value:void 0,r.style],disabled:r.disabled||void 0,draggable:r.draggable,tabindex:Pt.value?0:void 0,onClick:ft,onKeydown:Pt.value&&!vt.value&&bt},je.linkProps),{default:()=>{var Tr;return[Qy(Pt.value,"v-chip"),dt&&st(M8,{key:"filter"},{default:()=>[Dd(st("div",{class:"v-chip__filter"},[A.filter?st(Bo,{key:"filter-defaults",disabled:!r.filterIcon,defaults:{VIcon:{icon:r.filterIcon}}},A.filter):st(Qs,{key:"filter-icon",icon:r.filterIcon},null)]),[[nI,Ie.isSelected.value]])]}),nr&&st("div",{key:"prepend",class:"v-chip__prepend"},[A.prepend?st(Bo,{key:"prepend-defaults",disabled:!mt,defaults:{VAvatar:{image:r.prependAvatar,start:!0},VIcon:{icon:r.prependIcon,start:!0}}},A.prepend):st(ti,null,[r.prependIcon&&st(Qs,{key:"prepend-icon",icon:r.prependIcon,start:!0},null),r.prependAvatar&&st(Pm,{key:"prepend-avatar",image:r.prependAvatar,start:!0},null)])]),st("div",{class:"v-chip__content","data-no-activator":""},[((Tr=A.default)==null?void 0:Tr.call(A,{isSelected:Ie==null?void 0:Ie.isSelected.value,selectedClass:Ie==null?void 0:Ie.selectedClass.value,select:Ie==null?void 0:Ie.select,toggle:Ie==null?void 0:Ie.toggle,value:Ie==null?void 0:Ie.value.value,disabled:r.disabled}))??Vs(r.text)]),pt&&st("div",{key:"append",class:"v-chip__append"},[A.append?st(Bo,{key:"append-defaults",disabled:!Et,defaults:{VAvatar:{end:!0,image:r.appendAvatar},VIcon:{end:!0,icon:r.appendIcon}}},A.append):st(ti,null,[r.appendIcon&&st(Qs,{key:"append-icon",end:!0,icon:r.appendIcon},null),r.appendAvatar&&st(Pm,{key:"append-avatar",end:!0,image:r.appendAvatar},null)])]),lt&&st("button",ys({key:"close",class:"v-chip__close",type:"button","data-testid":"close-chip"},ht.value),[A.close?st(Bo,{key:"close-defaults",defaults:{VIcon:{icon:r.closeIcon,size:"x-small"}}},A.close):st(Qs,{key:"close-icon",icon:r.closeIcon,size:"x-small"},null)])]}}),[[O1("ripple"),Pt.value&&r.ripple,null]])}}}),U8=ln({fluid:{type:Boolean,default:!1},...Ei(),...Zd(),...vs()},"VContainer"),j8=si()({name:"VContainer",props:U8(),setup(r,l){let{slots:p}=l;const{rtlClasses:v}=Kd(),{dimensionStyles:A}=Xd(r);return Bi(()=>st(r.tag,{class:["v-container",{"v-container--fluid":r.fluid},v.value,r.class],style:[A.value,r.style]},p)),{}}}),k3=_b.reduce((r,l)=>(r[l]={type:[Boolean,String,Number],default:!1},r),{}),F3=_b.reduce((r,l)=>{const p="offset"+Mc(l);return r[p]={type:[String,Number],default:null},r},{}),B3=_b.reduce((r,l)=>{const p="order"+Mc(l);return r[p]={type:[String,Number],default:null},r},{}),AA={col:Object.keys(k3),offset:Object.keys(F3),order:Object.keys(B3)};function $8(r,l,p){let v=r;if(!(p==null||p===!1)){if(l){const A=l.replace(r,"");v+=`-${A}`}return r==="col"&&(v="v-"+v),r==="col"&&(p===""||p===!0)||(v+=`-${p}`),v.toLowerCase()}}const G8=["auto","start","end","center","baseline","stretch"],H8=ln({cols:{type:[Boolean,String,Number],default:!1},...k3,offset:{type:[String,Number],default:null},...F3,order:{type:[String,Number],default:null},...B3,alignSelf:{type:String,default:null,validator:r=>G8.includes(r)},...Ei(),...vs()},"VCol"),Zg=si()({name:"VCol",props:H8(),setup(r,l){let{slots:p}=l;const v=et(()=>{const A=[];let R;for(R in AA)AA[R].forEach(i=>{const G=r[i],W=$8(R,i,G);W&&A.push(W)});const D=A.some(i=>i.startsWith("v-col-"));return A.push({"v-col":!D||!r.cols,[`v-col-${r.cols}`]:r.cols,[`offset-${r.offset}`]:r.offset,[`order-${r.order}`]:r.order,[`align-self-${r.alignSelf}`]:r.alignSelf}),A});return()=>{var A;return bl(r.tag,{class:[v.value,r.class],style:r.style},(A=p.default)==null?void 0:A.call(p))}}});function q8(r){let{rootEl:l,isSticky:p,layoutItemStyles:v}=r;const A=Vn(!1),R=Vn(0),D=et(()=>{const W=typeof A.value=="boolean"?"top":A.value;return[p.value?{top:"auto",bottom:"auto",height:void 0}:void 0,A.value?{[W]:ni(R.value)}:{top:v.value.top}]});fa(()=>{Tn(p,W=>{W?window.addEventListener("scroll",G,{passive:!0}):window.removeEventListener("scroll",G)},{immediate:!0})}),Ua(()=>{window.removeEventListener("scroll",G)});let i=0;function G(){const W=i>window.scrollY?"up":"down",H=l.value.getBoundingClientRect(),ee=parseFloat(v.value.top??0),ne=window.scrollY-Math.max(0,R.value-ee),de=H.height+Math.max(R.value,ee)-window.scrollY-window.innerHeight,he=parseFloat(getComputedStyle(l.value).getPropertyValue("--v-body-scroll-y"))||0;H.height<window.innerHeight-ee?(A.value="top",R.value=ee):W==="up"&&A.value==="bottom"||W==="down"&&A.value==="top"?(R.value=window.scrollY+H.top-he,A.value=!0):W==="down"&&de<=0?(R.value=0,A.value="bottom"):W==="up"&&ne<=0&&(he?A.value!=="top"&&(R.value=-ne+he+ee,A.value="top"):(R.value=H.top+ne,A.value="top")),i=window.scrollY}return{isStuck:A,stickyStyles:D}}const W8=100,Z8=20;function MA(r){return(r<0?-1:1)*Math.sqrt(Math.abs(r))*1.41421356237}function IA(r){if(r.length<2)return 0;if(r.length===2)return r[1].t===r[0].t?0:(r[1].d-r[0].d)/(r[1].t-r[0].t);let l=0;for(let p=r.length-1;p>0;p--){if(r[p].t===r[p-1].t)continue;const v=MA(l),A=(r[p].d-r[p-1].d)/(r[p].t-r[p-1].t);l+=(A-v)*Math.abs(A),p===r.length-1&&(l*=.5)}return MA(l)*1e3}function X8(){const r={};function l(A){Array.from(A.changedTouches).forEach(R=>{(r[R.identifier]??(r[R.identifier]=new vF(Z8))).push([A.timeStamp,R])})}function p(A){Array.from(A.changedTouches).forEach(R=>{delete r[R.identifier]})}function v(A){var W;const R=(W=r[A])==null?void 0:W.values().reverse();if(!R)throw new Error(`No samples for touch id ${A}`);const D=R[0],i=[],G=[];for(const H of R){if(D[0]-H[0]>W8)break;i.push({t:H[0],d:H[1].clientX}),G.push({t:H[0],d:H[1].clientY})}return{x:IA(i),y:IA(G),get direction(){const{x:H,y:ee}=this,[ne,de]=[Math.abs(H),Math.abs(ee)];return ne>de&&H>=0?"right":ne>de&&H<=0?"left":de>ne&&ee>=0?"down":de>ne&&ee<=0?"up":K8()}}}return{addMovement:l,endTouch:p,getVelocity:v}}function K8(){throw new Error}function Y8(r){let{el:l,isActive:p,isTemporary:v,width:A,touchless:R,position:D}=r;fa(()=>{window.addEventListener("touchstart",vt,{passive:!0}),window.addEventListener("touchmove",Pt,{passive:!1}),window.addEventListener("touchend",ht,{passive:!0})}),Ua(()=>{window.removeEventListener("touchstart",vt),window.removeEventListener("touchmove",Pt),window.removeEventListener("touchend",ht)});const i=et(()=>["left","right"].includes(D.value)),{addMovement:G,endTouch:W,getVelocity:H}=X8();let ee=!1;const ne=Vn(!1),de=Vn(0),he=Vn(0);let _e;function Ie(bt,Je){return(D.value==="left"?bt:D.value==="right"?document.documentElement.clientWidth-bt:D.value==="top"?bt:D.value==="bottom"?document.documentElement.clientHeight-bt:xd())-(Je?A.value:0)}function je(bt){let Je=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const Et=D.value==="left"?(bt-he.value)/A.value:D.value==="right"?(document.documentElement.clientWidth-bt-he.value)/A.value:D.value==="top"?(bt-he.value)/A.value:D.value==="bottom"?(document.documentElement.clientHeight-bt-he.value)/A.value:xd();return Je?Math.max(0,Math.min(1,Et)):Et}function vt(bt){if(R.value)return;const Je=bt.changedTouches[0].clientX,Et=bt.changedTouches[0].clientY,pt=25,lt=D.value==="left"?Je<pt:D.value==="right"?Je>document.documentElement.clientWidth-pt:D.value==="top"?Et<pt:D.value==="bottom"?Et>document.documentElement.clientHeight-pt:xd(),dt=p.value&&(D.value==="left"?Je<A.value:D.value==="right"?Je>document.documentElement.clientWidth-A.value:D.value==="top"?Et<A.value:D.value==="bottom"?Et>document.documentElement.clientHeight-A.value:xd());(lt||dt||p.value&&v.value)&&(_e=[Je,Et],he.value=Ie(i.value?Je:Et,p.value),de.value=je(i.value?Je:Et),ee=he.value>-20&&he.value<80,W(bt),G(bt))}function Pt(bt){const Je=bt.changedTouches[0].clientX,Et=bt.changedTouches[0].clientY;if(ee){if(!bt.cancelable){ee=!1;return}const lt=Math.abs(Je-_e[0]),dt=Math.abs(Et-_e[1]);(i.value?lt>dt&&lt>3:dt>lt&&dt>3)?(ne.value=!0,ee=!1):(i.value?dt:lt)>3&&(ee=!1)}if(!ne.value)return;bt.preventDefault(),G(bt);const pt=je(i.value?Je:Et,!1);de.value=Math.max(0,Math.min(1,pt)),pt>1?he.value=Ie(i.value?Je:Et,!0):pt<0&&(he.value=Ie(i.value?Je:Et,!1))}function ht(bt){if(ee=!1,!ne.value)return;G(bt),ne.value=!1;const Je=H(bt.changedTouches[0].identifier),Et=Math.abs(Je.x),pt=Math.abs(Je.y);(i.value?Et>pt&&Et>400:pt>Et&&pt>3)?p.value=Je.direction===({left:"right",right:"left",top:"down",bottom:"up"}[D.value]||xd()):p.value=de.value>.5}const ft=et(()=>ne.value?{transform:D.value==="left"?`translateX(calc(-100% + ${de.value*A.value}px))`:D.value==="right"?`translateX(calc(100% - ${de.value*A.value}px))`:D.value==="top"?`translateY(calc(-100% + ${de.value*A.value}px))`:D.value==="bottom"?`translateY(calc(100% - ${de.value*A.value}px))`:xd(),transition:"none"}:void 0);return fm(ne,()=>{var Et,pt;const bt=((Et=l.value)==null?void 0:Et.style.transform)??null,Je=((pt=l.value)==null?void 0:pt.style.transition)??null;Hu(()=>{var lt,dt,mt,nr;(dt=l.value)==null||dt.style.setProperty("transform",((lt=ft.value)==null?void 0:lt.transform)||"none"),(nr=l.value)==null||nr.style.setProperty("transition",((mt=ft.value)==null?void 0:mt.transition)||null)}),Oy(()=>{var lt,dt;(lt=l.value)==null||lt.style.setProperty("transform",bt),(dt=l.value)==null||dt.style.setProperty("transition",Je)})}),{isDragging:ne,dragProgress:de,dragStyles:ft}}function xd(){throw new Error}const c0={"001":1,AD:1,AE:6,AF:6,AG:0,AI:1,AL:1,AM:1,AN:1,AR:1,AS:0,AT:1,AU:1,AX:1,AZ:1,BA:1,BD:0,BE:1,BG:1,BH:6,BM:1,BN:1,BR:0,BS:0,BT:0,BW:0,BY:1,BZ:0,CA:0,CH:1,CL:1,CM:1,CN:1,CO:0,CR:1,CY:1,CZ:1,DE:1,DJ:6,DK:1,DM:0,DO:0,DZ:6,EC:1,EE:1,EG:6,ES:1,ET:0,FI:1,FJ:1,FO:1,FR:1,GB:1,"GB-alt-variant":0,GE:1,GF:1,GP:1,GR:1,GT:0,GU:0,HK:0,HN:0,HR:1,HU:1,ID:0,IE:1,IL:0,IN:0,IQ:6,IR:6,IS:1,IT:1,JM:0,JO:6,JP:0,KE:0,KG:1,KH:0,KR:0,KW:6,KZ:1,LA:0,LB:1,LI:1,LK:1,LT:1,LU:1,LV:1,LY:6,MC:1,MD:1,ME:1,MH:0,MK:1,MM:0,MN:1,MO:0,MQ:1,MT:0,MV:5,MX:0,MY:1,MZ:0,NI:0,NL:1,NO:1,NP:0,NZ:1,OM:6,PA:0,PE:0,PH:0,PK:0,PL:1,PR:0,PT:0,PY:0,QA:6,RE:1,RO:1,RS:1,RU:1,SA:0,SD:6,SE:1,SG:0,SI:1,SK:1,SM:1,SV:0,SY:6,TH:0,TJ:1,TM:1,TR:1,TT:0,TW:0,UA:1,UM:0,US:0,UY:1,UZ:1,VA:1,VE:0,VI:0,VN:1,WS:0,XK:1,YE:0,ZA:0,ZW:0};function J8(r,l,p){const v=[];let A=[];const R=N3(r),D=V3(r),i=p??c0[l.slice(-2).toUpperCase()]??0,G=(R.getDay()-i+7)%7,W=(D.getDay()-i+7)%7;for(let H=0;H<G;H++){const ee=new Date(R);ee.setDate(ee.getDate()-(G-H)),A.push(ee)}for(let H=1;H<=D.getDate();H++){const ee=new Date(r.getFullYear(),r.getMonth(),H);A.push(ee),A.length===7&&(v.push(A),A=[])}for(let H=1;H<7-W;H++){const ee=new Date(D);ee.setDate(ee.getDate()+H),A.push(ee)}return A.length>0&&v.push(A),v}function Q8(r,l,p){const v=p??c0[l.slice(-2).toUpperCase()]??0,A=new Date(r);for(;A.getDay()!==v;)A.setDate(A.getDate()-1);return A}function eU(r,l){const p=new Date(r),v=((c0[l.slice(-2).toUpperCase()]??0)+6)%7;for(;p.getDay()!==v;)p.setDate(p.getDate()+1);return p}function N3(r){return new Date(r.getFullYear(),r.getMonth(),1)}function V3(r){return new Date(r.getFullYear(),r.getMonth()+1,0)}function tU(r){const l=r.split("-").map(Number);return new Date(l[0],l[1]-1,l[2])}const rU=/^([12]\d{3}-([1-9]|0[1-9]|1[0-2])-([1-9]|0[1-9]|[12]\d|3[01]))$/;function U3(r){if(r==null)return new Date;if(r instanceof Date)return r;if(typeof r=="string"){let l;if(rU.test(r))return tU(r);if(l=Date.parse(r),!isNaN(l))return new Date(l)}return null}const CA=new Date(2e3,0,2);function nU(r,l){const p=l??c0[r.slice(-2).toUpperCase()]??0;return rC(7).map(v=>{const A=new Date(CA);return A.setDate(CA.getDate()+p+v),new Intl.DateTimeFormat(r,{weekday:"narrow"}).format(A)})}function iU(r,l,p,v){const A=U3(r)??new Date,R=v==null?void 0:v[l];if(typeof R=="function")return R(A,l,p);let D={};switch(l){case"fullDate":D={year:"numeric",month:"long",day:"numeric"};break;case"fullDateWithWeekday":D={weekday:"long",year:"numeric",month:"long",day:"numeric"};break;case"normalDate":const i=A.getDate(),G=new Intl.DateTimeFormat(p,{month:"long"}).format(A);return`${i} ${G}`;case"normalDateWithWeekday":D={weekday:"short",day:"numeric",month:"short"};break;case"shortDate":D={month:"short",day:"numeric"};break;case"year":D={year:"numeric"};break;case"month":D={month:"long"};break;case"monthShort":D={month:"short"};break;case"monthAndYear":D={month:"long",year:"numeric"};break;case"monthAndDate":D={month:"long",day:"numeric"};break;case"weekday":D={weekday:"long"};break;case"weekdayShort":D={weekday:"short"};break;case"dayOfMonth":return new Intl.NumberFormat(p).format(A.getDate());case"hours12h":D={hour:"numeric",hour12:!0};break;case"hours24h":D={hour:"numeric",hour12:!1};break;case"minutes":D={minute:"numeric"};break;case"seconds":D={second:"numeric"};break;case"fullTime":D={hour:"numeric",minute:"numeric"};break;case"fullTime12h":D={hour:"numeric",minute:"numeric",hour12:!0};break;case"fullTime24h":D={hour:"numeric",minute:"numeric",hour12:!1};break;case"fullDateTime":D={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};break;case"fullDateTime12h":D={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0};break;case"fullDateTime24h":D={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1};break;case"keyboardDate":D={year:"numeric",month:"2-digit",day:"2-digit"};break;case"keyboardDateTime":return D={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric"},new Intl.DateTimeFormat(p,D).format(A).replace(/, /g," ");case"keyboardDateTime12h":return D={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",hour12:!0},new Intl.DateTimeFormat(p,D).format(A).replace(/, /g," ");case"keyboardDateTime24h":return D={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",hour12:!1},new Intl.DateTimeFormat(p,D).format(A).replace(/, /g," ");default:D=R??{timeZone:"UTC",timeZoneName:"short"}}return new Intl.DateTimeFormat(p,D).format(A)}function sU(r,l){const p=r.toJsDate(l),v=p.getFullYear(),A=TE(String(p.getMonth()+1),2,"0"),R=TE(String(p.getDate()),2,"0");return`${v}-${A}-${R}`}function oU(r){const[l,p,v]=r.split("-").map(Number);return new Date(l,p-1,v)}function aU(r,l){const p=new Date(r);return p.setMinutes(p.getMinutes()+l),p}function lU(r,l){const p=new Date(r);return p.setHours(p.getHours()+l),p}function cU(r,l){const p=new Date(r);return p.setDate(p.getDate()+l),p}function uU(r,l){const p=new Date(r);return p.setDate(p.getDate()+l*7),p}function hU(r,l){const p=new Date(r);return p.setDate(1),p.setMonth(p.getMonth()+l),p}function dU(r){return r.getFullYear()}function fU(r){return r.getMonth()}function pU(r){return r.getDate()}function mU(r){return new Date(r.getFullYear(),r.getMonth()+1,1)}function _U(r){return new Date(r.getFullYear(),r.getMonth()-1,1)}function gU(r){return r.getHours()}function yU(r){return r.getMinutes()}function vU(r){return new Date(r.getFullYear(),0,1)}function xU(r){return new Date(r.getFullYear(),11,31)}function bU(r,l){return Cy(r,l[0])&&SU(r,l[1])}function wU(r){const l=new Date(r);return l instanceof Date&&!isNaN(l.getTime())}function Cy(r,l){return r.getTime()>l.getTime()}function TU(r,l){return Cy(m1(r),m1(l))}function SU(r,l){return r.getTime()<l.getTime()}function PA(r,l){return r.getTime()===l.getTime()}function EU(r,l){return r.getDate()===l.getDate()&&r.getMonth()===l.getMonth()&&r.getFullYear()===l.getFullYear()}function AU(r,l){return r.getMonth()===l.getMonth()&&r.getFullYear()===l.getFullYear()}function MU(r,l){return r.getFullYear()===l.getFullYear()}function IU(r,l,p){const v=new Date(r),A=new Date(l);switch(p){case"years":return v.getFullYear()-A.getFullYear();case"quarters":return Math.floor((v.getMonth()-A.getMonth()+(v.getFullYear()-A.getFullYear())*12)/4);case"months":return v.getMonth()-A.getMonth()+(v.getFullYear()-A.getFullYear())*12;case"weeks":return Math.floor((v.getTime()-A.getTime())/(1e3*60*60*24*7));case"days":return Math.floor((v.getTime()-A.getTime())/(1e3*60*60*24));case"hours":return Math.floor((v.getTime()-A.getTime())/(1e3*60*60));case"minutes":return Math.floor((v.getTime()-A.getTime())/(1e3*60));case"seconds":return Math.floor((v.getTime()-A.getTime())/1e3);default:return v.getTime()-A.getTime()}}function CU(r,l){const p=new Date(r);return p.setHours(l),p}function PU(r,l){const p=new Date(r);return p.setMinutes(l),p}function RU(r,l){const p=new Date(r);return p.setMonth(l),p}function DU(r,l){const p=new Date(r);return p.setDate(l),p}function zU(r,l){const p=new Date(r);return p.setFullYear(l),p}function m1(r){return new Date(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0,0)}function LU(r){return new Date(r.getFullYear(),r.getMonth(),r.getDate(),23,59,59,999)}class OU{constructor(l){this.locale=l.locale,this.formats=l.formats}date(l){return U3(l)}toJsDate(l){return l}toISO(l){return sU(this,l)}parseISO(l){return oU(l)}addMinutes(l,p){return aU(l,p)}addHours(l,p){return lU(l,p)}addDays(l,p){return cU(l,p)}addWeeks(l,p){return uU(l,p)}addMonths(l,p){return hU(l,p)}getWeekArray(l,p){return J8(l,this.locale,p?Number(p):void 0)}startOfWeek(l,p){return Q8(l,this.locale,p?Number(p):void 0)}endOfWeek(l){return eU(l,this.locale)}startOfMonth(l){return N3(l)}endOfMonth(l){return V3(l)}format(l,p){return iU(l,p,this.locale,this.formats)}isEqual(l,p){return PA(l,p)}isValid(l){return wU(l)}isWithinRange(l,p){return bU(l,p)}isAfter(l,p){return Cy(l,p)}isAfterDay(l,p){return TU(l,p)}isBefore(l,p){return!Cy(l,p)&&!PA(l,p)}isSameDay(l,p){return EU(l,p)}isSameMonth(l,p){return AU(l,p)}isSameYear(l,p){return MU(l,p)}setMinutes(l,p){return PU(l,p)}setHours(l,p){return CU(l,p)}setMonth(l,p){return RU(l,p)}setDate(l,p){return DU(l,p)}setYear(l,p){return zU(l,p)}getDiff(l,p,v){return IU(l,p,v)}getWeekdays(l){return nU(this.locale,l?Number(l):void 0)}getYear(l){return dU(l)}getMonth(l){return fU(l)}getDate(l){return pU(l)}getNextMonth(l){return mU(l)}getPreviousMonth(l){return _U(l)}getHours(l){return gU(l)}getMinutes(l){return yU(l)}startOfDay(l){return m1(l)}endOfDay(l){return LU(l)}startOfYear(l){return vU(l)}endOfYear(l){return xU(l)}}const kU=Symbol.for("vuetify:date-options"),RA=Symbol.for("vuetify:date-adapter");function FU(r,l){const p=gs({adapter:OU,locale:{af:"af-ZA",bg:"bg-BG",ca:"ca-ES",ckb:"",cs:"cs-CZ",de:"de-DE",el:"el-GR",en:"en-US",et:"et-EE",fa:"fa-IR",fi:"fi-FI",hr:"hr-HR",hu:"hu-HU",he:"he-IL",id:"id-ID",it:"it-IT",ja:"ja-JP",ko:"ko-KR",lv:"lv-LV",lt:"lt-LT",nl:"nl-NL",no:"no-NO",pl:"pl-PL",pt:"pt-PT",ro:"ro-RO",ru:"ru-RU",sk:"sk-SK",sl:"sl-SI",srCyrl:"sr-SP",srLatn:"sr-SP",sv:"sv-SE",th:"th-TH",tr:"tr-TR",az:"az-AZ",uk:"uk-UA",vi:"vi-VN",zhHans:"zh-CN",zhHant:"zh-TW"}},r);return{options:p,instance:BU(p,l)}}function BU(r,l){const p=Ki(typeof r.adapter=="function"?new r.adapter({locale:r.locale[l.current.value]??l.current.value,formats:r.formats}):r.adapter);return Tn(l.current,v=>{p.locale=r.locale[v]??v??p.locale}),p}const Py=Symbol.for("vuetify:layout"),j3=Symbol.for("vuetify:layout-item"),DA=1e3,NU=ln({overlaps:{type:Array,default:()=>[]},fullHeight:Boolean},"layout"),VU=ln({name:{type:String},order:{type:[Number,String],default:0},absolute:Boolean},"layout-item");function UU(){const r=Pn(Py);if(!r)throw new Error("[Vuetify] Could not find injected layout");return{getLayoutItem:r.getLayoutItem,mainRect:r.mainRect,mainStyles:r.mainStyles}}function jU(r){const l=Pn(Py);if(!l)throw new Error("[Vuetify] Could not find injected layout");const p=r.id??`layout-item-${Jy()}`,v=Gs("useLayoutItem");vo(j3,{id:p});const A=Vn(!1);wM(()=>A.value=!0),bM(()=>A.value=!1);const{layoutItemStyles:R,layoutItemScrimStyles:D}=l.register(v,{...r,active:et(()=>A.value?!1:r.active.value),id:p});return Ua(()=>l.unregister(p)),{layoutItemStyles:R,layoutRect:l.layoutRect,layoutItemScrimStyles:D}}const $U=(r,l,p,v)=>{let A={top:0,left:0,right:0,bottom:0};const R=[{id:"",layer:{...A}}];for(const D of r){const i=l.get(D),G=p.get(D),W=v.get(D);if(!i||!G||!W)continue;const H={...A,[i.value]:parseInt(A[i.value],10)+(W.value?parseInt(G.value,10):0)};R.push({id:D,layer:H}),A=H}return R};function GU(r){const l=Pn(Py,null),p=et(()=>l?l.rootZIndex.value-100:DA),v=dn([]),A=Ki(new Map),R=Ki(new Map),D=Ki(new Map),i=Ki(new Map),G=Ki(new Map),{resizeRef:W,contentRect:H}=Ty(),ee=et(()=>{const bt=new Map,Je=r.overlaps??[];for(const Et of Je.filter(pt=>pt.includes(":"))){const[pt,lt]=Et.split(":");if(!v.value.includes(pt)||!v.value.includes(lt))continue;const dt=A.get(pt),mt=A.get(lt),nr=R.get(pt),Cr=R.get(lt);!dt||!mt||!nr||!Cr||(bt.set(lt,{position:dt.value,amount:parseInt(nr.value,10)}),bt.set(pt,{position:mt.value,amount:-parseInt(Cr.value,10)}))}return bt}),ne=et(()=>{const bt=[...new Set([...D.values()].map(Et=>Et.value))].sort((Et,pt)=>Et-pt),Je=[];for(const Et of bt){const pt=v.value.filter(lt=>{var dt;return((dt=D.get(lt))==null?void 0:dt.value)===Et});Je.push(...pt)}return $U(Je,A,R,i)}),de=et(()=>!Array.from(G.values()).some(bt=>bt.value)),he=et(()=>ne.value[ne.value.length-1].layer),_e=et(()=>({"--v-layout-left":ni(he.value.left),"--v-layout-right":ni(he.value.right),"--v-layout-top":ni(he.value.top),"--v-layout-bottom":ni(he.value.bottom),...de.value?void 0:{transition:"none"}})),Ie=et(()=>ne.value.slice(1).map((bt,Je)=>{let{id:Et}=bt;const{layer:pt}=ne.value[Je],lt=R.get(Et),dt=A.get(Et);return{id:Et,...pt,size:Number(lt.value),position:dt.value}})),je=bt=>Ie.value.find(Je=>Je.id===bt),vt=Gs("createLayout"),Pt=Vn(!1);fa(()=>{Pt.value=!0}),vo(Py,{register:(bt,Je)=>{let{id:Et,order:pt,position:lt,layoutSize:dt,elementSize:mt,active:nr,disableTransitions:Cr,absolute:Zt}=Je;D.set(Et,pt),A.set(Et,lt),R.set(Et,dt),i.set(Et,nr),Cr&&G.set(Et,Cr);const vr=Sd(j3,vt==null?void 0:vt.vnode).indexOf(bt);vr>-1?v.value.splice(vr,0,Et):v.value.push(Et);const Ur=et(()=>Ie.value.findIndex(ir=>ir.id===Et)),lr=et(()=>p.value+ne.value.length*2-Ur.value*2),qr=et(()=>{const ir=lt.value==="left"||lt.value==="right",$t=lt.value==="right",vi=lt.value==="bottom",di=mt.value??dt.value,yn=di===0?"%":"px",Rt={[lt.value]:0,zIndex:lr.value,transform:`translate${ir?"X":"Y"}(${(nr.value?0:-(di===0?100:di))*($t||vi?-1:1)}${yn})`,position:Zt.value||p.value!==DA?"absolute":"fixed",...de.value?void 0:{transition:"none"}};if(!Pt.value)return Rt;const tr=Ie.value[Ur.value];if(!tr)throw new Error(`[Vuetify] Could not find layout item "${Et}"`);const Yt=ee.value.get(Et);return Yt&&(tr[Yt.position]+=Yt.amount),{...Rt,height:ir?`calc(100% - ${tr.top}px - ${tr.bottom}px)`:mt.value?`${mt.value}px`:void 0,left:$t?void 0:`${tr.left}px`,right:$t?`${tr.right}px`:void 0,top:lt.value!=="bottom"?`${tr.top}px`:void 0,bottom:lt.value!=="top"?`${tr.bottom}px`:void 0,width:ir?mt.value?`${mt.value}px`:void 0:`calc(100% - ${tr.left}px - ${tr.right}px)`}}),ur=et(()=>({zIndex:lr.value-1}));return{layoutItemStyles:qr,layoutItemScrimStyles:ur,zIndex:lr}},unregister:bt=>{D.delete(bt),A.delete(bt),R.delete(bt),i.delete(bt),G.delete(bt),v.value=v.value.filter(Je=>Je!==bt)},mainRect:he,mainStyles:_e,getLayoutItem:je,items:Ie,layoutRect:H,rootZIndex:p});const ht=et(()=>["v-layout",{"v-layout--full-height":r.fullHeight}]),ft=et(()=>({zIndex:l?p.value:void 0,position:l?"relative":void 0,overflow:l?"hidden":void 0}));return{layoutClasses:ht,layoutStyles:ft,getLayoutItem:je,items:Ie,layoutRect:H,layoutRef:W}}const HU=ln({closeDelay:[Number,String],openDelay:[Number,String]},"delay");function qU(r,l){let p=()=>{};function v(D){p==null||p();const i=Number(D?r.openDelay:r.closeDelay);return new Promise(G=>{p=bF(i,()=>{l==null||l(D),G(D)})})}function A(){return v(!0)}function R(){return v(!1)}return{clearDelay:p,runOpenDelay:A,runCloseDelay:R}}function WU(){const l=Gs("useScopeId").vnode.scopeId;return{scopeId:l?{[l]:""}:void 0}}function $3(){const r=Vn(!1);return fa(()=>{window.requestAnimationFrame(()=>{r.value=!0})}),{ssrBootStyles:et(()=>r.value?void 0:{transition:"none !important"}),isBooted:Vd(r)}}const ZU=["start","end","left","right","top","bottom"],XU=ln({color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:{type:Boolean,default:null},railWidth:{type:[Number,String],default:56},scrim:{type:[Boolean,String],default:!0},image:String,temporary:Boolean,persistent:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:r=>ZU.includes(r)},sticky:Boolean,...Gd(),...Ei(),...HU(),...I3({mobile:null}),...jm(),...VU(),...Rc(),...vs({tag:"nav"}),...ja()},"VNavigationDrawer"),KU=si()({name:"VNavigationDrawer",props:XU(),emits:{"update:modelValue":r=>!0,"update:rail":r=>!0},setup(r,l){let{attrs:p,emit:v,slots:A}=l;const{isRtl:R}=Kd(),{themeClasses:D}=$a(r),{borderClasses:i}=Hd(r),{backgroundColorClasses:G,backgroundColorStyles:W}=Cd(Si(r,"color")),{elevationClasses:H}=$m(r),{displayClasses:ee,mobile:ne}=C3(r),{roundedClasses:de}=Dc(r),he=C5(),_e=Gm(r,"modelValue",null,qr=>!!qr),{ssrBootStyles:Ie}=$3(),{scopeId:je}=WU(),vt=dn(),Pt=Vn(!1),{runOpenDelay:ht,runCloseDelay:ft}=qU(r,qr=>{Pt.value=qr}),bt=et(()=>r.rail&&r.expandOnHover&&Pt.value?Number(r.width):Number(r.rail?r.railWidth:r.width)),Je=et(()=>a1(r.location,R.value)),Et=et(()=>r.persistent),pt=et(()=>!r.permanent&&(ne.value||r.temporary)),lt=et(()=>r.sticky&&!pt.value&&Je.value!=="bottom");fm(()=>r.expandOnHover&&r.rail!=null,()=>{Tn(Pt,qr=>v("update:rail",!qr))}),fm(()=>!r.disableResizeWatcher,()=>{Tn(pt,qr=>!r.permanent&&Bs(()=>_e.value=!qr))}),fm(()=>!r.disableRouteWatcher&&!!he,()=>{Tn(he.currentRoute,()=>pt.value&&(_e.value=!1))}),Tn(()=>r.permanent,qr=>{qr&&(_e.value=!0)}),r.modelValue==null&&!pt.value&&(_e.value=r.permanent||!ne.value);const{isDragging:dt,dragProgress:mt}=Y8({el:vt,isActive:_e,isTemporary:pt,width:bt,touchless:Si(r,"touchless"),position:Je}),nr=et(()=>{const qr=pt.value?0:r.rail&&r.expandOnHover?Number(r.railWidth):bt.value;return dt.value?qr*mt.value:qr}),{layoutItemStyles:Cr,layoutItemScrimStyles:Zt}=jU({id:r.name,order:et(()=>parseInt(r.order,10)),position:Je,layoutSize:nr,elementSize:bt,active:et(()=>_e.value||dt.value),disableTransitions:et(()=>dt.value),absolute:et(()=>r.absolute||lt.value&&typeof Tr.value!="string")}),{isStuck:Tr,stickyStyles:vr}=q8({rootEl:vt,isSticky:lt,layoutItemStyles:Cr}),Ur=Cd(et(()=>typeof r.scrim=="string"?r.scrim:null)),lr=et(()=>({...dt.value?{opacity:mt.value*.2,transition:"none"}:void 0,...Zt.value}));return Nm({VList:{bgColor:"transparent"}}),Bi(()=>{const qr=A.image||r.image;return st(ti,null,[st(r.tag,ys({ref:vt,onMouseenter:ht,onMouseleave:ft,class:["v-navigation-drawer",`v-navigation-drawer--${Je.value}`,{"v-navigation-drawer--expand-on-hover":r.expandOnHover,"v-navigation-drawer--floating":r.floating,"v-navigation-drawer--is-hovering":Pt.value,"v-navigation-drawer--rail":r.rail,"v-navigation-drawer--temporary":pt.value,"v-navigation-drawer--persistent":Et.value,"v-navigation-drawer--active":_e.value,"v-navigation-drawer--sticky":lt.value},D.value,G.value,i.value,ee.value,H.value,de.value,r.class],style:[W.value,Cr.value,Ie.value,vr.value,r.style]},je,p),{default:()=>{var ur,ir,$t;return[qr&&st("div",{key:"image",class:"v-navigation-drawer__img"},[A.image?st(Bo,{key:"image-defaults",disabled:!r.image,defaults:{VImg:{alt:"",cover:!0,height:"inherit",src:r.image}}},A.image):st(l0,{key:"image-img",alt:"",cover:!0,height:"inherit",src:r.image},null)]),A.prepend&&st("div",{class:"v-navigation-drawer__prepend"},[(ur=A.prepend)==null?void 0:ur.call(A)]),st("div",{class:"v-navigation-drawer__content"},[(ir=A.default)==null?void 0:ir.call(A)]),A.append&&st("div",{class:"v-navigation-drawer__append"},[($t=A.append)==null?void 0:$t.call(A)])]}}),st(Om,{name:"fade-transition"},{default:()=>[pt.value&&(dt.value||_e.value)&&!!r.scrim&&st("div",ys({class:["v-navigation-drawer__scrim",Ur.backgroundColorClasses.value],style:[lr.value,Ur.backgroundColorStyles.value],onClick:()=>{Et.value||(_e.value=!1)}},je),null)]})])}),{isStuck:Tr}}}),YU={class:"mark"},JU={class:"mark-parent"},QU={class:"mark-types"},ej={class:"name"},tj={class:"total"},rj={name:"BassDrawer"},nj=pn({...rj,setup(r){const l=II(),p=eC(),v=dn(""),A=et(()=>{const W=[];return(v.value?p.marks.filter(ee=>ee.mark_type_name.toLowerCase().includes(v.value.toLowerCase())):p.marks).forEach(ee=>{const ne=W.find(de=>de.name==ee.mark_type_parent);ne?(ne.list.push(ee),ne.total=ne.list.reduce((de,he)=>de+he.marks_point.length,0)):W.push({name:ee.mark_type_parent,list:[ee],total:ee.marks_point.length})}),W});Tn([()=>p.unshowMarks,()=>p.showName],()=>{window.$gmap&&(p.pointsIds=window.$gmap.addPoints(p.fillterMarks,p.showName,p.pointsIds,!0))},{deep:!0});function R(){var W;(W=window.$gmap)==null||W.addPoints(p.fillterMarks,p.showName,p.pointsIds,!0)}function D(W){p.unshowMarks.includes(W.id)?p.unshowMarks=p.unshowMarks.filter(H=>H!=W.id):p.unshowMarks.push(W.id)}function i(){p.unshowMarks=p.marks.map(W=>W.id)}function G(){p.unshowMarks=[]}return(W,H)=>{const ee=n8,ne=u8,de=tV,he=Js,_e=RV;return Kt(),Cn(KU,{class:"drawer",modelValue:xt(l).drawer,"onUpdate:modelValue":H[3]||(H[3]=Ie=>xt(l).drawer=Ie),width:375,location:W.$vuetify.display.mobile?"bottom":void 0,mobile:W.$vuetify.display.mobile},{default:An(()=>[st(E8,null,{default:An(()=>[st(E3,{class:"content"},{default:An(()=>[W.$vuetify.display.mobile?In("",!0):(Kt(),Nr(ti,{key:0},[st(Zg,{cols:"12"},{default:An(()=>H[4]||(H[4]=[Wr("h1",{class:"title"},"2 ",-1)])),_:1}),st(Zg,{cols:"12"},{default:An(()=>[st(l0,{cover:"",src:"https://mod.3dmgame.com/static/upload/logo/croppedImg_67e41b904f5c9.jpg"})]),_:1})],64)),st(Zg,{cols:"12",class:"buttons"},{default:An(()=>[Wr("div",null,[st(ee,{onClick:G},{default:An(()=>H[5]||(H[5]=[Ru("")])),_:1}),st(ee,{onClick:i},{default:An(()=>H[6]||(H[6]=[Ru("")])),_:1})]),Wr("div",null,[st(ne,{modelValue:xt(p).showName,"onUpdate:modelValue":H[0]||(H[0]=Ie=>xt(p).showName=Ie),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":""},null,8,["modelValue"])])]),_:1}),st(Zg,{cols:"12"},{default:An(()=>[st(_e,{modelValue:xt(v),"onUpdate:modelValue":H[1]||(H[1]=Ie=>Yn(v)?v.value=Ie:null),placeholder:"",onInput:R},{append:An(()=>[st(ee,null,{default:An(()=>[st(he,null,{default:An(()=>[st(de)]),_:1})]),_:1})]),_:1},8,["modelValue"]),(Kt(!0),Nr(ti,null,aS(xt(A),Ie=>(Kt(),Nr("div",YU,[Wr("h3",JU,Vs(Ie.name),1),Wr("div",QU,[(Kt(!0),Nr(ti,null,aS(Ie.list,je=>(Kt(),Cn(V8,{class:kn(["type-list",{unshow:xt(p).unshowMarks.includes(je.id)}]),variant:"text",label:"",onClick:vt=>D(je)},{prepend:An(()=>[st(Pm,{image:je.mark_type_icon,size:"25"},null,8,["image"])]),append:An(()=>[Wr("span",tj,Vs(Ie.total),1)]),default:An(()=>[Wr("span",ej,Vs(je.mark_type_name),1)]),_:2},1032,["onClick","class"]))),256))])]))),256))]),_:1})]),_:1})]),_:1}),W.$vuetify.display.mobile?In("",!0):(Kt(),Nr("div",{key:0,class:"sidebar-close",onClick:H[2]||(H[2]=Ie=>xt(l).drawer=!xt(l).drawer)},[xt(l).drawer?(Kt(),Cn(Qs,{key:0},{default:An(()=>H[7]||(H[7]=[Ru("mdi-chevron-double-left")])),_:1})):(Kt(),Cn(Qs,{key:1},{default:An(()=>H[8]||(H[8]=[Ru("mdi-chevron-double-right")])),_:1}))]))]),_:1},8,["modelValue","location","mobile"])}}}),ij=km(nj,[["__scopeId","data-v-6a839f8b"]]),sj={name:"DefaultLayout"},oj=ln({...Ei(),...Zd(),...NU()},"VLayout"),aj=si()({name:"VLayout",props:oj(),setup(r,l){let{slots:p}=l;const{layoutClasses:v,layoutStyles:A,getLayoutItem:R,items:D,layoutRef:i}=GU(r),{dimensionStyles:G}=Xd(r);return Bi(()=>{var W;return st("div",{ref:i,class:[v.value,r.class],style:[G.value,A.value,r.style]},[(W=p.default)==null?void 0:W.call(p)])}),{getLayoutItem:R,items:D}}}),lj=ln({scrollable:Boolean,...Ei(),...Zd(),...vs({tag:"main"})},"VMain"),cj=si()({name:"VMain",props:lj(),setup(r,l){let{slots:p}=l;const{dimensionStyles:v}=Xd(r),{mainStyles:A}=UU(),{ssrBootStyles:R}=$3();return Bi(()=>st(r.tag,{class:["v-main",{"v-main--scrollable":r.scrollable},r.class],style:[A.value,R.value,v.value,r.style]},{default:()=>{var D,i;return[r.scrollable?st("div",{class:"v-main__scroller"},[(D=p.default)==null?void 0:D.call(p)]):(i=p.default)==null?void 0:i.call(p)]}})),{}}});function uj(r,l,p,v,A,R){const D=ij,i=q5,G=EM("RouterView"),W=U5;return Kt(),Cn(aj,null,{default:An(()=>[st(D),st(cj,null,{default:An(()=>[st(j8,{style:{padding:"0"},fluid:""},{default:An(()=>[r.$vuetify.display.mobile?(Kt(),Cn(i,{key:0})):In("",!0),st(G),r.$vuetify.display.mobile?(Kt(),Cn(W,{key:1})):In("",!0)]),_:1})]),_:1})]),_:1})}const hj=km(sj,[["render",uj]]),zA={default:hj};function dj(r){function l(p,v=!0){return p.map(A=>{var R,D,i,G,W,H;if(((R=A.children)==null?void 0:R.length)>0&&(A.children=l(A.children,!1)),v){if(!A.component&&((D=A.children)==null?void 0:D.find(ne=>{var de;return(ne.path===""||ne.path==="/")&&((de=ne.meta)==null?void 0:de.isLayout)})))return A;if(((i=A.meta)==null?void 0:i.layout)!==!1)return{path:A.path,component:zA[((G=A.meta)==null?void 0:G.layout)||"default"],children:A.path==="/"?[A]:[{...A,path:""}],meta:{isLayout:!0}}}return(W=A.meta)!=null&&W.layout?{path:A.path,component:zA[(H=A.meta)==null?void 0:H.layout],children:[{...A,path:""}],meta:{isLayout:!0}}:A})}return l(r)}const fj=AO({history:tO("/"),routes:dj(RO)});function G3(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{blueprint:l,...p}=r,v=gs(l,p),{aliases:A={},components:R={},directives:D={}}=v,i=KF(v.defaults),G=C8(v.display,v.ssr),W=r5(v.theme),H=h5(v.icons),ee=x5(v.locale),ne=FU(v.date,ee),de=R8(v.goTo,ee);return{install:_e=>{for(const Ie in D)_e.directive(Ie,D[Ie]);for(const Ie in R)_e.component(Ie,R[Ie]);for(const Ie in A)_e.component(Ie,Vm({...A[Ie],name:Ie,aliasName:A[Ie].name}));if(W.install(_e),_e.provide(Fd,i),_e.provide(p1,G),_e.provide(by,W),_e.provide(c1,H),_e.provide(Sy,ee),_e.provide(kU,ne.options),_e.provide(RA,ne.instance),_e.provide(P3,de),_s&&v.ssr)if(_e.$nuxt)_e.$nuxt.hook("app:suspense:resolve",()=>{G.update()});else{const{mount:Ie}=_e;_e.mount=function(){const je=Ie(...arguments);return Bs(()=>G.update()),_e.mount=Ie,je}}Jy.reset(),_e.mixin({computed:{$vuetify(){return Ki({defaults:bd.call(this,Fd),display:bd.call(this,p1),theme:bd.call(this,by),icons:bd.call(this,c1),locale:bd.call(this,Sy),date:bd.call(this,RA)})}}})},defaults:i,display:G,theme:W,icons:H,locale:ee,date:ne,goTo:de}}const pj="3.7.18";G3.version=pj;function bd(r){var v,A;const l=this.$,p=((v=l.parent)==null?void 0:v.provides)??((A=l.vnode.appContext)==null?void 0:A.provides);if(p&&r in p)return p[r]}const mj=G3({theme:{defaultTheme:"dark"}}),u0=fL(SL);u0.use(_L());u0.use(mj);u0.use(fj);u0.mount("#app");export{ti as $,s$ as A,Jd as B,pn as C,Pn as D,Tc as E,fN as F,dn as G,et as H,Ua as I,Pd as J,Si as K,Yd as L,d6 as M,Cn as N,Kt as O,An as P,Dd as Q,Wr as R,Sc as S,kn as T,xt as U,Vu as V,nI as W,Om as X,Nr as Y,st as Z,Xm as _,Ay as a,Gj as a$,Bu as a0,m3 as a1,Nu as a2,l3 as a3,Tn as a4,nN as a5,Bs as a6,vo as a7,Ki as a8,bM as a9,gj as aA,SM as aB,FC as aC,bV as aD,Zj as aE,wV as aF,Vd as aG,wM as aH,Vs as aI,Ru as aJ,vm as aK,IM as aL,Im as aM,vN as aN,lI as aO,Js as aP,c$ as aQ,u$ as aR,aS,z1 as aT,F6 as aU,AN as aV,i3 as aW,Nd as aX,a0 as aY,pb as aZ,Yj as a_,fa as aa,D1 as ab,In as ac,la as ad,mo as ae,Un as af,o0 as ag,yo as ah,wc as ai,Ud as aj,Ns as ak,gc as al,$j as am,ZC as an,ys as ao,qn as ap,Vn as aq,WC as ar,pN as as,_3 as at,s0 as au,r3 as av,$s as aw,Zr as ax,oy as ay,Vr as az,OB as b,OA as b$,zn as b0,mb as b1,g3 as b2,DV as b3,Yn as b4,xj as b5,O6 as b6,Fy as b7,bj as b8,bl as b9,r$ as bA,n$ as bB,Oy as bC,i$ as bD,hb as bE,sy as bF,Wj as bG,fb as bH,Hj as bI,e$ as bJ,U1 as bK,fV as bL,C1 as bM,b$ as bN,m$ as bO,x1 as bP,T$ as bQ,w$ as bR,v$ as bS,x$ as bT,uA as bU,vV as bV,_j as bW,S4 as bX,qj as bY,lV as bZ,Z6 as b_,EM as ba,db as bb,h$ as bc,Mc as bd,jj as be,Vz as bf,n3 as bg,h3 as bh,Jj as bi,Wz as bj,Qj as bk,EV as bl,ay as bm,RV as bn,yj as bo,u3 as bp,l$ as bq,hL as br,vj as bs,Xj as bt,Hn as bu,Hu as bv,TV as bw,n8 as bx,yc as by,S$ as bz,BB as c,O1 as c0,ux as c1,Kj as c2,y$ as c3,LV as c4,a$ as c5,rM as c6,t$ as c7,A$ as c8,E$ as c9,wj as ca,o$ as cb,i8 as cc,eC as cd,p$ as ce,f$ as cf,_$ as cg,g$ as ch,km as ci,Tj as cj,DO as ck,II as cl,E8 as cm,x8 as cn,Qs as co,d$ as cp,E3 as cq,V8 as cr,g8 as cs,C3 as ct,KU as cu,UB as d,hB as e,ob as f,lb as g,sb as h,ab as i,Z5 as j,$C as k,VC as l,Wm as m,qu as n,A6 as o,UC as p,WB as q,ib as r,ub as s,mB as t,HC as u,D6 as v,GC as w,oB as x,qC as y,Wu as z};

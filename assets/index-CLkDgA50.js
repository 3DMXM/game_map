const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-1s7vx9Id.js","assets/index-D5ccndEx.css"])))=>i.map(i=>d[i]);
(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const A of document.querySelectorAll('link[rel="modulepreload"]'))v(A);new MutationObserver(A=>{for(const R of A)if(R.type==="childList")for(const D of R.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&v(D)}).observe(document,{childList:!0,subtree:!0});function p(A){const R={};return A.integrity&&(R.integrity=A.integrity),A.referrerPolicy&&(R.referrerPolicy=A.referrerPolicy),A.crossOrigin==="use-credentials"?R.credentials="include":A.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function v(A){if(A.ep)return;A.ep=!0;const R=p(A);fetch(A.href,R)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function o1(n){const l=Object.create(null);for(const p of n.split(","))l[p]=1;return p=>p in l}const ni={},bd=[],_o=()=>{},LD=()=>!1,gy=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),a1=n=>n.startsWith("onUpdate:"),Gi=Object.assign,l1=(n,l)=>{const p=n.indexOf(l);p>-1&&n.splice(p,1)},OD=Object.prototype.hasOwnProperty,Gn=(n,l)=>OD.call(n,l),Nr=Array.isArray,wd=n=>Am(n)==="[object Map]",yy=n=>Am(n)==="[object Set]",jT=n=>Am(n)==="[object Date]",Zr=n=>typeof n=="function",Hn=n=>typeof n=="string",ca=n=>typeof n=="symbol",Vn=n=>n!==null&&typeof n=="object",Xg=n=>(Vn(n)||Zr(n))&&Zr(n.then)&&Zr(n.catch),SA=Object.prototype.toString,Am=n=>SA.call(n),kD=n=>Am(n).slice(8,-1),EA=n=>Am(n)==="[object Object]",c1=n=>Hn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Yp=o1(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),vy=n=>{const l=Object.create(null);return p=>l[p]||(l[p]=n(p))},FD=/-(\w)/g,Fs=vy(n=>n.replace(FD,(l,p)=>p?p.toUpperCase():"")),BD=/\B([A-Z])/g,Sc=vy(n=>n.replace(BD,"-$1").toLowerCase()),Ec=vy(n=>n.charAt(0).toUpperCase()+n.slice(1)),Qv=vy(n=>n?`on${Ec(n)}`:""),yc=(n,l)=>!Object.is(n,l),Bg=(n,...l)=>{for(let p=0;p<n.length;p++)n[p](...l)},AA=(n,l,p,v=!1)=>{Object.defineProperty(n,l,{configurable:!0,enumerable:!1,writable:v,value:p})},Ex=n=>{const l=parseFloat(n);return isNaN(l)?n:l},ND=n=>{const l=Hn(n)?Number(n):NaN;return isNaN(l)?n:l};let $T;const xy=()=>$T||($T=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ou(n){if(Nr(n)){const l={};for(let p=0;p<n.length;p++){const v=n[p],A=Hn(v)?$D(v):Ou(v);if(A)for(const R in A)l[R]=A[R]}return l}else if(Hn(n)||Vn(n))return n}const VD=/;(?![^(]*\))/g,UD=/:([^]+)/,jD=/\/\*[^]*?\*\//g;function $D(n){const l={};return n.replace(jD,"").split(VD).forEach(p=>{if(p){const v=p.split(UD);v.length>1&&(l[v[0].trim()]=v[1].trim())}}),l}function Ln(n){let l="";if(Hn(n))l=n;else if(Nr(n))for(let p=0;p<n.length;p++){const v=Ln(n[p]);v&&(l+=v+" ")}else if(Vn(n))for(const p in n)n[p]&&(l+=p+" ");return l.trim()}function YU(n){if(!n)return null;let{class:l,style:p}=n;return l&&!Hn(l)&&(n.class=Ln(l)),p&&(n.style=Ou(p)),n}const GD="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",HD=o1(GD);function MA(n){return!!n||n===""}function qD(n,l){if(n.length!==l.length)return!1;let p=!0;for(let v=0;p&&v<n.length;v++)p=Md(n[v],l[v]);return p}function Md(n,l){if(n===l)return!0;let p=jT(n),v=jT(l);if(p||v)return p&&v?n.getTime()===l.getTime():!1;if(p=ca(n),v=ca(l),p||v)return n===l;if(p=Nr(n),v=Nr(l),p||v)return p&&v?qD(n,l):!1;if(p=Vn(n),v=Vn(l),p||v){if(!p||!v)return!1;const A=Object.keys(n).length,R=Object.keys(l).length;if(A!==R)return!1;for(const D in n){const i=n.hasOwnProperty(D),G=l.hasOwnProperty(D);if(i&&!G||!i&&G||!Md(n[D],l[D]))return!1}}return String(n)===String(l)}function IA(n,l){return n.findIndex(p=>Md(p,l))}const CA=n=>!!(n&&n.__v_isRef===!0),Xs=n=>Hn(n)?n:n==null?"":Nr(n)||Vn(n)&&(n.toString===SA||!Zr(n.toString))?CA(n)?Xs(n.value):JSON.stringify(n,PA,2):String(n),PA=(n,l)=>CA(l)?PA(n,l.value):wd(l)?{[`Map(${l.size})`]:[...l.entries()].reduce((p,[v,A],R)=>(p[ex(v,R)+" =>"]=A,p),{})}:yy(l)?{[`Set(${l.size})`]:[...l.values()].map(p=>ex(p))}:ca(l)?ex(l):Vn(l)&&!Nr(l)&&!EA(l)?String(l):l,ex=(n,l="")=>{var p;return ca(n)?`Symbol(${(p=n.description)!=null?p:l})`:n};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ls;class RA{constructor(l=!1){this.detached=l,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ls,!l&&Ls&&(this.index=(Ls.scopes||(Ls.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let l,p;if(this.scopes)for(l=0,p=this.scopes.length;l<p;l++)this.scopes[l].pause();for(l=0,p=this.effects.length;l<p;l++)this.effects[l].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let l,p;if(this.scopes)for(l=0,p=this.scopes.length;l<p;l++)this.scopes[l].resume();for(l=0,p=this.effects.length;l<p;l++)this.effects[l].resume()}}run(l){if(this._active){const p=Ls;try{return Ls=this,l()}finally{Ls=p}}}on(){Ls=this}off(){Ls=this.parent}stop(l){if(this._active){this._active=!1;let p,v;for(p=0,v=this.effects.length;p<v;p++)this.effects[p].stop();for(this.effects.length=0,p=0,v=this.cleanups.length;p<v;p++)this.cleanups[p]();if(this.cleanups.length=0,this.scopes){for(p=0,v=this.scopes.length;p<v;p++)this.scopes[p].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!l){const A=this.parent.scopes.pop();A&&A!==this&&(this.parent.scopes[this.index]=A,A.index=this.index)}this.parent=void 0}}}function u1(n){return new RA(n)}function h1(){return Ls}function by(n,l=!1){Ls&&Ls.cleanups.push(n)}let si;const tx=new WeakSet;class DA{constructor(l){this.fn=l,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ls&&Ls.active&&Ls.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,tx.has(this)&&(tx.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||LA(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,GT(this),OA(this);const l=si,p=la;si=this,la=!0;try{return this.fn()}finally{kA(this),si=l,la=p,this.flags&=-3}}stop(){if(this.flags&1){for(let l=this.deps;l;l=l.nextDep)p1(l);this.deps=this.depsTail=void 0,GT(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?tx.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Ax(this)&&this.run()}get dirty(){return Ax(this)}}let zA=0,Jp,Qp;function LA(n,l=!1){if(n.flags|=8,l){n.next=Qp,Qp=n;return}n.next=Jp,Jp=n}function d1(){zA++}function f1(){if(--zA>0)return;if(Qp){let l=Qp;for(Qp=void 0;l;){const p=l.next;l.next=void 0,l.flags&=-9,l=p}}let n;for(;Jp;){let l=Jp;for(Jp=void 0;l;){const p=l.next;if(l.next=void 0,l.flags&=-9,l.flags&1)try{l.trigger()}catch(v){n||(n=v)}l=p}}if(n)throw n}function OA(n){for(let l=n.deps;l;l=l.nextDep)l.version=-1,l.prevActiveLink=l.dep.activeLink,l.dep.activeLink=l}function kA(n){let l,p=n.depsTail,v=p;for(;v;){const A=v.prevDep;v.version===-1?(v===p&&(p=A),p1(v),WD(v)):l=v,v.dep.activeLink=v.prevActiveLink,v.prevActiveLink=void 0,v=A}n.deps=l,n.depsTail=p}function Ax(n){for(let l=n.deps;l;l=l.nextDep)if(l.dep.version!==l.version||l.dep.computed&&(FA(l.dep.computed)||l.dep.version!==l.version))return!0;return!!n._dirty}function FA(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===am))return;n.globalVersion=am;const l=n.dep;if(n.flags|=2,l.version>0&&!n.isSSR&&n.deps&&!Ax(n)){n.flags&=-3;return}const p=si,v=la;si=n,la=!0;try{OA(n);const A=n.fn(n._value);(l.version===0||yc(A,n._value))&&(n._value=A,l.version++)}catch(A){throw l.version++,A}finally{si=p,la=v,kA(n),n.flags&=-3}}function p1(n,l=!1){const{dep:p,prevSub:v,nextSub:A}=n;if(v&&(v.nextSub=A,n.prevSub=void 0),A&&(A.prevSub=v,n.nextSub=void 0),p.subs===n&&(p.subs=v,!v&&p.computed)){p.computed.flags&=-5;for(let R=p.computed.deps;R;R=R.nextDep)p1(R,!0)}!l&&!--p.sc&&p.map&&p.map.delete(p.key)}function WD(n){const{prevDep:l,nextDep:p}=n;l&&(l.nextDep=p,n.prevDep=void 0),p&&(p.prevDep=l,n.nextDep=void 0)}let la=!0;const BA=[];function Ac(){BA.push(la),la=!1}function Mc(){const n=BA.pop();la=n===void 0?!0:n}function GT(n){const{cleanup:l}=n;if(n.cleanup=void 0,l){const p=si;si=void 0;try{l()}finally{si=p}}}let am=0;class ZD{constructor(l,p){this.sub=l,this.dep=p,this.version=p.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class m1{constructor(l){this.computed=l,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(l){if(!si||!la||si===this.computed)return;let p=this.activeLink;if(p===void 0||p.sub!==si)p=this.activeLink=new ZD(si,this),si.deps?(p.prevDep=si.depsTail,si.depsTail.nextDep=p,si.depsTail=p):si.deps=si.depsTail=p,NA(p);else if(p.version===-1&&(p.version=this.version,p.nextDep)){const v=p.nextDep;v.prevDep=p.prevDep,p.prevDep&&(p.prevDep.nextDep=v),p.prevDep=si.depsTail,p.nextDep=void 0,si.depsTail.nextDep=p,si.depsTail=p,si.deps===p&&(si.deps=v)}return p}trigger(l){this.version++,am++,this.notify(l)}notify(l){d1();try{for(let p=this.subs;p;p=p.prevSub)p.sub.notify()&&p.sub.dep.notify()}finally{f1()}}}function NA(n){if(n.dep.sc++,n.sub.flags&4){const l=n.dep.computed;if(l&&!n.dep.subs){l.flags|=20;for(let v=l.deps;v;v=v.nextDep)NA(v)}const p=n.dep.subs;p!==n&&(n.prevSub=p,p&&(p.nextSub=n)),n.dep.subs=n}}const Kg=new WeakMap,Cu=Symbol(""),Mx=Symbol(""),lm=Symbol("");function hs(n,l,p){if(la&&si){let v=Kg.get(n);v||Kg.set(n,v=new Map);let A=v.get(p);A||(v.set(p,A=new m1),A.map=v,A.key=p),A.track()}}function pl(n,l,p,v,A,R){const D=Kg.get(n);if(!D){am++;return}const i=G=>{G&&G.trigger()};if(d1(),l==="clear")D.forEach(i);else{const G=Nr(n),W=G&&c1(p);if(G&&p==="length"){const H=Number(v);D.forEach((ee,ne)=>{(ne==="length"||ne===lm||!ca(ne)&&ne>=H)&&i(ee)})}else switch((p!==void 0||D.has(void 0))&&i(D.get(p)),W&&i(D.get(lm)),l){case"add":G?W&&i(D.get("length")):(i(D.get(Cu)),wd(n)&&i(D.get(Mx)));break;case"delete":G||(i(D.get(Cu)),wd(n)&&i(D.get(Mx)));break;case"set":wd(n)&&i(D.get(Cu));break}}f1()}function XD(n,l){const p=Kg.get(n);return p&&p.get(l)}function dd(n){const l=Rn(n);return l===n?l:(hs(l,"iterate",lm),Fo(n)?l:l.map(ds))}function wy(n){return hs(n=Rn(n),"iterate",lm),n}const KD={__proto__:null,[Symbol.iterator](){return rx(this,Symbol.iterator,ds)},concat(...n){return dd(this).concat(...n.map(l=>Nr(l)?dd(l):l))},entries(){return rx(this,"entries",n=>(n[1]=ds(n[1]),n))},every(n,l){return ul(this,"every",n,l,void 0,arguments)},filter(n,l){return ul(this,"filter",n,l,p=>p.map(ds),arguments)},find(n,l){return ul(this,"find",n,l,ds,arguments)},findIndex(n,l){return ul(this,"findIndex",n,l,void 0,arguments)},findLast(n,l){return ul(this,"findLast",n,l,ds,arguments)},findLastIndex(n,l){return ul(this,"findLastIndex",n,l,void 0,arguments)},forEach(n,l){return ul(this,"forEach",n,l,void 0,arguments)},includes(...n){return nx(this,"includes",n)},indexOf(...n){return nx(this,"indexOf",n)},join(n){return dd(this).join(n)},lastIndexOf(...n){return nx(this,"lastIndexOf",n)},map(n,l){return ul(this,"map",n,l,void 0,arguments)},pop(){return $p(this,"pop")},push(...n){return $p(this,"push",n)},reduce(n,...l){return HT(this,"reduce",n,l)},reduceRight(n,...l){return HT(this,"reduceRight",n,l)},shift(){return $p(this,"shift")},some(n,l){return ul(this,"some",n,l,void 0,arguments)},splice(...n){return $p(this,"splice",n)},toReversed(){return dd(this).toReversed()},toSorted(n){return dd(this).toSorted(n)},toSpliced(...n){return dd(this).toSpliced(...n)},unshift(...n){return $p(this,"unshift",n)},values(){return rx(this,"values",ds)}};function rx(n,l,p){const v=wy(n),A=v[l]();return v!==n&&!Fo(n)&&(A._next=A.next,A.next=()=>{const R=A._next();return R.value&&(R.value=p(R.value)),R}),A}const YD=Array.prototype;function ul(n,l,p,v,A,R){const D=wy(n),i=D!==n&&!Fo(n),G=D[l];if(G!==YD[l]){const ee=G.apply(n,R);return i?ds(ee):ee}let W=p;D!==n&&(i?W=function(ee,ne){return p.call(this,ds(ee),ne,n)}:p.length>2&&(W=function(ee,ne){return p.call(this,ee,ne,n)}));const H=G.call(D,W,v);return i&&A?A(H):H}function HT(n,l,p,v){const A=wy(n);let R=p;return A!==n&&(Fo(n)?p.length>3&&(R=function(D,i,G){return p.call(this,D,i,G,n)}):R=function(D,i,G){return p.call(this,D,ds(i),G,n)}),A[l](R,...v)}function nx(n,l,p){const v=Rn(n);hs(v,"iterate",lm);const A=v[l](...p);return(A===-1||A===!1)&&y1(p[0])?(p[0]=Rn(p[0]),v[l](...p)):A}function $p(n,l,p=[]){Ac(),d1();const v=Rn(n)[l].apply(n,p);return f1(),Mc(),v}const JD=o1("__proto__,__v_isRef,__isVue"),VA=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(ca));function QD(n){ca(n)||(n=String(n));const l=Rn(this);return hs(l,"has",n),l.hasOwnProperty(n)}class UA{constructor(l=!1,p=!1){this._isReadonly=l,this._isShallow=p}get(l,p,v){if(p==="__v_skip")return l.__v_skip;const A=this._isReadonly,R=this._isShallow;if(p==="__v_isReactive")return!A;if(p==="__v_isReadonly")return A;if(p==="__v_isShallow")return R;if(p==="__v_raw")return v===(A?R?cz:HA:R?GA:$A).get(l)||Object.getPrototypeOf(l)===Object.getPrototypeOf(v)?l:void 0;const D=Nr(l);if(!A){let G;if(D&&(G=KD[p]))return G;if(p==="hasOwnProperty")return QD}const i=Reflect.get(l,p,Yn(l)?l:v);return(ca(p)?VA.has(p):JD(p))||(A||hs(l,"get",p),R)?i:Yn(i)?D&&c1(p)?i:i.value:Vn(i)?A?Od(i):Zi(i):i}}class jA extends UA{constructor(l=!1){super(!1,l)}set(l,p,v,A){let R=l[p];if(!this._isShallow){const G=ku(R);if(!Fo(v)&&!ku(v)&&(R=Rn(R),v=Rn(v)),!Nr(l)&&Yn(R)&&!Yn(v))return G?!1:(R.value=v,!0)}const D=Nr(l)&&c1(p)?Number(p)<l.length:Gn(l,p),i=Reflect.set(l,p,v,Yn(l)?l:A);return l===Rn(A)&&(D?yc(v,R)&&pl(l,"set",p,v):pl(l,"add",p,v)),i}deleteProperty(l,p){const v=Gn(l,p);l[p];const A=Reflect.deleteProperty(l,p);return A&&v&&pl(l,"delete",p,void 0),A}has(l,p){const v=Reflect.has(l,p);return(!ca(p)||!VA.has(p))&&hs(l,"has",p),v}ownKeys(l){return hs(l,"iterate",Nr(l)?"length":Cu),Reflect.ownKeys(l)}}class ez extends UA{constructor(l=!1){super(!0,l)}set(l,p){return!0}deleteProperty(l,p){return!0}}const tz=new jA,rz=new ez,nz=new jA(!0);const Ix=n=>n,Eg=n=>Reflect.getPrototypeOf(n);function iz(n,l,p){return function(...v){const A=this.__v_raw,R=Rn(A),D=wd(R),i=n==="entries"||n===Symbol.iterator&&D,G=n==="keys"&&D,W=A[n](...v),H=p?Ix:l?Cx:ds;return!l&&hs(R,"iterate",G?Mx:Cu),{next(){const{value:ee,done:ne}=W.next();return ne?{value:ee,done:ne}:{value:i?[H(ee[0]),H(ee[1])]:H(ee),done:ne}},[Symbol.iterator](){return this}}}}function Ag(n){return function(...l){return n==="delete"?!1:n==="clear"?void 0:this}}function sz(n,l){const p={get(A){const R=this.__v_raw,D=Rn(R),i=Rn(A);n||(yc(A,i)&&hs(D,"get",A),hs(D,"get",i));const{has:G}=Eg(D),W=l?Ix:n?Cx:ds;if(G.call(D,A))return W(R.get(A));if(G.call(D,i))return W(R.get(i));R!==D&&R.get(A)},get size(){const A=this.__v_raw;return!n&&hs(Rn(A),"iterate",Cu),Reflect.get(A,"size",A)},has(A){const R=this.__v_raw,D=Rn(R),i=Rn(A);return n||(yc(A,i)&&hs(D,"has",A),hs(D,"has",i)),A===i?R.has(A):R.has(A)||R.has(i)},forEach(A,R){const D=this,i=D.__v_raw,G=Rn(i),W=l?Ix:n?Cx:ds;return!n&&hs(G,"iterate",Cu),i.forEach((H,ee)=>A.call(R,W(H),W(ee),D))}};return Gi(p,n?{add:Ag("add"),set:Ag("set"),delete:Ag("delete"),clear:Ag("clear")}:{add(A){!l&&!Fo(A)&&!ku(A)&&(A=Rn(A));const R=Rn(this);return Eg(R).has.call(R,A)||(R.add(A),pl(R,"add",A,A)),this},set(A,R){!l&&!Fo(R)&&!ku(R)&&(R=Rn(R));const D=Rn(this),{has:i,get:G}=Eg(D);let W=i.call(D,A);W||(A=Rn(A),W=i.call(D,A));const H=G.call(D,A);return D.set(A,R),W?yc(R,H)&&pl(D,"set",A,R):pl(D,"add",A,R),this},delete(A){const R=Rn(this),{has:D,get:i}=Eg(R);let G=D.call(R,A);G||(A=Rn(A),G=D.call(R,A)),i&&i.call(R,A);const W=R.delete(A);return G&&pl(R,"delete",A,void 0),W},clear(){const A=Rn(this),R=A.size!==0,D=A.clear();return R&&pl(A,"clear",void 0,void 0),D}}),["keys","values","entries",Symbol.iterator].forEach(A=>{p[A]=iz(A,n,l)}),p}function _1(n,l){const p=sz(n,l);return(v,A,R)=>A==="__v_isReactive"?!n:A==="__v_isReadonly"?n:A==="__v_raw"?v:Reflect.get(Gn(p,A)&&A in v?p:v,A,R)}const oz={get:_1(!1,!1)},az={get:_1(!1,!0)},lz={get:_1(!0,!1)};const $A=new WeakMap,GA=new WeakMap,HA=new WeakMap,cz=new WeakMap;function uz(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function hz(n){return n.__v_skip||!Object.isExtensible(n)?0:uz(kD(n))}function Zi(n){return ku(n)?n:g1(n,!1,tz,oz,$A)}function qA(n){return g1(n,!1,nz,az,GA)}function Od(n){return g1(n,!0,rz,lz,HA)}function g1(n,l,p,v,A){if(!Vn(n)||n.__v_raw&&!(l&&n.__v_isReactive))return n;const R=A.get(n);if(R)return R;const D=hz(n);if(D===0)return n;const i=new Proxy(n,D===2?v:p);return A.set(n,i),i}function vc(n){return ku(n)?vc(n.__v_raw):!!(n&&n.__v_isReactive)}function ku(n){return!!(n&&n.__v_isReadonly)}function Fo(n){return!!(n&&n.__v_isShallow)}function y1(n){return n?!!n.__v_raw:!1}function Rn(n){const l=n&&n.__v_raw;return l?Rn(l):n}function v1(n){return!Gn(n,"__v_skip")&&Object.isExtensible(n)&&AA(n,"__v_skip",!0),n}const ds=n=>Vn(n)?Zi(n):n,Cx=n=>Vn(n)?Od(n):n;function Yn(n){return n?n.__v_isRef===!0:!1}function hn(n){return WA(n,!1)}function Nn(n){return WA(n,!0)}function WA(n,l){return Yn(n)?n:new dz(n,l)}class dz{constructor(l,p){this.dep=new m1,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=p?l:Rn(l),this._value=p?l:ds(l),this.__v_isShallow=p}get value(){return this.dep.track(),this._value}set value(l){const p=this._rawValue,v=this.__v_isShallow||Fo(l)||ku(l);l=v?l:Rn(l),yc(l,p)&&(this._rawValue=l,this._value=v?l:ds(l),this.dep.trigger())}}function vt(n){return Yn(n)?n.value:n}const fz={get:(n,l,p)=>l==="__v_raw"?n:vt(Reflect.get(n,l,p)),set:(n,l,p,v)=>{const A=n[l];return Yn(A)&&!Yn(p)?(A.value=p,!0):Reflect.set(n,l,p,v)}};function ZA(n){return vc(n)?n:new Proxy(n,fz)}function Ty(n){const l=Nr(n)?new Array(n.length):{};for(const p in n)l[p]=XA(n,p);return l}class pz{constructor(l,p,v){this._object=l,this._key=p,this._defaultValue=v,this.__v_isRef=!0,this._value=void 0}get value(){const l=this._object[this._key];return this._value=l===void 0?this._defaultValue:l}set value(l){this._object[this._key]=l}get dep(){return XD(Rn(this._object),this._key)}}class mz{constructor(l){this._getter=l,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function ps(n,l,p){return Yn(n)?n:Zr(n)?new mz(n):Vn(n)&&arguments.length>1?XA(n,l,p):hn(n)}function XA(n,l,p){const v=n[l];return Yn(v)?v:new pz(n,l,p)}class _z{constructor(l,p,v){this.fn=l,this.setter=p,this._value=void 0,this.dep=new m1(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=am-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!p,this.isSSR=v}notify(){if(this.flags|=16,!(this.flags&8)&&si!==this)return LA(this,!0),!0}get value(){const l=this.dep.track();return FA(this),l&&(l.version=this.dep.version),this._value}set value(l){this.setter&&this.setter(l)}}function gz(n,l,p=!1){let v,A;return Zr(n)?v=n:(v=n.get,A=n.set),new _z(v,A,p)}const Mg={},Yg=new WeakMap;let Eu;function yz(n,l=!1,p=Eu){if(p){let v=Yg.get(p);v||Yg.set(p,v=[]),v.push(n)}}function vz(n,l,p=ni){const{immediate:v,deep:A,once:R,scheduler:D,augmentJob:i,call:G}=p,W=ut=>A?ut:Fo(ut)||A===!1||A===0?ml(ut,1):ml(ut);let H,ee,ne,de,he=!1,ye=!1;if(Yn(n)?(ee=()=>n.value,he=Fo(n)):vc(n)?(ee=()=>W(n),he=!0):Nr(n)?(ye=!0,he=n.some(ut=>vc(ut)||Fo(ut)),ee=()=>n.map(ut=>{if(Yn(ut))return ut.value;if(vc(ut))return W(ut);if(Zr(ut))return G?G(ut,2):ut()})):Zr(n)?l?ee=G?()=>G(n,2):n:ee=()=>{if(ne){Ac();try{ne()}finally{Mc()}}const ut=Eu;Eu=H;try{return G?G(n,3,[de]):n(de)}finally{Eu=ut}}:ee=_o,l&&A){const ut=ee,ht=A===!0?1/0:A;ee=()=>ml(ut(),ht)}const Le=h1(),je=()=>{H.stop(),Le&&Le.active&&l1(Le.effects,H)};if(R&&l){const ut=l;l=(...ht)=>{ut(...ht),je()}}let xt=ye?new Array(n.length).fill(Mg):Mg;const Dt=ut=>{if(!(!(H.flags&1)||!H.dirty&&!ut))if(l){const ht=H.run();if(A||he||(ye?ht.some((Et,tt)=>yc(Et,xt[tt])):yc(ht,xt))){ne&&ne();const Et=Eu;Eu=H;try{const tt=[ht,xt===Mg?void 0:ye&&xt[0]===Mg?[]:xt,de];G?G(l,3,tt):l(...tt),xt=ht}finally{Eu=Et}}}else H.run()};return i&&i(Dt),H=new DA(ee),H.scheduler=D?()=>D(Dt,!1):Dt,de=ut=>yz(ut,!1,H),ne=H.onStop=()=>{const ut=Yg.get(H);if(ut){if(G)G(ut,4);else for(const ht of ut)ht();Yg.delete(H)}},l?v?Dt(!0):xt=H.run():D?D(Dt.bind(null,!0),!0):H.run(),je.pause=H.pause.bind(H),je.resume=H.resume.bind(H),je.stop=je,je}function ml(n,l=1/0,p){if(l<=0||!Vn(n)||n.__v_skip||(p=p||new Set,p.has(n)))return n;if(p.add(n),l--,Yn(n))ml(n.value,l,p);else if(Nr(n))for(let v=0;v<n.length;v++)ml(n[v],l,p);else if(yy(n)||wd(n))n.forEach(v=>{ml(v,l,p)});else if(EA(n)){for(const v in n)ml(n[v],l,p);for(const v of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,v)&&ml(n[v],l,p)}return n}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Mm(n,l,p,v){try{return v?n(...v):n()}catch(A){Sy(A,l,p)}}function ua(n,l,p,v){if(Zr(n)){const A=Mm(n,l,p,v);return A&&Xg(A)&&A.catch(R=>{Sy(R,l,p)}),A}if(Nr(n)){const A=[];for(let R=0;R<n.length;R++)A.push(ua(n[R],l,p,v));return A}}function Sy(n,l,p,v=!0){const A=l?l.vnode:null,{errorHandler:R,throwUnhandledErrorInProduction:D}=l&&l.appContext.config||ni;if(l){let i=l.parent;const G=l.proxy,W=`https://vuejs.org/error-reference/#runtime-${p}`;for(;i;){const H=i.ec;if(H){for(let ee=0;ee<H.length;ee++)if(H[ee](n,G,W)===!1)return}i=i.parent}if(R){Ac(),Mm(R,null,10,[n,G,W]),Mc();return}}xz(n,p,A,v,D)}function xz(n,l,p,v=!0,A=!1){if(A)throw n;console.error(n)}const Os=[];let Fa=-1;const Td=[];let uc=null,yd=0;const KA=Promise.resolve();let Jg=null;function Zs(n){const l=Jg||KA;return n?l.then(this?n.bind(this):n):l}function bz(n){let l=Fa+1,p=Os.length;for(;l<p;){const v=l+p>>>1,A=Os[v],R=cm(A);R<n||R===n&&A.flags&2?l=v+1:p=v}return l}function x1(n){if(!(n.flags&1)){const l=cm(n),p=Os[Os.length-1];!p||!(n.flags&2)&&l>=cm(p)?Os.push(n):Os.splice(bz(l),0,n),n.flags|=1,YA()}}function YA(){Jg||(Jg=KA.then(QA))}function wz(n){Nr(n)?Td.push(...n):uc&&n.id===-1?uc.splice(yd+1,0,n):n.flags&1||(Td.push(n),n.flags|=1),YA()}function qT(n,l,p=Fa+1){for(;p<Os.length;p++){const v=Os[p];if(v&&v.flags&2){if(n&&v.id!==n.uid)continue;Os.splice(p,1),p--,v.flags&4&&(v.flags&=-2),v(),v.flags&4||(v.flags&=-2)}}}function JA(n){if(Td.length){const l=[...new Set(Td)].sort((p,v)=>cm(p)-cm(v));if(Td.length=0,uc){uc.push(...l);return}for(uc=l,yd=0;yd<uc.length;yd++){const p=uc[yd];p.flags&4&&(p.flags&=-2),p.flags&8||p(),p.flags&=-2}uc=null,yd=0}}const cm=n=>n.id==null?n.flags&2?-1:1/0:n.id;function QA(n){try{for(Fa=0;Fa<Os.length;Fa++){const l=Os[Fa];l&&!(l.flags&8)&&(l.flags&4&&(l.flags&=-2),Mm(l,l.i,l.i?15:14),l.flags&4||(l.flags&=-2))}}finally{for(;Fa<Os.length;Fa++){const l=Os[Fa];l&&(l.flags&=-2)}Fa=-1,Os.length=0,JA(),Jg=null,(Os.length||Td.length)&&QA()}}let $i=null,eM=null;function Qg(n){const l=$i;return $i=n,eM=n&&n.type.__scopeId||null,l}function Pn(n,l=$i,p){if(!l||n._n)return n;const v=(...A)=>{v._d&&aS(-1);const R=Qg(l);let D;try{D=n(...A)}finally{Qg(R),v._d&&aS(1)}return D};return v._n=!0,v._c=!0,v._d=!0,v}function um(n,l){if($i===null)return n;const p=Iy($i),v=n.dirs||(n.dirs=[]);for(let A=0;A<l.length;A++){let[R,D,i,G=ni]=l[A];R&&(Zr(R)&&(R={mounted:R,updated:R}),R.deep&&ml(D),v.push({dir:R,instance:p,value:D,oldValue:void 0,arg:i,modifiers:G}))}return n}function vu(n,l,p,v){const A=n.dirs,R=l&&l.dirs;for(let D=0;D<A.length;D++){const i=A[D];R&&(i.oldValue=R[D].value);let G=i.dir[v];G&&(Ac(),ua(G,p,8,[n.el,i,n,l]),Mc())}}const tM=Symbol("_vte"),rM=n=>n.__isTeleport,em=n=>n&&(n.disabled||n.disabled===""),WT=n=>n&&(n.defer||n.defer===""),ZT=n=>typeof SVGElement<"u"&&n instanceof SVGElement,XT=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,Px=(n,l)=>{const p=n&&n.to;return Hn(p)?l?l(p):null:p},nM={name:"Teleport",__isTeleport:!0,process(n,l,p,v,A,R,D,i,G,W){const{mc:H,pc:ee,pbc:ne,o:{insert:de,querySelector:he,createText:ye,createComment:Le}}=W,je=em(l.props);let{shapeFlag:xt,children:Dt,dynamicChildren:ut}=l;if(n==null){const ht=l.el=ye(""),Et=l.anchor=ye("");de(ht,p,v),de(Et,p,v);const tt=(pt,at)=>{xt&16&&(A&&A.isCE&&(A.ce._teleportTarget=pt),H(Dt,pt,at,A,R,D,i,G))},At=()=>{const pt=l.target=Px(l.props,he),at=iM(pt,l,ye,de);pt&&(D!=="svg"&&ZT(pt)?D="svg":D!=="mathml"&&XT(pt)&&(D="mathml"),je||(tt(pt,at),Ng(l,!1)))};je&&(tt(p,Et),Ng(l,!0)),WT(l.props)?zs(()=>{At(),l.el.__isMounted=!0},R):At()}else{if(WT(l.props)&&!n.el.__isMounted){zs(()=>{nM.process(n,l,p,v,A,R,D,i,G,W),delete n.el.__isMounted},R);return}l.el=n.el,l.targetStart=n.targetStart;const ht=l.anchor=n.anchor,Et=l.target=n.target,tt=l.targetAnchor=n.targetAnchor,At=em(n.props),pt=At?p:Et,at=At?ht:tt;if(D==="svg"||ZT(Et)?D="svg":(D==="mathml"||XT(Et))&&(D="mathml"),ut?(ne(n.dynamicChildren,ut,pt,A,R,D,i),I1(n,l,!0)):G||ee(n,l,pt,at,A,R,D,i,!1),je)At?l.props&&n.props&&l.props.to!==n.props.to&&(l.props.to=n.props.to):Ig(l,p,ht,W,1);else if((l.props&&l.props.to)!==(n.props&&n.props.to)){const gt=l.target=Px(l.props,he);gt&&Ig(l,gt,null,W,0)}else At&&Ig(l,Et,tt,W,1);Ng(l,je)}},remove(n,l,p,{um:v,o:{remove:A}},R){const{shapeFlag:D,children:i,anchor:G,targetStart:W,targetAnchor:H,target:ee,props:ne}=n;if(ee&&(A(W),A(H)),R&&A(G),D&16){const de=R||!em(ne);for(let he=0;he<i.length;he++){const ye=i[he];v(ye,l,p,de,!!ye.dynamicChildren)}}},move:Ig,hydrate:Tz};function Ig(n,l,p,{o:{insert:v},m:A},R=2){R===0&&v(n.targetAnchor,l,p);const{el:D,anchor:i,shapeFlag:G,children:W,props:H}=n,ee=R===2;if(ee&&v(D,l,p),(!ee||em(H))&&G&16)for(let ne=0;ne<W.length;ne++)A(W[ne],l,p,2);ee&&v(i,l,p)}function Tz(n,l,p,v,A,R,{o:{nextSibling:D,parentNode:i,querySelector:G,insert:W,createText:H}},ee){const ne=l.target=Px(l.props,G);if(ne){const de=em(l.props),he=ne._lpa||ne.firstChild;if(l.shapeFlag&16)if(de)l.anchor=ee(D(n),l,i(n),p,v,A,R),l.targetStart=he,l.targetAnchor=he&&D(he);else{l.anchor=D(n);let ye=he;for(;ye;){if(ye&&ye.nodeType===8){if(ye.data==="teleport start anchor")l.targetStart=ye;else if(ye.data==="teleport anchor"){l.targetAnchor=ye,ne._lpa=l.targetAnchor&&D(l.targetAnchor);break}}ye=D(ye)}l.targetAnchor||iM(ne,l,H,W),ee(he&&D(he),l,ne,p,v,A,R)}Ng(l,de)}return l.anchor&&D(l.anchor)}const JU=nM;function Ng(n,l){const p=n.ctx;if(p&&p.ut){let v,A;for(l?(v=n.el,A=n.anchor):(v=n.targetStart,A=n.targetAnchor);v&&v!==A;)v.nodeType===1&&v.setAttribute("data-v-owner",p.uid),v=v.nextSibling;p.ut()}}function iM(n,l,p,v){const A=l.targetStart=p(""),R=l.targetAnchor=p("");return A[tM]=R,n&&(v(A,n),v(R,n)),R}const hc=Symbol("_leaveCb"),Cg=Symbol("_enterCb");function sM(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return da(()=>{n.isMounted=!0}),Va(()=>{n.isUnmounting=!0}),n}const ko=[Function,Array],oM={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ko,onEnter:ko,onAfterEnter:ko,onEnterCancelled:ko,onBeforeLeave:ko,onLeave:ko,onAfterLeave:ko,onLeaveCancelled:ko,onBeforeAppear:ko,onAppear:ko,onAfterAppear:ko,onAppearCancelled:ko},aM=n=>{const l=n.subTree;return l.component?aM(l.component):l},Sz={name:"BaseTransition",props:oM,setup(n,{slots:l}){const p=Bs(),v=sM();return()=>{const A=l.default&&b1(l.default(),!0);if(!A||!A.length)return;const R=lM(A),D=Rn(n),{mode:i}=D;if(v.isLeaving)return ix(R);const G=KT(R);if(!G)return ix(R);let W=hm(G,D,v,p,ee=>W=ee);G.type!==ks&&Fu(G,W);let H=p.subTree&&KT(p.subTree);if(H&&H.type!==ks&&!Au(G,H)&&aM(p).type!==ks){let ee=hm(H,D,v,p);if(Fu(H,ee),i==="out-in"&&G.type!==ks)return v.isLeaving=!0,ee.afterLeave=()=>{v.isLeaving=!1,p.job.flags&8||p.update(),delete ee.afterLeave,H=void 0},ix(R);i==="in-out"&&G.type!==ks?ee.delayLeave=(ne,de,he)=>{const ye=cM(v,H);ye[String(H.key)]=H,ne[hc]=()=>{de(),ne[hc]=void 0,delete W.delayedLeave,H=void 0},W.delayedLeave=()=>{he(),delete W.delayedLeave,H=void 0}}:H=void 0}else H&&(H=void 0);return R}}};function lM(n){let l=n[0];if(n.length>1){for(const p of n)if(p.type!==ks){l=p;break}}return l}const Ez=Sz;function cM(n,l){const{leavingVNodes:p}=n;let v=p.get(l.type);return v||(v=Object.create(null),p.set(l.type,v)),v}function hm(n,l,p,v,A){const{appear:R,mode:D,persisted:i=!1,onBeforeEnter:G,onEnter:W,onAfterEnter:H,onEnterCancelled:ee,onBeforeLeave:ne,onLeave:de,onAfterLeave:he,onLeaveCancelled:ye,onBeforeAppear:Le,onAppear:je,onAfterAppear:xt,onAppearCancelled:Dt}=l,ut=String(n.key),ht=cM(p,n),Et=(pt,at)=>{pt&&ua(pt,v,9,at)},tt=(pt,at)=>{const gt=at[1];Et(pt,at),Nr(pt)?pt.every(yt=>yt.length<=1)&&gt():pt.length<=1&&gt()},At={mode:D,persisted:i,beforeEnter(pt){let at=G;if(!p.isMounted)if(R)at=Le||G;else return;pt[hc]&&pt[hc](!0);const gt=ht[ut];gt&&Au(n,gt)&&gt.el[hc]&&gt.el[hc](),Et(at,[pt])},enter(pt){let at=W,gt=H,yt=ee;if(!p.isMounted)if(R)at=je||W,gt=xt||H,yt=Dt||ee;else return;let sr=!1;const zr=pt[Cg]=Zt=>{sr||(sr=!0,Zt?Et(yt,[pt]):Et(gt,[pt]),At.delayedLeave&&At.delayedLeave(),pt[Cg]=void 0)};at?tt(at,[pt,zr]):zr()},leave(pt,at){const gt=String(n.key);if(pt[Cg]&&pt[Cg](!0),p.isUnmounting)return at();Et(ne,[pt]);let yt=!1;const sr=pt[hc]=zr=>{yt||(yt=!0,at(),zr?Et(ye,[pt]):Et(he,[pt]),pt[hc]=void 0,ht[gt]===n&&delete ht[gt])};ht[gt]=n,de?tt(de,[pt,sr]):sr()},clone(pt){const at=hm(pt,l,p,v,A);return A&&A(at),at}};return At}function ix(n){if(Ey(n))return n=xc(n),n.children=null,n}function KT(n){if(!Ey(n))return rM(n.type)&&n.children?lM(n.children):n;const{shapeFlag:l,children:p}=n;if(p){if(l&16)return p[0];if(l&32&&Zr(p.default))return p.default()}}function Fu(n,l){n.shapeFlag&6&&n.component?(n.transition=l,Fu(n.component.subTree,l)):n.shapeFlag&128?(n.ssContent.transition=l.clone(n.ssContent),n.ssFallback.transition=l.clone(n.ssFallback)):n.transition=l}function b1(n,l=!1,p){let v=[],A=0;for(let R=0;R<n.length;R++){let D=n[R];const i=p==null?D.key:String(p)+String(D.key!=null?D.key:R);D.type===ti?(D.patchFlag&128&&A++,v=v.concat(b1(D.children,l,i))):(l||D.type!==ks)&&v.push(i!=null?xc(D,{key:i}):D)}if(A>1)for(let R=0;R<v.length;R++)v[R].patchFlag=-2;return v}/*! #__NO_SIDE_EFFECTS__ */function _n(n,l){return Zr(n)?Gi({name:n.name},l,{setup:n}):n}function uM(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function ey(n,l,p,v,A=!1){if(Nr(n)){n.forEach((he,ye)=>ey(he,l&&(Nr(l)?l[ye]:l),p,v,A));return}if(Sd(v)&&!A){v.shapeFlag&512&&v.type.__asyncResolved&&v.component.subTree.component&&ey(n,l,p,v.component.subTree);return}const R=v.shapeFlag&4?Iy(v.component):v.el,D=A?null:R,{i,r:G}=n,W=l&&l.r,H=i.refs===ni?i.refs={}:i.refs,ee=i.setupState,ne=Rn(ee),de=ee===ni?()=>!1:he=>Gn(ne,he);if(W!=null&&W!==G&&(Hn(W)?(H[W]=null,de(W)&&(ee[W]=null)):Yn(W)&&(W.value=null)),Zr(G))Mm(G,i,12,[D,H]);else{const he=Hn(G),ye=Yn(G);if(he||ye){const Le=()=>{if(n.f){const je=he?de(G)?ee[G]:H[G]:G.value;A?Nr(je)&&l1(je,R):Nr(je)?je.includes(R)||je.push(R):he?(H[G]=[R],de(G)&&(ee[G]=H[G])):(G.value=[R],n.k&&(H[n.k]=G.value))}else he?(H[G]=D,de(G)&&(ee[G]=D)):ye&&(G.value=D,n.k&&(H[n.k]=D))};D?(Le.id=-1,zs(Le,p)):Le()}}}xy().requestIdleCallback;xy().cancelIdleCallback;const Sd=n=>!!n.type.__asyncLoader,Ey=n=>n.type.__isKeepAlive;function hM(n,l){fM(n,"a",l)}function dM(n,l){fM(n,"da",l)}function fM(n,l,p=Xi){const v=n.__wdc||(n.__wdc=()=>{let A=p;for(;A;){if(A.isDeactivated)return;A=A.parent}return n()});if(Ay(l,v,p),p){let A=p.parent;for(;A&&A.parent;)Ey(A.parent.vnode)&&Az(v,l,p,A),A=A.parent}}function Az(n,l,p,v){const A=Ay(l,n,v,!0);T1(()=>{l1(v[l],A)},p)}function Ay(n,l,p=Xi,v=!1){if(p){const A=p[n]||(p[n]=[]),R=l.__weh||(l.__weh=(...D)=>{Ac();const i=Im(p),G=ua(l,p,n,D);return i(),Mc(),G});return v?A.unshift(R):A.push(R),R}}const yl=n=>(l,p=Xi)=>{(!pm||n==="sp")&&Ay(n,(...v)=>l(...v),p)},pM=yl("bm"),da=yl("m"),Mz=yl("bu"),w1=yl("u"),Va=yl("bum"),T1=yl("um"),Iz=yl("sp"),Cz=yl("rtg"),Pz=yl("rtc");function Rz(n,l=Xi){Ay("ec",n,l)}const S1="components",Dz="directives";function mM(n,l){return A1(S1,n,!0,l)||n}const _M=Symbol.for("v-ndc");function ho(n){return Hn(n)?A1(S1,n,!1)||n:n||_M}function E1(n){return A1(Dz,n)}function A1(n,l,p=!0,v=!1){const A=$i||Xi;if(A){const R=A.type;if(n===S1){const i=y4(R,!1);if(i&&(i===l||i===Fs(l)||i===Ec(Fs(l))))return R}const D=YT(A[n]||R[n],l)||YT(A.appContext[n],l);return!D&&v?R:D}}function YT(n,l){return n&&(n[l]||n[Fs(l)]||n[Ec(Fs(l))])}function JT(n,l,p,v){let A;const R=p,D=Nr(n);if(D||Hn(n)){const i=D&&vc(n);let G=!1;i&&(G=!Fo(n),n=wy(n)),A=new Array(n.length);for(let W=0,H=n.length;W<H;W++)A[W]=l(G?ds(n[W]):n[W],W,void 0,R)}else if(typeof n=="number"){A=new Array(n);for(let i=0;i<n;i++)A[i]=l(i+1,i,void 0,R)}else if(Vn(n))if(n[Symbol.iterator])A=Array.from(n,(i,G)=>l(i,G,void 0,R));else{const i=Object.keys(n);A=new Array(i.length);for(let G=0,W=i.length;G<W;G++){const H=i[G];A[G]=l(n[H],H,G,R)}}else A=[];return A}function QU(n,l){for(let p=0;p<l.length;p++){const v=l[p];if(Nr(v))for(let A=0;A<v.length;A++)n[v[A].name]=v[A].fn;else v&&(n[v.name]=v.key?(...A)=>{const R=v.fn(...A);return R&&(R.key=v.key),R}:v.fn)}return n}function oa(n,l,p={},v,A){if($i.ce||$i.parent&&Sd($i.parent)&&$i.parent.ce)return l!=="default"&&(p.name=l),ir(),On(ti,null,[dt("slot",p,v&&v())],64);let R=n[l];R&&R._c&&(R._d=!1),ir();const D=R&&gM(R(p)),i=p.key||D&&D.key,G=On(ti,{key:(i&&!ca(i)?i:`_${l}`)+(!D&&v?"_fb":"")},D||(v?v():[]),D&&n._===1?64:-2);return G.scopeId&&(G.slotScopeIds=[G.scopeId+"-s"]),R&&R._c&&(R._d=!0),G}function gM(n){return n.some(l=>fm(l)?!(l.type===ks||l.type===ti&&!gM(l.children)):!0)?n:null}const Rx=n=>n?BM(n)?Iy(n):Rx(n.parent):null,tm=Gi(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>Rx(n.parent),$root:n=>Rx(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>bM(n),$forceUpdate:n=>n.f||(n.f=()=>{x1(n.update)}),$nextTick:n=>n.n||(n.n=Zs.bind(n.proxy)),$watch:n=>t4.bind(n)}),sx=(n,l)=>n!==ni&&!n.__isScriptSetup&&Gn(n,l),zz={get({_:n},l){if(l==="__v_skip")return!0;const{ctx:p,setupState:v,data:A,props:R,accessCache:D,type:i,appContext:G}=n;let W;if(l[0]!=="$"){const de=D[l];if(de!==void 0)switch(de){case 1:return v[l];case 2:return A[l];case 4:return p[l];case 3:return R[l]}else{if(sx(v,l))return D[l]=1,v[l];if(A!==ni&&Gn(A,l))return D[l]=2,A[l];if((W=n.propsOptions[0])&&Gn(W,l))return D[l]=3,R[l];if(p!==ni&&Gn(p,l))return D[l]=4,p[l];Dx&&(D[l]=0)}}const H=tm[l];let ee,ne;if(H)return l==="$attrs"&&hs(n.attrs,"get",""),H(n);if((ee=i.__cssModules)&&(ee=ee[l]))return ee;if(p!==ni&&Gn(p,l))return D[l]=4,p[l];if(ne=G.config.globalProperties,Gn(ne,l))return ne[l]},set({_:n},l,p){const{data:v,setupState:A,ctx:R}=n;return sx(A,l)?(A[l]=p,!0):v!==ni&&Gn(v,l)?(v[l]=p,!0):Gn(n.props,l)||l[0]==="$"&&l.slice(1)in n?!1:(R[l]=p,!0)},has({_:{data:n,setupState:l,accessCache:p,ctx:v,appContext:A,propsOptions:R}},D){let i;return!!p[D]||n!==ni&&Gn(n,D)||sx(l,D)||(i=R[0])&&Gn(i,D)||Gn(v,D)||Gn(tm,D)||Gn(A.config.globalProperties,D)},defineProperty(n,l,p){return p.get!=null?n._.accessCache[l]=0:Gn(p,"value")&&this.set(n,l,p.value,null),Reflect.defineProperty(n,l,p)}};function yM(){return vM().slots}function Lz(){return vM().attrs}function vM(){const n=Bs();return n.setupContext||(n.setupContext=VM(n))}function QT(n){return Nr(n)?n.reduce((l,p)=>(l[p]=null,l),{}):n}let Dx=!0;function Oz(n){const l=bM(n),p=n.proxy,v=n.ctx;Dx=!1,l.beforeCreate&&eS(l.beforeCreate,n,"bc");const{data:A,computed:R,methods:D,watch:i,provide:G,inject:W,created:H,beforeMount:ee,mounted:ne,beforeUpdate:de,updated:he,activated:ye,deactivated:Le,beforeDestroy:je,beforeUnmount:xt,destroyed:Dt,unmounted:ut,render:ht,renderTracked:Et,renderTriggered:tt,errorCaptured:At,serverPrefetch:pt,expose:at,inheritAttrs:gt,components:yt,directives:sr,filters:zr}=l;if(W&&kz(W,v,null),D)for(const vr in D){const Vr=D[vr];Zr(Vr)&&(v[vr]=Vr.bind(p))}if(A){const vr=A.call(p,p);Vn(vr)&&(n.data=Zi(vr))}if(Dx=!0,R)for(const vr in R){const Vr=R[vr],lr=Zr(Vr)?Vr.bind(p,p):Zr(Vr.get)?Vr.get.bind(p,p):_o,Hr=!Zr(Vr)&&Zr(Vr.set)?Vr.set.bind(p):_o,ur=it({get:lr,set:Hr});Object.defineProperty(v,vr,{enumerable:!0,configurable:!0,get:()=>ur.value,set:rr=>ur.value=rr})}if(i)for(const vr in i)xM(i[vr],v,p,vr);if(G){const vr=Zr(G)?G.call(p):G;Reflect.ownKeys(vr).forEach(Vr=>{go(Vr,vr[Vr])})}H&&eS(H,n,"c");function Ir(vr,Vr){Nr(Vr)?Vr.forEach(lr=>vr(lr.bind(p))):Vr&&vr(Vr.bind(p))}if(Ir(pM,ee),Ir(da,ne),Ir(Mz,de),Ir(w1,he),Ir(hM,ye),Ir(dM,Le),Ir(Rz,At),Ir(Pz,Et),Ir(Cz,tt),Ir(Va,xt),Ir(T1,ut),Ir(Iz,pt),Nr(at))if(at.length){const vr=n.exposed||(n.exposed={});at.forEach(Vr=>{Object.defineProperty(vr,Vr,{get:()=>p[Vr],set:lr=>p[Vr]=lr})})}else n.exposed||(n.exposed={});ht&&n.render===_o&&(n.render=ht),gt!=null&&(n.inheritAttrs=gt),yt&&(n.components=yt),sr&&(n.directives=sr),pt&&uM(n)}function kz(n,l,p=_o){Nr(n)&&(n=zx(n));for(const v in n){const A=n[v];let R;Vn(A)?"default"in A?R=Mn(A.from||v,A.default,!0):R=Mn(A.from||v):R=Mn(A),Yn(R)?Object.defineProperty(l,v,{enumerable:!0,configurable:!0,get:()=>R.value,set:D=>R.value=D}):l[v]=R}}function eS(n,l,p){ua(Nr(n)?n.map(v=>v.bind(l.proxy)):n.bind(l.proxy),l,p)}function xM(n,l,p,v){let A=v.includes(".")?zM(p,v):()=>p[v];if(Hn(n)){const R=l[n];Zr(R)&&Tn(A,R)}else if(Zr(n))Tn(A,n.bind(p));else if(Vn(n))if(Nr(n))n.forEach(R=>xM(R,l,p,v));else{const R=Zr(n.handler)?n.handler.bind(p):l[n.handler];Zr(R)&&Tn(A,R,n)}}function bM(n){const l=n.type,{mixins:p,extends:v}=l,{mixins:A,optionsCache:R,config:{optionMergeStrategies:D}}=n.appContext,i=R.get(l);let G;return i?G=i:!A.length&&!p&&!v?G=l:(G={},A.length&&A.forEach(W=>ty(G,W,D,!0)),ty(G,l,D)),Vn(l)&&R.set(l,G),G}function ty(n,l,p,v=!1){const{mixins:A,extends:R}=l;R&&ty(n,R,p,!0),A&&A.forEach(D=>ty(n,D,p,!0));for(const D in l)if(!(v&&D==="expose")){const i=Fz[D]||p&&p[D];n[D]=i?i(n[D],l[D]):l[D]}return n}const Fz={data:tS,props:rS,emits:rS,methods:Xp,computed:Xp,beforeCreate:Ds,created:Ds,beforeMount:Ds,mounted:Ds,beforeUpdate:Ds,updated:Ds,beforeDestroy:Ds,beforeUnmount:Ds,destroyed:Ds,unmounted:Ds,activated:Ds,deactivated:Ds,errorCaptured:Ds,serverPrefetch:Ds,components:Xp,directives:Xp,watch:Nz,provide:tS,inject:Bz};function tS(n,l){return l?n?function(){return Gi(Zr(n)?n.call(this,this):n,Zr(l)?l.call(this,this):l)}:l:n}function Bz(n,l){return Xp(zx(n),zx(l))}function zx(n){if(Nr(n)){const l={};for(let p=0;p<n.length;p++)l[n[p]]=n[p];return l}return n}function Ds(n,l){return n?[...new Set([].concat(n,l))]:l}function Xp(n,l){return n?Gi(Object.create(null),n,l):l}function rS(n,l){return n?Nr(n)&&Nr(l)?[...new Set([...n,...l])]:Gi(Object.create(null),QT(n),QT(l??{})):l}function Nz(n,l){if(!n)return l;if(!l)return n;const p=Gi(Object.create(null),n);for(const v in l)p[v]=Ds(n[v],l[v]);return p}function wM(){return{app:null,config:{isNativeTag:LD,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Vz=0;function Uz(n,l){return function(v,A=null){Zr(v)||(v=Gi({},v)),A!=null&&!Vn(A)&&(A=null);const R=wM(),D=new WeakSet,i=[];let G=!1;const W=R.app={_uid:Vz++,_component:v,_props:A,_container:null,_context:R,_instance:null,version:x4,get config(){return R.config},set config(H){},use(H,...ee){return D.has(H)||(H&&Zr(H.install)?(D.add(H),H.install(W,...ee)):Zr(H)&&(D.add(H),H(W,...ee))),W},mixin(H){return R.mixins.includes(H)||R.mixins.push(H),W},component(H,ee){return ee?(R.components[H]=ee,W):R.components[H]},directive(H,ee){return ee?(R.directives[H]=ee,W):R.directives[H]},mount(H,ee,ne){if(!G){const de=W._ceVNode||dt(v,A);return de.appContext=R,ne===!0?ne="svg":ne===!1&&(ne=void 0),n(de,H,ne),G=!0,W._container=H,H.__vue_app__=W,Iy(de.component)}},onUnmount(H){i.push(H)},unmount(){G&&(ua(i,W._instance,16),n(null,W._container),delete W._container.__vue_app__)},provide(H,ee){return R.provides[H]=ee,W},runWithContext(H){const ee=Pu;Pu=W;try{return H()}finally{Pu=ee}}};return W}}let Pu=null;function go(n,l){if(Xi){let p=Xi.provides;const v=Xi.parent&&Xi.parent.provides;v===p&&(p=Xi.provides=Object.create(v)),p[n]=l}}function Mn(n,l,p=!1){const v=Xi||$i;if(v||Pu){const A=Pu?Pu._context.provides:v?v.parent==null?v.vnode.appContext&&v.vnode.appContext.provides:v.parent.provides:void 0;if(A&&n in A)return A[n];if(arguments.length>1)return p&&Zr(l)?l.call(v&&v.proxy):l}}function jz(){return!!(Xi||$i||Pu)}const TM={},SM=()=>Object.create(TM),EM=n=>Object.getPrototypeOf(n)===TM;function $z(n,l,p,v=!1){const A={},R=SM();n.propsDefaults=Object.create(null),AM(n,l,A,R);for(const D in n.propsOptions[0])D in A||(A[D]=void 0);p?n.props=v?A:qA(A):n.type.props?n.props=A:n.props=R,n.attrs=R}function Gz(n,l,p,v){const{props:A,attrs:R,vnode:{patchFlag:D}}=n,i=Rn(A),[G]=n.propsOptions;let W=!1;if((v||D>0)&&!(D&16)){if(D&8){const H=n.vnode.dynamicProps;for(let ee=0;ee<H.length;ee++){let ne=H[ee];if(My(n.emitsOptions,ne))continue;const de=l[ne];if(G)if(Gn(R,ne))de!==R[ne]&&(R[ne]=de,W=!0);else{const he=Fs(ne);A[he]=Lx(G,i,he,de,n,!1)}else de!==R[ne]&&(R[ne]=de,W=!0)}}}else{AM(n,l,A,R)&&(W=!0);let H;for(const ee in i)(!l||!Gn(l,ee)&&((H=Sc(ee))===ee||!Gn(l,H)))&&(G?p&&(p[ee]!==void 0||p[H]!==void 0)&&(A[ee]=Lx(G,i,ee,void 0,n,!0)):delete A[ee]);if(R!==i)for(const ee in R)(!l||!Gn(l,ee))&&(delete R[ee],W=!0)}W&&pl(n.attrs,"set","")}function AM(n,l,p,v){const[A,R]=n.propsOptions;let D=!1,i;if(l)for(let G in l){if(Yp(G))continue;const W=l[G];let H;A&&Gn(A,H=Fs(G))?!R||!R.includes(H)?p[H]=W:(i||(i={}))[H]=W:My(n.emitsOptions,G)||(!(G in v)||W!==v[G])&&(v[G]=W,D=!0)}if(R){const G=Rn(p),W=i||ni;for(let H=0;H<R.length;H++){const ee=R[H];p[ee]=Lx(A,G,ee,W[ee],n,!Gn(W,ee))}}return D}function Lx(n,l,p,v,A,R){const D=n[p];if(D!=null){const i=Gn(D,"default");if(i&&v===void 0){const G=D.default;if(D.type!==Function&&!D.skipFactory&&Zr(G)){const{propsDefaults:W}=A;if(p in W)v=W[p];else{const H=Im(A);v=W[p]=G.call(null,l),H()}}else v=G;A.ce&&A.ce._setProp(p,v)}D[0]&&(R&&!i?v=!1:D[1]&&(v===""||v===Sc(p))&&(v=!0))}return v}const Hz=new WeakMap;function MM(n,l,p=!1){const v=p?Hz:l.propsCache,A=v.get(n);if(A)return A;const R=n.props,D={},i=[];let G=!1;if(!Zr(n)){const H=ee=>{G=!0;const[ne,de]=MM(ee,l,!0);Gi(D,ne),de&&i.push(...de)};!p&&l.mixins.length&&l.mixins.forEach(H),n.extends&&H(n.extends),n.mixins&&n.mixins.forEach(H)}if(!R&&!G)return Vn(n)&&v.set(n,bd),bd;if(Nr(R))for(let H=0;H<R.length;H++){const ee=Fs(R[H]);nS(ee)&&(D[ee]=ni)}else if(R)for(const H in R){const ee=Fs(H);if(nS(ee)){const ne=R[H],de=D[ee]=Nr(ne)||Zr(ne)?{type:ne}:Gi({},ne),he=de.type;let ye=!1,Le=!0;if(Nr(he))for(let je=0;je<he.length;++je){const xt=he[je],Dt=Zr(xt)&&xt.name;if(Dt==="Boolean"){ye=!0;break}else Dt==="String"&&(Le=!1)}else ye=Zr(he)&&he.name==="Boolean";de[0]=ye,de[1]=Le,(ye||Gn(de,"default"))&&i.push(ee)}}const W=[D,i];return Vn(n)&&v.set(n,W),W}function nS(n){return n[0]!=="$"&&!Yp(n)}const IM=n=>n[0]==="_"||n==="$stable",M1=n=>Nr(n)?n.map(Ba):[Ba(n)],qz=(n,l,p)=>{if(l._n)return l;const v=Pn((...A)=>M1(l(...A)),p);return v._c=!1,v},CM=(n,l,p)=>{const v=n._ctx;for(const A in n){if(IM(A))continue;const R=n[A];if(Zr(R))l[A]=qz(A,R,v);else if(R!=null){const D=M1(R);l[A]=()=>D}}},PM=(n,l)=>{const p=M1(l);n.slots.default=()=>p},RM=(n,l,p)=>{for(const v in l)(p||v!=="_")&&(n[v]=l[v])},Wz=(n,l,p)=>{const v=n.slots=SM();if(n.vnode.shapeFlag&32){const A=l._;A?(RM(v,l,p),p&&AA(v,"_",A,!0)):CM(l,v)}else l&&PM(n,l)},Zz=(n,l,p)=>{const{vnode:v,slots:A}=n;let R=!0,D=ni;if(v.shapeFlag&32){const i=l._;i?p&&i===1?R=!1:RM(A,l,p):(R=!l.$stable,CM(l,A)),D=l}else l&&(PM(n,l),D={default:1});if(R)for(const i in A)!IM(i)&&D[i]==null&&delete A[i]},zs=l4;function Xz(n){return Kz(n)}function Kz(n,l){const p=xy();p.__VUE__=!0;const{insert:v,remove:A,patchProp:R,createElement:D,createText:i,createComment:G,setText:W,setElementText:H,parentNode:ee,nextSibling:ne,setScopeId:de=_o,insertStaticContent:he}=n,ye=(ke,Ve,Ae,bt=null,Vt=null,zt=null,Rt=void 0,jt=null,Yt=!!Ve.dynamicChildren)=>{if(ke===Ve)return;ke&&!Au(ke,Ve)&&(bt=Pt(ke),rr(ke,Vt,zt,!0),ke=null),Ve.patchFlag===-2&&(Yt=!1,Ve.dynamicChildren=null);const{type:Gt,ref:Cr,shapeFlag:cr}=Ve;switch(Gt){case Fd:Le(ke,Ve,Ae,bt);break;case ks:je(ke,Ve,Ae,bt);break;case ax:ke==null&&xt(Ve,Ae,bt,Rt);break;case ti:yt(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt);break;default:cr&1?ht(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt):cr&6?sr(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt):(cr&64||cr&128)&&Gt.process(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt,te)}Cr!=null&&Vt&&ey(Cr,ke&&ke.ref,zt,Ve||ke,!Ve)},Le=(ke,Ve,Ae,bt)=>{if(ke==null)v(Ve.el=i(Ve.children),Ae,bt);else{const Vt=Ve.el=ke.el;Ve.children!==ke.children&&W(Vt,Ve.children)}},je=(ke,Ve,Ae,bt)=>{ke==null?v(Ve.el=G(Ve.children||""),Ae,bt):Ve.el=ke.el},xt=(ke,Ve,Ae,bt)=>{[ke.el,ke.anchor]=he(ke.children,Ve,Ae,bt,ke.el,ke.anchor)},Dt=({el:ke,anchor:Ve},Ae,bt)=>{let Vt;for(;ke&&ke!==Ve;)Vt=ne(ke),v(ke,Ae,bt),ke=Vt;v(Ve,Ae,bt)},ut=({el:ke,anchor:Ve})=>{let Ae;for(;ke&&ke!==Ve;)Ae=ne(ke),A(ke),ke=Ae;A(Ve)},ht=(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt)=>{Ve.type==="svg"?Rt="svg":Ve.type==="math"&&(Rt="mathml"),ke==null?Et(Ve,Ae,bt,Vt,zt,Rt,jt,Yt):pt(ke,Ve,Vt,zt,Rt,jt,Yt)},Et=(ke,Ve,Ae,bt,Vt,zt,Rt,jt)=>{let Yt,Gt;const{props:Cr,shapeFlag:cr,transition:Ye,dirs:Jt}=ke;if(Yt=ke.el=D(ke.type,zt,Cr&&Cr.is,Cr),cr&8?H(Yt,ke.children):cr&16&&At(ke.children,Yt,null,bt,Vt,ox(ke,zt),Rt,jt),Jt&&vu(ke,null,bt,"created"),tt(Yt,ke,ke.scopeId,Rt,bt),Cr){for(const xn in Cr)xn!=="value"&&!Yp(xn)&&R(Yt,xn,null,Cr[xn],zt,bt);"value"in Cr&&R(Yt,"value",null,Cr.value,zt),(Gt=Cr.onVnodeBeforeMount)&&La(Gt,bt,ke)}Jt&&vu(ke,null,bt,"beforeMount");const $r=Yz(Vt,Ye);$r&&Ye.beforeEnter(Yt),v(Yt,Ve,Ae),((Gt=Cr&&Cr.onVnodeMounted)||$r||Jt)&&zs(()=>{Gt&&La(Gt,bt,ke),$r&&Ye.enter(Yt),Jt&&vu(ke,null,bt,"mounted")},Vt)},tt=(ke,Ve,Ae,bt,Vt)=>{if(Ae&&de(ke,Ae),bt)for(let zt=0;zt<bt.length;zt++)de(ke,bt[zt]);if(Vt){let zt=Vt.subTree;if(Ve===zt||OM(zt.type)&&(zt.ssContent===Ve||zt.ssFallback===Ve)){const Rt=Vt.vnode;tt(ke,Rt,Rt.scopeId,Rt.slotScopeIds,Vt.parent)}}},At=(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt=0)=>{for(let Gt=Yt;Gt<ke.length;Gt++){const Cr=ke[Gt]=jt?dc(ke[Gt]):Ba(ke[Gt]);ye(null,Cr,Ve,Ae,bt,Vt,zt,Rt,jt)}},pt=(ke,Ve,Ae,bt,Vt,zt,Rt)=>{const jt=Ve.el=ke.el;let{patchFlag:Yt,dynamicChildren:Gt,dirs:Cr}=Ve;Yt|=ke.patchFlag&16;const cr=ke.props||ni,Ye=Ve.props||ni;let Jt;if(Ae&&xu(Ae,!1),(Jt=Ye.onVnodeBeforeUpdate)&&La(Jt,Ae,Ve,ke),Cr&&vu(Ve,ke,Ae,"beforeUpdate"),Ae&&xu(Ae,!0),(cr.innerHTML&&Ye.innerHTML==null||cr.textContent&&Ye.textContent==null)&&H(jt,""),Gt?at(ke.dynamicChildren,Gt,jt,Ae,bt,ox(Ve,Vt),zt):Rt||Vr(ke,Ve,jt,null,Ae,bt,ox(Ve,Vt),zt,!1),Yt>0){if(Yt&16)gt(jt,cr,Ye,Ae,Vt);else if(Yt&2&&cr.class!==Ye.class&&R(jt,"class",null,Ye.class,Vt),Yt&4&&R(jt,"style",cr.style,Ye.style,Vt),Yt&8){const $r=Ve.dynamicProps;for(let xn=0;xn<$r.length;xn++){const Ur=$r[xn],xi=cr[Ur],ri=Ye[Ur];(ri!==xi||Ur==="value")&&R(jt,Ur,xi,ri,Vt,Ae)}}Yt&1&&ke.children!==Ve.children&&H(jt,Ve.children)}else!Rt&&Gt==null&&gt(jt,cr,Ye,Ae,Vt);((Jt=Ye.onVnodeUpdated)||Cr)&&zs(()=>{Jt&&La(Jt,Ae,Ve,ke),Cr&&vu(Ve,ke,Ae,"updated")},bt)},at=(ke,Ve,Ae,bt,Vt,zt,Rt)=>{for(let jt=0;jt<Ve.length;jt++){const Yt=ke[jt],Gt=Ve[jt],Cr=Yt.el&&(Yt.type===ti||!Au(Yt,Gt)||Yt.shapeFlag&70)?ee(Yt.el):Ae;ye(Yt,Gt,Cr,null,bt,Vt,zt,Rt,!0)}},gt=(ke,Ve,Ae,bt,Vt)=>{if(Ve!==Ae){if(Ve!==ni)for(const zt in Ve)!Yp(zt)&&!(zt in Ae)&&R(ke,zt,Ve[zt],null,Vt,bt);for(const zt in Ae){if(Yp(zt))continue;const Rt=Ae[zt],jt=Ve[zt];Rt!==jt&&zt!=="value"&&R(ke,zt,jt,Rt,Vt,bt)}"value"in Ae&&R(ke,"value",Ve.value,Ae.value,Vt)}},yt=(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt)=>{const Gt=Ve.el=ke?ke.el:i(""),Cr=Ve.anchor=ke?ke.anchor:i("");let{patchFlag:cr,dynamicChildren:Ye,slotScopeIds:Jt}=Ve;Jt&&(jt=jt?jt.concat(Jt):Jt),ke==null?(v(Gt,Ae,bt),v(Cr,Ae,bt),At(Ve.children||[],Ae,Cr,Vt,zt,Rt,jt,Yt)):cr>0&&cr&64&&Ye&&ke.dynamicChildren?(at(ke.dynamicChildren,Ye,Ae,Vt,zt,Rt,jt),(Ve.key!=null||Vt&&Ve===Vt.subTree)&&I1(ke,Ve,!0)):Vr(ke,Ve,Ae,Cr,Vt,zt,Rt,jt,Yt)},sr=(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt)=>{Ve.slotScopeIds=jt,ke==null?Ve.shapeFlag&512?Vt.ctx.activate(Ve,Ae,bt,Rt,Yt):zr(Ve,Ae,bt,Vt,zt,Rt,Yt):Zt(ke,Ve,Yt)},zr=(ke,Ve,Ae,bt,Vt,zt,Rt)=>{const jt=ke.component=p4(ke,bt,Vt);if(Ey(ke)&&(jt.ctx.renderer=te),m4(jt,!1,Rt),jt.asyncDep){if(Vt&&Vt.registerDep(jt,Ir,Rt),!ke.el){const Yt=jt.subTree=dt(ks);je(null,Yt,Ve,Ae)}}else Ir(jt,ke,Ve,Ae,Vt,zt,Rt)},Zt=(ke,Ve,Ae)=>{const bt=Ve.component=ke.component;if(o4(ke,Ve,Ae))if(bt.asyncDep&&!bt.asyncResolved){vr(bt,Ve,Ae);return}else bt.next=Ve,bt.update();else Ve.el=ke.el,bt.vnode=Ve},Ir=(ke,Ve,Ae,bt,Vt,zt,Rt)=>{const jt=()=>{if(ke.isMounted){let{next:cr,bu:Ye,u:Jt,parent:$r,vnode:xn}=ke;{const ki=DM(ke);if(ki){cr&&(cr.el=xn.el,vr(ke,cr,Rt)),ki.asyncDep.then(()=>{ke.isUnmounted||jt()});return}}let Ur=cr,xi;xu(ke,!1),cr?(cr.el=xn.el,vr(ke,cr,Rt)):cr=xn,Ye&&Bg(Ye),(xi=cr.props&&cr.props.onVnodeBeforeUpdate)&&La(xi,$r,cr,xn),xu(ke,!0);const ri=sS(ke),Ki=ke.subTree;ke.subTree=ri,ye(Ki,ri,ee(Ki.el),Pt(Ki),ke,Vt,zt),cr.el=ri.el,Ur===null&&a4(ke,ri.el),Jt&&zs(Jt,Vt),(xi=cr.props&&cr.props.onVnodeUpdated)&&zs(()=>La(xi,$r,cr,xn),Vt)}else{let cr;const{el:Ye,props:Jt}=Ve,{bm:$r,m:xn,parent:Ur,root:xi,type:ri}=ke,Ki=Sd(Ve);xu(ke,!1),$r&&Bg($r),!Ki&&(cr=Jt&&Jt.onVnodeBeforeMount)&&La(cr,Ur,Ve),xu(ke,!0);{xi.ce&&xi.ce._injectChildStyle(ri);const ki=ke.subTree=sS(ke);ye(null,ki,Ae,bt,ke,Vt,zt),Ve.el=ki.el}if(xn&&zs(xn,Vt),!Ki&&(cr=Jt&&Jt.onVnodeMounted)){const ki=Ve;zs(()=>La(cr,Ur,ki),Vt)}(Ve.shapeFlag&256||Ur&&Sd(Ur.vnode)&&Ur.vnode.shapeFlag&256)&&ke.a&&zs(ke.a,Vt),ke.isMounted=!0,Ve=Ae=bt=null}};ke.scope.on();const Yt=ke.effect=new DA(jt);ke.scope.off();const Gt=ke.update=Yt.run.bind(Yt),Cr=ke.job=Yt.runIfDirty.bind(Yt);Cr.i=ke,Cr.id=ke.uid,Yt.scheduler=()=>x1(Cr),xu(ke,!0),Gt()},vr=(ke,Ve,Ae)=>{Ve.component=ke;const bt=ke.vnode.props;ke.vnode=Ve,ke.next=null,Gz(ke,Ve.props,bt,Ae),Zz(ke,Ve.children,Ae),Ac(),qT(ke),Mc()},Vr=(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt=!1)=>{const Gt=ke&&ke.children,Cr=ke?ke.shapeFlag:0,cr=Ve.children,{patchFlag:Ye,shapeFlag:Jt}=Ve;if(Ye>0){if(Ye&128){Hr(Gt,cr,Ae,bt,Vt,zt,Rt,jt,Yt);return}else if(Ye&256){lr(Gt,cr,Ae,bt,Vt,zt,Rt,jt,Yt);return}}Jt&8?(Cr&16&&yn(Gt,Vt,zt),cr!==Gt&&H(Ae,cr)):Cr&16?Jt&16?Hr(Gt,cr,Ae,bt,Vt,zt,Rt,jt,Yt):yn(Gt,Vt,zt,!0):(Cr&8&&H(Ae,""),Jt&16&&At(cr,Ae,bt,Vt,zt,Rt,jt,Yt))},lr=(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt)=>{ke=ke||bd,Ve=Ve||bd;const Gt=ke.length,Cr=Ve.length,cr=Math.min(Gt,Cr);let Ye;for(Ye=0;Ye<cr;Ye++){const Jt=Ve[Ye]=Yt?dc(Ve[Ye]):Ba(Ve[Ye]);ye(ke[Ye],Jt,Ae,null,Vt,zt,Rt,jt,Yt)}Gt>Cr?yn(ke,Vt,zt,!0,!1,cr):At(Ve,Ae,bt,Vt,zt,Rt,jt,Yt,cr)},Hr=(ke,Ve,Ae,bt,Vt,zt,Rt,jt,Yt)=>{let Gt=0;const Cr=Ve.length;let cr=ke.length-1,Ye=Cr-1;for(;Gt<=cr&&Gt<=Ye;){const Jt=ke[Gt],$r=Ve[Gt]=Yt?dc(Ve[Gt]):Ba(Ve[Gt]);if(Au(Jt,$r))ye(Jt,$r,Ae,null,Vt,zt,Rt,jt,Yt);else break;Gt++}for(;Gt<=cr&&Gt<=Ye;){const Jt=ke[cr],$r=Ve[Ye]=Yt?dc(Ve[Ye]):Ba(Ve[Ye]);if(Au(Jt,$r))ye(Jt,$r,Ae,null,Vt,zt,Rt,jt,Yt);else break;cr--,Ye--}if(Gt>cr){if(Gt<=Ye){const Jt=Ye+1,$r=Jt<Cr?Ve[Jt].el:bt;for(;Gt<=Ye;)ye(null,Ve[Gt]=Yt?dc(Ve[Gt]):Ba(Ve[Gt]),Ae,$r,Vt,zt,Rt,jt,Yt),Gt++}}else if(Gt>Ye)for(;Gt<=cr;)rr(ke[Gt],Vt,zt,!0),Gt++;else{const Jt=Gt,$r=Gt,xn=new Map;for(Gt=$r;Gt<=Ye;Gt++){const Jn=Ve[Gt]=Yt?dc(Ve[Gt]):Ba(Ve[Gt]);Jn.key!=null&&xn.set(Jn.key,Gt)}let Ur,xi=0;const ri=Ye-$r+1;let Ki=!1,ki=0;const ys=new Array(ri);for(Gt=0;Gt<ri;Gt++)ys[Gt]=0;for(Gt=Jt;Gt<=cr;Gt++){const Jn=ke[Gt];if(xi>=ri){rr(Jn,Vt,zt,!0);continue}let Fi;if(Jn.key!=null)Fi=xn.get(Jn.key);else for(Ur=$r;Ur<=Ye;Ur++)if(ys[Ur-$r]===0&&Au(Jn,Ve[Ur])){Fi=Ur;break}Fi===void 0?rr(Jn,Vt,zt,!0):(ys[Fi-$r]=Gt+1,Fi>=ki?ki=Fi:Ki=!0,ye(Jn,Ve[Fi],Ae,null,Vt,zt,Rt,jt,Yt),xi++)}const bo=Ki?Jz(ys):bd;for(Ur=bo.length-1,Gt=ri-1;Gt>=0;Gt--){const Jn=$r+Gt,Fi=Ve[Jn],Pr=Jn+1<Cr?Ve[Jn+1].el:bt;ys[Gt]===0?ye(null,Fi,Ae,Pr,Vt,zt,Rt,jt,Yt):Ki&&(Ur<0||Gt!==bo[Ur]?ur(Fi,Ae,Pr,2):Ur--)}}},ur=(ke,Ve,Ae,bt,Vt=null)=>{const{el:zt,type:Rt,transition:jt,children:Yt,shapeFlag:Gt}=ke;if(Gt&6){ur(ke.component.subTree,Ve,Ae,bt);return}if(Gt&128){ke.suspense.move(Ve,Ae,bt);return}if(Gt&64){Rt.move(ke,Ve,Ae,te);return}if(Rt===ti){v(zt,Ve,Ae);for(let cr=0;cr<Yt.length;cr++)ur(Yt[cr],Ve,Ae,bt);v(ke.anchor,Ve,Ae);return}if(Rt===ax){Dt(ke,Ve,Ae);return}if(bt!==2&&Gt&1&&jt)if(bt===0)jt.beforeEnter(zt),v(zt,Ve,Ae),zs(()=>jt.enter(zt),Vt);else{const{leave:cr,delayLeave:Ye,afterLeave:Jt}=jt,$r=()=>v(zt,Ve,Ae),xn=()=>{cr(zt,()=>{$r(),Jt&&Jt()})};Ye?Ye(zt,$r,xn):xn()}else v(zt,Ve,Ae)},rr=(ke,Ve,Ae,bt=!1,Vt=!1)=>{const{type:zt,props:Rt,ref:jt,children:Yt,dynamicChildren:Gt,shapeFlag:Cr,patchFlag:cr,dirs:Ye,cacheIndex:Jt}=ke;if(cr===-2&&(Vt=!1),jt!=null&&ey(jt,null,Ae,ke,!0),Jt!=null&&(Ve.renderCache[Jt]=void 0),Cr&256){Ve.ctx.deactivate(ke);return}const $r=Cr&1&&Ye,xn=!Sd(ke);let Ur;if(xn&&(Ur=Rt&&Rt.onVnodeBeforeUnmount)&&La(Ur,Ve,ke),Cr&6)hi(ke.component,Ae,bt);else{if(Cr&128){ke.suspense.unmount(Ae,bt);return}$r&&vu(ke,null,Ve,"beforeUnmount"),Cr&64?ke.type.remove(ke,Ve,Ae,te,bt):Gt&&!Gt.hasOnce&&(zt!==ti||cr>0&&cr&64)?yn(Gt,Ve,Ae,!1,!0):(zt===ti&&cr&384||!Vt&&Cr&16)&&yn(Yt,Ve,Ae),bt&&$t(ke)}(xn&&(Ur=Rt&&Rt.onVnodeUnmounted)||$r)&&zs(()=>{Ur&&La(Ur,Ve,ke),$r&&vu(ke,null,Ve,"unmounted")},Ae)},$t=ke=>{const{type:Ve,el:Ae,anchor:bt,transition:Vt}=ke;if(Ve===ti){vi(Ae,bt);return}if(Ve===ax){ut(ke);return}const zt=()=>{A(Ae),Vt&&!Vt.persisted&&Vt.afterLeave&&Vt.afterLeave()};if(ke.shapeFlag&1&&Vt&&!Vt.persisted){const{leave:Rt,delayLeave:jt}=Vt,Yt=()=>Rt(Ae,zt);jt?jt(ke.el,zt,Yt):Yt()}else zt()},vi=(ke,Ve)=>{let Ae;for(;ke!==Ve;)Ae=ne(ke),A(ke),ke=Ae;A(Ve)},hi=(ke,Ve,Ae)=>{const{bum:bt,scope:Vt,job:zt,subTree:Rt,um:jt,m:Yt,a:Gt}=ke;iS(Yt),iS(Gt),bt&&Bg(bt),Vt.stop(),zt&&(zt.flags|=8,rr(Rt,ke,Ve,Ae)),jt&&zs(jt,Ve),zs(()=>{ke.isUnmounted=!0},Ve),Ve&&Ve.pendingBranch&&!Ve.isUnmounted&&ke.asyncDep&&!ke.asyncResolved&&ke.suspenseId===Ve.pendingId&&(Ve.deps--,Ve.deps===0&&Ve.resolve())},yn=(ke,Ve,Ae,bt=!1,Vt=!1,zt=0)=>{for(let Rt=zt;Rt<ke.length;Rt++)rr(ke[Rt],Ve,Ae,bt,Vt)},Pt=ke=>{if(ke.shapeFlag&6)return Pt(ke.component.subTree);if(ke.shapeFlag&128)return ke.suspense.next();const Ve=ne(ke.anchor||ke.el),Ae=Ve&&Ve[tM];return Ae?ne(Ae):Ve};let er=!1;const Kt=(ke,Ve,Ae)=>{ke==null?Ve._vnode&&rr(Ve._vnode,null,null,!0):ye(Ve._vnode||null,ke,Ve,null,null,null,Ae),Ve._vnode=ke,er||(er=!0,qT(),JA(),er=!1)},te={p:ye,um:rr,m:ur,r:$t,mt:zr,mc:At,pc:Vr,pbc:at,n:Pt,o:n};return{render:Kt,hydrate:void 0,createApp:Uz(Kt)}}function ox({type:n,props:l},p){return p==="svg"&&n==="foreignObject"||p==="mathml"&&n==="annotation-xml"&&l&&l.encoding&&l.encoding.includes("html")?void 0:p}function xu({effect:n,job:l},p){p?(n.flags|=32,l.flags|=4):(n.flags&=-33,l.flags&=-5)}function Yz(n,l){return(!n||n&&!n.pendingBranch)&&l&&!l.persisted}function I1(n,l,p=!1){const v=n.children,A=l.children;if(Nr(v)&&Nr(A))for(let R=0;R<v.length;R++){const D=v[R];let i=A[R];i.shapeFlag&1&&!i.dynamicChildren&&((i.patchFlag<=0||i.patchFlag===32)&&(i=A[R]=dc(A[R]),i.el=D.el),!p&&i.patchFlag!==-2&&I1(D,i)),i.type===Fd&&(i.el=D.el)}}function Jz(n){const l=n.slice(),p=[0];let v,A,R,D,i;const G=n.length;for(v=0;v<G;v++){const W=n[v];if(W!==0){if(A=p[p.length-1],n[A]<W){l[v]=A,p.push(v);continue}for(R=0,D=p.length-1;R<D;)i=R+D>>1,n[p[i]]<W?R=i+1:D=i;W<n[p[R]]&&(R>0&&(l[v]=p[R-1]),p[R]=v)}}for(R=p.length,D=p[R-1];R-- >0;)p[R]=D,D=l[D];return p}function DM(n){const l=n.subTree.component;if(l)return l.asyncDep&&!l.asyncResolved?l:DM(l)}function iS(n){if(n)for(let l=0;l<n.length;l++)n[l].flags|=8}const Qz=Symbol.for("v-scx"),e4=()=>Mn(Qz);function kd(n,l){return C1(n,null,l)}function Tn(n,l,p){return C1(n,l,p)}function C1(n,l,p=ni){const{immediate:v,deep:A,flush:R,once:D}=p,i=Gi({},p),G=l&&v||!l&&R!=="post";let W;if(pm){if(R==="sync"){const de=e4();W=de.__watcherHandles||(de.__watcherHandles=[])}else if(!G){const de=()=>{};return de.stop=_o,de.resume=_o,de.pause=_o,de}}const H=Xi;i.call=(de,he,ye)=>ua(de,H,he,ye);let ee=!1;R==="post"?i.scheduler=de=>{zs(de,H&&H.suspense)}:R!=="sync"&&(ee=!0,i.scheduler=(de,he)=>{he?de():x1(de)}),i.augmentJob=de=>{l&&(de.flags|=4),ee&&(de.flags|=2,H&&(de.id=H.uid,de.i=H))};const ne=vz(n,l,i);return pm&&(W?W.push(ne):G&&ne()),ne}function t4(n,l,p){const v=this.proxy,A=Hn(n)?n.includes(".")?zM(v,n):()=>v[n]:n.bind(v,v);let R;Zr(l)?R=l:(R=l.handler,p=l);const D=Im(this),i=C1(A,R.bind(v),p);return D(),i}function zM(n,l){const p=l.split(".");return()=>{let v=n;for(let A=0;A<p.length&&v;A++)v=v[p[A]];return v}}const r4=(n,l)=>l==="modelValue"||l==="model-value"?n.modelModifiers:n[`${l}Modifiers`]||n[`${Fs(l)}Modifiers`]||n[`${Sc(l)}Modifiers`];function n4(n,l,...p){if(n.isUnmounted)return;const v=n.vnode.props||ni;let A=p;const R=l.startsWith("update:"),D=R&&r4(v,l.slice(7));D&&(D.trim&&(A=p.map(H=>Hn(H)?H.trim():H)),D.number&&(A=p.map(Ex)));let i,G=v[i=Qv(l)]||v[i=Qv(Fs(l))];!G&&R&&(G=v[i=Qv(Sc(l))]),G&&ua(G,n,6,A);const W=v[i+"Once"];if(W){if(!n.emitted)n.emitted={};else if(n.emitted[i])return;n.emitted[i]=!0,ua(W,n,6,A)}}function LM(n,l,p=!1){const v=l.emitsCache,A=v.get(n);if(A!==void 0)return A;const R=n.emits;let D={},i=!1;if(!Zr(n)){const G=W=>{const H=LM(W,l,!0);H&&(i=!0,Gi(D,H))};!p&&l.mixins.length&&l.mixins.forEach(G),n.extends&&G(n.extends),n.mixins&&n.mixins.forEach(G)}return!R&&!i?(Vn(n)&&v.set(n,null),null):(Nr(R)?R.forEach(G=>D[G]=null):Gi(D,R),Vn(n)&&v.set(n,D),D)}function My(n,l){return!n||!gy(l)?!1:(l=l.slice(2).replace(/Once$/,""),Gn(n,l[0].toLowerCase()+l.slice(1))||Gn(n,Sc(l))||Gn(n,l))}function sS(n){const{type:l,vnode:p,proxy:v,withProxy:A,propsOptions:[R],slots:D,attrs:i,emit:G,render:W,renderCache:H,props:ee,data:ne,setupState:de,ctx:he,inheritAttrs:ye}=n,Le=Qg(n);let je,xt;try{if(p.shapeFlag&4){const ut=A||v,ht=ut;je=Ba(W.call(ht,ut,H,ee,de,ne,he)),xt=i}else{const ut=l;je=Ba(ut.length>1?ut(ee,{attrs:i,slots:D,emit:G}):ut(ee,null)),xt=l.props?i:i4(i)}}catch(ut){rm.length=0,Sy(ut,n,1),je=dt(ks)}let Dt=je;if(xt&&ye!==!1){const ut=Object.keys(xt),{shapeFlag:ht}=Dt;ut.length&&ht&7&&(R&&ut.some(a1)&&(xt=s4(xt,R)),Dt=xc(Dt,xt,!1,!0))}return p.dirs&&(Dt=xc(Dt,null,!1,!0),Dt.dirs=Dt.dirs?Dt.dirs.concat(p.dirs):p.dirs),p.transition&&Fu(Dt,p.transition),je=Dt,Qg(Le),je}const i4=n=>{let l;for(const p in n)(p==="class"||p==="style"||gy(p))&&((l||(l={}))[p]=n[p]);return l},s4=(n,l)=>{const p={};for(const v in n)(!a1(v)||!(v.slice(9)in l))&&(p[v]=n[v]);return p};function o4(n,l,p){const{props:v,children:A,component:R}=n,{props:D,children:i,patchFlag:G}=l,W=R.emitsOptions;if(l.dirs||l.transition)return!0;if(p&&G>=0){if(G&1024)return!0;if(G&16)return v?oS(v,D,W):!!D;if(G&8){const H=l.dynamicProps;for(let ee=0;ee<H.length;ee++){const ne=H[ee];if(D[ne]!==v[ne]&&!My(W,ne))return!0}}}else return(A||i)&&(!i||!i.$stable)?!0:v===D?!1:v?D?oS(v,D,W):!0:!!D;return!1}function oS(n,l,p){const v=Object.keys(l);if(v.length!==Object.keys(n).length)return!0;for(let A=0;A<v.length;A++){const R=v[A];if(l[R]!==n[R]&&!My(p,R))return!0}return!1}function a4({vnode:n,parent:l},p){for(;l;){const v=l.subTree;if(v.suspense&&v.suspense.activeBranch===n&&(v.el=n.el),v===n)(n=l.vnode).el=p,l=l.parent;else break}}const OM=n=>n.__isSuspense;function l4(n,l){l&&l.pendingBranch?Nr(n)?l.effects.push(...n):l.effects.push(n):wz(n)}const ti=Symbol.for("v-fgt"),Fd=Symbol.for("v-txt"),ks=Symbol.for("v-cmt"),ax=Symbol.for("v-stc"),rm=[];let po=null;function ir(n=!1){rm.push(po=n?null:[])}function c4(){rm.pop(),po=rm[rm.length-1]||null}let dm=1;function aS(n,l=!1){dm+=n,n<0&&po&&l&&(po.hasOnce=!0)}function kM(n){return n.dynamicChildren=dm>0?po||bd:null,c4(),dm>0&&po&&po.push(n),n}function qr(n,l,p,v,A,R){return kM(Wr(n,l,p,v,A,R,!0))}function On(n,l,p,v,A){return kM(dt(n,l,p,v,A,!0))}function fm(n){return n?n.__v_isVNode===!0:!1}function Au(n,l){return n.type===l.type&&n.key===l.key}const FM=({key:n})=>n??null,Vg=({ref:n,ref_key:l,ref_for:p})=>(typeof n=="number"&&(n=""+n),n!=null?Hn(n)||Yn(n)||Zr(n)?{i:$i,r:n,k:l,f:!!p}:n:null);function Wr(n,l=null,p=null,v=0,A=null,R=n===ti?0:1,D=!1,i=!1){const G={__v_isVNode:!0,__v_skip:!0,type:n,props:l,key:l&&FM(l),ref:l&&Vg(l),scopeId:eM,slotScopeIds:null,children:p,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:R,patchFlag:v,dynamicProps:A,dynamicChildren:null,appContext:null,ctx:$i};return i?(P1(G,p),R&128&&n.normalize(G)):p&&(G.shapeFlag|=Hn(p)?8:16),dm>0&&!D&&po&&(G.patchFlag>0||R&6)&&G.patchFlag!==32&&po.push(G),G}const dt=u4;function u4(n,l=null,p=null,v=0,A=null,R=!1){if((!n||n===_M)&&(n=ks),fm(n)){const i=xc(n,l,!0);return p&&P1(i,p),dm>0&&!R&&po&&(i.shapeFlag&6?po[po.indexOf(n)]=i:po.push(i)),i.patchFlag=-2,i}if(v4(n)&&(n=n.__vccOpts),l){l=h4(l);let{class:i,style:G}=l;i&&!Hn(i)&&(l.class=Ln(i)),Vn(G)&&(y1(G)&&!Nr(G)&&(G=Gi({},G)),l.style=Ou(G))}const D=Hn(n)?1:OM(n)?128:rM(n)?64:Vn(n)?4:Zr(n)?2:0;return Wr(n,l,p,v,A,D,R,!0)}function h4(n){return n?y1(n)||EM(n)?Gi({},n):n:null}function xc(n,l,p=!1,v=!1){const{props:A,ref:R,patchFlag:D,children:i,transition:G}=n,W=l?Ys(A||{},l):A,H={__v_isVNode:!0,__v_skip:!0,type:n.type,props:W,key:W&&FM(W),ref:l&&l.ref?p&&R?Nr(R)?R.concat(Vg(l)):[R,Vg(l)]:Vg(l):R,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:i,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:l&&n.type!==ti?D===-1?16:D|16:D,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:G,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&xc(n.ssContent),ssFallback:n.ssFallback&&xc(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return G&&v&&Fu(H,G.clone(H)),H}function Kp(n=" ",l=0){return dt(Fd,null,n,l)}function Zn(n="",l=!1){return l?(ir(),On(ks,null,n)):dt(ks,null,n)}function Ba(n){return n==null||typeof n=="boolean"?dt(ks):Nr(n)?dt(ti,null,n.slice()):fm(n)?dc(n):dt(Fd,null,String(n))}function dc(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:xc(n)}function P1(n,l){let p=0;const{shapeFlag:v}=n;if(l==null)l=null;else if(Nr(l))p=16;else if(typeof l=="object")if(v&65){const A=l.default;A&&(A._c&&(A._d=!1),P1(n,A()),A._c&&(A._d=!0));return}else{p=32;const A=l._;!A&&!EM(l)?l._ctx=$i:A===3&&$i&&($i.slots._===1?l._=1:(l._=2,n.patchFlag|=1024))}else Zr(l)?(l={default:l,_ctx:$i},p=32):(l=String(l),v&64?(p=16,l=[Kp(l)]):p=8);n.children=l,n.shapeFlag|=p}function Ys(...n){const l={};for(let p=0;p<n.length;p++){const v=n[p];for(const A in v)if(A==="class")l.class!==v.class&&(l.class=Ln([l.class,v.class]));else if(A==="style")l.style=Ou([l.style,v.style]);else if(gy(A)){const R=l[A],D=v[A];D&&R!==D&&!(Nr(R)&&R.includes(D))&&(l[A]=R?[].concat(R,D):D)}else A!==""&&(l[A]=v[A])}return l}function La(n,l,p,v=null){ua(n,l,7,[p,v])}const d4=wM();let f4=0;function p4(n,l,p){const v=n.type,A=(l?l.appContext:n.appContext)||d4,R={uid:f4++,vnode:n,type:v,parent:l,appContext:A,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new RA(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:l?l.provides:Object.create(A.provides),ids:l?l.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:MM(v,A),emitsOptions:LM(v,A),emit:null,emitted:null,propsDefaults:ni,inheritAttrs:v.inheritAttrs,ctx:ni,data:ni,props:ni,attrs:ni,slots:ni,refs:ni,setupState:ni,setupContext:null,suspense:p,suspenseId:p?p.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return R.ctx={_:R},R.root=l?l.root:R,R.emit=n4.bind(null,R),n.ce&&n.ce(R),R}let Xi=null;const Bs=()=>Xi||$i;let ry,Ox;{const n=xy(),l=(p,v)=>{let A;return(A=n[p])||(A=n[p]=[]),A.push(v),R=>{A.length>1?A.forEach(D=>D(R)):A[0](R)}};ry=l("__VUE_INSTANCE_SETTERS__",p=>Xi=p),Ox=l("__VUE_SSR_SETTERS__",p=>pm=p)}const Im=n=>{const l=Xi;return ry(n),n.scope.on(),()=>{n.scope.off(),ry(l)}},lS=()=>{Xi&&Xi.scope.off(),ry(null)};function BM(n){return n.vnode.shapeFlag&4}let pm=!1;function m4(n,l=!1,p=!1){l&&Ox(l);const{props:v,children:A}=n.vnode,R=BM(n);$z(n,v,R,l),Wz(n,A,p);const D=R?_4(n,l):void 0;return l&&Ox(!1),D}function _4(n,l){const p=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,zz);const{setup:v}=p;if(v){Ac();const A=n.setupContext=v.length>1?VM(n):null,R=Im(n),D=Mm(v,n,0,[n.props,A]),i=Xg(D);if(Mc(),R(),(i||n.sp)&&!Sd(n)&&uM(n),i){if(D.then(lS,lS),l)return D.then(G=>{cS(n,G)}).catch(G=>{Sy(G,n,0)});n.asyncDep=D}else cS(n,D)}else NM(n)}function cS(n,l,p){Zr(l)?n.type.__ssrInlineRender?n.ssrRender=l:n.render=l:Vn(l)&&(n.setupState=ZA(l)),NM(n)}function NM(n,l,p){const v=n.type;n.render||(n.render=v.render||_o);{const A=Im(n);Ac();try{Oz(n)}finally{Mc(),A()}}}const g4={get(n,l){return hs(n,"get",""),n[l]}};function VM(n){const l=p=>{n.exposed=p||{}};return{attrs:new Proxy(n.attrs,g4),slots:n.slots,emit:n.emit,expose:l}}function Iy(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(ZA(v1(n.exposed)),{get(l,p){if(p in l)return l[p];if(p in tm)return tm[p](n)},has(l,p){return p in l||p in tm}})):n.proxy}function y4(n,l=!0){return Zr(n)?n.displayName||n.name:n.name||l&&n.__name}function v4(n){return Zr(n)&&"__vccOpts"in n}const it=(n,l)=>gz(n,l,pm);function vl(n,l,p){const v=arguments.length;return v===2?Vn(l)&&!Nr(l)?fm(l)?dt(n,null,[l]):dt(n,l):dt(n,null,l):(v>3?p=Array.prototype.slice.call(arguments,2):v===3&&fm(p)&&(p=[p]),dt(n,l,p))}const x4="3.5.13",b4=_o;/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let kx;const uS=typeof window<"u"&&window.trustedTypes;if(uS)try{kx=uS.createPolicy("vue",{createHTML:n=>n})}catch{}const UM=kx?n=>kx.createHTML(n):n=>n,w4="http://www.w3.org/2000/svg",T4="http://www.w3.org/1998/Math/MathML",fl=typeof document<"u"?document:null,hS=fl&&fl.createElement("template"),S4={insert:(n,l,p)=>{l.insertBefore(n,p||null)},remove:n=>{const l=n.parentNode;l&&l.removeChild(n)},createElement:(n,l,p,v)=>{const A=l==="svg"?fl.createElementNS(w4,n):l==="mathml"?fl.createElementNS(T4,n):p?fl.createElement(n,{is:p}):fl.createElement(n);return n==="select"&&v&&v.multiple!=null&&A.setAttribute("multiple",v.multiple),A},createText:n=>fl.createTextNode(n),createComment:n=>fl.createComment(n),setText:(n,l)=>{n.nodeValue=l},setElementText:(n,l)=>{n.textContent=l},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>fl.querySelector(n),setScopeId(n,l){n.setAttribute(l,"")},insertStaticContent(n,l,p,v,A,R){const D=p?p.previousSibling:l.lastChild;if(A&&(A===R||A.nextSibling))for(;l.insertBefore(A.cloneNode(!0),p),!(A===R||!(A=A.nextSibling)););else{hS.innerHTML=UM(v==="svg"?`<svg>${n}</svg>`:v==="mathml"?`<math>${n}</math>`:n);const i=hS.content;if(v==="svg"||v==="mathml"){const G=i.firstChild;for(;G.firstChild;)i.appendChild(G.firstChild);i.removeChild(G)}l.insertBefore(i,p)}return[D?D.nextSibling:l.firstChild,p?p.previousSibling:l.lastChild]}},sc="transition",Gp="animation",Id=Symbol("_vtc"),jM={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},$M=Gi({},oM,jM),E4=n=>(n.displayName="Transition",n.props=$M,n),Cm=E4((n,{slots:l})=>vl(Ez,GM(n),l)),bu=(n,l=[])=>{Nr(n)?n.forEach(p=>p(...l)):n&&n(...l)},dS=n=>n?Nr(n)?n.some(l=>l.length>1):n.length>1:!1;function GM(n){const l={};for(const yt in n)yt in jM||(l[yt]=n[yt]);if(n.css===!1)return l;const{name:p="v",type:v,duration:A,enterFromClass:R=`${p}-enter-from`,enterActiveClass:D=`${p}-enter-active`,enterToClass:i=`${p}-enter-to`,appearFromClass:G=R,appearActiveClass:W=D,appearToClass:H=i,leaveFromClass:ee=`${p}-leave-from`,leaveActiveClass:ne=`${p}-leave-active`,leaveToClass:de=`${p}-leave-to`}=n,he=A4(A),ye=he&&he[0],Le=he&&he[1],{onBeforeEnter:je,onEnter:xt,onEnterCancelled:Dt,onLeave:ut,onLeaveCancelled:ht,onBeforeAppear:Et=je,onAppear:tt=xt,onAppearCancelled:At=Dt}=l,pt=(yt,sr,zr,Zt)=>{yt._enterCancelled=Zt,lc(yt,sr?H:i),lc(yt,sr?W:D),zr&&zr()},at=(yt,sr)=>{yt._isLeaving=!1,lc(yt,ee),lc(yt,de),lc(yt,ne),sr&&sr()},gt=yt=>(sr,zr)=>{const Zt=yt?tt:xt,Ir=()=>pt(sr,yt,zr);bu(Zt,[sr,Ir]),fS(()=>{lc(sr,yt?G:R),ka(sr,yt?H:i),dS(Zt)||pS(sr,v,ye,Ir)})};return Gi(l,{onBeforeEnter(yt){bu(je,[yt]),ka(yt,R),ka(yt,D)},onBeforeAppear(yt){bu(Et,[yt]),ka(yt,G),ka(yt,W)},onEnter:gt(!1),onAppear:gt(!0),onLeave(yt,sr){yt._isLeaving=!0;const zr=()=>at(yt,sr);ka(yt,ee),yt._enterCancelled?(ka(yt,ne),Fx()):(Fx(),ka(yt,ne)),fS(()=>{yt._isLeaving&&(lc(yt,ee),ka(yt,de),dS(ut)||pS(yt,v,Le,zr))}),bu(ut,[yt,zr])},onEnterCancelled(yt){pt(yt,!1,void 0,!0),bu(Dt,[yt])},onAppearCancelled(yt){pt(yt,!0,void 0,!0),bu(At,[yt])},onLeaveCancelled(yt){at(yt),bu(ht,[yt])}})}function A4(n){if(n==null)return null;if(Vn(n))return[lx(n.enter),lx(n.leave)];{const l=lx(n);return[l,l]}}function lx(n){return ND(n)}function ka(n,l){l.split(/\s+/).forEach(p=>p&&n.classList.add(p)),(n[Id]||(n[Id]=new Set)).add(l)}function lc(n,l){l.split(/\s+/).forEach(v=>v&&n.classList.remove(v));const p=n[Id];p&&(p.delete(l),p.size||(n[Id]=void 0))}function fS(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let M4=0;function pS(n,l,p,v){const A=n._endId=++M4,R=()=>{A===n._endId&&v()};if(p!=null)return setTimeout(R,p);const{type:D,timeout:i,propCount:G}=HM(n,l);if(!D)return v();const W=D+"end";let H=0;const ee=()=>{n.removeEventListener(W,ne),R()},ne=de=>{de.target===n&&++H>=G&&ee()};setTimeout(()=>{H<G&&ee()},i+1),n.addEventListener(W,ne)}function HM(n,l){const p=window.getComputedStyle(n),v=he=>(p[he]||"").split(", "),A=v(`${sc}Delay`),R=v(`${sc}Duration`),D=mS(A,R),i=v(`${Gp}Delay`),G=v(`${Gp}Duration`),W=mS(i,G);let H=null,ee=0,ne=0;l===sc?D>0&&(H=sc,ee=D,ne=R.length):l===Gp?W>0&&(H=Gp,ee=W,ne=G.length):(ee=Math.max(D,W),H=ee>0?D>W?sc:Gp:null,ne=H?H===sc?R.length:G.length:0);const de=H===sc&&/\b(transform|all)(,|$)/.test(v(`${sc}Property`).toString());return{type:H,timeout:ee,propCount:ne,hasTransform:de}}function mS(n,l){for(;n.length<l.length;)n=n.concat(n);return Math.max(...l.map((p,v)=>_S(p)+_S(n[v])))}function _S(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function Fx(){return document.body.offsetHeight}function I4(n,l,p){const v=n[Id];v&&(l=(l?[l,...v]:[...v]).join(" ")),l==null?n.removeAttribute("class"):p?n.setAttribute("class",l):n.className=l}const ny=Symbol("_vod"),qM=Symbol("_vsh"),WM={beforeMount(n,{value:l},{transition:p}){n[ny]=n.style.display==="none"?"":n.style.display,p&&l?p.beforeEnter(n):Hp(n,l)},mounted(n,{value:l},{transition:p}){p&&l&&p.enter(n)},updated(n,{value:l,oldValue:p},{transition:v}){!l!=!p&&(v?l?(v.beforeEnter(n),Hp(n,!0),v.enter(n)):v.leave(n,()=>{Hp(n,!1)}):Hp(n,l))},beforeUnmount(n,{value:l}){Hp(n,l)}};function Hp(n,l){n.style.display=l?n[ny]:"none",n[qM]=!l}const C4=Symbol(""),P4=/(^|;)\s*display\s*:/;function R4(n,l,p){const v=n.style,A=Hn(p);let R=!1;if(p&&!A){if(l)if(Hn(l))for(const D of l.split(";")){const i=D.slice(0,D.indexOf(":")).trim();p[i]==null&&Ug(v,i,"")}else for(const D in l)p[D]==null&&Ug(v,D,"");for(const D in p)D==="display"&&(R=!0),Ug(v,D,p[D])}else if(A){if(l!==p){const D=v[C4];D&&(p+=";"+D),v.cssText=p,R=P4.test(p)}}else l&&n.removeAttribute("style");ny in n&&(n[ny]=R?v.display:"",n[qM]&&(v.display="none"))}const gS=/\s*!important$/;function Ug(n,l,p){if(Nr(p))p.forEach(v=>Ug(n,l,v));else if(p==null&&(p=""),l.startsWith("--"))n.setProperty(l,p);else{const v=D4(n,l);gS.test(p)?n.setProperty(Sc(v),p.replace(gS,""),"important"):n[v]=p}}const yS=["Webkit","Moz","ms"],cx={};function D4(n,l){const p=cx[l];if(p)return p;let v=Fs(l);if(v!=="filter"&&v in n)return cx[l]=v;v=Ec(v);for(let A=0;A<yS.length;A++){const R=yS[A]+v;if(R in n)return cx[l]=R}return l}const vS="http://www.w3.org/1999/xlink";function xS(n,l,p,v,A,R=HD(l)){v&&l.startsWith("xlink:")?p==null?n.removeAttributeNS(vS,l.slice(6,l.length)):n.setAttributeNS(vS,l,p):p==null||R&&!MA(p)?n.removeAttribute(l):n.setAttribute(l,R?"":ca(p)?String(p):p)}function bS(n,l,p,v,A){if(l==="innerHTML"||l==="textContent"){p!=null&&(n[l]=l==="innerHTML"?UM(p):p);return}const R=n.tagName;if(l==="value"&&R!=="PROGRESS"&&!R.includes("-")){const i=R==="OPTION"?n.getAttribute("value")||"":n.value,G=p==null?n.type==="checkbox"?"on":"":String(p);(i!==G||!("_value"in n))&&(n.value=G),p==null&&n.removeAttribute(l),n._value=p;return}let D=!1;if(p===""||p==null){const i=typeof n[l];i==="boolean"?p=MA(p):p==null&&i==="string"?(p="",D=!0):i==="number"&&(p=0,D=!0)}try{n[l]=p}catch{}D&&n.removeAttribute(A||l)}function pc(n,l,p,v){n.addEventListener(l,p,v)}function z4(n,l,p,v){n.removeEventListener(l,p,v)}const wS=Symbol("_vei");function L4(n,l,p,v,A=null){const R=n[wS]||(n[wS]={}),D=R[l];if(v&&D)D.value=v;else{const[i,G]=O4(l);if(v){const W=R[l]=B4(v,A);pc(n,i,W,G)}else D&&(z4(n,i,D,G),R[l]=void 0)}}const TS=/(?:Once|Passive|Capture)$/;function O4(n){let l;if(TS.test(n)){l={};let v;for(;v=n.match(TS);)n=n.slice(0,n.length-v[0].length),l[v[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Sc(n.slice(2)),l]}let ux=0;const k4=Promise.resolve(),F4=()=>ux||(k4.then(()=>ux=0),ux=Date.now());function B4(n,l){const p=v=>{if(!v._vts)v._vts=Date.now();else if(v._vts<=p.attached)return;ua(N4(v,p.value),l,5,[v])};return p.value=n,p.attached=F4(),p}function N4(n,l){if(Nr(l)){const p=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{p.call(n),n._stopped=!0},l.map(v=>A=>!A._stopped&&v&&v(A))}else return l}const SS=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,V4=(n,l,p,v,A,R)=>{const D=A==="svg";l==="class"?I4(n,v,D):l==="style"?R4(n,p,v):gy(l)?a1(l)||L4(n,l,p,v,R):(l[0]==="."?(l=l.slice(1),!0):l[0]==="^"?(l=l.slice(1),!1):U4(n,l,v,D))?(bS(n,l,v),!n.tagName.includes("-")&&(l==="value"||l==="checked"||l==="selected")&&xS(n,l,v,D,R,l!=="value")):n._isVueCE&&(/[A-Z]/.test(l)||!Hn(v))?bS(n,Fs(l),v,R,l):(l==="true-value"?n._trueValue=v:l==="false-value"&&(n._falseValue=v),xS(n,l,v,D))};function U4(n,l,p,v){if(v)return!!(l==="innerHTML"||l==="textContent"||l in n&&SS(l)&&Zr(p));if(l==="spellcheck"||l==="draggable"||l==="translate"||l==="form"||l==="list"&&n.tagName==="INPUT"||l==="type"&&n.tagName==="TEXTAREA")return!1;if(l==="width"||l==="height"){const A=n.tagName;if(A==="IMG"||A==="VIDEO"||A==="CANVAS"||A==="SOURCE")return!1}return SS(l)&&Hn(p)?!1:l in n}const ZM=new WeakMap,XM=new WeakMap,iy=Symbol("_moveCb"),ES=Symbol("_enterCb"),j4=n=>(delete n.props.mode,n),$4=j4({name:"TransitionGroup",props:Gi({},$M,{tag:String,moveClass:String}),setup(n,{slots:l}){const p=Bs(),v=sM();let A,R;return w1(()=>{if(!A.length)return;const D=n.moveClass||`${n.name||"v"}-move`;if(!W4(A[0].el,p.vnode.el,D))return;A.forEach(G4),A.forEach(H4);const i=A.filter(q4);Fx(),i.forEach(G=>{const W=G.el,H=W.style;ka(W,D),H.transform=H.webkitTransform=H.transitionDuration="";const ee=W[iy]=ne=>{ne&&ne.target!==W||(!ne||/transform$/.test(ne.propertyName))&&(W.removeEventListener("transitionend",ee),W[iy]=null,lc(W,D))};W.addEventListener("transitionend",ee)})}),()=>{const D=Rn(n),i=GM(D);let G=D.tag||ti;if(A=[],R)for(let W=0;W<R.length;W++){const H=R[W];H.el&&H.el instanceof Element&&(A.push(H),Fu(H,hm(H,i,v,p)),ZM.set(H,H.el.getBoundingClientRect()))}R=l.default?b1(l.default()):[];for(let W=0;W<R.length;W++){const H=R[W];H.key!=null&&Fu(H,hm(H,i,v,p))}return dt(G,null,R)}}}),R1=$4;function G4(n){const l=n.el;l[iy]&&l[iy](),l[ES]&&l[ES]()}function H4(n){XM.set(n,n.el.getBoundingClientRect())}function q4(n){const l=ZM.get(n),p=XM.get(n),v=l.left-p.left,A=l.top-p.top;if(v||A){const R=n.el.style;return R.transform=R.webkitTransform=`translate(${v}px,${A}px)`,R.transitionDuration="0s",n}}function W4(n,l,p){const v=n.cloneNode(),A=n[Id];A&&A.forEach(i=>{i.split(/\s+/).forEach(G=>G&&v.classList.remove(G))}),p.split(/\s+/).forEach(i=>i&&v.classList.add(i)),v.style.display="none";const R=l.nodeType===1?l:l.parentNode;R.appendChild(v);const{hasTransform:D}=HM(v);return R.removeChild(v),D}const Cd=n=>{const l=n.props["onUpdate:modelValue"]||!1;return Nr(l)?p=>Bg(l,p):l};function Z4(n){n.target.composing=!0}function AS(n){const l=n.target;l.composing&&(l.composing=!1,l.dispatchEvent(new Event("input")))}const gl=Symbol("_assign"),ej={created(n,{modifiers:{lazy:l,trim:p,number:v}},A){n[gl]=Cd(A);const R=v||A.props&&A.props.type==="number";pc(n,l?"change":"input",D=>{if(D.target.composing)return;let i=n.value;p&&(i=i.trim()),R&&(i=Ex(i)),n[gl](i)}),p&&pc(n,"change",()=>{n.value=n.value.trim()}),l||(pc(n,"compositionstart",Z4),pc(n,"compositionend",AS),pc(n,"change",AS))},mounted(n,{value:l}){n.value=l??""},beforeUpdate(n,{value:l,oldValue:p,modifiers:{lazy:v,trim:A,number:R}},D){if(n[gl]=Cd(D),n.composing)return;const i=(R||n.type==="number")&&!/^0\d/.test(n.value)?Ex(n.value):n.value,G=l??"";i!==G&&(document.activeElement===n&&n.type!=="range"&&(v&&l===p||A&&n.value.trim()===G)||(n.value=G))}},tj={deep:!0,created(n,l,p){n[gl]=Cd(p),pc(n,"change",()=>{const v=n._modelValue,A=KM(n),R=n.checked,D=n[gl];if(Nr(v)){const i=IA(v,A),G=i!==-1;if(R&&!G)D(v.concat(A));else if(!R&&G){const W=[...v];W.splice(i,1),D(W)}}else if(yy(v)){const i=new Set(v);R?i.add(A):i.delete(A),D(i)}else D(YM(n,R))})},mounted:MS,beforeUpdate(n,l,p){n[gl]=Cd(p),MS(n,l,p)}};function MS(n,{value:l,oldValue:p},v){n._modelValue=l;let A;if(Nr(l))A=IA(l,v.props.value)>-1;else if(yy(l))A=l.has(v.props.value);else{if(l===p)return;A=Md(l,YM(n,!0))}n.checked!==A&&(n.checked=A)}const rj={created(n,{value:l},p){n.checked=Md(l,p.props.value),n[gl]=Cd(p),pc(n,"change",()=>{n[gl](KM(n))})},beforeUpdate(n,{value:l,oldValue:p},v){n[gl]=Cd(v),l!==p&&(n.checked=Md(l,v.props.value))}};function KM(n){return"_value"in n?n._value:n.value}function YM(n,l){const p=l?"_trueValue":"_falseValue";return p in n?n[p]:l}const X4=["ctrl","shift","alt","meta"],K4={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,l)=>X4.some(p=>n[`${p}Key`]&&!l.includes(p))},JM=(n,l)=>{const p=n._withMods||(n._withMods={}),v=l.join(".");return p[v]||(p[v]=(A,...R)=>{for(let D=0;D<l.length;D++){const i=K4[l[D]];if(i&&i(A,l))return}return n(A,...R)})},Y4={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},J4=(n,l)=>{const p=n._withKeys||(n._withKeys={}),v=l.join(".");return p[v]||(p[v]=A=>{if(!("key"in A))return;const R=Sc(A.key);if(l.some(D=>D===R||Y4[D]===R))return n(A)})},Q4=Gi({patchProp:V4},S4);let IS;function QM(){return IS||(IS=Xz(Q4))}const nj=(...n)=>{QM().render(...n)},eL=(...n)=>{const l=QM().createApp(...n),{mount:p}=l;return l.mount=v=>{const A=rL(v);if(!A)return;const R=l._component;!Zr(R)&&!R.render&&!R.template&&(R.template=A.innerHTML),A.nodeType===1&&(A.textContent="");const D=p(A,!1,tL(A));return A instanceof Element&&(A.removeAttribute("v-cloak"),A.setAttribute("data-v-app","")),D},l};function tL(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function rL(n){return Hn(n)?document.querySelector(n):n}/*!
 * pinia v3.0.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let eI;const Cy=n=>eI=n,tI=Symbol();function Bx(n){return n&&typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"&&typeof n.toJSON!="function"}var nm;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(nm||(nm={}));function nL(){const n=u1(!0),l=n.run(()=>hn({}));let p=[],v=[];const A=v1({install(R){Cy(A),A._a=R,R.provide(tI,A),R.config.globalProperties.$pinia=A,v.forEach(D=>p.push(D)),v=[]},use(R){return this._a?p.push(R):v.push(R),this},_p:p,_a:null,_e:n,_s:new Map,state:l});return A}const rI=()=>{};function CS(n,l,p,v=rI){n.push(l);const A=()=>{const R=n.indexOf(l);R>-1&&(n.splice(R,1),v())};return!p&&h1()&&by(A),A}function fd(n,...l){n.slice().forEach(p=>{p(...l)})}const iL=n=>n(),PS=Symbol(),hx=Symbol();function Nx(n,l){n instanceof Map&&l instanceof Map?l.forEach((p,v)=>n.set(v,p)):n instanceof Set&&l instanceof Set&&l.forEach(n.add,n);for(const p in l){if(!l.hasOwnProperty(p))continue;const v=l[p],A=n[p];Bx(A)&&Bx(v)&&n.hasOwnProperty(p)&&!Yn(v)&&!vc(v)?n[p]=Nx(A,v):n[p]=v}return n}const sL=Symbol();function oL(n){return!Bx(n)||!n.hasOwnProperty(sL)}const{assign:cc}=Object;function aL(n){return!!(Yn(n)&&n.effect)}function lL(n,l,p,v){const{state:A,actions:R,getters:D}=l,i=p.state.value[n];let G;function W(){i||(p.state.value[n]=A?A():{});const H=Ty(p.state.value[n]);return cc(H,R,Object.keys(D||{}).reduce((ee,ne)=>(ee[ne]=v1(it(()=>{Cy(p);const de=p._s.get(n);return D[ne].call(de,de)})),ee),{}))}return G=nI(n,W,l,p,v,!0),G}function nI(n,l,p={},v,A,R){let D;const i=cc({actions:{}},p),G={deep:!0};let W,H,ee=[],ne=[],de;const he=v.state.value[n];!R&&!he&&(v.state.value[n]={}),hn({});let ye;function Le(At){let pt;W=H=!1,typeof At=="function"?(At(v.state.value[n]),pt={type:nm.patchFunction,storeId:n,events:de}):(Nx(v.state.value[n],At),pt={type:nm.patchObject,payload:At,storeId:n,events:de});const at=ye=Symbol();Zs().then(()=>{ye===at&&(W=!0)}),H=!0,fd(ee,pt,v.state.value[n])}const je=R?function(){const{state:pt}=p,at=pt?pt():{};this.$patch(gt=>{cc(gt,at)})}:rI;function xt(){D.stop(),ee=[],ne=[],v._s.delete(n)}const Dt=(At,pt="")=>{if(PS in At)return At[hx]=pt,At;const at=function(){Cy(v);const gt=Array.from(arguments),yt=[],sr=[];function zr(vr){yt.push(vr)}function Zt(vr){sr.push(vr)}fd(ne,{args:gt,name:at[hx],store:ht,after:zr,onError:Zt});let Ir;try{Ir=At.apply(this&&this.$id===n?this:ht,gt)}catch(vr){throw fd(sr,vr),vr}return Ir instanceof Promise?Ir.then(vr=>(fd(yt,vr),vr)).catch(vr=>(fd(sr,vr),Promise.reject(vr))):(fd(yt,Ir),Ir)};return at[PS]=!0,at[hx]=pt,at},ut={_p:v,$id:n,$onAction:CS.bind(null,ne),$patch:Le,$reset:je,$subscribe(At,pt={}){const at=CS(ee,At,pt.detached,()=>gt()),gt=D.run(()=>Tn(()=>v.state.value[n],yt=>{(pt.flush==="sync"?H:W)&&At({storeId:n,type:nm.direct,events:de},yt)},cc({},G,pt)));return at},$dispose:xt},ht=Zi(ut);v._s.set(n,ht);const tt=(v._a&&v._a.runWithContext||iL)(()=>v._e.run(()=>(D=u1()).run(()=>l({action:Dt}))));for(const At in tt){const pt=tt[At];if(Yn(pt)&&!aL(pt)||vc(pt))R||(he&&oL(pt)&&(Yn(pt)?pt.value=he[At]:Nx(pt,he[At])),v.state.value[n][At]=pt);else if(typeof pt=="function"){const at=Dt(pt,At);tt[At]=at,i.actions[At]=pt}}return cc(ht,tt),cc(Rn(ht),tt),Object.defineProperty(ht,"$state",{get:()=>v.state.value[n],set:At=>{Le(pt=>{cc(pt,At)})}}),v._p.forEach(At=>{cc(ht,D.run(()=>At({store:ht,app:v._a,pinia:v,options:i})))}),he&&R&&p.hydrate&&p.hydrate(ht.$state,he),W=!0,H=!0,ht}/*! #__NO_SIDE_EFFECTS__ */function iI(n,l,p){let v;const A=typeof l=="function";v=A?p:l;function R(D,i){const G=jz();return D=D||(G?Mn(tI,null):null),D&&Cy(D),D=eI,D._s.has(n)||(A?nI(n,l,v,D):lL(n,v,D)),D._s.get(n)}return R.$id=n,R}const cL={name:"App"},D1=(n,l)=>{const p=n.__vccOpts||n;for(const[v,A]of l)p[v]=A;return p};function uL(n,l,p,v,A,R){const D=mM("RouterView");return ir(),On(D)}const hL=D1(cL,[["render",uL]]);/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const vd=typeof document<"u";function sI(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function dL(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&sI(n.default)}const Kn=Object.assign;function dx(n,l){const p={};for(const v in l){const A=l[v];p[v]=ha(A)?A.map(n):n(A)}return p}const im=()=>{},ha=Array.isArray,oI=/#/g,fL=/&/g,pL=/\//g,mL=/=/g,_L=/\?/g,aI=/\+/g,gL=/%5B/g,yL=/%5D/g,lI=/%5E/g,vL=/%60/g,cI=/%7B/g,xL=/%7C/g,uI=/%7D/g,bL=/%20/g;function z1(n){return encodeURI(""+n).replace(xL,"|").replace(gL,"[").replace(yL,"]")}function wL(n){return z1(n).replace(cI,"{").replace(uI,"}").replace(lI,"^")}function Vx(n){return z1(n).replace(aI,"%2B").replace(bL,"+").replace(oI,"%23").replace(fL,"%26").replace(vL,"`").replace(cI,"{").replace(uI,"}").replace(lI,"^")}function TL(n){return Vx(n).replace(mL,"%3D")}function SL(n){return z1(n).replace(oI,"%23").replace(_L,"%3F")}function EL(n){return n==null?"":SL(n).replace(pL,"%2F")}function mm(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const AL=/\/$/,ML=n=>n.replace(AL,"");function fx(n,l,p="/"){let v,A={},R="",D="";const i=l.indexOf("#");let G=l.indexOf("?");return i<G&&i>=0&&(G=-1),G>-1&&(v=l.slice(0,G),R=l.slice(G+1,i>-1?i:l.length),A=n(R)),i>-1&&(v=v||l.slice(0,i),D=l.slice(i,l.length)),v=RL(v??l,p),{fullPath:v+(R&&"?")+R+D,path:v,query:A,hash:mm(D)}}function IL(n,l){const p=l.query?n(l.query):"";return l.path+(p&&"?")+p+(l.hash||"")}function RS(n,l){return!l||!n.toLowerCase().startsWith(l.toLowerCase())?n:n.slice(l.length)||"/"}function CL(n,l,p){const v=l.matched.length-1,A=p.matched.length-1;return v>-1&&v===A&&Pd(l.matched[v],p.matched[A])&&hI(l.params,p.params)&&n(l.query)===n(p.query)&&l.hash===p.hash}function Pd(n,l){return(n.aliasOf||n)===(l.aliasOf||l)}function hI(n,l){if(Object.keys(n).length!==Object.keys(l).length)return!1;for(const p in n)if(!PL(n[p],l[p]))return!1;return!0}function PL(n,l){return ha(n)?DS(n,l):ha(l)?DS(l,n):n===l}function DS(n,l){return ha(l)?n.length===l.length&&n.every((p,v)=>p===l[v]):n.length===1&&n[0]===l}function RL(n,l){if(n.startsWith("/"))return n;if(!n)return l;const p=l.split("/"),v=n.split("/"),A=v[v.length-1];(A===".."||A===".")&&v.push("");let R=p.length-1,D,i;for(D=0;D<v.length;D++)if(i=v[D],i!==".")if(i==="..")R>1&&R--;else break;return p.slice(0,R).join("/")+"/"+v.slice(D).join("/")}const oc={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var _m;(function(n){n.pop="pop",n.push="push"})(_m||(_m={}));var sm;(function(n){n.back="back",n.forward="forward",n.unknown=""})(sm||(sm={}));function DL(n){if(!n)if(vd){const l=document.querySelector("base");n=l&&l.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),ML(n)}const zL=/^[^#]+#/;function LL(n,l){return n.replace(zL,"#")+l}function OL(n,l){const p=document.documentElement.getBoundingClientRect(),v=n.getBoundingClientRect();return{behavior:l.behavior,left:v.left-p.left-(l.left||0),top:v.top-p.top-(l.top||0)}}const Py=()=>({left:window.scrollX,top:window.scrollY});function kL(n){let l;if("el"in n){const p=n.el,v=typeof p=="string"&&p.startsWith("#"),A=typeof p=="string"?v?document.getElementById(p.slice(1)):document.querySelector(p):p;if(!A)return;l=OL(A,n)}else l=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(l):window.scrollTo(l.left!=null?l.left:window.scrollX,l.top!=null?l.top:window.scrollY)}function zS(n,l){return(history.state?history.state.position-l:-1)+n}const Ux=new Map;function FL(n,l){Ux.set(n,l)}function BL(n){const l=Ux.get(n);return Ux.delete(n),l}let NL=()=>location.protocol+"//"+location.host;function dI(n,l){const{pathname:p,search:v,hash:A}=l,R=n.indexOf("#");if(R>-1){let i=A.includes(n.slice(R))?n.slice(R).length:1,G=A.slice(i);return G[0]!=="/"&&(G="/"+G),RS(G,"")}return RS(p,n)+v+A}function VL(n,l,p,v){let A=[],R=[],D=null;const i=({state:ne})=>{const de=dI(n,location),he=p.value,ye=l.value;let Le=0;if(ne){if(p.value=de,l.value=ne,D&&D===he){D=null;return}Le=ye?ne.position-ye.position:0}else v(de);A.forEach(je=>{je(p.value,he,{delta:Le,type:_m.pop,direction:Le?Le>0?sm.forward:sm.back:sm.unknown})})};function G(){D=p.value}function W(ne){A.push(ne);const de=()=>{const he=A.indexOf(ne);he>-1&&A.splice(he,1)};return R.push(de),de}function H(){const{history:ne}=window;ne.state&&ne.replaceState(Kn({},ne.state,{scroll:Py()}),"")}function ee(){for(const ne of R)ne();R=[],window.removeEventListener("popstate",i),window.removeEventListener("beforeunload",H)}return window.addEventListener("popstate",i),window.addEventListener("beforeunload",H,{passive:!0}),{pauseListeners:G,listen:W,destroy:ee}}function LS(n,l,p,v=!1,A=!1){return{back:n,current:l,forward:p,replaced:v,position:window.history.length,scroll:A?Py():null}}function UL(n){const{history:l,location:p}=window,v={value:dI(n,p)},A={value:l.state};A.value||R(v.value,{back:null,current:v.value,forward:null,position:l.length-1,replaced:!0,scroll:null},!0);function R(G,W,H){const ee=n.indexOf("#"),ne=ee>-1?(p.host&&document.querySelector("base")?n:n.slice(ee))+G:NL()+n+G;try{l[H?"replaceState":"pushState"](W,"",ne),A.value=W}catch(de){console.error(de),p[H?"replace":"assign"](ne)}}function D(G,W){const H=Kn({},l.state,LS(A.value.back,G,A.value.forward,!0),W,{position:A.value.position});R(G,H,!0),v.value=G}function i(G,W){const H=Kn({},A.value,l.state,{forward:G,scroll:Py()});R(H.current,H,!0);const ee=Kn({},LS(v.value,G,null),{position:H.position+1},W);R(G,ee,!1),v.value=G}return{location:v,state:A,push:i,replace:D}}function jL(n){n=DL(n);const l=UL(n),p=VL(n,l.state,l.location,l.replace);function v(R,D=!0){D||p.pauseListeners(),history.go(R)}const A=Kn({location:"",base:n,go:v,createHref:LL.bind(null,n)},l,p);return Object.defineProperty(A,"location",{enumerable:!0,get:()=>l.location.value}),Object.defineProperty(A,"state",{enumerable:!0,get:()=>l.state.value}),A}function $L(n){return typeof n=="string"||n&&typeof n=="object"}function fI(n){return typeof n=="string"||typeof n=="symbol"}const pI=Symbol("");var OS;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(OS||(OS={}));function Rd(n,l){return Kn(new Error,{type:n,[pI]:!0},l)}function hl(n,l){return n instanceof Error&&pI in n&&(l==null||!!(n.type&l))}const kS="[^/]+?",GL={sensitive:!1,strict:!1,start:!0,end:!0},HL=/[.+*?^${}()[\]/\\]/g;function qL(n,l){const p=Kn({},GL,l),v=[];let A=p.start?"^":"";const R=[];for(const W of n){const H=W.length?[]:[90];p.strict&&!W.length&&(A+="/");for(let ee=0;ee<W.length;ee++){const ne=W[ee];let de=40+(p.sensitive?.25:0);if(ne.type===0)ee||(A+="/"),A+=ne.value.replace(HL,"\\$&"),de+=40;else if(ne.type===1){const{value:he,repeatable:ye,optional:Le,regexp:je}=ne;R.push({name:he,repeatable:ye,optional:Le});const xt=je||kS;if(xt!==kS){de+=10;try{new RegExp(`(${xt})`)}catch(ut){throw new Error(`Invalid custom RegExp for param "${he}" (${xt}): `+ut.message)}}let Dt=ye?`((?:${xt})(?:/(?:${xt}))*)`:`(${xt})`;ee||(Dt=Le&&W.length<2?`(?:/${Dt})`:"/"+Dt),Le&&(Dt+="?"),A+=Dt,de+=20,Le&&(de+=-8),ye&&(de+=-20),xt===".*"&&(de+=-50)}H.push(de)}v.push(H)}if(p.strict&&p.end){const W=v.length-1;v[W][v[W].length-1]+=.7000000000000001}p.strict||(A+="/?"),p.end?A+="$":p.strict&&!A.endsWith("/")&&(A+="(?:/|$)");const D=new RegExp(A,p.sensitive?"":"i");function i(W){const H=W.match(D),ee={};if(!H)return null;for(let ne=1;ne<H.length;ne++){const de=H[ne]||"",he=R[ne-1];ee[he.name]=de&&he.repeatable?de.split("/"):de}return ee}function G(W){let H="",ee=!1;for(const ne of n){(!ee||!H.endsWith("/"))&&(H+="/"),ee=!1;for(const de of ne)if(de.type===0)H+=de.value;else if(de.type===1){const{value:he,repeatable:ye,optional:Le}=de,je=he in W?W[he]:"";if(ha(je)&&!ye)throw new Error(`Provided param "${he}" is an array but it is not repeatable (* or + modifiers)`);const xt=ha(je)?je.join("/"):je;if(!xt)if(Le)ne.length<2&&(H.endsWith("/")?H=H.slice(0,-1):ee=!0);else throw new Error(`Missing required param "${he}"`);H+=xt}}return H||"/"}return{re:D,score:v,keys:R,parse:i,stringify:G}}function WL(n,l){let p=0;for(;p<n.length&&p<l.length;){const v=l[p]-n[p];if(v)return v;p++}return n.length<l.length?n.length===1&&n[0]===80?-1:1:n.length>l.length?l.length===1&&l[0]===80?1:-1:0}function mI(n,l){let p=0;const v=n.score,A=l.score;for(;p<v.length&&p<A.length;){const R=WL(v[p],A[p]);if(R)return R;p++}if(Math.abs(A.length-v.length)===1){if(FS(v))return 1;if(FS(A))return-1}return A.length-v.length}function FS(n){const l=n[n.length-1];return n.length>0&&l[l.length-1]<0}const ZL={type:0,value:""},XL=/[a-zA-Z0-9_]/;function KL(n){if(!n)return[[]];if(n==="/")return[[ZL]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function l(de){throw new Error(`ERR (${p})/"${W}": ${de}`)}let p=0,v=p;const A=[];let R;function D(){R&&A.push(R),R=[]}let i=0,G,W="",H="";function ee(){W&&(p===0?R.push({type:0,value:W}):p===1||p===2||p===3?(R.length>1&&(G==="*"||G==="+")&&l(`A repeatable param (${W}) must be alone in its segment. eg: '/:ids+.`),R.push({type:1,value:W,regexp:H,repeatable:G==="*"||G==="+",optional:G==="*"||G==="?"})):l("Invalid state to consume buffer"),W="")}function ne(){W+=G}for(;i<n.length;){if(G=n[i++],G==="\\"&&p!==2){v=p,p=4;continue}switch(p){case 0:G==="/"?(W&&ee(),D()):G===":"?(ee(),p=1):ne();break;case 4:ne(),p=v;break;case 1:G==="("?p=2:XL.test(G)?ne():(ee(),p=0,G!=="*"&&G!=="?"&&G!=="+"&&i--);break;case 2:G===")"?H[H.length-1]=="\\"?H=H.slice(0,-1)+G:p=3:H+=G;break;case 3:ee(),p=0,G!=="*"&&G!=="?"&&G!=="+"&&i--,H="";break;default:l("Unknown state");break}}return p===2&&l(`Unfinished custom RegExp for param "${W}"`),ee(),D(),A}function YL(n,l,p){const v=qL(KL(n.path),p),A=Kn(v,{record:n,parent:l,children:[],alias:[]});return l&&!A.record.aliasOf==!l.record.aliasOf&&l.children.push(A),A}function JL(n,l){const p=[],v=new Map;l=US({strict:!1,end:!0,sensitive:!1},l);function A(ee){return v.get(ee)}function R(ee,ne,de){const he=!de,ye=NS(ee);ye.aliasOf=de&&de.record;const Le=US(l,ee),je=[ye];if("alias"in ee){const ut=typeof ee.alias=="string"?[ee.alias]:ee.alias;for(const ht of ut)je.push(NS(Kn({},ye,{components:de?de.record.components:ye.components,path:ht,aliasOf:de?de.record:ye})))}let xt,Dt;for(const ut of je){const{path:ht}=ut;if(ne&&ht[0]!=="/"){const Et=ne.record.path,tt=Et[Et.length-1]==="/"?"":"/";ut.path=ne.record.path+(ht&&tt+ht)}if(xt=YL(ut,ne,Le),de?de.alias.push(xt):(Dt=Dt||xt,Dt!==xt&&Dt.alias.push(xt),he&&ee.name&&!VS(xt)&&D(ee.name)),_I(xt)&&G(xt),ye.children){const Et=ye.children;for(let tt=0;tt<Et.length;tt++)R(Et[tt],xt,de&&de.children[tt])}de=de||xt}return Dt?()=>{D(Dt)}:im}function D(ee){if(fI(ee)){const ne=v.get(ee);ne&&(v.delete(ee),p.splice(p.indexOf(ne),1),ne.children.forEach(D),ne.alias.forEach(D))}else{const ne=p.indexOf(ee);ne>-1&&(p.splice(ne,1),ee.record.name&&v.delete(ee.record.name),ee.children.forEach(D),ee.alias.forEach(D))}}function i(){return p}function G(ee){const ne=tO(ee,p);p.splice(ne,0,ee),ee.record.name&&!VS(ee)&&v.set(ee.record.name,ee)}function W(ee,ne){let de,he={},ye,Le;if("name"in ee&&ee.name){if(de=v.get(ee.name),!de)throw Rd(1,{location:ee});Le=de.record.name,he=Kn(BS(ne.params,de.keys.filter(Dt=>!Dt.optional).concat(de.parent?de.parent.keys.filter(Dt=>Dt.optional):[]).map(Dt=>Dt.name)),ee.params&&BS(ee.params,de.keys.map(Dt=>Dt.name))),ye=de.stringify(he)}else if(ee.path!=null)ye=ee.path,de=p.find(Dt=>Dt.re.test(ye)),de&&(he=de.parse(ye),Le=de.record.name);else{if(de=ne.name?v.get(ne.name):p.find(Dt=>Dt.re.test(ne.path)),!de)throw Rd(1,{location:ee,currentLocation:ne});Le=de.record.name,he=Kn({},ne.params,ee.params),ye=de.stringify(he)}const je=[];let xt=de;for(;xt;)je.unshift(xt.record),xt=xt.parent;return{name:Le,path:ye,params:he,matched:je,meta:eO(je)}}n.forEach(ee=>R(ee));function H(){p.length=0,v.clear()}return{addRoute:R,resolve:W,removeRoute:D,clearRoutes:H,getRoutes:i,getRecordMatcher:A}}function BS(n,l){const p={};for(const v of l)v in n&&(p[v]=n[v]);return p}function NS(n){const l={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:QL(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(l,"mods",{value:{}}),l}function QL(n){const l={},p=n.props||!1;if("component"in n)l.default=p;else for(const v in n.components)l[v]=typeof p=="object"?p[v]:p;return l}function VS(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function eO(n){return n.reduce((l,p)=>Kn(l,p.meta),{})}function US(n,l){const p={};for(const v in n)p[v]=v in l?l[v]:n[v];return p}function tO(n,l){let p=0,v=l.length;for(;p!==v;){const R=p+v>>1;mI(n,l[R])<0?v=R:p=R+1}const A=rO(n);return A&&(v=l.lastIndexOf(A,v-1)),v}function rO(n){let l=n;for(;l=l.parent;)if(_I(l)&&mI(n,l)===0)return l}function _I({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function nO(n){const l={};if(n===""||n==="?")return l;const v=(n[0]==="?"?n.slice(1):n).split("&");for(let A=0;A<v.length;++A){const R=v[A].replace(aI," "),D=R.indexOf("="),i=mm(D<0?R:R.slice(0,D)),G=D<0?null:mm(R.slice(D+1));if(i in l){let W=l[i];ha(W)||(W=l[i]=[W]),W.push(G)}else l[i]=G}return l}function jS(n){let l="";for(let p in n){const v=n[p];if(p=TL(p),v==null){v!==void 0&&(l+=(l.length?"&":"")+p);continue}(ha(v)?v.map(R=>R&&Vx(R)):[v&&Vx(v)]).forEach(R=>{R!==void 0&&(l+=(l.length?"&":"")+p,R!=null&&(l+="="+R))})}return l}function iO(n){const l={};for(const p in n){const v=n[p];v!==void 0&&(l[p]=ha(v)?v.map(A=>A==null?null:""+A):v==null?v:""+v)}return l}const sO=Symbol(""),$S=Symbol(""),L1=Symbol(""),gI=Symbol(""),jx=Symbol("");function qp(){let n=[];function l(v){return n.push(v),()=>{const A=n.indexOf(v);A>-1&&n.splice(A,1)}}function p(){n=[]}return{add:l,list:()=>n.slice(),reset:p}}function fc(n,l,p,v,A,R=D=>D()){const D=v&&(v.enterCallbacks[A]=v.enterCallbacks[A]||[]);return()=>new Promise((i,G)=>{const W=ne=>{ne===!1?G(Rd(4,{from:p,to:l})):ne instanceof Error?G(ne):$L(ne)?G(Rd(2,{from:l,to:ne})):(D&&v.enterCallbacks[A]===D&&typeof ne=="function"&&D.push(ne),i())},H=R(()=>n.call(v&&v.instances[A],l,p,W));let ee=Promise.resolve(H);n.length<3&&(ee=ee.then(W)),ee.catch(ne=>G(ne))})}function px(n,l,p,v,A=R=>R()){const R=[];for(const D of n)for(const i in D.components){let G=D.components[i];if(!(l!=="beforeRouteEnter"&&!D.instances[i]))if(sI(G)){const H=(G.__vccOpts||G)[l];H&&R.push(fc(H,p,v,D,i,A))}else{let W=G();R.push(()=>W.then(H=>{if(!H)throw new Error(`Couldn't resolve component "${i}" at "${D.path}"`);const ee=dL(H)?H.default:H;D.mods[i]=H,D.components[i]=ee;const de=(ee.__vccOpts||ee)[l];return de&&fc(de,p,v,D,i,A)()}))}}return R}function GS(n){const l=Mn(L1),p=Mn(gI),v=it(()=>{const G=vt(n.to);return l.resolve(G)}),A=it(()=>{const{matched:G}=v.value,{length:W}=G,H=G[W-1],ee=p.matched;if(!H||!ee.length)return-1;const ne=ee.findIndex(Pd.bind(null,H));if(ne>-1)return ne;const de=HS(G[W-2]);return W>1&&HS(H)===de&&ee[ee.length-1].path!==de?ee.findIndex(Pd.bind(null,G[W-2])):ne}),R=it(()=>A.value>-1&&uO(p.params,v.value.params)),D=it(()=>A.value>-1&&A.value===p.matched.length-1&&hI(p.params,v.value.params));function i(G={}){if(cO(G)){const W=l[vt(n.replace)?"replace":"push"](vt(n.to)).catch(im);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>W),W}return Promise.resolve()}return{route:v,href:it(()=>v.value.href),isActive:R,isExactActive:D,navigate:i}}function oO(n){return n.length===1?n[0]:n}const aO=_n({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:GS,setup(n,{slots:l}){const p=Zi(GS(n)),{options:v}=Mn(L1),A=it(()=>({[qS(n.activeClass,v.linkActiveClass,"router-link-active")]:p.isActive,[qS(n.exactActiveClass,v.linkExactActiveClass,"router-link-exact-active")]:p.isExactActive}));return()=>{const R=l.default&&oO(l.default(p));return n.custom?R:vl("a",{"aria-current":p.isExactActive?n.ariaCurrentValue:null,href:p.href,onClick:p.navigate,class:A.value},R)}}}),lO=aO;function cO(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const l=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(l))return}return n.preventDefault&&n.preventDefault(),!0}}function uO(n,l){for(const p in l){const v=l[p],A=n[p];if(typeof v=="string"){if(v!==A)return!1}else if(!ha(A)||A.length!==v.length||v.some((R,D)=>R!==A[D]))return!1}return!0}function HS(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const qS=(n,l,p)=>n??l??p,hO=_n({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:l,slots:p}){const v=Mn(jx),A=it(()=>n.route||v.value),R=Mn($S,0),D=it(()=>{let W=vt(R);const{matched:H}=A.value;let ee;for(;(ee=H[W])&&!ee.components;)W++;return W}),i=it(()=>A.value.matched[D.value]);go($S,it(()=>D.value+1)),go(sO,i),go(jx,A);const G=hn();return Tn(()=>[G.value,i.value,n.name],([W,H,ee],[ne,de,he])=>{H&&(H.instances[ee]=W,de&&de!==H&&W&&W===ne&&(H.leaveGuards.size||(H.leaveGuards=de.leaveGuards),H.updateGuards.size||(H.updateGuards=de.updateGuards))),W&&H&&(!de||!Pd(H,de)||!ne)&&(H.enterCallbacks[ee]||[]).forEach(ye=>ye(W))},{flush:"post"}),()=>{const W=A.value,H=n.name,ee=i.value,ne=ee&&ee.components[H];if(!ne)return WS(p.default,{Component:ne,route:W});const de=ee.props[H],he=de?de===!0?W.params:typeof de=="function"?de(W):de:null,Le=vl(ne,Kn({},he,l,{onVnodeUnmounted:je=>{je.component.isUnmounted&&(ee.instances[H]=null)},ref:G}));return WS(p.default,{Component:Le,route:W})||Le}}});function WS(n,l){if(!n)return null;const p=n(l);return p.length===1?p[0]:p}const dO=hO;function fO(n){const l=JL(n.routes,n),p=n.parseQuery||nO,v=n.stringifyQuery||jS,A=n.history,R=qp(),D=qp(),i=qp(),G=Nn(oc);let W=oc;vd&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const H=dx.bind(null,Pt=>""+Pt),ee=dx.bind(null,EL),ne=dx.bind(null,mm);function de(Pt,er){let Kt,te;return fI(Pt)?(Kt=l.getRecordMatcher(Pt),te=er):te=Pt,l.addRoute(te,Kt)}function he(Pt){const er=l.getRecordMatcher(Pt);er&&l.removeRoute(er)}function ye(){return l.getRoutes().map(Pt=>Pt.record)}function Le(Pt){return!!l.getRecordMatcher(Pt)}function je(Pt,er){if(er=Kn({},er||G.value),typeof Pt=="string"){const Ae=fx(p,Pt,er.path),bt=l.resolve({path:Ae.path},er),Vt=A.createHref(Ae.fullPath);return Kn(Ae,bt,{params:ne(bt.params),hash:mm(Ae.hash),redirectedFrom:void 0,href:Vt})}let Kt;if(Pt.path!=null)Kt=Kn({},Pt,{path:fx(p,Pt.path,er.path).path});else{const Ae=Kn({},Pt.params);for(const bt in Ae)Ae[bt]==null&&delete Ae[bt];Kt=Kn({},Pt,{params:ee(Ae)}),er.params=ee(er.params)}const te=l.resolve(Kt,er),vn=Pt.hash||"";te.params=H(ne(te.params));const ke=IL(v,Kn({},Pt,{hash:wL(vn),path:te.path})),Ve=A.createHref(ke);return Kn({fullPath:ke,hash:vn,query:v===jS?iO(Pt.query):Pt.query||{}},te,{redirectedFrom:void 0,href:Ve})}function xt(Pt){return typeof Pt=="string"?fx(p,Pt,G.value.path):Kn({},Pt)}function Dt(Pt,er){if(W!==Pt)return Rd(8,{from:er,to:Pt})}function ut(Pt){return tt(Pt)}function ht(Pt){return ut(Kn(xt(Pt),{replace:!0}))}function Et(Pt){const er=Pt.matched[Pt.matched.length-1];if(er&&er.redirect){const{redirect:Kt}=er;let te=typeof Kt=="function"?Kt(Pt):Kt;return typeof te=="string"&&(te=te.includes("?")||te.includes("#")?te=xt(te):{path:te},te.params={}),Kn({query:Pt.query,hash:Pt.hash,params:te.path!=null?{}:Pt.params},te)}}function tt(Pt,er){const Kt=W=je(Pt),te=G.value,vn=Pt.state,ke=Pt.force,Ve=Pt.replace===!0,Ae=Et(Kt);if(Ae)return tt(Kn(xt(Ae),{state:typeof Ae=="object"?Kn({},vn,Ae.state):vn,force:ke,replace:Ve}),er||Kt);const bt=Kt;bt.redirectedFrom=er;let Vt;return!ke&&CL(v,te,Kt)&&(Vt=Rd(16,{to:bt,from:te}),ur(te,te,!0,!1)),(Vt?Promise.resolve(Vt):at(bt,te)).catch(zt=>hl(zt)?hl(zt,2)?zt:Hr(zt):Vr(zt,bt,te)).then(zt=>{if(zt){if(hl(zt,2))return tt(Kn({replace:Ve},xt(zt.to),{state:typeof zt.to=="object"?Kn({},vn,zt.to.state):vn,force:ke}),er||bt)}else zt=yt(bt,te,!0,Ve,vn);return gt(bt,te,zt),zt})}function At(Pt,er){const Kt=Dt(Pt,er);return Kt?Promise.reject(Kt):Promise.resolve()}function pt(Pt){const er=vi.values().next().value;return er&&typeof er.runWithContext=="function"?er.runWithContext(Pt):Pt()}function at(Pt,er){let Kt;const[te,vn,ke]=pO(Pt,er);Kt=px(te.reverse(),"beforeRouteLeave",Pt,er);for(const Ae of te)Ae.leaveGuards.forEach(bt=>{Kt.push(fc(bt,Pt,er))});const Ve=At.bind(null,Pt,er);return Kt.push(Ve),yn(Kt).then(()=>{Kt=[];for(const Ae of R.list())Kt.push(fc(Ae,Pt,er));return Kt.push(Ve),yn(Kt)}).then(()=>{Kt=px(vn,"beforeRouteUpdate",Pt,er);for(const Ae of vn)Ae.updateGuards.forEach(bt=>{Kt.push(fc(bt,Pt,er))});return Kt.push(Ve),yn(Kt)}).then(()=>{Kt=[];for(const Ae of ke)if(Ae.beforeEnter)if(ha(Ae.beforeEnter))for(const bt of Ae.beforeEnter)Kt.push(fc(bt,Pt,er));else Kt.push(fc(Ae.beforeEnter,Pt,er));return Kt.push(Ve),yn(Kt)}).then(()=>(Pt.matched.forEach(Ae=>Ae.enterCallbacks={}),Kt=px(ke,"beforeRouteEnter",Pt,er,pt),Kt.push(Ve),yn(Kt))).then(()=>{Kt=[];for(const Ae of D.list())Kt.push(fc(Ae,Pt,er));return Kt.push(Ve),yn(Kt)}).catch(Ae=>hl(Ae,8)?Ae:Promise.reject(Ae))}function gt(Pt,er,Kt){i.list().forEach(te=>pt(()=>te(Pt,er,Kt)))}function yt(Pt,er,Kt,te,vn){const ke=Dt(Pt,er);if(ke)return ke;const Ve=er===oc,Ae=vd?history.state:{};Kt&&(te||Ve?A.replace(Pt.fullPath,Kn({scroll:Ve&&Ae&&Ae.scroll},vn)):A.push(Pt.fullPath,vn)),G.value=Pt,ur(Pt,er,Kt,Ve),Hr()}let sr;function zr(){sr||(sr=A.listen((Pt,er,Kt)=>{if(!hi.listening)return;const te=je(Pt),vn=Et(te);if(vn){tt(Kn(vn,{replace:!0,force:!0}),te).catch(im);return}W=te;const ke=G.value;vd&&FL(zS(ke.fullPath,Kt.delta),Py()),at(te,ke).catch(Ve=>hl(Ve,12)?Ve:hl(Ve,2)?(tt(Kn(xt(Ve.to),{force:!0}),te).then(Ae=>{hl(Ae,20)&&!Kt.delta&&Kt.type===_m.pop&&A.go(-1,!1)}).catch(im),Promise.reject()):(Kt.delta&&A.go(-Kt.delta,!1),Vr(Ve,te,ke))).then(Ve=>{Ve=Ve||yt(te,ke,!1),Ve&&(Kt.delta&&!hl(Ve,8)?A.go(-Kt.delta,!1):Kt.type===_m.pop&&hl(Ve,20)&&A.go(-1,!1)),gt(te,ke,Ve)}).catch(im)}))}let Zt=qp(),Ir=qp(),vr;function Vr(Pt,er,Kt){Hr(Pt);const te=Ir.list();return te.length?te.forEach(vn=>vn(Pt,er,Kt)):console.error(Pt),Promise.reject(Pt)}function lr(){return vr&&G.value!==oc?Promise.resolve():new Promise((Pt,er)=>{Zt.add([Pt,er])})}function Hr(Pt){return vr||(vr=!Pt,zr(),Zt.list().forEach(([er,Kt])=>Pt?Kt(Pt):er()),Zt.reset()),Pt}function ur(Pt,er,Kt,te){const{scrollBehavior:vn}=n;if(!vd||!vn)return Promise.resolve();const ke=!Kt&&BL(zS(Pt.fullPath,0))||(te||!Kt)&&history.state&&history.state.scroll||null;return Zs().then(()=>vn(Pt,er,ke)).then(Ve=>Ve&&kL(Ve)).catch(Ve=>Vr(Ve,Pt,er))}const rr=Pt=>A.go(Pt);let $t;const vi=new Set,hi={currentRoute:G,listening:!0,addRoute:de,removeRoute:he,clearRoutes:l.clearRoutes,hasRoute:Le,getRoutes:ye,resolve:je,options:n,push:ut,replace:ht,go:rr,back:()=>rr(-1),forward:()=>rr(1),beforeEach:R.add,beforeResolve:D.add,afterEach:i.add,onError:Ir.add,isReady:lr,install(Pt){const er=this;Pt.component("RouterLink",lO),Pt.component("RouterView",dO),Pt.config.globalProperties.$router=er,Object.defineProperty(Pt.config.globalProperties,"$route",{enumerable:!0,get:()=>vt(G)}),vd&&!$t&&G.value===oc&&($t=!0,ut(A.location).catch(vn=>{}));const Kt={};for(const vn in oc)Object.defineProperty(Kt,vn,{get:()=>G.value[vn],enumerable:!0});Pt.provide(L1,er),Pt.provide(gI,qA(Kt)),Pt.provide(jx,G);const te=Pt.unmount;vi.add(Pt),Pt.unmount=function(){vi.delete(Pt),vi.size<1&&(W=oc,sr&&sr(),sr=null,G.value=oc,$t=!1,vr=!1),te()}}};function yn(Pt){return Pt.reduce((er,Kt)=>er.then(()=>pt(Kt)),Promise.resolve())}return hi}function pO(n,l){const p=[],v=[],A=[],R=Math.max(l.matched.length,n.matched.length);for(let D=0;D<R;D++){const i=l.matched[D];i&&(n.matched.find(W=>Pd(W,i))?v.push(i):p.push(i));const G=n.matched[D];G&&(l.matched.find(W=>Pd(W,G))||A.push(G))}return[p,v,A]}const mO="modulepreload",_O=function(n){return"/"+n},ZS={},gO=function(l,p,v){let A=Promise.resolve();if(p&&p.length>0){document.getElementsByTagName("link");const D=document.querySelector("meta[property=csp-nonce]"),i=(D==null?void 0:D.nonce)||(D==null?void 0:D.getAttribute("nonce"));A=Promise.allSettled(p.map(G=>{if(G=_O(G),G in ZS)return;ZS[G]=!0;const W=G.endsWith(".css"),H=W?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${G}"]${H}`))return;const ee=document.createElement("link");if(ee.rel=W?"stylesheet":mO,W||(ee.as="script"),ee.crossOrigin="",ee.href=G,i&&ee.setAttribute("nonce",i),document.head.appendChild(ee),W)return new Promise((ne,de)=>{ee.addEventListener("load",ne),ee.addEventListener("error",()=>de(new Error(`Unable to preload CSS for ${G}`)))})}))}function R(D){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=D,window.dispatchEvent(i),!i.defaultPrevented)throw D}return A.then(D=>{for(const i of D||[])i.status==="rejected"&&R(i.reason);return l().catch(R)})},yO=[{path:"/",name:"/",component:()=>gO(()=>import("./index-1s7vx9Id.js"),__vite__mapDeps([0,1]))}],yI=Symbol(),jg="el",vO="is-",wu=(n,l,p,v,A)=>{let R=`${n}-${l}`;return p&&(R+=`-${p}`),v&&(R+=`__${v}`),A&&(R+=`--${A}`),R},vI=Symbol("namespaceContextKey"),xI=n=>{const l=n||(Bs()?Mn(vI,hn(jg)):hn(jg));return it(()=>vt(l)||jg)},bc=(n,l)=>{const p=xI(l);return{namespace:p,b:(ye="")=>wu(p.value,n,ye,"",""),e:ye=>ye?wu(p.value,n,"",ye,""):"",m:ye=>ye?wu(p.value,n,"","",ye):"",be:(ye,Le)=>ye&&Le?wu(p.value,n,ye,Le,""):"",em:(ye,Le)=>ye&&Le?wu(p.value,n,"",ye,Le):"",bm:(ye,Le)=>ye&&Le?wu(p.value,n,ye,"",Le):"",bem:(ye,Le,je)=>ye&&Le&&je?wu(p.value,n,ye,Le,je):"",is:(ye,...Le)=>{const je=Le.length>=1?Le[0]:!0;return ye&&je?`${vO}${ye}`:""},cssVar:ye=>{const Le={};for(const je in ye)ye[je]&&(Le[`--${p.value}-${je}`]=ye[je]);return Le},cssVarName:ye=>`--${p.value}-${ye}`,cssVarBlock:ye=>{const Le={};for(const je in ye)ye[je]&&(Le[`--${p.value}-${n}-${je}`]=ye[je]);return Le},cssVarBlockName:ye=>`--${p.value}-${n}-${ye}`}};var xO=typeof global=="object"&&global&&global.Object===Object&&global,bO=typeof self=="object"&&self&&self.Object===Object&&self,O1=xO||bO||Function("return this")(),wc=O1.Symbol,bI=Object.prototype,wO=bI.hasOwnProperty,TO=bI.toString,Wp=wc?wc.toStringTag:void 0;function SO(n){var l=wO.call(n,Wp),p=n[Wp];try{n[Wp]=void 0;var v=!0}catch{}var A=TO.call(n);return v&&(l?n[Wp]=p:delete n[Wp]),A}var EO=Object.prototype,AO=EO.toString;function MO(n){return AO.call(n)}var IO="[object Null]",CO="[object Undefined]",XS=wc?wc.toStringTag:void 0;function k1(n){return n==null?n===void 0?CO:IO:XS&&XS in Object(n)?SO(n):MO(n)}function F1(n){return n!=null&&typeof n=="object"}var PO="[object Symbol]";function B1(n){return typeof n=="symbol"||F1(n)&&k1(n)==PO}function RO(n,l){for(var p=-1,v=n==null?0:n.length,A=Array(v);++p<v;)A[p]=l(n[p],p,n);return A}var Pm=Array.isArray,KS=wc?wc.prototype:void 0,YS=KS?KS.toString:void 0;function wI(n){if(typeof n=="string")return n;if(Pm(n))return RO(n,wI)+"";if(B1(n))return YS?YS.call(n):"";var l=n+"";return l=="0"&&1/n==-1/0?"-0":l}function sy(n){var l=typeof n;return n!=null&&(l=="object"||l=="function")}function DO(n){return n}var zO="[object AsyncFunction]",LO="[object Function]",OO="[object GeneratorFunction]",kO="[object Proxy]";function FO(n){if(!sy(n))return!1;var l=k1(n);return l==LO||l==OO||l==zO||l==kO}var mx=O1["__core-js_shared__"],JS=function(){var n=/[^.]+$/.exec(mx&&mx.keys&&mx.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function BO(n){return!!JS&&JS in n}var NO=Function.prototype,VO=NO.toString;function UO(n){if(n!=null){try{return VO.call(n)}catch{}try{return n+""}catch{}}return""}var jO=/[\\^$.*+?()[\]{}|]/g,$O=/^\[object .+?Constructor\]$/,GO=Function.prototype,HO=Object.prototype,qO=GO.toString,WO=HO.hasOwnProperty,ZO=RegExp("^"+qO.call(WO).replace(jO,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function XO(n){if(!sy(n)||BO(n))return!1;var l=FO(n)?ZO:$O;return l.test(UO(n))}function KO(n,l){return n==null?void 0:n[l]}function N1(n,l){var p=KO(n,l);return XO(p)?p:void 0}function YO(n,l,p){switch(p.length){case 0:return n.call(l);case 1:return n.call(l,p[0]);case 2:return n.call(l,p[0],p[1]);case 3:return n.call(l,p[0],p[1],p[2])}return n.apply(l,p)}var JO=800,QO=16,ek=Date.now;function tk(n){var l=0,p=0;return function(){var v=ek(),A=QO-(v-p);if(p=v,A>0){if(++l>=JO)return arguments[0]}else l=0;return n.apply(void 0,arguments)}}function rk(n){return function(){return n}}var oy=function(){try{var n=N1(Object,"defineProperty");return n({},"",{}),n}catch{}}(),nk=oy?function(n,l){return oy(n,"toString",{configurable:!0,enumerable:!1,value:rk(l),writable:!0})}:DO,ik=tk(nk),sk=9007199254740991,ok=/^(?:0|[1-9]\d*)$/;function TI(n,l){var p=typeof n;return l=l??sk,!!l&&(p=="number"||p!="symbol"&&ok.test(n))&&n>-1&&n%1==0&&n<l}function ak(n,l,p){l=="__proto__"&&oy?oy(n,l,{configurable:!0,enumerable:!0,value:p,writable:!0}):n[l]=p}function SI(n,l){return n===l||n!==n&&l!==l}var lk=Object.prototype,ck=lk.hasOwnProperty;function uk(n,l,p){var v=n[l];(!(ck.call(n,l)&&SI(v,p))||p===void 0&&!(l in n))&&ak(n,l,p)}var QS=Math.max;function hk(n,l,p){return l=QS(l===void 0?n.length-1:l,0),function(){for(var v=arguments,A=-1,R=QS(v.length-l,0),D=Array(R);++A<R;)D[A]=v[l+A];A=-1;for(var i=Array(l+1);++A<l;)i[A]=v[A];return i[l]=p(D),YO(n,this,i)}}var dk=9007199254740991;function fk(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=dk}var pk="[object Arguments]";function eE(n){return F1(n)&&k1(n)==pk}var EI=Object.prototype,mk=EI.hasOwnProperty,_k=EI.propertyIsEnumerable,AI=eE(function(){return arguments}())?eE:function(n){return F1(n)&&mk.call(n,"callee")&&!_k.call(n,"callee")},gk=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,yk=/^\w*$/;function vk(n,l){if(Pm(n))return!1;var p=typeof n;return p=="number"||p=="symbol"||p=="boolean"||n==null||B1(n)?!0:yk.test(n)||!gk.test(n)||l!=null&&n in Object(l)}var gm=N1(Object,"create");function xk(){this.__data__=gm?gm(null):{},this.size=0}function bk(n){var l=this.has(n)&&delete this.__data__[n];return this.size-=l?1:0,l}var wk="__lodash_hash_undefined__",Tk=Object.prototype,Sk=Tk.hasOwnProperty;function Ek(n){var l=this.__data__;if(gm){var p=l[n];return p===wk?void 0:p}return Sk.call(l,n)?l[n]:void 0}var Ak=Object.prototype,Mk=Ak.hasOwnProperty;function Ik(n){var l=this.__data__;return gm?l[n]!==void 0:Mk.call(l,n)}var Ck="__lodash_hash_undefined__";function Pk(n,l){var p=this.__data__;return this.size+=this.has(n)?0:1,p[n]=gm&&l===void 0?Ck:l,this}function Bu(n){var l=-1,p=n==null?0:n.length;for(this.clear();++l<p;){var v=n[l];this.set(v[0],v[1])}}Bu.prototype.clear=xk;Bu.prototype.delete=bk;Bu.prototype.get=Ek;Bu.prototype.has=Ik;Bu.prototype.set=Pk;function Rk(){this.__data__=[],this.size=0}function Ry(n,l){for(var p=n.length;p--;)if(SI(n[p][0],l))return p;return-1}var Dk=Array.prototype,zk=Dk.splice;function Lk(n){var l=this.__data__,p=Ry(l,n);if(p<0)return!1;var v=l.length-1;return p==v?l.pop():zk.call(l,p,1),--this.size,!0}function Ok(n){var l=this.__data__,p=Ry(l,n);return p<0?void 0:l[p][1]}function kk(n){return Ry(this.__data__,n)>-1}function Fk(n,l){var p=this.__data__,v=Ry(p,n);return v<0?(++this.size,p.push([n,l])):p[v][1]=l,this}function Bd(n){var l=-1,p=n==null?0:n.length;for(this.clear();++l<p;){var v=n[l];this.set(v[0],v[1])}}Bd.prototype.clear=Rk;Bd.prototype.delete=Lk;Bd.prototype.get=Ok;Bd.prototype.has=kk;Bd.prototype.set=Fk;var Bk=N1(O1,"Map");function Nk(){this.size=0,this.__data__={hash:new Bu,map:new(Bk||Bd),string:new Bu}}function Vk(n){var l=typeof n;return l=="string"||l=="number"||l=="symbol"||l=="boolean"?n!=="__proto__":n===null}function Dy(n,l){var p=n.__data__;return Vk(l)?p[typeof l=="string"?"string":"hash"]:p.map}function Uk(n){var l=Dy(this,n).delete(n);return this.size-=l?1:0,l}function jk(n){return Dy(this,n).get(n)}function $k(n){return Dy(this,n).has(n)}function Gk(n,l){var p=Dy(this,n),v=p.size;return p.set(n,l),this.size+=p.size==v?0:1,this}function Vu(n){var l=-1,p=n==null?0:n.length;for(this.clear();++l<p;){var v=n[l];this.set(v[0],v[1])}}Vu.prototype.clear=Nk;Vu.prototype.delete=Uk;Vu.prototype.get=jk;Vu.prototype.has=$k;Vu.prototype.set=Gk;var Hk="Expected a function";function V1(n,l){if(typeof n!="function"||l!=null&&typeof l!="function")throw new TypeError(Hk);var p=function(){var v=arguments,A=l?l.apply(this,v):v[0],R=p.cache;if(R.has(A))return R.get(A);var D=n.apply(this,v);return p.cache=R.set(A,D)||R,D};return p.cache=new(V1.Cache||Vu),p}V1.Cache=Vu;var qk=500;function Wk(n){var l=V1(n,function(v){return p.size===qk&&p.clear(),v}),p=l.cache;return l}var Zk=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Xk=/\\(\\)?/g,Kk=Wk(function(n){var l=[];return n.charCodeAt(0)===46&&l.push(""),n.replace(Zk,function(p,v,A,R){l.push(A?R.replace(Xk,"$1"):v||p)}),l});function Yk(n){return n==null?"":wI(n)}function zy(n,l){return Pm(n)?n:vk(n,l)?[n]:Kk(Yk(n))}function U1(n){if(typeof n=="string"||B1(n))return n;var l=n+"";return l=="0"&&1/n==-1/0?"-0":l}function MI(n,l){l=zy(l,n);for(var p=0,v=l.length;n!=null&&p<v;)n=n[U1(l[p++])];return p&&p==v?n:void 0}function II(n,l,p){var v=n==null?void 0:MI(n,l);return v===void 0?p:v}function Jk(n,l){for(var p=-1,v=l.length,A=n.length;++p<v;)n[A+p]=l[p];return n}var tE=wc?wc.isConcatSpreadable:void 0;function Qk(n){return Pm(n)||AI(n)||!!(tE&&n&&n[tE])}function CI(n,l,p,v,A){var R=-1,D=n.length;for(p||(p=Qk),A||(A=[]);++R<D;){var i=n[R];l>0&&p(i)?l>1?CI(i,l-1,p,v,A):Jk(A,i):A[A.length]=i}return A}function eF(n){var l=n==null?0:n.length;return l?CI(n,1):[]}function tF(n){return ik(hk(n,void 0,eF),n+"")}function rF(n,l){return n!=null&&l in Object(n)}function nF(n,l,p){l=zy(l,n);for(var v=-1,A=l.length,R=!1;++v<A;){var D=U1(l[v]);if(!(R=n!=null&&p(n,D)))break;n=n[D]}return R||++v!=A?R:(A=n==null?0:n.length,!!A&&fk(A)&&TI(D,A)&&(Pm(n)||AI(n)))}function iF(n,l){return n!=null&&nF(n,l,rF)}function PI(n){for(var l=-1,p=n==null?0:n.length,v={};++l<p;){var A=n[l];v[A[0]]=A[1]}return v}function RI(n){return n==null}function DI(n,l,p,v){if(!sy(n))return n;l=zy(l,n);for(var A=-1,R=l.length,D=R-1,i=n;i!=null&&++A<R;){var G=U1(l[A]),W=p;if(G==="__proto__"||G==="constructor"||G==="prototype")return n;if(A!=D){var H=i[G];W=void 0,W===void 0&&(W=sy(H)?H:TI(l[A+1])?[]:{})}uk(i,G,W),i=i[G]}return n}function sF(n,l,p){for(var v=-1,A=l.length,R={};++v<A;){var D=l[v],i=MI(n,D);p(i,D)&&DI(R,zy(D,n),i)}return R}function oF(n,l){return sF(n,l,function(p,v){return iF(n,v)})}var aF=tF(function(n,l){return n==null?{}:oF(n,l)});function lF(n,l,p){return n==null?n:DI(n,l,p)}const cF=n=>n===void 0,$g=n=>typeof n=="boolean",Ru=n=>typeof n=="number",ij=n=>!n&&n!==0||Nr(n)&&n.length===0||Vn(n)&&!Object.keys(n).length,sj=n=>typeof Element>"u"?!1:n instanceof Element,oj=n=>RI(n),uF=n=>Hn(n)?!Number.isNaN(Number(n)):!1;var hF=Object.defineProperty,dF=Object.defineProperties,fF=Object.getOwnPropertyDescriptors,rE=Object.getOwnPropertySymbols,pF=Object.prototype.hasOwnProperty,mF=Object.prototype.propertyIsEnumerable,nE=(n,l,p)=>l in n?hF(n,l,{enumerable:!0,configurable:!0,writable:!0,value:p}):n[l]=p,_F=(n,l)=>{for(var p in l||(l={}))pF.call(l,p)&&nE(n,p,l[p]);if(rE)for(var p of rE(l))mF.call(l,p)&&nE(n,p,l[p]);return n},gF=(n,l)=>dF(n,fF(l));function yF(n,l){var p;const v=Nn();return kd(()=>{v.value=n()},gF(_F({},l),{flush:(p=void 0)!=null?p:"sync"})),Od(v)}var iE;const Uu=typeof window<"u",vF=n=>typeof n=="string",Dd=()=>{},xF=Uu&&((iE=window==null?void 0:window.navigator)==null?void 0:iE.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function Tc(n){return typeof n=="function"?n():vt(n)}function zI(n,l){function p(...v){return new Promise((A,R)=>{Promise.resolve(n(()=>l.apply(this,v),{fn:l,thisArg:this,args:v})).then(A).catch(R)})}return p}function bF(n,l={}){let p,v,A=Dd;const R=i=>{clearTimeout(i),A(),A=Dd};return i=>{const G=Tc(n),W=Tc(l.maxWait);return p&&R(p),G<=0||W!==void 0&&W<=0?(v&&(R(v),v=null),Promise.resolve(i())):new Promise((H,ee)=>{A=l.rejectOnCancel?ee:H,W&&!v&&(v=setTimeout(()=>{p&&R(p),v=null,H(i())},W)),p=setTimeout(()=>{v&&R(v),v=null,H(i())},G)})}}function wF(n,l=!0,p=!0,v=!1){let A=0,R,D=!0,i=Dd,G;const W=()=>{R&&(clearTimeout(R),R=void 0,i(),i=Dd)};return ee=>{const ne=Tc(n),de=Date.now()-A,he=()=>G=ee();return W(),ne<=0?(A=Date.now(),he()):(de>ne&&(p||!D)?(A=Date.now(),he()):l&&(G=new Promise((ye,Le)=>{i=v?Le:ye,R=setTimeout(()=>{A=Date.now(),D=!0,ye(he()),W()},Math.max(0,ne-de))})),!p&&!R&&(R=setTimeout(()=>D=!0,ne)),D=!1,G)}}function TF(n){return n}function Ly(n){return h1()?(by(n),!0):!1}function SF(n,l=200,p={}){return zI(bF(l,p),n)}function aj(n,l=200,p={}){const v=hn(n.value),A=SF(()=>{v.value=n.value},l,p);return Tn(n,()=>A()),v}function lj(n,l=200,p=!1,v=!0,A=!1){return zI(wF(l,p,v,A),n)}function EF(n,l=!0){Bs()?da(n):l?n():Zs(n)}function cj(n,l,p={}){const{immediate:v=!0}=p,A=hn(!1);let R=null;function D(){R&&(clearTimeout(R),R=null)}function i(){A.value=!1,D()}function G(...W){D(),A.value=!0,R=setTimeout(()=>{A.value=!1,R=null,n(...W)},Tc(l))}return v&&(A.value=!0,Uu&&G()),Ly(i),{isPending:Od(A),start:G,stop:i}}function mc(n){var l;const p=Tc(n);return(l=p==null?void 0:p.$el)!=null?l:p}const Rm=Uu?window:void 0;function Ed(...n){let l,p,v,A;if(vF(n[0])||Array.isArray(n[0])?([p,v,A]=n,l=Rm):[l,p,v,A]=n,!l)return Dd;Array.isArray(p)||(p=[p]),Array.isArray(v)||(v=[v]);const R=[],D=()=>{R.forEach(H=>H()),R.length=0},i=(H,ee,ne,de)=>(H.addEventListener(ee,ne,de),()=>H.removeEventListener(ee,ne,de)),G=Tn(()=>[mc(l),Tc(A)],([H,ee])=>{D(),H&&R.push(...p.flatMap(ne=>v.map(de=>i(H,ne,de,ee))))},{immediate:!0,flush:"post"}),W=()=>{G(),D()};return Ly(W),W}let sE=!1;function uj(n,l,p={}){const{window:v=Rm,ignore:A=[],capture:R=!0,detectIframe:D=!1}=p;if(!v)return;xF&&!sE&&(sE=!0,Array.from(v.document.body.children).forEach(ne=>ne.addEventListener("click",Dd)));let i=!0;const G=ne=>A.some(de=>{if(typeof de=="string")return Array.from(v.document.querySelectorAll(de)).some(he=>he===ne.target||ne.composedPath().includes(he));{const he=mc(de);return he&&(ne.target===he||ne.composedPath().includes(he))}}),H=[Ed(v,"click",ne=>{const de=mc(n);if(!(!de||de===ne.target||ne.composedPath().includes(de))){if(ne.detail===0&&(i=!G(ne)),!i){i=!0;return}l(ne)}},{passive:!0,capture:R}),Ed(v,"pointerdown",ne=>{const de=mc(n);de&&(i=!ne.composedPath().includes(de)&&!G(ne))},{passive:!0}),D&&Ed(v,"blur",ne=>{var de;const he=mc(n);((de=v.document.activeElement)==null?void 0:de.tagName)==="IFRAME"&&!(he!=null&&he.contains(v.document.activeElement))&&l(ne)})].filter(Boolean);return()=>H.forEach(ne=>ne())}function LI(n,l=!1){const p=hn(),v=()=>p.value=!!n();return v(),EF(v,l),p}const oE=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},aE="__vueuse_ssr_handlers__";oE[aE]=oE[aE]||{};function hj(n,l,{window:p=Rm,initialValue:v=""}={}){const A=hn(v),R=it(()=>{var D;return mc(l)||((D=p==null?void 0:p.document)==null?void 0:D.documentElement)});return Tn([R,()=>Tc(n)],([D,i])=>{var G;if(D&&p){const W=(G=p.getComputedStyle(D).getPropertyValue(i))==null?void 0:G.trim();A.value=W||v}},{immediate:!0}),Tn(A,D=>{var i;(i=R.value)!=null&&i.style&&R.value.style.setProperty(Tc(n),D)}),A}var lE=Object.getOwnPropertySymbols,AF=Object.prototype.hasOwnProperty,MF=Object.prototype.propertyIsEnumerable,IF=(n,l)=>{var p={};for(var v in n)AF.call(n,v)&&l.indexOf(v)<0&&(p[v]=n[v]);if(n!=null&&lE)for(var v of lE(n))l.indexOf(v)<0&&MF.call(n,v)&&(p[v]=n[v]);return p};function CF(n,l,p={}){const v=p,{window:A=Rm}=v,R=IF(v,["window"]);let D;const i=LI(()=>A&&"ResizeObserver"in A),G=()=>{D&&(D.disconnect(),D=void 0)},W=Tn(()=>mc(n),ee=>{G(),i.value&&A&&ee&&(D=new ResizeObserver(l),D.observe(ee,R))},{immediate:!0,flush:"post"}),H=()=>{G(),W()};return Ly(H),{isSupported:i,stop:H}}var cE=Object.getOwnPropertySymbols,PF=Object.prototype.hasOwnProperty,RF=Object.prototype.propertyIsEnumerable,DF=(n,l)=>{var p={};for(var v in n)PF.call(n,v)&&l.indexOf(v)<0&&(p[v]=n[v]);if(n!=null&&cE)for(var v of cE(n))l.indexOf(v)<0&&RF.call(n,v)&&(p[v]=n[v]);return p};function dj(n,l,p={}){const v=p,{window:A=Rm}=v,R=DF(v,["window"]);let D;const i=LI(()=>A&&"MutationObserver"in A),G=()=>{D&&(D.disconnect(),D=void 0)},W=Tn(()=>mc(n),ee=>{G(),i.value&&A&&ee&&(D=new MutationObserver(l),D.observe(ee,R))},{immediate:!0}),H=()=>{G(),W()};return Ly(H),{isSupported:i,stop:H}}var uE;(function(n){n.UP="UP",n.RIGHT="RIGHT",n.DOWN="DOWN",n.LEFT="LEFT",n.NONE="NONE"})(uE||(uE={}));var zF=Object.defineProperty,hE=Object.getOwnPropertySymbols,LF=Object.prototype.hasOwnProperty,OF=Object.prototype.propertyIsEnumerable,dE=(n,l,p)=>l in n?zF(n,l,{enumerable:!0,configurable:!0,writable:!0,value:p}):n[l]=p,kF=(n,l)=>{for(var p in l||(l={}))LF.call(l,p)&&dE(n,p,l[p]);if(hE)for(var p of hE(l))OF.call(l,p)&&dE(n,p,l[p]);return n};const FF={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};kF({linear:TF},FF);class BF extends Error{constructor(l){super(l),this.name="ElementPlusError"}}function NF(n,l){throw new BF(`[${n}] ${l}`)}function fj(n,l){}const fE={current:0},pE=hn(0),OI=2e3,mE=Symbol("elZIndexContextKey"),kI=Symbol("zIndexContextKey"),VF=n=>{const l=Bs()?Mn(mE,fE):fE,p=n||(Bs()?Mn(kI,void 0):void 0),v=it(()=>{const D=vt(p);return Ru(D)?D:OI}),A=it(()=>v.value+pE.value),R=()=>(l.current++,pE.value=l.current,A.value);return!Uu&&Mn(mE),{initialZIndex:v,currentZIndex:A,nextZIndex:R}};var UF={name:"en",el:{breadcrumb:{label:"Breadcrumb"},colorpicker:{confirm:"OK",clear:"Clear",defaultLabel:"color picker",description:"current color is {color}. press enter to select a new color.",alphaLabel:"pick alpha value"},datepicker:{now:"Now",today:"Today",cancel:"Cancel",clear:"Clear",confirm:"OK",dateTablePrompt:"Use the arrow keys and enter to select the day of the month",monthTablePrompt:"Use the arrow keys and enter to select the month",yearTablePrompt:"Use the arrow keys and enter to select the year",selectedDate:"Selected date",selectDate:"Select date",selectTime:"Select time",startDate:"Start Date",startTime:"Start Time",endDate:"End Date",endTime:"End Time",prevYear:"Previous Year",nextYear:"Next Year",prevMonth:"Previous Month",nextMonth:"Next Month",year:"",month1:"January",month2:"February",month3:"March",month4:"April",month5:"May",month6:"June",month7:"July",month8:"August",month9:"September",month10:"October",month11:"November",month12:"December",week:"week",weeks:{sun:"Sun",mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat"},weeksFull:{sun:"Sunday",mon:"Monday",tue:"Tuesday",wed:"Wednesday",thu:"Thursday",fri:"Friday",sat:"Saturday"},months:{jan:"Jan",feb:"Feb",mar:"Mar",apr:"Apr",may:"May",jun:"Jun",jul:"Jul",aug:"Aug",sep:"Sep",oct:"Oct",nov:"Nov",dec:"Dec"}},inputNumber:{decrease:"decrease number",increase:"increase number"},select:{loading:"Loading",noMatch:"No matching data",noData:"No data",placeholder:"Select"},mention:{loading:"Loading"},dropdown:{toggleDropdown:"Toggle Dropdown"},cascader:{noMatch:"No matching data",loading:"Loading",placeholder:"Select",noData:"No data"},pagination:{goto:"Go to",pagesize:"/page",total:"Total {total}",pageClassifier:"",page:"Page",prev:"Go to previous page",next:"Go to next page",currentPage:"page {pager}",prevPages:"Previous {pager} pages",nextPages:"Next {pager} pages",deprecationWarning:"Deprecated usages detected, please refer to the el-pagination documentation for more details"},dialog:{close:"Close this dialog"},drawer:{close:"Close this dialog"},messagebox:{title:"Message",confirm:"OK",cancel:"Cancel",error:"Illegal input",close:"Close this dialog"},upload:{deleteTip:"press delete to remove",delete:"Delete",preview:"Preview",continue:"Continue"},slider:{defaultLabel:"slider between {min} and {max}",defaultRangeStartLabel:"pick start value",defaultRangeEndLabel:"pick end value"},table:{emptyText:"No Data",confirmFilter:"Confirm",resetFilter:"Reset",clearFilter:"All",sumText:"Sum"},tour:{next:"Next",previous:"Previous",finish:"Finish"},tree:{emptyText:"No Data"},transfer:{noMatch:"No matching data",noData:"No data",titles:["List 1","List 2"],filterPlaceholder:"Enter keyword",noCheckedFormat:"{total} items",hasCheckedFormat:"{checked}/{total} checked"},image:{error:"FAILED"},pageHeader:{title:"Back"},popconfirm:{confirmButtonText:"Yes",cancelButtonText:"No"},carousel:{leftArrow:"Carousel arrow left",rightArrow:"Carousel arrow right",indicator:"Carousel switch to index {index}"}}};const jF=n=>(l,p)=>$F(l,p,vt(n)),$F=(n,l,p)=>II(p,n,n).replace(/\{(\w+)\}/g,(v,A)=>{var R;return`${(R=l==null?void 0:l[A])!=null?R:`{${A}}`}`}),GF=n=>{const l=it(()=>vt(n).name),p=Yn(n)?n:hn(n);return{lang:l,locale:p,t:jF(n)}},FI=Symbol("localeContextKey"),HF=n=>{const l=n||Mn(FI,hn());return GF(it(()=>l.value||UF))},BI="__epPropKey",Du=n=>n,qF=n=>Vn(n)&&!!n[BI],NI=(n,l)=>{if(!Vn(n)||qF(n))return n;const{values:p,required:v,default:A,type:R,validator:D}=n,G={type:R,required:!!v,validator:p||D?W=>{let H=!1,ee=[];if(p&&(ee=Array.from(p),Gn(n,"default")&&ee.push(A),H||(H=ee.includes(W))),D&&(H||(H=D(W))),!H&&ee.length>0){const ne=[...new Set(ee)].map(de=>JSON.stringify(de)).join(", ");b4(`Invalid prop: validation failed${l?` for prop "${l}"`:""}. Expected one of [${ne}], got value ${JSON.stringify(W)}.`)}return H}:void 0,[BI]:!0};return Gn(n,"default")&&(G.default=A),G},Nd=n=>PI(Object.entries(n).map(([l,p])=>[l,NI(p,l)])),VI=["","default","small","large"],UI=NI({type:String,values:VI,required:!1}),jI=Symbol("size"),WF=()=>{const n=Mn(jI,{});return it(()=>vt(n.size)||"")},$I=Symbol("emptyValuesContextKey"),ZF=["",void 0,null],XF=void 0,pj=Nd({emptyValues:Array,valueOnClear:{type:[String,Number,Boolean,Function],default:void 0,validator:n=>Zr(n)?!n():!n}}),mj=(n,l)=>{const p=Bs()?Mn($I,hn({})):hn({}),v=it(()=>n.emptyValues||p.value.emptyValues||ZF),A=it(()=>Zr(n.valueOnClear)?n.valueOnClear():n.valueOnClear!==void 0?n.valueOnClear:Zr(p.value.valueOnClear)?p.value.valueOnClear():p.value.valueOnClear!==void 0?p.value.valueOnClear:XF),R=D=>v.value.includes(D);return v.value.includes(A.value),{emptyValues:v,valueOnClear:A,isEmptyValue:R}},_E=n=>Object.keys(n),_j=(n,l,p)=>({get value(){return II(n,l,p)},set value(v){lF(n,l,v)}}),ay=hn();function j1(n,l=void 0){const p=Bs()?Mn(yI,ay):ay;return n?it(()=>{var v,A;return(A=(v=p.value)==null?void 0:v[n])!=null?A:l}):p}function gj(n,l){const p=j1(),v=bc(n,it(()=>{var i;return((i=p.value)==null?void 0:i.namespace)||jg})),A=HF(it(()=>{var i;return(i=p.value)==null?void 0:i.locale})),R=VF(it(()=>{var i;return((i=p.value)==null?void 0:i.zIndex)||OI})),D=it(()=>{var i;return vt(l)||((i=p.value)==null?void 0:i.size)||""});return KF(it(()=>vt(p)||{})),{ns:v,locale:A,zIndex:R,size:D}}const KF=(n,l,p=!1)=>{var v;const A=!!Bs(),R=A?j1():void 0,D=(v=void 0)!=null?v:A?go:void 0;if(!D)return;const i=it(()=>{const G=vt(n);return R!=null&&R.value?YF(R.value,G):G});return D(yI,i),D(FI,it(()=>i.value.locale)),D(vI,it(()=>i.value.namespace)),D(kI,it(()=>i.value.zIndex)),D(jI,{size:it(()=>i.value.size||"")}),D($I,it(()=>({emptyValues:i.value.emptyValues,valueOnClear:i.value.valueOnClear}))),(p||!ay.value)&&(ay.value=i.value),i},YF=(n,l)=>{const p=[...new Set([..._E(n),..._E(l)])],v={};for(const A of p)v[A]=l[A]!==void 0?l[A]:n[A];return v},zd="update:modelValue",ym="change",vm="input";var Dm=(n,l)=>{const p=n.__vccOpts||n;for(const[v,A]of l)p[v]=A;return p};const GI=(n="")=>n.split(" ").filter(l=>!!l.trim()),yj=(n,l)=>{if(!n||!l)return!1;if(l.includes(" "))throw new Error("className should not contain space.");return n.classList.contains(l)},vj=(n,l)=>{!n||!l.trim()||n.classList.add(...GI(l))},xj=(n,l)=>{!n||!l.trim()||n.classList.remove(...GI(l))},bj=(n,l)=>{var p;if(!Uu||!n||!l)return"";let v=Fs(l);v==="float"&&(v="cssFloat");try{const A=n.style[v];if(A)return A;const R=(p=document.defaultView)==null?void 0:p.getComputedStyle(n,"");return R?R[v]:""}catch{return n.style[v]}};function HI(n,l="px"){if(!n)return"";if(Ru(n)||uF(n))return`${n}${l}`;if(Hn(n))return n}const Oy=(n,l)=>{if(n.install=p=>{for(const v of[n,...Object.values(l??{})])p.component(v.name,v)},l)for(const[p,v]of Object.entries(l))n[p]=v;return n},wj=(n,l)=>(n.install=p=>{n._context=p._context,p.config.globalProperties[l]=n},n),Tj=(n,l)=>(n.install=p=>{p.directive(l,n)},n),JF=n=>(n.install=_o,n),QF=Nd({size:{type:Du([Number,String])},color:{type:String}}),e5=_n({name:"ElIcon",inheritAttrs:!1}),t5=_n({...e5,props:QF,setup(n){const l=n,p=bc("icon"),v=it(()=>{const{size:A,color:R}=l;return!A&&!R?{}:{fontSize:cF(A)?void 0:HI(A),"--color":R}});return(A,R)=>(ir(),qr("i",Ys({class:vt(p).b(),style:vt(v)},A.$attrs),[oa(A.$slots,"default")],16))}});var r5=Dm(t5,[["__file","icon.vue"]]);const Ws=Oy(r5);/*! Element Plus Icons Vue v2.3.1 */var n5=_n({name:"ArrowDown",__name:"arrow-down",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M831.872 340.864 512 652.672 192.128 340.864a30.592 30.592 0 0 0-42.752 0 29.12 29.12 0 0 0 0 41.6L489.664 714.24a32 32 0 0 0 44.672 0l340.288-331.712a29.12 29.12 0 0 0 0-41.728 30.592 30.592 0 0 0-42.752 0z"})]))}}),Sj=n5,i5=_n({name:"ArrowLeft",__name:"arrow-left",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M609.408 149.376 277.76 489.6a32 32 0 0 0 0 44.672l331.648 340.352a29.12 29.12 0 0 0 41.728 0 30.592 30.592 0 0 0 0-42.752L339.264 511.936l311.872-319.872a30.592 30.592 0 0 0 0-42.688 29.12 29.12 0 0 0-41.728 0z"})]))}}),Ej=i5,s5=_n({name:"ArrowRight",__name:"arrow-right",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M340.864 149.312a30.592 30.592 0 0 0 0 42.752L652.736 512 340.864 831.872a30.592 30.592 0 0 0 0 42.752 29.12 29.12 0 0 0 41.728 0L714.24 534.336a32 32 0 0 0 0-44.672L382.592 149.376a29.12 29.12 0 0 0-41.728 0z"})]))}}),Aj=s5,o5=_n({name:"Check",__name:"check",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M406.656 706.944 195.84 496.256a32 32 0 1 0-45.248 45.248l256 256 512-512a32 32 0 0 0-45.248-45.248L406.592 706.944z"})]))}}),Mj=o5,a5=_n({name:"CircleCheck",__name:"circle-check",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896"}),Wr("path",{fill:"currentColor",d:"M745.344 361.344a32 32 0 0 1 45.312 45.312l-288 288a32 32 0 0 1-45.312 0l-160-160a32 32 0 1 1 45.312-45.312L480 626.752l265.344-265.408z"})]))}}),l5=a5,c5=_n({name:"CircleCloseFilled",__name:"circle-close-filled",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336z"})]))}}),qI=c5,u5=_n({name:"CircleClose",__name:"circle-close",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"m466.752 512-90.496-90.496a32 32 0 0 1 45.248-45.248L512 466.752l90.496-90.496a32 32 0 1 1 45.248 45.248L557.248 512l90.496 90.496a32 32 0 1 1-45.248 45.248L512 557.248l-90.496 90.496a32 32 0 0 1-45.248-45.248z"}),Wr("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896"})]))}}),WI=u5,h5=_n({name:"Close",__name:"close",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"})]))}}),ZI=h5,d5=_n({name:"CopyDocument",__name:"copy-document",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M768 832a128 128 0 0 1-128 128H192A128 128 0 0 1 64 832V384a128 128 0 0 1 128-128v64a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64z"}),Wr("path",{fill:"currentColor",d:"M384 128a64 64 0 0 0-64 64v448a64 64 0 0 0 64 64h448a64 64 0 0 0 64-64V192a64 64 0 0 0-64-64zm0-64h448a128 128 0 0 1 128 128v448a128 128 0 0 1-128 128H384a128 128 0 0 1-128-128V192A128 128 0 0 1 384 64"})]))}}),Ij=d5,f5=_n({name:"Delete",__name:"delete",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M160 256H96a32 32 0 0 1 0-64h256V95.936a32 32 0 0 1 32-32h256a32 32 0 0 1 32 32V192h256a32 32 0 1 1 0 64h-64v672a32 32 0 0 1-32 32H192a32 32 0 0 1-32-32zm448-64v-64H416v64zM224 896h576V256H224zm192-128a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32m192 0a32 32 0 0 1-32-32V416a32 32 0 0 1 64 0v320a32 32 0 0 1-32 32"})]))}}),Cj=f5,p5=_n({name:"Edit",__name:"edit",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M832 512a32 32 0 1 1 64 0v352a32 32 0 0 1-32 32H160a32 32 0 0 1-32-32V160a32 32 0 0 1 32-32h352a32 32 0 0 1 0 64H192v640h640z"}),Wr("path",{fill:"currentColor",d:"m469.952 554.24 52.8-7.552L847.104 222.4a32 32 0 1 0-45.248-45.248L477.44 501.44l-7.552 52.8zm422.4-422.4a96 96 0 0 1 0 135.808l-331.84 331.84a32 32 0 0 1-18.112 9.088L436.8 623.68a32 32 0 0 1-36.224-36.224l15.104-105.6a32 32 0 0 1 9.024-18.112l331.904-331.84a96 96 0 0 1 135.744 0z"})]))}}),Pj=p5,m5=_n({name:"FullScreen",__name:"full-screen",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"m160 96.064 192 .192a32 32 0 0 1 0 64l-192-.192V352a32 32 0 0 1-64 0V96h64zm0 831.872V928H96V672a32 32 0 1 1 64 0v191.936l192-.192a32 32 0 1 1 0 64zM864 96.064V96h64v256a32 32 0 1 1-64 0V160.064l-192 .192a32 32 0 1 1 0-64l192-.192zm0 831.872-192-.192a32 32 0 0 1 0-64l192 .192V672a32 32 0 1 1 64 0v256h-64z"})]))}}),Rj=m5,_5=_n({name:"Hide",__name:"hide",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M876.8 156.8c0-9.6-3.2-16-9.6-22.4-6.4-6.4-12.8-9.6-22.4-9.6-9.6 0-16 3.2-22.4 9.6L736 220.8c-64-32-137.6-51.2-224-60.8-160 16-288 73.6-377.6 176C44.8 438.4 0 496 0 512s48 73.6 134.4 176c22.4 25.6 44.8 48 73.6 67.2l-86.4 89.6c-6.4 6.4-9.6 12.8-9.6 22.4 0 9.6 3.2 16 9.6 22.4 6.4 6.4 12.8 9.6 22.4 9.6 9.6 0 16-3.2 22.4-9.6l704-710.4c3.2-6.4 6.4-12.8 6.4-22.4Zm-646.4 528c-76.8-70.4-128-128-153.6-172.8 28.8-48 80-105.6 153.6-172.8C304 272 400 230.4 512 224c64 3.2 124.8 19.2 176 44.8l-54.4 54.4C598.4 300.8 560 288 512 288c-64 0-115.2 22.4-160 64s-64 96-64 160c0 48 12.8 89.6 35.2 124.8L256 707.2c-9.6-6.4-19.2-16-25.6-22.4Zm140.8-96c-12.8-22.4-19.2-48-19.2-76.8 0-44.8 16-83.2 48-112 32-28.8 67.2-48 112-48 28.8 0 54.4 6.4 73.6 19.2zM889.599 336c-12.8-16-28.8-28.8-41.6-41.6l-48 48c73.6 67.2 124.8 124.8 150.4 169.6-28.8 48-80 105.6-153.6 172.8-73.6 67.2-172.8 108.8-284.8 115.2-51.2-3.2-99.2-12.8-140.8-28.8l-48 48c57.6 22.4 118.4 38.4 188.8 44.8 160-16 288-73.6 377.6-176C979.199 585.6 1024 528 1024 512s-48.001-73.6-134.401-176Z"}),Wr("path",{fill:"currentColor",d:"M511.998 672c-12.8 0-25.6-3.2-38.4-6.4l-51.2 51.2c28.8 12.8 57.6 19.2 89.6 19.2 64 0 115.2-22.4 160-64 41.6-41.6 64-96 64-160 0-32-6.4-64-19.2-89.6l-51.2 51.2c3.2 12.8 6.4 25.6 6.4 38.4 0 44.8-16 83.2-48 112-32 28.8-67.2 48-112 48Z"})]))}}),g5=_5,y5=_n({name:"InfoFilled",__name:"info-filled",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896.064A448 448 0 0 1 512 64m67.2 275.072c33.28 0 60.288-23.104 60.288-57.344s-27.072-57.344-60.288-57.344c-33.28 0-60.16 23.104-60.16 57.344s26.88 57.344 60.16 57.344M590.912 699.2c0-6.848 2.368-24.64 1.024-34.752l-52.608 60.544c-10.88 11.456-24.512 19.392-30.912 17.28a12.992 12.992 0 0 1-8.256-14.72l87.68-276.992c7.168-35.136-12.544-67.2-54.336-71.296-44.096 0-108.992 44.736-148.48 101.504 0 6.784-1.28 23.68.064 33.792l52.544-60.608c10.88-11.328 23.552-19.328 29.952-17.152a12.8 12.8 0 0 1 7.808 16.128L388.48 728.576c-10.048 32.256 8.96 63.872 55.04 71.04 67.84 0 107.904-43.648 147.456-100.416z"})]))}}),XI=y5,v5=_n({name:"Link",__name:"link",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M715.648 625.152 670.4 579.904l90.496-90.56c75.008-74.944 85.12-186.368 22.656-248.896-62.528-62.464-173.952-52.352-248.96 22.656L444.16 353.6l-45.248-45.248 90.496-90.496c100.032-99.968 251.968-110.08 339.456-22.656 87.488 87.488 77.312 239.424-22.656 339.456l-90.496 90.496zm-90.496 90.496-90.496 90.496C434.624 906.112 282.688 916.224 195.2 828.8c-87.488-87.488-77.312-239.424 22.656-339.456l90.496-90.496 45.248 45.248-90.496 90.56c-75.008 74.944-85.12 186.368-22.656 248.896 62.528 62.464 173.952 52.352 248.96-22.656l90.496-90.496zm0-362.048 45.248 45.248L398.848 670.4 353.6 625.152z"})]))}}),Dj=v5,x5=_n({name:"Loading",__name:"loading",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32m0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32m448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32m-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32M195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0m-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"})]))}}),$1=x5,b5=_n({name:"Plus",__name:"plus",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M480 480V128a32 32 0 0 1 64 0v352h352a32 32 0 1 1 0 64H544v352a32 32 0 1 1-64 0V544H128a32 32 0 0 1 0-64z"})]))}}),zj=b5,w5=_n({name:"QuestionFilled",__name:"question-filled",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m23.744 191.488c-52.096 0-92.928 14.784-123.2 44.352-30.976 29.568-45.76 70.4-45.76 122.496h80.256c0-29.568 5.632-52.8 17.6-68.992 13.376-19.712 35.2-28.864 66.176-28.864 23.936 0 42.944 6.336 56.32 19.712 12.672 13.376 19.712 31.68 19.712 54.912 0 17.6-6.336 34.496-19.008 49.984l-8.448 9.856c-45.76 40.832-73.216 70.4-82.368 89.408-9.856 19.008-14.08 42.24-14.08 68.992v9.856h80.96v-9.856c0-16.896 3.52-31.68 10.56-45.76 6.336-12.672 15.488-24.64 28.16-35.2 33.792-29.568 54.208-48.576 60.544-55.616 16.896-22.528 26.048-51.392 26.048-86.592 0-42.944-14.08-76.736-42.24-101.376-28.16-25.344-65.472-37.312-111.232-37.312zm-12.672 406.208a54.272 54.272 0 0 0-38.72 14.784 49.408 49.408 0 0 0-15.488 38.016c0 15.488 4.928 28.16 15.488 38.016A54.848 54.848 0 0 0 523.072 768c15.488 0 28.16-4.928 38.72-14.784a51.52 51.52 0 0 0 16.192-38.72 51.968 51.968 0 0 0-15.488-38.016 55.936 55.936 0 0 0-39.424-14.784z"})]))}}),Lj=w5,T5=_n({name:"RefreshLeft",__name:"refresh-left",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M289.088 296.704h92.992a32 32 0 0 1 0 64H232.96a32 32 0 0 1-32-32V179.712a32 32 0 0 1 64 0v50.56a384 384 0 0 1 643.84 282.88 384 384 0 0 1-383.936 384 384 384 0 0 1-384-384h64a320 320 0 1 0 640 0 320 320 0 0 0-555.712-216.448z"})]))}}),Oj=T5,S5=_n({name:"RefreshRight",__name:"refresh-right",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})]))}}),kj=S5,E5=_n({name:"ScaleToOriginal",__name:"scale-to-original",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M813.176 180.706a60.235 60.235 0 0 1 60.236 60.235v481.883a60.235 60.235 0 0 1-60.236 60.235H210.824a60.235 60.235 0 0 1-60.236-60.235V240.94a60.235 60.235 0 0 1 60.236-60.235h602.352zm0-60.235H210.824A120.47 120.47 0 0 0 90.353 240.94v481.883a120.47 120.47 0 0 0 120.47 120.47h602.353a120.47 120.47 0 0 0 120.471-120.47V240.94a120.47 120.47 0 0 0-120.47-120.47zm-120.47 180.705a30.118 30.118 0 0 0-30.118 30.118v301.177a30.118 30.118 0 0 0 60.236 0V331.294a30.118 30.118 0 0 0-30.118-30.118zm-361.412 0a30.118 30.118 0 0 0-30.118 30.118v301.177a30.118 30.118 0 1 0 60.236 0V331.294a30.118 30.118 0 0 0-30.118-30.118M512 361.412a30.118 30.118 0 0 0-30.118 30.117v30.118a30.118 30.118 0 0 0 60.236 0V391.53A30.118 30.118 0 0 0 512 361.412M512 512a30.118 30.118 0 0 0-30.118 30.118v30.117a30.118 30.118 0 0 0 60.236 0v-30.117A30.118 30.118 0 0 0 512 512"})]))}}),Fj=E5,A5=_n({name:"Search",__name:"search",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704"})]))}}),M5=A5,I5=_n({name:"SuccessFilled",__name:"success-filled",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m-55.808 536.384-99.52-99.584a38.4 38.4 0 1 0-54.336 54.336l126.72 126.72a38.272 38.272 0 0 0 54.336 0l262.4-262.464a38.4 38.4 0 1 0-54.272-54.336z"})]))}}),KI=I5,C5=_n({name:"View",__name:"view",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 160c320 0 512 352 512 352S832 864 512 864 0 512 0 512s192-352 512-352m0 64c-225.28 0-384.128 208.064-436.8 288 52.608 79.872 211.456 288 436.8 288 225.28 0 384.128-208.064 436.8-288-52.608-79.872-211.456-288-436.8-288zm0 64a224 224 0 1 1 0 448 224 224 0 0 1 0-448m0 64a160.192 160.192 0 0 0-160 160c0 88.192 71.744 160 160 160s160-71.808 160-160-71.744-160-160-160"})]))}}),P5=C5,R5=_n({name:"WarningFilled",__name:"warning-filled",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896m0 192a58.432 58.432 0 0 0-58.24 63.744l23.36 256.384a35.072 35.072 0 0 0 69.76 0l23.296-256.384A58.432 58.432 0 0 0 512 256m0 512a51.2 51.2 0 1 0 0-102.4 51.2 51.2 0 0 0 0 102.4"})]))}}),YI=R5,D5=_n({name:"ZoomIn",__name:"zoom-in",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704m-32-384v-96a32 32 0 0 1 64 0v96h96a32 32 0 0 1 0 64h-96v96a32 32 0 0 1-64 0v-96h-96a32 32 0 0 1 0-64z"})]))}}),Bj=D5,z5=_n({name:"ZoomOut",__name:"zoom-out",setup(n){return(l,p)=>(ir(),qr("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[Wr("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704M352 448h256a32 32 0 0 1 0 64H352a32 32 0 0 1 0-64"})]))}}),Nj=z5;const _c=Du([String,Object,Function]),Vj={Close:ZI},Uj={Close:ZI,SuccessFilled:KI,InfoFilled:XI,WarningFilled:YI,CircleCloseFilled:qI},jj={success:KI,warning:YI,error:qI,info:XI},L5={validating:$1,success:l5,error:WI},O5=()=>Uu&&/firefox/i.test(window.navigator.userAgent);let qs;const k5={height:"0",visibility:"hidden",overflow:O5()?"":"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},F5=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"];function B5(n){const l=window.getComputedStyle(n),p=l.getPropertyValue("box-sizing"),v=Number.parseFloat(l.getPropertyValue("padding-bottom"))+Number.parseFloat(l.getPropertyValue("padding-top")),A=Number.parseFloat(l.getPropertyValue("border-bottom-width"))+Number.parseFloat(l.getPropertyValue("border-top-width"));return{contextStyle:F5.map(D=>[D,l.getPropertyValue(D)]),paddingSize:v,borderSize:A,boxSizing:p}}function gE(n,l=1,p){var v;qs||(qs=document.createElement("textarea"),document.body.appendChild(qs));const{paddingSize:A,borderSize:R,boxSizing:D,contextStyle:i}=B5(n);i.forEach(([ee,ne])=>qs==null?void 0:qs.style.setProperty(ee,ne)),Object.entries(k5).forEach(([ee,ne])=>qs==null?void 0:qs.style.setProperty(ee,ne,"important")),qs.value=n.value||n.placeholder||"";let G=qs.scrollHeight;const W={};D==="border-box"?G=G+R:D==="content-box"&&(G=G-A),qs.value="";const H=qs.scrollHeight-A;if(Ru(l)){let ee=H*l;D==="border-box"&&(ee=ee+A+R),G=Math.max(ee,G),W.minHeight=`${ee}px`}if(Ru(p)){let ee=H*p;D==="border-box"&&(ee=ee+A+R),G=Math.min(ee,G)}return W.height=`${G}px`,(v=qs.parentNode)==null||v.removeChild(qs),qs=void 0,W}const N5=n=>n,V5=Nd({ariaLabel:String,ariaOrientation:{type:String,values:["horizontal","vertical","undefined"]},ariaControls:String}),JI=n=>aF(V5,n),U5=Nd({id:{type:String,default:void 0},size:UI,disabled:Boolean,modelValue:{type:Du([String,Number,Object]),default:""},maxlength:{type:[String,Number]},minlength:{type:[String,Number]},type:{type:String,default:"text"},resize:{type:String,values:["none","both","horizontal","vertical"]},autosize:{type:Du([Boolean,Object]),default:!1},autocomplete:{type:String,default:"off"},formatter:{type:Function},parser:{type:Function},placeholder:{type:String},form:{type:String},readonly:Boolean,clearable:Boolean,showPassword:Boolean,showWordLimit:Boolean,suffixIcon:{type:_c},prefixIcon:{type:_c},containerRole:{type:String,default:void 0},tabindex:{type:[String,Number],default:0},validateEvent:{type:Boolean,default:!0},inputStyle:{type:Du([Object,Array,String]),default:()=>N5({})},autofocus:Boolean,rows:{type:Number,default:2},...JI(["ariaLabel"])}),j5={[zd]:n=>Hn(n),input:n=>Hn(n),change:n=>Hn(n),focus:n=>n instanceof FocusEvent,blur:n=>n instanceof FocusEvent,clear:()=>!0,mouseleave:n=>n instanceof MouseEvent,mouseenter:n=>n instanceof MouseEvent,keydown:n=>n instanceof Event,compositionstart:n=>n instanceof CompositionEvent,compositionupdate:n=>n instanceof CompositionEvent,compositionend:n=>n instanceof CompositionEvent},$5=["class","style"],G5=/^on[A-Z]/,H5=(n={})=>{const{excludeListeners:l=!1,excludeKeys:p}=n,v=it(()=>((p==null?void 0:p.value)||[]).concat($5)),A=Bs();return it(A?()=>{var R;return PI(Object.entries((R=A.proxy)==null?void 0:R.$attrs).filter(([D])=>!v.value.includes(D)&&!(l&&G5.test(D))))}:()=>({}))},G1=Symbol("formContextKey"),QI=Symbol("formItemContextKey"),yE={prefix:Math.floor(Math.random()*1e4),current:0},q5=Symbol("elIdInjection"),W5=()=>Bs()?Mn(q5,yE):yE,Z5=n=>{const l=W5(),p=xI();return yF(()=>vt(n)||`${p.value}-id-${l.prefix}-${l.current++}`)},H1=()=>{const n=Mn(G1,void 0),l=Mn(QI,void 0);return{form:n,formItem:l}},e3=(n,{formItemContext:l,disableIdGeneration:p,disableIdManagement:v})=>{p||(p=hn(!1)),v||(v=hn(!1));const A=hn();let R;const D=it(()=>{var i;return!!(!(n.label||n.ariaLabel)&&l&&l.inputIds&&((i=l.inputIds)==null?void 0:i.length)<=1)});return da(()=>{R=Tn([ps(n,"id"),p],([i,G])=>{const W=i??(G?void 0:Z5().value);W!==A.value&&(l!=null&&l.removeInputId&&(A.value&&l.removeInputId(A.value),!(v!=null&&v.value)&&!G&&W&&l.addInputId(W)),A.value=W)},{immediate:!0})}),T1(()=>{R&&R(),l!=null&&l.removeInputId&&A.value&&l.removeInputId(A.value)}),{isLabeledByFormItem:D,inputId:A}},t3=n=>{const l=Bs();return it(()=>{var p,v;return(v=(p=l==null?void 0:l.proxy)==null?void 0:p.$props)==null?void 0:v[n]})},q1=(n,l={})=>{const p=hn(void 0),v=l.prop?p:t3("size"),A=l.global?p:WF(),R=l.form?{size:void 0}:Mn(G1,void 0),D=l.formItem?{size:void 0}:Mn(QI,void 0);return it(()=>v.value||vt(n)||(D==null?void 0:D.size)||(R==null?void 0:R.size)||A.value||"")},ky=n=>{const l=t3("disabled"),p=Mn(G1,void 0);return it(()=>l.value||vt(n)||(p==null?void 0:p.disabled)||!1)};function X5(n,{beforeFocus:l,afterFocus:p,beforeBlur:v,afterBlur:A}={}){const R=Bs(),{emit:D}=R,i=Nn(),G=hn(!1),W=ne=>{Zr(l)&&l(ne)||G.value||(G.value=!0,D("focus",ne),p==null||p())},H=ne=>{var de;Zr(v)&&v(ne)||ne.relatedTarget&&((de=i.value)!=null&&de.contains(ne.relatedTarget))||(G.value=!1,D("blur",ne),A==null||A())},ee=()=>{var ne,de;(ne=i.value)!=null&&ne.contains(document.activeElement)&&i.value!==document.activeElement||(de=n.value)==null||de.focus()};return Tn(i,ne=>{ne&&ne.setAttribute("tabindex","-1")}),Ed(i,"focus",W,!0),Ed(i,"blur",H,!0),Ed(i,"click",ee,!0),{isFocused:G,wrapperRef:i,handleFocus:W,handleBlur:H}}const K5=n=>/([\uAC00-\uD7AF\u3130-\u318F])+/gi.test(n);function Y5({afterComposition:n,emit:l}){const p=hn(!1),v=i=>{l==null||l("compositionstart",i),p.value=!0},A=i=>{var G;l==null||l("compositionupdate",i);const W=(G=i.target)==null?void 0:G.value,H=W[W.length-1]||"";p.value=!K5(H)},R=i=>{l==null||l("compositionend",i),p.value&&(p.value=!1,Zs(()=>n(i)))};return{isComposing:p,handleComposition:i=>{i.type==="compositionend"?R(i):A(i)},handleCompositionStart:v,handleCompositionUpdate:A,handleCompositionEnd:R}}function J5(n){let l;function p(){if(n.value==null)return;const{selectionStart:A,selectionEnd:R,value:D}=n.value;if(A==null||R==null)return;const i=D.slice(0,Math.max(0,A)),G=D.slice(Math.max(0,R));l={selectionStart:A,selectionEnd:R,value:D,beforeTxt:i,afterTxt:G}}function v(){if(n.value==null||l==null)return;const{value:A}=n.value,{beforeTxt:R,afterTxt:D,selectionStart:i}=l;if(R==null||D==null||i==null)return;let G=A.length;if(A.endsWith(D))G=A.length-D.length;else if(A.startsWith(R))G=R.length;else{const W=R[i-1],H=A.indexOf(W,i-1);H!==-1&&(G=H+1)}n.value.setSelectionRange(G,G)}return[p,v]}const Q5="ElInput",eB=_n({name:Q5,inheritAttrs:!1}),tB=_n({...eB,props:U5,emits:j5,setup(n,{expose:l,emit:p}){const v=n,A=Lz(),R=H5(),D=yM(),i=it(()=>[v.type==="textarea"?ye.b():he.b(),he.m(ne.value),he.is("disabled",de.value),he.is("exceed",rr.value),{[he.b("group")]:D.prepend||D.append,[he.m("prefix")]:D.prefix||v.prefixIcon,[he.m("suffix")]:D.suffix||v.suffixIcon||v.clearable||v.showPassword,[he.bm("suffix","password-clear")]:Vr.value&&lr.value,[he.b("hidden")]:v.type==="hidden"},A.class]),G=it(()=>[he.e("wrapper"),he.is("focus",At.value)]),{form:W,formItem:H}=H1(),{inputId:ee}=e3(v,{formItemContext:H}),ne=q1(),de=ky(),he=bc("input"),ye=bc("textarea"),Le=Nn(),je=Nn(),xt=hn(!1),Dt=hn(!1),ut=hn(),ht=Nn(v.inputStyle),Et=it(()=>Le.value||je.value),{wrapperRef:tt,isFocused:At,handleFocus:pt,handleBlur:at}=X5(Et,{beforeFocus(){return de.value},afterBlur(){var Ye;v.validateEvent&&((Ye=H==null?void 0:H.validate)==null||Ye.call(H,"blur").catch(Jt=>void 0))}}),gt=it(()=>{var Ye;return(Ye=W==null?void 0:W.statusIcon)!=null?Ye:!1}),yt=it(()=>(H==null?void 0:H.validateState)||""),sr=it(()=>yt.value&&L5[yt.value]),zr=it(()=>Dt.value?P5:g5),Zt=it(()=>[A.style]),Ir=it(()=>[v.inputStyle,ht.value,{resize:v.resize}]),vr=it(()=>RI(v.modelValue)?"":String(v.modelValue)),Vr=it(()=>v.clearable&&!de.value&&!v.readonly&&!!vr.value&&(At.value||xt.value)),lr=it(()=>v.showPassword&&!de.value&&!!vr.value&&(!!vr.value||At.value)),Hr=it(()=>v.showWordLimit&&!!v.maxlength&&(v.type==="text"||v.type==="textarea")&&!de.value&&!v.readonly&&!v.showPassword),ur=it(()=>vr.value.length),rr=it(()=>!!Hr.value&&ur.value>Number(v.maxlength)),$t=it(()=>!!D.suffix||!!v.suffixIcon||Vr.value||v.showPassword||Hr.value||!!yt.value&&gt.value),[vi,hi]=J5(Le);CF(je,Ye=>{if(er(),!Hr.value||v.resize!=="both")return;const Jt=Ye[0],{width:$r}=Jt.contentRect;ut.value={right:`calc(100% - ${$r+15+6}px)`}});const yn=()=>{const{type:Ye,autosize:Jt}=v;if(!(!Uu||Ye!=="textarea"||!je.value))if(Jt){const $r=Vn(Jt)?Jt.minRows:void 0,xn=Vn(Jt)?Jt.maxRows:void 0,Ur=gE(je.value,$r,xn);ht.value={overflowY:"hidden",...Ur},Zs(()=>{je.value.offsetHeight,ht.value=Ur})}else ht.value={minHeight:gE(je.value).minHeight}},er=(Ye=>{let Jt=!1;return()=>{var $r;if(Jt||!v.autosize)return;(($r=je.value)==null?void 0:$r.offsetParent)===null||(Ye(),Jt=!0)}})(yn),Kt=()=>{const Ye=Et.value,Jt=v.formatter?v.formatter(vr.value):vr.value;!Ye||Ye.value===Jt||(Ye.value=Jt)},te=async Ye=>{vi();let{value:Jt}=Ye.target;if(v.formatter&&v.parser&&(Jt=v.parser(Jt)),!ke.value){if(Jt===vr.value){Kt();return}p(zd,Jt),p(vm,Jt),await Zs(),Kt(),hi()}},vn=Ye=>{let{value:Jt}=Ye.target;v.formatter&&v.parser&&(Jt=v.parser(Jt)),p(ym,Jt)},{isComposing:ke,handleCompositionStart:Ve,handleCompositionUpdate:Ae,handleCompositionEnd:bt}=Y5({emit:p,afterComposition:te}),Vt=()=>{vi(),Dt.value=!Dt.value,setTimeout(hi)},zt=()=>{var Ye;return(Ye=Et.value)==null?void 0:Ye.focus()},Rt=()=>{var Ye;return(Ye=Et.value)==null?void 0:Ye.blur()},jt=Ye=>{xt.value=!1,p("mouseleave",Ye)},Yt=Ye=>{xt.value=!0,p("mouseenter",Ye)},Gt=Ye=>{p("keydown",Ye)},Cr=()=>{var Ye;(Ye=Et.value)==null||Ye.select()},cr=()=>{p(zd,""),p(ym,""),p("clear"),p(vm,"")};return Tn(()=>v.modelValue,()=>{var Ye;Zs(()=>yn()),v.validateEvent&&((Ye=H==null?void 0:H.validate)==null||Ye.call(H,"change").catch(Jt=>void 0))}),Tn(vr,()=>Kt()),Tn(()=>v.type,async()=>{await Zs(),Kt(),yn()}),da(()=>{!v.formatter&&v.parser,Kt(),Zs(yn)}),l({input:Le,textarea:je,ref:Et,textareaStyle:Ir,autosize:ps(v,"autosize"),isComposing:ke,focus:zt,blur:Rt,select:Cr,clear:cr,resizeTextarea:yn}),(Ye,Jt)=>(ir(),qr("div",{class:Ln([vt(i),{[vt(he).bm("group","append")]:Ye.$slots.append,[vt(he).bm("group","prepend")]:Ye.$slots.prepend}]),style:Ou(vt(Zt)),onMouseenter:Yt,onMouseleave:jt},[Zn(" input "),Ye.type!=="textarea"?(ir(),qr(ti,{key:0},[Zn(" prepend slot "),Ye.$slots.prepend?(ir(),qr("div",{key:0,class:Ln(vt(he).be("group","prepend"))},[oa(Ye.$slots,"prepend")],2)):Zn("v-if",!0),Wr("div",{ref_key:"wrapperRef",ref:tt,class:Ln(vt(G))},[Zn(" prefix slot "),Ye.$slots.prefix||Ye.prefixIcon?(ir(),qr("span",{key:0,class:Ln(vt(he).e("prefix"))},[Wr("span",{class:Ln(vt(he).e("prefix-inner"))},[oa(Ye.$slots,"prefix"),Ye.prefixIcon?(ir(),On(vt(Ws),{key:0,class:Ln(vt(he).e("icon"))},{default:Pn(()=>[(ir(),On(ho(Ye.prefixIcon)))]),_:1},8,["class"])):Zn("v-if",!0)],2)],2)):Zn("v-if",!0),Wr("input",Ys({id:vt(ee),ref_key:"input",ref:Le,class:vt(he).e("inner")},vt(R),{minlength:Ye.minlength,maxlength:Ye.maxlength,type:Ye.showPassword?Dt.value?"text":"password":Ye.type,disabled:vt(de),readonly:Ye.readonly,autocomplete:Ye.autocomplete,tabindex:Ye.tabindex,"aria-label":Ye.ariaLabel,placeholder:Ye.placeholder,style:Ye.inputStyle,form:Ye.form,autofocus:Ye.autofocus,role:Ye.containerRole,onCompositionstart:vt(Ve),onCompositionupdate:vt(Ae),onCompositionend:vt(bt),onInput:te,onChange:vn,onKeydown:Gt}),null,16,["id","minlength","maxlength","type","disabled","readonly","autocomplete","tabindex","aria-label","placeholder","form","autofocus","role","onCompositionstart","onCompositionupdate","onCompositionend"]),Zn(" suffix slot "),vt($t)?(ir(),qr("span",{key:1,class:Ln(vt(he).e("suffix"))},[Wr("span",{class:Ln(vt(he).e("suffix-inner"))},[!vt(Vr)||!vt(lr)||!vt(Hr)?(ir(),qr(ti,{key:0},[oa(Ye.$slots,"suffix"),Ye.suffixIcon?(ir(),On(vt(Ws),{key:0,class:Ln(vt(he).e("icon"))},{default:Pn(()=>[(ir(),On(ho(Ye.suffixIcon)))]),_:1},8,["class"])):Zn("v-if",!0)],64)):Zn("v-if",!0),vt(Vr)?(ir(),On(vt(Ws),{key:1,class:Ln([vt(he).e("icon"),vt(he).e("clear")]),onMousedown:JM(vt(_o),["prevent"]),onClick:cr},{default:Pn(()=>[dt(vt(WI))]),_:1},8,["class","onMousedown"])):Zn("v-if",!0),vt(lr)?(ir(),On(vt(Ws),{key:2,class:Ln([vt(he).e("icon"),vt(he).e("password")]),onClick:Vt},{default:Pn(()=>[(ir(),On(ho(vt(zr))))]),_:1},8,["class"])):Zn("v-if",!0),vt(Hr)?(ir(),qr("span",{key:3,class:Ln(vt(he).e("count"))},[Wr("span",{class:Ln(vt(he).e("count-inner"))},Xs(vt(ur))+" / "+Xs(Ye.maxlength),3)],2)):Zn("v-if",!0),vt(yt)&&vt(sr)&&vt(gt)?(ir(),On(vt(Ws),{key:4,class:Ln([vt(he).e("icon"),vt(he).e("validateIcon"),vt(he).is("loading",vt(yt)==="validating")])},{default:Pn(()=>[(ir(),On(ho(vt(sr))))]),_:1},8,["class"])):Zn("v-if",!0)],2)],2)):Zn("v-if",!0)],2),Zn(" append slot "),Ye.$slots.append?(ir(),qr("div",{key:1,class:Ln(vt(he).be("group","append"))},[oa(Ye.$slots,"append")],2)):Zn("v-if",!0)],64)):(ir(),qr(ti,{key:1},[Zn(" textarea "),Wr("textarea",Ys({id:vt(ee),ref_key:"textarea",ref:je,class:[vt(ye).e("inner"),vt(he).is("focus",vt(At))]},vt(R),{minlength:Ye.minlength,maxlength:Ye.maxlength,tabindex:Ye.tabindex,disabled:vt(de),readonly:Ye.readonly,autocomplete:Ye.autocomplete,style:vt(Ir),"aria-label":Ye.ariaLabel,placeholder:Ye.placeholder,form:Ye.form,autofocus:Ye.autofocus,rows:Ye.rows,role:Ye.containerRole,onCompositionstart:vt(Ve),onCompositionupdate:vt(Ae),onCompositionend:vt(bt),onInput:te,onFocus:vt(pt),onBlur:vt(at),onChange:vn,onKeydown:Gt}),null,16,["id","minlength","maxlength","tabindex","disabled","readonly","autocomplete","aria-label","placeholder","form","autofocus","rows","role","onCompositionstart","onCompositionupdate","onCompositionend","onFocus","onBlur"]),vt(Hr)?(ir(),qr("span",{key:0,style:Ou(ut.value),class:Ln(vt(he).e("count"))},Xs(vt(ur))+" / "+Xs(Ye.maxlength),7)):Zn("v-if",!0)],64))],38))}});var rB=Dm(tB,[["__file","input.vue"]]);const nB=Oy(rB),r3=Symbol("buttonGroupContextKey"),iB=({from:n,replacement:l,scope:p,version:v,ref:A,type:R="API"},D)=>{Tn(()=>vt(D),i=>{},{immediate:!0})},sB=(n,l)=>{iB({from:"type.text",replacement:"link",version:"3.0.0",scope:"props",ref:"https://element-plus.org/en-US/component/button.html#button-attributes"},it(()=>n.type==="text"));const p=Mn(r3,void 0),v=j1("button"),{form:A}=H1(),R=q1(it(()=>p==null?void 0:p.size)),D=ky(),i=hn(),G=yM(),W=it(()=>n.type||(p==null?void 0:p.type)||""),H=it(()=>{var he,ye,Le;return(Le=(ye=n.autoInsertSpace)!=null?ye:(he=v.value)==null?void 0:he.autoInsertSpace)!=null?Le:!1}),ee=it(()=>n.tag==="button"?{ariaDisabled:D.value||n.loading,disabled:D.value||n.loading,autofocus:n.autofocus,type:n.nativeType}:{}),ne=it(()=>{var he;const ye=(he=G.default)==null?void 0:he.call(G);if(H.value&&(ye==null?void 0:ye.length)===1){const Le=ye[0];if((Le==null?void 0:Le.type)===Fd){const je=Le.children;return new RegExp("^\\p{Unified_Ideograph}{2}$","u").test(je.trim())}}return!1});return{_disabled:D,_size:R,_type:W,_ref:i,_props:ee,shouldAddSpace:ne,handleClick:he=>{if(D.value||n.loading){he.stopPropagation();return}n.nativeType==="reset"&&(A==null||A.resetFields()),l("click",he)}}},oB=["default","primary","success","warning","info","danger","text",""],aB=["button","submit","reset"],$x=Nd({size:UI,disabled:Boolean,type:{type:String,values:oB,default:""},icon:{type:_c},nativeType:{type:String,values:aB,default:"button"},loading:Boolean,loadingIcon:{type:_c,default:()=>$1},plain:Boolean,text:Boolean,link:Boolean,bg:Boolean,autofocus:Boolean,round:Boolean,circle:Boolean,color:String,dark:Boolean,autoInsertSpace:{type:Boolean,default:void 0},tag:{type:Du([String,Object]),default:"button"}}),lB={click:n=>n instanceof MouseEvent};function rs(n,l){cB(n)&&(n="100%");var p=uB(n);return n=l===360?n:Math.min(l,Math.max(0,parseFloat(n))),p&&(n=parseInt(String(n*l),10)/100),Math.abs(n-l)<1e-6?1:(l===360?n=(n<0?n%l+l:n%l)/parseFloat(String(l)):n=n%l/parseFloat(String(l)),n)}function Pg(n){return Math.min(1,Math.max(0,n))}function cB(n){return typeof n=="string"&&n.indexOf(".")!==-1&&parseFloat(n)===1}function uB(n){return typeof n=="string"&&n.indexOf("%")!==-1}function n3(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function Rg(n){return n<=1?"".concat(Number(n)*100,"%"):n}function Mu(n){return n.length===1?"0"+n:String(n)}function hB(n,l,p){return{r:rs(n,255)*255,g:rs(l,255)*255,b:rs(p,255)*255}}function vE(n,l,p){n=rs(n,255),l=rs(l,255),p=rs(p,255);var v=Math.max(n,l,p),A=Math.min(n,l,p),R=0,D=0,i=(v+A)/2;if(v===A)D=0,R=0;else{var G=v-A;switch(D=i>.5?G/(2-v-A):G/(v+A),v){case n:R=(l-p)/G+(l<p?6:0);break;case l:R=(p-n)/G+2;break;case p:R=(n-l)/G+4;break}R/=6}return{h:R,s:D,l:i}}function _x(n,l,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?n+(l-n)*(6*p):p<1/2?l:p<2/3?n+(l-n)*(2/3-p)*6:n}function dB(n,l,p){var v,A,R;if(n=rs(n,360),l=rs(l,100),p=rs(p,100),l===0)A=p,R=p,v=p;else{var D=p<.5?p*(1+l):p+l-p*l,i=2*p-D;v=_x(i,D,n+1/3),A=_x(i,D,n),R=_x(i,D,n-1/3)}return{r:v*255,g:A*255,b:R*255}}function xE(n,l,p){n=rs(n,255),l=rs(l,255),p=rs(p,255);var v=Math.max(n,l,p),A=Math.min(n,l,p),R=0,D=v,i=v-A,G=v===0?0:i/v;if(v===A)R=0;else{switch(v){case n:R=(l-p)/i+(l<p?6:0);break;case l:R=(p-n)/i+2;break;case p:R=(n-l)/i+4;break}R/=6}return{h:R,s:G,v:D}}function fB(n,l,p){n=rs(n,360)*6,l=rs(l,100),p=rs(p,100);var v=Math.floor(n),A=n-v,R=p*(1-l),D=p*(1-A*l),i=p*(1-(1-A)*l),G=v%6,W=[p,D,R,R,i,p][G],H=[i,p,p,D,R,R][G],ee=[R,R,i,p,p,D][G];return{r:W*255,g:H*255,b:ee*255}}function bE(n,l,p,v){var A=[Mu(Math.round(n).toString(16)),Mu(Math.round(l).toString(16)),Mu(Math.round(p).toString(16))];return v&&A[0].startsWith(A[0].charAt(1))&&A[1].startsWith(A[1].charAt(1))&&A[2].startsWith(A[2].charAt(1))?A[0].charAt(0)+A[1].charAt(0)+A[2].charAt(0):A.join("")}function pB(n,l,p,v,A){var R=[Mu(Math.round(n).toString(16)),Mu(Math.round(l).toString(16)),Mu(Math.round(p).toString(16)),Mu(mB(v))];return A&&R[0].startsWith(R[0].charAt(1))&&R[1].startsWith(R[1].charAt(1))&&R[2].startsWith(R[2].charAt(1))&&R[3].startsWith(R[3].charAt(1))?R[0].charAt(0)+R[1].charAt(0)+R[2].charAt(0)+R[3].charAt(0):R.join("")}function mB(n){return Math.round(parseFloat(n)*255).toString(16)}function wE(n){return uo(n)/255}function uo(n){return parseInt(n,16)}function _B(n){return{r:n>>16,g:(n&65280)>>8,b:n&255}}var Gx={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function gB(n){var l={r:0,g:0,b:0},p=1,v=null,A=null,R=null,D=!1,i=!1;return typeof n=="string"&&(n=xB(n)),typeof n=="object"&&(dl(n.r)&&dl(n.g)&&dl(n.b)?(l=hB(n.r,n.g,n.b),D=!0,i=String(n.r).substr(-1)==="%"?"prgb":"rgb"):dl(n.h)&&dl(n.s)&&dl(n.v)?(v=Rg(n.s),A=Rg(n.v),l=fB(n.h,v,A),D=!0,i="hsv"):dl(n.h)&&dl(n.s)&&dl(n.l)&&(v=Rg(n.s),R=Rg(n.l),l=dB(n.h,v,R),D=!0,i="hsl"),Object.prototype.hasOwnProperty.call(n,"a")&&(p=n.a)),p=n3(p),{ok:D,format:n.format||i,r:Math.min(255,Math.max(l.r,0)),g:Math.min(255,Math.max(l.g,0)),b:Math.min(255,Math.max(l.b,0)),a:p}}var yB="[-\\+]?\\d+%?",vB="[-\\+]?\\d*\\.\\d+%?",gc="(?:".concat(vB,")|(?:").concat(yB,")"),gx="[\\s|\\(]+(".concat(gc,")[,|\\s]+(").concat(gc,")[,|\\s]+(").concat(gc,")\\s*\\)?"),yx="[\\s|\\(]+(".concat(gc,")[,|\\s]+(").concat(gc,")[,|\\s]+(").concat(gc,")[,|\\s]+(").concat(gc,")\\s*\\)?"),sa={CSS_UNIT:new RegExp(gc),rgb:new RegExp("rgb"+gx),rgba:new RegExp("rgba"+yx),hsl:new RegExp("hsl"+gx),hsla:new RegExp("hsla"+yx),hsv:new RegExp("hsv"+gx),hsva:new RegExp("hsva"+yx),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function xB(n){if(n=n.trim().toLowerCase(),n.length===0)return!1;var l=!1;if(Gx[n])n=Gx[n],l=!0;else if(n==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var p=sa.rgb.exec(n);return p?{r:p[1],g:p[2],b:p[3]}:(p=sa.rgba.exec(n),p?{r:p[1],g:p[2],b:p[3],a:p[4]}:(p=sa.hsl.exec(n),p?{h:p[1],s:p[2],l:p[3]}:(p=sa.hsla.exec(n),p?{h:p[1],s:p[2],l:p[3],a:p[4]}:(p=sa.hsv.exec(n),p?{h:p[1],s:p[2],v:p[3]}:(p=sa.hsva.exec(n),p?{h:p[1],s:p[2],v:p[3],a:p[4]}:(p=sa.hex8.exec(n),p?{r:uo(p[1]),g:uo(p[2]),b:uo(p[3]),a:wE(p[4]),format:l?"name":"hex8"}:(p=sa.hex6.exec(n),p?{r:uo(p[1]),g:uo(p[2]),b:uo(p[3]),format:l?"name":"hex"}:(p=sa.hex4.exec(n),p?{r:uo(p[1]+p[1]),g:uo(p[2]+p[2]),b:uo(p[3]+p[3]),a:wE(p[4]+p[4]),format:l?"name":"hex8"}:(p=sa.hex3.exec(n),p?{r:uo(p[1]+p[1]),g:uo(p[2]+p[2]),b:uo(p[3]+p[3]),format:l?"name":"hex"}:!1)))))))))}function dl(n){return!!sa.CSS_UNIT.exec(String(n))}var bB=function(){function n(l,p){l===void 0&&(l=""),p===void 0&&(p={});var v;if(l instanceof n)return l;typeof l=="number"&&(l=_B(l)),this.originalInput=l;var A=gB(l);this.originalInput=l,this.r=A.r,this.g=A.g,this.b=A.b,this.a=A.a,this.roundA=Math.round(100*this.a)/100,this.format=(v=p.format)!==null&&v!==void 0?v:A.format,this.gradientType=p.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=A.ok}return n.prototype.isDark=function(){return this.getBrightness()<128},n.prototype.isLight=function(){return!this.isDark()},n.prototype.getBrightness=function(){var l=this.toRgb();return(l.r*299+l.g*587+l.b*114)/1e3},n.prototype.getLuminance=function(){var l=this.toRgb(),p,v,A,R=l.r/255,D=l.g/255,i=l.b/255;return R<=.03928?p=R/12.92:p=Math.pow((R+.055)/1.055,2.4),D<=.03928?v=D/12.92:v=Math.pow((D+.055)/1.055,2.4),i<=.03928?A=i/12.92:A=Math.pow((i+.055)/1.055,2.4),.2126*p+.7152*v+.0722*A},n.prototype.getAlpha=function(){return this.a},n.prototype.setAlpha=function(l){return this.a=n3(l),this.roundA=Math.round(100*this.a)/100,this},n.prototype.isMonochrome=function(){var l=this.toHsl().s;return l===0},n.prototype.toHsv=function(){var l=xE(this.r,this.g,this.b);return{h:l.h*360,s:l.s,v:l.v,a:this.a}},n.prototype.toHsvString=function(){var l=xE(this.r,this.g,this.b),p=Math.round(l.h*360),v=Math.round(l.s*100),A=Math.round(l.v*100);return this.a===1?"hsv(".concat(p,", ").concat(v,"%, ").concat(A,"%)"):"hsva(".concat(p,", ").concat(v,"%, ").concat(A,"%, ").concat(this.roundA,")")},n.prototype.toHsl=function(){var l=vE(this.r,this.g,this.b);return{h:l.h*360,s:l.s,l:l.l,a:this.a}},n.prototype.toHslString=function(){var l=vE(this.r,this.g,this.b),p=Math.round(l.h*360),v=Math.round(l.s*100),A=Math.round(l.l*100);return this.a===1?"hsl(".concat(p,", ").concat(v,"%, ").concat(A,"%)"):"hsla(".concat(p,", ").concat(v,"%, ").concat(A,"%, ").concat(this.roundA,")")},n.prototype.toHex=function(l){return l===void 0&&(l=!1),bE(this.r,this.g,this.b,l)},n.prototype.toHexString=function(l){return l===void 0&&(l=!1),"#"+this.toHex(l)},n.prototype.toHex8=function(l){return l===void 0&&(l=!1),pB(this.r,this.g,this.b,this.a,l)},n.prototype.toHex8String=function(l){return l===void 0&&(l=!1),"#"+this.toHex8(l)},n.prototype.toHexShortString=function(l){return l===void 0&&(l=!1),this.a===1?this.toHexString(l):this.toHex8String(l)},n.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},n.prototype.toRgbString=function(){var l=Math.round(this.r),p=Math.round(this.g),v=Math.round(this.b);return this.a===1?"rgb(".concat(l,", ").concat(p,", ").concat(v,")"):"rgba(".concat(l,", ").concat(p,", ").concat(v,", ").concat(this.roundA,")")},n.prototype.toPercentageRgb=function(){var l=function(p){return"".concat(Math.round(rs(p,255)*100),"%")};return{r:l(this.r),g:l(this.g),b:l(this.b),a:this.a}},n.prototype.toPercentageRgbString=function(){var l=function(p){return Math.round(rs(p,255)*100)};return this.a===1?"rgb(".concat(l(this.r),"%, ").concat(l(this.g),"%, ").concat(l(this.b),"%)"):"rgba(".concat(l(this.r),"%, ").concat(l(this.g),"%, ").concat(l(this.b),"%, ").concat(this.roundA,")")},n.prototype.toName=function(){if(this.a===0)return"transparent";if(this.a<1)return!1;for(var l="#"+bE(this.r,this.g,this.b,!1),p=0,v=Object.entries(Gx);p<v.length;p++){var A=v[p],R=A[0],D=A[1];if(l===D)return R}return!1},n.prototype.toString=function(l){var p=!!l;l=l??this.format;var v=!1,A=this.a<1&&this.a>=0,R=!p&&A&&(l.startsWith("hex")||l==="name");return R?l==="name"&&this.a===0?this.toName():this.toRgbString():(l==="rgb"&&(v=this.toRgbString()),l==="prgb"&&(v=this.toPercentageRgbString()),(l==="hex"||l==="hex6")&&(v=this.toHexString()),l==="hex3"&&(v=this.toHexString(!0)),l==="hex4"&&(v=this.toHex8String(!0)),l==="hex8"&&(v=this.toHex8String()),l==="name"&&(v=this.toName()),l==="hsl"&&(v=this.toHslString()),l==="hsv"&&(v=this.toHsvString()),v||this.toHexString())},n.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},n.prototype.clone=function(){return new n(this.toString())},n.prototype.lighten=function(l){l===void 0&&(l=10);var p=this.toHsl();return p.l+=l/100,p.l=Pg(p.l),new n(p)},n.prototype.brighten=function(l){l===void 0&&(l=10);var p=this.toRgb();return p.r=Math.max(0,Math.min(255,p.r-Math.round(255*-(l/100)))),p.g=Math.max(0,Math.min(255,p.g-Math.round(255*-(l/100)))),p.b=Math.max(0,Math.min(255,p.b-Math.round(255*-(l/100)))),new n(p)},n.prototype.darken=function(l){l===void 0&&(l=10);var p=this.toHsl();return p.l-=l/100,p.l=Pg(p.l),new n(p)},n.prototype.tint=function(l){return l===void 0&&(l=10),this.mix("white",l)},n.prototype.shade=function(l){return l===void 0&&(l=10),this.mix("black",l)},n.prototype.desaturate=function(l){l===void 0&&(l=10);var p=this.toHsl();return p.s-=l/100,p.s=Pg(p.s),new n(p)},n.prototype.saturate=function(l){l===void 0&&(l=10);var p=this.toHsl();return p.s+=l/100,p.s=Pg(p.s),new n(p)},n.prototype.greyscale=function(){return this.desaturate(100)},n.prototype.spin=function(l){var p=this.toHsl(),v=(p.h+l)%360;return p.h=v<0?360+v:v,new n(p)},n.prototype.mix=function(l,p){p===void 0&&(p=50);var v=this.toRgb(),A=new n(l).toRgb(),R=p/100,D={r:(A.r-v.r)*R+v.r,g:(A.g-v.g)*R+v.g,b:(A.b-v.b)*R+v.b,a:(A.a-v.a)*R+v.a};return new n(D)},n.prototype.analogous=function(l,p){l===void 0&&(l=6),p===void 0&&(p=30);var v=this.toHsl(),A=360/p,R=[this];for(v.h=(v.h-(A*l>>1)+720)%360;--l;)v.h=(v.h+A)%360,R.push(new n(v));return R},n.prototype.complement=function(){var l=this.toHsl();return l.h=(l.h+180)%360,new n(l)},n.prototype.monochromatic=function(l){l===void 0&&(l=6);for(var p=this.toHsv(),v=p.h,A=p.s,R=p.v,D=[],i=1/l;l--;)D.push(new n({h:v,s:A,v:R})),R=(R+i)%1;return D},n.prototype.splitcomplement=function(){var l=this.toHsl(),p=l.h;return[this,new n({h:(p+72)%360,s:l.s,l:l.l}),new n({h:(p+216)%360,s:l.s,l:l.l})]},n.prototype.onBackground=function(l){var p=this.toRgb(),v=new n(l).toRgb(),A=p.a+v.a*(1-p.a);return new n({r:(p.r*p.a+v.r*v.a*(1-p.a))/A,g:(p.g*p.a+v.g*v.a*(1-p.a))/A,b:(p.b*p.a+v.b*v.a*(1-p.a))/A,a:A})},n.prototype.triad=function(){return this.polyad(3)},n.prototype.tetrad=function(){return this.polyad(4)},n.prototype.polyad=function(l){for(var p=this.toHsl(),v=p.h,A=[this],R=360/l,D=1;D<l;D++)A.push(new n({h:(v+D*R)%360,s:p.s,l:p.l}));return A},n.prototype.equals=function(l){return this.toRgbString()===new n(l).toRgbString()},n}();function ac(n,l=20){return n.mix("#141414",l).toString()}function wB(n){const l=ky(),p=bc("button");return it(()=>{let v={},A=n.color;if(A){const R=A.match(/var\((.*?)\)/);R&&(A=window.getComputedStyle(window.document.documentElement).getPropertyValue(R[1]));const D=new bB(A),i=n.dark?D.tint(20).toString():ac(D,20);if(n.plain)v=p.cssVarBlock({"bg-color":n.dark?ac(D,90):D.tint(90).toString(),"text-color":A,"border-color":n.dark?ac(D,50):D.tint(50).toString(),"hover-text-color":`var(${p.cssVarName("color-white")})`,"hover-bg-color":A,"hover-border-color":A,"active-bg-color":i,"active-text-color":`var(${p.cssVarName("color-white")})`,"active-border-color":i}),l.value&&(v[p.cssVarBlockName("disabled-bg-color")]=n.dark?ac(D,90):D.tint(90).toString(),v[p.cssVarBlockName("disabled-text-color")]=n.dark?ac(D,50):D.tint(50).toString(),v[p.cssVarBlockName("disabled-border-color")]=n.dark?ac(D,80):D.tint(80).toString());else{const G=n.dark?ac(D,30):D.tint(30).toString(),W=D.isDark()?`var(${p.cssVarName("color-white")})`:`var(${p.cssVarName("color-black")})`;if(v=p.cssVarBlock({"bg-color":A,"text-color":W,"border-color":A,"hover-bg-color":G,"hover-text-color":W,"hover-border-color":G,"active-bg-color":i,"active-border-color":i}),l.value){const H=n.dark?ac(D,50):D.tint(50).toString();v[p.cssVarBlockName("disabled-bg-color")]=H,v[p.cssVarBlockName("disabled-text-color")]=n.dark?"rgba(255, 255, 255, 0.5)":`var(${p.cssVarName("color-white")})`,v[p.cssVarBlockName("disabled-border-color")]=H}}}return v})}const TB=_n({name:"ElButton"}),SB=_n({...TB,props:$x,emits:lB,setup(n,{expose:l,emit:p}){const v=n,A=wB(v),R=bc("button"),{_ref:D,_size:i,_type:G,_disabled:W,_props:H,shouldAddSpace:ee,handleClick:ne}=sB(v,p),de=it(()=>[R.b(),R.m(G.value),R.m(i.value),R.is("disabled",W.value),R.is("loading",v.loading),R.is("plain",v.plain),R.is("round",v.round),R.is("circle",v.circle),R.is("text",v.text),R.is("link",v.link),R.is("has-bg",v.bg)]);return l({ref:D,size:i,type:G,disabled:W,shouldAddSpace:ee}),(he,ye)=>(ir(),On(ho(he.tag),Ys({ref_key:"_ref",ref:D},vt(H),{class:vt(de),style:vt(A),onClick:vt(ne)}),{default:Pn(()=>[he.loading?(ir(),qr(ti,{key:0},[he.$slots.loading?oa(he.$slots,"loading",{key:0}):(ir(),On(vt(Ws),{key:1,class:Ln(vt(R).is("loading"))},{default:Pn(()=>[(ir(),On(ho(he.loadingIcon)))]),_:1},8,["class"]))],64)):he.icon||he.$slots.icon?(ir(),On(vt(Ws),{key:1},{default:Pn(()=>[he.icon?(ir(),On(ho(he.icon),{key:0})):oa(he.$slots,"icon",{key:1})]),_:3})):Zn("v-if",!0),he.$slots.default?(ir(),qr("span",{key:2,class:Ln({[vt(R).em("text","expand")]:vt(ee)})},[oa(he.$slots,"default")],2)):Zn("v-if",!0)]),_:3},16,["class","style","onClick"]))}});var EB=Dm(SB,[["__file","button.vue"]]);const AB={size:$x.size,type:$x.type},MB=_n({name:"ElButtonGroup"}),IB=_n({...MB,props:AB,setup(n){const l=n;go(r3,Zi({size:ps(l,"size"),type:ps(l,"type")}));const p=bc("button");return(v,A)=>(ir(),qr("div",{class:Ln(vt(p).b("group"))},[oa(v.$slots,"default")],2))}});var i3=Dm(IB,[["__file","button-group.vue"]]);const CB=Oy(EB,{ButtonGroup:i3});JF(i3);function PB(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}const RB=n=>["",...VI].includes(n),DB=Nd({modelValue:{type:[Boolean,String,Number],default:!1},disabled:Boolean,loading:Boolean,size:{type:String,validator:RB},width:{type:[String,Number],default:""},inlinePrompt:Boolean,inactiveActionIcon:{type:_c},activeActionIcon:{type:_c},activeIcon:{type:_c},inactiveIcon:{type:_c},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},beforeChange:{type:Du(Function)},id:String,tabindex:{type:[String,Number]},...JI(["ariaLabel"])}),zB={[zd]:n=>$g(n)||Hn(n)||Ru(n),[ym]:n=>$g(n)||Hn(n)||Ru(n),[vm]:n=>$g(n)||Hn(n)||Ru(n)},s3="ElSwitch",LB=_n({name:s3}),OB=_n({...LB,props:DB,emits:zB,setup(n,{expose:l,emit:p}){const v=n,{formItem:A}=H1(),R=q1(),D=bc("switch"),{inputId:i}=e3(v,{formItemContext:A}),G=ky(it(()=>v.loading)),W=hn(v.modelValue!==!1),H=hn(),ee=hn(),ne=it(()=>[D.b(),D.m(R.value),D.is("disabled",G.value),D.is("checked",je.value)]),de=it(()=>[D.e("label"),D.em("label","left"),D.is("active",!je.value)]),he=it(()=>[D.e("label"),D.em("label","right"),D.is("active",je.value)]),ye=it(()=>({width:HI(v.width)}));Tn(()=>v.modelValue,()=>{W.value=!0});const Le=it(()=>W.value?v.modelValue:!1),je=it(()=>Le.value===v.activeValue);[v.activeValue,v.inactiveValue].includes(Le.value)||(p(zd,v.inactiveValue),p(ym,v.inactiveValue),p(vm,v.inactiveValue)),Tn(je,ht=>{var Et;H.value.checked=ht,v.validateEvent&&((Et=A==null?void 0:A.validate)==null||Et.call(A,"change").catch(tt=>void 0))});const xt=()=>{const ht=je.value?v.inactiveValue:v.activeValue;p(zd,ht),p(ym,ht),p(vm,ht),Zs(()=>{H.value.checked=je.value})},Dt=()=>{if(G.value)return;const{beforeChange:ht}=v;if(!ht){xt();return}const Et=ht();[Xg(Et),$g(Et)].includes(!0)||NF(s3,"beforeChange must return type `Promise<boolean>` or `boolean`"),Xg(Et)?Et.then(At=>{At&&xt()}).catch(At=>{}):Et&&xt()},ut=()=>{var ht,Et;(Et=(ht=H.value)==null?void 0:ht.focus)==null||Et.call(ht)};return da(()=>{H.value.checked=je.value}),l({focus:ut,checked:je}),(ht,Et)=>(ir(),qr("div",{class:Ln(vt(ne)),onClick:JM(Dt,["prevent"])},[Wr("input",{id:vt(i),ref_key:"input",ref:H,class:Ln(vt(D).e("input")),type:"checkbox",role:"switch","aria-checked":vt(je),"aria-disabled":vt(G),"aria-label":ht.ariaLabel,name:ht.name,"true-value":ht.activeValue,"false-value":ht.inactiveValue,disabled:vt(G),tabindex:ht.tabindex,onChange:xt,onKeydown:J4(Dt,["enter"])},null,42,["id","aria-checked","aria-disabled","aria-label","name","true-value","false-value","disabled","tabindex","onKeydown"]),!ht.inlinePrompt&&(ht.inactiveIcon||ht.inactiveText)?(ir(),qr("span",{key:0,class:Ln(vt(de))},[ht.inactiveIcon?(ir(),On(vt(Ws),{key:0},{default:Pn(()=>[(ir(),On(ho(ht.inactiveIcon)))]),_:1})):Zn("v-if",!0),!ht.inactiveIcon&&ht.inactiveText?(ir(),qr("span",{key:1,"aria-hidden":vt(je)},Xs(ht.inactiveText),9,["aria-hidden"])):Zn("v-if",!0)],2)):Zn("v-if",!0),Wr("span",{ref_key:"core",ref:ee,class:Ln(vt(D).e("core")),style:Ou(vt(ye))},[ht.inlinePrompt?(ir(),qr("div",{key:0,class:Ln(vt(D).e("inner"))},[ht.activeIcon||ht.inactiveIcon?(ir(),On(vt(Ws),{key:0,class:Ln(vt(D).is("icon"))},{default:Pn(()=>[(ir(),On(ho(vt(je)?ht.activeIcon:ht.inactiveIcon)))]),_:1},8,["class"])):ht.activeText||ht.inactiveText?(ir(),qr("span",{key:1,class:Ln(vt(D).is("text")),"aria-hidden":!vt(je)},Xs(vt(je)?ht.activeText:ht.inactiveText),11,["aria-hidden"])):Zn("v-if",!0)],2)):Zn("v-if",!0),Wr("div",{class:Ln(vt(D).e("action"))},[ht.loading?(ir(),On(vt(Ws),{key:0,class:Ln(vt(D).is("loading"))},{default:Pn(()=>[dt(vt($1))]),_:1},8,["class"])):vt(je)?oa(ht.$slots,"active-action",{key:1},()=>[ht.activeActionIcon?(ir(),On(vt(Ws),{key:0},{default:Pn(()=>[(ir(),On(ho(ht.activeActionIcon)))]),_:1})):Zn("v-if",!0)]):vt(je)?Zn("v-if",!0):oa(ht.$slots,"inactive-action",{key:2},()=>[ht.inactiveActionIcon?(ir(),On(vt(Ws),{key:0},{default:Pn(()=>[(ir(),On(ho(ht.inactiveActionIcon)))]),_:1})):Zn("v-if",!0)])],2)],6),!ht.inlinePrompt&&(ht.activeIcon||ht.activeText)?(ir(),qr("span",{key:1,class:Ln(vt(he))},[ht.activeIcon?(ir(),On(vt(Ws),{key:0},{default:Pn(()=>[(ir(),On(ho(ht.activeIcon)))]),_:1})):Zn("v-if",!0),!ht.activeIcon&&ht.activeText?(ir(),qr("span",{key:1,"aria-hidden":!vt(je)},Xs(ht.activeText),9,["aria-hidden"])):Zn("v-if",!0)],2)):Zn("v-if",!0)],10,["onClick"]))}});var kB=Dm(OB,[["__file","switch.vue"]]);const FB=Oy(kB),BB=iI("main",{state:()=>({drawer:!0})});var Gg={exports:{}},NB=Gg.exports,TE;function VB(){return TE||(TE=1,function(n,l){(function(p,v){n.exports=v()})(NB,function(){var p,v,A;function R(i,G){if(!p)p=G;else if(!v)v=G;else{var W="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+v+")(sharedChunk); self.onerror = null;",H={};p(H),A=G(H),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(A.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}R(["exports"],function(i){function G(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var W,H={},ee={};function ne(){if(W)return ee;W=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.setMatrixArrayType=function(u){ee.ARRAY_TYPE=e=u},ee.toRadian=function(u){return u*a},ee.equals=function(u,c){return Math.abs(u-c)<=o*Math.max(1,Math.abs(u),Math.abs(c))},ee.RANDOM=ee.ARRAY_TYPE=ee.EPSILON=void 0;var o=1e-6;ee.EPSILON=o;var e=typeof Float32Array<"u"?Float32Array:Array;ee.ARRAY_TYPE=e;var r=Math.random;ee.RANDOM=r;var a=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var u=0,c=arguments.length;c--;)u+=arguments[c]*arguments[c];return Math.sqrt(u)}),ee}var de,he={};function ye(){if(de)return he;function o(c){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},o(c)}de=1,Object.defineProperty(he,"__esModule",{value:!0}),he.create=function(){var c=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c},he.clone=function(c){var f=new e.ARRAY_TYPE(4);return f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f},he.copy=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[3],c},he.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c},he.fromValues=function(c,f,y,b){var S=new e.ARRAY_TYPE(4);return S[0]=c,S[1]=f,S[2]=y,S[3]=b,S},he.set=function(c,f,y,b,S){return c[0]=f,c[1]=y,c[2]=b,c[3]=S,c},he.transpose=function(c,f){if(c===f){var y=f[1];c[1]=f[2],c[2]=y}else c[0]=f[0],c[1]=f[2],c[2]=f[1],c[3]=f[3];return c},he.invert=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=y*_-S*b;return w?(c[0]=_*(w=1/w),c[1]=-b*w,c[2]=-S*w,c[3]=y*w,c):null},he.adjoint=function(c,f){var y=f[0];return c[0]=f[3],c[1]=-f[1],c[2]=-f[2],c[3]=y,c},he.determinant=function(c){return c[0]*c[3]-c[2]*c[1]},he.multiply=a,he.rotate=function(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=Math.sin(y),T=Math.cos(y);return c[0]=b*T+_*M,c[1]=S*T+w*M,c[2]=b*-M+_*T,c[3]=S*-M+w*T,c},he.scale=function(c,f,y){var b=f[1],S=f[2],_=f[3],w=y[0],M=y[1];return c[0]=f[0]*w,c[1]=b*w,c[2]=S*M,c[3]=_*M,c},he.fromRotation=function(c,f){var y=Math.sin(f),b=Math.cos(f);return c[0]=b,c[1]=y,c[2]=-y,c[3]=b,c},he.fromScaling=function(c,f){return c[0]=f[0],c[1]=0,c[2]=0,c[3]=f[1],c},he.str=function(c){return"mat2("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+")"},he.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3])},he.LDU=function(c,f,y,b){return c[2]=b[2]/b[0],y[0]=b[0],y[1]=b[1],y[3]=b[3]-c[2]*y[1],[c,f,y]},he.add=function(c,f,y){return c[0]=f[0]+y[0],c[1]=f[1]+y[1],c[2]=f[2]+y[2],c[3]=f[3]+y[3],c},he.subtract=u,he.exactEquals=function(c,f){return c[0]===f[0]&&c[1]===f[1]&&c[2]===f[2]&&c[3]===f[3]},he.equals=function(c,f){var y=c[0],b=c[1],S=c[2],_=c[3],w=f[0],M=f[1],T=f[2],E=f[3];return Math.abs(y-w)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(w))&&Math.abs(b-M)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(M))&&Math.abs(S-T)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(T))&&Math.abs(_-E)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(E))},he.multiplyScalar=function(c,f,y){return c[0]=f[0]*y,c[1]=f[1]*y,c[2]=f[2]*y,c[3]=f[3]*y,c},he.multiplyScalarAndAdd=function(c,f,y,b){return c[0]=f[0]+y[0]*b,c[1]=f[1]+y[1]*b,c[2]=f[2]+y[2]*b,c[3]=f[3]+y[3]*b,c},he.sub=he.mul=void 0;var e=function(c,f){if(c&&c.__esModule)return c;if(c===null||o(c)!=="object"&&typeof c!="function")return{default:c};var y=r(void 0);if(y&&y.has(c))return y.get(c);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var w=S?Object.getOwnPropertyDescriptor(c,_):null;w&&(w.get||w.set)?Object.defineProperty(b,_,w):b[_]=c[_]}return b.default=c,y&&y.set(c,b),b}(ne());function r(c){if(typeof WeakMap!="function")return null;var f=new WeakMap,y=new WeakMap;return(r=function(b){return b?y:f})(c)}function a(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=y[0],T=y[1],E=y[2],C=y[3];return c[0]=b*M+_*T,c[1]=S*M+w*T,c[2]=b*E+_*C,c[3]=S*E+w*C,c}function u(c,f,y){return c[0]=f[0]-y[0],c[1]=f[1]-y[1],c[2]=f[2]-y[2],c[3]=f[3]-y[3],c}return he.mul=a,he.sub=u,he}var Le,je={};function xt(){if(Le)return je;function o(c){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},o(c)}Le=1,Object.defineProperty(je,"__esModule",{value:!0}),je.create=function(){var c=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0,c[4]=0,c[5]=0),c[0]=1,c[3]=1,c},je.clone=function(c){var f=new e.ARRAY_TYPE(6);return f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f[4]=c[4],f[5]=c[5],f},je.copy=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c},je.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=0,c[5]=0,c},je.fromValues=function(c,f,y,b,S,_){var w=new e.ARRAY_TYPE(6);return w[0]=c,w[1]=f,w[2]=y,w[3]=b,w[4]=S,w[5]=_,w},je.set=function(c,f,y,b,S,_,w){return c[0]=f,c[1]=y,c[2]=b,c[3]=S,c[4]=_,c[5]=w,c},je.invert=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],M=f[5],T=y*_-b*S;return T?(c[0]=_*(T=1/T),c[1]=-b*T,c[2]=-S*T,c[3]=y*T,c[4]=(S*M-_*w)*T,c[5]=(b*w-y*M)*T,c):null},je.determinant=function(c){return c[0]*c[3]-c[1]*c[2]},je.multiply=a,je.rotate=function(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=Math.sin(y),C=Math.cos(y);return c[0]=b*C+_*E,c[1]=S*C+w*E,c[2]=b*-E+_*C,c[3]=S*-E+w*C,c[4]=M,c[5]=T,c},je.scale=function(c,f,y){var b=f[1],S=f[2],_=f[3],w=f[4],M=f[5],T=y[0],E=y[1];return c[0]=f[0]*T,c[1]=b*T,c[2]=S*E,c[3]=_*E,c[4]=w,c[5]=M,c},je.translate=function(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=y[0],C=y[1];return c[0]=b,c[1]=S,c[2]=_,c[3]=w,c[4]=b*E+_*C+M,c[5]=S*E+w*C+T,c},je.fromRotation=function(c,f){var y=Math.sin(f),b=Math.cos(f);return c[0]=b,c[1]=y,c[2]=-y,c[3]=b,c[4]=0,c[5]=0,c},je.fromScaling=function(c,f){return c[0]=f[0],c[1]=0,c[2]=0,c[3]=f[1],c[4]=0,c[5]=0,c},je.fromTranslation=function(c,f){return c[0]=1,c[1]=0,c[2]=0,c[3]=1,c[4]=f[0],c[5]=f[1],c},je.str=function(c){return"mat2d("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+")"},je.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3],c[4],c[5],1)},je.add=function(c,f,y){return c[0]=f[0]+y[0],c[1]=f[1]+y[1],c[2]=f[2]+y[2],c[3]=f[3]+y[3],c[4]=f[4]+y[4],c[5]=f[5]+y[5],c},je.subtract=u,je.multiplyScalar=function(c,f,y){return c[0]=f[0]*y,c[1]=f[1]*y,c[2]=f[2]*y,c[3]=f[3]*y,c[4]=f[4]*y,c[5]=f[5]*y,c},je.multiplyScalarAndAdd=function(c,f,y,b){return c[0]=f[0]+y[0]*b,c[1]=f[1]+y[1]*b,c[2]=f[2]+y[2]*b,c[3]=f[3]+y[3]*b,c[4]=f[4]+y[4]*b,c[5]=f[5]+y[5]*b,c},je.exactEquals=function(c,f){return c[0]===f[0]&&c[1]===f[1]&&c[2]===f[2]&&c[3]===f[3]&&c[4]===f[4]&&c[5]===f[5]},je.equals=function(c,f){var y=c[0],b=c[1],S=c[2],_=c[3],w=c[4],M=c[5],T=f[0],E=f[1],C=f[2],O=f[3],k=f[4],U=f[5];return Math.abs(y-T)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(T))&&Math.abs(b-E)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(S-C)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(C))&&Math.abs(_-O)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(O))&&Math.abs(w-k)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(k))&&Math.abs(M-U)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(U))},je.sub=je.mul=void 0;var e=function(c,f){if(c&&c.__esModule)return c;if(c===null||o(c)!=="object"&&typeof c!="function")return{default:c};var y=r(void 0);if(y&&y.has(c))return y.get(c);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var w=S?Object.getOwnPropertyDescriptor(c,_):null;w&&(w.get||w.set)?Object.defineProperty(b,_,w):b[_]=c[_]}return b.default=c,y&&y.set(c,b),b}(ne());function r(c){if(typeof WeakMap!="function")return null;var f=new WeakMap,y=new WeakMap;return(r=function(b){return b?y:f})(c)}function a(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=y[0],C=y[1],O=y[2],k=y[3],U=y[4],V=y[5];return c[0]=b*E+_*C,c[1]=S*E+w*C,c[2]=b*O+_*k,c[3]=S*O+w*k,c[4]=b*U+_*V+M,c[5]=S*U+w*V+T,c}function u(c,f,y){return c[0]=f[0]-y[0],c[1]=f[1]-y[1],c[2]=f[2]-y[2],c[3]=f[3]-y[3],c[4]=f[4]-y[4],c[5]=f[5]-y[5],c}return je.mul=a,je.sub=u,je}var Dt,ut={};function ht(){if(Dt)return ut;function o(c){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},o(c)}Dt=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.create=function(){var c=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[5]=0,c[6]=0,c[7]=0),c[0]=1,c[4]=1,c[8]=1,c},ut.fromMat4=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[4],c[4]=f[5],c[5]=f[6],c[6]=f[8],c[7]=f[9],c[8]=f[10],c},ut.clone=function(c){var f=new e.ARRAY_TYPE(9);return f[0]=c[0],f[1]=c[1],f[2]=c[2],f[3]=c[3],f[4]=c[4],f[5]=c[5],f[6]=c[6],f[7]=c[7],f[8]=c[8],f},ut.copy=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=f[2],c[3]=f[3],c[4]=f[4],c[5]=f[5],c[6]=f[6],c[7]=f[7],c[8]=f[8],c},ut.fromValues=function(c,f,y,b,S,_,w,M,T){var E=new e.ARRAY_TYPE(9);return E[0]=c,E[1]=f,E[2]=y,E[3]=b,E[4]=S,E[5]=_,E[6]=w,E[7]=M,E[8]=T,E},ut.set=function(c,f,y,b,S,_,w,M,T,E){return c[0]=f,c[1]=y,c[2]=b,c[3]=S,c[4]=_,c[5]=w,c[6]=M,c[7]=T,c[8]=E,c},ut.identity=function(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=1,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},ut.transpose=function(c,f){if(c===f){var y=f[1],b=f[2],S=f[5];c[1]=f[3],c[2]=f[6],c[3]=y,c[5]=f[7],c[6]=b,c[7]=S}else c[0]=f[0],c[1]=f[3],c[2]=f[6],c[3]=f[1],c[4]=f[4],c[5]=f[7],c[6]=f[2],c[7]=f[5],c[8]=f[8];return c},ut.invert=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],M=f[5],T=f[6],E=f[7],C=f[8],O=C*w-M*E,k=-C*_+M*T,U=E*_-w*T,V=y*O+b*k+S*U;return V?(c[0]=O*(V=1/V),c[1]=(-C*b+S*E)*V,c[2]=(M*b-S*w)*V,c[3]=k*V,c[4]=(C*y-S*T)*V,c[5]=(-M*y+S*_)*V,c[6]=U*V,c[7]=(-E*y+b*T)*V,c[8]=(w*y-b*_)*V,c):null},ut.adjoint=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],M=f[5],T=f[6],E=f[7],C=f[8];return c[0]=w*C-M*E,c[1]=S*E-b*C,c[2]=b*M-S*w,c[3]=M*T-_*C,c[4]=y*C-S*T,c[5]=S*_-y*M,c[6]=_*E-w*T,c[7]=b*T-y*E,c[8]=y*w-b*_,c},ut.determinant=function(c){var f=c[3],y=c[4],b=c[5],S=c[6],_=c[7],w=c[8];return c[0]*(w*y-b*_)+c[1]*(-w*f+b*S)+c[2]*(_*f-y*S)},ut.multiply=a,ut.translate=function(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=f[6],C=f[7],O=f[8],k=y[0],U=y[1];return c[0]=b,c[1]=S,c[2]=_,c[3]=w,c[4]=M,c[5]=T,c[6]=k*b+U*w+E,c[7]=k*S+U*M+C,c[8]=k*_+U*T+O,c},ut.rotate=function(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=f[6],C=f[7],O=f[8],k=Math.sin(y),U=Math.cos(y);return c[0]=U*b+k*w,c[1]=U*S+k*M,c[2]=U*_+k*T,c[3]=U*w-k*b,c[4]=U*M-k*S,c[5]=U*T-k*_,c[6]=E,c[7]=C,c[8]=O,c},ut.scale=function(c,f,y){var b=y[0],S=y[1];return c[0]=b*f[0],c[1]=b*f[1],c[2]=b*f[2],c[3]=S*f[3],c[4]=S*f[4],c[5]=S*f[5],c[6]=f[6],c[7]=f[7],c[8]=f[8],c},ut.fromTranslation=function(c,f){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=1,c[5]=0,c[6]=f[0],c[7]=f[1],c[8]=1,c},ut.fromRotation=function(c,f){var y=Math.sin(f),b=Math.cos(f);return c[0]=b,c[1]=y,c[2]=0,c[3]=-y,c[4]=b,c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},ut.fromScaling=function(c,f){return c[0]=f[0],c[1]=0,c[2]=0,c[3]=0,c[4]=f[1],c[5]=0,c[6]=0,c[7]=0,c[8]=1,c},ut.fromMat2d=function(c,f){return c[0]=f[0],c[1]=f[1],c[2]=0,c[3]=f[2],c[4]=f[3],c[5]=0,c[6]=f[4],c[7]=f[5],c[8]=1,c},ut.fromQuat=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=y+y,M=b+b,T=S+S,E=y*w,C=b*w,O=b*M,k=S*w,U=S*M,V=S*T,N=_*w,$=_*M,Z=_*T;return c[0]=1-O-V,c[3]=C-Z,c[6]=k+$,c[1]=C+Z,c[4]=1-E-V,c[7]=U-N,c[2]=k-$,c[5]=U+N,c[8]=1-E-O,c},ut.normalFromMat4=function(c,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],M=f[5],T=f[6],E=f[7],C=f[8],O=f[9],k=f[10],U=f[11],V=f[12],N=f[13],$=f[14],Z=f[15],K=y*M-b*w,ae=y*T-S*w,ie=y*E-_*w,se=b*T-S*M,ve=b*E-_*M,le=S*E-_*T,xe=C*N-O*V,Me=C*$-k*V,Se=C*Z-U*V,Ce=O*$-k*N,Ie=O*Z-U*N,Fe=k*Z-U*$,ze=K*Fe-ae*Ie+ie*Ce+se*Se-ve*Me+le*xe;return ze?(c[0]=(M*Fe-T*Ie+E*Ce)*(ze=1/ze),c[1]=(T*Se-w*Fe-E*Me)*ze,c[2]=(w*Ie-M*Se+E*xe)*ze,c[3]=(S*Ie-b*Fe-_*Ce)*ze,c[4]=(y*Fe-S*Se+_*Me)*ze,c[5]=(b*Se-y*Ie-_*xe)*ze,c[6]=(N*le-$*ve+Z*se)*ze,c[7]=($*ie-V*le-Z*ae)*ze,c[8]=(V*ve-N*ie+Z*K)*ze,c):null},ut.projection=function(c,f,y){return c[0]=2/f,c[1]=0,c[2]=0,c[3]=0,c[4]=-2/y,c[5]=0,c[6]=-1,c[7]=1,c[8]=1,c},ut.str=function(c){return"mat3("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+")"},ut.frob=function(c){return Math.hypot(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8])},ut.add=function(c,f,y){return c[0]=f[0]+y[0],c[1]=f[1]+y[1],c[2]=f[2]+y[2],c[3]=f[3]+y[3],c[4]=f[4]+y[4],c[5]=f[5]+y[5],c[6]=f[6]+y[6],c[7]=f[7]+y[7],c[8]=f[8]+y[8],c},ut.subtract=u,ut.multiplyScalar=function(c,f,y){return c[0]=f[0]*y,c[1]=f[1]*y,c[2]=f[2]*y,c[3]=f[3]*y,c[4]=f[4]*y,c[5]=f[5]*y,c[6]=f[6]*y,c[7]=f[7]*y,c[8]=f[8]*y,c},ut.multiplyScalarAndAdd=function(c,f,y,b){return c[0]=f[0]+y[0]*b,c[1]=f[1]+y[1]*b,c[2]=f[2]+y[2]*b,c[3]=f[3]+y[3]*b,c[4]=f[4]+y[4]*b,c[5]=f[5]+y[5]*b,c[6]=f[6]+y[6]*b,c[7]=f[7]+y[7]*b,c[8]=f[8]+y[8]*b,c},ut.exactEquals=function(c,f){return c[0]===f[0]&&c[1]===f[1]&&c[2]===f[2]&&c[3]===f[3]&&c[4]===f[4]&&c[5]===f[5]&&c[6]===f[6]&&c[7]===f[7]&&c[8]===f[8]},ut.equals=function(c,f){var y=c[0],b=c[1],S=c[2],_=c[3],w=c[4],M=c[5],T=c[6],E=c[7],C=c[8],O=f[0],k=f[1],U=f[2],V=f[3],N=f[4],$=f[5],Z=f[6],K=f[7],ae=f[8];return Math.abs(y-O)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(O))&&Math.abs(b-k)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(k))&&Math.abs(S-U)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(_-V)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(w-N)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(N))&&Math.abs(M-$)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs($))&&Math.abs(T-Z)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(Z))&&Math.abs(E-K)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(K))&&Math.abs(C-ae)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(ae))},ut.sub=ut.mul=void 0;var e=function(c,f){if(c&&c.__esModule)return c;if(c===null||o(c)!=="object"&&typeof c!="function")return{default:c};var y=r(void 0);if(y&&y.has(c))return y.get(c);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in c)if(_!=="default"&&Object.prototype.hasOwnProperty.call(c,_)){var w=S?Object.getOwnPropertyDescriptor(c,_):null;w&&(w.get||w.set)?Object.defineProperty(b,_,w):b[_]=c[_]}return b.default=c,y&&y.set(c,b),b}(ne());function r(c){if(typeof WeakMap!="function")return null;var f=new WeakMap,y=new WeakMap;return(r=function(b){return b?y:f})(c)}function a(c,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],M=f[4],T=f[5],E=f[6],C=f[7],O=f[8],k=y[0],U=y[1],V=y[2],N=y[3],$=y[4],Z=y[5],K=y[6],ae=y[7],ie=y[8];return c[0]=k*b+U*w+V*E,c[1]=k*S+U*M+V*C,c[2]=k*_+U*T+V*O,c[3]=N*b+$*w+Z*E,c[4]=N*S+$*M+Z*C,c[5]=N*_+$*T+Z*O,c[6]=K*b+ae*w+ie*E,c[7]=K*S+ae*M+ie*C,c[8]=K*_+ae*T+ie*O,c}function u(c,f,y){return c[0]=f[0]-y[0],c[1]=f[1]-y[1],c[2]=f[2]-y[2],c[3]=f[3]-y[3],c[4]=f[4]-y[4],c[5]=f[5]-y[5],c[6]=f[6]-y[6],c[7]=f[7]-y[7],c[8]=f[8]-y[8],c}return ut.mul=a,ut.sub=u,ut}var Et,tt={};function At(){if(Et)return tt;function o(_){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},o(_)}Et=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.create=function(){var _=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},tt.clone=function(_){var w=new e.ARRAY_TYPE(16);return w[0]=_[0],w[1]=_[1],w[2]=_[2],w[3]=_[3],w[4]=_[4],w[5]=_[5],w[6]=_[6],w[7]=_[7],w[8]=_[8],w[9]=_[9],w[10]=_[10],w[11]=_[11],w[12]=_[12],w[13]=_[13],w[14]=_[14],w[15]=_[15],w},tt.copy=function(_,w){return _[0]=w[0],_[1]=w[1],_[2]=w[2],_[3]=w[3],_[4]=w[4],_[5]=w[5],_[6]=w[6],_[7]=w[7],_[8]=w[8],_[9]=w[9],_[10]=w[10],_[11]=w[11],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15],_},tt.fromValues=function(_,w,M,T,E,C,O,k,U,V,N,$,Z,K,ae,ie){var se=new e.ARRAY_TYPE(16);return se[0]=_,se[1]=w,se[2]=M,se[3]=T,se[4]=E,se[5]=C,se[6]=O,se[7]=k,se[8]=U,se[9]=V,se[10]=N,se[11]=$,se[12]=Z,se[13]=K,se[14]=ae,se[15]=ie,se},tt.set=function(_,w,M,T,E,C,O,k,U,V,N,$,Z,K,ae,ie,se){return _[0]=w,_[1]=M,_[2]=T,_[3]=E,_[4]=C,_[5]=O,_[6]=k,_[7]=U,_[8]=V,_[9]=N,_[10]=$,_[11]=Z,_[12]=K,_[13]=ae,_[14]=ie,_[15]=se,_},tt.identity=a,tt.transpose=function(_,w){if(_===w){var M=w[1],T=w[2],E=w[3],C=w[6],O=w[7],k=w[11];_[1]=w[4],_[2]=w[8],_[3]=w[12],_[4]=M,_[6]=w[9],_[7]=w[13],_[8]=T,_[9]=C,_[11]=w[14],_[12]=E,_[13]=O,_[14]=k}else _[0]=w[0],_[1]=w[4],_[2]=w[8],_[3]=w[12],_[4]=w[1],_[5]=w[5],_[6]=w[9],_[7]=w[13],_[8]=w[2],_[9]=w[6],_[10]=w[10],_[11]=w[14],_[12]=w[3],_[13]=w[7],_[14]=w[11],_[15]=w[15];return _},tt.invert=function(_,w){var M=w[0],T=w[1],E=w[2],C=w[3],O=w[4],k=w[5],U=w[6],V=w[7],N=w[8],$=w[9],Z=w[10],K=w[11],ae=w[12],ie=w[13],se=w[14],ve=w[15],le=M*k-T*O,xe=M*U-E*O,Me=M*V-C*O,Se=T*U-E*k,Ce=T*V-C*k,Ie=E*V-C*U,Fe=N*ie-$*ae,ze=N*se-Z*ae,Ne=N*ve-K*ae,st=$*se-Z*ie,nt=$*ve-K*ie,Bt=Z*ve-K*se,ft=le*Bt-xe*nt+Me*st+Se*Ne-Ce*ze+Ie*Fe;return ft?(_[0]=(k*Bt-U*nt+V*st)*(ft=1/ft),_[1]=(E*nt-T*Bt-C*st)*ft,_[2]=(ie*Ie-se*Ce+ve*Se)*ft,_[3]=(Z*Ce-$*Ie-K*Se)*ft,_[4]=(U*Ne-O*Bt-V*ze)*ft,_[5]=(M*Bt-E*Ne+C*ze)*ft,_[6]=(se*Me-ae*Ie-ve*xe)*ft,_[7]=(N*Ie-Z*Me+K*xe)*ft,_[8]=(O*nt-k*Ne+V*Fe)*ft,_[9]=(T*Ne-M*nt-C*Fe)*ft,_[10]=(ae*Ce-ie*Me+ve*le)*ft,_[11]=($*Me-N*Ce-K*le)*ft,_[12]=(k*ze-O*st-U*Fe)*ft,_[13]=(M*st-T*ze+E*Fe)*ft,_[14]=(ie*xe-ae*Se-se*le)*ft,_[15]=(N*Se-$*xe+Z*le)*ft,_):null},tt.adjoint=function(_,w){var M=w[0],T=w[1],E=w[2],C=w[3],O=w[4],k=w[5],U=w[6],V=w[7],N=w[8],$=w[9],Z=w[10],K=w[11],ae=w[12],ie=w[13],se=w[14],ve=w[15];return _[0]=k*(Z*ve-K*se)-$*(U*ve-V*se)+ie*(U*K-V*Z),_[1]=-(T*(Z*ve-K*se)-$*(E*ve-C*se)+ie*(E*K-C*Z)),_[2]=T*(U*ve-V*se)-k*(E*ve-C*se)+ie*(E*V-C*U),_[3]=-(T*(U*K-V*Z)-k*(E*K-C*Z)+$*(E*V-C*U)),_[4]=-(O*(Z*ve-K*se)-N*(U*ve-V*se)+ae*(U*K-V*Z)),_[5]=M*(Z*ve-K*se)-N*(E*ve-C*se)+ae*(E*K-C*Z),_[6]=-(M*(U*ve-V*se)-O*(E*ve-C*se)+ae*(E*V-C*U)),_[7]=M*(U*K-V*Z)-O*(E*K-C*Z)+N*(E*V-C*U),_[8]=O*($*ve-K*ie)-N*(k*ve-V*ie)+ae*(k*K-V*$),_[9]=-(M*($*ve-K*ie)-N*(T*ve-C*ie)+ae*(T*K-C*$)),_[10]=M*(k*ve-V*ie)-O*(T*ve-C*ie)+ae*(T*V-C*k),_[11]=-(M*(k*K-V*$)-O*(T*K-C*$)+N*(T*V-C*k)),_[12]=-(O*($*se-Z*ie)-N*(k*se-U*ie)+ae*(k*Z-U*$)),_[13]=M*($*se-Z*ie)-N*(T*se-E*ie)+ae*(T*Z-E*$),_[14]=-(M*(k*se-U*ie)-O*(T*se-E*ie)+ae*(T*U-E*k)),_[15]=M*(k*Z-U*$)-O*(T*Z-E*$)+N*(T*U-E*k),_},tt.determinant=function(_){var w=_[0],M=_[1],T=_[2],E=_[3],C=_[4],O=_[5],k=_[6],U=_[7],V=_[8],N=_[9],$=_[10],Z=_[11],K=_[12],ae=_[13],ie=_[14],se=_[15];return(w*O-M*C)*($*se-Z*ie)-(w*k-T*C)*(N*se-Z*ae)+(w*U-E*C)*(N*ie-$*ae)+(M*k-T*O)*(V*se-Z*K)-(M*U-E*O)*(V*ie-$*K)+(T*U-E*k)*(V*ae-N*K)},tt.multiply=u,tt.translate=function(_,w,M){var T,E,C,O,k,U,V,N,$,Z,K,ae,ie=M[0],se=M[1],ve=M[2];return w===_?(_[12]=w[0]*ie+w[4]*se+w[8]*ve+w[12],_[13]=w[1]*ie+w[5]*se+w[9]*ve+w[13],_[14]=w[2]*ie+w[6]*se+w[10]*ve+w[14],_[15]=w[3]*ie+w[7]*se+w[11]*ve+w[15]):(E=w[1],C=w[2],O=w[3],k=w[4],U=w[5],V=w[6],N=w[7],$=w[8],Z=w[9],K=w[10],ae=w[11],_[0]=T=w[0],_[1]=E,_[2]=C,_[3]=O,_[4]=k,_[5]=U,_[6]=V,_[7]=N,_[8]=$,_[9]=Z,_[10]=K,_[11]=ae,_[12]=T*ie+k*se+$*ve+w[12],_[13]=E*ie+U*se+Z*ve+w[13],_[14]=C*ie+V*se+K*ve+w[14],_[15]=O*ie+N*se+ae*ve+w[15]),_},tt.scale=function(_,w,M){var T=M[0],E=M[1],C=M[2];return _[0]=w[0]*T,_[1]=w[1]*T,_[2]=w[2]*T,_[3]=w[3]*T,_[4]=w[4]*E,_[5]=w[5]*E,_[6]=w[6]*E,_[7]=w[7]*E,_[8]=w[8]*C,_[9]=w[9]*C,_[10]=w[10]*C,_[11]=w[11]*C,_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15],_},tt.rotate=function(_,w,M,T){var E,C,O,k,U,V,N,$,Z,K,ae,ie,se,ve,le,xe,Me,Se,Ce,Ie,Fe,ze,Ne,st,nt=T[0],Bt=T[1],ft=T[2],St=Math.hypot(nt,Bt,ft);return St<e.EPSILON?null:(nt*=St=1/St,Bt*=St,ft*=St,E=Math.sin(M),C=Math.cos(M),U=w[1],V=w[2],N=w[3],Z=w[5],K=w[6],ae=w[7],se=w[9],ve=w[10],le=w[11],xe=nt*nt*(O=1-C)+C,Ce=nt*Bt*O-ft*E,Ie=Bt*Bt*O+C,Fe=ft*Bt*O+nt*E,ze=nt*ft*O+Bt*E,Ne=Bt*ft*O-nt*E,st=ft*ft*O+C,_[0]=(k=w[0])*xe+($=w[4])*(Me=Bt*nt*O+ft*E)+(ie=w[8])*(Se=ft*nt*O-Bt*E),_[1]=U*xe+Z*Me+se*Se,_[2]=V*xe+K*Me+ve*Se,_[3]=N*xe+ae*Me+le*Se,_[4]=k*Ce+$*Ie+ie*Fe,_[5]=U*Ce+Z*Ie+se*Fe,_[6]=V*Ce+K*Ie+ve*Fe,_[7]=N*Ce+ae*Ie+le*Fe,_[8]=k*ze+$*Ne+ie*st,_[9]=U*ze+Z*Ne+se*st,_[10]=V*ze+K*Ne+ve*st,_[11]=N*ze+ae*Ne+le*st,w!==_&&(_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_)},tt.rotateX=function(_,w,M){var T=Math.sin(M),E=Math.cos(M),C=w[4],O=w[5],k=w[6],U=w[7],V=w[8],N=w[9],$=w[10],Z=w[11];return w!==_&&(_[0]=w[0],_[1]=w[1],_[2]=w[2],_[3]=w[3],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_[4]=C*E+V*T,_[5]=O*E+N*T,_[6]=k*E+$*T,_[7]=U*E+Z*T,_[8]=V*E-C*T,_[9]=N*E-O*T,_[10]=$*E-k*T,_[11]=Z*E-U*T,_},tt.rotateY=function(_,w,M){var T=Math.sin(M),E=Math.cos(M),C=w[0],O=w[1],k=w[2],U=w[3],V=w[8],N=w[9],$=w[10],Z=w[11];return w!==_&&(_[4]=w[4],_[5]=w[5],_[6]=w[6],_[7]=w[7],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_[0]=C*E-V*T,_[1]=O*E-N*T,_[2]=k*E-$*T,_[3]=U*E-Z*T,_[8]=C*T+V*E,_[9]=O*T+N*E,_[10]=k*T+$*E,_[11]=U*T+Z*E,_},tt.rotateZ=function(_,w,M){var T=Math.sin(M),E=Math.cos(M),C=w[0],O=w[1],k=w[2],U=w[3],V=w[4],N=w[5],$=w[6],Z=w[7];return w!==_&&(_[8]=w[8],_[9]=w[9],_[10]=w[10],_[11]=w[11],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_[0]=C*E+V*T,_[1]=O*E+N*T,_[2]=k*E+$*T,_[3]=U*E+Z*T,_[4]=V*E-C*T,_[5]=N*E-O*T,_[6]=$*E-k*T,_[7]=Z*E-U*T,_},tt.fromTranslation=function(_,w){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=w[0],_[13]=w[1],_[14]=w[2],_[15]=1,_},tt.fromScaling=function(_,w){return _[0]=w[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=w[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=w[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},tt.fromRotation=function(_,w,M){var T,E,C,O=M[0],k=M[1],U=M[2],V=Math.hypot(O,k,U);return V<e.EPSILON?null:(O*=V=1/V,k*=V,U*=V,T=Math.sin(w),E=Math.cos(w),_[0]=O*O*(C=1-E)+E,_[1]=k*O*C+U*T,_[2]=U*O*C-k*T,_[3]=0,_[4]=O*k*C-U*T,_[5]=k*k*C+E,_[6]=U*k*C+O*T,_[7]=0,_[8]=O*U*C+k*T,_[9]=k*U*C-O*T,_[10]=U*U*C+E,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)},tt.fromXRotation=function(_,w){var M=Math.sin(w),T=Math.cos(w);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=T,_[6]=M,_[7]=0,_[8]=0,_[9]=-M,_[10]=T,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},tt.fromYRotation=function(_,w){var M=Math.sin(w),T=Math.cos(w);return _[0]=T,_[1]=0,_[2]=-M,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=M,_[9]=0,_[10]=T,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},tt.fromZRotation=function(_,w){var M=Math.sin(w),T=Math.cos(w);return _[0]=T,_[1]=M,_[2]=0,_[3]=0,_[4]=-M,_[5]=T,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},tt.fromRotationTranslation=c,tt.fromQuat2=function(_,w){var M=new e.ARRAY_TYPE(3),T=-w[0],E=-w[1],C=-w[2],O=w[3],k=w[4],U=w[5],V=w[6],N=w[7],$=T*T+E*E+C*C+O*O;return $>0?(M[0]=2*(k*O+N*T+U*C-V*E)/$,M[1]=2*(U*O+N*E+V*T-k*C)/$,M[2]=2*(V*O+N*C+k*E-U*T)/$):(M[0]=2*(k*O+N*T+U*C-V*E),M[1]=2*(U*O+N*E+V*T-k*C),M[2]=2*(V*O+N*C+k*E-U*T)),c(_,w,M),_},tt.getTranslation=function(_,w){return _[0]=w[12],_[1]=w[13],_[2]=w[14],_},tt.getScaling=f,tt.getRotation=function(_,w){var M=new e.ARRAY_TYPE(3);f(M,w);var T=1/M[0],E=1/M[1],C=1/M[2],O=w[0]*T,k=w[1]*E,U=w[2]*C,V=w[4]*T,N=w[5]*E,$=w[6]*C,Z=w[8]*T,K=w[9]*E,ae=w[10]*C,ie=O+N+ae,se=0;return ie>0?(se=2*Math.sqrt(ie+1),_[3]=.25*se,_[0]=($-K)/se,_[1]=(Z-U)/se,_[2]=(k-V)/se):O>N&&O>ae?(se=2*Math.sqrt(1+O-N-ae),_[3]=($-K)/se,_[0]=.25*se,_[1]=(k+V)/se,_[2]=(Z+U)/se):N>ae?(se=2*Math.sqrt(1+N-O-ae),_[3]=(Z-U)/se,_[0]=(k+V)/se,_[1]=.25*se,_[2]=($+K)/se):(se=2*Math.sqrt(1+ae-O-N),_[3]=(k-V)/se,_[0]=(Z+U)/se,_[1]=($+K)/se,_[2]=.25*se),_},tt.fromRotationTranslationScale=function(_,w,M,T){var E=w[0],C=w[1],O=w[2],k=w[3],U=E+E,V=C+C,N=O+O,$=E*U,Z=E*V,K=E*N,ae=C*V,ie=C*N,se=O*N,ve=k*U,le=k*V,xe=k*N,Me=T[0],Se=T[1],Ce=T[2];return _[0]=(1-(ae+se))*Me,_[1]=(Z+xe)*Me,_[2]=(K-le)*Me,_[3]=0,_[4]=(Z-xe)*Se,_[5]=(1-($+se))*Se,_[6]=(ie+ve)*Se,_[7]=0,_[8]=(K+le)*Ce,_[9]=(ie-ve)*Ce,_[10]=(1-($+ae))*Ce,_[11]=0,_[12]=M[0],_[13]=M[1],_[14]=M[2],_[15]=1,_},tt.fromRotationTranslationScaleOrigin=function(_,w,M,T,E){var C=w[0],O=w[1],k=w[2],U=w[3],V=C+C,N=O+O,$=k+k,Z=C*V,K=C*N,ae=C*$,ie=O*N,se=O*$,ve=k*$,le=U*V,xe=U*N,Me=U*$,Se=T[0],Ce=T[1],Ie=T[2],Fe=E[0],ze=E[1],Ne=E[2],st=(1-(ie+ve))*Se,nt=(K+Me)*Se,Bt=(ae-xe)*Se,ft=(K-Me)*Ce,St=(1-(Z+ve))*Ce,lt=(se+le)*Ce,tr=(ae+xe)*Ie,Ot=(se-le)*Ie,qt=(1-(Z+ie))*Ie;return _[0]=st,_[1]=nt,_[2]=Bt,_[3]=0,_[4]=ft,_[5]=St,_[6]=lt,_[7]=0,_[8]=tr,_[9]=Ot,_[10]=qt,_[11]=0,_[12]=M[0]+Fe-(st*Fe+ft*ze+tr*Ne),_[13]=M[1]+ze-(nt*Fe+St*ze+Ot*Ne),_[14]=M[2]+Ne-(Bt*Fe+lt*ze+qt*Ne),_[15]=1,_},tt.fromQuat=function(_,w){var M=w[0],T=w[1],E=w[2],C=w[3],O=M+M,k=T+T,U=E+E,V=M*O,N=T*O,$=T*k,Z=E*O,K=E*k,ae=E*U,ie=C*O,se=C*k,ve=C*U;return _[0]=1-$-ae,_[1]=N+ve,_[2]=Z-se,_[3]=0,_[4]=N-ve,_[5]=1-V-ae,_[6]=K+ie,_[7]=0,_[8]=Z+se,_[9]=K-ie,_[10]=1-V-$,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},tt.frustum=function(_,w,M,T,E,C,O){var k=1/(M-w),U=1/(E-T),V=1/(C-O);return _[0]=2*C*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*C*U,_[6]=0,_[7]=0,_[8]=(M+w)*k,_[9]=(E+T)*U,_[10]=(O+C)*V,_[11]=-1,_[12]=0,_[13]=0,_[14]=O*C*2*V,_[15]=0,_},tt.perspectiveNO=y,tt.perspectiveZO=function(_,w,M,T,E){var C,O=1/Math.tan(w/2);return _[0]=O/M,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=O,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,E!=null&&E!==1/0?(_[10]=E*(C=1/(T-E)),_[14]=E*T*C):(_[10]=-1,_[14]=-T),_},tt.perspectiveFromFieldOfView=function(_,w,M,T){var E=Math.tan(w.upDegrees*Math.PI/180),C=Math.tan(w.downDegrees*Math.PI/180),O=Math.tan(w.leftDegrees*Math.PI/180),k=Math.tan(w.rightDegrees*Math.PI/180),U=2/(O+k),V=2/(E+C);return _[0]=U,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=V,_[6]=0,_[7]=0,_[8]=-(O-k)*U*.5,_[9]=(E-C)*V*.5,_[10]=T/(M-T),_[11]=-1,_[12]=0,_[13]=0,_[14]=T*M/(M-T),_[15]=0,_},tt.orthoNO=b,tt.orthoZO=function(_,w,M,T,E,C,O){var k=1/(w-M),U=1/(T-E),V=1/(C-O);return _[0]=-2*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*U,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=V,_[11]=0,_[12]=(w+M)*k,_[13]=(E+T)*U,_[14]=C*V,_[15]=1,_},tt.lookAt=function(_,w,M,T){var E,C,O,k,U,V,N,$,Z,K,ae=w[0],ie=w[1],se=w[2],ve=T[0],le=T[1],xe=T[2],Me=M[0],Se=M[1],Ce=M[2];return Math.abs(ae-Me)<e.EPSILON&&Math.abs(ie-Se)<e.EPSILON&&Math.abs(se-Ce)<e.EPSILON?a(_):(N=ae-Me,$=ie-Se,Z=se-Ce,E=le*(Z*=K=1/Math.hypot(N,$,Z))-xe*($*=K),C=xe*(N*=K)-ve*Z,O=ve*$-le*N,(K=Math.hypot(E,C,O))?(E*=K=1/K,C*=K,O*=K):(E=0,C=0,O=0),k=$*O-Z*C,U=Z*E-N*O,V=N*C-$*E,(K=Math.hypot(k,U,V))?(k*=K=1/K,U*=K,V*=K):(k=0,U=0,V=0),_[0]=E,_[1]=k,_[2]=N,_[3]=0,_[4]=C,_[5]=U,_[6]=$,_[7]=0,_[8]=O,_[9]=V,_[10]=Z,_[11]=0,_[12]=-(E*ae+C*ie+O*se),_[13]=-(k*ae+U*ie+V*se),_[14]=-(N*ae+$*ie+Z*se),_[15]=1,_)},tt.targetTo=function(_,w,M,T){var E=w[0],C=w[1],O=w[2],k=T[0],U=T[1],V=T[2],N=E-M[0],$=C-M[1],Z=O-M[2],K=N*N+$*$+Z*Z;K>0&&(N*=K=1/Math.sqrt(K),$*=K,Z*=K);var ae=U*Z-V*$,ie=V*N-k*Z,se=k*$-U*N;return(K=ae*ae+ie*ie+se*se)>0&&(ae*=K=1/Math.sqrt(K),ie*=K,se*=K),_[0]=ae,_[1]=ie,_[2]=se,_[3]=0,_[4]=$*se-Z*ie,_[5]=Z*ae-N*se,_[6]=N*ie-$*ae,_[7]=0,_[8]=N,_[9]=$,_[10]=Z,_[11]=0,_[12]=E,_[13]=C,_[14]=O,_[15]=1,_},tt.str=function(_){return"mat4("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+", "+_[4]+", "+_[5]+", "+_[6]+", "+_[7]+", "+_[8]+", "+_[9]+", "+_[10]+", "+_[11]+", "+_[12]+", "+_[13]+", "+_[14]+", "+_[15]+")"},tt.frob=function(_){return Math.hypot(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])},tt.add=function(_,w,M){return _[0]=w[0]+M[0],_[1]=w[1]+M[1],_[2]=w[2]+M[2],_[3]=w[3]+M[3],_[4]=w[4]+M[4],_[5]=w[5]+M[5],_[6]=w[6]+M[6],_[7]=w[7]+M[7],_[8]=w[8]+M[8],_[9]=w[9]+M[9],_[10]=w[10]+M[10],_[11]=w[11]+M[11],_[12]=w[12]+M[12],_[13]=w[13]+M[13],_[14]=w[14]+M[14],_[15]=w[15]+M[15],_},tt.subtract=S,tt.multiplyScalar=function(_,w,M){return _[0]=w[0]*M,_[1]=w[1]*M,_[2]=w[2]*M,_[3]=w[3]*M,_[4]=w[4]*M,_[5]=w[5]*M,_[6]=w[6]*M,_[7]=w[7]*M,_[8]=w[8]*M,_[9]=w[9]*M,_[10]=w[10]*M,_[11]=w[11]*M,_[12]=w[12]*M,_[13]=w[13]*M,_[14]=w[14]*M,_[15]=w[15]*M,_},tt.multiplyScalarAndAdd=function(_,w,M,T){return _[0]=w[0]+M[0]*T,_[1]=w[1]+M[1]*T,_[2]=w[2]+M[2]*T,_[3]=w[3]+M[3]*T,_[4]=w[4]+M[4]*T,_[5]=w[5]+M[5]*T,_[6]=w[6]+M[6]*T,_[7]=w[7]+M[7]*T,_[8]=w[8]+M[8]*T,_[9]=w[9]+M[9]*T,_[10]=w[10]+M[10]*T,_[11]=w[11]+M[11]*T,_[12]=w[12]+M[12]*T,_[13]=w[13]+M[13]*T,_[14]=w[14]+M[14]*T,_[15]=w[15]+M[15]*T,_},tt.exactEquals=function(_,w){return _[0]===w[0]&&_[1]===w[1]&&_[2]===w[2]&&_[3]===w[3]&&_[4]===w[4]&&_[5]===w[5]&&_[6]===w[6]&&_[7]===w[7]&&_[8]===w[8]&&_[9]===w[9]&&_[10]===w[10]&&_[11]===w[11]&&_[12]===w[12]&&_[13]===w[13]&&_[14]===w[14]&&_[15]===w[15]},tt.equals=function(_,w){var M=_[0],T=_[1],E=_[2],C=_[3],O=_[4],k=_[5],U=_[6],V=_[7],N=_[8],$=_[9],Z=_[10],K=_[11],ae=_[12],ie=_[13],se=_[14],ve=_[15],le=w[0],xe=w[1],Me=w[2],Se=w[3],Ce=w[4],Ie=w[5],Fe=w[6],ze=w[7],Ne=w[8],st=w[9],nt=w[10],Bt=w[11],ft=w[12],St=w[13],lt=w[14],tr=w[15];return Math.abs(M-le)<=e.EPSILON*Math.max(1,Math.abs(M),Math.abs(le))&&Math.abs(T-xe)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(xe))&&Math.abs(E-Me)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Me))&&Math.abs(C-Se)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(Se))&&Math.abs(O-Ce)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(Ce))&&Math.abs(k-Ie)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ie))&&Math.abs(U-Fe)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(Fe))&&Math.abs(V-ze)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(ze))&&Math.abs(N-Ne)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(Ne))&&Math.abs($-st)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(st))&&Math.abs(Z-nt)<=e.EPSILON*Math.max(1,Math.abs(Z),Math.abs(nt))&&Math.abs(K-Bt)<=e.EPSILON*Math.max(1,Math.abs(K),Math.abs(Bt))&&Math.abs(ae-ft)<=e.EPSILON*Math.max(1,Math.abs(ae),Math.abs(ft))&&Math.abs(ie-St)<=e.EPSILON*Math.max(1,Math.abs(ie),Math.abs(St))&&Math.abs(se-lt)<=e.EPSILON*Math.max(1,Math.abs(se),Math.abs(lt))&&Math.abs(ve-tr)<=e.EPSILON*Math.max(1,Math.abs(ve),Math.abs(tr))},tt.sub=tt.mul=tt.ortho=tt.perspective=void 0;var e=function(_,w){if(_&&_.__esModule)return _;if(_===null||o(_)!=="object"&&typeof _!="function")return{default:_};var M=r(void 0);if(M&&M.has(_))return M.get(_);var T={},E=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var C in _)if(C!=="default"&&Object.prototype.hasOwnProperty.call(_,C)){var O=E?Object.getOwnPropertyDescriptor(_,C):null;O&&(O.get||O.set)?Object.defineProperty(T,C,O):T[C]=_[C]}return T.default=_,M&&M.set(_,T),T}(ne());function r(_){if(typeof WeakMap!="function")return null;var w=new WeakMap,M=new WeakMap;return(r=function(T){return T?M:w})(_)}function a(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function u(_,w,M){var T=w[0],E=w[1],C=w[2],O=w[3],k=w[4],U=w[5],V=w[6],N=w[7],$=w[8],Z=w[9],K=w[10],ae=w[11],ie=w[12],se=w[13],ve=w[14],le=w[15],xe=M[0],Me=M[1],Se=M[2],Ce=M[3];return _[0]=xe*T+Me*k+Se*$+Ce*ie,_[1]=xe*E+Me*U+Se*Z+Ce*se,_[2]=xe*C+Me*V+Se*K+Ce*ve,_[3]=xe*O+Me*N+Se*ae+Ce*le,_[4]=(xe=M[4])*T+(Me=M[5])*k+(Se=M[6])*$+(Ce=M[7])*ie,_[5]=xe*E+Me*U+Se*Z+Ce*se,_[6]=xe*C+Me*V+Se*K+Ce*ve,_[7]=xe*O+Me*N+Se*ae+Ce*le,_[8]=(xe=M[8])*T+(Me=M[9])*k+(Se=M[10])*$+(Ce=M[11])*ie,_[9]=xe*E+Me*U+Se*Z+Ce*se,_[10]=xe*C+Me*V+Se*K+Ce*ve,_[11]=xe*O+Me*N+Se*ae+Ce*le,_[12]=(xe=M[12])*T+(Me=M[13])*k+(Se=M[14])*$+(Ce=M[15])*ie,_[13]=xe*E+Me*U+Se*Z+Ce*se,_[14]=xe*C+Me*V+Se*K+Ce*ve,_[15]=xe*O+Me*N+Se*ae+Ce*le,_}function c(_,w,M){var T=w[0],E=w[1],C=w[2],O=w[3],k=T+T,U=E+E,V=C+C,N=T*k,$=T*U,Z=T*V,K=E*U,ae=E*V,ie=C*V,se=O*k,ve=O*U,le=O*V;return _[0]=1-(K+ie),_[1]=$+le,_[2]=Z-ve,_[3]=0,_[4]=$-le,_[5]=1-(N+ie),_[6]=ae+se,_[7]=0,_[8]=Z+ve,_[9]=ae-se,_[10]=1-(N+K),_[11]=0,_[12]=M[0],_[13]=M[1],_[14]=M[2],_[15]=1,_}function f(_,w){var M=w[4],T=w[5],E=w[6],C=w[8],O=w[9],k=w[10];return _[0]=Math.hypot(w[0],w[1],w[2]),_[1]=Math.hypot(M,T,E),_[2]=Math.hypot(C,O,k),_}function y(_,w,M,T,E){var C,O=1/Math.tan(w/2);return _[0]=O/M,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=O,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,E!=null&&E!==1/0?(_[10]=(E+T)*(C=1/(T-E)),_[14]=2*E*T*C):(_[10]=-1,_[14]=-2*T),_}function b(_,w,M,T,E,C,O){var k=1/(w-M),U=1/(T-E),V=1/(C-O);return _[0]=-2*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*U,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*V,_[11]=0,_[12]=(w+M)*k,_[13]=(E+T)*U,_[14]=(O+C)*V,_[15]=1,_}function S(_,w,M){return _[0]=w[0]-M[0],_[1]=w[1]-M[1],_[2]=w[2]-M[2],_[3]=w[3]-M[3],_[4]=w[4]-M[4],_[5]=w[5]-M[5],_[6]=w[6]-M[6],_[7]=w[7]-M[7],_[8]=w[8]-M[8],_[9]=w[9]-M[9],_[10]=w[10]-M[10],_[11]=w[11]-M[11],_[12]=w[12]-M[12],_[13]=w[13]-M[13],_[14]=w[14]-M[14],_[15]=w[15]-M[15],_}return tt.perspective=y,tt.ortho=b,tt.mul=u,tt.sub=S,tt}var pt,at={},gt={};function yt(){if(pt)return gt;function o(E){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(E)}pt=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=a,gt.clone=function(E){var C=new e.ARRAY_TYPE(3);return C[0]=E[0],C[1]=E[1],C[2]=E[2],C},gt.length=u,gt.fromValues=function(E,C,O){var k=new e.ARRAY_TYPE(3);return k[0]=E,k[1]=C,k[2]=O,k},gt.copy=function(E,C){return E[0]=C[0],E[1]=C[1],E[2]=C[2],E},gt.set=function(E,C,O,k){return E[0]=C,E[1]=O,E[2]=k,E},gt.add=function(E,C,O){return E[0]=C[0]+O[0],E[1]=C[1]+O[1],E[2]=C[2]+O[2],E},gt.subtract=c,gt.multiply=f,gt.divide=y,gt.ceil=function(E,C){return E[0]=Math.ceil(C[0]),E[1]=Math.ceil(C[1]),E[2]=Math.ceil(C[2]),E},gt.floor=function(E,C){return E[0]=Math.floor(C[0]),E[1]=Math.floor(C[1]),E[2]=Math.floor(C[2]),E},gt.min=function(E,C,O){return E[0]=Math.min(C[0],O[0]),E[1]=Math.min(C[1],O[1]),E[2]=Math.min(C[2],O[2]),E},gt.max=function(E,C,O){return E[0]=Math.max(C[0],O[0]),E[1]=Math.max(C[1],O[1]),E[2]=Math.max(C[2],O[2]),E},gt.round=function(E,C){return E[0]=Math.round(C[0]),E[1]=Math.round(C[1]),E[2]=Math.round(C[2]),E},gt.scale=function(E,C,O){return E[0]=C[0]*O,E[1]=C[1]*O,E[2]=C[2]*O,E},gt.scaleAndAdd=function(E,C,O,k){return E[0]=C[0]+O[0]*k,E[1]=C[1]+O[1]*k,E[2]=C[2]+O[2]*k,E},gt.distance=b,gt.squaredDistance=S,gt.squaredLength=_,gt.negate=function(E,C){return E[0]=-C[0],E[1]=-C[1],E[2]=-C[2],E},gt.inverse=function(E,C){return E[0]=1/C[0],E[1]=1/C[1],E[2]=1/C[2],E},gt.normalize=function(E,C){var O=C[0],k=C[1],U=C[2],V=O*O+k*k+U*U;return V>0&&(V=1/Math.sqrt(V)),E[0]=C[0]*V,E[1]=C[1]*V,E[2]=C[2]*V,E},gt.dot=w,gt.cross=function(E,C,O){var k=C[0],U=C[1],V=C[2],N=O[0],$=O[1],Z=O[2];return E[0]=U*Z-V*$,E[1]=V*N-k*Z,E[2]=k*$-U*N,E},gt.lerp=function(E,C,O,k){var U=C[0],V=C[1],N=C[2];return E[0]=U+k*(O[0]-U),E[1]=V+k*(O[1]-V),E[2]=N+k*(O[2]-N),E},gt.hermite=function(E,C,O,k,U,V){var N=V*V,$=N*(2*V-3)+1,Z=N*(V-2)+V,K=N*(V-1),ae=N*(3-2*V);return E[0]=C[0]*$+O[0]*Z+k[0]*K+U[0]*ae,E[1]=C[1]*$+O[1]*Z+k[1]*K+U[1]*ae,E[2]=C[2]*$+O[2]*Z+k[2]*K+U[2]*ae,E},gt.bezier=function(E,C,O,k,U,V){var N=1-V,$=N*N,Z=V*V,K=$*N,ae=3*V*$,ie=3*Z*N,se=Z*V;return E[0]=C[0]*K+O[0]*ae+k[0]*ie+U[0]*se,E[1]=C[1]*K+O[1]*ae+k[1]*ie+U[1]*se,E[2]=C[2]*K+O[2]*ae+k[2]*ie+U[2]*se,E},gt.random=function(E,C){C=C||1;var O=2*e.RANDOM()*Math.PI,k=2*e.RANDOM()-1,U=Math.sqrt(1-k*k)*C;return E[0]=Math.cos(O)*U,E[1]=Math.sin(O)*U,E[2]=k*C,E},gt.transformMat4=function(E,C,O){var k=C[0],U=C[1],V=C[2],N=O[3]*k+O[7]*U+O[11]*V+O[15];return E[0]=(O[0]*k+O[4]*U+O[8]*V+O[12])/(N=N||1),E[1]=(O[1]*k+O[5]*U+O[9]*V+O[13])/N,E[2]=(O[2]*k+O[6]*U+O[10]*V+O[14])/N,E},gt.transformMat3=function(E,C,O){var k=C[0],U=C[1],V=C[2];return E[0]=k*O[0]+U*O[3]+V*O[6],E[1]=k*O[1]+U*O[4]+V*O[7],E[2]=k*O[2]+U*O[5]+V*O[8],E},gt.transformQuat=function(E,C,O){var k=O[0],U=O[1],V=O[2],N=C[0],$=C[1],Z=C[2],K=U*Z-V*$,ae=V*N-k*Z,ie=k*$-U*N,se=U*ie-V*ae,ve=V*K-k*ie,le=k*ae-U*K,xe=2*O[3];return ae*=xe,ie*=xe,ve*=2,le*=2,E[0]=N+(K*=xe)+(se*=2),E[1]=$+ae+ve,E[2]=Z+ie+le,E},gt.rotateX=function(E,C,O,k){var U=[],V=[];return U[0]=C[0]-O[0],U[1]=C[1]-O[1],U[2]=C[2]-O[2],V[0]=U[0],V[1]=U[1]*Math.cos(k)-U[2]*Math.sin(k),V[2]=U[1]*Math.sin(k)+U[2]*Math.cos(k),E[0]=V[0]+O[0],E[1]=V[1]+O[1],E[2]=V[2]+O[2],E},gt.rotateY=function(E,C,O,k){var U=[],V=[];return U[0]=C[0]-O[0],U[1]=C[1]-O[1],U[2]=C[2]-O[2],V[0]=U[2]*Math.sin(k)+U[0]*Math.cos(k),V[1]=U[1],V[2]=U[2]*Math.cos(k)-U[0]*Math.sin(k),E[0]=V[0]+O[0],E[1]=V[1]+O[1],E[2]=V[2]+O[2],E},gt.rotateZ=function(E,C,O,k){var U=[],V=[];return U[0]=C[0]-O[0],U[1]=C[1]-O[1],U[2]=C[2]-O[2],V[0]=U[0]*Math.cos(k)-U[1]*Math.sin(k),V[1]=U[0]*Math.sin(k)+U[1]*Math.cos(k),V[2]=U[2],E[0]=V[0]+O[0],E[1]=V[1]+O[1],E[2]=V[2]+O[2],E},gt.angle=function(E,C){var O=E[0],k=E[1],U=E[2],V=C[0],N=C[1],$=C[2],Z=Math.sqrt(O*O+k*k+U*U)*Math.sqrt(V*V+N*N+$*$),K=Z&&w(E,C)/Z;return Math.acos(Math.min(Math.max(K,-1),1))},gt.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E},gt.str=function(E){return"vec3("+E[0]+", "+E[1]+", "+E[2]+")"},gt.exactEquals=function(E,C){return E[0]===C[0]&&E[1]===C[1]&&E[2]===C[2]},gt.equals=function(E,C){var O=E[0],k=E[1],U=E[2],V=C[0],N=C[1],$=C[2];return Math.abs(O-V)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(V))&&Math.abs(k-N)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(N))&&Math.abs(U-$)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs($))},gt.forEach=gt.sqrLen=gt.len=gt.sqrDist=gt.dist=gt.div=gt.mul=gt.sub=void 0;var e=function(E,C){if(E&&E.__esModule)return E;if(E===null||o(E)!=="object"&&typeof E!="function")return{default:E};var O=r(void 0);if(O&&O.has(E))return O.get(E);var k={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in E)if(V!=="default"&&Object.prototype.hasOwnProperty.call(E,V)){var N=U?Object.getOwnPropertyDescriptor(E,V):null;N&&(N.get||N.set)?Object.defineProperty(k,V,N):k[V]=E[V]}return k.default=E,O&&O.set(E,k),k}(ne());function r(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,O=new WeakMap;return(r=function(k){return k?O:C})(E)}function a(){var E=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0),E}function u(E){return Math.hypot(E[0],E[1],E[2])}function c(E,C,O){return E[0]=C[0]-O[0],E[1]=C[1]-O[1],E[2]=C[2]-O[2],E}function f(E,C,O){return E[0]=C[0]*O[0],E[1]=C[1]*O[1],E[2]=C[2]*O[2],E}function y(E,C,O){return E[0]=C[0]/O[0],E[1]=C[1]/O[1],E[2]=C[2]/O[2],E}function b(E,C){return Math.hypot(C[0]-E[0],C[1]-E[1],C[2]-E[2])}function S(E,C){var O=C[0]-E[0],k=C[1]-E[1],U=C[2]-E[2];return O*O+k*k+U*U}function _(E){var C=E[0],O=E[1],k=E[2];return C*C+O*O+k*k}function w(E,C){return E[0]*C[0]+E[1]*C[1]+E[2]*C[2]}gt.sub=c,gt.mul=f,gt.div=y,gt.dist=b,gt.sqrDist=S,gt.len=u,gt.sqrLen=_;var M,T=(M=a(),function(E,C,O,k,U,V){var N,$;for(C||(C=3),O||(O=0),$=k?Math.min(k*C+O,E.length):E.length,N=O;N<$;N+=C)M[0]=E[N],M[1]=E[N+1],M[2]=E[N+2],U(M,M,V),E[N]=M[0],E[N+1]=M[1],E[N+2]=M[2];return E});return gt.forEach=T,gt}var sr,zr,Zt={};function Ir(){if(sr)return Zt;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},o(T)}sr=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=a,Zt.clone=function(T){var E=new e.ARRAY_TYPE(4);return E[0]=T[0],E[1]=T[1],E[2]=T[2],E[3]=T[3],E},Zt.fromValues=function(T,E,C,O){var k=new e.ARRAY_TYPE(4);return k[0]=T,k[1]=E,k[2]=C,k[3]=O,k},Zt.copy=function(T,E){return T[0]=E[0],T[1]=E[1],T[2]=E[2],T[3]=E[3],T},Zt.set=function(T,E,C,O,k){return T[0]=E,T[1]=C,T[2]=O,T[3]=k,T},Zt.add=function(T,E,C){return T[0]=E[0]+C[0],T[1]=E[1]+C[1],T[2]=E[2]+C[2],T[3]=E[3]+C[3],T},Zt.subtract=u,Zt.multiply=c,Zt.divide=f,Zt.ceil=function(T,E){return T[0]=Math.ceil(E[0]),T[1]=Math.ceil(E[1]),T[2]=Math.ceil(E[2]),T[3]=Math.ceil(E[3]),T},Zt.floor=function(T,E){return T[0]=Math.floor(E[0]),T[1]=Math.floor(E[1]),T[2]=Math.floor(E[2]),T[3]=Math.floor(E[3]),T},Zt.min=function(T,E,C){return T[0]=Math.min(E[0],C[0]),T[1]=Math.min(E[1],C[1]),T[2]=Math.min(E[2],C[2]),T[3]=Math.min(E[3],C[3]),T},Zt.max=function(T,E,C){return T[0]=Math.max(E[0],C[0]),T[1]=Math.max(E[1],C[1]),T[2]=Math.max(E[2],C[2]),T[3]=Math.max(E[3],C[3]),T},Zt.round=function(T,E){return T[0]=Math.round(E[0]),T[1]=Math.round(E[1]),T[2]=Math.round(E[2]),T[3]=Math.round(E[3]),T},Zt.scale=function(T,E,C){return T[0]=E[0]*C,T[1]=E[1]*C,T[2]=E[2]*C,T[3]=E[3]*C,T},Zt.scaleAndAdd=function(T,E,C,O){return T[0]=E[0]+C[0]*O,T[1]=E[1]+C[1]*O,T[2]=E[2]+C[2]*O,T[3]=E[3]+C[3]*O,T},Zt.distance=y,Zt.squaredDistance=b,Zt.length=S,Zt.squaredLength=_,Zt.negate=function(T,E){return T[0]=-E[0],T[1]=-E[1],T[2]=-E[2],T[3]=-E[3],T},Zt.inverse=function(T,E){return T[0]=1/E[0],T[1]=1/E[1],T[2]=1/E[2],T[3]=1/E[3],T},Zt.normalize=function(T,E){var C=E[0],O=E[1],k=E[2],U=E[3],V=C*C+O*O+k*k+U*U;return V>0&&(V=1/Math.sqrt(V)),T[0]=C*V,T[1]=O*V,T[2]=k*V,T[3]=U*V,T},Zt.dot=function(T,E){return T[0]*E[0]+T[1]*E[1]+T[2]*E[2]+T[3]*E[3]},Zt.cross=function(T,E,C,O){var k=C[0]*O[1]-C[1]*O[0],U=C[0]*O[2]-C[2]*O[0],V=C[0]*O[3]-C[3]*O[0],N=C[1]*O[2]-C[2]*O[1],$=C[1]*O[3]-C[3]*O[1],Z=C[2]*O[3]-C[3]*O[2],K=E[0],ae=E[1],ie=E[2],se=E[3];return T[0]=ae*Z-ie*$+se*N,T[1]=-K*Z+ie*V-se*U,T[2]=K*$-ae*V+se*k,T[3]=-K*N+ae*U-ie*k,T},Zt.lerp=function(T,E,C,O){var k=E[0],U=E[1],V=E[2],N=E[3];return T[0]=k+O*(C[0]-k),T[1]=U+O*(C[1]-U),T[2]=V+O*(C[2]-V),T[3]=N+O*(C[3]-N),T},Zt.random=function(T,E){var C,O,k,U,V,N;E=E||1;do V=(C=2*e.RANDOM()-1)*C+(O=2*e.RANDOM()-1)*O;while(V>=1);do N=(k=2*e.RANDOM()-1)*k+(U=2*e.RANDOM()-1)*U;while(N>=1);var $=Math.sqrt((1-V)/N);return T[0]=E*C,T[1]=E*O,T[2]=E*k*$,T[3]=E*U*$,T},Zt.transformMat4=function(T,E,C){var O=E[0],k=E[1],U=E[2],V=E[3];return T[0]=C[0]*O+C[4]*k+C[8]*U+C[12]*V,T[1]=C[1]*O+C[5]*k+C[9]*U+C[13]*V,T[2]=C[2]*O+C[6]*k+C[10]*U+C[14]*V,T[3]=C[3]*O+C[7]*k+C[11]*U+C[15]*V,T},Zt.transformQuat=function(T,E,C){var O=E[0],k=E[1],U=E[2],V=C[0],N=C[1],$=C[2],Z=C[3],K=Z*O+N*U-$*k,ae=Z*k+$*O-V*U,ie=Z*U+V*k-N*O,se=-V*O-N*k-$*U;return T[0]=K*Z+se*-V+ae*-$-ie*-N,T[1]=ae*Z+se*-N+ie*-V-K*-$,T[2]=ie*Z+se*-$+K*-N-ae*-V,T[3]=E[3],T},Zt.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=0,T},Zt.str=function(T){return"vec4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+")"},Zt.exactEquals=function(T,E){return T[0]===E[0]&&T[1]===E[1]&&T[2]===E[2]&&T[3]===E[3]},Zt.equals=function(T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=E[0],N=E[1],$=E[2],Z=E[3];return Math.abs(C-V)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(V))&&Math.abs(O-N)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(N))&&Math.abs(k-$)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs($))&&Math.abs(U-Z)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(Z))},Zt.forEach=Zt.sqrLen=Zt.len=Zt.sqrDist=Zt.dist=Zt.div=Zt.mul=Zt.sub=void 0;var e=function(T,E){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var C=r(void 0);if(C&&C.has(T))return C.get(T);var O={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(U!=="default"&&Object.prototype.hasOwnProperty.call(T,U)){var V=k?Object.getOwnPropertyDescriptor(T,U):null;V&&(V.get||V.set)?Object.defineProperty(O,U,V):O[U]=T[U]}return O.default=T,C&&C.set(T,O),O}(ne());function r(T){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(r=function(O){return O?C:E})(T)}function a(){var T=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0,T[3]=0),T}function u(T,E,C){return T[0]=E[0]-C[0],T[1]=E[1]-C[1],T[2]=E[2]-C[2],T[3]=E[3]-C[3],T}function c(T,E,C){return T[0]=E[0]*C[0],T[1]=E[1]*C[1],T[2]=E[2]*C[2],T[3]=E[3]*C[3],T}function f(T,E,C){return T[0]=E[0]/C[0],T[1]=E[1]/C[1],T[2]=E[2]/C[2],T[3]=E[3]/C[3],T}function y(T,E){return Math.hypot(E[0]-T[0],E[1]-T[1],E[2]-T[2],E[3]-T[3])}function b(T,E){var C=E[0]-T[0],O=E[1]-T[1],k=E[2]-T[2],U=E[3]-T[3];return C*C+O*O+k*k+U*U}function S(T){return Math.hypot(T[0],T[1],T[2],T[3])}function _(T){var E=T[0],C=T[1],O=T[2],k=T[3];return E*E+C*C+O*O+k*k}Zt.sub=u,Zt.mul=c,Zt.div=f,Zt.dist=y,Zt.sqrDist=b,Zt.len=S,Zt.sqrLen=_;var w,M=(w=a(),function(T,E,C,O,k,U){var V,N;for(E||(E=4),C||(C=0),N=O?Math.min(O*E+C,T.length):T.length,V=C;V<N;V+=E)w[0]=T[V],w[1]=T[V+1],w[2]=T[V+2],w[3]=T[V+3],k(w,w,U),T[V]=w[0],T[V+1]=w[1],T[V+2]=w[2],T[V+3]=w[3];return T});return Zt.forEach=M,Zt}function vr(){if(zr)return at;function o(le){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(xe){return typeof xe}:function(xe){return xe&&typeof Symbol=="function"&&xe.constructor===Symbol&&xe!==Symbol.prototype?"symbol":typeof xe},o(le)}zr=1,Object.defineProperty(at,"__esModule",{value:!0}),at.create=y,at.identity=function(le){return le[0]=0,le[1]=0,le[2]=0,le[3]=1,le},at.setAxisAngle=b,at.getAxisAngle=function(le,xe){var Me=2*Math.acos(xe[3]),Se=Math.sin(Me/2);return Se>e.EPSILON?(le[0]=xe[0]/Se,le[1]=xe[1]/Se,le[2]=xe[2]/Se):(le[0]=1,le[1]=0,le[2]=0),Me},at.getAngle=function(le,xe){var Me=C(le,xe);return Math.acos(2*Me*Me-1)},at.multiply=S,at.rotateX=function(le,xe,Me){Me*=.5;var Se=xe[0],Ce=xe[1],Ie=xe[2],Fe=xe[3],ze=Math.sin(Me),Ne=Math.cos(Me);return le[0]=Se*Ne+Fe*ze,le[1]=Ce*Ne+Ie*ze,le[2]=Ie*Ne-Ce*ze,le[3]=Fe*Ne-Se*ze,le},at.rotateY=function(le,xe,Me){Me*=.5;var Se=xe[0],Ce=xe[1],Ie=xe[2],Fe=xe[3],ze=Math.sin(Me),Ne=Math.cos(Me);return le[0]=Se*Ne-Ie*ze,le[1]=Ce*Ne+Fe*ze,le[2]=Ie*Ne+Se*ze,le[3]=Fe*Ne-Ce*ze,le},at.rotateZ=function(le,xe,Me){Me*=.5;var Se=xe[0],Ce=xe[1],Ie=xe[2],Fe=xe[3],ze=Math.sin(Me),Ne=Math.cos(Me);return le[0]=Se*Ne+Ce*ze,le[1]=Ce*Ne-Se*ze,le[2]=Ie*Ne+Fe*ze,le[3]=Fe*Ne-Ie*ze,le},at.calculateW=function(le,xe){var Me=xe[0],Se=xe[1],Ce=xe[2];return le[0]=Me,le[1]=Se,le[2]=Ce,le[3]=Math.sqrt(Math.abs(1-Me*Me-Se*Se-Ce*Ce)),le},at.exp=_,at.ln=w,at.pow=function(le,xe,Me){return w(le,xe),E(le,le,Me),_(le,le),le},at.slerp=M,at.random=function(le){var xe=e.RANDOM(),Me=e.RANDOM(),Se=e.RANDOM(),Ce=Math.sqrt(1-xe),Ie=Math.sqrt(xe);return le[0]=Ce*Math.sin(2*Math.PI*Me),le[1]=Ce*Math.cos(2*Math.PI*Me),le[2]=Ie*Math.sin(2*Math.PI*Se),le[3]=Ie*Math.cos(2*Math.PI*Se),le},at.invert=function(le,xe){var Me=xe[0],Se=xe[1],Ce=xe[2],Ie=xe[3],Fe=Me*Me+Se*Se+Ce*Ce+Ie*Ie,ze=Fe?1/Fe:0;return le[0]=-Me*ze,le[1]=-Se*ze,le[2]=-Ce*ze,le[3]=Ie*ze,le},at.conjugate=function(le,xe){return le[0]=-xe[0],le[1]=-xe[1],le[2]=-xe[2],le[3]=xe[3],le},at.fromMat3=T,at.fromEuler=function(le,xe,Me,Se){var Ce=.5*Math.PI/180;xe*=Ce,Me*=Ce,Se*=Ce;var Ie=Math.sin(xe),Fe=Math.cos(xe),ze=Math.sin(Me),Ne=Math.cos(Me),st=Math.sin(Se),nt=Math.cos(Se);return le[0]=Ie*Ne*nt-Fe*ze*st,le[1]=Fe*ze*nt+Ie*Ne*st,le[2]=Fe*Ne*st-Ie*ze*nt,le[3]=Fe*Ne*nt+Ie*ze*st,le},at.str=function(le){return"quat("+le[0]+", "+le[1]+", "+le[2]+", "+le[3]+")"},at.setAxes=at.sqlerp=at.rotationTo=at.equals=at.exactEquals=at.normalize=at.sqrLen=at.squaredLength=at.len=at.length=at.lerp=at.dot=at.scale=at.mul=at.add=at.set=at.copy=at.fromValues=at.clone=void 0;var e=f(ne()),r=f(ht()),a=f(yt()),u=f(Ir());function c(le){if(typeof WeakMap!="function")return null;var xe=new WeakMap,Me=new WeakMap;return(c=function(Se){return Se?Me:xe})(le)}function f(le,xe){if(le&&le.__esModule)return le;if(le===null||o(le)!=="object"&&typeof le!="function")return{default:le};var Me=c(xe);if(Me&&Me.has(le))return Me.get(le);var Se={},Ce=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ie in le)if(Ie!=="default"&&Object.prototype.hasOwnProperty.call(le,Ie)){var Fe=Ce?Object.getOwnPropertyDescriptor(le,Ie):null;Fe&&(Fe.get||Fe.set)?Object.defineProperty(Se,Ie,Fe):Se[Ie]=le[Ie]}return Se.default=le,Me&&Me.set(le,Se),Se}function y(){var le=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(le[0]=0,le[1]=0,le[2]=0),le[3]=1,le}function b(le,xe,Me){Me*=.5;var Se=Math.sin(Me);return le[0]=Se*xe[0],le[1]=Se*xe[1],le[2]=Se*xe[2],le[3]=Math.cos(Me),le}function S(le,xe,Me){var Se=xe[0],Ce=xe[1],Ie=xe[2],Fe=xe[3],ze=Me[0],Ne=Me[1],st=Me[2],nt=Me[3];return le[0]=Se*nt+Fe*ze+Ce*st-Ie*Ne,le[1]=Ce*nt+Fe*Ne+Ie*ze-Se*st,le[2]=Ie*nt+Fe*st+Se*Ne-Ce*ze,le[3]=Fe*nt-Se*ze-Ce*Ne-Ie*st,le}function _(le,xe){var Me=xe[0],Se=xe[1],Ce=xe[2],Ie=xe[3],Fe=Math.sqrt(Me*Me+Se*Se+Ce*Ce),ze=Math.exp(Ie),Ne=Fe>0?ze*Math.sin(Fe)/Fe:0;return le[0]=Me*Ne,le[1]=Se*Ne,le[2]=Ce*Ne,le[3]=ze*Math.cos(Fe),le}function w(le,xe){var Me=xe[0],Se=xe[1],Ce=xe[2],Ie=xe[3],Fe=Math.sqrt(Me*Me+Se*Se+Ce*Ce),ze=Fe>0?Math.atan2(Fe,Ie)/Fe:0;return le[0]=Me*ze,le[1]=Se*ze,le[2]=Ce*ze,le[3]=.5*Math.log(Me*Me+Se*Se+Ce*Ce+Ie*Ie),le}function M(le,xe,Me,Se){var Ce,Ie,Fe,ze,Ne,st=xe[0],nt=xe[1],Bt=xe[2],ft=xe[3],St=Me[0],lt=Me[1],tr=Me[2],Ot=Me[3];return(Ie=st*St+nt*lt+Bt*tr+ft*Ot)<0&&(Ie=-Ie,St=-St,lt=-lt,tr=-tr,Ot=-Ot),1-Ie>e.EPSILON?(Ce=Math.acos(Ie),Fe=Math.sin(Ce),ze=Math.sin((1-Se)*Ce)/Fe,Ne=Math.sin(Se*Ce)/Fe):(ze=1-Se,Ne=Se),le[0]=ze*st+Ne*St,le[1]=ze*nt+Ne*lt,le[2]=ze*Bt+Ne*tr,le[3]=ze*ft+Ne*Ot,le}function T(le,xe){var Me,Se=xe[0]+xe[4]+xe[8];if(Se>0)Me=Math.sqrt(Se+1),le[3]=.5*Me,le[0]=(xe[5]-xe[7])*(Me=.5/Me),le[1]=(xe[6]-xe[2])*Me,le[2]=(xe[1]-xe[3])*Me;else{var Ce=0;xe[4]>xe[0]&&(Ce=1),xe[8]>xe[3*Ce+Ce]&&(Ce=2);var Ie=(Ce+1)%3,Fe=(Ce+2)%3;Me=Math.sqrt(xe[3*Ce+Ce]-xe[3*Ie+Ie]-xe[3*Fe+Fe]+1),le[Ce]=.5*Me,le[3]=(xe[3*Ie+Fe]-xe[3*Fe+Ie])*(Me=.5/Me),le[Ie]=(xe[3*Ie+Ce]+xe[3*Ce+Ie])*Me,le[Fe]=(xe[3*Fe+Ce]+xe[3*Ce+Fe])*Me}return le}at.clone=u.clone,at.fromValues=u.fromValues,at.copy=u.copy,at.set=u.set,at.add=u.add,at.mul=S;var E=u.scale;at.scale=E;var C=u.dot;at.dot=C,at.lerp=u.lerp;var O=u.length;at.length=O,at.len=O;var k=u.squaredLength;at.squaredLength=k,at.sqrLen=k;var U=u.normalize;at.normalize=U,at.exactEquals=u.exactEquals,at.equals=u.equals;var V,N,$,Z=(V=a.create(),N=a.fromValues(1,0,0),$=a.fromValues(0,1,0),function(le,xe,Me){var Se=a.dot(xe,Me);return Se<-.999999?(a.cross(V,N,xe),a.len(V)<1e-6&&a.cross(V,$,xe),a.normalize(V,V),b(le,V,Math.PI),le):Se>.999999?(le[0]=0,le[1]=0,le[2]=0,le[3]=1,le):(a.cross(V,xe,Me),le[0]=V[0],le[1]=V[1],le[2]=V[2],le[3]=1+Se,U(le,le))});at.rotationTo=Z;var K,ae,ie=(K=y(),ae=y(),function(le,xe,Me,Se,Ce,Ie){return M(K,xe,Ce,Ie),M(ae,Me,Se,Ie),M(le,K,ae,2*Ie*(1-Ie)),le});at.sqlerp=ie;var se,ve=(se=r.create(),function(le,xe,Me,Se){return se[0]=Me[0],se[3]=Me[1],se[6]=Me[2],se[1]=Se[0],se[4]=Se[1],se[7]=Se[2],se[2]=-xe[0],se[5]=-xe[1],se[8]=-xe[2],U(le,T(le,se))});return at.setAxes=ve,at}var Vr,lr={};function Hr(){if(Vr)return lr;function o(M){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},o(M)}Vr=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.create=function(){var M=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(M[0]=0,M[1]=0,M[2]=0,M[4]=0,M[5]=0,M[6]=0,M[7]=0),M[3]=1,M},lr.clone=function(M){var T=new e.ARRAY_TYPE(8);return T[0]=M[0],T[1]=M[1],T[2]=M[2],T[3]=M[3],T[4]=M[4],T[5]=M[5],T[6]=M[6],T[7]=M[7],T},lr.fromValues=function(M,T,E,C,O,k,U,V){var N=new e.ARRAY_TYPE(8);return N[0]=M,N[1]=T,N[2]=E,N[3]=C,N[4]=O,N[5]=k,N[6]=U,N[7]=V,N},lr.fromRotationTranslationValues=function(M,T,E,C,O,k,U){var V=new e.ARRAY_TYPE(8);V[0]=M,V[1]=T,V[2]=E,V[3]=C;var N=.5*O,$=.5*k,Z=.5*U;return V[4]=N*C+$*E-Z*T,V[5]=$*C+Z*M-N*E,V[6]=Z*C+N*T-$*M,V[7]=-N*M-$*T-Z*E,V},lr.fromRotationTranslation=f,lr.fromTranslation=function(M,T){return M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=.5*T[0],M[5]=.5*T[1],M[6]=.5*T[2],M[7]=0,M},lr.fromRotation=function(M,T){return M[0]=T[0],M[1]=T[1],M[2]=T[2],M[3]=T[3],M[4]=0,M[5]=0,M[6]=0,M[7]=0,M},lr.fromMat4=function(M,T){var E=r.create();a.getRotation(E,T);var C=new e.ARRAY_TYPE(3);return a.getTranslation(C,T),f(M,E,C),M},lr.copy=y,lr.identity=function(M){return M[0]=0,M[1]=0,M[2]=0,M[3]=1,M[4]=0,M[5]=0,M[6]=0,M[7]=0,M},lr.set=function(M,T,E,C,O,k,U,V,N){return M[0]=T,M[1]=E,M[2]=C,M[3]=O,M[4]=k,M[5]=U,M[6]=V,M[7]=N,M},lr.getDual=function(M,T){return M[0]=T[4],M[1]=T[5],M[2]=T[6],M[3]=T[7],M},lr.setDual=function(M,T){return M[4]=T[0],M[5]=T[1],M[6]=T[2],M[7]=T[3],M},lr.getTranslation=function(M,T){var E=T[4],C=T[5],O=T[6],k=T[7],U=-T[0],V=-T[1],N=-T[2],$=T[3];return M[0]=2*(E*$+k*U+C*N-O*V),M[1]=2*(C*$+k*V+O*U-E*N),M[2]=2*(O*$+k*N+E*V-C*U),M},lr.translate=function(M,T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=.5*E[0],N=.5*E[1],$=.5*E[2],Z=T[4],K=T[5],ae=T[6],ie=T[7];return M[0]=C,M[1]=O,M[2]=k,M[3]=U,M[4]=U*V+O*$-k*N+Z,M[5]=U*N+k*V-C*$+K,M[6]=U*$+C*N-O*V+ae,M[7]=-C*V-O*N-k*$+ie,M},lr.rotateX=function(M,T,E){var C=-T[0],O=-T[1],k=-T[2],U=T[3],V=T[4],N=T[5],$=T[6],Z=T[7],K=V*U+Z*C+N*k-$*O,ae=N*U+Z*O+$*C-V*k,ie=$*U+Z*k+V*O-N*C,se=Z*U-V*C-N*O-$*k;return r.rotateX(M,T,E),M[4]=K*(U=M[3])+se*(C=M[0])+ae*(k=M[2])-ie*(O=M[1]),M[5]=ae*U+se*O+ie*C-K*k,M[6]=ie*U+se*k+K*O-ae*C,M[7]=se*U-K*C-ae*O-ie*k,M},lr.rotateY=function(M,T,E){var C=-T[0],O=-T[1],k=-T[2],U=T[3],V=T[4],N=T[5],$=T[6],Z=T[7],K=V*U+Z*C+N*k-$*O,ae=N*U+Z*O+$*C-V*k,ie=$*U+Z*k+V*O-N*C,se=Z*U-V*C-N*O-$*k;return r.rotateY(M,T,E),M[4]=K*(U=M[3])+se*(C=M[0])+ae*(k=M[2])-ie*(O=M[1]),M[5]=ae*U+se*O+ie*C-K*k,M[6]=ie*U+se*k+K*O-ae*C,M[7]=se*U-K*C-ae*O-ie*k,M},lr.rotateZ=function(M,T,E){var C=-T[0],O=-T[1],k=-T[2],U=T[3],V=T[4],N=T[5],$=T[6],Z=T[7],K=V*U+Z*C+N*k-$*O,ae=N*U+Z*O+$*C-V*k,ie=$*U+Z*k+V*O-N*C,se=Z*U-V*C-N*O-$*k;return r.rotateZ(M,T,E),M[4]=K*(U=M[3])+se*(C=M[0])+ae*(k=M[2])-ie*(O=M[1]),M[5]=ae*U+se*O+ie*C-K*k,M[6]=ie*U+se*k+K*O-ae*C,M[7]=se*U-K*C-ae*O-ie*k,M},lr.rotateByQuatAppend=function(M,T,E){var C=E[0],O=E[1],k=E[2],U=E[3],V=T[0],N=T[1],$=T[2],Z=T[3];return M[0]=V*U+Z*C+N*k-$*O,M[1]=N*U+Z*O+$*C-V*k,M[2]=$*U+Z*k+V*O-N*C,M[3]=Z*U-V*C-N*O-$*k,M[4]=(V=T[4])*U+(Z=T[7])*C+(N=T[5])*k-($=T[6])*O,M[5]=N*U+Z*O+$*C-V*k,M[6]=$*U+Z*k+V*O-N*C,M[7]=Z*U-V*C-N*O-$*k,M},lr.rotateByQuatPrepend=function(M,T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=E[0],N=E[1],$=E[2],Z=E[3];return M[0]=C*Z+U*V+O*$-k*N,M[1]=O*Z+U*N+k*V-C*$,M[2]=k*Z+U*$+C*N-O*V,M[3]=U*Z-C*V-O*N-k*$,M[4]=C*(Z=E[7])+U*(V=E[4])+O*($=E[6])-k*(N=E[5]),M[5]=O*Z+U*N+k*V-C*$,M[6]=k*Z+U*$+C*N-O*V,M[7]=U*Z-C*V-O*N-k*$,M},lr.rotateAroundAxis=function(M,T,E,C){if(Math.abs(C)<e.EPSILON)return y(M,T);var O=Math.hypot(E[0],E[1],E[2]);C*=.5;var k=Math.sin(C),U=k*E[0]/O,V=k*E[1]/O,N=k*E[2]/O,$=Math.cos(C),Z=T[0],K=T[1],ae=T[2],ie=T[3];M[0]=Z*$+ie*U+K*N-ae*V,M[1]=K*$+ie*V+ae*U-Z*N,M[2]=ae*$+ie*N+Z*V-K*U,M[3]=ie*$-Z*U-K*V-ae*N;var se=T[4],ve=T[5],le=T[6],xe=T[7];return M[4]=se*$+xe*U+ve*N-le*V,M[5]=ve*$+xe*V+le*U-se*N,M[6]=le*$+xe*N+se*V-ve*U,M[7]=xe*$-se*U-ve*V-le*N,M},lr.add=function(M,T,E){return M[0]=T[0]+E[0],M[1]=T[1]+E[1],M[2]=T[2]+E[2],M[3]=T[3]+E[3],M[4]=T[4]+E[4],M[5]=T[5]+E[5],M[6]=T[6]+E[6],M[7]=T[7]+E[7],M},lr.multiply=b,lr.scale=function(M,T,E){return M[0]=T[0]*E,M[1]=T[1]*E,M[2]=T[2]*E,M[3]=T[3]*E,M[4]=T[4]*E,M[5]=T[5]*E,M[6]=T[6]*E,M[7]=T[7]*E,M},lr.lerp=function(M,T,E,C){var O=1-C;return S(T,E)<0&&(C=-C),M[0]=T[0]*O+E[0]*C,M[1]=T[1]*O+E[1]*C,M[2]=T[2]*O+E[2]*C,M[3]=T[3]*O+E[3]*C,M[4]=T[4]*O+E[4]*C,M[5]=T[5]*O+E[5]*C,M[6]=T[6]*O+E[6]*C,M[7]=T[7]*O+E[7]*C,M},lr.invert=function(M,T){var E=w(T);return M[0]=-T[0]/E,M[1]=-T[1]/E,M[2]=-T[2]/E,M[3]=T[3]/E,M[4]=-T[4]/E,M[5]=-T[5]/E,M[6]=-T[6]/E,M[7]=T[7]/E,M},lr.conjugate=function(M,T){return M[0]=-T[0],M[1]=-T[1],M[2]=-T[2],M[3]=T[3],M[4]=-T[4],M[5]=-T[5],M[6]=-T[6],M[7]=T[7],M},lr.normalize=function(M,T){var E=w(T);if(E>0){E=Math.sqrt(E);var C=T[0]/E,O=T[1]/E,k=T[2]/E,U=T[3]/E,V=T[4],N=T[5],$=T[6],Z=T[7],K=C*V+O*N+k*$+U*Z;M[0]=C,M[1]=O,M[2]=k,M[3]=U,M[4]=(V-C*K)/E,M[5]=(N-O*K)/E,M[6]=($-k*K)/E,M[7]=(Z-U*K)/E}return M},lr.str=function(M){return"quat2("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+", "+M[4]+", "+M[5]+", "+M[6]+", "+M[7]+")"},lr.exactEquals=function(M,T){return M[0]===T[0]&&M[1]===T[1]&&M[2]===T[2]&&M[3]===T[3]&&M[4]===T[4]&&M[5]===T[5]&&M[6]===T[6]&&M[7]===T[7]},lr.equals=function(M,T){var E=M[0],C=M[1],O=M[2],k=M[3],U=M[4],V=M[5],N=M[6],$=M[7],Z=T[0],K=T[1],ae=T[2],ie=T[3],se=T[4],ve=T[5],le=T[6],xe=T[7];return Math.abs(E-Z)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Z))&&Math.abs(C-K)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(K))&&Math.abs(O-ae)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(ae))&&Math.abs(k-ie)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(ie))&&Math.abs(U-se)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(se))&&Math.abs(V-ve)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(ve))&&Math.abs(N-le)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(le))&&Math.abs($-xe)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(xe))},lr.sqrLen=lr.squaredLength=lr.len=lr.length=lr.dot=lr.mul=lr.setReal=lr.getReal=void 0;var e=c(ne()),r=c(vr()),a=c(At());function u(M){if(typeof WeakMap!="function")return null;var T=new WeakMap,E=new WeakMap;return(u=function(C){return C?E:T})(M)}function c(M,T){if(M&&M.__esModule)return M;if(M===null||o(M)!=="object"&&typeof M!="function")return{default:M};var E=u(T);if(E&&E.has(M))return E.get(M);var C={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in M)if(k!=="default"&&Object.prototype.hasOwnProperty.call(M,k)){var U=O?Object.getOwnPropertyDescriptor(M,k):null;U&&(U.get||U.set)?Object.defineProperty(C,k,U):C[k]=M[k]}return C.default=M,E&&E.set(M,C),C}function f(M,T,E){var C=.5*E[0],O=.5*E[1],k=.5*E[2],U=T[0],V=T[1],N=T[2],$=T[3];return M[0]=U,M[1]=V,M[2]=N,M[3]=$,M[4]=C*$+O*N-k*V,M[5]=O*$+k*U-C*N,M[6]=k*$+C*V-O*U,M[7]=-C*U-O*V-k*N,M}function y(M,T){return M[0]=T[0],M[1]=T[1],M[2]=T[2],M[3]=T[3],M[4]=T[4],M[5]=T[5],M[6]=T[6],M[7]=T[7],M}function b(M,T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=E[4],N=E[5],$=E[6],Z=E[7],K=T[4],ae=T[5],ie=T[6],se=T[7],ve=E[0],le=E[1],xe=E[2],Me=E[3];return M[0]=C*Me+U*ve+O*xe-k*le,M[1]=O*Me+U*le+k*ve-C*xe,M[2]=k*Me+U*xe+C*le-O*ve,M[3]=U*Me-C*ve-O*le-k*xe,M[4]=C*Z+U*V+O*$-k*N+K*Me+se*ve+ae*xe-ie*le,M[5]=O*Z+U*N+k*V-C*$+ae*Me+se*le+ie*ve-K*xe,M[6]=k*Z+U*$+C*N-O*V+ie*Me+se*xe+K*le-ae*ve,M[7]=U*Z-C*V-O*N-k*$+se*Me-K*ve-ae*le-ie*xe,M}lr.getReal=r.copy,lr.setReal=r.copy,lr.mul=b;var S=r.dot;lr.dot=S;var _=r.length;lr.length=_,lr.len=_;var w=r.squaredLength;return lr.squaredLength=w,lr.sqrLen=w,lr}var ur,rr,$t={};function vi(){if(ur)return $t;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},o(T)}ur=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.create=a,$t.clone=function(T){var E=new e.ARRAY_TYPE(2);return E[0]=T[0],E[1]=T[1],E},$t.fromValues=function(T,E){var C=new e.ARRAY_TYPE(2);return C[0]=T,C[1]=E,C},$t.copy=function(T,E){return T[0]=E[0],T[1]=E[1],T},$t.set=function(T,E,C){return T[0]=E,T[1]=C,T},$t.add=function(T,E,C){return T[0]=E[0]+C[0],T[1]=E[1]+C[1],T},$t.subtract=u,$t.multiply=c,$t.divide=f,$t.ceil=function(T,E){return T[0]=Math.ceil(E[0]),T[1]=Math.ceil(E[1]),T},$t.floor=function(T,E){return T[0]=Math.floor(E[0]),T[1]=Math.floor(E[1]),T},$t.min=function(T,E,C){return T[0]=Math.min(E[0],C[0]),T[1]=Math.min(E[1],C[1]),T},$t.max=function(T,E,C){return T[0]=Math.max(E[0],C[0]),T[1]=Math.max(E[1],C[1]),T},$t.round=function(T,E){return T[0]=Math.round(E[0]),T[1]=Math.round(E[1]),T},$t.scale=function(T,E,C){return T[0]=E[0]*C,T[1]=E[1]*C,T},$t.scaleAndAdd=function(T,E,C,O){return T[0]=E[0]+C[0]*O,T[1]=E[1]+C[1]*O,T},$t.distance=y,$t.squaredDistance=b,$t.length=S,$t.squaredLength=_,$t.negate=function(T,E){return T[0]=-E[0],T[1]=-E[1],T},$t.inverse=function(T,E){return T[0]=1/E[0],T[1]=1/E[1],T},$t.normalize=function(T,E){var C=E[0],O=E[1],k=C*C+O*O;return k>0&&(k=1/Math.sqrt(k)),T[0]=E[0]*k,T[1]=E[1]*k,T},$t.dot=function(T,E){return T[0]*E[0]+T[1]*E[1]},$t.cross=function(T,E,C){var O=E[0]*C[1]-E[1]*C[0];return T[0]=T[1]=0,T[2]=O,T},$t.lerp=function(T,E,C,O){var k=E[0],U=E[1];return T[0]=k+O*(C[0]-k),T[1]=U+O*(C[1]-U),T},$t.random=function(T,E){E=E||1;var C=2*e.RANDOM()*Math.PI;return T[0]=Math.cos(C)*E,T[1]=Math.sin(C)*E,T},$t.transformMat2=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[2]*k,T[1]=C[1]*O+C[3]*k,T},$t.transformMat2d=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[2]*k+C[4],T[1]=C[1]*O+C[3]*k+C[5],T},$t.transformMat3=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[3]*k+C[6],T[1]=C[1]*O+C[4]*k+C[7],T},$t.transformMat4=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[4]*k+C[12],T[1]=C[1]*O+C[5]*k+C[13],T},$t.rotate=function(T,E,C,O){var k=E[0]-C[0],U=E[1]-C[1],V=Math.sin(O),N=Math.cos(O);return T[0]=k*N-U*V+C[0],T[1]=k*V+U*N+C[1],T},$t.angle=function(T,E){var C=T[0],O=T[1],k=E[0],U=E[1],V=Math.sqrt(C*C+O*O)*Math.sqrt(k*k+U*U);return Math.acos(Math.min(Math.max(V&&(C*k+O*U)/V,-1),1))},$t.zero=function(T){return T[0]=0,T[1]=0,T},$t.str=function(T){return"vec2("+T[0]+", "+T[1]+")"},$t.exactEquals=function(T,E){return T[0]===E[0]&&T[1]===E[1]},$t.equals=function(T,E){var C=T[0],O=T[1],k=E[0],U=E[1];return Math.abs(C-k)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(k))&&Math.abs(O-U)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(U))},$t.forEach=$t.sqrLen=$t.sqrDist=$t.dist=$t.div=$t.mul=$t.sub=$t.len=void 0;var e=function(T,E){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var C=r(void 0);if(C&&C.has(T))return C.get(T);var O={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(U!=="default"&&Object.prototype.hasOwnProperty.call(T,U)){var V=k?Object.getOwnPropertyDescriptor(T,U):null;V&&(V.get||V.set)?Object.defineProperty(O,U,V):O[U]=T[U]}return O.default=T,C&&C.set(T,O),O}(ne());function r(T){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(r=function(O){return O?C:E})(T)}function a(){var T=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0),T}function u(T,E,C){return T[0]=E[0]-C[0],T[1]=E[1]-C[1],T}function c(T,E,C){return T[0]=E[0]*C[0],T[1]=E[1]*C[1],T}function f(T,E,C){return T[0]=E[0]/C[0],T[1]=E[1]/C[1],T}function y(T,E){return Math.hypot(E[0]-T[0],E[1]-T[1])}function b(T,E){var C=E[0]-T[0],O=E[1]-T[1];return C*C+O*O}function S(T){return Math.hypot(T[0],T[1])}function _(T){var E=T[0],C=T[1];return E*E+C*C}$t.len=S,$t.sub=u,$t.mul=c,$t.div=f,$t.dist=y,$t.sqrDist=b,$t.sqrLen=_;var w,M=(w=a(),function(T,E,C,O,k,U){var V,N;for(E||(E=2),C||(C=0),N=O?Math.min(O*E+C,T.length):T.length,V=C;V<N;V+=E)w[0]=T[V],w[1]=T[V+1],k(w,w,U),T[V]=w[0],T[V+1]=w[1];return T});return $t.forEach=M,$t}function hi(){if(rr)return H;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},o(T)}rr=1,Object.defineProperty(H,"__esModule",{value:!0}),H.vec4=H.vec3=H.vec2=H.quat2=H.quat=H.mat4=H.mat3=H.mat2d=H.mat2=H.glMatrix=void 0;var e=M(ne());H.glMatrix=e;var r=M(ye());H.mat2=r;var a=M(xt());H.mat2d=a;var u=M(ht());H.mat3=u;var c=M(At());H.mat4=c;var f=M(vr());H.quat=f;var y=M(Hr());H.quat2=y;var b=M(vi());H.vec2=b;var S=M(yt());H.vec3=S;var _=M(Ir());function w(T){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(w=function(O){return O?C:E})(T)}function M(T,E){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var C=w(E);if(C&&C.has(T))return C.get(T);var O={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(U!=="default"&&Object.prototype.hasOwnProperty.call(T,U)){var V=k?Object.getOwnPropertyDescriptor(T,U):null;V&&(V.get||V.set)?Object.defineProperty(O,U,V):O[U]=T[U]}return O.default=T,C&&C.set(T,O),O}return H.vec4=_,H}var yn,Pt,er,Kt,te=hi(),vn=function(){if(Pt)return yn;function o(e,r,a,u){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=a,this.p2y=u}return Pt=1,yn=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,u=0;u<8;u++){var c=this.sampleCurveX(a)-e;if(Math.abs(c)<r)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=c/f}var y=0,b=1;for(a=e,u=0;u<20&&(c=this.sampleCurveX(a),!(Math.abs(c-e)<r));u++)e>c?y=a:b=a,a=.5*(b-y)+y;return a},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},yn}(),ke=G(vn);function Ve(){if(Kt)return er;function o(e,r){this.x=e,this.y=r}return Kt=1,er=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,a=e.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),a=Math.sin(e),u=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=u,this},_rotateAround:function(e,r){var a=Math.cos(e),u=Math.sin(e),c=r.y+u*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-u*(this.y-r.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e},er}var Ae=G(Ve());function bt(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let r=0;r<o.length;r++)if(!bt(o[r],e[r]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const r in o)if(!bt(o[r],e[r]))return!1;return!0}return o===e}const Vt=Math.PI/180,zt=180/Math.PI;function Rt(o){return o*Vt}function jt(o){return o*zt}const Yt=[[0,0],[1,0],[1,1],[0,1]];function Gt(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,r=e*o;return 4*(o<.5?r:3*(o-e)+r-.75)}function Cr(o,e,r,a){const u=new ke(o,e,r,a);return function(c){return u.solve(c)}}const cr=Cr(.25,.1,.25,1);function Ye(o,e,r){return Math.min(r,Math.max(e,o))}function Jt(o,e,r){return(r=Ye((r-o)/(e-o),0,1))*r*(3-2*r)}function $r(o,e,r){const a=r-e,u=((o-e)%a+a)%a+e;return u===e?r:u}function xn(o,e,r){if(!o.length)return r(null,[]);let a=o.length;const u=new Array(o.length);let c=null;o.forEach((f,y)=>{e(f,(b,S)=>{b&&(c=b),u[y]=S,--a==0&&r(c,u)})})}function Ur(o,...e){for(const r of e)for(const a in r)o[a]=r[a];return o}let xi=1;function ri(){return xi++}function Ki(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function ki(o,e){o.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ys(o,e,r){const a={};for(const u in o)a[u]=e.call(this,o[u],u,o);return a}function bo(o,e,r){const a={};for(const u in o)e.call(this,o[u],u,o)&&(a[u]=o[u]);return a}function Jn(o){return Array.isArray(o)?o.map(Jn):typeof o=="object"&&o?ys(o,Jn):o}const Fi={};function Pr(o){Fi[o]||(typeof console<"u"&&console.warn(o),Fi[o]=!0)}function wo(o,e,r){return(r.y-o.y)*(e.x-o.x)>(e.y-o.y)*(r.x-o.x)}function xl(o){let e=0;for(let r,a,u=0,c=o.length,f=c-1;u<c;f=u++)r=o[u],a=o[f],e+=(a.x-r.x)*(r.y+a.y);return e}function vs([o,e,r]){const a=Rt(e+90),u=Rt(r);return{x:o*Math.cos(a)*Math.sin(u),y:o*Math.sin(a)*Math.sin(u),z:o*Math.cos(u),azimuthal:e,polar:r}}function Ua(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ja(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,u,c)=>{const f=u||c;return e[a]=!f||f.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Cc=null;function bl(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function Gu(o,e,r,a){for(;e<r;){const u=e+r>>1;o[u]<a?e=u+1:r=u}return e}function Hu(o,e,r,a){for(;e<r;){const u=e+r>>1;o[u]<=a?e=u+1:r=u}return e}function Pc(o){return o>0?1/(1.001-o):1+o}function Xe(o){return o>0?1-1/(1.001-o):-o}const Y={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Y.API_URL)return null;try{const o=new URL(Y.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function re(o){return Y.API_URL_REGEX.test(o)}function fe(o){return Y.API_SPRITE_REGEX.test(o)}let Te,be,Pe,Ge,Re,qe;function Ke(){return Te==null&&(Te=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Te}const We={now:()=>Ge!==void 0?Ge:performance.now(),setNow(o){Ge=o},restoreNow(){Ge=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:r,height:a}=o;Re||(Re=document.createElement("canvas"));const u=Re.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(r>Re.width||a>Re.height)&&(Re.width=r,Re.height=a),u.clearRect(-e,-e,r+2*e,a+2*e),u.drawImage(o,0,0,r,a),u.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:o=>(be||(be=document.createElement("a")),be.href=o,be.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Pe==null&&(Pe=window.matchMedia("(prefers-reduced-motion: reduce)")),Pe.matches)},hasCanvasFingerprintNoise(){if(qe!==void 0)return qe;if(!Ke())return qe=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let r=0;for(let u=0;u<o.width;++u)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(u,0,1,1);const a=e.getImageData(0,0,o.width,o.height);r=0;for(let u=0;u<a.data.length;++u)if(u%4!=3&&r++!==a.data[u])return qe=!0,!0;return qe=!1,!1}};function mt(o,e){const r=o.indexOf("?");if(r<0)return`${o}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(o.slice(r));for(const u in e)a.set(u,e[u]);return`${o.slice(0,r)}?${a.toString()}`}function Nt(o,e={persistentParams:[]}){const r=o.indexOf("?");if(r<0)return o;const a=new URLSearchParams,u=new URLSearchParams(o.slice(r));for(const f of e.persistentParams){const y=u.get(f);y&&a.set(f,y)}const c=a.toString();return`${o.slice(0,r)}${c.length>0?`?${c}`:""}`}const Ut="mapbox-tiles";let xr=500,Tr=50;const Er=["language","worldview","jobid"];let Ar,Sn;function Un(){try{return caches}catch{}}function Or(){const o=Un();o&&Ar==null&&(Ar=o.open(Ut))}let un=1/0;const ln={supported:!1,testSupport:function(o){!bi&&Qn&&(Si?Bi(o):cn=o)}};let cn,Qn,bi=!1,Si=!1;const Bo=typeof self<"u"?self:{};function Bi(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Qn),o.isContextLost())return;ln.supported=!0}catch{}o.deleteTexture(e),bi=!0}Bo.document&&(Qn=Bo.document.createElement("img"),Qn.onload=function(){cn&&Bi(cn),cn=null,Si=!0},Qn.onerror=function(){bi=!0,cn=null},Qn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const pi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(pi);class Ni extends Error{constructor(e,r,a){r===401&&re(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pa=Ua()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,xs=function(o,e){if(!(/^file:/.test(r=o.url)||/^file:/.test(pa())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,u){const c=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:pa(),referrerPolicy:a.referrerPolicy,signal:c.signal});let y=!1,b=!1;const S=(_=f.url).indexOf("sku=")>0&&re(_);var _;a.type==="json"&&f.headers.set("Accept","application/json");const w=(T,E,C)=>{if(b)return;if(T&&T.message!=="SecurityError"&&Pr(T.toString()),E&&C)return M(E);const O=Date.now();fetch(f).then(k=>{if(k.ok){const U=S?k.clone():null;return M(k,U,O)}return u(new Ni(k.statusText,k.status,a.url))}).catch(k=>{k.name!=="AbortError"&&u(new Error(`${k.message} ${a.url}`))})},M=(T,E,C)=>{(a.type==="arrayBuffer"?T.arrayBuffer():a.type==="json"?T.json():T.text()).then(O=>{b||(E&&C&&function(k,U,V){if(Or(),Ar==null)return;const N=ja(U.headers.get("Cache-Control")||"");if(N["no-store"])return;const $={status:U.status,statusText:U.statusText,headers:new Headers};U.headers.forEach((ae,ie)=>$.headers.set(ie,ae)),N["max-age"]&&$.headers.set("Expires",new Date(V+1e3*N["max-age"]).toUTCString());const Z=$.headers.get("Expires");if(!Z||new Date(Z).getTime()-V<42e4)return;let K=Nt(k.url,{persistentParams:Er});if(U.status===206){const ae=k.headers.get("Range");if(!ae)return;$.status=200,K=mt(K,{range:ae})}(function(ae,ie){if(Sn===void 0)try{new Response(new ReadableStream),Sn=!0}catch{Sn=!1}Sn?ie(ae.body):ae.blob().then(ie)})(U,ae=>{const ie=new Response((se=U.status)!==200&&se!==404&&[101,103,204,205,304].includes(se)?null:ae,$);var se;Or(),Ar!=null&&Ar.then(ve=>ve.put(K,ie)).catch(ve=>Pr(ve.message))})}(f,E,C),y=!0,u(null,O,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(O=>{b||u(new Error(O.message))})};return S?function(T,E){if(Or(),Ar==null)return E(null);Ar.then(C=>{let O=Nt(T.url,{persistentParams:Er});const k=T.headers.get("Range");k&&(O=mt(O,{range:k})),C.match(O).then(U=>{const V=function(N){if(!N)return!1;const $=new Date(N.headers.get("Expires")||0),Z=ja(N.headers.get("Cache-Control")||"");return $>Date.now()&&!Z["no-cache"]}(U);C.delete(O),V&&C.put(O,U.clone()),E(null,U,V)}).catch(E)}).catch(E)}(f,w):w(null,null),{cancel:()=>{b=!0,y||c.abort()}}}(o,e);if(Ua()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var r;return function(a,u){const c=new XMLHttpRequest;c.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const f in a.headers)c.setRequestHeader(f,a.headers[f]);return a.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=a.credentials==="include",c.onerror=()=>{u(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let f=c.response;if(a.type==="json")try{f=JSON.parse(c.response)}catch(y){return u(y)}u(null,f,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else u(new Ni(c.statusText,c.status,a.url))},c.send(a.body),{cancel:()=>c.abort()}}(o,e)},$a=function(o,e){return xs(Ur(o,{type:"arrayBuffer"}),e)};function Hd(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const qd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Rc,Dc;Rc=[],Dc=0;const Wd=function(o,e){if(ln.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Dc>=Y.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Rc.push(c),c}Dc++;let r=!1;const a=()=>{if(!r)for(r=!0,Dc--;Rc.length&&Dc<Y.MAX_PARALLEL_IMAGE_REQUESTS;){const c=Rc.shift(),{requestParameters:f,callback:y,cancelled:b}=c;b||(c.cancel=Wd(f,y).cancel)}},u=$a(o,(c,f,y,b)=>{a(),c?e(c):f&&(self.createImageBitmap?function(S,_){const w=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(w).then(M=>{_(null,M)}).catch(M=>{_(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(S,_)=>e(S,_,y,b)):function(S,_){const w=new Image;w.onload=()=>{_(null,w),URL.revokeObjectURL(w.src),w.onload=null,requestAnimationFrame(()=>{w.src=qd})},w.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(S)],{type:"image/png"});w.src=S.byteLength?URL.createObjectURL(M):qd}(f,(S,_)=>e(S,_,y,b)))});return{cancel:()=>{u.cancel(),a()}}};var Nm,Zd,Xd,qi={exports:{}},Js={exports:{}},No={exports:{}},To=function(){if(Xd)return qi.exports;Xd=1;var o=(Nm||(Nm=1,Js.exports=function(r,a){var u,c,f,y,b,S,_,w;for(c=r.length-(u=3&r.length),f=a,b=3432918353,S=461845907,w=0;w<c;)_=255&r.charCodeAt(w)|(255&r.charCodeAt(++w))<<8|(255&r.charCodeAt(++w))<<16|(255&r.charCodeAt(++w))<<24,++w,f=27492+(65535&(y=5*(65535&(f=(f^=_=(65535&(_=(_=(65535&_)*b+(((_>>>16)*b&65535)<<16)&4294967295)<<15|_>>>17))*S+(((_>>>16)*S&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(_=0,u){case 3:_^=(255&r.charCodeAt(w+2))<<16;case 2:_^=(255&r.charCodeAt(w+1))<<8;case 1:f^=_=(65535&(_=(_=(65535&(_^=255&r.charCodeAt(w)))*b+(((_>>>16)*b&65535)<<16)&4294967295)<<15|_>>>17))*S+(((_>>>16)*S&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),Js.exports),e=(Zd||(Zd=1,No.exports=function(r,a){for(var u,c=r.length,f=a^c,y=0;c>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),c-=4,++y;switch(c){case 3:f^=(255&r.charCodeAt(y+2))<<16;case 2:f^=(255&r.charCodeAt(y+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(y)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),No.exports);return qi.exports=o,qi.exports.murmur3=o,qi.exports.murmur2=e,qi.exports}(),Qs=G(To);class So{constructor(e,...r){Ur(this,r[0]||{}),this.type=e}}class qu extends So{constructor(e,r={}){super("error",Ur({error:e},r))}}function Kd(o,e,r){r[o]&&r[o].indexOf(e)!==-1||(r[o]=r[o]||[],r[o].push(e))}function ma(o,e,r){if(r&&r[o]){const a=r[o].indexOf(e);a!==-1&&r[o].splice(a,1)}}class _a{on(e,r){return this._listeners=this._listeners||{},Kd(e,r,this._listeners),this}off(e,r){return ma(e,r,this._listeners),ma(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Kd(e,r,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,r){const a=typeof e=="string"?new So(e,r):e,u=a.type;if(this.listens(u)){a.target=this;const c=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of c)b.call(this,a);const f=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of f)ma(u,b,this._oneTimeListeners),b.call(this,a);const y=this._eventedParent;y&&(Ur(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(a))}else a instanceof qu&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}class bs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new bs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[r,a]=e.split("");return new bs({name:r,iconsetId:a})}static isEqual(e,r){return e.name===r.name&&e.iconsetId===r.iconsetId}toString(){return bs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Vm,ws={},Yd=function(){if(Vm)return ws;Vm=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(c){return(c=Math.round(c))<0?0:c>255?255:c}function r(c){return e(c[c.length-1]==="%"?parseFloat(c)/100*255:parseInt(c))}function a(c){return(f=c[c.length-1]==="%"?parseFloat(c)/100:parseFloat(c))<0?0:f>1?1:f;var f}function u(c,f,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?c+(f-c)*y*6:2*y<1?f:3*y<2?c+(f-c)*(2/3-y)*6:c}try{ws.parseCSSColor=function(c){var f,y=c.replace(/ /g,"").toLowerCase();if(y in o)return o[y].slice();if(y[0]==="#")return y.length===4?(f=parseInt(y.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:y.length===7&&(f=parseInt(y.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var b=y.indexOf("("),S=y.indexOf(")");if(b!==-1&&S+1===y.length){var _=y.substr(0,b),w=y.substr(b+1,S-(b+1)).split(","),M=1;switch(_){case"rgba":if(w.length!==4)return null;M=a(w.pop());case"rgb":return w.length!==3?null:[r(w[0]),r(w[1]),r(w[2]),M];case"hsla":if(w.length!==4)return null;M=a(w.pop());case"hsl":if(w.length!==3)return null;var T=(parseFloat(w[0])%360+360)%360/360,E=a(w[1]),C=a(w[2]),O=C<=.5?C*(E+1):C+E-C*E,k=2*C-O;return[e(255*u(k,O,T+1/3)),e(255*u(k,O,T)),e(255*u(k,O,T-1/3)),M];default:return null}}return null}}catch{}return ws}();class nn{constructor(e,r,a,u=1){this.r=e,this.g=r,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof nn)return e;if(typeof e!="string")return;const r=Yd.parseCSSColor(e);return r?new nn(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toStringPremultipliedAlpha(){const[e,r,a,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${u})`}toString(){const[e,r,a,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*a)},${u})`}toRenderColor(e){const{r,g:a,b:u,a:c}=this;return new zc(e,r,a,u,c)}clone(){return new nn(this.r,this.g,this.b,this.a)}}class zc{constructor(e,r,a,u,c){if(e){const f=e.image.height,y=f*f;r=c===0?0:r/c*(f-1),a=c===0?0:a/c*(f-1),u=c===0?0:u/c*(f-1);const b=Math.floor(r),S=Math.floor(a),_=Math.floor(u),w=Math.ceil(r),M=Math.ceil(a),T=Math.ceil(u),E=r-b,C=a-S,O=u-_,k=e.image.data,U=4*(b+S*y+_*f),V=4*(b+S*y+T*f),N=4*(b+M*y+_*f),$=4*(b+M*y+T*f),Z=4*(w+S*y+_*f),K=4*(w+S*y+T*f),ae=4*(w+M*y+_*f),ie=4*(w+M*y+T*f);if(U<0||ie>=k.length)throw new Error("out of range");this.r=ar(ar(ar(k[U],k[V],O),ar(k[N],k[$],O),C),ar(ar(k[Z],k[K],O),ar(k[ae],k[ie],O),C),E)/255*c,this.g=ar(ar(ar(k[U+1],k[V+1],O),ar(k[N+1],k[$+1],O),C),ar(ar(k[Z+1],k[K+1],O),ar(k[ae+1],k[ie+1],O),C),E)/255*c,this.b=ar(ar(ar(k[U+2],k[V+2],O),ar(k[N+2],k[$+2],O),C),ar(ar(k[Z+2],k[K+2],O),ar(k[ae+2],k[ie+2],O),C),E)/255*c,this.a=c}else this.r=r,this.g=a,this.b=u,this.a=c}toArray(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*r/u,255*a/u,u]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:r,b:a,a:u}=this,c=Math.min(Math.max(e/u,0),1),f=Math.min(Math.max(r/u,0),1),y=Math.min(Math.max(a/u,0),1),b=Math.min(c,f,y),S=Math.max(c,f,y),_=(b+S)/2;if(b===S)return[0,0,100*_,u];const w=S-b,M=_>.5?w/(2-S-b):w/(S+b);let T=0;return S===c?T=(f-y)/w+(f<y?6:0):S===f?T=(y-c)/w+2:S===y&&(T=(c-f)/w+4),T*=60,[Math.min(Math.max(T,0),360),Math.min(Math.max(100*M,0),100),Math.min(Math.max(100*_,0),100),u]}toArray01(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,r/u,a/u,u]}toArray01Scaled(e){const{r,g:a,b:u,a:c}=this;return c===0?[0,0,0]:[r/c*e,a/c*e,u/c*e]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:a,a:u}=this;return[e,r,a,u]}toArray01Linear(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(r/u,2.2),Math.pow(a/u,2.2),u]}}function ar(o,e,r){return o*(1-r)+e*r}function Um(o,e,r){return o.map((a,u)=>ar(a,e[u],r))}function Jd(o){return o*o*o*o*o}nn.black=new nn(0,0,0,1),nn.white=new nn(1,1,1,1),nn.transparent=new nn(0,0,0,0),nn.red=new nn(1,0,0,1),nn.blue=new nn(0,0,1,1);var Xr=Object.freeze({__proto__:null,array:Um,color:function(o,e,r){return new nn(ar(o.r,e.r,r),ar(o.g,e.g,r),ar(o.b,e.b,r),ar(o.a,e.a,r))},easeIn:Jd,number:ar});function Wu(o,...e){for(const r of e)for(const a in r)o[a]=r[a];return o}class Vs extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Qd{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,u]of r)this.bindings[a]=u}concat(e){return new Qd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const wl={kind:"null"},Ht={kind:"number"},sn={kind:"string"},Kr={kind:"boolean"},ns={kind:"color"},Ga={kind:"object"},Gr={kind:"value"},Zu={kind:"collator"},Vo={kind:"formatted"},Ha={kind:"resolvedImage"};function Pi(o,e){return{kind:"array",itemType:o,N:e}}function An(o){if(o.kind==="array"){const e=An(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const jm=[wl,Ht,sn,Kr,ns,Vo,Ga,Pi(Gr),Ha];function Lc(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Lc(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const r of jm)if(!Lc(r,e))return null}}return`Expected ${An(o)} but found ${An(e)} instead.`}function Xu(o,e){return e.some(r=>r.kind===o.kind)}function Tl(o,e){return e.some(r=>r==="null"?o===null:r==="array"?Array.isArray(o):r==="object"?o&&!Array.isArray(o)&&typeof o=="object":r===typeof o)}class Ku{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oc{constructor(e,r,a,u,c){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=u,this.textColor=c}}class Vi{constructor(e){this.sections=e}static fromString(e){return new Vi([new Oc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Vi?e:Vi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){const u=r.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class Eo{constructor(e,r={}){if(this.id=bs.from(e),this.options=Object.assign({},r),r.transform){const{a,b:u,c,d:f,e:y,f:b}=r.transform;this.options.transform=new DOMMatrix([a,u,c,f,y,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:r,c:a,d:u,e:c,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:r,c:a,d:u,e:c,f}})}static parse(e){let r,a,u,c;try{({name:r,iconsetId:a,params:u,transform:c}=JSON.parse(e)||{})}catch{return null}if(!r)return null;const{a:f,b:y,c:b,d:S,e:_,f:w}=c||{};return new Eo({name:r,iconsetId:a},{params:u,transform:new DOMMatrix([f,y,b,S,_,w])})}scaleSelf(e){return this.options.transform.scaleSelf(e),this}}class Ei{constructor(e,r,a,u,c=!1){this.primaryId=bs.from(e),this.primaryOptions=r,a&&(this.secondaryId=bs.from(a)),this.secondaryOptions=u,this.available=c}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Eo(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Eo(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Ei.build({name:e}):e}static build(e,r,a,u){return!e||typeof e=="object"&&!("name"in e)?null:new Ei(e,a,r,u)}}function qa(o,e,r,a){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[o,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[o,e,r,a]:[o,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Wa(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof nn||o instanceof Ku||o instanceof Vi||o instanceof Ei)return!0;if(Array.isArray(o)){for(const e of o)if(!Wa(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!Wa(o[e]))return!1;return!0}return!1}function kn(o){if(o===null)return wl;if(typeof o=="string")return sn;if(typeof o=="boolean")return Kr;if(typeof o=="number")return Ht;if(o instanceof nn)return ns;if(o instanceof Ku)return Zu;if(o instanceof Vi)return Vo;if(o instanceof Ei)return Ha;if(Array.isArray(o)){const e=o.length;let r;for(const a of o){const u=kn(a);if(r){if(r===u)continue;r=Gr;break}r=u}return Pi(r||Gr,e)}return Ga}function eo(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof nn?o.toStringPremultipliedAlpha():o instanceof Vi||o instanceof Ei?o.toString():JSON.stringify(o)}class to{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Wa(e[1]))return r.error("invalid value");const a=e[1];let u=kn(a);const c=r.expectedType;return u.kind!=="array"||u.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(u=c),new to(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof nn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Vi?this.value.serialize():this.value}}class ai{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const kc={string:sn,number:Ht,boolean:Kr,object:Ga};class Us{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,u=1;const c=e[0];if(c==="array"){let y,b;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in kc)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=kc[S],u++}else y=Gr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}a=Pi(y,b)}else a=kc[c];const f=[];for(;u<e.length;u++){const y=r.parse(e[u],u,Gr);if(!y)return null;f.push(y)}return new Us(a,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!Lc(this.type,kn(a)))return a;if(r===this.args.length-1)throw new ai(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${An(kn(a))} but was expected to be of type ${An(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(a=>a.serialize()))}}class Uo{constructor(e){this.type=Vo,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const u=[];let c=!1;for(let f=1;f<=e.length-1;++f){const y=e[f];if(c&&typeof y=="object"&&!Array.isArray(y)){c=!1;let b=null;if(y["font-scale"]&&(b=r.parseObjectValue(y["font-scale"],f,"font-scale",Ht),!b))return null;let S=null;if(y["text-font"]&&(S=r.parseObjectValue(y["text-font"],f,"text-font",Pi(sn)),!S))return null;let _=null;if(y["text-color"]&&(_=r.parseObjectValue(y["text-color"],f,"text-color",ns),!_))return null;const w=u[u.length-1];w.scale=b,w.font=S,w.textColor=_}else{const b=r.parse(e[f],f,Gr);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new Uo(u)}evaluate(e){return new Vi(this.sections.map(r=>{const a=r.content.evaluate(e);return kn(a)===Ha?new Oc("",a,null,null,null):new Oc(eo(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class Sl{constructor(e,r,a,u){this._imageWarnHistory={},this.type=Ha,this.namePrimary=e,this.nameSecondary=r,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let a=1;const u=[];function c(){if(a<e.length){const y=r.parse(e[a],a++,sn);return y?(u.push({image:y,options:{}}),!0):(r.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(a<e.length){const b=e[a];if((y=b)===null||typeof y!="object"||Array.isArray(y))return!0;const S=b.params,_=b.iconset,w=r.concat(a);if(!S&&!_)return a++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return w.error('Image options "params" should be an object'),!1;const M={},T=w.concat(void 0,"params");for(const E in S){if(!E)return T.error("Image parameter name should be non-empty"),!1;const C=T.concat(void 0,E).parse(S[E],void 0,ns,void 0,{typeAnnotation:"coerce"});if(!C)return!1;M[E]=C}u[u.length-1].options.params=M}if(_){if(typeof _!="object"||_.constructor!==Object)return w.error('Image options "iconset" should be an object'),!1;if(!_.id)return w.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=_}return a++,!0}var y;return!0}for(let y=0;y<2;y++)if(!c()||!f())return;return new Sl(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,r){const a={};if(r){for(const u in r)if(r[u])try{a[u]=r[u].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const r={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=Ei.build(r,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const c=u.getPrimary().id;if(u.available=e.availableImages.some(f=>bs.isEqual(f,c)),u.available){const f=u.getSecondary()?u.getSecondary().id:null;f&&(u.available=e.availableImages.some(y=>bs.isEqual(y,f)))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&e(this.paramsPrimary[r]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&e(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(e,r){const a={};if(r&&(a.iconset={id:r}),e){a.params={};for(const u in e)e[u]&&(a.params[u]=e[u].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&e.push(r)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&e.push(r)}return e}}function Za(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}const e0={"to-boolean":Kr,"to-color":ns,"to-number":Ht,"to-string":sn};class jo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0],u=[];let c=wl;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);c=Pi(r.expectedType.itemType,f)}else{if(!(f>0&&Wa(e[1][0])))return null;c=Pi(kn(e[1][0]),f)}for(let y=0;y<f;y++){const b=e[1][y];let S;if(Za(b)==="array")S=r.parse(b,void 0,c.itemType);else{const _=Za(b);if(_!==c.itemType.kind)return r.error(`Expected ${c.itemType.kind} but found ${_}.`);S=r.registry.literal.parse(["literal",b===void 0?null:b],r)}if(!S)return null;u.push(S)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");c=e0[a];for(let f=1;f<e.length;f++){const y=r.parse(e[f],f,Gr);if(!y)return null;u.push(y)}}return new jo(c,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const u of this.args){if(r=u.evaluate(e),a=null,r instanceof nn)return r;if(typeof r=="string"){const c=e.parseColor(r);if(c)return c}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:qa(r[0],r[1],r[2],r[3]),!a))return new nn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ai(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new ai(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Vi.fromString(eo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ei.build(eo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):eo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Uo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Sl(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const $m=["Unknown","Point","LineString","Polygon"];class Fc{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?$m[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-e[0])+this.featureDistanceData.bearing[1]*(u*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=nn.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class is{constructor(e,r,a,u,c){this.name=e,this.type=r,this._evaluate=a,this.args=u,this._overloadIndex=c}evaluate(e){if(!this._evaluate){const r=is.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],u=is.definitions[a];if(!u)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(u)?u[0]:u.type,f=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=[];let b=null,S=-1;for(const[_,w]of f){if(Array.isArray(_)&&_.length!==e.length-1)continue;y.push(_),S++,b=new cf(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const M=[];let T=!1;for(let E=1;E<e.length;E++){const C=e[E],O=Array.isArray(_)?_[E-1]:_.type,k=b.parse(C,1+M.length,O);if(!k){T=!0;break}M.push(k)}if(!T)if(Array.isArray(_)&&_.length!==M.length)b.error(`Expected ${_.length} arguments, but found ${M.length} instead.`);else{for(let E=0;E<M.length;E++){const C=Array.isArray(_)?_[E]:_.type,O=M[E];b.concat(E+1).checkSubtype(C,O.type)}if(b.errors.length===0)return new is(a,c,w,M,S)}}if(y.length===1)r.errors.push(...b.errors);else{const _=(y.length?y:f.map(([M])=>M)).map(Yu).join(" | "),w=[];for(let M=1;M<e.length;M++){const T=r.parse(e[M],1+w.length);if(!T)return null;w.push(An(T.type))}r.error(`Expected arguments of type ${_}, but found (${w.join(", ")}) instead.`)}return null}static register(e,r){is.definitions=r;for(const a in r)e[a]=is}}function Yu(o){return Array.isArray(o)?`(${o.map(An).join(", ")})`:`(${An(o.type)}...)`}class Ju{constructor(e,r,a){this.type=Zu,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const u=a["case-sensitive"]===void 0?r.parse(!1,1,Kr):r.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Kr);if(!u)return null;const c=a["diacritic-sensitive"]===void 0?r.parse(!1,1,Kr):r.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Kr);if(!c)return null;let f=null;return a.locale&&(f=r.parseObjectValue(a.locale,1,"locale",sn),!f)?null:new Ju(u,c,f)}evaluate(e){return new Ku(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Gm(o,e,r=0,a=o.length-1,u=t0){for(;a>r;){if(a-r>600){const b=a-r+1,S=e-r+1,_=Math.log(b),w=.5*Math.exp(2*_/3),M=.5*Math.sqrt(_*w*(b-w)/b)*(S-b/2<0?-1:1);Gm(o,e,Math.max(r,Math.floor(e-S*w/b+M)),Math.min(a,Math.floor(e+(b-S)*w/b+M)),u)}const c=o[e];let f=r,y=a;for(Bc(o,r,e),u(o[a],c)>0&&Bc(o,r,a);f<y;){for(Bc(o,f,y),f++,y--;u(o[f],c)<0;)f++;for(;u(o[y],c)>0;)y--}u(o[r],c)===0?Bc(o,r,y):(y++,Bc(o,y,a)),y<=e&&(r=y+1),e<=y&&(a=y-1)}}function Bc(o,e,r){const a=o[e];o[e]=o[r],o[r]=a}function t0(o,e){return o<e?-1:o>e?1:0}function r0(o){let e=0;for(let r,a,u=0,c=o.length,f=c-1;u<c;f=u++)r=o[u],a=o[f],e+=(a.x-r.x)*(r.y+a.y);return e}function Nc(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function Vc(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function Hm(o,e,r){const a=o[0]-e[0],u=o[1]-e[1],c=o[0]-r[0],f=o[1]-r[1];return a*f-c*u==0&&a*c<=0&&u*f<=0}function ro(o,e,r=!1){let a=!1;for(let y=0,b=e.length;y<b;y++){const S=e[y];for(let _=0,w=S.length,M=w-1;_<w;M=_++){const T=S[M],E=S[_];if(Hm(o,T,E))return r;(c=T)[1]>(u=o)[1]!=(f=E)[1]>u[1]&&u[0]<(f[0]-c[0])*(u[1]-c[1])/(f[1]-c[1])+c[0]&&(a=!a)}}var u,c,f;return a}function qm(o,e,r,a){const u=a[0]-r[0],c=a[1]-r[1],f=(o[0]-r[0])*c-u*(o[1]-r[1]),y=(e[0]-r[0])*c-u*(e[1]-r[1]);return f>0&&y<0||f<0&&y>0}function Qu(o,e,r,a){return(u=[a[0]-r[0],a[1]-r[1]])[0]*(c=[e[0]-o[0],e[1]-o[1]])[1]-u[1]*c[0]!=0&&!(!qm(o,e,r,a)||!qm(r,a,o,e));var u,c}const Ao=8192;function n0(o,e){const r=(180+o[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*Ao),Math.round(a*u*Ao)]}function i0(o,e){for(let r=0;r<e.length;r++)if(ro(o,e[r]))return!0;return!1}function s0(o,e,r){for(const a of r)for(let u=0,c=a.length,f=c-1;u<c;f=u++)if(Qu(o,e,a[f],a[u]))return!0;return!1}function Wm(o,e){for(let r=0;r<o.length;++r)if(!ro(o[r],e))return!1;for(let r=0;r<o.length-1;++r)if(s0(o[r],o[r+1],e))return!1;return!0}function El(o,e){for(let r=0;r<e.length;r++)if(Wm(o,e[r]))return!0;return!1}function Rr(o,e,r){const a=[];for(let u=0;u<o.length;u++){const c=[];for(let f=0;f<o[u].length;f++){const y=n0(o[u][f],r);Nc(e,y),c.push(y)}a.push(c)}return a}function Xt(o,e,r){const a=[];for(let u=0;u<o.length;u++){const c=Rr(o[u],e,r);a.push(c)}return a}function eh(o,e,r,a){if(o[0]<r[0]||o[0]>r[2]){const u=.5*a;let c=o[0]-r[0]>u?-a:r[0]-o[0]>u?a:0;c===0&&(c=o[0]-r[2]>u?-a:r[2]-o[0]>u?a:0),o[0]+=c}Nc(e,o)}function br(o,e,r,a){const u=Math.pow(2,a.z)*Ao,c=[a.x*Ao,a.y*Ao],f=[];if(!o)return f;for(const y of o)for(const b of y){const S=[b.x+c[0],b.y+c[1]];eh(S,e,r,u),f.push(S)}return f}function th(o,e,r,a){const u=Math.pow(2,a.z)*Ao,c=[a.x*Ao,a.y*Ao],f=[];if(!o)return f;for(const b of o){const S=[];for(const _ of b){const w=[_.x+c[0],_.y+c[1]];Nc(e,w),S.push(w)}f.push(S)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of f)for(const S of b)eh(S,e,r,u)}var y;return f}class $o{constructor(e,r){this.type=Kr,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Wa(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const c=a.features[u].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new $o(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new $o(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new $o(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(a.type==="Polygon"){const y=Rr(a.coordinates,c,f),b=br(r.geometry(),u,c,f);if(!Vc(u,c))return!1;for(const S of b)if(!ro(S,y))return!1}if(a.type==="MultiPolygon"){const y=Xt(a.coordinates,c,f),b=br(r.geometry(),u,c,f);if(!Vc(u,c))return!1;for(const S of b)if(!i0(S,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(a.type==="Polygon"){const y=Rr(a.coordinates,c,f),b=th(r.geometry(),u,c,f);if(!Vc(u,c))return!1;for(const S of b)if(!Wm(S,y))return!1}if(a.type==="MultiPolygon"){const y=Xt(a.coordinates,c,f),b=th(r.geometry(),u,c,f);if(!Vc(u,c))return!1;for(const S of b)if(!El(S,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const fr={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ef=1/298.257223563,rh=ef*(2-ef),Al=Math.PI/180;class Ml{static fromTile(e,r,a){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),c=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Al;return new Ml(c,a)}static get units(){return fr}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!fr[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(fr).join(", ")}`);const a=6378.137*Al*(r?fr[r]:1),u=Math.cos(e*Al),c=1/(1-rh*(1-u*u)),f=Math.sqrt(c);this.kx=a*f*u,this.ky=a*f*c*(1-rh)}distance(e,r){const a=ss(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(a*a+u*u)}bearing(e,r){const a=ss(r[0]-e[0])*this.kx;return Math.atan2(a,(r[1]-e[1])*this.ky)/Al}destination(e,r,a){const u=a*Al;return this.offset(e,Math.sin(u)*r,Math.cos(u)*r)}offset(e,r,a){return[e[0]+r/this.kx,e[1]+a/this.ky]}lineDistance(e){let r=0;for(let a=0;a<e.length-1;a++)r+=this.distance(e[a],e[a+1]);return r}area(e){let r=0;for(let a=0;a<e.length;a++){const u=e[a];for(let c=0,f=u.length,y=f-1;c<f;y=c++)r+=ss(u[c][0]-u[y][0])*(u[c][1]+u[y][1])*(a?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let a=0;if(r<=0)return e[0];for(let u=0;u<e.length-1;u++){const c=e[u],f=e[u+1],y=this.distance(c,f);if(a+=y,a>r)return Ri(c,f,(r-(a-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,r,a){let[u,c]=r,f=ss(a[0]-u)*this.kx,y=(a[1]-c)*this.ky;if(f!==0||y!==0){const b=(ss(e[0]-u)*this.kx*f+(e[1]-c)*this.ky*y)/(f*f+y*y);b>1?(u=a[0],c=a[1]):b>0&&(u+=f/this.kx*b,c+=y/this.ky*b)}return f=ss(e[0]-u)*this.kx,y=(e[1]-c)*this.ky,Math.sqrt(f*f+y*y)}pointOnLine(e,r){let a=1/0,u=e[0][0],c=e[0][1],f=0,y=0;for(let b=0;b<e.length-1;b++){let S=e[b][0],_=e[b][1],w=ss(e[b+1][0]-S)*this.kx,M=(e[b+1][1]-_)*this.ky,T=0;w===0&&M===0||(T=(ss(r[0]-S)*this.kx*w+(r[1]-_)*this.ky*M)/(w*w+M*M),T>1?(S=e[b+1][0],_=e[b+1][1]):T>0&&(S+=w/this.kx*T,_+=M/this.ky*T)),w=ss(r[0]-S)*this.kx,M=(r[1]-_)*this.ky;const E=w*w+M*M;E<a&&(a=E,u=S,c=_,f=b,y=T)}return{point:[u,c],index:f,t:Math.max(0,Math.min(1,y))}}lineSlice(e,r,a){let u=this.pointOnLine(a,e),c=this.pointOnLine(a,r);if(u.index>c.index||u.index===c.index&&u.t>c.t){const S=u;u=c,c=S}const f=[u.point],y=u.index+1,b=c.index;!Uc(a[y],f[0])&&y<=b&&f.push(a[y]);for(let S=y+1;S<=b;S++)f.push(a[S]);return Uc(a[b],c.point)||f.push(c.point),f}lineSliceAlong(e,r,a){let u=0;const c=[];for(let f=0;f<a.length-1;f++){const y=a[f],b=a[f+1],S=this.distance(y,b);if(u+=S,u>e&&c.length===0&&c.push(Ri(y,b,(e-(u-S))/S)),u>=r)return c.push(Ri(y,b,(r-(u-S))/S)),c;u>e&&c.push(b)}return c}bufferPoint(e,r){const a=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-a,e[0]+u,e[1]+a]}bufferBBox(e,r){const a=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-a,e[2]+u,e[3]+a]}insideBBox(e,r){return ss(e[0]-r[0])>=0&&ss(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function Uc(o,e){return o[0]===e[0]&&o[1]===e[1]}function Ri(o,e,r){const a=ss(e[0]-o[0]);return[o[0]+a*r,o[1]+(e[1]-o[1])*r]}function ss(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class Go{constructor(e=[],r=(a,u)=>a<u?-1:a>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,u=r[e];for(;e>0;){const c=e-1>>1,f=r[c];if(a(u,f)>=0)break;r[e]=f,e=c}r[e]=u}_down(e){const{data:r,compare:a}=this,u=this.length>>1,c=r[e];for(;e<u;){let f=1+(e<<1);const y=f+1;if(y<this.length&&a(r[y],r[f])<0&&(f=y),a(r[f],c)>=0)break;r[e]=r[f],e=f}r[e]=c}}var Ct=8192;function ga(o,e){return e.dist-o.dist}const Di=100,tf=50;function Zm(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==o[r])return!1;return!0}function nh(o){return o[1]-o[0]+1}function js(o,e){const r=o[1]>=o[0]&&o[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function ih(o,e){if(o[0]>o[1])return[null,null];const r=nh(o);if(e){if(r===2)return[o,null];const a=Math.floor(r/2);return[[o[0],o[0]+a],[o[0]+a,o[1]]]}{if(r===1)return[o,null];const a=Math.floor(r/2)-1;return[[o[0],o[0]+a],[o[0]+a+1,o[1]]]}}function Ho(o,e){const r=[1/0,1/0,-1/0,-1/0];if(!js(e,o.length))return r;for(let a=e[0];a<=e[1];++a)Nc(r,o[a]);return r}function sh(o){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<o.length;++r)for(let a=0;a<o[r].length;++a)Nc(e,o[r][a]);return e}function Il(o,e,r){if(Zm(o)||Zm(e))return NaN;let a=0,u=0;return o[2]<e[0]&&(a=e[0]-o[2]),o[0]>e[2]&&(a=o[0]-e[2]),o[1]>e[3]&&(u=o[1]-e[3]),o[3]<e[1]&&(u=e[1]-o[3]),r.distance([0,0],[a,u])}function o0(o){return 360*o-180}function a0(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function oh(o,e){const r=Math.pow(2,e.z),a=(o.y/Ct+e.y)/r;return[o0((o.x/Ct+e.x)/r),a0(a)]}function l0(o,e){const r=[];for(let a=0;a<o.length;++a)r.push(oh(o[a],e));return r}function Xm(o,e,r){const a=r.pointOnLine(e,o).point;return r.distance(o,a)}function rf(o,e,r,a,u){const c=r.slice(a[0],a[1]+1);let f=1/0;for(let y=e[0];y<=e[1];++y)if((f=Math.min(f,Xm(o[y],c,u)))===0)return 0;return f}function nf(o,e,r,a,u){const c=Math.min(u.pointToSegmentDistance(o,r,a),u.pointToSegmentDistance(e,r,a)),f=Math.min(u.pointToSegmentDistance(r,o,e),u.pointToSegmentDistance(a,o,e));return Math.min(c,f)}function Xa(o,e,r,a,u){if(!js(e,o.length)||!js(a,r.length))return NaN;let c=1/0;for(let f=e[0];f<e[1];++f)for(let y=a[0];y<a[1];++y){if(Qu(o[f],o[f+1],r[y],r[y+1]))return 0;c=Math.min(c,nf(o[f],o[f+1],r[y],r[y+1],u))}return c}function c0(o,e,r,a,u){if(!js(e,o.length)||!js(a,r.length))return NaN;let c=1/0;for(let f=e[0];f<=e[1];++f)for(let y=a[0];y<=a[1];++y)if((c=Math.min(c,u.distance(o[f],r[y])))===0)return c;return c}function u0(o,e,r){if(ro(o,e,!0))return 0;let a=1/0;for(const u of e){const c=u.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[c-1]&&(a=Math.min(a,r.pointToSegmentDistance(o,u[c-1],u[0])))===0||(a=Math.min(a,Xm(o,u,r)))===0)return a}return a}function sf(o,e,r,a){if(!js(e,o.length))return NaN;for(let c=e[0];c<=e[1];++c)if(ro(o[c],r,!0))return 0;let u=1/0;for(let c=e[0];c<e[1];++c)for(const f of r)for(let y=0,b=f.length,S=b-1;y<b;S=y++){if(Qu(o[c],o[c+1],f[S],f[y]))return 0;u=Math.min(u,nf(o[c],o[c+1],f[S],f[y],a))}return u}function of(o,e){for(const r of o)for(let a=0;a<=r.length-1;++a)if(ro(r[a],e,!0))return!0;return!1}function Km(o,e,r,a=1/0){const u=sh(o),c=sh(e);if(a!==1/0&&Il(u,c,r)>=a)return a;if(Vc(u,c)){if(of(o,e))return 0}else if(of(e,o))return 0;let f=a;for(const y of o)for(let b=0,S=y.length,_=S-1;b<S;_=b++)for(const w of e)for(let M=0,T=w.length,E=T-1;M<T;E=M++){if(Qu(y[_],y[b],w[E],w[M]))return 0;f=Math.min(f,nf(y[_],y[b],w[E],w[M],r))}return f}function os(o,e,r,a,u,c,f){if(c===null||f===null)return;const y=Il(Ho(a,c),Ho(u,f),r);y<e&&o.push({dist:y,range1:c,range2:f})}function Ym(o,e,r,a,u=1/0){let c=Math.min(a.distance(o[0],r[0][0]),u);if(c===0)return c;const f=new Go([{dist:0,range1:[0,o.length-1],range2:[0,0]}],ga),y=e?tf:Di,b=sh(r);for(;f.length;){const S=f.pop();if(S.dist>=c)continue;const _=S.range1;if(nh(_)<=y){if(!js(_,o.length))return NaN;if(e){const w=sf(o,_,r,a);if((c=Math.min(c,w))===0)return c}else for(let w=_[0];w<=_[1];++w){const M=u0(o[w],r,a);if((c=Math.min(c,M))===0)return c}}else{const w=ih(_,e);if(w[0]!==null){const M=Il(Ho(o,w[0]),b,a);M<c&&f.push({dist:M,range1:w[0],range2:[0,0]})}if(w[1]!==null){const M=Il(Ho(o,w[1]),b,a);M<c&&f.push({dist:M,range1:w[1],range2:[0,0]})}}}return c}function af(o,e,r,a,u,c=1/0){let f=Math.min(c,u.distance(o[0],r[0]));if(f===0)return f;const y=new Go([{dist:0,range1:[0,o.length-1],range2:[0,r.length-1]}],ga),b=e?tf:Di,S=a?tf:Di;for(;y.length;){const _=y.pop();if(_.dist>=f)continue;const w=_.range1,M=_.range2;if(nh(w)<=b&&nh(M)<=S){if(!js(w,o.length)||!js(M,r.length))return NaN;if(e&&a?f=Math.min(f,Xa(o,w,r,M,u)):e||a?e&&!a?f=Math.min(f,rf(r,M,o,w,u)):!e&&a&&(f=Math.min(f,rf(o,w,r,M,u))):f=Math.min(f,c0(o,w,r,M,u)),f===0)return f}else{const T=ih(w,e),E=ih(M,a);os(y,f,u,o,r,T[0],E[0]),os(y,f,u,o,r,T[0],E[1]),os(y,f,u,o,r,T[1],E[0]),os(y,f,u,o,r,T[1],E[1])}}return f}function ah(o,e,r,a,u=1/0){let c=u;const f=Ho(o,[0,o.length-1]);for(const y of r)if(!(c!==1/0&&Il(f,Ho(y,[0,y.length-1]),a)>=c)&&(c=Math.min(c,af(o,e,y,!0,a,c)),c===0))return c;return c}function jc(o,e,r,a,u=1/0){let c=u;const f=Ho(o,[0,o.length-1]);for(const y of r){if(c!==1/0&&Il(f,sh(y),a)>=c)continue;const b=Ym(o,e,y,a,c);if(isNaN(b))return b;if((c=Math.min(c,b))===0)return c}return c}function lh(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class ya{constructor(e,r){this.type=Ht,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Wa(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let u=0;u<a.features.length;++u)if(lh(a.features[u].geometry.type))return new ya(a,a.features[u].geometry)}else if(a.type==="Feature"){if(lh(a.geometry.type))return new ya(a,a.geometry)}else if(lh(a.type))return new ya(a,a)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),a=e.canonicalID();if(r!=null&&a!=null){if(e.geometryType()==="Point")return function(u,c,f){const y=[];for(const S of u)for(const _ of S)y.push(oh(_,c));const b=new Ml(y[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?af(y,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",b):f.type==="MultiLineString"?ah(y,!1,f.coordinates,b):f.type==="Polygon"||f.type==="MultiPolygon"?jc(y,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,b):null}(r,a,this.geometries);if(e.geometryType()==="LineString")return function(u,c,f){const y=[];for(const S of u){const _=[];for(const w of S)_.push(oh(w,c));y.push(_)}const b=new Ml(y[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return ah(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y,b);if(f.type==="MultiLineString"){let S=1/0;for(let _=0;_<f.coordinates.length;_++){const w=ah(f.coordinates[_],!0,y,b,S);if(isNaN(w))return w;if((S=Math.min(S,w))===0)return S}return S}if(f.type==="Polygon"||f.type==="MultiPolygon"){let S=1/0;for(let _=0;_<y.length;_++){const w=jc(y[_],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,b,S);if(isNaN(w))return w;if((S=Math.min(S,w))===0)return S}return S}return null}(r,a,this.geometries);if(e.geometryType()==="Polygon")return function(u,c,f){const y=[];for(const S of function(_,w){const M=_.length;if(M<=1)return[_];const T=[];let E,C;for(let O=0;O<M;O++){const k=r0(_[O]);k!==0&&(_[O].area=Math.abs(k),C===void 0&&(C=k<0),C===k<0?(E&&T.push(E),E=[_[O]]):E.push(_[O]))}return E&&T.push(E),T}(u)){const _=[];for(let w=0;w<S.length;++w)_.push(l0(S[w],c));y.push(_)}const b=new Ml(y[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return jc(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y,b);if(f.type==="MultiLineString"){let S=1/0;for(let _=0;_<f.coordinates.length;_++){const w=jc(f.coordinates[_],!0,y,b,S);if(isNaN(w))return w;if((S=Math.min(S,w))===0)return S}return S}return f.type==="Polygon"||f.type==="MultiPolygon"?function(S,_,w){let M=1/0;for(const T of S)for(const E of _){const C=Km(T,E,w,M);if(isNaN(C))return C;if((M=Math.min(M,C))===0)return M}return M}(f.type==="Polygon"?[f.coordinates]:f.coordinates,y,b):null}(r,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ch(o,e){switch(o){case"string":return eo(e);case"number":return+e;case"boolean":return!!e;case"color":return nn.parse(e);case"formatted":return Vi.fromString(eo(e));case"resolvedImage":return Ei.build(eo(e))}return e}function lf(o,e,r,a){return a!==void 0&&(o=a*Math.round(o/a)),e!==void 0&&o<e&&(o=e),r!==void 0&&o>r&&(o=r),o}class Ka{constructor(e,r,a){this.type=e,this.key=r,this.scope=a}static parse(e,r){let a=r.expectedType;if(a==null&&(a=Gr),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const u=r.parse(e[1],1);if(!(u instanceof to))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const c=r.parse(e[2],2);return c instanceof to?new Ka(a,eo(u.value),eo(c.value)):r.error("Scope of 'config' expression must be a string literal.")}return new Ka(a,eo(u.value))}evaluate(e){const r=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(r);if(!a)return null;const{type:u,value:c,values:f,minValue:y,maxValue:b,stepValue:S}=a,_=a.default.evaluate(e);let w=_;if(c){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),w=c.evaluate(e),e.scope=M}return u&&(w=ch(u,w)),w===void 0||y===void 0&&b===void 0&&S===void 0||(typeof w=="number"?w=lf(w,y,b,S):Array.isArray(w)&&(w=w.map(M=>typeof M=="number"?lf(M,y,b,S):M))),c!==void 0&&w!==void 0&&f&&!f.includes(w)&&(w=_,u&&(w=ch(u,w))),(u&&u!==this.type||w!==void 0&&kn(w)!==this.type)&&(w=ch(this.type.kind,w)),w}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Cl(o){if(o instanceof is&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof $o||o instanceof ya)return!1;let e=!0;return o.eachChild(r=>{e&&!Cl(r)&&(e=!1)}),e}function $c(o){if(o instanceof is&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(r=>{e&&!$c(r)&&(e=!1)}),e}function Ya(o){if(o instanceof Ka)return new Set([o.key]);let e=new Set;return o.eachChild(r=>{e=new Set([...e,...Ya(r)])}),e}function qo(o,e){if(o instanceof is&&e.indexOf(o.name)>=0)return!1;let r=!0;return o.eachChild(a=>{r&&!qo(a,e)&&(r=!1)}),r}class Ja{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new Ja(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class uh{constructor(e,r=[],a,u=new Qd,c=[],f,y){this.registry=e,this.path=r,this.key=r.map(b=>typeof b=="string"?`['${b}']`:`[${b}]`).join(""),this.scope=u,this.errors=c,this.expectedType=a,this._scope=f,this.options=y}parse(e,r,a,u,c={}){return r||a?this.concat(r,null,a,u)._parse(e,c):this._parse(e,c)}parseObjectValue(e,r,a,u,c,f={}){return this.concat(r,a,u,c)._parse(e,f)}_parse(e,r){function a(u,c,f){return f==="assert"?new Us(c,[u]):f==="coerce"?new jo(c,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let c=u.parse(e,this);if(!c)return null;if(this.expectedType){const f=this.expectedType,y=c.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||y.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(f,y))return null}else c=a(c,f,r.typeAnnotation||"coerce");else c=a(c,f,r.typeAnnotation||"assert")}if(!(c instanceof to)&&c.type.kind!=="resolvedImage"&&hh(c)){const f=new Fc(this._scope,this.options);try{c=new to(c.type,c.evaluate(f))}catch(y){return this.error(y.message),null}}return c}return jo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a,u){let c=typeof e=="number"?this.path.concat(e):this.path;c=typeof r=="string"?c.concat(r):c;const f=u?this.scope.concat(u):this.scope;return new uh(this.registry,c,a||null,f,this.errors,this._scope,this.options)}error(e,...r){const a=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new Vs(a,e))}checkSubtype(e,r){const a=Lc(e,r);return a&&this.error(a),a}}var cf=uh;function hh(o){if(o instanceof Ja)return hh(o.boundExpression);if(o instanceof is&&o.name==="error"||o instanceof Ju||o instanceof $o||o instanceof ya||o instanceof Ka)return!1;const e=o instanceof jo||o instanceof Us;let r=!0;return o.eachChild(a=>{r=e?r&&hh(a):r&&a instanceof to}),!!r&&Cl(o)&&qo(o,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Wo(o,e){const r=o.length-1;let a,u,c=0,f=r,y=0;for(;c<=f;)if(y=Math.floor((c+f)/2),a=o[y],u=o[y+1],a<=e){if(y===r||e<u)return y;c=y+1}else{if(!(a>e))throw new ai("Input is not a number.");f=y-1}return 0}class kr{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,c]of a)this.labels.push(u),this.outputs.push(c)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,Ht);if(!a)return null;const u=[];let c=null;r.expectedType&&r.expectedType.kind!=="value"&&(c=r.expectedType);for(let f=1;f<e.length;f+=2){const y=f===1?-1/0:e[f],b=e[f+1],S=f,_=f+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(u.length&&u[u.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const w=r.parse(b,_,c);if(!w)return null;c=c||w.type,u.push([y,w])}return new kr(c,a,u)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const c=r.length;return u>=r[c-1]?a[c-1].evaluate(e):a[Wo(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const Jm=.95047,Qm=1.08883,e_=4/29,Qa=6/29,t_=3*Qa*Qa,Dn=Qa*Qa*Qa,h0=Math.PI/180,d0=180/Math.PI;function uf(o){return o>Dn?Math.pow(o,1/3):o/t_+e_}function hf(o){return o>Qa?o*o*o:t_*(o-e_)}function df(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function ff(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function r_(o){const e=ff(o.r),r=ff(o.g),a=ff(o.b),u=uf((.4124564*e+.3575761*r+.1804375*a)/Jm),c=uf((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*c-16,a:500*(u-c),b:200*(c-uf((.0193339*e+.119192*r+.9503041*a)/Qm)),alpha:o.a}}function n_(o){let e=(o.l+16)/116,r=isNaN(o.a)?e:e+o.a/500,a=isNaN(o.b)?e:e-o.b/200;return e=1*hf(e),r=Jm*hf(r),a=Qm*hf(a),new nn(df(3.2404542*r-1.5371385*e-.4985314*a),df(-.969266*r+1.8760108*e+.041556*a),df(.0556434*r-.2040259*e+1.0572252*a),o.alpha)}function f0(o,e,r){const a=e-o;return o+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const Gc={forward:r_,reverse:n_,interpolate:function(o,e,r){return{l:ar(o.l,e.l,r),a:ar(o.a,e.a,r),b:ar(o.b,e.b,r),alpha:ar(o.alpha,e.alpha,r)}}},Hc={forward:function(o){const{l:e,a:r,b:a}=r_(o),u=Math.atan2(a,r)*d0;return{h:u<0?u+360:u,c:Math.sqrt(r*r+a*a),l:e,alpha:o.a}},reverse:function(o){const e=o.h*h0,r=o.c;return n_({l:o.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:o.alpha})},interpolate:function(o,e,r){return{h:f0(o.h,e.h,r),c:ar(o.c,e.c,r),l:ar(o.l,e.l,r),alpha:ar(o.alpha,e.alpha,r)}}};var i_=Object.freeze({__proto__:null,hcl:Hc,lab:Gc});class Ts{constructor(e,r,a,u,c){this.type=e,this.operator=r,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[f,y]of c)this.labels.push(f),this.outputs.push(y)}static interpolationFactor(e,r,a,u){let c=0;if(e.name==="exponential")c=pf(r,e.base,a,u);else if(e.name==="linear")c=pf(r,1,a,u);else if(e.name==="cubic-bezier"){const f=e.controlPoints;c=new ke(f[0],f[1],f[2],f[3]).solve(pf(r,1,a,u))}return c}static parse(e,r){let[a,u,c,...f]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const S=u[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:S}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const S=u.slice(1);if(S.length!==4||S.some(_=>typeof _!="number"||_<0||_>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(c=r.parse(c,2,Ht),!c)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=ns:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let S=0;S<f.length;S+=2){const _=f[S],w=f[S+1],M=S+3,T=S+4;if(typeof _!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(y.length&&y[y.length-1][0]>=_)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const E=r.parse(w,T,b);if(!E)return null;b=b||E.type,y.push([_,E])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Ts(b,a,u,c,y):r.error(`Type ${An(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const c=r.length;if(u>=r[c-1])return a[c-1].evaluate(e);const f=Wo(r,u),y=Ts.interpolationFactor(this.interpolation,u,r[f],r[f+1]),b=a[f].evaluate(e),S=a[f+1].evaluate(e);return this.operator==="interpolate"?Xr[this.type.kind.toLowerCase()](b,S,y):this.operator==="interpolate-hcl"?Hc.reverse(Hc.interpolate(Hc.forward(b),Hc.forward(S),y)):Gc.reverse(Gc.interpolate(Gc.forward(b),Gc.forward(S),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function pf(o,e,r,a){const u=a-r,c=o-r;return u===0?0:e===1?c/u:(Math.pow(e,c)-1)/(Math.pow(e,u)-1)}class dh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const u=r.expectedType;u&&u.kind!=="value"&&(a=u);const c=[];for(const y of e.slice(1)){const b=r.parse(y,1+c.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,c.push(b)}const f=u&&c.some(y=>Lc(u,y.type));return new dh(f?Gr:a,c)}evaluate(e){let r,a=null,u=0;for(const c of this.args){if(u++,a=c.evaluate(e),a&&a instanceof Ei&&!a.available&&(r||(r=a),a=null,u===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class fh{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let c=1;c<e.length-1;c+=2){const f=e[c];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,c);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",c);const y=r.parse(e[c+1],c+1);if(!y)return null;a.push([f,y])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return u?new fh(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}class mf{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Ht),u=r.parse(e[2],2,Pi(r.expectedType||Gr));return a&&u?new mf(u.type.itemType,a,u):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new ai(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new ai(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new ai(`Array index must be an integer, but found ${r} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class _f{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Ht),u=r.parse(e[2],2,Pi(r.expectedType||Gr));return a&&u?new _f(u.type.itemType,a,u):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new ai(`Array index out of bounds: ${r} < 0.`);if(r>a.length-1)throw new ai(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r===Math.floor(r))return a[r];const u=Math.floor(r),c=Math.ceil(r),f=a[u],y=a[c];if(typeof f!="number"||typeof y!="number")throw new ai(`Cannot interpolate between non-number values at index ${r}.`);const b=r-u;return f*(1-b)+y*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class gf{constructor(e,r){this.type=Kr,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Gr),u=r.parse(e[2],2,Gr);return a&&u?Xu(a.type,[Kr,sn,Ht,wl,Gr])?new gf(a,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${An(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Tl(r,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${An(kn(r))} instead.`);if(!Tl(a,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${An(kn(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ph{constructor(e,r,a){this.type=Ht,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Gr),u=r.parse(e[2],2,Gr);if(!a||!u)return null;if(!Xu(a.type,[Kr,sn,Ht,wl,Gr]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${An(a.type)} instead`);if(e.length===4){const c=r.parse(e[3],3,Ht);return c?new ph(a,u,c):null}return new ph(a,u)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Tl(r,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${An(kn(r))} instead.`);if(!Tl(a,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${An(kn(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(r,u)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class yf{constructor(e,r,a,u,c,f){this.inputType=e,this.type=r,this.input=a,this.cases=u,this.outputs=c,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const c={},f=[];for(let S=2;S<e.length-1;S+=2){let _=e[S];const w=e[S+1];Array.isArray(_)||(_=[_]);const M=r.concat(S);if(_.length===0)return M.error("Expected at least one branch label.");for(const E of _){if(typeof E!="number"&&typeof E!="string")return M.error("Branch labels must be numbers or strings.");if(typeof E=="number"&&Math.abs(E)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof E=="number"&&Math.floor(E)!==E)return M.error("Numeric branch labels must be integer values.");if(a){if(M.checkSubtype(a,kn(E)))return null}else a=kn(E);if(c[String(E)]!==void 0)return M.error("Branch labels must be unique.");c[String(E)]=f.length}const T=r.parse(w,S,u);if(!T)return null;u=u||T.type,f.push(T)}const y=r.parse(e[1],1,Gr);if(!y)return null;const b=r.parse(e[e.length-1],e.length-1,u);return b?y.type.kind!=="value"&&r.concat(1).checkSubtype(a,y.type)?null:new yf(a,u,y,c,f,b):null}evaluate(e){const r=this.input.evaluate(e);return(kn(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],u={};for(const f of r){const y=u[this.cases[f]];y===void 0?(u[this.cases[f]]=a.length,a.push([this.cases[f],[f]])):a[y][1].push(f)}const c=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,y]of a)e.push(y.length===1?c(y[0]):y.map(c)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class vf{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const u=[];for(let f=1;f<e.length-1;f+=2){const y=r.parse(e[f],f,Kr);if(!y)return null;const b=r.parse(e[f+1],f+1,a);if(!b)return null;u.push([y,b]),a=a||b.type}const c=r.parse(e[e.length-1],e.length-1,a);return c?new vf(a,u,c):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class mh{constructor(e,r,a,u){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,Gr),u=r.parse(e[2],2,Ht);if(!a||!u)return null;if(!Xu(a.type,[Pi(Gr),sn,Gr]))return r.error(`Expected first argument to be of type array or string, but found ${An(a.type)} instead`);if(e.length===4){const c=r.parse(e[3],3,Ht);return c?new mh(a.type,a,u,c):null}return new mh(a.type,a,u)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Tl(r,["string","array"]))throw new ai(`Expected first argument to be of type array or string, but found ${An(kn(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(a,u)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function s_(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function o_(o,e,r,a){return a.compare(e,r)===0}function Pl(o,e,r){const a=o!=="=="&&o!=="!=";return class o3{constructor(c,f,y){this.type=Kr,this.lhs=c,this.rhs=f,this.collator=y,this.hasUntypedArgument=c.type.kind==="value"||f.type.kind==="value"}static parse(c,f){if(c.length!==3&&c.length!==4)return f.error("Expected two or three arguments.");const y=c[0];let b=f.parse(c[1],1,Gr);if(!b)return null;if(!s_(y,b.type))return f.concat(1).error(`"${y}" comparisons are not supported for type '${An(b.type)}'.`);let S=f.parse(c[2],2,Gr);if(!S)return null;if(!s_(y,S.type))return f.concat(2).error(`"${y}" comparisons are not supported for type '${An(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error(`Cannot compare types '${An(b.type)}' and '${An(S.type)}'.`);a&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new Us(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new Us(b.type,[S])));let _=null;if(c.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(_=f.parse(c[3],3,Zu),!_)return null}return new o3(b,S,_)}evaluate(c){const f=this.lhs.evaluate(c),y=this.rhs.evaluate(c);if(a&&this.hasUntypedArgument){const b=kn(f),S=kn(y);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new ai(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=kn(f),S=kn(y);if(b.kind!=="string"||S.kind!=="string")return e(c,f,y)}return this.collator?r(c,f,y,this.collator.evaluate(c)):e(c,f,y)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[o];return this.eachChild(f=>{c.push(f.serialize())}),c}}}const p0=Pl("==",function(o,e,r){return e===r},o_),m0=Pl("!=",function(o,e,r){return e!==r},function(o,e,r,a){return!o_(0,e,r,a)}),_0=Pl("<",function(o,e,r){return e<r},function(o,e,r,a){return a.compare(e,r)<0}),g0=Pl(">",function(o,e,r){return e>r},function(o,e,r,a){return a.compare(e,r)>0}),y0=Pl("<=",function(o,e,r){return e<=r},function(o,e,r,a){return a.compare(e,r)<=0}),xf=Pl(">=",function(o,e,r){return e>=r},function(o,e,r,a){return a.compare(e,r)>=0});class bf{constructor(e,r,a,u,c,f){this.type=sn,this.number=e,this.locale=r,this.currency=a,this.unit=u,this.minFractionDigits=c,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,Ht);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let c=null;if(u.locale&&(c=r.parseObjectValue(u.locale,2,"locale",sn),!c))return null;let f=null;if(u.currency&&(f=r.parseObjectValue(u.currency,2,"currency",sn),!f))return null;let y=null;if(u.unit&&(y=r.parseObjectValue(u.unit,2,"unit",sn),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=r.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",Ht),!b))return null;let S=null;return u["max-fraction-digits"]&&(S=r.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",Ht),!S)?null:new bf(a,c,f,y,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class _h{constructor(e){this.type=Ht,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${An(a.type)} instead.`):new _h(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new ai(`Expected value to be of type string or array, but found ${An(kn(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function a_(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Rl={"==":p0,"!=":m0,">":g0,"<":_0,">=":xf,"<=":y0,array:Us,at:mf,"at-interpolated":_f,boolean:Us,case:vf,coalesce:dh,collator:Ju,format:Uo,image:Sl,in:gf,"index-of":ph,interpolate:Ts,"interpolate-hcl":Ts,"interpolate-lab":Ts,length:_h,let:fh,literal:to,match:yf,number:Us,"number-format":bf,object:Us,slice:mh,step:kr,string:Us,"to-boolean":jo,"to-color":jo,"to-number":jo,"to-string":jo,var:Ja,within:$o,distance:ya,config:Ka};function l_(o,[e,r,a,u]){e=e.evaluate(o),r=r.evaluate(o),a=a.evaluate(o);const c=u?u.evaluate(o):1,f=qa(e,r,a,c);if(f)throw new ai(f);return new nn(e/255*c,r/255*c,a/255*c,c)}function wf(o,[e,r,a,u]){e=e.evaluate(o),r=r.evaluate(o),a=a.evaluate(o);const c=u?u.evaluate(o):1,f=function(S,_,w,M){return typeof S=="number"&&S>=0&&S<=360?typeof _=="number"&&_>=0&&_<=100&&typeof w=="number"&&w>=0&&w<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[S,_,w,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[S,_,w,M]:[S,_,w]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[S,_,w,M]:[S,_,w]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,a,c);if(f)throw new ai(f);const y=`hsla(${e}, ${r}%, ${a}%, ${c})`,b=nn.parse(y);if(!b)throw new ai(`Failed to parse HSLA color: ${y}`);return b}function Tf(o,e){return o in e}function va(o,e){const r=e[o];return r===void 0?null:r}function xa(o){return{type:o}}function Sf(o){return{result:"success",value:o}}function ba(o){return{result:"error",value:o}}function qc(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Dl(o){return o["property-type"]==="data-driven"}function c_(o){return qc(o.expression,"measure-light")}function u_(o){return qc(o.expression,"zoom")}function gh(o){return!!o.expression&&o.expression.interpolated}function yh(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function v0(o){return o}function h_(o,e){const r=e.type==="color",a=o.stops&&typeof o.stops[0][0]=="object",u=a||!(a||o.property!==void 0),c=o.type||(gh(e)?"exponential":"interval");if(r&&((o=Wu({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],nn.parse(S[1])])),o.default=nn.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!i_[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let f,y,b;if(c==="exponential")f=Zc;else if(c==="interval")f=f_;else if(c==="categorical"){f=d_,y=Object.create(null);for(const S of o.stops)y[S[0]]=S[1];b=typeof o.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);f=x0}if(a){const S={},_=[];for(let T=0;T<o.stops.length;T++){const E=o.stops[T],C=E[0].zoom;S[C]===void 0&&(S[C]={zoom:C,type:o.type,property:o.property,default:o.default,stops:[]},_.push(C)),S[C].stops.push([E[0].value,E[1]])}const w=[];for(const T of _)w.push([S[T].zoom,h_(S[T],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Ts.interpolationFactor.bind(void 0,M),zoomStops:w.map(T=>T[0]),evaluate:({zoom:T},E)=>Zc({stops:w,base:o.base},e,T).evaluate(T,E)}}if(u){const S=c==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Ts.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(_=>_[0]),evaluate:({zoom:_})=>f(o,e,_,y,b)}}return{kind:"source",evaluate(S,_){const w=_&&_.properties?_.properties[o.property]:void 0;return w===void 0?Wc(o.default,e.default):f(o,e,w,y,b)}}}function Wc(o,e,r){return o!==void 0?o:e!==void 0?e:r!==void 0?r:void 0}function d_(o,e,r,a,u){return Wc(typeof r===u?a[r]:void 0,o.default,e.default)}function f_(o,e,r){if(Za(r)!=="number")return Wc(o.default,e.default);const a=o.stops.length;if(a===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[a-1][0])return o.stops[a-1][1];const u=Wo(o.stops.map(c=>c[0]),r);return o.stops[u][1]}function Zc(o,e,r){const a=o.base!==void 0?o.base:1;if(Za(r)!=="number")return Wc(o.default,e.default);const u=o.stops.length;if(u===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[u-1][0])return o.stops[u-1][1];const c=Wo(o.stops.map(_=>_[0]),r),f=function(_,w,M,T){const E=T-M,C=_-M;return E===0?0:w===1?C/E:(Math.pow(w,C)-1)/(Math.pow(w,E)-1)}(r,a,o.stops[c][0],o.stops[c+1][0]),y=o.stops[c][1],b=o.stops[c+1][1];let S=Xr[e.type]||v0;if(o.colorSpace&&o.colorSpace!=="rgb"){const _=i_[o.colorSpace];S=(w,M)=>_.reverse(_.interpolate(_.forward(w),_.forward(M),f))}return typeof y.evaluate=="function"?{evaluate(..._){const w=y.evaluate.apply(void 0,_),M=b.evaluate.apply(void 0,_);if(w!==void 0&&M!==void 0)return S(w,M,f)}}:S(y,b,f)}function x0(o,e,r){return e.type==="color"?r=nn.parse(r):e.type==="formatted"?r=Vi.fromString(r.toString()):e.type==="resolvedImage"?r=Ei.build(r.toString()):Za(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),Wc(r,o.default,e.default)}is.register(Rl,{error:[{kind:"error"},[sn],(o,[e])=>{throw new ai(e.evaluate(o))}],typeof:[sn,[Gr],(o,[e])=>An(kn(e.evaluate(o)))],"to-rgba":[Pi(Ht,4),[ns],(o,[e])=>e.evaluate(o).toRenderColor(null).toArray()],"to-hsla":[Pi(Ht,4),[ns],(o,[e])=>e.evaluate(o).toRenderColor(null).toHslaArray()],rgb:[ns,[Ht,Ht,Ht],l_],rgba:[ns,[Ht,Ht,Ht,Ht],l_],hsl:[ns,[Ht,Ht,Ht],wf],hsla:[ns,[Ht,Ht,Ht,Ht],wf],has:{type:Kr,overloads:[[[sn],(o,[e])=>Tf(e.evaluate(o),o.properties())],[[sn,Ga],(o,[e,r])=>Tf(e.evaluate(o),r.evaluate(o))]]},get:{type:Gr,overloads:[[[sn],(o,[e])=>va(e.evaluate(o),o.properties())],[[sn,Ga],(o,[e,r])=>va(e.evaluate(o),r.evaluate(o))]]},"feature-state":[Gr,[sn],(o,[e])=>va(e.evaluate(o),o.featureState||{})],properties:[Ga,[],o=>o.properties()],"geometry-type":[sn,[],o=>o.geometryType()],id:[Gr,[],o=>o.id()],zoom:[Ht,[],o=>o.globals.zoom],pitch:[Ht,[],o=>o.globals.pitch||0],"distance-from-center":[Ht,[],o=>o.distanceFromCenter()],"measure-light":[Ht,[sn],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[Ht,[],o=>o.globals.heatmapDensity||0],"line-progress":[Ht,[],o=>o.globals.lineProgress||0],"raster-value":[Ht,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[Ht,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ht,[],o=>o.globals.skyRadialProgress||0],accumulated:[Gr,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[Ht,xa(Ht),(o,e)=>{let r=0;for(const a of e)r+=a.evaluate(o);return r}],"*":[Ht,xa(Ht),(o,e)=>{let r=1;for(const a of e)r*=a.evaluate(o);return r}],"-":{type:Ht,overloads:[[[Ht,Ht],(o,[e,r])=>e.evaluate(o)-r.evaluate(o)],[[Ht],(o,[e])=>-e.evaluate(o)]]},"/":[Ht,[Ht,Ht],(o,[e,r])=>e.evaluate(o)/r.evaluate(o)],"%":[Ht,[Ht,Ht],(o,[e,r])=>e.evaluate(o)%r.evaluate(o)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(o,[e,r])=>Math.pow(e.evaluate(o),r.evaluate(o))],sqrt:[Ht,[Ht],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[Ht,[Ht],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[Ht,[Ht],(o,[e])=>Math.log(e.evaluate(o))],log2:[Ht,[Ht],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[Ht,[Ht],(o,[e])=>Math.sin(e.evaluate(o))],cos:[Ht,[Ht],(o,[e])=>Math.cos(e.evaluate(o))],tan:[Ht,[Ht],(o,[e])=>Math.tan(e.evaluate(o))],asin:[Ht,[Ht],(o,[e])=>Math.asin(e.evaluate(o))],acos:[Ht,[Ht],(o,[e])=>Math.acos(e.evaluate(o))],atan:[Ht,[Ht],(o,[e])=>Math.atan(e.evaluate(o))],min:[Ht,xa(Ht),(o,e)=>Math.min(...e.map(r=>r.evaluate(o)))],max:[Ht,xa(Ht),(o,e)=>Math.max(...e.map(r=>r.evaluate(o)))],abs:[Ht,[Ht],(o,[e])=>Math.abs(e.evaluate(o))],round:[Ht,[Ht],(o,[e])=>{const r=e.evaluate(o);return r<0?-Math.round(-r):Math.round(r)}],floor:[Ht,[Ht],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[Ht,[Ht],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[Kr,[sn,Gr],(o,[e,r])=>o.properties()[e.value]===r.value],"filter-id-==":[Kr,[Gr],(o,[e])=>o.id()===e.value],"filter-type-==":[Kr,[sn],(o,[e])=>o.geometryType()===e.value],"filter-<":[Kr,[sn,Gr],(o,[e,r])=>{const a=o.properties()[e.value],u=r.value;return typeof a==typeof u&&a<u}],"filter-id-<":[Kr,[Gr],(o,[e])=>{const r=o.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[Kr,[sn,Gr],(o,[e,r])=>{const a=o.properties()[e.value],u=r.value;return typeof a==typeof u&&a>u}],"filter-id->":[Kr,[Gr],(o,[e])=>{const r=o.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[Kr,[sn,Gr],(o,[e,r])=>{const a=o.properties()[e.value],u=r.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[Kr,[Gr],(o,[e])=>{const r=o.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[Kr,[sn,Gr],(o,[e,r])=>{const a=o.properties()[e.value],u=r.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[Kr,[Gr],(o,[e])=>{const r=o.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[Kr,[Gr],(o,[e])=>e.value in o.properties()],"filter-has-id":[Kr,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Kr,[Pi(sn)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[Kr,[Pi(Gr)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[Kr,[sn,Pi(Gr)],(o,[e,r])=>r.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[Kr,[sn,Pi(Gr)],(o,[e,r])=>function(a,u,c,f){for(;c<=f;){const y=c+f>>1;if(u[y]===a)return!0;u[y]>a?f=y-1:c=y+1}return!1}(o.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Kr,overloads:[[[Kr,Kr],(o,[e,r])=>e.evaluate(o)&&r.evaluate(o)],[xa(Kr),(o,e)=>{for(const r of e)if(!r.evaluate(o))return!1;return!0}]]},any:{type:Kr,overloads:[[[Kr,Kr],(o,[e,r])=>e.evaluate(o)||r.evaluate(o)],[xa(Kr),(o,e)=>{for(const r of e)if(r.evaluate(o))return!0;return!1}]]},"!":[Kr,[Kr],(o,[e])=>!e.evaluate(o)],"is-supported-script":[Kr,[sn],(o,[e])=>{const r=o.globals&&o.globals.isSupportedScript;return!r||r(e.evaluate(o))}],upcase:[sn,[sn],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[sn,[sn],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[sn,xa(Gr),(o,e)=>e.map(r=>eo(r.evaluate(o))).join("")],"resolved-locale":[sn,[Zu],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[Ht,[Ht,Ht,Gr],(o,e)=>{const[r,a,u]=e.map(f=>f.evaluate(o));if(r>a||r===a)return r;let c;if(typeof u=="string")c=function(f){let y=0;if(f.length===0)return y;for(let b=0;b<f.length;b++)y=(y<<5)-y+f.charCodeAt(b),y|=0;return y}(u);else{if(typeof u!="number")throw new ai(`Invalid seed input: ${u}`);c=u}return r+a_(c)()*(a-r)}]});class vh{constructor(e,r,a,u){this.expression=e,this._warningHistory={},this._evaluator=new Fc(a,u),this._defaultValue=r?function(c){return c.type==="color"&&(yh(c.default)||Array.isArray(c.default))?new nn(0,0,0,0):c.type==="color"?nn.parse(c.default)||null:c.default===void 0?null:c.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=Ya(e)}evaluateWithoutErrorHandling(e,r,a,u,c,f,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,u,c,f,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new ai(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function Ef(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Rl}function zl(o,e,r,a){const u=new cf(Rl,[],e?function(f){const y={color:ns,string:sn,number:Ht,enum:sn,boolean:Kr,formatted:Vo,resolvedImage:Ha};return f.type==="array"?Pi(y[f.value]||Gr,f.length):y[f.type]}(e):void 0,void 0,void 0,r,a),c=u.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Sf(new vh(c,e,r,a)):ba(u.errors)}class xh{constructor(e,r,a,u){this.kind=e,this._styleExpression=r,this.isLightConstant=a,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!$c(r.expression),this.configDependencies=Ya(r.expression)}evaluateWithoutErrorHandling(e,r,a,u,c,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,c,f)}evaluate(e,r,a,u,c,f){return this._styleExpression.evaluate(e,r,a,u,c,f)}}class Ll{constructor(e,r,a,u,c,f){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!$c(r.expression),this.isLightConstant=c,this.isLineProgressConstant=f,this.configDependencies=Ya(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,a,u,c,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,c,f)}evaluate(e,r,a,u,c,f){return this._styleExpression.evaluate(e,r,a,u,c,f)}interpolationFactor(e,r,a){return this.interpolationType?Ts.interpolationFactor(this.interpolationType,e,r,a):0}}function p_(o,e,r,a){if((o=zl(o,e,r,a)).result==="error")return o;const u=o.value.expression,c=Cl(u);if(!c&&!Dl(e))return ba([new Vs("","data expressions not supported")]);const f=qo(u,["zoom","pitch","distance-from-center"]);if(!f&&!u_(e))return ba([new Vs("","zoom expressions not supported")]);const y=qo(u,["measure-light"]);if(!y&&!c_(e))return ba([new Vs("","measure-light expression not supported")]);const b=qo(u,["line-progress"]);if(!b&&!function(w){return qc(w.expression,"line-progress")}(e))return ba([new Vs("","line-progress expression not supported")]);const S=e.expression&&e.expression.relaxZoomRestriction,_=Ol(u);return _||f||S?_ instanceof Vs?ba([_]):_ instanceof Ts&&!gh(e)?ba([new Vs("",'"interpolate" expressions cannot be used with this property')]):Sf(_?new Ll(c&&b?"camera":"composite",o.value,_.labels,_ instanceof Ts?_.interpolation:void 0,y,b):new xh(c&&b?"constant":"source",o.value,y,b)):ba([new Vs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class bh{constructor(e,r){this._parameters=e,this._specification=r,Wu(this,h_(this._parameters,this._specification))}static deserialize(e){return new bh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ol(o){let e=null;if(o instanceof fh)e=Ol(o.result);else if(o instanceof dh){for(const r of o.args)if(e=Ol(r),e)break}else(o instanceof kr||o instanceof Ts)&&o.input instanceof is&&o.input.name==="zoom"&&(e=o);return e instanceof Vs||o.eachChild(r=>{const a=Ol(r);a instanceof Vs?e=a:e&&a&&e!==a&&(e=new Vs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Af,Mf,b0=function(){if(Mf)return Af;Mf=1,Af=e;var o=3;function e(r,a,u){var c=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var f=new Int32Array(this.arrayBuffer);r=f[0],this.d=(a=f[1])+2*(u=f[2]);for(var y=0;y<this.d*this.d;y++){var b=f[o+y],S=f[o+y+1];c.push(b===S?null:f.subarray(b,S))}var _=f[o+c.length+1];this.keys=f.subarray(f[o+c.length],_),this.bboxes=f.subarray(_),this.insert=this._insertReadonly}else{this.d=a+2*u;for(var w=0;w<this.d*this.d;w++)c.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=r,this.padding=u,this.scale=a/r,this.uid=0;var M=u/a*r;this.min=-M,this.max=r+M}return e.prototype.insert=function(r,a,u,c,f){this._forEachCell(a,u,c,f,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,a,u,c,f,y){this.cells[f].push(y)},e.prototype.query=function(r,a,u,c,f){var y=this.min,b=this.max;if(r<=y&&a<=y&&b<=u&&b<=c&&!f)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(r,a,u,c,this._queryCell,S,{},f),S},e.prototype._queryCell=function(r,a,u,c,f,y,b,S){var _=this.cells[f];if(_!==null)for(var w=this.keys,M=this.bboxes,T=0;T<_.length;T++){var E=_[T];if(b[E]===void 0){var C=4*E;(S?S(M[C+0],M[C+1],M[C+2],M[C+3]):r<=M[C+2]&&a<=M[C+3]&&u>=M[C+0]&&c>=M[C+1])?(b[E]=!0,y.push(w[E])):b[E]=!1}}},e.prototype._forEachCell=function(r,a,u,c,f,y,b,S){for(var _=this._convertToCellCoord(r),w=this._convertToCellCoord(a),M=this._convertToCellCoord(u),T=this._convertToCellCoord(c),E=_;E<=M;E++)for(var C=w;C<=T;C++){var O=this.d*C+E;if((!S||S(this._convertFromCellCoord(E),this._convertFromCellCoord(C),this._convertFromCellCoord(E+1),this._convertFromCellCoord(C+1)))&&f.call(this,r,a,u,c,O,y,b,S))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,a=o+this.cells.length+1+1,u=0,c=0;c<this.cells.length;c++)u+=this.cells[c].length;var f=new Int32Array(a+u+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var y=a,b=0;b<r.length;b++){var S=r[b];f[o+b]=y,f.set(S,y),y+=S.length}return f[o+r.length]=y,f.set(this.keys,y),f[o+r.length+1]=y+=this.keys.length,f.set(this.bboxes,y),y+=this.bboxes.length,f.buffer},Af}(),kl=G(b0);const Xc={};function Ft(o,e,r={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),Xc[e]={klass:o,omit:r.omit||[]}}Ft(Object,"Object"),kl.serialize=function(o,e){const r=o.toArrayBuffer();return e&&e.add(r),{buffer:r}},kl.deserialize=function(o){return new kl(o.buffer)},Object.defineProperty(kl,"name",{value:"Grid"}),Ft(kl,"Grid"),typeof DOMMatrix<"u"&&Ft(DOMMatrix,"DOMMatrix"),Ft(nn,"Color"),Ft(Error,"Error"),Ft(Vi,"Formatted"),Ft(Oc,"FormattedSection"),Ft(Ni,"AJAXError"),Ft(Ei,"ResolvedImage"),Ft(bh,"StylePropertyFunction"),Ft(vh,"StyleExpression",{omit:["_evaluator"]}),Ft(bs,"ImageId"),Ft(Eo,"ImageVariant"),Ft(Ll,"ZoomDependentExpression"),Ft(xh,"ZoomConstantExpression"),Ft(is,"CompoundExpression",{omit:["_evaluate"]});for(const o in Rl)Xc[Rl[o]._classRegistryKey]||Ft(Rl[o],`Expression${o}`);function If(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function m_(o){return self.ImageBitmap&&o instanceof ImageBitmap}function Ss(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(If(o)||m_(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const r=[];for(const a of o)r.push(Ss(a,e));return r}if(o instanceof Map){const r={$name:"Map",entries:[]};for(const[a,u]of o.entries())r.entries.push(Ss(a),Ss(u));return r}if(o instanceof Set){const r={$name:"Set"};let a=0;for(const u of o.values())r[++a]=Ss(u);return r}if(o instanceof DOMMatrix){const r={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const u of a)r[u]=o[u];return r}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const r=o.constructor,a=r._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const u=r.serialize?r.serialize(o,e):{};if(!r.serialize){for(const c in o)o.hasOwnProperty(c)&&(Xc[a].omit.indexOf(c)>=0||(u[c]=Ss(o[c],e)));o instanceof Error&&(u.message=o.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof o)}function wa(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||If(o)||m_(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(wa);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const u=o.entries||[],c=new Map;for(let f=0;f<u.length;f+=2)c.set(wa(u[f]),wa(u[f+1]));return c}if(e==="Set"){const u=new Set;for(const c of Object.keys(o))c!=="$name"&&u.add(wa(o[c]));return u}if(e==="DOMMatrix"){let u;return u=o.is2D?[o.a,o.b,o.c,o.d,o.e,o.f]:[o.m11,o.m12,o.m13,o.m14,o.m21,o.m22,o.m23,o.m24,o.m31,o.m32,o.m33,o.m34,o.m41,o.m42,o.m43,o.m44],new DOMMatrix(u)}if(e==="BigInt")return BigInt(o.value);const{klass:r}=Xc[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(o);const a=Object.create(r.prototype);for(const u of Object.keys(o))u!=="$name"&&(a[u]=wa(o[u]));return a}throw new Error("can't deserialize object of type "+typeof o)}const Qt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function Cf(o){for(const e of o)if(wh(e.charCodeAt(0)))return!0;return!1}function __(o){for(const e of o)if(!g_(e.charCodeAt(0)))return!1;return!0}function g_(o){return!(Qt.Arabic(o)||Qt["Arabic Supplement"](o)||Qt["Arabic Extended-A"](o)||Qt["Arabic Presentation Forms-A"](o)||Qt["Arabic Presentation Forms-B"](o))}function wh(o){return!(o!==746&&o!==747&&(o<4352||!(Qt["Bopomofo Extended"](o)||Qt.Bopomofo(o)||Qt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Qt["CJK Compatibility Ideographs"](o)||Qt["CJK Compatibility"](o)||Qt["CJK Radicals Supplement"](o)||Qt["CJK Strokes"](o)||!(!Qt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Qt["CJK Unified Ideographs Extension A"](o)||Qt["CJK Unified Ideographs"](o)||Qt["Enclosed CJK Letters and Months"](o)||Qt["Hangul Compatibility Jamo"](o)||Qt["Hangul Jamo Extended-A"](o)||Qt["Hangul Jamo Extended-B"](o)||Qt["Hangul Jamo"](o)||Qt["Hangul Syllables"](o)||Qt.Hiragana(o)||Qt["Ideographic Description Characters"](o)||Qt.Kanbun(o)||Qt["Kangxi Radicals"](o)||Qt["Katakana Phonetic Extensions"](o)||Qt.Katakana(o)&&o!==12540||!(!Qt["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Qt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Qt["Unified Canadian Aboriginal Syllabics"](o)||Qt["Unified Canadian Aboriginal Syllabics Extended"](o)||Qt["Vertical Forms"](o)||Qt["Yijing Hexagram Symbols"](o)||Qt["Yi Syllables"](o)||Qt["Yi Radicals"](o))))}function Pf(o){return!(wh(o)||function(e){return!!(Qt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Qt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Qt["Letterlike Symbols"](e)||Qt["Number Forms"](e)||Qt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Qt["Control Pictures"](e)&&e!==9251||Qt["Optical Character Recognition"](e)||Qt["Enclosed Alphanumerics"](e)||Qt["Geometric Shapes"](e)||Qt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Qt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qt["CJK Symbols and Punctuation"](e)||Qt.Katakana(e)||Qt["Private Use Area"](e)||Qt["CJK Compatibility Forms"](e)||Qt["Small Form Variants"](e)||Qt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(o))}function Rf(o){return Qt.Arabic(o)||Qt["Arabic Supplement"](o)||Qt["Arabic Extended-A"](o)||Qt["Arabic Presentation Forms-A"](o)||Qt["Arabic Presentation Forms-B"](o)}function Th(o){return o>=1424&&o<=2303||Qt["Arabic Presentation Forms-A"](o)||Qt["Arabic Presentation Forms-B"](o)}function y_(o,e){return!(!e&&Th(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Qt.Khmer(o))}function w0(o){for(const e of o)if(Th(e.charCodeAt(0)))return!0;return!1}const Mo="deferred",Df="loading",zf="loaded";let Sh=null,as="unavailable",no=null;const Lf=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(as="error"),Sh&&Sh(o)};function Fl(){Eh.fire(new So("pluginStateChange",{pluginStatus:as,pluginURL:no}))}const Eh=new _a,Of=function(){return as},v_=function(){if(as!==Mo||!no)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");as=Df,Fl(),no&&$a({url:no},o=>{o?Lf(o):(as=zf,Fl())})},ls={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>as===zf||ls.applyArabicShaping!=null,isLoading:()=>as===Df,setState(o){as=o.pluginStatus,no=o.pluginURL},isParsed:()=>ls.applyArabicShaping!=null&&ls.processBidirectionalText!=null&&ls.processStyledBidirectionalText!=null,getPluginURL:()=>no};class bn{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,a){for(const u of r)if(!y_(u.charCodeAt(0),a))return!1;return!0}(e,ls.isLoaded())}}class Ah{constructor(e,r,a,u){this.property=e,this.value=r,this.expression=function(c,f,y,b){if(yh(c))return new bh(c,f);if(Ef(c)||Array.isArray(c)&&c.length>0){const S=p_(c,f,y,b);if(S.result==="error")throw new Error(S.value.map(_=>`${_.key}: ${_.message}`).join(", "));return S.value}{let S=c;return typeof c=="string"&&f.type==="color"&&(S=nn.parse(c)),{kind:"constant",configDependencies:new Set,evaluate:()=>S}}}(r===void 0?e.specification.default:r,e.specification,a,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class Mh{constructor(e,r,a){this.property=e,this.value=new Ah(e,void 0,r,a)}transitioned(e,r){return new Kc(this.property,this.value,r,Ur({},e.transition,this.transition),e.now)}untransitioned(){return new Kc(this.property,this.value,null,{},0)}}class Ih{constructor(e,r,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=a,this.configDependencies=new Set}getValue(e){return Jn(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Mh(this._values[e].property,this._scope,this._options)),this._values[e].value=new Ah(this._values[e].property,r===null?void 0:Jn(r),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);const a=this._properties.properties;if(e)for(const u in e){const c=e[u];if(u.endsWith("-transition")){const f=u.slice(0,-11);a[f]&&this.setTransition(f,c)}else a.hasOwnProperty(u)&&this.setValue(u,c)}}getTransition(e){return Jn(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new Mh(this._values[e].property)),this._values[e].transition=Jn(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const a=new el(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,r._values[u]);return a}untransitioned(){const e=new el(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class Kc{constructor(e,r,a,u,c){const f=u.delay||0,y=u.duration||0;c=c||0,this.property=e,this.value=r,this.begin=c+f,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const u=e.now||0,c=this.value.possiblyEvaluate(e,r,a),f=this.prior;if(f){if(u>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(u<this.begin)return f.possiblyEvaluate(e,r,a);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,a),c,Gt(y))}}return c}}class el{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const u=new Nl(this._properties);for(const c of Object.keys(this._values))u._values[c]=this._values[c].possiblyEvaluate(e,r,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class T0{constructor(e,r,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=a,this.configDependencies=new Set}getValue(e){return Jn(this._values[e].value)}setValue(e,r){this._values[e]=new Ah(this._values[e].property,r===null?void 0:Jn(r),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const u=new Nl(this._properties);for(const c of Object.keys(this._values))u._values[c]=this._values[c].possiblyEvaluate(e,r,a);return u}}class Bl{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,u){return this.property.evaluate(this.value,this.parameters,e,r,a,u)}}class Nl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class wt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const u=Xr[this.specification.type];return u?u(e,r,a):e}}class kt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,u){return new Bl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,u)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Bl(this,{kind:"constant",value:void 0},e.parameters);const u=Xr[this.specification.type];return u?new Bl(this,{kind:"constant",value:u(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,u,c,f){return e.kind==="constant"?e.value:e.evaluate(r,a,u,c,f)}}class tl{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){return!!e.expression.evaluate(r,null,{},a,u)}interpolate(){return!1}}class jn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new bn(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const c=this.defaultPropertyValues[a]=new Ah(u,void 0),f=this.defaultTransitionablePropertyValues[a]=new Mh(u);this.defaultTransitioningPropertyValues[a]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=c.possiblyEvaluate(r)}}}Ft(kt,"DataDrivenProperty"),Ft(wt,"DataConstantProperty"),Ft(tl,"ColorRampProperty");var Ue=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function x_(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Ch(o){if(Array.isArray(o))return o.map(Ch);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const r in o)e[r]=Ch(o[r]);return e}return x_(o)}function kf(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!kf(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ff(o,e="",r=null,a="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};kf(o)||(o=Zo(o));const u=o;let c=!0;try{c=function(_){if(!Vl(_))return _;let w=Ch(_);return w_(w),w=b_(w),w}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let f=null,y=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){y=Ue[`filter_${a}`];const _=zl(c,y,e,r);if(_.result==="error")throw new Error(_.value.map(w=>`${w.key}: ${w.message}`).join(", "));f=(w,M,T)=>_.value.evaluate(w,M,{},T)}let b=null,S=null;if(c!==u){const _=zl(u,y,e,r);if(_.result==="error")throw new Error(_.value.map(w=>`${w.key}: ${w.message}`).join(", "));b=(w,M,T,E,C)=>_.value.evaluate(w,M,{},T,void 0,void 0,E,C),S=!Cl(_.value.expression)}return{filter:f,dynamicFilter:b||void 0,needGeometry:T_(c),needFeature:!!S}}function b_(o){if(!Array.isArray(o))return o;const e=function(r){if(S0.has(r[0])){for(let a=1;a<r.length;a++)if(Vl(r[a]))return!0}return r}(o);return e===!0?e:e.map(r=>b_(r))}function w_(o){let e=!1;const r=[];if(o[0]==="case"){for(let a=1;a<o.length-1;a+=2)e=e||Vl(o[a]),r.push(o[a+1]);r.push(o[o.length-1])}else if(o[0]==="match"){e=e||Vl(o[1]);for(let a=2;a<o.length-1;a+=2)r.push(o[a+1]);r.push(o[o.length-1])}else if(o[0]==="step"){e=e||Vl(o[1]);for(let a=1;a<o.length-1;a+=2)r.push(o[a+1])}e&&(o.length=0,o.push("any",...r));for(let a=1;a<o.length;a++)w_(o[a])}function Vl(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<o.length;r++)if(Vl(o[r]))return!0;return!1}const S0=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function E0(o,e){return o<e?-1:o>e?1:0}function T_(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(T_(o[e]))return!0;return!1}function Zo(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?Ph(o[1],o[2],"=="):e==="!="?Rh(Ph(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ph(o[1],o[2],e):e==="any"?(r=o.slice(1),["any"].concat(r.map(Zo))):e==="all"?["all"].concat(o.slice(1).map(Zo)):e==="none"?["all"].concat(o.slice(1).map(Zo).map(Rh)):e==="in"?Bf(o[1],o.slice(2)):e==="!in"?Rh(Bf(o[1],o.slice(2))):e==="has"?Yc(o[1]):e!=="!has"||Rh(Yc(o[1]));var r}function Ph(o,e,r){switch(o){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,o,e]}}function Bf(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",o,["literal",e.sort(E0)]]:["filter-in-small",o,["literal",e]]}}function Yc(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Rh(o){return["!",o]}const Dh="";function Es(o,e){return e?`${o}${Dh}${e}`:o}const Nf="-transition",Ul=new Set(["fill","line","background","hillshade","raster"]);class Yi extends _a{constructor(e,r,a,u,c){if(super(),this.id=e.id,this.fqid=Es(this.id,a),this.type=e.type,this.scope=a,this.lut=u,this.options=c,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=zl(this.filter,Ue[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new T0(r.layout,this.scope,c),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new Ih(r.paint,this.scope,c);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Nl(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Ul.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Nf)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const a=this._transitionablePaint,u=a._properties.properties;if(e.endsWith(Nf)){const w=e.slice(0,-11);return u[w]&&a.setTransition(w,r||void 0),!1}if(!u[e])return!1;const c=a._values[e],f=c.value.isDataDriven(),y=c.value;a.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=a._values[e].value,S=b.isDataDriven(),_=e.endsWith("pattern")||e==="line-dasharray";return S||f||_||this._handleOverridablePaintPropertyUpdate(e,y,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,a){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return bo({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(e){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Bl&&Dl(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Ff(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,a,u,c,f,y,b,S){}}const A0={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Jc{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class En{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Jr(o,e=1){let r=0,a=0;return{members:o.map(u=>{const c=A0[u.type].BYTES_PER_ELEMENT,f=r=Vf(r,Math.max(e,c)),y=u.components||1;return a=Math.max(a,c),r+=c*y,{name:u.name,type:u.type,components:y,offset:f}}),size:Vf(r,Math.max(a,e)),alignment:e}}function Vf(o,e){return Math.ceil(o/e)*e}class Io extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=a,e}}Io.prototype.bytesPerElement=4,Ft(Io,"StructArrayLayout2i4");class rl extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const c=3*e;return this.int16[c+0]=r,this.int16[c+1]=a,this.int16[c+2]=u,e}}rl.prototype.bytesPerElement=6,Ft(rl,"StructArrayLayout3i6");class nl extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a,u)}emplace(e,r,a,u,c){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=a,this.int16[f+2]=u,this.int16[f+3]=c,e}}nl.prototype.bytesPerElement=8,Ft(nl,"StructArrayLayout4i8");class Ta extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}Ta.prototype.bytesPerElement=4,Ft(Ta,"StructArrayLayout1f4");class Uf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const c=4*e,f=2*e;return this.int16[c+0]=r,this.int16[c+1]=a,this.float32[f+1]=u,e}}Uf.prototype.bytesPerElement=8,Ft(Uf,"StructArrayLayout2i1f8");class $s extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const c=4*e;return this.int16[c+0]=r,this.int16[c+1]=a,this.int16[c+2]=u,e}}$s.prototype.bytesPerElement=8,Ft($s,"StructArrayLayout3i8");class jf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u,c)}emplace(e,r,a,u,c,f){const y=5*e;return this.int16[y+0]=r,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=c,this.int16[y+4]=f,e}}jf.prototype.bytesPerElement=10,Ft(jf,"StructArrayLayout5i10");class zh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,c,f,y)}emplace(e,r,a,u,c,f,y,b){const S=6*e,_=12*e,w=3*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.uint8[_+4]=u,this.uint8[_+5]=c,this.uint8[_+6]=f,this.uint8[_+7]=y,this.float32[w+2]=b,e}}zh.prototype.bytesPerElement=12,Ft(zh,"StructArrayLayout2i4ub1f12");class Co extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const c=3*e;return this.float32[c+0]=r,this.float32[c+1]=a,this.float32[c+2]=u,e}}Co.prototype.bytesPerElement=12,Ft(Co,"StructArrayLayout3f12");class Sa extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u,c)}emplace(e,r,a,u,c,f){const y=6*e,b=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=a,this.uint16[y+2]=u,this.uint16[y+3]=c,this.float32[b+2]=f,e}}Sa.prototype.bytesPerElement=12,Ft(Sa,"StructArrayLayout4ui1f12");class Lh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a,u)}emplace(e,r,a,u,c){const f=4*e;return this.uint16[f+0]=r,this.uint16[f+1]=a,this.uint16[f+2]=u,this.uint16[f+3]=c,e}}Lh.prototype.bytesPerElement=8,Ft(Lh,"StructArrayLayout4ui8");class Oh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,c,f)}emplace(e,r,a,u,c,f,y){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+3]=c,this.int16[b+4]=f,this.int16[b+5]=y,e}}Oh.prototype.bytesPerElement=12,Ft(Oh,"StructArrayLayout6i12");class $f extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y,b,S,_,w,M){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,a,u,c,f,y,b,S,_,w,M)}emplace(e,r,a,u,c,f,y,b,S,_,w,M,T){const E=12*e;return this.int16[E+0]=r,this.int16[E+1]=a,this.int16[E+2]=u,this.int16[E+3]=c,this.uint16[E+4]=f,this.uint16[E+5]=y,this.uint16[E+6]=b,this.uint16[E+7]=S,this.int16[E+8]=_,this.int16[E+9]=w,this.int16[E+10]=M,this.int16[E+11]=T,e}}$f.prototype.bytesPerElement=24,Ft($f,"StructArrayLayout4i4ui4i24");class Gf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,c,f)}emplace(e,r,a,u,c,f,y){const b=10*e,S=5*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=u,this.float32[S+2]=c,this.float32[S+3]=f,this.float32[S+4]=y,e}}Gf.prototype.bytesPerElement=20,Ft(Gf,"StructArrayLayout3i3f20");class il extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a,u)}emplace(e,r,a,u,c){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=a,this.float32[f+2]=u,this.float32[f+3]=c,e}}il.prototype.bytesPerElement=16,Ft(il,"StructArrayLayout4f16");class Hf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Hf.prototype.bytesPerElement=4,Ft(Hf,"StructArrayLayout1ul4");class Ea extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=a,e}}Ea.prototype.bytesPerElement=4,Ft(Ea,"StructArrayLayout2ui4");class kh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y,b,S,_,w,M,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,a,u,c,f,y,b,S,_,w,M,T)}emplace(e,r,a,u,c,f,y,b,S,_,w,M,T,E){const C=20*e,O=10*e;return this.int16[C+0]=r,this.int16[C+1]=a,this.int16[C+2]=u,this.int16[C+3]=c,this.int16[C+4]=f,this.float32[O+3]=y,this.float32[O+4]=b,this.float32[O+5]=S,this.float32[O+6]=_,this.int16[C+14]=w,this.uint32[O+8]=M,this.uint16[C+18]=T,this.uint16[C+19]=E,e}}kh.prototype.bytesPerElement=40,Ft(kh,"StructArrayLayout5i4f1i1ul2ui40");class Fh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,c,f,y)}emplace(e,r,a,u,c,f,y,b){const S=8*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=u,this.int16[S+4]=c,this.int16[S+5]=f,this.int16[S+6]=y,this.int16[S+7]=b,e}}Fh.prototype.bytesPerElement=16,Ft(Fh,"StructArrayLayout3i2i2i16");class qf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u,c)}emplace(e,r,a,u,c,f){const y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=u,this.int16[b+6]=c,this.int16[b+7]=f,e}}qf.prototype.bytesPerElement=16,Ft(qf,"StructArrayLayout2f1f2i16");class Wf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,c,f)}emplace(e,r,a,u,c,f,y){const b=20*e,S=5*e;return this.uint8[b+0]=r,this.uint8[b+1]=a,this.float32[S+1]=u,this.float32[S+2]=c,this.float32[S+3]=f,this.float32[S+4]=y,e}}Wf.prototype.bytesPerElement=20,Ft(Wf,"StructArrayLayout2ub4f20");class wi extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const c=3*e;return this.uint16[c+0]=r,this.uint16[c+1]=a,this.uint16[c+2]=u,e}}wi.prototype.bytesPerElement=6,Ft(wi,"StructArrayLayout3ui6");class Bh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$)}emplace(e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$,Z){const K=30*e,ae=15*e,ie=60*e;return this.int16[K+0]=r,this.int16[K+1]=a,this.int16[K+2]=u,this.float32[ae+2]=c,this.float32[ae+3]=f,this.uint16[K+8]=y,this.uint16[K+9]=b,this.uint32[ae+5]=S,this.uint32[ae+6]=_,this.uint32[ae+7]=w,this.uint16[K+16]=M,this.uint16[K+17]=T,this.uint16[K+18]=E,this.float32[ae+10]=C,this.float32[ae+11]=O,this.uint8[ie+48]=k,this.uint8[ie+49]=U,this.uint8[ie+50]=V,this.uint32[ae+13]=N,this.int16[K+28]=$,this.uint8[ie+58]=Z,e}}Bh.prototype.bytesPerElement=60,Ft(Bh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Po extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$,Z,K,ae,ie,se,ve,le,xe,Me,Se,Ce,Ie){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$,Z,K,ae,ie,se,ve,le,xe,Me,Se,Ce,Ie)}emplace(e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V,N,$,Z,K,ae,ie,se,ve,le,xe,Me,Se,Ce,Ie,Fe){const ze=20*e,Ne=40*e,st=80*e;return this.float32[ze+0]=r,this.float32[ze+1]=a,this.int16[Ne+4]=u,this.int16[Ne+5]=c,this.int16[Ne+6]=f,this.int16[Ne+7]=y,this.int16[Ne+8]=b,this.int16[Ne+9]=S,this.int16[Ne+10]=_,this.int16[Ne+11]=w,this.int16[Ne+12]=M,this.uint16[Ne+13]=T,this.uint16[Ne+14]=E,this.uint16[Ne+15]=C,this.uint16[Ne+16]=O,this.uint16[Ne+17]=k,this.uint16[Ne+18]=U,this.uint16[Ne+19]=V,this.uint16[Ne+20]=N,this.uint16[Ne+21]=$,this.uint16[Ne+22]=Z,this.uint16[Ne+23]=K,this.uint16[Ne+24]=ae,this.uint16[Ne+25]=ie,this.uint16[Ne+26]=se,this.uint16[Ne+27]=ve,this.uint32[ze+14]=le,this.float32[ze+15]=xe,this.float32[ze+16]=Me,this.float32[ze+17]=Se,this.float32[ze+18]=Ce,this.uint8[st+76]=Ie,this.uint16[Ne+39]=Fe,e}}Po.prototype.bytesPerElement=80,Ft(Po,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Aa extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u,c)}emplace(e,r,a,u,c,f){const y=5*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=c,this.float32[y+4]=f,e}}Aa.prototype.bytesPerElement=20,Ft(Aa,"StructArrayLayout5f20");class Zf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,c,f,y)}emplace(e,r,a,u,c,f,y,b){const S=7*e;return this.float32[S+0]=r,this.float32[S+1]=a,this.float32[S+2]=u,this.float32[S+3]=c,this.float32[S+4]=f,this.float32[S+5]=y,this.float32[S+6]=b,e}}Zf.prototype.bytesPerElement=28,Ft(Zf,"StructArrayLayout7f28");class Xf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y,b,S,_,w){const M=this.length;return this.resize(M+1),this.emplace(M,e,r,a,u,c,f,y,b,S,_,w)}emplace(e,r,a,u,c,f,y,b,S,_,w,M){const T=11*e;return this.float32[T+0]=r,this.float32[T+1]=a,this.float32[T+2]=u,this.float32[T+3]=c,this.float32[T+4]=f,this.float32[T+5]=y,this.float32[T+6]=b,this.float32[T+7]=S,this.float32[T+8]=_,this.float32[T+9]=w,this.float32[T+10]=M,e}}Xf.prototype.bytesPerElement=44,Ft(Xf,"StructArrayLayout11f44");class Kf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y,b,S){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,c,f,y,b,S)}emplace(e,r,a,u,c,f,y,b,S,_){const w=9*e;return this.float32[w+0]=r,this.float32[w+1]=a,this.float32[w+2]=u,this.float32[w+3]=c,this.float32[w+4]=f,this.float32[w+5]=y,this.float32[w+6]=b,this.float32[w+7]=S,this.float32[w+8]=_,e}}Kf.prototype.bytesPerElement=36,Ft(Kf,"StructArrayLayout9f36");class Ma extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=a,e}}Ma.prototype.bytesPerElement=8,Ft(Ma,"StructArrayLayout2f8");class Nh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,a,u)}emplace(e,r,a,u,c){const f=6*e;return this.uint32[3*e+0]=r,this.uint16[f+2]=a,this.uint16[f+3]=u,this.uint16[f+4]=c,e}}Nh.prototype.bytesPerElement=12,Ft(Nh,"StructArrayLayout1ul3ui12");class Vh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Vh.prototype.bytesPerElement=2,Ft(Vh,"StructArrayLayout1ui2");class Yf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O)}emplace(e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k){const U=16*e;return this.float32[U+0]=r,this.float32[U+1]=a,this.float32[U+2]=u,this.float32[U+3]=c,this.float32[U+4]=f,this.float32[U+5]=y,this.float32[U+6]=b,this.float32[U+7]=S,this.float32[U+8]=_,this.float32[U+9]=w,this.float32[U+10]=M,this.float32[U+11]=T,this.float32[U+12]=E,this.float32[U+13]=C,this.float32[U+14]=O,this.float32[U+15]=k,e}}Yf.prototype.bytesPerElement=64,Ft(Yf,"StructArrayLayout16f64");class Qc extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,c,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,c,f,y)}emplace(e,r,a,u,c,f,y,b){const S=10*e,_=5*e;return this.uint16[S+0]=r,this.uint16[S+1]=a,this.uint16[S+2]=u,this.uint16[S+3]=c,this.float32[_+2]=f,this.float32[_+3]=y,this.float32[_+4]=b,e}}Qc.prototype.bytesPerElement=20,Ft(Qc,"StructArrayLayout4ui3f20");class Jf extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}Jf.prototype.bytesPerElement=2,Ft(Jf,"StructArrayLayout1i2");class Uh extends En{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Uh.prototype.bytesPerElement=1,Ft(Uh,"StructArrayLayout1ub1");class eu extends Jc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}eu.prototype.size=40;class S_ extends kh{get(e){return new eu(this,e)}}Ft(S_,"CollisionBoxArray");class E_ extends Jc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}E_.prototype.size=60;class A_ extends Bh{get(e){return new E_(this,e)}}Ft(A_,"PlacedSymbolArray");class M_ extends Jc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}M_.prototype.size=80;class I_ extends Po{get(e){return new M_(this,e)}}Ft(I_,"SymbolInstanceArray");class tu extends Ta{getoffsetX(e){return this.float32[1*e+0]}}Ft(tu,"GlyphOffsetArray");class ru extends Io{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ft(ru,"SymbolLineVertexArray");class cs extends Jc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}cs.prototype.size=12;class nu extends Nh{get(e){return new cs(this,e)}}Ft(nu,"FeatureIndexArray");class C_ extends Ea{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ft(C_,"FillExtrusionCentroidArray");class P_ extends Jc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}P_.prototype.size=6;class R_ extends rl{get(e){return new P_(this,e)}}Ft(R_,"FillExtrusionWallArray");const M0=Jr([{name:"a_pos",components:2,type:"Int16"}],4),Qf=Jr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $n{constructor(e=[]){this.segments=e}_prepareSegment(e,r,a,u){let c=this.segments[this.segments.length-1];return e>$n.MAX_VERTEX_ARRAY_LENGTH&&Pr(`Max vertices per segment is ${$n.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>$n.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==u)&&(c={vertexOffset:r,primitiveOffset:a,vertexLength:0,primitiveLength:0},u!==void 0&&(c.sortKey=u),this.segments.push(c)),c}prepareSegment(e,r,a,u){return this._prepareSegment(e,r.length,a.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,u){return new $n([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function jh(o,e){return 256*(o=Ye(Math.floor(o),0,255))+Ye(Math.floor(e),0,255)}$n.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ft($n,"SegmentVector");const I0=Jr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),C0=Jr([{name:"a_dash",components:4,type:"Uint16"}]);class jl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,a,u){this.ids.push($h(e)),this.positions.push(r,a,u)}eachPosition(e,r){const a=$h(e);let u=0,c=this.ids.length-1;for(;u<c;){const f=u+c>>1;this.ids[f]>=a?c=f:u=f+1}for(;this.ids[u]===a;)r(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,r){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return ep(a,u,0,a.length-1),r&&(r.add(a.buffer),r.add(u.buffer)),{ids:a,positions:u}}static deserialize(e){const r=new jl;let a;r.ids=e.ids,r.positions=e.positions;for(const u of r.ids)u!==a&&r.uniqueIds.push(u),a=u;return r.indexed=!0,r}}function $h(o){const e=+o;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Qs(String(o))}function ep(o,e,r,a){for(;r<a;){const u=o[r+a>>1];let c=r-1,f=a+1;for(;;){do c++;while(o[c]<u);do f--;while(o[f]>u);if(c>=f)break;iu(o,c,f),iu(e,3*c,3*f),iu(e,3*c+1,3*f+1),iu(e,3*c+2,3*f+2)}f-r<a-f?(ep(o,e,r,f),r=f+1):(ep(o,e,f+1,a),a=f)}}function iu(o,e,r){const a=o[e];o[e]=o[r],o[r]=a}Ft(jl,"FeaturePositionMap");class Ro{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Gh extends Ro{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class ei extends Ro{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class As extends Ro{constructor(e){super(e),this.current=[0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Hh extends Ro{constructor(e){super(e),this.current=[0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class qh extends Ro{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class tp extends Ro{constructor(e){super(e),this.current=nn.transparent.toRenderColor(null)}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const P0=new Float32Array(16);class sl extends Ro{constructor(e){super(e),this.current=P0}set(e,r,a){if(this.fetchUniformLocation(e,r)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const R0=new Float32Array(9),D0=new Float32Array(4);class rp extends Ro{constructor(e){super(e),this.current=D0}set(e,r,a){if(this.fetchUniformLocation(e,r)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function np(o){return[jh(255*o.r,255*o.g),jh(255*o.b,255*o.a)]}class $l{constructor(e,r,a,u){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=a,this.context=u}setUniform(e,r,a,u,c){const f=u.constantOr(this.value);r.set(e,c,f instanceof nn?f.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,r){return this.type==="color"?new tp(e):new ei(e)}}class Gl{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,u,c){const f=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;f&&r.set(e,c,f)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new qh(e):new ei(e)}}class Xo{constructor(e,r,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(c=>({name:`a_${c}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,a,u,c,f,y){const b=this.paintVertexArray.length,S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new bn(0,{brightness:f}),r,{},c,u,y):this.expression.kind==="constant"&&this.expression.value,_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bn(0,{brightness:f}),r,{},c,u,y):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(b,e,S,_?null:this.context.lut)}updatePaintArray(e,r,a,u,c,f,y){const b=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:y},a,u,void 0,c):this.expression.kind==="constant"&&this.expression.value,S=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bn(0,{brightness:y}),a,u,void 0,c):this.lutExpression.value)==="none";this._setPaintValue(e,r,b,S?null:this.context.lut)}_setPaintValue(e,r,a,u){if(this.type==="color"){const c=np(a.toRenderColor(u));for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class io{constructor(e,r,a,u,c,f){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=u,this.context=c,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,a,u,c,f,y){const b=this.expression.evaluate(new bn(this.context.zoom,{brightness:f}),r,{},c,u,y),S=this.expression.evaluate(new bn(this.context.zoom+1,{brightness:f}),r,{},c,u,y),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bn(0,{brightness:f}),r,{},c,u,y):this.lutExpression.value)==="none",w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,b,S,_?null:this.context.lut)}updatePaintArray(e,r,a,u,c,f,y){const b=this.expression.evaluate({zoom:this.context.zoom,brightness:y},a,u,void 0,c),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y},a,u,void 0,c),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new bn(0,{brightness:y}),a,u,void 0,c):this.lutExpression.value)==="none";this._setPaintValue(e,r,b,S,_?null:this.context.lut)}_setPaintValue(e,r,a,u,c){if(this.type==="color"){const f=np(a.toRenderColor(c)),y=np(a.toRenderColor(c));for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,f[0],f[1],y[0],y[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,u,c){const f=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=Ye(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);r.set(e,c,y)}getBinding(e,r){return new ei(e)}}class Ia{constructor(e,r,a,u,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(a==="array"?C0:I0).members;for(let f=0;f<r.length;++f);this.paintVertexArray=new u}populatePaintArray(e,r,a,u){const c=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,u,c,f,y){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(e,r,a,u){if(!u||!a)return;const c=u[a];if(!c)return;const{tl:f,br:y,pixelRatio:b}=c;for(let S=e;S<r;S++)this.paintVertexArray.emplace(S,f[0],f[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ol{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[],this.context=r;const u=[];for(const c in e.paint._values){const f=e.paint.get(c);if(c.endsWith("-use-theme")||!a(c)||!(f instanceof Bl&&Dl(f.property.specification)))continue;const y=L0(c,e.type),b=f.value,S=f.property.specification.type,_=!!f.property.useIntegerZoom,w=c==="line-dasharray"||c.endsWith("pattern"),M=e.paint.get(`${c}-use-theme`),T=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(b.kind!=="constant"||T)if(b.kind==="source"||T||w){const E=D_(c,S,"source");this.binders[c]=w?new Ia(b,y,S,E,e.id):new Xo(b,y,S,E),u.push(`/a_${c}`)}else{const E=D_(c,S,"composite");this.binders[c]=new io(b,y,S,_,r,E),u.push(`/z_${c}`)}else this.binders[c]=w?new Gl(b.value,y):new $l(b.value,y,S,r),u.push(`/u_${c}`);M&&(this.binders[c].lutExpression=M.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Xo||r instanceof io?r.maxValue:0}populatePaintArrays(e,r,a,u,c,f,y){for(const b in this.binders){const S=this.binders[b];S.context=this.context,(S instanceof Xo||S instanceof io||S instanceof Ia)&&S.populatePaintArray(e,r,a,u,c,f,y)}}setConstantPatternPositions(e){for(const r in this.binders){const a=this.binders[r];a instanceof Gl&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,u,c,f,y,b,S){let _=!1;const w=Object.keys(e),M=w.length!==0&&!b,T=M?w:r.uniqueIds;this.context.lut=c.lut;for(const E in this.binders){const C=this.binders[E];if(C.context=this.context,(C instanceof Xo||C instanceof io||C instanceof Ia)&&C.expression&&C.expression.kind&&C.expression.kind!=="constant"&&(C.expression.isStateDependent===!0||C.expression.isLightConstant===!1)){const O=c.paint.get(E);C.expression=O.value;for(const k of T){const U=e[k.toString()];r.eachPosition(k,(V,N,$)=>{const Z=u.feature(V);C.updatePaintArray(N,$,Z,U,f,y,S)})}if(!M)for(const k of a.uniqueIds){const U=e[k.toString()];a.eachPosition(k,(V,N,$)=>{const Z=u.feature(V);C.updatePaintArray(N,$,Z,U,f,y,S)})}_=!0}}return _}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof $l||a instanceof Gl)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Xo||a instanceof io||a instanceof Ia)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof $l||a instanceof Gl||a instanceof io)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof $l||u instanceof Gl||u instanceof io)for(const c of u.uniformNames)r.push({name:c,property:a,binding:u.getBinding(e,c)})}return r}setUniforms(e,r,a,u,c){for(const{name:f,property:y,binding:b}of a)this.binders[y].setUniform(e,b,c,u.get(y),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Xo||r instanceof io||r instanceof Ia)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof Xo||a instanceof io||a instanceof Ia)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Xo||r instanceof io||r instanceof Ia)&&r.destroy()}}}class Ca{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new ol(u,r,a);this.needsUpload=!1,this._featureMap=new jl,this._featureMapWithoutIds=new jl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,a,u,c,f,y,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,r,u,c,f,y,b);r.id!==void 0?this._featureMap.add(r.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,u,c,f,y){for(const b of a)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,b,u,c,f,y||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const z0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function L0(o,e){return z0[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const Wh={"line-pattern":{source:Sa,composite:Sa},"fill-pattern":{source:Sa,composite:Sa},"fill-extrusion-pattern":{source:Sa,composite:Sa},"line-dasharray":{source:Lh,composite:Lh}},O0={color:{source:Ma,composite:il},number:{source:Ta,composite:Ma}};function D_(o,e,r){const a=Wh[o];return a&&a[r]||O0[e][r]}Ft($l,"ConstantBinder"),Ft(Gl,"PatternConstantBinder"),Ft(Xo,"SourceExpressionBinder"),Ft(Ia,"PatternCompositeBinder"),Ft(io,"CompositeExpressionBinder"),Ft(ol,"ProgramConfiguration",{omit:["_buffers"]}),Ft(Ca,"ProgramConfigurationSet");const Ai=Ct/Math.PI/2,ip=5,sp=6,k0=16383,al=64,op=[al,32,16],Ms=-Ai,Gs=Ai;function Hl(o,e,r,a=Ai){return r=Rt(r),[o*Math.sin(r)*a,-e*a,o*Math.cos(r)*a]}function Pa(o,e,r){return Hl(Math.cos(Rt(o)),Math.sin(Rt(o)),e,r)}const ql=63710088e-1,ap=2*Math.PI*ql;class Qr{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Qr($r(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,u=e.lat*r,c=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return ql*Math.acos(Math.min(c,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new Ra({lng:this.lng-a,lat:this.lat-r},{lng:this.lng+a,lat:this.lat+r})}toEcef(e){return Pa(this.lat,this.lng,Ai+e*Ai/ql)}static convert(e){if(e instanceof Qr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Qr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Qr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ra{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){const a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{const a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof Qr?new Qr(e.lng,e.lat):Qr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Qr?new Qr(e.lng,e.lat):Qr.convert(e),this}extend(e){const r=this._sw,a=this._ne;let u,c;if(e instanceof Qr)u=e,c=e;else{if(!(e instanceof Ra))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ra.convert(e)):this.extend(Qr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Qr.convert(e)):this;if(u=e._sw,c=e._ne,!u||!c)return this}return r||a?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),a.lng=Math.max(c.lng,a.lng),a.lat=Math.max(c.lat,a.lat)):(this._sw=new Qr(u.lng,u.lat),this._ne=new Qr(c.lng,c.lat)),this}getCenter(){return new Qr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Qr(this.getWest(),this.getNorth())}getSouthEast(){return new Qr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=Qr.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){if(e)return e instanceof Ra?e:new Ra(e)}}const F0=0,z_=25.5;function su(o){return ap*Math.cos(o*Math.PI/180)}function Is(o){return(180+o)/360}function so(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Wi(o,e){return o/su(e)}function us(o){return 360*o-180}function Mi(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function lp(o,e){return o*su(Mi(e))}const Ji=85.051129;function cp(o){return Math.cos(Rt(Ye(o,-85.051129,Ji)))}function Wl(o,e){const r=Ye(e,F0,z_),a=Math.pow(2,r);return cp(o)*ap/(512*a)}function d(o){return 1/Math.cos(o*Math.PI/180)}function t(o,e=0){const r=Math.exp(Math.PI*(1-(o.y+e/Ct)/(1<<o.z)*2));return 80150034*r/(r*r+1)/Ct/(1<<o.z)}class s{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=Qr.convert(e);return new s(Is(a.lng),so(a.lat),Wi(r,a.lat))}toLngLat(){return new Qr(us(this.x),Mi(this.y))}toAltitude(){return lp(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ap*d(Mi(this.y))}}function h(o,e,r,a,u,c,f,y,b){const S=(e+a)/2,_=(r+u)/2,w=new Ae(S,_);y(w),function(M,T,E,C,O,k){const U=E-O,V=C-k;return Math.abs((C-T)*U-(E-M)*V)/Math.hypot(U,V)}(w.x,w.y,c.x,c.y,f.x,f.y)>=b?(h(o,e,r,S,_,c,w,y,b),h(o,S,_,a,u,w,f,y,b)):o.push(f)}function m(o,e,r){let a=o[0],u=a.x,c=a.y;e(a);const f=[a];for(let y=1;y<o.length;y++){const b=o[y],{x:S,y:_}=b;e(b),h(f,u,c,S,_,a,b,e,r),u=S,c=_,a=b}return f}function g(o,e,r,a){if(a(e,r)){const u=e.add(r)._mult(.5);g(o,e,u,a),g(o,u,r,a)}else o.push(r)}function x(o,e){let r=o[0];const a=[r];for(let u=1;u<o.length;u++){const c=o[u];g(a,r,c,e),r=c}return a}const I=Math.pow(2,14)-1,P=-I-1;function z(o,e){const r=Math.round(o.x*e),a=Math.round(o.y*e);return o.x=Ye(r,P,I),o.y=Ye(a,P,I),(r<o.x||r>o.x+1||a<o.y||a>o.y+1)&&Pr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function L(o,e,r){const a=o.loadGeometry(),u=o.extent,c=Ct/u;if(e&&r&&r.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:y,x:b,y:S,projection:_}=r,w=M=>{const T=us((e.x+M.x/u)/f),E=Mi((e.y+M.y/u)/f),C=_.project(T,E);M.x=(C.x*y-b)*u,M.y=(C.y*y-S)*u};for(let M=0;M<a.length;M++)if(o.type!==1)a[M]=m(a[M],w,1);else{const T=[];for(const E of a[M])E.x<0||E.x>=u||E.y<0||E.y>=u||(w(E),T.push(E));a[M]=T}}for(const f of a)for(const y of f)z(y,c);return a}function F(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?L(o):[]}}function B(o,e,r,a,u){o.emplaceBack(2*e+(a+1)/2,2*r+(u+1)/2)}function j(o,e,r){o.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class X{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Io,this.indexArray=new wi,this.segments=new $n,this.programConfigurations=new Ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(e,r){}populate(e,r,a,u){const c=this.layers[0],f=[];let y=null;c.type==="circle"&&(y=c.layout.get("circle-sort-key"));for(const{feature:S,id:_,index:w,sourceLayerIndex:M}of e){const T=this.layers[0]._featureFilter.needGeometry,E=F(S,T);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),E,a))continue;const C=y?y.evaluate(E,{},a):void 0,O={id:_,properties:S.properties,type:S.type,sourceLayerIndex:M,index:w,geometry:T?E.geometry:L(S,a,u),patterns:{},sortKey:C};f.push(O)}y&&f.sort((S,_)=>S.sortKey-_.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Oh,b=u.projection);for(const S of f){const{geometry:_,index:w,sourceLayerIndex:M}=S,T=e[w].feature;this.addFeature(S,_,w,r.availableImages,a,b,r.brightness),r.featureIndex.insert(T,_,w,M,this.index)}}update(e,r,a,u,c,f,y){this.programConfigurations.updatePaintArrays(e,r,c,a,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,M0.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Qf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,u,c,f,y){for(const b of r)for(const S of b){const _=S.x,w=S.y;if(_<0||_>=Ct||w<0||w>=Ct)continue;if(f){const E=f.projectTilePoint(_,w,c),C=f.upVector(c,_,w),O=this.globeExtVertexArray;j(O,E,C),j(O,E,C),j(O,E,C),j(O,E,C)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),T=M.vertexLength;B(this.layoutVertexArray,_,w,-1,-1),B(this.layoutVertexArray,_,w,1,-1),B(this.layoutVertexArray,_,w,1,1),B(this.layoutVertexArray,_,w,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+2,T+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,c,y)}}function q(o,e){for(let r=0;r<o.length;r++)if(me(e,o[r]))return!0;for(let r=0;r<e.length;r++)if(me(o,e[r]))return!0;return!!ue(o,e)}function J(o,e,r){return!!me(o,e)||!!ge(e,o,r)}function Q(o,e){if(o.length===1)return _e(e,o[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let u=0;u<a.length;u++)if(me(o,a[u]))return!0}for(let r=0;r<o.length;r++)if(_e(e,o[r]))return!0;for(let r=0;r<e.length;r++)if(ue(o,e[r]))return!0;return!1}function oe(o,e,r){if(o.length>1){if(ue(o,e))return!0;for(let a=0;a<e.length;a++)if(ge(e[a],o,r))return!0}for(let a=0;a<o.length;a++)if(ge(o[a],e,r))return!0;return!1}function ue(o,e){if(o.length===0||e.length===0)return!1;for(let r=0;r<o.length-1;r++){const a=o[r],u=o[r+1];for(let c=0;c<e.length-1;c++)if(ce(a,u,e[c],e[c+1]))return!0}return!1}function ce(o,e,r,a){return wo(o,r,a)!==wo(e,r,a)&&wo(o,e,r)!==wo(o,e,a)}function ge(o,e,r){const a=r*r;if(e.length===1)return o.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(pe(o,e[u-1],e[u])<a)return!0;return!1}function pe(o,e,r){const a=e.distSqr(r);if(a===0)return o.distSqr(e);const u=((o.x-e.x)*(r.x-e.x)+(o.y-e.y)*(r.y-e.y))/a;return o.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function _e(o,e){let r,a,u,c=!1;for(let f=0;f<o.length;f++){r=o[f];for(let y=0,b=r.length-1;y<r.length;b=y++)a=r[y],u=r[b],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(c=!c)}return c}function me(o,e){let r=!1;for(let a=0,u=o.length-1;a<o.length;u=a++){const c=o[a],f=o[u];c.y>e.y!=f.y>e.y&&e.x<(f.x-c.x)*(e.y-c.y)/(f.y-c.y)+c.x&&(r=!r)}return r}function we(o,e,r,a,u){for(const f of o)if(e<=f.x&&r<=f.y&&a>=f.x&&u>=f.y)return!0;const c=[new Ae(e,r),new Ae(e,u),new Ae(a,u),new Ae(a,r)];if(o.length>2){for(const f of c)if(me(o,f))return!0}for(let f=0;f<o.length-1;f++)if(Ee(o[f],o[f+1],c))return!0;return!1}function Ee(o,e,r){const a=r[0],u=r[2];if(o.x<a.x&&e.x<a.x||o.x>u.x&&e.x>u.x||o.y<a.y&&e.y<a.y||o.y>u.y&&e.y>u.y)return!1;const c=wo(o,e,r[0]);return c!==wo(o,e,r[1])||c!==wo(o,e,r[2])||c!==wo(o,e,r[3])}function He(o,e,r,a,u,c){let f=e.y-o.y,y=o.x-e.x;if(c=c||0){const b=f*f+y*y;if(b===0)return!0;const S=Math.sqrt(b);f/=S,y/=S}return!((r.x-o.x)*f+(r.y-o.y)*y-c<0||(a.x-o.x)*f+(a.y-o.y)*y-c<0||(u.x-o.x)*f+(u.y-o.y)*y-c<0)}function Be(o,e,r,a,u,c,f){return!(He(o,e,a,u,c,f)||He(e,r,a,u,c,f)||He(r,o,a,u,c,f)||He(a,u,o,e,r,f)||He(u,c,o,e,r,f)||He(c,a,o,e,r,f))}function et(o,e,r){const a=e.paint.get(o).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(o)}function rt(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function _t(o,e,r,a,u){if(!e[0]&&!e[1])return o;const c=Ae.convert(e)._mult(u);r==="viewport"&&c._rotate(-a);const f=[];for(let y=0;y<o.length;y++)f.push(o[y].sub(c));return f}function Oe(o,e,r,a){const u=Ae.convert(o)._mult(a);return e==="viewport"&&u._rotate(-r),u}let Qe,De;Ft(X,"CircleBucket",{omit:["layers"]});var Je,Ze={exports:{}},ot=(Je||(Je=1,function(o,e){(function(r){function a(c,f,y){var b=u(256*c,256*(f=Math.pow(2,y)-f-1),y),S=u(256*(c+1),256*(f+1),y);return b[0]+","+b[1]+","+S[0]+","+S[1]}function u(c,f,y){var b=2*Math.PI*6378137/256/Math.pow(2,y);return[c*b-2*Math.PI*6378137/2,f*b-2*Math.PI*6378137/2]}r.getURL=function(c,f,y,b,S,_){return _=_||{},c+"?"+["bbox="+a(y,b,S),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+f].join("&")},r.getTileBBox=a,r.getMercCoords=u,Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,Ze.exports)),Ze.exports);class $e{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=Mt(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=ot.getTileBBox(this.x,this.y,this.z),u=function(c,f,y){let b,S="";for(let _=c;_>0;_--)b=1<<_-1,S+=(f&b?1:0)+(y&b?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class ct{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Mt(e,r.z,r.z,r.x,r.y)}}class Tt{constructor(e,r,a,u,c){this.overscaledZ=e,this.wrap=r,this.canonical=new $e(a,+u,+c),this.key=r===0&&e===a?this.canonical.key:Mt(r,e,a,u,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Tt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Tt(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Mt(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Mt(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Tt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new Tt(r,this.wrap,r,a,u),new Tt(r,this.wrap,r,a+1,u),new Tt(r,this.wrap,r,a,u+1),new Tt(r,this.wrap,r,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Tt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Tt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new ct(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Mt(o,e,r,a,u){const c=1<<Math.min(r,22);let f=c*(u%c)+a%c;return o&&r<22&&(f+=c*c*((o<0?-2*o-1:2*o)%(1<<2*(22-r)))),16*(32*f+r)+(e-r)}const Lt=[o=>{let e=o.canonical.x-1,r=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,r--),new Tt(o.overscaledZ,r,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,r=o.wrap;return e===1<<o.canonical.z&&(e=0,r++),new Tt(o.overscaledZ,r,o.canonical.z,e,o.canonical.y)},o=>new Tt(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new Tt(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Ft($e,"CanonicalTileID"),Ft(Tt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Wt=Jr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:pr}=Wt,nr=Jr([{name:"a_pos_3",components:3,type:"Int16"}]);var mr=Jr([{name:"a_pos",type:"Int16",components:2}]);class hr{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const u=te.vec2.dot(r,this.dir);if(Math.abs(u)<1e-6)return!1;const c=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1])/u;return a[0]=this.pos[0]+this.dir[0]*c,a[1]=this.pos[1]+this.dir[1]*c,!0}}class Br{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const u=te.vec3.dot(r,this.dir);if(Math.abs(u)<1e-6)return!1;const c=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/u;return a[0]=this.pos[0]+this.dir[0]*c,a[1]=this.pos[1]+this.dir[1]*c,a[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,r,a){if(te.vec3.equals(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;const[u,c,f]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],S=this.pos[2]-e[2],_=u*u+c*c+f*f,w=2*(y*u+b*c+S*f),M=w*w-4*_*(y*y+b*b+S*S-r*r);if(M<0){const T=Math.max(-w/2,0),E=y+u*T,C=b+c*T,O=S+f*T,k=Math.hypot(E,C,O);return a[0]=E*r/k,a[1]=C*r/k,a[2]=O*r/k,!1}{const T=(-w-Math.sqrt(M))/(2*_);if(T<0){const E=Math.hypot(y,b,S);return a[0]=y*r/E,a[1]=b*r/E,a[2]=S*r/E,!1}return a[0]=y+u*T,a[1]=b+c*T,a[2]=S+f*T,!0}}}class on{constructor(e,r,a,u,c){this.TL=e,this.TR=r,this.BR=a,this.BL=u,this.horizon=c}static fromInvProjectionMatrix(e,r,a){const u=[-1,1,1],c=[1,1,1],f=[1,-1,1],y=[-1,-1,1],b=te.vec3.transformMat4(u,u,e),S=te.vec3.transformMat4(c,c,e),_=te.vec3.transformMat4(f,f,e),w=te.vec3.transformMat4(y,y,e);return new on(b,S,_,w,r/a)}}function pn(o,e,r){let a=1/0,u=-1/0;const c=[];for(const f of o){te.vec3.sub(c,f,e);const y=te.vec3.dot(c,r);a=Math.min(a,y),u=Math.max(u,y)}return[a,u]}function Dr(o,e){let r=!0;for(let a=0;a<o.planes.length;a++){const u=o.planes[a];let c=0;for(let f=0;f<e.length;f++)c+=te.vec3.dot(u,e[f])+u[3]>=0;if(c===0)return 0;c!==e.length&&(r=!1)}return r?2:1}function zn(o,e){for(const r of o.projections){const a=pn(e,o.points[0],r.axis);if(r.projection[1]<a[0]||r.projection[0]>a[1])return 0}return 1}function wr(o,e){let r=0;const a=[0,0,0,0];for(let u=0;u<o.length;u++)a[0]=o[u][0],a[1]=o[u][1],a[2]=o[u][2],a[3]=1,te.vec4.dot(a,e)>=0&&r++;return r}class gr{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=or.fromPoints(this.points),this.projections=[],this.frustumEdges=[te.vec3.sub([],this.points[2],this.points[3]),te.vec3.sub([],this.points[0],this.points[3]),te.vec3.sub([],this.points[4],this.points[0]),te.vec3.sub([],this.points[5],this.points[1]),te.vec3.sub([],this.points[6],this.points[2]),te.vec3.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const u=[0,-a[2],a[1]],c=[a[2],0,-a[0]];this.projections.push({axis:u,projection:pn(this.points,this.points[0],u)}),this.projections.push({axis:c,projection:pn(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(e,r,a,u){const c=Math.pow(2,a),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const _=te.vec4.transformMat4([],S,e),w=1/_[3]/r*c;return te.vec4.mul(_,_,[w,w,u?1/_[3]:w,w])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const _=te.vec3.sub([],f[S[0]],f[S[1]]),w=te.vec3.sub([],f[S[2]],f[S[1]]),M=te.vec3.normalize([],te.vec3.cross([],_,w)),T=-te.vec3.dot(M,f[S[1]]);return M.concat(T)}),b=[];for(let S=0;S<f.length;S++)b.push([f[S][0],f[S][1],f[S][2]]);return new gr(b,y)}intersectsPrecise(e,r,a){for(let u=0;u<r.length;u++)if(!wr(e,r[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!wr(e,this.planes[u]))return 0;for(const u of a)for(const c of this.frustumEdges){const f=te.vec3.cross([],u,c),y=te.vec3.length(f);if(y===0)continue;te.vec3.scale(f,f,1/y);const b=pn(this.points,this.points[0],f),S=pn(e,this.points[0],f);if(b[0]>S[1]||S[0]>b[1])return 0}return 1}containsPoint(e){for(const r of this.planes){const a=r[3];if(te.vec3.dot([r[0],r[1],r[2]],e)+a<0)return!1}return!0}}class or{static fromPoints(e){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of e)te.vec3.min(r,r,u),te.vec3.max(a,a,u);return new or(r,a)}static fromTileIdAndHeight(e,r,a){const u=1<<e.canonical.z,c=e.canonical.x,f=e.canonical.y;return new or([c/u,f/u,r],[(c+1)/u,(f+1)/u,a])}static applyTransform(e,r){const a=e.getCorners();for(let u=0;u<a.length;++u)te.vec3.transformMat4(a[u],a[u],r);return or.fromPoints(a)}static applyTransformFast(e,r){const a=[r[12],r[13],r[14]],u=[...a];for(let c=0;c<3;c++)for(let f=0;f<3;f++){const y=r[4*f+c],b=y*e.min[f],S=y*e.max[f];a[c]+=Math.min(b,S),u[c]+=Math.max(b,S)}return new or(a,u)}static projectAabbCorners(e,r){const a=e.getCorners();for(let u=0;u<a.length;++u)te.vec3.transformMat4(a[u],a[u],r);return a}constructor(e,r){this.min=e,this.max=r,this.center=te.vec3.scale([],te.vec3.add([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=te.vec3.clone(this.min),u=te.vec3.clone(this.max);for(let c=0;c<r.length;c++)a[c]=r[c]?this.min[c]:this.center[c],u[c]=r[c]?this.center[c]:this.max[c];return u[2]=this.max[2],new or(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Dr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Dr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?zn(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?zn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function en(o){return o*Ai/ql}Ft(or,"Aabb");const tn=[new or([Ms,Ms,Ms],[Gs,Gs,Gs]),new or([Ms,Ms,Ms],[0,0,Gs]),new or([0,Ms,Ms],[Gs,0,Gs]),new or([Ms,0,Ms],[0,Gs,Gs]),new or([0,0,Ms],[Gs,Gs,Gs])];function qn(o,e,r,a=!0){const u=te.vec3.scale([],o._camera.position,o.worldSize),c=[e,r,1,1];te.vec4.transformMat4(c,c,o.pixelMatrixInverse),te.vec4.scale(c,c,1/c[3]);const f=te.vec3.sub([],c,u),y=te.vec3.normalize([],f),b=o.globeMatrix,S=[b[12],b[13],b[14]],_=te.vec3.sub([],S,u),w=te.vec3.length(_),M=te.vec3.normalize([],_),T=o.worldSize/(2*Math.PI),E=te.vec3.dot(M,y),C=Math.asin(T/w);if(C<Math.acos(E)){if(!a)return null;const ve=[],le=[];te.vec3.scale(ve,y,w/E),te.vec3.normalize(le,te.vec3.sub(le,ve,_)),te.vec3.normalize(y,te.vec3.add(y,_,te.vec3.scale(y,le,Math.tan(C)*w)))}const O=[];new Br(u,y).closestPointOnSphere(S,T,O);const k=te.vec3.normalize([],bl(b,0)),U=te.vec3.normalize([],bl(b,1)),V=te.vec3.normalize([],bl(b,2)),N=te.vec3.dot(k,O),$=te.vec3.dot(U,O),Z=te.vec3.dot(V,O),K=jt(Math.asin(-$/T));let ae=jt(Math.atan2(N,Z));ae=o.center.lng+function(ve,le){const xe=(le-ve+180)%360-180;return xe<-180?xe+360:xe}(o.center.lng,ae);const ie=Is(ae),se=Ye(so(K),0,1);return new s(ie,se)}class di{constructor(e,r,a){this.a=te.vec3.sub([],e,a),this.b=te.vec3.sub([],r,a),this.center=a;const u=te.vec3.normalize([],this.a),c=te.vec3.normalize([],this.b);this.angle=Math.acos(te.vec3.dot(u,c))}}function Qi(o,e){if(o.angle===0)return null;let r;return r=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),r<0||r>1?null:function(a,u,c,f){const y=Math.sin(c);return a*(Math.sin((1-f)*c)/y)+u*(Math.sin(f*c)/y)}(o.a[e],o.b[e],o.angle,Ye(r,0,1))+o.center[e]}function fi(o){if(o.z<=1)return tn[o.z+2*o.y+o.x];const e=an(In(o));return or.fromPoints(e)}function Ti(o,e,r){return te.vec3.scale(o,o,1-r),te.vec3.scaleAndAdd(o,o,e,r)}function Ui(o,e,r){for(const a of o)te.vec3.transformMat4(a,a,e),te.vec3.scale(a,a,r)}function rn(o,e,r,a){const u=e/o.worldSize,c=o.globeMatrix;if(r.z<=1){const ie=fi(r).getCorners();return Ui(ie,c,u),or.fromPoints(ie)}const f=In(r,a),y=an(f,Ai+en(o._tileCoverLift));Ui(y,c,u);const b=Number.MAX_VALUE,S=[-b,-b,-b],_=[b,b,b];if(f.contains(o.center)){for(const ve of y)te.vec3.min(_,_,ve),te.vec3.max(S,S,ve);S[2]=0;const ie=o.point,se=[ie.x*u,ie.y*u,0];return te.vec3.min(_,_,se),te.vec3.max(S,S,se),new or(_,S)}if(o._tileCoverLift>0){for(const ie of y)te.vec3.min(_,_,ie),te.vec3.max(S,S,ie);return new or(_,S)}const w=[c[12]*u,c[13]*u,c[14]*u],M=f.getCenter(),T=Ye(o.center.lat,-85.051129,Ji),E=Ye(M.lat,-85.051129,Ji),C=Is(o.center.lng),O=so(T);let k=C-Is(M.lng);const U=O-so(E);k>.5?k-=1:k<-.5&&(k+=1);let V=0;if(Math.abs(k)>Math.abs(U))V=k>=0?1:3;else{V=U>=0?0:2;const ie=[c[4]*u,c[5]*u,c[6]*u],se=-Math.sin(Rt(U>=0?f.getSouth():f.getNorth()))*Ai;te.vec3.scaleAndAdd(w,w,ie,se)}const N=y[V],$=y[(V+1)%4],Z=new di(N,$,w),K=[Qi(Z,0)||N[0],Qi(Z,1)||N[1],Qi(Z,2)||N[2]],ae=zi(o.zoom);if(ae>0){const ie=function({x:ve,y:le,z:xe},Me,Se,Ce,Ie){const Fe=1/(1<<xe);let ze=ve*Fe,Ne=ze+Fe,st=le*Fe,nt=st+Fe,Bt=0;const ft=(ze+Ne)/2-Ce;return ft>.5?Bt=-1:ft<-.5&&(Bt=1),ze=((ze+Bt)*Me-(Ce*=Me))*Se+Ce,Ne=((Ne+Bt)*Me-Ce)*Se+Ce,st=(st*Me-(Ie*=Me))*Se+Ie,nt=(nt*Me-Ie)*Se+Ie,[[ze,nt,0],[Ne,nt,0],[Ne,st,0],[ze,st,0]]}(r,e,o._pixelsPerMercatorPixel,C,O);for(let ve=0;ve<y.length;ve++)Ti(y[ve],ie[ve],ae);const se=te.vec3.add([],ie[V],ie[(V+1)%4]);te.vec3.scale(se,se,.5),Ti(K,se,ae)}for(const ie of y)te.vec3.min(_,_,ie),te.vec3.max(S,S,ie);return _[2]=Math.min(N[2],$[2]),te.vec3.min(_,_,K),te.vec3.max(S,S,K),new or(_,S)}function In({x:o,y:e,z:r},a=!1){const u=1/(1<<r),c=new Qr(us(o*u),e===(1<<r)-1&&a?-90:Mi((e+1)*u)),f=new Qr(us((o+1)*u),e===0&&a?90:Mi(e*u));return new Ra(c,f)}function an(o,e=Ai){const r=Rt(o.getNorth()),a=Rt(o.getSouth()),u=Math.cos(r),c=Math.cos(a),f=Math.sin(r),y=Math.sin(a),b=o.getWest(),S=o.getEast();return[Hl(c,y,b,e),Hl(c,y,S,e),Hl(u,f,S,e),Hl(u,f,b,e)]}function mn(o,e,r,a){const u=1<<r.z,c=(o/Ct+r.x)/u;return Pa(Mi((e/Ct+r.y)/u),us(c),a)}function mi({min:o,max:e}){return k0/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const Fn=new Float64Array(16);function li(o){const e=mi(o),r=te.mat4.fromScaling(Fn,[e,e,e]);return te.mat4.translate(r,r,te.vec3.negate([],o.min))}function Do(o){const e=te.mat4.fromTranslation(Fn,o.min),r=1/mi(o);return te.mat4.scale(e,e,[r,r,r])}function es(o){const e=Ct/(2*Math.PI);return o/(2*Math.PI)/e}function Hs(o,e){return Ct/(512*Math.pow(2,o))*mi(fi(e))}function Ko(o,e,r,a,u){const c=es(r),f=[o,e,-r/(2*Math.PI)],y=te.mat4.identity(new Float64Array(16));return te.mat4.translate(y,y,f),te.mat4.scale(y,y,[c,c,c]),te.mat4.rotateX(y,y,Rt(-u)),te.mat4.rotateY(y,y,Rt(-a)),y}function zi(o){return Jt(ip,sp,o)}function Cs(o,e){const r=Pa(e.lat,e.lng),a=function(c){const f=Pa(c._center.lat,c._center.lng),y=te.vec3.fromValues(0,1,0);let b=te.vec3.cross([],y,f);const S=te.mat4.fromRotation([],-c.angle,f);b=te.vec3.transformMat4(b,b,S),te.mat4.fromRotation(S,-c._pitch,b);const _=te.vec3.normalize([],f);return te.vec3.scale(_,_,en(c.cameraToCenterDistance/c.pixelsPerMeter)),te.vec3.transformMat4(_,_,S),te.vec3.add([],f,_)}(o),u=te.vec3.subtract([],a,r);return te.vec3.angle(u,r)}function zo(o,e){return Cs(o,e)>Math.PI/2*1.01}const oo=Rt(85),Yo=Math.cos(oo),up=Math.sin(oo),ou=te.mat4.create(),Zh=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Xh(o,e,r,a,u,c,f,y,b){if(c&&o.queryGeometry.isAboveHorizon)return!1;c&&(b*=o.pixelToTileUnitsFactor);const S=o.tileID.canonical,_=r.projection.upVectorScale(S,r.center.lat,r.worldSize).metersToTile;for(const w of e)for(const M of w){const T=M.add(y),E=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(T.x,T.y,!0):0,C=r.projection.projectTilePoint(T.x,T.y,S);if(E>0){const V=r.projection.upVector(S,T.x,T.y);C.x+=V[0]*_*E,C.y+=V[1]*_*E,C.z+=V[2]*_*E}const O=c?T:DC(C.x,C.y,C.z,a),k=c?o.tilespaceRays.map(V=>LC(V,E)):o.queryGeometry.screenGeometry,U=te.vec4.transformMat4([],[C.x,C.y,C.z,1],a);if(!f&&c?b*=U[3]/r.cameraToCenterDistance:f&&!c&&(b*=r.cameraToCenterDistance/U[3]),c){const V=Mi((M.y/Ct+S.y)/(1<<S.z));b/=r.projection.pixelsPerMeter(V,1)/Wi(1,V)}if(J(k,O,b))return!0}return!1}function DC(o,e,r,a){const u=te.vec4.transformMat4([],[o,e,r,1],a);return new Ae(u[0]/u[3],u[1]/u[3])}const cb=te.vec3.fromValues(0,0,0),zC=te.vec3.fromValues(0,0,1);function LC(o,e){const r=te.vec3.create();return cb[2]=e,o.intersectsPlane(cb,zC,r),new Ae(r[0],r[1])}class ub extends X{}let hb,db,fb,pb;function mb(o,{width:e,height:r},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*a);return o.width=e,o.height=r,o.data=u,o}function _b(o,e,r){const{width:a,height:u}=e;a===o.width&&u===o.height||(B0(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,a),height:Math.min(o.height,u)},r,null),o.width=a,o.height=u,o.data=e.data)}function B0(o,e,r,a,u,c,f,y){if(u.width===0||u.height===0)return e;if(u.width>o.width||u.height>o.height||r.x>o.width-u.width||r.y>o.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const b=o.data,S=e.data,_=c===4&&y;for(let w=0;w<u.height;w++){const M=((r.y+w)*o.width+r.x)*c,T=((a.y+w)*e.width+a.x)*c;if(_)for(let E=0;E<u.width;E++){const C=M+E*c+3,O=T+E*c;S[O+0]=255,S[O+1]=255,S[O+2]=255,S[O+3]=b[C]}else if(f)for(let E=0;E<u.width;E++){const C=M+E*c,O=T+E*c,k=b[C+3],U=new nn(b[C+0]/255*k,b[C+1]/255*k,b[C+2]/255*k,k).toRenderColor(f).toArray();S[O+0]=U[0],S[O+1]=U[1],S[O+2]=U[2],S[O+3]=U[3]}else for(let E=0;E<u.width*c;E++)S[T+E]=b[M+E]}return e}Ft(ub,"HeatmapBucket",{omit:["layers"]});class Zl{constructor(e,r){mb(this,e,1,r)}resize(e){_b(this,new Zl(e),1)}clone(){return new Zl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,c){B0(e,r,a,u,c,1,null)}}class Li{constructor(e,r){mb(this,e,4,r)}resize(e){_b(this,new Li(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Li({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,c,f,y){B0(e,r,a,u,c,4,f,y)}}class gb{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function hp(o){const e={},r=o.resolution||256,a=o.clips?o.clips.length:1,u=o.image||new Li({width:r,height:a}),c=(f,y,b)=>{e[o.evaluationKey]=b;const S=o.expression.evaluate(e);S&&(u.data[f+y+0]=Math.floor(255*S.r/S.a),u.data[f+y+1]=Math.floor(255*S.g/S.a),u.data[f+y+2]=Math.floor(255*S.b/S.a),u.data[f+y+3]=Math.floor(255*S.a))};if(o.clips)for(let f=0,y=0;f<a;++f,y+=4*r)for(let b=0,S=0;b<r;b++,S+=4){const _=b/(r-1),{start:w,end:M}=o.clips[f];c(y,S,w*(1-_)+M*_)}else for(let f=0,y=0;f<r;f++,y+=4)c(0,y,f/(r-1));return u}Ft(Zl,"AlphaImage"),Ft(Li,"RGBAImage");const OC=Jr([{name:"a_pos",components:2,type:"Int16"}],4),kC=Jr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),FC=Jr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),BC=Jr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function dp(o,e,r=2){const a=e&&e.length,u=a?e[0]*r:o.length;let c=yb(o,0,u,r,!0);const f=[];if(!c||c.next===c.prev)return f;let y,b,S;if(a&&(c=function(_,w,M,T){const E=[];for(let C=0,O=w.length;C<O;C++){const k=yb(_,w[C]*T,C<O-1?w[C+1]*T:_.length,T,!1);k===k.next&&(k.steiner=!0),E.push(qC(k))}E.sort($C);for(let C=0;C<E.length;C++)M=GC(E[C],M);return M}(o,e,c,r)),o.length>80*r){y=1/0,b=1/0;let _=-1/0,w=-1/0;for(let M=r;M<u;M+=r){const T=o[M],E=o[M+1];T<y&&(y=T),E<b&&(b=E),T>_&&(_=T),E>w&&(w=E)}S=Math.max(_-y,w-b),S=S!==0?32767/S:0}return fp(c,f,r,y,b,S,0),f}function yb(o,e,r,a,u){let c;if(u===function(f,y,b,S){let _=0;for(let w=y,M=b-S;w<b;w+=S)_+=(f[M]-f[w])*(f[w+1]+f[M+1]),M=w;return _}(o,e,r,a)>0)for(let f=e;f<r;f+=a)c=bb(f/a|0,o[f],o[f+1],c);else for(let f=r-a;f>=e;f-=a)c=bb(f/a|0,o[f],o[f+1],c);return c&&L_(c,c.next)&&(mp(c),c=c.next),c}function au(o,e){if(!o)return o;e||(e=o);let r,a=o;do if(r=!1,a.steiner||!L_(a,a.next)&&_i(a.prev,a,a.next)!==0)a=a.next;else{if(mp(a),a=e=a.prev,a===a.next)break;r=!0}while(r||a!==e);return e}function fp(o,e,r,a,u,c,f){if(!o)return;!f&&c&&function(b,S,_,w){let M=b;do M.z===0&&(M.z=N0(M.x,M.y,S,_,w)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==b);M.prevZ.nextZ=null,M.prevZ=null,function(T){let E,C=1;do{let O,k=T;T=null;let U=null;for(E=0;k;){E++;let V=k,N=0;for(let Z=0;Z<C&&(N++,V=V.nextZ,V);Z++);let $=C;for(;N>0||$>0&&V;)N!==0&&($===0||!V||k.z<=V.z)?(O=k,k=k.nextZ,N--):(O=V,V=V.nextZ,$--),U?U.nextZ=O:T=O,O.prevZ=U,U=O;k=V}U.nextZ=null,C*=2}while(E>1)}(M)}(o,a,u,c);let y=o;for(;o.prev!==o.next;){const b=o.prev,S=o.next;if(c?VC(o,a,u,c):NC(o))e.push(b.i,o.i,S.i),mp(o),o=S.next,y=S.next;else if((o=S)===y){f?f===1?fp(o=UC(au(o),e),e,r,a,u,c,2):f===2&&jC(o,e,r,a,u,c):fp(au(o),e,r,a,u,c,1);break}}}function NC(o){const e=o.prev,r=o,a=o.next;if(_i(e,r,a)>=0)return!1;const u=e.x,c=r.x,f=a.x,y=e.y,b=r.y,S=a.y,_=u<c?u<f?u:f:c<f?c:f,w=y<b?y<S?y:S:b<S?b:S,M=u>c?u>f?u:f:c>f?c:f,T=y>b?y>S?y:S:b>S?b:S;let E=a.next;for(;E!==e;){if(E.x>=_&&E.x<=M&&E.y>=w&&E.y<=T&&Kh(u,y,c,b,f,S,E.x,E.y)&&_i(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function VC(o,e,r,a){const u=o.prev,c=o,f=o.next;if(_i(u,c,f)>=0)return!1;const y=u.x,b=c.x,S=f.x,_=u.y,w=c.y,M=f.y,T=y<b?y<S?y:S:b<S?b:S,E=_<w?_<M?_:M:w<M?w:M,C=y>b?y>S?y:S:b>S?b:S,O=_>w?_>M?_:M:w>M?w:M,k=N0(T,E,e,r,a),U=N0(C,O,e,r,a);let V=o.prevZ,N=o.nextZ;for(;V&&V.z>=k&&N&&N.z<=U;){if(V.x>=T&&V.x<=C&&V.y>=E&&V.y<=O&&V!==u&&V!==f&&Kh(y,_,b,w,S,M,V.x,V.y)&&_i(V.prev,V,V.next)>=0||(V=V.prevZ,N.x>=T&&N.x<=C&&N.y>=E&&N.y<=O&&N!==u&&N!==f&&Kh(y,_,b,w,S,M,N.x,N.y)&&_i(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;V&&V.z>=k;){if(V.x>=T&&V.x<=C&&V.y>=E&&V.y<=O&&V!==u&&V!==f&&Kh(y,_,b,w,S,M,V.x,V.y)&&_i(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;N&&N.z<=U;){if(N.x>=T&&N.x<=C&&N.y>=E&&N.y<=O&&N!==u&&N!==f&&Kh(y,_,b,w,S,M,N.x,N.y)&&_i(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function UC(o,e){let r=o;do{const a=r.prev,u=r.next.next;!L_(a,u)&&vb(a,r,r.next,u)&&pp(a,u)&&pp(u,a)&&(e.push(a.i,r.i,u.i),mp(r),mp(r.next),r=o=u),r=r.next}while(r!==o);return au(r)}function jC(o,e,r,a,u,c){let f=o;do{let y=f.next.next;for(;y!==f.prev;){if(f.i!==y.i&&WC(f,y)){let b=xb(f,y);return f=au(f,f.next),b=au(b,b.next),fp(f,e,r,a,u,c,0),void fp(b,e,r,a,u,c,0)}y=y.next}f=f.next}while(f!==o)}function $C(o,e){return o.x-e.x}function GC(o,e){const r=function(u,c){let f=c;const y=u.x,b=u.y;let S,_=-1/0;do{if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){const C=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(C<=y&&C>_&&(_=C,S=f.x<f.next.x?f:f.next,C===y))return S}f=f.next}while(f!==c);if(!S)return null;const w=S,M=S.x,T=S.y;let E=1/0;f=S;do{if(y>=f.x&&f.x>=M&&y!==f.x&&Kh(b<T?y:_,b,M,T,b<T?_:y,b,f.x,f.y)){const C=Math.abs(b-f.y)/(y-f.x);pp(f,u)&&(C<E||C===E&&(f.x>S.x||f.x===S.x&&HC(S,f)))&&(S=f,E=C)}f=f.next}while(f!==w);return S}(o,e);if(!r)return e;const a=xb(r,o);return au(a,a.next),au(r,r.next)}function HC(o,e){return _i(o.prev,o,e.prev)<0&&_i(e.next,o,o.next)<0}function N0(o,e,r,a,u){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-r)*u|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function qC(o){let e=o,r=o;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==o);return r}function Kh(o,e,r,a,u,c,f,y){return(u-f)*(e-y)>=(o-f)*(c-y)&&(o-f)*(a-y)>=(r-f)*(e-y)&&(r-f)*(c-y)>=(u-f)*(a-y)}function WC(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(r,a){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&vb(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1}(o,e)&&(pp(o,e)&&pp(e,o)&&function(r,a){let u=r,c=!1;const f=(r.x+a.x)/2,y=(r.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&f<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(c=!c),u=u.next;while(u!==r);return c}(o,e)&&(_i(o.prev,o,e.prev)||_i(o,e.prev,e))||L_(o,e)&&_i(o.prev,o,o.next)>0&&_i(e.prev,e,e.next)>0)}function _i(o,e,r){return(e.y-o.y)*(r.x-e.x)-(e.x-o.x)*(r.y-e.y)}function L_(o,e){return o.x===e.x&&o.y===e.y}function vb(o,e,r,a){const u=k_(_i(o,e,r)),c=k_(_i(o,e,a)),f=k_(_i(r,a,o)),y=k_(_i(r,a,e));return u!==c&&f!==y||!(u!==0||!O_(o,r,e))||!(c!==0||!O_(o,a,e))||!(f!==0||!O_(r,o,a))||!(y!==0||!O_(r,e,a))}function O_(o,e,r){return e.x<=Math.max(o.x,r.x)&&e.x>=Math.min(o.x,r.x)&&e.y<=Math.max(o.y,r.y)&&e.y>=Math.min(o.y,r.y)}function k_(o){return o>0?1:o<0?-1:0}function pp(o,e){return _i(o.prev,o,o.next)<0?_i(o,e,o.next)>=0&&_i(o,o.prev,e)>=0:_i(o,e,o.prev)<0||_i(o,o.next,e)<0}function xb(o,e){const r=V0(o.i,o.x,o.y),a=V0(e.i,e.x,e.y),u=o.next,c=e.prev;return o.next=e,e.prev=o,r.next=u,u.prev=r,a.next=r,r.prev=a,c.next=a,a.prev=c,a}function bb(o,e,r,a){const u=V0(o,e,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function mp(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function V0(o,e,r){return{i:o,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function F_(o,e){const r=o.length;if(r<=1)return[o];const a=[];let u,c;for(let f=0;f<r;f++){const y=xl(o[f]);y!==0&&(o[f].area=Math.abs(y),c===void 0&&(c=y<0),c===y<0?(u&&a.push(u),u=[o[f]]):u.push(o[f]))}if(u&&a.push(u),e>1)for(let f=0;f<a.length;f++)a[f].length<=e||(Gm(a[f],e,1,a[f].length-1,ZC),a[f]=a[f].slice(0,e));return a}function ZC(o,e){return e.area-o.area}function wb(o,e,r=1){if(!o)return null;const a=typeof o=="string"?Ei.from(o).getPrimary():o.getPrimary(),u=a.id.toString();return e.has(u)||e.set(u,[]),a.scaleSelf(r),e.get(u).push(a),a.toString()}function U0(o,e,r,a){const u=a.patternDependencies;let c=!1;for(const f of e){const y=f.paint.get(`${o}-pattern`);y.isConstant()||(c=!0),wb(y.constantOr(null),u,r)&&(c=!0)}return c}function j0(o,e,r,a,u,c){const f=c.patternDependencies;for(const y of e){const b=y.paint.get(`${o}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:a},r,{},c.availableImages);S=S&&S.name?S.name:S;const _=wb(S,f,u);_&&(r.patterns[y.id]=_)}}return r}var $0,Tb,G0,Sb,H0,Eb,Ab,B_={};function Mb(){if(Tb)return $0;Tb=1;var o=Ve();function e(u,c,f,y,b){this.properties={},this.extent=f,this.type=0,this._pbf=u,this._geometry=-1,this._keys=y,this._values=b,u.readFields(r,this,c)}function r(u,c,f){u==1?c.id=f.readVarint():u==2?function(y,b){for(var S=y.readVarint()+y.pos;y.pos<S;){var _=b._keys[y.readVarint()],w=b._values[y.readVarint()];b.properties[_]=w}}(f,c):u==3?c.type=f.readVarint():u==4&&(c._geometry=f.pos)}function a(u){for(var c,f,y=0,b=0,S=u.length,_=S-1;b<S;_=b++)y+=((f=u[_]).x-(c=u[b]).x)*(c.y+f.y);return y}return $0=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var c,f=u.readVarint()+u.pos,y=1,b=0,S=0,_=0,w=[];u.pos<f;){if(b<=0){var M=u.readVarint();y=7&M,b=M>>3}if(b--,y===1||y===2)S+=u.readSVarint(),_+=u.readSVarint(),y===1&&(c&&w.push(c),c=[]),c.push(new o(S,_));else{if(y!==7)throw new Error("unknown command "+y);c&&c.push(c[0].clone())}}return c&&w.push(c),w},e.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var c=u.readVarint()+u.pos,f=1,y=0,b=0,S=0,_=1/0,w=-1/0,M=1/0,T=-1/0;u.pos<c;){if(y<=0){var E=u.readVarint();f=7&E,y=E>>3}if(y--,f===1||f===2)(b+=u.readSVarint())<_&&(_=b),b>w&&(w=b),(S+=u.readSVarint())<M&&(M=S),S>T&&(T=S);else if(f!==7)throw new Error("unknown command "+f)}return[_,M,w,T]},e.prototype.toGeoJSON=function(u,c,f){var y,b,S=this.extent*Math.pow(2,f),_=this.extent*u,w=this.extent*c,M=this.loadGeometry(),T=e.types[this.type];function E(k){for(var U=0;U<k.length;U++){var V=k[U];k[U]=[360*(V.x+_)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+w)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(y=0;y<M.length;y++)C[y]=M[y][0];E(M=C);break;case 2:for(y=0;y<M.length;y++)E(M[y]);break;case 3:for(M=function(k){var U=k.length;if(U<=1)return[k];for(var V,N,$=[],Z=0;Z<U;Z++){var K=a(k[Z]);K!==0&&(N===void 0&&(N=K<0),N===K<0?(V&&$.push(V),V=[k[Z]]):V.push(k[Z]))}return V&&$.push(V),$}(M),y=0;y<M.length;y++)for(b=0;b<M[y].length;b++)E(M[y][b])}M.length===1?M=M[0]:T="Multi"+T;var O={type:"Feature",geometry:{type:T,coordinates:M},properties:this.properties};return"id"in this&&(O.id=this.id),O},$0}function Ib(){if(Sb)return G0;Sb=1;var o=Mb();function e(a,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(r,this,u),this.length=this._features.length}function r(a,u,c){a===15?u.version=c.readVarint():a===1?u.name=c.readString():a===5?u.extent=c.readVarint():a===2?u._features.push(c.pos):a===3?u._keys.push(c.readString()):a===4&&u._values.push(function(f){for(var y=null,b=f.readVarint()+f.pos;f.pos<b;){var S=f.readVarint()>>3;y=S===1?f.readString():S===2?f.readFloat():S===3?f.readDouble():S===4?f.readVarint64():S===5?f.readVarint():S===6?f.readSVarint():S===7?f.readBoolean():null}return y}(c))}return G0=e,e.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var u=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,u,this.extent,this._keys,this._values)},G0}function Cb(){return Ab||(Ab=1,B_.VectorTile=function(){if(Eb)return H0;Eb=1;var o=Ib();function e(r,a,u){if(r===3){var c=new o(u,u.readVarint()+u.pos);c.length&&(a[c.name]=c)}}return H0=function(r,a){this.layers=r.readFields(e,{},a)},H0}(),B_.VectorTileFeature=Mb(),B_.VectorTileLayer=Ib()),B_}var Xl=Cb();const lu="3d_elevation_id",Pb="level";class XC{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,r){return this._valid&&e(r(this._geometry)),this}require(e,r,a){return this.get(e,!0,r,a)}optional(e,r,a){return this.get(e,!1,r,a)}success(){return this._valid}get(e,r,a,u){const c=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&c!==void 0?a(u?u(c):c):r&&(this._valid=!1),this}}class Rb{constructor(e,r){this.featureFunc=e,this.vertexFunc=r}parseFeature(e,r,a){return this.featureFunc(e,r,a)}parseVertex(e,r,a){return this.vertexFunc(e,r,a)}}const KC=new Rb((o,e,r)=>o.reset(e).require(lu,a=>{r.id=a}).optional("fixed_height_relative",a=>{r.constantHeight=a},ll.decodeRelativeHeight).geometry(a=>{r.bounds=a},ll.computeBounds).success(),(o,e,r)=>o.reset(e).require(lu,a=>{r.id=a}).require("elevation_idx",a=>{r.idx=a}).require("extent",a=>{r.extent=a}).require("height_relative",a=>{r.height=a},ll.decodeRelativeHeight).geometry(a=>{r.position=a},ll.getPoint).success()),YC=new Rb((o,e,r)=>o.reset(e).require(lu,a=>{r.id=a}).optional("fixed_height",a=>{r.constantHeight=a},ll.decodeMetricHeight).geometry(a=>{r.bounds=a},ll.computeBounds).success(),(o,e,r)=>o.reset(e).require(lu,a=>{r.id=a}).require("elevation_idx",a=>{r.idx=a}).require("extent",a=>{r.extent=a}).require("height",a=>{r.height=a},ll.decodeMetricHeight).geometry(a=>{r.position=a},ll.getPoint).success());class ll{static computeBounds(e){const r=new Ae(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new Ae(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of e[0])r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),a.x<u.x&&(a.x=u.x),a.y<u.y&&(a.y=u.y);return{min:r,max:a}}static getPoint(e){return te.vec2.fromValues(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const r=[],a=[],u=e.length,c=new XC;for(let y=0;y<u;y++){const b=e.feature(y),S=b.properties.hasOwnProperty("version")?String(b.properties.version):void 0,_=(f=S)?f==="1.0.1"?YC:void 0:KC;if(_===void 0){Pr(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const w=b.properties.hasOwnProperty("type")?b.properties.type:void 0;if(w){if(Xl.VectorTileFeature.types[b.type]==="Point"&&w==="curve_point"){const M={};_.parseVertex(c,b,M)&&r.push(M)}else if(Xl.VectorTileFeature.types[b.type]==="Polygon"&&w==="curve_meta"){const M={};_.parseFeature(c,b,M)&&a.push(M)}}}var f;return{vertices:r,features:a}}}class q0{constructor(e,r,a,u,c,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:a,max:a},this.safeArea=r,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=c,this.edges=this.edges.filter(y=>y.a<this.vertices.length&&y.b<this.vertices.length&&!te.vec2.exactEquals(this.vertices[y.a].position,this.vertices[y.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const y of this.vertices)this.vertexProps.push({dir:te.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,y.height),this.heightRange.max=Math.max(this.heightRange.max,y.height);for(const y of this.edges){const b=this.vertices[y.a].position,S=this.vertices[y.b].position,_=te.vec2.subtract(te.vec2.create(),S,b),w=te.vec2.length(_),M=te.vec2.scale(te.vec2.create(),_,1/w);this.edgeProps.push({vec:_,dir:M,len:w});const T=this.vertexProps[y.a].dir,E=this.vertexProps[y.b].dir;te.vec2.add(T,T,M),te.vec2.add(E,E,M)}for(const y of this.vertexProps)y.dir[0]===0&&y.dir[1]===0||te.vec2.normalize(y.dir,y.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(e);if(r==null)return 0;const[a,u]=r;return((c,f,y)=>(1-y)*c+y*f)(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,u)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let r=0,a=Number.POSITIVE_INFINITY,u=0;const c=te.vec2.fromValues(e.x,e.y);for(let f=0;f<this.edges.length;f++){const y=this.edges[f],b=this.edgeProps[f].dir,S=new hr(c,this.edgeProps[f].dir),_=this.vertices[y.a].position,w=this.vertices[y.b].position,M=te.vec2.create(),T=te.vec2.create(),E=S.intersectsPlane(_,this.vertexProps[y.a].dir,M),C=S.intersectsPlane(w,this.vertexProps[y.b].dir,T);if(!E||!C)continue;const O=te.vec2.subtract(te.vec2.create(),T,M),k=te.vec2.subtract(te.vec2.create(),c,M),U=te.vec2.dot(O,O),V=U>0?te.vec2.dot(k,O)/U:0,N=Ye(V,0,1),$=Math.abs((V-N)*this.edgeProps[f].len),Z=te.vec2.subtract(te.vec2.create(),c,_),K=$+Math.abs(te.vec2.dot(Z,te.vec2.fromValues(b[1],-b[0])));K<a&&(r=f,a=K,u=N)}return[r,u]}tessellate(e){for(let r=this.edges.length-1;r>=0;--r){const a=this.edges[r].a,u=this.edges[r].b,{position:c,height:f,extent:y}=this.vertices[a],{position:b,height:S,extent:_}=this.vertices[u],w=this.vertexProps[a].dir,M=this.vertexProps[u].dir,T=te.vec3.fromValues(c[0]/e,c[1]/e,f),E=te.vec3.fromValues(b[0]/e,b[1]/e,S),C=te.vec3.fromValues(w[1],-w[0],0);te.vec3.scale(C,C,y);const O=te.vec3.fromValues(M[1],-M[0],0);if(te.vec3.scale(O,O,_),this.distSqLines(te.vec3.fromValues(T[0]+.5*C[0],T[1]+.5*C[1],T[2]+.5*C[2]),te.vec3.fromValues(E[0]-.5*O[0],E[1]-.5*O[1],E[2]-.5*O[2]),te.vec3.fromValues(T[0]-.5*C[0],T[1]-.5*C[1],T[2]-.5*C[2]),te.vec3.fromValues(E[0]+.5*O[0],E[1]+.5*O[1],E[2]+.5*O[2]))<=.05*.05)continue;const k=this.vertices.length,U=te.vec2.add(te.vec2.create(),c,b);this.vertices.push({position:te.vec2.scale(U,U,.5),height:.5*(f+S),extent:.5*(y+_)});const V=te.vec2.add(te.vec2.create(),w,M);this.vertexProps.push({dir:te.vec2.normalize(V,V)}),this.edges.splice(r,1),this.edgeProps.splice(r,1),this.edges.push({a,b:k}),this.edges.push({a:k,b:u});const N=te.vec2.subtract(te.vec2.create(),this.vertices[k].position,c),$=te.vec2.length(N),Z={vec:N,dir:te.vec2.scale(te.vec2.create(),N,1/$),len:$};this.edgeProps.push(Z),this.edgeProps.push(Z)}}distSqLines(e,r,a,u){const c=te.vec3.subtract(te.vec3.create(),r,e),f=te.vec3.subtract(te.vec3.create(),u,a),y=te.vec3.subtract(te.vec3.create(),e,a),b=te.vec3.dot(c,c),S=te.vec3.dot(c,f),_=te.vec3.dot(c,y),w=te.vec3.dot(f,f),M=te.vec3.dot(f,y),T=b*w-S*S;if(T===0){const U=te.vec3.dot(y,f)/te.vec3.dot(f,f),V=te.vec3.lerp(te.vec3.create(),a,u,U);return te.vec3.squaredDistance(V,e)}const E=(S*M-_*w)/T,C=(b*M-S*_)/T,O=te.vec3.lerp(te.vec3.create(),e,r,E),k=te.vec3.lerp(te.vec3.create(),a,u,C);return te.vec3.squaredDistance(O,k)}}class JC{constructor(e,r){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(r)||(this.zScale=Math.pow(2,r.z-e.z),this.xOffset=(e.x*this.zScale-r.x)*Ct,this.yOffset=(e.y*this.zScale-r.y)*Ct)}constantElevation(e,r){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,r)}pointElevation(e,r,a){const u=this.constantElevation(r,a);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(e),a))}computeBiasedHeight(e,r){return r<=0?e:e+r*Jt(0,r,e>=0?e:Math.abs(.5*e))}}Ft(q0,"ElevationFeature");class Db{constructor(){this.polygons=new Map}add(e,...r){this.polygons.has(e)?this.polygons.get(e).push(...r):this.polygons.set(e,r)}merge(e){for(const[r,a]of e.polygons)this.add(r,...a)}}class cu{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new cu;let r=[];for(const S of e)r.push(...S.portals);if(r.length===0)return new cu;const a=(S,_)=>S<=0&&_<=0||S>=Ct&&_>=Ct;for(const S of r){const _=S.va,w=S.vb;(a(_.x,w.x)||a(_.y,w.y))&&(S.type="border")}const u=r.filter(S=>S.type!=="unevaluated"),c=r.filter(S=>S.type==="unevaluated");if(c.length===0)return new cu;c.sort((S,_)=>S.hash===_.hash?S.isTunnel===_.isTunnel?0:S.isTunnel?-1:1:S.hash<_.hash?1:-1),r=u.concat(c);let f=u.length,y=f,b=f;do if(y++,y===r.length||r[f].hash!==r[y].hash){if(y-f==2){b<f&&(r[b]=r[f],r[f]=null);const S=r[b],_=r[y-1];S.type=S.isTunnel!==_.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:_.connection.a},b++}f=y}while(f!==r.length);return r.splice(b),r.sort((S,_)=>S.hash<_.hash?1:-1),{portals:r}}}Ft(cu,"ElevationPortalGraph"),Ft(Db,"ElevationPolygons");class QC{constructor(e,r,a){this.outPositions=e,this.outNormals=r,this.outIndices=a,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,r,a){let u=e[2];a!=null&&(u*=a);const c=this.getVec3Bits(e)<<96n|this.getVec3Bits(r),f=this.vertexLookup.get(c);if(f!=null)return f;const y=this.outPositions.length;this.vertexLookup.set(c,y);const b=Math.trunc(16384*r[0]),S=Math.trunc(16384*r[1]),_=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(b,S,_),y}addVertices(e,r,...a){const u=[];for(const c of a){const f=this.addVertex(c,e,r);u.push(f)}return u}addTriangles(e,r,a){if(r&&a){const u=a.length===1,c=te.vec3.fromValues(0,0,0);for(let f=0;f<e.length;f+=3){const y=r[e[f+0]],b=r[e[f+1]],S=r[e[f+2]],_=u?a[0]:a[e[f+1]],w=u?a[0]:a[e[f+2]],M=this.addVertex(te.vec3.fromValues(y.x,y.y,u?a[0]:a[e[f+0]]),c),T=this.addVertex(te.vec3.fromValues(b.x,b.y,_),c),E=this.addVertex(te.vec3.fromValues(S.x,S.y,w),c);this.outIndices.emplaceBack(M,T,E)}}else for(let u=0;u<e.length;u+=3)this.outIndices.emplaceBack(e[u+0],e[u+1],e[u+2])}addQuad(e,r){const a=this.addVertices(r,void 0,...e.map(b=>te.vec3.fromValues(b.coord.x,b.coord.y,b.height))),[u,c,f,y]=a;this.addTriangles([u,c,f,f,y,u])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Jo{constructor(e){this.unevaluatedPortals=new cu,this.portalPolygons=new Db,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Uf,this.vertexNormals=new $s,this.indexArray=new wi,this.tileToMeters=t(e)}addVertices(e,r){const a=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(r[u]);return a}addTriangles(e,r,a){const u=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const c of e)u.push(c+r)}addRenderableRing(e,r,a,u,c){const f=[new Ae(c.min.x,c.min.y),new Ae(c.max.x,c.min.y),new Ae(c.max.x,c.max.y),new Ae(c.min.x,c.max.y)];for(let y=0;y<a-1;y++){const b=r+y,S=b+1,_=this.unevalVertices[b],w=this.unevalVertices[S];if(!(_.x>=c.min.x&&_.x<=c.max.x&&_.y>=c.min.y&&_.y<=c.max.y||w.x>=c.min.x&&w.x<=c.max.x&&w.y>=c.min.y&&w.y<=c.max.y||Ee(_,w,f))||this.isOnBorder(_.x,w.x)||this.isOnBorder(_.y,w.y))continue;const M=Jo.computeEdgeHash(this.unevalVertices[b],this.unevalVertices[S]);let T,E=this.vertexHashLookup.get(Jo.computePosHash(_));E!=null?T=E.next:(E=this.vertexHashLookup.get(Jo.computePosHash(w)),T=E!=null?E.prev:M),this.unevalEdges.push({polygonIdx:e,a:b,b:S,hash:M,portalHash:T,isTunnel:u,type:"unevaluated"})}}addPortalCandidates(e,r,a,u,c){if(r.length===0)return;this.portalPolygons.add(e,{geometry:r,zLevel:c});const f=r[0];this.vertexHashLookup.clear();let y=Jo.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let b=0;b<f.length-1;b++){const S=f[b+0],_=f[b+1],w=te.vec2.fromValues(_.x-S.x,_.y-S.y),M=te.vec2.length(w);if(M===0)continue;let T="unevaluated";const E=u.pointElevation(S),C=u.pointElevation(_);Math.abs(E)<.01&&Math.abs(C)<.01?T="entrance":(this.isOnBorder(S.x,_.x)||this.isOnBorder(S.y,_.y))&&(T="border");const O=Jo.computeEdgeHash(S,_);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:S,vb:_,vab:w,length:M,hash:O,isTunnel:a,type:T});const k=Jo.computePosHash(S);this.vertexHashLookup.set(k,{prev:y,next:O}),y=O}}construct(e){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=w=>{w.primitiveLength=this.indexArray.length-w.primitiveOffset},u=new QC(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const c=r(),f=r(),y=r(),b=(w,M)=>{w.sort((E,C)=>E.type===M&&C.type!==M?-1:E.type!==M&&C.type===M?1:0);const T=w.findIndex(E=>E.type!==M);return T>=0?T:w.length};let S=0;this.unevalEdges.length>0&&(S=b(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters));const _=r();if(this.unevalEdges.length>0){const w=this.unevalEdges.splice(S),M=b(w,"tunnel")+S;this.unevalEdges.push(...w),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:M})}a(y),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(_),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(f),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(c),this.maskSegments=$n.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.depthSegments=$n.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableSegments=$n.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.shadowCasterSegments=$n.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,FC.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,BC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,r,a,u){const c=new Map;for(let f=a;f<u;f++){const y=r[f],b=y.a,S=y.b;c.has(b)||c.set(b,{}),c.has(S)||c.set(S,{});const _=c.get(b),w=c.get(S);e[S]>0&&(_.to=S),e[b]>0&&(w.from=b)}return c}constructBridgeStructures(e,r,a,u,c,f){const y=this.computeVertexConnections(a,u,c.min,c.max),b=1/f,S=.5*b,_=M=>te.vec3.fromValues(r[M].x,r[M].y,a[M]*b),w=M=>{const T=y.get(M),E=T.from,C=T.to;if(!E||!C)return;const O=_(E),k=_(M),U=_(C),V=te.vec3.fromValues(0,0,0);if(!te.vec3.exactEquals(O,k)){const $=te.vec3.sub(te.vec3.create(),k,O);te.vec3.add(V,V,te.vec3.normalize($,$))}if(!te.vec3.exactEquals(U,k)){const $=te.vec3.sub(te.vec3.create(),U,k);te.vec3.add(V,V,te.vec3.normalize($,$))}const N=te.vec3.len(V);return N>0?te.vec3.scale(V,V,1/N):void 0};for(let M=c.min;M<c.max;M++){const T=u[M],E=this.prepareEdgePoints(r,a,T,(lt,tr)=>lt>=tr);if(E==null)continue;const C=E[0],O=E[1],k=te.vec3.fromValues(C.coord.x,C.coord.y,b*C.height),U=te.vec3.fromValues(O.coord.x,O.coord.y,b*O.height);if(te.vec3.exactEquals(k,U))continue;const V=te.vec3.sub(te.vec3.create(),U,k);te.vec3.normalize(V,V);const N=lt=>te.vec3.normalize(lt,lt),$=w(T.a)||V,Z=w(T.b)||V,K=N(te.vec3.fromValues($[1],-$[0],0)),ae=N(te.vec3.fromValues(Z[1],-Z[0],0)),ie=N(te.vec3.cross(te.vec3.create(),K,$)),se=N(te.vec3.cross(te.vec3.create(),ae,Z)),ve=te.vec3.create(),le=[te.vec3.add(te.vec3.create(),k,te.vec3.scale(ve,te.vec3.sub(ve,K,ie),S)),te.vec3.add(te.vec3.create(),k,te.vec3.scale(ve,te.vec3.add(ve,K,ie),S)),te.vec3.add(te.vec3.create(),k,te.vec3.scale(ve,ie,S)),k],xe=[te.vec3.add(te.vec3.create(),U,te.vec3.scale(ve,te.vec3.sub(ve,ae,se),S)),te.vec3.add(te.vec3.create(),U,te.vec3.scale(ve,te.vec3.add(ve,ae,se),S)),te.vec3.add(te.vec3.create(),U,te.vec3.scale(ve,se,S)),U],[Me,Se]=e.addVertices(K,f,le[0],le[1]),[Ce,Ie]=e.addVertices(ae,f,xe[0],xe[1]);e.addTriangles([Me,Se,Ce,Se,Ie,Ce]);const[Fe,ze]=e.addVertices(ie,f,le[1],le[2]),[Ne,st]=e.addVertices(se,f,xe[1],xe[2]);e.addTriangles([Fe,ze,Ne,ze,st,Ne]);const[nt,Bt]=e.addVertices(te.vec3.negate(K,K),f,le[2],le[3]),[ft,St]=e.addVertices(te.vec3.negate(ae,ae),f,xe[2],xe[3]);e.addTriangles([nt,Bt,ft,Bt,St,ft])}}constructTunnelStructures(e,r,a,u,c,f){const y=b=>te.vec3.normalize(b,b);for(let b=c.min;b<c.max;b++){const S=this.prepareEdgePoints(r,a,u[b],(T,E)=>T<=E);if(S==null)continue;const[_,w]=S,M=y(te.vec3.fromValues(w.coord.y-_.coord.y,-(w.coord.x-_.coord.x),0));e.addQuad([_,w,{coord:w.coord,height:u[b].isTunnel?-.1:0},{coord:_.coord,height:u[b].isTunnel?-.1:0}],M)}for(let b=f.min;b<f.max;b++){const S=u[b],_=r[S.a],w=r[S.b],M=y(te.vec3.fromValues(w.y-_.y,-(w.x-_.x),0));e.addQuad([{coord:w,height:0},{coord:_,height:0},{coord:_,height:a[S.a]+4},{coord:w,height:a[S.b]+4}],M),e.addQuad([{coord:_,height:0},{coord:w,height:0},{coord:w,height:a[S.b]+4},{coord:_,height:a[S.a]+4}],M)}}prepareEdgePoints(e,r,a,u){const c=e[a.a],f=e[a.b];let y=r[a.a],b=r[a.b];if(!(y!==0&&u(y,0)||b!==0&&u(b,0)))return;const S=c.clone(),_=f.clone();if(u(y,0)){if(!u(b,0)){const w=b/(b-y);_.x=ar(_.x,S.x,w),_.y=ar(_.y,S.y,w),b=ar(b,y,w)}}else{const w=y/(y-b);S.x=ar(S.x,_.x,w),S.y=ar(S.y,_.y,w),y=ar(y,b,w)}return[{coord:S,height:y},{coord:_,height:b}]}prepareEdges(e,r){if(r.length===0)return;r.sort((y,b)=>y.hash===b.hash?b.polygonIdx-y.polygonIdx:b.hash>y.hash?1:-1);let a=0,u=0,c=0,f=r[a].polygonIdx;do u++,(u===r.length||r[a].hash!==r[u].hash)&&((u-a==1||r[u-1].polygonIdx!==f)&&(c<a&&(r[c]=r[a],r[a]=null),r[c].type="none",c++),a=u,a!==r.length&&(f=r[a].polygonIdx));while(a!==r.length);if(r.splice(c),r.length!==0&&e.length!==0){r.sort((S,_)=>S.hash<_.hash?1:-1);let y=0,b=0;for(;y!==r.length&&b!==e.length;){const S=r[y],_=e[b];S.portalHash>_.hash?y++:_.hash>S.portalHash?b++:(S.type=_.type,y++)}}}isOnBorder(e,r){return e<=0&&r<=0||e>=Ct&&r>=Ct}static computeEdgeHash(e,r){return(e.y===r.y&&e.x>r.x||e.y>r.y)&&([e,r]=[r,e]),BigInt(Jo.computePosHash(e))<<32n|BigInt(Jo.computePosHash(r))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}class W0{constructor(e,r){this.layoutVertexArray=new Io,this.indexArray=new wi,this.lineIndexArray=new Ea,this.triangleSegments=new $n,this.lineSegments=new $n,this.programConfigurations=new Ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new Ta)}update(e,r,a,u,c,f,y){this.programConfigurations.updatePaintArrays(e,r,c,a,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,OC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,kC.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,r,a,u,c,f){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,a,u,c,f)}}class Z0{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new W0(e,!1),this.elevationBufferData=new W0(e,!0),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,r){}populate(e,r,a,u){this.hasPattern=U0("fill",this.layers,this.pixelRatio,r);const c=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:y,id:b,index:S,sourceLayerIndex:_}of e){const w=this.layers[0]._featureFilter.needGeometry,M=F(y,w);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),M,a))continue;const T=c?c.evaluate(M,{},a,r.availableImages):void 0,E={id:b,properties:y.properties,type:y.type,sourceLayerIndex:_,index:S,geometry:w?M.geometry:L(y,a,u),patterns:{},sortKey:T};f.push(E)}c&&f.sort((y,b)=>y.sortKey-b.sortKey);for(const y of f){const{geometry:b,index:S,sourceLayerIndex:_}=y;if(this.hasPattern){const w=j0("fill",this.layers,y,this.zoom,this.pixelRatio,r);this.patternFeatures.push(w)}else this.addFeature(y,b,S,a,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(e[S].feature,b,S,_,this.index)}}update(e,r,a,u,c,f,y){this.bufferData.update(e,r,a,u,c,f,y),this.elevationBufferData.update(e,r,a,u,c,f,y)}addFeatures(e,r,a,u,c,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,r,a,u,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,r,a,u,c,f=[],y,b){const S=F_(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,S,u,a,b):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(e,a,c,f,u,y),this.elevationBufferData.populatePaintArrays(e,a,c,f,u,y)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,r,a,u,c){const f=new Array,y=this.getElevationFeature(e,c);if(y){f.push({polygons:r,elevationFeature:y,elevationTileID:a});for(const b of f)if(b.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Jo(b.elevationTileID));const _=b.elevationFeature.isTunnel();let w=0;e.properties.hasOwnProperty(Pb)&&(w=+e.properties[Pb]);for(const M of b.polygons)this.elevatedStructures.addPortalCandidates(b.elevationFeature.id,M,_,b.elevationFeature,w)}const S=new JC(a,b.elevationTileID);this.addElevatedGeometry(b.polygons,S,b.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u)}}else this.addGeometry(r,this.bufferData)}addElevatedGeometry(e,r,a,u,c){const f={elevation:a,elevationSampler:r,bias:u,index:c},[y,b]=this.addGeometry(e,this.elevationBufferData,f);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:y,max:b}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,y),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,b))}addGeometry(e,r,a){let u=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,f=null;a&&(f=a.elevationSampler.constantElevation(a.elevation,a.bias),f!=null&&(u=f,c=f));const y=(b,S,_)=>{if(a!=null)if(S.push(b),f!=null)r.elevatedLayoutVertexArray.emplaceBack(f),_.push(f);else{const w=a.elevationSampler.pointElevation(b,a.elevation,a.bias);r.elevatedLayoutVertexArray.emplaceBack(w),_.push(w),u=Math.min(u,w),c=Math.max(c,w)}};for(const b of e){let S=0;for(const V of b)S+=V.length;const _=r.triangleSegments.prepareSegment(S,r.layoutVertexArray,r.indexArray),w=_.vertexLength,M=[],T=[],E=[],C=[],O=[],k=r.layoutVertexArray.length;for(const V of b){if(V.length===0)continue;V!==b[0]&&T.push(M.length/2);const N=r.lineSegments.prepareSegment(V.length,r.layoutVertexArray,r.lineIndexArray),$=N.vertexLength;a&&O.push(r.layoutVertexArray.length-k),y(V[0],E,C),r.layoutVertexArray.emplaceBack(V[0].x,V[0].y),r.lineIndexArray.emplaceBack($+V.length-1,$),M.push(V[0].x),M.push(V[0].y);for(let Z=1;Z<V.length;Z++)y(V[Z],E,C),r.layoutVertexArray.emplaceBack(V[Z].x,V[Z].y),r.lineIndexArray.emplaceBack($+Z-1,$+Z),M.push(V[Z].x),M.push(V[Z].y);N.vertexLength+=V.length,N.primitiveLength+=V.length}const U=dp(M,T);for(let V=0;V<U.length;V+=3)r.indexArray.emplaceBack(w+U[V],w+U[V+1],w+U[V+2]);if(a&&this.elevationMode==="hd-road-base"){const V=a.elevation.isTunnel(),N=a.elevation.safeArea,$=this.elevatedStructures.addVertices(E,C);this.elevatedStructures.addTriangles(U,$,V);const Z=O.length;if(Z>0){for(let K=0;K<Z-1;K++)this.elevatedStructures.addRenderableRing(a.index,O[K]+$,O[K+1]-O[K],V,N);this.elevatedStructures.addRenderableRing(a.index,O[Z-1]+$,E.length-O[Z-1],V,N)}}_.vertexLength+=S,_.primitiveLength+=U.length/3}return[u,c]}getElevationFeature(e,r){if(!r)return;const a=+e.properties[lu];return a!=null?r.find(u=>u.id===a):void 0}}let zb,Lb,Ob,kb;Ft(Z0,"FillBucket",{omit:["layers","patternFeatures"]}),Ft(W0,"FillBufferData"),Ft(Jo,"ElevatedStructures");class X0{constructor(e,r,a,u){if(this.triangleCount=r.length/3,this.min=new Ae(0,0),this.max=new Ae(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[c,f]=[e[0].clone(),e[0].clone()];for(let w=1;w<e.length;++w){const M=e[w];c.x=Math.min(c.x,M.x),c.y=Math.min(c.y,M.y),f.x=Math.max(f.x,M.x),f.y=Math.max(f.y,M.y)}if(u){const w=Math.ceil(Math.max(f.x-c.x,f.y-c.y)/u);a=Math.max(a,w)}if(a===0)return;this.min=c,this.max=f;const y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);const b=Math.max(y.x,y.y)/a;this.cellsX=Math.max(1,Math.ceil(y.x/b)),this.cellsY=Math.max(1,Math.ceil(y.y/b)),this.xScale=1/b,this.yScale=1/b;const S=[];for(let w=0;w<this.triangleCount;w++){const M=e[r[3*w+0]].sub(this.min),T=e[r[3*w+1]].sub(this.min),E=e[r[3*w+2]].sub(this.min),C=Da(Math.floor(Math.min(M.x,T.x,E.x)),this.xScale,this.cellsX),O=Da(Math.floor(Math.max(M.x,T.x,E.x)),this.xScale,this.cellsX),k=Da(Math.floor(Math.min(M.y,T.y,E.y)),this.yScale,this.cellsY),U=Da(Math.floor(Math.max(M.y,T.y,E.y)),this.yScale,this.cellsY),V=new Ae(0,0),N=new Ae(0,0),$=new Ae(0,0),Z=new Ae(0,0);for(let K=k;K<=U;++K){V.y=N.y=K*b,$.y=Z.y=(K+1)*b;for(let ae=C;ae<=O;++ae)V.x=$.x=ae*b,N.x=Z.x=(ae+1)*b,(Be(M,T,E,V,N,Z)||Be(M,T,E,V,Z,$))&&S.push({cellIdx:K*this.cellsX+ae,triIdx:w})}}if(S.length===0)return;S.sort((w,M)=>w.cellIdx-M.cellIdx||w.triIdx-M.triIdx);let _=0;for(;_<S.length;){const w=S[_].cellIdx,M={start:this.payload.length,len:0};for(;_<S.length&&S[_].cellIdx===w;)++M.len,this.payload.push(S[_++].triIdx);this.cells[w]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=Da(e.x-this.min.x,this.xScale,this.cellsX),u=Da(e.y-this.min.y,this.yScale,this.cellsY),c=this.cells[u*this.cellsX+a];if(c){this._lazyInitLookup();for(let f=0;f<c.len;f++){const y=this.payload[c.start+f],b=Math.floor(y/8),S=1<<y%8;if(!(this.lookup[b]&S)&&(this.lookup[b]|=S,r.push(y),r.length===this.triangleCount))return}}}query(e,r,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const u=Da(e.x-this.min.x,this.xScale,this.cellsX),c=Da(r.x-this.min.x,this.xScale,this.cellsX),f=Da(e.y-this.min.y,this.yScale,this.cellsY),y=Da(r.y-this.min.y,this.yScale,this.cellsY);for(let b=f;b<=y;b++)for(let S=u;S<=c;S++){const _=this.cells[b*this.cellsX+S];if(_)for(let w=0;w<_.len;w++){const M=this.payload[_.start+w],T=Math.floor(M/8),E=1<<M%8;if(!(this.lookup[T]&E)&&(this.lookup[T]|=E,a.push(M),a.length===this.triangleCount))return}}}}function Da(o,e,r){return Math.max(0,Math.min(r-1,Math.floor(o*e)))}Ft(X0,"TriangleGridIndex");class Fb{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(e,r){for(const a of this.footprints)r.push({footprint:a,id:e})}populate(e,r,a,u){const c=[];for(const{feature:f,id:y,index:b,sourceLayerIndex:S}of e){const _=this.layers[0]._featureFilter.needGeometry,w=F(f,_);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),w,a))continue;const M={id:y,properties:f.properties,type:f.type,sourceLayerIndex:S,index:b,geometry:_?w.geometry:L(f,a,u),patterns:{}};c.push(M)}for(const f of c){const{geometry:y,index:b,sourceLayerIndex:S}=f;this.addFeature(f,y,b,a,{},r.availableImages,r.brightness),r.featureIndex.insert(e[b].feature,y,b,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,a,u,c,f,y){}destroy(){}addFeature(e,r,a,u,c,f=[],y){for(const b of F_(r,2)){const S=[],_=[],w=[],M=new Ae(1/0,1/0),T=new Ae(-1/0,-1/0);for(const O of b)if(O.length!==0){O!==b[0]&&w.push(_.length/2);for(let k=0;k<O.length;k++)_.push(O[k].x),_.push(O[k].y),S.push(O[k]),M.x=Math.min(M.x,O[k].x),M.y=Math.min(M.y,O[k].y),T.x=Math.max(T.x,O[k].x),T.y=Math.max(T.y,O[k].y)}const E=dp(_,w),C=new X0(S,E,8,256);this.footprints.push({vertices:S,indices:E,grid:C,min:M,max:T})}}}Ft(Fb,"ClipBucket",{omit:["layers"]});const eP=Jr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),tP=Jr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),rP=Jr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),nP=Jr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),iP=Jr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),sP=Jr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:oP}=eP;class uu extends Ae{constructor(e,r,a){super(e,r),this.z=a}}class Bb extends uu{constructor(e,r,a,u){super(e,r,a),this.w=u}}function N_(o,e,r,a){const u=[],c=a===0?(f,y,b,S,_,w)=>{f.push(new Ae(w,b+(w-y)/(S-y)*(_-b)))}:(f,y,b,S,_,w)=>{f.push(new Ae(y+(w-b)/(_-b)*(S-y),w))};for(const f of o){const y=[];for(const b of f){if(b.length<=2)continue;const S=[];for(let M=0;M<b.length-1;M++){const T=b[M].x,E=b[M].y,C=b[M+1].x,O=b[M+1].y,k=a===0?T:E,U=a===0?C:O;k<e?U>e&&c(S,T,E,C,O,e):k>r?U<r&&c(S,T,E,C,O,r):S.push(b[M]),U<e&&k>=e&&c(S,T,E,C,O,e),U>r&&k<=r&&c(S,T,E,C,O,r)}let _=b[b.length-1];const w=a===0?_.x:_.y;w>=e&&w<=r&&S.push(_),S.length&&(_=S[S.length-1],S[0].x===_.x&&S[0].y===_.y||S.push(S[0]),y.push(S))}y.length&&u.push(y)}return u}function Nb(o,e,r,a){const u=r==="x"?"y":"x",c=(a-o[r])/(e[r]-o[r]);o[u]=o[u]+(e[u]-o[u])*c,o[r]=a,o.hasOwnProperty("z")&&(o.z=ar(o.z,e.z,c)),o.hasOwnProperty("w")&&(o.w=ar(o.w,e.w,c))}function Vb(o,e,r,a){const u=r,c=a;for(const f of["x","y"]){let y=o,b=e;y[f]>=b[f]&&(y=e,b=o),y[f]<u&&b[f]>u&&Nb(y,b,f,u),y[f]<c&&b[f]>c&&Nb(b,y,f,c)}}const V_=Number.MAX_SAFE_INTEGER;function Ub(o,e,r,a){return o.order<e||o.order===V_||!(o.clipMask&r)||function(u,c){return c.length!==0&&c.find(f=>f===u)===void 0}(a,o.clipScope)}function U_(o,e){return o.x-e.x||o.y-e.y}function jb(o,e){return U_(o.min,e.min)===0&&U_(o.max,e.max)===0}function K0(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function Y0(o,e){if(o.length!==e.length)return!1;for(let r=0;r<o.length;r++)if(o[r].sourceId!==e[r].sourceId||!jb(o[r],e[r])||o[r].order!==e[r].order||o[r].clipMask!==e[r].clipMask||!bt(o[r].clipScope,e[r].clipScope))return!1;return!0}function $b(o,e,r){const a=1/Ct,u=1/(1<<r.canonical.z),c=(e.x*a+r.canonical.x)*u+r.wrap,f=(e.y*a+r.canonical.y)*u;return{min:new Ae((o.x*a+r.canonical.x)*u+r.wrap,(o.y*a+r.canonical.y)*u),max:new Ae(c,f)}}function aP(o,e,r){const a=1<<r.canonical.z,u=((e.x-r.wrap)*a-r.canonical.x)*Ct,c=(e.y*a-r.canonical.y)*Ct;return{min:new Ae(((o.x-r.wrap)*a-r.canonical.x)*Ct,(o.y*a-r.canonical.y)*Ct),max:new Ae(u,c)}}function Gb(o,e,r,a,u,c,f){const y=o.indices,b=o.vertices,S=[];for(let _=a;_<a+u;_+=3){const w=e[r[_+0]+c],M=e[r[_+1]+c],T=e[r[_+2]+c],E=Math.min(w.x,M.x,T.x),C=Math.max(w.x,M.x,T.x),O=Math.min(w.y,M.y,T.y),k=Math.max(w.y,M.y,T.y);S.length=0,o.grid.query(new Ae(E,O),new Ae(C,k),S);for(let U=0;U<S.length;U++){const V=S[U];if(Be(b[y[3*V+0]],b[y[3*V+1]],b[y[3*V+2]],w,M,T,f))return!0}}return!1}function Hb(o,e,r,a){if(!o||!r)return!1;let u=o.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(r.vertices.length<o.vertices.length)return Hb(r,a,o,e);const c=e.canonical,f=a.canonical,y=Math.pow(2,f.z-c.z);u=o.vertices.map(b=>new Ae((b.x+c.x*Ct)*y-f.x*Ct,(b.y+c.y*Ct)*y-f.y*Ct))}return Gb(r,u,o.indices,0,o.indices.length,0,0)}function qb(o,e,r,a){const u=Math.pow(2,a.z-r.z);return new Ae((o+r.x*Ct)*u-a.x*Ct,(e+r.y*Ct)*u-a.y*Ct)}function Wb(o,e){const r=[];e.grid.queryPoint(o,r);const a=e.indices,u=e.vertices;for(let c=0;c<r.length;c++){const f=r[c];if(me([u[a[3*f+0]],u[a[3*f+1]],u[a[3*f+2]]],o))return!0}return!1}const J0=[new Ae(0,0),new Ae(Ct,0),new Ae(Ct,Ct),new Ae(0,Ct)];function Zb(o,e){const r=[];let a=[];if(!e||o.length<2)return[o];if(o.length===2)return Ee(o[0],o[1],J0)?[o]:[];for(let u=0;u<o.length+2;u++){const c=o[u%o.length],f=o[(u+1)%o.length],y=Ee(u===0?o[o.length-1]:o[(u-1)%o.length],c,J0),b=Ee(c,f,J0),S=y||b;S&&a.push(c),S&&b||a.length>0&&(a.length>1&&r.push(a),a=[])}return a.length>1&&r.push(a),r}const Q0=Xl.VectorTileFeature.types,lP=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],cP=["fill-extrusion-flood-light-ground-radius"],uP=Math.pow(2,13),hP=Math.pow(2,15)-1,Xb=new Ae(0,1),Kl=2147483648;function _p(o,e,r,a,u,c,f,y){o.emplaceBack((e<<1)+f,(r<<1)+c,(Math.floor(a*uP)<<1)+u,Math.round(y))}function gp(o,e,r){o.emplaceBack(e.x*Ct,e.y*Ct,r?1:0)}function j_(o,e,r,a,u,c){o.emplaceBack(e.x,e.y,(r.x<<1)+a,(r.y<<1)+u,c)}function yp(o,e,r){o.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Kb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Yb{constructor(){this.centroidXY=new Ae(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ae(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ae(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ae(this.max.x-this.min.x,this.max.y-this.min.y)}}class Jb{constructor(){this.acc=new Ae(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,a){this.accCount++,this.acc._add(r);let u=!!this.borders;r.x<e.min.x?(e.min.x=r.x,u=!0):r.x>e.max.x&&(e.max.x=r.x,u=!0),r.y<e.min.y?(e.min.y=r.y,u=!0):r.y>e.max.y&&(e.max.y=r.y,u=!0),((r.x===0||r.x===Ct)&&r.x===a.x)!=((r.y===0||r.y===Ct)&&r.y===a.y)&&this.processBorderOverlap(r,a),u&&this.checkBorderIntersection(r,a)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,ar(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Ct!=e.x>Ct&&this.addBorderIntersection(1,ar(r.y,e.y,(Ct-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,ar(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Ct!=e.y>Ct&&this.addBorderIntersection(3,ar(r.x,e.x,(Ct-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Ae(0,0):new Ae(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function Qb(o,e){const r=o.add(e)._unit(),a=Ye(o.x*r.x+o.y*r.y,-1,1);var u,c,f;return f=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(f)))/4*hP*((u=o).x*(c=e).y-u.y*c.x<0?-1:1)}const dP=[o=>o.x<0,o=>o.x>Ct,o=>o.y<0,o=>o.y>Ct];function fP(o,e,r,a){const u=[4];if(a===0)return u;r._mult(a);const c=o.sub(r),f=e.sub(r),y=[o,e,c,f];for(let b=0;b<4;b++)for(const S of y)if(dP[b](S)){u.push(b);break}return u}class ew{constructor(e){this.vertexArray=new jf,this.indexArray=new wi,this.programConfigurations=new Ca(e.layers,{zoom:e.zoom,lut:e.lut},r=>cP.includes(r)),this._segments=new $n,this.hiddenByLandmarkVertexArray=new Uh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new $n}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,a,u=!1){const c=e.length;if(c>2){let f=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let b;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const S=e[0],_=e[1];b=Qb(S.sub(e[c-1])._perp()._unit(),_.sub(S)._perp()._unit())}for(let S=0;S<c;S++){const _=S===c-1?0:S+1,w=e[S],M=e[_],T=e[_===c-1?0:_+1],E=M.sub(w)._perp()._unit(),C=Qb(E,T.sub(M)._perp()._unit()),O=b,k=C;if(ev(w,M,r)||u&&nw(w,r)&&nw(M,r)){b=C;continue}const U=y.vertexLength;j_(this.vertexArray,w,M,1,1,O),j_(this.vertexArray,w,M,1,0,O),j_(this.vertexArray,w,M,0,1,k),j_(this.vertexArray,w,M,0,0,k),y.vertexLength+=4;const V=fP(w,M,E,a);for(const N of V)this._segmentToGroundQuads[f].push({id:U,region:N}),this._segmentToRegionTriCounts[f][N]+=2,y.primitiveLength+=2;b=C}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let a=0;a<r;a++)this._segmentToGroundQuads[a].sort((u,c)=>u.region-c.region);for(let a=0;a<r;a++){const u=this._segmentToGroundQuads[a],c=e[a],f=this._segmentToRegionTriCounts[a];f.reduce((b,S)=>b+S,0);let y=0;for(let b=0;b<=4;b++){const S=f[b];if(S!==0){let _=this.regionSegments[b];_||(_=this.regionSegments[b]=new $n);const w={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+y,vertexLength:c.vertexLength,primitiveLength:S};_.get().push(w)}y+=S}for(let b=0;b<u.length;b++){const S=u[b].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,a,u,c,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,a,u,c,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,tP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,a,u,c,f,y){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,a,u,c,f,y)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&Kl?1:0;for(let u=e.groundVertexArrayOffset;u<r;++u)this.hiddenByLandmarkVertexArray.emplace(u,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,iP.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class $_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new wi,this.footprintVertices=new Io,this.footprintSegments=[],this.layoutVertexArray=new nl,this.centroidVertexArray=new C_,this.wallVertexArray=new R_,this.indexArray=new wi,this.programConfigurations=new Ca(e.layers,{zoom:e.zoom,lut:e.lut},r=>lP.includes(r)),this.segments=new $n,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new ew(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,r){}populate(e,r,a,u){this.features=[],this.hasPattern=U0("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=t(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:c,id:f,index:y,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,_=F(c,S);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),_,a))continue;const w={id:f,sourceLayerIndex:b,index:y,geometry:S?_.geometry:L(c,a,u),properties:c.properties,type:c.type,patterns:{}},M=this.layoutVertexArray.length,T=Q0[w.type]==="Polygon";if(this.hasPattern)this.features.push(j0("fill-extrusion",this.layers,w,this.zoom,this.pixelRatio,r));else if(this.wallMode)for(const E of w.geometry)for(const C of Zb(E,T))this.addFeature(w,[C],y,a,{},r.availableImages,u,r.brightness);else this.addFeature(w,w.geometry,y,a,{},r.availableImages,u,r.brightness);r.featureIndex.insert(c,w.geometry,y,b,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,a,u,c,f){for(const y of this.features){const b=Q0[y.type]==="Polygon",{geometry:S}=y;if(this.wallMode)for(const _ of S)for(const w of Zb(_,b))this.addFeature(y,[w],y.index,r,a,u,c,f);else this.addFeature(y,S,y.index,r,a,u,c,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,a,u,c,f,y){this.programConfigurations.updatePaintArrays(e,r,c,a,u,f,y),this.groundEffect.update(e,r,c,a,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,oP),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,nP.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,sP.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,rP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,u,c,f,y,b){const S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,_=[new Ae(0,0),new Ae(Ct,Ct)],w=y.projection,M=w.name==="globe",T=this.wallMode||Q0[e.type]==="Polygon",E=new Jb;E.centroidDataIndex=this.centroidData.length;const C=new Yb,O=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,k=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);let U;if(C.height=k,C.vertexArrayOffset=this.layoutVertexArray.length,C.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Oh),this.wallMode){if(M)return void Pr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;U=function(se){const ve=se[0].x===se[se.length-1].x&&se[0].y===se[se.length-1].y;(function(St){let lt=0;const tr=St.length;for(let Ot=0;Ot<tr;Ot++)lt+=(St[(Ot+1)%tr].x-St[Ot].x)*(St[(Ot+1)%tr].y+St[Ot].y);return lt>=0})(se)||(se=se.reverse());const xe={geometry:[],joinNormals:[],indices:[]},Me=[],Se=[],Ce=[];let Ie=se.length;for(;Ie>=2&&se[Ie-1].equals(se[Ie-2]);)Ie--;if(Ie<(ve?3:2))return xe;let Fe,ze,Ne,st,nt,Bt=0;for(;Bt<Ie-1&&se[Bt].equals(se[Bt+1]);)Bt++;ve&&(Fe=se[Ie-2],nt=se[Bt].sub(Fe)._unit()._perp());for(let St=Bt;St<Ie;St++){if(Ne=St===Ie-1?ve?se[Bt+1]:void 0:se[St+1],Ne&&se[St].equals(Ne))continue;nt&&(st=nt),Fe&&(ze=Fe),Fe=se[St],nt=Ne?Ne.sub(Fe)._unit()._perp():st,st=st||nt;let lt=st.add(nt);lt.x===0&&lt.y===0||lt._unit();const tr=lt.x*nt.x+lt.y*nt.y,Ot=tr!==0?1/tr:1/0,qt=st.x*nt.y-st.y*nt.x>0;let dr="miter";const Mr=2;dr==="miter"&&Ot>Mr&&(dr="bevel"),dr==="bevel"&&(Ot>100&&(dr="flipbevel"),Ot<Mr&&(dr="miter"));const yr=(Lr,Sr,Fr,Yr)=>{const wn=new Ae(Lr.x,Lr.y),_r=new Ae(Lr.x,Lr.y);wn.x+=Sr.x*Yr,wn.y+=Sr.y*Yr,_r.x-=Sr.x*Math.max(Fr,1),_r.y-=Sr.y*Math.max(Fr,1),Ce.push(Sr),Me.push(wn),Se.push(_r)};if(dr==="miter")lt._mult(Ot),yr(Fe,lt,0,0);else if(dr==="flipbevel")lt=nt.mult(-1),yr(Fe,lt,0,0),yr(Fe,lt.mult(-1),0,0);else{const Lr=-Math.sqrt(Ot*Ot-1),Sr=qt?Lr:0,Fr=qt?0:Lr;ze&&yr(Fe,st,Sr,Fr),Ne&&yr(Fe,nt,Sr,Fr)}}xe.geometry=[...Me,...Se.reverse(),Me[0]],xe.joinNormals=[...Ce,...Ce.reverse(),Ce[Ce.length-1]];const ft=xe.geometry.length-1;for(let St=0;St<ft/2;St++)if(St+1<ft/2){let lt=St,tr=St+1,Ot=ft-1-St,qt=ft-2-St;lt=lt===0?ft-1:lt-1,tr=tr===0?ft-1:tr-1,Ot=Ot===0?ft-1:Ot-1,qt=qt===0?ft-1:qt-1,xe.indices.push(Ot),xe.indices.push(tr),xe.indices.push(lt),xe.indices.push(Ot),xe.indices.push(qt),xe.indices.push(tr)}return xe}(r[0]),r=[U.geometry]}const V=(se,ve)=>se<(ve.length-1)/2||se===ve.length-1,N=this.wallMode?[r]:F_(r,500);for(let se=N.length-1;se>=0;se--){const ve=N[se];(ve.length===0||($=ve[0]).every(le=>le.x<=0)||$.every(le=>le.x>=Ct)||$.every(le=>le.y<=0)||$.every(le=>le.y>=Ct))&&N.splice(se,1)}var $;let Z;if(M)Z=aw(N,_,u);else{Z=[];for(const se of N)Z.push({polygon:se,bounds:_})}const K=T?this.edgeRadius:0,ae=K>0&&this.zoom<17,ie=(se,ve)=>{if(se.length===0)return!1;const le=se[se.length-1];return ve.x===le.x&&ve.y===le.y};for(const{polygon:se,bounds:ve}of Z){let le=0,xe=0;for(const Ie of se)T&&!Ie[0].equals(Ie[Ie.length-1])&&Ie.push(Ie[0]),xe+=T?Ie.length-1:Ie.length;const Me=this.segments.prepareSegment((T?5:4)*xe,this.layoutVertexArray,this.indexArray);C.footprintSegIdx<0&&(C.footprintSegIdx=this.footprintSegments.length),C.polygonSegIdx<0&&(C.polygonSegIdx=this.polygonSegments.length);const Se={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ce=new Kb;if(Ce.vertexOffset=this.footprintVertices.length,Ce.indexOffset=3*this.footprintIndices.length,Ce.ringIndices=[],T){const Ie=[],Fe=[];le=Me.vertexLength;for(let Ne=0;Ne<se.length;Ne++){const st=se[Ne];st.length&&Ne!==0&&Fe.push(Ie.length/2);const nt=[];let Bt,ft;Bt=st[1].sub(st[0])._perp()._unit(),Ce.ringIndices.push(st.length-1);for(let St=1;St<st.length;St++){const lt=st[St],tr=st[St===st.length-1?1:St+1],Ot=lt.clone();if(K){ft=tr.sub(lt)._perp()._unit();const qt=Bt.add(ft)._unit(),dr=K*Math.min(4,1/(Bt.x*qt.x+Bt.y*qt.y));Ot.x+=dr*qt.x,Ot.y+=dr*qt.y,Ot.x=Math.round(Ot.x),Ot.y=Math.round(Ot.y),Bt=ft}if(!O||K!==0&&!ae||ie(nt,Ot)||nt.push(Ot),_p(this.layoutVertexArray,Ot.x,Ot.y,0,0,1,1,0),this.wallMode){const qt=V(St,st);gp(this.wallVertexArray,U.joinNormals[St],!qt)}Me.vertexLength++,this.footprintVertices.emplaceBack(lt.x,lt.y),Ie.push(lt.x,lt.y),M&&yp(this.layoutVertexExtArray,w.projectTilePoint(Ot.x,Ot.y,u),w.upVector(u,Ot.x,Ot.y))}O&&(K===0||ae)&&(nt.length!==0&&ie(nt,nt[0])&&nt.pop(),this.groundEffect.addData(nt,ve,S))}const ze=this.wallMode?U.indices:dp(Ie,Fe);for(let Ne=0;Ne<ze.length;Ne+=3)this.footprintIndices.emplaceBack(Ce.vertexOffset+ze[Ne+0],Ce.vertexOffset+ze[Ne+1],Ce.vertexOffset+ze[Ne+2]),this.indexArray.emplaceBack(le+ze[Ne],le+ze[Ne+2],le+ze[Ne+1]),Me.primitiveLength++;Ce.indexCount+=ze.length,Ce.vertexCount+=this.footprintVertices.length-Ce.vertexOffset}for(let Ie=0;Ie<se.length;Ie++){const Fe=se[Ie];E.startRing(C,Fe[0]);let ze=Fe.length>4&&iw(Fe[Fe.length-2],Fe[0],Fe[1]),Ne=K?pP(Fe[Fe.length-2],Fe[0],Fe[1],K):0;const st=[];let nt,Bt,ft;Bt=Fe[1].sub(Fe[0])._perp()._unit();let St=!0;for(let lt=1,tr=0;lt<Fe.length;lt++){let Ot=Fe[lt-1],qt=Fe[lt];const dr=Fe[lt===Fe.length-1?1:lt+1];if(E.appendEdge(C,qt,Ot),ev(qt,Ot,ve)){K&&(Bt=dr.sub(qt)._perp()._unit(),St=!St);continue}const Mr=qt.sub(Ot)._perp(),yr=Mr.x/(Math.abs(Mr.x)+Math.abs(Mr.y)),Lr=Mr.y>0?1:0,Sr=Ot.dist(qt);if(tr+Sr>32768&&(tr=0),K){ft=dr.sub(qt)._perp()._unit();let _r=rw(Ot,qt,dr,tw(Bt,ft),K);isNaN(_r)&&(_r=0);const jr=qt.sub(Ot)._unit();Ot=Ot.add(jr.mult(Ne))._round(),qt=qt.add(jr.mult(-_r))._round(),Ne=_r,Bt=ft,O&&this.zoom>=17&&(ie(st,Ot)||st.push(Ot),ie(st,qt)||st.push(qt))}const Fr=Me.vertexLength,Yr=Fe.length>4&&iw(Ot,qt,dr);let wn=sw(tr,ze,St);if(_p(this.layoutVertexArray,Ot.x,Ot.y,yr,Lr,0,0,wn),_p(this.layoutVertexArray,Ot.x,Ot.y,yr,Lr,0,1,wn),this.wallMode){const _r=V(lt-1,Fe),jr=U.joinNormals[lt-1];gp(this.wallVertexArray,jr,_r),gp(this.wallVertexArray,jr,_r)}if(tr+=Sr,wn=sw(tr,Yr,!St),ze=Yr,_p(this.layoutVertexArray,qt.x,qt.y,yr,Lr,0,0,wn),_p(this.layoutVertexArray,qt.x,qt.y,yr,Lr,0,1,wn),this.wallMode){const _r=V(lt,Fe),jr=U.joinNormals[lt];gp(this.wallVertexArray,jr,_r),gp(this.wallVertexArray,jr,_r)}if(Me.vertexLength+=4,this.indexArray.emplaceBack(Fr+0,Fr+1,Fr+2),this.indexArray.emplaceBack(Fr+1,Fr+3,Fr+2),Me.primitiveLength+=2,K){const _r=le+(lt===1?Fe.length-2:lt-2),jr=lt===1?le:_r+1;if(this.indexArray.emplaceBack(Fr+1,_r,Fr+3),this.indexArray.emplaceBack(_r,jr,Fr+3),Me.primitiveLength+=2,nt===void 0&&(nt=Fr),!ev(dr,Fe[lt],ve)){const Cn=lt===Fe.length-1?nt:Me.vertexLength;this.indexArray.emplaceBack(Fr+2,Fr+3,Cn),this.indexArray.emplaceBack(Fr+3,Cn+1,Cn),this.indexArray.emplaceBack(Fr+3,jr,Cn+1),Me.primitiveLength+=3}St=!St}if(M){const _r=this.layoutVertexExtArray,jr=w.projectTilePoint(Ot.x,Ot.y,u),Cn=w.projectTilePoint(qt.x,qt.y,u),Bn=w.upVector(u,Ot.x,Ot.y),Wn=w.upVector(u,qt.x,qt.y);yp(_r,jr,Bn),yp(_r,jr,Bn),yp(_r,Cn,Wn),yp(_r,Cn,Wn)}}T&&(le+=Fe.length-1),O&&K&&this.zoom>=17&&(st.length!==0&&ie(st,st[0])&&st.pop(),this.groundEffect.addData(st,ve,S,K>0))}this.footprintSegments.push(Ce),Se.triangleCount=this.indexArray.length-Se.triangleArrayOffset,this.polygonSegments.push(Se),++C.footprintSegLen,++C.polygonSegLen}if(C.vertexCount=this.layoutVertexArray.length-C.vertexArrayOffset,C.groundVertexCount=this.groundEffect.vertexArray.length-C.groundVertexArrayOffset,C.vertexCount!==0){if(C.centroidXY=E.borders?Xb:this.encodeCentroid(E,C),this.centroidData.push(C),E.borders){this.featuresOnBorder.push(E);const se=this.featuresOnBorder.length-1;for(let ve=0;ve<E.borders.length;ve++)E.borders[ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ve].push(se)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,c,f,u,b),this.groundEffect.addPaintPropertiesData(e,a,c,f,u,b),this.maxHeight=Math.max(this.maxHeight,k)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],S=+(b.min.y+b.max.y>Ct),_=2*S+(+(b.min.x+b.max.x>Ct)^S);for(let w=0;w<b.polygonSegLen;w++){const M=b.polygonSegIdx+w;e.push({centroidIdx:y,subtile:_,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const r=new wi;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let a=0,u=0,c=0;for(const y of e){if(y.triangleSegmentIdx!==a)break;c++}const f=e.length;for(;u!==e.length;){a=e[u].triangleSegmentIdx;let y=0,b=u,S=u;for(let _=b;_<c&&e[_].subtile===y;_++)S++;for(;b!==c;){const _=e[b];y=_.subtile;const w=this.centroidData[_.centroidIdx].min.clone(),M=this.centroidData[_.centroidIdx].max.clone(),T={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let E=b;E<S;E++){const C=e[E],O=this.polygonSegments[C.polygonSegmentIdx],k=this.centroidData[C.centroidIdx].min,U=this.centroidData[C.centroidIdx].max,V=this.indexArray.uint16;for(let N=O.triangleArrayOffset;N<O.triangleArrayOffset+O.triangleCount;N++)r.emplaceBack(V[3*N],V[3*N+1],V[3*N+2]);T.primitiveLength+=O.triangleCount,w.x=Math.min(w.x,k.x),w.y=Math.min(w.y,k.y),M.x=Math.max(M.x,U.x),M.y=Math.max(M.y,U.y)}T.primitiveLength>0&&this.triangleSubSegments.push({segment:T,min:w,max:M}),b=S;for(let E=b;E<c&&e[E].subtile===e[b].subtile;E++)S++}u=c;for(let _=u;_<f&&e[_].triangleSegmentIdx===e[u].triangleSegmentIdx;_++)c++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,a){const u=new $n;if(this.wallMode){for(const C of this.triangleSubSegments)u.segments.push(C.segment);return u}let c=0,f=0;const y=1<<e.canonical.z;if(r){const C=r.getMinMaxForTile(e);C&&(c=C.min,f=C.max)}f+=this.maxHeight;const b=e.toUnwrapped();let S;const _=[b.canonical.x/y+b.wrap,b.canonical.y/y],w=[(b.canonical.x+1)/y+b.wrap,(b.canonical.y+1)/y],M=(C,O,k)=>[C[0]*(1-k[0])+O[0]*k[0],C[1]*(1-k[1])+O[1]*k[1]],T=[],E=[];for(const C of this.triangleSubSegments){T[0]=C.min.x/Ct,T[1]=C.min.y/Ct,E[0]=C.max.x/Ct,E[1]=C.max.y/Ct;const O=M(_,w,T),k=M(_,w,E);if(new or([O[0],O[1],c],[k[0],k[1],f]).intersectsPrecise(a)===0){S&&(u.segments.push(S),S=void 0);continue}const U=C.segment;S&&S.vertexOffset!==U.vertexOffset&&(u.segments.push(S),S=void 0),S?(S.vertexLength+=U.vertexLength,S.primitiveLength+=U.primitiveLength):S={vertexOffset:U.vertexOffset,primitiveLength:U.primitiveLength,vertexLength:U.vertexLength,primitiveOffset:U.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&u.segments.push(S),u}encodeCentroid(e,r){const a=e.centroid(),u=r.span(),c=Math.min(7,Math.round(u.x*this.tileToMeter/10)),f=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Ae(Ye(a.x,1,Ct-1)<<3|c,Ye(a.y,1,Ct-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Ae(0,0);const r=e.borders,a=Number.MAX_VALUE;if(r[0][0]!==a||r[1][0]!==a){const u=r[0][0]!==a?0:1;return new Ae(6|(r[0][0]!==a?0:65528),(r[u][0]+r[u][1])/2<<3|6)}{const u=r[2][0]!==a?2:3;return new Ae((r[u][0]+r[u][1])/2<<3|6,6|(r[2][0]!==a?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=Kl,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,u=e.flags&Kl?Xb:e.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==u.y||c!==u.x){for(let f=r;f<a;++f)this.centroidVertexArray.emplace(f,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,a){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(e.toUnwrapped());if(Y0(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const c=[];for(const f of this.activeReplacements){if(f.order<a)continue;const y=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const b of this.centroidData)if(!(b.flags&Kl||f.min.x>b.max.x||b.min.x>f.max.x||f.min.y>b.max.y||b.min.y>f.max.y))for(let S=0;S<b.footprintSegLen;S++){const _=this.footprintSegments[b.footprintSegIdx+S];if(c.length=0,mP(this.footprintVertices,_.vertexOffset,_.vertexCount,f.footprintTileId.canonical,e.canonical,c),Gb(f.footprint,c,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-y)){b.flags|=Kl;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,a){let u=!1;for(let c=0;c<a.footprintSegLen;c++){const f=this.footprintSegments[a.footprintSegIdx+c];let y=0;for(const b of f.ringIndices){for(let S=y,_=b+y-1;S<b+y;_=S++){const w=this.footprintVertices.int16[2*(S+f.vertexOffset)+0],M=this.footprintVertices.int16[2*(S+f.vertexOffset)+1],T=this.footprintVertices.int16[2*(_+f.vertexOffset)+1];M>r!=T>r&&e<(this.footprintVertices.int16[2*(_+f.vertexOffset)+0]-w)*(r-M)/(T-M)+w&&(u=!u)}y=b}}return u}getHeightAtTileCoord(e,r){let a=Number.NEGATIVE_INFINITY,u=!0;const c=4*(e+Ct)*Ct+(r+Ct);if(this.partLookup.hasOwnProperty(c)){const f=this.partLookup[c];return f?{height:f.height,hidden:!!(f.flags&Kl)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||r>f.max.y||f.min.y>r||this.footprintContainsPoint(e,r,f)&&f&&f.height>a&&(a=f.height,this.partLookup[c]=f,u=!!(f.flags&Kl));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.partLookup[c]=void 0}}function tw(o,e){const r=o.add(e)._unit();return o.x*r.x+o.y*r.y}function pP(o,e,r,a){const u=e.sub(o)._perp()._unit(),c=r.sub(e)._perp()._unit();return rw(o,e,r,tw(u,c),a)}function rw(o,e,r,a,u){const c=Math.sqrt(1-a*a);return Math.min(o.dist(e)/3,e.dist(r)/3,u*c/a)}function ev(o,e,r){return o.x<r[0].x&&e.x<r[0].x||o.x>r[1].x&&e.x>r[1].x||o.y<r[0].y&&e.y<r[0].y||o.y>r[1].y&&e.y>r[1].y}function nw(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function iw(o,e,r){if(o.x<0||o.x>=Ct||e.x<0||e.x>=Ct||r.x<0||r.x>=Ct)return!1;const a=r.sub(e),u=a.perp(),c=o.sub(e);return(a.x*c.x+a.y*c.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(c.x*c.x+c.y*c.y))>-.866&&u.x*c.x+u.y*c.y<0}function sw(o,e,r){const a=e?2|o:-3&o;return r?1|a:-2&a}function ow(){const o=Math.PI/32,e=Math.tan(o),r=ql;return r*Math.sqrt(1+2*e*e)-r}function aw(o,e,r){const a=1<<r.z,u=us(r.x/a),c=us((r.x+1)/a),f=Mi(r.y/a),y=Mi((r.y+1)/a);return function(b,S,_,w,M=0,T){const E=[];if(!b.length||!_||!w)return E;const C=(Z,K)=>{for(const ae of Z)E.push({polygon:ae,bounds:K})},O=Math.ceil(Math.log2(_)),k=Math.ceil(Math.log2(w)),U=O-k,V=[];for(let Z=0;Z<Math.abs(U);Z++)V.push(U>0?0:1);for(let Z=0;Z<Math.min(O,k);Z++)V.push(0),V.push(1);let N=b;if(N=N_(N,S[0].y-M,S[1].y+M,1),N=N_(N,S[0].x-M,S[1].x+M,0),!N.length)return E;const $=[];for(V.length?$.push({polygons:N,bounds:S,depth:0}):C(N,S);$.length;){const Z=$.pop(),K=Z.depth,ae=V[K],ie=Z.bounds[0],se=Z.bounds[1],ve=ae===0?ie.x:ie.y,le=ae===0?se.x:se.y,xe=T?T(ae,ve,le):.5*(ve+le),Me=N_(Z.polygons,ve-M,xe+M,ae),Se=N_(Z.polygons,xe-M,le+M,ae);if(Me.length){const Ce=[ie,new Ae(ae===0?xe:se.x,ae===1?xe:se.y)];V.length>K+1?$.push({polygons:Me,bounds:Ce,depth:K+1}):C(Me,Ce)}if(Se.length){const Ce=[new Ae(ae===0?xe:ie.x,ae===1?xe:ie.y),se];V.length>K+1?$.push({polygons:Se,bounds:Ce,depth:K+1}):C(Se,Ce)}}return E}(o,e,Math.ceil((c-u)/11.25),Math.ceil((f-y)/11.25),1,(b,S,_)=>{if(b===0)return .5*(S+_);{const w=Mi((r.y+S/Ct)/a);return(so(.5*(Mi((r.y+_/Ct)/a)+w))*a-r.y)*Ct}})}function mP(o,e,r,a,u,c){const f=Math.pow(2,a.z-u.z);for(let y=0;y<r;y++){let b=o.int16[2*(y+e)+0],S=o.int16[2*(y+e)+1];b=(b+u.x*Ct)*f-a.x*Ct,S=(S+u.y*Ct)*f-a.y*Ct,c.push(new Ae(b,S))}}let lw,cw;function vp(o,e){return o.x*e.x+o.y*e.y}function uw(o,e){if(o.length===1){let r=0;const a=e[r++];let u;for(;!u||a.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const c=e[r],f=o[0],y=u.sub(a),b=c.sub(a),S=f.sub(a),_=vp(y,y),w=vp(y,b),M=vp(b,b),T=vp(S,y),E=vp(S,b),C=_*M-w*w,O=(M*T-w*E)/C,k=(_*E-w*T)/C,U=a.z*(1-O-k)+u.z*O+c.z*k;if(isFinite(U))return U}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function hw(o,e,r,a,u,c,f,y){const b=f*u.getElevationAt(o,e,!0,!0),S=c[0]!==0,_=S?c[1]===0?f*(c[0]/7-450):f*function(w,M,T){const E=Math.floor(M[0]/8),C=Math.floor(M[1]/8),O=10*(M[0]-8*E),k=10*(M[1]-8*C),U=w.getElevationAt(E,C,!0,!0),V=w.getMeterToDEM(T),N=Math.floor(.5*(O*V-1)),$=Math.floor(.5*(k*V-1)),Z=w.tileCoordToPixel(E,C),K=2*N+1,ae=2*$+1,ie=function(Se,Ce,Ie,Fe,ze){return[Se.getElevationAtPixel(Ce,Ie,!0),Se.getElevationAtPixel(Ce+ze,Ie,!0),Se.getElevationAtPixel(Ce,Ie+ze,!0),Se.getElevationAtPixel(Ce+Fe,Ie+ze,!0)]}(w,Z.x-N,Z.y-$,K,ae),se=Math.abs(ie[0]-ie[1]),ve=Math.abs(ie[2]-ie[3]),le=Math.abs(ie[0]-ie[2])+Math.abs(ie[1]-ie[3]),xe=Math.min(.25,.5*V*(se+ve)/K),Me=Math.min(.25,.5*V*le/ae);return U+Math.max(xe*O,Me*k)}(u,c,y):b;return{base:b+(r===0?-1:r),top:S?Math.max(_+a,b+r+2):b+a}}Ft($_,"FillExtrusionBucket",{omit:["layers","features"]}),Ft(Yb,"PartData"),Ft(Kb,"FootprintSegment"),Ft(Jb,"BorderCentroidData"),Ft(ew,"GroundEffect");const _P=Jr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),gP=Jr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:yP}=_P,vP=Jr([{name:"a_packed",components:3,type:"Float32"}]),{members:xP}=vP,bP=Jr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:wP}=bP;class dw{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Zl({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=Ki(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const u=[];let c=e.length%2==1?-e[e.length-1]*a:0,f=e[0]*a,y=!0;u.push({left:c,right:f,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let S=1;S<e.length;S++){y=!y;const _=e[S];c=b*a,b+=_,f=b*a,u.push({left:c,right:f,isDash:y,zeroLength:_===0})}return u}addRoundDash(e,r,a){const u=r/2;for(let c=-a;c<=a;c++){const f=this.width*(this.nextRow+a+c);let y=0,b=e[y];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++y]);const _=Math.abs(S-b.left),w=Math.abs(S-b.right),M=Math.min(_,w);let T;const E=c/a*(u+1);if(b.isDash){const C=u-Math.abs(E);T=Math.sqrt(M*M+C*C)}else T=u-Math.sqrt(M*M+E*E);this.image.data[f+S]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const S=e[b],_=e[b+1];S.zeroLength?e.splice(b,1):_&&_.isDash===S.isDash&&(_.left=S.left,e.splice(b,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const c=this.width*this.nextRow;let f=0,y=e[f];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++f]);const S=Math.abs(b-y.left),_=Math.abs(b-y.right),w=Math.min(S,_);this.image.data[c+b]=Math.max(0,Math.min(255,(y.isDash?w:-w)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const u=r==="round",c=u?7:0,f=2*c+1;if(this.nextRow+f>this.height)return Pr("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let _=0;_<e.length;_++)e[_]<0&&(Pr("Negative value is found in line dasharray, replacing values with 0"),e[_]=0),y+=e[_];if(y!==0){const _=this.width/y,w=this.getDashRanges(e,this.width,_);u?this.addRoundDash(w,_,c):this.addRegularDash(w,r==="square"?.5*_:0)}const b=this.nextRow+c;this.nextRow+=f;const S={tl:[b,c],br:[y,0]};return this.positions[a]=S,S}}Ft(dw,"LineAtlas");const TP=Xl.VectorTileFeature.types,SP=Math.cos(Math.PI/180*37.5),EP=Math.cos(Math.PI/180*5);class tv{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new zh,this.layoutVertexArray2=new Co,this.patternVertexArray=new Co,this.indexArray=new wi,this.programConfigurations=new Ca(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new $n,this.maxLineLength=0,this.zOffsetVertexArray=new Co,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Ct/64}updateFootprints(e,r){}populate(e,r,a,u){this.hasPattern=U0("line",this.layers,this.pixelRatio,r);const c=this.layers[0].layout.get("line-sort-key");this.tileToMeter=t(a);const f=this.layers[0].layout.get("line-z-offset"),y=f.isConstant()&&!f.constantOr(0),b=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=b==="sea"||b==="ground"||!y&&b==="none",this.hasZOffset&&b==="none"&&Pr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&S!==void 0;const _=[];for(const{feature:E,id:C,index:O,sourceLayerIndex:k}of e){const U=this.layers[0]._featureFilter.needGeometry,V=F(E,U);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),V,a))continue;const N=c?c.evaluate(V,{},a):void 0,$={id:C,properties:E.properties,type:E.type,sourceLayerIndex:k,index:O,geometry:U?V.geometry:L(E,a,u),patterns:{},sortKey:N};_.push($)}c&&_.sort((E,C)=>E.sortKey-C.sortKey);const{lineAtlas:w,featureIndex:M}=r,T=this.addConstantDashes(w);for(const E of _){const{geometry:C,index:O,sourceLayerIndex:k}=E;if(T&&this.addFeatureDashes(E,w),this.hasPattern){const U=j0("line",this.layers,E,this.zoom,this.pixelRatio,r);this.patternFeatures.push(U)}else this.addFeature(E,C,O,a,w.positions,r.availableImages,r.brightness);M.insert(e[O].feature,C,O,k,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,c=a.layout.get("line-cap").value;if(u.kind!=="constant"||c.kind!=="constant")r=!0;else{const f=c.value,y=u.value;if(!y)continue;e.addDash(y,f)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const u of this.layers){const c=u.paint.get("line-dasharray").value,f=u.layout.get("line-cap").value;if(c.kind==="constant"&&f.kind==="constant")continue;let y,b;if(c.kind==="constant"){if(y=c.value,!y)continue}else y=c.evaluate({zoom:a},e);b=f.kind==="constant"?f.value:f.evaluate({zoom:a},e),r.addDash(y,b),e.patterns[u.id]=r.getKey(y,b)}}update(e,r,a,u,c,f,y){this.programConfigurations.updatePaintArrays(e,r,c,a,u,f,y)}addFeatures(e,r,a,u,c,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,r,a,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,xP)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,wP)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,gP.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yP),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,u,c,f,y){const b=this.layers[0].layout,S=b.get("line-join").evaluate(e,{}),_=b.get("line-cap").evaluate(e,{}),w=b.get("line-miter-limit"),M=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=b.get("line-z-offset").value;const T=this.layers[0].paint.get("line-width").value;T.kind!=="constant"&&T.isLineProgressConstant===!1&&(this.variableWidthValue=T);for(const E of r)this.addLine(E,e,u,S,_,w,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,c,f,u,y)}addLine(e,r,a,u,c,f,y){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const b=u==="none";if(this.patternJoinNone=this.hasPattern&&b,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let V=0;V<e.length-1;V++)this.totalDistance+=e[V].dist(e[V+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=TP[r.type]==="Polygon";let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let w=0;for(;w<_-1&&e[w].equals(e[w+1]);)w++;if(_<(S?3:2))return;u==="bevel"&&(f=1.05);const M=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let T,E,C,O,k,U;this.e1=this.e2=-1,S&&(T=e[_-2],k=e[w].sub(T)._unit()._perp());for(let V=w;V<_;V++){if(C=V===_-1?S?e[w+1]:void 0:e[V+1],C&&e[V].equals(C))continue;k&&(O=k),T&&(E=T),T=e[V],U=this.evaluateLineProgressFeatures(E?E.dist(T):0),k=C?C.sub(T)._unit()._perp():O,O=O||k;const N=E&&C;let $=N?u:S||b?"butt":c;const Z=O.x*k.x+O.y*k.y;if(b){const Me=function(Se){if(Se.patternJoinNone){const Ce=Se.segmentPoints.length/2,Ie=Se.lineSoFar-Se.segmentStart;for(let Fe=0;Fe<Ce;++Fe){const ze=Se.segmentPoints[2*Fe+1],Ne=Math.round(Se.segmentPoints[2*Fe])+.5+.25*ze;Se.patternVertexArray.emplaceBack(Ne,Ie,Se.segmentStart),Se.patternVertexArray.emplaceBack(Ne,Ie,Se.segmentStart)}Se.segmentPoints.length=0}Se.e1=Se.e2=-1};if(N&&Z<EP){this.updateDistance(E,T),this.addCurrentVertex(T,O,1,1,M,U),Me(this),this.addCurrentVertex(T,k,-1,-1,M,U);continue}if(E){if(!C){this.updateDistance(E,T),this.addCurrentVertex(T,O,1,1,M,U),Me(this);continue}$="miter"}}let K=O.add(k);K.x===0&&K.y===0||K._unit();const ae=K.x*k.x+K.y*k.y,ie=ae!==0?1/ae:1/0,se=2*Math.sqrt(2-2*ae),ve=ae<SP&&E&&C,le=O.x*k.y-O.y*k.x>0,xe=this.overscaling<=16?15*Ct/(512*this.overscaling):0;if(N&&$==="round"){if(ie<y)$="miter";else if(ie<=2){const Me=rv(T,-10,Ct+10);$=this.hasZOffset&&(Me||this.hasCrossSlope)?"miter":"fakeround"}}if($==="miter"&&ie>f&&($="bevel"),$==="bevel"&&(ie>2&&($="flipbevel"),ie<f&&($="miter")),E&&!($==="miter"&&ve)&&this.updateDistance(E,T),$==="miter")if(ve){const Me=T.dist(E);if(Me>2*xe){const Ce=T.sub(T.sub(E)._mult(xe/Me)._round());this.updateDistance(E,Ce),this.addCurrentVertex(Ce,O,0,0,M,U),E=Ce}this.updateDistance(E,T),K._mult(ie),this.addCurrentVertex(T,K,0,0,M,U);const Se=T.dist(C);if(Se>2*xe){const Ce=T.add(C.sub(T)._mult(xe/Se)._round());this.updateDistance(T,Ce),this.addCurrentVertex(Ce,k,0,0,M,U),T=Ce}}else K._mult(ie),this.addCurrentVertex(T,K,0,0,M,U);else if($==="flipbevel"){if(ie>100)K=k.mult(-1);else{const Me=ie*O.add(k).mag()/O.sub(k).mag();K._perp()._mult(Me*(le?-1:1))}this.addCurrentVertex(T,K,0,0,M,U),this.addCurrentVertex(T,K.mult(-1),0,0,M,U)}else if($==="bevel"||$==="fakeround"){U!=null&&E&&this.addCurrentVertex(T,O,-1,-1,M,U);const Me=T.dist(E)<=2*xe&&$!=="bevel",Se=K.mult(le?1:-1);Se._mult(ie);const Ce=k.mult(le?-1:1),Ie=O.mult(le?-1:1),Fe=this.evaluateLineProgressFeatures(this.distance);if(U==null&&(this.addHalfVertex(T,Se.x,Se.y,!1,!le,0,M,Fe),Me||this.addHalfVertex(T,Se.x+2*Ie.x,Se.y+2*Ie.y,!1,le,0,M,Fe)),$==="fakeround"){const ze=Math.round(180*se/Math.PI/20);this.addHalfVertex(T,Ie.x,Ie.y,!1,le,0,M,Fe);for(let Ne=0;Ne<ze;Ne++){let st=Ne/ze;if(st!==.5){const Bt=st-.5;st+=st*Bt*(st-1)*((1.0904+Z*(Z*(3.55645-1.43519*Z)-3.2452))*Bt*Bt+(.848013+Z*(.215638*Z-1.06021)))}const nt=Ce.sub(Ie)._mult(st)._add(Ie)._unit();this.addHalfVertex(T,nt.x,nt.y,!1,le,0,M,Fe)}this.addHalfVertex(T,Ce.x,Ce.y,!1,le,0,M,Fe)}Me||U!=null||this.addHalfVertex(T,Se.x+2*Ce.x,Se.y+2*Ce.y,!1,le,0,M,Fe),U!=null&&C&&this.addCurrentVertex(T,k,1,1,M,U)}else $==="butt"?this.addCurrentVertex(T,K,0,0,M,U):$==="square"?(E||this.addCurrentVertex(T,K,-1,-1,M,U),this.addCurrentVertex(T,K,0,0,M,U),E&&this.addCurrentVertex(T,K,1,1,M,U)):$==="round"&&(E&&(this.addCurrentVertex(T,O,0,0,M,U),this.addCurrentVertex(T,O,1,1,M,U,!0)),C&&(this.addCurrentVertex(T,k,-1,-1,M,U,!0),this.addCurrentVertex(T,k,0,0,M,U)))}}addVerticesTo(e,r,a,u,c,f,y,b,S,_){const w=(r.w-e.w)/this.tessellationStep|0;let M=0;const T=this.scaledDistance;if(w>1){this.lineSoFar=e.w;const C=(r.x-e.x)/w,O=(r.y-e.y)/w,k=(r.z-e.z)/w,U=(r.w-e.w)/w;for(let V=1;V<w;++V){e.x+=C,e.y+=O,e.z+=k,this.lineSoFar+=U,M+=U;const N=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(e,a,u,_,!1,y,S,N),this.addHalfVertex(e,c,f,_,!0,-b,S,N)}}this.lineSoFar=r.w,this.scaledDistance=T;const E=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,a,u,_,!1,y,S,E),this.addHalfVertex(r,c,f,_,!0,-b,S,E)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Pr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}:{zOffset:0,variableWidth:r}}addCurrentVertex(e,r,a,u,c,f,y=!1){const b=r.x+r.y*a,S=r.y-r.x*a,_=r.y*u-r.x,w=-r.y-r.x*u;if(f!=null){const M=this.hasZOffset,T=-10,E=Ct+10,C=f.zOffset,O=new Bb(e.x,e.y,C,this.lineSoFar),k=!!M&&rv(e,T,E),U=this.lineSoFar,V=this.distance;if(this.currentVertex)if(k){const N=this.currentVertexIsOutside,$=this.currentVertex,Z=new Bb(e.x,e.y,C,this.lineSoFar);if(Vb($,Z,T,E),!rv(Z,T,E)){if(N){this.e1=this.e2=-1,this.distance-=$.dist(O),this.lineSoFar=$.w;const K=this.evaluateLineProgressFeatures($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,b,S,y,!1,a,c,K),this.addHalfVertex($,_,w,y,!0,-u,c,K),this.prevDistance=this.distance}this.distance=this.prevDistance+$.dist(Z),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo($,Z,b,S,_,w,a,u,c,y),this.distance=V,this.scaledDistance=this.distance/this.totalDistance}}else{const N=this.currentVertex;if(this.currentVertexIsOutside){Vb(N,O,T,E),this.e1=this.e2=-1,this.distance-=N.dist(O),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=N.w;const $=this.evaluateLineProgressFeatures(N.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(N,b,S,y,!1,a,c,$),this.addHalfVertex(N,_,w,y,!0,-u,c,$),this.prevDistance=this.distance,this.distance=V,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(N,O,b,S,_,w,a,u,c,y)}else k||(this.addHalfVertex(e,b,S,y,!1,a,c,f),this.addHalfVertex(e,_,w,y,!0,-u,c,f));this.currentVertex=O,this.currentVertexIsOutside=k,this.lineSoFar=U}else this.addHalfVertex(e,b,S,y,!1,a,c,f),this.addHalfVertex(e,_,w,y,!0,-u,c,f)}addHalfVertex({x:e,y:r},a,u,c,f,y,b,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(r<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const w=ar(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,w)}const _=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),b.primitiveLength++),f?this.e2=_:this.e1=_,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function rv(o,e,r){return o.x<e||o.x>r||o.y<e||o.y>r}let fw,pw;function mw(o,e,r){return e*(Ct/(o.tileSize*Math.pow(2,r-o.tileID.overscaledZ)))}Ft(tv,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const _w=(o,e,r)=>(1-r)*o+r*e;function gw(o,e){return 1/mw(o,1,e.tileZoom)}function yw(o,e,r,a){return o.translatePosMatrix(a||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const vw=o=>{const e=[];xw(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=o.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=o.layout.get("line-join").constantOr("miter")==="none",u=!!o.paint.get("line-pattern").constantOr(1);return a&&u&&e.push("LINE_JOIN_NONE"),e};function xw(o){const e=o.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let nv;const bw=()=>nv||(nv={layout:fw||(fw=new jn({"line-cap":new kt(Ue.layout_line["line-cap"]),"line-join":new kt(Ue.layout_line["line-join"]),"line-miter-limit":new wt(Ue.layout_line["line-miter-limit"]),"line-round-limit":new wt(Ue.layout_line["line-round-limit"]),"line-sort-key":new kt(Ue.layout_line["line-sort-key"]),"line-z-offset":new kt(Ue.layout_line["line-z-offset"]),"line-elevation-reference":new wt(Ue.layout_line["line-elevation-reference"]),"line-cross-slope":new wt(Ue.layout_line["line-cross-slope"]),visibility:new wt(Ue.layout_line.visibility),"line-width-unit":new wt(Ue.layout_line["line-width-unit"])})),paint:pw||(pw=new jn({"line-opacity":new kt(Ue.paint_line["line-opacity"]),"line-color":new kt(Ue.paint_line["line-color"]),"line-translate":new wt(Ue.paint_line["line-translate"]),"line-translate-anchor":new wt(Ue.paint_line["line-translate-anchor"]),"line-width":new kt(Ue.paint_line["line-width"]),"line-gap-width":new kt(Ue.paint_line["line-gap-width"]),"line-offset":new kt(Ue.paint_line["line-offset"]),"line-blur":new kt(Ue.paint_line["line-blur"]),"line-dasharray":new kt(Ue.paint_line["line-dasharray"]),"line-pattern":new kt(Ue.paint_line["line-pattern"]),"line-gradient":new tl(Ue.paint_line["line-gradient"]),"line-trim-offset":new wt(Ue.paint_line["line-trim-offset"]),"line-trim-fade-range":new wt(Ue.paint_line["line-trim-fade-range"]),"line-trim-color":new wt(Ue.paint_line["line-trim-color"]),"line-emissive-strength":new wt(Ue.paint_line["line-emissive-strength"]),"line-border-width":new kt(Ue.paint_line["line-border-width"]),"line-border-color":new kt(Ue.paint_line["line-border-color"]),"line-occlusion-opacity":new wt(Ue.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},nv);class AP extends kt{possiblyEvaluate(e,r){return r=new bn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,u){return r=Ur({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,u)}}let xp;function ww(o,e){return e>0?e+2*o:o}const MP=Jr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),IP=Jr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),CP=Jr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Jr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const PP=Jr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),RP=Jr([{name:"a_texb",components:2,type:"Uint16"}]),DP=Jr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),zP=Jr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Jr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Tw=Jr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),LP=Jr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Jr([{name:"triangle",components:3,type:"Uint16"}]),Jr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Jr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Jr([{type:"Float32",name:"offsetX"}]),Jr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Oi=24;const Qo=128;function Sw(o,e,r,a,u){if(o.kind==="camera")return o.maxSize;if(o.kind==="composite"){const c=e.possiblyEvaluate(new bn(o.maxZoom),r).evaluate(u,{},r),f=e.possiblyEvaluate(new bn(o.minZoom),r).evaluate(u,{},r);return Math.max(c,f)}return e.possiblyEvaluate(new bn(a)).evaluate(u,{},r)}function iv(o,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new bn(o+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=r;let c=0;for(;c<a.length&&a[c]<=o;)c++;c=Math.max(0,c-1);let f=c;for(;f<a.length&&a[f]<o+1;)f++;f=Math.min(a.length-1,f);const y=a[c],b=a[f];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new bn(y)),maxSize:r.evaluate(new bn(b)),interpolationType:u}}}function G_(o,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:u}){return o.kind==="source"?a/Qo:o.kind==="composite"?ar(a/Qo,u/Qo,r):e}function Yh(o,e,r=1){let a=0,u=0;if(o.kind==="constant")u=o.layoutSize*r;else if(o.kind!=="source"){const{interpolationType:c,minZoom:f,maxZoom:y}=o,b=c?Ye(Ts.interpolationFactor(c,e,f,y),0,1):0;o.kind==="camera"?u=ar(o.minSize,o.maxSize,b)*r:a=b*r}return{uSizeT:a,uSize:u}}var OP=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Qo,evaluateSizeForFeature:G_,evaluateSizeForZoom:Yh,getRasterizedIconSize:Sw,getSizeData:iv});function kP(o,e,r){return o.sections.forEach(a=>{a.text=function(u,c,f){const y=c.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),ls.applyArabicShaping&&(u=ls.applyArabicShaping(u)),u}(a.text,e,r)}),o}const bp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function FP(o){return o==="︶"||o==="﹈"||o==="︸"||o==="﹄"||o==="﹂"||o==="︾"||o==="︼"||o==="︺"||o==="︘"||o==="﹀"||o==="︐"||o==="︓"||o==="︔"||o==="｀"||o==="￣"||o==="︑"||o==="︒"}function BP(o){return o==="︵"||o==="﹇"||o==="︷"||o==="﹃"||o==="﹁"||o==="︽"||o==="︻"||o==="︹"||o==="︗"||o==="︿"}var Ew,sv,Aw,ov={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function NP(){return Ew||(Ew=1,ov.read=function(o,e,r,a,u){var c,f,y=8*u-a-1,b=(1<<y)-1,S=b>>1,_=-7,w=r?u-1:0,M=r?-1:1,T=o[e+w];for(w+=M,c=T&(1<<-_)-1,T>>=-_,_+=y;_>0;c=256*c+o[e+w],w+=M,_-=8);for(f=c&(1<<-_)-1,c>>=-_,_+=a;_>0;f=256*f+o[e+w],w+=M,_-=8);if(c===0)c=1-S;else{if(c===b)return f?NaN:1/0*(T?-1:1);f+=Math.pow(2,a),c-=S}return(T?-1:1)*f*Math.pow(2,c-a)},ov.write=function(o,e,r,a,u,c){var f,y,b,S=8*c-u-1,_=(1<<S)-1,w=_>>1,M=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=a?0:c-1,E=a?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,f=_):(f=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-f))<1&&(f--,b*=2),(e+=f+w>=1?M/b:M*Math.pow(2,1-w))*b>=2&&(f++,b/=2),f+w>=_?(y=0,f=_):f+w>=1?(y=(e*b-1)*Math.pow(2,u),f+=w):(y=e*Math.pow(2,w-1)*Math.pow(2,u),f=0));u>=8;o[r+T]=255&y,T+=E,y/=256,u-=8);for(f=f<<u|y,S+=u;S>0;o[r+T]=255&f,T+=E,f/=256,S-=8);o[r+T-E]|=128*C}),ov}function Mw(){if(Aw)return sv;Aw=1,sv=e;var o=NP();function e(N){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(N)?N:new Uint8Array(N||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,a=1/r,u=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function c(N){return N.type===e.Bytes?N.readVarint()+N.pos:N.pos+1}function f(N,$,Z){return Z?4294967296*$+(N>>>0):4294967296*($>>>0)+(N>>>0)}function y(N,$,Z){var K=$<=16383?1:$<=2097151?2:$<=268435455?3:Math.floor(Math.log($)/(7*Math.LN2));Z.realloc(K);for(var ae=Z.pos-1;ae>=N;ae--)Z.buf[ae+K]=Z.buf[ae]}function b(N,$){for(var Z=0;Z<N.length;Z++)$.writeVarint(N[Z])}function S(N,$){for(var Z=0;Z<N.length;Z++)$.writeSVarint(N[Z])}function _(N,$){for(var Z=0;Z<N.length;Z++)$.writeFloat(N[Z])}function w(N,$){for(var Z=0;Z<N.length;Z++)$.writeDouble(N[Z])}function M(N,$){for(var Z=0;Z<N.length;Z++)$.writeBoolean(N[Z])}function T(N,$){for(var Z=0;Z<N.length;Z++)$.writeFixed32(N[Z])}function E(N,$){for(var Z=0;Z<N.length;Z++)$.writeSFixed32(N[Z])}function C(N,$){for(var Z=0;Z<N.length;Z++)$.writeFixed64(N[Z])}function O(N,$){for(var Z=0;Z<N.length;Z++)$.writeSFixed64(N[Z])}function k(N,$){return(N[$]|N[$+1]<<8|N[$+2]<<16)+16777216*N[$+3]}function U(N,$,Z){N[Z]=$,N[Z+1]=$>>>8,N[Z+2]=$>>>16,N[Z+3]=$>>>24}function V(N,$){return(N[$]|N[$+1]<<8|N[$+2]<<16)+(N[$+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(N,$,Z){for(Z=Z||this.length;this.pos<Z;){var K=this.readVarint(),ae=K>>3,ie=this.pos;this.type=7&K,N(ae,$,this),this.pos===ie&&this.skip(K)}return $},readMessage:function(N,$){return this.readFields(N,$,this.readVarint()+this.pos)},readFixed32:function(){var N=k(this.buf,this.pos);return this.pos+=4,N},readSFixed32:function(){var N=V(this.buf,this.pos);return this.pos+=4,N},readFixed64:function(){var N=k(this.buf,this.pos)+k(this.buf,this.pos+4)*r;return this.pos+=8,N},readSFixed64:function(){var N=k(this.buf,this.pos)+V(this.buf,this.pos+4)*r;return this.pos+=8,N},readFloat:function(){var N=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,N},readDouble:function(){var N=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,N},readVarint:function(N){var $,Z,K=this.buf;return $=127&(Z=K[this.pos++]),Z<128?$:($|=(127&(Z=K[this.pos++]))<<7,Z<128?$:($|=(127&(Z=K[this.pos++]))<<14,Z<128?$:($|=(127&(Z=K[this.pos++]))<<21,Z<128?$:function(ae,ie,se){var ve,le,xe=se.buf;if(ve=(112&(le=xe[se.pos++]))>>4,le<128||(ve|=(127&(le=xe[se.pos++]))<<3,le<128)||(ve|=(127&(le=xe[se.pos++]))<<10,le<128)||(ve|=(127&(le=xe[se.pos++]))<<17,le<128)||(ve|=(127&(le=xe[se.pos++]))<<24,le<128)||(ve|=(1&(le=xe[se.pos++]))<<31,le<128))return f(ae,ve,ie);throw new Error("Expected varint not more than 10 bytes")}($|=(15&(Z=K[this.pos]))<<28,N,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var N=this.readVarint();return N%2==1?(N+1)/-2:N/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var N=this.readVarint()+this.pos,$=this.pos;return this.pos=N,N-$>=12&&u?function(Z,K,ae){return u.decode(Z.subarray(K,ae))}(this.buf,$,N):function(Z,K,ae){for(var ie="",se=K;se<ae;){var ve,le,xe,Me=Z[se],Se=null,Ce=Me>239?4:Me>223?3:Me>191?2:1;if(se+Ce>ae)break;Ce===1?Me<128&&(Se=Me):Ce===2?(192&(ve=Z[se+1]))==128&&(Se=(31&Me)<<6|63&ve)<=127&&(Se=null):Ce===3?(le=Z[se+2],(192&(ve=Z[se+1]))==128&&(192&le)==128&&((Se=(15&Me)<<12|(63&ve)<<6|63&le)<=2047||Se>=55296&&Se<=57343)&&(Se=null)):Ce===4&&(le=Z[se+2],xe=Z[se+3],(192&(ve=Z[se+1]))==128&&(192&le)==128&&(192&xe)==128&&((Se=(15&Me)<<18|(63&ve)<<12|(63&le)<<6|63&xe)<=65535||Se>=1114112)&&(Se=null)),Se===null?(Se=65533,Ce=1):Se>65535&&(Se-=65536,ie+=String.fromCharCode(Se>>>10&1023|55296),Se=56320|1023&Se),ie+=String.fromCharCode(Se),se+=Ce}return ie}(this.buf,$,N)},readBytes:function(){var N=this.readVarint()+this.pos,$=this.buf.subarray(this.pos,N);return this.pos=N,$},readPackedVarint:function(N,$){if(this.type!==e.Bytes)return N.push(this.readVarint($));var Z=c(this);for(N=N||[];this.pos<Z;)N.push(this.readVarint($));return N},readPackedSVarint:function(N){if(this.type!==e.Bytes)return N.push(this.readSVarint());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readSVarint());return N},readPackedBoolean:function(N){if(this.type!==e.Bytes)return N.push(this.readBoolean());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readBoolean());return N},readPackedFloat:function(N){if(this.type!==e.Bytes)return N.push(this.readFloat());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readFloat());return N},readPackedDouble:function(N){if(this.type!==e.Bytes)return N.push(this.readDouble());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readDouble());return N},readPackedFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed32());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readFixed32());return N},readPackedSFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed32());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readSFixed32());return N},readPackedFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed64());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readFixed64());return N},readPackedSFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed64());var $=c(this);for(N=N||[];this.pos<$;)N.push(this.readSFixed64());return N},skip:function(N){var $=7&N;if($===e.Varint)for(;this.buf[this.pos++]>127;);else if($===e.Bytes)this.pos=this.readVarint()+this.pos;else if($===e.Fixed32)this.pos+=4;else{if($!==e.Fixed64)throw new Error("Unimplemented type: "+$);this.pos+=8}},writeTag:function(N,$){this.writeVarint(N<<3|$)},realloc:function(N){for(var $=this.length||16;$<this.pos+N;)$*=2;if($!==this.length){var Z=new Uint8Array($);Z.set(this.buf),this.buf=Z,this.length=$}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(N){this.realloc(4),U(this.buf,N,this.pos),this.pos+=4},writeSFixed32:function(N){this.realloc(4),U(this.buf,N,this.pos),this.pos+=4},writeFixed64:function(N){this.realloc(8),U(this.buf,-1&N,this.pos),U(this.buf,Math.floor(N*a),this.pos+4),this.pos+=8},writeSFixed64:function(N){this.realloc(8),U(this.buf,-1&N,this.pos),U(this.buf,Math.floor(N*a),this.pos+4),this.pos+=8},writeVarint:function(N){(N=+N||0)>268435455||N<0?function($,Z){var K,ae;if($>=0?(K=$%4294967296|0,ae=$/4294967296|0):(ae=~(-$/4294967296),4294967295^(K=~(-$%4294967296))?K=K+1|0:(K=0,ae=ae+1|0)),$>=18446744073709552e3||$<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Z.realloc(10),function(ie,se,ve){ve.buf[ve.pos++]=127&ie|128,ie>>>=7,ve.buf[ve.pos++]=127&ie|128,ie>>>=7,ve.buf[ve.pos++]=127&ie|128,ie>>>=7,ve.buf[ve.pos++]=127&ie|128,ve.buf[ve.pos]=127&(ie>>>=7)}(K,0,Z),function(ie,se){var ve=(7&ie)<<4;se.buf[se.pos++]|=ve|((ie>>>=3)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie)))))}(ae,Z)}(N,this):(this.realloc(4),this.buf[this.pos++]=127&N|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=N>>>7&127))))},writeSVarint:function(N){this.writeVarint(N<0?2*-N-1:2*N)},writeBoolean:function(N){this.writeVarint(!!N)},writeString:function(N){N=String(N),this.realloc(4*N.length),this.pos++;var $=this.pos;this.pos=function(K,ae,ie){for(var se,ve,le=0;le<ae.length;le++){if((se=ae.charCodeAt(le))>55295&&se<57344){if(!ve){se>56319||le+1===ae.length?(K[ie++]=239,K[ie++]=191,K[ie++]=189):ve=se;continue}if(se<56320){K[ie++]=239,K[ie++]=191,K[ie++]=189,ve=se;continue}se=ve-55296<<10|se-56320|65536,ve=null}else ve&&(K[ie++]=239,K[ie++]=191,K[ie++]=189,ve=null);se<128?K[ie++]=se:(se<2048?K[ie++]=se>>6|192:(se<65536?K[ie++]=se>>12|224:(K[ie++]=se>>18|240,K[ie++]=se>>12&63|128),K[ie++]=se>>6&63|128),K[ie++]=63&se|128)}return ie}(this.buf,N,this.pos);var Z=this.pos-$;Z>=128&&y($,Z,this),this.pos=$-1,this.writeVarint(Z),this.pos+=Z},writeFloat:function(N){this.realloc(4),o.write(this.buf,N,this.pos,!0,23,4),this.pos+=4},writeDouble:function(N){this.realloc(8),o.write(this.buf,N,this.pos,!0,52,8),this.pos+=8},writeBytes:function(N){var $=N.length;this.writeVarint($),this.realloc($);for(var Z=0;Z<$;Z++)this.buf[this.pos++]=N[Z]},writeRawMessage:function(N,$){this.pos++;var Z=this.pos;N($,this);var K=this.pos-Z;K>=128&&y(Z,K,this),this.pos=Z-1,this.writeVarint(K),this.pos+=K},writeMessage:function(N,$,Z){this.writeTag(N,e.Bytes),this.writeRawMessage($,Z)},writePackedVarint:function(N,$){$.length&&this.writeMessage(N,b,$)},writePackedSVarint:function(N,$){$.length&&this.writeMessage(N,S,$)},writePackedBoolean:function(N,$){$.length&&this.writeMessage(N,M,$)},writePackedFloat:function(N,$){$.length&&this.writeMessage(N,_,$)},writePackedDouble:function(N,$){$.length&&this.writeMessage(N,w,$)},writePackedFixed32:function(N,$){$.length&&this.writeMessage(N,T,$)},writePackedSFixed32:function(N,$){$.length&&this.writeMessage(N,E,$)},writePackedFixed64:function(N,$){$.length&&this.writeMessage(N,C,$)},writePackedSFixed64:function(N,$){$.length&&this.writeMessage(N,O,$)},writeBytesField:function(N,$){this.writeTag(N,e.Bytes),this.writeBytes($)},writeFixed32Field:function(N,$){this.writeTag(N,e.Fixed32),this.writeFixed32($)},writeSFixed32Field:function(N,$){this.writeTag(N,e.Fixed32),this.writeSFixed32($)},writeFixed64Field:function(N,$){this.writeTag(N,e.Fixed64),this.writeFixed64($)},writeSFixed64Field:function(N,$){this.writeTag(N,e.Fixed64),this.writeSFixed64($)},writeVarintField:function(N,$){this.writeTag(N,e.Varint),this.writeVarint($)},writeSVarintField:function(N,$){this.writeTag(N,e.Varint),this.writeSVarint($)},writeStringField:function(N,$){this.writeTag(N,e.Bytes),this.writeString($)},writeFloatField:function(N,$){this.writeTag(N,e.Fixed32),this.writeFloat($)},writeDoubleField:function(N,$){this.writeTag(N,e.Fixed64),this.writeDouble($)},writeBooleanField:function(N,$){this.writeVarintField(N,!!$)}},sv}var H_=G(Mw());const av=3;function VP(o,e,r){e.glyphs=[],o===1&&r.readMessage(UP,e)}function UP(o,e,r){if(o===3){const{id:a,bitmap:u,width:c,height:f,left:y,top:b,advance:S}=r.readMessage(jP,{});e.glyphs.push({id:a,bitmap:new Zl({width:c+2*av,height:f+2*av},u),metrics:{width:c,height:f,left:y,top:b,advance:S}})}else o===4?e.ascender=r.readSVarint():o===5&&(e.descender=r.readSVarint())}function jP(o,e,r){o===1?e.id=r.readVarint():o===2?e.bitmap=r.readBytes():o===3?e.width=r.readVarint():o===4?e.height=r.readVarint():o===5?e.left=r.readSVarint():o===6?e.top=r.readSVarint():o===7&&(e.advance=r.readVarint())}const $P=av,Ps={horizontal:1,vertical:2,horizontalOnly:3};class wp{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,r){const a=new wp;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new wp;return r.image=e,r}}class Jh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r,a){const u=new Jh;for(let c=0;c<e.sections.length;c++){const f=e.sections[c];f.image?u.addImageSection(f,a):u.addTextSection(f,r)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,a){let u="";for(let c=0;c<r.length;c++){const f=r.charCodeAt(c+1)||null,y=r.charCodeAt(c-1)||null;u+=!a&&(f&&Pf(f)&&!bp[r[c+1]]||y&&Pf(y)&&!bp[r[c-1]])||!bp[r[c]]?r[c]:bp[r[c]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&q_[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&q_[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new Jh;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(wp.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e,r){const a=e.image?e.image.getPrimary():null;if(!a)return void Pr("Can't add FormattedSection with an empty image.");a.scaleSelf(r);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(wp.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Pr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function lv(o,e,r,a,u,c,f,y,b,S,_,w,M,T,E,C=1){const O=Jh.fromFeature(o,u,C);w===Ps.vertical&&O.verticalizePunctuation(M);let k=[];const U=function(K,ae,ie,se,ve,le){if(!K)return[];const xe=[],Me=function(Fe,ze,Ne,st,nt,Bt){let ft=0;for(let St=0;St<Fe.length();St++){const lt=Fe.getSection(St);ft+=Iw(Fe.getCodePoint(St),lt,st,nt,ze,Bt)}return ft/Math.max(1,Math.ceil(ft/Ne))}(K,ae,ie,se,ve,le),Se=K.text.indexOf("​")>=0;let Ce=0;for(let Fe=0;Fe<K.length();Fe++){const ze=K.getSection(Fe),Ne=K.getCodePoint(Fe);if(q_[Ne]||(Ce+=Iw(Ne,ze,se,ve,ae,le)),Fe<K.length()-1){const st=!((Ie=Ne)<11904||!(Qt["Bopomofo Extended"](Ie)||Qt.Bopomofo(Ie)||Qt["CJK Compatibility Forms"](Ie)||Qt["CJK Compatibility Ideographs"](Ie)||Qt["CJK Compatibility"](Ie)||Qt["CJK Radicals Supplement"](Ie)||Qt["CJK Strokes"](Ie)||Qt["CJK Symbols and Punctuation"](Ie)||Qt["CJK Unified Ideographs Extension A"](Ie)||Qt["CJK Unified Ideographs"](Ie)||Qt["Enclosed CJK Letters and Months"](Ie)||Qt["Halfwidth and Fullwidth Forms"](Ie)||Qt.Hiragana(Ie)||Qt["Ideographic Description Characters"](Ie)||Qt["Kangxi Radicals"](Ie)||Qt["Katakana Phonetic Extensions"](Ie)||Qt.Katakana(Ie)||Qt["Vertical Forms"](Ie)||Qt["Yi Radicals"](Ie)||Qt["Yi Syllables"](Ie)));(GP[Ne]||st||ze.image)&&xe.push(Pw(Fe+1,Ce,Me,xe,HP(Ne,K.getCodePoint(Fe+1),st&&Se),!1))}}var Ie;return Rw(Pw(K.length(),Ce,Me,xe,0,!0))}(O,S,c,e,a,T),{processBidirectionalText:V,processStyledBidirectionalText:N}=ls;if(V&&O.sections.length===1){const K=V(O.toString(),U);for(const ae of K){const ie=new Jh;ie.text=ae,ie.sections=O.sections;for(let se=0;se<ae.length;se++)ie.sectionIndex.push(0);k.push(ie)}}else if(N){const K=N(O.text,O.sectionIndex,U);for(const ae of K){const ie=new Jh;ie.text=ae[0],ie.sectionIndex=ae[1],ie.sections=O.sections,k.push(ie)}}else k=function(K,ae){const ie=[],se=K.text;let ve=0;for(const le of ae)ie.push(K.substring(ve,le)),ve=le;return ve<se.length&&ie.push(K.substring(ve,se.length)),ie}(O,U);const $=[],Z={positionedLines:$,text:O.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:w,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(K,ae,ie,se,ve,le,xe,Me,Se,Ce,Ie,Fe){let ze=0,Ne=0,st=0;const nt=Me==="right"?1:Me==="left"?0:.5;let Bt=!1;for(const qt of ve){const dr=qt.getSections();for(const Mr of dr){if(Mr.image)continue;const yr=ae[Mr.fontStack];if(yr&&(Bt=yr.ascender!==void 0&&yr.descender!==void 0,!Bt))break}if(!Bt)break}let ft=0;for(const qt of ve){qt.trim();const dr=qt.getMaxScale(),Mr=(dr-1)*Oi,yr={positionedGlyphs:[],lineOffset:0};K.positionedLines[ft]=yr;const Lr=yr.positionedGlyphs;let Sr=0;if(!qt.length()){Ne+=le,++ft;continue}let Fr=0,Yr=0;for(let _r=0;_r<qt.length();_r++){const jr=qt.getSection(_r),Cn=qt.getSectionIndex(_r),Bn=qt.getCodePoint(_r);let Wn=jr.scale,Xn=null,gn=null,gi=null,ts=Oi,ii=0;Se===Ps.vertical&&((St=Bn)===12312||St===12313||St===12316||St===12540||St===12448)&&(Se=Ps.horizontal);const ui=!(Se===Ps.horizontal||!Ie&&!wh(Bn)||Ie&&(q_[Bn]||Rf(Bn)));if(jr.image){const ji=se.get(jr.image.toString());if(!ji)continue;gi=jr.image,K.iconsInText=K.iconsInText||!0,gn=ji.paddedRect;const Ii=ji.displaySize;Wn=Wn*Oi/Fe,Xn={width:Ii[0],height:Ii[1],left:0,top:-3,advance:ui?Ii[1]:Ii[0],localGlyph:!1},ii=Bt?-Xn.height*Wn:dr*Oi-17-Ii[1]*Wn,ts=Xn.advance;const lo=(ui?Ii[0]:Ii[1])*Wn-Oi*dr;lo>0&&lo>Sr&&(Sr=lo)}else{const ji=ie[jr.fontStack];if(!ji)continue;ji[Bn]&&(gn=ji[Bn]);const Ii=ae[jr.fontStack];if(!Ii)continue;const lo=Ii.glyphs[Bn];if(!lo)continue;if(Xn=lo.metrics,ts=Bn!==8203?Oi:0,Bt){const tc=Ii.ascender!==void 0?Math.abs(Ii.ascender):0,Oo=Ii.descender!==void 0?Math.abs(Ii.descender):0,ia=(tc+Oo)*Wn;Fr<ia&&(Fr=ia,Yr=(tc-Oo)/2*Wn),ii=-tc*Wn}else ii=(dr-Wn)*Oi-17}ui?(K.verticalizable=!0,Lr.push({glyph:Bn,image:gi,x:ze,y:Ne+ii,vertical:ui,scale:Wn,localGlyph:Xn.localGlyph,fontStack:jr.fontStack,sectionIndex:Cn,metrics:Xn,rect:gn}),ze+=ts*Wn+Ce):(Lr.push({glyph:Bn,image:gi,x:ze,y:Ne+ii,vertical:ui,scale:Wn,localGlyph:Xn.localGlyph,fontStack:jr.fontStack,sectionIndex:Cn,metrics:Xn,rect:gn}),ze+=Xn.advance*Wn+Ce)}Lr.length!==0&&(st=Math.max(ze-Ce,st),Bt?Dw(Lr,nt,Sr,Yr,le*dr/2):Dw(Lr,nt,Sr,0,le/2)),ze=0;const wn=le*dr+Sr;yr.lineOffset=Math.max(Sr,Mr),Ne+=wn,++ft}var St;const lt=Ne,{horizontalAlign:tr,verticalAlign:Ot}=cv(xe);(function(qt,dr,Mr,yr,Lr,Sr){const Fr=(dr-Mr)*Lr,Yr=-Sr*yr;for(const wn of qt)for(const _r of wn.positionedGlyphs)_r.x+=Fr,_r.y+=Yr})(K.positionedLines,nt,tr,Ot,st,lt),K.top+=-Ot*lt,K.bottom=K.top+lt,K.left+=-tr*st,K.right=K.left+st,K.hasBaseline=Bt}(Z,e,r,a,k,f,y,b,w,S,M,E),!function(K){for(const ae of K)if(ae.positionedGlyphs.length!==0)return!1;return!0}($))return Z}const q_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},GP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Iw(o,e,r,a,u,c){if(e.image){const f=a.get(e.image.toString());return f?f.displaySize[0]*e.scale*Oi/c+u:0}{const f=r[e.fontStack],y=f&&f.glyphs[o];return y?y.metrics.advance*e.scale+u:0}}function Cw(o,e,r,a){const u=Math.pow(o-e,2);return a?o<e?u/2:2*u:u+Math.abs(r)*r}function HP(o,e,r){let a=0;return o===10&&(a-=1e4),r&&(a+=150),o!==40&&o!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function Pw(o,e,r,a,u,c){let f=null,y=Cw(e,r,u,c);for(const b of a){const S=Cw(e-b.x,r,u,c)+b.badness;S<=y&&(f=b,y=S)}return{index:o,x:e,priorBreak:f,badness:y}}function Rw(o){return o?Rw(o.priorBreak).concat(o.index):[]}function cv(o){let e=.5,r=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function Dw(o,e,r,a,u){if(!(e||r||a||u))return;const c=o.length-1,f=o[c],y=(f.x+f.metrics.advance*f.scale)*e;for(let b=0;b<=c;b++)o[b].x-=y,o[b].y+=r+a+u}function qP(o,e,r,a){const{horizontalAlign:u,verticalAlign:c}=cv(a),f=r[0]-o.displaySize[0]*u,y=r[1]-o.displaySize[1]*c;return{imagePrimary:o,imageSecondary:e,top:y,bottom:y+o.displaySize[1],left:f,right:f+o.displaySize[0]}}function zw(o,e,r,a,u,c){const f=o.imagePrimary;let y;if(f.content){const O=f.content,k=f.pixelRatio||1;y=[O[0]/k,O[1]/k,f.displaySize[0]-O[2]/k,f.displaySize[1]-O[3]/k]}const b=e.left*c,S=e.right*c;let _,w,M,T;r==="width"||r==="both"?(T=u[0]+b-a[3],w=u[0]+S+a[1]):(T=u[0]+(b+S-f.displaySize[0])/2,w=T+f.displaySize[0]);const E=e.top*c,C=e.bottom*c;return r==="height"||r==="both"?(_=u[1]+E-a[0],M=u[1]+C+a[2]):(_=u[1]+(E+C-f.displaySize[1])/2,M=_+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:_,right:w,bottom:M,left:T,collisionPadding:y}}class cl extends Ae{constructor(e,r,a,u,c){super(e,r),this.angle=u,this.z=a,c!==void 0&&(this.segment=c)}clone(){return new cl(this.x,this.y,this.z,this.angle,this.segment)}}function Lw(o,e,r,a,u){if(e.segment===void 0)return!0;let c=e,f=e.segment+1,y=0;for(;y>-r/2;){if(f--,f<0)return!1;y-=o[f].dist(c),c=o[f]}y+=o[f].dist(o[f+1]),f++;const b=[];let S=0;for(;y<r/2;){const _=o[f],w=o[f+1];if(!w)return!1;let M=o[f-1].angleTo(_)-_.angleTo(w);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:M}),S+=M;y-b[0].distance>a;)S-=b.shift().angleDelta;if(S>u)return!1;f++,y+=_.dist(w)}return!0}function Ow(o){let e=0;for(let r=0;r<o.length-1;r++)e+=o[r].dist(o[r+1]);return e}function kw(o,e,r){return o?.6*e*r:0}function Fw(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function WP(o,e,r,a,u,c){const f=kw(r,u,c),y=Fw(r,a)*c;let b=0;const S=Ow(o)/2;for(let _=0;_<o.length-1;_++){const w=o[_],M=o[_+1],T=w.dist(M);if(b+T>S){const E=(S-b)/T,C=ar(w.x,M.x,E),O=ar(w.y,M.y,E),k=new cl(C,O,0,M.angleTo(w),_);return!f||Lw(o,k,y,f,e)?k:void 0}b+=T}}function ZP(o,e,r,a,u,c,f,y,b){const S=kw(a,c,f),_=Fw(a,u),w=_*f,M=o[0].x===0||o[0].x===b||o[0].y===0||o[0].y===b;return e-w<e/4&&(e=w+e/4),Bw(o,M?e/2*y%e:(_/2+2*c)*f*y%e,e,S,r,w,M,!1,b)}function Bw(o,e,r,a,u,c,f,y,b){const S=c/2,_=Ow(o);let w=0,M=e-r,T=[];for(let E=0;E<o.length-1;E++){const C=o[E],O=o[E+1],k=C.dist(O),U=O.angleTo(C);for(;M+r<w+k;){M+=r;const V=(M-w)/k,N=ar(C.x,O.x,V),$=ar(C.y,O.y,V);if(N>=0&&N<b&&$>=0&&$<b&&M-S>=0&&M+S<=_){const Z=new cl(N,$,0,U,E);a&&!Lw(o,Z,c,a,u)||T.push(Z)}}w+=k}return y||T.length||f||(T=Bw(o,w/2,r,a,u,c,f,!0,b)),T}function Nw(o,e,r,a,u){const c=[];for(let f=0;f<o.length;f++){const y=o[f];let b;for(let S=0;S<y.length-1;S++){let _=y[S],w=y[S+1];_.x<e&&w.x<e||(_.x<e?_=new Ae(e,_.y+(e-_.x)/(w.x-_.x)*(w.y-_.y))._round():w.x<e&&(w=new Ae(e,_.y+(e-_.x)/(w.x-_.x)*(w.y-_.y))._round()),_.y<r&&w.y<r||(_.y<r?_=new Ae(_.x+(r-_.y)/(w.y-_.y)*(w.x-_.x),r)._round():w.y<r&&(w=new Ae(_.x+(r-_.y)/(w.y-_.y)*(w.x-_.x),r)._round()),_.x>=a&&w.x>=a||(_.x>=a?_=new Ae(a,_.y+(a-_.x)/(w.x-_.x)*(w.y-_.y))._round():w.x>=a&&(w=new Ae(a,_.y+(a-_.x)/(w.x-_.x)*(w.y-_.y))._round()),_.y>=u&&w.y>=u||(_.y>=u?_=new Ae(_.x+(u-_.y)/(w.y-_.y)*(w.x-_.x),u)._round():w.y>=u&&(w=new Ae(_.x+(u-_.y)/(w.y-_.y)*(w.x-_.x),u)._round()),b&&_.equals(b[b.length-1])||(b=[_],c.push(b)),b.push(w)))))}}return c}function Vw(o){let e=0,r=0;for(const f of o)e+=f.w*f.h,r=Math.max(r,f.w);o.sort((f,y)=>y.h-f.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,c=0;for(const f of o)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,c=Math.max(c,f.y+f.h),u=Math.max(u,f.x+f.w),f.w===b.w&&f.h===b.h){const S=a.pop();y<a.length&&(a[y]=S)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(a.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:u,h:c,fill:e/(u*c)||0}}Ft(cl,"Anchor");const Qh=1;class Tp{static getImagePositionScale(e,r,a){if(r&&e&&e.options&&e.options.transform){const u=e.options.transform;return{x:u.a,y:u.d}}return{x:a,y:a}}constructor(e,r,a,u){this.paddedRect=e;const{pixelRatio:c,version:f,stretchX:y,stretchY:b,content:S,sdf:_,usvg:w}=r;this.pixelRatio=c,this.stretchX=y,this.stretchY=b,this.content=S,this.version=f,this.padding=a,this.sdf=_,this.scale=Tp.getImagePositionScale(u,w,c)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Uw(o,e,r){const a=Eo.parse(o),u=function(c,f,y=[1,1]){return{x:0,y:0,w:(c.data?c.data.width:c.width*y[0])+2*f,h:(c.data?c.data.height:c.height*y[1])+2*f}}(e,r,[a.options.transform.a,a.options.transform.d]);return{bin:u,imagePosition:new Tp(u,e,r,a),imageVariant:a}}class jw{constructor(e,r,a){const u=new Map,c=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,u,Qh,f),this.addImages(r,c,2,f);const{w:y,h:b}=Vw(f),S=new Li({width:y||1,height:b||1});for(const[_,w]of e.entries()){const M=u.get(_).paddedRect;Li.copy(w.data,S,{x:0,y:0},{x:M.x+Qh,y:M.y+Qh},w.data,a,w.sdf)}for(const[_,w]of r.entries()){const M=c.get(_),T=M.paddedRect;let E=M.padding;const C=T.x+E,O=T.y+E,k=w.data.width,U=w.data.height;E=E>1?E-1:E,Li.copy(w.data,S,{x:0,y:0},{x:C,y:O},w.data,a),Li.copy(w.data,S,{x:0,y:U-E},{x:C,y:O-E},{width:k,height:E},a),Li.copy(w.data,S,{x:0,y:0},{x:C,y:O+U},{width:k,height:E},a),Li.copy(w.data,S,{x:k-E,y:0},{x:C-E,y:O},{width:E,height:U},a),Li.copy(w.data,S,{x:0,y:0},{x:C+k,y:O},{width:E,height:U},a),Li.copy(w.data,S,{x:k-E,y:U-E},{x:C-E,y:O-E},{width:E,height:E},a),Li.copy(w.data,S,{x:0,y:U-E},{x:C+k,y:O-E},{width:E,height:E},a),Li.copy(w.data,S,{x:0,y:0},{x:C+k,y:O+U},{width:E,height:E},a),Li.copy(w.data,S,{x:k-E,y:0},{x:C-E,y:O+U},{width:E,height:E},a)}this.lut=a,this.image=S,this.iconPositions=u,this.patternPositions=c}addImages(e,r,a,u){for(const[c,f]of e.entries()){const{bin:y,imagePosition:b,imageVariant:S}=Uw(c,f,a);r.set(c,b),u.push(y),f.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const u of e.getUpdatedImages(a)){for(const c of this.iconPositions.keys()){const f=Eo.parse(c);if(bs.isEqual(f.id,u)){const y=e.getImage(u,a);this.patchUpdatedImage(this.iconPositions.get(c),y,r)}}for(const c of this.patternPositions.keys()){const f=Eo.parse(c);if(bs.isEqual(f.id,u)){const y=e.getImage(u,a);this.patchUpdatedImage(this.patternPositions.get(c),y,r)}}}}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,c]=e.tl,f=e.sdf;if(this.lut||f){const y={width:r.data.width,height:r.data.height},b=new Li(y);Li.copy(r.data,b,{x:0,y:0},{x:0,y:0},y,this.lut,f),a.update(b,{position:{x:u,y:c}})}else a.update(r.data,{position:{x:u,y:c}})}}Ft(Tp,"ImagePosition"),Ft(jw,"ImageAtlas");const W_=1e20;function $w(o,e,r,a,u,c,f,y,b){for(let S=e;S<e+a;S++)Gw(o,r*c+S,c,u,f,y,b);for(let S=r;S<r+u;S++)Gw(o,S*c+e,1,a,f,y,b)}function Gw(o,e,r,a,u,c,f){c[0]=0,f[0]=-1e20,f[1]=W_,u[0]=o[e];for(let y=1,b=0,S=0;y<a;y++){u[y]=o[e+y*r];const _=y*y;do{const w=c[b];S=(u[y]-u[w]+_-w*w)/(y-w)/2}while(S<=f[b]&&--b>-1);b++,c[b]=y,f[b]=S,f[b+1]=W_}for(let y=0,b=0;y<a;y++){for(;f[b+1]<y;)b++;const S=c[b],_=y-S;o[e+y*r]=u[S]+_*_}}const ea=2,uv={none:0,ideographs:1,all:2};class ed{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,a){const u=[],c=this.urls[r]||Y.GLYPHS_URL;for(const f in e)for(const y of e[f])u.push({stack:f,id:y});xn(u,({stack:f,id:y},b)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=S.glyphs[y];if(_!==void 0)return void b(null,{stack:f,id:y,glyph:_});if(_=this._tinySDF(S,f,y),_)return S.glyphs[y]=_,void b(null,{stack:f,id:y,glyph:_});const w=Math.floor(y/256);if(256*w>65535)return Pr("glyphs > 65535 not supported"),void b(null,{stack:f,id:y,glyph:_});if(S.ranges[w])return void b(null,{stack:f,id:y,glyph:_});let M=S.requests[w];M||(M=S.requests[w]=[],ed.loadGlyphRange(f,w,c,this.requestManager,(T,E)=>{if(E){S.ascender=E.ascender,S.descender=E.descender;for(const C in E.glyphs)this._doesCharSupportLocalGlyph(+C)||(S.glyphs[+C]=E.glyphs[+C]);S.ranges[w]=!0}for(const C of M)C(T,E);delete S.requests[w]})),M.push((T,E)=>{T?b(T):E&&b(null,{stack:f,id:y,glyph:E.glyphs[y]||null})})},(f,y)=>{if(f)a(f);else if(y){const b={};for(const{stack:S,id:_,glyph:w}of y)b[S]===void 0&&(b[S]={}),b[S].glyphs===void 0&&(b[S].glyphs={}),b[S].glyphs[_]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},b[S].ascender=this.entries[S].ascender,b[S].descender=this.entries[S].descender;a(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==uv.none&&(this.localGlyphMode===uv.all?!!this.localFontFamily:!!this.localFontFamily&&(Qt["CJK Unified Ideographs"](e)||Qt["Hangul Syllables"](e)||Qt.Hiragana(e)||Qt.Katakana(e)||Qt["CJK Symbols and Punctuation"](e)||Qt["CJK Unified Ideographs Extension A"](e)||Qt["CJK Unified Ideographs Extension B"](e)||Qt.Osage(e)))}_tinySDF(e,r,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let c=e.tinySDF;if(!c){let C="400";/bold/i.test(r)?C="900":/medium/i.test(r)?C="500":/light/i.test(r)&&(C="200"),c=e.tinySDF=new ed.TinySDF({fontFamily:u,fontWeight:C,fontSize:24*ea,buffer:3*ea,radius:8*ea}),c.fontWeight=C}if(this.localGlyphs[c.fontWeight][a])return this.localGlyphs[c.fontWeight][a];const f=String.fromCodePoint(a),{data:y,width:b,height:S,glyphWidth:_,glyphHeight:w,glyphLeft:M,glyphTop:T,glyphAdvance:E}=c.draw(f);return this.localGlyphs[c.fontWeight][a]={id:a,bitmap:new Zl({width:b,height:S},y),metrics:{width:_/ea,height:w/ea,left:M/ea,top:T/ea-27,advance:E/ea,localGlyph:!0}}}}ed.loadGlyphRange=function(o,e,r,a,u){const c=256*e,f=c+255,y=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",o).replace("{range}",`${c}-${f}`),pi.Glyphs);$a(y,(b,S)=>{if(b)u(b);else if(S){const _={},w=function(M){return new H_(M).readFields(VP,{})}(S);for(const M of w.glyphs)_[M.id]=M;u(null,{glyphs:_,ascender:w.ascender,descender:w.descender})}})},ed.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:c="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const y=this.size=o+4*e,b=this._createCanvas(y),S=this.ctx=b.getContext("2d",{willReadFrequently:!0});S.font=`${f} ${c} ${o}px ${u}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:c}=this.ctx.measureText(o),f=Math.ceil(r),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-u))),b=Math.min(this.size-this.buffer,f+Math.ceil(a)),S=y+2*this.buffer,_=b+2*this.buffer,w=Math.max(S*_,0),M=new Uint8ClampedArray(w),T={data:M,width:S,height:_,glyphWidth:y,glyphHeight:b,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return T;const{ctx:E,buffer:C,gridInner:O,gridOuter:k}=this;E.clearRect(C,C,y,b),E.fillText(o,C,C+f);const U=E.getImageData(C,C,y,b);k.fill(W_,0,w),O.fill(0,0,w);for(let V=0;V<b;V++)for(let N=0;N<y;N++){const $=U.data[4*(V*y+N)+3]/255;if($===0)continue;const Z=(V+C)*S+N+C;if($===1)k[Z]=0,O[Z]=W_;else{const K=.5-$;k[Z]=K>0?K*K:0,O[Z]=K<0?K*K:0}}$w(k,0,0,S,_,S,this.f,this.v,this.z),$w(O,C,C,y,b,S,this.f,this.v,this.z);for(let V=0;V<w;V++){const N=Math.sqrt(k[V])-Math.sqrt(O[V]);M[V]=Math.round(255-255*(N/this.radius+this.cutoff))}return T}};const hu=Qh;function Hw(o,e){return o+e[1]-e[0]}function qw(o,e,r,a,u=1){const c=[],f=o.imagePrimary,y=f.pixelRatio,b=f.paddedRect.w-2*hu,S=f.paddedRect.h-2*hu,_=(o.right-o.left)*u,w=(o.bottom-o.top)*u,M=f.stretchX||[[0,b]],T=f.stretchY||[[0,S]],E=M.reduce(Hw,0),C=T.reduce(Hw,0),O=b-E,k=S-C;let U=0,V=E,N=0,$=C,Z=0,K=O,ae=0,ie=k;if(f.content&&a){const ve=f.content;U=Z_(M,0,ve[0]),N=Z_(T,0,ve[1]),V=Z_(M,ve[0],ve[2]),$=Z_(T,ve[1],ve[3]),Z=ve[0]-U,ae=ve[1]-N,K=ve[2]-ve[0]-V,ie=ve[3]-ve[1]-$}const se=(ve,le,xe,Me)=>{const Se=X_(ve.stretch-U,V,_,o.left*u),Ce=K_(ve.fixed-Z,K,ve.stretch,E),Ie=X_(le.stretch-N,$,w,o.top*u),Fe=K_(le.fixed-ae,ie,le.stretch,C),ze=X_(xe.stretch-U,V,_,o.left*u),Ne=K_(xe.fixed-Z,K,xe.stretch,E),st=X_(Me.stretch-N,$,w,o.top*u),nt=K_(Me.fixed-ae,ie,Me.stretch,C),Bt=new Ae(Se,Ie),ft=new Ae(ze,Ie),St=new Ae(ze,st),lt=new Ae(Se,st),tr=new Ae(Ce/y,Fe/y),Ot=new Ae(Ne/y,nt/y),qt=e*Math.PI/180;if(qt){const Fr=Math.sin(qt),Yr=Math.cos(qt),wn=[Yr,-Fr,Fr,Yr];Bt._matMult(wn),ft._matMult(wn),lt._matMult(wn),St._matMult(wn)}const dr=ve.stretch+ve.fixed,Mr=xe.stretch+xe.fixed,yr=le.stretch+le.fixed,Lr=Me.stretch+Me.fixed,Sr=o.imageSecondary;return{tl:Bt,tr:ft,bl:lt,br:St,texPrimary:{x:f.paddedRect.x+hu+dr,y:f.paddedRect.y+hu+yr,w:Mr-dr,h:Lr-yr},texSecondary:Sr?{x:Sr.paddedRect.x+hu+dr,y:Sr.paddedRect.y+hu+yr,w:Mr-dr,h:Lr-yr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:tr,pixelOffsetBR:Ot,minFontScaleX:K/y/_,minFontScaleY:ie/y/w,isSDF:r}};if(a&&(f.stretchX||f.stretchY)){const ve=Ww(M,O,E),le=Ww(T,k,C);for(let xe=0;xe<ve.length-1;xe++){const Me=ve[xe],Se=ve[xe+1];for(let Ce=0;Ce<le.length-1;Ce++)c.push(se(Me,le[Ce],Se,le[Ce+1]))}}else c.push(se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return c}function Z_(o,e,r){let a=0;for(const u of o)a+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return a}function Ww(o,e,r){const a=[{fixed:-1,stretch:0}];for(const[u,c]of o){const f=a[a.length-1];a.push({fixed:u-f.stretch,stretch:f.stretch}),a.push({fixed:u-f.stretch,stretch:f.stretch+(c-u)})}return a.push({fixed:e+hu,stretch:r}),a}function X_(o,e,r,a){return o/e*r+a}function K_(o,e,r,a){return o-e*r/a}function XP(o,e,r,a){const u=e+o.positionedLines[a].lineOffset;return a===0?r+u/2:r+(u+(e+o.positionedLines[a-1].lineOffset))/2}function KP(o,e=1,r=!1){let a=1/0,u=1/0,c=-1/0,f=-1/0;const y=o[0];for(let T=0;T<y.length;T++){const E=y[T];(!T||E.x<a)&&(a=E.x),(!T||E.y<u)&&(u=E.y),(!T||E.x>c)&&(c=E.x),(!T||E.y>f)&&(f=E.y)}const b=Math.min(c-a,f-u);let S=b/2;const _=new Go([],YP);if(b===0)return new Ae(a,u);for(let T=a;T<c;T+=b)for(let E=u;E<f;E+=b)_.push(new td(T+S,E+S,S,o));let w=function(T){let E=0,C=0,O=0;const k=T[0];for(let U=0,V=k.length,N=V-1;U<V;N=U++){const $=k[U],Z=k[N],K=$.x*Z.y-Z.x*$.y;C+=($.x+Z.x)*K,O+=($.y+Z.y)*K,E+=3*K}return new td(C/E,O/E,0,T)}(o),M=_.length;for(;_.length;){const T=_.pop();(T.d>w.d||!w.d)&&(w=T,r&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,M)),T.max-w.d<=e||(S=T.h/2,_.push(new td(T.p.x-S,T.p.y-S,S,o)),_.push(new td(T.p.x+S,T.p.y-S,S,o)),_.push(new td(T.p.x-S,T.p.y+S,S,o)),_.push(new td(T.p.x+S,T.p.y+S,S,o)),M+=4)}return r&&(console.log(`num probes: ${M}`),console.log(`best distance: ${w.d}`)),w.p}function YP(o,e){return e.max-o.max}class td{constructor(e,r,a,u){this.p=new Ae(e,r),this.h=a,this.d=function(c,f){let y=!1,b=1/0;for(let S=0;S<f.length;S++){const _=f[S];for(let w=0,M=_.length,T=M-1;w<M;T=w++){const E=_[w],C=_[T];E.y>c.y!=C.y>c.y&&c.x<(C.x-E.x)*(c.y-E.y)/(C.y-E.y)+E.x&&(y=!y),b=Math.min(b,pe(c,E,C))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const hv=Number.POSITIVE_INFINITY,JP=Math.sqrt(2);function Zw(o,[e,r]){let a=0,u=0;if(r===hv){e<0&&(e=0);const c=e/JP;switch(o){case"top-right":case"top-left":u=c-7;break;case"bottom-right":case"bottom-left":u=7-c;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(o){case"top-right":case"bottom-right":a=-c;break;case"top-left":case"bottom-left":a=c;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),o){case"top-right":case"top-left":case"top":u=r-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-r}switch(o){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function Xw(o,e,r,a,u,c,f,y){if(!o)return;const b=Sw(e,r,a,u,c);return o.scaleSelf(b*y*f)}function Kw(o,e,r,a,u,c,f,y){return{iconPrimary:Xw(o.getPrimary(),e,r,a,u,c,f,y),iconSecondary:Xw(o.getSecondary(),e,r,a,u,c,f,y)}}function Yw(o,e,r,a){if(!o)return;const u=e.get(r.toString());if(o.imagePrimary=u,a){const c=e.get(a.toString());o.imageSecondary=c}}function QP(o,e){for(const r in o.horizontal)Jw(o.horizontal[r],e);Jw(o.vertical,e)}function Jw(o,e){if(o){for(const r of o.positionedLines)for(const a of r.positionedGlyphs)if(a.image!==null){const u=a.image.toString();a.rect=e.get(u).paddedRect}}}function dv(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function eR(o,e,r,a,u,c,f,y,b){const S=fv(c.horizontal)||c.vertical,_=r.get("icon-text-fit-padding").evaluate(a,{},u);let w,M=e;return e&&b!=="none"&&(o.allowVerticalPlacement&&c.vertical&&(w=zw(e,c.vertical,b,_,y,f)),S&&(M=zw(e,S,b,_,y,f))),{defaultShapedIcon:M,verticallyShapedIcon:w}}function tR(o,e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k,U,V){let N=f.textMaxSize.evaluate(e,{},M);N===void 0?N=y*f.textScaleFactor:N*=f.textScaleFactor;const $=o.layers[0].layout,Z=fv(r.horizontal)||r.vertical,K=T.name==="globe",ae=Oi,ie=o.tilePixelRatio*N/ae,se=(Ce=o.overscaling,o.zoom>18&&Ce>2&&(Ce>>=1),Math.max(Ct/(512*Ce),1)*$.get("symbol-spacing")),ve=$.get("text-padding")*o.tilePixelRatio,le=$.get("icon-padding")*o.tilePixelRatio,xe=Rt($.get("text-max-angle")),Me=$.get("icon-rotation-alignment")==="map"&&V!=="point",Se=se/2;var Ce;o.hasAnyIconTextFit===!1&&O!=="none"&&(o.hasAnyIconTextFit=!0);const Ie=e.properties?+e.properties[lu]:null,Fe=Ie&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(Ie):65535,ze=(Ne,st,nt)=>{if(st.x<0||st.x>=Ct||st.y<0||st.y>=Ct)return;let Bt=null;if(K){const{x:ft,y:St,z:lt}=T.projectTilePoint(st.x,st.y,nt);Bt={anchor:new cl(ft,St,lt,0,void 0),up:T.upVector(nt,st.x,st.y)}}(function(ft,St,lt,tr,Ot,qt,dr,Mr,yr,Lr,Sr,Fr,Yr,wn,_r,jr,Cn,Bn,Wn,Xn,gn,gi,ts,ii,ui,ji,Ii,lo,tc){const Oo=ft.addToLineVertexArray(St,tr);let ia,rc,nc,_u,LT,OT,kT,FT=0,BT=0,NT=0,VT=0,qv=-1,Wv=-1;const za={};let UT=Qs("");const gu=lt?lt.anchor:St,Zv=lo!=="none";let Xv=0,Kv=0;if(yr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Xv,Kv]=yr.layout.get("text-offset").evaluate(gn,{},ui).map(co=>co*Oi):(Xv=yr.layout.get("text-radial-offset").evaluate(gn,{},ui)*Oi,Kv=hv),ft.allowVerticalPlacement&&Ot.vertical){const co=Ot.vertical;if(_r)OT=pv(co),Mr&&(kT=pv(Mr));else{const Rs=yr.layout.get("text-rotate").evaluate(gn,{},ui)+90;nc=Y_(Lr,gu,St,Sr,Fr,Yr,co,wn,Rs,jr),Mr&&(_u=Y_(Lr,gu,St,Sr,Fr,Yr,Mr,Bn,Rs))}}if(qt){const co=ft.iconSizeData,Rs=yr.layout.get("icon-rotate").evaluate(gn,{},ui),jp=qw(qt,Rs,ts,Zv,gi.iconScaleFactor),Jv=Mr?qw(Mr,Rs,ts,Zv,gi.iconScaleFactor):void 0;rc=Y_(Lr,gu,St,Sr,Fr,Yr,qt,Bn,Rs,null),FT=4*jp.length;let yu=null;co.kind==="source"?(yu=[Qo*yr.layout.get("icon-size").evaluate(gn,{},ui)*gi.iconScaleFactor],yu[0]>Yl&&Pr(`${ft.layerIds[0]}: Value for "icon-size" is >= ${Sp}. Reduce your "icon-size".`)):co.kind==="composite"&&(yu=[Qo*gi.compositeIconSizes[0].evaluate(gn,{},ui)*gi.iconScaleFactor,Qo*gi.compositeIconSizes[1].evaluate(gn,{},ui)*gi.iconScaleFactor],(yu[0]>Yl||yu[1]>Yl)&&Pr(`${ft.layerIds[0]}: Value for "icon-size" is >= ${Sp}. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,jp,yu,Xn,Wn,gn,!1,lt,St,Oo.lineStartIndex,Oo.lineLength,-1,ii,ui,ji,Ii),qv=ft.icon.placedSymbolArray.length-1,Jv&&(BT=4*Jv.length,ft.addSymbols(ft.icon,Jv,yu,Xn,Wn,gn,Ps.vertical,lt,St,Oo.lineStartIndex,Oo.lineLength,-1,ii,ui,ji,Ii),Wv=ft.icon.placedSymbolArray.length-1)}for(const co in Ot.horizontal){const Rs=Ot.horizontal[co];ia||(UT=Qs(Rs.text),_r?LT=pv(Rs):ia=Y_(Lr,gu,St,Sr,Fr,Yr,Rs,wn,yr.layout.get("text-rotate").evaluate(gn,{},ui),jr));const jp=Rs.positionedLines.length===1;if(NT+=Qw(ft,lt,St,Rs,dr,yr,_r,gn,jr,Oo,Ot.vertical?Ps.horizontal:Ps.horizontalOnly,jp?Object.keys(Ot.horizontal):[co],za,qv,gi,ii,ui,ji),jp)break}Ot.vertical&&(VT+=Qw(ft,lt,St,Ot.vertical,dr,yr,_r,gn,jr,Oo,Ps.vertical,["vertical"],za,Wv,gi,ii,ui,ji));let ic=-1;const Yv=(co,Rs)=>co?Math.max(co,Rs):Rs;ic=Yv(LT,ic),ic=Yv(OT,ic),ic=Yv(kT,ic);const zD=ic>-1?1:0;ft.glyphOffsetArray.length>=65535&&Pr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),gn.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,gn.sortKey),ft.symbolInstances.emplaceBack(St.x,St.y,gu.x,gu.y,gu.z,za.right>=0?za.right:-1,za.center>=0?za.center:-1,za.left>=0?za.left:-1,za.vertical>=0?za.vertical:-1,qv,Wv,UT,ia!==void 0?ia:ft.collisionBoxArray.length,ia!==void 0?ia+1:ft.collisionBoxArray.length,nc!==void 0?nc:ft.collisionBoxArray.length,nc!==void 0?nc+1:ft.collisionBoxArray.length,rc!==void 0?rc:ft.collisionBoxArray.length,rc!==void 0?rc+1:ft.collisionBoxArray.length,_u||ft.collisionBoxArray.length,_u?_u+1:ft.collisionBoxArray.length,Sr,NT,VT,FT,BT,zD,0,Xv,Kv,ic,0,Zv?1:0,tc)})(o,st,Bt,Ne,r,a,c,u,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,ve,U,S,0,le,Me,k,e,f,_,w,M,E,C,O,Fe)};if(V==="line")for(const Ne of Nw(e.geometry,0,0,Ct,Ct)){const st=ZP(Ne,se,xe,r.vertical||Z,a,ae,ie,o.overscaling,Ct);for(const nt of st)Z&&rR(o,Z.text,Se,nt)||ze(Ne,nt,M)}else if(V==="line-center"){for(const Ne of e.geometry)if(Ne.length>1){const st=WP(Ne,xe,r.vertical||Z,a,ae,ie);st&&ze(Ne,st,M)}}else if(e.type==="Polygon")for(const Ne of F_(e.geometry,0)){const st=KP(Ne,16);ze(Ne[0],new cl(st.x,st.y,0,0,void 0),M)}else if(e.type==="LineString")for(const Ne of e.geometry)ze(Ne,new cl(Ne[0].x,Ne[0].y,0,0,void 0),M);else if(e.type==="Point")for(const Ne of e.geometry)for(const st of Ne)ze([st],new cl(st.x,st.y,0,0,void 0),M)}const Sp=255,Yl=Sp*Qo;function Qw(o,e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O,k){const U=function($,Z,K,ae,ie,se,ve,le){const xe=[];if(Z.positionedLines.length===0)return xe;const Me=ae.layout.get("text-rotate").evaluate(se,{})*Math.PI/180,Se=function(Ne){const st=Ne[0],nt=Ne[1],Bt=st*nt;return Bt>0?[st,-nt]:Bt<0?[-st,nt]:st===0?[nt,st]:[nt,-st]}(K);let Ce=Math.abs(Z.top-Z.bottom);for(const Ne of Z.positionedLines)Ce-=Ne.lineOffset;const Ie=Z.positionedLines.length,Fe=Ce/Ie;let ze=Z.top-K[1];for(let Ne=0;Ne<Ie;++Ne){const st=Z.positionedLines[Ne];ze=XP(Z,Fe,ze,Ne);for(const nt of st.positionedGlyphs){if(!nt.rect)continue;const Bt=nt.rect||{};let ft=$P+1,St=!0,lt=1,tr=0;if(nt.image){const gn=ve.get(nt.image.toString());if(!gn)continue;if(gn.sdf){Pr("SDF images are not supported in formatted text and will be ignored.");continue}St=!1,lt=gn.pixelRatio,ft=Qh/lt}const Ot=(ie||le)&&nt.vertical,qt=nt.metrics.advance*nt.scale/2,dr=nt.metrics,Mr=nt.rect;if(Mr===null)continue;le&&Z.verticalizable&&(tr=nt.image?qt-nt.metrics.width*nt.scale/2:0);const yr=ie?[nt.x+qt,nt.y]:[0,0];let Lr=[0,0],Sr=[0,0],Fr=!1;ie||(Ot?(Sr=[nt.x+qt+Se[0],nt.y+Se[1]-tr],Fr=!0):Lr=[nt.x+qt+K[0],nt.y+K[1]-tr]);const Yr=Mr.w*nt.scale/(lt*(nt.localGlyph?ea:1)),wn=Mr.h*nt.scale/(lt*(nt.localGlyph?ea:1));let _r,jr,Cn,Bn;if(Ot){const gn=nt.y-ze,gi=new Ae(-qt,qt-gn),ts=-Math.PI/2,ii=new Ae(...Sr);_r=new Ae(-qt+Lr[0],Lr[1]),_r._rotateAround(ts,gi)._add(ii),_r.x+=-gn+qt,_r.y-=(dr.left-ft)*nt.scale;const ui=nt.image?dr.advance*nt.scale:Oi*nt.scale,ji=String.fromCodePoint(nt.glyph);FP(ji)?_r.x+=(1-ft)*nt.scale:BP(ji)?_r.x+=ui-dr.height*nt.scale+(-ft-1)*nt.scale:_r.x+=nt.image||dr.width+2*ft===Mr.w&&dr.height+2*ft===Mr.h?(ui-wn)/2:(ui-(dr.height+2*ft)*nt.scale)/2,jr=new Ae(_r.x,_r.y-Yr),Cn=new Ae(_r.x+wn,_r.y),Bn=new Ae(_r.x+wn,_r.y-Yr)}else{const gn=(dr.left-ft)*nt.scale-qt+Lr[0],gi=(-dr.top-ft)*nt.scale+Lr[1],ts=gn+Yr,ii=gi+wn;_r=new Ae(gn,gi),jr=new Ae(ts,gi),Cn=new Ae(gn,ii),Bn=new Ae(ts,ii)}if(Me){let gn;gn=ie?new Ae(0,0):Fr?new Ae(Se[0],Se[1]):new Ae(K[0],K[1]),_r._rotateAround(Me,gn),jr._rotateAround(Me,gn),Cn._rotateAround(Me,gn),Bn._rotateAround(Me,gn)}const Wn=new Ae(0,0),Xn=new Ae(0,0);xe.push({tl:_r,tr:jr,bl:Cn,br:Bn,texPrimary:Bt,texSecondary:void 0,writingMode:Z.writingMode,glyphOffset:yr,sectionIndex:nt.sectionIndex,isSDF:St,pixelOffsetTL:Wn,pixelOffsetBR:Xn,minFontScaleX:0,minFontScaleY:0})}}return xe}(0,a,b,c,f,y,u,o.allowVerticalPlacement),V=o.textSizeData;let N=null;V.kind==="source"?(N=[Qo*c.layout.get("text-size").evaluate(y,{},O)*E.textScaleFactor],N[0]>Yl&&Pr(`${o.layerIds[0]}: Value for "text-size" is >= ${Sp}. Reduce your "text-size".`)):V.kind==="composite"&&(N=[Qo*E.compositeTextSizes[0].evaluate(y,{},O)*E.textScaleFactor,Qo*E.compositeTextSizes[1].evaluate(y,{},O)*E.textScaleFactor],(N[0]>Yl||N[1]>Yl)&&Pr(`${o.layerIds[0]}: Value for "text-size" is >= ${Sp}. Reduce your "text-size".`)),o.addSymbols(o.text,U,N,b,f,y,_,e,r,S.lineStartIndex,S.lineLength,T,C,O,k,!1);for(const $ of w)M[$]=o.text.placedSymbolArray.length-1;return 4*U.length}function fv(o){for(const e in o)return o[e];return null}function Y_(o,e,r,a,u,c,f,y,b,S){let _=f.top,w=f.bottom,M=f.left,T=f.right;const E=f.collisionPadding;if(E&&(M-=E[0],_-=E[1],T+=E[2],w+=E[3]),b){const C=new Ae(M,_),O=new Ae(T,_),k=new Ae(M,w),U=new Ae(T,w),V=Rt(b);let N=new Ae(0,0);S&&(N=new Ae(S[0],S[1])),C._rotateAround(V,N),O._rotateAround(V,N),k._rotateAround(V,N),U._rotateAround(V,N),M=Math.min(C.x,O.x,k.x,U.x),T=Math.max(C.x,O.x,k.x,U.x),_=Math.min(C.y,O.y,k.y,U.y),w=Math.max(C.y,O.y,k.y,U.y)}return o.emplaceBack(e.x,e.y,e.z,r.x,r.y,M,_,T,w,y,a,u,c),o.length-1}function pv(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function rR(o,e,r,a){const u=o.compareText;if(e in u){const c=u[e];for(let f=c.length-1;f>=0;f--)if(a.dist(c[f])<r)return!0}else u[e]=[];return u[e].push(a),!1}function e2(o,e){const r=o.fovAboveCenter,a=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,u=(o._camera.position[2]*o.worldSize-a)/Math.cos(o._pitch),c=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-o._pitch-r,.01));let f=Math.sin(o._pitch)*c+u;const y=u*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let b=Math.max(o.zoom-17,0);o.isOrthographic&&(b/=10),f*=1+b}return Math.min(1.01*f,y)}function Ep(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const r=Math.pow(2,-o.z),a=o.x*r,u=(o.x+1)*r,c=o.y*r,f=(o.y+1)*r,y=us(a),b=us(u),S=Mi(c),_=Mi(f),w=e.project(y,S),M=e.project(b,S),T=e.project(b,_),E=e.project(y,_);let C=Math.min(w.x,M.x,T.x,E.x),O=Math.min(w.y,M.y,T.y,E.y),k=Math.max(w.x,M.x,T.x,E.x),U=Math.max(w.y,M.y,T.y,E.y);const V=r/16;function N(Z,K,ae,ie,se,ve){const le=(ae+se)/2,xe=(ie+ve)/2,Me=e.project(us(le),Mi(xe)),Se=Math.max(0,C-Me.x,O-Me.y,Me.x-k,Me.y-U);C=Math.min(C,Me.x),k=Math.max(k,Me.x),O=Math.min(O,Me.y),U=Math.max(U,Me.y),Se>V&&(N(Z,Me,ae,ie,le,xe),N(Me,K,le,xe,se,ve))}N(w,M,a,c,u,c),N(M,T,u,c,u,f),N(T,E,u,f,a,f),N(E,w,a,f,a,c),C-=V,O-=V,k+=V,U+=V;const $=1/Math.max(k-C,U-O);return{scale:$,x:C*$,y:O*$,x2:k*$,y2:U*$,projection:e}}function t2(o,{x:e,y:r},a=0){return new Ae(((e-a)*o.scale-o.x)*Ct,(r*o.scale-o.y)*Ct)}const nR=te.mat4.identity(new Float32Array(16));class Jl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Qr(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a,u=!0){return e._coordinatePoint(e.locationCoordinate(r,a),u)}pixelsPerMeter(e,r){return Wi(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return e2(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,u){const c=e.horizonLineFromTop(!1),f=new Ae(r,Math.max(c,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,u))}pointCoordinate3D(e,r,a){const u=new Ae(r,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const c=this.pointCoordinate(e,u.x,u.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);const a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return nR}createTileMatrix(e,r,a){let u,c,f;const y=a.canonical,b=te.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Ep(y,this);u=1,c=S.x+a.wrap*S.scale,f=S.y,te.mat4.scale(b,b,[u/S.scale,u/S.scale,e.pixelsPerMeter/r])}else u=r/e.zoomScale(y.z),c=(y.x+Math.pow(2,y.z)*a.wrap)*u,f=y.y*u;return te.mat4.translate(b,b,[c,f,0]),te.mat4.scale(b,b,[u/Ct,u/Ct,1]),b}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class iR extends Jl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Rt(r));this.n=(u+Math.sin(Rt(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:a,c:u,r0:c}=this,f=Rt(e-this.center[0]),y=Rt(r),b=Math.sqrt(u-2*a*Math.sin(y))/a;return{x:b*Math.sin(f*a),y:b*Math.cos(f*a)-c,z:0}}unproject(e,r){const{n:a,c:u,r0:c}=this,f=c+r;let y=Math.atan2(e,Math.abs(f))*Math.sign(f);f*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(f));const b=Rt(this.center[0])*a;y=$r(y,-Math.PI-b,Math.PI-b);const S=Ye(jt(y/a)+this.center[0],-180,180),_=Math.asin(Ye((u-(e*e+f*f)*a*a)/(2*a),-1,1)),w=Ye(jt(_),-85.051129,Ji);return new Qr(S,w)}}const Ap=1.340264,Mp=-.081106,Ip=893e-6,Cp=.003796,J_=Math.sqrt(3)/2;class sR extends Jl{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(J_*Math.sin(r)),u=a*a,c=u*u*u;return{x:.5*(e*Math.cos(a)/(J_*(Ap+3*Mp*u+c*(7*Ip+9*Cp*u)))/Math.PI+.5),y:1-.5*(a*(Ap+Mp*u+c*(Ip+Cp*u))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=a*a,c=u*u*u;for(let _,w,M,T=0;T<12&&(w=a*(Ap+Mp*u+c*(Ip+Cp*u))-r,M=Ap+3*Mp*u+c*(7*Ip+9*Cp*u),_=w/M,a=Ye(a-_,-Math.PI/3,Math.PI/3),u=a*a,c=u*u*u,!(Math.abs(_)<1e-12));++T);const f=J_*e*(Ap+3*Mp*u+c*(7*Ip+9*Cp*u))/Math.cos(a),y=Math.asin(Math.sin(a)/J_),b=Ye(180*f/Math.PI,-180,180),S=Ye(180*y/Math.PI,-85.051129,Ji);return new Qr(b,S)}}class oR extends Jl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const a=360*(e-.5),u=Ye(360*(.5-r),-85.051129,Ji);return new Qr(a,u)}}const rd=Math.PI/2;function Q_(o){return Math.tan((rd+o)/2)}class aR extends Jl{constructor(e){super(e),this.center=e.center||[0,30];const[r,a]=this.parallels=e.parallels||[30,30];let u=Rt(r),c=Rt(a);this.southernCenter=u+c<0,this.southernCenter&&(u=-u,c=-c);const f=Math.cos(u),y=Q_(u);this.n=u===c?Math.sin(u):Math.log(f/Math.cos(c))/Math.log(Q_(c)/y),this.f=f*Math.pow(Q_(u),this.n)/this.n}project(e,r){r=Rt(r),this.southernCenter&&(r=-r),e=Rt(e-this.center[0]);const a=1e-6,{n:u,f:c}=this;c>0?r<-rd+a&&(r=-rd+a):r>rd-a&&(r=rd-a);const f=c/Math.pow(Q_(r),u);let y=f*Math.sin(u*e),b=c-f*Math.cos(u*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:u}=this,c=u-r,f=Math.sign(c),y=Math.sign(a)*Math.sqrt(e*e+c*c);let b=Math.atan2(e,Math.abs(c))*f;c*a<0&&(b-=Math.PI*Math.sign(e)*f);const S=Ye(jt(b/a)+this.center[0],-180,180),_=Ye(jt(2*Math.atan(Math.pow(u/y,1/a))-rd),-85.051129,Ji);return new Qr(S,this.southernCenter?-_:_)}}class r2 extends Jl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Is(e),y:so(r),z:0}}unproject(e,r){const a=us(e),u=Mi(r);return new Qr(a,u)}}const n2=Rt(Ji);class lR extends Jl{project(e,r){const a=(r=Rt(r))*r,u=a*a;return{x:.5*((e=Rt(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=25,c=0,f=a*a;do{f=a*a;const S=f*f;c=(a*(1.007226+f*(.015085+S*(.028874*f-.044475-.005916*S)))-r)/(1.007226+f*(.045255+S*(.259866*f-.311325-.005916*11*S))),a=Ye(a-c,-n2,n2)}while(Math.abs(c)>1e-6&&--u>0);f=a*a;const y=Ye(jt(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),b=jt(a);return new Qr(y,b)}}const i2=Rt(Ji);class cR extends Jl{project(e,r){r=Rt(r),e=Rt(e);const a=Math.cos(r),u=2/Math.PI,c=Math.acos(a*Math.cos(e/2)),f=Math.sin(c)/c,y=.5*(e*u+2*a*Math.sin(e/2)/f)||0,b=.5*(r+Math.sin(r)/f)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,c=25;const f=1e-6;let y=0,b=0;do{const S=Math.cos(u),_=Math.sin(u),w=2*_*S,M=_*_,T=S*S,E=Math.cos(a/2),C=Math.sin(a/2),O=2*E*C,k=C*C,U=1-T*E*E,V=U?1/U:0,N=U?Math.acos(S*E)*Math.sqrt(1/U):0,$=.5*(2*N*S*C+2*a/Math.PI)-e,Z=.5*(N*_+u)-r,K=.5*V*(T*k+N*S*E*M)+1/Math.PI,ae=V*(O*w/4-N*_*C),ie=.125*V*(w*C-N*_*T*O),se=.5*V*(M*E+N*k*S)+.5,ve=ae*ie-se*K;y=(Z*ae-$*se)/ve,b=($*ie-Z*K)/ve,a=Ye(a-y,-Math.PI,Math.PI),u=Ye(u-b,-i2,i2)}while((Math.abs(y)>f||Math.abs(b)>f)&&--c>0);return new Qr(jt(a),jt(u))}}class s2 extends Jl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Rt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:a,cosPhi:u}=this;return{x:Rt(e)*u*a+.5,y:-Math.sin(Rt(r))/u*a+.5,z:0}}unproject(e,r){const{scale:a,cosPhi:u}=this,c=-(r-.5)/a,f=Ye(jt((e-.5)/a)/u,-180,180),y=Math.asin(Ye(c*u,-1,1)),b=Ye(jt(y),-85.051129,Ji);return new Qr(f,b)}}class uR extends r2{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){const u=mn(e,r,a),c=li(fi(a));return te.vec3.transformMat4(u,u,c),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,r,a){const u=Pa(r.lat,r.lng),c=te.vec3.normalize([],u),f=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,y=Wi(1,0)*Ct*f;te.vec3.scaleAndAdd(u,u,c,y);const b=te.mat4.identity(new Float64Array(16));return te.mat4.multiply(b,e.pixelMatrix,e.globeMatrix),te.vec3.transformMat4(u,u,b),new Ae(u[0],u[1])}pixelsPerMeter(e,r){return Wi(1,0)*r}pixelSpaceConversion(e,r,a){const u=Wi(1,e)*r,c=ar(Wi(1,45)*r,u,a);return this.pixelsPerMeter(e,r)/c}createTileMatrix(e,r,a){const u=Do(fi(a.canonical));return te.mat4.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,r){const{center:a}=e,u=li(fi(r));return te.mat4.rotateY(u,u,Rt(a.lng)),te.mat4.rotateX(u,u,Rt(a.lat)),te.mat4.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,r,a,u){return qn(e,r,a,!0)||new s(0,0)}pointCoordinate3D(e,r,a){const u=this.pointCoordinate(e,r,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,r){return!qn(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(u,c){const f=u.cameraToCenterDistance,y=u._centerAltitude*c,b=u._camera,S=u._camera.forward(),_=te.vec3.add([],te.vec3.scale([],S,-f),[0,0,y]),w=u.worldSize/(2*Math.PI),M=[0,0,-w],T=u.width/u.height,E=Math.tan(u.fovAboveCenter),C=te.vec3.scale([],b.up(),E),O=te.vec3.scale([],b.right(),E*T),k=te.vec3.normalize([],te.vec3.add([],te.vec3.add([],S,C),O)),U=[];let V;if(new Br(_,k).closestPointOnSphere(M,w,U)){const N=te.vec3.add([],U,M),$=te.vec3.sub([],N,_);V=Math.cos(u.fovAboveCenter)*te.vec3.length($)}else{const N=te.vec3.sub([],_,M),$=te.vec3.sub([],M,_);te.vec3.normalize($,$);const Z=te.vec3.length(N)-w;V=Math.sqrt(Z*(Z+2*w));const K=Math.acos(V/(w+Z))-Math.acos(te.vec3.dot(S,$));V*=Math.cos(K)}return 1.01*V}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=zi(e.zoom);if(a>0){const u=e2(e,Wi(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ar(r,u+c*(1-Math.cos(f)),Math.pow(a,10))}return r}upVector(e,r,a){return mn(r,a,e,1)}upVectorScale(e){return{metersToTile:en(mi(fi(e)))}}}function o2(o){const e=o.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new r2(o);case"equirectangular":return new oR(o);case"naturalEarth":return new lR(o);case"equalEarth":return new sR(o);case"winkelTripel":return new cR(o);case"albers":return r?new s2(o):new iR(o);case"lambertConformalConic":return r?new s2(o):new aR(o);case"globe":return new uR(o)}throw new Error(`Invalid projection name: ${o.name}`)}const hR=Xl.VectorTileFeature.types,dR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function eg(o,e,r,a,u,c,f,y,b,S,_,w,M){const T=y?Math.min(Yl,Math.round(y[0])):0,E=y?Math.min(Yl,Math.round(y[1])):0;o.emplaceBack(e,r,Math.round(32*a),Math.round(32*u),c,f,(T<<1)+(b?1:0),E,16*S,16*_,256*w,256*M)}function tg(o,e,r){o.emplaceBack(e,r)}function rg(o,e,r,a,u,c,f){o.emplaceBack(e,r,a,u,c,f)}function ng(o,e,r,a,u){o.emplaceBack(e,r,a,u),o.emplaceBack(e,r,a,u),o.emplaceBack(e,r,a,u),o.emplaceBack(e,r,a,u)}function fR(o){for(const e of o.sections)if(w0(e.text))return!0;return!1}class mv{constructor(e){this.layoutVertexArray=new $f,this.indexArray=new wi,this.programConfigurations=e,this.segments=new $n,this.dynamicLayoutVertexArray=new il,this.opacityVertexArray=new Hf,this.placedSymbolArray=new A_,this.iconTransitioningVertexArray=new Ea,this.globeExtVertexArray=new Gf,this.zOffsetVertexArray=new Ta}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,a,u,c){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,MP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,CP.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,dR,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,RP.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,IP.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,PP.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ft(mv,"SymbolBuffers");class _v{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new $n,this.collisionVertexArray=new Wf,this.collisionVertexArrayExt=new il}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,DP.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,zP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ft(_v,"CollisionBuffers");class ig{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=te.mat4.identity([]),this.placementViewportMatrix=te.mat4.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=iv(this.zoom,r["text-size"]),this.iconSizeData=iv(this.zoom,r["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),c=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(f=>Ps[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new mv(new Ca(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new mv(new Ca(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new tu,this.lineVertexArray=new ru,this.symbolInstances=new I_}calculateGlyphDependencies(e,r,a,u,c){for(const f of e){const y=f.codePointAt(0);if(y===void 0)break;if(r[y]=!0,u&&c&&y<=65535){const b=bp[f];b&&(r[b.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const a=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Y0(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,r,a,u){const c=this.layers[0],f=c.layout,y=this.projection.name==="globe",b=f.get("text-font"),S=f.get("text-field"),_=f.get("icon-image"),[w,M]=f.get("icon-size-scale-range"),T=Ye(r.scaleFactor||1,w,M),E=(S.value.kind!=="constant"||S.value.value instanceof Vi&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),C=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,O=f.get("symbol-sort-key");if(this.features=[],!E&&!C)return;const k=r.iconDependencies,U=r.glyphDependencies,V=r.availableImages,N=new bn(this.zoom);for(const{feature:$,id:Z,index:K,sourceLayerIndex:ae}of e){const ie=c._featureFilter.needGeometry,se=F($,ie);if(!c._featureFilter.filter(N,se,a))continue;if(ie||(se.geometry=L($,a,u)),y&&$.type!==1&&a.z<=5){const Se=se.geometry,Ce=.98078528056,Ie=(Fe,ze)=>{const Ne=mn(Fe.x,Fe.y,a,1),st=mn(ze.x,ze.y,a,1);return te.vec3.dot(Ne,st)<Ce};for(let Fe=0;Fe<Se.length;Fe++)Se[Fe]=x(Se[Fe],Ie)}let ve,le;if(E){const Se=c.getValueAndResolveTokens("text-field",se,a,V),Ce=Vi.factory(Se);fR(Ce)&&(this.hasRTLText=!0),(!this.hasRTLText||Of()==="unavailable"||this.hasRTLText&&ls.isParsed())&&(ve=kP(Ce,c,se))}if(C){const Se=c.getValueAndResolveTokens("icon-image",se,a,V);le=Se instanceof Ei?Se:Ei.build(Se)}if(!ve&&!le)continue;const xe=this.sortFeaturesByKey?O.evaluate(se,{},a):void 0,Me={id:Z,text:ve,icon:le,index:K,sourceLayerIndex:ae,geometry:se.geometry,properties:$.properties,type:hR[$.type],sortKey:xe};if(this.features.push(Me),le){const Se=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ce,iconSecondary:Ie}=Kw(le,this.iconSizeData,Se["icon-size"],a,this.zoom,Me,this.pixelRatio,T),Fe=Ce.id.toString();if(k.has(Fe)?k.get(Fe).push(Ce):k.set(Fe,[Ce]),Ie){const ze=Ie.id.toString();k.has(ze)?k.get(ze).push(Ie):k.set(ze,[Ie])}}if(ve){const Se=b.evaluate(se,{},a).join(","),Ce=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ps.vertical)>=0;for(const Ie of ve.sections)if(Ie.image){const Fe=Ie.image.getPrimary().scaleSelf(this.pixelRatio),ze=Fe.id.toString(),Ne=k.get(ze)||[];Ne.push(Fe),k.set(ze,Ne)}else{const Fe=Cf(ve.toString()),ze=Ie.fontStack||Se,Ne=U[ze]=U[ze]||{};this.calculateGlyphDependencies(Ie.text,Ne,Ce,this.allowVerticalPlacement,Fe)}}}if(f.get("symbol-placement")==="line"&&(this.features=function($){const Z={},K={},ae=[];let ie=0;function se(Me){ae.push($[Me]),ie++}function ve(Me,Se,Ce){const Ie=K[Me];return delete K[Me],K[Se]=Ie,ae[Ie].geometry[0].pop(),ae[Ie].geometry[0]=ae[Ie].geometry[0].concat(Ce[0]),Ie}function le(Me,Se,Ce){const Ie=Z[Se];return delete Z[Se],Z[Me]=Ie,ae[Ie].geometry[0].shift(),ae[Ie].geometry[0]=Ce[0].concat(ae[Ie].geometry[0]),Ie}function xe(Me,Se,Ce){const Ie=Ce?Se[0][Se[0].length-1]:Se[0][0];return`${Me}:${Ie.x}:${Ie.y}`}for(let Me=0;Me<$.length;Me++){const Se=$[Me],Ce=Se.geometry,Ie=Se.text?Se.text.toString():null;if(!Ie){se(Me);continue}const Fe=xe(Ie,Ce),ze=xe(Ie,Ce,!0);if(Fe in K&&ze in Z&&K[Fe]!==Z[ze]){const Ne=le(Fe,ze,Ce),st=ve(Fe,ze,ae[Ne].geometry);delete Z[Fe],delete K[ze],K[xe(Ie,ae[st].geometry,!0)]=st,ae[Ne].geometry=null}else Fe in K?ve(Fe,ze,Ce):ze in Z?le(Fe,ze,Ce):(se(Me),Z[Fe]=ie-1,K[ze]=ie-1)}return ae.filter(Me=>Me.geometry)}(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const $ of r.elevationFeatures)this.elevationFeatureIdToIndex.set($.id,this.elevationFeatures.length),this.elevationFeatures.push($)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(($,Z)=>$.sortKey-Z.sortKey)}update(e,r,a,u,c,f,y){this.text.programConfigurations.updatePaintArrays(e,r,c,a,u,f,y),this.icon.programConfigurations.updatePaintArrays(e,r,c,a,u,f,y)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);if(a.elevationFeatureIndex===65535)continue;const u=this.elevationFeatures[a.elevationFeatureIndex];if(u){const c=.05+u.pointElevation(new Ae(a.tileAnchorX,a.tileAnchorY));a.zOffset!==c&&(e=!0,a.zOffset=c)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(c,f,y)=>{a+=f,a>c.length&&c.resize(a);for(let b=-f;b<0;b++)c.emplace(b+a,y)},r=(c,f,y)=>{u+=f,u>c.length&&c.resize(u);for(let b=-f;b<0;b++)c.emplace(b+u,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,u=0;for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:S}=f,_=f.zOffset,w=S>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,_),e(this.text.zOffsetVertexArray,b,_)),w){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:T}=f;M>=0&&r(this.icon.zOffsetVertexArray,S,_),T>=0&&r(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=o2(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:c}of r)this.lineVertexArray.emplaceBack(u,c);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,u,c,f,y,b,S,_,w,M,T,E,C,O){const k=e.indexArray,U=e.layoutVertexArray,V=e.globeExtVertexArray,N=e.segments.prepareSegment(4*r.length,U,k,this.canOverlap?f.sortKey:void 0),$=this.glyphOffsetArray.length,Z=N.vertexLength,K=this.allowVerticalPlacement&&y===Ps.vertical?Math.PI/2:0,ae=f.text&&f.text.sections;for(let se=0;se<r.length;se++){const{tl:ve,tr:le,bl:xe,br:Me,texPrimary:Se,texSecondary:Ce,pixelOffsetTL:Ie,pixelOffsetBR:Fe,minFontScaleX:ze,minFontScaleY:Ne,glyphOffset:st,isSDF:nt,sectionIndex:Bt}=r[se],ft=N.vertexLength,St=st[1];if(eg(U,S.x,S.y,ve.x,St+ve.y,Se.x,Se.y,a,nt,Ie.x,Ie.y,ze,Ne),eg(U,S.x,S.y,le.x,St+le.y,Se.x+Se.w,Se.y,a,nt,Fe.x,Ie.y,ze,Ne),eg(U,S.x,S.y,xe.x,St+xe.y,Se.x,Se.y+Se.h,a,nt,Ie.x,Fe.y,ze,Ne),eg(U,S.x,S.y,Me.x,St+Me.y,Se.x+Se.w,Se.y+Se.h,a,nt,Fe.x,Fe.y,ze,Ne),b){const{x:lt,y:tr,z:Ot}=b.anchor,[qt,dr,Mr]=b.up;rg(V,lt,tr,Ot,qt,dr,Mr),rg(V,lt,tr,Ot,qt,dr,Mr),rg(V,lt,tr,Ot,qt,dr,Mr),rg(V,lt,tr,Ot,qt,dr,Mr),ng(e.dynamicLayoutVertexArray,lt,tr,Ot,K)}else ng(e.dynamicLayoutVertexArray,S.x,S.y,S.z,K);if(O){const lt=Ce||Se;tg(e.iconTransitioningVertexArray,lt.x,lt.y),tg(e.iconTransitioningVertexArray,lt.x+lt.w,lt.y),tg(e.iconTransitioningVertexArray,lt.x,lt.y+lt.h),tg(e.iconTransitioningVertexArray,lt.x+lt.w,lt.y+lt.h)}k.emplaceBack(ft,ft+1,ft+2),k.emplaceBack(ft+1,ft+2,ft+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(st[0]),se!==r.length-1&&Bt===r[se+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,f,f.index,{},T,E,C,ae&&ae[Bt])}const ie=b?b.anchor:S;e.placedSymbolArray.emplaceBack(ie.x,ie.y,ie.z,S.x,S.y,$,this.glyphOffsetArray.length-$,Z,_,w,S.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],y,0,!1,0,M,0)}_commitLayoutVertex(e,r,a,u,c,f,y){e.emplaceBack(r,a,u,c,f,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,a,u,c,f,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),S=b.vertexLength,_=y.tileAnchorX,w=y.tileAnchorY;for(let T=0;T<4;T++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,r,e.padding,y.zOffset),this._commitLayoutVertex(a.layoutVertexArray,u,c,f,_,w,new Ae(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,c,f,_,w,new Ae(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,c,f,_,w,new Ae(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,c,f,_,w,new Ae(e.x1,e.y2)),b.vertexLength+=4;const M=a.indexArray;M.emplaceBack(S,S+1),M.emplaceBack(S+1,S+2),M.emplaceBack(S+2,S+3),M.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,u,c,f){for(let y=u;y<c;y++){const b=a.get(y),S=this.getSymbolInstanceTextSize(e,f,r,y);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,r,a,u,c,f){for(let y=u;y<c;y++){const b=a.get(y),S=this.getSymbolInstanceIconSize(e,r,f.placedIconSymbolIndex);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new _v(Fh,Tw.members,Ea),this.iconCollisionBox=new _v(Fh,Tw.members,Ea);const u=Yh(this.iconSizeData,e),c=Yh(this.textSizeData,e,a);for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(c,e,r,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(c,e,r,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,e,r,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,e,r,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,r,a,u){const c=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),f=G_(this.textSizeData,e,c)/Oi;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,r,a){const u=this.icon.placedSymbolArray.get(a),c=G_(this.iconSizeData,e,u);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,r,a,u){e.emplaceBack(r,-a,-a,u),e.emplaceBack(r,a,-a,u),e.emplaceBack(r,a,a,u),e.emplaceBack(r,-a,a,u)}_updateTextDebugCollisionBoxes(e,r,a,u,c,f,y){for(let b=u;b<c;b++){const S=a.get(b),_=this.getSymbolInstanceTextSize(e,f,r,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,S.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,r,a,u,c,f,y){for(let b=u;b<c;b++){const S=a.get(b),_=this.getSymbolInstanceIconSize(e,r,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,S.padding,f.zOffset)}}updateCollisionDebugBuffers(e,r,a,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Yh(this.iconSizeData,e,u),f=Yh(this.textSizeData,e,a);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(f,e,r,b.textBoxStartIndex,b.textBoxEndIndex,b,a),this._updateTextDebugCollisionBoxes(f,e,r,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,a),this._updateIconDebugCollisionBoxes(c,e,r,b.iconBoxStartIndex,b.iconBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(c,e,r,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,u,c,f,y,b,S){const _={};if(r<a){const{x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(r);_.textBox={x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.textFeatureIndex=$}if(u<c){const{x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(u);_.verticalTextBox={x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.verticalTextFeatureIndex=$}if(f<y){const{x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(f);_.iconBox={x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.iconFeatureIndex=$}if(b<S){const{x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(b);_.verticalIconBox={x1:w,y1:M,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.verticalIconFeatureIndex=$}return _}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),u=a.vertexStartIndex+4*a.numGlyphs;for(let c=a.vertexStartIndex;c<u;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),u=[],c=[],f=[];for(let y=0;y<this.symbolInstances.length;++y){f.push(y);const b=this.symbolInstances.get(y);u.push(0|Math.round(r*b.tileAnchorX+a*b.tileAnchorY)),c.push(b.featureIndex)}return f.sort((y,b)=>u[y]-u[b]||c[b]-c[y]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:S}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),c>=0&&c!==u&&this.addIndicesForPlacedSymbol(this.text,c),f>=0&&f!==c&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let a2,l2,gv;Ft(ig,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ig.addDynamicAttributes=ng;class c2{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:wl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ft(c2,"FormatSectionOverride",{omit:["defaultValue"]});const yv=()=>gv||(gv={layout:a2||(a2=new jn({"symbol-placement":new wt(Ue.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(Ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(Ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(Ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(Ue.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new wt(Ue.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new wt(Ue.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new wt(Ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new wt(Ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(Ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(Ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(Ue.layout_symbol["icon-size"]),"icon-size-scale-range":new wt(Ue.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new kt(Ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kt(Ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(Ue.layout_symbol["icon-image"]),"icon-rotate":new kt(Ue.layout_symbol["icon-rotate"]),"icon-padding":new wt(Ue.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(Ue.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(Ue.layout_symbol["icon-offset"]),"icon-anchor":new kt(Ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(Ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(Ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(Ue.layout_symbol["text-rotation-alignment"]),"text-field":new kt(Ue.layout_symbol["text-field"]),"text-font":new kt(Ue.layout_symbol["text-font"]),"text-size":new kt(Ue.layout_symbol["text-size"]),"text-size-scale-range":new wt(Ue.layout_symbol["text-size-scale-range"]),"text-max-width":new kt(Ue.layout_symbol["text-max-width"]),"text-line-height":new kt(Ue.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(Ue.layout_symbol["text-letter-spacing"]),"text-justify":new kt(Ue.layout_symbol["text-justify"]),"text-radial-offset":new kt(Ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(Ue.layout_symbol["text-variable-anchor"]),"text-anchor":new kt(Ue.layout_symbol["text-anchor"]),"text-max-angle":new wt(Ue.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(Ue.layout_symbol["text-writing-mode"]),"text-rotate":new kt(Ue.layout_symbol["text-rotate"]),"text-padding":new wt(Ue.layout_symbol["text-padding"]),"text-keep-upright":new wt(Ue.layout_symbol["text-keep-upright"]),"text-transform":new kt(Ue.layout_symbol["text-transform"]),"text-offset":new kt(Ue.layout_symbol["text-offset"]),"text-allow-overlap":new wt(Ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new wt(Ue.layout_symbol["text-ignore-placement"]),"text-optional":new wt(Ue.layout_symbol["text-optional"]),visibility:new wt(Ue.layout_symbol.visibility)})),paint:l2||(l2=new jn({"icon-opacity":new kt(Ue.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new kt(Ue.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new kt(Ue.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new kt(Ue.paint_symbol["text-emissive-strength"]),"icon-color":new kt(Ue.paint_symbol["icon-color"]),"icon-halo-color":new kt(Ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(Ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(Ue.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(Ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(Ue.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new kt(Ue.paint_symbol["icon-image-cross-fade"]),"text-opacity":new kt(Ue.paint_symbol["text-opacity"]),"text-occlusion-opacity":new kt(Ue.paint_symbol["text-occlusion-opacity"]),"text-color":new kt(Ue.paint_symbol["text-color"],{runtimeType:ns,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new kt(Ue.paint_symbol["text-halo-color"]),"text-halo-width":new kt(Ue.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(Ue.paint_symbol["text-halo-blur"]),"text-translate":new wt(Ue.paint_symbol["text-translate"]),"text-translate-anchor":new wt(Ue.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new wt(Ue.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new wt(Ue.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new wt(Ue.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new wt(Ue.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new kt(Ue.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},gv);class sg extends Yi{constructor(e,r,a,u){super(e,yv(),r,a,u),this._colorAdjustmentMatrix=te.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const c of a)u.indexOf(c)<0&&u.push(c);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,a,u){return this._saturation===e&&this._contrast===r&&this._brightnessMin===a&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(c,f,y,b){c=Xe(c),f=Pc(f);const S=te.mat4.create(),_=c/3,w=1-2*_,M=[w,_,_,0,_,w,_,0,_,_,w,0,0,0,0,1],T=.5-.5*f,E=b-y;return te.mat4.multiply(S,[E,0,0,0,0,E,0,0,0,0,E,0,y,y,y,1],[f,0,0,0,0,f,0,0,0,0,f,0,T,T,T,1]),te.mat4.multiply(S,S,M),S}(e,r,a,u),this._saturation=e,this._contrast=r,this._brightnessMin=a,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,a,u){const c=this.layout.get(e).evaluate(r,{},a,u),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Ef(f.value)||!c?c:function(y,b){return b.replace(/{([^{}]+)}/g,(S,_)=>_ in y?String(y[_]):"")}(r.properties,c)}createBucket(e){return new ig(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of yv().paint.overridableProperties){if(!sg.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new c2(r),u=new vh(a,r.property.specification,this.scope,this.options);let c=null;c=r.value.kind==="constant"||r.value.kind==="source"?new xh("source",u):new Ll("composite",u,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Bl(r.property,c,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&sg.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),u=yv().paint.properties[r];let c=!1;const f=y=>{for(const b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(c=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Vi)f(a.value.value.sections);else if(a.value.kind==="source"){const y=S=>{c||(S instanceof to&&kn(S.value)===Vo?f(S.value.sections):S instanceof Uo?f(S.sections):S.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return c}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,a){return{config:new ol(this,{zoom:r,lut:a}),overrideFog:!1}}}let u2,h2,d2,f2;var vv=Jr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function xv(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function bv(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class wv{constructor(e,r,a,u){this.context=e,this.format=a,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:u&&u.premultiply})}update(e,r){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:c}=this,{gl:f}=c,{x:y,y:b}=r&&r.position?r.position:{x:0,y:0},S=y+a,_=b+u;!this.size||this.size[0]===S&&this.size[1]===_||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!r||r.premultiply!==!1));const w=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&S>0&&_>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(S,_)))+1:1;f.texStorage2D(f.TEXTURE_2D,M,this.format,S,_),this.size=[S,_]}if(this.size)if(w)f.texSubImage2D(f.TEXTURE_2D,0,y,b,xv(this.format),bv(this.format),e);else{const M=e.data;M&&f.texSubImage2D(f.TEXTURE_2D,0,y,b,a,u,xv(this.format),bv(this.format),M)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,r,a=!1){const{context:u}=this,{gl:c}=u;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,a,u){const{context:c}=this,{gl:f}=c;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),this.wrapS=a),u!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class og{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}}function ag(o,e,r,a,u,c,f,y){const b=[o,e,1,r,a,1,u,c,1],S=[f,y,1],_=te.mat3.adjoint([],b),[w,M,T]=te.vec3.transformMat3(S,S,_);return te.mat3.multiply(b,b,[w,0,0,0,M,0,0,0,T])}function p2(o,e,r,a,u,c,f,y){const b=function(S,_,w,M,T,E,C,O){const k=ag(0,0,1,0,1,1,0,1),U=ag(S,_,w,M,T,E,C,O),V=te.mat3.adjoint([],k);return te.mat3.multiply(U,U,V)}(o,e,r,a,u,c,f,y);return[b[2]/b[8]/Ct,b[5]/b[8]/Ct]}function lg(o){return[o[0],Math.min(Math.max(o[1],-85.051129),Ji)]}class m2 extends _a{constructor(e,r,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new So("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Wd(this.map._requestManager.transformRequest(this.url,pi.Image),(a,u)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new qu(a)):u&&(this.image=u instanceof HTMLImageElement?We.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new og(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new So("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof og||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],a=e[0][1];for(const c of e)c[1]>a&&(a=c[1]),c[1]<r&&(r=c[1]);const u=(a+r)/2;if(u>Ji?this.onNorthPole=!0:u<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=e.map(s.fromLngLat);this.tileID=function(f){let y=1/0,b=1/0,S=-1/0,_=-1/0;for(const C of f)y=Math.min(y,C.x),b=Math.min(b,C.y),S=Math.max(S,C.x),_=Math.max(_,C.y);const w=Math.max(S-y,_-b),M=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),T=Math.pow(2,M);let E=Math.floor((y+S)/2*T);return E>1&&(E-=1),new $e(M,E,Math.floor((b+_)/2*T))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new So("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const k in this.tiles){const U=this.tiles[k];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=Ep(new $e(0,0,0),this.map.transform.projection),a=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(k){const U=k[1].x-k[0].x,V=k[1].y-k[0].y,N=k[2].x-k[1].x,$=k[2].y-k[1].y,Z=k[3].x-k[2].x,K=k[3].y-k[2].y,ae=k[0].x-k[3].x,ie=k[0].y-k[3].y,se=U*$-N*V,ve=N*K-Z*$,le=Z*ie-ae*K,xe=ae*V-U*ie;return se>0&&ve>0&&le>0&&xe>0||se<0&&ve<0&&le<0&&xe<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=Ep(this.tileID,this.map.transform.projection),[c,f,y,b]=this.coordinates.map(k=>{const U=u.projection.project(k[0],k[1]);return t2(u,U)._round()});this.perspectiveTransform=p2(c.x,c.y,f.x,f.y,y.x,y.y,b.x,b.y);const S=this._boundsArray=new nl;S.emplaceBack(c.x,c.y,0,0),S.emplaceBack(f.x,f.y,Ct,0),S.emplaceBack(b.x,b.y,0,Ct),S.emplaceBack(y.x,y.y,Ct,Ct),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,vv.members),this.boundsSegments=$n.simpleSegment(0,0,4,2);const _=[],w=[lg((M=this.coordinates)[0]),lg(M[1]),lg(M[2]),lg(M[3])];var M;const[T,E,C,O]=function(k){let U=k[0][0],V=U,N=k[0][1],$=N;for(let Z=1;Z<k.length;Z++)k[Z][0]<U?U=k[Z][0]:k[Z][0]>V&&(V=k[Z][0]),k[Z][1]<N?N=k[Z][1]:k[Z][1]>$&&($=k[Z][1]);return[U,N,V-U,$-N]}(w);{const k=new nl,[U,V,N,$]=function(Ie){let Fe=Ie[0].x,ze=Fe,Ne=Ie[0].y,st=Ne;for(let nt=1;nt<Ie.length;nt++)Ie[nt].x<Fe?Fe=Ie[nt].x:Ie[nt].x>ze&&(ze=Ie[nt].x),Ie[nt].y<Ne?Ne=Ie[nt].y:Ie[nt].y>st&&(st=Ie[nt].y);return[Fe,Ne,ze-Fe,st-Ne]}(a),Z=Ie=>[(Ie.x-U)/N,(Ie.y-V)/$],[K,ae,ie,se]=a.map(Z),ve=function(Ie,Fe,ze,Ne,st,nt,Bt,ft){const St=ag(0,0,1,0,1,1,0,1),lt=ag(Ie,Fe,ze,Ne,st,nt,Bt,ft),tr=te.mat3.adjoint([],lt);return te.mat3.multiply(St,St,tr)}(K[0],K[1],ae[0],ae[1],ie[0],ie[1],se[0],se[1]);this.elevatedGlobePerspectiveTransform=p2(K[0],K[1],ae[0],ae[1],ie[0],ie[1],se[0],se[1]);const le=(Ie,Fe)=>{_.push(Ie.lng);const ze=Math.round((Ie.lng-T)/C*Ct),Ne=Math.round((Ie.lat-E)/O*Ct),st=Z(Fe),nt=te.vec3.transformMat3([],[st[0],st[1],1],ve),Bt=Math.round(nt[0]/nt[2]*Ct),ft=Math.round(nt[1]/nt[2]*Ct);k.emplaceBack(ze,Ne,Bt,ft)},xe=a[3].x-a[0].x,Me=a[3].y-a[0].y,Se=a[2].x-a[1].x,Ce=a[2].y-a[1].y;for(let Ie=0;Ie<65;Ie++){const Fe=Ie/64,ze=[a[0].x+Fe*xe,a[0].y+Fe*Me],Ne=[a[1].x+Fe*Se,a[1].y+Fe*Ce],st=Ne[0]-ze[0],nt=Ne[1]-ze[1];for(let Bt=0;Bt<65;Bt++){const ft=Bt/64,St={x:ze[0]+st*ft,y:ze[1]+nt*ft};le(r.projection.unproject(St.x,St.y),St)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(k,vv.members)}{this.maxLongitudeTriangleSize=0;let k=[],U=new wi;const V=(N,$,Z)=>{U.emplaceBack(N,$,Z);const K=_[N],ae=_[$],ie=_[Z],se=Math.min(Math.min(K,ae),ie),ve=Math.max(Math.max(K,ae),ie)-se;ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ve),k.push(se+ve/2)};for(let N=0;N<64;N++)for(let $=0;$<64;$++){const Z=65*N+$,K=Z+1,ae=Z+65,ie=ae+1;V(Z,ae,K),V(K,ae,ie)}[k,U]=function(N,$){const Z=Array.from({length:N.length},(ie,se)=>se);Z.sort((ie,se)=>N[ie]-N[se]);const K=[],ae=new wi;for(let ie=0;ie<Z.length;ie++){const se=Z[ie];K.push(N[se]);const ve=3*se,le=ve+1;ae.emplaceBack($.uint16[ve],$.uint16[le],$.uint16[le+1])}return[K,ae]}(k,U),this.elevatedGlobeTrianglesCenterLongitudes=k,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(U)}this.elevatedGlobeSegments=$n.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,C/Ct,0,O/Ct,0,0,E,T,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,a=r.gl;!this._dirty||this.texture instanceof og||(this.texture?this.texture.update(this.image):(this.texture=new wv(r,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let u=(c=e+180)+360*Math.round((a[0]-c)/360);var c;const f=new $n,y=(w,M)=>{f.segments.push({vertexOffset:0,primitiveOffset:w,vertexLength:r.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-u)<=b){const w=Hu(a,0,a.length,u+b);return w===a.length||y(w,Gu(a,w+1,a.length,u+360-b)-w),f}u<a[0]&&(u+=360);const S=Gu(a,0,a.length,u-b);if(S===a.length)return y(0,a.length),f;y(0,S-0);const _=Hu(a,S+1,a.length,u+b);return _!==a.length&&y(_,a.length-_),f}}const pR=(Math.pow(256,2)-1)/16907520;class _2 extends Yi{constructor(e,r,a,u){super(e,{layout:d2||(d2=new jn({visibility:new wt(Ue.layout_raster.visibility)})),paint:f2||(f2=new jn({"raster-opacity":new wt(Ue.paint_raster["raster-opacity"]),"raster-color":new tl(Ue.paint_raster["raster-color"]),"raster-color-mix":new wt(Ue.paint_raster["raster-color-mix"]),"raster-color-range":new wt(Ue.paint_raster["raster-color-range"]),"raster-hue-rotate":new wt(Ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(Ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(Ue.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(Ue.paint_raster["raster-saturation"]),"raster-contrast":new wt(Ue.paint_raster["raster-contrast"]),"raster-resampling":new wt(Ue.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(Ue.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new wt(Ue.paint_raster["raster-emissive-strength"]),"raster-array-band":new wt(Ue.paint_raster["raster-array-band"]),"raster-elevation":new wt(Ue.paint_raster["raster-elevation"]),"raster-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof m2&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[a,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(u)||a===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=hp({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,u])}}let g2,y2,v2,x2,b2;class w2 extends Yi{constructor(e,r,a,u){super(e,{layout:g2||(g2=new jn({visibility:new wt(Ue["layout_raster-particle"].visibility)})),paint:y2||(y2=new jn({"raster-particle-array-band":new wt(Ue["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new wt(Ue["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new tl(Ue["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new wt(Ue["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new wt(Ue["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new wt(Ue["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new wt(Ue["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new wt(Ue["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this._updateColorRamp(),this.lastInvalidatedAt=We.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=hp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=We.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class mR extends Yi{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Tv(o,e,r){const a=[0,0,1],u=te.quat.identity([]);return te.quat.rotateY(u,u,r?-Rt(o)+Math.PI:Rt(o)),te.quat.rotateX(u,u,-Rt(e)),te.vec3.transformQuat(a,a,u),te.vec3.normalize(a,a)}function T2(o,e){const r=cg(o.projection,o.zoom,o.width,o.height),a=function(c,f,y,b,S){const _=new Qr(y.lng-180*Ql,y.lat),w=new Qr(y.lng+180*Ql,y.lat),M=c.project(_.lng,_.lat),T=c.project(w.lng,w.lat),E=-Math.atan2(T.y-M.y,T.x-M.x),C=s.fromLngLat(y);C.y=Ye(C.y,-1+Ql,1-Ql);const O=C.toLngLat(),k=c.project(O.lng,O.lat),U=s.fromLngLat(O);U.x+=Ql;const V=U.toLngLat(),N=c.project(V.lng,V.lat),$=E2(N.x-k.x,N.y-k.y,E),Z=s.fromLngLat(O);Z.y+=Ql;const K=Z.toLngLat(),ae=c.project(K.lng,K.lat),ie=E2(ae.x-k.x,ae.y-k.y,E),se=Math.abs($.x)/Math.abs(ie.y),ve=te.mat4.identity([]);te.mat4.rotateZ(ve,ve,-E*(1-(S?0:b)));const le=te.mat4.identity([]);return te.mat4.scale(le,le,[1,1-(1-se)*b,1]),le[4]=-ie.x/ie.y*b,te.mat4.rotateZ(le,le,E),te.mat4.multiply(le,ve,le),le}(o.projection,0,o.center,r,e),u=S2(o);return te.mat4.scale(a,a,[u,u,1]),a}function S2(o){const e=o.projection,r=cg(o.projection,o.zoom,o.width,o.height),a=Sv(e,o.center),u=Sv(e,Qr.convert(e.center));return Math.pow(2,a*r+(1-r)*u)}function cg(o,e,r,a,u=1/0){const c=o.range;if(!c)return 0;const f=Math.min(u,Math.max(r,a)),y=Math.log(f/1024)/Math.LN2;return Jt(c[0]+y,c[1]+y,e)}const Ql=1/4e4;function Sv(o,e){const r=Ye(e.lat,-85.051129,Ji),a=new Qr(e.lng-180*Ql,r),u=new Qr(e.lng+180*Ql,r),c=o.project(a.lng,r),f=o.project(u.lng,r),y=s.fromLngLat(a),b=s.fromLngLat(u),S=f.x-c.x,_=f.y-c.y,w=b.x-y.x,M=b.y-y.y,T=Math.sqrt((w*w+M*M)/(S*S+_*_));return Math.log(T)/Math.LN2}function E2(o,e,r){const a=Math.cos(r),u=Math.sin(r);return{x:o*a-e*u,y:o*u+e*a}}function A2(o,e,r){te.mat4.identity(o),te.mat4.rotateZ(o,o,Rt(e[2])),te.mat4.rotateX(o,o,Rt(e[0])),te.mat4.rotateY(o,o,Rt(e[1])),te.mat4.scale(o,o,r),te.mat4.multiply(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ug(o,e,r,a,u,c,f,y){const b=[r[0]-e[0],r[1]-e[1],0],S=[a[0]-e[0],a[1]-e[1],0];if(te.vec3.length(b)<1e-12||te.vec3.length(S)<1e-12)return te.quat.identity(o);const _=te.vec3.cross([],b,S);te.vec3.normalize(_,_),te.vec3.subtract(S,a,e),b[2]=(c-u)*y,S[2]=(f-u)*y;const w=b;return te.vec3.cross(w,b,S),te.vec3.normalize(w,w),te.quat.rotationTo(o,_,w)}function Ev(o,e,r=!1){const a=zi(e.zoom),u=function(c,f,y){const b=f.worldSize,S=[c[12],c[13],c[14]],_=Mi(S[1]/b),w=us(S[0]/b),M=te.mat4.identity([]),T=Wi(1,_)*b,E=Wi(1,0)*b*Wl(_,f.zoom),C=1/es(b);let O=E*C;if(y){const N=cg(f.projection,f.zoom,f.width,f.height,1024);O=C*f.projection.pixelSpaceConversion(f.center.lat,b,N)}const k=Pa(_,w);te.vec3.add(k,k,te.vec3.scale([],te.vec3.normalize([],k),T*O*S[2]));const U=function(N){const $=[N[0],N[1],N[2]];let Z=[0,1,0];const K=te.vec3.cross([],Z,$);return te.vec3.cross(Z,$,K),te.vec3.squaredLength(Z)===0&&(Z=[0,1,0],te.vec3.cross(K,$,Z)),te.vec3.normalize(K,K),te.vec3.normalize(Z,Z),te.vec3.normalize($,$),[K[0],K[1],K[2],0,Z[0],Z[1],Z[2],0,$[0],$[1],$[2],0,N[0],N[1],N[2],1]}(k);te.mat4.scale(M,M,[O,O,O*T]),te.mat4.translate(M,M,[-S[0],-S[1],-S[2]]);const V=te.mat4.multiply([],f.globeMatrix,U);return te.mat4.multiply(V,V,M),te.mat4.multiply(V,V,c),V}(o,e,r);if(a>0){const c=function(f,y){const b=y.worldSize,S=Wi(1,0)*b*Wl(y.center.lat,y.zoom)/es(b),_=Wi(1,y.center.lat)*b,w=te.mat4.identity([]);return te.mat4.rotateY(w,w,Rt(y.center.lng)),te.mat4.rotateX(w,w,Rt(y.center.lat)),te.mat4.translate(w,w,[0,0,Ai]),te.mat4.scale(w,w,[S,S,S*_]),te.mat4.translate(w,w,[y.point.x-.5*b,y.point.y-.5*b,0]),te.mat4.multiply(w,w,f),te.mat4.multiply(w,y.globeMatrix,w)}(o,e);return function(f,y,b){const S=(E,C,O)=>{const k=te.vec3.length(E),U=te.vec3.length(C),V=Ti(E,C,O);return te.vec3.scale(V,V,1/te.vec3.length(V)*ar(k,U,O))},_=S([f[0],f[1],f[2]],[y[0],y[1],y[2]],b),w=S([f[4],f[5],f[6]],[y[4],y[5],y[6]],b),M=S([f[8],f[9],f[10]],[y[8],y[9],y[10]],b),T=Ti([f[12],f[13],f[14]],[y[12],y[13],y[14]],b);return[_[0],_[1],_[2],0,w[0],w[1],w[2],0,M[0],M[1],M[2],0,T[0],T[1],T[2],1]}(u,c,a)}return u}function M2(o,e,r,a){const u=or.projectAabbCorners(a,r);let c=Number.MAX_VALUE,f=-1;for(let S=0;S<u.length;++S){const _=u[S];_[0]=(.5*_[0]+.5)*e.width,_[1]=(.5-.5*_[1])*e.height,_[2]<c&&(f=S,c=_[2])}const y=S=>new Ae(u[S][0],u[S][1]);let b;switch(f){case 0:case 6:b=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:b=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:b=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:b=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(q(o,b))return c}const _R=Jr([{name:"a_pos_3f",components:3,type:"Float32"}]),gR=Jr([{name:"a_color_3f",components:3,type:"Float32"}]),yR=Jr([{name:"a_color_4f",components:4,type:"Float32"}]),vR=Jr([{name:"a_uv_2f",components:2,type:"Float32"}]),xR=Jr([{name:"a_normal_3f",components:3,type:"Float32"}]),bR=Jr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),wR=Jr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),I2={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class hg{constructor(e,r,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function C2(o,e){const r=o.indexOf("://")===-1;try{return new URL(o,r&&e?"http://example.com":void 0),!0}catch{return!1}}class P2{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class R2{constructor(){this.instancedDataArray=new Yf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Av{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,r){}populate(e,r,a,u){this.tileToMeter=t(a);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:y,index:b,sourceLayerIndex:S}of e){const _=y??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),w=F(f,c);if(!this.layers[0]._featureFilter.filter(new bn(this.zoom),w,a))continue;const M={id:_,sourceLayerIndex:S,index:b,geometry:c?w.geometry:L(f,a,u),properties:f.properties,type:f.type,patterns:{}},T=this.addFeature(M,M.geometry,w);T&&r.featureIndex.insert(f,M.geometry,b,S,this.index,this.instancesPerModel[T].instancedDataArray.length,Ct/32)}this.lookup=null}update(e,r,a,u){for(const c in this.instancesPerModel){const f=this.instancesPerModel[c];for(const y in e)f.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(f.features[f.idToFeaturesIndex[y]],e[y],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const a=this.instancesPerModel[r];for(const u of a.features){const c=this.layers[0],f=u.feature,y=this.canonical,b=c.paint.get("model-rotation").evaluate(f,{},y),S=c.paint.get("model-scale").evaluate(f,{},y),_=c.paint.get("model-translation").evaluate(f,{},y);te.vec3.exactEquals(u.rotation,b)&&te.vec3.exactEquals(u.scale,S)&&te.vec3.exactEquals(u.translation,_)||(this.evaluate(u,u.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,r,a,u){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const c=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Y0(this.activeReplacements,c))return!1;this.activeReplacements=c;let f=!1;for(const y in this.instancesPerModel){const b=this.instancesPerModel[y],S=b.instancedDataArray;for(const _ of b.features){const w=_.instancedDataOffset,M=_.instancedDataCount;for(let T=0;T<M;T++){const E=16*(T+w);let C=S.float32[E+0];const O=C>Ct;C=O?C-Ct:C;const k=Math.floor(C),U=S.float32[E+1];let V=!1;for(const N of this.activeReplacements)if(!Ub(N,a,I2.Model,u)&&!(N.min.x>k||k>N.max.x||N.min.y>U||U>N.max.y)&&(V=Wb(qb(k,U,e.canonical,N.footprintTileId.canonical),N.footprint),V))break;S.float32[E]=V?C+Ct:C,f=f||V!==O}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const a=this.instancesPerModel[r];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,bR.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const a=this.instancesPerModel[r];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const r of this.modelUris)e.removeModel(r,"")}addFeature(e,r,a){const u=this.layers[0],c=u.layout.get("model-id").evaluate(a,{},this.canonical);if(!c)return Pr(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),c;C2(c,!1)&&(this.modelUris.includes(c)||this.modelUris.push(c)),this.instancesPerModel[c]||(this.instancesPerModel[c]=new R2);const f=this.instancesPerModel[c],y=f.instancedDataArray,b=new P2(a,y.length);for(const S of r)for(const _ of S){if(_.x<0||_.x>=Ct||_.y<0||_.y>=Ct)continue;const w=(this.lookupDim-1)/Ct,M=this.lookupDim*(_.y*w|0)+_.x*w|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const T=y.length;y.resize(T+1),f.instancesEvaluatedElevation.push(0),y.float32[16*T]=_.x,y.float32[16*T+1]=_.y}return b.instancedDataCount=f.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(b),this.evaluate(b,{},f,!1)),c}getModelUris(){return this.modelUris}evaluate(e,r,a,u){const c=this.layers[0],f=e.feature,y=this.canonical,b=e.rotation=c.paint.get("model-rotation").evaluate(f,r,y),S=e.scale=c.paint.get("model-scale").evaluate(f,r,y),_=e.translation=c.paint.get("model-translation").evaluate(f,r,y),w=c.paint.get("model-color").evaluate(f,r,y);w.a=c.paint.get("model-color-mix-intensity").evaluate(f,r,y);const M=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),A2(M,b,S);const T=Math.round(100*w.a)+w.b/1.05;for(let E=0;E<e.instancedDataCount;++E){const C=e.instancedDataOffset+E,O=16*C,k=a.instancedDataArray.float32;let U=0;u&&(U=k[O+6]-a.instancesEvaluatedElevation[C]);const V=0|k[O+1];k[O]=(0|k[O])+w.r/1.05,k[O+1]=V+w.g/1.05,k[O+2]=T,k[O+3]=1/(y.z>10?this.tileToMeter:t(y,V)),k[O+4]=_[0],k[O+5]=_[1],k[O+6]=_[2]+U,k[O+7]=M[0],k[O+8]=M[1],k[O+9]=M[2],k[O+10]=M[4],k[O+11]=M[5],k[O+12]=M[6],k[O+13]=M[8],k[O+14]=M[9],k[O+15]=M[10],a.instancesEvaluatedElevation[C]=_[2]}}}let D2,z2;Ft(Av,"ModelBucket",{omit:["layers"]}),Ft(R2,"PerModelAttributes"),Ft(P2,"ModelFeature");const du=64,nd={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function L2(o,e,r,a,u,c,f,y,b,S=!1){const _=r.zoom,w=r.project(a),M=Wl(a.lat,_),T=1/M;te.mat4.identity(o),te.mat4.translate(o,o,[w.x+f[0]*T,w.y+f[1]*T,f[2]]);let E=1,C=1;const O=r.worldSize;if(S){if(r.projection.name==="mercator"){let N=0;r.elevation&&(N=r.elevation.getAtPointOrZero(new s(w.x/O,w.y/O),0));const $=te.vec4.transformMat4([],[w.x,w.y,N,1],r.projMatrix)[3]/r.cameraToCenterDistance;E=$,C=$*Wl(r.center.lat,_)}else if(r.projection.name==="globe"){const N=Ev(o,r),$=te.mat4.multiply([],r.projMatrix,N),Z=[0,0,0,1];te.vec4.transformMat4(Z,Z,$);const K=Z[3]/r.cameraToCenterDistance,ae=zi(_),ie=r.projection.pixelsPerMeter(a.lat,O)*Wl(a.lat,_),se=r.projection.pixelsPerMeter(r.center.lat,O)*Wl(r.center.lat,_);E=K/ar(ie,cp(r.center.lat),ae),C=K*M/ie,E*=se,C*=se}}else E=T;te.mat4.scale(o,o,[E,E,C]);const k=[...o],U=e.orientation,V=[];if(A2(V,[U[0]+u[0],U[1]+u[1],U[2]+u[2]],c),te.mat4.multiply(o,k,V),y&&r.elevation){let N=0;const $=[];if(b&&r.elevation){N=function(ae,ie,se,ve,le){const xe=ie.elevation;if(!xe)return 0;const Me=or.projectAabbCorners(se,ve),Se=Wi(1,le.lat)*ie.worldSize,Ce=function(tr,Ot){const qt=[0,0,1],dr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Mr of dr){const yr=tr[Mr.corners[0]],Lr=tr[Mr.corners[1]],Sr=tr[Mr.corners[2]],Fr=[Lr[0]-yr[0],Lr[1]-yr[1],Ot*(Lr[2]-yr[2])],Yr=te.vec3.cross(Fr,Fr,[Sr[0]-yr[0],Sr[1]-yr[1],Ot*(Sr[2]-yr[2])]);te.vec3.normalize(Yr,Yr),Mr.dotProductWithUp=te.vec3.dot(Yr,qt)}return dr.sort((Mr,yr)=>Mr.dotProductWithUp-yr.dotProductWithUp),dr[0].corners}(Me,Se),Ie=Me[Ce[0]],Fe=Me[Ce[1]],ze=Me[Ce[2]],Ne=Me[Ce[3]],st=xe.getAtPointOrZero(new s(Ie[0]/ie.worldSize,Ie[1]/ie.worldSize),0),nt=xe.getAtPointOrZero(new s(Fe[0]/ie.worldSize,Fe[1]/ie.worldSize),0),Bt=xe.getAtPointOrZero(new s(ze[0]/ie.worldSize,ze[1]/ie.worldSize),0),ft=xe.getAtPointOrZero(new s(Ne[0]/ie.worldSize,Ne[1]/ie.worldSize),0),St=(st+ft)/2,lt=(nt+Bt)/2;return St>lt?nt<Bt?ug(ae,Fe,Ne,Ie,nt,ft,st,Se):ug(ae,ze,Ie,Ne,Bt,st,ft,Se):st<ft?ug(ae,Ie,Fe,ze,st,nt,Bt,Se):ug(ae,Ne,ze,Fe,ft,Bt,nt,Se),Math.max(St,lt)}($,r,e.aabb,o,a);const Z=te.mat4.fromQuat([],$),K=te.mat4.multiply([],Z,V);te.mat4.multiply(o,k,K)}else N=r.elevation.getAtPointOrZero(new s(w.x/O,w.y/O),0);N!==0&&(o[14]+=N)}}function Pp(o,e,r=!1){o.uploaded||(o.gfxTexture=new wv(e,o.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function TR(o,e,r){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,_R.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,xR.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,vR.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?gR:yR).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,wR.members,!0)),o.segments=$n.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const a=o.material;a.pbrMetallicRoughness.baseColorTexture&&Pp(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Pp(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Pp(a.normalTexture,e),a.occlusionTexture&&Pp(a.occlusionTexture,e,r),a.emissionTexture&&Pp(a.emissionTexture,e)}function Mv(o,e,r){if(o.meshes)for(const a of o.meshes)TR(a,e,r);if(o.children)for(const a of o.children)Mv(a,e,r)}function dg(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)dg(e)}function Iv(o){if(o.meshes)for(const r of o.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const r of o.children)Iv(r)}class id{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const u=a||e.findDEMTileFor(r);if(!u||!u.dem)return;const c=u.dem,f=u.tileID,y=1<<r.canonical.z-f.canonical.z;return new id(u,c.dim/Ct/y,[(r.canonical.x/y-f.canonical.x)*c.dim,(r.canonical.y/y-f.canonical.y)*c.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(a);return new Ae(u,c)}getElevationAt(e,r,a,u){const c=e*this._scale+this._offset[0],f=r*this._scale+this._offset[1],y=Math.floor(c),b=Math.floor(f),S=this._dem;return u=!!u,a?ar(ar(S.get(y,b,u),S.get(y,b+1,u),f-b),ar(S.get(y+1,b,u),S.get(y+1,b+1,u),f-b),c-y):S.get(y,b,u)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Wi(1,e)*this._dem.stride}}const Cv=new Float32Array(262144),fu=new Uint8Array(262144);function O2(o){let e=0;if(o.meshes)for(const r of o.meshes)e=Math.max(e,r.aabb.max[2]);if(o.children)for(const r of o.children)e=Math.max(e,O2(r));return e}function k2(o,e,r){if(o.meshes)for(const a of o.meshes){if(a.aabb.min[0]===1/0)continue;const u=or.applyTransform(a.aabb,o.matrix);r.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(o.children)for(const a of o.children)k2(a,e,r)}const F2=["","wall","door","roof","window","lamp","logo"];class B2{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:O2(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=or.applyTransformFast(a.aabb,this.node.matrix),r.encapsulate(a.transformedAabb)),e++;this.aabb=r}return this.aabb}}class fg{constructor(e,r,a,u,c,f,y){this.id=a,this.layers=e,this.layerIds=this.layers.map(b=>b.fqid),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.modelTraits|=nd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=nd.HasMapboxMeshFeatures),c&&(this.modelTraits|=nd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const b of r)this.nodesInfo.push(new B2(b)),k2(b,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,r){for(const a of this.getNodesInfo()){const u=a.node;u.footprint&&r.push({footprint:u.footprint,id:e})}}update(e){const r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;const a=r?this.stateDependentLayers:this.layers;if(!bt(e,this.states))for(const u of a)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const a of r){const u=a.node;this.uploaded?this.updatePbrBuffer(u):Mv(u,e,!0)}for(const a of r)dg(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),r=!0);return r}needsReEvaluation(e,r,a){const u=e.transform.projectionOptions,c=e.style.getBrightness(),f=this.brightness!==c;if(!this.uploaded||this.dirty||u.name!==this.projection.name||Rp(a.paint.get("model-color").value,f)||Rp(a.paint.get("model-color-mix-intensity").value,f)||Rp(a.paint.get("model-roughness").value,f)||Rp(a.paint.get("model-emissive-strength").value,f)||Rp(a.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=u,this.brightness=c;const y=this.getNodesInfo();for(const b of y)b.state=null;return!0}return!1}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),u=this.id.canonical;for(const c of a){const f=c.feature;c.evaluatedScale=r.paint.get("model-scale").evaluate(f,{},u)}}evaluate(e,r){const a=this.getNodesInfo();for(const u of a){if(!u.node.meshes)continue;const c=u.feature,f=r&&r[c.id];if(bt(f,u.state))continue;u.state=structuredClone(f);const y=u.node.meshes&&u.node.meshes[0].featureData,b=u.evaluatedColor[2],S=u.evaluatedRMEA[2],_=this.id.canonical;if(u.hasTranslucentParts=!1,y){for(let w=0;w<F2.length;w++){const M=F2[w];M.length&&(c.properties.part=M);const T=e.paint.get("model-color").evaluate(c,f,_).toRenderColor(null),E=e.paint.get("model-color-mix-intensity").evaluate(c,f,_);u.evaluatedColor[w]=[T.r,T.g,T.b,E],u.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(c,f,_),u.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(c,f,_),u.evaluatedRMEA[w][3]=T.a,u.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(c,f,_),!u.hasTranslucentParts&&T.a<1&&(u.hasTranslucentParts=!0)}delete c.properties.part,ER(u,b!==u.evaluatedColor[2]||S!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(c,f,_);u.evaluatedScale=e.paint.get("model-scale").evaluate(c,f,_),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,a,u){const c=e.findDEMTileFor(a);if(c&&(c.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const f=id.create(e,a,c);if(!f)return;this.modelTraits&nd.HasMapboxMeshFeatures&&this.updateDEM(e,f,a,u);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const S=b.footprint.vertices;let _=f.getElevationAt(S[0].x,S[0].y,!0,!0);for(let w=1;w<S.length;w++)_=Math.min(_,f.getElevationAt(S[w].x,S[w].y,!0,!0));b.elevation=_}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,a,u){let c=r._dem._modifiedForSources[u];if(c===void 0&&(r._dem._modifiedForSources[u]=[],c=r._dem._modifiedForSources[u]),c.includes(a.canonical))return;const f=r._dem.dim;c.push(a.canonical);let y=!1;for(const b of this.getNodesInfo()){const S=b.node;if(!S.footprint||!S.footprint.grid)continue;const _=S.footprint.grid,w=r.tileCoordToPixel(_.min.x,_.min.y),M=r.tileCoordToPixel(_.max.x,_.max.y),T=Math.min(Math.min(f-M.y,w.x),Math.min(w.y,f-M.x));if(T<0)continue;const E=Ye(T,2,5);let C=Math.max(0,w.x-E),O=Math.max(0,w.y-E),k=Math.min(M.x+E,f-1),U=Math.min(M.y+E,f-1);for(let Z=O;Z<=U;++Z)for(let K=C;K<=k;++K)fu[Z*f+K]=255;let V=0,N=0;for(let Z=0;Z<_.cellsY;++Z)for(let K=0;K<_.cellsX;++K){if(!_.cells[Z*_.cellsX+K])continue;const ae=r.tileCoordToPixel(_.min.x+K/_.xScale,_.min.y+Z/_.yScale),ie=r.tileCoordToPixel(_.min.x+(K+1)/_.xScale,_.min.y+(Z+1)/_.yScale);for(let se=ae.y;se<=Math.min(ie.y+1,f-1);++se)for(let ve=ae.x;ve<=Math.min(ie.x+1,f-1);++ve)fu[se*f+ve]===255&&(fu[se*f+ve]=0,V+=r.getElevationAtPixel(ve,se),N++)}const $=V/N;C=Math.max(1,w.x-E),O=Math.max(1,w.y-E),k=Math.min(M.x+E,f-2),U=Math.min(M.y+E,f-2),y=!0;for(let Z=O;Z<=U;++Z)for(let K=C;K<=k;++K)fu[Z*f+K]===0&&(Cv[Z*f+K]=r._dem.set(K,Z,$));for(let Z=1;Z<E;++Z){C=Math.max(1,w.x-Z),O=Math.max(1,w.y-Z),k=Math.min(M.x+Z,f-2),U=Math.min(M.y+Z,f-2);for(let K=O;K<=U;++K)for(let ae=C;ae<=k;++ae){const ie=K*f+ae;if(fu[ie]===255){let se=0,ve=0,le=-1,xe=-1;for(let Me=-1;Me<=1;++Me)for(let Se=-1;Se<=1;++Se){const Ce=(K+Me)*f+ae+Se;if(fu[Ce]>=Z)continue;const Ie=Cv[Ce],Fe=Math.abs(Ie);Fe>ve&&(se=Ie,ve=Fe,le=Se,xe=Me)}if(ve>.1){const Me=1-(Z+.5*Math.abs(le*xe))/E;let Se=r._dem.get(ae,K)+se*Me;const Ce=r._dem.get(ae+le,K+xe),Ie=r._dem.get(ae-le,K-xe,!0);(Se-Ce)*(Se-Ie)>0&&(Se=(Ce+Ie)/2),Cv[ie]=r._dem.set(ae,K,Se),fu[ie]=Z}}}}}y&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=We.now())}setFilter(e){this.filter=e?Ff(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new bn(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)dg(r.node),Iv(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const a=r.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const f=u[c].node;u[c].hiddenByReplacement=!!f.footprint&&!a.find(y=>y.footprint===f.footprint)}}getHeightAtTileCoord(e,r){const a=this.getNodesInfo(),u=[],c=[0,0,0],f=te.mat4.identity([]);for(let y=0;y<this.nodesInfo.length;y++){const b=a[y],S=b.node.meshes[0],_=S.transformedAabb;if(e<_.min[0]||r<_.min[1]||e>_.max[0]||r>_.max[1])continue;if(b.node.hidden===!0)return{height:1/0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};te.mat4.invert(f,b.node.matrix),c[0]=e,c[1]=r,te.vec3.transformMat4(c,c,f);const w=(c[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*du|0,M=Math.min(63,(c[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*du|0)*du+Math.min(63,w),T=S.heightmap[M];if(!(T<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:T,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Ae(e,r),new Ae(e,r),u),u.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function Rp(o,e){return!o.isLightConstant&&e}function SR(o,e,r,a,u,c,f,y){let b=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,_=240&e|(240&e)>>4;r[3]>0&&(b=ar(b,255*r[0],r[3]),S=ar(S,255*r[1],r[3]),_=ar(_,255*r[2],r[3]));const w=b<<8|S,M=_<<8|Math.floor(255*a[3]),T=function(Z){const K=Ye(Z,0,2);return Math.min(Math.round(.5*K*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],E=Ye(u[0],0,1),C=Ye(u[1],0,1),O=Ye(u[2],0,1),k=Ye(u[3],0,1);let U,V,N,$;if(E!==C&&f!==c&&C!==E){const Z=f-c;V=1/(Z*(C-E)),N=-(c+Z*E)/(Z*(C-E));const K=Ye(u[4],-1,1);$=Math.pow(10,K),U=255*O<<8|255*k}else U=65535,V=0,N=1,$=1;if(o.emplaceBack(w,M,T,U,V,N,$),y){const Z=y.length;y.clear();for(let K=0;K<Z;K++)y.emplaceBack(w,M,T,U,V,N,$)}}function ER(o,e,r){const a=o.node;let u=0;const c=r&nd.HasMeshoptCompression;for(const f of a.meshes){if(a.lights&&a.lightMeshIndex===u||!f.featureData)continue;f.featureArray=new Qc,f.featureArray.reserve(f.featureData.length);let y=e;for(const b of f.featureData){const S=c?65535&b:b>>16&65535,_=c?b>>16&65535:65535&b,w=(15&_)<8?15&_:0,M=o.evaluatedRMEA[w],T=o.evaluatedColor[w],E=o.emissionHeightBasedParams[w];let C;if(y&&w===2&&a.lights&&(C=new Qc,C.resize(10*a.lights.length)),SR(f.featureArray,S,T,M,E,f.aabb.min[2],f.aabb.max[2],C),C&&y){y=!1;const O=a.meshes[a.lightMeshIndex];O.featureArray=C,O.featureArray._trim()}}f.featureArray._trim(),u++}}function N2(o,e,r,a){const u=1<<o.z;e.lat=Mi((a/Ct+o.y)/u),e.lng=us((r/Ct+o.x)/u)}Ft(fg,"Tiled3dModelBucket",{omit:["layers"]}),Ft(B2,"Tiled3dModelFeature");const AR={circle:class extends Yi{constructor(o,e,r,a){super(o,{layout:Qe||(Qe=new jn({"circle-sort-key":new kt(Ue.layout_circle["circle-sort-key"]),"circle-elevation-reference":new wt(Ue.layout_circle["circle-elevation-reference"]),visibility:new wt(Ue.layout_circle.visibility)})),paint:De||(De=new jn({"circle-radius":new kt(Ue.paint_circle["circle-radius"]),"circle-color":new kt(Ue.paint_circle["circle-color"]),"circle-blur":new kt(Ue.paint_circle["circle-blur"]),"circle-opacity":new kt(Ue.paint_circle["circle-opacity"]),"circle-translate":new wt(Ue.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(Ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(Ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(Ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(Ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(Ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(Ue.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new wt(Ue.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}createBucket(o){return new X(o)}queryRadius(o){const e=o;return et("circle-radius",this,e)+et("circle-stroke-width",this,e)+rt(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,r,a,u,c,f,y){const b=Oe(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Xh(o,a,c,f,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,r){const a=Zh(this);return{config:new ol(this,{zoom:e,lut:r}),defines:a,overrideFog:!1}}},heatmap:class extends Yi{createBucket(o){return new ub(o)}constructor(o,e,r,a){super(o,{layout:hb||(hb=new jn({visibility:new wt(Ue.layout_heatmap.visibility)})),paint:db||(db=new jn({"heatmap-radius":new kt(Ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(Ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(Ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new tl(Ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(Ue.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=hp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return et("heatmap-radius",this,o)}queryIntersectsFeature(o,e,r,a,u,c,f,y){const b=this.paint.get("heatmap-radius").evaluate(e,r);return Xh(o,a,c,f,y,!0,!0,new Ae(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,r){return o==="heatmap"?{config:new ol(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Yi{constructor(o,e,r,a){super(o,{layout:fb||(fb=new jn({visibility:new wt(Ue.layout_hillshade.visibility)})),paint:pb||(pb=new jn({"hillshade-illumination-direction":new wt(Ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new wt(Ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(Ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(Ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(Ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(Ue.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new wt(Ue.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,r){return{overrideFog:!1}}},fill:class extends Yi{constructor(o,e,r,a){super(o,{layout:zb||(zb=new jn({"fill-sort-key":new kt(Ue.layout_fill["fill-sort-key"]),visibility:new wt(Ue.layout_fill.visibility),"fill-elevation-reference":new wt(Ue.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new kt(Ue.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Lb||(Lb=new jn({"fill-antialias":new wt(Ue.paint_fill["fill-antialias"]),"fill-opacity":new kt(Ue.paint_fill["fill-opacity"]),"fill-color":new kt(Ue.paint_fill["fill-color"]),"fill-outline-color":new kt(Ue.paint_fill["fill-outline-color"]),"fill-translate":new wt(Ue.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(Ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(Ue.paint_fill["fill-pattern"]),"fill-emissive-strength":new wt(Ue.paint_fill["fill-emissive-strength"]),"fill-z-offset":new kt(Ue.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new kt(Ue.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new kt(Ue.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(o,e,r){return{config:new ol(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Z0(o)}queryRadius(){return rt(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,r,a,u,c){return!o.queryGeometry.isAboveHorizon&&Q(_t(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}},"fill-extrusion":class extends Yi{constructor(o,e,r,a){super(o,{layout:lw||(lw=new jn({visibility:new wt(Ue["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new wt(Ue["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:cw||(cw=new jn({"fill-extrusion-opacity":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new wt(Ue["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new $_(o)}queryRadius(){return rt(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,r,a,u,c,f,y,b){const S=Oe(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(e,r),w=this.paint.get("fill-extrusion-base").evaluate(e,r),M=[0,0],T=y&&c.elevation,E=c.elevation?c.elevation.exaggeration():1,C=o.tile.getBucket(this);if(T&&C instanceof $_){const N=C.centroidVertexArray,$=b+1;$<N.length&&(M[0]=N.geta_centroid_pos0($),M[1]=N.geta_centroid_pos1($))}if(M[0]===0&&M[1]===1)return!1;c.projection.name==="globe"&&(a=aw([a],[new Ae(0,0),new Ae(Ct,Ct)],o.tileID.canonical).map(N=>N.polygon).flat());const O=T?y:null,[k,U]=function(N,$,Z,K,ae,ie,se,ve,le,xe,Me){return N.projection.name==="globe"?function(Se,Ce,Ie,Fe,ze,Ne,st,nt,Bt,ft,St){const lt=[],tr=[],Ot=Se.projection.upVectorScale(St,Se.center.lat,Se.worldSize).metersToTile,qt=[0,0,0,1],dr=[0,0,0,1],Mr=(Lr,Sr,Fr,Yr)=>{Lr[0]=Sr,Lr[1]=Fr,Lr[2]=Yr,Lr[3]=1},yr=ow();Ie>0&&(Ie+=yr),Fe+=yr;for(const Lr of Ce){const Sr=[],Fr=[];for(const Yr of Lr){const wn=Yr.x+ze.x,_r=Yr.y+ze.y,jr=Se.projection.projectTilePoint(wn,_r,St),Cn=Se.projection.upVector(St,Yr.x,Yr.y);let Bn=Ie,Wn=Fe;if(st){const Xn=hw(wn,_r,Ie,Fe,st,nt,Bt,ft);Bn+=Xn.base,Wn+=Xn.top}Ie!==0?Mr(qt,jr.x+Cn[0]*Ot*Bn,jr.y+Cn[1]*Ot*Bn,jr.z+Cn[2]*Ot*Bn):Mr(qt,jr.x,jr.y,jr.z),Mr(dr,jr.x+Cn[0]*Ot*Wn,jr.y+Cn[1]*Ot*Wn,jr.z+Cn[2]*Ot*Wn),te.vec3.transformMat4(qt,qt,Ne),te.vec3.transformMat4(dr,dr,Ne),Sr.push(new uu(qt[0],qt[1],qt[2])),Fr.push(new uu(dr[0],dr[1],dr[2]))}lt.push(Sr),tr.push(Fr)}return[lt,tr]}(N,$,Z,K,ae,ie,se,ve,le,xe,Me):se?function(Se,Ce,Ie,Fe,ze,Ne,st,nt,Bt){const ft=[],St=[],lt=[0,0,0,1];for(const tr of Se){const Ot=[],qt=[];for(const dr of tr){const Mr=dr.x+Fe.x,yr=dr.y+Fe.y,Lr=hw(Mr,yr,Ce,Ie,Ne,st,nt,Bt);lt[0]=Mr,lt[1]=yr,lt[2]=Lr.base,lt[3]=1,te.vec4.transformMat4(lt,lt,ze),lt[3]=Math.max(lt[3],1e-5);const Sr=new uu(lt[0]/lt[3],lt[1]/lt[3],lt[2]/lt[3]);lt[0]=Mr,lt[1]=yr,lt[2]=Lr.top,lt[3]=1,te.vec4.transformMat4(lt,lt,ze),lt[3]=Math.max(lt[3],1e-5);const Fr=new uu(lt[0]/lt[3],lt[1]/lt[3],lt[2]/lt[3]);Ot.push(Sr),qt.push(Fr)}ft.push(Ot),St.push(qt)}return[ft,St]}($,Z,K,ae,ie,se,ve,le,xe):function(Se,Ce,Ie,Fe,ze){const Ne=[],st=[],nt=ze[8]*Ce,Bt=ze[9]*Ce,ft=ze[10]*Ce,St=ze[11]*Ce,lt=ze[8]*Ie,tr=ze[9]*Ie,Ot=ze[10]*Ie,qt=ze[11]*Ie;for(const dr of Se){const Mr=[],yr=[];for(const Lr of dr){const Sr=Lr.x+Fe.x,Fr=Lr.y+Fe.y,Yr=ze[0]*Sr+ze[4]*Fr+ze[12],wn=ze[1]*Sr+ze[5]*Fr+ze[13],_r=ze[2]*Sr+ze[6]*Fr+ze[14],jr=ze[3]*Sr+ze[7]*Fr+ze[15],Cn=Yr+nt,Bn=wn+Bt,Wn=_r+ft,Xn=Math.max(jr+St,1e-5),gn=Yr+lt,gi=wn+tr,ts=_r+Ot,ii=Math.max(jr+qt,1e-5);Mr.push(new uu(Cn/Xn,Bn/Xn,Wn/Xn)),yr.push(new uu(gn/ii,gi/ii,ts/ii))}Ne.push(Mr),st.push(yr)}return[Ne,st]}($,Z,K,ae,ie)}(c,a,w,_,S,f,O,M,E,c.center.lat,o.tileID.canonical),V=o.queryGeometry;return function(N,$,Z){let K=1/0;Q(Z,$)&&(K=uw(Z,$[0]));for(let ae=0;ae<$.length;ae++){const ie=$[ae],se=N[ae];for(let ve=0;ve<ie.length-1;ve++){const le=ie[ve],xe=[le,ie[ve+1],se[ve+1],se[ve],le];q(Z,xe)&&(K=Math.min(K,uw(Z,xe)))}}return K!==1/0&&K}(k,U,V.isPointQuery()?V.screenBounds:V.screenGeometry)}},line:class extends Yi{constructor(o,e,r,a){const u=bw();super(o,u,e,r,a),u.layout&&(this.layout=new Nl(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof kr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(xp)return xp;const r=bw();return xp=new AP(r.paint.properties["line-width"].specification),xp.useIntegerZoom=!0,xp})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new tv(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,r){const a=vw(this);return{config:new ol(this,{zoom:e,lut:r}),defines:a,overrideFog:!1}}queryRadius(o){const e=o,r=ww(et("line-width",this,e),et("line-gap-width",this,e)),a=et("line-offset",this,e);return r/2+Math.abs(a)+rt(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,r,a,u,c){if(o.queryGeometry.isAboveHorizon)return!1;const f=_t(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,o.pixelToTileUnitsFactor),y=o.pixelToTileUnitsFactor/2*ww(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(a=function(S,_){const w=[],M=new Ae(0,0);for(let T=0;T<S.length;T++){const E=S[T],C=[];for(let O=0;O<E.length;O++){const k=E[O],U=E[O+1],V=O===0?M:k.sub(E[O-1])._unit()._perp(),N=O===E.length-1?M:U.sub(k)._unit()._perp(),$=V._add(N)._unit();$._mult(1/($.x*N.x+$.y*N.y)),C.push($._mult(_)._add(k))}w.push(C)}return w}(a,b*o.pixelToTileUnitsFactor)),function(S,_,w){for(let M=0;M<_.length;M++){const T=_[M];if(S.length>=3){for(let E=0;E<T.length;E++)if(me(S,T[E]))return!0}if(oe(S,T,w))return!0}return!1}(f,a,y)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets}},symbol:sg,background:class extends Yi{constructor(o,e,r,a){super(o,{layout:u2||(u2=new jn({visibility:new wt(Ue.layout_background.visibility)})),paint:h2||(h2=new jn({"background-pitch-alignment":new wt(Ue.paint_background["background-pitch-alignment"]),"background-color":new wt(Ue.paint_background["background-color"]),"background-pattern":new wt(Ue.paint_background["background-pattern"]),"background-opacity":new wt(Ue.paint_background["background-opacity"]),"background-emissive-strength":new wt(Ue.paint_background["background-emissive-strength"]),"background-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,r){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:_2,"raster-particle":w2,sky:class extends Yi{constructor(o,e,r,a){super(o,{layout:v2||(v2=new jn({visibility:new wt(Ue.layout_sky.visibility)})),paint:x2||(x2=new jn({"sky-type":new wt(Ue.paint_sky["sky-type"]),"sky-atmosphere-sun":new wt(Ue.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new wt(Ue.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new wt(Ue.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new wt(Ue.paint_sky["sky-gradient-radius"]),"sky-gradient":new tl(Ue.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new wt(Ue.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new wt(Ue.paint_sky["sky-atmosphere-color"]),"sky-opacity":new wt(Ue.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=hp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,c=o.style.light,f=c.properties.get("position");return u&&c.properties.get("anchor")==="viewport"&&Pr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Tv(f.azimuthal,90-f.polar,e):Tv(a[0],90-a[1],e)}const r=this.paint.get("sky-gradient-center");return Tv(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Yi{constructor(o,e,r,a){super(o,{paint:b2||(b2=new jn({}))},e,null)}},model:class extends Yi{constructor(o,e,r,a){super(o,{layout:D2||(D2=new jn({visibility:new wt(Ue.layout_model.visibility),"model-id":new kt(Ue.layout_model["model-id"])})),paint:z2||(z2=new jn({"model-opacity":new kt(Ue.paint_model["model-opacity"]),"model-rotation":new kt(Ue.paint_model["model-rotation"]),"model-scale":new kt(Ue.paint_model["model-scale"]),"model-translation":new kt(Ue.paint_model["model-translation"]),"model-color":new kt(Ue.paint_model["model-color"]),"model-color-mix-intensity":new kt(Ue.paint_model["model-color-mix-intensity"]),"model-type":new wt(Ue.paint_model["model-type"]),"model-cast-shadows":new wt(Ue.paint_model["model-cast-shadows"]),"model-receive-shadows":new wt(Ue.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new wt(Ue.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new kt(Ue.paint_model["model-emissive-strength"]),"model-roughness":new kt(Ue.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new kt(Ue.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new wt(Ue.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new wt(Ue.paint_model["model-front-cutoff"]),"model-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new Av(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof fg?Ct-1:0}queryIntersectsFeature(o,e,r,a,u,c){if(!this.modelManager)return!1;const f=this.modelManager,y=o.tile.getBucket(this);if(!(y&&y instanceof Av))return!1;for(const b in y.instancesPerModel){const S=y.instancesPerModel[b],_=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(S.idToFeaturesIndex.hasOwnProperty(_)){const w=S.features[S.idToFeaturesIndex[_]],M=f.getModel(b,this.scope);if(!M)return!1;let T=te.mat4.create();const E=new Qr(0,0),C=y.canonical;let O=Number.MAX_VALUE;for(let k=0;k<w.instancedDataCount;++k){const U=16*(w.instancedDataOffset+k),V=S.instancedDataArray.float32,N=[V[U+4],V[U+5],V[U+6]];N2(C,E,V[U],0|V[U+1]),L2(T,M,c,E,w.rotation,w.scale,N,!1,!1,!1),c.projection.name==="globe"&&(T=Ev(T,c));const $=te.mat4.multiply([],c.projMatrix,T),Z=o.queryGeometry,K=M2(Z.isPointQuery()?Z.screenBounds:Z.screenGeometry,c,$,M.aabb);K!=null&&(O=Math.min(K,O))}return O!==Number.MAX_VALUE&&O}}return!1}_handleOverridablePaintPropertyUpdate(o,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ll}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Yi{constructor(o,e,r,a){super(o,{layout:Ob||(Ob=new jn({"clip-layer-types":new wt(Ue.layout_clip["clip-layer-types"]),"clip-layer-scope":new wt(Ue.layout_clip["clip-layer-scope"])})),paint:kb||(kb=new jn({}))},e,r,a)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new Fb(o)}is3D(o){return!0}}};class MR{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class IR{constructor(){this.tasks={},this.taskQueue=[],ki(["process"],this),this.invoker=new MR(this.process),this.nextId=0}add(e,r){const a=this.nextId++,u=function({type:c,isSymbolTile:f,zoom:y}){return y=y||0,c==="message"?0:c!=="maybePrepare"||f?c!=="parseTile"||f?c==="parseTile"&&f?300-y:c==="maybePrepare"&&f?400-y:500:200-y:100-y}(r);if(u===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:r,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const c=this.tasks[this.taskQueue[u]];c.priority<r&&(r=c.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class V2{constructor(e,r,a){this.target=e,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},ki(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new IR}send(e,r,a,u,c=!1,f){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=f,this.callbacks[y]=a);const b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!a,targetMapId:u,mustQueue:c,sourceMapId:this.mapId,data:Ss(r,b)},b),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const r=e.data;if(!r)return;const a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(r.mustQueue||Ua()){const u=this.callbacks[a],c=this.scheduler.add(()=>this.processTask(a,r),u&&u.metadata||{type:"message"});c&&(this.cancelCallbacks[a]=c)}else this.processTask(a,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(r.error?a(wa(r.error)):a(null,wa(r.data)))}else{const a=new Set,u=r.hasCallback?(f,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?Ss(f):null,data:Ss(y,a)},a)}:()=>{},c=wa(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,c,u);else if(this.parent.getWorkerSource){const f=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,f[0],c.source,c.scope)[f[1]](c,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Dp={workerUrl:"",workerClass:null,workerParams:void 0};const Pv="mapboxgl_preloaded_worker_pool";class pu{constructor(){this.active={}}acquire(e,r=pu.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;)this.workers.push(Dp.workerClass!=null?new Dp.workerClass:new self.Worker(Dp.workerUrl,Dp.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Pv]}numActive(){return Object.keys(this.active).length}}pu.workerCount=2;class sd{constructor(e,r,a="Worker",u=pu.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ri();const c=this.workerPool.acquire(this.id,u);for(let f=0;f<c.length;f++){const y=new sd.Actor(c[f],r,this.id);y.name=`${a} ${f}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,a){xn(this.actors,(u,c)=>{u.send(e,r,c)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let zp,Rv;function pg(){return zp||(zp=new pu),zp}sd.Actor=V2;const Dv=new nn(0,0,0);var zv=(o=>(o[o.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",o[o.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",o[o.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",o))(zv||{}),mg=(o=>(o[o.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",o[o.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",o[o.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",o[o.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",o))(mg||{}),Lp=(o=>(o[o.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",o[o.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",o[o.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",o[o.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",o[o.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",o))(Lp||{}),U2=(o=>(o[o.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",o[o.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",o[o.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",o))(U2||{}),od=(o=>(o[o.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",o[o.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",o[o.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",o[o.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",o[o.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",o[o.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",o))(od||{}),j2=(o=>(o[o.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",o[o.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",o[o.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",o))(j2||{});function CR(o,e,r){o===1&&e.icons.push(function(a,u){return function(c){if(c.usvg_tree.height||(c.usvg_tree.height=c.usvg_tree.width),!c.metadata)return c;const{metadata:f}=c;if(f.content_area){const{content_area:y}=f;y.top==null&&(y.top=y.left),y.width==null&&(y.width=c.usvg_tree.width),y.height==null&&(y.height=y.width)}return f.stretch_x&&f.stretch_x.length&&$2(f,"x"),f.stretch_y&&f.stretch_y.length&&$2(f,"y"),c}(a.readFields(PR,{name:void 0},u))}(r,r.readVarint()+r.pos))}function $2(o,e){const r=[],a=o[`stretch_${e}`];let u=null;for(let c=0;c<a.length;c++)u===null?u=r.length===0?a[0]:r[r.length-1][1]+a[c]:(r.push([u,u+a[c]]),u=null);o[`stretch_${e}_areas`]=r}function PR(o,e,r){o===1?e.name=r.readString():o===2?e.metadata=function(a,u){return a.readFields(RR,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)}(r,r.readVarint()+r.pos):o===3&&(e.usvg_tree=function(a,u){return a.readFields(LR,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)}(r,r.readVarint()+r.pos),e.data="usvg_tree")}function RR(o,e,r){o===1?e.stretch_x=r.readPackedVarint():o===2?e.stretch_y=r.readPackedVarint():o===3?e.content_area=function(a,u){return a.readFields(DR,{left:0},u)}(r,r.readVarint()+r.pos):o===4&&e.variables.push(function(a,u){return a.readFields(zR,{name:void 0},u)}(r,r.readVarint()+r.pos))}function DR(o,e,r){o===1?e.left=r.readVarint():o===2?e.width=r.readVarint():o===3?e.top=r.readVarint():o===4&&(e.height=r.readVarint())}function zR(o,e,r){o===1?e.name=r.readString():o===2&&(e.rgb_color=yg(r.readVarint()),e.value="rgb_color")}function LR(o,e,r){o===1?e.width=e.height=r.readVarint():o===2?e.height=r.readVarint():o===3?e.children.push(_g(r,r.readVarint()+r.pos)):o===4?e.linear_gradients.push(function(a,u){return a.readFields(UR,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)}(r,r.readVarint()+r.pos)):o===5?e.radial_gradients.push(function(a,u){return a.readFields($R,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)}(r,r.readVarint()+r.pos)):o===7?e.clip_paths.push(function(a,u){return a.readFields(GR,{children:[]},u)}(r,r.readVarint()+r.pos)):o===8&&e.masks.push(function(a,u){const c=a.readFields(HR,{left:0,width:20,mask_type:1,children:[]},u);return c.height==null&&(c.height=c.width),c.top==null&&(c.top=c.left),c}(r,r.readVarint()+r.pos))}function _g(o,e){return o.readFields(OR,{},e)}function OR(o,e,r){o===1?(e.group=function(a,u){return a.readFields(kR,{opacity:255,children:[]},u)}(r,r.readVarint()+r.pos),e.node="group"):o===2&&(e.path=function(a,u){return a.readFields(BR,{paint_order:1,commands:[],step:1,diffs:[],rule:1},u)}(r,r.readVarint()+r.pos),e.node="path")}function kR(o,e,r){o===1?e.transform=gg(r,r.readVarint()+r.pos):o===2?e.opacity=r.readVarint():o===5?e.clip_path_idx=r.readVarint():o===6?e.mask_idx=r.readVarint():o===7&&e.children.push(_g(r,r.readVarint()+r.pos))}function gg(o,e){return o.readFields(FR,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function FR(o,e,r){o===1?e.sx=r.readFloat():o===2?e.ky=r.readFloat():o===3?e.kx=r.readFloat():o===4?e.sy=r.readFloat():o===5?e.tx=r.readFloat():o===6&&(e.ty=r.readFloat())}function BR(o,e,r){o===1?e.fill=function(a,u){return a.readFields(NR,{rgb_color:Dv,paint:"rgb_color",opacity:255},u)}(r,r.readVarint()+r.pos):o===2?e.stroke=function(a,u){return a.readFields(VR,{rgb_color:Dv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)}(r,r.readVarint()+r.pos):o===3?e.paint_order=r.readVarint():o===5?r.readPackedVarint(e.commands):o===6?e.step=r.readFloat():o===7?r.readPackedSVarint(e.diffs):o===8&&(e.rule=r.readVarint())}function NR(o,e,r){o===1?(e.rgb_color=yg(r.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=r.readVarint())}function yg(o){return new nn((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function VR(o,e,r){o===1?(e.rgb_color=yg(r.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):o===5?r.readPackedFloat(e.dasharray):o===6?e.dashoffset=r.readFloat():o===7?e.miterlimit=r.readFloat():o===8?e.opacity=r.readVarint():o===9?e.width=r.readFloat():o===10?e.linecap=r.readVarint():o===11&&(e.linejoin=r.readVarint())}function UR(o,e,r){o===1?e.transform=gg(r,r.readVarint()+r.pos):o===2?e.spread_method=r.readVarint():o===3?e.stops.push(G2(r,r.readVarint()+r.pos)):o===4?e.x1=r.readFloat():o===5?e.y1=r.readFloat():o===6?e.x2=r.readFloat():o===7&&(e.y2=r.readFloat())}function G2(o,e){return o.readFields(jR,{offset:0,opacity:255,rgb_color:Dv},e)}function jR(o,e,r){o===1?e.offset=r.readFloat():o===2?e.opacity=r.readVarint():o===3&&(e.rgb_color=yg(r.readVarint()))}function $R(o,e,r){o===1?e.transform=gg(r,r.readVarint()+r.pos):o===2?e.spread_method=r.readVarint():o===3?e.stops.push(G2(r,r.readVarint()+r.pos)):o===4?e.cx=r.readFloat():o===5?e.cy=r.readFloat():o===6?e.r=r.readFloat():o===7?e.fx=r.readFloat():o===8?e.fy=r.readFloat():o===9&&(e.fr=r.readFloat())}function GR(o,e,r){o===1?e.transform=gg(r,r.readVarint()+r.pos):o===2?e.clip_path_idx=r.readVarint():o===3&&e.children.push(_g(r,r.readVarint()+r.pos))}function HR(o,e,r){o===1?e.left=e.top=r.readFloat():o===2?e.width=e.height=r.readFloat():o===3?e.top=r.readFloat():o===4?e.height=r.readFloat():o===5?e.mask_type=r.readVarint():o===6?e.mask_idx=r.readVarint():o===7&&e.children.push(_g(r,r.readVarint()+r.pos))}class qR{static calculate(e={},r=[]){const a=new Map,u=new Map;if(Object.keys(e).length===0)return a;r.forEach(c=>{u.set(c.name,c.rgb_color||new nn(0,0,0))});for(const[c,f]of Object.entries(e))u.has(c)?a.set(u.get(c).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${c}"`);return a}}function ad(o,e=255,r){const a=e/255,u=o.toStringPremultipliedAlpha(),c=r.has(u)?r.get(u).clone():o.clone();return c.a*=a,c.toString()}function Op(o,e){if(!Ke()){const r=document.createElement("canvas");return r.width=o,r.height=e,r}return new OffscreenCanvas(o,e)}function WR(o,e){const r=qR.calculate(e.params,o.metadata?o.metadata.variables:[]),a=o.usvg_tree,u=a.width,c=a.height,f=e.transform?e.transform:new DOMMatrix,y=Math.max(1,Math.round(u*f.a)),b=Math.max(1,Math.round(c*f.d)),S=new DOMMatrix([y/u,0,0,b/c,0,0]),_=Op(y,b).getContext("2d");return Lv(_,S,a,a,r),_.getImageData(0,0,y,b)}function Lv(o,e,r,a,u){for(const c of a.children)H2(o,e,r,c,u)}function H2(o,e,r,a,u){a.group?(o.save(),function(c,f,y,b,S){const _=b.mask_idx!=null?y.masks[b.mask_idx]:null,w=b.clip_path_idx!=null?y.clip_paths[b.clip_path_idx]:null;if(b.transform&&(f=vg(b.transform).preMultiplySelf(f)),!function(E,C,O){return E.opacity!==255||C||O}(b,w!=null,_!=null))return void Lv(c,f,y,b,S);const M=Op(c.canvas.width,c.canvas.height),T=M.getContext("2d");Lv(T,f,y,b,S),w&&J2(T,f,y,w),_&&Q2(T,f,y,_,S),c.globalAlpha=b.opacity/255,c.drawImage(M,0,0)}(o,e,r,a.group,u),o.restore()):a.path&&(o.save(),function(c,f,y,b,S){const _=eT(b);c.setTransform(f),b.paint_order===U2.PAINT_ORDER_FILL_AND_STROKE?(q2(c,y,b,_,S),Z2(c,y,b,_,S)):(Z2(c,y,b,_,S),q2(c,y,b,_,S))}(o,e,r,a.path,u),o.restore())}function q2(o,e,r,a,u){const c=r.fill;if(!c)return;const f=c.opacity/255;switch(c.paint){case"rgb_color":o.fillStyle=ad(c.rgb_color,c.opacity,u);break;case"linear_gradient_idx":o.fillStyle=X2(o,e.linear_gradients[c.linear_gradient_idx],f,u);break;case"radial_gradient_idx":o.fillStyle=K2(o,e.radial_gradients[c.radial_gradient_idx],f,u)}o.fill(a,W2(r))}function W2(o){return o.rule===zv.PATH_RULE_NON_ZERO?"nonzero":o.rule===zv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Z2(o,e,r,a,u){const c=r.stroke;if(!c)return;o.lineWidth=c.width,o.miterLimit=c.miterlimit,o.setLineDash(c.dasharray),o.lineDashOffset=c.dashoffset;const f=c.opacity/255;switch(c.paint){case"rgb_color":o.strokeStyle=ad(c.rgb_color,c.opacity,u);break;case"linear_gradient_idx":o.strokeStyle=X2(o,e.linear_gradients[c.linear_gradient_idx],f,u);break;case"radial_gradient_idx":o.strokeStyle=K2(o,e.radial_gradients[c.radial_gradient_idx],f,u)}switch(c.linejoin){case Lp.LINE_JOIN_MITER_CLIP:case Lp.LINE_JOIN_MITER:o.lineJoin="miter";break;case Lp.LINE_JOIN_ROUND:o.lineJoin="round";break;case Lp.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(c.linecap){case mg.LINE_CAP_BUTT:o.lineCap="butt";break;case mg.LINE_CAP_ROUND:o.lineCap="round";break;case mg.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(a)}function X2(o,e,r,a){if(e.stops.length===1){const M=e.stops[0];return ad(M.rgb_color,M.opacity*r,a)}const u=vg(e.transform),{x1:c,y1:f,x2:y,y2:b}=e,S=u.transformPoint(new DOMPoint(c,f)),_=u.transformPoint(new DOMPoint(y,b)),w=o.createLinearGradient(S.x,S.y,_.x,_.y);for(const M of e.stops)w.addColorStop(M.offset,ad(M.rgb_color,M.opacity*r,a));return w}function K2(o,e,r,a){if(e.stops.length===1){const M=e.stops[0];return ad(M.rgb_color,M.opacity*r,a)}const u=vg(e.transform),{fx:c,fy:f,cx:y,cy:b}=e,S=u.transformPoint(new DOMPoint(c,f)),_=u.transformPoint(new DOMPoint(y,b)),w=o.createRadialGradient(S.x,S.y,0,_.x,_.y,e.r*((u.a+u.d)/2));for(const M of e.stops)w.addColorStop(M.offset,ad(M.rgb_color,M.opacity*r,a));return w}function Y2(o,e,r,a){const u=a.transform?vg(a.transform).preMultiplySelf(e):e,c=Op(o.canvas.width,o.canvas.height),f=c.getContext("2d");for(const b of a.children)if(b.group)Y2(f,u,r,b.group);else if(b.path){const S=b.path,_=new Path2D;_.addPath(eT(S),u),f.fill(_,W2(S))}const y=a.clip_path_idx!=null?r.clip_paths[a.clip_path_idx]:null;y&&J2(f,u,r,y),o.globalCompositeOperation="source-over",o.drawImage(c,0,0)}function J2(o,e,r,a){const u=Op(o.canvas.width,o.canvas.height);Y2(u.getContext("2d"),e,r,a),o.globalCompositeOperation="destination-in",o.drawImage(u,0,0)}function Q2(o,e,r,a,u){if(a.children.length===0)return;const c=a.mask_idx!=null?r.masks[a.mask_idx]:null;c&&Q2(o,e,r,c,u);const f=o.canvas.width,y=o.canvas.height,b=Op(f,y),S=b.getContext("2d"),_=a.width,w=a.height,M=a.left,T=a.top,E=new Path2D,C=new Path2D;C.rect(M,T,_,w),E.addPath(C,e),S.clip(E);for(const U of a.children)H2(S,e,r,U,u);const O=S.getImageData(0,0,f,y),k=O.data;if(a.mask_type===j2.MASK_TYPE_LUMINANCE)for(let U=0;U<k.length;U+=4)k[U+3]=k[U+3]/255*(.2126*k[U]+.7152*k[U+1]+.0722*k[U+2]);S.putImageData(O,0,0),o.globalCompositeOperation="destination-in",o.drawImage(b,0,0)}function vg(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function eT(o){const e=new Path2D,r=o.step;let a=o.diffs[0]*r,u=o.diffs[1]*r;e.moveTo(a,u);for(let c=0,f=2;c<o.commands.length;c++)switch(o.commands[c]){case od.PATH_COMMAND_MOVE:a+=o.diffs[f++]*r,u+=o.diffs[f++]*r,e.moveTo(a,u);break;case od.PATH_COMMAND_LINE:a+=o.diffs[f++]*r,u+=o.diffs[f++]*r,e.lineTo(a,u);break;case od.PATH_COMMAND_QUAD:{const y=a+o.diffs[f++]*r,b=u+o.diffs[f++]*r;a=y+o.diffs[f++]*r,u=b+o.diffs[f++]*r,e.quadraticCurveTo(y,b,a,u);break}case od.PATH_COMMAND_CUBIC:{const y=a+o.diffs[f++]*r,b=u+o.diffs[f++]*r,S=y+o.diffs[f++]*r,_=b+o.diffs[f++]*r;a=S+o.diffs[f++]*r,u=_+o.diffs[f++]*r,e.bezierCurveTo(y,b,S,_,a,u);break}case od.PATH_COMMAND_CLOSE:e.closePath()}return e}class xg{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}delete(e){this.cache.delete(e)}}Ft(xg,"LRUCache");class Ov{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Li(e,e.data)}getFromCache(e,r,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new xg(150)),this.cacheMap.get(a).get(Es(e.toString(),r))}setInCache(e,r,a,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new xg(150));const c=this.cacheDependenciesMap.get(u),f=Es(e.id.toString(),a);c.get(f)||c.set(f,new Set);const y=this.cacheMap.get(u),b=e.toString();c.get(f).add(b),y.put(Es(e.toString(),a),r)}removeImagesFromCacheByIds(e,r,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const u=this.cacheMap.get(a),c=this.cacheDependenciesMap.get(a);for(const f of e){const y=Es(f.toString(),r);if(c.has(y)){for(const b of c.get(y))u.delete(b);c.delete(y)}}}rasterize(e,r,a,u,c=WR){const f=this.getFromCache(e,a,u);if(f)return f.clone();const y=c(r.icon,e.options),b=Ov._getImage(y);return this.setInCache(e,b,a,u),b.clone()}}class tT{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function rT(o,e,r,a){let u=0,c=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(a[f])<1e-15){if(r[f]<o[f]||r[f]>e[f])return null}else{const y=1/a[f];let b=(o[f]-r[f])*y,S=(e[f]-r[f])*y;if(b>S){const _=b;b=S,S=_}if(b>u&&(u=b),S<c&&(c=S),u>c)return null}return u}function nT(o,e,r,a,u,c,f,y,b,S,_){const w=a-o,M=u-e,T=c-r,E=f-o,C=y-e,O=b-r,k=_[1]*O-_[2]*C,U=_[2]*E-_[0]*O,V=_[0]*C-_[1]*E,N=w*k+M*U+T*V;if(Math.abs(N)<1e-15)return null;const $=1/N,Z=S[0]-o,K=S[1]-e,ae=S[2]-r,ie=(Z*k+K*U+ae*V)*$;if(ie<0||ie>1)return null;const se=K*T-ae*M,ve=ae*w-Z*T,le=Z*M-K*w,xe=(_[0]*se+_[1]*ve+_[2]*le)*$;return xe<0||ie+xe>1?null:(E*se+C*ve+O*le)*$}function iT(o,e,r){return(o-e)/(r-e)}function sT(o,e,r,a,u,c,f,y,b){const S=1<<r,_=c-a,w=f-u,M=(o+1)/S*_+a,T=(e+0)/S*w+u,E=(e+1)/S*w+u;y[0]=(o+0)/S*_+a,y[1]=T,b[0]=M,b[1]=E}class oT{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(c){const f=Math.ceil(Math.log2(c.dim/8)),y=[];let b=Math.ceil(Math.pow(2,f));const S=1/b,_=(T,E,C,O,k)=>{const U=O?1:0,V=(T+1)*C-U,N=E*C,$=(E+1)*C-U;k[0]=T*C,k[1]=N,k[2]=V,k[3]=$};let w=new tT(b);const M=[];for(let T=0;T<b*b;T++){_(T%b,Math.floor(T/b),S,!1,M);const E=ec(M[0],M[1],c),C=ec(M[2],M[1],c),O=ec(M[2],M[3],c),k=ec(M[0],M[3],c);w.minimums.push(Math.min(E,C,O,k)),w.maximums.push(Math.max(E,C,O,k)),w.leaves.push(1)}for(y.push(w),b/=2;b>=1;b/=2){const T=y[y.length-1];w=new tT(b);for(let E=0;E<b*b;E++){_(E%b,Math.floor(E/b),2,!0,M);const C=T.getElevation(M[0],M[1]),O=T.getElevation(M[2],M[1]),k=T.getElevation(M[2],M[3]),U=T.getElevation(M[0],M[3]),V=T.isLeaf(M[0],M[1]),N=T.isLeaf(M[2],M[1]),$=T.isLeaf(M[2],M[3]),Z=T.isLeaf(M[0],M[3]),K=Math.min(C.min,O.min,k.min,U.min),ae=Math.max(C.max,O.max,k.max,U.max),ie=V&&N&&$&&Z;w.maximums.push(ae),w.minimums.push(K),w.leaves.push(ae-K<=5&&ie?1:0)}y.push(w)}return y}(this.dem),a=r.length-1,u=r[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,u,c,f,y=1){return rT([e,r,-100],[a,u,this.maximums[0]*y],c,f)}raycast(e,r,a,u,c,f,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,a,u,c,f,y);if(b==null)return null;const S=[],_=[],w=[],M=[],T=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;T.length>0;){const{idx:E,t:C,nodex:O,nodey:k,depth:U}=T.pop();if(this.leaves[E]){sT(O,k,U,e,r,a,u,w,M);const N=1<<U,$=(O+0)/N,Z=(O+1)/N,K=(k+0)/N,ae=(k+1)/N,ie=ec($,K,this.dem)*y,se=ec(Z,K,this.dem)*y,ve=ec(Z,ae,this.dem)*y,le=ec($,ae,this.dem)*y,xe=nT(w[0],w[1],ie,M[0],w[1],se,M[0],M[1],ve,c,f),Me=nT(M[0],M[1],ve,w[0],M[1],le,w[0],w[1],ie,c,f),Se=Math.min(xe!==null?xe:Number.MAX_VALUE,Me!==null?Me:Number.MAX_VALUE);if(Se!==Number.MAX_VALUE)return Se;{const Ce=te.vec3.scaleAndAdd([],c,f,C);if(aT(ie,se,le,ve,iT(Ce[0],w[0],M[0]),iT(Ce[1],w[1],M[1]))>=Ce[2])return C}continue}let V=0;for(let N=0;N<this._siblingOffset.length;N++){sT((O<<1)+this._siblingOffset[N][0],(k<<1)+this._siblingOffset[N][1],U+1,e,r,a,u,w,M),w[2]=-100,M[2]=this.maximums[this.childOffsets[E]+N]*y;const $=rT(w,M,c,f);if($!=null){const Z=$;S[N]=Z;let K=!1;for(let ae=0;ae<V&&!K;ae++)Z>=S[_[ae]]&&(_.splice(ae,0,N),K=!0);K||(_[V]=N),V++}}for(let N=0;N<V;N++){const $=_[N];T.push({idx:this.childOffsets[E]+$,t:S[$],nodex:(O<<1)+this._siblingOffset[$][0],nodey:(k<<1)+this._siblingOffset[$][1],depth:U+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,u,c){if(e[u].isLeaf(r,a)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const f=u-1,y=e[f];let b=0,S=0;for(let _=0;_<this._siblingOffset.length;_++){const w=2*r+this._siblingOffset[_][0],M=2*a+this._siblingOffset[_][1],T=y.getElevation(w,M),E=y.isLeaf(w,M),C=this._addNode(T.min,T.max,E);E&&(b|=1<<_),S||(S=C)}for(let _=0;_<this._siblingOffset.length;_++)b&1<<_||this._construct(e,2*r+this._siblingOffset[_][0],2*a+this._siblingOffset[_][1],f,S+_)}}function aT(o,e,r,a,u,c){return ar(ar(o,r,c),ar(e,a,c),u)}function ec(o,e,r){const a=r.dim,u=Ye(o*a-.5,0,a-1),c=Ye(e*a-.5,0,a-1),f=Math.floor(u),y=Math.floor(c),b=Math.min(f+1,a-1),S=Math.min(y+1,a-1);return aT(r.get(f,y),r.get(b,y),r.get(f,S),r.get(b,S),u-f,c-y)}const ZR={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function XR(o,e,r){return(256*o*256+256*e+r)/10-1e4}function KR(o,e,r){return 256*o+e+r/256-32768}class bg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Pr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const c=this.dim=r.height-2,f=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<c;b++)f[this._idx(-1,b)]=f[this._idx(0,b)],f[this._idx(c,b)]=f[this._idx(c-1,b)],f[this._idx(b,-1)]=f[this._idx(b,0)],f[this._idx(b,c)]=f[this._idx(b,c-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(c,-1)]=f[this._idx(c-1,0)],f[this._idx(-1,c)]=f[this._idx(0,c-1)],f[this._idx(c,c)]=f[this._idx(c-1,c-1)]}const y=a==="terrarium"?KR:XR;for(let b=0;b<f.length;++b){const S=4*b;this.floatView[b]=y(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=We.now()}_buildQuadTree(){this._tree=new oT(this)}get(e,r,a=!1){a&&(e=Ye(e,-1,this.dim),r=Ye(r,-1,this.dim));const u=this._idx(e,r);return this.floatView[u]}set(e,r,a){const u=this._idx(e,r),c=this.floatView[u];return this.floatView[u]=a,a-c}static getUnpackVector(e){return ZR[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const a=[0,0,0,0],u=bg.getUnpackVector(r);let c=Math.floor((e+u[3])/u[2]);return a[2]=c%256,c=Math.floor(c/256),a[1]=c%256,c=Math.floor(c/256),a[0]=c,a}getPixels(){return new gb({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,c=r*this.dim+this.dim,f=a*this.dim,y=a*this.dim+this.dim;switch(r){case-1:u=c-1;break;case 1:c=u+1}switch(a){case-1:f=y-1;break;case 1:y=f+1}const b=-r*this.dim,S=-a*this.dim;for(let _=f;_<y;_++)for(let w=u;w<c;w++){const M=4*this._idx(w,_),T=4*this._idx(w+b,_+S);this.pixels[M+0]=e.pixels[T+0],this.pixels[M+1]=e.pixels[T+1],this.pixels[M+2]=e.pixels[T+2],this.pixels[M+3]=e.pixels[T+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function YR(o,e,r){o===1?e.headerLength=r.readFixed32():o===2?e.x=r.readVarint():o===3?e.y=r.readVarint():o===4?e.z=r.readVarint():o===5&&e.layers.push(function(a,u){return a.readFields(rD,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)}(r,r.readVarint()+r.pos))}function JR(o,e,r){o===1?(e.delta_filter=function(a,u){return a.readFields(QR,{blockSize:0},u)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):o===2?(r.readVarint(),e.filter="zigzag_filter"):o===3?(r.readVarint(),e.filter="bitshuffle_filter"):o===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function QR(o,e,r){o===1&&(e.blockSize=r.readVarint())}function eD(o,e,r){o===1?(r.readVarint(),e.codec="gzip_data"):o===2?(r.readVarint(),e.codec="jpeg_image"):o===3?(r.readVarint(),e.codec="webp_image"):o===4&&(r.readVarint(),e.codec="png_image")}function tD(o,e,r){let a=0,u=0;o===1?e.firstByte=r.readFixed64():o===2?e.lastByte=r.readFixed64():o===3?e.filters.push(function(c,f){return c.readFields(JR,{},f)}(r,r.readVarint()+r.pos)):o===4?e.codec=function(c,f){return c.readFields(eD,{},f)}(r,r.readVarint()+r.pos):o===5?u=r.readFloat():o===6?a=r.readFloat():o===7?e.bands.push(r.readString()):o===8?e.offset=r.readDouble():o===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=a)}function rD(o,e,r){o===1?e.version=r.readVarint():o===2?e.name=r.readString():o===3?e.units=r.readString():o===4?e.tileSize=r.readVarint():o===5?e.buffer=r.readVarint():o===6?e.pixelFormat=r.readVarint():o===7&&e.dataIndex.push(function(a,u){return a.readFields(tD,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(r,r.readVarint()+r.pos))}function nD(o,e,r){if(o===2)(function(a,u,c){a.readFields(iD,c,u)})(r,r.readVarint()+r.pos,e);else if(o===3)throw new Error("Not implemented")}function iD(o,e,r){if(o===1){let a=0;const u=r.readVarint()+r.pos;for(;r.pos<u;)e[a++]=r.readVarint()}}function sD(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let a=2;a>=1;a--){const u=a===1?1:0,c=a===2?1:0;for(let f=0;f<e[0];f++){const y=e[1]*f;for(let b=u;b<e[1];b++){const S=e[2]*(b+y);for(let _=c;_<e[2];_++){const w=e[3]*(_+S);for(let M=0;M<e[3];M++){const T=w+M;o[T]+=o[T-r]}}}}r*=e[a]}return o}function oD(o){for(let e=0,r=o.length;e<r;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function aD(o,e){switch(e){case"uint32":return o;case"uint16":for(let r=0;r<o.length;r+=2){const a=o[r],u=o[r+1];o[r]=(240&a)>>4|(61440&a)>>8|(240&u)<<4|61440&u,o[r+1]=15&a|(3840&a)>>4|(15&u)<<8|(3840&u)<<4}return o;case"uint8":for(let r=0;r<o.length;r+=4){const a=o[r],u=o[r+1],c=o[r+2],f=o[r+3];o[r+0]=(192&a)>>6|(192&u)>>4|(192&c)>>2|192&f,o[r+1]=(48&a)>>4|(48&u)>>2|48&c|(48&f)<<2,o[r+2]=(12&a)>>2|12&u|(12&c)<<2|(12&f)<<4,o[r+3]=3&a|(3&u)<<2|(3&c)<<4|(3&f)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ft(bg,"DEMData"),Ft(oT,"DemMinMaxQuadTree",{omit:["dem"]});var ao=Uint8Array,kp=Uint16Array,lD=Int32Array,lT=new ao([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),cT=new ao([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),cD=new ao([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),uT=function(o,e){for(var r=new kp(31),a=0;a<31;++a)r[a]=e+=1<<o[a-1];var u=new lD(r[30]);for(a=1;a<30;++a)for(var c=r[a];c<r[a+1];++c)u[c]=c-r[a]<<5|a;return{b:r,r:u}},hT=uT(lT,2),dT=hT.b,uD=hT.r;dT[28]=258,uD[258]=28;for(var hD=uT(cT,0).b,fT=new kp(32768),ci=0;ci<32768;++ci){var ld=(43690&ci)>>1|(21845&ci)<<1;fT[ci]=((65280&(ld=(61680&(ld=(52428&ld)>>2|(13107&ld)<<2))>>4|(3855&ld)<<4))>>8|(255&ld)<<8)>>1}var Fp=function(o,e,r){for(var a=o.length,u=0,c=new kp(e);u<a;++u)o[u]&&++c[o[u]-1];var f,y=new kp(e);for(u=1;u<e;++u)y[u]=y[u-1]+c[u-1]<<1;f=new kp(1<<e);var b=15-e;for(u=0;u<a;++u)if(o[u])for(var S=u<<4|o[u],_=e-o[u],w=y[o[u]-1]++<<_,M=w|(1<<_)-1;w<=M;++w)f[fT[w]>>b]=S;return f},Bp=new ao(288);for(ci=0;ci<144;++ci)Bp[ci]=8;for(ci=144;ci<256;++ci)Bp[ci]=9;for(ci=256;ci<280;++ci)Bp[ci]=7;for(ci=280;ci<288;++ci)Bp[ci]=8;var pT=new ao(32);for(ci=0;ci<32;++ci)pT[ci]=5;var dD=Fp(Bp,9),fD=Fp(pT,5),kv=function(o){for(var e=o[0],r=1;r<o.length;++r)o[r]>e&&(e=o[r]);return e},ta=function(o,e,r){var a=e/8|0;return(o[a]|o[a+1]<<8)>>(7&e)&r},Fv=function(o,e){var r=e/8|0;return(o[r]|o[r+1]<<8|o[r+2]<<16)>>(7&e)},pD=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ra=function(o,e,r){var a=new Error(e||pD[o]);if(a.code=o,Error.captureStackTrace&&Error.captureStackTrace(a,ra),!r)throw a;return a},mD=new ao(0),_D=typeof TextDecoder<"u"&&new TextDecoder;try{_D.decode(mD,{stream:!0})}catch{}const gD={gzip_data:"gzip"};class Lo extends Error{constructor(e){super(e),this.name="MRTError"}}const yD={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},mT={uint32:1,uint16:2,uint8:4},vD={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Bv;class wg{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const r=this.layers[e];if(!r)throw new Lo(`Layer '${e}' not found`);return r}getHeaderLength(e){const r=new Uint8Array(e),a=new DataView(e);if(r[0]!==13)throw new Lo("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),a=this.getHeaderLength(e);if(r.length<a)throw new Lo(`Expected header with length >= ${a} but got buffer of length ${r.length}`);const u=function(c,f){return c.readFields(YR,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new Bv(r.subarray(0,a)));if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Lo(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const c of u.layers)this.layers[c.name]=new _T(c,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],a=this.getLayer(e.layerName);for(let u of e.blockIndices){const c=a.dataIndex[u],f=c.firstByte-e.firstByte,y=c.lastByte-e.firstByte;if(a._blocksInProgress.has(u))continue;const b={layerName:a.name,firstByte:f,lastByte:y,pixelFormat:a.pixelFormat,blockIndex:u,blockShape:[c.bands.length].concat(a.bandShape),buffer:a.buffer,codec:c.codec.codec,filters:c.filters.map(S=>S.filter)};a._blocksInProgress.add(u),r.push(b)}return new gT(r,()=>{r.forEach(u=>a._blocksInProgress.delete(u.blockIndex))},(u,c)=>{if(r.forEach(f=>a._blocksInProgress.delete(f.blockIndex)),u)throw u;c.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class _T{constructor({version:e,name:r,units:a,tileSize:u,pixelFormat:c,buffer:f,dataIndex:y},b){if(this.version=e,this.version!==1)throw new Lo(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=a,this.tileSize=u,this.buffer=f,this.pixelFormat=yD[c],this.dataIndex=y,this.bandShape=[u+2*f,u+2*f,mT[this.pixelFormat]],this._decodedBlocks=new xg(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return mT[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[a,u]of this.dataIndex.entries()){for(const[c,f]of u.bands.entries())if(f===e)return{bandIndex:r+c,blockIndex:a,blockBandIndex:c};r+=u.bands.length}break;case"number":for(const[a,u]of this.dataIndex.entries()){if(e>=r&&e<r+u.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-r};r+=u.bands.length}break;default:throw new Lo(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Lo(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,a=-1/0;const u=[],c=new Set;for(const f of e){const{blockIndex:y}=this.getBlockForBand(f);if(y<0)throw new Lo(`Invalid band: ${JSON.stringify(f)}`);const b=this.dataIndex[y];u.includes(y)||u.push(y),c.add(y),r=Math.min(r,b.firstByte),a=Math.max(a,b.lastByte)}if(c.size>this.cacheSize)throw new Lo(`Number of blocks to decode (${c.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:a,blockIndices:u}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:a}=this.getBlockForBand(e),u=this._decodedBlocks.get(r.toString());if(!u)throw new Lo(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const c=this.dataIndex[r],f=this.bandShape.reduce((S,_)=>S*_,1),y=a*f,b=u.subarray(y,y+f);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:c.offset,scale:c.scale}}}wg.setPbf=function(o){Bv=o};class gT{constructor(e,r,a){this.tasks=e,this._onCancel=r,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}wg.performDecoding=function(o,e){const r=new Uint8Array(o);return Promise.all(e.tasks.map(a=>{const{layerName:u,firstByte:c,lastByte:f,pixelFormat:y,blockShape:b,blockIndex:S,filters:_,codec:w}=a,M=r.subarray(c,f+1),T=new Uint32Array(b[0]*b[1]*b[2]);let E;if(w!=="gzip_data")throw new Lo(`Unhandled codec: ${w}`);return E=function(C,O){if(!globalThis.DecompressionStream&&O==="gzip_data")return Promise.resolve(((N=function(K){K[0]==31&&K[1]==139&&K[2]==8||ra(6,"invalid gzip data");var ae=K[3],ie=10;4&ae&&(ie+=2+(K[10]|K[11]<<8));for(var se=(ae>>3&1)+(ae>>4&1);se>0;se-=!K[ie++]);return ie+(2&ae)}(V=C))+8>V.length&&ra(6,"invalid gzip data"),function(K,ae,ie,se){var ve=K.length;if(!ve||ae.f&&!ae.l)return ie||new ao(0);var le=!ie,xe=le||ae.i!=2,Me=ae.i;le&&(ie=new ao(3*ve));var Se,Ce,Ie=function(rc){var nc=ie.length;if(rc>nc){var _u=new ao(Math.max(2*nc,rc));_u.set(ie),ie=_u}},Fe=ae.f||0,ze=ae.p||0,Ne=ae.b||0,st=ae.l,nt=ae.d,Bt=ae.m,ft=ae.n,St=8*ve;do{if(!st){Fe=ta(K,ze,1);var lt=ta(K,ze+1,3);if(ze+=3,!lt){var tr=K[(_r=4+((ze+7)/8|0))-4]|K[_r-3]<<8,Ot=_r+tr;if(Ot>ve){Me&&ra(0);break}xe&&Ie(Ne+tr),ie.set(K.subarray(_r,Ot),Ne),ae.b=Ne+=tr,ae.p=ze=8*Ot,ae.f=Fe;continue}if(lt==1)st=dD,nt=fD,Bt=9,ft=5;else if(lt==2){var qt=ta(K,ze,31)+257,dr=ta(K,ze+10,15)+4,Mr=qt+ta(K,ze+5,31)+1;ze+=14;for(var yr=new ao(Mr),Lr=new ao(19),Sr=0;Sr<dr;++Sr)Lr[cD[Sr]]=ta(K,ze+3*Sr,7);ze+=3*dr;var Fr=kv(Lr),Yr=(1<<Fr)-1,wn=Fp(Lr,Fr);for(Sr=0;Sr<Mr;){var _r,jr=wn[ta(K,ze,Yr)];if(ze+=15&jr,(_r=jr>>4)<16)yr[Sr++]=_r;else{var Cn=0,Bn=0;for(_r==16?(Bn=3+ta(K,ze,3),ze+=2,Cn=yr[Sr-1]):_r==17?(Bn=3+ta(K,ze,7),ze+=3):_r==18&&(Bn=11+ta(K,ze,127),ze+=7);Bn--;)yr[Sr++]=Cn}}var Wn=yr.subarray(0,qt),Xn=yr.subarray(qt);Bt=kv(Wn),ft=kv(Xn),st=Fp(Wn,Bt),nt=Fp(Xn,ft)}else ra(1);if(ze>St){Me&&ra(0);break}}xe&&Ie(Ne+131072);for(var gn=(1<<Bt)-1,gi=(1<<ft)-1,ts=ze;;ts=ze){var ii=(Cn=st[Fv(K,ze)&gn])>>4;if((ze+=15&Cn)>St){Me&&ra(0);break}if(Cn||ra(2),ii<256)ie[Ne++]=ii;else{if(ii==256){ts=ze,st=null;break}var ui=ii-254;ii>264&&(ui=ta(K,ze,(1<<(lo=lT[Sr=ii-257]))-1)+dT[Sr],ze+=lo);var ji=nt[Fv(K,ze)&gi],Ii=ji>>4;if(ji||ra(3),ze+=15&ji,Xn=hD[Ii],Ii>3){var lo=cT[Ii];Xn+=Fv(K,ze)&(1<<lo)-1,ze+=lo}if(ze>St){Me&&ra(0);break}xe&&Ie(Ne+131072);var tc=Ne+ui;if(Ne<Xn){var Oo=0-Xn,ia=Math.min(Xn,tc);for(Oo+Ne<0&&ra(3);Ne<ia;++Ne)ie[Ne]=(void 0)[Oo+Ne]}for(;Ne<tc;++Ne)ie[Ne]=ie[Ne-Xn]}}ae.l=st,ae.p=ts,ae.b=Ne,ae.f=Fe,st&&(Fe=1,ae.m=Bt,ae.d=nt,ae.n=ft)}while(!Fe);return Ne!=ie.length&&le?(Se=ie,((Ce=Ne)==null||Ce>Se.length)&&(Ce=Se.length),new ao(Se.subarray(0,Ce))):ie.subarray(0,Ne)}(V.subarray(N,-8),{i:2},new ao(((k=V)[(U=k.length)-4]|k[U-3]<<8|k[U-2]<<16|k[U-1]<<24)>>>0))));var k,U,V,N;const $=gD[O];if(!$)throw new Error(`Unhandled codec: ${O}`);const Z=new globalThis.DecompressionStream($);return new Response(new Blob([C]).stream().pipeThrough(Z)).arrayBuffer().then(K=>new Uint8Array(K))}(M,w).then(C=>(function(O,k){O.readFields(nD,k)}(new Bv(C),T),new vD[y](T.buffer))),E.then(C=>{for(let O=_.length-1;O>=0;O--)switch(_[O]){case"delta_filter":sD(C,b);break;case"zigzag_filter":oD(C);break;case"bitshuffle_filter":aD(C,y);break;default:throw new Lo(`Unhandled filter "${_[O]}"`)}return{layerName:u,blockIndex:S,data:C}}).catch(C=>{throw C})}))},Ft(gT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ft(wg,"MapboxRasterTile"),Ft(_T,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Np,Nv,na,cd,Vv,ud=null;function yT(){return Ua()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Nv||Y.DRACO_URL}function vT(){if(Ua()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(cd)return cd;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return cd=WebAssembly.validate(o)?Y.MESHOPT_SIMD_URL:Y.MESHOPT_URL,cd}const Tg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},xD={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Vp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function xT(o,e,r){const a=r.json.bufferViews.length,u=r.buffers.length;e.bufferView=a,r.json.bufferViews[a]={buffer:u,byteLength:o.byteLength},r.buffers[u]=o}const Uv="KHR_draco_mesh_compression";function bD(o,e){const r=o.extensions&&o.extensions[Uv];if(!r)return;const a=new na.Decoder,u=ST(e,r.bufferView),c=new na.Mesh;if(!a.DecodeArrayToMesh(u,u.byteLength,c))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[o.indices],y=Tg[f.componentType],b=f.count*y.BYTES_PER_ELEMENT,S=na._malloc(b);y===Uint16Array?a.GetTrianglesUInt16Array(c,b,S):a.GetTrianglesUInt32Array(c,b,S),xT(na.memory.buffer.slice(S,S+b),f,e),na._free(S);for(const _ of Object.keys(r.attributes)){const w=a.GetAttributeByUniqueId(c,r.attributes[_]),M=e.json.accessors[o.attributes[_]],T=xD[M.componentType],E=M.count*Vp[M.type]*Tg[M.componentType].BYTES_PER_ELEMENT,C=na._malloc(E);a.GetAttributeDataArrayForAllPoints(c,w,na[T],E,C),xT(na.memory.buffer.slice(C,C+E),M,e),na._free(C)}a.destroy(),c.destroy(),delete o.extensions[Uv]}const Sg="EXT_meshopt_compression";function wD(o,e){if(!o.extensions||!o.extensions[Sg])return;const r=o.extensions[Sg],a=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),u=new Uint8Array(r.count*r.byteStride);Vv.decodeGltfBuffer(u,r.count,r.byteStride,a,r.mode,r.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=u.buffer,delete o.extensions[Sg]}const bT=1179937895,wT=new TextDecoder("utf8");function TT(o,e){return new URL(o,e).href}function TD(o,e,r,a){return fetch(TT(o.uri,a)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[r]=u})}function ST(o,e){const r=o.json.bufferViews[e];return new Uint8Array(o.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function SD(o,e,r,a){if(o.uri){const u=TT(o.uri,a);return fetch(u).then(c=>c.blob()).then(c=>createImageBitmap(c)).then(c=>{e.images[r]=c})}if(o.bufferView!==void 0){const u=ST(e,o.bufferView),c=new Blob([u],{type:o.mimeType});return createImageBitmap(c).then(f=>{e.images[r]=f})}}function ET(o,e=0,r){const a={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===bT){const _=new Uint32Array(o,e);let w=2;const M=(_[w++]>>2)-3,T=_[w++]>>2;if(w++,a.json=JSON.parse(wT.decode(_.subarray(w,w+T))),w+=T,w<M){const E=_[w++];w++;const C=e+(w<<2);a.buffers[0]=o.slice(C,C+E)}}else a.json=JSON.parse(wT.decode(new Uint8Array(o,e)));const{buffers:u,images:c,meshes:f,extensionsUsed:y,bufferViews:b}=a.json;let S=Promise.resolve();if(u){const _=[];for(let w=0;w<u.length;w++){const M=u[w];M.uri?_.push(TD(M,a,w,r)):a.buffers[w]||(a.buffers[w]=null)}S=Promise.all(_)}return S.then(()=>{const _=[],w=y&&y.includes(Uv),M=y&&y.includes(Sg);if(w&&_.push(function(){if(!na)return Np??(Np=function(T){let E,C=null;function O(){E=new Uint8Array(C.buffer)}function k(){throw new Error("Unexpected Draco error.")}const U={a:{a:k,d:function(V,N,$){return E.copyWithin(V,N,N+$)},c:function(V){const N=E.length,$=Math.max(V>>>0,Math.ceil(1.2*N)),Z=Math.ceil(($-N)/65536);try{return C.grow(Z),O(),!0}catch{return!1}},b:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(T,U):T.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,U))).then(V=>{const{Rb:N,Qb:$,P:Z,T:K,X:ae,Ja:ie,La:se,Qa:ve,Va:le,Wa:xe,eb:Me,jb:Se,f:Ce,e:Ie,yb:Fe,zb:ze,Ab:Ne,Bb:st,Db:nt,Gb:Bt}=V.instance.exports;C=Ie;const ft=(()=>{let St=0,lt=0,tr=0,Ot=0;return qt=>{tr&&(N(Ot),N(St),lt+=tr,tr=St=0),St||(lt+=128,St=$(lt));const dr=qt.length+7&-8;let Mr=St;dr>=lt&&(tr=dr,Mr=Ot=$(dr));for(let yr=0;yr<qt.length;yr++)E[Mr+yr]=qt[yr];return Mr}})();return O(),Ce(),{memory:Ie,_free:N,_malloc:$,Mesh:class{constructor(){this.ptr=Z()}destroy(){K(this.ptr)}},Decoder:class{constructor(){this.ptr=ie()}destroy(){Se(this.ptr)}DecodeArrayToMesh(St,lt,tr){const Ot=ft(St),qt=se(this.ptr,Ot,lt,tr.ptr);return!!ae(qt)}GetAttributeByUniqueId(St,lt){return{ptr:ve(this.ptr,St.ptr,lt)}}GetTrianglesUInt16Array(St,lt,tr){le(this.ptr,St.ptr,lt,tr)}GetTrianglesUInt32Array(St,lt,tr){xe(this.ptr,St.ptr,lt,tr)}GetAttributeDataArrayForAllPoints(St,lt,tr,Ot,qt){Me(this.ptr,St.ptr,lt.ptr,tr,Ot,qt)}},DT_INT8:Fe(),DT_UINT8:ze(),DT_INT16:Ne(),DT_UINT16:st(),DT_UINT32:nt(),DT_FLOAT32:Bt()}})}(fetch(yT())),Np.then(T=>{na=T,Np=void 0}))}()),M&&_.push(function(){if(Vv)return;const T=function(E){let C;const O=WebAssembly.instantiateStreaming(E,{}).then(V=>{C=V.instance,C.exports.__wasm_call_ctors()}),k={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},U={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:O,supported:!0,decodeGltfBuffer(V,N,$,Z,K,ae){(function(ie,se,ve,le,xe,Me,Se){const Ce=ie.exports.sbrk,Ie=le+3&-4,Fe=Ce(Ie*xe),ze=Ce(Me.length),Ne=new Uint8Array(ie.exports.memory.buffer);Ne.set(Me,ze);const st=se(Fe,le,xe,ze,Me.length);if(st===0&&Se&&Se(Fe,Ie,xe),ve.set(Ne.subarray(Fe,Fe+le*xe)),Ce(Fe-Ce(0)),st!==0)throw new Error(`Malformed buffer data: ${st}`)})(C,C.exports[U[K]],V,N,$,Z,C.exports[k[ae]])}}}(fetch(vT()));return T.ready.then(()=>{Vv=T})}()),c)for(let T=0;T<c.length;T++)_.push(SD(c[T],a,T,r));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(w&&f)for(const{primitives:T}of f)for(const E of T)bD(E,a);if(M&&f&&b)for(const T of b)wD(T,a);return a})})}function mu(o,e){const r=o.json.bufferViews[e.bufferView],a=Tg[e.componentType];return new a(o.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==Vp[e.type]*a.BYTES_PER_ELEMENT?r.byteStride/a.BYTES_PER_ELEMENT:Vp[e.type]))}function jv(o,e,r,a){const u=Tg[e.componentType],c=function(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),f=o.json.bufferViews[e.bufferView],y=f.byteStride?f.byteStride/u.BYTES_PER_ELEMENT:Vp[e.type],b=r.float32,S=b.length/r.capacity;for(let _=0,w=0;_<e.count*y;_+=y,w+=S)for(let M=0;M<S;M++)b[w+M]=a[_+M]*c;r._trim()}function ED(o,e,r){const a=o.indices,u=o.attributes,c={};c.indexArray=new wi;const f=e.json.accessors[a],y=f.count/3;c.indexArray.reserve(y);const b=mu(e,f);for(let M=0;M<y;M++)c.indexArray.emplaceBack(b[3*M],b[3*M+1],b[3*M+2]);c.indexArray._trim(),c.vertexArray=new Co;const S=e.json.accessors[u.POSITION];c.vertexArray.reserve(S.count);const _=mu(e,S);for(let M=0;M<S.count;M++)c.vertexArray.emplaceBack(_[3*M],_[3*M+1],_[3*M+2]);if(c.vertexArray._trim(),c.aabb=new or(S.min,S.max),c.centroid=function(M,T){const E=[0,0,0],C=M.length;if(C>0){for(let O=0;O<C;O++){const k=3*M[O];E[0]+=T[k],E[1]+=T[k+1],E[2]+=T[k+2]}E[0]/=C,E[1]/=C,E[2]/=C}return E}(b,_),u.COLOR_0!==void 0){const M=e.json.accessors[u.COLOR_0],T=Vp[M.type],E=mu(e,M);c.colorArray=T===3?new Co:new il,c.colorArray.resize(M.count),jv(e,M,c.colorArray,E)}if(u.NORMAL!==void 0){c.normalArray=new Co;const M=e.json.accessors[u.NORMAL];c.normalArray.resize(M.count);const T=mu(e,M);jv(e,M,c.normalArray,T)}if(u.TEXCOORD_0!==void 0&&r.length>0){c.texcoordArray=new Ma;const M=e.json.accessors[u.TEXCOORD_0];c.texcoordArray.resize(M.count);const T=mu(e,M);jv(e,M,c.texcoordArray,T)}if(u._FEATURE_ID_RGBA4444!==void 0){const M=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(c.featureData=mu(e,M))}u._FEATURE_RGBA4444!==void 0&&(c.featureData=new Uint32Array(mu(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const w=o.material;return c.material=function(M,T){const{emissiveFactor:E=[0,0,0],alphaMode:C="OPAQUE",alphaCutoff:O=.5,normalTexture:k,occlusionTexture:U,emissiveTexture:V,doubleSided:N}=M,{baseColorFactor:$=[1,1,1,1],metallicFactor:Z=1,roughnessFactor:K=1,baseColorTexture:ae,metallicRoughnessTexture:ie}=M.pbrMetallicRoughness||{},se=U?T[U.index]:void 0;if(U&&U.extensions&&U.extensions.KHR_texture_transform&&se){const ve=U.extensions.KHR_texture_transform;se.offsetScale=[ve.offset[0],ve.offset[1],ve.scale[0],ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new nn(...$),metallicFactor:Z,roughnessFactor:K,baseColorTexture:ae?T[ae.index]:void 0,metallicRoughnessTexture:ie?T[ie.index]:void 0},doubleSided:N,emissiveFactor:E,alphaMode:C,alphaCutoff:O,normalTexture:k?T[k.index]:void 0,occlusionTexture:se,emissionTexture:V?T[V.index]:void 0,defined:M.defined===void 0}}(w!==void 0?e.json.materials[w]:{defined:!1},r),c}function AT(o,e,r){const{matrix:a,rotation:u,translation:c,scale:f,mesh:y,extras:b,children:S}=o,_={};if(_.matrix=a||te.mat4.fromRotationTranslationScale([],u||[0,0,0,1],c||[0,0,0],f||[1,1,1]),y!==void 0){_.meshes=r[y];const w=_.anchor=[0,0];for(const M of _.meshes){const{min:T,max:E}=M.aabb;w[0]+=T[0]+E[0],w[1]+=T[1]+E[1]}w[0]=Math.floor(w[0]/_.meshes.length/2),w[1]=Math.floor(w[1]/_.meshes.length/2)}if(b&&(b.id&&(_.id=b.id),b.lights&&(_.lights=function(w){if(!w.length)return[];const M=function(k){const U=atob(k),V=new Uint8Array(U.length);for(let N=0;N<U.length;N++)V[N]=U.codePointAt(N);return V}(w),T=[],E=M.length/24,C=new Uint16Array(M.buffer),O=new Float32Array(M.buffer);for(let k=0;k<E;k++){const U=C[2*k*6]/30,V=C[2*k*6+1]/30,N=C[2*k*6+10]/100,$=O[6*k+1],Z=O[6*k+2],K=O[6*k+3],ae=O[6*k+4],ie=K-$,se=ae-Z,ve=Math.hypot(ie,se);T.push({pos:[$+.5*ie,Z+.5*se,V],normal:[se/ve,-ie/ve,0],width:ve,height:U,depth:N,points:[$,Z,K,ae]})}return T}(b.lights))),S){const w=[];for(const M of S)w.push(AT(e.json.nodes[M],e,r));_.children=w}return _}function AD(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new X0(o.vertices,o.indices,8,256),[r,a]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:r,max:a}}function MD(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const a=[];for(const f of r){if(!Array.isArray(f)||f.length!==2)continue;const y=f[0],b=f[1];typeof y=="number"&&typeof b=="number"&&a.push(new Ae(y,b))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let u=0;for(let f=0;f<a.length;f++){const y=a[f],b=a[(f+1)%a.length],S=a[(f+2)%a.length];u+=(y.x-b.x)*(S.y-b.y)-(S.x-b.x)*(y.y-b.y)}u>0&&a.reverse();const c=dp(a.flatMap(f=>[f.x,f.y]),[]);return c.length===0?null:{vertices:a,indices:c}}function ID(o,e){const r=[],a=[];let u=0;const c=[];for(const f of o){u=r.length;const y=f.vertexArray.float32,b=f.indexArray.uint16;for(let S=0;S<f.vertexArray.length;S++)c[0]=y[3*S+0],c[1]=y[3*S+1],c[2]=y[3*S+2],te.vec3.transformMat4(c,c,e),r.push(new Ae(c[0],c[1]));for(let S=0;S<3*f.indexArray.length;S++)a.push(b[S]+u)}if(a.length%3!=0)return null;for(let f=0;f<a.length;f+=3){const y=r[a[f+0]],b=r[a[f+1]],S=r[a[f+2]];(y.x-b.x)*(S.y-b.y)-(S.x-b.x)*(y.y-b.y)>0&&([a[f+1],a[f+2]]=[a[f+2],a[f+1]])}return{vertices:r,indices:a}}function MT(o){const e=function(b,S){const _=[],w=WebGL2RenderingContext;if(b.json.textures)for(const M of b.json.textures){const T={magFilter:w.LINEAR,minFilter:w.NEAREST,wrapS:w.REPEAT,wrapT:w.REPEAT};M.sampler!==void 0&&Object.assign(T,b.json.samplers[M.sampler]),_.push({image:S[M.source],sampler:T,uploaded:!1})}return _}(o,o.images),r=function(b,S){const _=[];for(const w of b.json.meshes){const M=[];for(const T of w.primitives)M.push(ED(T,b,S));_.push(M)}return _}(o,e),{scenes:a,scene:u,nodes:c}=o.json,f=a?a[u||0].nodes:c,y=[];for(const b of f)y.push(AT(c[b],o,r));return function(b,S,_){const w={},M=new Set;for(let T=0;T<b.length;T++){const E=_[S[T]];if(!E.extras)continue;const C=E.extras["mapbox:footprint:version"],O=E.extras["mapbox:footprint:id"];(C||O)&&M.add(T),C==="1.0.0"&&O&&(w[O]=T)}for(let T=0;T<b.length;T++){if(M.has(T))continue;const E=b[T],C=_[S[T]];if(!C.extras)continue;let O=null;E.id in w&&(O=ID(b[w[E.id]].meshes,E.matrix)),O||(O=MD(C)),O&&(E.footprint=AD(O))}if(M.size>0){const T=Array.from(M.values()).sort((E,C)=>E-C);for(let E=T.length-1;E>=0;E--)b.splice(T[E],1)}}(y,f,o.json.nodes),y}function CD(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,r=o.aabb.min[0]-1,a=o.aabb.min[1]-1,u=du/(o.aabb.max[0]-r+2),c=du/(o.aabb.max[1]-a+2);for(let f=0;f<e.length;f+=3){const y=e[f+2],b=(e[f+0]-r)*u|0,S=(e[f+1]-a)*c|0;y>o.heightmap[S*du+b]&&(o.heightmap[S*du+b]=y)}}function PD(o,e){const r={};r.indexArray=new wi,r.indexArray.reserve(4*o.length),r.vertexArray=new Co,r.vertexArray.reserve(10*o.length),r.colorArray=new il,r.vertexArray.reserve(10*o.length);let a=0;for(const f of o){const y=Math.min(10,Math.max(4,1.3*f.height))*e,b=[-f.normal[1],f.normal[0],0],S=Math.min(.29,.1*f.width/f.depth),_=f.width-2*f.depth*e*(S+.01),w=te.vec3.scaleAndAdd([],f.pos,b,_/2),M=te.vec3.scaleAndAdd([],f.pos,b,-_/2),T=[w[0],w[1],w[2]+f.height],E=[M[0],M[1],M[2]+f.height],C=te.vec3.scaleAndAdd([],f.normal,b,S);te.vec3.scale(C,C,y);const O=te.vec3.scaleAndAdd([],f.normal,b,-S);te.vec3.scale(O,O,y),te.vec3.add(C,w,C),te.vec3.add(O,M,O),w[2]+=.1,M[2]+=.1,r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]),r.vertexArray.emplaceBack(w[0],w[1],w[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(T[0],T[1],T[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(w[0],w[1],w[2]),r.vertexArray.emplaceBack(M[0],M[1],M[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]);const k=_/y/2;r.colorArray.emplaceBack(-k-S,-1,k,.8),r.colorArray.emplaceBack(k+S,-1,k,.8),r.colorArray.emplaceBack(-k,0,k,1.3),r.colorArray.emplaceBack(k,0,k,1.3),r.colorArray.emplaceBack(k+S,-.8,k,.7),r.colorArray.emplaceBack(k+S,-.8,k,.7),r.colorArray.emplaceBack(0,0,k,1.3),r.colorArray.emplaceBack(0,0,k,1.3),r.colorArray.emplaceBack(k+S,-1.2,k,.8),r.colorArray.emplaceBack(k+S,-1.2,k,.8),r.indexArray.emplaceBack(6+a,4+a,8+a),r.indexArray.emplaceBack(7+a,9+a,5+a),r.indexArray.emplaceBack(0+a,1+a,2+a),r.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const u={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=nn.white,u.pbrMetallicRoughness=c,r.material=u,r.aabb=new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}class IT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const RD=["id","tile","layer","source","sourceLayer","state"];class hd{constructor(e,r,a,u,c){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=u,this.properties=e.properties,this.id=c}clone(){const e=new hd(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of RD)this[r]!==void 0&&(e[r]=this[r]);return e}}class CT{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new kl(Ct,16,0),this.featureIndexArray=new nu,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,a,u,c,f=0,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,c,f);const S=this.grid;for(let _=0;_<r.length;_++){const w=r[_],M=[1/0,1/0,-1/0,-1/0];for(let T=0;T<w.length;T++){const E=w[T];M[0]=Math.min(M[0],E.x),M[1]=Math.min(M[1],E.y),M[2]=Math.max(M[2],E.x),M[3]=Math.max(M[3],E.y)}y!==0&&(M[0]-=y,M[1]-=y,M[2]+=y,M[3]+=y),M[0]<Ct&&M[1]<Ct&&M[2]>=0&&M[3]>=0&&S.insert(b,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Xl.VectorTile(new H_(this.rawTileData)).layers,this.sourceLayerCoder=new IT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r){const{tilespaceGeometry:a,transform:u,tileTransform:c,pixelPosMatrix:f,availableImages:y}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const b=a.bufferedTilespaceBounds,S=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(T,E,C,O)=>we(a.bufferedTilespaceGeometry,T,E,C,O));S.sort(DD);let _=null;u.elevation&&S.length>0&&(_=id.create(u.elevation,this.tileID));const w={};let M;for(let T=0;T<S.length;T++){const E=S[T];if(E===M)continue;M=E;const C=this.featureIndexArray.get(E);let O=null;this.is3DTile?this.loadMatchingModelFeature(w,C,e,a,u):this.loadMatchingFeature(w,C,e,y,(k,U,V,N=0)=>(O||(O=L(k,this.tileID.canonical,c)),U.queryIntersectsFeature(a,k,V,O,this.z,u,f,_,N)))}return w}loadMatchingFeature(e,r,a,u,c){const{featureIndex:f,bucketIndex:y,sourceLayerIndex:b,layoutVertexArrayOffset:S}=r,_=this.bucketLayerIDs[y],w=a.layers,M=Object.keys(w);if(M.length&&!function(k,U){for(let V=0;V<k.length;V++)if(U.indexOf(k[V])>=0)return!0;return!1}(M,_))return;const T=a.sourceCache,E=this.sourceLayerCoder.decode(b),C=this.vtLayers[E].feature(f),O=this.getId(C,E);for(let k=0;k<_.length;k++){const U=_[k];if(!w[U])continue;const{styleLayer:V,targets:N}=w[U];let $={};O!==void 0&&($=T.getFeatureState(V.sourceLayer,O));const Z=!c||c(C,V,$,S);if(!Z)continue;const K=new hd(C,this.z,this.x,this.y,O);K.tile=this.tileID.canonical,K.state=$;let ae=this.serializedLayersCache.get(U);ae||(ae=V.serialize(),ae.id=U,this.serializedLayersCache.set(U,ae)),K.source=ae.source,K.sourceLayer=ae["source-layer"],K.layer=Ur({},ae),K.layer.paint=PT(ae.paint,V.paint,C,$,u),K.layer.layout=PT(ae.layout,V.layout,C,$,u);let ie=!1;for(const se of N){this.updateFeatureProperties(K,se);const{filter:ve}=se;if(ve){if(C.properties=K.properties,ve.needGeometry){const le=F(C,!0);if(!ve.filter(new bn(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!ve.filter(new bn(this.tileID.overscaledZ),C))continue}ie=!0,se.targetId&&this.addFeatureVariant(K,se)}ie&&this.appendToResult(e,U,f,K,Z)}}loadMatchingModelFeature(e,r,a,u,c){const f=this.bucketLayerIDs[0][0],y=a.layers;if(!y[f])return;const{styleLayer:b,targets:S}=y[f];if(b.type!=="model")return;const _=u.tile,w=r.featureIndex,M=_.getBucket(b);if(!(M&&M instanceof fg))return;const T=function(ae,ie,se,ve){const le=ae.getNodesInfo()[ie];if(le.hiddenByReplacement||!le.node.meshes)return;let xe=Number.MAX_VALUE;const Me=le.node,Se=se.tile,Ce=ve.calculatePosMatrix(Se.tileID.toUnwrapped(),ve.worldSize),Ie=le.evaluatedScale;let Fe=0;ve.elevation&&Me.elevation&&(Fe=Me.elevation*ve.elevation.exaggeration()),te.mat4.translate(Ce,Ce,[(Me.anchor?Me.anchor[0]:0)*(Ie[0]-1),(Me.anchor?Me.anchor[1]:0)*(Ie[1]-1),Fe]),te.mat4.scale(Ce,Ce,Ie);const ze=se.queryGeometry,Ne=ze.isPointQuery()?ze.screenBounds:ze.screenGeometry,st=function(Bt){const ft=te.mat4.multiply([],Ce,Bt.matrix);te.mat4.multiply(ft,ve.expandedFarZProjMatrix,ft);for(let St=0;St<Bt.meshes.length;++St){const lt=Bt.meshes[St];if(St===Bt.lightMeshIndex)continue;const tr=M2(Ne,ve,ft,lt.aabb);tr!=null&&(xe=Math.min(tr,xe))}if(Bt.children)for(const St of Bt.children)st(St)};if(st(Me),xe===Number.MAX_VALUE)return;const nt=new Qr(0,0);return N2(Se.tileID.canonical,nt,le.node.anchor[0],le.node.anchor[1]),{intersectionZ:xe,position:nt,feature:le.feature}}(M,w,u,c);if(!T)return;const{z:E,x:C,y:O}=_.tileID.canonical,{feature:k,intersectionZ:U,position:V}=T;let N={};k.id!==void 0&&(N=a.sourceCache.getFeatureState(b.sourceLayer,k.id));const $=new hd({},E,C,O,k.id);$.tile=this.tileID.canonical,$.state=N,$.properties=k.properties,$.geometry={type:"Point",coordinates:[V.lng,V.lat]};let Z=this.serializedLayersCache.get(f);Z||(Z=b.serialize(),Z.id=f,this.serializedLayersCache.set(f,Z)),$.source=Z.source,$.sourceLayer=Z["source-layer"],$.layer=Ur({},Z);let K=!1;for(const ae of S){this.updateFeatureProperties($,ae);const{filter:ie}=ae;if(ie){if(k.properties=$.properties,ie.needGeometry){if(!ie.filter(new bn(this.tileID.overscaledZ),k,this.tileID.canonical))continue}else if(!ie.filter(new bn(this.tileID.overscaledZ),k))continue}K=!0,ae.targetId&&this.addFeatureVariant($,ae)}K&&this.appendToResult(e,f,w,$,U)}updateFeatureProperties(e,r,a){if(r.properties){const u={};for(const c in r.properties){const f=r.properties[c].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);f!=null&&(u[c]=f)}e.properties=u}}addFeatureVariant(e,r,a){const u={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[r.targetId]=e.variants[r.targetId]||[],e.variants[r.targetId].push(u)}appendToResult(e,r,a,u,c){let f=e[r];f===void 0&&(f=e[r]=[]),f.push({featureIndex:a,feature:u,intersectionZ:c})}lookupSymbolFeatures(e,r,a,u,c){const f={};this.loadVTLayers();for(const y of e)this.loadMatchingFeature(f,{bucketIndex:r,sourceLayerIndex:a,featureIndex:y,layoutVertexArrayOffset:0},u,c);return f}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),c=this.vtFeatures[u];if(c[r])return c[r];const f=this.vtLayers[u].feature(r);return c[r]=f,f}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const c=zl(u);if(c.result!=="success"){const f=c.value.map(y=>`${y.key}: ${y.message}`).join(", ");return void Pr(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=c.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Fc),a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[u];typeof a=="boolean"&&(a=Number(a))}return a}}function PT(o,e,r,a,u){return ys(o,(c,f)=>{const y=e instanceof Nl?e.get(f):null;return y&&y.evaluate?y.evaluate(r,a,u):y})}function DD(o,e){return e-o}Ft(CT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const RT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $v{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const c=RT[15&a];if(!c)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new $v(y,f,c,e)}constructor(e,r=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=RT.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Gv(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:f,nodeSize:y}=this,b=[0,c.length-1,0],S=[];for(;b.length;){const _=b.pop()||0,w=b.pop()||0,M=b.pop()||0;if(w-M<=y){for(let O=M;O<=w;O++){const k=f[2*O],U=f[2*O+1];k>=e&&k<=a&&U>=r&&U<=u&&S.push(c[O])}continue}const T=M+w>>1,E=f[2*T],C=f[2*T+1];E>=e&&E<=a&&C>=r&&C<=u&&S.push(c[T]),(_===0?e<=E:r<=C)&&(b.push(M),b.push(T-1),b.push(1-_)),(_===0?a>=E:u>=C)&&(b.push(T+1),b.push(w),b.push(1-_))}return S}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:c,nodeSize:f}=this,y=[0,u.length-1,0],b=[],S=a*a;for(;y.length;){const _=y.pop()||0,w=y.pop()||0,M=y.pop()||0;if(w-M<=f){for(let O=M;O<=w;O++)zT(c[2*O],c[2*O+1],e,r)<=S&&b.push(u[O]);continue}const T=M+w>>1,E=c[2*T],C=c[2*T+1];zT(E,C,e,r)<=S&&b.push(u[T]),(_===0?e-a<=E:r-a<=C)&&(y.push(M),y.push(T-1),y.push(1-_)),(_===0?e+a>=E:r+a>=C)&&(y.push(T+1),y.push(w),y.push(1-_))}return b}}function Gv(o,e,r,a,u,c){if(u-a<=r)return;const f=a+u>>1;DT(o,e,f,a,u,c),Gv(o,e,r,a,f-1,1-c),Gv(o,e,r,f+1,u,1-c)}function DT(o,e,r,a,u,c){for(;u>a;){if(u-a>600){const S=u-a+1,_=r-a+1,w=Math.log(S),M=.5*Math.exp(2*w/3),T=.5*Math.sqrt(w*M*(S-M)/S)*(_-S/2<0?-1:1);DT(o,e,r,Math.max(a,Math.floor(r-_*M/S+T)),Math.min(u,Math.floor(r+(S-_)*M/S+T)),c)}const f=e[2*r+c];let y=a,b=u;for(Up(o,e,a,r),e[2*u+c]>f&&Up(o,e,a,u);y<b;){for(Up(o,e,y,b),y++,b--;e[2*y+c]<f;)y++;for(;e[2*b+c]>f;)b--}e[2*a+c]===f?Up(o,e,a,b):(b++,Up(o,e,b,u)),b<=r&&(a=b+1),r<=b&&(u=b-1)}}function Up(o,e,r,a){Hv(o,r,a),Hv(e,2*r,2*a),Hv(e,2*r+1,2*a+1)}function Hv(o,e,r){const a=o[e];o[e]=o[r],o[r]=a}function zT(o,e,r,a){const u=o-r,c=e-a;return u*u+c*c}i.$=is,i.A=So,i.B=Eo,i.C=Es,i.D=sd,i.E=_a,i.F=2,i.G=Tp,i.H=Vw,i.I=bs,i.J=class extends hg{},i.K=Za,i.L=Wu,i.M=x_,i.N=gh,i.O=Dl,i.P=Ae,i.Q=u_,i.R=pi,i.S=Ef,i.T=wv,i.U=Ch,i.V=hg,i.W=p_,i.X=zl,i.Y=$c,i.Z=qo,i._=Cl,i.a=function(o){return Y.API_CDN_URL_REGEX.test(o)},i.a$=F,i.a0=Yd,i.a1=kf,i.a2=yh,i.a3=c_,i.a4=function(o){const e=o.value;let r=[];if(!e)return r;const a=Za(e);return a!=="string"?(r=r.concat([new hg(o.key,e,`string expected, "${a}" found`)]),r):(C2(e,!0)||(r=r.concat([new hg(o.key,e,`invalid url "${e}"`)])),r)},i.a5=Ue,i.a6=Ih,i.a7=jn,i.a8=wt,i.a9=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return vs(o.expression.evaluate(e))}interpolate(o,e,r){return{x:ar(o.x,e.x,r),y:ar(o.y,e.y,r),z:ar(o.z,e.z,r),azimuthal:ar(o.azimuthal,e.azimuthal,r),polar:ar(o.polar,e.polar,r)}}},i.aA=function(o,e){const r={};for(let a=0;a<e.length;a++){const u=e[a];u in o&&(r[u]=o[u])}return r},i.aB=Ra,i.aC=so,i.aD=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,r,a){const u=this.entries[o]=this.entries[o]||{callbacks:[]};if(u.result){const[c,f]=u.result;return this.scheduler?this.scheduler.add(()=>{a(c,f)},e):a(c,f),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=r((c,f)=>{u.result=[c,f];for(const y of u.callbacks)this.scheduler?this.scheduler.add(()=>{y(c,f)},e):y(c,f);setTimeout(()=>delete this.entries[o],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(c=>c!==a),u.callbacks.length||(u.cancel(),delete this.entries[o]))}}},i.aE=function(o,e,r){const a=JSON.stringify(o.request);return o.data&&(this.deduped.entries[a]={result:[null,o.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},u=>{const c=$a(o.request,(f,y,b,S)=>{f?u(f):y&&u(null,{vectorTile:r?void 0:new Xl.VectorTile(new H_(y)),rawData:y,cacheControl:b,expires:S})});return()=>{c.cancel(),u()}},e)},i.aF=function(o){un++,un>Tr&&(o.getActor().send("enforceCacheSizeLimit",xr),un=0)},i.aG=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},i.aH=Tt,i.aI=_2,i.aJ=w2,i.aK=m2,i.aL=function(o,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<o.length;a++){const u=document.createElement("source");Hd(o[a])||(r.crossOrigin="Anonymous"),u.src=o[a],r.appendChild(u)}return{cancel:()=>{}}},i.aM=og,i.aN=function(o){return fetch(o).then(e=>e.arrayBuffer()).then(e=>ET(e,0,o))},i.aO=MT,i.aP=class{constructor(o,e,r,a){this.id=o,this.position=e!=null?new Qr(e[0],e[1]):new Qr(0,0),this.orientation=r??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new or([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(te.mat4.multiply(o.matrix,e,o.matrix),o.meshes)for(const r of o.meshes){const a=or.applyTransformFast(r.aabb,o.matrix);this.aabb.encapsulate(a)}if(o.children)for(const r of o.children)this._applyTransformations(r,o.matrix)}computeBoundsAndApplyParent(){const o=te.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,r,a,u,c,f=!1){L2(this.matrix,this,o.transform,this.position,e,r,a,u,c,f)}upload(o){if(!this.uploaded){for(const e of this.nodes)Mv(e,o);for(const e of this.nodes)dg(e);this.uploaded=!0}}destroy(){for(const o of this.nodes)Iv(o)}},i.aQ=ki,i.aR=Ep,i.aS=us,i.aT=Mi,i.aU=nl,i.aV=wi,i.aW=ri,i.aX=S_,i.aY=ig,i.aZ=function(){ls.isLoading()||ls.isLoaded()||Of()!=="deferred"||v_()},i.a_=Ff,i.aa=bn,i.ab=Ll,i.ac=s,i.ad=te,i.ae=Jt,i.af=Nl,i.ag=zi,i.ah=ar,i.ai=Ct,i.aj=Um,i.ak=Rt,i.al=nn,i.am=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return function([r,a]){const u=vs([1,r,a]);return{x:u.x,y:u.y,z:u.z}}(o.expression.evaluate(e))}interpolate(o,e,r){return{x:ar(o.x,e.x,r),y:ar(o.y,e.y,r),z:ar(o.z,e.z,r)}}},i.an=function(o,e,r=0,a=!0){const u=new Ae(r,r),c=o.sub(u),f=e.add(u),y=[c,new Ae(f.x,c.y),f,new Ae(c.x,f.y)];return a&&y.push(c.clone()),y},i.ao=function(o,e){const r=[];for(let a=0;a<o.length;a++){const u=$r(a-1,-1,o.length-1),c=$r(a+1,-1,o.length-1),f=o[a],y=o[c],b=o[u].sub(f).unit(),S=y.sub(f).unit(),_=S.angleWithSep(b.x,b.y),w=b.add(S).unit().mult(-1*e/Math.sin(_/2));r.push(f.add(w))}return r},i.ap=t2,i.aq=we,i.ar=function(o,e,r=0){return te.vec3.fromValues(((e.x-r)*o.scale-o.x)*Ct,(e.y*o.scale-o.y)*Ct,lp(e.z,e.y))},i.as=Br,i.at=mw,i.au=function(o){let e=1/0,r=1/0,a=-1/0,u=-1/0;for(const c of o)e=Math.min(e,c.x),r=Math.min(r,c.y),a=Math.max(a,c.x),u=Math.max(u,c.y);return{min:new Ae(e,r),max:new Ae(a,u)}},i.av=Is,i.aw=me,i.ax=m,i.ay=Ye,i.az=Ai,i.b=function(o){return Y.API_FONTS_REGEX.test(o)},i.b$=cg,i.b0=hd,i.b1=ja,i.b2=tv,i.b3=Z0,i.b4=L,i.b5=Io,i.b6=Vh,i.b7=mr,i.b8=$n,i.b9=dp,i.bA=Wb,i.bB=dv,i.bC=Zw,i.bD=cv,i.bE=$v,i.bF=$r,i.bG=bl,i.bH=Wi,i.bI=function(o,e,r){o[4*e+0]=r[0],o[4*e+1]=r[1],o[4*e+2]=r[2],o[4*e+3]=r[3]},i.bJ=sl,i.bK=As,i.bL=Hh,i.bM=ei,i.bN=Gh,i.bO=Qr,i.bP=o2,i.bQ=ct,i.bR=gr,i.bS=S2,i.bT=$e,i.bU=rn,i.bV=function(o,e,r,a,u,c,f,y,b){if(b.name==="globe")return rn(o,e,new $e(r,a,u),!1);const S=Ep({z:r,x:a,y:u},b);return new or([(c+S.x/S.scale)*e,e*(S.y/S.scale),f],[(c+S.x2/S.scale)*e,e*(S.y2/S.scale),y])},i.bW=function(o,e,r){let a=0;for(let u=0;u<2;++u)o[u]>0&&(a+=(o[u]-0)*(o[u]-0)),e[u]<0&&(a+=(0-e[u])*(0-e[u]));return a},i.bX=Ji,i.bY=sp,i.bZ=function(o){const e=te.mat4.identity(new Float64Array(16));te.mat4.multiply(e,o.pixelMatrix,o.globeMatrix);const r=[0,Ms,0],a=[0,Gs,0];return te.vec3.transformMat4(r,r,e),te.vec3.transformMat4(a,a,e),[r[0]>0&&r[0]<=o.width&&r[1]>0&&r[1]<=o.height&&!zo(o,new Qr(o.center.lat,90)),a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!zo(o,new Qr(o.center.lat,-90))]},i.b_=function(o,e){const{scale:r}=o.tileTransform,a=r*Ct/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return te.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},i.ba=vv,i.bb=function(o,e){const r=zi(e.zoom);if(r===0)return fi(o);const a=In(o),u=an(a),c=Is(a.getWest())*e.worldSize,f=Is(a.getEast())*e.worldSize,y=so(a.getNorth())*e.worldSize,b=so(a.getSouth())*e.worldSize,S=[c,y,0],_=[f,y,0],w=[c,b,0],M=[f,b,0],T=te.mat4.invert([],e.globeMatrix);return te.vec3.transformMat4(S,S,T),te.vec3.transformMat4(_,_,T),te.vec3.transformMat4(w,w,T),te.vec3.transformMat4(M,M,T),u[0]=Ti(u[0],w,r),u[1]=Ti(u[1],M,r),u[2]=Ti(u[2],_,r),u[3]=Ti(u[3],S,r),or.fromPoints(u)},i.bc=li,i.bd=mn,i.be=Ti,i.bf=rl,i.bg=nr,i.bh=wg,i.bi=H_,i.bj=$a,i.bk=function(o,e){const r=[];for(const a in o)a in e||r.push(a);return r},i.bl=xn,i.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bn=bt,i.bo=function(o,e){const{x:r,y:a}=o.point,u=Ko(r,a,o.worldSize/o._pixelsPerMercatorPixel,0,0);return te.mat4.multiply(u,u,Do(fi(e)))},i.bp=Yh,i.bq=Ps,i.br=G_,i.bs=function(o,e,r,a,u){const c=5*e+2;o.float32[c+0]=r,o.float32[c+1]=a,o.float32[c+2]=u},i.bt=ng,i.bu=Nw,i.bv=q,i.bw=Oi,i.bx=Ub,i.by=I2,i.bz=qb,i.c=fe,i.c$=vw,i.c0=T2,i.c1=function(o){const e=T2(o,!0);return te.mat2.invert([],[e[0],e[1],e[4],e[5]])},i.c2=on,i.c3=function(o){const{x:e,y:r}=o.point,{lng:a,lat:u}=o._center;return Ko(e,r,o.worldSize,a,u)},i.c4=jt,i.c5=Mt,i.c6=ip,i.c7=function(o){const e=Math.round((o+45+360)%360/90)%4;return Yt[e]},i.c8=45,i.c9=Jd,i.cA=tp,i.cB=class extends Ro{constructor(o){super(o),this.current=R0}set(o,e,r){if(this.fetchUniformLocation(o,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},i.cC=Gt,i.cD=function(o,e,r){const a=zi(r.zoom),u=o.style.map._antialias,c=o.terrain&&o.terrain.exaggeration()>0;return a===0&&!u&&!c},i.cE=function(o){const e=o.pixelsPerMeter,r=e/Wi(1,o.center.lat),a=te.mat4.identity(new Float64Array(16));return te.mat4.translate(a,a,[o.point.x,o.point.y,0]),te.mat4.scale(a,a,[r,r,e]),Float32Array.from(a)},i.cF=In,i.cG=function(o){const e=Ji-5;o=Ye(o,-80.051129,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Rt(o))),3);return Math.round(r*(op.length-1))},i.cH=function(o,e,r,a){const u=e.getNorth(),c=e.getSouth(),f=e.getWest(),y=e.getEast(),b=1<<o.z,S=y-f,_=u-c,w=S/al,M=-_/op[r],T=[0,w,0,M,0,0,u,f,0];if(o.z>0){const E=180/a;te.mat3.multiply(T,T,[E/S+1,0,0,0,E/_+1,0,-.5*E/w,.5*E/M,1])}return T[2]=b,T[5]=o.x,T[8]=o.y,T},i.cI=fi,i.cJ=function(o,e,r){const a=te.mat4.identity(new Float64Array(16)),u=(e/(1<<o)-.5)*Math.PI*2;return te.mat4.rotateY(a,r.globeMatrix,u),Float32Array.from(a)},i.cK=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const r=e.getSource().maxzoom,a=1<<r,u=Math.floor(o.x),c=Math.floor((o.x-u)*a),f=Math.floor(o.y*a),y=this.findDEMTileFor(new Tt(r,u,r,c,f));return!(!y||!y.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||o.y<0||o.y>1)return e;const u=a.getSource().maxzoom,c=1<<u,f=Math.floor(o.x),y=o.x-f,b=new Tt(u,f,u,Math.floor(y*c),Math.floor(o.y*c)),S=this.findDEMTileFor(b);if(!S||!S.dem)return e;const _=S.dem,w=1<<S.tileID.canonical.z,M=(y*w-S.tileID.canonical.x)*_.dim,T=(o.y*w-S.tileID.canonical.y)*_.dim,E=Math.floor(M),C=Math.floor(T);return(r?this.exaggeration():1)*ar(ar(_.get(E,C),_.get(E,C+1),T-C),ar(_.get(E+1,C),_.get(E+1,C+1),T-C),M-E)}getAtTileOffset(o,e,r){const a=1<<o.canonical.z;return this.getAtPointOrZero(new s(o.wrap+(o.canonical.x+e/Ct)/a,(o.canonical.y+r/Ct)/a))}getAtTileOffsetFunc(o,e,r,a){return u=>{const c=this.getAtTileOffset(o,u.x,u.y),f=a.upVector(o.canonical,u.x,u.y),y=a.upVectorScale(o.canonical,e,r).metersToTile;return te.vec3.scale(f,f,c*y),f}}getForTilePoints(o,e,r,a){if(this.isUsingMockSource())return!1;const u=id.create(this,o,a);return!!u&&(e.forEach(c=>{c[2]=this.exaggeration()*u.getElevationAt(c[0],c[1],r)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,u=1<<o.canonical.z-a.canonical.z;let c=o.canonical.x/u-a.canonical.x,f=o.canonical.y/u-a.canonical.y,y=0;for(let b=0;b<o.canonical.z-a.canonical.z&&!r.leaves[y];b++){c*=2,f*=2;const S=2*Math.floor(f)+Math.floor(c);y=r.childOffsets[y]+S,c%=1,f%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,r=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const u of o){const c=this.getMinMaxForTile(u.tileID);c&&(r=Math.min(r,c.min),a=Math.max(a,c.max),e=!0)}return e?{min:r,max:a}:null}},i.cL=gb,i.cM=en,i.cN=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},i.cO=Hs,i.cP=Xe,i.cQ=Pc,i.cR=256,i.cS=function(o,e){const r=[0,0,0],a=li(fi(e.canonical));return te.vec3.transformMat4(r,r,a),te.vec3.transformMat4(r,r,o),r},i.cT=o=>({u_camera_to_center_distance:new ei(o),u_extrude_scale:new rp(o),u_device_pixel_ratio:new ei(o),u_matrix:new sl(o),u_inv_rot_matrix:new sl(o),u_merc_center:new As(o),u_tile_id:new Hh(o),u_zoom_transition:new ei(o),u_up_dir:new Hh(o),u_emissive_strength:new ei(o)}),i.cU=o=>({u_matrix:new sl(o),u_pixels_to_tile_units:new rp(o),u_device_pixel_ratio:new ei(o),u_width_scale:new ei(o),u_floor_width_scale:new ei(o),u_units_to_pixels:new As(o),u_dash_image:new Gh(o),u_gradient_image:new Gh(o),u_image_height:new ei(o),u_texsize:new As(o),u_tile_units_to_pixels:new ei(o),u_alpha_discard_threshold:new ei(o),u_trim_offset:new As(o),u_trim_fade_range:new As(o),u_trim_color:new qh(o),u_emissive_strength:new ei(o),u_zbias_factor:new ei(o),u_tile_to_meter:new ei(o)}),i.cV=o=>({u_matrix:new sl(o),u_texsize:new As(o),u_pixels_to_tile_units:new rp(o),u_device_pixel_ratio:new ei(o),u_width_scale:new ei(o),u_floor_width_scale:new ei(o),u_image:new Gh(o),u_units_to_pixels:new As(o),u_tile_units_to_pixels:new ei(o),u_alpha_discard_threshold:new ei(o),u_trim_offset:new As(o),u_trim_fade_range:new As(o),u_trim_color:new qh(o),u_emissive_strength:new ei(o),u_zbias_factor:new ei(o),u_tile_to_meter:new ei(o)}),i.cW=qf,i.cX=LP,i.cY=OP,i.cZ=Zh,i.c_=(o,e,r,a,u,c)=>{const f=o.transform,y=f.projection.name==="globe";let b;if(c.paint.get("circle-pitch-alignment")==="map")if(y){const _=Hs(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;b=Float32Array.from([_,0,0,_])}else b=f.calculatePixelsToTileUnitsMatrix(r);else b=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(f.projection),u_matrix:o.translatePosMatrix(e.projMatrix,r,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:We.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:ou,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(y){S.u_inv_rot_matrix=a,S.u_merc_center=u,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=zi(f.zoom);const _=u[0]*Ct,w=u[1]*Ct;S.u_up_dir=f.projection.upVector(new $e(0,0,0),_,w)}return S},i.ca=su,i.cb=qh,i.cc=function(o,e,r){const a=Math.sqrt(o*o+e*e+r*r),u=a>0?Math.acos(r/a)*zt:0;let c=o!==0||e!==0?Math.atan2(-e,-o)*zt+90:0;return c<0&&(c+=360),[a,c,u]},i.cd=t,i.ce=or,i.cf=vs,i.cg=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},i.ch=function(o,e){return o.readFields(CR,{icons:[]},e)},i.ci=function(o){return o({pluginStatus:as,pluginURL:no}),Eh.on("pluginStateChange",o),o},i.cj=pg,i.ck=ed,i.cl=uv,i.cm=pa,i.cn=Lf,i.co=Nt,i.cp=Qs,i.cq=Jn,i.cr=function(o){const e=o.indexOf(Dh);return e>=0?o.slice(0,e):o},i.cs=function(o){return o.indexOf(Dh)>=0},i.ct=function(o){const e=o.indexOf(Dh);return e>=0?o.slice(e+1):""},i.cu=function(o){const e=[],r=o.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},i.cv=function(o,e,r,a){return o.type==="custom"?new mR(o,e):new AR[o.type](o,e,r,a)},i.cw=bo,i.cx=class extends hd{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},i.cy=Eh,i.cz=xs,i.d=function(o){return Y.API_TILEJSON_REGEX.test(o)},i.d$=IT,i.d0=Ei,i.d1=(o,e,r,a,u,c,f,y)=>{const b=o.transform,S=b.pitch<15?_w(.07,.7,Ye((14-b.zoom)/5,0,1)):.07,_=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:yw(o,e,r,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:c,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:gw(e,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(_?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:S,u_tile_to_meter:t(e.tileID.canonical,0)}},i.d2=(o,e,r,a,u,c,f,y,b)=>{const S=o.transform,_=S.calculatePixelsToTileUnitsMatrix(e),w=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",M=S.pitch<15?_w(.07,.7,Ye((14-S.zoom)/5,0,1)):.07;return{u_matrix:yw(o,e,r,a),u_pixels_to_tile_units:_,u_device_pixel_ratio:c,u_width_scale:f,u_floor_width_scale:y,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:xw(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:gw(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(w?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:t(e.tileID.canonical,0)}},i.d3=Ki,i.d4=hp,i.d5=lp,i.d6=ow,i.d7=Lt,i.d8=$_,i.d9=Kl,i.dA=V_,i.dB=Cr,i.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.dD=cr,i.dE=d,i.dF=Pa,i.dG=function([o,e,r]){const a=Math.hypot(o,e,r),u=Math.atan2(o,r),c=.5*Math.PI-Math.acos(-e/a);return new Qr(jt(u),jt(c))},i.dH=Sv,i.dI=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!function(r){if(Cc==null){const a=r.navigator?r.navigator.userAgent:null;Cc=!!r.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Cc}(o)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dJ=function(o,e){xr=o,Tr=e},i.dK=zo,i.dL=Cs,i.dM=function(o){const e=[0,0,0],r=te.mat4.identity(new Float64Array(16));return te.mat4.multiply(r,o.pixelMatrix,o.globeMatrix),te.vec3.transformMat4(e,e,r),new Ae(e[0],e[1])},i.dN=function(o,e,r=!1){if(as===Mo||as===Df||as===zf)throw new Error("setRTLTextPlugin cannot be called multiple times.");no=We.resolveURL(o),as=Mo,Sh=e,Fl(),r||v_()},i.dO=Of,i.dP=function(){pg().acquire(Pv)},i.dQ=function(){const o=zp;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(Pv),zp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dR=pu,i.dS=function(o){const e=Un();if(!e)return;const r=e.delete(Ut);o&&r.catch(o).then(()=>o())},i.dT=Dp,i.dU=yT,i.dV=function(o){Nv=We.resolveURL(o),ud||(ud=new sd(pg(),new _a)),ud.broadcast("setDracoUrl",Nv)},i.dW=vT,i.dX=function(o){cd=We.resolveURL(o),ud||(ud=new sd(pg(),new _a)),ud.broadcast("setMeshoptUrl",cd)},i.dY=Ft,i.dZ=Zl,i.d_=ea,i.da=450,i.db=7,i.dc=pR,i.dd=Jr,i.de=Jf,i.df=256,i.dg=Do,i.dh=Co,i.di=Aa,i.dj=Zf,i.dk=function(o,e,r,a,u){return Ye((o-e)/(r-e)*(u-a)+a,a,u)},i.dl=a_,i.dm=Wl,i.dn=class{constructor(o,e,r,a){this.context=o,this.format=a,this.size=r,this.texture=o.gl.createTexture();const[u,c,f]=this.size,{gl:y}=o;y.bindTexture(y.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),y.texImage3D(y.TEXTURE_3D,0,this.format,u,c,f,0,xv(this.format),bv(this.format),e.data)}bind(o,e){const{context:r}=this,{gl:a}=r;a.bindTexture(a.TEXTURE_3D,this.texture),o!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,o),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},i.dp=Ev,i.dq=[1,1,1],i.dr=id,i.ds=nd,i.dt=Ea,i.du=Ma,i.dv=ql,i.dw=Kf,i.dx=Xf,i.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ae(1/0,1/0),max:new Ae(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const r=$b(new Ae(0,0),new Ae(Ct,Ct),o),a=[];if(e&&!K0(r,this._globalClipBounds))return a;for(const u of this._activeRegions){if(u.hiddenByOverlap||!K0(r,u))continue;const c=aP(u.min,u.max,o);a.push({min:c.min,max:c.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return a}setSources(o){this._setSources(o.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const a of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(a).buckets[e.layer];u&&u.updateFootprints(a.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const r=o.getOrder(),a=o.getClipMask(),u=o.getClipScope();for(const c of e){if(!c.footprint)continue;const f=$b(c.footprint.min,c.footprint.max,c.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:c.id,footprint:c.footprint,order:r,clipMask:a,clipScope:u})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||U_(e.min,r.min)||U_(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(a,u){const c=(f,y)=>f+y;return a.length-u.length||a.reduce(c,"").localeCompare(u.reduce(c,""))}(e.clipScope,r.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const r=this._activeRegions[e],a=this._prevRegions[e];o=r.priority!==a.priority||!jb(r,a)||r.order!==a.order||r.clipMask!==a.clipMask||!bt(r.clipScope,a.clipScope),++e}}if(o){++this._updateTime;for(const r of this._activeRegions)r.order!==V_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const e=r=>{const a=this._activeRegions;if(r>=a.length)return r;const u=a[r].priority;for(;r<a.length&&a[r].priority===u;)++r;return r};if(this._sourceIds.length>1){let r=0,a=e(r);for(;r!==a;){let u=r;const c=r;for(;u!==a;){const f=this._activeRegions[u];f.hiddenByOverlap=!1;for(let y=0;y<c;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&f.order===V_&&K0(f,b)&&(f.hiddenByOverlap=Hb(f.footprint,f.tileId,b.footprint,b.tileId),f.hiddenByOverlap))break}++u}r=a,a=e(r)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},i.dz=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const r=new Io,a=new wi,u=[],c=o+1+2,f=e[0]+1,y=e[0]+1+(1+e.length),b=(S,_,w)=>{let M=S===c-1?S-2:S===0?S:S-1;return M+=w?24575:0,[M,_]};for(let S=0;S<c;++S)r.emplaceBack(...b(S,0,!0));for(let S=0;S<f;++S)for(let _=0;_<c;++_)r.emplaceBack(...b(_,S,(_===0||_===c-1)&&!0));for(let S=0;S<e.length;++S){const _=e[S];for(let w=0;w<c;++w)r.emplaceBack(...b(w,_,!0))}for(let S=0;S<e.length;++S){const _=a.length,w=e[S]+1+2,M=new wi;for(let C=0;C<w-1;C++){const O=C===w-2,k=O?c*(y-e.length+S-C):c;for(let U=0;U<c-1;U++){const V=C*c+U;C===0||O||U===0||U===c-2?(M.emplaceBack(V+1,V,V+k),M.emplaceBack(V+k,V+k+1,V+1)):(a.emplaceBack(V+1,V,V+k),a.emplaceBack(V+k,V+k+1,V+1))}}const T=$n.simpleSegment(0,_,r.length,a.length-_);for(let C=0;C<M.uint16.length;C+=3)a.emplaceBack(M.uint16[C],M.uint16[C+1],M.uint16[C+2]);const E=$n.simpleSegment(0,_,r.length,a.length-_);u.push({withoutSkirts:T,withSkirts:E})}return{vertices:r,indices:a,segments:u}}_createGrid(o){const e=this._fillGridMeshWithLods(al,op);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,mr.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new wi;for(let f=0;f<=al;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const r=new Aa,a=new Aa,u=new Aa,c=new Aa;this._poleSegments=[];for(let f=0,y=0;f<ip;f++){const b=360/(1<<f);r.emplaceBack(0,-Ai,0,.5,0),a.emplaceBack(0,-Ai,0,.5,1),u.emplaceBack(0,-Ai,0,.5,.5),c.emplaceBack(0,-Ai,0,.5,.5);for(let S=0;S<=al;S++){let _=S/al,w=0;const M=ar(0,b,_),[T,E,C]=Hl(Yo,up,M,Ai);r.emplaceBack(T,E,C,_,w),a.emplaceBack(T,E,C,_,1-w);const O=Rt(M);_=.5+.5*Math.sin(O),w=.5+.5*Math.cos(O),u.emplaceBack(T,E,C,_,w),c.emplaceBack(T,E,C,_,1-w)}this._poleSegments.push($n.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(r,pr,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(a,pr,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(u,pr,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(c,pr,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},i.e=Y,i.e0=CT,i.e1=dw,i.e2=lu,i.e3="hd_road_elevation",i.e4=class{static parseFrom(o,e){const r=ll.parse(o);if(!r)return[];let{vertices:a,features:u}=r;const c=1/t(e);u.sort((S,_)=>S.id-_.id),a.sort((S,_)=>S.id-_.id||S.idx-_.idx),a=a.filter((S,_,w)=>_===w.findIndex(M=>M.id===S.id&&M.idx===S.idx));const f=new Array;let y=0;const b=a.length;for(const S of u){if(S.constantHeight){f.push(new q0(S.id,S.bounds,S.constantHeight));continue}for(;y!==b&&a[y].id<S.id;)y++;if(y===b||a[y].id!==S.id)continue;const _=new Array,w=new Array,M=y;for(;y!==b&&a[y].id===S.id;){const T=a[y];if(_.push({position:T.position,height:T.height,extent:T.extent}),y!==M&&a[y-1].idx===T.idx-1){const E=y-M;w.push({a:E-1,b:E})}y++}f.push(new q0(S.id,S.bounds,void 0,_,w,c))}return f}},i.e5=ys,i.e6=cu,i.e7=Uw,i.e8=Qh,i.e9=function(o,e,r,a,u,c,f,y=1,b){o.createArrays(),o.tilePixelRatio=Ct/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const S=o.layers[0].layout,_=o.layers[0]._unevaluatedLayout._values,w={};w.scaleFactor=y,w.textSizeScaleRange=S.get("text-size-scale-range"),w.iconSizeScaleRange=S.get("icon-size-scale-range");const[M,T]=w.textSizeScaleRange,[E,C]=w.iconSizeScaleRange;w.textScaleFactor=Ye(w.scaleFactor,M,T),w.iconScaleFactor=Ye(w.scaleFactor,E,C);const O=_["text-size"],k=_["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:K,maxZoom:ae}=o.textSizeData;w.compositeTextSizes=[O.possiblyEvaluate(new bn(K),c),O.possiblyEvaluate(new bn(ae),c)]}if(o.iconSizeData.kind==="composite"){const{minZoom:K,maxZoom:ae}=o.iconSizeData;w.compositeIconSizes=[k.possiblyEvaluate(new bn(K),c),k.possiblyEvaluate(new bn(ae),c)]}w.layoutTextSize=O.possiblyEvaluate(new bn(f+1),c),w.layoutIconSize=k.possiblyEvaluate(new bn(f+1),c),w.textMaxSize=O.possiblyEvaluate(new bn(18),c);const U=S.get("symbol-placement"),V=S.get("text-rotation-alignment")==="map"&&U!=="point",N=S.get("text-size");let $=!1;const Z=[];for(const K of o.features){const ae=S.get("text-font").evaluate(K,{},c).join(","),ie=N.evaluate(K,{},c)*w.textScaleFactor,se=w.layoutTextSize.evaluate(K,{},c)*w.textScaleFactor,ve=w.layoutIconSize.evaluate(K,{},c)*w.iconScaleFactor,le={horizontal:{},vertical:void 0},xe=K.text;let Me,Se=[0,0];if(xe){const lt=xe.toString(),tr=S.get("text-letter-spacing").evaluate(K,{},c)*Oi,Ot=S.get("text-line-height").evaluate(K,{},c)*Oi,qt=__(lt)?tr:0,dr=S.get("text-anchor").evaluate(K,{},c),Mr=S.get("text-variable-anchor");if(!Mr){const Yr=S.get("text-radial-offset").evaluate(K,{},c);Se=Yr?Zw(dr,[Yr*Oi,hv]):S.get("text-offset").evaluate(K,{},c).map(wn=>wn*Oi)}let yr=V?"center":S.get("text-justify").evaluate(K,{},c);const Lr=U==="point",Sr=Lr?S.get("text-max-width").evaluate(K,{},c)*Oi:1/0,Fr=Yr=>{o.allowVerticalPlacement&&Cf(lt)&&(le.vertical=lv(xe,e,r,u,ae,Sr,Ot,dr,Yr,qt,Se,Ps.vertical,!0,se,ie,b))};if(!V&&Mr){const Yr=yr==="auto"?Mr.map(_r=>dv(_r)):[yr];let wn=!1;for(let _r=0;_r<Yr.length;_r++){const jr=Yr[_r];if(!le.horizontal[jr])if(wn)le.horizontal[jr]=le.horizontal[0];else{const Cn=lv(xe,e,r,u,ae,Sr,Ot,"center",jr,qt,Se,Ps.horizontal,!1,se,ie,b);Cn&&(le.horizontal[jr]=Cn,wn=Cn.positionedLines.length===1)}}Fr("left")}else{if(yr==="auto"&&(yr=dv(dr)),Lr||S.get("text-writing-mode").indexOf("horizontal")>=0||!Cf(lt)){const Yr=lv(xe,e,r,u,ae,Sr,Ot,dr,yr,qt,Se,Ps.horizontal,!1,se,ie,b);Yr&&(le.horizontal[yr]=Yr)}Fr(Lr?"left":yr)}}let Ce,Ie,Fe,ze,Ne,st=!1;if(K.icon&&K.icon.hasPrimary()){const lt=Kw(K.icon,o.iconSizeData,_["icon-size"],c,o.zoom,K,b,w.iconScaleFactor);Ce=lt.iconPrimary,Ie=lt.iconSecondary;const tr=Ce.toString(),Ot=a.get(tr);Ot&&(Fe=S.get("icon-offset").evaluate(K,{},c),ze=S.get("icon-anchor").evaluate(K,{},c),Ne=S.get("icon-text-fit").evaluate(K,{},c),Me=qP(u.get(tr),Ie?u.get(Ie.toString()):void 0,Fe,ze),st=Ot.sdf,o.sdfIcons===void 0?o.sdfIcons=Ot.sdf:o.sdfIcons!==Ot.sdf&&Pr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ot.pixelRatio!==o.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}$=$||!(!K.icon||!K.icon.hasSecondary());const nt=fv(le.horizontal)||le.vertical;o.iconsInText||(o.iconsInText=!!nt&&nt.iconsInText);const Bt=se*w.textScaleFactor/Oi,{defaultShapedIcon:ft,verticallyShapedIcon:St}=eR(o,Me,S,K,c,le,Bt,Fe,Ne);Me=ft,Z.push({feature:K,shapedTextOrientations:le,shapedText:nt,shapedIcon:Me,iconPrimary:Ce,iconSecondary:Ie,iconOffset:Fe,iconAnchor:ze,verticallyShapedIcon:St,layoutTextSize:se,layoutIconSize:ve,textOffset:Se,isSDFIcon:st,iconTextFit:Ne})}return{featureData:Z,sizes:w,hasAnySecondaryIcon:$,textAlongLine:V,symbolPlacement:U}},i.ea=jw,i.eb=function(o,e,r,a,u,c,f,y,b,S){const{featureData:_,hasAnySecondaryIcon:w,sizes:M,textAlongLine:T,symbolPlacement:E}=e;for(const C of _){const{shapedIcon:O,verticallyShapedIcon:k,feature:U,shapedTextOrientations:V,shapedText:N,layoutTextSize:$,textOffset:Z,isSDFIcon:K,iconPrimary:ae,iconSecondary:ie,iconTextFit:se,iconOffset:ve}=C;Yw(O,S.iconPositions,ae,ie),Yw(k,S.iconPositions,ae,ie),QP(V,S.iconPositions),(N||O)&&tR(o,U,V,O,k,b,M,$,0,Z,K,a,u,f,y,w,se,ve,T,E)}r&&o.generateCollisionDebugBuffers(c,o.collisionBoxArray,M.textScaleFactor)},i.ec=Xl,i.ed=bg,i.ee=Ve,i.ef=Cb,i.eg=Mw,i.eh=G,i.ei=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==bT){const r=new Uint32Array(o,0,7),[,,a,u,c,f]=r;e=r.byteLength+u+c+f+c,(a!==o.byteLength||e>=o.byteLength)&&Pr("Invalid b3dm header information.")}return ET(o,e)},i.ej=function(o,e){const r=MT(o);for(const a of r){for(const u of a.meshes)CD(u);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(PD(a.lights,e)))}return r},i.ek=fg,i.el=V2,i.em=ls,i.en=function(o){Or(),Ar!=null&&Ar.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-o;a++)e.delete(r[a])})})},i.f=function(o){return o.indexOf("mapbox:")===0},i.g=function(o,e){return xs(Ur(o,{method:"GET"}),e)},i.h=re,i.i=function(o){return Y.API_STYLE_REGEX.test(o)&&!fe(o)},i.j=function(o){return decodeURIComponent(atob(o).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},i.l=Ur,i.m=ln,i.n=function(o,e){return xs(Ur(o,{type:"json"}),e)},i.o=Wd,i.p=function(o,e){return xs(Ur(o,{method:"POST"}),e)},i.q=We,i.r=Li,i.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=Ke,i.u=function(){return function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()},i.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},i.w=Pr,i.x=function(){return Rv||(Rv=new pu),Rv},i.y=Ov,i.z=qu}),R(["./shared"],function(i){function G(Xe){const Y=Xe?Xe.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function W(Xe){if(typeof Xe=="number"||typeof Xe=="boolean"||typeof Xe=="string"||Xe==null)return JSON.stringify(Xe);if(Array.isArray(Xe)){let re="[";for(const fe of Xe)re+=`${W(fe)},`;return`${re}]`}let Y="{";for(const re of Object.keys(Xe).sort())Y+=`${re}:${W(Xe[re])},`;return`${Y}}`}function H(Xe){let Y="";for(const re of i.bm)(Xe.type!=="model"||re!=="minzoom"&&re!=="maxzoom")&&(Y+=`/${W(Xe[re])}`);return Y}class ee{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,re){this._layerConfigs={},this._layers={},this.update(Y,[],re)}update(Y,re,fe){this._options=fe;for(const be of Y)this._layerConfigs[be.id]=be,(this._layers[be.id]=i.cv(be,this.scope,null,this._options)).compileFilter(fe),this.keyCache[be.id]&&delete this.keyCache[be.id];for(const be of re)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};const Te=function(be,Pe){const Ge={};for(let qe=0;qe<be.length;qe++){const Ke=be[qe];let We=Pe&&Pe[Ke.id];!We&&(We=H(Ke),Ke.type==="line"&&Ke.paint)&&function Nt(Ut){return typeof Ut=="string"&&Ut==="line-progress"||(Array.isArray(Ut)?Ut.some(Nt):!(!Ut||typeof Ut!="object")&&Object.values(Ut).some(Nt))}(Ke.paint["line-width"])&&(We+=`/${W(Ke.paint["line-width"])}`),Pe&&(Pe[Ke.id]=We);let mt=Ge[We];mt||(mt=Ge[We]=[]),mt.push(Ke)}const Re=[];for(const qe in Ge)Re.push(Ge[qe]);return Re}(Object.values(this._layerConfigs),this.keyCache);for(const be of Te){const Pe=be.map(mt=>this._layers[mt.id]),Ge=Pe[0];if(Ge.visibility==="none")continue;const Re=Ge.source||"";let qe=this.familiesBySource[Re];qe||(qe=this.familiesBySource[Re]={});const Ke=Ge.sourceLayer||"_geojsonTileLayer";let We=qe[Ke];We||(We=qe[Ke]=[]),We.push(Pe)}}}const ne=1*i.d_;class de{constructor(Y){const re={},fe=[];for(const Ge in Y){const Re=Y[Ge],qe=re[Ge]={};for(const Ke in Re.glyphs){const We=Re.glyphs[+Ke];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const mt=We.metrics.localGlyph?ne:1,Nt={x:0,y:0,w:We.bitmap.width+2*mt,h:We.bitmap.height+2*mt};fe.push(Nt),qe[Ke]=Nt}}const{w:Te,h:be}=i.H(fe),Pe=new i.dZ({width:Te||1,height:be||1});for(const Ge in Y){const Re=Y[Ge];for(const qe in Re.glyphs){const Ke=Re.glyphs[+qe];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const We=re[Ge][qe],mt=Ke.metrics.localGlyph?ne:1;i.dZ.copy(Ke.bitmap,Pe,{x:0,y:0},{x:We.x+mt,y:We.y+mt},Ke.bitmap)}}this.image=Pe,this.positions=re}}i.dY(de,"GlyphAtlas");class he{constructor(Y){this.tileID=new i.aH(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=i.aR(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor}parse(Y,re,fe,Te,be){this.status="parsing",this.data=Y,this.collisionBoxArray=new i.aX;const Pe=new i.d$(Object.keys(Y.layers).sort()),Ge=new i.e0(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const Re={},qe=new i.e1(256,256),Ke={featureIndex:Ge,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:qe,availableImages:fe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},We=re.familiesBySource[this.source];for(const Or in We){const un=Y.layers[Or];if(!un)continue;let ln=!1,cn=!1,Qn=!1;for(const Bi of We[Or])Bi[0].type==="symbol"?ln=!0:cn=!0,Bi[0].is3D()&&Bi[0].type!=="model"&&(Qn=!0);if(this.extraShadowCaster&&!Qn||this.isSymbolTile===!0&&!ln||this.isSymbolTile===!1&&!cn)continue;un.version===1&&i.w(`Vector tile source "${this.source}" layer "${Or}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bi=Pe.encode(Or),Si=[];let Bo=!1;for(let Bi=0,pi=0;Bi<un.length;Bi++){const Ni=un.feature(Bi),pa=Ge.getId(Ni,Or);if(this.localizableLayerIds&&this.localizableLayerIds.has(Or)){const xs=Ni.properties?Ni.properties.worldview:null;if(this.worldview&&typeof xs=="string")if(xs==="all")Ni.properties.$localized=!0;else{if(!xs.split(",").includes(this.worldview))continue;Ni.properties.$localized=!0,Ni.properties.worldview=this.worldview}}!Bo&&Ni.properties&&Ni.properties.hasOwnProperty(i.e2)&&(Bo=!0),Si.push({feature:Ni,id:pa,index:pi,sourceLayerIndex:bi}),pi++}Bo&&!Ke.elevationFeatures&&Y.layers.hasOwnProperty(i.e3)&&(Ke.elevationFeatures=i.e4.parseFrom(Y.layers[i.e3],this.canonical));for(const Bi of We[Or]){const pi=Bi[0];(!this.extraShadowCaster||pi.is3D()&&pi.type!=="model")&&(this.isSymbolTile!==void 0&&pi.type==="symbol"!==this.isSymbolTile||pi.minzoom&&this.zoom<Math.floor(pi.minzoom)||pi.maxzoom&&this.zoom>=pi.maxzoom||pi.visibility!=="none"&&(ye(Bi,this.zoom,Ke.brightness,fe),(Re[pi.id]=pi.createBucket({index:Ge.bucketLayerIDs.length,layers:Bi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Si,Ke,this.tileID.canonical,this.tileTransform),Ge.bucketLayerIDs.push(Bi.map(Ni=>i.C(Ni.id,Ni.scope)))))}}let mt,Nt,Ut,xr,Tr,Er;qe.trim();const Ar={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Sn=()=>{if(mt)return this.status="done",be(mt);if(this.extraShadowCaster)this.status="done",be(null,{buckets:Object.values(Re).filter(Or=>!Or.isEmpty()),featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ke.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Nt&&Ut&&xr){const Or=new de(Nt),un=new Map;for(const[Qn,bi]of Ut.entries()){const{imagePosition:Si}=i.e7(Qn,bi,i.e8);un.set(Qn,Si)}const ln={};for(const Qn in Re){const bi=Re[Qn];bi instanceof i.aY&&(ye(bi.layers,this.zoom,Ke.brightness,fe),ln[Qn]=i.e9(bi,Nt,Or.positions,Ut,un,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const cn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Te,Ut,Tr,()=>{cn.iconsPending=!1,Un(ln,Or,cn)}),this.rasterizeIfNeeded(Te,xr,Er,()=>{cn.patternsPending=!1,Un(ln,Or,cn)})}},Un=(Or,un,ln,cn)=>{if(ln.iconsPending||ln.patternsPending)return;const Qn=new i.ea(Ut,xr,this.lut);for(const bi in Re){const Si=Re[bi];if(bi in Or)i.eb(Si,Or[bi],this.showCollisionBoxes,fe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Ut,Qn);else if(Si.hasPattern&&(Si instanceof i.b2||Si instanceof i.b3||Si instanceof i.d8)){ye(Si.layers,this.zoom,Ke.brightness,fe);const Bo=Object.fromEntries(Qn.patternPositions);Si.addFeatures(Ke,this.tileID.canonical,Bo,fe,this.tileTransform,this.brightness)}}this.status="done",be(null,{buckets:Object.values(Re).filter(bi=>!bi.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:un.image,lineAtlas:qe,imageAtlas:Qn,brightness:Ke.brightness})};if(!this.extraShadowCaster){const Or=i.e5(Ke.glyphDependencies,cn=>Object.keys(cn).map(Number));Object.keys(Or).length?Te.send("getGlyphs",{uid:this.uid,stacks:Or,scope:this.scope},(cn,Qn)=>{mt||(mt=cn,Nt=Qn,Sn())},void 0,!1,Ar):Nt={};const un=Array.from(Ke.iconDependencies.keys()).map(cn=>i.I.parse(cn));un.length?Te.send("getImages",{images:un,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(cn,Qn)=>{mt||(mt=cn,Ut=new Map,Tr=this.updateImageMapAndGetImageTaskQueue(Ut,Qn,Ke.iconDependencies),Sn())},void 0,!1,Ar):(Ut=new Map,Tr=new Map);const ln=Array.from(Ke.patternDependencies.keys()).map(cn=>i.I.parse(cn));ln.length?Te.send("getImages",{images:ln,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(cn,Qn)=>{mt||(mt=cn,xr=new Map,Er=this.updateImageMapAndGetImageTaskQueue(xr,Qn,Ke.patternDependencies),Sn())},void 0,!1,Ar):(xr=new Map,Er=new Map)}if(Ke.elevationFeatures&&Ke.elevationFeatures.length>0){const Or=[];for(const ln of Object.values(Re))if(ln instanceof i.b3){const cn=ln.getUnevaluatedPortalGraph();cn&&Or.push(cn)}const un=i.e6.evaluate(Or);for(const ln of Object.values(Re))ln instanceof i.b3&&ln.setEvaluatedPortalGraph(un)}Sn()}rasterizeIfNeeded(Y,re,fe,Te){Array.from(re.values()).some(be=>be.usvg)?this.rasterize(Y,re,fe,Te):Te()}updateImageMapAndGetImageTaskQueue(Y,re,fe){const Te=new Map;for(const be of re.keys()){const Pe=fe.get(be)||[];for(const Ge of Pe){const Re=Ge.toString(),qe=re.get(Ge.id.toString());qe.usvg?Te.has(Re)||(Te.set(Re,Ge),Y.set(Re,Object.assign({},qe))):Y.set(Re,qe)}}return Te}rasterize(Y,re,fe,Te){this.rasterizeTask=Y.send("rasterizeImages",{scope:this.scope,tasks:fe},(be,Pe)=>{if(!be)for(const[Ge,Re]of Pe.entries()){const qe=Object.assign(re.get(Ge),{data:Re});re.set(Ge,qe)}Te()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ye(Xe,Y,re,fe){const Te=new i.aa(Y,{brightness:re});for(const be of Xe)be.recalculate(Te,fe)}class Le extends i.E{constructor(Y,re,fe,Te,be,Pe){super(),this.actor=Y,this.layerIndex=re,this.availableImages=fe,this.loadVectorData=be||i.aE,this.loading={},this.loaded={},this.deduped=new i.aD(Y.scheduler),this.isSpriteLoaded=Te,this.scheduler=Y.scheduler,this.brightness=Pe}loadTile(Y,re){const fe=Y.uid,Te=Y&&Y.request,be=Te&&Te.collectResourceTiming,Pe=this.loading[fe]=new he(Y);Pe.abort=this.loadVectorData(Y,(Ge,Re)=>{const qe=!this.loading[fe];if(delete this.loading[fe],Pe.cancelRasterize(),qe||Ge||!Re)return Pe.status="done",qe||(this.loaded[fe]=Pe),re(Ge);const Ke=Re.rawData,We={};Re.expires&&(We.expires=Re.expires),Re.cacheControl&&(We.cacheControl=Re.cacheControl),Pe.vectorTile=Re.vectorTile||new i.ec.VectorTile(new i.bi(Ke));const mt=()=>{Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Nt,Ut)=>{if(Nt||!Ut)return re(Nt);const xr={};if(be){const Tr=G(Te);Tr.length>0&&(xr.resourceTiming=JSON.parse(JSON.stringify(Tr)))}re(null,i.l({rawTileData:Ke.slice(0)},Ut,We,xr))})};this.isSpriteLoaded?mt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(mt,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):mt()}),this.loaded=this.loaded||{},this.loaded[fe]=Pe})}reloadTile(Y,re){const fe=this.loaded,Te=Y.uid;if(fe&&fe[Te]){const be=fe[Te];be.scaleFactor=Y.scaleFactor,be.showCollisionBoxes=Y.showCollisionBoxes,be.projection=Y.projection,be.brightness=Y.brightness,be.tileTransform=i.aR(Y.tileID.canonical,Y.projection),be.extraShadowCaster=Y.extraShadowCaster,be.lut=Y.lut;const Pe=(Ge,Re)=>{const qe=be.reloadCallback;qe&&(delete be.reloadCallback,be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,qe)),re(Ge,Re)};be.status==="parsing"?be.reloadCallback=Pe:be.status==="done"&&(be.vectorTile?be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,Pe):Pe())}else re(null,void 0)}abortTile(Y,re){const fe=Y.uid,Te=this.loading[fe];Te&&(Te.abort&&Te.abort(),delete this.loading[fe]),re()}removeTile(Y,re){const fe=this.loaded,Te=Y.uid;fe&&fe[Te]&&delete fe[Te],re()}}class je{loadTile(Y,re){const{uid:fe,encoding:Te,rawImageData:be,padding:Pe}=Y,Ge=ImageBitmap&&be instanceof ImageBitmap?this.getImageData(be,Pe):be;re(null,new i.ed(fe,Ge,Te,Pe<1))}reloadTile(Y,re){re(null,null)}abortTile(Y,re){re()}removeTile(Y,re){re()}getImageData(Y,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const fe=this.offscreenCanvasContext.getImageData(-re,-re,Y.width+2*re,Y.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),fe}}i.bh.setPbf(i.bi);class xt{constructor(Y){this._mrt=new i.bh(Y.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Y.uid,this.tileID=Y.tileID,this.source=Y.source}parse(Y,re){const fe=this._mrt;this.status="parsing",this._entireBuffer=Y;try{fe.parseHeader(Y),this._isHeaderLoaded=!0;const Te=[];for(const be in fe.layers){const Pe=fe.getLayer(be),Ge=Pe.getDataRange(Pe.getBandList()),Re=fe.createDecodingTask(Ge),qe=Y.slice(Ge.firstByte,Ge.lastByte+1),Ke=i.bh.performDecoding(qe,Re).then(We=>Re.complete(null,We)).catch(We=>Re.complete(We,null));Te.push(Ke)}Promise.allSettled(Te).then(()=>re(null,fe))}catch(Te){re(Te)}}}class Dt{constructor(Y){this.actor=Y,this.loading={},this.loaded={}}loadTile(Y,re){const fe=Y.uid,Te=Y.request,be=this.loading[fe]=new xt(Y),{cancel:Pe}=i.bj(Te,(Ge,Re,qe,Ke)=>{const We=!this.loading[fe];if(delete this.loading[fe],We||Ge||!Re)return be.status="done",We||(this.loaded[fe]=be),re(Ge);be.parse(Re,(mt,Nt)=>{if(mt||!Nt)return re(mt);re(null,Nt,qe,Ke)}),this.loaded[fe]=be});be.abort=Pe}reloadTile(Y,re){re(null,void 0)}abortTile(Y,re){const fe=Y.uid,Te=this.loading[fe];Te&&(Te.abort&&Te.abort(),delete this.loading[fe]),re()}removeTile(Y,re){const fe=Y.uid;this.loaded[fe]&&delete this.loaded[fe],re()}decodeRasterArray({task:Y,buffer:re},fe){i.bh.performDecoding(re,Y).then(Te=>fe(null,Te)).catch(Te=>fe(Te))}}const ut=i.ec.VectorTileFeature.prototype.toGeoJSON;class ht{constructor(Y){this._feature=Y,this.extent=i.ai,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const re of this._feature.geometry)Y.push([new i.P(re[0],re[1])]);return Y}{const Y=[];for(const re of this._feature.geometry){const fe=[];for(const Te of re)fe.push(new i.P(Te[0],Te[1]));Y.push(fe)}return Y}}toGeoJSON(Y,re,fe){return ut.call(this,Y,re,fe)}}class Et{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.ai,this.length=Y.length,this._features=Y}feature(Y){return new ht(this._features[Y])}}const tt=64/4096,At=128;class pt{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],re){for(const fe of Y){const Te=fe.id;if(Te==null)continue;let be=this.features.get(Te);be&&this.updateCache(be,re),fe.geometry?(be=gt(fe),this.updateCache(be,re),this.features.set(Te,be)):this.features.delete(Te),this.updateCache(be,re)}}updateCache(Y,re){for(const{canonical:fe,uid:Te}of Object.values(re)){const{z:be,x:Pe,y:Ge}=fe;at(Y,Math.pow(2,be),Pe,Ge)&&delete re[Te]}}getTile(Y,re,fe){const Te=Math.pow(2,Y),be=[];for(const Pe of this.features.values())at(Pe,Te,re,fe)&&be.push(Zt(Pe,Te,re,fe));return{features:be}}getFeatures(){return[...this.features.values()]}}function at({minX:Xe,minY:Y,maxX:re,maxY:fe},Te,be,Pe){return Xe<(be+1+tt)/Te&&Y<(Pe+1+tt)/Te&&re>(be-tt)/Te&&fe>(Pe-tt)/Te}function gt(Xe){const{id:Y,geometry:re,properties:fe}=Xe;if(!re)return;if(re.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Te,coordinates:be}=re,Pe={id:Y,type:1,geometry:[],tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ge=Pe.geometry;if(Te==="Point")yt(be,Ge,Pe);else if(Te==="MultiPoint")for(const Re of be)yt(Re,Ge,Pe);else if(Te==="LineString")Pe.type=2,sr(be,Ge,Pe);else if(Te==="MultiLineString")Pe.type=2,zr(be,Ge,Pe);else if(Te==="Polygon")Pe.type=3,zr(be,Ge,Pe,!0);else{if(Te!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Pe.type=3;for(const Re of be)zr(Re,Ge,Pe,!0)}return Pe}function yt([Xe,Y],re,fe){const Te=i.av(Xe);let be=i.aC(Y);be=be<0?0:be>1?1:be,re.push(Te,be),fe.minX=Math.min(fe.minX,Te),fe.minY=Math.min(fe.minY,be),fe.maxX=Math.max(fe.maxX,Te),fe.maxY=Math.max(fe.maxY,be)}function sr(Xe,Y,re,fe=!1,Te=!1){const be=[];for(const Pe of Xe)yt(Pe,be,re);Y.push(be),fe&&function(Pe,Ge){let Re=0;for(let qe=0,Ke=Pe.length,We=Ke-2;qe<Ke;We=qe,qe+=2)Re+=(Pe[qe]-Pe[We])*(Pe[qe+1]+Pe[We+1]);if(Re>0===Ge)for(let qe=0,Ke=Pe.length;qe<Ke/2;qe+=2){const We=Pe[qe],mt=Pe[qe+1];Pe[qe]=Pe[Ke-2-qe],Pe[qe+1]=Pe[Ke-1-qe],Pe[Ke-2-qe]=We,Pe[Ke-1-qe]=mt}}(be,Te)}function zr(Xe,Y,re,fe=!1){for(let Te=0;Te<Xe.length;Te++)sr(Xe[Te],Y,re,fe,Te===0)}function Zt(Xe,Y,re,fe){const{id:Te,type:be,geometry:Pe,tags:Ge}=Xe,Re=[];if(be===1)(function(qe,Ke,We,mt,Nt){for(let Ut=0;Ut<qe.length;Ut+=2){const xr=Math.round(i.ai*(qe[Ut+0]*Ke-We)),Tr=Math.round(i.ai*(qe[Ut+1]*Ke-mt));Nt.push([xr,Tr])}})(Pe,Y,re,fe,Re);else for(const qe of Pe)Ir(qe,Y,re,fe,Re);return{id:Te,type:be,geometry:Re,tags:Ge}}function Ir(Xe,Y,re,fe,Te){const Pe=i.ai+At;let Ge;for(let Re=0;Re<Xe.length-2;Re+=2){let qe=Math.round(i.ai*(Xe[Re+0]*Y-re)),Ke=Math.round(i.ai*(Xe[Re+1]*Y-fe)),We=Math.round(i.ai*(Xe[Re+2]*Y-re)),mt=Math.round(i.ai*(Xe[Re+3]*Y-fe));const Nt=We-qe,Ut=mt-Ke;qe<-128&&We<-128||(qe<-128?(Ke+=Math.round(Ut*((-128-qe)/Nt)),qe=-128):We<-128&&(mt=Ke+Math.round(Ut*((-128-qe)/Nt)),We=-128),Ke<-128&&mt<-128||(Ke<-128?(qe+=Math.round(Nt*((-128-Ke)/Ut)),Ke=-128):mt<-128&&(We=qe+Math.round(Nt*((-128-Ke)/Ut)),mt=-128),qe>=Pe&&We>=Pe||(qe>=Pe?(Ke+=Math.round(Ut*((Pe-qe)/Nt)),qe=Pe):We>=Pe&&(mt=Ke+Math.round(Ut*((Pe-qe)/Nt)),We=Pe),Ke>=Pe&&mt>=Pe||(Ke>=Pe?(qe+=Math.round(Nt*((Pe-Ke)/Ut)),Ke=Pe):mt>=Pe&&(We=qe+Math.round(Nt*((Pe-Ke)/Ut)),mt=Pe),Ge&&qe===Ge[Ge.length-1][0]&&Ke===Ge[Ge.length-1][1]||(Ge=[[qe,Ke]],Te.push(Ge)),Ge.push([We,mt])))))}}var vr,Vr,lr,Hr={exports:{}},ur=function(){if(lr)return Hr.exports;lr=1;var Xe=i.eg(),Y=function(){if(Vr)return vr;Vr=1;var Ke=i.ee(),We=i.ef().VectorTileFeature;function mt(Ut,xr){this.options=xr||{},this.features=Ut,this.length=Ut.length}function Nt(Ut,xr){this.id=typeof Ut.id=="number"?Ut.id:void 0,this.type=Ut.type,this.rawGeometry=Ut.type===1?[Ut.geometry]:Ut.geometry,this.properties=Ut.tags,this.extent=xr||4096}return vr=mt,mt.prototype.feature=function(Ut){return new Nt(this.features[Ut],this.options.extent)},Nt.prototype.loadGeometry=function(){var Ut=this.rawGeometry;this.geometry=[];for(var xr=0;xr<Ut.length;xr++){for(var Tr=Ut[xr],Er=[],Ar=0;Ar<Tr.length;Ar++)Er.push(new Ke(Tr[Ar][0],Tr[Ar][1]));this.geometry.push(Er)}return this.geometry},Nt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ut=this.geometry,xr=1/0,Tr=-1/0,Er=1/0,Ar=-1/0,Sn=0;Sn<Ut.length;Sn++)for(var Un=Ut[Sn],Or=0;Or<Un.length;Or++){var un=Un[Or];xr=Math.min(xr,un.x),Tr=Math.max(Tr,un.x),Er=Math.min(Er,un.y),Ar=Math.max(Ar,un.y)}return[xr,Er,Tr,Ar]},Nt.prototype.toGeoJSON=We.prototype.toGeoJSON,vr}();function re(Ke){var We=new Xe;return function(mt,Nt){for(var Ut in mt.layers)Nt.writeMessage(3,fe,mt.layers[Ut])}(Ke,We),We.finish()}function fe(Ke,We){var mt;We.writeVarintField(15,Ke.version||1),We.writeStringField(1,Ke.name||""),We.writeVarintField(5,Ke.extent||4096);var Nt={keys:[],values:[],keycache:{},valuecache:{}};for(mt=0;mt<Ke.length;mt++)Nt.feature=Ke.feature(mt),We.writeMessage(2,Te,Nt);var Ut=Nt.keys;for(mt=0;mt<Ut.length;mt++)We.writeStringField(3,Ut[mt]);var xr=Nt.values;for(mt=0;mt<xr.length;mt++)We.writeMessage(4,qe,xr[mt])}function Te(Ke,We){var mt=Ke.feature;mt.id!==void 0&&We.writeVarintField(1,mt.id),We.writeMessage(2,be,Ke),We.writeVarintField(3,mt.type),We.writeMessage(4,Re,mt)}function be(Ke,We){var mt=Ke.feature,Nt=Ke.keys,Ut=Ke.values,xr=Ke.keycache,Tr=Ke.valuecache;for(var Er in mt.properties){var Ar=mt.properties[Er],Sn=xr[Er];if(Ar!==null){Sn===void 0&&(Nt.push(Er),xr[Er]=Sn=Nt.length-1),We.writeVarint(Sn);var Un=typeof Ar;Un!=="string"&&Un!=="boolean"&&Un!=="number"&&(Ar=JSON.stringify(Ar));var Or=Un+":"+Ar,un=Tr[Or];un===void 0&&(Ut.push(Ar),Tr[Or]=un=Ut.length-1),We.writeVarint(un)}}}function Pe(Ke,We){return(We<<3)+(7&Ke)}function Ge(Ke){return Ke<<1^Ke>>31}function Re(Ke,We){for(var mt=Ke.loadGeometry(),Nt=Ke.type,Ut=0,xr=0,Tr=mt.length,Er=0;Er<Tr;Er++){var Ar=mt[Er],Sn=1;Nt===1&&(Sn=Ar.length),We.writeVarint(Pe(1,Sn));for(var Un=Nt===3?Ar.length-1:Ar.length,Or=0;Or<Un;Or++){Or===1&&Nt!==1&&We.writeVarint(Pe(2,Un-1));var un=Ar[Or].x-Ut,ln=Ar[Or].y-xr;We.writeVarint(Ge(un)),We.writeVarint(Ge(ln)),Ut+=un,xr+=ln}Nt===3&&We.writeVarint(Pe(7,1))}}function qe(Ke,We){var mt=typeof Ke;mt==="string"?We.writeStringField(1,Ke):mt==="boolean"?We.writeBooleanField(7,Ke):mt==="number"&&(Ke%1!=0?We.writeDoubleField(3,Ke):Ke<0?We.writeSVarintField(6,Ke):We.writeVarintField(5,Ke))}return Hr.exports=re,Hr.exports.fromVectorTileJs=re,Hr.exports.fromGeojsonVt=function(Ke,We){We=We||{};var mt={};for(var Nt in Ke)mt[Nt]=new Y(Ke[Nt].features,We),mt[Nt].name=Nt,mt[Nt].version=We.version,mt[Nt].extent=We.extent;return re({layers:mt})},Hr.exports.GeoJSONWrapper=Y,Hr.exports}(),rr=i.eh(ur);const $t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xe=>Xe},vi=Math.fround||(hi=new Float32Array(1),Xe=>(hi[0]=+Xe,hi[0]));var hi;const yn=3,Pt=5,er=6;class Kt{constructor(Y){this.options=Object.assign(Object.create($t),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:re,minZoom:fe,maxZoom:Te}=this.options;re&&console.time("total time");const be=`prepare ${Y.length} points`;re&&console.time(be),this.points=Y;const Pe=[];for(let Re=0;Re<Y.length;Re++){const qe=Y[Re];if(!qe.geometry)continue;const[Ke,We]=qe.geometry.coordinates,mt=vi(ke(Ke)),Nt=vi(Ve(We));Pe.push(mt,Nt,1/0,Re,-1,1),this.options.reduce&&Pe.push(0)}let Ge=this.trees[Te+1]=this._createTree(Pe);re&&console.timeEnd(be);for(let Re=Te;Re>=fe;Re--){const qe=+Date.now();Ge=this.trees[Re]=this._createTree(this._cluster(Ge,Re)),re&&console.log("z%d: %d clusters in %dms",Re,Ge.numItems,+Date.now()-qe)}return re&&console.timeEnd("total time"),this}getClusters(Y,re){let fe=((Y[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,Y[1]));let be=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)fe=-180,be=180;else if(fe>be){const We=this.getClusters([fe,Te,180,Pe],re),mt=this.getClusters([-180,Te,be,Pe],re);return We.concat(mt)}const Ge=this.trees[this._limitZoom(re)],Re=Ge.range(ke(fe),Ve(Pe),ke(be),Ve(Te)),qe=Ge.data,Ke=[];for(const We of Re){const mt=this.stride*We;Ke.push(qe[mt+Pt]>1?te(qe,mt,this.clusterProps):this.points[qe[mt+yn]])}return Ke}getChildren(Y){const re=this._getOriginId(Y),fe=this._getOriginZoom(Y),Te="No cluster with the specified id.",be=this.trees[fe];if(!be)throw new Error(Te);const Pe=be.data;if(re*this.stride>=Pe.length)throw new Error(Te);const Ge=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),Re=be.within(Pe[re*this.stride],Pe[re*this.stride+1],Ge),qe=[];for(const Ke of Re){const We=Ke*this.stride;Pe[We+4]===Y&&qe.push(Pe[We+Pt]>1?te(Pe,We,this.clusterProps):this.points[Pe[We+yn]])}if(qe.length===0)throw new Error(Te);return qe}getLeaves(Y,re,fe){const Te=[];return this._appendLeaves(Te,Y,re=re||10,fe=fe||0,0),Te}getTile(Y,re,fe){const Te=this.trees[this._limitZoom(Y)],be=Math.pow(2,Y),{extent:Pe,radius:Ge}=this.options,Re=Ge/Pe,qe=(fe-Re)/be,Ke=(fe+1+Re)/be,We={features:[]};return this._addTileFeatures(Te.range((re-Re)/be,qe,(re+1+Re)/be,Ke),Te.data,re,fe,be,We),re===0&&this._addTileFeatures(Te.range(1-Re/be,qe,1,Ke),Te.data,be,fe,be,We),re===be-1&&this._addTileFeatures(Te.range(0,qe,Re/be,Ke),Te.data,-1,fe,be,We),We.features.length?We:null}getClusterExpansionZoom(Y){let re=this._getOriginZoom(Y)-1;for(;re<=this.options.maxZoom;){const fe=this.getChildren(Y);if(re++,fe.length!==1)break;Y=fe[0].properties.cluster_id}return re}_appendLeaves(Y,re,fe,Te,be){const Pe=this.getChildren(re);for(const Ge of Pe){const Re=Ge.properties;if(Re&&Re.cluster?be+Re.point_count<=Te?be+=Re.point_count:be=this._appendLeaves(Y,Re.cluster_id,fe,Te,be):be<Te?be++:Y.push(Ge),Y.length===fe)break}return be}_createTree(Y){const re=new i.bE(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<Y.length;fe+=this.stride)re.add(Y[fe],Y[fe+1]);return re.finish(),re.data=Y,re}_addTileFeatures(Y,re,fe,Te,be,Pe){for(const Ge of Y){const Re=Ge*this.stride,qe=re[Re+Pt]>1;let Ke,We,mt;if(qe)Ke=vn(re,Re,this.clusterProps),We=re[Re],mt=re[Re+1];else{const xr=this.points[re[Re+yn]];Ke=xr.properties;const[Tr,Er]=xr.geometry.coordinates;We=ke(Tr),mt=Ve(Er)}const Nt={type:1,geometry:[[Math.round(this.options.extent*(We*be-fe)),Math.round(this.options.extent*(mt*be-Te))]],tags:Ke};let Ut;Ut=qe||this.options.generateId?re[Re+yn]:this.points[re[Re+yn]].id,Ut!==void 0&&(Nt.id=Ut),Pe.features.push(Nt)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,re){const{radius:fe,extent:Te,reduce:be,minPoints:Pe}=this.options,Ge=fe/(Te*Math.pow(2,re)),Re=Y.data,qe=[],Ke=this.stride;for(let We=0;We<Re.length;We+=Ke){if(Re[We+2]<=re)continue;Re[We+2]=re;const mt=Re[We],Nt=Re[We+1],Ut=Y.within(Re[We],Re[We+1],Ge),xr=Re[We+Pt];let Tr=xr;for(const Er of Ut){const Ar=Er*Ke;Re[Ar+2]>re&&(Tr+=Re[Ar+Pt])}if(Tr>xr&&Tr>=Pe){let Er,Ar=mt*xr,Sn=Nt*xr,Un=-1;const Or=(We/Ke<<5)+(re+1)+this.points.length;for(const un of Ut){const ln=un*Ke;if(Re[ln+2]<=re)continue;Re[ln+2]=re;const cn=Re[ln+Pt];Ar+=Re[ln]*cn,Sn+=Re[ln+1]*cn,Re[ln+4]=Or,be&&(Er||(Er=this._map(Re,We,!0),Un=this.clusterProps.length,this.clusterProps.push(Er)),be(Er,this._map(Re,ln)))}Re[We+4]=Or,qe.push(Ar/Tr,Sn/Tr,1/0,Or,-1,Tr),be&&qe.push(Un)}else{for(let Er=0;Er<Ke;Er++)qe.push(Re[We+Er]);if(Tr>1)for(const Er of Ut){const Ar=Er*Ke;if(!(Re[Ar+2]<=re)){Re[Ar+2]=re;for(let Sn=0;Sn<Ke;Sn++)qe.push(Re[Ar+Sn])}}}}return qe}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,re,fe){if(Y[re+Pt]>1){const Pe=this.clusterProps[Y[re+er]];return fe?Object.assign({},Pe):Pe}const Te=this.points[Y[re+yn]].properties,be=this.options.map(Te);return fe&&be===Te?Object.assign({},be):be}}function te(Xe,Y,re){return{type:"Feature",id:Xe[Y+yn],properties:vn(Xe,Y,re),geometry:{type:"Point",coordinates:[(fe=Xe[Y],360*(fe-.5)),Ae(Xe[Y+1])]}};var fe}function vn(Xe,Y,re){const fe=Xe[Y+Pt],Te=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,be=Xe[Y+er],Pe=be===-1?{}:Object.assign({},re[be]);return Object.assign(Pe,{cluster:!0,cluster_id:Xe[Y+yn],point_count:fe,point_count_abbreviated:Te})}function ke(Xe){return Xe/360+.5}function Ve(Xe){const Y=Math.sin(Xe*Math.PI/180),re=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return re<0?0:re>1?1:re}function Ae(Xe){const Y=(180-360*Xe)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function bt(Xe,Y,re,fe){let Te=fe;const be=Y+(re-Y>>1);let Pe,Ge=re-Y;const Re=Xe[Y],qe=Xe[Y+1],Ke=Xe[re],We=Xe[re+1];for(let mt=Y+3;mt<re;mt+=3){const Nt=Vt(Xe[mt],Xe[mt+1],Re,qe,Ke,We);if(Nt>Te)Pe=mt,Te=Nt;else if(Nt===Te){const Ut=Math.abs(mt-be);Ut<Ge&&(Pe=mt,Ge=Ut)}}Te>fe&&(Pe-Y>3&&bt(Xe,Y,Pe,fe),Xe[Pe+2]=Te,re-Pe>3&&bt(Xe,Pe,re,fe))}function Vt(Xe,Y,re,fe,Te,be){let Pe=Te-re,Ge=be-fe;if(Pe!==0||Ge!==0){const Re=((Xe-re)*Pe+(Y-fe)*Ge)/(Pe*Pe+Ge*Ge);Re>1?(re=Te,fe=be):Re>0&&(re+=Pe*Re,fe+=Ge*Re)}return Pe=Xe-re,Ge=Y-fe,Pe*Pe+Ge*Ge}function zt(Xe,Y,re,fe){const Te={id:Xe??null,type:Y,geometry:re,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")Rt(Te,re);else if(Y==="Polygon")Rt(Te,re[0]);else if(Y==="MultiLineString")for(const be of re)Rt(Te,be);else if(Y==="MultiPolygon")for(const be of re)Rt(Te,be[0]);return Te}function Rt(Xe,Y){for(let re=0;re<Y.length;re+=3)Xe.minX=Math.min(Xe.minX,Y[re]),Xe.minY=Math.min(Xe.minY,Y[re+1]),Xe.maxX=Math.max(Xe.maxX,Y[re]),Xe.maxY=Math.max(Xe.maxY,Y[re+1])}function jt(Xe,Y,re,fe){if(!Y.geometry)return;const Te=Y.geometry.coordinates;if(Te&&Te.length===0)return;const be=Y.geometry.type,Pe=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2);let Ge=[],Re=Y.id;if(re.promoteId?Re=Y.properties[re.promoteId]:re.generateId&&(Re=fe||0),be==="Point")Yt(Te,Ge);else if(be==="MultiPoint")for(const qe of Te)Yt(qe,Ge);else if(be==="LineString")Gt(Te,Ge,Pe,!1);else if(be==="MultiLineString"){if(re.lineMetrics){for(const qe of Te)Ge=[],Gt(qe,Ge,Pe,!1),Xe.push(zt(Re,"LineString",Ge,Y.properties));return}Cr(Te,Ge,Pe,!1)}else if(be==="Polygon")Cr(Te,Ge,Pe,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(const qe of Y.geometry.geometries)jt(Xe,{id:Re,geometry:qe,properties:Y.properties},re,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const qe of Te){const Ke=[];Cr(qe,Ke,Pe,!0),Ge.push(Ke)}}Xe.push(zt(Re,be,Ge,Y.properties))}function Yt(Xe,Y){Y.push(cr(Xe[0]),Ye(Xe[1]),0)}function Gt(Xe,Y,re,fe){let Te,be,Pe=0;for(let Re=0;Re<Xe.length;Re++){const qe=cr(Xe[Re][0]),Ke=Ye(Xe[Re][1]);Y.push(qe,Ke,0),Re>0&&(Pe+=fe?(Te*Ke-qe*be)/2:Math.sqrt(Math.pow(qe-Te,2)+Math.pow(Ke-be,2))),Te=qe,be=Ke}const Ge=Y.length-3;Y[2]=1,bt(Y,0,Ge,re),Y[Ge+2]=1,Y.size=Math.abs(Pe),Y.start=0,Y.end=Y.size}function Cr(Xe,Y,re,fe){for(let Te=0;Te<Xe.length;Te++){const be=[];Gt(Xe[Te],be,re,fe),Y.push(be)}}function cr(Xe){return Xe/360+.5}function Ye(Xe){const Y=Math.sin(Xe*Math.PI/180),re=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return re<0?0:re>1?1:re}function Jt(Xe,Y,re,fe,Te,be,Pe,Ge){if(fe/=Y,be>=(re/=Y)&&Pe<fe)return Xe;if(Pe<re||be>=fe)return null;const Re=[];for(const qe of Xe){const Ke=qe.geometry;let We=qe.type;const mt=Te===0?qe.minX:qe.minY,Nt=Te===0?qe.maxX:qe.maxY;if(mt>=re&&Nt<fe){Re.push(qe);continue}if(Nt<re||mt>=fe)continue;let Ut=[];if(We==="Point"||We==="MultiPoint")$r(Ke,Ut,re,fe,Te);else if(We==="LineString")xn(Ke,Ut,re,fe,Te,!1,Ge.lineMetrics);else if(We==="MultiLineString")xi(Ke,Ut,re,fe,Te,!1);else if(We==="Polygon")xi(Ke,Ut,re,fe,Te,!0);else if(We==="MultiPolygon")for(const xr of Ke){const Tr=[];xi(xr,Tr,re,fe,Te,!0),Tr.length&&Ut.push(Tr)}if(Ut.length){if(Ge.lineMetrics&&We==="LineString"){for(const xr of Ut)Re.push(zt(qe.id,We,xr,qe.tags));continue}We!=="LineString"&&We!=="MultiLineString"||(Ut.length===1?(We="LineString",Ut=Ut[0]):We="MultiLineString"),We!=="Point"&&We!=="MultiPoint"||(We=Ut.length===3?"Point":"MultiPoint"),Re.push(zt(qe.id,We,Ut,qe.tags))}}return Re.length?Re:null}function $r(Xe,Y,re,fe,Te){for(let be=0;be<Xe.length;be+=3){const Pe=Xe[be+Te];Pe>=re&&Pe<=fe&&ri(Y,Xe[be],Xe[be+1],Xe[be+2])}}function xn(Xe,Y,re,fe,Te,be,Pe){let Ge=Ur(Xe);const Re=Te===0?Ki:ki;let qe,Ke,We=Xe.start;for(let Tr=0;Tr<Xe.length-3;Tr+=3){const Er=Xe[Tr],Ar=Xe[Tr+1],Sn=Xe[Tr+2],Un=Xe[Tr+3],Or=Xe[Tr+4],un=Te===0?Er:Ar,ln=Te===0?Un:Or;let cn=!1;Pe&&(qe=Math.sqrt(Math.pow(Er-Un,2)+Math.pow(Ar-Or,2))),un<re?ln>re&&(Ke=Re(Ge,Er,Ar,Un,Or,re),Pe&&(Ge.start=We+qe*Ke)):un>fe?ln<fe&&(Ke=Re(Ge,Er,Ar,Un,Or,fe),Pe&&(Ge.start=We+qe*Ke)):ri(Ge,Er,Ar,Sn),ln<re&&un>=re&&(Ke=Re(Ge,Er,Ar,Un,Or,re),cn=!0),ln>fe&&un<=fe&&(Ke=Re(Ge,Er,Ar,Un,Or,fe),cn=!0),!be&&cn&&(Pe&&(Ge.end=We+qe*Ke),Y.push(Ge),Ge=Ur(Xe)),Pe&&(We+=qe)}let mt=Xe.length-3;const Nt=Xe[mt],Ut=Xe[mt+1],xr=Te===0?Nt:Ut;xr>=re&&xr<=fe&&ri(Ge,Nt,Ut,Xe[mt+2]),mt=Ge.length-3,be&&mt>=3&&(Ge[mt]!==Ge[0]||Ge[mt+1]!==Ge[1])&&ri(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&Y.push(Ge)}function Ur(Xe){const Y=[];return Y.size=Xe.size,Y.start=Xe.start,Y.end=Xe.end,Y}function xi(Xe,Y,re,fe,Te,be){for(const Pe of Xe)xn(Pe,Y,re,fe,Te,be,!1)}function ri(Xe,Y,re,fe){Xe.push(Y,re,fe)}function Ki(Xe,Y,re,fe,Te,be){const Pe=(be-Y)/(fe-Y);return ri(Xe,be,re+(Te-re)*Pe,1),Pe}function ki(Xe,Y,re,fe,Te,be){const Pe=(be-re)/(Te-re);return ri(Xe,Y+(fe-Y)*Pe,be,1),Pe}function ys(Xe,Y){const re=[];for(let fe=0;fe<Xe.length;fe++){const Te=Xe[fe],be=Te.type;let Pe;if(be==="Point"||be==="MultiPoint"||be==="LineString")Pe=bo(Te.geometry,Y);else if(be==="MultiLineString"||be==="Polygon"){Pe=[];for(const Ge of Te.geometry)Pe.push(bo(Ge,Y))}else if(be==="MultiPolygon"){Pe=[];for(const Ge of Te.geometry){const Re=[];for(const qe of Ge)Re.push(bo(qe,Y));Pe.push(Re)}}re.push(zt(Te.id,be,Pe,Te.tags))}return re}function bo(Xe,Y){const re=[];re.size=Xe.size,Xe.start!==void 0&&(re.start=Xe.start,re.end=Xe.end);for(let fe=0;fe<Xe.length;fe+=3)re.push(Xe[fe]+Y,Xe[fe+1],Xe[fe+2]);return re}function Jn(Xe,Y){if(Xe.transformed)return Xe;const re=1<<Xe.z,fe=Xe.x,Te=Xe.y;for(const be of Xe.features){const Pe=be.geometry,Ge=be.type;if(be.geometry=[],Ge===1)for(let Re=0;Re<Pe.length;Re+=2)be.geometry.push(Fi(Pe[Re],Pe[Re+1],Y,re,fe,Te));else for(let Re=0;Re<Pe.length;Re++){const qe=[];for(let Ke=0;Ke<Pe[Re].length;Ke+=2)qe.push(Fi(Pe[Re][Ke],Pe[Re][Ke+1],Y,re,fe,Te));be.geometry.push(qe)}}return Xe.transformed=!0,Xe}function Fi(Xe,Y,re,fe,Te,be){return[Math.round(re*(Xe*fe-Te)),Math.round(re*(Y*fe-be))]}function Pr(Xe,Y,re,fe,Te){const be=Y===Te.maxZoom?0:Te.tolerance/((1<<Y)*Te.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:Xe.length,source:null,x:re,y:fe,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of Xe)wo(Pe,Ge,be,Te);return Pe}function wo(Xe,Y,re,fe){const Te=Y.geometry,be=Y.type,Pe=[];if(Xe.minX=Math.min(Xe.minX,Y.minX),Xe.minY=Math.min(Xe.minY,Y.minY),Xe.maxX=Math.max(Xe.maxX,Y.maxX),Xe.maxY=Math.max(Xe.maxY,Y.maxY),be==="Point"||be==="MultiPoint")for(let Ge=0;Ge<Te.length;Ge+=3)Pe.push(Te[Ge],Te[Ge+1]),Xe.numPoints++,Xe.numSimplified++;else if(be==="LineString")xl(Pe,Te,Xe,re,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(let Ge=0;Ge<Te.length;Ge++)xl(Pe,Te[Ge],Xe,re,be==="Polygon",Ge===0);else if(be==="MultiPolygon")for(let Ge=0;Ge<Te.length;Ge++){const Re=Te[Ge];for(let qe=0;qe<Re.length;qe++)xl(Pe,Re[qe],Xe,re,!0,qe===0)}if(Pe.length){let Ge=Y.tags||null;if(be==="LineString"&&fe.lineMetrics){Ge={};for(const qe in Y.tags)Ge[qe]=Y.tags[qe];Ge.mapbox_clip_start=Te.start/Te.size,Ge.mapbox_clip_end=Te.end/Te.size}const Re={geometry:Pe,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:Ge};Y.id!==null&&(Re.id=Y.id),Xe.features.push(Re)}}function xl(Xe,Y,re,fe,Te,be){const Pe=fe*fe;if(fe>0&&Y.size<(Te?Pe:fe))return void(re.numPoints+=Y.length/3);const Ge=[];for(let Re=0;Re<Y.length;Re+=3)(fe===0||Y[Re+2]>Pe)&&(re.numSimplified++,Ge.push(Y[Re],Y[Re+1])),re.numPoints++;Te&&function(Re,qe){let Ke=0;for(let We=0,mt=Re.length,Nt=mt-2;We<mt;Nt=We,We+=2)Ke+=(Re[We]-Re[Nt])*(Re[We+1]+Re[Nt+1]);if(Ke>0===qe)for(let We=0,mt=Re.length;We<mt/2;We+=2){const Nt=Re[We],Ut=Re[We+1];Re[We]=Re[mt-2-We],Re[We+1]=Re[mt-1-We],Re[mt-2-We]=Nt,Re[mt-1-We]=Ut}}(Ge,be),Xe.push(Ge)}const vs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ua{constructor(Y,re){const fe=(re=this.options=function(be,Pe){for(const Ge in Pe)be[Ge]=Pe[Ge];return be}(Object.create(vs),re)).debug;if(fe&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let Te=function(be,Pe){const Ge=[];if(be.type==="FeatureCollection")for(let Re=0;Re<be.features.length;Re++)jt(Ge,be.features[Re],Pe,Re);else jt(Ge,be.type==="Feature"?be:{geometry:be},Pe);return Ge}(Y,re);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=function(be,Pe){const Ge=Pe.buffer/Pe.extent;let Re=be;const qe=Jt(be,1,-1-Ge,Ge,0,-1,2,Pe),Ke=Jt(be,1,1-Ge,2+Ge,0,-1,2,Pe);return(qe||Ke)&&(Re=Jt(be,1,-Ge,1+Ge,0,-1,2,Pe)||[],qe&&(Re=ys(qe,1).concat(Re)),Ke&&(Re=Re.concat(ys(Ke,-1)))),Re}(Te,re),Te.length&&this.splitTile(Te,0,0,0),fe&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,re,fe,Te,be,Pe,Ge){const Re=[Y,re,fe,Te],qe=this.options,Ke=qe.debug;for(;Re.length;){Te=Re.pop(),fe=Re.pop(),re=Re.pop(),Y=Re.pop();const We=1<<re,mt=ja(re,fe,Te);let Nt=this.tiles[mt];if(!Nt&&(Ke>1&&console.time("creation"),Nt=this.tiles[mt]=Pr(Y,re,fe,Te,qe),this.tileCoords.push({z:re,x:fe,y:Te}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,fe,Te,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));const cn=`z${re}`;this.stats[cn]=(this.stats[cn]||0)+1,this.total++}if(Nt.source=Y,be==null){if(re===qe.indexMaxZoom||Nt.numPoints<=qe.indexMaxPoints)continue}else{if(re===qe.maxZoom||re===be)continue;if(be!=null){const cn=be-re;if(fe!==Pe>>cn||Te!==Ge>>cn)continue}}if(Nt.source=null,Y.length===0)continue;Ke>1&&console.time("clipping");const Ut=.5*qe.buffer/qe.extent,xr=.5-Ut,Tr=.5+Ut,Er=1+Ut;let Ar=null,Sn=null,Un=null,Or=null,un=Jt(Y,We,fe-Ut,fe+Tr,0,Nt.minX,Nt.maxX,qe),ln=Jt(Y,We,fe+xr,fe+Er,0,Nt.minX,Nt.maxX,qe);Y=null,un&&(Ar=Jt(un,We,Te-Ut,Te+Tr,1,Nt.minY,Nt.maxY,qe),Sn=Jt(un,We,Te+xr,Te+Er,1,Nt.minY,Nt.maxY,qe),un=null),ln&&(Un=Jt(ln,We,Te-Ut,Te+Tr,1,Nt.minY,Nt.maxY,qe),Or=Jt(ln,We,Te+xr,Te+Er,1,Nt.minY,Nt.maxY,qe),ln=null),Ke>1&&console.timeEnd("clipping"),Re.push(Ar||[],re+1,2*fe,2*Te),Re.push(Sn||[],re+1,2*fe,2*Te+1),Re.push(Un||[],re+1,2*fe+1,2*Te),Re.push(Or||[],re+1,2*fe+1,2*Te+1)}}getTile(Y,re,fe){Y=+Y,re=+re,fe=+fe;const Te=this.options,{extent:be,debug:Pe}=Te;if(Y<0||Y>24)return null;const Ge=1<<Y,Re=ja(Y,re=re+Ge&Ge-1,fe);if(this.tiles[Re])return Jn(this.tiles[Re],be);Pe>1&&console.log("drilling down to z%d-%d-%d",Y,re,fe);let qe,Ke=Y,We=re,mt=fe;for(;!qe&&Ke>0;)Ke--,We>>=1,mt>>=1,qe=this.tiles[ja(Ke,We,mt)];return qe&&qe.source?(Pe>1&&(console.log("found parent tile z%d-%d-%d",Ke,We,mt),console.time("drilling down")),this.splitTile(qe.source,Ke,We,mt,Y,re,fe),Pe>1&&console.timeEnd("drilling down"),this.tiles[Re]?Jn(this.tiles[Re],be):null):null}}function ja(Xe,Y,re){return 32*((1<<Xe)*re+Y)+Xe}function Cc(Xe,Y){const re=Xe.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);const fe=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!fe)return void Y(null,null);const Te=new Et(fe.features);let be=rr(Te);be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),Y(null,{vectorTile:Te,rawData:be.buffer})}class bl extends Le{constructor(Y,re,fe,Te,be,Pe){super(Y,re,fe,Te,Cc,Pe),be&&(this.loadGeoJSON=be),this._dynamicIndex=new pt}loadData(Y,re){const fe=Y&&Y.request,Te=fe&&fe.collectResourceTiming;this.loadGeoJSON(Y,(be,Pe)=>{if(be||!Pe)return re(be);if(typeof Pe!="object")return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){const Re=i.X(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Re.result==="error")throw new Error(Re.value.map(qe=>`${qe.key}: ${qe.message}`).join(", "));Pe.features=Pe.features.filter(qe=>Re.value.evaluate({zoom:0},qe))}Y.dynamic?(Pe.type==="Feature"&&(Pe={type:"FeatureCollection",features:[Pe]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Pe.features,this.loaded),Y.cluster&&(Pe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new Kt(function({superclusterOptions:Re,clusterProperties:qe}){if(!qe||!Re)return Re;const Ke={},We={},mt={accumulated:null,zoom:0},Nt={properties:null},Ut=Object.keys(qe);for(const xr of Ut){const[Tr,Er]=qe[xr],Ar=i.X(Er),Sn=i.X(typeof Tr=="string"?[Tr,["accumulated"],["get",xr]]:Tr);Ke[xr]=Ar.value,We[xr]=Sn.value}return Re.map=xr=>{Nt.properties=xr;const Tr={};for(const Er of Ut)Tr[Er]=Ke[Er].evaluate(mt,Nt);return Tr},Re.reduce=(xr,Tr)=>{Nt.properties=Tr;for(const Er of Ut)mt.accumulated=xr[Er],xr[Er]=We[Er].evaluate(mt,Nt)},Re}(Y)).load(Pe.features):Y.dynamic?this._dynamicIndex:function(Re,qe){return new Ua(Re,qe)}(Pe,Y.geojsonVtOptions)}catch(Re){return re(Re)}const Ge={};if(Te){const Re=G(fe);Re&&(Ge.resourceTiming={},Ge.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Re)))}re(null,Ge)}})}reloadTile(Y,re){const fe=this.loaded;return fe&&fe[Y.uid]?Y.partial?re(null,void 0):super.reloadTile(Y,re):this.loadTile(Y,re)}loadGeoJSON(Y,re){if(Y.request)i.n(Y.request,re);else{if(typeof Y.data!="string")return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(Y.data))}catch{return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(fe){re(fe)}}getClusterChildren(Y,re){try{re(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(fe){re(fe)}}getClusterLeaves(Y,re){try{re(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(fe){re(fe)}}}class Gu{constructor(Y,re){this.tileID=new i.aH(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=re}parse(Y,re,fe,Te){this.status="parsing";const be=new i.aH(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),Pe=[],Ge=re.familiesBySource[fe.source],Re=new i.e0(be,fe.promoteId);return Re.bucketLayerIDs=[],Re.is3DTile=!0,i.ei(Y).then(qe=>{if(!qe)return Te(new Error("Could not parse tile"));const Ke=i.ej(qe,1/i.cd(fe.tileID.canonical)),We=qe.json.extensionsUsed&&qe.json.extensionsUsed.includes("MAPBOX_mesh_features")||qe.json.asset.extras&&qe.json.asset.extras.MAPBOX_mesh_features,mt=qe.json.extensionsUsed&&qe.json.extensionsUsed.includes("EXT_meshopt_compression"),Nt=new i.aa(this.zoom,{brightness:this.brightness});for(const Ut in Ge)for(const xr of Ge[Ut]){const Tr=xr[0];Re.bucketLayerIDs.push(xr.map(Ar=>i.C(Ar.id,Ar.scope))),Tr.recalculate(Nt,[]);const Er=new i.ek(xr,Ke,be,We,mt,this.brightness,Re);We||(Er.needsUpload=!0),Pe.push(Er),Er.evaluate(Tr)}this.status="done",Te(null,{buckets:Pe,featureIndex:Re,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(qe=>Te(new Error(qe.message)))}}class Hu{constructor(Y,re,fe,Te,be,Pe){this.actor=Y,this.layerIndex=re,this.availableImages=fe,this.brightness=Pe,this.loading={},this.loaded={}}loadTile(Y,re){const fe=Y.uid,Te=this.loading[fe]=new Gu(Y,this.brightness);i.bj(Y.request,(be,Pe)=>{const Ge=!this.loading[fe];return delete this.loading[fe],Ge||be?(Te.status="done",Ge||(this.loaded[fe]=Te),re(be)):Pe&&Pe.byteLength!==0?void Te.parse(Pe,this.layerIndex,Y,(Re,qe)=>{Te.status="done",this.loaded=this.loaded||{},this.loaded[fe]=Te,Re||!qe?re(Re):re(null,qe)}):(Te.status="done",this.loaded[fe]=Te,re())})}reloadTile(Y,re){const fe=this.loaded,Te=Y.uid;if(fe&&fe[Te]){const be=fe[Te];be.projection=Y.projection,be.brightness=Y.brightness;const Pe=(Ge,Re)=>{be.reloadCallback&&(delete be.reloadCallback,this.loadTile(Y,re)),re(Ge,Re)};be.status==="parsing"?be.reloadCallback=Pe:be.status==="done"&&this.loadTile(Y,re)}}abortTile(Y,re){const fe=Y.uid;this.loading[fe]&&delete this.loading[fe],re()}removeTile(Y,re){const fe=this.loaded,Te=Y.uid;fe&&fe[Te]&&delete fe[Te],re()}}class Pc{constructor(Y){this.self=Y,this.actor=new i.el(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.projections={},this.defaultProjection=i.bP({name:"mercator"}),this.workerSourceTypes={vector:Le,geojson:bl,"raster-dem":je,"raster-array":Dt,"batched-model":Hu},this.workerSources={},this.self.registerWorkerSource=(re,fe)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=fe},this.self.registerRTLTextPlugin=re=>{if(i.em.isParsed())throw new Error("RTL text plugin already registered.");i.em.applyArabicShaping=re.applyArabicShaping,i.em.processBidirectionalText=re.processBidirectionalText,i.em.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(Y,re,fe){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],fe()}checkIfReady(Y,re,fe){fe()}setReferrer(Y,re){this.referrer=re}spriteLoaded(Y,{scope:re,isLoaded:fe}){if(this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.isSpriteLoaded[Y][re]=fe,this.workerSources[Y]&&this.workerSources[Y][re])for(const Te in this.workerSources[Y][re]){const be=this.workerSources[Y][re][Te];for(const Pe in be){const Ge=be[Pe];Ge instanceof Le&&(Ge.isSpriteLoaded=fe,Ge.fire(new i.A("isSpriteLoaded")))}}}setImages(Y,{scope:re,images:fe},Te){if(this.availableImages[Y]||(this.availableImages[Y]={}),this.availableImages[Y][re]=fe,this.workerSources[Y]&&this.workerSources[Y][re]){for(const be in this.workerSources[Y][re]){const Pe=this.workerSources[Y][re][be];for(const Ge in Pe)Pe[Ge].availableImages=fe}Te()}else Te()}setProjection(Y,re){this.projections[Y]=i.bP(re)}setBrightness(Y,re,fe){this.brightness=re,fe()}setLayers(Y,re,fe){this.getLayerIndex(Y,re.scope).replace(re.layers,re.options),fe()}updateLayers(Y,re,fe){this.getLayerIndex(Y,re.scope).update(re.layers,re.removedIds,re.options),fe()}loadTile(Y,re,fe){re.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,re.type,re.source,re.scope).loadTile(re,fe)}decodeRasterArray(Y,re,fe){this.getWorkerSource(Y,re.type,re.source,re.scope).decodeRasterArray(re,fe)}reloadTile(Y,re,fe){re.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,re.type,re.source,re.scope).reloadTile(re,fe)}abortTile(Y,re,fe){this.getWorkerSource(Y,re.type,re.source,re.scope).abortTile(re,fe)}removeTile(Y,re,fe){this.getWorkerSource(Y,re.type,re.source,re.scope).removeTile(re,fe)}removeSource(Y,re,fe){if(!(this.workerSources[Y]&&this.workerSources[Y][re.scope]&&this.workerSources[Y][re.scope][re.type]&&this.workerSources[Y][re.scope][re.type][re.source]))return;const Te=this.workerSources[Y][re.scope][re.type][re.source];delete this.workerSources[Y][re.scope][re.type][re.source],Te.removeSource!==void 0?Te.removeSource(re,fe):fe()}loadWorkerSource(Y,re,fe){try{this.self.importScripts(re.url),fe()}catch(Te){fe(Te.toString())}}syncRTLPluginState(Y,re,fe){try{i.em.setState(re);const Te=i.em.getPluginURL();if(i.em.isLoaded()&&!i.em.isParsed()&&Te!=null){this.self.importScripts(Te);const be=i.em.isParsed();fe(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Te}`),be)}}catch(Te){fe(Te.toString())}}setDracoUrl(Y,re){this.dracoUrl=re}getAvailableImages(Y,re){this.availableImages[Y]||(this.availableImages[Y]={});let fe=this.availableImages[Y][re];return fe||(fe=[]),fe}getLayerIndex(Y,re){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let fe=this.layerIndexes[Y][re];return fe||(fe=this.layerIndexes[Y][re]=new ee,fe.scope=re),fe}getWorkerSource(Y,re,fe,Te){const be=this.workerSources;return be[Y]||(be[Y]={}),be[Y][Te]||(be[Y][Te]={}),be[Y][Te][re]||(be[Y][Te][re]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),be[Y][Te][re][fe]||(be[Y][Te][re][fe]=new this.workerSourceTypes[re]({send:(Pe,Ge,Re,qe,Ke,We)=>{this.actor.send(Pe,Ge,Re,Y,Ke,We)},scheduler:this.actor.scheduler},this.getLayerIndex(Y,Te),this.getAvailableImages(Y,Te),this.isSpriteLoaded[Y][Te],void 0,this.brightness)),be[Y][Te][re][fe]}rasterizeImages(Y,re,fe){const Te=new Map;for(const[be,{image:Pe,imageVariant:Ge}]of re.tasks.entries()){const Re=this.imageRasterizer.rasterize(Ge,Pe,re.scope,Y);Te.set(be,Re)}fe(void 0,Te)}removeRasterizedImages(Y,re,fe){this.imageRasterizer.removeImagesFromCacheByIds(re.imageIds,re.scope,Y),fe()}enforceCacheSizeLimit(Y,re){i.en(re)}getWorkerPerformanceMetrics(Y,re,fe){fe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Pc(self)),Pc}),R(["./shared"],function(i){var G="3.11.0";const W={create:"create",load:"load",fullLoad:"fullLoad"},H={mark(d){performance.mark(d)},measure(d,t,s){performance.measure(d,t,s)}};function ee(d){const t=d.name.split("?")[0];return i.a(t)&&t.includes("mapbox-gl.js")?"javascript":i.a(t)&&t.includes("mapbox-gl.css")?"css":i.b(t)?"fontRange":i.c(t)?"sprite":i.i(t)?"style":i.d(t)?"tilejson":"other"}var ne,de={},he=function(){if(ne)return de;function d(h){return!t(h)}function t(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,I=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(I);try{x=new Worker(P),g=!0}catch{g=!1}return x&&x.terminate(),URL.revokeObjectURL(P),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var I=x.getImageData(0,0,1,1);return I&&I.width===g.width}()?(s[m=h&&h.failIfMajorPerformanceCaveat]===void 0&&(s[m]=function(g){var x,I=function(P){var z=document.createElement("canvas"),L=Object.create(d.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=P,z.getContext("webgl2",L)}(g);if(!I)return!1;try{x=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!x||I.isContextLost())&&(I.shaderSource(x,"void main() {}"),I.compileShader(x),I.getShaderParameter(x,I.COMPILE_STATUS)===!0)}(m)),s[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}ne=1,de.supported=d,de.notSupportedReason=t;var s={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},de}();function ye(d,t,s){const h=document.createElement(d);return t!=null&&(h.className=t),s&&s.appendChild(h),h}function Le(d,t,s){const h=document.createElementNS("http://www.w3.org/2000/svg",d);for(const m of Object.keys(t))h.setAttributeNS(null,m,String(t[m]));return s&&s.appendChild(h),h}const je=typeof document<"u"?document.documentElement&&document.documentElement.style:null,xt=je&&je.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Dt;function ut(){je&&xt&&(Dt=je[xt],je[xt]="none")}function ht(){je&&xt&&(je[xt]=Dt)}function Et(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",Et,!0)}function tt(){window.addEventListener("click",Et,!0),window.setTimeout(()=>{window.removeEventListener("click",Et,!0)},0)}function At(d,t){const s=d.getBoundingClientRect();return gt(d,s,t)}function pt(d,t){const s=d.getBoundingClientRect(),h=[];for(let m=0;m<t.length;m++)h.push(gt(d,s,t[m]));return h}function at(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function gt(d,t,s){const h=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new i.P((s.clientX-t.left)*h,(s.clientY-t.top)*h)}const yt="01",sr="NO_ACCESS_TOKEN";class zr{constructor(t,s,h){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const t=function(){let s="";for(let h=0;h<10;h++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yt,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!i.f(t))return t;const h=Ir(t);return h.params.push(`sdk=js-${G}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!i.f(t))return t;const h=Ir(t);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeModelURL(t,s){if(!i.f(t))return t;const h=Ir(t);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeSourceURL(t,s,h,m){if(!i.f(t))return t;const g=Ir(t);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),h&&g.params.push(`language=${h}`),m&&g.params.push(`worldview=${m}`),this._makeAPIURL(g,this._customAccessToken||s)}normalizeIconsetURL(t,s){const h=Ir(t);return i.f(t)?(h.path=`/styles/v1${h.path}/iconset.pbf`,this._makeAPIURL(h,this._customAccessToken||s)):vr(h)}normalizeSpriteURL(t,s,h,m){const g=Ir(t);return i.f(t)?(g.path=`/styles/v1${g.path}/sprite${s}${h}`,this._makeAPIURL(g,this._customAccessToken||m)):(g.path+=`${s}${h}`,vr(g))}normalizeTileURL(t,s,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!i.f(t))return t;const m=Ir(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||h&&m.authority!=="raster"&&h===512?"@2x":""}${i.m.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${i.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${i.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${i.e.TILE_URL_VERSION}${m.path}`);const g=this._customAccessToken||function(x){for(const I of x){const P=I.match(/^access_token=(.*)$/);if(P)return P[1]}return null}(m.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,g)}canonicalizeTileURL(t,s){const h=Ir(t);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return t;let m="mapbox://";h.path.match(/^\/raster\/v1\//)?m+=`raster/${h.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${h.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${h.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let g=h.params;return s&&(g=g.filter(x=>!x.match(/^access_token=/))),g.length&&(m+=`?${g.join("&")}`),m}canonicalizeTileset(t,s){const h=!!s&&i.f(s),m=[];for(const g of t.tiles||[])i.h(g)?m.push(this.canonicalizeTileURL(g,h)):m.push(g);return m}_makeAPIURL(t,s){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=Ir(i.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){const g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return vr(t);if(s=s||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return t.params=t.params.filter(g=>g.indexOf("access_token")===-1),t.params.push(`access_token=${s||""}`),vr(t)}}const Zt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ir(d){const t=d.match(Zt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function vr(d){const t=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${t}`}const Vr="mapbox.eventData";function lr(d){if(!d)return null;const t=d.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(i.j(t[1]))}catch{return null}}class Hr{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=lr(i.e.ACCESS_TOKEN);let h="";return h=s&&s.u?i.k(s.u):i.e.ACCESS_TOKEN||"",t?`${Vr}.${t}:${h}`:`${Vr}:${h}`}fetchEventData(){const t=i.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{const m=localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));const g=localStorage.getItem(h);g&&(this.anonId=g)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const t=i.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid"),m=this.anonId;if(t&&m)try{localStorage.setItem(h,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,h,m){if(!i.e.EVENTS_URL)return;const g=Ir(i.e.EVENTS_URL);g.params.push(`access_token=${m||i.e.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(t).toISOString()},I=s?i.l(x,s):x,P={url:vr(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=i.p(P,z=>{this.pendingRequest=null,h(z),this.saveEventData(),this.processRequests(m)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const ur=new class extends Hr{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,t){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(s=>i.f(s)||i.h(s))&&this.queueRequest(Date.now(),t)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=lr(i.e.ACCESS_TOKEN),s=t?t.u:i.e.ACCESS_TOKEN;let h=s!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),h=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),x=new Date(m),I=(m-this.eventData.lastSuccess)/864e5;h=h||I>=1||I<-1||g.getDate()!==x.getDate()}else h=!0;h?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:yt,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=m,this.eventData.tokenU=s)},d):this.processRequests()}},rr=ur.postTurnstileEvent.bind(ur),$t=new class extends Hr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,t,s,h){this.skuToken=t,this.errorCb=h,i.e.EVENTS_URL&&(s||i.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},s):this.errorCb(new Error(sr)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:yt,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},d))}remove(){this.errorCb=null}},vi=$t.postMapLoadEvent.bind($t),hi=new class extends Hr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let t=this.mapInstanceIdMap.get(d);return t||(t=i.u(),this.mapInstanceIdMap.set(d,t)),t}getEventId(d){const t=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,t+1),t}postStyleLoadEvent(d,t){const{map:s,style:h,importedStyles:m}=t;if(!i.e.EVENTS_URL||!d&&!i.e.ACCESS_TOKEN)return;const g=this.getMapInstanceId(s),x={mapInstanceId:g,eventId:this.getEventId(g),style:h};m.length&&(x.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:x},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,()=>{},d)}},yn=hi.postStyleLoadEvent.bind(hi),Pt=new class extends Hr{constructor(){super("gljs.performance")}postPerformanceEvent(d,t){i.e.EVENTS_URL&&(d||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),h=function(m){const g=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),I=function(j){const X={};if(j){for(const q in j)if(q!=="other")for(const J of j[q]){const Q=`${q}ResolveRangeMin`,oe=`${q}ResolveRangeMax`,ue=`${q}RequestCount`,ce=`${q}RequestCachedCount`;X[Q]=Math.min(X[Q]||1/0,J.startTime),X[oe]=Math.max(X[oe]||-1/0,J.responseEnd);const ge=pe=>{X[pe]===void 0&&(X[pe]=0),++X[pe]};J.transferSize!==void 0&&J.transferSize===0&&ge(ce),ge(ue)}}return X}(function(j,X){const q={};if(j)for(const J of j){const Q=X(J);q[Q]===void 0&&(q[Q]=[]),q[Q].push(J)}return q}(g,ee)),P=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=z?z.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},B=(j,X,q)=>{q!=null&&j.push({name:X,value:q.toString()})};for(const j in I)B(F.counters,j,I[j]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(B(F.counters,"interactionRangeMin",m.interactionRange[0]),B(F.counters,"interactionRangeMax",m.interactionRange[1])),x)for(const j of Object.keys(W)){const X=W[j],q=x.find(J=>J.name===X);q&&B(F.counters,X,q.startTime)}return B(F.counters,"visibilityHidden",m.visibilityHidden),B(F.attributes,"style",function(j){if(j)for(const X of j){const q=X.name.split("?")[0];if(i.i(q)){const J=q.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}}(g)),B(F.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),B(F.attributes,"fogEnabled",m.fogEnabled?"true":"false"),B(F.attributes,"projection",m.projection),B(F.attributes,"zoom",m.zoom),B(F.metadata,"devicePixelRatio",P),B(F.metadata,"connectionEffectiveType",L),B(F.metadata,"navigatorUserAgent",navigator.userAgent),B(F.metadata,"screenWidth",window.screen.width),B(F.metadata,"screenHeight",window.screen.height),B(F.metadata,"windowWidth",window.innerWidth),B(F.metadata,"windowHeight",window.innerHeight),B(F.metadata,"mapWidth",m.width/P),B(F.metadata,"mapHeight",m.height/P),B(F.metadata,"webglRenderer",m.renderer),B(F.metadata,"webglVendor",m.vendor),B(F.metadata,"sdkVersion",G),B(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(s);for(const m of h.metadata);for(const m of h.counters);for(const m of h.attributes);this.postEvent(t,h,()=>{},d)}},er=Pt.postPerformanceEvent.bind(Pt),Kt=new class extends Hr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,t,s,h){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const m=Ir(i.e.API_URL+i.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${h||i.e.ACCESS_TOKEN||""}`);const g={url:vr(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(g,x=>{this.pendingRequest=null,s(x),this.saveEventData(),this.processRequests(h)})}getSessionAPI(d,t,s,h){this.skuToken=t,this.errorCb=h,i.e.SESSION_PATH&&i.e.API_URL&&(s||i.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},s):this.errorCb(new Error(sr)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},d)}remove(){this.errorCb=null}},te=Kt.getSessionAPI.bind(Kt),vn=new Set;class ke{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(i.I.toString(t)),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ve(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ae extends i.E{constructor(t){super(),this._images={},this._iconsets={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.patternsInFlight=new Set,this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}createScope(t){this._images[t]={},this._iconsets[t]={},this.loaded[t]=!1,this.updatedImages[t]=new Set,this.patterns[t]={},this.callbackDispatchedThisFrame[t]=new Set,this.atlasImage[t]=new i.r({width:1,height:1})}createIconset(t,s){this._iconsets[t][s]={}}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,s){if(this.loaded[s]!==t&&(this.loaded[s]=t,t)){for(const{ids:h,callback:m}of this.requestors)this._notify(h,s,m);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return(t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s])[t.name]}addImage(t,s,h){const m=t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s];this._validate(t,h)&&(m[t.name]=h)}_validate(t,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new i.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new i.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new i.z(new Error(`Image "${t.name}" has invalid "content" value`))),h=!1),h}_validateStretch(t,s){if(!t)return!0;let h=0;for(const m of t){if(m[0]<h||m[1]<m[0]||s<m[1])return!1;h=m[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,h){const m=t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s];h.version=m[t.name].version+1,m[t.name]=h,this.updatedImages[s].add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages[t].clear()}removeFromImageRasterizerCache(t,s){if(this.spriteFormat!=="raster")if(i.t()){const h={imageIds:[t],scope:s};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",h)}else this.imageRasterizer.removeImagesFromCacheByIds([t],s)}removeImage(t,s){const h=t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s],m=h[t.name];delete h[t.name],delete this.patterns[s][t.name],this.removeFromImageRasterizerCache(t,s),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(t){const s=[];for(const h of Object.keys(this._images[t]))s.push(new i.I(h));for(const h in this._iconsets[t])for(const m of Object.keys(this._iconsets[t][h]))s.push(new i.I({name:m,iconsetId:h}));return s}getImages(t,s,h){let m=!0;const g=!!this.loaded[s];if(!g)for(const x of t)(x.iconsetId?this._iconsets[s][x.iconsetId]:this._images[s])[x.name]||(m=!1);g||m?this._notify(t,s,h):this.requestors.push({ids:t,scope:s,callback:h})}rasterizeImages({scope:t,tasks:s},h){const m=new Map;for(const[g,x]of s.entries()){const I=this.getImage(x.id,t);I&&m.set(g,{image:I,imageVariant:x})}this._rasterizeImages(t,m,h)}_rasterizeImages(t,s,h){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:s,scope:t},h);else{const m=new Map;for(const[g,{image:x,imageVariant:I}]of s.entries())m.set(g,this.imageRasterizer.rasterize(I,x,t,0));h(void 0,m)}}getUpdatedImages(t){return this.updatedImages[t]||new Set}_notify(t,s,h){const m=new Map;for(const g of t){g.iconsetId&&(this._iconsets[s][g.iconsetId]=this._iconsets[s][g.iconsetId]||{});const x=(g.iconsetId?this._iconsets[s][g.iconsetId]:this._images[s])[g.name];if(!x){if(g.iconsetId)continue;i.w(`Image "${g.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new i.A("styleimagemissing",{id:g.name}));continue}const I={data:x.usvg?null:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,usvg:x.usvg,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)};x.usvg&&Object.assign(I,{width:x.icon.usvg_tree.width,height:x.icon.usvg_tree.height}),m.set(i.I.toString(g),I)}h(null,m)}getPixelSize(t){const{width:s,height:h}=this.atlasImage[t];return{width:s,height:h}}getPattern(t,s,h){const m=this.patterns[s][t.name],g=this.getImage(t,s);if(!g)return null;if(m){if(m.position.version===g.version)return m.position;m.position.version=g.version}else{if(g.usvg&&!g.data){const x=this.getPatternInFlightId(t.toString(),s);if(this.patternsInFlight.has(x))return null;this.patternsInFlight.add(x);const I=new i.B(t).scaleSelf(i.q.devicePixelRatio),P=new Map([[I.toString(),{image:g,imageVariant:I}]]);return this._rasterizeImages(s,P,(z,L)=>this.storePatternImage(I,s,g,h,L)),null}this.storePattern(t,s,g)}return this._updatePatternAtlas(s,h),this.patterns[s][t.name].position}getPatternInFlightId(t,s){return i.C(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,h,m,g){const x=t.toString(),I=g?g.get(x):void 0;I&&(h.data=I,this.storePattern(t.id,s,h),this._updatePatternAtlas(s,m),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,h){const m={w:h.data.width+2*i.F,h:h.data.height+2*i.F,x:0,y:0},g=new i.G(m,h,i.F);this.patterns[s][t.name]={bin:m,position:g}}bind(t,s){const h=t.gl;let m=this.atlasTexture[s];m?this.dirty&&(m.update(this.atlasImage[s]),this.dirty=!1):(m=new i.T(t,this.atlasImage[s],h.RGBA8),this.atlasTexture[s]=m),m.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const h=[];for(const I in this.patterns[t])h.push(this.patterns[t][I].bin);const{w:m,h:g}=i.H(h),x=this.atlasImage[t];x.resize({width:m||1,height:g||1});for(const I in this.patterns[t]){const{bin:P,position:z}=this.patterns[t][I];let L=z.padding;const F=P.x+L,B=P.y+L,j=this._images[t][I].data,X=j.width,q=j.height;L=L>1?L-1:L,i.r.copy(j,x,{x:0,y:0},{x:F,y:B},{width:X,height:q},s),i.r.copy(j,x,{x:0,y:q-L},{x:F,y:B-L},{width:X,height:L},s),i.r.copy(j,x,{x:0,y:0},{x:F,y:B+q},{width:X,height:L},s),i.r.copy(j,x,{x:X-L,y:0},{x:F-L,y:B},{width:L,height:q},s),i.r.copy(j,x,{x:0,y:0},{x:F+X,y:B},{width:L,height:q},s),i.r.copy(j,x,{x:X-L,y:q-L},{x:F-L,y:B-L},{width:L,height:L},s),i.r.copy(j,x,{x:0,y:q-L},{x:F+X,y:B-L},{width:L,height:L},s),i.r.copy(j,x,{x:0,y:0},{x:F+X,y:B+q},{width:L,height:L},s),i.r.copy(j,x,{x:X-L,y:0},{x:F-L,y:B+q},{width:L,height:L},s)}this.dirty=!0}beginFrame(){for(const t in this._images)this.callbackDispatchedThisFrame[t]=new Set}dispatchRenderCallbacks(t,s){for(const h of t){if(this.callbackDispatchedThisFrame[s].has(h.toString()))continue;this.callbackDispatchedThisFrame[s].add(h.toString());const m=(h.iconsetId?this._iconsets[s][h.iconsetId]:this._images[s])[h.name];Ve(m)&&this.updateImage(h,s,m)}}}function bt(d){const t=d.key,s=d.value,h=d.valueSpec||{},m=d.objectElementValidators||{},g=d.style,x=d.styleSpec;let I=[];const P=i.K(s);if(P!=="object")return[new i.V(t,s,`object expected, ${P} found`)];for(const z in s){const L=z.split(".")[0];let F;m[L]?F=m[L]:h[L]?F=Pr:m["*"]?F=m["*"]:h["*"]&&(F=Pr),F?I=I.concat(F({key:(t&&`${t}.`)+z,value:s[z],valueSpec:h[L]||h["*"],style:g,styleSpec:x,object:s,objectKey:z},s)):I.push(new i.J(t,s[z],`unknown property "${z}"`))}for(const z in h)m[z]||h[z].required&&h[z].default===void 0&&s[z]===void 0&&I.push(new i.V(t,s,`missing required property "${z}"`));return I}function Vt(d){const t=d.value,s=d.valueSpec,h=d.style,m=d.styleSpec,g=d.key,x=d.arrayElementValidator||Pr;if(i.K(t)!=="array")return[new i.V(g,t,`array expected, ${i.K(t)} found`)];if(s.length&&t.length!==s.length)return[new i.V(g,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new i.V(g,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let I={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};m.$version<7&&(I.function=s.function),i.K(s.value)==="object"&&(I=s.value);let P=[];for(let z=0;z<t.length;z++)P=P.concat(x({array:t,arrayIndex:z,value:t[z],valueSpec:I,style:h,styleSpec:m,key:`${g}[${z}]`},!0));return P}function zt(d){const t=d.key,s=d.value,h=d.valueSpec;let m=i.K(s);if(m==="number"&&s!=s&&(m="NaN"),m!=="number")return[new i.V(t,s,`number expected, ${m} found`)];if("minimum"in h){let g=h.minimum;if(i.K(h.minimum)==="array"&&(g=h.minimum[d.arrayIndex]),s<g)return[new i.V(t,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in h){let g=h.maximum;if(i.K(h.maximum)==="array"&&(g=h.maximum[d.arrayIndex]),s>g)return[new i.V(t,s,`${s} is greater than the maximum value ${g}`)]}return[]}function Rt(d){const t=d.valueSpec,s=i.M(d.value.type);let h,m,g,x={};const I=s!=="categorical"&&d.value.property===void 0,P=!I,z=i.K(d.value.stops)==="array"&&i.K(d.value.stops[0])==="array"&&i.K(d.value.stops[0][0])==="object",L=bt({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(j){if(s==="identity")return[new i.V(j.key,j.value,'identity function may not have a "stops" property')];let X=[];const q=j.value;return X=X.concat(Vt({key:j.key,value:q,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:F})),i.K(q)==="array"&&q.length===0&&X.push(new i.V(j.key,q,"array must have at least one stop")),X},default:function(j){return Pr({key:j.key,value:j.value,valueSpec:t,style:j.style,styleSpec:j.styleSpec})}}});return s==="identity"&&I&&L.push(new i.V(d.key,d.value,'missing required property "property"')),s==="identity"||d.value.stops||L.push(new i.V(d.key,d.value,'missing required property "stops"')),s==="exponential"&&d.valueSpec.expression&&!i.N(d.valueSpec)&&L.push(new i.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(P&&!i.O(d.valueSpec)?L.push(new i.V(d.key,d.value,"property functions not supported")):I&&!i.Q(d.valueSpec)&&L.push(new i.V(d.key,d.value,"zoom functions not supported"))),s!=="categorical"&&!z||d.value.property!==void 0||L.push(new i.V(d.key,d.value,'"property" property is required')),L;function F(j){let X=[];const q=j.value,J=j.key;if(i.K(q)!=="array")return[new i.V(J,q,`array expected, ${i.K(q)} found`)];if(q.length!==2)return[new i.V(J,q,`array length 2 expected, length ${q.length} found`)];if(z){if(i.K(q[0])!=="object")return[new i.V(J,q,`object expected, ${i.K(q[0])} found`)];if(q[0].zoom===void 0)return[new i.V(J,q,"object stop key must have zoom")];if(q[0].value===void 0)return[new i.V(J,q,"object stop key must have value")];const Q=i.M(q[0].zoom);if(typeof Q!="number")return[new i.V(J,q[0].zoom,"stop zoom values must be numbers")];if(g&&g>Q)return[new i.V(J,q[0].zoom,"stop zoom values must appear in ascending order")];Q!==g&&(g=Q,m=void 0,x={}),X=X.concat(bt({key:`${J}[0]`,value:q[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:zt,value:B}}))}else X=X.concat(B({key:`${J}[0]`,value:q[0],style:j.style,styleSpec:j.styleSpec},q));return i.S(i.U(q[1]))?X.concat([new i.V(`${J}[1]`,q[1],"expressions are not allowed in function stops.")]):X.concat(Pr({key:`${J}[1]`,value:q[1],valueSpec:t,style:j.style,styleSpec:j.styleSpec}))}function B(j,X){const q=i.K(j.value),J=i.M(j.value),Q=j.value!==null?j.value:X;if(h){if(q!==h)return[new i.V(j.key,Q,`${q} stop domain type must match previous stop domain type ${h}`)]}else h=q;if(q!=="number"&&q!=="string"&&q!=="boolean"&&typeof J!="number"&&typeof J!="string"&&typeof J!="boolean")return[new i.V(j.key,Q,"stop domain value must be a number, string, or boolean")];if(q!=="number"&&s!=="categorical"){let oe=`number expected, ${q} found`;return i.O(t)&&s===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(j.key,Q,oe)]}return s!=="categorical"||q!=="number"||typeof J=="number"&&isFinite(J)&&Math.floor(J)===J?s!=="categorical"&&q==="number"&&typeof J=="number"&&typeof m=="number"&&m!==void 0&&J<m?[new i.V(j.key,Q,"stop domain values must appear in ascending order")]:(m=J,s==="categorical"&&J in x?[new i.V(j.key,Q,"stop domain values must be unique")]:(x[J]=!0,[])):[new i.V(j.key,Q,`integer expected, found ${String(J)}`)]}}function jt(d){const t=(d.expressionContext==="property"?i.W:i.X)(i.U(d.value),d.valueSpec);if(t.result==="error")return t.value.map(h=>new i.V(`${d.key}${h.key}`,d.value,h.message));const s=t.value.expression||t.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!s.outputDefined())return[new i.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!i.Y(s))return[new i.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Yt(s,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!i.Z(s,["zoom","feature-state"]))return[new i.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!i._(s))return[new i.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yt(d,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)s.delete(m);if(s.size===0)return[];const h=[];return d instanceof i.$&&s.has(d.name)?[new i.V(t.key,t.value,`["${d.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(d.eachChild(m=>{h.push(...Yt(m,t))}),h)}function Gt(d){const t=d.key,s=d.value,h=d.valueSpec,m=[];return Array.isArray(h.values)?h.values.indexOf(i.M(s))===-1&&m.push(new i.V(t,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(i.M(s))===-1&&m.push(new i.V(t,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function Cr(d){return i.a1(i.U(d.value))?jt(i.L({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):cr(d)}function cr(d){const t=d.value,s=d.key;if(i.K(t)!=="array")return[new i.V(s,t,`array expected, ${i.K(t)} found`)];const h=d.styleSpec;let m,g=[];if(t.length<1)return[new i.V(s,t,"filter array must have at least 1 element")];switch(g=g.concat(Gt({key:`${s}[0]`,value:t[0],valueSpec:h.filter_operator,style:d.style,styleSpec:d.styleSpec})),i.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&i.M(t[1])==="$type"&&g.push(new i.V(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new i.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=i.K(t[1]),m!=="string"&&g.push(new i.V(`${s}[1]`,t[1],`string expected, ${m} found`)));for(let x=2;x<t.length;x++)m=i.K(t[x]),i.M(t[1])==="$type"?g=g.concat(Gt({key:`${s}[${x}]`,value:t[x],valueSpec:h.geometry_type,style:d.style,styleSpec:d.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&g.push(new i.V(`${s}[${x}]`,t[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)g=g.concat(cr({key:`${s}[${x}]`,value:t[x],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":m=i.K(t[1]),t.length!==2?g.push(new i.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&g.push(new i.V(`${s}[1]`,t[1],`string expected, ${m} found`))}return g}function Ye(d,t){const s=d.key,h=d.style,m=d.layer,g=d.styleSpec,x=d.value,I=d.objectKey,P=g[`${t}_${d.layerType}`];if(!P)return[];const z=I.match(/^(.*)-use-theme$/);if(t==="paint"&&z&&P[z[1]])return i.S(x)?[].concat(Pr({key:d.key,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:I})):Pr({key:s,value:x,valueSpec:{type:"string"},style:h,styleSpec:g});const L=I.match(/^(.*)-transition$/);if(t==="paint"&&L&&P[L[1]]&&P[L[1]].transition)return Pr({key:s,value:x,valueSpec:g.transition,style:h,styleSpec:g});const F=d.valueSpec||P[I];if(!F)return[new i.J(s,x,`unknown property "${I}"`)];let B;if(i.K(x)==="string"&&i.O(F)&&!F.tokens&&(B=/^{([^}]+)}$/.exec(x))){const X=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new i.V(s,x,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${X}.`)]}const j=[];if(d.layerType==="symbol")I!=="text-field"||!h||h.glyphs||h.imports||j.push(new i.V(s,x,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&i.a2(i.U(x))&&i.M(x.type)==="identity"&&j.push(new i.V(s,x,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&i.O(F)&&(i.a3(F)||i.Q(F))){const X=i.W(i.U(x),F),q=X.value.expression||X.value._styleExpression.expression;q&&!i.Z(q,["measure-light"])&&(I==="model-emissive-strength"&&i._(q)&&i.Y(q)||j.push(new i.V(s,x,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(Pr({key:d.key,value:x,valueSpec:F,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:I}))}function Jt(d){return Ye(d,"paint")}function $r(d){return Ye(d,"layout")}function xn(d){let t=[];const s=d.value,h=d.key,m=d.style,g=d.styleSpec;s.type||s.ref||t.push(new i.V(h,s,'either "type" or "ref" is required'));let x=i.M(s.type);const I=i.M(s.ref);if(s.id){const P=i.M(s.id);for(let z=0;z<d.arrayIndex;z++){const L=m.layers[z];i.M(L.id)===P&&t.push(new i.V(h,s.id,`duplicate layer id "${s.id}", previously used at line ${L.id.__line__}`))}}if("ref"in s){let P;["type","source","source-layer","filter","layout"].forEach(z=>{z in s&&t.push(new i.V(h,s[z],`"${z}" is prohibited for ref layers`))}),m.layers.forEach(z=>{i.M(z.id)===I&&(P=z)}),P?P.ref?t.push(new i.V(h,s.ref,"ref cannot reference another ref layer")):x=i.M(P.type):typeof I=="string"&&t.push(new i.V(h,s.ref,`ref layer "${I}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(s.source){const P=m.sources&&m.sources[s.source],z=P&&i.M(P.type);P?z==="vector"&&x==="raster"?t.push(new i.V(h,s.source,`layer "${s.id}" requires a raster source`)):z==="raster"&&x!=="raster"?t.push(new i.V(h,s.source,`layer "${s.id}" requires a vector source`)):z!=="vector"||s["source-layer"]?z==="raster-dem"&&x!=="hillshade"?t.push(new i.V(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||z==="geojson"&&P.lineMetrics?x==="raster-particle"&&z!=="raster-array"&&t.push(new i.V(h,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new i.V(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new i.V(h,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new i.V(h,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new i.V(h,s.source,`source "${s.source}" not found`))}else t.push(new i.V(h,s,'missing required property "source"'));return t=t.concat(bt({key:h,value:s,valueSpec:g.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pr({key:`${h}.type`,value:s.type,valueSpec:g.layer.type,style:d.style,styleSpec:d.styleSpec,object:s,objectKey:"type"}),filter:P=>Cr(i.L({layerType:x},P)),layout:P=>bt({layer:s,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":z=>$r(i.L({layerType:x},z))}}),paint:P=>bt({layer:s,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":z=>Jt(i.L({layerType:x,layer:s},z))}})}})),t}function Ur(d){const t=d.value,s=d.key,h=i.K(t);return h!=="string"?[new i.V(s,t,`string expected, ${h} found`)]:[]}const xi={promoteId:function d({key:t,value:s}){if(i.K(s)==="string")return Ur({key:t,value:s});if(Array.isArray(s)){const h=[],m=i.U(s),g=i.X(m);return g.result==="error"&&g.value.forEach(x=>{h.push(new i.V(`${t}${x.key}`,null,`${x.message}`))}),i.Z(g.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||h.push(new i.V(`${t}`,null,"promoteId expression should be only feature dependent")),h}{const h=[];for(const m in s)h.push(...d({key:`${t}.${m}`,value:s[m]}));return h}}};function ri(d){const t=d.value,s=d.key,h=d.styleSpec,m=d.style;if(!t.type)return[new i.V(s,t,'"type" is required')];const g=i.M(t.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&(t.url||t.tiles||x.push(new i.J(s,t,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(bt({key:s,value:t,valueSpec:h[`source_${g.replace("-","_")}`],style:d.style,styleSpec:h,objectElementValidators:xi})),x;case"geojson":if(x=bt({key:s,value:t,valueSpec:h.source_geojson,style:m,styleSpec:h,objectElementValidators:xi}),t.cluster)for(const I in t.clusterProperties){const[P,z]=t.clusterProperties[I],L=typeof P=="string"?[P,["accumulated"],["get",I]]:P;x.push(...jt({key:`${s}.${I}.map`,value:z,expressionContext:"cluster-map"})),x.push(...jt({key:`${s}.${I}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return bt({key:s,value:t,valueSpec:h.source_video,style:m,styleSpec:h});case"image":return bt({key:s,value:t,valueSpec:h.source_image,style:m,styleSpec:h});case"canvas":return[new i.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gt({key:`${s}.type`,value:t.type,valueSpec:{values:Ki(h)}})}}function Ki(d){return d.source.reduce((t,s)=>{const h=d[s];return h.type.type==="enum"&&(t=t.concat(Object.keys(h.type.values))),t},[])}function ki(d){const t=d.value,s=d.styleSpec,h=s.light,m=d.style;let g=[];const x=i.K(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new i.V("light",t,`object expected, ${x} found`)]),g;for(const I in t){const P=I.match(/^(.*)-transition$/),z=I.match(/^(.*)-use-theme$/);g=g.concat(z&&h[z[1]]?Pr({key:I,value:t[I],valueSpec:{type:"string"},style:m,styleSpec:s}):P&&h[P[1]]&&h[P[1]].transition?Pr({key:I,value:t[I],valueSpec:s.transition,style:m,styleSpec:s}):h[I]?Pr({key:I,value:t[I],valueSpec:h[I],style:m,styleSpec:s}):[new i.V(I,t[I],`unknown property "${I}"`)])}return g}function ys(d){const t=d.value;let s=[];if(!t)return s;const h=i.K(t);if(h!=="object")return s=s.concat([new i.V("light-3d",t,`object expected, ${h} found`)]),s;const m=d.styleSpec,g=m["light-3d"],x=d.key,I=d.style,P=d.style.lights;for(const F of["type","id"])if(!(F in t))return s=s.concat([new i.V("light-3d",t,`missing property ${F} on light`)]),s;if(t.type&&P)for(let F=0;F<d.arrayIndex;F++){const B=i.M(t.type),j=P[F];i.M(j.type)===B&&s.push(new i.V(x,t.id,`duplicate light type "${t.type}", previously defined at line ${j.id.__line__}`))}const z=`properties_light_${t.type}`;if(!(z in m))return s=s.concat([new i.V("light-3d",t,`Invalid light type ${t.type}`)]),s;const L=m[z];for(const F in t)if(F==="properties"){const B=t[F],j=i.K(B);if(j!=="object")return s=s.concat([new i.V("properties",B,`object expected, ${j} found`)]),s;for(const X in B)s=s.concat(L[X]?Pr({key:X,value:B[X],valueSpec:L[X],style:I,styleSpec:m}):[new i.J(d.key,B[X],`unknown property "${X}"`)])}else{const B=F.match(/^(.*)-transition$/),j=F.match(/^(.*)-use-theme$/);s=s.concat(j&&g[j[1]]?Pr({key:F,value:t[F],valueSpec:{type:"string"},style:I,styleSpec:m}):B&&g[B[1]]&&g[B[1]].transition?Pr({key:F,value:t[F],valueSpec:m.transition,style:I,styleSpec:m}):g[F]?Pr({key:F,value:t[F],valueSpec:g[F],style:I,styleSpec:m}):[new i.J(F,t[F],`unknown property "${F}"`)])}return s}function bo(d){const t=d.value,s=d.key,h=d.style,m=d.styleSpec,g=m.terrain;let x=[];const I=i.K(t);if(t===void 0||I==="null")return x;if(I!=="object")return x=x.concat([new i.V("terrain",t,`object expected, ${I} found`)]),x;for(const P in t){const z=P.match(/^(.*)-transition$/),L=P.match(/^(.*)-use-theme$/);x=x.concat(L&&g[L[1]]?Pr({key:P,value:t[P],valueSpec:{type:"string"},style:h,styleSpec:m}):z&&g[z[1]]&&g[z[1]].transition?Pr({key:P,value:t[P],valueSpec:m.transition,style:h,styleSpec:m}):g[P]?Pr({key:P,value:t[P],valueSpec:g[P],style:h,styleSpec:m}):[new i.J(P,t[P],`unknown property "${P}"`)])}if(t.source){const P=h.sources&&h.sources[t.source],z=P&&i.M(P.type);P?z!=="raster-dem"&&x.push(new i.V(s,t.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):x.push(new i.V(s,t.source,`source "${t.source}" not found`))}else x.push(new i.V(s,t,'terrain is missing required property "source"'));return x}function Jn(d){const t=d.value,s=d.style,h=d.styleSpec,m=h.fog;let g=[];const x=i.K(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new i.V("fog",t,`object expected, ${x} found`)]),g;for(const I in t){const P=I.match(/^(.*)-transition$/),z=I.match(/^(.*)-use-theme$/);g=g.concat(z&&m[z[1]]?Pr({key:I,value:t[I],valueSpec:{type:"string"},style:s,styleSpec:h}):P&&m[P[1]]&&m[P[1]].transition?Pr({key:I,value:t[I],valueSpec:h.transition,style:s,styleSpec:h}):m[I]?Pr({key:I,value:t[I],valueSpec:m[I],style:s,styleSpec:h}):[new i.J(I,t[I],`unknown property "${I}"`)])}return g}const Fi={"*":()=>[],array:Vt,boolean:function(d){const t=d.value,s=d.key,h=i.K(t);return h!=="boolean"?[new i.V(s,t,`boolean expected, ${h} found`)]:[]},number:zt,color:function(d){const t=d.key,s=d.value,h=i.K(s);return h!=="string"?[new i.V(t,s,`color expected, ${h} found`)]:i.a0.parseCSSColor(s)===null?[new i.V(t,s,`color expected, "${s}" found`)]:[]},enum:Gt,filter:Cr,function:Rt,layer:xn,object:bt,source:ri,model:i.a4,light:ki,"light-3d":ys,terrain:bo,fog:Jn,string:Ur,formatted:function(d){return Ur(d).length===0?[]:jt(d)},resolvedImage:function(d){return Ur(d).length===0?[]:jt(d)},projection:function(d){const t=d.value,s=d.styleSpec,h=s.projection,m=d.style;let g=[];const x=i.K(t);if(x==="object")for(const I in t)g=g.concat(Pr({key:I,value:t[I],valueSpec:h[I],style:m,styleSpec:s}));else x!=="string"&&(g=g.concat([new i.V("projection",t,`object or string expected, ${x} found`)]));return g},import:function(d){const{value:t,styleSpec:s}=d,{data:h,...m}=t;Object.defineProperty(m,"__line__",{value:t.__line__,enumerable:!1});let g=bt(i.L({},d,{value:m,valueSpec:s.import}));return i.M(m.id)===""&&g.push(new i.V(`${d.key}.id`,m,"import id can't be an empty string")),h&&(g=g.concat(xl(h,s,{key:`${d.key}.data`}))),g},iconset:function(d){const t=d.value,s=d.key,h=d.styleSpec,m=d.style;if(!t.type)return[new i.V(s,t,'"type" is required')];const g=i.M(t.type);let x=[];if(x=x.concat(bt({key:s,value:t,valueSpec:h[`iconset_${g}`],style:m,styleSpec:h})),g==="source"&&t.source){const I=m.sources&&m.sources[t.source],P=I&&i.M(I.type);I?P!=="raster-array"&&x.push(new i.V(s,t.source,`iconset cannot be used with a source of type ${String(P)}, it only be used with a "raster-array" source type`)):x.push(new i.V(s,t.source,`source "${t.source}" not found`))}return x}};function Pr(d,t=!1){const s=d.value,h=d.valueSpec,m=d.styleSpec;if(h.expression&&i.a2(i.M(s)))return Rt(d);if(h.expression&&i.S(i.U(s)))return jt(d);if(h.type&&Fi[h.type]){const g=Fi[h.type](d);return t===!0&&g.length>0&&i.K(d.value)==="array"?jt(d):g}return bt(i.L({},d,{valueSpec:h.type?m[h.type]:h}))}function wo(d){const t=d.value,s=d.key,h=Ur(d);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new i.V(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new i.V(s,t,'"glyphs" url must include a "{range}" token'))),h}function xl(d,t=i.a5,s={}){return Pr({key:s.key||"",value:d,valueSpec:t.$root,styleSpec:t,style:d,objectElementValidators:{glyphs:wo,"*":()=>[]}})}function vs(d,t=i.a5){return be(xl(d,t))}const Ua=d=>be(ri(d)),ja=d=>be(ki(d)),Cc=d=>be(ys(d)),bl=d=>be(bo(d)),Gu=d=>be(Jn(d)),Hu=d=>be(function(t){const s=t.value,h=t.style,m=t.styleSpec,g=m.snow;let x=[];const I=i.K(s);if(s===void 0)return x;if(I!=="object")return x=x.concat([new i.V("snow",s,`object expected, ${I} found`)]),x;for(const P in s){const z=P.match(/^(.*)-transition$/);x=x.concat(z&&g[z[1]]&&g[z[1]].transition?Pr({key:P,value:s[P],valueSpec:m.transition,style:h,styleSpec:m}):g[P]?Pr({key:P,value:s[P],valueSpec:g[P],style:h,styleSpec:m}):[new i.J(P,s[P],`unknown property "${P}"`)])}return x}(d)),Pc=d=>be(function(t){const s=t.value,h=t.style,m=t.styleSpec,g=m.rain;let x=[];const I=i.K(s);if(s===void 0)return x;if(I!=="object")return x=x.concat([new i.V("rain",s,`object expected, ${I} found`)]),x;for(const P in s){const z=P.match(/^(.*)-transition$/);x=x.concat(z&&g[z[1]]&&g[z[1]].transition?Pr({key:P,value:s[P],valueSpec:m.transition,style:h,styleSpec:m}):g[P]?Pr({key:P,value:s[P],valueSpec:g[P],style:h,styleSpec:m}):[new i.J(P,s[P],`unknown property "${P}"`)])}return x}(d)),Xe=d=>be(xn(d)),Y=d=>be(Cr(d)),re=d=>be(Jt(d)),fe=d=>be($r(d)),Te=d=>be(i.a4(d));function be(d){return d.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function Pe(d,t){let s=!1;if(t&&t.length)for(const h of t)h instanceof i.J?i.w(h.message):(d.fire(new i.z(new Error(h.message))),s=!0);return s}let Ge;class Re extends i.E{constructor(t,s="flat"){super(),this._transitionable=new i.a6(Ge||(Ge=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,h={}){this._validate(ja,t,h)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Pe(this,t.call(vs,i.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let qe=class extends i.E{constructor(d,t,s,h){super(),this.scope=s,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),s,h),this._transitionable.setTransitionOrValue(d,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(d,t){this._transitionable.setTransitionOrValue(d,t)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new i.aa(d)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const t=d.value.expression;if(!t)return null;let s=-1,h=-1,m=1;for(const g of t.zoomStops)m=t.evaluate(new i.aa(g)),m>.01?(s=g,h=-1):h=g;return m<.01&&s>0&&h>s?[s,h]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof i.ab}};const Ke=45,We=65,mt=.05;function Nt(d,t,s,h){const m=i.ae(Ke,We,s),[g,x]=Ut(d,h);let I=1-Math.min(1,Math.exp((t-g)/(x-g)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*m*d.alpha}function Ut(d,t){const s=.5/Math.tan(.5*t);return[d.range[0]+s,d.range[1]+s]}function xr(d,t,s,h,m){const g=i.ad.vec3.transformMat4([],[t,s,h],m.mercatorFogMatrix);return Nt(d,i.ad.vec3.length(g),m.pitch,m._fov)}function Tr(d,t,s,h,m,g,x){const I=[[s,h,0],[m,h,0],[m,g,0],[s,g,0]];let P=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const L of I){const F=i.ad.vec3.transformMat4([],L,t),B=i.ad.vec3.length(F);P=Math.min(P,B),z=Math.max(z,B)}return[Nt(d,P,x.pitch,x._fov),Nt(d,z,x.pitch,x._fov)]}class Er extends i.E{constructor(t,s,h,m){super();const g=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(g,h,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new i.af(g),this.scope=h}get state(){const t=this._transform,s=t.projection.name==="globe",h=i.ag(t.zoom),m=this.properties.get("range"),g=[.5,3];return{range:s?[i.ah(g[0],m[0],h),i.ah(g[1],m[1],h)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,h={}){if(this._validate(Gu,t,h))return;const m=i.l({},t);for(const g of Object.keys(i.a5.fog))m[g]===void 0&&(m[g]=i.a5.fog[g].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ae(Ke,We,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(h,m,g){const x=i.ac.fromLngLat(m),I=g.elevation?g.elevation.getAtPointOrZero(x):0;return xr(h,x.x,x.y,I,g)}(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Tr(this.state,s,0,0,i.ai,i.ai,this._transform)}getOpacityForBounds(t,s,h,m,g){return this._transform.projection.supportsFog?Tr(this.state,t,s,h,m,g,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ut(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const h of s){const m=t.points[h];let g;if(m[2]>=0)g=m;else{const x=t.points[h-4];g=i.aj(x,m,x[2]/(x[2]-m[2]))}if(xr(this.state,g[0],g[1],0,this._transform)>=mt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Pe(this,t.call(vs,i.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Ar,Sn,Un,Or,un=class extends i.E{constructor(d,t,s,h){super();const m=Ar||(Ar=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(m,s,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(m),this.scope=s}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=i.ak(s[0]),m=-Math.max(i.ak(s[1]),.01),g=[Math.cos(h)*Math.cos(m),Math.sin(h)*Math.cos(m),Math.sin(m)],x=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(t.r,t.g,t.b,t.a*d),direction:g,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(d,t,s={}){if(this._validate(Hu,d,s))return;const h=i.l({},d);for(const m of Object.keys(i.a5.snow))h[m]===void 0&&(h[m]=i.a5.snow[m].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,s){return(!s||s.validate!==!1)&&Pe(this,d.call(vs,i.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},ln=class extends i.E{constructor(d,t,s,h){super();const m=Sn||(Sn=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(m,s,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(m),this.scope=s}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=i.ak(s[0]),m=-Math.max(i.ak(s[1]),.01),g=[Math.cos(h)*Math.cos(m),Math.sin(h)*Math.cos(m),Math.sin(m)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(t.r,t.g,t.b,t.a*d),direction:g,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(d,t,s={}){if(this._validate(Pc,d,s))return;const h=i.l({},d);for(const m of Object.keys(i.a5.rain))h[m]===void 0&&(h[m]=i.a5.rain[m].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,s){return(!s||s.validate!==!1)&&Pe(this,d.call(vs,i.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class cn extends i.E{constructor(t,s,h,m){super(),this.scope=h,this._options=t,this.properties=new i.af(s),this._transitionable=new i.a6(s,h,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Qn{constructor(t,s,h,m){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(t,s){let h,m;if(t instanceof i.P||typeof t[0]=="number"){const g=i.P.convert(t);h=[g],m=s.isPointAboveHorizon(g)}else{const g=i.P.convert(t[0]),x=i.P.convert(t[1]);h=[g,x],m=i.an(g,x).every(I=>s.isPointAboveHorizon(I))}return new Qn(h,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return i.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],m=i.an(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),i.ao(m,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],m=i.an(s,h,t),g=this.cameraPoint.clone();switch(3*((g.y>s.y)+(g.y>h.y))+((g.x>s.x)+(g.x>h.x))){case 0:m[0]=g,m[4]=g.clone();break;case 1:m.splice(1,0,g);break;case 2:m[1]=g;break;case 3:m.splice(4,0,g);break;case 5:m.splice(2,0,g);break;case 6:m[3]=g;break;case 7:m.splice(3,0,g);break;case 8:m[2]=g}return m}containsTile(t,s,h,m=0){const g=t.queryPadding/s._pixelsPerMercatorPixel+1,x=h?this._bufferedCameraMercator(g,s):this._bufferedScreenMercator(g,s);let I=t.tileID.wrap+(x.unwrapped?m:0);const P=x.polygon.map(J=>i.ap(t.tileTransform,J,I));if(!i.aq(P,0,0,i.ai,i.ai))return;I=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const z=this.screenGeometryMercator.polygon.map(J=>i.ar(t.tileTransform,J,I)),L=z.map(J=>new i.P(J[0],J[1])),F=s.getFreeCameraOptions().position||new i.ac(0,0,0),B=i.ar(t.tileTransform,F,I),j=z.map(J=>{const Q=i.ad.vec3.sub(J,J,B);return i.ad.vec3.normalize(Q,Q),new i.as(B,Q)}),X=i.at(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:j,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(q=i.au(P),q.min.x=i.ay(q.min.x,0,i.ai),q.min.y=i.ay(q.min.y,0,i.ai),q.max.x=i.ay(q.max.x,0,i.ai),q.max.y=i.ay(q.max.y,0,i.ai),q),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:X};var q}_bufferedScreenMercator(t,s){const h=Bo(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map(g=>s.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(t,s){const h=Bo(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map(g=>s.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[h]=m,m}}_projectAndResample(t,s){const h=function(g,x){const I=i.ad.mat4.multiply([],x.pixelMatrix,x.globeMatrix),P=[0,-i.az,0,1],z=[0,i.az,0,1],L=[0,0,0,1];i.ad.vec4.transformMat4(P,P,I),i.ad.vec4.transformMat4(z,z,I),i.ad.vec4.transformMat4(L,L,I);const F=new i.P(P[0]/P[3],P[1]/P[3]),B=new i.P(z[0]/z[3],z[1]/z[3]),j=i.aw(g,F)&&P[3]<L[3],X=i.aw(g,B)&&z[3]<L[3];if(!j&&!X)return null;const q=function(_e,me,we){for(let Ee=1;Ee<_e.length;Ee++){const He=Si(me.pointCoordinate3D(_e[Ee-1]).x),Be=Si(me.pointCoordinate3D(_e[Ee]).x);if(we<0){if(He<Be)return{idx:Ee,t:-He/(Be-1-He)}}else if(Be<He)return{idx:Ee,t:(1-He)/(Be+1-He)}}return null}(g,x,j?-1:1);if(!q)return null;const{idx:J,t:Q}=q;let oe=J>1?bi(g.slice(0,J),x):[],ue=J<g.length?bi(g.slice(J),x):[];oe=oe.map(_e=>new i.P(Si(_e.x),_e.y)),ue=ue.map(_e=>new i.P(Si(_e.x),_e.y));const ce=[...oe];ce.length===0&&ce.push(ue[ue.length-1]);const ge=i.ah(ce[ce.length-1].y,(ue.length===0?oe[0]:ue[0]).y,Q);let pe;return pe=j?[new i.P(0,ge),new i.P(0,0),new i.P(1,0),new i.P(1,ge)]:[new i.P(1,ge),new i.P(1,1),new i.P(0,1),new i.P(0,ge)],ce.push(...pe),ue.length===0?ce.push(oe[0]):ce.push(...ue),{polygon:ce.map(_e=>new i.ac(_e.x,_e.y)),unwrapped:!1}}(t,s);if(h)return h;const m=function(g,x){let I=!1,P=-1/0,z=0;for(let F=0;F<g.length-1;F++)g[F].x>P&&(P=g[F].x,z=F);for(let F=0;F<g.length-1;F++){const B=(z+F)%(g.length-1),j=g[B],X=g[B+1];Math.abs(j.x-X.x)>.5&&(j.x<X.x?(j.x+=1,B===0&&(g[g.length-1].x+=1)):(X.x+=1,B+1===g.length-1&&(g[0].x+=1)),I=!0)}const L=i.av(x.center.lng);return I&&L<Math.abs(L-1)&&g.forEach(F=>{F.x-=1}),{polygon:g,unwrapped:I}}(bi(t,s).map(g=>new i.P(Si(g.x),g.y)),s);return{polygon:m.polygon.map(g=>new i.ac(g.x,g.y)),unwrapped:m.unwrapped}}}function bi(d,t){return i.ax(d,s=>{const h=t.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function Si(d){return d<0?1+d%1:d%1}function Bo(d){return 100*d|0}function Bi(d,t,s,h,m){const g=function(I,P){if(I)return m(I);if(P){if(d.url&&P.tiles&&d.tiles&&delete d.tiles,P.variants){if(!Array.isArray(P.variants))return m(new Error("variants must be an array"));for(const L of P.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return m(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){P=i.l(P,L);break}}}const z=i.aA(i.l({},P,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=t.canonicalizeTileset(z,d.url),m(null,z)}},x=function(I,P,z){if(!I)return null;if(!P&&!z)return I;z=z||I.worldview_default;const L=Object.values(I.language||{});if(L.length===0)return null;const F=Object.values(I.worldview||{});if(F.length===0)return null;const B=L.every(X=>X===P),j=F.every(X=>X===z);return B&&j?I:P in(I.language_options||{})||z in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null}(d.data,s,h);return x?i.q.frame(()=>g(null,x)):d.url?i.n(t.transformRequest(t.normalizeSourceURL(d.url,null,s,h),i.R.Source),g):i.q.frame(()=>{const{data:I,...P}=d;g(null,P)})}class pi{constructor(t,s,h){this.bounds=i.aB.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),h=Math.floor(i.av(this.bounds.getWest())*s),m=Math.floor(i.aC(this.bounds.getNorth())*s),g=Math.ceil(i.av(this.bounds.getEast())*s),x=Math.ceil(i.aC(this.bounds.getSouth())*s);return t.x>=h&&t.x<g&&t.y>=m&&t.y<x}}class Ni extends i.E{constructor(t,s,h,m){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.aA(s,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new i.aD}load(t){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Bi(this._options,this.map._requestManager,s,h,(m,g)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new i.z(m));else if(g){if(i.l(this,g),this.hasWorldviews=!!g.worldview_options,g.worldview_default&&(this.worldviewDefault=g.worldview_default),g.vector_layers){this.vectorLayers=g.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const x of g.vector_layers)this.vectorLayerIds.push(x.id),g.worldview&&g.worldview[x.source]&&this.localizableLayerIds.add(x.id)}g.bounds&&(this.tileBounds=new pi(g.bounds,this.minzoom,this.maxzoom)),rr(g.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(t,s){const h=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(h),g=this.map._requestManager.transformRequest(m,i.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,I=x?{image:x.image.clone()}:null,P={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&i.f(h)&&(P.worldview=this.map.getWorldview()||this.worldviewDefault,P.localizableLayerIds=this.localizableLayerIds),P.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",P,z.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",P,z.bind(this),void 0,!0);else{const L=i.aE.call({deduped:this._deduped},P,(F,B)=>{F||!B?z.call(this,F):(P.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},t.actor&&t.actor.send("loadTile",P,z.bind(this),void 0,!0))},!0);t.request={cancel:L}}function z(L,F){return delete t.request,t.aborted?s(null):L&&L.status!==404?s(L):(F&&F.resourceTiming&&(t.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&t.setExpiryData(F),t.loadVectorData(F,this.map.painter),i.aF(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class pa extends i.E{constructor(t,s,h,m){super(),this.id=t,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},s),i.l(this,i.aA(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Bi(this._options,this.map._requestManager,null,null,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new i.z(s)):h&&(i.l(this,h),h.raster_layers&&(this.rasterLayers=h.raster_layers,this.rasterLayerIds=this.rasterLayers.map(m=>m.id)),h.bounds&&(this.tileBounds=new pi(h.bounds,this.minzoom,this.maxzoom)),rr(h.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(s)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const h=i.q.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=i.o(this.map._requestManager.transformRequest(m,i.R.Tile),(g,x,I,P)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):g?(t.state="errored",s(g)):x?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:I,expires:P}),t.setTexture(x,this.map.painter),t.state="loaded",i.aF(this.dispatcher),void s(null)):s(null)))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof i.T?(t.destroy(!0),t.texture&&t.texture instanceof i.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xs extends pa{constructor(t,s,h,m){super(t,s,h,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this.iconsets={},this._options=i.l({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);s&&s.enabled&&h&&s._clearRenderCacheForTile(h.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(h,i.R.Tile),g={request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor());const x=(I,P,z,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(I)return I.name==="AbortError"?void 0:(t.state="errored",s(I));if(this.map._refreshExpiredTiles&&P&&t.setExpiryData({cacheControl:z,expires:L}),this.partial)t.state="empty";else{if(!P)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=P;const F=new Map;for(const B in t._mrt.layers){const j=t.getLayer(B);if(j)for(const X of j.getBandList()){const{bytes:q,tileSize:J,buffer:Q}=j.getBandView(X),oe=J+2*Q,ue={data:new i.r({width:oe,height:oe},q),pixelRatio:2,sdf:!1,usvg:!1,version:0};F.set(`${B}/${X}`,ue)}}for(const B in this.iconsets)this.iconsets[B].addIcons(F)}s(null)};t.request=this.partial?t.fetchHeader(void 0,x.bind(this)):t.actor.send("loadTile",g,x.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const h=t.texture;h&&h instanceof i.T?(t.destroy(!0),this.map.painter.saveTileTexture(h)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,s,h){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(s,h,(m,g)=>{if(m)return t.state="errored",this.fire(new i.z(m)),void this.triggerRepaint(t);g&&(t._isHeaderLoaded=!0,t.setTexture(g,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:g})=>g===t),h=s&&s.fields,m=h&&h.bands&&h.bands;return m?m[0]:0}getTextureDescriptor(t,s,h){if(!t)return;const m=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let g=null;s instanceof i.aI?g=s.paint.get("raster-array-band"):s instanceof i.aJ&&(g=s.paint.get("raster-particle-array-band"));const x=g||this.getInitialBand(m);if(x!=null)if(t.textureDescriptor){if(!t.updateNeeded(m,x)||h)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,m,x)}addIconset(t,s){this.iconsets[t]=s,this.partial=!1}}const $a={vector:Ni,raster:pa,"raster-dem":class extends pa{constructor(d,t,s,h){super(d,t,s,h),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(d,t){const s=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,g){m&&(d.state="errored",t(m)),g&&(d.dem=g,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=i.o(this.map._requestManager.transformRequest(s,i.R.Tile),(function(m,g,x,I){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(m)d.state="errored",t(m);else if(g){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:x,expires:I});const P=ImageBitmap&&g instanceof ImageBitmap&&i.t(),z=1-(g.width-i.aG(g.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const L=P?g:i.q.getImageData(g,z),F={uid:d.uid,tileID:d.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:z};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadTile",F,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const t=d.canonical,s=Math.pow(2,t.z),h=(t.x-1+s)%s,m=t.x===0?d.wrap-1:d.wrap,g=(t.x+1+s)%s,x=t.x+1===s?d.wrap+1:d.wrap,I={};return I[new i.aH(d.overscaledZ,m,t.z,h,t.y).key]={backfilled:!1},I[new i.aH(d.overscaledZ,x,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(I[new i.aH(d.overscaledZ,m,t.z,h,t.y-1).key]={backfilled:!1},I[new i.aH(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},I[new i.aH(d.overscaledZ,x,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<s&&(I[new i.aH(d.overscaledZ,m,t.z,h,t.y+1).key]={backfilled:!1},I[new i.aH(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},I[new i.aH(d.overscaledZ,x,t.z,g,t.y+1).key]={backfilled:!1}),I}},"raster-array":xs,geojson:class extends i.E{constructor(d,t,s,h){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=t.data,this._options=i.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=i.ai/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:i.ai,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:i.ai,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of d.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterLeaves(d,t,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:t,offset:s},h),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=i.l({append:d},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(i.q.resolveURL(s),i.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(h,m)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new i.z(h));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(g.resourceTiming=m.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new i.A("data",g)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const d=i.C(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,t){const s=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const h=this.map.style?this.map.style.getLut(this.scope):null,m=h?{image:h.image.clone()}:null,g=this._partialReload,x={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:g};d.request=this.actor.send(s,x,(I,P)=>g&&!P?(d.state="loaded",t(null)):(delete d.request,d.destroy(),d.aborted?t(null):I?t(I):(d.loadVectorData(P,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,t){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aK{constructor(d,t,s,h){super(d,t,s,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,i.R.Source).url);i.aL(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new i.z(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,t=d.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(d,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aK,model:class extends i.E{constructor(d,t,s,h){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const d=[];for(const t in this._options.models){const s=this._options.models[t],h=i.aN(this.map._requestManager.transformRequest(s.uri,i.R.Model).url).then(m=>{if(!m)return;const g=i.aO(m),x=new i.aP(t,s.position,s.orientation,g);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(m=>{this.fire(new i.z(new Error(`Could not load model ${t} from ${s.uri}: ${m.message}`)))});d.push(h)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new i.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,t){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(d,t,s,h){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=Bi(this._options,this.map._requestManager,t,s,(h,m)=>{this._tileJSONRequest=null,this._loaded=!0,h?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new i.z(h))):m&&(i.l(this,m),m.bounds&&(this.tileBounds=new pi(m.bounds,this.minzoom,this.maxzoom)),rr(m.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),d&&d(h)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,t){const s=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,i.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=t;else{if(d.buckets){const g=Object.values(d.buckets);for(const x of g)x.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",h,m.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",h,m.bind(this),void 0,!0);function m(g,x){return d.aborted?t(null):g&&g.status!==404?t(g):(this.map._refreshExpiredTiles&&x&&d.setExpiryData(x),d.loadModelData(x,this.map.painter),d.state="loaded",void t(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aK{constructor(d,t,s,h){super(d,t,s,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(g=>typeof g!="number"))||this.fire(new i.z(new i.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${d}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof i.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends i.E{constructor(d,t,s,h){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new pi(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.aA(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:t,y:s,z:h}=d.canonical;return this._implementation.hasTile({x:t,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,t){const{x:s,y:h,z:m}=d.tileID.canonical,g=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:s,y:h,z:m},{signal:g.signal})).then((function(x){return delete d.request,d.aborted?(d.state="unloaded",t(null)):x===void 0?(d.state="errored",t(null)):x===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",t(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(x)?(this.loadTileData(d,x),d.state="loaded",void t(null)):(d.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.name!=="AbortError"&&(d.state="errored",t(x))}),d.request.cancel=()=>g.abort()}loadTileData(d,t){d.setTexture(t,this.map.painter)}unloadTile(d,t){if(d.texture&&d.texture instanceof i.T?(d.destroy(!0),d.texture&&d.texture instanceof i.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:s,y:h,z:m}=d.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:m})}t&&t()}abortTile(d,t){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=i.C(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},Hd=function(d,t,s,h){const m=new $a[t.type](d,t,s,h);if(m.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${m.id}`);return i.aQ(["load","abort","unload","serialize","prepare"],m),m};function qd(d,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${function(h){if("layerId"in h)return`layer:${h.layerId}`;{const{featuresetId:m,importId:g}=h;return`featureset:${m}${g?`:import:${g}`:""}`}}(d.target)}`}function Rc(d,t,s,h=""){if(d.uniqueFeatureID){const m=qd(d,t,h);if(s.has(m))return!0;s.add(m)}return!1}function Dc(d,t,s,h,m=!1){const g=t.sourceCache.transform,x=t.sourceCache.tilesIn(d,t.has3DLayers,m);x.sort(Zd);const I=[];for(const P of x){const z=P.tile.queryRenderedFeatures(t,P,s,h,g,m);Object.keys(z).length&&I.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:z})}return I.length===0?{}:function(P){const z={},L={};for(const F of P){const B=F.queryResults,j=F.wrappedTileID,X=L[j]=L[j]||{};for(const q in B){const J=B[q],Q=X[q]=X[q]||{},oe=z[q]=z[q]||[];for(const ue of J)Q[ue.featureIndex]||(Q[ue.featureIndex]=!0,oe.push(ue))}}return z}(I)}function Wd(d,t,s,h,m){const g={},x=h.queryRenderedSymbols(d),I=[];for(const P of Object.keys(x).map(Number))I.push(m[P]);I.sort(Zd);for(const P of I){const z=P.featureIndex.lookupSymbolFeatures(x[P.bucketInstanceId],P.bucketIndex,P.sourceLayerIndex,t,s);for(const L in z){const F=g[L]=g[L]||[],B=z[L];B.sort((j,X)=>{const q=P.featureSortOrder;if(q){const J=q.indexOf(j.featureIndex);return q.indexOf(X.featureIndex)-J}return X.featureIndex-j.featureIndex});for(const j of B)F.push(j)}}return g}function Nm(d,t){const s=d.getRenderableIds().map(g=>d.getTileByID(g)),h=[],m={};for(let g=0;g<s.length;g++){const x=s[g],I=x.tileID.canonical.key;m[I]||(m[I]=!0,x.querySourceFeatures(h,t))}return h}function Zd(d,t){const s=d.tileID,h=t.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function Xd(d,t){const s={};if(!t)return s;for(const h of d){const m=h.layerIds.map(g=>t.getLayer(g)).filter(Boolean);if(m.length!==0){h.layers=m,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(g=>m.filter(x=>x.id===g)[0]));for(const g of m)s[g.fqid]=h}}return s}const qi=32,Js=33,No=new Uint16Array(8184);for(let d=0;d<2046;d++){let t=d+2,s=0,h=0,m=0,g=0,x=0,I=0;for(1&t?m=g=x=qi:s=h=I=qi;(t>>=1)>1;){const z=s+m>>1,L=h+g>>1;1&t?(m=s,g=h,s=x,h=I):(s=m,h=g,m=x,g=I),x=z,I=L}const P=4*d;No[P+0]=s,No[P+1]=h,No[P+2]=m,No[P+3]=g}const To=new Uint16Array(2178),Qs=new Uint8Array(1089),So=new Uint16Array(1089);function qu(d){return d===0?-.03125:d===32?.03125:0}const Kd={type:2,extent:i.ai,loadGeometry:()=>[[new i.P(0,0),new i.P(i.ai+1,0),new i.P(i.ai+1,i.ai+1),new i.P(0,i.ai+1),new i.P(0,0)]]};class ma{constructor(t,s,h,m,g){this.tileID=t,this.uid=i.aW(),this.uses=0,this.tileSize=s,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(t){const s=t+this.timeAdded;s<i.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Xd(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const g=this.buckets[m];if(g instanceof i.aY){if(this.hasSymbolBuckets=!0,!h)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const g=this.buckets[m];if(g instanceof i.aY&&g.hasRTLText){this.hasRTLText=!0,i.aZ();break}}this.queryPadding=0;for(const m in this.buckets){const g=this.buckets[m],x=s.style.getOwnLayer(m);if(!x)continue;const I=x.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,I)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new i.aX}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,h){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Xd(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(t)}const s=t.gl,h=this.imageAtlas;h&&!h.uploaded&&(this.imageAtlasTexture=new i.T(t,h.image,s.RGBA8,{useMipmap:!!h.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(t,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(t,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,h),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=s.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(t,s,h,m,g,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=function(P,z){const L=i.ad.mat4.fromScaling([],[.5*P.width,.5*-P.height,1]);return i.ad.mat4.translate(L,L,[1,-1,0]),i.ad.mat4.multiply(L,L,P.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(L)}(g,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:I,transform:m,availableImages:h,tileTransform:this.tileTransform})}querySourceFeatures(t,s){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const m=h.loadVTLayers(),g=s?s.sourceLayer:"",x=m._geojsonTileLayer||m[g];if(!x)return;const I=i.a_(s&&s.filter),{z:P,x:z,y:L}=this.tileID.canonical,F={z:P,x:z,y:L};for(let B=0;B<x.length;B++){const j=x.feature(B);if(I.needGeometry){const J=i.a$(j,!0);if(!I.filter(new i.aa(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!I.filter(new i.aa(this.tileID.overscaledZ),j))continue;const X=h.getId(j,g),q=new i.b0(j,P,z,L,X);q.tile=F,t.push(q)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const h=i.b1(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let m=!1;if(this.expirationTime>h)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const g=this.expirationTime-s;g?this.expirationTime=h+Math.max(g,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const h=this.latestFeatureIndex.loadVTLayers(),m=t.style.listImages(),g=t.style.getBrightness();for(const x in this.buckets){if(!t.style.hasLayer(x))continue;const I=this.buckets[x],P=I.layers[0],z=P.sourceLayer||"_geojsonTileLayer",L=h[z],F=t.style.getLayerSourceCache(P);let B={};F&&(B=F._state.getState(z,void 0));const j=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},X=Object.keys(B).length>0&&!s;X&&!I.stateDependentLayers.length&&!s||I.update(B,L,m,j,X?I.stateDependentLayers:I.layers,s,g),(I instanceof i.b2||I instanceof i.b3)&&t._terrain&&t._terrain.enabled&&F&&I.uploadPending()&&t._terrain._clearRenderCacheForTile(F.id,this.tileID);const q=t&&t.style&&t.style.getOwnLayer(x);q&&(this.queryPadding=Math.max(this.queryPadding,q.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=i.q.now()+t}setTexture(t,s){const h=s.context,m=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t):(this.texture=new i.T(h,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,s){const h={};for(const m of s)h[m]=!0;this.dependencies[t]=h}hasDependency(t,s){for(const h of t){const m=this.dependencies[h];if(m){for(const g of s)if(m[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const h=i.b4(Kd,this.tileID.canonical,this.tileTransform)[0],m=new i.b5,g=new i.b6;for(let x=0;x<h.length;x++){const{x:I,y:P}=h[x];m.emplaceBack(I,P),g.emplaceBack(x)}g.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(m,i.b7.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,m.length,g.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const h=i.b4(Kd,this.tileID.canonical,this.tileTransform)[0];let m,g;if(this.isRaster){const x=function(I,P){const z=i.aR(I,P),L=Math.pow(2,I.z);for(let J=0;J<Js;J++)for(let Q=0;Q<Js;Q++){const oe=i.aS((I.x+(Q+qu(Q))/qi)/L),ue=i.aT((I.y+(J+qu(J))/qi)/L),ce=P.project(oe,ue),ge=J*Js+Q;To[2*ge+0]=Math.round((ce.x*z.scale-z.x)*i.ai),To[2*ge+1]=Math.round((ce.y*z.scale-z.y)*i.ai)}Qs.fill(0),So.fill(0);for(let J=2045;J>=0;J--){const Q=4*J,oe=No[Q+0],ue=No[Q+1],ce=No[Q+2],ge=No[Q+3],pe=oe+ce>>1,_e=ue+ge>>1,me=pe+_e-ue,we=_e+oe-pe,Ee=ue*Js+oe,He=ge*Js+ce,Be=_e*Js+pe,et=Math.hypot((To[2*Ee+0]+To[2*He+0])/2-To[2*Be+0],(To[2*Ee+1]+To[2*He+1])/2-To[2*Be+1])>=16;Qs[Be]=Qs[Be]||(et?1:0),J<1022&&(Qs[Be]=Qs[Be]||Qs[(ue+we>>1)*Js+(oe+me>>1)]||Qs[(ge+we>>1)*Js+(ce+me>>1)])}const F=new i.aU,B=new i.aV;let j=0;function X(J,Q){const oe=Q*Js+J;return So[oe]===0&&(F.emplaceBack(To[2*oe+0],To[2*oe+1],J*i.ai/qi,Q*i.ai/qi),So[oe]=++j),So[oe]-1}function q(J,Q,oe,ue,ce,ge){const pe=J+oe>>1,_e=Q+ue>>1;if(Math.abs(J-ce)+Math.abs(Q-ge)>1&&Qs[_e*Js+pe])q(ce,ge,J,Q,pe,_e),q(oe,ue,ce,ge,pe,_e);else{const me=X(J,Q),we=X(oe,ue),Ee=X(ce,ge);B.emplaceBack(me,we,Ee)}}return q(0,0,qi,qi,qi,0),q(qi,qi,0,0,0,qi),{vertices:F,indices:B}}(this.tileID.canonical,s);m=x.vertices,g=x.indices}else{m=new i.aU,g=new i.aV;for(const{x:I,y:P}of h)m.emplaceBack(I,P,0,0);const x=i.b9(m.int16,void 0,4);for(let I=0;I<x.length;I+=3)g.emplaceBack(x[I],x[I+1],x[I+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,i.ba.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(g),this._tileBoundsSegments=i.b8.simpleSegment(0,0,m.length,g.length)}_makeGlobeTileDebugBuffers(t,s){const h=s.projection;if(!h||h.name!=="globe"||s.freezeTileCoverage)return;const m=this.tileID.canonical,g=i.bb(m,s),x=i.bc(g),I=i.ag(s.zoom);let P;I>0&&(P=i.ad.mat4.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,s,x,P,I),this._makeGlobeTileDebugTextBuffer(t,m,s,x,P,I)}_globePoint(t,s,h,m,g,x,I){let P=i.bd(t,s,h);if(x){const z=1<<h.z,L=i.av(m.center.lng),F=i.aC(m.center.lat),B=(h.x+.5)/z-L;let j=0;B>.5?j=-1:B<-.5&&(j=1);let X=(t/i.ai+h.x)/z+j,q=(s/i.ai+h.y)/z;X=(X-L)*m._pixelsPerMercatorPixel+L,q=(q-F)*m._pixelsPerMercatorPixel+F;const J=[X*m.worldSize,q*m.worldSize,0];i.ad.vec3.transformMat4(J,J,x),P=i.be(P,J,I)}return i.ad.vec3.transformMat4(P,P,g)}_makeGlobeTileDebugBorderBuffer(t,s,h,m,g,x){const I=new i.b5,P=new i.b6,z=new i.bf,L=(B,j,X,q,J)=>{const Q=(X-B)/(J-1),oe=(q-j)/(J-1),ue=I.length;for(let ce=0;ce<J;ce++){const ge=B+ce*Q,pe=j+ce*oe;I.emplaceBack(ge,pe);const _e=this._globePoint(ge,pe,s,h,m,g,x);z.emplaceBack(_e[0],_e[1],_e[2]),P.emplaceBack(ue+ce)}},F=i.ai;L(0,0,F,0,16),L(F,0,F,F,16),L(F,F,0,F,16),L(0,F,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(P),this._tileDebugBuffer=t.createVertexBuffer(I,i.b7.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(z,i.bg.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,I.length,P.length)}_makeGlobeTileDebugTextBuffer(t,s,h,m,g,x){const I=i.ai/4,P=new i.b5,z=new i.aV,L=new i.bf,F=25;z.reserve(32),P.reserve(F),L.reserve(F);const B=(j,X)=>F*j+X;for(let j=0;j<F;j++){const X=j*I;for(let q=0;q<F;q++){const J=q*I;P.emplaceBack(J,X);const Q=this._globePoint(J,X,s,h,m,g,x);L.emplaceBack(Q[0],Q[1],Q[2])}}for(let j=0;j<4;j++)for(let X=0;X<4;X++){const q=B(j,X),J=B(j,X+1),Q=B(j+1,X),oe=B(j+1,X+1);z.emplaceBack(q,J,Q),z.emplaceBack(Q,J,oe)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(z),this._tileDebugTextBuffer=t.createVertexBuffer(P,i.b7.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(L,i.bg.members),this._tileDebugTextSegments=i.b8.simpleSegment(0,0,F,32)}destroy(t=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bh.setPbf(i.bi);class _a extends ma{constructor(t,s,h,m,g){super(t,s,h,m,g),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,s){const h=s.context,m=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t,{premultiply:!1}):this.texture=new i.T(h,t,m.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,s){const h=this._mrt=new i.bh(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=i.bj(m,(g,x,I,P)=>{if(g)s(g);else try{const z=h.getHeaderLength(x);if(z>t)return void(this.request=this.fetchHeader(z,s));h.parseHeader(x),this._isHeaderLoaded=!0;let L=0;for(const F of Object.values(h.layers))L=Math.max(L,F.dataIndex[F.dataIndex.length-1].lastByte);x.byteLength>=L&&(this.entireBuffer=x),s(null,this.entireBuffer||x,I,P)}catch(z){s(z)}}),this.request}fetchBand(t,s,h){const m=this._mrt;if(!this._isHeaderLoaded||!m)return void h(new Error("Tile header is not ready"));const g=this.actor;if(!g)return void h(new Error("Can't fetch tile band without an actor"));let x;const I=(F,B)=>{x.complete(F,B),F?h(F):(this.updateTextureDescriptor(t,s),h(null,this.textureDescriptor&&this.textureDescriptor.img))},P=(F,B)=>{if(F)return h(F);const j=g.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:B,task:x},I,void 0,!0);this._workQueue.push(()=>{j&&j.cancel(),x.cancel()})},z=m.getLayer(t);if(!z)return void h(new Error(`Unknown sourceLayer "${t}"`));if(z.hasDataForBand(s))return this.updateTextureDescriptor(t,s),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);const L=z.getDataRange([s]);if(x=m.createDecodingTask(L),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)P(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{const F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),B=i.bj(F,P);this._fetchQueue.push(()=>{B.cancel(),x.cancel()})}else h(null)}updateNeeded(t,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,s){if(!this._mrt)return;const h=this._mrt.getLayer(t);if(!h||!h.hasBand(s)||!h.hasDataForBand(s))return;const{bytes:m,tileSize:g,buffer:x,offset:I,scale:P}=h.getBandView(s),z=g+2*x,L=new i.r({width:z,height:z},m),F=this.texture;F&&F instanceof i.T&&F.update(L,{premultiply:!1}),this.textureDescriptor={layer:t,band:s,img:L,buffer:x,offset:I,tileSize:g,format:h.pixelFormat,mix:[P,256*P,65536*P,16777216*P]}}}class bs{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,h){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const g={value:s,timeout:void 0};if(h!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},h)),this.data[m].push(g),this.order.push(m),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const h=t.wrapped().key,m=s===void 0?0:this.data[h].indexOf(s),g=this.data[h][m];return this.data[h].splice(m,1),g.timeout&&clearTimeout(g.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(g.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const h in this.data)for(const m of this.data[h])t(m.value)||s.push(m);for(const h of s)this.remove(h.value.tileID,h)}}class Vm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,h){const m=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},i.l(this.stateChanges[t][m],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==m&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const g in this.state[t][m])h[g]||(this.deletedStates[t][m][g]=null)}else for(const g in h)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][g]===null&&delete this.deletedStates[t][m][g]}removeFeatureState(t,s,h){if(this.deletedStates[t]===null)return;const m=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&s!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][h]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(h in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][h]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,s){const h=this.state[t]||{},m=this.stateChanges[t]||{},g=this.deletedStates[t];if(g===null)return{};if(s!==void 0){const I=String(s),P=i.l({},h[I],m[I]);if(g){const z=g[s];if(z===null)return{};for(const L in z)delete P[L]}return P}const x=i.l({},h,m);if(g)for(const I in g)delete x[I];return x}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const h={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const g={};for(const x in this.stateChanges[m])this.state[m][x]||(this.state[m][x]={}),i.l(this.state[m][x],this.stateChanges[m][x]),g[x]=this.state[m][x];h[m]=g}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const g={};if(this.deletedStates[m]===null)for(const x in this.state[m])g[x]={},this.state[m][x]={};else for(const x in this.deletedStates[m]){if(this.deletedStates[m][x]===null)this.state[m][x]={};else if(this.state[m][x])for(const I of Object.keys(this.deletedStates[m][x]))delete this.state[m][x][I];g[x]=this.state[m][x]}h[m]=h[m]||{},i.l(h[m],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const m in t)t[m].refreshFeatureState(s)}}class ws extends i.E{constructor(t,s,h){super(),this.id=t,this._onlySymbols=h,s.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new bs(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Vm,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const h=this._tiles[s];h.upload(t),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Yd).map(t=>t.key)}getRenderableIds(t,s){const h=[];for(const m in this._tiles)this._isIdRenderable(+m,t,s)&&h.push(this._tiles[m]);return t?h.sort((m,g)=>{const x=m.tileID,I=g.tileID,P=new i.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),z=new i.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-I.overscaledZ||z.y-P.y||z.x-P.x}).map(m=>m.tileID.key):h.map(m=>m.tileID).sort(Yd).map(m=>m.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(h||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=s),this._loadTile(h,this._tileLoaded.bind(this,h,t,s)))}_tileLoaded(t,s,h,m){if(m)if(t.state="errored",m.status!==404)this._source.fire(new i.z(m,{tile:t}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=i.q.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const g=s[m];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);h(t,x),h(x,t)}}function h(m,g){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let x=g.tileID.canonical.x-m.tileID.canonical.x;const I=g.tileID.canonical.y-m.tileID.canonical.y,P=Math.pow(2,m.tileID.canonical.z),z=g.tileID.key;x===0&&I===0||Math.abs(I)>1||(Math.abs(x)>1&&(Math.abs(x+P)===1?x+=P:Math.abs(x-P)===1&&(x-=P)),g.dem&&m.dem&&(m.dem.backfillBorder(g.dem,x,I),m.neighboringTiles&&m.neighboringTiles[z]&&(m.neighboringTiles[z].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,h,m){for(const g in this._tiles){let x=this._tiles[g];if(m[g]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>h)continue;let I=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const z=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[z.key],x&&x.hasData()&&(I=z)}let P=I;for(;P.overscaledZ>s;)if(P=P.scaledTo(P.overscaledZ-1),t[P.key]){m[I.key]=I;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=s?h:null}for(let h=t.overscaledZ-1;h>=s;h--){const m=t.scaledTo(h),g=this._getLoadedTile(m);if(g)return g}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const h=Math.ceil(t.width/s)+1,m=Math.ceil(t.height/s)+1,g=Math.floor(h*m*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(I)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const h={};for(const m in this._tiles){const g=this._tiles[m];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),h[g.tileID.key]=g}this._tiles=h;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,s,h,m){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const g=this._source.type==="batched-model";let x,I=this._source.maxzoom;const P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){const F=P.attenuationRange()[0],B=Math.floor(F)-Math.log2(P.getDemUpscale());I>B&&(I=B)}if(this.used||this.usedForTerrain){if(this._source.tileID)x=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new i.aH(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y));else if(this.tileCoverLift!==0){const F=t.clone();F.tileCoverLift=this.tileCoverLift,x=F.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.minzoom<=1&&t.projection.name==="globe"&&(x.push(new i.aH(1,0,1,0,0)),x.push(new i.aH(1,0,1,1,0)),x.push(new i.aH(1,0,1,0,1)),x.push(new i.aH(1,0,1,1,1)))}else if(x=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:I,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.hasTile){const F=this._source.hasTile.bind(this._source);x=x.filter(B=>F(B))}}else x=[];if(x.length>0&&this.castsShadows&&m&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!nn(this._source.type)){const F=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),B=Math.min(F,this._source.maxzoom);if(g){const j=t.extendTileCover(x,B);for(const X of j)x.push(X)}else{const j=t.extendTileCover(x,B,m);for(const X of j)this._shadowCasterTiles[X.key]=!0,x.push(X)}}const z=this._updateRetainedTiles(x);if(nn(this._source.type)&&x.length!==0){const F={},B={},j=Object.keys(z);for(const q of j){const J=z[q],Q=this._tiles[q];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=i.q.now())continue;const oe=this.findLoadedParent(J,Math.max(J.overscaledZ-ws.maxOverzooming,this._source.minzoom));oe&&(this._addTile(oe.tileID),F[oe.tileID.key]=oe.tileID),B[q]=J}const X=x[x.length-1].overscaledZ;for(const q in this._tiles){const J=this._tiles[q];if(z[q]||!J.hasData())continue;let Q=J.tileID;for(;Q.overscaledZ>X;){Q=Q.scaledTo(Q.overscaledZ-1);const oe=this._tiles[Q.key];if(oe&&oe.hasData()&&B[Q.key]){z[q]=J.tileID;break}}}for(const q in F)z[q]||(this._coveredTiles[q]=!0,z[q]=F[q])}for(const F in z)this._tiles[F].clearFadeHold();const L=i.bk(this._tiles,z);for(const F of L){const B=this._tiles[F];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const h={},m=t.reduce((z,L)=>Math.min(z,L.overscaledZ),1/0),g=t[0].overscaledZ,x=Math.max(g-ws.maxOverzooming,this._source.minzoom),I=Math.max(g+ws.maxUnderzooming,this._source.minzoom),P={};for(const z of t){const L=this._addTile(z);s[z.key]=z,L.hasData()||m<this._source.maxzoom&&(P[z.key]=z)}this._retainLoadedChildren(P,m,I,s);for(const z of t){let L=this._tiles[z.key];if(L.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const B=z.children(this._source.maxzoom)[0],j=this.getTile(B);if(j&&j.hasData()){s[B.key]=B;continue}}else{const B=z.children(this._source.maxzoom);if(s[B[0].key]&&s[B[1].key]&&s[B[2].key]&&s[B[3].key])continue}let F=L.wasRequested();for(let B=z.overscaledZ-1;B>=x;--B){const j=z.scaledTo(B);if(h[j.key]||(h[j.key]=!0,L=this.getTile(j),!L&&F&&(L=this._addTile(j)),L&&(s[j.key]=j,F=L.wasRequested(),L.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let h,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){h=this._loadedParentTiles[m.key];break}s.push(m.key);const g=m.scaledTo(m.overscaledZ-1);if(h=this._getLoadedTile(g),h)break;m=g}for(const g of s)this._loadedParentTiles[g]=h}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const h=!!s;if(!h){const m=this.map?this.map.painter:null,g=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new _a(t,g,this.transform.tileZoom,m,this._isRaster):new ma(t,g,this.transform.tileZoom,m,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s?(s.uses++,this._tiles[t.key]=s,h||this._source.fire(new i.A("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=s.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,h){const m=[],g=this.transform;if(!g)return m;const x=g.projection.name==="globe",I=i.av(g.center.lng);for(const P in this._tiles){const z=this._tiles[P];if(h&&z.clearQueryDebugViz(),z.holdingForFade())continue;let L;if(x){const F=z.tileID.canonical;if(F.z===0){const B=[Math.abs(i.ay(I,...zc(F,-1))-I),Math.abs(i.ay(I,...zc(F,1))-I)];L=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(i.ay(I,...zc(F,-1))-I),Math.abs(i.ay(I,...zc(F,0))-I),Math.abs(i.ay(I,...zc(F,1))-I)];L=[B.indexOf(Math.min(...B))-1]}}else L=[0];for(const F of L){const B=t.containsTile(z,g,s,F);B&&m.push(B)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const h=this.getRenderableIds(t,s).map(g=>this._tiles[g].tileID),m=this.transform.projection.name==="globe";for(const g of h)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=m?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return h}sortCoordinatesByDistance(t){const s=t.slice(),h=this.transform._camera.position,m=this.transform._camera.forward(),g={};for(const x of s){const I=1/(1<<x.canonical.z);g[x.key]=((x.canonical.x+.5)*I+x.wrap-h[0])*m[0]+((x.canonical.y+.5)*I-h[1])*m[1]-h[2]*m[2]}return s.sort((x,I)=>g[x.key]-g[I.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(nn(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(t,s,h){this._state.updateState(t=t||"_geojsonTileLayer",s,h)}removeFeatureState(t,s,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,h)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,h){const m=this._tiles[t];m&&m.setDependencies(s,h)}reloadTilesForDependencies(t,s){for(const h in this._tiles)this._tiles[h].hasDependency(t,s)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(t,s))}_preloadTiles(t,s){if(!this._sourceLoaded){const P=()=>{this._sourceLoaded&&(this._source.off("data",P),this._preloadTiles(t,s))};return void this._source.on("data",P)}const h=new Map,m=Array.isArray(t)?t:[t],g=this.map.painter.terrain,x=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const P of m){const z=P.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of z)h.set(L.key,L);this.usedForTerrain&&P.updateElevation(!1)}const I=Array.from(h.values());i.bl(I,(P,z)=>{const L=new ma(P,this._source.tileSize*P.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,F=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),z(F,L)})},s)}}function Yd(d,t){const s=Math.abs(2*d.wrap)-+(d.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||h-s||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function nn(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function zc(d,t){const s=1<<d.z;return[d.x/s+t,(d.x+1)/s+t]}ws.maxOverzooming=10,ws.maxUnderzooming=3;class ar{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const h in this.style._mergedLayers){const m=this.style._mergedLayers[h];if(m.type==="fill-extrusion")this.layers.push({layer:m,visible:t,visibilityChanged:s});else if(m.type==="model"){const g=this.style.getLayerSource(m);g&&g.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const h=s.layer;let m=!1;h.type==="fill-extrusion"?m=!h.isHidden(t)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="model"&&(m=!h.isHidden(t)&&h.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&s.visible,s.visible=m}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const m of this.layers){const g=m.layer,x=this.style.getLayerSourceCache(g);let I=1;g.type==="fill-extrusion"&&(I=m.visible?g.paint.get("fill-extrusion-vertical-scale"):0);let P=x?x.getTile(s):null;if(!P&&x&&s.canonical.z>x.getSource().minzoom){let z=s.scaledTo(Math.min(x.getSource().maxzoom,s.overscaledZ-1));for(;z.overscaledZ>=x.getSource().minzoom&&(P=x.getTile(z),!P&&z.overscaledZ!==0);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:P?P.getBucket(g):null,tileID:P?P.tileID:s,verticalScale:I})}t.hasAnyZOffset=!1;let h=!1;for(let m=0;m<t.symbolInstances.length;m++){const g=t.symbolInstances.get(m),x=g.zOffset,I=this._getHeightAtTileOffset(s,g.tileAnchorX,g.tileAnchorY);g.zOffset=I!==Number.NEGATIVE_INFINITY?I:x,h||x===g.zOffset||(h=!0),t.hasAnyZOffset||g.zOffset===0||(t.hasAnyZOffset=!0)}h&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,h,m){let g=s,x=h;if(t.canonical.z!==m.canonical.z){const I=m.canonical,P=1/(1<<t.canonical.z-I.z);g=(s+t.canonical.x*i.ai)*P-I.x*i.ai|0,x=(h+t.canonical.y*i.ai)*P-I.y*i.ai|0}return{tileX:g,tileY:x}}_getHeightAtTileOffset(t,s,h){let m,g;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;const{bucket:I,tileID:P,verticalScale:z}=this.currentBuildingBuckets[x];if(!I)continue;const{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(t,s,h,P),B=I.getHeightAtTileCoord(L,F);B&&B.height!==void 0&&(B.hidden?m=B.height:g=Math.max(B.height*z,g||0))}if(g!==void 0)return g;for(let x=0;x<this.layers.length;++x){const I=this.layers[x];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:P,tileID:z}=this.currentBuildingBuckets[x];if(!P)continue;const{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(t,s,h,z),B=P.getHeightAtTileCoord(L,F);if(B&&!B.hidden)return B.height===void 0&&m!==void 0?Math.min(B.maxHeight,m)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Um(d,t){const s={};for(const h in d)h!=="ref"&&(s[h]=d[h]);return i.bm.forEach(h=>{h in t&&(s[h]=t[h])}),s}function Jd(d){d=d.slice();const t=Object.create(null);for(let s=0;s<d.length;s++)t[d[s].id]=d[s];for(let s=0;s<d.length;s++)"ref"in d[s]&&(d[s]=Um(d[s],t[d[s].ref]));return d}const Xr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Wu(d,t,s){s.push({command:Xr.addSource,args:[d,t[d]]})}function Vs(d,t,s){t.push({command:Xr.removeSource,args:[d]}),s[d]=!0}function Qd(d,t,s,h){Vs(d,s,h),Wu(d,t,s)}function wl(d,t,s){let h;for(h in d[s])if(d[s].hasOwnProperty(h)&&h!=="data"&&!i.bn(d[s][h],t[s][h]))return!1;for(h in t[s])if(t[s].hasOwnProperty(h)&&h!=="data"&&!i.bn(d[s][h],t[s][h]))return!1;return!0}function Ht(d,t,s,h,m,g){let x;for(x in t=t||{},d=d||{})d.hasOwnProperty(x)&&(i.bn(d[x],t[x])||s.push({command:g,args:[h,x,t[x],m]}));for(x in t)t.hasOwnProperty(x)&&!d.hasOwnProperty(x)&&(i.bn(d[x],t[x])||s.push({command:g,args:[h,x,t[x],m]}))}function sn(d){return d.id}function Kr(d,t){return d[t.id]=t,d}class ns{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=i.ay(t,0,1);let s=1,h=this._distances[s];const m=t*this.paddedLength+this.padding;for(;h<m&&s<this._distances.length;)h=this._distances[++s];const g=s-1,x=this._distances[g],I=h-x,P=I>0?(m-x)/I:0;return this.points[g].mult(1-P).add(this.points[s].mult(P))}}class Ga{constructor(t,s,h){const m=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(s/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)m.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,h,m,g){this._forEachCell(s,h,m,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(g)}insertCircle(t,s,h,m){this._forEachCell(s-m,h-m,s+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(h),this.circles.push(m)}_insertBoxCell(t,s,h,m,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,s,h,m,g,x){this.circleCells[g].push(x)}_query(t,s,h,m,g,x){if(h<0||t>this.width||m<0||s>this.height)return!g&&[];const I=[];if(t<=0&&s<=0&&this.width<=h&&this.height<=m){if(g)return!0;for(let P=0;P<this.boxKeys.length;P++)I.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],L=this.circles[3*P+1],F=this.circles[3*P+2];I.push({key:this.circleKeys[P],x1:z-F,y1:L-F,x2:z+F,y2:L+F})}return x?I.filter(x):I}return this._forEachCell(t,s,h,m,this._queryCell,I,{hitTest:g,seenUids:{box:{},circle:{}}},x),g?I.length>0:I}_queryCircle(t,s,h,m,g){const x=t-h,I=t+h,P=s-h,z=s+h;if(I<0||x>this.width||z<0||P>this.height)return!m&&[];const L=[];return this._forEachCell(x,P,I,z,this._queryCellCircle,L,{hitTest:m,circle:{x:t,y:s,radius:h},seenUids:{box:{},circle:{}}},g),m?L.length>0:L}query(t,s,h,m,g){return this._query(t,s,h,m,!1,g)}hitTest(t,s,h,m,g){return this._query(t,s,h,m,!0,g)}hitTestCircle(t,s,h,m){return this._queryCircle(t,s,h,!0,m)}_queryCell(t,s,h,m,g,x,I,P){const z=I.seenUids,L=this.boxCells[g];if(L!==null){const B=this.bboxes;for(const j of L)if(!z.box[j]){z.box[j]=!0;const X=4*j;if(t<=B[X+2]&&s<=B[X+3]&&h>=B[X+0]&&m>=B[X+1]&&(!P||P(this.boxKeys[j]))){if(I.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[j],x1:B[X],y1:B[X+1],x2:B[X+2],y2:B[X+3]})}}}const F=this.circleCells[g];if(F!==null){const B=this.circles;for(const j of F)if(!z.circle[j]){z.circle[j]=!0;const X=3*j;if(this._circleAndRectCollide(B[X],B[X+1],B[X+2],t,s,h,m)&&(!P||P(this.circleKeys[j]))){if(I.hitTest)return x.push(!0),!0;{const q=B[X],J=B[X+1],Q=B[X+2];x.push({key:this.circleKeys[j],x1:q-Q,y1:J-Q,x2:q+Q,y2:J+Q})}}}}}_queryCellCircle(t,s,h,m,g,x,I,P){const z=I.circle,L=I.seenUids,F=this.boxCells[g];if(F!==null){const j=this.bboxes;for(const X of F)if(!L.box[X]){L.box[X]=!0;const q=4*X;if(this._circleAndRectCollide(z.x,z.y,z.radius,j[q+0],j[q+1],j[q+2],j[q+3])&&(!P||P(this.boxKeys[X])))return x.push(!0),!0}}const B=this.circleCells[g];if(B!==null){const j=this.circles;for(const X of B)if(!L.circle[X]){L.circle[X]=!0;const q=3*X;if(this._circlesCollide(j[q],j[q+1],j[q+2],z.x,z.y,z.radius)&&(!P||P(this.circleKeys[X])))return x.push(!0),!0}}}_forEachCell(t,s,h,m,g,x,I,P){const z=this._convertToXCellCoord(t),L=this._convertToYCellCoord(s),F=this._convertToXCellCoord(h),B=this._convertToYCellCoord(m);for(let j=z;j<=F;j++)for(let X=L;X<=B;X++)if(g.call(this,t,s,h,m,this.xCellCount*X+j,x,I,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,h,m,g,x){const I=m-t,P=g-s,z=h+x;return z*z>I*I+P*P}_circleAndRectCollide(t,s,h,m,g,x,I){const P=(x-m)/2,z=Math.abs(t-(m+P));if(z>P+h)return!1;const L=(I-g)/2,F=Math.abs(s-(g+L));if(F>L+h)return!1;if(z<=P||F<=L)return!0;const B=z-P,j=F-L;return B*B+j*j<=h*h}}const Gr={unknown:0,flipRequired:1,flipNotRequired:2},Zu=Math.tan(85*Math.PI/180);function Vo(d,t,s,h,m,g,x){const I=i.ad.mat4.create();if(s)if(g.name==="globe"){const P=i.bo(m,t);i.ad.mat4.multiply(I,I,P)}else{const P=i.ad.mat2.invert([],x);I[0]=P[0],I[1]=P[1],I[4]=P[2],I[5]=P[3],h||i.ad.mat4.rotateZ(I,I,m.angle)}else i.ad.mat4.multiply(I,m.labelPlaneMatrix,d);return I}function Ha(d,t,s,h,m,g,x){const I=Vo(d,t,s,h,m,g,x);return g.name==="globe"&&s||(I[2]=I[6]=I[10]=I[14]=0),I}function Pi(d,t,s,h,m,g,x){if(s){if(g.name==="globe"){const I=Vo(d,t,s,h,m,g,x);return i.ad.mat4.invert(I,I),i.ad.mat4.multiply(I,d,I),I}{const I=i.ad.mat4.clone(d),P=i.ad.mat4.identity([]);return P[0]=x[0],P[1]=x[1],P[4]=x[2],P[5]=x[3],i.ad.mat4.multiply(I,I,P),h||i.ad.mat4.rotateZ(I,I,-m.angle),I}}return m.glCoordMatrix}function An(d,t,s,h){const m=[d,t,s,1];s?i.ad.vec4.transformMat4(m,m,h):Wa(m,m,h);const g=m[3];return m[0]/=g,m[1]/=g,m[2]/=g,m}function jm(d,t){return Math.min(.5+d/t*.5,1.5)}function Lc(d,t){const s=d[0]/d[3],h=d[1]/d[3];return s>=-t[0]&&s<=t[0]&&h>=-t[1]&&h<=t[1]}function Xu(d,t,s,h,m,g,x,I,P,z){const L=s.transform,F=h?d.textSizeData:d.iconSizeData,B=i.bp(F,s.transform.zoom),j=L.projection.name==="globe",X=[256/s.width*2+1,256/s.height*2+1],q=h?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;q.clear();let J=null;j&&(J=h?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const Q=d.lineVertexArray,oe=h?d.text.placedSymbolArray:d.icon.placedSymbolArray,ue=s.transform.width/s.transform.height;let ce,ge=!1;for(let pe=0;pe<oe.length;pe++){const _e=oe.get(pe),{numGlyphs:me,writingMode:we}=_e;if(we!==i.bq.vertical||ge||ce===i.bq.horizontal||(ge=!0),ce=we,(_e.hidden||we===i.bq.vertical)&&!ge){qa(me,q);continue}ge=!1;const Ee=new i.P(_e.tileAnchorX,_e.tileAnchorY);let{x:He,y:Be,z:et}=L.projection.projectTilePoint(Ee.x,Ee.y,z.canonical);if(P){const[Mt,Lt,Wt]=P(Ee);He+=Mt,Be+=Lt,et+=Wt}const rt=[He,Be,et,1];if(i.ad.vec4.transformMat4(rt,rt,t),!Lc(rt,X)){qa(me,q);continue}const _t=rt[3],Oe=jm(s.transform.getCameraToCenterDistance(L.projection),_t),Qe=i.br(F,B,_e),De=x?Qe/Oe:Qe*Oe,Je=An(He,Be,et,m);if(Je[3]<=0){qa(me,q);continue}let Ze={};const ot=i.ak(d.layers[0].layout.get("text-max-angle")),$e=Math.cos(ot),ct=x?null:P,Tt=Oc(_e,De,!1,I,t,m,g,d.glyphOffsetArray,Q,q,J,Je,Ee,Ze,ue,ct,L.projection,z,x,$e);ge=Tt.useVertical,ct&&Tt.needsFlipping&&(Ze={}),(Tt.notEnoughRoom||ge||Tt.needsFlipping&&Oc(_e,De,!0,I,t,m,g,d.glyphOffsetArray,Q,q,J,Je,Ee,Ze,ue,ct,L.projection,z,x,$e).notEnoughRoom)&&qa(me,q)}h?(d.text.dynamicLayoutVertexBuffer.updateData(q),J&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(J)):(d.icon.dynamicLayoutVertexBuffer.updateData(q),J&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(J))}function Tl(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J){const{lineStartIndex:Q,glyphStartIndex:oe,segment:ue}=I,ce=oe+I.numGlyphs,ge=Q+I.lineLength,pe=t.getoffsetX(oe),_e=t.getoffsetX(ce-1),me=Ei(d*pe,s,h,m,g,x,ue,Q,ge,P,z,L,F,B,!0,j,X,q,J);if(!me)return null;const we=Ei(d*_e,s,h,m,g,x,ue,Q,ge,P,z,L,F,B,!0,j,X,q,J);return we?{first:me,last:we}:null}function Ku(d,t,s,h){return d===i.bq.horizontal&&Math.abs(h)>Math.abs(s)?{useVertical:!0}:d===i.bq.vertical?h>0?{needsFlipping:!0}:null:t!==Gr.unknown&&function(m,g){return m===0||Math.abs(g/m)>Zu}(s,h)?t===Gr.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Oc(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe,ue){const ce=t/24,ge=d.lineOffsetX*ce,pe=d.lineOffsetY*ce,{lineStartIndex:_e,glyphStartIndex:me,numGlyphs:we,segment:Ee,writingMode:He,flipState:Be}=d,et=_e+d.lineLength,rt=_t=>{if(L){const[Je,Ze,ot]=_t.up,$e=z.length;i.bs(L,$e+0,Je,Ze,ot),i.bs(L,$e+1,Je,Ze,ot),i.bs(L,$e+2,Je,Ze,ot),i.bs(L,$e+3,Je,Ze,ot)}const[Oe,Qe,De]=_t.point;i.bt(z,Oe,Qe,De,_t.angle)};if(we>1){const _t=Tl(ce,I,ge,pe,s,F,B,d,P,g,j,q,!1,J,Q,oe,ue);if(!_t)return{notEnoughRoom:!0};if(h&&!s){let[Oe,Qe,De]=_t.first.point,[Je,Ze,ot]=_t.last.point;[Oe,Qe]=An(Oe,Qe,De,x),[Je,Ze]=An(Je,Ze,ot,x);const $e=Ku(He,Be,(Je-Oe)*X,Ze-Qe);if(d.flipState=$e&&$e.needsFlipping?Gr.flipRequired:Gr.flipNotRequired,$e)return $e}rt(_t.first);for(let Oe=me+1;Oe<me+we-1;Oe++){const Qe=Ei(ce*I.getoffsetX(Oe),ge,pe,s,F,B,Ee,_e,et,P,g,j,q,!1,!1,J,Q,oe,ue);if(!Qe)return z.length-=4*(Oe-me),{notEnoughRoom:!0};rt(Qe)}rt(_t.last)}else{if(h&&!s){const Oe=An(B.x,B.y,0,m),Qe=_e+Ee+1,De=new i.P(P.getx(Qe),P.gety(Qe)),Je=An(De.x,De.y,0,m),Ze=Je[3]>0?Je:Eo(B,De,Oe,1,m,void 0,J,Q.canonical),ot=Ku(He,Be,(Ze[0]-Oe[0])*X,Ze[1]-Oe[1]);if(d.flipState=ot&&ot.needsFlipping?Gr.flipRequired:Gr.flipNotRequired,ot)return ot}const _t=Ei(ce*I.getoffsetX(me),ge,pe,s,F,B,Ee,_e,et,P,g,j,q,!1,!1,J,Q,oe,ue);if(!_t)return{notEnoughRoom:!0};rt(_t)}return{}}function Vi(d,t,s,h,m){const{x:g,y:x,z:I}=h.projectTilePoint(d.x,d.y,t);if(!m)return An(g,x,I,s);const[P,z,L]=m(d);return An(g+P,x+z,I+L,s)}function Eo(d,t,s,h,m,g,x,I){const P=Vi(d.sub(t)._unit()._add(d),I,m,x,g);return i.ad.vec3.sub(P,s,P),i.ad.vec3.normalize(P,P),i.ad.vec3.scaleAndAdd(P,s,P,h)}function Ei(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe){const ue=h?d-t:d+t;let ce=ue>0?1:-1,ge=0;h&&(ce*=-1,ge=Math.PI),ce<0&&(ge+=Math.PI);let pe=I+x+(ce>0?0:1)|0,_e=m,me=m,we=0,Ee=0;const He=Math.abs(ue),Be=[],et=[];let rt=g,_t=rt,Oe=i.ad.vec3.zero([]);const Qe=()=>Eo(_t,rt,me,He-we+1,L,B,q,J.canonical);for(;we+Ee<=He;){if(pe+=ce,pe<I||pe>=P)return null;if(me=_e,_t=rt,Be.push(me),j&&et.push(_t),rt=new i.P(z.getx(pe),z.gety(pe)),_e=F[pe],!_e){const Wt=Vi(rt,J.canonical,L,q,B);_e=Wt[3]>0?F[pe]=Wt:Qe()}we+=Ee;const Mt=i.ad.vec3.sub([],_e,me),Lt=i.ad.vec3.distance(me,_e);if(s&&Lt>0&&Ee>0&&i.ad.vec3.dot(Oe,Mt)/(Ee*Lt)<oe)return null;Ee=Lt,Oe=Mt}X&&B&&(F[pe]&&(_e=Qe(),Ee=i.ad.vec3.distance(me,_e),Oe=i.ad.vec3.sub([],_e,me)),F[pe]=_e);const De=(He-we)/Ee,Je=rt.sub(_t)._mult(De)._add(_t),Ze=i.ad.vec3.scaleAndAdd([],me,Oe,De);let ot=[0,0,1],$e=Oe[0],ct=Oe[1];if(Q&&(ot=q.upVector(J.canonical,Je.x,Je.y),ot[0]!==0||ot[1]!==0||ot[2]!==1)){const Mt=[ot[2],0,-ot[0]],Lt=i.ad.vec3.cross([],ot,Mt);i.ad.vec3.normalize(Mt,Mt),i.ad.vec3.normalize(Lt,Lt),$e=i.ad.vec3.dot(Oe,Mt),ct=i.ad.vec3.dot(Oe,Lt)}if(s){const Mt=i.ad.vec3.cross([],ot,Oe);i.ad.vec3.normalize(Mt,Mt),i.ad.vec3.scaleAndAdd(Ze,Ze,Mt,s*ce)}const Tt=ge+Math.atan2(ct,$e);return Be.push(Ze),j&&et.push(Je),{point:Ze,angle:Tt,path:Be,tilePath:et,up:ot}}function qa(d,t){const s=t.length,h=s+4*d;t.resize(h),t.float32.fill(-1/0,4*s,4*h)}function Wa(d,t,s){const h=t[0],m=t[1];return d[0]=s[0]*h+s[4]*m+s[12],d[1]=s[1]*h+s[5]*m+s[13],d[3]=s[3]*h+s[7]*m+s[15],d}const kn=100;class eo{constructor(t,s,h=new Ga(t.width+200,t.height+200,25),m=new Ga(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+kn,this.screenBottomBoundary=t.height+kn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,h,m,g,x,I,P){let z=h.projectedAnchorX,L=h.projectedAnchorY,F=h.projectedAnchorZ;const B=h.elevation,j=h.tileID,X=t.getProjection();if(B&&j){const[pe,_e,me]=X.upVector(j.canonical,h.tileAnchorX,h.tileAnchorY),we=X.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=pe*B*we,L+=_e*B*we,F+=me*B*we}const q=this.projectAndGetPerspectiveRatio(I,z,L,F,h.tileID,X.name==="globe"||!!B||this.transform.pitch>0,X),J=x*q.perspectiveRatio,Q=(h.x1*s+m.x-h.padding)*J+q.point.x,oe=(h.y1*s+m.y-h.padding)*J+q.point.y,ue=(h.x2*s+m.x+h.padding)*J+q.point.x,ce=(h.y2*s+m.y+h.padding)*J+q.point.y,ge=q.perspectiveRatio<=.55||q.occluded;return!this.isInsideGrid(Q,oe,ue,ce)||!g&&this.grid.hitTest(Q,oe,ue,ce,P)||ge?{box:[],offscreen:!1,occluded:q.occluded}:{box:[Q,oe,ue,ce],offscreen:this.isOffscreen(Q,oe,ue,ce),occluded:!1}}placeCollisionCircles(t,s,h,m,g,x,I,P,z,L,F,B,j,X,q){const J=[],Q=this.transform.elevation,oe=t.getProjection(),ue=Q?Q.getAtTileOffsetFunc(q,this.transform.center.lat,this.transform.worldSize,oe):null,ce=new i.P(h.tileAnchorX,h.tileAnchorY);let{x:ge,y:pe,z:_e}=oe.projectTilePoint(ce.x,ce.y,q.canonical);if(ue){const[ot,$e,ct]=ue(ce);ge+=ot,pe+=$e,_e+=ct}const me=oe.name==="globe",we=this.projectAndGetPerspectiveRatio(I,ge,pe,_e,q,me||!!Q||this.transform.pitch>0,oe),{perspectiveRatio:Ee}=we,He=(F?x/Ee:x*Ee)/i.bw,Be=An(ge,pe,_e,P),et=h.lineOffsetX*He,rt=h.lineOffsetY*He,_t=i.ak(t.layers[0].layout.get("text-max-angle")),Oe=Math.cos(_t),Qe=we.signedDistanceFromCamera>0?Tl(He,g,et,rt,!1,Be,ce,h,m,P,{},Q&&!F?ue:null,F&&!!Q,oe,q,F,Oe):null;let De=!1,Je=!1,Ze=!0;if(Qe&&!we.occluded){const ot=.5*j*Ee+X,$e=new i.P(-100,-100),ct=new i.P(this.screenRightBoundary,this.screenBottomBoundary),Tt=new ns,{first:Mt,last:Lt}=Qe,Wt=Mt.path.length;let pr=[];for(let hr=Wt-1;hr>=1;hr--)pr.push(Mt.path[hr]);for(let hr=1;hr<Lt.path.length;hr++)pr.push(Lt.path[hr]);const nr=2.5*ot;z&&(pr=pr.map(([hr,Br,on],pn)=>(ue&&!me&&(on=ue(pn<Wt-1?Mt.tilePath[Wt-1-pn]:Lt.tilePath[pn-Wt+2])[2]),An(hr,Br,on,z))),pr.some(hr=>hr[3]<=0)&&(pr=[]));let mr=[];if(pr.length>0){let hr=1/0,Br=-1/0,on=1/0,pn=-1/0;for(const Dr of pr)hr=Math.min(hr,Dr[0]),on=Math.min(on,Dr[1]),Br=Math.max(Br,Dr[0]),pn=Math.max(pn,Dr[1]);Br>=$e.x&&hr<=ct.x&&pn>=$e.y&&on<=ct.y&&(mr=[pr.map(Dr=>new i.P(Dr[0],Dr[1]))],(hr<$e.x||Br>ct.x||on<$e.y||pn>ct.y)&&(mr=i.bu(mr,$e.x,$e.y,ct.x,ct.y)))}for(const hr of mr){Tt.reset(hr,.25*ot);let Br=0;Br=Tt.length<=.5*ot?1:Math.ceil(Tt.paddedLength/nr)+1;for(let on=0;on<Br;on++){const pn=on/Math.max(Br-1,1),Dr=Tt.lerp(pn),zn=Dr.x+kn,wr=Dr.y+kn;J.push(zn,wr,ot,0);const gr=zn-ot,or=wr-ot,en=zn+ot,tn=wr+ot;if(Ze=Ze&&this.isOffscreen(gr,or,en,tn),Je=Je||this.isInsideGrid(gr,or,en,tn),!s&&this.grid.hitTestCircle(zn,wr,ot,B)&&(De=!0,!L))return{circles:[],offscreen:!1,collisionDetected:De,occluded:!1}}}}return{circles:!L&&De||!Je?[]:J,offscreen:Ze,collisionDetected:De,occluded:we.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,m=1/0,g=-1/0,x=-1/0;for(const L of t){const F=new i.P(L.x+kn,L.y+kn);h=Math.min(h,F.x),m=Math.min(m,F.y),g=Math.max(g,F.x),x=Math.max(x,F.y),s.push(F)}const I=this.grid.query(h,m,g,x).concat(this.ignoredGrid.query(h,m,g,x)),P={},z={};for(const L of I){const F=L.key;if(P[F.bucketInstanceId]===void 0&&(P[F.bucketInstanceId]={}),P[F.bucketInstanceId][F.featureIndex])continue;const B=[new i.P(L.x1,L.y1),new i.P(L.x2,L.y1),new i.P(L.x2,L.y2),new i.P(L.x1,L.y2)];i.bv(s,B)&&(P[F.bucketInstanceId][F.featureIndex]=!0,z[F.bucketInstanceId]===void 0&&(z[F.bucketInstanceId]=[]),z[F.bucketInstanceId].push(F.featureIndex))}return z}insertCollisionBox(t,s,h,m,g){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,h,m,g){const x=s?this.ignoredGrid:this.grid,I={bucketInstanceId:h,featureIndex:m,collisionGroupID:g};for(let P=0;P<t.length;P+=4)x.insertCircle(I,t[P],t[P+1],t[P+2])}projectAndGetPerspectiveRatio(t,s,h,m,g,x,I){const P=[s,h,m,1];let z=!1;m||this.transform.pitch>0?(i.ad.vec4.transformMat4(P,P,t),this.fogState&&g&&I.name!=="globe"&&(z=function(B,j,X,q,J,Q){const oe=Q.calculateFogTileMatrix(J),ue=[j,X,q];return i.ad.vec3.transformMat4(ue,ue,oe),Nt(B,i.ad.vec3.length(ue),Q.pitch,Q._fov)}(this.fogState,s,h,m,g.toUnwrapped(),this.transform)>.9)):Wa(P,P,t);const L=P[3];return{point:new i.P((P[0]/L+1)/2*this.transform.width+kn,(-P[1]/L+1)/2*this.transform.height+kn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/L*.5,1.5),signedDistanceFromCamera:L,occluded:x&&P[2]>L||z}}isOffscreen(t,s,h,m){return h<kn||t>=this.screenRightBoundary||m<kn||s>this.screenBottomBoundary}isInsideGrid(t,s,h,m){return h>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=i.ad.mat4.identity([]);return i.ad.mat4.translate(t,t,[-100,-100,0]),t}}function to(d,t,s){const h=t.createTileMatrix(d,d.worldSize,s.toUnwrapped());return i.ad.mat4.multiply(new Float32Array(16),d.projMatrix,h)}function ai(d,t,s){if(t.projection.name===s.projection.name)return d.projMatrix;const h=s.clone();return h.setProjection(t.projection),to(h,t.getProjection(),d)}function kc(d,t,s){return t.name===s.projection.name?d.projMatrix:to(s,t,d)}class Us{constructor(t,s,h,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Uo{constructor(t,s,h,m,g,x=!1){this.text=new Us(t?t.text:null,s,h,g),this.icon=new Us(t?t.icon:null,s,m,g),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Sl{constructor(t,s,h,m=!1){this.text=t,this.icon=s,this.skipFade=h,this.clipped=m}}class Za{constructor(){this.invProjMatrix=i.ad.mat4.create(),this.viewportMatrix=i.ad.mat4.create(),this.circles=[]}}class e0{constructor(t,s,h,m,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=g}}class jo{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[t]}}function $m(d,t,s,h,m){const{horizontalAlign:g,verticalAlign:x}=i.bD(d),I=-(g-.5)*t,P=-(x-.5)*s,z=i.bC(d,h);return new i.P(I+z[0]*m,P+z[1]*m)}function Fc(d,t,s,h,m){const g=new i.P(d,t);return s&&g._rotate(h?m:-m),g}class is{constructor(t,s,h,m,g,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new eo(this.transform,g),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new jo(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,h,m,g=1){const x=h.getBucket(s),I=h.latestFeatureIndex;if(!x||!I||s.fqid!==x.layerIds[0])return;const P=x.layers[0].layout,z=x.layers[0].paint,L=h.collisionBoxArray,F=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),B=h.tileSize/i.ai,j=h.tileID.toUnwrapped();this.transform.setProjection(x.projection);const X=(q=h.tileID,J=x.getProjection(),Q=this.transform,J.name===this.projection?Q.calculateProjMatrix(q.toUnwrapped()):to(Q,J,q));var q,J,Q;const oe=P.get("text-pitch-alignment")==="map",ue=P.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const ce=s.dynamicFilter(),ge=s.dynamicFilterNeedsFeature(),pe=this.transform.calculatePixelsToTileUnitsMatrix(h),_e=Ha(X,h.tileID.canonical,oe,ue,this.transform,x.getProjection(),pe);let me=null;if(oe){const Qe=Pi(X,h.tileID.canonical,oe,ue,this.transform,x.getProjection(),pe);me=i.ad.mat4.multiply([],this.transform.labelPlaneMatrix,Qe)}let we=null;ce&&h.latestFeatureIndex&&(we={unwrappedTileID:j,dynamicFilter:ce,dynamicFilterNeedsFeature:ge}),this.retainedQueryData[x.bucketInstanceId]=new e0(x.bucketInstanceId,I,x.sourceLayerIndex,x.index,h.tileID);const[Ee,He]=x.layers[0].layout.get("text-size-scale-range"),Be=i.ay(g,Ee,He),[et,rt]=P.get("icon-size-scale-range"),_t=i.ay(g,et,rt),Oe={bucket:x,layout:P,paint:z,posMatrix:X,textLabelPlaneMatrix:_e,labelToScreenMatrix:me,clippingData:we,scale:F,textPixelRatio:B,holdingForFade:h.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:i.bp(x.textSizeData,this.transform.zoom,Be),partiallyEvaluatedIconSize:i.bp(x.iconSizeData,this.transform.zoom,_t),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(m)for(const Qe of x.sortKeyRanges){const{sortKey:De,symbolInstanceStart:Je,symbolInstanceEnd:Ze}=Qe;t.push({sortKey:De,symbolInstanceStart:Je,symbolInstanceEnd:Ze,parameters:Oe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Oe})}attemptAnchorPlacement(t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe){const{textOffset0:ue,textOffset1:ce,crossTileID:ge}=B,pe=[ue,ce],_e=$m(t,h,m,pe,g),me=this.collisionIndex.placeCollisionBox(X,g,s,Fc(_e.x,_e.y,x,I,this.transform.angle),F,P,z,L.predicate);if(J){const we=X.getSymbolInstanceIconSize(oe,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(X,we,J,Fc(_e.x,_e.y,x,I,this.transform.angle),F,P,z,L.predicate).box.length===0)return}if(me.box.length>0){let we;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(we=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:pe,width:h,height:m,anchor:t,textScale:g,prevAnchor:we},this.markUsedJustification(X,t,B,q),X.allowVerticalPlacement&&(this.markUsedOrientation(X,q,B),this.placedOrientations[ge]=q),{shift:_e,placedGlyphBoxes:me}}}placeLayerBucketPart(t,s,h,m,g=1){const{bucket:x,layout:I,paint:P,posMatrix:z,textLabelPlaneMatrix:L,labelToScreenMatrix:F,clippingData:B,textPixelRatio:j,holdingForFade:X,collisionBoxArray:q,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:Q,collisionGroup:oe,latestFeatureIndex:ue}=t.parameters,ce=I.get("text-optional"),ge=I.get("icon-optional"),pe=I.get("text-allow-overlap"),_e=I.get("icon-allow-overlap"),me=I.get("text-rotation-alignment")==="map",we=I.get("text-pitch-alignment")==="map",Ee=P.get("symbol-z-offset"),He=I.get("symbol-elevation-reference")==="sea",[Be,et]=I.get("text-size-scale-range"),[rt,_t]=I.get("icon-size-scale-range"),Oe=i.ay(g,Be,et),Qe=i.ay(g,rt,_t);this.transform.setProjection(x.projection);let De=pe&&(_e||!x.hasIconData()||ge),Je=_e&&(pe||!x.hasTextData()||ce);const Ze=!Ee.isConstant();!x.collisionArrays&&q&&x.deserializeCollisionBoxes(q),h&&m&&x.updateCollisionDebugBuffers(this.transform.zoom,q,Oe,Qe);const ot=($e,ct,Tt)=>{const{crossTileID:Mt,numVerticalGlyphVertices:Lt}=$e;let Wt=null;if(B&&B.dynamicFilterNeedsFeature||Ze){const rn=this.retainedQueryData[x.bucketInstanceId];Wt=ue.loadFeature({featureIndex:$e.featureIndex,bucketIndex:rn.bucketIndex,sourceLayerIndex:rn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Wt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new i.P($e.tileAnchorX,$e.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Mt]=new Sl(!1,!1,!1,!0),void s.add(Mt);const pr=Ee.evaluate(Wt,{});if(s.has(Mt))return;if(X)return void(this.placements[Mt]=new Sl(!1,!1,!1));let nr=!1,mr=!1,hr=!0,Br=!1,on=!1,pn=null,Dr={box:null,offscreen:null,occluded:null},zn={box:null},wr=null,gr=null,or=null,en=0,tn=0,qn=0;Tt.textFeatureIndex?en=Tt.textFeatureIndex:$e.useRuntimeCollisionCircles&&(en=$e.featureIndex),Tt.verticalTextFeatureIndex&&(tn=Tt.verticalTextFeatureIndex);const di=rn=>{rn.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const In=this.transform.elevation;rn.elevation=He?pr:pr+(In?In.getAtTileOffset(rn.tileID,rn.tileAnchorX,rn.tileAnchorY):0),rn.elevation+=$e.zOffset},Qi=Tt.textBox;if(Qi){di(Qi);const rn=an=>{let mn=i.bq.horizontal;if(x.allowVerticalPlacement&&!an&&this.prevPlacement){const mi=this.prevPlacement.placedOrientations[Mt];mi&&(this.placedOrientations[Mt]=mi,mn=mi,this.markUsedOrientation(x,mn,$e))}return mn},In=(an,mn)=>{if(x.allowVerticalPlacement&&Lt>0&&Tt.verticalTextBox){for(const mi of x.writingModes)if(mi===i.bq.vertical?(Dr=mn(),zn=Dr):Dr=an(),Dr&&Dr.box&&Dr.box.length)break}else Dr=an()};if(I.get("text-variable-anchor")){let an=I.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Mt]){const Fn=this.prevPlacement.variableOffsets[Mt];an.indexOf(Fn.anchor)>0&&(an=an.filter(li=>li!==Fn.anchor),an.unshift(Fn.anchor))}const mn=(Fn,li,Do)=>{const es=x.getSymbolInstanceTextSize(J,$e,this.transform.zoom,ct),Hs=(Fn.x2-Fn.x1)*es+2*Fn.padding,Ko=(Fn.y2-Fn.y1)*es+2*Fn.padding,zi=$e.hasIconTextFit&&!_e?li:null;zi&&di(zi);let Cs={box:[],offscreen:!1,occluded:!1};const zo=pe?2*an.length:an.length;for(let oo=0;oo<zo;++oo){const Yo=this.attemptAnchorPlacement(an[oo%an.length],Fn,Hs,Ko,es,me,we,j,z,oe,oo>=an.length,$e,ct,x,Do,zi,J,Q);if(Yo&&(Cs=Yo.placedGlyphBoxes,Cs&&Cs.box&&Cs.box.length)){nr=!0,pn=Yo.shift;break}}return Cs};In(()=>mn(Qi,Tt.iconBox,i.bq.horizontal),()=>{const Fn=Tt.verticalTextBox;return Fn&&di(Fn),x.allowVerticalPlacement&&!(Dr&&Dr.box&&Dr.box.length)&&Lt>0&&Fn?mn(Fn,Tt.verticalIconBox,i.bq.vertical):{box:null,offscreen:null,occluded:null}}),Dr&&(nr=Dr.box,hr=Dr.offscreen,Br=Dr.occluded);const mi=rn(!(!Dr||!Dr.box));if(!nr&&this.prevPlacement){const Fn=this.prevPlacement.variableOffsets[Mt];Fn&&(this.variableOffsets[Mt]=Fn,this.markUsedJustification(x,Fn.anchor,$e,mi))}}else{const an=(mn,mi)=>{const Fn=x.getSymbolInstanceTextSize(J,$e,this.transform.zoom,ct,g),li=this.collisionIndex.placeCollisionBox(x,Fn,mn,new i.P(0,0),pe,j,z,oe.predicate);return li&&li.box&&li.box.length&&(this.markUsedOrientation(x,mi,$e),this.placedOrientations[Mt]=mi),li};In(()=>an(Qi,i.bq.horizontal),()=>{const mn=Tt.verticalTextBox;return x.allowVerticalPlacement&&Lt>0&&mn?(di(mn),an(mn,i.bq.vertical)):{box:null,offscreen:null,occluded:null}}),rn(!!(Dr&&Dr.box&&Dr.box.length))}}if(wr=Dr,nr=wr&&wr.box&&wr.box.length>0,hr=wr&&wr.offscreen,Br=wr&&wr.occluded,$e.useRuntimeCollisionCircles){const rn=x.text.placedSymbolArray.get($e.centerJustifiedTextSymbolIndex>=0?$e.centerJustifiedTextSymbolIndex:$e.verticalPlacedTextSymbolIndex),In=i.br(x.textSizeData,J,rn),an=I.get("text-padding");gr=this.collisionIndex.placeCollisionCircles(x,pe,rn,x.lineVertexArray,x.glyphOffsetArray,In,z,L,F,h,we,oe.predicate,$e.collisionCircleDiameter*In/i.bw,an,this.retainedQueryData[x.bucketInstanceId].tileID),nr=pe||gr.circles.length>0&&!gr.collisionDetected,hr=hr&&gr.offscreen,Br=gr.occluded}if(Tt.iconFeatureIndex&&(qn=Tt.iconFeatureIndex),Tt.iconBox){const rn=In=>{di(In);const an=$e.hasIconTextFit&&pn?Fc(pn.x,pn.y,me,we,this.transform.angle):new i.P(0,0),mn=x.getSymbolInstanceIconSize(Q,this.transform.zoom,$e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,mn,In,an,_e,j,z,oe.predicate)};zn&&zn.box&&zn.box.length&&Tt.verticalIconBox?(or=rn(Tt.verticalIconBox),mr=or.box.length>0):(or=rn(Tt.iconBox),mr=or.box.length>0),hr=hr&&or.offscreen,on=or.occluded}const fi=ce||$e.numHorizontalGlyphVertices===0&&Lt===0,Ti=ge||$e.numIconVertices===0;if(fi||Ti?Ti?fi||(mr=mr&&nr):nr=mr&&nr:mr=nr=mr&&nr,nr&&wr&&wr.box&&this.collisionIndex.insertCollisionBox(wr.box,I.get("text-ignore-placement"),x.bucketInstanceId,zn&&zn.box&&tn?tn:en,oe.ID),mr&&or&&this.collisionIndex.insertCollisionBox(or.box,I.get("icon-ignore-placement"),x.bucketInstanceId,qn,oe.ID),gr&&(nr&&this.collisionIndex.insertCollisionCircles(gr.circles,I.get("text-ignore-placement"),x.bucketInstanceId,en,oe.ID),h)){const rn=x.bucketInstanceId;let In=this.collisionCircleArrays[rn];In===void 0&&(In=this.collisionCircleArrays[rn]=new Za);for(let an=0;an<gr.circles.length;an+=4)In.circles.push(gr.circles[an+0]),In.circles.push(gr.circles[an+1]),In.circles.push(gr.circles[an+2]),In.circles.push(gr.collisionDetected?1:0)}const Ui=x.projection.name!=="globe";De=De&&(Ui||!Br),Je=Je&&(Ui||!on),this.placements[Mt]=new Sl(nr||De,mr||Je,hr||x.justReloaded),s.add(Mt)};if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.elevationType==="road"&&x.updateRoadElevation(),x.updateZOffset(),x.sortFeaturesByY){const $e=x.getSortedSymbolIndexes(this.transform.angle);for(let ct=$e.length-1;ct>=0;--ct){const Tt=$e[ct];ot(x.symbolInstances.get(Tt),Tt,x.collisionArrays[Tt])}x.hasAnyZOffset&&i.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const $e=x.getSortedIndexesByZOffset();for(let ct=0;ct<$e.length;++ct){const Tt=$e[ct];ot(x.symbolInstances.get(Tt),Tt,x.collisionArrays[Tt])}}else for(let $e=t.symbolInstanceStart;$e<t.symbolInstanceEnd;$e++)ot(x.symbolInstances.get($e),$e,x.collisionArrays[$e]);if(h&&x.bucketInstanceId in this.collisionCircleArrays){const $e=this.collisionCircleArrays[x.bucketInstanceId];i.ad.mat4.invert($e.invProjMatrix,z),$e.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,s,h,m){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:P,crossTileID:z}=h,L=i.bB(s),F=m===i.bq.vertical?P:L==="left"?g:L==="center"?x:L==="right"?I:-1;g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=F>=0&&g!==F?0:z),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:z),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=F>=0&&I!==F?0:z),P>=0&&(t.text.placedSymbolArray.get(P).crossTileID=F>=0&&P!==F?0:z)}markUsedOrientation(t,s,h){const m=s===i.bq.horizontal||s===i.bq.horizontalOnly?s:0,g=s===i.bq.vertical?s:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:z}=h,L=t.text.placedSymbolArray;x>=0&&(L.get(x).placedOrientation=m),I>=0&&(L.get(I).placedOrientation=m),P>=0&&(L.get(P).placedOrientation=m),z>=0&&(L.get(z).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},x=s?s.variableOffsets:{},I=s?s.placedOrientations:{};for(const P in this.placements){const z=this.placements[P],L=g[P];L?(this.opacities[P]=new Uo(L,m,z.text,z.icon,null,z.clipped),h=h||z.text!==L.text.placed||z.icon!==L.icon.placed):(this.opacities[P]=new Uo(null,m,z.text,z.icon,z.skipFade,z.clipped),h=h||z.text||z.icon)}for(const P in g){const z=g[P];if(!this.opacities[P]){const L=new Uo(z,m,!1,!1);L.isHidden()||(this.opacities[P]=L,h=h||z.text.placed||z.icon.placed)}}for(const P in x)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=x[P]);for(const P in I)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=I[P]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,h,m){const g=new Set;for(const x of s){const I=x.getBucket(t);I&&x.latestFeatureIndex&&t.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,g,x,x.collisionBoxArray,h,m,x.tileID,t.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,x.tileID),I.elevationType==="road"&&I.updateRoadElevation(),I.updateZOffset())}}updateBucketOpacities(t,s,h,m,g,x,I,P){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const z=t.layers[0].layout,L=t.layers[0].paint,F=!!t.layers[0].dynamicFilter(),B=new Uo(null,0,!1,!1,!0),j=z.get("text-allow-overlap"),X=z.get("icon-allow-overlap"),q=z.get("text-variable-anchor"),J=z.get("text-rotation-alignment")==="map",Q=z.get("text-pitch-alignment")==="map",oe=L.get("symbol-z-offset"),ue=z.get("symbol-elevation-reference")==="sea",ce=!oe.isConstant(),ge=new Uo(null,0,j&&(X||!t.hasIconData()||z.get("icon-optional")),X&&(j||!t.hasTextData()||z.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const pe=(me,we,Ee)=>{for(let He=0;He<we/4;He++)me.opacityVertexArray.emplaceBack(Ee)};let _e=0;x&&t.updateReplacement(I,x);for(let me=0;me<t.symbolInstances.length;me++){const we=t.symbolInstances.get(me),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:He,crossTileID:Be,numIconVertices:et,tileAnchorX:rt,tileAnchorY:_t}=we;let Oe=null;const Qe=this.retainedQueryData[t.bucketInstanceId];ce&&we&&Qe&&(Oe=h.latestFeatureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:Qe.bucketIndex,sourceLayerIndex:Qe.sourceLayerIndex,layoutVertexArrayOffset:0}));const De=oe.evaluate(Oe,{}),Je=s.has(Be);let Ze=this.opacities[Be];Je?Ze=B:Ze||(Ze=ge,this.opacities[Be]=Ze),s.add(Be);const ot=Ee>0||He>0,$e=et>0,ct=this.placedOrientations[Be],Tt=ct===i.bq.vertical,Mt=ct===i.bq.horizontal||ct===i.bq.horizontalOnly;!ot&&!$e||Ze.isHidden()||_e++;let Lt=!1;if((ot||$e)&&x)for(const Wt of t.activeReplacements){if(i.bx(Wt,g,i.by.Symbol,P)||Wt.min.x>rt||rt>Wt.max.x||Wt.min.y>_t||_t>Wt.max.y)continue;const pr=i.bz(rt,_t,I.canonical,Wt.footprintTileId.canonical);if(Lt=i.bA(pr,Wt.footprint),Lt)break}if(ot){const Wt=Lt?ro:Hm(Ze.text);pe(t.text,Ee,Tt?ro:Wt),pe(t.text,He,Mt?ro:Wt);const pr=Ze.text.isHidden(),{leftJustifiedTextSymbolIndex:nr,centerJustifiedTextSymbolIndex:mr,rightJustifiedTextSymbolIndex:hr,verticalPlacedTextSymbolIndex:Br}=we,on=t.text.placedSymbolArray,pn=pr||Tt?1:0;nr>=0&&(on.get(nr).hidden=pn),mr>=0&&(on.get(mr).hidden=pn),hr>=0&&(on.get(hr).hidden=pn),Br>=0&&(on.get(Br).hidden=pr||Mt?1:0);const Dr=this.variableOffsets[Be];Dr&&this.markUsedJustification(t,Dr.anchor,we,ct);const zn=this.placedOrientations[Be];zn&&(this.markUsedJustification(t,"left",we,zn),this.markUsedOrientation(t,zn,we))}if($e){const Wt=Lt?ro:Hm(Ze.icon),{placedIconSymbolIndex:pr,verticalPlacedIconSymbolIndex:nr}=we,mr=t.icon.placedSymbolArray,hr=Ze.icon.isHidden()?1:0;pr>=0&&(pe(t.icon,et,Tt?ro:Wt),mr.get(pr).hidden=hr),nr>=0&&(pe(t.icon,we.numVerticalIconVertices,Mt?ro:Wt),mr.get(nr).hidden=hr)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Wt=t.collisionArrays[me];if(Wt){let pr=new i.P(0,0),nr=!0;if(Wt.textBox||Wt.verticalTextBox){if(q){const hr=this.variableOffsets[Be];hr?(pr=$m(hr.anchor,hr.width,hr.height,hr.textOffset,hr.textScale),J&&pr._rotate(Q?this.transform.angle:-this.transform.angle)):nr=!1}F&&(nr=!Ze.clipped),Wt.textBox&&Yu(t.textCollisionBox.collisionVertexArray,Ze.text.placed,!nr||Tt,De,ue,pr.x,pr.y),Wt.verticalTextBox&&Yu(t.textCollisionBox.collisionVertexArray,Ze.text.placed,!nr||Mt,De,ue,pr.x,pr.y)}const mr=nr&&!!(!Mt&&Wt.verticalIconBox);Wt.iconBox&&Yu(t.iconCollisionBox.collisionVertexArray,Ze.icon.placed,mr,De,ue,we.hasIconTextFit?pr.x:0,we.hasIconTextFit?pr.y:0),Wt.verticalIconBox&&Yu(t.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!mr,De,ue,we.hasIconTextFit?pr.x:0,we.hasIconTextFit?pr.y:0)}}}if(t.fullyClipped=_e===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=me.invProjMatrix,t.placementViewportMatrix=me.viewportMatrix,t.collisionCircleArray=me.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function Yu(d,t,s,h,m,g,x){d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0),d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0),d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0),d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0)}const Ju=Math.pow(2,25),Gm=Math.pow(2,24),Bc=Math.pow(2,17),t0=Math.pow(2,16),r0=Math.pow(2,9),Nc=Math.pow(2,8),Vc=Math.pow(2,1);function Hm(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,s=Math.floor(127*d.opacity);return s*Ju+t*Gm+s*Bc+t*t0+s*r0+t*Nc+s*Vc+t}const ro=0;class qm{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,h,m,g,x){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(I,m,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort((P,z)=>P.sortKey-z.sortKey));this._currentPartIndex<I.length;){const P=I[this._currentPartIndex];if(s.placeLayerBucketPart(P,this._seenCrossTileIDs,h,P.symbolInstanceStart===0,x),this._currentPartIndex++,g())return!0}return!1}}class Qu{constructor(t,s,h,m,g,x,I,P,z){this.placement=new is(t,g,x,I,P,z),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,h,m,g){const x=i.q.now(),I=()=>{const P=i.q.now()-x;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=s[t[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=z)&&(!P.maxzoom||P.maxzoom>z)){const L=P,F=L.layout.get("symbol-z-elevate"),B=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=L.layout.get("symbol-z-order"),X=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&B),q=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),J=X&&q,Q=this._inProgressLayer=this._inProgressLayer||new qm(L),oe=i.C(P.source,P.scope);if(Q.continuePlacement(F||J?m[oe]:h[oe],this.placement,this._showCollisionBoxes,P,I,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ao=512/i.ai/2;class n0{constructor(t,s,h){this.tileID=t,this.bucketInstanceId=h,this.index=new i.bE(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=t.canonical.x*i.ai,g=t.canonical.y*i.ai;for(let x=0;x<s.length;x++){const{key:I,crossTileID:P,tileAnchorX:z,tileAnchorY:L}=s.get(x),F=Math.floor((m+z)*Ao),B=Math.floor((g+L)*Ao);this.index.add(F,B),this.keys.push(I),this.crossTileIDs.push(P)}this.index.finish()}findMatches(t,s,h){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),g=Ao/Math.pow(2,s.canonical.z-this.tileID.canonical.z),x=s.canonical.x*i.ai,I=s.canonical.y*i.ai;for(let P=0;P<t.length;P++){const z=t.get(P);if(z.crossTileID)continue;const{key:L,tileAnchorX:F,tileAnchorY:B}=z,j=Math.floor((x+F)*g),X=Math.floor((I+B)*g),q=this.index.range(j-m,X-m,j+m,X+m);for(const J of q){const Q=this.crossTileIDs[J];if(this.keys[J]===L&&!h.has(Q)){h.add(Q),z.crossTileID=Q;break}}}}}class i0{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class s0{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const h in this.indexes){const m=this.indexes[h],g={};for(const x in m){const I=m[x];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+s),g[I.tileID.key]=I}this.indexes[h]=g}this.lng=t}addBucket(t,s,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const m=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const I in x){const P=x[I];P.tileID.isChildOf(t)&&P.findMatches(s.symbolInstances,t,m)}else{const I=x[t.scaledTo(Number(g)).key];I&&I.findMatches(s.symbolInstances,t,m)}}for(let g=0;g<s.symbolInstances.length;g++){const x=s.symbolInstances.get(g);x.crossTileID||(x.crossTileID=h.generate(),m.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new n0(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const h of s.crossTileIDs)this.usedCrossTileIDs[t].delete(h)}removeStaleBuckets(t){let s=!1;for(const h in this.indexes){const m=this.indexes[h];for(const g in m)t[m[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[g]),delete m[g],s=!0)}return s}}class Wm{constructor(){this.layerIndexes={},this.crossTileIDs=new i0,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,h,m){let g=this.layerIndexes[t.fqid];g===void 0&&(g=this.layerIndexes[t.fqid]=new s0);let x=!1;const I={};m.name!=="globe"&&g.handleWrapJump(h);for(const P of s){const z=P.getBucket(t);z&&t.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(P.tileID,z,this.crossTileIDs)&&(x=!0),I[z.bucketInstanceId]=!0)}return g.removeStaleBuckets(I)&&(x=!0),x}pruneUnusedLayers(t){const s={};t.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const El=771;class Rr{constructor(t,s,h,m){this.blendFunction=t,this.blendColor=s,this.mask=h,this.blendEquation=m}}Rr.Replace=[1,0,1,0],Rr.disabled=new Rr(Rr.Replace,i.al.transparent,[!1,!1,!1,!1]),Rr.unblended=new Rr(Rr.Replace,i.al.transparent,[!0,!0,!0,!0]),Rr.alphaBlended=new Rr([1,El,1,El],i.al.transparent,[!0,!0,!0,!0]),Rr.alphaBlendedNonPremultiplied=new Rr([770,El,770,El],i.al.transparent,[!0,!0,!0,!0]),Rr.multiply=new Rr([774,0,774,0],i.al.transparent,[!0,!0,!0,!0]);class Xt{constructor(t,s,h){this.func=t,this.mask=s,this.range=h}}Xt.ReadOnly=!1,Xt.ReadWrite=!0,Xt.disabled=new Xt(519,Xt.ReadOnly,[0,1]);const eh=7680;class br{constructor(t,s,h,m,g,x){this.test=t,this.ref=s,this.mask=h,this.fail=m,this.depthFail=g,this.pass=x}}br.disabled=new br({func:519,mask:0},0,0,eh,eh,eh);const th=1029,$o=2305;class fr{constructor(t,s,h){this.enable=t,this.mode=s,this.frontFace=h}}function ef(d,t){const s=i.bG(d,3);i.ad.mat4.fromQuat(d,t),i.bI(d,3,s)}function rh(d,t){const s=i.ad.quat.identity([]);return i.ad.quat.rotateZ(s,s,-t),i.ad.quat.rotateX(s,s,-d),s}function Al(d,t){const s=[d[0],d[1],0],h=[t[0],t[1],0];if(i.ad.vec3.length(s)>=1e-15){const x=i.ad.vec3.normalize([],s);i.ad.vec3.scale(h,x,i.ad.vec3.dot(h,x)),t[0]=h[0],t[1]=h[1]}const m=i.ad.vec3.cross([],t,d);if(i.ad.vec3.len(m)<1e-15)return null;const g=Math.atan2(-m[1],m[0]);return rh(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),g)}fr.disabled=new fr(!1,th,$o),fr.backCCW=new fr(!0,th,$o),fr.backCW=new fr(!0,th,2304),fr.frontCW=new fr(!0,1028,2304),fr.frontCCW=new fr(!0,1028,$o);class Ml{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof i.ac?t:new i.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=i.bF(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const h=this.position,m=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(t)):0,g=i.ac.fromLngLat(t,m),x=[g.x-h.x,g.y-h.y,g.z-h.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=Al(x,s)}setPitchBearing(t,s){this.orientation=rh(i.ak(t),i.ak(-s))}}class Uc{constructor(t,s){this._transform=i.ad.mat4.identity([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new i.ac(t[0],t[1],t[2])}get position(){const t=i.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&i.bI(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||i.ad.quat.identity([]),t&&ef(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=rh(t,s),ef(this._transform,this._orientation)}forward(){const t=i.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=i.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=i.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const h=new Float64Array(16);return i.ad.mat4.invert(h,this.getWorldToCamera(t,s)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,h){const m=this.position;i.ad.vec3.scale(m,m,-t);const g=new Float64Array(16);return i.ad.mat4.fromScaling(g,[h,h,h]),i.ad.mat4.translate(g,g,m),g[10]*=s,g}getWorldToCamera(t,s){const h=new Float64Array(16),m=new Float64Array(4),g=this.position;return i.ad.quat.conjugate(m,this._orientation),i.ad.vec3.scale(g,g,-t),i.ad.mat4.fromQuat(h,m),i.ad.mat4.translate(h,h,g),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(t,s,h,m){const g=new Float64Array(16);return i.ad.mat4.perspective(g,t,s,h,m),g}getCameraToClipOrthographic(t,s,h,m,g,x){const I=new Float64Array(16);return i.ad.mat4.ortho(I,t,s,h,m,g,x),I}getDistanceToElevation(t,s=!1){const h=t===0?0:i.bH(t,s?i.aT(this.position[1]):this.position[1]),m=this.forward();return(h-this.position[2])/m[2]}clone(){return new Uc([...this.position],[...this.orientation])}}const Ri={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ss{constructor(t=0,s=0,h=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=h,this.right=m}interpolate(t,s,h){return s.top!=null&&t.top!=null&&(this.top=i.ah(t.top,s.top,h)),s.bottom!=null&&t.bottom!=null&&(this.bottom=i.ah(t.bottom,s.bottom,h)),s.left!=null&&t.left!=null&&(this.left=i.ah(t.left,s.left,h)),s.right!=null&&t.right!=null&&(this.right=i.ah(t.right,s.right,h)),this}getCenter(t,s){const h=i.ay((this.left+t-this.right)/2,0,t),m=i.ay((this.top+s-this.bottom)/2,0,s);return new i.P(h,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ss(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Go=15;class Ct{constructor(t,s,h,m,g,x,I){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=h??0,this._maxPitch=m??60,this.setProjection(x),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new i.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ss,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Uc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Ct(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Go}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(t||h)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return i.aA(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=i.bP(this.projectionOptions);const h=this.getProjection(),m=!i.bn(s,h);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bP({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=i.ad.mat2.create(),i.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=i.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=i.ak(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,g=0;for(let x=0;x<s.length;x++){const I=new i.P(s[x][0]*this.width,h+s[x][1]*(this.height-h)),P=t.pointCoordinate(I);if(!P)continue;const z=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);m+=P[3]*z,g+=z}return g===0?NaN:m/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),x=Math.max(m-h,g);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,h));return i.ay(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!i.ad.quat.exactEquals(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];i.ad.vec3.exactEquals(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new Ml;return s.position=new i.ac(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!i.ad.quat.length(t))return!1;i.ad.quat.normalize(t,t);const s=i.ad.vec3.transformQuat([],[0,0,-1],t),h=i.ad.vec3.transformQuat([],[0,-1,0],t);if(h[2]<0)return!1;const m=Al(s,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=i.ay(t[2],m/h,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,h){this._unmodified=!1,this._edgeInsets.interpolate(t,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new i.bQ(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new i.P(0,0)),m=this.pointCoordinate(new i.P(this.width,0)),g=this.pointCoordinate(new i.P(this.width,this.height)),x=this.pointCoordinate(new i.P(0,this.height)),I=Math.floor(Math.min(h.x,m.x,g.x,x.x)),P=Math.floor(Math.max(h.x,m.x,g.x,x.x)),z=1;for(let L=I-z;L<=P+z;L++)L!==0&&s.push(new i.bQ(L,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,h){let m=[];const g=h!==void 0,x=!g;if(x&&this.zoom<s||g&&h[0]===0&&h[1]===0)return m;const I=new Set,P=(L,F,B,j,X)=>{const q=i.c5(F,L,B,j,X);I.has(q)||(m.push(new i.aH(L,F,B,j,X)),I.add(q))};for(let L=0;L<t.length;L++){const F=t[L];if(x&&F.canonical.z!==s)continue;const B=F.canonical,j=F.overscaledZ,X=F.wrap,q=1<<B.z,J=B.x+1<q,Q=B.x>0,oe=B.y+1<q,ue=B.y>0,ce=F.wrap-(Q?0:1),ge=F.wrap+(J?0:1),pe=Q?B.x-1:q-1,_e=J?B.x+1:0;if(g)h[0]<0?(P(j,ge,B.z,_e,B.y),h[1]<0&&oe&&(P(j,X,B.z,B.x,B.y+1),P(j,ge,B.z,_e,B.y+1)),h[1]>0&&ue&&(P(j,X,B.z,B.x,B.y-1),P(j,ge,B.z,_e,B.y-1))):h[0]>0?(P(j,ce,B.z,pe,B.y),h[1]<0&&oe&&(P(j,X,B.z,B.x,B.y+1),P(j,ce,B.z,pe,B.y+1)),h[1]>0&&ue&&(P(j,X,B.z,B.x,B.y-1),P(j,ce,B.z,pe,B.y-1))):h[1]<0&&oe?P(j,X,B.z,B.x,B.y+1):ue&&P(j,X,B.z,B.x,B.y-1);else{const me=F.visibleQuadrants;1&me&&(P(j,ce,B.z,pe,B.y),ue&&(P(j,X,B.z,B.x,B.y-1),P(j,ce,B.z,pe,B.y-1))),2&me&&(P(j,ge,B.z,_e,B.y),ue&&(P(j,X,B.z,B.x,B.y-1),P(j,ge,B.z,_e,B.y-1))),4&me&&(P(j,ce,B.z,pe,B.y),oe&&(P(j,X,B.z,B.x,B.y+1),P(j,ce,B.z,pe,B.y+1))),8&me&&(P(j,ge,B.z,_e,B.y),oe&&(P(j,X,B.z,B.x,B.y+1),P(j,ge,B.z,_e,B.y+1)))}}const z=[];for(const L of m)m.some(F=>L.isChildOf(F))||z.push(L);if(m=z.filter(L=>!t.some(F=>!!(L.overscaledZ<s&&F.isChildOf(L))||L.equals(F)||L.isChildOf(F))),x){const L=1<<s,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[L*F.x,L*F.y],j=4,X=j*j;m=m.filter(q=>{const J=q.canonical.x+.5-B[0],Q=q.canonical.y+.5-B[1];return J*J+Q*Q<X})}return m}coveringTiles(t){let s=this.coveringZoomLevel(t);const h=s,m=this.elevation&&this.elevation.exaggeration(),g=m&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const I=this.locationCoordinate(this.center),P=this.center.lat,z=1<<s,L=[z*I.x,z*I.y,0],F=this.projection.name==="globe",B=!F,j=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,B),X=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),q=z*i.bH(1,this.center.lat),J=this._camera.position[2]/i.bH(1,this.center.lat),Q=[z*X.x,z*X.y,J*(B?1:q)],oe=F||m,ue=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ce=this.isLODDisabled(!0)?s:0;let ge;if(this._elevation&&t.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){const De=this._elevation.getMinMaxForVisibleTiles();ge=De?De.max:this._centerAltitude}else ge=this._centerAltitude;const pe=t.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,_e=this.projection.isReprojectedInTileSpace?i.bS(this):1,me=De=>{const Ze=new i.ac(De.x+25e-6,De.y,De.z),ot=new i.ac(De.x,De.y+25e-6,De.z),$e=De.toLngLat(),ct=Ze.toLngLat(),Tt=ot.toLngLat(),Mt=this.locationCoordinate($e),Lt=this.locationCoordinate(ct),Wt=this.locationCoordinate(Tt),pr=Math.hypot(Lt.x-Mt.x,Lt.y-Mt.y),nr=Math.hypot(Wt.x-Mt.x,Wt.y-Mt.y);return Math.sqrt(pr*nr)*_e/25e-6},we=De=>{const Je=ge,Ze=pe;return{aabb:i.bV(this,z,0,0,0,De,Ze,Je,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:Je,wrap:De,fullyVisible:!1}},Ee=[];let He=[];const Be=s,et=t.reparseOverscaled?h:s,rt=(J-this._centerAltitude)*q,_t=De=>{if(!this._elevation||!De.tileID||!x)return;const Je=this._elevation.getMinMaxForTile(De.tileID),Ze=De.aabb;Je?(Ze.min[2]=Je.min,Ze.max[2]=Je.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(De.shouldSplit=Qe(De),De.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},Oe=(De,Je)=>{if(.707*Je<De)return 1;const Ze=Je/De;return Ze/(1.4144271570014144+(Math.pow(1.1,Ze-1.4144271570014144+1)-1)/(1.1-1)-1)},Qe=De=>{if(De.zoom<ce)return!0;if(De.zoom===Be)return!1;if(De.shouldSplit!=null)return De.shouldSplit;const Je=De.aabb.distanceX(Q),Ze=De.aabb.distanceY(Q);let ot=rt,$e=1;if(F){ot=De.aabb.distanceZ(Q);const nr=Math.pow(2,De.zoom),mr=i.aT((De.y+1)/nr),hr=i.aT(De.y/nr),Br=Math.min(Math.max(P,mr),hr),on=i.ca(Br)/i.ca(P);if($e=Br===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,on/this._mercatorScaleRatio),this.zoom<=i.c6&&De.zoom===Be-1&&on>=.9)return!0}else if(g&&(ot=De.aabb.distanceZ(Q)*q),this.projection.isReprojectedInTileSpace&&h<=5){const nr=Math.pow(2,De.zoom),mr=me(new i.ac((De.x+.5)/nr,(De.y+.5)/nr));$e=mr>.85?1:mr}if(!x){const nr=Math.sqrt(Je*Je+Ze*Ze+ot*ot);let mr=(1<<Be-De.zoom)*ue*$e;return mr*=Oe(Math.max(ot,rt),nr),nr<mr}let ct=Number.MAX_VALUE,Tt=0;const Mt=De.aabb.getCorners(),Lt=[];for(const nr of Mt){i.ad.vec3.sub(Lt,nr,Q),F||(g?Lt[2]*=q:Lt[2]=rt);const mr=i.ad.vec3.dot(Lt,this._camera.forward());mr<ct&&(ct=mr,Tt=Math.abs(Lt[2]))}let Wt=(1<<Be-De.zoom)*ue*$e;if(Wt*=Oe(Math.max(Tt,rt),ct),ct<Wt)return!0;const pr=De.aabb.closestPoint(L);return pr[0]===L[0]&&pr[1]===L[1]};if(this.renderWorldCopies)for(let De=1;De<=3;De++)Ee.push(we(-De)),Ee.push(we(De));for(Ee.push(we(0));Ee.length>0;){const De=Ee.pop(),Je=De.x,Ze=De.y;let ot=De.fullyVisible;const $e=()=>this.projection.name==="globe"&&(De.y===0||De.y===(1<<De.zoom)-1);if(!ot){let ct=oe?De.aabb.intersects(j):De.aabb.intersectsFlat(j);if(ct===0&&$e()){const Tt=new i.bT(De.zoom,Je,Ze);ct=i.bU(this,z,Tt,!0).intersects(j)}if(ct===0)continue;ot=ct===2}if(De.zoom!==Be&&Qe(De))for(let ct=0;ct<4;ct++){const Tt=(Je<<1)+ct%2,Mt=(Ze<<1)+(ct>>1),Lt={aabb:x?De.aabb.quadrant(ct):i.bV(this,z,De.zoom+1,Tt,Mt,De.wrap,De.minZ,De.maxZ,this.projection),zoom:De.zoom+1,x:Tt,y:Mt,wrap:De.wrap,fullyVisible:ot,tileID:void 0,shouldSplit:void 0,minZ:De.minZ,maxZ:De.maxZ};g&&!F&&(Lt.tileID=new i.aH(De.zoom+1===Be?et:De.zoom+1,De.wrap,De.zoom+1,Tt,Mt),_t(Lt)),Ee.push(Lt)}else{const ct=De.zoom===Be?et:De.zoom;if(t.minzoom&&t.minzoom>ct)continue;let Tt=0;if(!ot){let pr=oe?De.aabb.intersectsPrecise(j):De.aabb.intersectsPreciseFlat(j);if(pr===0&&$e()){const nr=new i.bT(De.zoom,Je,Ze);pr=i.bU(this,z,nr,!0).intersectsPrecise(j)}if(pr===0)continue;if(t.calculateQuadrantVisibility)if(j.containsPoint(De.aabb.center))Tt=15;else for(let nr=0;nr<4;nr++)De.aabb.quadrant(nr).intersects(j)!==0&&(Tt|=1<<nr)}const Mt=L[0]-(.5+Je+(De.wrap<<De.zoom))*(1<<s-De.zoom),Lt=L[1]-.5-Ze,Wt=De.tileID?De.tileID:new i.aH(ct,De.wrap,De.zoom,Je,Ze);t.calculateQuadrantVisibility&&(Wt.visibleQuadrants=Tt),He.push({tileID:Wt,distanceSq:Mt*Mt+Lt*Lt})}}if(this.fogCullDistSq){const De=this.fogCullDistSq,Je=this.horizonLineFromTop();He=He.filter(Ze=>{const ot=[0,0,0,1],$e=[i.ai,i.ai,0,1],ct=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());i.ad.vec4.transformMat4(ot,ot,ct),i.ad.vec4.transformMat4($e,$e,ct);const Tt=i.ad.vec4.min([],ot,$e),Mt=i.ad.vec4.max([],ot,$e),Lt=i.bW(Tt,Mt);if(Lt===0)return!0;let Wt=!1;const pr=this._elevation;if(pr&&Lt>De&&Je!==0){const nr=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let mr;t.isTerrainDEM||(mr=pr.getMinMaxForTile(Ze.tileID)),mr||(mr={min:pe,max:ge});const hr=i.c7(this.rotation),Br=[hr[0]*i.ai,hr[1]*i.ai,mr.max];i.ad.vec3.transformMat4(Br,Br,nr),Wt=(1-Br[1])*this.height*.5<Je}return Lt<De||Wt})}return He.sort((De,Je)=>De.distanceSq-Je.distanceSq).map(De=>De.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=i.ay(t.lat,-i.bX,i.bX),h=this.projection.project(t.lng,s);return new i.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let h,m;const g=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;h=(s.x-g.x)/I,m=(s.y-g.y)/I}else{const I=this.pointCoordinate(s),P=this.pointCoordinate(g);h=I.x-P.x,m=I.y-P.y}const x=this.locationCoordinate(t);this.setLocation(new i.ac(x.x-h,x.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const h=s?i.bH(s,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new i.ac(m.x,m.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const h=s??this._centerAltitude,m=[t.x,t.y,0,1],g=[t.x,t.y,1,1];i.ad.vec4.transformMat4(m,m,this.pixelMatrixInverse),i.ad.vec4.transformMat4(g,g,this.pixelMatrixInverse);const x=g[3];i.ad.vec4.scale(m,m,1/m[3]),i.ad.vec4.scale(g,g,1/x);const I=m[2],P=g[2];return{p0:m,p1:g,t:I===P?0:(h-I)/(P-I)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return i.ad.vec4.transformMat4(s,s,this.pixelMatrixInverse),i.ad.vec4.transformMat4(h,h,this.pixelMatrixInverse),i.ad.vec4.scale(s,s,1/s[3]),i.ad.vec4.scale(h,h,1/h[3]),s[2]=i.bH(s[2],this._center.lat)*this.worldSize,h[2]=i.bH(h[2],this._center.lat)*this.worldSize,i.ad.vec4.scale(s,s,1/this.worldSize),i.ad.vec4.scale(h,h,1/this.worldSize),new i.as([s[0],s[1],s[2]],i.ad.vec3.normalize([],i.ad.vec3.sub([],h,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:h,t:m}=t,g=i.bH(s[2],this._center.lat),x=i.bH(h[2],this._center.lat);return new i.ac(i.ah(s[0],h[0],m)/this.worldSize,i.ah(s[1],h[1],m)/this.worldSize,i.ah(g,x,m))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let h=this.projection.pointCoordinate3D(this,t.x,t.y);if(h)return new i.ac(h[0],h[1],h[2]);let m=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t,s);const x=.02*g,I=t.clone();for(let P=0;P<10&&g-m>x;P++){I.y=i.ah(m,g,.66);const z=this.projection.pointCoordinate3D(this,I.x,I.y);z?(g=I.y,h=z):m=I.y}return h?new i.ac(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=i.bY)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return i.ad.vec4.transformMat4(m,m,this.pixelMatrix),m[3]>0?new i.P(m[0]/m[3],m[1]/m[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,g=this.pointLocation3D(new i.P(s,t)),x=this.pointLocation3D(new i.P(m,t)),I=this.pointLocation3D(new i.P(m,h)),P=this.pointLocation3D(new i.P(s,h));let z=Math.min(g.lng,x.lng,I.lng,P.lng),L=Math.max(g.lng,x.lng,I.lng,P.lng),F=Math.min(g.lat,x.lat,I.lat,P.lat),B=Math.max(g.lat,x.lat,I.lat,P.lat);const j=Math.pow(2,-this.zoom)/16*270,X=this.projection.name==="globe"?1:4,q=(J,Q,oe,ue,ce)=>{const ge=(J+oe)/2,pe=(Q+ue)/2,_e=new i.P(ge,pe),{lng:me,lat:we}=this.pointLocation3D(_e),Ee=Math.max(0,z-me,F-we,me-L,we-B);z=Math.min(z,me),L=Math.max(L,me),F=Math.min(F,we),B=Math.max(B,we),(ce<X||Ee>j)&&(q(J,Q,ge,pe,ce+1),q(ge,pe,oe,ue,ce+1))};if(q(s,t,m,t,1),q(m,t,m,h,1),q(m,h,s,h,1),q(s,h,s,t,1),this.projection.name==="globe"){const[J,Q]=i.bZ(this);J?(B=90,L=180,z=-180):Q&&(F=-90,L=180,z=-180)}return new i.aB(new i.bO(z,F),new i.bO(L,B))}_getBoundsRectangular(t,s){const{top:h,left:m}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,I=new i.P(m,h),P=new i.P(x,h),z=new i.P(x,g),L=new i.P(m,g);let F=this.pointCoordinate(I,t),B=this.pointCoordinate(P,t);const j=this.pointCoordinate(z,s),X=this.pointCoordinate(L,s),q=(J,Q)=>(Q.y-J.y)/(Q.x-J.x);return F.y>1&&B.y>=0?F=new i.ac((1-X.y)/q(X,F)+X.x,1):F.y<0&&B.y<=1&&(F=new i.ac(-X.y/q(X,F)+X.x,0)),B.y>1&&F.y>=0?B=new i.ac((1-j.y)/q(j,B)+j.x,1):B.y<0&&F.y<=1&&(B=new i.ac(-j.y/q(j,B)+j.x,0)),new i.aB().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce((h,m)=>{if(m.dem){const g=m.dem.tree;h.min=Math.min(h.min,g.minimums[0]),h.max=Math.max(h.max,g.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-i.bX,this.maxLat=i.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.av(this.minLng)*this.tileSize,this.worldMaxX=i.av(this.maxLng)*this.tileSize,this.worldMinY=i.aC(this.maxLat)*this.tileSize,this.worldMaxY=i.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,h=this._distanceTileDataCache;if(h[s])return h[s];const m=t.canonical,g=1/this.height,x=this.cameraWorldSize,I=x/this.zoomScale(m.z),P=(m.x+Math.pow(2,m.z)*t.wrap)*I,z=m.y*I,L=this.point;L.x*=x/this.worldSize,L.y*=x/this.worldSize;const F=this.angle,B=Math.sin(-F),j=-Math.cos(-F);return h[s]={bearing:[B,j],center:[(L.x-P)*g,(L.y-z)*g],scale:I/i.ai*g},h[s]}calculateFogTileMatrix(t){const s=t.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return i.ad.mat4.multiply(m,this.worldToFogMatrix,m),h[s]=new Float32Array(m),h[s]}calculateProjMatrix(t,s=!1,h=!1){const m=t.key;let g;if(g=h?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,g[m])return g[m];const x=this.calculatePosMatrix(t,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,i.ad.mat4.multiply(x,I,x),g[m]=new Float32Array(x),g[m]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const m=i.b_(t,this);return h[s]=m,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=i.ad.mat4.fromScaling([],[t,t,t]);return i.ad.mat4.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=i.bH(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=this._camera.forward(),g=i.bH(1,this._center.lat);h[2]/=g,m[2]/=g,i.ad.vec3.normalize(m,m);const x=t.raycast(h,m,t.exaggeration());if(x){const I=i.ad.vec3.scaleAndAdd([],h,m,x),P=new i.ac(I[0],I[1],i.bH(I[2],i.aT(I[1]))),z=(P.z+i.ad.vec3.length([P.x-h[0],P.y-h[1],P.z-h[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,h=i.bH(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(h),g=s.getAtPointOrZero(new i.ac(...m)),x=this.pixelsPerMeter/this.worldSize*g,I=this._minimumHeightOverTerrain(),P=m[2]-x;if(P<=I)if(P<0||t){const z=this.locationCoordinate(this._center,this._centerAltitude),L=[m[0],m[1],z.z-m[2]],F=i.ad.vec3.length(L);L[2]-=(I-P)/this._pixelsPerMercatorPixel;const B=i.ad.vec3.length(L);if(B===0)return;i.ad.vec3.scale(L,L,F/B*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],z.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=i.ay(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=i.ay(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:m}=this.point;let g=0,x=h,I=m;const P=this.width/2,z=this.height/2,L=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(m-z<L&&(I=L+z),m+z>F&&(I=F-z),F-L<this.height&&(g=Math.max(g,this.height/(F-L)),I=(F+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,X=this.worldSize/2-(B+j)/2;x=(h+X+this.worldSize)%this.worldSize-X,x-P<B&&(x=B+P),x+P>j&&(x=j-P),j-B<this.width&&(g=Math.max(g,this.width/(j-B)),x=(j+B)/2)}x===h&&I===m||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(x,I))),g&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bH(1,this.center.lat)/i.bH(1,i.c8));const m=i.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?h:1,x=this._camera.getWorldToCamera(this.worldSize,g);let I;const P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(P[8]=2*-t.x/this.width,P[9]=2*t.y/this.height,this.isOrthographic){let we=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ee=we*this.aspect,He=-Ee,Be=-we;Ee-=t.x,He-=t.x,we+=t.y,Be+=t.y,I=this._camera.getCameraToClipOrthographic(He,Ee,Be,we,this._nearZ,this._farZ),((et,rt,_t,Oe)=>{for(let Qe=0;Qe<16;Qe++)et[Qe]=i.ah(rt[Qe],_t[Qe],Oe)})(I,I,P,i.c9(this.pitch>=Go?1:this.pitch/Go))}else I=P;const z=i.ad.mat4.mul([],P,x);let L=i.ad.mat4.mul([],I,x);if(this.projection.isReprojectedInTileSpace){const we=this.locationCoordinate(this.center),Ee=i.ad.mat4.identity([]);i.ad.mat4.translate(Ee,Ee,[we.x*this.worldSize,we.y*this.worldSize,0]),i.ad.mat4.multiply(Ee,Ee,i.c0(this)),i.ad.mat4.translate(Ee,Ee,[-we.x*this.worldSize,-we.y*this.worldSize,0]),i.ad.mat4.multiply(L,L,Ee),i.ad.mat4.multiply(z,z,Ee),this.inverseAdjustmentMatrix=i.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ad.mat4.scale([],L,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=L,this.invProjMatrix=i.ad.mat4.invert(new Float64Array(16),this.projMatrix),s){const we=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);we[8]=2*-t.x/this.width,we[9]=2*t.y/this.height,this.expandedFarZProjMatrix=i.ad.mat4.mul([],we,x)}else this.expandedFarZProjMatrix=this.projMatrix;const F=i.ad.mat4.invert([],I);this.frustumCorners=i.c2.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const B=new Float32Array(16);i.ad.mat4.identity(B),i.ad.mat4.scale(B,B,[1,-1,1]),i.ad.mat4.rotateX(B,B,this._pitch),i.ad.mat4.rotateZ(B,B,this.angle);const j=i.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ad.mat4.clone(j);const X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-t.x/this.width,j[9]=2*(t.y+X)/this.height,this.skyboxMatrix=i.ad.mat4.multiply(B,j,B);const q=this.point,J=q.x,Q=q.y,oe=this.width%2/2,ue=this.height%2/2,ce=Math.cos(this.angle),ge=Math.sin(this.angle),pe=J-Math.round(J)+ce*oe+ge*ue,_e=Q-Math.round(Q)+ce*ue+ge*oe,me=new Float64Array(L);if(i.ad.mat4.translate(me,me,[pe>.5?pe-1:pe,_e>.5?_e-1:_e,0]),this.alignedProjMatrix=me,L=i.ad.mat4.create(),i.ad.mat4.scale(L,L,[this.width/2,-this.height/2,1]),i.ad.mat4.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=i.ad.mat4.create(),i.ad.mat4.scale(L,L,[1,-1,1]),i.ad.mat4.translate(L,L,[-1,-1,0]),i.ad.mat4.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=i.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},L=i.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.c3(this);const we=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad.vec3.transformMat4(we,we,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,s];i.ad.vec3.scale(g,g,m),i.ad.vec3.scale(h,h,-1),i.ad.vec3.multiply(h,h,g);const x=i.ad.mat4.create();i.ad.mat4.translate(x,x,h),i.ad.mat4.scale(x,x,g),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),m=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-h[0]*g,m.y/this.worldSize-h[1]*g,t/this.worldSize*this._centerAltitude-h[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],m=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(g=Math.min((s-h)/m,1)),this._camera.position=i.ad.vec3.scaleAndAdd([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),g=i.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ak(this._maxPitch)),I=Math.max((t[2]-g)/Math.cos(h),x),P=this._zoomFromMercatorZ(I);i.ad.vec3.scaleAndAdd(t,t,s,I),this._pitch=i.ay(h,i.ak(this.minPitch),i.ak(this.maxPitch)),this.angle=i.bF(m,-Math.PI,Math.PI),this._setZoom(i.ay(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,h=i.bY,m=0,g=1/0;for(;h-s>1e-6&&h>s;){const x=s+.5*(h-s),I=this.tileSize*Math.pow(2,x),P=this.getCameraToCenterDistance(this.projection,x,I),z=this.scaleZoom(P/(t*this.tileSize)),L=Math.abs(x-z);L<g&&(g=L,m=x),x<z?s=x:h=x}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const h=Math.min(t.x,s.x),m=Math.max(t.x,s.x),g=Math.min(t.y,s.y),x=Math.max(t.y,s.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new i.P(h,g),new i.P(m,x),new i.P(h,x),new i.P(m,g)],P=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const L of I){const F=this.pointRayIntersection(L);if(F.t<0)return!0;const B=this.rayIntersectionCoordinate(F);if(B.x<P||B.y<0||B.x>z||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(t,s){const h=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([s,h,m],g){const x=[s,h,m,1];i.ad.vec4.transformMat4(x,x,g);const I=x[3]=Math.max(x[3],1e-6);return x[0]/=I,x[1]/=I,x[2]/=I,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,h=this.worldSize){const m=i.b$(t,s,this.width,this.height,1024),g=t.pixelSpaceConversion(this.center.lat,h,m);let x=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(x=i.ah(1,x,i.c9(this.pitch>=Go?1:this.pitch/Go))),x}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ad.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const ga=(d,t)=>{if(t>0&&d.terrain&&i.w("Cutoff is currently disabled on terrain"),t<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=d.transform,h=Math.max(Math.abs(s._zoom-(d.minCutoffZoom-1)),1),m=s.isLODDisabled(!1)?i.ae(60,45,s.pitch):i.ae(30,15,s.pitch),g=s._farZ-s._nearZ,x=t*s.height,I=((1-(P=m))*s.cameraToCenterDistance+P*(s._farZ+x))*h;var P;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(I-s._nearZ)/g,(I-x-s._nearZ)/g]}}},Di={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class tf{constructor(t,s){this.aabb=t,this.lastCascade=s}}class Zm{add(t,s){const h=this.receivers[t.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],s.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],s.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],s.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],s.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],s.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],s.max[2])):this.receivers[t.key]=new tf(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,h){const m=i.ce.fromPoints(t.points);let g=0;for(const x in this.receivers){const I=this.receivers[x];if(!I||!m.intersectsAabb(I.aabb))continue;I.aabb.min=m.closestPoint(I.aabb.min),I.aabb.max=m.closestPoint(I.aabb.max);const P=I.aabb.getCorners();for(let z=0;z<h.length;z++){let L=!0;for(const F of P){const B=[F[0]*s,F[1]*s,F[2]];if(i.ad.vec3.transformMat4(B,B,h[z].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){L=!1;break}}if(I.lastCascade=z,g=Math.max(g,z),L)break}}return g+1}}class nh{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Zm,this._depthMode=new Xt(t.context.gl.LEQUAL,Xt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Di,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Di,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Di,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const m=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||m<=0||(this._shadowLayerCount=h.style.order.reduce((X,q)=>{const J=h.style._mergedLayers[q];return X+(J.hasShadowPass()&&!J.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const g=h.context,x=Di.shadowMapResolution,I=Di.shadowMapResolution;if(this._cascades.length===0||Di.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let X=0;X<Di.cascadeCount;++X){const q=h._shadowMapDebug,J=g.gl,Q=g.createFramebuffer(x,I,q,"texture"),oe=new i.T(g,{width:x,height:I,data:null},J.DEPTH_COMPONENT16);if(Q.depthAttachment.set(oe.texture),q){const ue=new i.T(g,{width:x,height:I,data:null},J.RGBA8);Q.colorAttachment.set(ue.texture)}this._cascades.push({framebuffer:Q,texture:oe,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bR,scale:0})}}this.shadowDirection=ih(s);let P=0;if(t.elevation){const X=t.elevation,q=[1e4,-1e4];X.visibleDemTiles.filter(J=>J.dem).forEach(J=>{const Q=J.dem.tree;q[0]=Math.min(q[0],Q.minimums[0]),q[1]=Math.max(q[1],Q.maximums[0])}),q[0]!==1e4&&(P=(q[1]-q[0])*X.exaggeration())}const z=1.5*t.cameraToCenterDistance,L=3*z,F=new Float64Array(16);for(let X=0;X<this._cascades.length;++X){const q=this._cascades[X];let J=t.height/50,Q=1;Di.cascadeCount===1?Q=L:X===0?Q=z:(J=z,Q=L);const[oe,ue]=sh(t,this.shadowDirection,J,Q,Di.shadowMapResolution,P);q.scale=t.scale,q.matrix=oe,q.boundingSphereRadius=ue,i.ad.mat4.invert(F,q.matrix),q.frustum=i.bR.fromInvProjectionMatrix(F,1,0,!0),q.far=Q}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Di.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Di.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ri.ShadowMap0,this._uniformValues.u_shadowmap_1=Ri.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=h.transform.elevation;for(const X of this._groundShadowTiles){let q={min:0,max:0};if(j){const J=j.getMinMaxForTile(X);J&&(q=J)}this.addShadowReceiver(X.toUnwrapped(),q.min,q.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const h=this.painter,m=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),m.viewport.set([0,0,Di.shadowMapResolution,Di.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){h.currentShadowCascade=g,m.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),m.clear({color:i.al.white,depth:1});for(const x of t.order){const I=t._mergedLayers[x];if(!I.hasShadowPass()||I.isHidden(h.transform.zoom))continue;const P=t.getLayerSourceCache(I),z=P?s[P.id]:void 0;(I.type==="model"||z&&z.length)&&h.renderLayer(h,P,I,z)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,h=t.context,m=s.directionalLight,g=s.ambientLight;if(!m||!g)return;const x=[],I=ga(t,t.longestCutoffRange);I.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&x.push("NORMAL_OFFSET");const P=Ho(s,m,g),z=new Xt(h.gl.LEQUAL,Xt.ReadOnly,t.depthRangeFor3D);for(const L of this._groundShadowTiles){const F=L.toUnwrapped(),B=t.isTileAffectedByFog(L),j=t.getOrCreateProgram("groundShadow",{defines:x,overrideFog:B});this.setupShadows(F,j),t.uploadCommonUniforms(h,j,F,null,I);const X={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:P};j.draw(t,h.gl.TRIANGLES,z,br.disabled,Rr.multiply,fr.disabled,X,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Rr.unblended:Rr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,h=s.calculatePosMatrix(t,s.worldSize);return i.ad.mat4.multiply(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(t){return i.ad.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,s,h,m=0){if(!this.enabled)return;const g=this.painter.transform,x=this.painter.context,I=x.gl,P=this._uniformValues,z=new Float64Array(16),L=g.calculatePosMatrix(t,g.worldSize);for(let F=0;F<this._cascades.length;F++)i.ad.mat4.multiply(z,this._cascades[F].matrix,L),P[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),x.activeTexture.set(I.TEXTURE0+Ri.ShadowMap0+F),this._cascades[F].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!h,this.useNormalOffset){const F=i.cd(t.canonical),B=2/g.tileSize*i.ai/Di.shadowMapResolution,j=B*this._cascades[0].boundingSphereRadius,X=B*this._cascades[this._cascades.length-1].boundingSphereRadius,q=(h==="vector-tile"?1:3)/Math.pow(2,m-t.canonical.z-(1-g.zoom+Math.floor(g.zoom)));P.u_shadow_normal_offset=[F,j*q,X*q],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(x,P)}setupShadowsFromMatrix(t,s,h=!1){if(!this.enabled)return;const m=this.painter.context,g=m.gl,x=this._uniformValues,I=new Float64Array(16);for(let P=0;P<Di.cascadeCount;P++)i.ad.mat4.multiply(I,this._cascades[P].matrix,t),x[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),m.activeTexture.set(g.TEXTURE0+Ri.ShadowMap0+P),this._cascades[P].texture.bind(g.NEAREST,g.CLAMP_TO_EDGE);if(this.useNormalOffset=h,h){const P=Di.normalOffset;x.u_shadow_normal_offset=[1,P,P],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(m,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,h,m){if(m[2]>=0)return{};const g=function(P,z,L){const F=L/(1<<P.canonical.z);return new i.ce([P.canonical.x*F+P.wrap*L,P.canonical.y*F+P.wrap*L,0],[(P.canonical.x+1)*F+P.wrap*L,(P.canonical.y+1)*F+P.wrap*L,z])}(t,s,h).getCorners(),x=s/-m[2];m[0]<0?(i.ad.vec3.add(g[0],g[0],[m[0]*x,0,0]),i.ad.vec3.add(g[3],g[3],[m[0]*x,0,0])):m[0]>0&&(i.ad.vec3.add(g[1],g[1],[m[0]*x,0,0]),i.ad.vec3.add(g[2],g[2],[m[0]*x,0,0])),m[1]<0?(i.ad.vec3.add(g[0],g[0],[0,m[1]*x,0]),i.ad.vec3.add(g[1],g[1],[0,m[1]*x,0])):m[1]>0&&(i.ad.vec3.add(g[2],g[2],[0,m[1]*x,0]),i.ad.vec3.add(g[3],g[3],[0,m[1]*x,0]));const I={};return I.vertices=g,I.planes=[js(g[1],g[0],g[4]),js(g[2],g[1],g[5]),js(g[3],g[2],g[6]),js(g[0],g[3],g[7])],I}addShadowReceiver(t,s,h){this._receivers.add(t,i.ce.fromTileIdAndHeight(t,s,h))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function js(d,t,s){const h=i.ad.vec3.sub([],s,t),m=i.ad.vec3.sub([],d,t),g=i.ad.vec3.cross([],h,m),x=i.ad.vec3.length(g);return x===0?[0,0,1,0]:(i.ad.vec3.scale(g,g,1/x),[g[0],g[1],g[2],-i.ad.vec3.dot(g,t)])}function ih(d){const t=d.properties.get("direction"),s=i.cc(t.x,t.y,t.z);s[2]=i.ay(s[2],0,75);const h=i.cf([s[0],s[1],s[2]]);return i.ad.vec3.fromValues(h.x,h.y,h.z)}function Ho(d,t,s){const h=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),g=t.properties.get("intensity"),x=t.properties.get("direction"),I=[x.x,x.y,x.z],P=s.properties.get("color-use-theme")==="none",z=s.properties.get("color"),L=s.properties.get("intensity"),F=Math.max(i.ad.vec3.dot([0,0,1],I),0),B=[0,0,0];i.ad.vec3.scale(B,z.toRenderColor(P?null:d.getLut(t.scope)).toArray01Linear().slice(0,3),L);const j=[0,0,0];return i.ad.vec3.scale(j,m.toRenderColor(h?null:d.getLut(s.scope)).toArray01Linear().slice(0,3),F*g),i.cg([B[0]>0?B[0]/(B[0]+j[0]):0,B[1]>0?B[1]/(B[1]+j[1]):0,B[2]>0?B[2]/(B[2]+j[2]):0])}function sh(d,t,s,h,m,g){const x=d.zoom,I=d.scale,P=d.worldSize,z=1/P,L=d.aspect,F=Math.sqrt(1+L*L)*Math.tan(.5*d.fovX),B=F*F,j=h-s,X=h+s;let q,J;B>j/X?(q=h,J=h*F):(q=.5*X*(1+B),J=.5*Math.sqrt(j*j+2*(h*h+s*s)*B+X*X*B*B));const Q=d.projection.pixelsPerMeter(d.center.lat,P),oe=d._camera.getCameraToWorldMercator(),ue=[0,0,-q*z];i.ad.vec3.transformMat4(ue,ue,oe);let ce=J*z;const ge=d._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){const ot=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?Q:1),$e=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,s,h);$e[8]=2*-d.centerOffset.x/d.width,$e[9]=2*d.centerOffset.y/d.height;const ct=new Float64Array(16);i.ad.mat4.mul(ct,$e,ot);const Tt=new Float64Array(16);i.ad.mat4.invert(Tt,ct);const Mt=i.bR.fromInvProjectionMatrix(Tt,P,x,!0);for(const Lt of Mt.points){const Wt=((pe=Lt)[0]/=I,pe[1]/=I,pe[2]=i.bH(pe[2],d._center.lat),pe);ce=Math.max(ce,i.ad.vec3.len(i.ad.vec3.subtract([],ue,Wt)))}}var pe;ce*=m/(m-1);const _e=Math.acos(t[2]),me=Math.atan2(-t[0],-t[1]),we=new Uc;we.position=ue,we.setPitchBearing(_e,me);const Ee=we.getWorldToCamera(P,Q),He=ce*P,Be=Math.min(d._mercatorZfromZoom(17)*P*-2,-2*He),et=we.getCameraToClipOrthographic(-He,He,-He,He,Be,(He+g*Q)/t[2]),rt=new Float64Array(16);i.ad.mat4.multiply(rt,et,Ee);const _t=i.ad.vec3.fromValues(Math.floor(1e6*ue[0])/1e6*P,Math.floor(1e6*ue[1])/1e6*P,0),Oe=.5*m,Qe=[0,0,0];i.ad.vec3.transformMat4(Qe,_t,rt),i.ad.vec3.scale(Qe,Qe,Oe);const De=[Math.floor(Qe[0]),Math.floor(Qe[1]),Math.floor(Qe[2])],Je=[0,0,0];i.ad.vec3.sub(Je,Qe,De),i.ad.vec3.scale(Je,Je,-1/Oe);const Ze=new Float64Array(16);return i.ad.mat4.identity(Ze),i.ad.mat4.translate(Ze,Ze,Je),i.ad.mat4.multiply(rt,Ze,rt),[rt,He]}class Il extends i.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,s){return i.aN(this.requestManager.transformRequest(s,i.R.Model).url).then(h=>{if(!h)return;const m=i.aO(h),g=new i.aP(t,void 0,void 0,m);return g.computeBoundsAndApplyParent(),g}).catch(h=>{if(h&&h.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${t} from ${s}: ${h.message}`)))})}load(t,s,h={keepNumReferences:!1}){this.models[s]||(this.models[s]={});const m=Object.keys(t);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+m.length;const g=[];for(const x of m)g.push(this.loadModel(x,t[x]));Promise.allSettled(g).then(x=>{for(let I=0;I<x.length;I++){const{status:P,value:z}=x[I];if(P==="fulfilled"&&z){const L=this.models[s][m[I]];this.models[s][m[I]]={model:z,numReferences:h.keepNumReferences&&L?L.numReferences:1}}}this.numModelsLoading[s]-=m.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(x=>{this.fire(new i.z(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s){return!!this.getModel(t,s)}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}addModel(t,s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={}),this.hasModel(t,h)&&this.models[h][t].numReferences++,this.modelUris[h][t]=this.requestManager.normalizeModelURL(s),this.load({[t]:this.modelUris[h][t]},h)}addModels(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h=this.modelUris[s];for(const m in t)this.models[s][m]={},h[m]=this.requestManager.normalizeModelURL(t[m]);this.load(h,s,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h={};for(const m of t)this.hasModel(m,s)?this.models[s][m].numReferences++:(this.modelUris[s][m]=this.requestManager.normalizeModelURL(m),h[m]=this.modelUris[s][m]);this.load(h,s)}removeModel(t,s){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0)){const h=this.models[s][t].model;delete this.models[s][t],delete this.modelUris[s][t],h.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const h in this.models[s])this.models[s][h].model&&this.models[s][h].model.upload(t.context)}}const o0=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),a0={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function oh(d){return d=d||{},Object.assign(d,a0)}class l0 extends i.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},i.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(x,I){const[P,z]=x,{center:L,radius:F}=I,[B,j]=L,X=Math.abs(P-B);return Math.sqrt((X>180?360-X:X)**2+(z-j)**2)<=F}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone")));const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=new i.P(this._map.transform.width/2,this._map.transform.height/2),m=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(t?m:h,s);g.length>0&&(this._selectedFloorplan&&g[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=g[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(g){const[[x,I],[P,z]]=g,L=(P-x+360)%360,F=L>180?360-L:L;return{center:[(x+F/2+360)%360,(I+z)/2],radius:Math.sqrt(F**2+(z-I)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const s=this._floorplanStates[this._indoorData.id].selectedBuilding,h=this._floorplanStates[this._indoorData.id].selectedLevel;let m;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const g of this._indoorData.levels)g.id===this._selectedLevel.id&&(m=g.id);if(this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:m})),s){const g=this._indoorData.buildings.find(x=>x.id===s);this._buildingSelected(g,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(h){const g=this._indoorData.levels.find(x=>x.id===h);this._updateLevels(g,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,s){s&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const h=this._indoorData.levels.filter(m=>t.levels.includes(m.id));this.fire(new i.A("buildingselected",{buildingId:t.id,levels:h}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const s=this._indoorData.levels.find(h=>h.id===t);this._updateLevels(s,!0)}this.fire(new i.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,s){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(s&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function h(z){const L=z.indexOf("/floor/");if(L===-1)return z;const F=L+7,B=z.indexOf("/",F);return B===-1?z.slice(F):z.slice(F,B)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const m=[],g={},x={},I={},P={};for(const z of this._indoorData.levels)if(m.push(z.id),g[z.id]=z.height,x[z.id]=z.base,t){if(this.mergeFloors){const L=h(t.id),F=h(z.id);I[z.id]=F===L?"true":"false"}else I[z.id]=z.id===t.id?"true":"false";P[z.id]=z.base<t.base?"true":"false"}else P[z.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",m]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",I]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",P]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),s&&t.extent)){const z=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),L=this._map.getZoom(),F=z.zoom?Math.abs(L-z.zoom):0;this._map.fitBounds(t.extent,F>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:L})}}selectFloorplan(t){const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],m=this._map.queryRenderedFeatures(h,s);if(m.length>0){for(const g of m)if(JSON.parse(g.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=g,this._floorplanSelected(!0);break}}}selectBuilding(t){const s=this._indoorData.buildings.find(h=>h.id===t);this._buildingSelected(s,!0)}selectLevel(t){this._levelSelected(t)}}function Xm(d){if(!d.metadata||!d.metadata.content_area)return;const t=i.q.devicePixelRatio,{left:s,top:h,width:m,height:g}=d.metadata.content_area,x=s*t,I=h*t;return[x,I,x+m*t,I+g*t]}function rf(d){if(d)return d.map(([t,s])=>[t*i.q.devicePixelRatio,s*i.q.devicePixelRatio])}class nf{constructor(t,s){this.id=t,this.style=s}addIcons(t){const s=new Map;for(const[h,m]of t.entries()){const g=i.I.from({name:h,iconsetId:this.id});s.set(g,m)}this.style.addImages(s)}}const Xa=(d,t)=>Pe(d,t&&t.filter(s=>s.identifier!=="source.canvas")),c0=i.aA(Xr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),u0=i.aA(Xr,["setCenter","setZoom","setBearing","setPitch"]),sf=new Set(["background","sky","slot","custom"]),of={version:8,layers:[],sources:{}},Km={duration:300,delay:0};class os extends i.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=i.l({},Km),this._buildingIndex=new ar(this),this.crossTileSymbolIndex=new Wm,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new ke,this.dispatcher=s.dispatcher?s.dispatcher:new i.D(i.cj(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Ae(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new i.ck(t._requestManager,s.localFontFamily?i.cl.all:s.localIdeographFontFamily?i.cl.ideographs:i.cl.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new Il(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",i.cm());const h=this;this._rtlTextPluginCallback=os.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(g,x)=>{if(i.cn(g),x&&x.every(I=>I))for(const I in h._sourceCaches){const P=h._sourceCaches[I],z=P.getSource().type;z!=="vector"&&z!=="geojson"||P.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.getOwnSource(m.sourceId);if(g&&g.vectorLayerIds)for(const x in this._layers){const I=this._layers[x];I.source===g.id&&this._validateLayer(I)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(i.f(t))return t;const s=i.co(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${i.cp(JSON.stringify(t))}`}_diffStyle(t,s,h){this.globalId=this._getGlobalId(t);const m=(g,x)=>{try{x(null,this.setState(g,h))}catch(I){x(I,!1)}};if(typeof t=="string"){const g=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(g,i.R.Style);i.n(x,(I,P)=>{I?this.fire(new i.z(I)):P&&m(P,s)})}else typeof t=="object"&&m(t,s)}loadURL(t,s={}){this.fire(new i.A("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!i.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const m=this.importsCache.get(t);if(m)return this._load(m,h);const g=this.map._requestManager.transformRequest(t,i.R.Style);this._request=i.n(g,(x,I)=>{if(this._request=null,x)this.fire(new i.z(x));else if(I)return this.importsCache.set(t,I),this._load(I,h)})}loadJSON(t,s={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=i.q.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(of,!1)}_loadImports(t,s,h){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const g of t){const x=this._createFragmentStyle(g),I=new Promise(L=>{x.once("style.import.load",L),x.once("error",L)}).then(()=>this.mergeAll());if(m.push(I),this.resolvedImports.has(g.url)){x.loadEmpty();continue}const P=g.data||this.importsCache.get(g.url);P?(x.loadJSON(P,{validate:s}),this._isInternalStyle(P)&&(x.globalId=null)):g.url?x.loadURL(g.url,{validate:s}):x.loadEmpty();const z={style:x,id:g.id,config:g.config};if(h){const L=this.fragments.findIndex(({id:F})=>F===h);this.fragments=this.fragments.slice(0,L).concat(z).concat(this.fragments.slice(L))}else this.fragments.push(z)}return Promise.allSettled(m)}getImportGlobalIds(t=this,s=new Set){for(const h of t.fragments)h.style.globalId&&s.add(h.style.globalId),this.getImportGlobalIds(h.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?i.C(t.id,this.scope):t.id;let h;const m=this._initialConfig&&this._initialConfig[s];(t.config||m)&&(h=i.l({},t.config,m));const g=new os(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){const h=t.indoor?oh(t.schema):t.schema;if(this._isInternalStyle(t)){const x=i.l({},of,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(x,s)}if(this.updateConfig(this._config,h),s&&Xa(this,vs(t)))return;this._loaded=!0,this.stylesheet=i.cq(t);const m=()=>{for(const z in t.sources)this.addSource(z,t.sources[z],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const z in t.iconsets)this.addIconset(z,t.iconsets[z]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const x=Jd(this.stylesheet.layers);if(this._order=x.map(z=>z.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new Re(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Re(this.stylesheet.light)),this._layers={};for(const z of x){const L=i.cv(z,this.scope,this._styleColorTheme.lut,this.options);L.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const F=this.getOwnLayerSourceCache(L),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&L.canCastShadows()&&B&&(F.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const I=this.stylesheet.terrain;I&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(I,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const P=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then(()=>{this._reloadImports(),this.fire(new i.A(P?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(P?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const x=this._evaluateColorThemeData(g);this._loadColorTheme(x).then(()=>{m()}).catch(I=>{i.w(`Couldn't load color theme from the stylesheet: ${I}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,s,h,m,g,x,I,P,z,L;const F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(t=B.light),B.stylesheet.lights)for(const j of B.stylesheet.lights)j.type==="ambient"&&B.ambientLight!=null&&(s=B.ambientLight),j.type==="directional"&&B.directionalLight!=null&&(h=B.directionalLight);m=this._prioritizeTerrain(m,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(g=B.fog),B.stylesheet.snow&&B.snow!=null&&(x=B.snow),B.stylesheet.rain&&B.rain!=null&&(I=B.rain),B.stylesheet.camera!=null&&(L=B.stylesheet.camera),B.stylesheet.projection!=null&&(P=B.stylesheet.projection),B.stylesheet.transition!=null&&(z=B.stylesheet.transition),F[B.scope]=B._styleColorTheme}}),this.light=t,this.ambientLight=s,this.directionalLight=h,this.fog=g,this.snow=x,this.rain=I,this._styleColorThemeForScope=F,m===null?delete this.terrain:this.terrain=m,this.camera=L||{"camera-projection":"perspective"},this.projection=P||{name:"mercator"},this.transition=i.l({},Km,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const s=h=>{for(const m of h.fragments)s(m.style);t(h)};s(this)}_prioritizeTerrain(t,s,h){const m=t&&t.drapeRenderMode===0;return h===null?s&&s.drapeRenderMode===0?s:m?t:null:s!=null&&(!t||m||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},h={};this.forEachFragmentStyle(m=>{for(const g in m._sourceCaches){const x=i.C(g,m.scope);t[x]=m._sourceCaches[g]}for(const g in m._otherSourceCaches){const x=i.C(g,m.scope);s[x]=m._otherSourceCaches[g]}for(const g in m._symbolSourceCaches){const x=i.C(g,m.scope);h[x]=m._symbolSourceCaches[g]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=h}mergeLayers(){const t={},s=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(g=>{for(const x of g._order){const I=g._layers[x];if(I.type==="slot"){const P=i.cr(x);if(t[P])continue;t[P]=[]}I.slot&&t[I.slot]?t[I.slot].push(I):s.push(I)}}),this._mergedOrder=[];const m=(g=[])=>{for(const x of g)if(x.type==="slot"){const I=i.cr(x.id);t[I]&&m(t[I]),this._mergedSlots.push(I)}else{const I=i.C(x.id,x.scope);this._mergedOrder.push(I),h[I]=x,x.is3D(!!this.terrain)&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0),x.type==="clip"&&(this._clipLayerPresent=!0)}};m(s),this._mergedOrder.sort((g,x)=>{const I=h[g],P=h[x];return I.hasInitialOcclusionOpacityProperties?P.is3D(!!this.terrain)?1:0:I.is3D(!!this.terrain)&&P.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=i.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(s,h,m){const g=i.l({},h);for(const I of Object.keys(i.a5.colorTheme))g[I]===void 0&&(g[I]=i.a5.colorTheme[I].default);const x=new i.a6(o0,s,new Map(m));return x.setTransitionOrValue(g,m),x.untransitioned().possiblyEvaluate(new i.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((h,m)=>{const g="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let x=t;x.startsWith(g)||(x=g+x);const I=i.I.from("mapbox-reserved-lut"),P=new Image;P.src=x,P.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},P.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void h();this._styleColorTheme.lutLoading=!1;const{width:z,height:L,data:F}=i.q.getImageData(P);if(L>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==L*L)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new i.r({width:z,height:L},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(I,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},h()):m(new Error("Missing LUT image."))}})}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(s,h,m){let g,x,I;const P=i.q.devicePixelRatio>1?"@2x":"";let z=i.n(h.transformRequest(h.normalizeSpriteURL(s,P,".json"),i.R.SpriteJSON),(B,j)=>{z=null,I||(I=B,g=j,F())}),L=i.o(h.transformRequest(h.normalizeSpriteURL(s,P,".png"),i.R.SpriteImage),(B,j)=>{L=null,I||(I=B,x=j,F())});function F(){if(I)m(I);else if(g&&x){const B=i.q.getImageData(x),j={};for(const X in g){const{width:q,height:J,x:Q,y:oe,sdf:ue,pixelRatio:ce,stretchX:ge,stretchY:pe,content:_e}=g[X],me=new i.r({width:q,height:J});i.r.copy(B,me,{x:Q,y:oe},{x:0,y:0},{width:q,height:J},null),j[X]={data:me,pixelRatio:ce,sdf:ue,stretchX:ge,stretchY:pe,content:_e,usvg:!1}}m(null,j)}}return{cancel(){z&&(z.cancel(),z=null),L&&(L.cancel(),L=null)}}}(t,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new i.z(s));else if(h){const m=new Map;for(const g in h)m.set(i.I.from(g),h[g]);this.addImages(m)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const h=this.getOwnSource(s.source);if(!h)return void this.fire(new i.z(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));if(h.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));this.imageManager.createIconset(this.scope,t);const m=new nf(t,this);h.addIconset(t,m)}_loadIconset(t){if(!i.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var h,m;this._spriteRequest=(m=(g,x)=>{if(this._spriteRequest=null,g)s?this._loadSprite(t):this.fire(new i.z(g));else if(x){const I=new Map;for(const P in x)I.set(i.I.from(P),x[P]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.bj((h=this.map._requestManager).transformRequest(h.normalizeIconsetURL(t),i.R.Iconset),(g,x)=>{if(g)return void m(g);const I={},P=i.ch(new i.bi(x));for(const z of P.icons){const L={version:1,pixelRatio:i.q.devicePixelRatio,content:Xm(z),stretchX:z.metadata?rf(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?rf(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};I[z.name]=L}m(null,I)}))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const h=t.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new i.z(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,s)=>{const h=this.fragments[s];return h&&h.style&&(t.data=h.style.serialize()),t})}_serializeSources(){const t={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();t[h.id]||(t[h.id]=h.serialize())}return t}_serializeLayers(t){const s=[];for(const h of t){const m=this._layers[h];m&&m.type!=="custom"&&s.push(m.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new i.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new i.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const h=this.map.painter;if(h)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){const g=t.getProgramIds();if(g)for(const x of g){const I=t.getDefaultProgramParams(x,s.zoom,this._styleColorTheme.lut);I&&(h.style=this,this.fog&&(h._fogVisible=!0,I.overrideFog=!0,h.getOrCreateProgram(x,I)),h._fogVisible=!1,I.overrideFog=!1,h.getOrCreateProgram(x,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,h.getOrCreateProgram(x,I)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const h=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const x=this._changes.getLayerUpdatesByScope();for(const I in x){const{updatedIds:P,removedIds:z}=x[I];(P||z)&&(this._updateWorkerLayers(I,P,z),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const g={};for(const x in this._mergedSourceCaches){const I=this._mergedSourceCaches[x];g[x]=I.used,I.used=!1,I.tileCoverLift=0}for(const x of this._mergedOrder){const I=this._mergedLayers[x];if(I.recalculate(t,this._availableImages),!I.isHidden(t.zoom)){const P=this.getLayerSourceCache(I);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,I.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(I,t)}):this.precompilePrograms(I,t))}for(const x in this._mergedSourceCaches){const I=this._mergedSourceCaches[x];if(!I)continue;const P=I._source;P.type==="raster-array"&&P.iconsets&&(I.used=!0)}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();for(const x in g){const I=this._mergedSourceCaches[x];g[x]!==I.used&&I.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:I.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),h&&this.fire(new i.A("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,s,h){const m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:s?m._serializeLayers(s):[],scope:t,removedIds:h||[],options:m.options})}setState(t,s){if(this._checkLoaded(),Xa(this,vs(t)))return!1;(t=i.cq(t)).layers=Jd(t.layers);const h=function(x,I){if(!x)return[{command:Xr.setStyle,args:[I]}];let P=[];try{if(!i.bn(x.version,I.version))return[{command:Xr.setStyle,args:[I]}];if(i.bn(x.center,I.center)||P.push({command:Xr.setCenter,args:[I.center]}),i.bn(x.zoom,I.zoom)||P.push({command:Xr.setZoom,args:[I.zoom]}),i.bn(x.bearing,I.bearing)||P.push({command:Xr.setBearing,args:[I.bearing]}),i.bn(x.pitch,I.pitch)||P.push({command:Xr.setPitch,args:[I.pitch]}),i.bn(x.sprite,I.sprite)||P.push({command:Xr.setSprite,args:[I.sprite]}),i.bn(x.glyphs,I.glyphs)||P.push({command:Xr.setGlyphs,args:[I.glyphs]}),i.bn(x.imports,I.imports)||function(j=[],X=[],q){X=X||[];const J=(j=j||[]).map(sn),Q=X.map(sn),oe=j.reduce(Kr,{}),ue=X.reduce(Kr,{}),ce=J.slice();let ge,pe,_e,me;for(ge=0,pe=0;ge<J.length;ge++)_e=J[ge],ue.hasOwnProperty(_e)?pe++:(q.push({command:Xr.removeImport,args:[_e]}),ce.splice(ce.indexOf(_e,pe),1));for(ge=0,pe=0;ge<Q.length;ge++)_e=Q[Q.length-1-ge],ce[ce.length-1-ge]!==_e&&(oe.hasOwnProperty(_e)?(q.push({command:Xr.removeImport,args:[_e]}),ce.splice(ce.lastIndexOf(_e,ce.length-pe),1)):pe++,me=ce[ce.length-ge],q.push({command:Xr.addImport,args:[ue[_e],me]}),ce.splice(ce.length-ge,0,_e));for(const we of X){const Ee=oe[we.id];Ee&&!i.bn(Ee,we)&&q.push({command:Xr.updateImport,args:[we.id,we]})}}(x.imports,I.imports,P),i.bn(x.transition,I.transition)||P.push({command:Xr.setTransition,args:[I.transition]}),i.bn(x.light,I.light)||P.push({command:Xr.setLight,args:[I.light]}),i.bn(x.fog,I.fog)||P.push({command:Xr.setFog,args:[I.fog]}),i.bn(x.snow,I.snow)||P.push({command:Xr.setSnow,args:[I.snow]}),i.bn(x.rain,I.rain)||P.push({command:Xr.setRain,args:[I.rain]}),i.bn(x.projection,I.projection)||P.push({command:Xr.setProjection,args:[I.projection]}),i.bn(x.lights,I.lights)||P.push({command:Xr.setLights,args:[I.lights]}),i.bn(x.camera,I.camera)||P.push({command:Xr.setCamera,args:[I.camera]}),!i.bn(x["color-theme"],I["color-theme"]))return[{command:Xr.setStyle,args:[I]}];const z={},L=[];(function(j,X,q,J){let Q;for(Q in X=X||{},j=j||{})j.hasOwnProperty(Q)&&(X.hasOwnProperty(Q)||Vs(Q,q,J));for(Q in X){if(!X.hasOwnProperty(Q))continue;const oe=X[Q];j.hasOwnProperty(Q)?i.bn(j[Q],oe)||(j[Q].type==="geojson"&&oe.type==="geojson"&&wl(j,X,Q)?q.push({command:Xr.setGeoJSONSourceData,args:[Q,oe.data]}):Qd(Q,X,q,J)):Wu(Q,X,q)}})(x.sources,I.sources,L,z);const F=[];x.layers&&x.layers.forEach(j=>{j.source&&z[j.source]?P.push({command:Xr.removeLayer,args:[j.id]}):F.push(j)});let B=x.terrain;B&&z[B.source]&&(P.push({command:Xr.setTerrain,args:[void 0]}),B=void 0),P=P.concat(L),i.bn(B,I.terrain)||P.push({command:Xr.setTerrain,args:[I.terrain]}),function(j,X,q){X=X||[];const J=(j=j||[]).map(sn),Q=X.map(sn),oe=j.reduce(Kr,{}),ue=X.reduce(Kr,{}),ce=J.slice(),ge=Object.create(null);let pe,_e,me,we,Ee,He,Be;for(pe=0,_e=0;pe<J.length;pe++)me=J[pe],ue.hasOwnProperty(me)?_e++:(q.push({command:Xr.removeLayer,args:[me]}),ce.splice(ce.indexOf(me,_e),1));for(pe=0,_e=0;pe<Q.length;pe++)me=Q[Q.length-1-pe],ce[ce.length-1-pe]!==me&&(oe.hasOwnProperty(me)?(q.push({command:Xr.removeLayer,args:[me]}),ce.splice(ce.lastIndexOf(me,ce.length-_e),1)):_e++,He=ce[ce.length-pe],q.push({command:Xr.addLayer,args:[ue[me],He]}),ce.splice(ce.length-pe,0,me),ge[me]=!0);for(pe=0;pe<Q.length;pe++)if(me=Q[pe],we=oe[me],Ee=ue[me],!ge[me]&&!i.bn(we,Ee))if(i.bn(we.source,Ee.source)&&i.bn(we["source-layer"],Ee["source-layer"])&&i.bn(we.type,Ee.type)){for(Be in Ht(we.layout,Ee.layout,q,me,null,Xr.setLayoutProperty),Ht(we.paint,Ee.paint,q,me,null,Xr.setPaintProperty),i.bn(we.slot,Ee.slot)||q.push({command:Xr.setSlot,args:[me,Ee.slot]}),i.bn(we.filter,Ee.filter)||q.push({command:Xr.setFilter,args:[me,Ee.filter]}),i.bn(we.minzoom,Ee.minzoom)&&i.bn(we.maxzoom,Ee.maxzoom)||q.push({command:Xr.setLayerZoomRange,args:[me,Ee.minzoom,Ee.maxzoom]}),we)we.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?Ht(we[Be],Ee[Be],q,me,Be.slice(6),Xr.setPaintProperty):i.bn(we[Be],Ee[Be])||q.push({command:Xr.setLayerProperty,args:[me,Be,Ee[Be]]}));for(Be in Ee)Ee.hasOwnProperty(Be)&&!we.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?Ht(we[Be],Ee[Be],q,me,Be.slice(6),Xr.setPaintProperty):i.bn(we[Be],Ee[Be])||q.push({command:Xr.setLayerProperty,args:[me,Be,Ee[Be]]}))}else q.push({command:Xr.removeLayer,args:[me]}),He=ce[ce.lastIndexOf(me)+1],q.push({command:Xr.addLayer,args:[Ee,He]})}(F,I.layers,P)}catch(z){console.warn("Unable to compute style diff:",z),P=[{command:Xr.setStyle,args:[I]}]}return P}(this.serialize(),t).filter(x=>!(x.command in u0));if(h.length===0)return!1;const m=h.filter(x=>!(x.command in c0));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);const g=[];return h.forEach(x=>{g.push(this[x.command].apply(this,x.args))}),s&&Promise.all(g).then(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}addImages(t){for(const[s,h]of t.entries()){if(this.getImage(s)&&!s.iconsetId)return this.fire(new i.z(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,h),this._changes.updateImage(s)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)&&!t.iconsetId?this.fire(new i.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(t,s,h=!1){this.imageManager.updateImage(t,this.scope,s),h&&(this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,s,h={}){return this._checkLoaded(),this._validate(Te,`models.${t}`,s,null,h)||(this.modelManager.addModel(t,s,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,s,h={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(Ua,`sources.${t}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=Hd(t,s,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const g=x=>{const I=(x?"symbol:":"other:")+m.id,P=i.C(I,this.scope),z=this._sourceCaches[I]=new ws(P,m,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=z,z.onAdd(this.map)};g(!1),s.type!=="vector"&&s.type!=="geojson"||g(!0),m.onAdd&&m.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new i.z(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new i.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const h=this.getOwnSourceCaches(t);for(const m of h){const g=i.cr(m.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(m.id),m.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const h=this.getOwnSourceCache(s);h&&t.push(h.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const h=t[s]._tiles;for(const m in h){const g=h[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const m of t){if(this._validate(Cc,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){const g=this.ambientLight;g.set(m),g.updateTransitions(s)}else this.ambientLight=new cn(m,Un||(Un=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const g=this.directionalLight;g.set(m),g.updateTransitions(s)}else this.directionalLight=new cn(m,Or||(Or=new i.a7({direction:new i.am(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const h=new i.aa(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const h=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),m=t.properties.get("color").toRenderColor(null).toArray01(),g=t.properties.get("intensity"),x=t.properties.get("direction"),I=1-i.cc(x.x,x.y,x.z)[2]/90,P=h(m)*g*I,z=s.properties.get("color").toRenderColor(null).toArray01(),L=s.properties.get("intensity"),F=h(z)*L;return Number(((P+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(i.cs(t)){const s=i.ct(t),h=this.fragments.find(({id:g})=>g===s);if(!h)throw new Error(`Style import '${t}' not found`);const m=i.cr(t);return h.style.getFragmentStyle(m)}{const s=this.fragments.find(({id:h})=>h===t);return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},h=(m,g="")=>`${m}::${g}`;this._featuresetSelectors={};for(const m in t){const g=this._featuresetSelectors[m]=[];for(const x of t[m].selectors){if(x.featureNamespace){const P=this.getOwnLayer(x.layer);if(!P){i.w(`Layer is undefined for selector: ${x.layer}`);continue}const z=h(P.source,P.sourceLayer);if(z in s&&s[z]!==x.featureNamespace){i.w(`"featureNamespace ${x.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}s[z]=x.featureNamespace}let I;if(x.properties)for(const P in x.properties){const z=i.X(x.properties[P]);z.result==="success"&&(I=I||{},I[P]=z.value)}g.push({layerId:x.layer,namespace:x.featureNamespace,properties:I,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const h=[];for(const m in s.stylesheet.featuresets)h.push({featuresetId:m,importId:s.scope?s.scope:void 0});return h}getFeaturesetLayers(t,s){const h=this.getFragmentStyle(s),m=h.stylesheet.featuresets;if(!m||!m[t])return this.fire(new i.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const g=[];for(const x of m[t].selectors){const I=h.getOwnLayer(x.layer);I&&g.push(I)}return g}getConfigProperty(t,s){const h=this.getFragmentStyle(t);if(!h)return null;const m=i.C(s,h.scope),g=h.options.get(m),x=g?g.value||g.default:null;return x?x.serialize():null}setConfigProperty(t,s,h){const m=this.getFragmentStyle(t);if(!m)return;const g=m.stylesheet.indoor?oh(m.stylesheet.schema):m.stylesheet.schema;if(!g||!g[s])return;const x=i.X(h);if(x.result!=="success")return void Xa(this,x.value);const I=x.value.expression,P=i.C(s,m.scope),z=m.options.get(P);if(!z)return;let L;const{minValue:F,maxValue:B,stepValue:j,type:X,values:q}=g[s],J=i.X(g[s].default);J.result==="success"&&(L=J.value.expression),L?(this.options.set(P,Object.assign({},z,{value:I,default:L,minValue:F,maxValue:B,stepValue:j,type:X,values:q})),this.updateConfigDependencies(s)):this.fire(new i.z(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const h=s.stylesheet.schema;if(!h)return null;const m={};for(const g in h){const x=i.C(g,s.scope),I=s.options.get(x),P=I?I.value||I.default:null;m[g]=P?P.serialize():null}return m}setConfig(t,s){const h=this.getFragmentStyle(t);h&&(h.updateConfig(s,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const h=this.getFragmentStyle(t);h&&(h.stylesheet.schema=s,h.updateConfig(h._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const h in s){let m,g;const x=i.X(s[h].default);if(x.result==="success"&&(m=x.value.expression),t&&t[h]!==void 0){const B=i.X(t[h]);B.result==="success"&&(g=B.value.expression)}const{minValue:I,maxValue:P,stepValue:z,type:L,values:F}=s[h];if(m){const B=i.C(h,this.scope);this.options.set(B,{default:m,value:g,minValue:I,maxValue:P,stepValue:z,type:L,values:F})}else this.fire(new i.z(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const s of this._configDependentLayers){const h=this.getLayer(s);if(h){if(t&&!h.configDependencies.has(t))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const h=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(h){const m=s._evaluateColorThemeData(h);(!s._styleColorTheme.lut&&m!==""||s._styleColorTheme.lut&&m!==s._styleColorTheme.lut.data)&&s.setColorTheme(h)}}),this._changes.setDirty()}addLayer(t,s,h={}){this._checkLoaded();const m=t.id;if(this._layers[m])return void this.fire(new i.z(new Error(`Layer with id "${m}" already exists on this map`)));let g;if(t.type==="custom"){if(Xa(this,i.cu(t)))return;g=i.cv(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=i.cq(t),t=i.l(t,{source:m})),this._validate(Xe,`layers.${m}`,t,{arrayIndex:-1},h))return;g=i.cv(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:m}})}g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid);let x=this._order.length;if(s){const L=this._order.indexOf(s);if(L===-1)return void this.fire(new i.z(new Error(`Layer with id "${s}" does not exist on this map.`)));g.slot===this._layers[s].slot?x=L:i.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,m),this._layerOrderChanged=!0,this._layers[m]=g;const I=this.getOwnLayerSourceCache(g),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&g.canCastShadows()&&P&&(I.castsShadows=!0);const z=this._changes.getRemovedLayer(g);if(z&&g.source&&I&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const L=i.C(g.source,g.scope);z.type!==g.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),I.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const h=this._checkLayer(t);if(!h||t===s)return;const m=this._order.indexOf(t);this._order.splice(m,1);let g=this._order.length;if(s){const x=this._order.indexOf(s);if(x===-1)return void this.fire(new i.z(new Error(`Layer with id "${s}" does not exist on this map.`)));h.slot===this._layers[s].slot?g=x:i.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const m=this.getOwnLayerSourceCache(s);if(m&&m.castsShadows){let g=!1;for(const x in this._layers)if(this._layers[x].source===s.source&&this._layers[x].canCastShadows()){g=!0;break}m.castsShadows=g}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,h){this._checkLoaded();const m=this._checkLayer(t);m&&(m.minzoom===s&&m.maxzoom===h||(s!=null&&(m.minzoom=s),h!=null&&(m.maxzoom=h),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const h=this._checkLayer(t);h&&h.slot!==s&&(h.slot=s,this._updateLayer(h))}setFilter(t,s,h={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!i.bn(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(Y,`layers.${m.id}.filter`,s,{layerType:m.type},h)||(m.filter=i.cq(s),this._updateLayer(m)))}getFilter(t){const s=this._checkLayer(t);if(s)return i.cq(s.filter)}setLayoutProperty(t,s,h,m={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!i.bn(g.getLayoutProperty(s),h)){if(h!=null&&(!m||m.validate!==!1)&&Xa(g,fe.call(vs,{key:`layers.${t}.layout.${s}`,layerType:g.type,objectKey:s,value:h,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(s,h),g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(t,s){const h=this._checkLayer(t);if(h)return h.getLayoutProperty(s)}setPaintProperty(t,s,h,m={}){this._checkLoaded();const g=this._checkLayer(t);if(!g||i.bn(g.getPaintProperty(s),h)||h!=null&&(!m||m.validate!==!1)&&Xa(g,re.call(vs,{key:`layers.${t}.paint.${s}`,layerType:g.type,objectKey:s,value:h,styleSpec:i.a5})))return;const x=g.setPaintProperty(s,h);g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),x&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(t,s){const h=this._checkLayer(t);if(h)return h.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:P,importId:z}=t.target,L=this.getFragmentStyle(z),F=L.getFeaturesetLayers(P);for(const{source:B,sourceLayer:j}of F)L.setFeatureState({id:t.id,source:B,sourceLayer:j},s)}else if("layerId"in t.target){const{layerId:P}=t.target,z=this.getLayer(P);this.setFeatureState({id:t.id,source:z.source,sourceLayer:z.sourceLayer},s)}return}const h=t.source,m=t.sourceLayer,g=this._checkSource(h);if(!g)return;const x=g.type;if(x==="geojson"&&m)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!m)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(h);for(const P of I)P.setFeatureState(m,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:P,importId:z}=t.target,L=this.getFragmentStyle(z),F=L.getFeaturesetLayers(P);for(const{source:B,sourceLayer:j}of F)L.removeFeatureState({id:t.id,source:B,sourceLayer:j},s)}else if("layerId"in t.target){const{layerId:P}=t.target,z=this.getLayer(P);this.removeFeatureState({id:t.id,source:z.source,sourceLayer:z.sourceLayer},s)}return}const h=t.source,m=this._checkSource(h);if(!m)return;const g=m.type,x=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!x)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(h);for(const P of I)P.removeFeatureState(x,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let g;if("featuresetId"in t.target){const{featuresetId:x,importId:I}=t.target,P=this.getFragmentStyle(I),z=P.getFeaturesetLayers(x);for(const{source:L,sourceLayer:F}of z){const B=P.getFeatureState({id:t.id,source:L,sourceLayer:F});if(B&&!g)g=B;else if(!i.bn(g,B))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:x}=t.target,I=this.getLayer(x);g=this.getFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer})}return g}const s=t.source,h=t.sourceLayer,m=this._checkSource(s);if(m){if(m.type!=="vector"||h)return t.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(h,t.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=i.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return i.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),h=i.C(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[h]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=I=>this._mergedLayers[I].is3D(!!this.terrain),h=this.order,m={},g=[];for(let I=h.length-1;I>=0;I--){const P=h[I];if(s(P)){m[P]=I;for(const z of t){const L=z[P];if(L)for(const F of L)g.push(F)}}}g.sort((I,P)=>P.intersectionZ-I.intersectionZ);const x=[];for(let I=h.length-1;I>=0;I--){const P=h[I];if(s(P))for(let z=g.length-1;z>=0;z--){const L=g[z].feature;if(L.layer&&m[L.layer.id]<I)break;x.push(L),g.pop()}else for(const z of t){const L=z[P];if(L)for(const F of L)x.push(F.feature)}}return x}queryRenderedFeatures(t,s,h){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(Y,"queryRenderedFeatures.filter",s.filter,null,s),m=i.a_(s.filter));const g={},x=L=>{if(sf.has(L.type))return;const F=this.getOwnLayerSourceCache(L),B=g[F.id]=g[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[L.fqid]=B.layers[L.fqid]||{styleLayer:L,targets:[]},B.layers[L.fqid].targets.push({filter:m})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const L of s.layers){const F=this._layers[L];if(!F)return this.fire(new i.z(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];x(F)}}else for(const L in this._layers)x(this._layers[L]);const I=this._queryRenderedFeatures(t,g,h),P=this._flattenAndSortRenderedFeatures(I),z=[];for(const L of P)i.ct(L.layer.id)===this.scope&&z.push(L);return z}queryRenderedFeatureset(t,s,h){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(Y,"queryRenderedFeatures.filter",s.filter,null,s),m=i.a_(s.filter));const g="mock",x=[];if(s&&s.target)x.push(Object.assign({},s,{targetId:g,filter:m}));else{const L=this.getFeaturesetDescriptors();for(const F of L)x.push({targetId:g,filter:m,target:F});for(const{style:F}of this.fragments){const B=F.getFeaturesetDescriptors();for(const j of B)x.push({targetId:g,filter:m,target:j})}}const I=this.queryRenderedTargets(t,x,h),P=[],z=new Set;for(const L of I)for(const F of L.variants[g])Rc(F,L,z)||P.push(new i.cx(L,F));return P}queryRenderedTargets(t,s,h){const m={},g=(I,P,z,L)=>{const F=m[P.id]=m[P.id]||{sourceCache:P,layers:{},has3DLayers:!1};if(F.layers[I.fqid]=F.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(F.has3DLayers=!0),!L)return z.uniqueFeatureID=!1,void F.layers[I.fqid].targets.push(z);F.layers[I.fqid].targets.push(Object.assign({},z,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const I of s)if("featuresetId"in I.target){const{featuresetId:P,importId:z}=I.target,L=this.getFragmentStyle(z);if(!L||!L._featuresetSelectors)continue;const F=L._featuresetSelectors[P];if(!F){this.fire(new i.z(new Error(`The featureset '${P}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of F){const j=L.getOwnLayer(B.layerId);j&&!sf.has(j.type)&&g(j,L.getOwnLayerSourceCache(j),I,B)}}else if("layerId"in I.target){const{layerId:P}=I.target,z=this.getLayer(P);if(!z||sf.has(z.type))continue;g(z,this.getLayerSourceCache(z),I)}const x=this._queryRenderedFeatures(t,m,h);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(t,s,h){const m=[],g=!!this.map._showQueryGeometry,x=Qn.createFromScreenPoints(t,h);for(const I in s){const P=Dc(x,s[I],this._availableImages,h,g);Object.keys(P).length&&m.push(P)}if(this.placement)for(const I in s){if(!s[I].sourceCache._onlySymbols)continue;const P=Wd(x.screenGeometry,s[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(P).length&&m.push(P)}return m}querySourceFeatures(t,s){const h=s&&s.filter;h&&this._validate(Y,"querySourceFeatures.filter",h,null,s);let m=[];const g=this.getOwnSourceCaches(t);for(const x of g)m=m.concat(Nm(x,s));return m}addSourceType(t,s,h){return os.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(os.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,h={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const I in t)if(!i.bn(t[I],m[I])){g=!0;break}if(!g)return;const x=this._getTransitionParameters();this.light.setLight(t,s,h),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=t;const m=t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){const I="terrain-dem-src";this.addSource(I,h.source),h=i.cq(h),h=i.l(h,{source:I})}const g=i.l({},h),x={};if(this.terrain&&m){g.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(x.style=I.serialize())}if(this._validate(bl,"terrain",g,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&s!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,s),this.fire(new i.A("data",{dataType:"style"}))}else{const g=this.terrain,x=g.get();for(const I of Object.keys(i.a5.terrain))!h.hasOwnProperty(I)&&i.a5.terrain[I].default&&(h[I]=i.a5.terrain[I].default);for(const I in t)if(!i.bn(t[I],x[I])){g.set(t,this.options),this.stylesheet.terrain=t;const P=this._getTransitionParameters({duration:0});g.updateTransitions(P),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Er(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createSnow(t){const s=this.snow=new un(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createRain(t){const s=this.rain=new ln(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const h=this._evaluateColorThemeData(s);this._loadColorTheme(h).then(()=>{this.fire(new i.A("colorthemeset")),t()}).catch(m=>{i.w(`Couldn't set color theme: ${m}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const h=this.getFragmentStyle(t);h&&(h._styleColorTheme.colorThemeOverride=s,h._reloadColorTheme())}_getTransitionParameters(t){return{now:i.q.now(),transition:i.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?t.push(h):s.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const h=this.terrain=new qe(t,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});h.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,h,m,g={}){if(g&&g.validate===!1)return!1;const x=i.l({},this.serialize());return Xa(this,t.call(vs,i.l({key:s,style:x,value:h,styleSpec:i.a5},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const h of s)h.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const s=this.getSourceCaches(t);for(const h of s)h.resume(),h.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let s;this.directionalLight&&(s=ih(this.directionalLight));for(const h in this._mergedSourceCaches)this._mergedSourceCaches[h].update(t,void 0,void 0,s)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,h,m,g,x,I=!1){let P=!1,z=!1;const L={},F={};for(const B of this._mergedOrder){const j=this._mergedLayers[B];if(j.type!=="symbol")continue;const X=i.C(j.source,j.scope);let q=L[X];if(!q){const Q=this.getLayerSourceCache(j);if(!Q)continue;const oe=Q.getRenderableIds(!0).map(ue=>Q.getTileByID(ue));F[X]=oe.slice(),q=L[X]=oe.sort((ue,ce)=>ce.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(ce.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(j,q,s.center.lng,s.projection);P=P||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),s.zoom))&&(this.pauseablePlacement=new Qu(s,this._mergedOrder,I,h,m,g,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),z=!0),P&&this.pauseablePlacement.placement.setStale()),z||P){this._buildingIndex.onNewFrame(s.zoom);for(let B=0;B<this._mergedOrder.length;B++){const j=this._mergedLayers[this._mergedOrder[B]];if(j.type!=="symbol")continue;const X=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,L[i.C(j.source,j.scope)],B,X?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:g})=>g===t.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return h.push(t),this._loadImports([t],!0);const m=h.findIndex(({id:g})=>g===s);return m===-1&&this.fire(new i.z(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,m).concat(t).concat(h.slice(m)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==h[m].url&&this.setImportUrl(t,s.url),i.bn(s.config,h[m].config)||this.setImportConfig(t,s.config,s.data.schema),i.bn(s.data,h[m].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let h=this.stylesheet.imports||[];const m=this.getImportIndex(t);if(m===-1)return this;const g=this.getImportIndex(s);if(g===-1)return this;const x=h[m],I=this.fragments[m];return h=h.filter(({id:P})=>P!==t),this.fragments=this.fragments.filter(({id:P})=>P!==t),this.stylesheet.imports=h.slice(0,g).concat(x).concat(h.slice(g)),this.fragments=this.fragments.slice(0,g).concat(I).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;h[m].url=s;const g=this.fragments[m];return g.style=this._createFragmentStyle(h[m]),g.style.on("style.import.load",()=>this.mergeAll()),g.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const h=this.getImportIndex(t),m=this.stylesheet.imports||[];return h===-1?this:s?(this.fragments[h].style.setState(s),this._reloadImports(),this):(delete m[h].data,this.setImportUrl(t,m[h].url))}setImportConfig(t,s,h){this._checkLoaded();const m=this.getImportIndex(t),g=this.stylesheet.imports||[];if(m===-1)return this;s?g[m].config=s:delete g[m].config;const x=this.fragments[m];h&&x.style.stylesheet&&(x.style.stylesheet.schema=h);const I=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=s,x.style.updateConfig(s,I),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],h=this.getImportIndex(t);h!==-1&&(s.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex(h=>h.id===t);return s===-1&&this.fire(new i.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[s];h&&t.push(h.getSource())}return t}getSource(t,s){const h=this.getSourceCache(t,s);return h&&h.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const h=i.C(t,s);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(t){const s=i.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const h=t[s];h==="reload"?this.reloadSource(s):h==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const h of s){const m=this.getLayer(h);m&&m.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,s,h){this.imageManager.getImages(s.images,s.scope,h),this._updateTilesForChangedImages();const m=x=>{if(x){const I=s.images.map(P=>i.I.toString(P));x.setDependencies(s.tileID.key,s.type,I)}},g=i.C(s.source,s.scope);m(this._mergedOtherSourceCaches[g]),m(this._mergedSymbolSourceCaches[g])}rasterizeImages(t,s,h){this.imageManager.rasterizeImages(s,h)}getGlyphs(t,s,h){this.glyphManager.getGlyphs(s.stacks,s.scope,h)}getResource(t,s,h){return i.cz(s,h)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${t}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const h=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(h||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}os.getSourceType=function(d){return $a[d]},os.setSourceType=function(d,t){$a[d]=t},os.registerForPluginStateChange=i.ci;var Ym=`
#define EPSILON 0.0000001\r
#define PI 3.141592653589793\r
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {\r
float near=cutoff_params.x;\r
float far=cutoff_params.y;\r
float cutoffStart=cutoff_params.z;\r
float cutoffEnd=cutoff_params.w;\r
float linearDepth=(depth-near)/(far-near);\r
return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);\r
}\r
#endif`,af=`
out vec4 glFragColor;\r
highp float unpack_depth(highp vec4 rgba_depth)\r
{\r
const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r
return dot(rgba_depth,bit_shift)*2.0-1.0;\r
}highp vec4 pack_depth(highp float ndc_z) {\r
highp float depth=ndc_z*0.5+0.5;\r
const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\r
const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\r
highp vec4 res=fract(depth*bit_shift);\r
res-=res.xxyz*bit_mask;\r
return res;\r
}\r
#ifdef INDICATOR_CUTOUT\r
uniform vec3 u_indicator_cutout_centers;\r
uniform vec4 u_indicator_cutout_params;\r
#endif\r
vec4 applyCutout(vec4 color,float height) {\r
#ifdef INDICATOR_CUTOUT\r
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));\r
float holeRadius=max(u_indicator_cutout_params.y,0.0);\r
float holeAspectRatio=u_indicator_cutout_params.z;\r
float fadeStart=u_indicator_cutout_params.w;\r
float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));\r
return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\r
#else\r
return color;\r
#endif\r
}\r
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\\r
glFragColor=vec4(0.7,0.0,0.0,0.7); \\\r
gl_FragDepth=gl_FragCoord.z-0.0001;
#else\r
#define HANDLE_WIREFRAME_DEBUG\r
#endif\r
#ifdef RENDER_CUTOFF\r
uniform highp vec4 u_cutoff_params;\r
in float v_cutoff_opacity;\r
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {\r
highp vec2 size=vec2(textureSize(image,0));\r
highp vec2 dx=dFdx(lod_coord.xy*size);\r
highp vec2 dy=dFdy(lod_coord.xy*size);\r
highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));\r
highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);\r
}\r
vec4 applyLUT(highp sampler3D lut,vec4 col) {\r
vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;\r
return vec4(texture(lut,uvw).rgb,col.a);\r
}\r
vec3 applyLUT(highp sampler3D lut,vec3 col) {\r
return applyLUT(lut,vec4(col,1.0)).rgb;\r
}`,ah=`
#define EXTENT 8192.0\r
#define RAD_TO_DEG 180.0/PI\r
#define DEG_TO_RAD PI/180.0\r
#define GLOBE_RADIUS EXTENT/PI/2.0\r
float wrap(float n,float min,float max) {\r
float d=max-min;\r
float w=mod(mod(n-min,d)+d,d)+min;\r
return (w==min) ? max : w;\r
}\r
#ifdef PROJECTION_GLOBE_VIEW\r
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\r
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;\r
vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;\r
mercator-=mercator_center;\r
mercator.x=wrap(mercator.x,-0.5,0.5);\r
vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);\r
mercator_tile=matrix*mercator_tile;\r
return mercator_tile.xyz;\r
#else\r
return vec3(0.0);\r
#endif\r
}\r
vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\r
return mix(globe,mercator,t);\r
}\r
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {\r
vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));\r
vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));\r
vec3 yAxis=normalize(cross(normal,xAxis));\r
return mat3(xAxis,yAxis,normal);\r
}\r
#endif
vec2 unpack_float(const float packedValue) {\r
int packedIntValue=int(packedValue);\r
int v0=packedIntValue/256;\r
return vec2(v0,packedIntValue-v0*256);\r
}\r
vec2 unpack_opacity(const float packedOpacity) {\r
int intOpacity=int(packedOpacity)/2;\r
return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));\r
}vec4 decode_color(const vec2 encodedColor) {\r
return vec4(\r
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\r
);\r
}float unpack_mix_vec2(const vec2 packedValue,const float t) {\r
return mix(packedValue[0],packedValue[1],t);\r
}vec4 unpack_mix_color(const vec4 packedColors,const float t) {\r
vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));\r
vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));\r
return mix(minColor,maxColor,t);\r
}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {\r
vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);\r
return (units_to_pixels*pos+offset)/pattern_size;\r
}\r
vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {\r
return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);\r
}\r
float mercatorXfromLng(float lng) {\r
return (180.0+lng)/360.0;\r
}\r
float mercatorYfromLat(float lat) {\r
return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;\r
}\r
vec3 latLngToECEF(vec2 latLng) {\r
latLng=DEG_TO_RAD*latLng;\r
float cosLat=cos(latLng[0]);\r
float sinLat=sin(latLng[0]);\r
float cosLng=cos(latLng[1]);\r
float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;\r
float sy=-sinLat*GLOBE_RADIUS;\r
float sz=cosLat*cosLng*GLOBE_RADIUS;\r
return vec3(sx,sy,sz);\r
}\r
#ifdef RENDER_CUTOFF\r
uniform vec4 u_cutoff_params;\r
out float v_cutoff_opacity;\r
#endif\r
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;\r
vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\r
{\r
float skirt=float(posWithComposedSkirt.x >=skirtOffset);\r
vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);\r
return vec3(pos,skirt);\r
}`,jc=`in highp vec3 a_pos_3f;\r
uniform lowp mat4 u_matrix;\r
out highp vec3 v_uv;\r
void main() {\r
const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);\r
v_uv=half_neg_pi_around_x*a_pos_3f;\r
vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;\r
}`,lh=`
#define ELEVATION_SCALE 7.0\r
#define ELEVATION_OFFSET 450.0\r
#ifdef PROJECTION_GLOBE_VIEW\r
uniform vec3 u_tile_tl_up;\r
uniform vec3 u_tile_tr_up;\r
uniform vec3 u_tile_br_up;\r
uniform vec3 u_tile_bl_up;\r
uniform float u_tile_up_scale;\r
vec3 elevationVector(vec2 pos) {\r
vec2 uv=pos/EXTENT;\r
vec3 up=normalize(mix(\r
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));\r
return up*u_tile_up_scale;\r
}\r
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\r
#endif
#ifdef TERRAIN\r
uniform highp sampler2D u_dem;\r
uniform highp sampler2D u_dem_prev;\r
uniform vec2 u_dem_tl;\r
uniform vec2 u_dem_tl_prev;\r
uniform float u_dem_scale;\r
uniform float u_dem_scale_prev;\r
uniform float u_dem_size;uniform float u_dem_lerp;\r
uniform float u_exaggeration;\r
uniform float u_meter_to_dem;\r
uniform mat4 u_label_plane_matrix_inv;\r
vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {\r
vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;\r
vec2 f=fract(pos);\r
return vec4((pos-f+0.5)/(dem_size+2.0),f);\r
}\r
float currentElevation(vec2 apos) {\r
#ifdef TERRAIN_DEM_FLOAT_FORMAT\r
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);\r
return u_exaggeration*texture(u_dem,pos).r;\r
#else
float dd=1.0/(u_dem_size+2.0);\r
vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);\r
vec2 pos=r.xy;\r
vec2 f=r.zw;\r
float tl=texture(u_dem,pos).r;\r
float tr=texture(u_dem,pos+vec2(dd,0)).r;\r
float bl=texture(u_dem,pos+vec2(0,dd)).r;\r
float br=texture(u_dem,pos+vec2(dd,dd)).r;\r
return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\r
#endif
}\r
float prevElevation(vec2 apos) {\r
#ifdef TERRAIN_DEM_FLOAT_FORMAT\r
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);\r
return u_exaggeration*texture(u_dem_prev,pos).r;\r
#else
float dd=1.0/(u_dem_size+2.0);\r
vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);\r
vec2 pos=r.xy;\r
vec2 f=r.zw;\r
float tl=texture(u_dem_prev,pos).r;\r
float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;\r
float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;\r
float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;\r
return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\r
#endif
}\r
#ifdef TERRAIN_VERTEX_MORPHING\r
float elevation(vec2 apos) {\r
#ifdef ZERO_EXAGGERATION\r
return 0.0;\r
#endif
float nextElevation=currentElevation(apos);\r
float prevElevation=prevElevation(apos);\r
return mix(prevElevation,nextElevation,u_dem_lerp);\r
}\r
#else
float elevation(vec2 apos) {\r
#ifdef ZERO_EXAGGERATION\r
return 0.0;\r
#endif
return currentElevation(apos);\r
}\r
#endif
vec4 fourSample(vec2 pos,vec2 off) {\r
float tl=texture(u_dem,pos).r;\r
float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;\r
float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;\r
float br=texture(u_dem,pos+off).r;\r
return vec4(tl,tr,bl,br);\r
}\r
float flatElevation(vec2 pack) {\r
vec2 apos=floor(pack/8.0);\r
vec2 span=10.0*(pack-apos*8.0);\r
vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;\r
float size=u_dem_size+2.0;\r
float dd=1.0/size;\r
vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;\r
vec2 f=fract(pos);\r
pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));\r
float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);\r
vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));\r
vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));\r
vec4 diff=abs(h.xzxy-h.ywzw);\r
vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));\r
vec2 fix=slope*span;\r
float base=z+max(fix.x,fix.y);\r
return u_exaggeration*base;\r
}\r
float elevationFromUint16(float word) {\r
return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);\r
}
#else
float elevation(vec2 pos) { return 0.0; }\r
#endif\r
#ifdef DEPTH_OCCLUSION\r
uniform highp sampler2D u_depth;\r
uniform highp vec2 u_depth_size_inv;\r
uniform highp vec2 u_depth_range_unpack;\r
uniform highp float u_occluder_half_size;\r
uniform highp float u_occlusion_depth_offset;\r
#ifdef DEPTH_D24\r
float unpack_depth(float depth) {\r
return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;\r
}\r
vec4 unpack_depth4(vec4 depth) {\r
return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);\r
}\r
#else
highp float unpack_depth_rgba(vec4 rgba_depth)\r
{\r
const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r
return dot(rgba_depth,bit_shift)*2.0-1.0;\r
}\r
#endif
bool isOccluded(vec4 frag) {\r
vec3 coord=frag.xyz/frag.w;\r
#ifdef DEPTH_D24\r
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\r
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\r
#endif
return coord.z+u_occlusion_depth_offset > depth;\r
}\r
highp vec4 getCornerDepths(vec2 coord) {\r
highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);\r
highp vec2 uv=0.5*coord.xy+0.5;\r
#ifdef DEPTH_D24\r
highp vec4 depth=vec4(\r
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\r
);\r
depth=unpack_depth4(depth);\r
#else
highp vec4 depth=vec4(\r
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\r
);\r
#endif
return depth;\r
}highp float occlusionFadeMultiSample(vec4 frag) {\r
highp vec3 coord=frag.xyz/frag.w;\r
highp vec2 uv=0.5*coord.xy+0.5;\r
int NX=3;\r
int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;\r
highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);\r
highp float res=0.0;\r
for (int y=0; y < NY;++y) {\r
for (int x=0; x < NX;++x) {\r
#ifdef DEPTH_D24\r
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\r
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\r
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);\r
}\r
}\r
res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);\r
return res;\r
}highp float occlusionFade(vec4 frag) {\r
highp vec3 coord=frag.xyz/frag.w;\r
highp vec4 depth=getCornerDepths(coord.xy);\r
return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));\r
}\r
#else
bool isOccluded(vec4 frag) { return false; }\r
highp float occlusionFade(vec4 frag) { return 1.0; }\r
highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\r
#endif//DEPTH_OCCLUSION`,ya=`#ifdef FOG\r
uniform mediump vec4 u_fog_color;\r
uniform mediump vec2 u_fog_range;\r
uniform mediump float u_fog_horizon_blend;\r
uniform mediump mat4 u_fog_matrix;\r
out vec3 v_fog_pos;\r
float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);\r
}float fog_horizon_blending(vec3 camera_dir) {\r
float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);\r
}float fog_opacity(float t) {\r
const float decay=6.0;\r
float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);\r
}\r
vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;\r
}\r
vec3 fog_position(vec2 pos) {\r
return fog_position(vec3(pos,0.0));\r
}\r
float fog(vec3 pos) {\r
float depth=length(pos);\r
float opacity=fog_opacity(fog_range(depth));\r
return opacity*fog_horizon_blending(pos/depth);\r
}\r
#endif`,ch=`#ifdef FOG\r
uniform mediump vec4 u_fog_color;\r
uniform mediump vec2 u_fog_range;\r
uniform mediump float u_fog_horizon_blend;\r
uniform mediump vec2 u_fog_vertical_limit;\r
uniform mediump float u_fog_temporal_offset;\r
in vec3 v_fog_pos;\r
uniform highp vec3 u_frustum_tl;\r
uniform highp vec3 u_frustum_tr;\r
uniform highp vec3 u_frustum_br;\r
uniform highp vec3 u_frustum_bl;\r
uniform highp vec3 u_globe_pos;\r
uniform highp float u_globe_radius;\r
uniform highp vec2 u_viewport;\r
uniform float u_globe_transition;\r
uniform int u_is_globe;\r
float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);\r
}float fog_horizon_blending(vec3 camera_dir) {\r
float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);\r
}float fog_opacity(float t) {\r
const float decay=6.0;\r
float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);\r
}\r
float globe_glow_progress() {\r
highp vec2 uv=gl_FragCoord.xy/u_viewport;\r
highp vec3 ray_dir=mix(\r
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);\r
highp vec3 dir=normalize(ray_dir);\r
highp vec3 closest_point=dot(u_globe_pos,dir)*dir;\r
highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;\r
return sdf+PI*0.5;\r
}float fog_opacity(vec3 pos) {\r
float depth=length(pos);\r
return fog_opacity(fog_range(depth));\r
}\r
vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {\r
float depth=length(pos);\r
float opacity;\r
if (u_is_globe==1) {\r
float glow_progress=globe_glow_progress();\r
float t=mix(glow_progress,depth,u_globe_transition);\r
opacity=fog_opacity(fog_range(t));\r
} else {\r
opacity=fog_opacity(fog_range(depth));\r
opacity*=fog_horizon_blending(pos/depth);\r
}\r
return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));\r
}\r
vec3 fog_apply(vec3 color,vec3 pos) {\r
return fog_apply(color,pos,1.0);\r
}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {\r
float alpha=EPSILON+color.a;\r
color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;\r
return color;\r
}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {\r
float horizon_blend=fog_horizon_blending(normalize(camera_ray));\r
return mix(sky_color,u_fog_color.rgb,horizon_blend);\r
}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {\r
float alpha=EPSILON+color.a;\r
color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;\r
return color;\r
}\r
vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {\r
float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));\r
return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));\r
}\r
vec3 fog_dither(vec3 color) {\r
return color;\r
}\r
vec4 fog_dither(vec4 color) {\r
return vec4(fog_dither(color.rgb),color.a);\r
}\r
#endif`,lf=`#ifdef RASTER_ARRAY\r
uniform highp sampler2D u_image0;\r
uniform sampler2D u_image1;\r
const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {\r
texCoord=texCoord*texResolution-0.5;\r
fxy=fract(texCoord);\r
texCoord-=fxy;\r
return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);\r
}\r
vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);\r
vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);\r
vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);\r
vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);\r
return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);\r
}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec2 fxy;\r
ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);\r
return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\r
);\r
}\r
vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec2 fxy;\r
ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);\r
return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\r
);\r
}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);\r
return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);\r
}\r
vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);\r
return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);\r
}\r
#endif`,Ka=`#ifdef RASTER_ARRAY\r
uniform sampler2D u_velocity;\r
uniform mediump vec2 u_velocity_res;\r
uniform mediump float u_max_speed;\r
const vec4 NO_DATA=vec4(1);\r
const vec2 INVALID_VELOCITY=vec2(-1);\r
uniform highp vec2 u_uv_offset;\r
uniform highp float u_data_offset;\r
uniform highp vec2 u_data_scale;\r
ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {\r
texCoord=texCoord*texResolution-0.5;\r
fxy=fract(texCoord);\r
texCoord-=fxy;\r
return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);\r
}\r
highp vec2 lookup_velocity(highp vec2 uv) {\r
uv=u_uv_offset.x+u_uv_offset.y*uv;\r
highp vec2 fxy;\r
ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);\r
highp vec4 tl=texelFetch(u_velocity,c.yz,0);\r
highp vec4 tr=texelFetch(u_velocity,c.xz,0);\r
highp vec4 bl=texelFetch(u_velocity,c.yw,0);\r
highp vec4 br=texelFetch(u_velocity,c.xw,0);\r
if (tl==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
if (tr==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
if (bl==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
if (br==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\r
highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));\r
velocity.y=-velocity.y;\r
velocity/=max(u_max_speed,length(velocity));\r
return velocity;\r
}\r
#endif\r
uniform highp float u_particle_pos_scale;\r
uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {\r
highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;\r
highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));\r
return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);\r
}\r
highp vec2 unpack_pos_from_rgba(highp vec4 v) {\r
v=floor(v*255.0+0.5)/255.0;\r
highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));\r
return u_particle_pos_scale*p-u_particle_pos_offset;\r
}`,Cl=`#ifdef RENDER_SHADOWS\r
uniform mediump vec3 u_shadow_direction;\r
uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {\r
float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);\r
float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;\r
return n*dotScale;\r
}\r
vec3 shadow_normal_offset_model(vec3 normal) {\r
vec3 transformed_normal=vec3(-normal.xy,normal.z);\r
float NDotL=dot(normalize(transformed_normal),u_shadow_direction);\r
float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;\r
return normal*dotScale;\r
}\r
float shadow_normal_offset_multiplier0() {\r
return u_shadow_normal_offset[1];\r
}\r
float shadow_normal_offset_multiplier1() {\r
return u_shadow_normal_offset[2];\r
}\r
#endif//RENDER_SHADOWS`,$c=`#ifdef RENDER_SHADOWS\r
#ifdef DEPTH_TEXTURE\r
uniform highp sampler2D u_shadowmap_0;\r
uniform highp sampler2D u_shadowmap_1;\r
#else\r
uniform sampler2D u_shadowmap_0;\r
uniform sampler2D u_shadowmap_1;\r
#endif\r
uniform float u_shadow_intensity;\r
uniform float u_shadow_map_resolution;\r
uniform float u_shadow_texel_size;\r
uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;\r
uniform mediump vec3 u_shadow_direction;\r
uniform highp vec3 u_shadow_bias;\r
highp float shadow_sample_1(highp vec2 uv,highp float compare) {\r
highp float shadow_depth;\r
#ifdef DEPTH_TEXTURE\r
shadow_depth=texture(u_shadowmap_1,uv).r;\r
#else\r
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\r
#endif\r
return step(shadow_depth,compare);\r
}\r
highp float shadow_sample_0(highp vec2 uv,highp float compare) {\r
highp float shadow_depth;\r
#ifdef DEPTH_TEXTURE\r
shadow_depth=texture(u_shadowmap_0,uv).r;\r
#else\r
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\r
#endif\r
return step(shadow_depth,compare);\r
}\r
float shadow_occlusion_1(highp vec4 pos,highp float bias) {\r
highp vec2 uv=pos.xy;\r
return shadow_sample_1(uv,pos.z-bias);\r
}\r
float shadow_occlusion_0(highp vec4 pos,highp float bias) {\r
highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER\r
highp vec2 uv=pos.xy;\r
highp vec4 samples=textureGather(u_shadowmap_0,uv,0);\r
lowp vec4 stepSamples=step(samples,vec4(compare0));\r
#else\r
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);\r
highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);\r
highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);\r
highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);\r
lowp vec4 stepSamples=vec4(\r
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\r
);\r
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));\r
lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);\r
return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);\r
}\r
float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\r
#ifdef SHADOWS_SINGLE_CASCADE\r
light_view_pos0.xyz/=light_view_pos0.w;\r
vec2 abs_bounds=abs(light_view_pos0.xy);\r
if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {\r
return 0.0;\r
}\r
light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;\r
return shadow_occlusion_0(light_view_pos0,bias);\r
#else
light_view_pos0.xyz/=light_view_pos0.w;\r
light_view_pos1.xyz/=light_view_pos1.w;\r
vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);\r
vec4 abs_bounds=abs(uv);\r
if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {\r
light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;\r
return shadow_occlusion_0(light_view_pos0,bias);\r
}\r
if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {\r
return 0.0;\r
}\r
light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;\r
float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\r
#endif
}\r
highp float calculate_shadow_bias(float NDotL) {\r
#ifdef NORMAL_OFFSET\r
return 0.5*u_shadow_bias.x;\r
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\r
#endif\r
}\r
float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float NDotL=dot(N,u_shadow_direction);\r
float bias=calculate_shadow_bias(NDotL);\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r
}\r
float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {\r
float NDotL=dot(N,u_shadow_direction);\r
float bias=calculate_shadow_bias(NDotL);\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;\r
return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r
}\r
float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float NDotL=dot(N,u_shadow_direction);\r
float bias=0.0;\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r
}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\r
{\r
highp vec2 biasUV=vec2(\r
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);\r
biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));\r
return biasUV;\r
}\r
float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;\r
highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);\r
highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);\r
highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);\r
highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return 1.0-(u_shadow_intensity*occlusion);\r
}\r
float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float bias=0.0;\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return 1.0-(u_shadow_intensity*occlusion);\r
}\r
float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float bias=calculate_shadow_bias(ndotl);\r
return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
}\r
#endif`;const Ya=[];Wo(Ym,Ya),Wo(ah,Ya),Wo(af,Ya);const qo={"_prelude_fog.vertex.glsl":ya,"_prelude_terrain.vertex.glsl":lh,"_prelude_shadow.vertex.glsl":Cl,"_prelude_fog.fragment.glsl":ch,"_prelude_shadow.fragment.glsl":$c,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;\r
uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;\r
uniform mediump vec3 u_ground_radiance;\r
float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;\r
float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));\r
float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;\r
float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);\r
return vertical_factor*ambient_directional_factor;\r
}vec3 linearProduct(vec3 srgbIn,vec3 k) {\r
return srgbIn*pow(k,vec3(1./2.2));\r
}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);\r
vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;\r
vec3 directional_contrib=u_lighting_directional_color*dir_factor;\r
return linearProduct(color,ambient_contrib+directional_contrib);\r
}\r
vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {\r
return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);\r
}vec3 apply_lighting(vec3 color,vec3 normal) {\r
float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);\r
return apply_lighting(color.rgb,normal,dir_factor);\r
}\r
vec4 apply_lighting(vec4 color,vec3 normal) {\r
float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);\r
return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);\r
}\r
vec3 apply_lighting_ground(vec3 color) {\r
return color*u_ground_radiance;\r
}\r
vec4 apply_lighting_ground(vec4 color) {\r
return vec4(apply_lighting_ground(color.rgb),color.a);\r
}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);\r
}\r
vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {\r
return mix(apply_lighting_ground(color),color,emissive_strength);\r
}\r
vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);\r
float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);\r
return mix(fully_occluded_color,flood_light_color,occlusion_ramp);\r
}\r
vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {\r
vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);\r
return mix(fully_occluded_color,unlit_color,1.0-occlusion);\r
}\r
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":lf,"_prelude_raster_particle.glsl":Ka},Ja={};kr("",lh),kr(ch,ya),kr($c,Cl),kr(lf,""),kr(Ka,"");const uh=kr(af,ah),cf=Ym;var hh={background:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform vec4 u_color;\r
uniform float u_opacity;\r
#ifdef LIGHTING_3D_MODE\r
in vec4 v_color;\r
#endif\r
void main() {\r
vec4 out_color;\r
#ifdef LIGHTING_3D_MODE\r
out_color=v_color;\r
#else\r
out_color=u_color;\r
#endif\r
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*u_opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_lighting.glsl"\r
in vec2 a_pos;\r
uniform mat4 u_matrix;\r
#ifdef LIGHTING_3D_MODE\r
uniform mediump vec4 u_color;\r
out vec4 v_color;\r
uniform float u_emissive_strength;\r
#endif\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
#ifdef LIGHTING_3D_MODE\r
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),backgroundPattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform vec2 u_pattern_tl;\r
uniform vec2 u_pattern_br;\r
uniform vec2 u_texsize;\r
uniform float u_opacity;\r
uniform float u_emissive_strength;\r
uniform sampler2D u_image;\r
in highp vec2 v_pos;\r
void main() {\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);\r
vec4 out_color=textureLodCustom(u_image,pos,v_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*u_opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_pattern_size;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform vec2 u_pattern_units_to_pixels;\r
in vec2 a_pos;\r
out highp vec2 v_pos;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),circle:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
in vec3 v_data;\r
in float v_visibility;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define mediump float radius\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp vec4 stroke_color\r
#pragma mapbox: define mediump float stroke_width\r
#pragma mapbox: define lowp float stroke_opacity\r
uniform float u_emissive_strength;\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize mediump float radius\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp vec4 stroke_color\r
#pragma mapbox: initialize mediump float stroke_width\r
#pragma mapbox: initialize lowp float stroke_opacity\r
vec2 extrude=v_data.xy;\r
float blur_positive=blur < 0.0 ? 0.0 : 1.0;\r
lowp float antialiasblur=v_data.z;\r
float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);\r
float antialiased_blur=-max(abs(blur),antialiasblur);\r
float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);\r
float opacity_t=blur_positive==1.0 ? \r
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \r
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;\r
float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\r
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\r
);\r
vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
out_color=fog_apply_premultiplied(out_color,v_fog_pos);\r
#endif\r
glFragColor=out_color*(v_visibility*opacity_t);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
#define NUM_VISIBILITY_RINGS 2\r
#define INV_SQRT2 0.70710678\r
#define ELEVATION_BIAS 0.0001\r
#define NUM_SAMPLES_PER_RING 16\r
uniform mat4 u_matrix;\r
uniform mat2 u_extrude_scale;\r
uniform lowp float u_device_pixel_ratio;\r
uniform highp float u_camera_to_center_distance;\r
in vec2 a_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
#endif\r
#ifdef ELEVATED_ROADS\r
in float a_circle_z_offset;\r
#endif\r
out vec3 v_data;\r
out float v_visibility;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define mediump float radius\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp vec4 stroke_color\r
#pragma mapbox: define mediump float stroke_width\r
#pragma mapbox: define lowp float stroke_opacity\r
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {\r
return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;\r
}\r
float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {\r
vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);\r
vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);\r
vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);\r
vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);\r
float h1=elevation(c1)+ELEVATION_BIAS;\r
float h2=elevation(c2)+ELEVATION_BIAS;\r
float h3=elevation(c3)+ELEVATION_BIAS;\r
float h4=elevation(c4)+ELEVATION_BIAS;\r
return max(h4,max(h3,max(h1,h2)));\r
}\r
float circle_elevation(vec2 pos) {\r
#if defined(TERRAIN)\r
return elevation(pos)+ELEVATION_BIAS;\r
#else\r
return 0.0;\r
#endif\r
}\r
vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {\r
vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\r
#ifdef PITCH_WITH_MAP\r
#ifdef PROJECTION_GLOBE_VIEW\r
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\r
#else\r
return u_matrix*( world_center+vec4(sample_offset,0,0) );\r
#endif\r
#else\r
return projected_center+vec4(sample_offset,0,0);\r
#endif\r
}\r
float get_sample_step() {\r
#ifdef PITCH_WITH_MAP\r
return 2.0*PI/float(NUM_SAMPLES_PER_RING);\r
#else
return PI/float(NUM_SAMPLES_PER_RING);\r
#endif\r
}\r
void main(void) {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize mediump float radius\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp vec4 stroke_color\r
#pragma mapbox: initialize mediump float stroke_width\r
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\r
vec4 world_center;\r
mat3 surface_vectors;\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;\r
surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);\r
vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];\r
vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);\r
vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;\r
vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;\r
vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
world_center=vec4(pos,1);\r
#else \r
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);\r
world_center=vec4(circle_center,height,1);\r
#endif\r
#ifdef ELEVATED_ROADS\r
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;\r
#endif\r
vec4 projected_center=u_matrix*world_center;\r
float view_scale=0.0;\r
#ifdef PITCH_WITH_MAP\r
#ifdef SCALE_WITH_MAP\r
view_scale=1.0;\r
#else
view_scale=projected_center.w/u_camera_to_center_distance;\r
#endif\r
#else\r
#ifdef SCALE_WITH_MAP\r
view_scale=u_camera_to_center_distance;\r
#else\r
view_scale=projected_center.w;\r
#endif\r
#endif\r
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);\r
float visibility=0.0;\r
#ifdef TERRAIN\r
float step=get_sample_step();\r
vec4 occlusion_world_center;\r
vec4 occlusion_projected_center;\r
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);\r
occlusion_world_center=vec4(circle_center,cantilevered_height,1);\r
occlusion_projected_center=u_matrix*occlusion_world_center;\r
#else\r
occlusion_world_center=world_center;\r
occlusion_projected_center=projected_center;\r
#endif\r
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {\r
float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);\r
for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {\r
vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;\r
vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);\r
visibility+=float(!isOccluded(frag_pos));\r
}\r
}\r
visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\r
#else\r
visibility=1.0;\r
#endif
#ifdef PROJECTION_GLOBE_VIEW\r
visibility=1.0;\r
#endif\r
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);\r
v_data=vec3(extrude.x,extrude.y,antialiasblur);\r
#ifdef FOG\r
v_fog_pos=fog_position(world_center.xyz);\r
#endif\r
}`),clippingMask:kr(`void main() {\r
glFragColor=vec4(1.0);\r
}`,`in vec2 a_pos;\r
uniform mat4 u_matrix;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
}`),heatmap:kr(`#include "_prelude_fog.fragment.glsl"\r
uniform highp float u_intensity;\r
in vec2 v_extrude;\r
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327\r
void main() {\r
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);\r
float val=weight*u_intensity*GAUSS_COEF*exp(d);\r
glFragColor=vec4(val,1.0,1.0,1.0);\r
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\r
}\r
#endif\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform float u_extrude_scale;\r
uniform float u_opacity;\r
uniform float u_intensity;\r
in vec2 a_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
#endif\r
out vec2 v_extrude;\r
#pragma mapbox: define highp float weight\r
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327\r
void main(void) {\r
#pragma mapbox: initialize highp float weight\r
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\r
vec3 pos;\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;\r
mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);\r
vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];\r
vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);\r
vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;\r
vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;\r
pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
#else\r
pos=vec3(tilePos+extrude,elevation(tilePos));\r
#endif\r
gl_Position=u_matrix*vec4(pos,1);\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
}`),heatmapTexture:kr(`uniform sampler2D u_image;\r
uniform sampler2D u_color_ramp;\r
uniform float u_opacity;\r
in vec2 v_pos;\r
void main() {\r
float t=texture(u_image,v_pos).r;\r
vec4 color=texture(u_color_ramp,vec2(t,0.5));\r
glFragColor=color*u_opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(0.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`in vec2 a_pos;\r
out vec2 v_pos;\r
void main() {\r
gl_Position=vec4(a_pos,0,1);\r
v_pos=a_pos*0.5+0.5;\r
}`),collisionBox:kr(`in float v_placed;\r
in float v_notUsed;\r
void main() {\r
vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;\r
glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in vec3 a_pos;\r
in vec2 a_anchor_pos;\r
in vec2 a_extrude;\r
in vec2 a_placed;\r
in vec2 a_shift;\r
in vec2 a_elevation_from_sea;\r
in float a_size_scale;\r
in vec2 a_padding;\r
in float a_auto_z_offset;\r
uniform mat4 u_matrix;\r
uniform vec2 u_extrude_scale;\r
uniform float u_camera_to_center_distance;\r
out float v_placed;\r
out float v_notUsed;\r
void main() {\r
float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;\r
float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));\r
vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);\r
highp float camera_to_anchor_distance=projectedPoint.w;\r
highp float collision_perspective_ratio=clamp(\r
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);\r
gl_Position=projectedPoint;\r
gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;\r
v_placed=a_placed.x;\r
v_notUsed=a_placed.y;\r
}`),collisionCircle:kr(`in float v_radius;\r
in vec2 v_extrude;\r
in float v_perspective_ratio;\r
in float v_collision;\r
void main() {\r
float alpha=0.5*min(v_perspective_ratio,1.0);\r
float stroke_radius=0.9*max(v_perspective_ratio,1.0);\r
float distance_to_center=length(v_extrude);\r
float distance_to_edge=abs(distance_to_center-v_radius);\r
float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);\r
vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);\r
glFragColor=color*alpha*opacity_t;\r
}`,`in vec2 a_pos_2f;\r
in float a_radius;\r
in vec2 a_flags;\r
uniform mat4 u_matrix;\r
uniform mat4 u_inv_matrix;\r
uniform vec2 u_viewport_size;\r
uniform float u_camera_to_center_distance;\r
out float v_radius;\r
out vec2 v_extrude;\r
out float v_perspective_ratio;\r
out float v_collision;\r
vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);\r
vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);\r
rayStart.xyz/=rayStart.w;\r
rayEnd.xyz  /=rayEnd.w;\r
highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);\r
return mix(rayStart.xyz,rayEnd.xyz,t);\r
}\r
void main() {\r
vec2 quadCenterPos=a_pos_2f;\r
float radius=a_radius;\r
float collision=a_flags.x;\r
float vertexIdx=a_flags.y;\r
vec2 quadVertexOffset=vec2(\r
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));\r
vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);\r
vec4 clipPos=u_matrix*vec4(tilePos,1.0);\r
highp float camera_to_anchor_distance=clipPos.w;\r
highp float collision_perspective_ratio=clamp(\r
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;\r
v_radius=radius;\r
v_extrude=quadVertexExtent*padding_factor;\r
v_perspective_ratio=collision_perspective_ratio;\r
v_collision=collision;\r
gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);\r
}`),debug:kr(`uniform highp vec4 u_color;\r
uniform sampler2D u_overlay;\r
in vec2 v_uv;\r
void main() {\r
vec4 overlay_color=texture(u_overlay,v_uv);\r
glFragColor=mix(u_color,overlay_color,overlay_color.a);\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in vec2 a_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;\r
#endif\r
out vec2 v_uv;\r
uniform mat4 u_matrix;\r
uniform float u_overlay_scale;\r
void main() {float h=elevation(a_pos);\r
v_uv=a_pos/8192.0;\r
#ifdef PROJECTION_GLOBE_VIEW\r
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\r
#else\r
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\r
#endif\r
}`),elevatedStructuresDepth:kr(`void main() {\r
#ifndef DEPTH_TEXTURE\r
glFragColor=vec4(0.);\r
#endif\r
}`,`in vec2 a_pos;\r
in float a_height;\r
uniform mat4 u_matrix;\r
uniform float u_depth_bias;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,a_height,1);\r
gl_Position.z=gl_Position.z+u_depth_bias;\r
}`),elevatedStructuresDepthReconstruct:kr(`#ifdef DEPTH_RECONSTRUCTION\r
in float v_height;\r
#endif\r
void main() {\r
#ifdef DEPTH_RECONSTRUCTION\r
if (v_height >=0.0)\r
discard;\r
#endif\r
glFragColor=vec4(1.0,0.0,0.0,1.0);\r
}`,`in vec2 a_pos;\r
in float a_height;\r
uniform mat4 u_matrix;\r
uniform vec3 u_camera_pos;\r
uniform highp float u_depth_bias;\r
uniform lowp float u_height_scale;\r
uniform lowp float u_reset_depth;\r
#ifdef DEPTH_RECONSTRUCTION\r
out float v_height;\r
#endif\r
void main() {\r
vec3 vpos=vec3(a_pos,a_height*u_height_scale);\r
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {\r
vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));\r
}\r
v_height=a_height;\r
#endif\r
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;\r
}`),elevatedStructures:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
in vec3 v_normal;\r
in float v_height;\r
#ifdef RENDER_SHADOWS\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in float v_depth;\r
#endif\r
void main() {\r
vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);\r
#ifdef LIGHTING_3D_MODE\r
vec3 normal=normalize(v_normal);\r
#ifdef RENDER_SHADOWS\r
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\r
#else
color=apply_lighting(color,normal);\r
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);\r
float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);\r
color=color*(1.0-pow(occlusion,2.0)*0.3);\r
}\r
#endif
#ifdef FOG\r
color=fog_apply(color,v_fog_pos);\r
#endif\r
vec4 out_color=vec4(color,1.0);\r
#ifdef INDICATOR_CUTOUT\r
out_color=applyCutout(out_color,v_height);\r
#endif\r
glFragColor=out_color;\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec2 a_pos;\r
in float a_height;\r
in vec3 a_pos_normal_3;\r
uniform mat4 u_matrix;\r
out vec3 v_normal;\r
out float v_height;\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out float v_depth;\r
#endif\r
void main() {\r
v_normal=a_pos_normal_3/16384.0;\r
v_height=a_height;\r
vec3 pos=vec3(a_pos,a_height);\r
gl_Position=u_matrix*vec4(pos,1);\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=pos;\r
vec3 shd_pos1=pos;\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(v_normal);\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fill:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float opacity\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float opacity\r
vec4 out_color=color;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
out_color*=opacity;\r
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {\r
out_color=applyCutout(out_color,v_z_offset);\r
}\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif\r
uniform mat4 u_matrix;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp float z_offset\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=z_offset;\r
#endif\r
}`),fillOutline:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
in highp vec2 v_pos;\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
#pragma mapbox: define highp vec4 outline_color\r
#pragma mapbox: define lowp float opacity\r
void main() {\r
#pragma mapbox: initialize highp vec4 outline_color\r
#pragma mapbox: initialize lowp float opacity\r
float dist=length(v_pos-gl_FragCoord.xy);\r
float alpha=1.0-smoothstep(0.0,1.0,dist);\r
vec4 out_color=outline_color;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*(alpha*opacity);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
uniform mat4 u_matrix;\r
uniform vec2 u_world;\r
out highp vec2 v_pos;\r
#pragma mapbox: define highp vec4 outline_color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize highp vec4 outline_color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp float z_offset\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fillOutlinePattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform vec2 u_texsize;\r
uniform sampler2D u_image;\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
in highp vec2 v_pos;\r
in highp vec2 v_pos_world;\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r
highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);\r
float alpha=1.0-smoothstep(0.0,1.0,dist);\r
vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*(alpha*opacity);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_world;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform float u_tile_units_to_pixels;\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
out highp vec2 v_pos;\r
out highp vec2 v_pos_world;\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
#pragma mapbox: define lowp float pixel_ratio\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize lowp float pixel_ratio\r
#pragma mapbox: initialize highp float z_offset\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\r
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fillPattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform vec2 u_texsize;\r
uniform sampler2D u_image;\r
in highp vec2 v_pos;\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r
highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);\r
vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform float u_tile_units_to_pixels;\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
out highp vec2 v_pos;\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
#pragma mapbox: define lowp float pixel_ratio\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize lowp float pixel_ratio\r
#pragma mapbox: initialize highp float z_offset\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fillExtrusion:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
in vec4 v_color;\r
in vec4 v_flat;\r
#ifdef RENDER_SHADOWS\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
#endif\r
uniform lowp float u_opacity;\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
in vec2 v_ao;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r
in vec4 v_roof_color;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
in highp vec3 v_normal;\r
#endif\r
uniform vec3 u_flood_light_color;\r
uniform highp float u_vertical_scale;\r
uniform float u_flood_light_intensity;\r
uniform vec3 u_ground_shadow_factor;\r
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\r
in float v_flood_radius;\r
in float v_has_floodlight;\r
#endif\r
in float v_height;\r
#pragma mapbox: define highp float emissive_strength\r
void main() {\r
#pragma mapbox: initialize highp float emissive_strength\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
vec3 normal=normalize(v_normal);\r
#endif\r
float z;\r
vec4 color=v_color;\r
#ifdef ZERO_ROOF_RADIUS\r
z=float(normal.z > 0.00001);\r
#ifdef LIGHTING_3D_MODE\r
normal=mix(normal,vec3(0.0,0.0,1.0),z);\r
#else
color=mix(v_color,v_roof_color,z);\r
#endif
#endif
float h=max(0.0,v_height);\r
float ao_shade=1.0;\r
#ifdef FAUX_AO\r
float intensity=u_ao[0];\r
float h_floors=h/(u_ao[1]*u_vertical_scale);\r
float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);\r
ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\r
#ifdef ZERO_ROOF_RADIUS\r
concave*=(1.0-z);\r
#endif\r
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);\r
ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\r
#ifdef LIGHTING_3D_MODE\r
#ifdef FLOOD_LIGHT\r
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;\r
#endif
#else
color.rgb*=ao_shade;\r
#endif
#endif
#ifdef LIGHTING_3D_MODE\r
float flood_radiance=0.0;\r
#ifdef FLOOD_LIGHT\r
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\r
#endif
#ifdef RENDER_SHADOWS\r
#ifdef FLOOD_LIGHT\r
float ndotl_unclamped=dot(normal,u_shadow_direction);\r
float ndotl=max(0.0,ndotl_unclamped);\r
float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);\r
vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);\r
color.rgb=mix(litColor,floodLitColor,flood_radiance);\r
#else
float shadowed_lighting_factor;\r
#ifdef RENDER_CUTOFF\r
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);\r
if (v_cutoff_opacity==0.0) {\r
discard;\r
}\r
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\r
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\r
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);\r
#ifdef FLOOD_LIGHT\r
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\r
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);\r
color*=u_opacity;\r
#endif
#ifdef FOG\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
color=applyCutout(color,h);\r
#endif\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform mat4 u_matrix;\r
uniform vec3 u_lightcolor;\r
uniform lowp vec3 u_lightpos;\r
uniform lowp float u_lightintensity;\r
uniform float u_vertical_gradient;\r
uniform lowp float u_opacity;\r
uniform float u_edge_radius;\r
uniform float u_width_scale;\r
in vec4 a_pos_normal_ed;\r
in vec2 a_centroid_pos;\r
#ifdef RENDER_WALL_MODE\r
in vec3 a_join_normal_inside;\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
uniform float u_height_lift;\r
#endif\r
#ifdef TERRAIN\r
uniform int u_height_type;\r
uniform int u_base_type;\r
#endif\r
uniform highp float u_vertical_scale;\r
out vec4 v_color;\r
out vec4 v_flat;\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r
out vec4 v_roof_color;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
out highp vec3 v_normal;\r
#endif\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
out vec2 v_ao;\r
#endif\r
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\r
out float v_flood_radius;\r
out float v_has_floodlight;\r
#endif\r
out float v_height;vec3 linearTosRGB(vec3 color) {\r
return pow(color,vec3(1./2.2));\r
}\r
vec3 sRGBToLinear(vec3 srgbIn) {\r
return pow(srgbIn,vec3(2.2));\r
}\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define highp float flood_light_wall_radius\r
#pragma mapbox: define highp float line_width\r
#pragma mapbox: define highp float emissive_strength\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize highp float flood_light_wall_radius\r
#pragma mapbox: initialize highp float line_width\r
#pragma mapbox: initialize highp float emissive_strength\r
base*=u_vertical_scale;\r
height*=u_vertical_scale;\r
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;\r
vec3 top_up_ny=top_up_ny_start.xyz;\r
float x_normal=pos_nx.z/8192.0;\r
vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
v_normal=normal;\r
#endif\r
base=max(0.0,base);\r
float attr_height=height;\r
height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);\r
float t=top_up_ny.x;\r
vec2 centroid_pos=vec2(0.0);\r
#if defined(HAS_CENTROID) || defined(TERRAIN)\r
centroid_pos=a_centroid_pos;\r
#endif\r
float ele=0.0;\r
float h=0.0;\r
float c_ele=0.0;\r
vec3 pos;\r
#ifdef TERRAIN\r
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;\r
bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;\r
ele=elevation(pos_nx.xy);\r
c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;\r
float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;\r
float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);\r
h=t > 0.0 ? max(h_base,h_height) : h_base;\r
pos=vec3(pos_nx.xy,h);\r
#else\r
h=t > 0.0 ? height : base;\r
pos=vec3(pos_nx.xy,h);\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;\r
h+=lift;\r
vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));\r
vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;\r
pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
#endif\r
float cutoff=1.0;\r
vec3 scaled_pos=pos;\r
#ifdef RENDER_CUTOFF\r
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);\r
vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);\r
vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);\r
cutoff=cutoff_opacity(u_cutoff_params,ground.z);\r
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {\r
vec3 g=floor(ground_pos);\r
vec3 mod_=centroid_random-g*8.0;\r
float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));\r
if (cutoff < 0.8-seed) {\r
cutoff=0.0;\r
}\r
}\r
float cutoff_scale=cutoff;\r
v_cutoff_opacity=cutoff;\r
scaled_pos.z=mix(c_ele,h,cutoff_scale);\r
#endif\r
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\r
#ifdef RENDER_WALL_MODE\r
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);\r
scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;\r
scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\r
#endif\r
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);\r
h=h-ele;\r
v_height=h;\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=pos;\r
vec3 shd_pos1=pos;\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(normal);\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
#endif\r
float NdotL=0.0;\r
float colorvalue=0.0;\r
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);\r
color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {\r
float r=0.84;\r
r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\r
(1.0-u_vertical_gradient)+
(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));\r
}\r
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;\r
float start=top_up_ny_start.w;\r
float y_ground=1.0-clamp(t+base,0.0,1.0);\r
float top_height=height;\r
#ifdef TERRAIN\r
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;\r
y_ground+=y_ground*5.0/max(3.0,top_height);\r
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);\r
NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW\r
top_height+=u_height_lift;\r
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\r
#endif
#ifdef LIGHTING_3D_MODE\r
#ifdef FLOOD_LIGHT\r
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);\r
v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);\r
v_flood_radius=flood_light_wall_radius*u_vertical_scale;\r
#endif
v_color=vec4(color.rgb,1.0);\r
float ndotl=calculate_NdotL(normal);\r
v_flat.rgb=sRGBToLinear(color.rgb);\r
v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);\r
v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\r
#else
v_color=vec4(0.0,0.0,0.0,1.0);\r
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r
v_color*=u_opacity;\r
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);\r
roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);\r
v_roof_color=vec4(0.0,0.0,0.0,1.0);\r
v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r
v_roof_color*=u_opacity;\r
#endif
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
}`),fillExtrusionDepth:kr(`in highp float v_depth;\r
void main() {\r
#ifndef DEPTH_TEXTURE\r
glFragColor=pack_depth(v_depth);\r
#endif\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform float u_edge_radius;\r
uniform float u_width_scale;\r
uniform float u_vertical_scale;\r
#ifdef TERRAIN\r
uniform int u_height_type;\r
uniform int u_base_type;\r
#endif\r
in vec4 a_pos_normal_ed;\r
in vec2 a_centroid_pos;\r
#ifdef RENDER_WALL_MODE\r
in vec3 a_join_normal_inside;\r
#endif\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define highp float line_width\r
#pragma mapbox: define highp vec4 color\r
out highp float v_depth;\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize highp float line_width\r
#pragma mapbox: initialize highp vec4 color\r
base*=u_vertical_scale;\r
height*=u_vertical_scale;\r
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;\r
base=max(0.0,base);\r
height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);\r
float t=top_up_ny.x;\r
vec2 centroid_pos=vec2(0.0);\r
#if defined(HAS_CENTROID) || defined(TERRAIN)\r
centroid_pos=a_centroid_pos;\r
#endif\r
vec3 pos;\r
#ifdef TERRAIN\r
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;\r
bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;\r
float ele=elevation(pos_nx.xy);\r
float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;\r
float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;\r
float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);\r
float h=t > 0.0 ? max(h_base,h_height) : h_base;\r
pos=vec3(pos_nx.xy,h);\r
#else\r
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\r
#endif\r
#ifdef RENDER_WALL_MODE\r
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);\r
pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;\r
pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\r
#endif\r
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));\r
gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\r
v_depth=gl_Position.z/gl_Position.w;\r
}`),fillExtrusionPattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform vec2 u_texsize;\r
uniform sampler2D u_image;\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
in vec3 v_ao;\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
in vec3 v_normal;\r
#endif\r
in highp vec2 v_pos;\r
in vec4 v_lighting;\r
uniform lowp float u_opacity;\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define highp float pixel_ratio\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize highp float pixel_ratio\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r
highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);\r
vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\r
#else\r
out_color=out_color*v_lighting;\r
#endif\r
#ifdef FAUX_AO\r
float intensity=u_ao[0];\r
float h=max(0.0,v_ao.z);\r
float h_floors=h/u_ao[1];\r
float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);\r
float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\r
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);\r
shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\r
out_color.rgb=out_color.rgb*shade;\r
#endif\r
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform float u_height_factor;\r
uniform float u_tile_units_to_pixels;\r
uniform float u_vertical_gradient;\r
uniform lowp float u_opacity;\r
uniform float u_width_scale;\r
uniform vec3 u_lightcolor;\r
uniform lowp vec3 u_lightpos;\r
uniform lowp float u_lightintensity;\r
in vec4 a_pos_normal_ed;\r
in vec2 a_centroid_pos;\r
#ifdef RENDER_WALL_MODE\r
in vec3 a_join_normal_inside;\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
uniform float u_height_lift;\r
#endif\r
#ifdef TERRAIN\r
uniform int u_height_type;\r
uniform int u_base_type;\r
#endif\r
out highp vec2 v_pos;\r
out vec4 v_lighting;\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
out vec3 v_ao;\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
out vec3 v_normal;\r
#endif\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define highp float pixel_ratio\r
#pragma mapbox: define highp float line_width\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize highp float pixel_ratio\r
#pragma mapbox: initialize highp float line_width\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;\r
mediump vec3 top_up_ny=top_up_ny_start.xyz;\r
float x_normal=pos_nx.z/8192.0;\r
vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\r
float edgedistance=a_pos_normal_ed.w;\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
base=max(0.0,base);\r
height=max(0.0,height);\r
float t=top_up_ny.x;\r
float z=t > 0.0 ? height : base;\r
vec2 centroid_pos=vec2(0.0);\r
#if defined(HAS_CENTROID) || defined(TERRAIN)\r
centroid_pos=a_centroid_pos;\r
#endif\r
float ele=0.0;\r
float h=z;\r
vec3 p;\r
float c_ele;\r
#ifdef TERRAIN\r
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;\r
bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;\r
ele=elevation(pos_nx.xy);\r
c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;\r
float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;\r
float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);\r
h=t > 0.0 ? max(h_base,h_height) : h_base;\r
p=vec3(pos_nx.xy,h);\r
#else\r
p=vec3(pos_nx.xy,z);\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;\r
h+=lift;\r
vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));\r
vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;\r
p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
#endif\r
#ifdef RENDER_WALL_MODE\r
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);\r
p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;\r
p.xy-=a_join_normal_inside.z*wall_offset*0.5;\r
#endif\r
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));\r
gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);\r
vec2 pos=normal.z==1.0\r
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);\r
v_lighting=vec4(0.0,0.0,0.0,1.0);\r
float NdotL=0.0;\r
#ifdef LIGHTING_3D_MODE\r
NdotL=calculate_NdotL(normal);\r
#else\r
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);\r
NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\r
#endif\r
if (normal.y !=0.0) {\r
float r=0.84;\r
#ifndef LIGHTING_3D_MODE\r
r=mix(0.7,0.98,1.0-u_lightintensity);\r
#endif
NdotL*=(\r
(1.0-u_vertical_gradient)+
(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));\r
}\r
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;\r
float start=top_up_ny_start.w;\r
float y_ground=1.0-clamp(t+base,0.0,1.0);\r
float top_height=height;\r
#ifdef TERRAIN\r
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;\r
y_ground+=y_ground*5.0/max(3.0,top_height);\r
#endif\r
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);\r
NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW\r
top_height+=u_height_lift;\r
#endif\r
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
v_normal=normal;\r
#else\r
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r
v_lighting*=u_opacity;\r
#endif \r
#ifdef FOG\r
v_fog_pos=fog_position(p);\r
#endif\r
}`),groundShadow:kr(`#include "_prelude_shadow.fragment.glsl"\r
precision highp float;\r
uniform vec3 u_ground_shadow_factor;\r
in vec4 v_pos_light_view_0;\r
in vec4 v_pos_light_view_1;\r
#ifdef FOG\r
in float v_fog_opacity;\r
#endif\r
void main() {\r
float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\r
vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#ifdef RENDER_CUTOFF\r
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\r
#endif\r
#ifdef FOG\r
shadow=mix(shadow,vec3(1.0),v_fog_opacity);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\r
#endif\r
glFragColor=vec4(shadow,1.0);\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
in vec2 a_pos;\r
out vec4 v_pos_light_view_0;\r
out vec4 v_pos_light_view_1;\r
#ifdef FOG\r
out float v_fog_opacity;\r
#endif\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0.0,1.0);\r
v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);\r
v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
v_fog_opacity=fog(v_fog_pos);\r
#endif\r
}`),fillExtrusionGroundEffect:kr(`uniform highp float u_ao_pass;\r
uniform highp float u_opacity;\r
uniform highp float u_flood_light_intensity;\r
uniform highp vec3 u_flood_light_color;\r
uniform highp float u_attenuation;\r
uniform sampler2D u_fb;\r
uniform float u_fb_size;\r
#ifdef SDF_SUBPASS\r
in highp vec2 v_pos;\r
in highp vec4 v_line_segment;\r
in highp float v_flood_light_radius_tile;\r
in highp vec2 v_ao;\r
float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {\r
highp vec2 ba=b-a;\r
highp vec2 pa=p-a;\r
highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);\r
return length(pa-r*ba);\r
}\r
#ifdef FOG\r
in highp float v_fog;\r
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS\r
vec4 color=vec4(1.0);\r
#ifdef CLEAR_FROM_TEXTURE\r
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\r
#endif
glFragColor=color;\r
#else
#ifdef SDF_SUBPASS\r
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);\r
highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);\r
d/=effect_radius;\r
d=min(d,1.0);\r
d=1.0-pow(1.0-d,u_attenuation);\r
highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);\r
highp float fog=1.0;\r
#ifdef FOG\r
fog=v_fog;\r
#endif
#ifdef RENDER_CUTOFF\r
fog*=v_cutoff_opacity;\r
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\r
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\r
#ifdef OVERDRAW_INSPECTOR\r
color=vec4(1.0);\r
#endif\r
glFragColor=color;\r
#endif
HANDLE_WIREFRAME_DEBUG;\r
#endif
}`,`#include "_prelude_fog.vertex.glsl"\r
in highp vec4 a_pos_end;\r
in highp float a_angular_offset_factor;\r
in highp float a_hidden_by_landmark;\r
#ifdef SDF_SUBPASS\r
out highp vec2 v_pos;\r
out highp vec4 v_line_segment;\r
out highp float v_flood_light_radius_tile;\r
out highp vec2 v_ao;\r
#ifdef FOG\r
out highp float v_fog;\r
#endif\r
#endif\r
uniform highp float u_flood_light_intensity;\r
uniform highp mat4 u_matrix;\r
uniform highp float u_ao_pass;\r
uniform highp float u_meter_to_tile;\r
uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;\r
uniform highp vec2 u_ao;\r
#pragma mapbox: define highp float flood_light_ground_radius\r
const float TANGENT_CUTOFF=4.0;\r
const float NORM=32767.0;\r
void main() {\r
#pragma mapbox: initialize highp float flood_light_ground_radius\r
vec2 p=a_pos_end.xy;\r
vec2 q=floor(a_pos_end.zw*0.5);\r
vec2 start_bottom=a_pos_end.zw-q*2.0;\r
float fl_ground_radius=flood_light_ground_radius;\r
fl_ground_radius=abs(flood_light_ground_radius);\r
float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;\r
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;\r
vec2 v=normalize(q-p);\r
float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;\r
float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;\r
float angular_offset=direction*angular_offset_factor*effect_radius;\r
float top=1.0-start_bottom.y;\r
float side=(0.5-start_bottom.x)*2.0;\r
vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);\r
vec2 perp=vec2(v.y,-v.x);\r
vec2 extrusion_perp=direction*perp*effect_radius*top;\r
vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);\r
pos.xy+=extrusion_parallel+extrusion_perp;\r
#ifdef SDF_SUBPASS\r
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;\r
v_flood_light_radius_tile=flood_radius_tile;\r
v_ao=vec2(u_ao.x,ao_radius);\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
v_fog=1.0-fog(v_fog_pos);\r
#endif\r
#endif\r
float hidden_by_landmark=0.0;\r
#ifdef HAS_CENTROID\r
hidden_by_landmark=a_hidden_by_landmark;\r
#endif\r
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);\r
float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);\r
hidden+=hidden_by_landmark;\r
gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\r
#ifdef RENDER_CUTOFF\r
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\r
#endif\r
}`),hillshadePrepare:kr(`precision highp float;\r
uniform sampler2D u_image;\r
in vec2 v_pos;\r
uniform vec2 u_dimension;\r
uniform float u_zoom;\r
float getElevation(vec2 coord) {\r
return texture(u_image,coord).r/4.0;\r
}\r
void main() {\r
vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));\r
float b=getElevation(v_pos+vec2(0,-epsilon.y));\r
float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));\r
float d=getElevation(v_pos+vec2(-epsilon.x,0));\r
float e=getElevation(v_pos+vec2(epsilon.x,0));\r
float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));\r
float g=getElevation(v_pos+vec2(0,epsilon.y));\r
float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\r
float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;\r
vec2 deriv=vec2(\r
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\r
)/pow(2.0,exaggeration+(19.2562-u_zoom));\r
glFragColor=clamp(vec4(\r
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\r
}`,`uniform mat4 u_matrix;\r
uniform vec2 u_dimension;\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
out vec2 v_pos;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
highp vec2 epsilon=1.0/u_dimension;\r
float scale=(u_dimension.x-2.0)/u_dimension.x;\r
v_pos=(a_texture_pos/8192.0)*scale+epsilon;\r
}`),hillshade:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform sampler2D u_image;\r
in vec2 v_pos;\r
uniform vec2 u_latrange;\r
uniform vec2 u_light;\r
uniform vec4 u_shadow;\r
uniform vec4 u_highlight;\r
uniform vec4 u_accent;\r
uniform float u_emissive_strength;\r
void main() {\r
vec4 pixel=texture(u_image,v_pos);\r
vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);\r
float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);\r
float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;\r
float maxValue=0.5*PI;\r
float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);\r
float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);\r
vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);\r
glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\r
#ifdef LIGHTING_3D_MODE\r
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\r
#endif\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
out vec2 v_pos;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
v_pos=a_texture_pos/8192.0;\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),line:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform lowp float u_device_pixel_ratio;\r
uniform highp float u_width_scale;\r
uniform highp float u_floor_width_scale;\r
uniform float u_alpha_discard_threshold;\r
uniform highp vec2 u_trim_offset;\r
uniform highp vec2 u_trim_fade_range;\r
uniform lowp vec4 u_trim_color;\r
in vec2 v_width2;\r
in vec2 v_normal;\r
in float v_gamma_scale;\r
in highp vec3 v_uv;\r
#ifdef ELEVATED_ROADS\r
in highp float v_road_z_offset;\r
#endif\r
#ifdef RENDER_LINE_DASH\r
uniform sampler2D u_dash_image;\r
in vec2 v_tex;\r
#endif\r
#ifdef RENDER_LINE_GRADIENT\r
uniform sampler2D u_gradient_image;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;\r
}\r
uniform float u_emissive_strength;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float floorwidth\r
#pragma mapbox: define lowp vec4 dash\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp float border_width\r
#pragma mapbox: define lowp vec4 border_color\r
float linearstep(float edge0,float edge1,float x) {\r
return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);\r
}\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float floorwidth\r
#pragma mapbox: initialize lowp vec4 dash\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize lowp float border_width\r
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r
float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r
#ifdef RENDER_LINE_DASH\r
float sdfdist=texture(u_dash_image,v_tex).r;\r
float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;\r
float scaled_floorwidth=(floorwidth*u_floor_width_scale);\r
alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\r
#endif\r
highp vec4 out_color;\r
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);\r
#else\r
out_color=color;\r
#endif\r
float trim_alpha=1.0;\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
highp float trim_start=u_trim_offset[0];\r
highp float trim_end=u_trim_offset[1];\r
highp float line_progress=v_uv[2];if (trim_end > trim_start) {\r
highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));\r
highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));\r
highp float transition_factor=min(start_transition,end_transition);\r
out_color=mix(out_color,u_trim_color,transition_factor);\r
trim_alpha=1.0-transition_factor;\r
}\r
#endif\r
if (u_alpha_discard_threshold !=0.0) {\r
if (alpha < u_alpha_discard_threshold) {\r
discard;\r
}\r
}\r
#ifdef RENDER_LINE_BORDER\r
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);\r
float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);\r
if (alpha2 < 1.) {\r
float smoothAlpha=smoothstep(0.6,1.0,alpha2);\r
if (border_color.a==0.0) {\r
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;\r
if (out_color.a > 0.25 && Y < 0.25) {\r
vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;\r
out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));\r
} else {\r
out_color.rgb*=(0.6 +0.4*smoothAlpha);\r
}\r
} else {\r
out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);\r
}\r
}\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
#ifdef ELEVATED_ROADS\r
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\r
#else\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
out_color*=(alpha*opacity);\r
#ifdef INDICATOR_CUTOUT\r
out_color=applyCutout(out_color,v_z_offset);\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016\r
in vec2 a_pos_normal;\r
in vec4 a_data;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\r
in vec3 a_z_offset_width;\r
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\r
in highp vec3 a_packed;\r
#endif\r
#ifdef RENDER_LINE_DASH\r
in float a_linesofar;\r
#endif\r
uniform mat4 u_matrix;\r
uniform mat2 u_pixels_to_tile_units;\r
uniform vec2 u_units_to_pixels;\r
uniform lowp float u_device_pixel_ratio;\r
uniform float u_width_scale;\r
uniform highp float u_floor_width_scale;\r
#ifdef ELEVATED\r
uniform lowp float u_zbias_factor;\r
uniform lowp float u_tile_to_meter;\r
float sample_elevation(vec2 apos) {\r
#ifdef ELEVATION_REFERENCE_SEA\r
return 0.0;\r
#else\r
return elevation(apos);\r
#endif\r
}\r
#endif\r
out vec2 v_normal;\r
out vec2 v_width2;\r
out float v_gamma_scale;\r
out highp vec3 v_uv;\r
#ifdef ELEVATED_ROADS\r
out highp float v_road_z_offset;\r
#endif\r
#ifdef RENDER_LINE_DASH\r
uniform vec2 u_texsize;\r
uniform float u_tile_units_to_pixels;\r
out vec2 v_tex;\r
#endif\r
#ifdef RENDER_LINE_GRADIENT\r
uniform float u_image_height;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float floorwidth\r
#pragma mapbox: define lowp vec4 dash\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define mediump float gapwidth\r
#pragma mapbox: define lowp float offset\r
#pragma mapbox: define mediump float width\r
#pragma mapbox: define lowp float border_width\r
#pragma mapbox: define lowp vec4 border_color\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float floorwidth\r
#pragma mapbox: initialize lowp vec4 dash\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump float gapwidth\r
#pragma mapbox: initialize lowp float offset\r
#pragma mapbox: initialize mediump float width\r
#pragma mapbox: initialize lowp float border_width\r
#pragma mapbox: initialize lowp vec4 border_color\r
float a_z_offset;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS)\r
a_z_offset=a_z_offset_width.x;\r
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r
vec2 a_extrude=a_data.xy-128.0;\r
float a_direction=mod(a_data.z,4.0)-1.0;\r
vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r
normal.y=normal.y*2.0-1.0;\r
v_normal=normal;gapwidth=gapwidth/2.0;\r
float halfwidth;\r
#ifdef VARIABLE_LINE_WIDTH\r
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);\r
halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\r
#else\r
halfwidth=(u_width_scale*width)/2.0;\r
#endif\r
offset=-1.0*offset*u_width_scale;\r
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r
float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;\r
mediump float t=1.0-abs(u);\r
mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);\r
float hidden=float(opacity==0.0);\r
vec2 extrude=dist*u_pixels_to_tile_units;\r
vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);\r
vec2 projected_extrude_xy=projected_extrude.xy;\r
#ifdef ELEVATED_ROADS\r
v_road_z_offset=a_z_offset;\r
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\r
#else\r
#ifdef ELEVATED\r
vec2 offsetTile=offset2*u_pixels_to_tile_units;\r
vec2 offset_pos=pos+offsetTile;\r
float ele=0.0;\r
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);\r
float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;\r
ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\r
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,max(ele1,ele2));\r
ele=ele_max+a_z_offset;\r
#else
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,0.5*(ele1+ele2));\r
ele=ele_max-ele0+ele1+a_z_offset;\r
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;\r
float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);\r
float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);\r
gl_Position.z-=(gl_Position.w*zbias);\r
gl_Position=mix(gl_Position,AWAY,hidden);\r
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\r
#endif
#endif
#ifdef ELEVATED_ROADS\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);\r
vec3 shd_pos0=shd_pos;\r
vec3 shd_pos1=shd_pos;\r
#ifdef NORMAL_OFFSET\r
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#endif\r
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);\r
float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);\r
v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\r
#else\r
v_gamma_scale=1.0;\r
#endif\r
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\r
highp float a_uv_x=a_packed[0];\r
float a_split_index=a_packed[1];\r
highp float line_progress=a_packed[2];\r
#ifdef RENDER_LINE_GRADIENT\r
highp float texel_height=1.0/u_image_height;\r
highp float half_texel_height=0.5*texel_height;\r
v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\r
#else\r
v_uv=vec3(a_uv_x,0.0,line_progress);\r
#endif\r
#endif\r
#ifdef RENDER_LINE_DASH\r
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;\r
float height=dash.y;\r
v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\r
#endif\r
v_width2=vec2(outset,inset);\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=a_z_offset;\r
#endif\r
}`),linePattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform highp float u_device_pixel_ratio;\r
uniform highp float u_width_scale;\r
uniform highp float u_alpha_discard_threshold;\r
uniform highp vec2 u_texsize;\r
uniform highp float u_tile_units_to_pixels;\r
uniform highp vec2 u_trim_offset;\r
uniform highp vec2 u_trim_fade_range;\r
uniform lowp vec4 u_trim_color;\r
uniform sampler2D u_image;\r
in vec2 v_normal;\r
in vec2 v_width2;\r
in highp float v_linesofar;\r
in float v_gamma_scale;\r
in float v_width;\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
in highp vec3 v_uv;\r
#endif\r
#ifdef ELEVATED_ROADS\r
in highp float v_road_z_offset;\r
#endif\r
#ifdef LINE_JOIN_NONE\r
in vec2 v_pattern_data;
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
uniform float u_emissive_strength;\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define mediump float pixel_ratio\r
#pragma mapbox: define mediump float blur\r
#pragma mapbox: define mediump float opacity\r
void main() {\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize mediump float pixel_ratio\r
#pragma mapbox: initialize mediump float blur\r
#pragma mapbox: initialize mediump float opacity\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
highp float pattern_size=display_size.x/u_tile_units_to_pixels;\r
float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r
float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r
highp float pattern_x=v_linesofar/pattern_size*aspect;\r
highp float x=mod(pattern_x,1.0);\r
highp float y=0.5*v_normal.y+0.5;\r
vec2 texel_size=1.0/u_texsize;\r
highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));\r
highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));\r
vec4 color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
highp float trim_start=u_trim_offset[0];\r
highp float trim_end=u_trim_offset[1];\r
highp float line_progress=v_uv[2];if (trim_end > trim_start) {\r
highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));\r
highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));\r
highp float transition_factor=min(start_transition,end_transition);\r
color=mix(color,color.a*u_trim_color,transition_factor);\r
}\r
#endif\r
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;\r
highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;\r
highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;\r
visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;\r
if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {\r
color=vec4(0.0);\r
}\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
color=apply_lighting_with_emission_ground(color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
#ifdef ELEVATED_ROADS\r
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\r
#else\r
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#endif\r
#ifdef FOG\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r
#endif\r
color*=(alpha*opacity);\r
if (u_alpha_discard_threshold !=0.0) {\r
if (color.a < u_alpha_discard_threshold) {\r
discard;\r
}\r
}\r
#ifdef INDICATOR_CUTOUT\r
color=applyCutout(color,v_z_offset);\r
#endif\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016\r
in vec2 a_pos_normal;\r
in vec4 a_data;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS)\r
in vec3 a_z_offset_width;\r
#endif
#ifdef RENDER_LINE_TRIM_OFFSET\r
in highp vec3 a_packed;\r
#endif\r
in highp float a_linesofar;\r
#ifdef LINE_JOIN_NONE\r
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif\r
uniform mat4 u_matrix;\r
uniform float u_tile_units_to_pixels;\r
uniform vec2 u_units_to_pixels;\r
uniform mat2 u_pixels_to_tile_units;\r
uniform float u_device_pixel_ratio;\r
uniform float u_width_scale;\r
uniform float u_floor_width_scale;\r
#ifdef ELEVATED\r
uniform lowp float u_zbias_factor;\r
uniform lowp float u_tile_to_meter;\r
float sample_elevation(vec2 apos) {\r
#ifdef ELEVATION_REFERENCE_SEA\r
return 0.0;\r
#else\r
return elevation(apos);\r
#endif\r
}\r
#endif\r
out vec2 v_normal;\r
out vec2 v_width2;\r
out highp float v_linesofar;\r
out float v_gamma_scale;\r
out float v_width;\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
out highp vec3 v_uv;\r
#endif\r
#ifdef ELEVATED_ROADS\r
out highp float v_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
#pragma mapbox: define mediump float blur\r
#pragma mapbox: define mediump float opacity\r
#pragma mapbox: define mediump float offset\r
#pragma mapbox: define mediump float gapwidth\r
#pragma mapbox: define mediump float width\r
#pragma mapbox: define mediump float floorwidth\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define mediump float pixel_ratio\r
void main() {\r
#pragma mapbox: initialize mediump float blur\r
#pragma mapbox: initialize mediump float opacity\r
#pragma mapbox: initialize mediump float offset\r
#pragma mapbox: initialize mediump float gapwidth\r
#pragma mapbox: initialize mediump float width\r
#pragma mapbox: initialize mediump float floorwidth\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize mediump float pixel_ratio\r
float a_z_offset;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS)\r
a_z_offset=a_z_offset_width.x;\r
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r
vec2 a_extrude=a_data.xy-128.0;\r
float a_direction=mod(a_data.z,4.0)-1.0;\r
vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;\r
normal.y=normal.y*2.0-1.0;\r
v_normal=normal;gapwidth=gapwidth/2.0;\r
float halfwidth=(u_width_scale*width)/2.0;\r
offset=-1.0*offset*u_width_scale;\r
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r
float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;\r
float t=1.0-abs(u);\r
vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r
float hidden=float(opacity==0.0);\r
vec2 extrude=dist*u_pixels_to_tile_units;\r
vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);\r
vec2 projected_extrude_xy=projected_extrude.xy;\r
#ifdef ELEVATED_ROADS\r
v_road_z_offset=a_z_offset;\r
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\r
#else\r
#ifdef ELEVATED\r
vec2 offsetTile=offset2*u_pixels_to_tile_units;\r
vec2 offset_pos=pos+offsetTile;\r
float ele=0.0;\r
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);\r
float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;\r
ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\r
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,max(ele1,ele2));\r
ele=ele_max+a_z_offset;\r
#else
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,0.5*(ele1+ele2));\r
ele=ele_max-ele0+ele1+a_z_offset;\r
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;\r
float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);\r
float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);\r
gl_Position.z-=(gl_Position.w*zbias);\r
gl_Position=mix(gl_Position,AWAY,hidden);\r
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\r
#endif
#endif
#ifdef ELEVATED_ROADS\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);\r
vec3 shd_pos0=shd_pos;\r
vec3 shd_pos1=shd_pos;\r
#ifdef NORMAL_OFFSET\r
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#endif\r
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);\r
float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);\r
v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\r
#else\r
v_gamma_scale=1.0;\r
#endif\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
highp float a_uv_x=a_packed[0];\r
highp float line_progress=a_packed[2];\r
v_uv=vec3(a_uv_x,0.0,line_progress);\r
#endif\r
v_linesofar=a_linesofar;\r
v_width2=vec2(outset,inset);\r
v_width=(floorwidth*u_floor_width_scale);\r
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;\r
mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;\r
mediump float pixel_ratio_inverse=1.0/pixel_ratio;\r
mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;\r
highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;\r
float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;\r
v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;\r
v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=a_z_offset;\r
#endif\r
}`),raster:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_raster_array.glsl"\r
uniform float u_fade_t;\r
uniform float u_opacity;\r
uniform highp float u_raster_elevation;\r
uniform highp float u_zoom_transition;\r
in vec2 v_pos0;\r
in vec2 v_pos1;\r
in float v_depth;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in float v_split_fade;\r
#endif\r
uniform float u_brightness_low;\r
uniform float u_brightness_high;\r
uniform float u_saturation_factor;\r
uniform float u_contrast_factor;\r
uniform vec3 u_spin_weights;\r
uniform float u_emissive_strength;\r
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;\r
uniform sampler2D u_image1;\r
#endif\r
#ifdef RASTER_COLOR\r
uniform sampler2D u_color_ramp;\r
uniform highp vec4 u_colorization_mix;\r
uniform highp float u_colorization_offset;\r
uniform vec2 u_texture_res;\r
#endif\r
void main() {\r
vec4 color0,color1,color;\r
vec2 value;\r
#ifdef RASTER_COLOR\r
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR\r
value=mix(\r
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\r
);\r
#else\r
value=mix(\r
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\r
);\r
#endif
if (value.y > 0.0) value.x/=value.y;\r
#else\r
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);\r
value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\r
#endif\r
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;\r
color.a*=value.y;\r
#else
color0=texture(u_image0,v_pos0);\r
color1=texture(u_image1,v_pos1);\r
if (color0.a > 0.0) color0.rgb/=color0.a;\r
if (color1.a > 0.0) color1.rgb/=color1.a;\r
color=mix(color0,color1,u_fade_t);\r
#endif\r
color.a*=u_opacity;\r
#ifdef GLOBE_POLES\r
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\r
#endif\r
vec3 rgb=color.rgb;rgb=vec3(\r
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;\r
rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);\r
vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);\r
vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\r
#endif\r
#ifdef FOG\r
highp float fog_limit_high_meters=1000000.0;\r
highp float fog_limit_low_meters=600000.0;\r
float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);\r
out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\r
#endif\r
glFragColor=vec4(out_color*color.a,color.a);\r
#ifdef PROJECTION_GLOBE_VIEW\r
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\r
#endif\r
#ifdef RENDER_CUTOFF\r
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\r
#endif\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform mat4 u_normalize_matrix;\r
uniform mat4 u_globe_matrix;\r
uniform mat4 u_merc_matrix;\r
uniform mat3 u_grid_matrix;\r
uniform vec2 u_tl_parent;\r
uniform float u_scale_parent;\r
uniform vec2 u_perspective_transform;\r
uniform vec2 u_texture_offset;\r
uniform float u_raster_elevation;\r
uniform float u_zoom_transition;\r
uniform vec2 u_merc_center;\r
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\r
#ifdef GLOBE_POLES\r
in vec3 a_globe_pos;\r
in vec2 a_uv;\r
#else\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
#endif\r
out vec2 v_pos0;\r
out vec2 v_pos1;\r
out float v_depth;\r
#ifdef PROJECTION_GLOBE_VIEW\r
out float v_split_fade;\r
#endif\r
void main() {\r
vec2 uv;\r
#ifdef GLOBE_POLES\r
vec3 globe_pos=a_globe_pos;\r
globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;\r
gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);\r
uv=a_uv;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\r
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\r
#ifdef PROJECTION_GLOBE_VIEW\r
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);\r
vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);\r
vec3 globe_pos=latLngToECEF(latLng.xy);\r
globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;\r
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
vec4 merc_world_pos=vec4(0.0);\r
float mercatorY=mercatorYfromLat(latLng[0]);\r
float mercatorX=mercatorXfromLng(latLng[1]);    \r
v_split_fade=0.0;\r
if (u_zoom_transition > 0.0) {\r
vec2 merc_pos=vec2(mercatorX,mercatorY);\r
merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);\r
merc_world_pos.xy-=u_merc_center;\r
merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);\r
merc_world_pos=u_merc_matrix*merc_world_pos;\r
float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);\r
float dist_from_poles=(abs(mercatorY-0.5)*2.0);\r
float range=0.1;\r
v_split_fade=abs(opposite_merc_center-mercatorX);\r
v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);\r
v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));\r
}\r
float tiles=u_grid_matrix[0][2];\r
if (tiles > 0.0) {\r
float idx=u_grid_matrix[1][2];\r
float idy=u_grid_matrix[2][2];\r
float uvY=mercatorY*tiles-idy;\r
float uvX=mercatorX*tiles-idx;\r
uv=vec2(uvX,uvY);\r
}\r
vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);\r
gl_Position=u_matrix*interpolated_pos;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\r
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif
#endif
#endif
v_pos0=uv;\r
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;\r
v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\r
#ifdef RENDER_CUTOFF\r
v_depth=gl_Position.z;\r
#endif\r
}`),rasterParticle:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform float u_fade_t;\r
uniform float u_opacity;\r
uniform highp float u_raster_elevation;\r
in vec2 v_pos0;\r
in vec2 v_pos1;\r
uniform sampler2D u_image0;\r
uniform sampler2D u_image1;\r
void main() {\r
vec4 color0,color1,color;color0=texture(u_image0,v_pos0);\r
color1=texture(u_image1,v_pos1);\r
if (color0.a > 0.0) color0.rgb/=color0.a;\r
if (color1.a > 0.0) color1.rgb/=color1.a;\r
color=mix(color0,color1,u_fade_t);\r
color.a*=u_opacity;\r
vec3 out_color=color.rgb;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\r
#endif\r
#ifdef FOG\r
highp float fog_limit_high_meters=1000000.0;\r
highp float fog_limit_low_meters=600000.0;\r
float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);\r
out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\r
#endif\r
glFragColor=vec4(out_color*color.a,color.a);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform mat4 u_normalize_matrix;\r
uniform mat4 u_globe_matrix;\r
uniform mat4 u_merc_matrix;\r
uniform mat3 u_grid_matrix;\r
uniform vec2 u_tl_parent;\r
uniform float u_scale_parent;\r
uniform float u_raster_elevation;\r
uniform float u_zoom_transition;\r
uniform vec2 u_merc_center;\r
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
out vec2 v_pos0;\r
out vec2 v_pos1;\r
void main() {\r
float w=1.0;\r
vec2 uv;\r
#ifdef PROJECTION_GLOBE_VIEW\r
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);\r
vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);\r
float mercatorY=mercatorYfromLat(latLng[0]);\r
float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];\r
float idx=u_grid_matrix[1][2];\r
float idy=u_grid_matrix[2][2];\r
float uvX=mercatorX*tiles-idx;\r
float uvY=mercatorY*tiles-idy;\r
uv=vec2(uvX,uvY);\r
vec3 globe_pos=latLngToECEF(latLng.xy);\r
globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;\r
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
vec4 merc_world_pos=vec4(0.0);\r
if (u_zoom_transition > 0.0) {\r
vec2 merc_pos=vec2(mercatorX,mercatorY);\r
merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);\r
merc_world_pos.xy-=u_merc_center;\r
merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);\r
merc_world_pos=u_merc_matrix*merc_world_pos;\r
}\r
vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);\r
gl_Position=u_matrix*interpolated_pos;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\r
#endif
#else
uv=a_texture_pos/8192.0;\r
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif
#endif
v_pos0=uv;\r
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\r
}`),rasterParticleDraw:kr(`uniform sampler2D u_color_ramp;\r
in float v_particle_speed;\r
void main() {\r
glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));\r
}`,`#include "_prelude_raster_particle.glsl"\r
in float a_index;\r
uniform sampler2D u_particle_texture;\r
uniform float u_particle_texture_side_len;\r
uniform vec2 u_tile_offset;\r
out float v_particle_speed;\r
void main() {\r
ivec2 pixel_coord=ivec2(\r
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);\r
vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);\r
vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;\r
vec2 tex_coord=fract(pos);\r
vec2 velocity=lookup_velocity(tex_coord);\r
if (velocity==INVALID_VELOCITY) {\r
gl_Position=AWAY;\r
v_particle_speed=0.0;\r
} else {\r
gl_Position=vec4(2.0*pos-1.0,0,1);\r
v_particle_speed=length(velocity);\r
}\r
gl_PointSize=1.0;\r
}`),rasterParticleTexture:kr(`uniform sampler2D u_texture;\r
uniform float u_opacity;\r
in vec2 v_tex_pos;\r
void main() {\r
vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);\r
}`,`in vec2 a_pos;\r
out vec2 v_tex_pos;\r
void main() {\r
vec2 uv=0.5*a_pos+vec2(0.5);\r
v_tex_pos=uv;\r
gl_Position=vec4(a_pos,0.0,1.0);\r
}`),rasterParticleUpdate:kr(`#include "_prelude_raster_particle.glsl"\r
uniform sampler2D u_particle_texture;\r
uniform mediump float u_particle_texture_side_len;\r
uniform mediump float u_speed_factor;\r
uniform highp float u_reset_rate;\r
uniform highp float u_rand_seed;\r
in highp vec2 v_tex_coord;\r
vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {\r
return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));\r
}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);\r
highp float rand(const highp vec2 co) {\r
highp float t=dot(rand_constants.xy,co);\r
return fract(sin(t)*(rand_constants.z+t));\r
}\r
void main() {\r
ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);\r
highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);\r
highp vec2 pos=unpack_pos_from_rgba(pixel);\r
highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));\r
highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\r
pos=pos+dp;\r
highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;\r
highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\r
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*
linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\r
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;\r
highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));\r
highp vec2 next_pos=mix(pos,random_pos,drop);\r
glFragColor=pack_pos_to_rgba(next_pos);\r
}`,`in vec2 a_pos;\r
out vec2 v_tex_coord;\r
void main() {\r
v_tex_coord=0.5*(a_pos+vec2(1.0));\r
gl_Position=vec4(a_pos,0.0,1.0);\r
}`),symbol:kr(`#include "_prelude_lighting.glsl"\r
#define SDF_PX 8.0\r
#define SDF 1.0\r
#define ICON 0.0\r
uniform sampler2D u_texture;\r
uniform sampler2D u_texture_icon;\r
uniform highp float u_gamma_scale;\r
uniform lowp float u_device_pixel_ratio;\r
uniform bool u_is_text;\r
uniform bool u_is_halo;\r
uniform lowp float u_scale_factor;\r
#ifdef ICON_TRANSITION\r
uniform float u_icon_transition;\r
#endif\r
#ifdef COLOR_ADJUSTMENT\r
uniform mat4 u_color_adj_mat;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
in vec2 v_tex_a;\r
#ifdef ICON_TRANSITION\r
in vec2 v_tex_b;\r
#endif\r
in float v_draw_halo;\r
in vec3 v_gamma_scale_size_fade_opacity;\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
in float is_sdf;\r
in vec2 v_tex_a_icon;\r
#endif\r
#pragma mapbox: define highp vec4 fill_color\r
#pragma mapbox: define highp vec4 halo_color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp float halo_width\r
#pragma mapbox: define lowp float halo_blur\r
#pragma mapbox: define lowp float emissive_strength\r
void main() {\r
#pragma mapbox: initialize highp vec4 fill_color\r
#pragma mapbox: initialize highp vec4 halo_color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize lowp float halo_width\r
#pragma mapbox: initialize lowp float halo_blur\r
#pragma mapbox: initialize lowp float emissive_strength\r
vec4 out_color;\r
float fade_opacity=v_gamma_scale_size_fade_opacity[2];\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
if (is_sdf==ICON) {\r
vec2 tex_icon=v_tex_a_icon;\r
lowp float alpha=opacity*fade_opacity;\r
glFragColor=texture(u_texture_icon,tex_icon)*alpha;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
return;\r
}\r
#endif\r
#ifdef RENDER_SDF\r
float EDGE_GAMMA=0.105/u_device_pixel_ratio;\r
float gamma_scale=v_gamma_scale_size_fade_opacity.x;\r
float size=v_gamma_scale_size_fade_opacity.y;\r
float fontScale=u_is_text ? size/24.0 : size;\r
out_color=fill_color;\r
highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);\r
lowp float buff=(256.0-64.0)/256.0;\r
bool draw_halo=v_draw_halo > 0.0;\r
if (draw_halo) {\r
out_color=halo_color;\r
gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);\r
buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;\r
}\r
lowp float dist=texture(u_texture,v_tex_a).r;\r
highp float gamma_scaled=gamma*gamma_scale;\r
highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);\r
out_color*=alpha;\r
#else
#ifdef ICON_TRANSITION\r
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);\r
vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;\r
out_color=(a+b);\r
#else\r
out_color=texture(u_texture,v_tex_a);\r
#endif\r
#ifdef COLOR_ADJUSTMENT\r
out_color=u_color_adj_mat*out_color;\r
#endif\r
#endif\r
out_color*=opacity*fade_opacity;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out_color=applyCutout(out_color,v_z_offset);\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in vec4 a_pos_offset;\r
in vec4 a_tex_size;\r
in vec4 a_pixeloffset;\r
in vec4 a_projected_pos;\r
in float a_fade_opacity;\r
#ifdef Z_OFFSET\r
in float a_auto_z_offset;\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_globe_anchor;\r
in vec3 a_globe_normal;\r
#endif\r
#ifdef ICON_TRANSITION\r
in vec2 a_texb;\r
#endif\r
#ifdef OCCLUSION_QUERIES\r
in float a_occlusion_query_opacity;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif
uniform bool u_is_size_zoom_constant;\r
uniform bool u_is_size_feature_constant;\r
uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;\r
uniform mat4 u_label_plane_matrix;\r
uniform mat4 u_coord_matrix;\r
uniform bool u_is_text;\r
uniform bool u_elevation_from_sea;\r
uniform bool u_pitch_with_map;\r
uniform bool u_rotate_symbol;\r
uniform highp float u_aspect_ratio;\r
uniform highp float u_camera_to_center_distance;\r
uniform float u_fade_change;\r
uniform vec2 u_texsize;\r
uniform vec3 u_up_vector;\r
uniform vec2 u_texsize_icon;\r
uniform bool u_is_halo;\r
#ifdef PROJECTION_GLOBE_VIEW\r
uniform vec3 u_tile_id;\r
uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_camera_forward;\r
uniform float u_zoom_transition;\r
uniform vec3 u_ecef_origin;\r
uniform mat4 u_tile_matrix;\r
#endif\r
out vec2 v_tex_a;\r
#ifdef ICON_TRANSITION\r
out vec2 v_tex_b;\r
#endif\r
out float v_draw_halo;\r
out vec3 v_gamma_scale_size_fade_opacity;\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
out float is_sdf;\r
out vec2 v_tex_a_icon;\r
#endif\r
#pragma mapbox: define highp vec4 fill_color\r
#pragma mapbox: define highp vec4 halo_color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp float halo_width\r
#pragma mapbox: define lowp float halo_blur\r
#pragma mapbox: define lowp float emissive_strength\r
#pragma mapbox: define lowp float occlusion_opacity\r
#pragma mapbox: define lowp float z_offset\r
void main() {\r
#pragma mapbox: initialize highp vec4 fill_color\r
#pragma mapbox: initialize highp vec4 halo_color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize lowp float halo_width\r
#pragma mapbox: initialize lowp float halo_blur\r
#pragma mapbox: initialize lowp float emissive_strength\r
#pragma mapbox: initialize lowp float occlusion_opacity\r
#pragma mapbox: initialize lowp float z_offset\r
vec2 a_pos=a_pos_offset.xy;\r
vec2 a_offset=a_pos_offset.zw;\r
vec2 a_tex=a_tex_size.xy;\r
vec2 a_size=a_tex_size.zw;\r
float a_size_min=floor(a_size[0]*0.5);\r
vec2 a_pxoffset=a_pixeloffset.xy;\r
vec2 a_min_font_scale=a_pixeloffset.zw/256.0;\r
highp float segment_angle=-a_projected_pos[3];\r
float size;\r
if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r
size=mix(a_size_min,a_size[1],u_size_t)/128.0;\r
} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r
size=a_size_min/128.0;\r
} else {\r
size=u_size;\r
}\r
vec2 tile_anchor=a_pos;\r
float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\r
#ifdef Z_OFFSET\r
e+=a_auto_z_offset;\r
#endif\r
vec3 h=elevationVector(tile_anchor)*e;\r
float globe_occlusion_fade;\r
vec3 world_pos;\r
vec3 mercator_pos;\r
vec3 world_pos_globe;\r
#ifdef PROJECTION_GLOBE_VIEW\r
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);\r
world_pos_globe=a_globe_anchor+h;\r
world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);\r
vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);\r
vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\r
#else\r
world_pos=vec3(tile_anchor,0)+h;\r
globe_occlusion_fade=1.0;\r
#endif\r
vec4 projected_point=u_matrix*vec4(world_pos,1);\r
highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\r
camera_to_anchor_distance/u_camera_to_center_distance :\r
u_camera_to_center_distance/camera_to_anchor_distance;\r
highp float perspective_ratio=clamp(\r
0.5+0.5*distance_ratio,0.0,1.5);\r
size*=perspective_ratio;\r
float font_scale=u_is_text ? size/24.0 : size;\r
highp float symbol_rotation=0.0;\r
if (u_rotate_symbol) {vec4 offsetprojected_point;\r
vec2 a;\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);\r
offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\r
vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);\r
a=projected_point_globe.xy/projected_point_globe.w;\r
#else\r
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\r
a=projected_point.xy/projected_point.w;\r
#endif\r
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;\r
symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r
}\r
vec4 projected_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
#ifdef PROJECTED_POS_ON_VIEWPORT\r
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\r
#else\r
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;\r
projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \r
#endif\r
#else\r
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\r
#endif\r
highp float angle_sin=sin(segment_angle+symbol_rotation);\r
highp float angle_cos=cos(segment_angle+symbol_rotation);\r
mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r
float z=0.0;\r
vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\r
#ifdef TERRAIN\r
#ifdef PITCH_WITH_MAP_TERRAIN\r
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);\r
z=elevation(tile_pos.xy);\r
#endif\r
#endif\r
#ifdef Z_OFFSET\r
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;\r
#else\r
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;\r
#endif
float occlusion_fade=globe_occlusion_fade;\r
vec2 fade_opacity=unpack_opacity(a_fade_opacity);\r
float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r
float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\r
#ifdef DEPTH_OCCLUSION\r
float depth_occlusion=occlusionFadeMultiSample(projected_point);\r
float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);\r
out_fade_opacity*=depth_occlusion_multplier;\r
#endif\r
#ifdef OCCLUSION_QUERIES\r
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);\r
out_fade_opacity*=occludedFadeMultiplier;\r
#endif\r
float alpha=opacity*out_fade_opacity;\r
float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);\r
vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);\r
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\r
#else\r
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\r
#endif\r
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\r
v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);\r
v_tex_a=a_tex/u_texsize;\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
is_sdf=a_size[0]-2.0*a_size_min;\r
v_tex_a_icon=a_tex/u_texsize_icon;\r
#endif\r
#ifdef ICON_TRANSITION\r
v_tex_b=a_texb/u_texsize;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=e;\r
#endif\r
}`),terrainRaster:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform sampler2D u_image0;\r
in vec2 v_pos0;\r
#ifdef FOG\r
in float v_fog_opacity;\r
#endif\r
#ifdef RENDER_SHADOWS\r
in vec4 v_pos_light_view_0;\r
in vec4 v_pos_light_view_1;\r
#endif\r
uniform vec3 u_ground_shadow_factor;\r
void main() {\r
vec4 image_color=texture(u_image0,v_pos0);\r
vec4 color;\r
#ifdef LIGHTING_3D_MODE\r
const vec3 normal=vec3(0.0,0.0,1.0);\r
#ifdef RENDER_SHADOWS\r
float cutoffOpacity=1.0;\r
#ifdef RENDER_CUTOFF\r
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\r
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);\r
vec3 emissive_base=image_color.rgb*image_color.a;\r
float ndotl=u_shadow_direction.z;\r
float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);\r
ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));\r
vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);\r
color.rgb=lit+emissive;\r
color.a=1.0;\r
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\r
color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\r
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;\r
color=apply_lighting(image_color,normal,lighting_factor);\r
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);\r
color.a=1.0;\r
#endif
#endif
#else
color=image_color;\r
#endif
#ifdef FOG\r
#ifdef ZERO_EXAGGERATION\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r
#else\r
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\r
#endif\r
#endif\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform float u_skirt_height;\r
in vec2 a_pos;\r
out vec2 v_pos0;\r
#ifdef FOG\r
out float v_fog_opacity;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out vec4 v_pos_light_view_0;\r
out vec4 v_pos_light_view_1;\r
out float v_depth;\r
#endif\r
void main() {\r
vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);\r
float skirt=decomposedPosAndSkirt.z;\r
vec2 decodedPos=decomposedPosAndSkirt.xy;\r
float elevation=elevation(decodedPos)-skirt*u_skirt_height;\r
v_pos0=decodedPos/8192.0;\r
gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\r
#ifdef FOG\r
#ifdef ZERO_EXAGGERATION\r
v_fog_pos=fog_position(decodedPos);\r
#else\r
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\r
#endif\r
#endif\r
#ifdef RENDER_SHADOWS\r
vec3 pos=vec3(decodedPos,elevation);\r
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);\r
v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\r
#endif\r
}`),terrainDepth:kr(`precision highp float;\r
in float v_depth;\r
void main() {\r
glFragColor=pack_depth(v_depth);\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_matrix;\r
in vec2 a_pos;\r
out float v_depth;\r
void main() {\r
float elevation=elevation(a_pos);\r
gl_Position=u_matrix*vec4(a_pos,elevation,1.0);\r
v_depth=gl_Position.z/gl_Position.w;\r
}`),skybox:kr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;\r
uniform lowp samplerCube u_cubemap;\r
uniform lowp float u_opacity;\r
uniform highp float u_temporal_offset;\r
uniform highp vec3 u_sun_direction;\r
float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {\r
highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;\r
const highp float smoothstep_delta=1e-5;\r
return smoothstep(\r
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);\r
}\r
float map(float value,float start,float end,float new_start,float new_end) {\r
return ((value-start)*(new_end-new_start))/(end-start)+new_start;\r
}\r
void main() {\r
vec3 uv=v_uv;const float y_bias=0.015;\r
uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);\r
vec3 sky_color=texture(u_cubemap,uv).rgb;\r
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\r
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);\r
glFragColor=vec4(sky_color*u_opacity,u_opacity);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
}`,jc),skyboxGradient:kr(`#include "_prelude_fog.fragment.glsl"\r
in highp vec3 v_uv;\r
uniform lowp sampler2D u_color_ramp;\r
uniform highp vec3 u_center_direction;\r
uniform lowp float u_radius;\r
uniform lowp float u_opacity;\r
uniform highp float u_temporal_offset;\r
void main() {\r
float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;\r
vec4 color=texture(u_color_ramp,vec2(progress,0.5));\r
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\r
#endif\r
color*=u_opacity;\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
}`,jc),skyboxCapture:kr(`
in highp vec3 v_position;\r
uniform highp float u_sun_intensity;\r
uniform highp float u_luminance;\r
uniform lowp vec3 u_sun_direction;\r
uniform highp vec4 u_color_tint_r;\r
uniform highp vec4 u_color_tint_m;\r
precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)\r
#define MIE_G                   0.76\r
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10\r
#define DENSITY_STEPS           4\r
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {\r
float a=dot(dir,dir);\r
float b=2.0*dot(dir,orig);\r
float c=dot(orig,orig)-radius*radius;\r
float d=sqrt(b*b-4.0*a*c);\r
return (-b+d)/(2.0*a);\r
}\r
vec3 extinction(vec2 density) {\r
return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));\r
}\r
vec2 local_density(vec3 point) {\r
float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);\r
float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);\r
return vec2(exp_r,exp_m);\r
}\r
float phase_ray(float cos_angle) {\r
return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);\r
}\r
float phase_mie(float cos_angle) {\r
return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/
((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));\r
}\r
vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {\r
float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);\r
float step_len=ray_len/float(DENSITY_STEPS);\r
vec2 density_point_to_atmosphere=vec2(0.0);\r
for (int i=0; i < DENSITY_STEPS;++i) {\r
vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);\r
density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;\r
}\r
return density_point_to_atmosphere;\r
}\r
vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {\r
vec2 density_orig_to_point=vec2(0.0);\r
vec3 scatter_r=vec3(0.0);\r
vec3 scatter_m=vec3(0.0);\r
vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);\r
float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);\r
float step_len=ray_len/float(SAMPLE_STEPS);\r
for (int i=0; i < SAMPLE_STEPS;++i) {\r
vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;\r
density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;\r
vec3 extinction=extinction(density_orig_to_atmosphere);\r
scatter_r+=density.x*extinction;\r
scatter_m+=density.y*extinction;\r
}float cos_angle=dot(ray_dir,sun_direction);\r
float phase_r=phase_ray(cos_angle);\r
float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;\r
vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;\r
return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;\r
}\r
const float A=0.15;\r
const float B=0.50;\r
const float C=0.10;\r
const float D=0.20;\r
const float E=0.02;\r
const float F=0.30;\r
vec3 uncharted2_tonemap(vec3 x) {\r
return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\r
}\r
void main() {\r
vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;\r
ray_direction.y+=y_bias;\r
vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;\r
glFragColor=vec4(color,1.0);\r
}`,`in highp vec3 a_pos_3f;\r
uniform mat3 u_matrix_3f;\r
out highp vec3 v_position;\r
float map(float value,float start,float end,float new_start,float new_end) {\r
return ((value-start)*(new_end-new_start))/(end-start)+new_start;\r
}\r
void main() {\r
vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);\r
v_position=pos.xyz;\r
v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);\r
gl_Position=vec4(a_pos_3f.xy,0.0,1.0);\r
}`),globeRaster:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform sampler2D u_image0;\r
uniform float u_far_z_cutoff;\r
in vec2 v_pos0;\r
#ifndef FOG\r
uniform highp vec3 u_frustum_tl;\r
uniform highp vec3 u_frustum_tr;\r
uniform highp vec3 u_frustum_br;\r
uniform highp vec3 u_frustum_bl;\r
uniform highp vec3 u_globe_pos;\r
uniform highp float u_globe_radius;\r
uniform vec2 u_viewport;\r
#endif\r
void main() {\r
vec4 color;\r
#ifdef CUSTOM_ANTIALIASING\r
highp vec2 uv=gl_FragCoord.xy/u_viewport;\r
highp vec3 ray_dir=mix(\r
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);\r
highp vec3 dir=normalize(ray_dir);\r
highp vec3 closest_point=dot(u_globe_pos,dir)*dir;\r
highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;\r
const float antialias_pixel=2.0;\r
highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);\r
highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);\r
vec4 raster=texture(u_image0,v_pos0);\r
#ifdef LIGHTING_3D_MODE\r
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r
raster=apply_lighting_with_emission_ground(raster,raster.a);\r
color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\r
#else
raster=apply_lighting_ground(raster);\r
color=vec4(raster.rgb*antialias,raster.a*antialias);\r
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);\r
#endif
#else
color=texture(u_image0,v_pos0);\r
#ifdef LIGHTING_3D_MODE\r
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r
color=apply_lighting_with_emission_ground(color,color.a);\r
color.a=1.0;\r
#else
color=apply_lighting_ground(color);\r
#endif
#endif
#endif
#ifdef FOG\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r
#endif\r
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_proj_matrix;\r
uniform mat4 u_normalize_matrix;\r
uniform mat4 u_globe_matrix;\r
uniform mat4 u_merc_matrix;\r
uniform float u_zoom_transition;\r
uniform vec2 u_merc_center;\r
uniform mat3 u_grid_matrix;\r
uniform float u_skirt_height;\r
#ifdef GLOBE_POLES\r
in vec3 a_globe_pos;\r
in vec2 a_uv;\r
#else\r
in vec2 a_pos;
#endif\r
out vec2 v_pos0;\r
void main() {\r
#ifdef GLOBE_POLES\r
vec3 globe_pos=a_globe_pos;\r
vec2 uv=a_uv;\r
#else
float tiles=u_grid_matrix[0][2];\r
float idx=u_grid_matrix[1][2];\r
float idy=u_grid_matrix[2][2];\r
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);\r
vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);\r
float mercatorY=mercatorYfromLat(latLng[0]);\r
float uvY=mercatorY*tiles-idy;\r
float mercatorX=mercatorXfromLng(latLng[1]);\r
float uvX=mercatorX*tiles-idx;\r
vec3 globe_pos=latLngToECEF(latLng.xy);\r
vec2 merc_pos=vec2(mercatorX,mercatorY);\r
vec2 uv=vec2(uvX,uvY);\r
#endif\r
v_pos0=uv;\r
vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\r
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;\r
#else\r
vec3 up_vector=elevationVector(tile_pos);\r
#endif\r
float height=elevation(tile_pos);\r
globe_pos+=up_vector*height;\r
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\r
#endif\r
#ifdef GLOBE_POLES\r
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
#else\r
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
vec4 merc_world_pos=vec4(0.0);\r
if (u_zoom_transition > 0.0) {\r
merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);\r
merc_world_pos.xy-=u_merc_center;\r
merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);\r
merc_world_pos=u_merc_matrix*merc_world_pos;\r
}\r
vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\r
#endif\r
gl_Position=u_proj_matrix*interpolated_pos;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\r
#endif\r
}`),globeAtmosphere:kr(`#include "_prelude_fog.fragment.glsl"\r
uniform float u_transition;\r
uniform highp float u_fadeout_range;\r
uniform highp float u_temporal_offset;\r
uniform vec4 u_color;\r
uniform vec4 u_high_color;\r
uniform vec4 u_space_color;\r
uniform float u_horizon_angle;\r
in highp vec3 v_ray_dir;\r
in highp vec3 v_horizon_dir;\r
void main() {\r
highp vec3 dir=normalize(v_ray_dir);\r
float globe_pos_dot_dir;\r
#ifdef PROJECTION_GLOBE_VIEW\r
globe_pos_dot_dir=dot(u_globe_pos,dir);\r
highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;\r
float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\r
#ifdef ALPHA_PASS\r
glFragColor=vec4(0,0,0,0);\r
return;\r
#else\r
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);\r
#else\r
glFragColor=vec4(0,0,0,1);\r
#endif\r
return;\r
#endif\r
}\r
#endif\r
highp vec3 horizon_dir=normalize(v_horizon_dir);\r
float horizon_angle_mercator=dir.y < horizon_dir.y ?\r
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);\r
float horizon_angle;\r
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;\r
highp float closest_point_to_center=length(closest_point-u_globe_pos);\r
highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\r
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);\r
horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\r
#else\r
horizon_angle=horizon_angle_mercator;\r
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);\r
float alpha_0=u_color.a;\r
float alpha_1=u_high_color.a;\r
float alpha_2=u_space_color.a;\r
vec3 color_stop_0=u_color.rgb;\r
vec3 color_stop_1=u_high_color.rgb;\r
vec3 color_stop_2=u_space_color.rgb;\r
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);\r
float a1=mix(a0,1.0,alpha_0);\r
float a2=mix(a0,a1,t);\r
float a =mix(alpha_2,a2,t);\r
glFragColor=vec4(1.0,1.0,1.0,a);\r
#else\r
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);\r
vec3 c1=mix(c0,color_stop_0,alpha_0);\r
vec3 c2=mix(c0,c1,t);\r
vec3 c=c2;glFragColor=vec4(c*t,t);\r
#endif\r
}`,`in vec3 a_pos;\r
in vec2 a_uv;uniform vec3 u_frustum_tl;\r
uniform vec3 u_frustum_tr;\r
uniform vec3 u_frustum_br;\r
uniform vec3 u_frustum_bl;\r
uniform float u_horizon;\r
out highp vec3 v_ray_dir;\r
out highp vec3 v_horizon_dir;\r
void main() {\r
v_ray_dir=mix(\r
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);\r
v_horizon_dir=mix(\r
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);\r
gl_Position=vec4(a_pos,1.0);\r
}`),model:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform float u_opacity;\r
uniform vec3 u_lightcolor;\r
uniform vec3 u_lightpos;\r
uniform float u_lightintensity;\r
uniform vec4 u_baseColorFactor;\r
uniform vec4 u_emissiveFactor;\r
uniform float u_metallicFactor;\r
uniform float u_roughnessFactor;\r
uniform float u_emissive_strength;\r
in highp vec4 v_position_height;\r
in lowp vec4 v_color_mix;\r
#ifdef RENDER_SHADOWS\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in float v_depth_shadows;\r
#endif\r
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;\r
#endif\r
#pragma mapbox: define-attribute highp vec3 normal_3f\r
#pragma mapbox: define-attribute highp vec3 color_3f\r
#pragma mapbox: define-attribute highp vec4 color_4f\r
#pragma mapbox: define-attribute highp vec2 uv_2f\r
#pragma mapbox: initialize-attribute highp vec3 normal_3f\r
#pragma mapbox: initialize-attribute highp vec3 color_3f\r
#pragma mapbox: initialize-attribute highp vec4 color_4f\r
#pragma mapbox: initialize-attribute highp vec2 uv_2f\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
in lowp vec4 v_roughness_metallic_emissive_alpha;\r
in mediump vec4 v_height_based_emission_params;\r
#endif\r
#ifdef HAS_TEXTURE_u_baseColorTexture\r
uniform sampler2D u_baseColorTexture;\r
uniform bool u_baseTextureIsAlpha;\r
uniform bool u_alphaMask;\r
uniform float u_alphaCutoff;\r
#endif\r
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\r
uniform sampler2D u_metallicRoughnessTexture;\r
#endif\r
#ifdef HAS_TEXTURE_u_occlusionTexture\r
uniform sampler2D u_occlusionTexture;\r
uniform float u_aoIntensity;\r
#endif\r
#ifdef HAS_TEXTURE_u_normalTexture\r
uniform sampler2D u_normalTexture;\r
#endif\r
#ifdef HAS_TEXTURE_u_emissionTexture\r
uniform sampler2D u_emissionTexture;\r
#endif\r
#ifdef APPLY_LUT_ON_GPU\r
uniform highp sampler3D u_lutTexture;\r
#endif\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
in highp float v_depth;\r
uniform highp sampler2D u_depthTexture;\r
uniform highp vec2 u_inv_depth_size;\r
uniform highp vec2 u_depth_range_unpack;\r
#ifdef DEPTH_D24\r
highp float unpack_depth(highp float depth) {\r
return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;\r
}\r
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)\r
{\r
const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r
return dot(rgba_depth,bit_shift)*2.0-1.0;\r
}\r
#endif\r
bool isOccluded() {\r
highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\r
#ifdef DEPTH_D24\r
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);\r
#else\r
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\r
#endif
return v_depth > depth+0.0005;\r
}\r
#endif\r
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {\r
return pow(color,vec3(1./2.2));\r
}\r
vec3 sRGBToLinear(vec3 srgbIn) {\r
return pow(srgbIn,vec3(2.2));\r
}\r
float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);\r
}\r
vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\r
{\r
#ifdef LIGHTING_3D_MODE\r
vec3 transformed_normal=vec3(-normal.xy,normal.z);\r
float lighting_factor;\r
#ifdef RENDER_SHADOWS\r
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\r
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\r
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);\r
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);\r
vec3 c=vec3(0.03,0.03,0.03);\r
float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);\r
directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);\r
vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));\r
return c3;\r
#endif
}\r
vec4 getBaseColor() {\r
vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f\r
albedo*=vec4(color_3f,1.0);\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
#else\r
#ifdef HAS_ATTRIBUTE_a_color_4f\r
albedo*=color_4f;\r
#endif\r
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\r
vec4 texColor=texture(u_baseColorTexture,uv_2f);\r
if(u_alphaMask) {\r
if (texColor.w < u_alphaCutoff) {\r
discard;\r
}\r
}\r
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {\r
texColor.rgb/=texColor.w;\r
}\r
texColor.w=1.0;\r
#endif\r
if(u_baseTextureIsAlpha) {\r
if (texColor.r < 0.5) {\r
discard;\r
}\r
} else {texColor.rgb=sRGBToLinear(texColor.rgb);\r
albedo*=texColor;\r
}\r
#endif\r
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\r
#ifdef APPLY_LUT_ON_GPU\r
color=applyLUT(u_lutTexture,color);\r
#endif\r
return color;\r
}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\r
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));\r
highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));\r
highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));\r
highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );\r
highp vec3 dp1perp=cross( N,dp1 );\r
highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;\r
highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);\r
highp float lengthB=dot(B,B);\r
highp float maxLength=max(lengthT,lengthB);\r
highp float invmax=inversesqrt( maxLength );\r
highp mat3 res=mat3( T*invmax,B*invmax,N );\r
return res;\r
#else\r
return mat3(1.0);\r
#endif\r
}\r
highp vec3 getNormal(){\r
highp vec3 n;\r
#ifdef HAS_ATTRIBUTE_a_normal_3f\r
n=normalize(normal_3f);\r
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));\r
highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\r
#endif\r
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;\r
nMap=normalize(2.0*nMap-vec3(1.0));\r
highp vec3 v=normalize(-v_position_height.xyz);\r
highp mat3 TBN=cotangentFrame(n,v,uv_2f);\r
n=normalize(TBN*nMap);\r
#endif\r
return n;\r
}\r
struct Material {\r
float perceptualRoughness;\r
float alphaRoughness;\r
float metallic;\r
vec3 f90;\r
vec4 baseColor;\r
vec3 diffuseColor;\r
vec3 specularColor;\r
highp vec3 normal;\r
};\r
Material getPBRMaterial() {\r
Material mat;\r
mat.baseColor=getBaseColor();\r
mat.perceptualRoughness=u_roughnessFactor;\r
mat.metallic=u_metallicFactor;\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;\r
mat.metallic=v_roughness_metallic_emissive_alpha.y;\r
mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\r
#endif\r
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \r
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);\r
mat.perceptualRoughness*=mrSample.g;\r
mat.metallic*=mrSample.b;\r
#endif\r
const float c_minRoughness=0.04;\r
mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);\r
mat.metallic=saturate(mat.metallic);\r
mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);\r
mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);\r
mat.diffuseColor*=1.0-mat.metallic;\r
mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);\r
highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);\r
mat.f90=vec3(reflectance90);\r
mat.normal=getNormal();\r
return mat;\r
}float V_GGX(float NdotL,float NdotV,float roughness)\r
{\r
float a2=roughness*roughness;\r
float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);\r
float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);\r
return 0.5/(GGXV+GGXL);\r
}float V_GGXFast(float NdotL,float NdotV,float roughness) {\r
float a=roughness;\r
float GGXV=NdotL*(NdotV*(1.0-a)+a);\r
float GGXL=NdotV*(NdotL*(1.0-a)+a);\r
return 0.5/(GGXV+GGXL);\r
}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\r
{\r
return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);\r
}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\r
{\r
float x=1.0-VdotH;\r
float x4=x*x*x*x;\r
return specularColor+(1.0-specularColor)*x4*x;\r
}float D_GGX(highp float NdotH,float alphaRoughness)\r
{\r
highp float a4=alphaRoughness*alphaRoughness;\r
highp float f=(NdotH*a4-NdotH)*NdotH+1.0;\r
return a4/(PI*f*f);\r
}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\r
{\r
float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;\r
return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));\r
}\r
vec3 diffuseLambertian(Material mat)\r
{\r
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;\r
#else\r
return mat.diffuseColor/PI;\r
#endif\r
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\r
{\r
vec4 c0=vec4(-1,-0.0275,-0.572,0.022);\r
vec4 c1=vec4(1,0.0425,1.04,-0.04);\r
highp vec4 r=roughness*c0+c1;\r
highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;\r
vec2 AB=vec2(-1.04,1.04)*a004+r.zw;\r
return specularColor*AB.x+AB.y;\r
}\r
vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\r
{\r
vec3 env_light=vec3(0.65,0.65,0.65);\r
#ifdef LIGHTING_3D_MODE\r
float ambient_factor=calculate_ambient_directional_factor(normal);\r
env_light=u_lighting_ambient_color*ambient_factor;\r
#endif\r
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);\r
vec3 indirectSpecular= envBRDF*env_light;\r
vec3 indirectDiffuse=mat.diffuseColor*env_light;\r
return indirectSpecular+indirectDiffuse;\r
}\r
vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\r
{\r
highp vec3 n=mat.normal;\r
highp vec3 v=normalize(-v_position_height.xyz);\r
highp vec3 l=normalize(lightPosition);\r
highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);\r
float NdotL=saturate(dot(n,l));\r
highp float NdotH=saturate(dot(n,h));\r
float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;\r
vec3 transformed_normal=vec3(-n.xy,n.z);\r
float lighting_factor;\r
#ifdef RENDER_SHADOWS\r
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\r
#else\r
lighting_factor=NdotL;\r
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;\r
vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);\r
vec3 color=(saturate(directLightColor)+indirectLightColor);\r
float intensityFactor=1.0;\r
#if !defined(LIGHTING_3D_MODE)\r
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\r
#endif
color*=intensityFactor;\r
return color;\r
}\r
void main() {\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
if (isOccluded()) {\r
discard;\r
}\r
#endif\r
vec3 lightDir=u_lightpos;\r
vec3 lightColor=u_lightcolor;\r
#ifdef LIGHTING_3D_MODE\r
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;\r
lightColor=u_lighting_directional_color;\r
#endif\r
vec4 finalColor;\r
#ifdef DIFFUSE_SHADED\r
vec3 N=getNormal();\r
vec3 baseColor=getBaseColor().rgb;\r
vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;\r
diffuse*=ao;\r
#endif\r
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\r
#else
Material mat=getPBRMaterial();\r
vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\r
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\r
#ifdef OCCLUSION_TEXTURE_TRANSFORM\r
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\r
#else\r
vec2 uv=uv_2f;\r
#endif\r
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;\r
color*=ao;\r
#endif
vec4 emissive=u_emissiveFactor;\r
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\r
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\r
#endif\r
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);\r
emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\r
#endif\r
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
float resEmission=v_roughness_metallic_emissive_alpha.z;\r
resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);\r
vec3 color_mix=v_color_mix.rgb;\r
#ifdef APPLY_LUT_ON_GPU\r
color_mix=applyLUT(u_lutTexture,color_mix);\r
#endif\r
color=mix(color,color_mix,min(1.0,resEmission));\r
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));\r
distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));\r
opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\r
#endif\r
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;\r
color=mix(color,unlitColor,u_emissive_strength);\r
color=linearTosRGB(color);\r
color*=opacity;\r
finalColor=vec4(color,opacity);\r
#endif
#ifdef FOG\r
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\r
#endif\r
#ifdef RENDER_CUTOFF\r
finalColor*=v_cutoff_opacity;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
finalColor=applyCutout(finalColor,v_position_height.w);\r
#endif\r
glFragColor=finalColor;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec3 a_pos_3f;\r
#pragma mapbox: define-attribute highp vec3 normal_3f\r
#pragma mapbox: define-attribute highp vec2 uv_2f\r
#pragma mapbox: define-attribute highp vec3 color_3f\r
#pragma mapbox: define-attribute highp vec4 color_4f\r
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\r
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;\r
uniform mat4 u_node_matrix;\r
uniform mat4 u_lighting_matrix;\r
uniform vec3 u_camera_pos;\r
uniform vec4 u_color_mix;\r
#ifdef INSTANCED_ARRAYS\r
in vec4 a_normal_matrix0;\r
in vec4 a_normal_matrix1;\r
in vec4 a_normal_matrix2;\r
in vec4 a_normal_matrix3;\r
#else\r
uniform highp mat4 u_normal_matrix;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out float v_depth_shadows;\r
#endif\r
out vec4 v_position_height;\r
out lowp vec4 v_color_mix;\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
out highp float v_depth;\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
out lowp vec4 v_roughness_metallic_emissive_alpha;\r
out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {\r
return pow(srgbIn,vec3(2.2));\r
}\r
void main() {\r
#pragma mapbox: initialize-attribute highp vec3 normal_3f\r
#pragma mapbox: initialize-attribute highp vec2 uv_2f\r
#pragma mapbox: initialize-attribute highp vec3 color_3f\r
#pragma mapbox: initialize-attribute highp vec4 color_4f\r
#pragma mapbox: initialize-attribute-custom highp vec4 pbr\r
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\r
highp mat4 normal_matrix;\r
#ifdef INSTANCED_ARRAYS\r
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\r
#else\r
normal_matrix=u_normal_matrix;\r
#endif\r
vec3 local_pos;\r
mat3 rs;\r
#ifdef MODEL_POSITION_ON_GPU\r
vec3 pos_color=normal_matrix[0].xyz;\r
vec4 translate=normal_matrix[1];\r
vec3 pos_a=floor(pos_color);\r
vec3 rgb=1.05*(pos_color-pos_a);\r
float hidden=float(pos_a.x > EXTENT);\r
float color_mix=pos_a.z/100.0;\r
v_color_mix=vec4(sRGBToLinear(rgb),color_mix);\r
float meter_to_tile=normal_matrix[0].w;\r
vec4 pos=vec4(pos_a.xy,translate.z,1.0);\r
rs[0].x=normal_matrix[1].w;\r
rs[0].yz=normal_matrix[2].xy;\r
rs[1].xy=normal_matrix[2].zw;\r
rs[1].z=normal_matrix[3].x;\r
rs[2].xyz=normal_matrix[3].yzw;\r
vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);\r
vec3 rotated_pos_node=rs*pos_node.xyz;\r
vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);\r
pos.xyz+=pos_model_tile;\r
local_pos=pos.xyz;\r
gl_Position=mix(u_matrix*pos,AWAY,hidden);\r
pos.z*=meter_to_tile;\r
v_position_height.xyz=pos.xyz-u_camera_pos;\r
#else\r
local_pos=a_pos_3f;\r
gl_Position=u_matrix*vec4(a_pos_3f,1);\r
v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));\r
v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\r
#endif\r
v_position_height.w=a_pos_3f.z;\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
vec4 albedo_c=decode_color(pbr.xy);\r
vec2 e_r_m=unpack_float(pbr.z);\r
vec2 r_m= unpack_float(e_r_m.y*16.0);\r
r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);\r
v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;\r
v_height_based_emission_params.x=heightBasedRelativeIntepolation;\r
v_height_based_emission_params.y=heightBasedEmissiveStrength.z;\r
vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;\r
v_height_based_emission_params.z=emissionMultiplierValues.x;\r
v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(local_pos);\r
#endif\r
#ifdef RENDER_CUTOFF\r
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\r
#endif\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
v_depth=gl_Position.z/gl_Position.w;\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_normal_3f\r
#ifdef MODEL_POSITION_ON_GPU\r
float x_squared_scale=dot(rs[0],rs[0]);\r
float y_squared_scale=dot(rs[1],rs[1]);\r
float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);\r
normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);\r
normal_3f=normalize(normal_3f);\r
#else\r
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));\r
#endif\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
#ifdef HAS_ATTRIBUTE_a_color_4f\r
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\r
#endif\r
#endif\r
#ifdef RENDER_SHADOWS\r
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\r
#ifdef NORMAL_OFFSET\r
#ifdef HAS_ATTRIBUTE_a_normal_3f\r
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));\r
shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\r
#else\r
vec3 offset=shadow_normal_offset_model(normal_3f);\r
shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\r
#endif\r
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;\r
v_pos_light_view_1=u_light_matrix_1*shadow_pos;\r
v_depth_shadows=gl_Position.w;\r
#endif
}`),modelDepth:kr(`in highp float v_depth;\r
void main() {\r
#ifndef DEPTH_TEXTURE\r
glFragColor=pack_depth(v_depth);\r
#endif\r
}`,`in vec3 a_pos_3f;\r
uniform mat4 u_matrix;\r
out highp float v_depth;\r
#ifdef MODEL_POSITION_ON_GPU\r
#ifdef INSTANCED_ARRAYS\r
in vec4 a_normal_matrix0;\r
in vec4 a_normal_matrix1;\r
in vec4 a_normal_matrix2;\r
in vec4 a_normal_matrix3;\r
#else\r
uniform highp mat4 u_instance;\r
#endif\r
uniform highp mat4 u_node_matrix;\r
#endif\r
void main() {\r
#ifdef MODEL_POSITION_ON_GPU\r
highp mat4 instance;\r
#ifdef INSTANCED_ARRAYS\r
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\r
#else\r
instance=u_instance;\r
#endif\r
vec3 pos_color=instance[0].xyz;\r
vec4 translate=instance[1];\r
vec3 pos_a=floor(pos_color);\r
float hidden=float(pos_a.x > EXTENT);\r
float meter_to_tile=instance[0].w;\r
vec4 pos=vec4(pos_a.xy,translate.z,1.0);\r
mat3 rs;\r
rs[0].x=instance[1].w;\r
rs[0].yz=instance[2].xy;\r
rs[1].xy=instance[2].zw;\r
rs[1].z=instance[3].x;\r
rs[2].xyz=instance[3].yzw;\r
vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);\r
vec3 rotated_pos_node=rs*pos_node.xyz;\r
vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);\r
pos.xyz+=pos_model_tile;\r
gl_Position=mix(u_matrix*pos,AWAY,hidden);\r
#else\r
gl_Position=u_matrix*vec4(a_pos_3f,1);\r
#endif\r
v_depth=gl_Position.z/gl_Position.w;\r
}`),stars:kr(`in highp vec2 v_uv;\r
in mediump float v_intensity;float shapeCircle(in vec2 uv)\r
{float beginFade=0.6;float lengthFromCenter=length(v_uv);\r
return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);\r
}\r
void main() {\r
float alpha=shapeCircle(v_uv);\r
vec3 color=vec3(1.0,1.0,1.0);\r
alpha*=v_intensity;\r
glFragColor=vec4(color*alpha,alpha);\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;\r
uniform vec3 u_right;uniform float u_intensity_multiplier;\r
out highp vec2 v_uv;\r
out mediump float v_intensity;\r
void main() {\r
v_uv=a_uv;\r
v_intensity=a_fade_opacity*u_intensity_multiplier;\r
vec3 pos=a_pos_3f;\r
pos+=a_uv.x*u_right*a_size_scale;\r
pos+=a_uv.y*u_up*a_size_scale;\r
gl_Position=u_matrix*vec4(pos,1.0);\r
}`),snowParticle:kr(`in highp vec2 uv;\r
in highp float alphaMultiplier;\r
uniform vec4 u_particleColor;\r
uniform vec2 u_simpleShapeParameters;void main() {\r
float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);\r
float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));\r
alpha*=alphaMultiplier;\r
alpha*=u_particleColor.a;\r
vec3 color=u_particleColor.rgb*alpha;\r
glFragColor=vec4(color,alpha) ;\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`
in highp vec3 a_pos_3f;in highp vec2 a_uv;\r
in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;\r
uniform mat4 u_projection;\r
uniform vec3 u_cam_pos;\r
uniform vec2 u_screenSize;\r
uniform float u_time;\r
uniform float u_boxSize;\r
uniform float u_velocityConeAperture; \r
uniform float u_velocity;uniform vec3 u_direction;\r
uniform float u_horizontalOscillationRadius; \r
uniform float u_horizontalOscillationRate; \r
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;\r
uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;\r
out highp vec2 uv;\r
out highp float alphaMultiplier;\r
void main() {\r
vec3 pos=a_pos_3f;\r
float halfBoxSize=0.5*u_boxSize;\r
pos.xyz*=halfBoxSize;\r
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);\r
float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;\r
float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);\r
vec3 localZ=normalize(u_direction);\r
vec3 localX=normalize(cross(localZ,vec3(1,0,0)));\r
vec3 localY=normalize(cross(localZ,localX));vec3 direction;\r
direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
direction.z=cos(coneAnglePichRad);\r
direction=normalize(direction);\r
vec3 simPosLocal=vec3(0,0,0);\r
float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;\r
simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;\r
float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);\r
simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));\r
vec3 simPos=localX*simPosLocal.x+\r
localY*simPosLocal.y+
localZ*simPosLocal.z;\r
pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);\r
float clipZ=-u_cam_pos.z+pos.z;\r
vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;\r
alphaMultiplier=1.0;\r
vec4 posScreen=u_projection*posView;\r
posScreen/=posScreen.w;\r
posScreen.xy=vec2(0.5)+posScreen.xy*0.5;\r
posScreen.xy*=u_screenSize;\r
vec2 thinningCenterPos=u_thinningCenterPos.xy;\r
thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;\r
float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));\r
screenDist+=a_snowParticleData.x*u_thinningParticleOffset;\r
float scaleFactorMode=0.0;\r
float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;\r
if (screenDist < thinningShapeDist) {\r
float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);\r
thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);\r
if (a_snowParticleData.x < u_thinningAffectedRatio) {\r
scaleFactorMode=1.0-thinningFadeRatio;\r
alphaMultiplier=thinningFadeRatio;\r
}\r
}\r
vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);\r
posScreen1/=posScreen1.w;\r
vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);\r
posScreen2/=posScreen2.w;\r
posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;\r
posScreen1.xy*=u_screenSize;\r
posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;\r
posScreen2.xy*=u_screenSize;\r
float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;\r
float scaleFactor=1.0;\r
if (screenLength < screenEpsilon) {\r
scaleFactor=screenEpsilon/max(screenLength,0.01);\r
scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);\r
}float screenEpsilon2=15.0;\r
if (screenLength > screenEpsilon2) {\r
scaleFactor=screenEpsilon2/max(screenLength,0.01);\r
}\r
size*=scaleFactor;\r
vec2 right=size*vec2(1,0);\r
vec2 up=size*vec2(0,1);\r
posView.xy+=right*a_uv.x;\r
posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;\r
}`),rainParticle:kr(`in highp vec2 uv;\r
in highp float particleRandomValue;\r
uniform sampler2D u_texScreen;\r
uniform float u_distortionStrength;\r
uniform vec4 u_color;uniform vec2 u_thinningCenterPos;\r
uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;\r
uniform float u_thinningParticleOffset;\r
uniform float u_shapeDirectionalPower;\r
uniform float u_mode;void main() {\r
vec2 st=uv*0.5+vec2(0.5);\r
vec2 uvm=uv;\r
uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);\r
float shape=clamp(1.0-length(uvm),0.0,1.0);\r
float alpha=abs(shape)*u_color.a;\r
vec2 screenSize=vec2(textureSize(u_texScreen,0));\r
vec2 thinningCenterPos=u_thinningCenterPos.xy;\r
thinningCenterPos.y=screenSize.y-thinningCenterPos.y;\r
float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));\r
screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;\r
float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;\r
float thinningAlpha=1.0;\r
if (screenDist < thinningShapeDist) {\r
float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);\r
thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);\r
thinningAlpha*=thinningFadeRatio;\r
}\r
vec2 offsetXY=normalize(uvm)*abs(shape);\r
vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;\r
vec3 colorScreen=texture(u_texScreen,stScreen).rgb;\r
alpha*=thinningAlpha;\r
glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`
in highp vec3 a_pos_3f;in highp vec2 a_uv;\r
in highp vec4 a_rainParticleData;uniform mat4 u_modelview;\r
uniform mat4 u_projection;uniform vec3 u_cam_pos;\r
uniform float u_time;\r
uniform float u_boxSize;\r
uniform float u_velocityConeAperture; \r
uniform float u_velocity; \r
uniform vec2 u_rainDropletSize;\r
uniform vec3 u_rainDirection;\r
out highp vec2 uv;\r
out highp float particleRandomValue;\r
void main() {\r
vec3 pos=a_pos_3f;\r
float halfBoxSize=0.5*u_boxSize;\r
pos*=halfBoxSize; \r
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);\r
float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;\r
float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);\r
vec3 localX=normalize(cross(localZ,vec3(1,0,0)));\r
vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;\r
directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
directionLocal.z=cos(coneAnglePichRad);\r
directionLocal=normalize(directionLocal);\r
vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;\r
float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;\r
vec3 simPosLocal=vec3(0,0,0);\r
simPosLocal+=directionLocal*velocityScale*u_time;\r
vec3 simPos=localX*simPosLocal.x+\r
localY*simPosLocal.y+
localZ*simPosLocal.z;\r
pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);\r
vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);\r
vec3 side=cross(directionView,normalize(posView.xyz));\r
posView.xyz+=side*a_uv.x*u_rainDropletSize.x;\r
posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;\r
particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;\r
}`),vignette:kr(`uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;\r
in vec2 st;\r
void main() {\r
float screenDist=length(st);\r
float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);\r
alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;\r
vec3 color=u_vignetteColor.rgb;\r
glFragColor=vec4(color*alpha,alpha) ;\r
}`,`in vec2 a_pos_2f;\r
out vec2 st;\r
void main() {\r
st=a_pos_2f;\r
gl_Position=vec4(a_pos_2f,0,1);\r
}`),occlusion:kr(`uniform vec4 u_color;\r
void main() {\r
glFragColor=u_color;\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in highp vec2 a_offset_xy;\r
uniform highp vec3 u_anchorPos;\r
uniform mat4 u_matrix;\r
uniform vec2 u_screenSizePx;\r
uniform vec2 u_occluderSizePx;\r
void main() {\r
vec3 world_pos=u_anchorPos;\r
#ifdef TERRAIN\r
float e=elevation(world_pos.xy);\r
world_pos.z+=e;\r
#endif\r
vec4 projected_point=u_matrix*vec4(world_pos,1.0);\r
projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;\r
gl_Position=projected_point;\r
}`)};function Wo(d,t){const s=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=h.split(" ");for(const g of m)t.includes(g)||t.push(g)}}function kr(d,t){const s=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let m=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(z=>{const L=z.split(" ");return L[L.length-1]}),m=[...new Set(m)]);const g={},x=[],I=[];if(d=d.replace(s,(z,L)=>(I.push(L),"")),(t=t.replace(s,(z,L)=>(x.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let P=[...Ya];Wo(d,P),Wo(t,P);for(const z of[...x,...I])qo[z]||console.error(`Undefined include: ${z}`),Ja[z]||(Ja[z]=[],Wo(qo[z],Ja[z])),P=[...P,...Ja[z]];return{fragmentSource:d=d.replace(h,(z,L,F,B,j)=>(g[j]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${F} ${B} ${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${F} ${B} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${B} ${j};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(h,(z,L,F,B,j)=>{const X=B==="float"?"vec2":B,q=j.match(/color/)?"color":X;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${F} ${B} a_${j};
#endif
`:g[j]?L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${X} a_${j};
out ${F} ${B} ${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="initialize"?q==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${F} ${B} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${q}(a_${j}, u_${j}_t);
#else
    ${F} ${B} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${B} a_${j};
    out ${F} ${B} ${j};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${X} a_${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="define-instanced"?q==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${F} ${B} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${X} a_${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${F} ${B} ${j} = a_${j};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${B} ${j} = a_${j};
#else
    ${F} ${B} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${B} ${j} = unpack_mix_${q}(a_${j}, u_${j}_t);
#else
    ${F} ${B} ${j} = u_${j};
#endif
`}),staticAttributes:m,usedDefines:P,vertexIncludes:x,fragmentIncludes:I}}class Jm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,h,m,g,x,I,P){this.context=t;let z=this.boundPaintVertexBuffers.length!==m.length;for(let F=0;!z&&F<m.length;F++)this.boundPaintVertexBuffers[F]!==m[F]&&(z=!0);let L=this.boundDynamicVertexBuffers.length!==I.length;for(let F=0;!L&&F<I.length;F++)this.boundDynamicVertexBuffers[F]!==I[F]&&(L=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||z||L||this.boundIndexBuffer!==g||this.boundVertexOffset!==x)this.freshBind(s,h,m,g,x,I,P);else{t.bindVertexArrayOES.set(this.vao);for(const F of I)F&&(F.bind(),P&&F.instanceCount&&F.setVertexAttribDivisor(t.gl,s,P));g&&g.dynamicDraw&&g.bind()}}freshBind(t,s,h,m,g,x,I){const P=t.numAttributes,z=this.context,L=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=x,s.enableAttributes(L,t),s.bind(),s.setVertexAttribPointers(L,t,g);for(const F of h)F.enableAttributes(L,t),F.bind(),F.setVertexAttribPointers(L,t,g);for(const F of x)F&&(F.enableAttributes(L,t),F.bind(),F.setVertexAttribPointers(L,t,g),I&&F.instanceCount&&F.setVertexAttribDivisor(L,t,I));m&&m.bind(),z.currentNumAttributes=P}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Qm(d,t){const s=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new i.ac(0,h/s).toLngLat().lat,new i.ac(0,(h+1)/s).toLngLat().lat]}function e_(d,t,s,h,m,g,x){const I=d.context,P=I.gl,z=s.hillshadeFBO;if(!z)return;d.prepareDrawTile();const L=d.isTileAffectedByFog(t),F=d.getOrCreateProgram("hillshade",{overrideFog:L});I.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,z.colorAttachment.get());const B=((J,Q,oe,ue)=>{const ce=oe.paint.get("hillshade-shadow-color"),ge=oe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",pe=oe.paint.get("hillshade-highlight-color"),_e=oe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",me=oe.paint.get("hillshade-accent-color"),we=oe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ee=oe.paint.get("hillshade-emissive-strength");let He=i.ak(oe.paint.get("hillshade-illumination-direction"));if(oe.paint.get("hillshade-illumination-anchor")==="viewport")He-=J.transform.angle;else if(J.style&&J.style.enable3dLights()&&J.style.directionalLight){const et=J.style.directionalLight.properties.get("direction"),rt=i.cc(et.x,et.y,et.z);He=i.ak(rt[1])}const Be=!J.options.moving;return{u_matrix:ue||J.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),Be),u_image:0,u_latrange:Qm(0,Q.tileID),u_light:[oe.paint.get("hillshade-exaggeration"),He],u_shadow:ce.toRenderColor(ge?null:oe.lut),u_highlight:pe.toRenderColor(_e?null:oe.lut),u_emissive_strength:Ee,u_accent:me.toRenderColor(we?null:oe.lut)}})(d,s,h,d.terrain?t.projMatrix:null);d.uploadCommonUniforms(I,F,t.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:X,tileBoundsSegments:q}=d.getTileBoundsBuffers(s);F.draw(d,P.TRIANGLES,m,g,x,fr.disabled,B,h.id,j,X,q)}function Qa(d,t,s){if(!t.needsDEMTextureUpload)return;const h=d.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(s.stride);const g=s.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new i.T(h,g,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function t_(d,t,s){const h=d.context,m=h.gl;if(!t.dem)return;const g=t.dem;if(h.activeTexture.set(m.TEXTURE1),Qa(d,t,g),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const x=g.dim;h.activeTexture.set(m.TEXTURE0);let I=t.hillshadeFBO;if(!I){const B=new i.T(h,{width:x,height:x,data:null},m.RGBA8);B.bind(m.LINEAR,m.CLAMP_TO_EDGE),I=t.hillshadeFBO=h.createFramebuffer(x,x,!0,"renderbuffer"),I.colorAttachment.set(B.texture)}h.bindFramebuffer.set(I.framebuffer),h.viewport.set([0,0,x,x]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:z,tileBoundsSegments:L}=d.getMercatorTileBoundsBuffers(),F=[];d.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(d,m.TRIANGLES,Xt.disabled,br.disabled,Rr.unblended,fr.disabled,((B,j)=>{const X=j.stride,q=i.ad.mat4.create();return i.ad.mat4.ortho(q,0,i.ai,-i.ai,0,0,1),i.ad.mat4.translate(q,q,[0,-i.ai,0]),{u_matrix:q,u_image:1,u_dimension:[X,X],u_zoom:B.overscaledZ}})(t.tileID,g),s.id,P,z,L),t.needsHillshadePrepare=!1}class Dn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class h0 extends Dn{getDefault(){return i.al.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class d0 extends Dn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class uf extends Dn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class hf extends Dn{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class df extends Dn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class ff extends Dn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class r_ extends Dn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class n_ extends Dn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class f0 extends Dn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Gc extends Dn{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Hc extends Dn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class i_ extends Dn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ts extends Dn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class pf extends Dn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class dh extends Dn{getDefault(){return i.al.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class fh extends Dn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class mf extends Dn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class _f extends Dn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class gf extends Dn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let ph=class extends Dn{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class yf extends Dn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class vf extends Dn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class mh extends Dn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class s_ extends Dn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class o_ extends Dn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Pl extends Dn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class p0 extends Dn{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class m0 extends Dn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class _0 extends Dn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class g0 extends Dn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class y0 extends Dn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class xf extends Dn{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class bf extends xf{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _h extends xf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class a_ extends xf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Rl extends _h{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const l_=(d,t,s)=>({u_matrix:d,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:s}),wf=(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:g,u_image0:0,u_frustum_tl:x,u_frustum_tr:I,u_frustum_br:P,u_frustum_bl:z,u_globe_pos:L,u_globe_radius:F,u_viewport:B,u_grid_matrix:q?Float32Array.from(q):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:X});function Tf(d,t){return d!=null&&t!=null&&!(!d.hasData()||!t.hasData())&&d.demTexture!=null&&t.demTexture!=null&&d.tileID.key!==t.tileID.key}const va=new class{constructor(){this.operations={}}newMorphing(d,t,s,h,m){if(d in this.operations){const g=this.operations[d];g.to.tileID.key!==s.tileID.key&&(g.queued=s)}else this.operations[d]={startTime:h,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(const t in this.operations){const s=this.operations[t];for(s.phase=(d-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},xa={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Sf(d,t,s){if(t===0)return 0;const h=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-d)*Math.max(t,1)*h}function ba(d,t){const s=1<<d.z;return!t&&(d.x===0||d.x===s-1)||d.y===0||d.y===s-1}const qc=d=>({u_matrix:d});function Dl(d,t,s,h,m){if(m>0){const g=i.q.now(),x=(g-d.timeAdded)/m,I=t?(g-t.timeAdded)/m:-1,P=s.getSource(),z=h.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),F=L&&d.refreshedUponExpiration?1:i.ay(L?x:1-I,0,1);return d.refreshedUponExpiration&&x>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class c_ extends ws{constructor(t){const s={type:"raster-dem",maxzoom:t.transform.maxZoom},h=new i.D(i.cj(),null),m=Hd("mock-dem",s,h,t.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class u_ extends ws{constructor(t){const s=Hd("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new i.D(i.cj(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,h){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,x)=>{if(g[x.key]="",!this._tiles[x.key]){const I=new ma(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);I.state="loaded",this._tiles[x.key]=I}return g},{});for(const g in this._tiles)g in m||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class gh extends i.aH{constructor(t,s,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class yh extends i.cK{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,g]=function(P){const z=new i.b5,L=new i.aV,F=131;z.reserve(17161),L.reserve(33800);const B=i.ai/128,j=i.ai+B/2,X=j+B;for(let J=-B;J<X;J+=B)for(let Q=-B;Q<X;Q+=B){const oe=Q<0||Q>j||J<0||J>j?24575:0,ue=i.ay(Math.round(Q),0,i.ai),ce=i.ay(Math.round(J),0,i.ai);z.emplaceBack(ue+oe,ce)}const q=(J,Q)=>{const oe=Q*F+J;L.emplaceBack(oe+1,oe,oe+F),L.emplaceBack(oe+F,oe+F+1,oe+1)};for(let J=1;J<129;J++)for(let Q=1;Q<129;Q++)q(Q,J);return[0,129].forEach(J=>{for(let Q=0;Q<130;Q++)q(Q,J),q(J,Q)}),[z,L,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(h,i.b7.members),this.gridIndexBuffer=x.createIndexBuffer(m),this.gridSegments=i.b8.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=i.b8.simpleSegment(0,0,h.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new u_(s.map),this.orthoMatrix=i.ad.mat4.create(),i.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.ai,0,i.ai,0,1);const I=x.gl;this._overlapStencilMode=new br({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new c_(s.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,s,h){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const m=t.terrain.properties,g=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const I=t.terrain&&t.terrain.scope,P=m.get("source"),z=g?this._mockSourceCache:t.getSourceCache(P,I);if(!z)return void i.w(`Couldn't find terrain source "${P}".`);if(this.sourceCache=z,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(s):m.get("exaggeration"),!s.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(s,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),s.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,h=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=h;const m=s!=null?h-s:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const g=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(g);let I=g-this._previousZoom;const P=this._previousUpdateTimestamp;let z=g;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(g-z)>.5&&(I=.5*(g-z+I)),I*m<0&&(z+=I)),this._evaluationZoom=z;const L=x.getExaggeration(z),F=L===x.getExaggeration(Math.max(0,z-.1));if(F&&Math.abs(L-this._exaggeration)<.01)return L;let B=Math.min(.1,.00375*(this._updateTimestamp-P));return(F||L<.1||Math.abs(I)<1e-4)&&(B=Math.min(.2,4*B)),i.ah(this._exaggeration,L,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(P=>{const z=s.getTileByID(P).tileID;return z.projMatrix=h.calculateProjMatrix(z.toUnwrapped()),z});(function(P,z){const L=z.transform.pointCoordinate(z.transform.getCameraPoint()),F=new i.P(L.x,L.y);P.sort((B,j)=>{if(j.overscaledZ-B.overscaledZ)return j.overscaledZ-B.overscaledZ;const X=new i.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),q=new i.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),J=F.mult(1<<B.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(X)-J.distSqr(q)})})(m,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},m.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const P in x){const z=x[P];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,t[P],g),z.usedForTerrain))continue;const L=t[P];z.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[s.id]=m.map(P=>new gh(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const z=this.terrainTileForTile[P.key];if(!z)continue;const L=z.tileID.key;L in I||(this._visibleDemTiles.push(z),I[L]=L)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],g=m.dem;!g||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),Qa(this.painter,m,g))}}_prepareDemTileUniforms(t,s,h,m){if(!s||s.demTexture==null)return!1;const g=t.tileID.canonical,x=Math.pow(2,s.tileID.canonical.z-g.z),I=m||"";return h[`u_dem_tl${I}`]=[g.x*x%1,g.y*x%1],h[`u_dem_scale${I}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const g=m.dem.tree.minimums[0];return g>0&&t++,h+g},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),m=new i.cL({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(m,{premultiply:!1}):g=this._emptyDEMTexture=new i.T(t,m,s.R32F,{premultiply:!1}),g}setupElevationDraw(t,s,h){const m=this.painter.context,g=m.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let I=null,P=null,z=1;if(h&&h.morphing&&this._useVertexMorphing){const j=h.morphing.srcDemTile,X=h.morphing.dstDemTile;z=h.morphing.phase,j&&X&&(this._prepareDemTileUniforms(t,j,x,"_prev")&&(P=j),this._prepareDemTileUniforms(t,X,x)&&(I=X))}const L=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST;let F=null;var B;if(this.enabled?P&&I?(F=I.demTexture,m.activeTexture.set(g.TEXTURE4),P.demTexture.bind(L(P),g.CLAMP_TO_EDGE),x.u_dem_lerp=z):(I=this.terrainTileForTile[t.tileID.key],F=this._prepareDemTileUniforms(t,I,x)?I.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,m.activeTexture.set(g.TEXTURE2),F&&(x.u_dem_size=(B=F).size[0]===1?1:B.size[0]-2,F.bind(L(I),g.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,s,x),h&&h.useMeterToDem&&I){const j=(1<<I.tileID.canonical.z)*i.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=j}if(h&&h.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(m,x),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,t.tileID.canonical,h&&h.useDenormalizedUpVectorScale);s.setGlobeUniformValues(m,j)}}globeUniformValues(t,s,h){const m=t.projection;return{u_tile_tl_up:m.upVector(s,0,0),u_tile_tr_up:m.upVector(s,i.ai,0),u_tile_br_up:m.upVector(s,i.ai,i.ai),u_tile_bl_up:m.upVector(s,0,i.ai),u_tile_up_scale:h?i.cM(1):m.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,g,x,I,P){if(m.transform.projection.name==="globe")(function(z,L,F,B,j){const X=z.context,q=X.gl;let J,Q;const oe=z.transform,ue=i.cD(z,X,oe),ce=(et,rt)=>{if(Q===rt)return;const _t=[xa[rt],"PROJECTION_GLOBE_VIEW"];ue&&_t.push("CUSTOM_ANTIALIASING");const Oe=z.isTileAffectedByFog(et);J=z.getOrCreateProgram("globeRaster",{defines:_t,overrideFog:Oe}),Q=rt},ge=z.colorModeForRenderPass(),pe=new Xt(q.LEQUAL,Xt.ReadWrite,z.depthRangeFor3D);va.update(j);const _e=i.cE(oe),me=[i.av(oe.center.lng),i.aC(oe.center.lat)],we=z.globeSharedBuffers,Ee=[oe.width*i.q.devicePixelRatio,oe.height*i.q.devicePixelRatio],He=Float32Array.from(oe.globeMatrix),Be={useDenormalizedUpVectorScale:!0};{const et=z.transform,rt=Sf(et.zoom,L.exaggeration(),L.sourceCache._source.tileSize);Q=-1;const _t=q.TRIANGLES;for(const Oe of B){const Qe=F.getTile(Oe),De=br.disabled,Je=L.prevTerrainTileForTile[Oe.key],Ze=L.terrainTileForTile[Oe.key];Tf(Je,Ze)&&va.newMorphing(Oe.key,Je,Ze,j,250),X.activeTexture.set(q.TEXTURE0),Qe.texture&&Qe.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);const ot=va.getMorphValuesForProxy(Oe.key),$e=ot?1:0;ot&&i.L(Be,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:i.cC(ot.phase)}});const ct=i.cF(Oe.canonical),Tt=i.cG(ct.getCenter().lat),Mt=i.cH(Oe.canonical,ct,Tt,et.worldSize/et._pixelsPerMercatorPixel),Lt=i.bc(i.cI(Oe.canonical)),Wt=wf(et.expandedFarZProjMatrix,He,_e,Lt,i.ag(et.zoom),me,et.frustumCorners.TL,et.frustumCorners.TR,et.frustumCorners.BR,et.frustumCorners.BL,et.globeCenterInViewSpace,et.globeRadius,Ee,rt,et._farZ,Mt);if(ce(Oe,$e),J&&(L.setupElevationDraw(Qe,J,Be),z.uploadCommonUniforms(X,J,Oe.toUnwrapped()),we)){const[pr,nr,mr]=we.getGridBuffers(Tt,rt!==0);J.draw(z,_t,pe,De,ge,fr.backCCW,Wt,"globe_raster",pr,nr,mr)}}}if(we&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&et.push("CUSTOM_ANTIALIASING"),J=z.getOrCreateProgram("globeRaster",{defines:et});for(const rt of B){const{x:_t,y:Oe,z:Qe}=rt.canonical,De=Oe===0,Je=Oe===(1<<Qe)-1,[Ze,ot,$e,ct]=we.getPoleBuffers(Qe,!1);if(ct&&(De||Je)){const Tt=F.getTile(rt);X.activeTexture.set(q.TEXTURE0),Tt.texture&&Tt.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE);let Mt=i.cJ(Qe,_t,oe);const Lt=i.bc(i.cI(rt.canonical)),Wt=(pr,nr)=>pr.draw(z,q.TRIANGLES,pe,br.disabled,ge,fr.disabled,wf(oe.expandedFarZProjMatrix,Mt,Mt,Lt,0,me,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Ee,0,oe._farZ),"globe_pole_raster",nr,$e,ct);L.setupElevationDraw(Tt,J,Be),z.uploadCommonUniforms(X,J,rt.toUnwrapped()),De&&z.renderDefaultNorthPole&&Wt(J,Ze),Je&&z.renderDefaultSouthPole&&(Mt=i.ad.mat4.scale(i.ad.mat4.create(),Mt,[1,-1,1]),Wt(J,ot))}}}})(m,g,x,I,P);else{const z=m.context,L=z.gl;let F,B;const j=m.shadowRenderer,X=ga(m,m.longestCutoffRange),q=ge=>{if(B===ge)return;const pe=[];pe.push(xa[ge]),X.shouldRenderCutoff&&pe.push("RENDER_CUTOFF"),j&&(pe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&pe.push("NORMAL_OFFSET")),F=m.getOrCreateProgram("terrainRaster",{defines:pe}),B=ge},J=m.colorModeForRenderPass(),Q=new Xt(L.LEQUAL,Xt.ReadWrite,m.depthRangeFor3D);va.update(P);const oe=m.transform,ue=Sf(oe.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let ce=[0,0,0];if(j){const ge=m.style.directionalLight,pe=m.style.ambientLight;ge&&pe&&(ce=Ho(m.style,ge,pe))}{B=-1;const ge=L.TRIANGLES,[pe,_e]=[g.gridIndexBuffer,g.gridSegments];for(const me of I){const we=x.getTile(me),Ee=br.disabled,He=g.prevTerrainTileForTile[me.key],Be=g.terrainTileForTile[me.key];Tf(He,Be)&&va.newMorphing(me.key,He,Be,P,250),z.activeTexture.set(L.TEXTURE0),we.texture&&we.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const et=va.getMorphValuesForProxy(me.key),rt=et?1:0;let _t;et&&(_t={morphing:{srcDemTile:et.from,dstDemTile:et.to,phase:i.cC(et.phase)}});const Oe=l_(me.projMatrix,ba(me.canonical,oe.renderWorldCopies)?ue/10:ue,ce);if(q(rt),!F)continue;g.setupElevationDraw(we,F,_t);const Qe=me.toUnwrapped();j&&j.setupShadows(Qe,F),m.uploadCommonUniforms(z,F,Qe,null,X),F.draw(m,ge,Q,Ee,J,fr.backCCW,Oe,"terrain_raster",g.gridBuffer,pe,_e)}}}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,m=this.proxySourceCache,g=this.proxiedCoords[m.id],x=this._drapedRenderBatches.shift(),I=s.style.order,P=[];let z=0;for(const L of g){const F=m.getTileByID(L.proxyTileKey),B=m.proxyCachedFBO[L.key]?m.proxyCachedFBO[L.key][t]:void 0,j=B!==void 0?m.renderCache[B]:this.pool[z++],X=B!==void 0;if(F.texture=j.tex,X&&!j.dirty){P.push(F.tileID);continue}let q;h.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(h.clear({color:i.al.transparent,stencil:0}),j.dirty=!1);for(let J=x.start;J<=x.end;++J){const Q=s.style._mergedLayers[I[J]];if(Q.isHidden(s.transform.zoom))continue;const oe=s.style.getLayerSourceCache(Q),ue=oe?this.proxyToSource[L.key][oe.id]:[L];if(!ue)continue;const ce=ue;h.viewport.set([0,0,j.fb.width,j.fb.height]),q!==(oe?oe.id:null)&&(this._setupStencil(j,ue,Q,oe),q=oe?oe.id:null),s.renderLayer(s,oe,Q,ce)}if(this._drapedRenderBatches.length===0)for(const J of this._pendingGroundEffectLayers){const Q=s.style._mergedLayers[I[J]];if(Q.isHidden(s.transform.zoom))continue;const oe=s.style.getLayerSourceCache(Q),ue=oe?this.proxyToSource[L.key][oe.id]:[L];if(!ue)continue;const ce=ue;h.viewport.set([0,0,j.fb.width,j.fb.height]),q!==(oe?oe.id:null)&&(this._setupStencil(j,ue,Q,oe),q=oe?oe.id:null),s.renderLayer(s,oe,Q,ce)}this.renderedToTile?(j.dirty=!0,P.push(F.tileID)):X||--z,z===5&&(z=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let h=-1,m=s;for(let g=0;g<s;++g)this._style.isLayerDraped(t._mergedLayers[t.order[g]])?h=Math.max(h,g):m=Math.min(m,g);return m>h}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const x=g.tileID,I=1<<x.overscaledZ,{x:P,y:z}=x.canonical,L=P/I,F=(P+1)/I,B=z/I,j=(z+1)/I;return{minx:L,miny:B,maxx:F,maxy:j,t:g.dem.tree.raycastRoot(L,B,F,j,t,s,h),tile:g}});m.sort((g,x)=>(g.t!==null?g.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const g of m){if(g.t==null)return null;const x=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,s,h);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,s=t.gl,h=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new i.T(t,{width:h[0],height:h[1],data:null},s.RGBA8);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const g=t.createFramebuffer(h[0],h[1],!0,null);return g.colorAttachment.set(m.texture),g.depthAttachment=new Rl(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._mergedLayers[t],h=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!h&&s.shouldRedrape():!h&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const h of this._style.getSources())if(h instanceof Ni){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const m=this._style._mergedLayers[this._style.order[h]],g=this._style.getLayerSourceCache(m);if(g&&!s[g.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof i.ab){s[g.id]=!0;for(const x of this.proxyCoords){const I=this.proxyToSource[x.key][g.id];if(I)for(const P of I)this._clearRenderCacheForTile(g.id,P)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof pa){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const m=this._style._mergedLayers[this._style.order[h]],g=this._style.getLayerSourceCache(m);if(!g||s[g.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const x=m.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const P=this.proxyToSource[I.key][g.id];if(P)for(const z of P){const L=Dl(g.getTile(z),g.findLoadedParent(z,0),g,this.painter.transform,x);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(g.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const h=[];this._pendingGroundEffectLayers=[];let m,g=0,x=this._style._mergedLayers[t[g]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++g<s;)x=this._style._mergedLayers[t[g]];for(;g<s;++g){const I=this._style._mergedLayers[t[g]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?m===void 0&&(m=g):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),m!==void 0&&(h.push({start:m,end:g-1}),m=void 0)))}if(m!==void 0&&h.push({start:m,end:g-1}),h.length!==0){const I=h[h.length-1];this._pendingGroundEffectLayers.every(P=>P>I.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const x=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let I=0;I<x.length;++I){const P=Object.values(x[I]);s.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let x=h.length-1;x>=0;x--){const I=h[x];if(s.getTileByID(I.key),s.proxyCachedFBO[I.key]!==void 0){const P=t[I.key],z=this.proxyToSource[I.key];let L=0;for(const F in z){const B=z[F],j=P[F];if(!j||j.length!==B.length||B.some((X,q)=>X!==j[q]||m[F]&&m[F].hasOwnProperty(X.key))){L=-1;break}++L}for(const F in s.proxyCachedFBO[I.key])s.renderCache[s.proxyCachedFBO[I.key][F]].dirty=L<0||L!==Object.values(P).length}}const g=[...this._drapedRenderBatches];g.sort((x,I)=>I.end-I.start-(x.end-x.start));for(const x of g)for(const I of h){if(s.proxyCachedFBO[I.key])continue;let P=s.renderCachePool.pop();P===void 0&&s.renderCache.length<50&&(P=s.renderCache.length,s.renderCache.push(this._createFBO())),P!==void 0&&(s.proxyCachedFBO[I.key]={},s.proxyCachedFBO[I.key][x.start]=P,s.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,x=g.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let I;if(h.isTileClipped())I=s.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):br.disabled}_renderTileClippingMasks(t,s){const h=this.painter,m=this.painter.context,g=m.gl;h._tileClippingMaskIDs={},m.setColorMode(Rr.disabled),m.setDepthMode(Xt.disabled);const x=h.getOrCreateProgram("clippingMask");for(const I of t){const P=h._tileClippingMaskIDs[I.key]=--s;x.draw(h,g.TRIANGLES,Xt.disabled,new br({func:g.ALWAYS,mask:0},P,255,g.KEEP,g.KEEP,g.REPLACE),Rr.disabled,fr.disabled,qc(I.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const h=[t.x,t.y,1,1];i.ad.vec4.transformMat4(h,h,s.pixelMatrixInverse),i.ad.vec4.scale(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const m=s._camera.position,g=i.bH(1,s.center.lat),x=[m[0],m[1],m[2]/g,0],I=i.ad.vec3.subtract([],h.slice(0,3),x);i.ad.vec3.normalize(I,I);const P=this.raycast(x,I,this._exaggeration);return P!==null&&P?(i.ad.vec3.scaleAndAdd(x,x,I,P),x[3]=x[2],x[2]*=g,x):null}_setupProxiedCoordsForOrtho(t,s,h){if(t.getSource()instanceof i.aK)return this._setupProxiedCoordsForImageSource(t,s,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let P=0;P<g.length;P++){const z=g[P],L=this._findTileCoveringTileID(z,t);if(L){const F=this._createProxiedId(z,L,h[z.key]&&h[z.key][t.id]);m.push(F),this.proxyToSource[z.key][t.id]=[F]}}let x=!1;const I=new Set;for(let P=0;P<s.length;P++){const z=t.getTile(s[P]);if(!z||!z.hasData())continue;const L=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==z.tileID.canonical.z){const F=this.proxyToSource[L.tileID.key][t.id],B=this._createProxiedId(L.tileID,z,h[L.tileID.key]&&h[L.tileID.key][t.id]);F?F.splice(F.length-1,0,B):this.proxyToSource[L.tileID.key][t.id]=[B];const j=this.proxyToSource[L.tileID.key][t.id];I.has(j)||I.add(j),m.push(B),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const P of I)P.sort((z,L)=>L.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(t,s,h){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords,x=t.getSource(),I=x.tileID;if(!I)return;const P=new i.P(I.x,I.y)._div(1<<I.z),z=x.coordinates.map(i.ac.fromLngLat).reduce((F,B)=>(F.min.x=Math.min(F.min.x,B.x-P.x),F.min.y=Math.min(F.min.y,B.y-P.y),F.max.x=Math.max(F.max.x,B.x-P.x),F.max.y=Math.max(F.max.y,B.y-P.y),F),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(F,B)=>{const j=F.wrap+F.canonical.x/(1<<F.canonical.z),X=F.canonical.y/(1<<F.canonical.z),q=i.ai/(1<<F.canonical.z),J=B.wrap+B.canonical.x/(1<<B.canonical.z),Q=B.canonical.y/(1<<B.canonical.z);return j+q<J+z.min.x||j>J+z.max.x||X+q<Q+z.min.y||X>Q+z.max.y};for(let F=0;F<g.length;F++){const B=g[F];for(let j=0;j<s.length;j++){const X=t.getTile(s[j]);if(!X||!X.hasData()||L(B,X.tileID))continue;const q=this._createProxiedId(B,X,h[B.key]&&h[B.key][t.id]),J=this.proxyToSource[B.key][t.id];J?J.push(q):this.proxyToSource[B.key][t.id]=[q],m.push(q)}}}_createProxiedId(t,s,h){let m=this.orthoMatrix;if(h){const g=h.find(x=>x.key===s.tileID.key);if(g)return g}if(s.tileID.key!==t.key){const g=t.canonical.z-s.tileID.canonical.z;let x,I,P;m=i.ad.mat4.create();const z=s.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(x=i.ai>>g,I=x*((s.tileID.canonical.x<<g)-t.canonical.x+z),P=x*((s.tileID.canonical.y<<g)-t.canonical.y)):(x=i.ai<<-g,I=i.ai*(s.tileID.canonical.x-(t.canonical.x+z<<-g)),P=i.ai*(s.tileID.canonical.y-(t.canonical.y<<-g))),i.ad.mat4.ortho(m,0,x,0,x,0,1),i.ad.mat4.translate(m,m,[I,P,0])}return new gh(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let h=s.getTile(t);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[s.id],g=m[t.key];if(h=g?s.getTileByID(g):null,h&&h.hasData()||g===null)return h;let x=h?h.tileID:t,I=x.overscaledZ;const P=s.getSource().minzoom,z=[];if(!g){const F=s.getSource().maxzoom;if(t.canonical.z>=F){const B=t.canonical.z-F;s.getSource().reparseOverscaled?(I=Math.max(t.canonical.z+2,s.transform.tileZoom),x=new i.aH(I,t.wrap,F,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(I=F,x=new i.aH(I,t.wrap,F,t.canonical.x>>B,t.canonical.y>>B))}x.key!==t.key&&(z.push(x.key),h=s.getTile(x))}const L=F=>{z.forEach(B=>{m[B]=F}),z.length=0};for(I-=1;I>=P&&(!h||!h.hasData());I--){h&&L(h.tileID.key);const F=x.calculateScaledKey(I);if(h=s.getTileByID(F),h&&h.hasData())break;const B=m[F];if(B===null)break;B===void 0?z.push(F):h=s.getTileByID(B)}return L(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[s.key]=!0}}function v0(d,t,s){const h=function(I,P,z){const L=i.ad.vec3.dot(P,I),F=i.ad.vec3.dot(z,[.2126,.7152,.0722]),B=(X,q,J)=>(1-J)*X+J*q,j=B(1-.3*Math.min(F,1),1,Math.min(L+1,1));return B(.92,1,Math.asin(i.ay(P[2],-1,1))/Math.PI+.5)*j}(d,[0,0,1],t),m=[0,0,0];i.ad.vec3.scale(m,s.slice(0,3),h);const g=[0,0,0];i.ad.vec3.scale(g,t.slice(0,3),d[2]);const x=[0,0,0];return i.ad.vec3.add(x,m,g),i.cg(x)}const h_=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Wc=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class d_{static cacheKey(t,s,h,m){let g=`${s}${m?m.cacheKey:""}`;for(const x of h)t.usedDefines.includes(x)&&(g+=`/${x}`);return g}constructor(t,s,h,m,g,x){const I=t.gl;this.program=I.createProgram(),this.configuration=m,this.name=s,this.fixedDefines=[...x];const P=m?m.getBinderAttributes():[],z=(h.staticAttributes||[]).concat(P);let L=m?m.defines():[];L=L.concat(x.map(J=>`#define ${J}`));const F=`#version 300 es
`;let B=F+L.concat("precision mediump float;",cf,uh.fragmentSource).join(`
`);for(const J of h.fragmentIncludes)B+=`
${qo[J]}`;B+=`
${h.fragmentSource}`;let j=F+L.concat("precision highp float;",cf,uh.vertexSource).join(`
`);for(const J of h.vertexIncludes)j+=`
${qo[J]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&h.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(j+=`
uniform int u_instanceID;
`),j+=`
${h.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(j=j.replaceAll("gl_InstanceID","u_instanceID"));const X=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(X,B),I.compileShader(X),I.attachShader(this.program,X);const q=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(q,j),I.compileShader(q),I.attachShader(this.program,q),this.attributes={},this.numAttributes=z.length;for(let J=0;J<this.numAttributes;J++)if(z[J]){const Q=z[J].startsWith("a_")?z[J]:`a_${z[J]}`;I.bindAttribLocation(this.program,J,Q),this.attributes[Q]=J}I.linkProgram(this.program),I.deleteShader(q),I.deleteShader(X),this.fixedUniforms=g(t),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(J=>({u_instanceID:new i.bN(J)}))(t)),(x.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(J=>({u_dem:new i.bN(J),u_dem_prev:new i.bN(J),u_dem_tl:new i.bK(J),u_dem_scale:new i.bM(J),u_dem_tl_prev:new i.bK(J),u_dem_scale_prev:new i.bM(J),u_dem_size:new i.bM(J),u_dem_lerp:new i.bM(J),u_exaggeration:new i.bM(J),u_depth:new i.bN(J),u_depth_size_inv:new i.bK(J),u_depth_range_unpack:new i.bK(J),u_occluder_half_size:new i.bM(J),u_occlusion_depth_offset:new i.bM(J),u_meter_to_dem:new i.bM(J),u_label_plane_matrix_inv:new i.bJ(J)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new i.bL(J),u_tile_tr_up:new i.bL(J),u_tile_br_up:new i.bL(J),u_tile_bl_up:new i.bL(J),u_tile_up_scale:new i.bM(J)}))(t)),x.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new i.bJ(J),u_fog_range:new i.bK(J),u_fog_color:new i.cb(J),u_fog_horizon_blend:new i.bM(J),u_fog_vertical_limit:new i.bK(J),u_fog_temporal_offset:new i.bM(J),u_frustum_tl:new i.bL(J),u_frustum_tr:new i.bL(J),u_frustum_br:new i.bL(J),u_frustum_bl:new i.bL(J),u_globe_pos:new i.bL(J),u_globe_radius:new i.bM(J),u_globe_transition:new i.bM(J),u_is_globe:new i.bN(J),u_viewport:new i.bK(J)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new i.cb(J)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new i.bL(J),u_lighting_directional_dir:new i.bL(J),u_lighting_directional_color:new i.bL(J),u_ground_radiance:new i.bL(J)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new i.bJ(J),u_light_matrix_1:new i.bJ(J),u_fade_range:new i.bK(J),u_shadow_normal_offset:new i.bL(J),u_shadow_intensity:new i.bM(J),u_shadow_texel_size:new i.bM(J),u_shadow_map_resolution:new i.bM(J),u_shadow_direction:new i.bL(J),u_shadow_bias:new i.bL(J),u_shadowmap_0:new i.bN(J),u_shadowmap_1:new i.bN(J)}))(t))}}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m]&&h[m].set(this.program,m,s[m])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m]&&h[m].set(this.program,m,s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}_drawDebugWireframe(t,s,h,m,g,x,I,P,z,L){const F=t.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const B=t.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||t._terrain&&t._terrain.renderingToTexture||!h_.includes(this.name))||!(!F.layers3D||!Wc.includes(this.name))))return;const j=B.gl,X=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,g,B);if(!X)return;const q=[...this.fixedDefines];q.push("DEBUG_WIREFRAME");const J=t.getOrCreateProgram(this.name,{config:this.configuration,defines:q});B.program.set(J.program);const Q=(ce,ge,pe)=>{if(ge[ce]&&pe[ce])for(const _e in ge[ce])pe[ce][_e]&&pe[ce][_e].set(pe.program,_e,ge[ce][_e].current)};z&&z.setUniforms(J.program,B,J.binderUniforms,I,{zoom:P}),Q("fixedUniforms",this,J),Q("terrainUniforms",this,J),Q("globeUniforms",this,J),Q("fogUniforms",this,J),Q("lightsUniforms",this,J),Q("shadowUniforms",this,J),X.bind(),B.setColorMode(new Rr([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],i.al.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Xt(s.func===j.LESS?j.LEQUAL:s.func,Xt.ReadOnly,s.range)),B.setStencilMode(br.disabled);const oe=3*x.primitiveLength*2,ue=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=L||1;for(let ge=0;ge<ce;++ge)J.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),j.drawElements(j.LINES,oe,j.UNSIGNED_SHORT,ue)}else L&&L>1?j.drawElementsInstanced(j.LINES,oe,j.UNSIGNED_SHORT,ue,L):j.drawElements(j.LINES,oe,j.UNSIGNED_SHORT,ue);g.bind(),B.program.set(this.program),B.setDepthMode(s),B.setStencilMode(h),B.setColorMode(m)}checkUniforms(t,s,h){if(this.fixedDefines.includes(s)){for(const m of Object.keys(h))if(!h[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${s} being defined`)}}draw(t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J){const Q=t.context,oe=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(h),Q.setStencilMode(m),Q.setColorMode(g),Q.setCullFace(x);for(const ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,I[ge]);X&&X.setUniforms(this.program,Q,this.binderUniforms,B,{zoom:j});const ue={[oe.POINTS]:1,[oe.LINES]:2,[oe.TRIANGLES]:3,[oe.LINE_STRIP]:1}[s];this.checkUniforms(P,"RENDER_SHADOWS",this.shadowUniforms);const ce=J&&J>0?1:void 0;for(const ge of F.get()){const pe=ge.vaos||(ge.vaos={});if((pe[P]||(pe[P]=new Jm)).bind(Q,this,z,X?X.getPaintVertexBuffers():[],L,ge.vertexOffset,q||[],ce),this.forceManualRenderingForInstanceIDShaders){const _e=J||1;for(let me=0;me<_e;++me)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",me),L?oe.drawElements(s,ge.primitiveLength*ue,oe.UNSIGNED_SHORT,ge.primitiveOffset*ue*2):oe.drawArrays(s,ge.vertexOffset,ge.vertexLength)}else J&&J>1?oe.drawElementsInstanced(s,ge.primitiveLength*ue,oe.UNSIGNED_SHORT,ge.primitiveOffset*ue*2,J):L?oe.drawElements(s,ge.primitiveLength*ue,oe.UNSIGNED_SHORT,ge.primitiveOffset*ue*2):oe.drawArrays(s,ge.vertexOffset,ge.vertexLength);s===oe.TRIANGLES&&L&&this._drawDebugWireframe(t,h,m,g,L,ge,B,j,X,J)}}}function f_(d,t){const s=Math.pow(2,t.tileID.overscaledZ),h=t.tileSize*Math.pow(2,d.transform.tileZoom)/s,m=h*(t.tileID.canonical.x+t.tileID.wrap*s),g=h*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.at(t,1,d.transform.tileZoom),u_pixel_coord_upper:[m>>16,g>>16],u_pixel_coord_lower:[65535&m,65535&g]}}const Zc={terrain:0,flat:1},x0=i.ad.mat4.create(),vh=(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q)=>{const oe=t.style.light,ue=oe.properties.get("position"),ce=[ue.x,ue.y,ue.z],ge=i.ad.mat3.create();oe.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(ge,-t.transform.angle),i.ad.vec3.transformMat3(ce,ce,ge));const pe=oe.properties.get("color"),_e=t.transform,me={u_matrix:d,u_lightpos:ce,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:x0,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Zc[z],u_base_type:Zc[L],u_ao:m,u_edge_radius:g,u_width_scale:x,u_flood_light_color:X,u_vertical_scale:q,u_flood_light_intensity:J,u_ground_shadow_factor:Q};return _e.projection.name==="globe"&&(me.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],me.u_zoom_transition=F,me.u_inv_rot_matrix=j,me.u_merc_center=B,me.u_up_dir=_e.projection.upVector(new i.bT(0,0,0),B[0]*i.ai,B[1]*i.ai),me.u_height_lift=P),me},Ef=(d,t,s,h,m,g)=>({u_matrix:d,u_edge_radius:t,u_width_scale:s,u_vertical_scale:h,u_height_type:Zc[m],u_base_type:Zc[g]}),zl=(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J)=>{const Q=vh(d,t,s,h,m,g,x,I,z,L,F,B,j,X,q,J,1,[0,0,0]),oe={u_height_factor:-Math.pow(2,I.overscaledZ)/P.tileSize/8};return i.l(Q,f_(t,P),oe)},xh=(d,t)=>({u_matrix:d,u_emissive_strength:t}),Ll=(d,t,s,h)=>i.l(xh(d,t),f_(s,h)),p_=(d,t,s)=>({u_matrix:d,u_world:s,u_emissive_strength:t}),bh=(d,t,s,h,m)=>i.l(Ll(d,t,s,h),{u_world:m}),Ol=(d,t,s,h,m)=>({u_matrix:d,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:h,u_reset_depth:m}),Af=(d,t,s,h)=>{const m=i.ai/s.tileSize;return{u_matrix:d,u_camera_to_center_distance:t.getCameraToCenterDistance(h),u_extrude_scale:[t.pixelsToGLUnits[0]/m,t.pixelsToGLUnits[1]/m]}},Mf=(d,t,s=1)=>({u_matrix:d,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),b0=i.ad.mat4.create(),kl=(d,t,s,h,m,g,x)=>{const I=d.transform,P=I.projection.name==="globe",z=P?i.cO(I.zoom,t.canonical)*I._pixelsPerMercatorPixel:i.at(s,1,g),L={u_matrix:t.projMatrix,u_extrude_scale:z,u_intensity:x,u_inv_rot_matrix:b0,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){L.u_inv_rot_matrix=h,L.u_merc_center=m,L.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],L.u_zoom_transition=i.ag(I.zoom);const F=m[0]*i.ai,B=m[1]*i.ai;L.u_up_dir=I.projection.upVector(new i.bT(0,0,0),F,B)}return L};function Xc(d,[t,s,h,m],[g,x]){if(g===x)return[0,0,0,0];const I=255*(d-1)/(d*(x-g));return[t*I,s*I,h*I,m*I]}function Ft(d,t,[s,h]){return s===h?0:.5/d+(t-s)*(d-1)/(d*(h-s))}const If=(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe,ue,ce)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:z,u_fade_t:L.mix,u_opacity:L.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:i.cP(F.paint.get("raster-saturation")),u_contrast_factor:i.cQ(F.paint.get("raster-contrast")),u_spin_weights:m_(F.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:j,u_zoom_transition:x,u_merc_center:I,u_cutoff_params:P,u_colorization_mix:Xc(i.cR,q,Q),u_colorization_offset:Ft(i.cR,J,Q),u_color_ramp:X,u_texture_offset:[ue/(oe+2*ue),oe/(oe+2*ue)],u_texture_res:[oe+2*ue,oe+2*ue],u_emissive_strength:ce});function m_(d){d*=Math.PI/180;const t=Math.sin(d),s=Math.cos(d);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Ss=.05,wa=(d,t,s,h,m,g,x,I,P,z,L,F)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:z,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:x,u_merc_center:I,u_cutoff_params:P}),Qt=(d,t,s,h,m,g,x,I,P,z)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:h,u_color_ramp:g,u_velocity_res:m,u_max_speed:x,u_uv_offset:I,u_data_scale:[255*P[0],255*P[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ss,Ss]}),Cf=(d,t,s,h,m,g,x,I,P,z)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:h,u_max_speed:m,u_speed_factor:g,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*P[0],255*P[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ss,Ss]}),__=i.ad.mat4.create(),g_=(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe,ue,ce,ge)=>{const pe=m.transform,_e={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:pe.getCameraToCenterDistance(oe),u_rotate_symbol:+s,u_aspect_ratio:pe.width/pe.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:I,u_is_text:+z,u_elevation_from_sea:P?1:0,u_pitch_with_map:+h,u_texsize:L,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:__,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:__,u_up_vector:[0,-1,0],u_color_adj_mat:ue,u_icon_transition:ce||0,u_gamma_scale:h?m.transform.getCameraToCenterDistance(oe)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:ge||1};return oe.name==="globe"&&(_e.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],_e.u_zoom_transition=X,_e.u_inv_rot_matrix=J,_e.u_merc_center=q,_e.u_camera_forward=pe._camera.forward(),_e.u_ecef_origin=i.cS(pe.globeMatrix,j.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(pe.globeMatrix),_e.u_up_vector=Q),_e},wh=(d,t,s,h)=>({u_matrix:d,u_emissive_strength:t,u_opacity:s,u_color:h}),Pf=(d,t,s,h,m,g,x,I,P)=>i.l(function(z,L,F,B,j,X){const{width:q,height:J}=B.imageManager.getPixelSize(L),Q=Math.pow(2,X.tileID.overscaledZ),oe=X.tileSize*Math.pow(2,B.transform.tileZoom)/Q,ue=oe*(X.tileID.canonical.x+X.tileID.wrap*Q),ce=oe*X.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[q,J],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:j?[B.transform.width,-1*B.transform.height]:[1/i.at(X,1,B.transform.tileZoom),1/i.at(X,1,B.transform.tileZoom)],u_pixel_coord_upper:[ue>>16,ce>>16],u_pixel_coord_lower:[65535&ue,65535&ce]}}(0,g,x,h,I,P),{u_matrix:d,u_emissive_strength:t,u_opacity:s}),Rf=new Float32Array(i.ad.mat4.identity([])),Th=(d,t,s,h,m,g,x,I,P,z,L,F,B,j=[0,0,0],X)=>{const q=m.style.light,J=q.properties.get("position"),Q=[-J.x,-J.y,J.z],oe=i.ad.mat3.create();q.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(oe,-m.transform.angle),i.ad.vec3.transformMat3(Q,Q,oe));const ue=L.alphaMode==="MASK",ce=q.properties.get("color").toRenderColor(null),ge=B.paint.get("model-ambient-occlusion-intensity"),pe=B.paint.get("model-color").constantOr(i.al.white).toRenderColor(null),_e=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:h||Rf,u_lightpos:Q,u_lightintensity:q.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:j,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+ue,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[I[0],I[1],I[2],1],u_metallicFactor:P,u_roughnessFactor:z,u_baseColorTexture:Ri.BaseColor,u_metallicRoughnessTexture:Ri.MetallicRoughness,u_normalTexture:Ri.Normal,u_occlusionTexture:Ri.Occlusion,u_emissionTexture:Ri.Emission,u_lutTexture:Ri.LUT,u_color_mix:[pe.r,pe.g,pe.b,_e],u_aoIntensity:ge,u_emissive_strength:F,u_occlusionTextureTransform:X||[0,0,0,0]}},y_=(d,t=Rf,s=Rf)=>({u_matrix:d,u_instance:t,u_node_matrix:s}),w0={fillExtrusion:d=>({u_matrix:new i.bJ(d),u_lightpos:new i.bL(d),u_lightintensity:new i.bM(d),u_lightcolor:new i.bL(d),u_vertical_gradient:new i.bM(d),u_opacity:new i.bM(d),u_edge_radius:new i.bM(d),u_width_scale:new i.bM(d),u_ao:new i.bK(d),u_height_type:new i.bN(d),u_base_type:new i.bN(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_up_dir:new i.bL(d),u_height_lift:new i.bM(d),u_flood_light_color:new i.bL(d),u_vertical_scale:new i.bM(d),u_flood_light_intensity:new i.bM(d),u_ground_shadow_factor:new i.bL(d)}),fillExtrusionDepth:d=>({u_matrix:new i.bJ(d),u_edge_radius:new i.bM(d),u_width_scale:new i.bM(d),u_vertical_scale:new i.bM(d),u_height_type:new i.bN(d),u_base_type:new i.bN(d)}),fillExtrusionPattern:d=>({u_matrix:new i.bJ(d),u_lightpos:new i.bL(d),u_lightintensity:new i.bM(d),u_lightcolor:new i.bL(d),u_vertical_gradient:new i.bM(d),u_height_factor:new i.bM(d),u_edge_radius:new i.bM(d),u_width_scale:new i.bM(d),u_ao:new i.bK(d),u_height_type:new i.bN(d),u_base_type:new i.bN(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_up_dir:new i.bL(d),u_height_lift:new i.bM(d),u_image:new i.bN(d),u_texsize:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_tile_units_to_pixels:new i.bM(d),u_opacity:new i.bM(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new i.bJ(d),u_opacity:new i.bM(d),u_ao_pass:new i.bM(d),u_meter_to_tile:new i.bM(d),u_ao:new i.bK(d),u_flood_light_intensity:new i.bM(d),u_flood_light_color:new i.bL(d),u_attenuation:new i.bM(d),u_edge_radius:new i.bM(d),u_fb:new i.bN(d),u_fb_size:new i.bM(d),u_dynamic_offset:new i.bM(d)}),fill:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d)}),fillPattern:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_image:new i.bN(d),u_texsize:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_tile_units_to_pixels:new i.bM(d)}),fillOutline:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_world:new i.bK(d)}),fillOutlinePattern:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_world:new i.bK(d),u_image:new i.bN(d),u_texsize:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_tile_units_to_pixels:new i.bM(d)}),elevatedStructures:d=>({u_matrix:new i.bJ(d)}),elevatedStructuresDepthReconstruct:d=>({u_matrix:new i.bJ(d),u_camera_pos:new i.bL(d),u_depth_bias:new i.bM(d),u_height_scale:new i.bM(d),u_reset_depth:new i.bM(d)}),circle:i.cT,collisionBox:d=>({u_matrix:new i.bJ(d),u_camera_to_center_distance:new i.bM(d),u_extrude_scale:new i.bK(d)}),collisionCircle:d=>({u_matrix:new i.bJ(d),u_inv_matrix:new i.bJ(d),u_camera_to_center_distance:new i.bM(d),u_viewport_size:new i.bK(d)}),debug:d=>({u_color:new i.cA(d),u_matrix:new i.bJ(d),u_overlay:new i.bN(d),u_overlay_scale:new i.bM(d)}),clippingMask:d=>({u_matrix:new i.bJ(d)}),heatmap:d=>({u_extrude_scale:new i.bM(d),u_intensity:new i.bM(d),u_matrix:new i.bJ(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_up_dir:new i.bL(d)}),heatmapTexture:d=>({u_image:new i.bN(d),u_color_ramp:new i.bN(d),u_opacity:new i.bM(d)}),hillshade:d=>({u_matrix:new i.bJ(d),u_image:new i.bN(d),u_latrange:new i.bK(d),u_light:new i.bK(d),u_shadow:new i.cA(d),u_highlight:new i.cA(d),u_emissive_strength:new i.bM(d),u_accent:new i.cA(d)}),hillshadePrepare:d=>({u_matrix:new i.bJ(d),u_image:new i.bN(d),u_dimension:new i.bK(d),u_zoom:new i.bM(d)}),line:i.cU,linePattern:i.cV,raster:d=>({u_matrix:new i.bJ(d),u_normalize_matrix:new i.bJ(d),u_globe_matrix:new i.bJ(d),u_merc_matrix:new i.bJ(d),u_grid_matrix:new i.cB(d),u_tl_parent:new i.bK(d),u_scale_parent:new i.bM(d),u_fade_t:new i.bM(d),u_opacity:new i.bM(d),u_image0:new i.bN(d),u_image1:new i.bN(d),u_brightness_low:new i.bM(d),u_brightness_high:new i.bM(d),u_saturation_factor:new i.bM(d),u_contrast_factor:new i.bM(d),u_spin_weights:new i.bL(d),u_perspective_transform:new i.bK(d),u_raster_elevation:new i.bM(d),u_zoom_transition:new i.bM(d),u_merc_center:new i.bK(d),u_cutoff_params:new i.cb(d),u_colorization_mix:new i.cb(d),u_colorization_offset:new i.bM(d),u_color_ramp:new i.bN(d),u_texture_offset:new i.bK(d),u_texture_res:new i.bK(d),u_emissive_strength:new i.bM(d)}),rasterParticle:d=>({u_matrix:new i.bJ(d),u_normalize_matrix:new i.bJ(d),u_globe_matrix:new i.bJ(d),u_merc_matrix:new i.bJ(d),u_grid_matrix:new i.cB(d),u_tl_parent:new i.bK(d),u_scale_parent:new i.bM(d),u_fade_t:new i.bM(d),u_opacity:new i.bM(d),u_image0:new i.bN(d),u_image1:new i.bN(d),u_raster_elevation:new i.bM(d),u_zoom_transition:new i.bM(d),u_merc_center:new i.bK(d),u_cutoff_params:new i.cb(d)}),rasterParticleTexture:d=>({u_texture:new i.bN(d),u_opacity:new i.bM(d)}),rasterParticleDraw:d=>({u_particle_texture:new i.bN(d),u_particle_texture_side_len:new i.bM(d),u_tile_offset:new i.bK(d),u_velocity:new i.bN(d),u_color_ramp:new i.bN(d),u_velocity_res:new i.bK(d),u_max_speed:new i.bM(d),u_uv_offset:new i.bK(d),u_data_scale:new i.bK(d),u_data_offset:new i.bM(d),u_particle_pos_scale:new i.bM(d),u_particle_pos_offset:new i.bK(d)}),rasterParticleUpdate:d=>({u_particle_texture:new i.bN(d),u_particle_texture_side_len:new i.bM(d),u_velocity:new i.bN(d),u_velocity_res:new i.bK(d),u_max_speed:new i.bM(d),u_speed_factor:new i.bM(d),u_reset_rate:new i.bM(d),u_rand_seed:new i.bM(d),u_uv_offset:new i.bK(d),u_data_scale:new i.bK(d),u_data_offset:new i.bM(d),u_particle_pos_scale:new i.bM(d),u_particle_pos_offset:new i.bK(d)}),symbol:d=>({u_is_size_zoom_constant:new i.bN(d),u_is_size_feature_constant:new i.bN(d),u_size_t:new i.bM(d),u_size:new i.bM(d),u_camera_to_center_distance:new i.bM(d),u_rotate_symbol:new i.bN(d),u_aspect_ratio:new i.bM(d),u_fade_change:new i.bM(d),u_matrix:new i.bJ(d),u_label_plane_matrix:new i.bJ(d),u_coord_matrix:new i.bJ(d),u_is_text:new i.bN(d),u_elevation_from_sea:new i.bN(d),u_pitch_with_map:new i.bN(d),u_texsize:new i.bK(d),u_texsize_icon:new i.bK(d),u_texture:new i.bN(d),u_texture_icon:new i.bN(d),u_gamma_scale:new i.bM(d),u_device_pixel_ratio:new i.bM(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_camera_forward:new i.bL(d),u_tile_matrix:new i.bJ(d),u_up_vector:new i.bL(d),u_ecef_origin:new i.bL(d),u_is_halo:new i.bN(d),u_icon_transition:new i.bM(d),u_color_adj_mat:new i.bJ(d),u_scale_factor:new i.bM(d)}),background:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_opacity:new i.bM(d),u_color:new i.cA(d)}),backgroundPattern:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_opacity:new i.bM(d),u_image:new i.bN(d),u_pattern_tl:new i.bK(d),u_pattern_br:new i.bK(d),u_texsize:new i.bK(d),u_pattern_size:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_pattern_units_to_pixels:new i.bK(d)}),terrainRaster:d=>({u_matrix:new i.bJ(d),u_image0:new i.bN(d),u_skirt_height:new i.bM(d),u_ground_shadow_factor:new i.bL(d)}),skybox:d=>({u_matrix:new i.bJ(d),u_sun_direction:new i.bL(d),u_cubemap:new i.bN(d),u_opacity:new i.bM(d),u_temporal_offset:new i.bM(d)}),skyboxGradient:d=>({u_matrix:new i.bJ(d),u_color_ramp:new i.bN(d),u_center_direction:new i.bL(d),u_radius:new i.bM(d),u_opacity:new i.bM(d),u_temporal_offset:new i.bM(d)}),skyboxCapture:d=>({u_matrix_3f:new i.cB(d),u_sun_direction:new i.bL(d),u_sun_intensity:new i.bM(d),u_color_tint_r:new i.cb(d),u_color_tint_m:new i.cb(d),u_luminance:new i.bM(d)}),globeRaster:d=>({u_proj_matrix:new i.bJ(d),u_globe_matrix:new i.bJ(d),u_normalize_matrix:new i.bJ(d),u_merc_matrix:new i.bJ(d),u_zoom_transition:new i.bM(d),u_merc_center:new i.bK(d),u_image0:new i.bN(d),u_grid_matrix:new i.cB(d),u_skirt_height:new i.bM(d),u_far_z_cutoff:new i.bM(d),u_frustum_tl:new i.bL(d),u_frustum_tr:new i.bL(d),u_frustum_br:new i.bL(d),u_frustum_bl:new i.bL(d),u_globe_pos:new i.bL(d),u_globe_radius:new i.bM(d),u_viewport:new i.bK(d)}),globeAtmosphere:d=>({u_frustum_tl:new i.bL(d),u_frustum_tr:new i.bL(d),u_frustum_br:new i.bL(d),u_frustum_bl:new i.bL(d),u_horizon:new i.bM(d),u_transition:new i.bM(d),u_fadeout_range:new i.bM(d),u_color:new i.cb(d),u_high_color:new i.cb(d),u_space_color:new i.cb(d),u_temporal_offset:new i.bM(d),u_horizon_angle:new i.bM(d)}),model:d=>({u_matrix:new i.bJ(d),u_lighting_matrix:new i.bJ(d),u_normal_matrix:new i.bJ(d),u_node_matrix:new i.bJ(d),u_lightpos:new i.bL(d),u_lightintensity:new i.bM(d),u_lightcolor:new i.bL(d),u_camera_pos:new i.bL(d),u_opacity:new i.bM(d),u_baseColorFactor:new i.cb(d),u_emissiveFactor:new i.cb(d),u_metallicFactor:new i.bM(d),u_roughnessFactor:new i.bM(d),u_baseTextureIsAlpha:new i.bN(d),u_alphaMask:new i.bN(d),u_alphaCutoff:new i.bM(d),u_baseColorTexture:new i.bN(d),u_metallicRoughnessTexture:new i.bN(d),u_normalTexture:new i.bN(d),u_occlusionTexture:new i.bN(d),u_emissionTexture:new i.bN(d),u_lutTexture:new i.bN(d),u_color_mix:new i.cb(d),u_aoIntensity:new i.bM(d),u_emissive_strength:new i.bM(d),u_occlusionTextureTransform:new i.cb(d)}),modelDepth:d=>({u_matrix:new i.bJ(d),u_instance:new i.bJ(d),u_node_matrix:new i.bJ(d)}),groundShadow:d=>({u_matrix:new i.bJ(d),u_ground_shadow_factor:new i.bL(d)}),stars:d=>({u_matrix:new i.bJ(d),u_up:new i.bL(d),u_right:new i.bL(d),u_intensity_multiplier:new i.bM(d)}),snowParticle:d=>({u_modelview:new i.bJ(d),u_projection:new i.bJ(d),u_time:new i.bM(d),u_cam_pos:new i.bL(d),u_velocityConeAperture:new i.bM(d),u_velocity:new i.bM(d),u_horizontalOscillationRadius:new i.bM(d),u_horizontalOscillationRate:new i.bM(d),u_boxSize:new i.bM(d),u_billboardSize:new i.bM(d),u_simpleShapeParameters:new i.bK(d),u_screenSize:new i.bK(d),u_thinningCenterPos:new i.bK(d),u_thinningShape:new i.bL(d),u_thinningAffectedRatio:new i.bM(d),u_thinningParticleOffset:new i.bM(d),u_particleColor:new i.cb(d),u_direction:new i.bL(d)}),rainParticle:d=>({u_modelview:new i.bJ(d),u_projection:new i.bJ(d),u_time:new i.bM(d),u_cam_pos:new i.bL(d),u_texScreen:new i.bN(d),u_velocityConeAperture:new i.bM(d),u_velocity:new i.bM(d),u_boxSize:new i.bM(d),u_rainDropletSize:new i.bK(d),u_distortionStrength:new i.bM(d),u_rainDirection:new i.bL(d),u_color:new i.cb(d),u_screenSize:new i.bK(d),u_thinningCenterPos:new i.bK(d),u_thinningShape:new i.bL(d),u_thinningAffectedRatio:new i.bM(d),u_thinningParticleOffset:new i.bM(d),u_shapeDirectionalPower:new i.bM(d),u_shapeNormalPower:new i.bM(d),u_mode:new i.bM(d)}),vignette:d=>({u_vignetteShape:new i.bL(d),u_vignetteColor:new i.cb(d)}),occlusion:d=>({u_matrix:new i.bJ(d),u_anchorPos:new i.bL(d),u_screenSizePx:new i.bK(d),u_occluderSizePx:new i.bK(d),u_color:new i.cb(d)})};class Mo{constructor(t,s,h,m){this.id=Mo.uniqueIdxCounter,Mo.uniqueIdxCounter++,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||m||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Mo.uniqueIdxCounter,Mo.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Mo.uniqueIdxCounter=0;const Df={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zf{constructor(t,s,h,m,g,x){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.instanceCount=x,this.context=t;const I=t.gl;this.buffer=I.createBuffer(),t.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||g||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let h=0;h<this.attributes.length;h++){const m=s.attributes[this.attributes[h].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,h){for(let m=0;m<this.attributes.length;m++){const g=this.attributes[m],x=s.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[Df[g.type]],!1,this.itemSize,g.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(t,s,h){for(let m=0;m<this.attributes.length;m++){const g=s.attributes[this.attributes[m].name];g!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(g,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Sh{constructor(t,s,h,m,g){this.context=t,this.width=s,this.height=h;const x=this.framebuffer=t.gl.createFramebuffer();m&&(this.colorAttachment=new bf(t,x)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new _h(t,x):new a_(t,x))}destroy(){const t=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class as{constructor(t,s){this.gl=t,this.clearColor=new h0(this),this.clearDepth=new d0(this),this.clearStencil=new uf(this),this.colorMask=new hf(this),this.depthMask=new df(this),this.stencilMask=new ff(this),this.stencilFunc=new r_(this),this.stencilOp=new n_(this),this.stencilTest=new f0(this),this.depthRange=new Gc(this),this.depthTest=new Hc(this),this.depthFunc=new i_(this),this.blend=new Ts(this),this.blendFunc=new pf(this),this.blendColor=new dh(this),this.blendEquation=new fh(this),this.cullFace=new mf(this),this.cullFaceSide=new _f(this),this.frontFace=new gf(this),this.program=new ph(this),this.activeTexture=new yf(this),this.viewport=new vf(this),this.bindFramebuffer=new mh(this),this.bindRenderbuffer=new s_(this),this.bindTexture=new o_(this),this.bindVertexBuffer=new Pl(this),this.bindElementBuffer=new p0(this),this.bindVertexArrayOES=new m0(this),this.pixelStoreUnpack=new _0(this),this.pixelStoreUnpackPremultiplyAlpha=new g0(this),this.pixelStoreUnpackFlipY=new y0(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,h){return new Mo(this,t,s,h)}createVertexBuffer(t,s,h,m,g){return new zf(this,t,s,h,m,g)}createRenderbuffer(t,s,h){const m=this.gl,g=m.createRenderbuffer();return this.bindRenderbuffer.set(g),m.renderbufferStorage(m.RENDERBUFFER,t,s,h),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,h,m){return new Sh(this,t,s,h,m)}clear({color:t,depth:s,stencil:h,colorMask:m}){const g=this.gl;let x=0;t&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(m||[!0,!0,!0,!0])),s!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),g.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){i.bn(t.blendFunction,Rr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let no;function Lf(d,t,s,h,m,g,x){const I=d.context,P=I.gl,z=d.transform,L=d.getOrCreateProgram("collisionBox"),F=[];let B=0,j=0;for(let ce=0;ce<h.length;ce++){const ge=h[ce],pe=t.getTile(ge),_e=pe.getBucket(s);if(!_e)continue;const me=ai(ge,_e,z);let we=me;m[0]===0&&m[1]===0||(we=d.translatePosMatrix(me,pe,m,g));const Ee=x?_e.textCollisionBox:_e.iconCollisionBox,He=_e.collisionCircleArray;if(He.length>0){const Be=i.ad.mat4.create(),et=we;i.ad.mat4.mul(Be,_e.placementInvProjMatrix,z.glCoordMatrix),i.ad.mat4.mul(Be,Be,_e.placementViewportMatrix),F.push({circleArray:He,circleOffset:j,transform:et,invTransform:Be,projection:_e.getProjection()}),B+=He.length/4,j=B}Ee&&(d.terrain&&d.terrain.setupElevationDraw(pe,L),L.draw(d,P.LINES,Xt.disabled,br.disabled,d.colorModeForRenderPass(),fr.disabled,Af(we,z,pe,_e.getProjection()),s.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,z.zoom,null,[Ee.collisionVertexBuffer,Ee.collisionVertexBufferExt]))}if(!x||!F.length)return;const X=d.getOrCreateProgram("collisionCircle"),q=new i.cW;q.resize(4*B),q._trim();let J=0;for(const ce of F)for(let ge=0;ge<ce.circleArray.length/4;ge++){const pe=4*ge,_e=ce.circleArray[pe+0],me=ce.circleArray[pe+1],we=ce.circleArray[pe+2],Ee=ce.circleArray[pe+3];q.emplace(J++,_e,me,we,Ee,0),q.emplace(J++,_e,me,we,Ee,1),q.emplace(J++,_e,me,we,Ee,2),q.emplace(J++,_e,me,we,Ee,3)}(!no||no.length<2*B)&&(no=function(ce){const ge=2*ce,pe=new i.aV;pe.resize(ge),pe._trim();for(let _e=0;_e<ge;_e++){const me=6*_e;pe.uint16[me+0]=4*_e+0,pe.uint16[me+1]=4*_e+1,pe.uint16[me+2]=4*_e+2,pe.uint16[me+3]=4*_e+2,pe.uint16[me+4]=4*_e+3,pe.uint16[me+5]=4*_e+0}return pe}(B));const Q=I.createIndexBuffer(no,!0),oe=I.createVertexBuffer(q,i.cX.members,!0);for(const ce of F){const ge={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(ue=z).getCameraToCenterDistance(ce.projection),u_viewport_size:[ue.width,ue.height]};X.draw(d,P.TRIANGLES,Xt.disabled,br.disabled,d.colorModeForRenderPass(),fr.disabled,ge,s.id,oe,Q,i.b8.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,z.zoom)}var ue;oe.destroy(),Q.destroy()}const Fl=i.ad.mat4.create();function Eh(d){const t=d._camera.getWorldToCamera(d.worldSize,1),s=i.ad.mat4.multiply([],t,d.globeMatrix);i.ad.mat4.invert(s,s);const h=[0,0,0],m=[0,1,0,0];return i.ad.vec4.transformMat4(m,m,s),h[0]=m[0],h[1]=m[1],h[2]=m[2],i.ad.vec3.normalize(h,h),h}function Of({width:d,height:t,anchor:s,textOffset:h,textScale:m},g){const{horizontalAlign:x,verticalAlign:I}=i.bD(s),P=-(x-.5)*d,z=-(I-.5)*t,L=i.bC(s,h);return new i.P((P/m+L[0])*g,(z/m+L[1])*g)}function v_(d,t,s,h,m,g,x,I,P,z,L){const F=d.text.placedSymbolArray,B=d.text.dynamicLayoutVertexArray,j=d.icon.dynamicLayoutVertexArray,X={},q=d.getProjection(),J=kc(I,q,g),Q=g.elevation,oe=q.upVectorScale(I.canonical,g.center.lat,g.worldSize).metersToTile;B.clear();for(let ue=0;ue<F.length;ue++){const ce=F.get(ue),{tileAnchorX:ge,tileAnchorY:pe,numGlyphs:_e}=ce,me=ce.hidden||!ce.crossTileID||d.allowVerticalPlacement&&!ce.placedOrientation?null:h[ce.crossTileID];if(me){let we=0,Ee=0,He=0;if(Q){const Ze=Q?Q.getAtTileOffset(I,ge,pe):0,[ot,$e,ct]=q.upVector(I.canonical,ge,pe);we=Ze*ot*oe,Ee=Ze*$e*oe,He=Ze*ct*oe}let[Be,et,rt,_t]=An(ce.projectedAnchorX+we,ce.projectedAnchorY+Ee,ce.projectedAnchorZ+He,s?J:x);const Oe=jm(g.getCameraToCenterDistance(q),_t);let Qe=m.evaluateSizeForFeature(d.textSizeData,z,ce)*Oe/i.bw;s&&(Qe*=d.tilePixelRatio/P);const De=Of(me,Qe);s?({x:Be,y:et,z:rt}=q.projectTilePoint(ge+De.x,pe+De.y,I.canonical),[Be,et,rt]=An(Be+we,et+Ee,rt+He,x)):(t&&De._rotate(-g.angle),Be+=De.x,et+=De.y,rt=0);const Je=d.allowVerticalPlacement&&ce.placedOrientation===i.bq.vertical?Math.PI/2:0;for(let Ze=0;Ze<_e;Ze++)i.bt(B,Be,et,rt,Je);L&&ce.associatedIconIndex>=0&&(X[ce.associatedIconIndex]={x:Be,y:et,z:rt,angle:Je})}else qa(_e,B)}if(L){j.clear();const ue=d.icon.placedSymbolArray;for(let ce=0;ce<ue.length;ce++){const ge=ue.get(ce),{numGlyphs:pe}=ge,_e=X[ce];if(ge.hidden||!_e)qa(pe,j);else{const{x:me,y:we,z:Ee,angle:He}=_e;for(let Be=0;Be<pe;Be++)i.bt(j,me,we,Ee,He)}}d.icon.dynamicLayoutVertexBuffer.updateData(j)}d.text.dynamicLayoutVertexBuffer.updateData(B)}function ls(d,t,s,h,m,g,x={}){const I=s.paint.get("icon-translate"),P=s.paint.get("text-translate"),z=s.paint.get("icon-translate-anchor"),L=s.paint.get("text-translate-anchor"),F=s.layout.get("icon-rotation-alignment"),B=s.layout.get("text-rotation-alignment"),j=s.layout.get("icon-pitch-alignment"),X=s.layout.get("text-pitch-alignment"),q=s.layout.get("icon-keep-upright"),J=s.layout.get("text-keep-upright"),Q=s.paint.get("icon-color-saturation"),oe=s.paint.get("icon-color-contrast"),ue=s.paint.get("icon-color-brightness-min"),ce=s.paint.get("icon-color-brightness-max"),ge=s.layout.get("symbol-elevation-reference")==="sea",pe=d.context,_e=pe.gl,me=d.transform,we=F==="map",Ee=B==="map",He=j==="map",Be=X==="map",et=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let rt=!1;const _t=d.depthModeForSublayer(0,Xt.ReadOnly),Oe=[i.av(me.center.lng),i.aC(me.center.lat)],Qe=s.layout.get("text-variable-anchor"),De=me.projection.name==="globe",Je=[],Ze=[0,-1,0];for(const ot of h){const $e=t.getTile(ot),ct=$e.getBucket(s);if(!ct||ct.projection.name==="mercator"&&De||ct.fullyClipped)continue;const Tt=ct.projection.name==="globe",Mt=Tt?i.ag(me.zoom):0,Lt=kc(ot,ct.getProjection(),me),Wt=me.calculatePixelsToTileUnitsMatrix($e),pr=Qe&&ct.hasTextData(),nr=ct.hasIconTextFit()&&pr&&ct.hasIconData(),mr=ct.getProjection().createInversionMatrix(me,ot.canonical),hr=en=>{me.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||d.terrain)&&(en.push("DEPTH_D24"),en.push("DEPTH_OCCLUSION"))},Br=()=>{const en=we&&s.layout.get("symbol-placement")!=="point",tn=[];hr(tn);const qn=en||nr,di=s.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&He&&tn.push("PITCH_WITH_MAP_TERRAIN"),Tt&&(tn.push("PROJECTION_GLOBE_VIEW"),qn&&tn.push("PROJECTED_POS_ON_VIEWPORT")),di>0&&tn.push("ICON_TRANSITION"),ct.icon.zOffsetVertexBuffer&&tn.push("Z_OFFSET"),Q===0&&oe===0&&ue===0&&ce===1||tn.push("COLOR_ADJUSTMENT"),ct.sdfIcons&&tn.push("RENDER_SDF");const Qi=ct.icon.programConfigurations.get(s.id),fi=d.getOrCreateProgram("symbol",{config:Qi,defines:tn}),Ti=$e.imageAtlasTexture?$e.imageAtlasTexture.size:[0,0],Ui=ct.iconSizeData,rn=i.bp(Ui,me.zoom),In=He||me.pitch!==0,an=Vo(Lt,$e.tileID.canonical,He,we,me,ct.getProjection(),Wt),mn=Pi(Lt,$e.tileID.canonical,He,we,me,ct.getProjection(),Wt),mi=d.translatePosMatrix(mn,$e,I,z,!0),Fn=d.translatePosMatrix(Lt,$e,I,z),li=qn?Fl:an,Do=we&&!He&&!en;let es=Ze;!De&&!me.mercatorFromTransition||we||(es=Eh(me));const Hs=Tt?es:Ze,Ko=s.getColorAdjustmentMatrix(Q,oe,ue,ce),zi=g_(Ui.kind,rn,Do,He,d,Fn,li,mi,ge,!1,Ti,[0,0],!0,ot,Mt,Oe,mr,Hs,ct.getProjection(),Ko,di),Cs=$e.imageAtlasTexture?$e.imageAtlasTexture:null,zo=s.layout.get("icon-size").constantOr(0)!==1||ct.iconsNeedLinear,oo=ct.sdfIcons||d.options.rotating||d.options.zooming||zo||In?_e.LINEAR:_e.NEAREST,Yo=ct.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,up=d.terrain&&He&&en?i.ad.mat4.invert(i.ad.mat4.create(),an):Fl;if(en&&ct.icon){const ou=me.elevation,Zh=ou?ou.getAtTileOffsetFunc(ot,me.center.lat,me.worldSize,ct.getProjection()):null,Xh=Ha(Lt,$e.tileID.canonical,He,we,me,ct.getProjection(),Wt);Xu(ct,Lt,d,!1,Xh,mn,He,q,Zh,ot)}return{program:fi,buffers:ct.icon,uniformValues:zi,atlasTexture:Cs,atlasTextureIcon:null,atlasInterpolation:oo,atlasInterpolationIcon:null,isSDF:ct.sdfIcons,hasHalo:Yo,tile:$e,labelPlaneMatrixInv:up}},on=()=>{const en=Ee&&s.layout.get("symbol-placement")!=="point",tn=[],qn=en||Qe||nr;d.terrainRenderModeElevated()&&Be&&tn.push("PITCH_WITH_MAP_TERRAIN"),Tt&&(tn.push("PROJECTION_GLOBE_VIEW"),qn&&tn.push("PROJECTED_POS_ON_VIEWPORT")),ct.text.zOffsetVertexBuffer&&tn.push("Z_OFFSET"),ct.iconsInText&&tn.push("RENDER_TEXT_AND_SYMBOL"),tn.push("RENDER_SDF"),hr(tn);const di=ct.text.programConfigurations.get(s.id),Qi=d.getOrCreateProgram("symbol",{config:di,defines:tn});let fi,Ti=[0,0],Ui=null;const rn=ct.textSizeData;ct.iconsInText&&(Ti=$e.imageAtlasTexture?$e.imageAtlasTexture.size:[0,0],Ui=$e.imageAtlasTexture?$e.imageAtlasTexture:null,fi=Be||me.pitch!==0||d.options.rotating||d.options.zooming||rn.kind==="composite"||rn.kind==="camera"?_e.LINEAR:_e.NEAREST);const In=$e.glyphAtlasTexture?$e.glyphAtlasTexture.size:[0,0],an=s.layout.get("text-size-scale-range"),mn=i.ay(d.scaleFactor,an[0],an[1]),mi=i.bp(rn,me.zoom,mn),Fn=Vo(Lt,$e.tileID.canonical,Be,Ee,me,ct.getProjection(),Wt),li=Pi(Lt,$e.tileID.canonical,Be,Ee,me,ct.getProjection(),Wt),Do=d.translatePosMatrix(li,$e,P,L,!0),es=d.translatePosMatrix(Lt,$e,P,L),Hs=qn?Fl:Fn,Ko=Ee&&!Be&&!en;let zi=Ze;!De&&!me.mercatorFromTransition||Ee||(zi=Eh(me));const Cs=g_(rn.kind,mi,Ko,Be,d,es,Hs,Do,ge,!0,In,Ti,!0,ot,Mt,Oe,mr,Tt?zi:Ze,ct.getProjection(),null,null,mn),zo=$e.glyphAtlasTexture?$e.glyphAtlasTexture:null,oo=_e.LINEAR,Yo=s.paint.get("text-halo-width").constantOr(1)!==0,up=d.terrain&&Be&&en?i.ad.mat4.invert(i.ad.mat4.create(),Fn):Fl;if(en&&ct.text){const ou=me.elevation,Zh=ou?ou.getAtTileOffsetFunc(ot,me.center.lat,me.worldSize,ct.getProjection()):null,Xh=Ha(Lt,$e.tileID.canonical,Be,Ee,me,ct.getProjection(),Wt);Xu(ct,Lt,d,!0,Xh,li,Be,J,Zh,ot)}return{program:Qi,buffers:ct.text,uniformValues:Cs,atlasTexture:zo,atlasTextureIcon:Ui,atlasInterpolation:oo,atlasInterpolationIcon:fi,isSDF:!0,hasHalo:Yo,tile:$e,labelPlaneMatrixInv:up}},pn=ct.icon.segments.get().length,Dr=ct.text.segments.get().length,zn=pn&&!x.onlyText?Br():null,wr=Dr&&!x.onlyIcons?on():null,gr=s.paint.get("icon-opacity").constantOr(1),or=s.paint.get("text-opacity").constantOr(1);if(et&&ct.canOverlap){rt=!0;const en=gr&&!x.onlyText?ct.icon.segments.get():[],tn=or&&!x.onlyIcons?ct.text.segments.get():[];for(const qn of en)Je.push({segments:new i.b8([qn]),sortKey:qn.sortKey,state:zn});for(const qn of tn)Je.push({segments:new i.b8([qn]),sortKey:qn.sortKey,state:wr})}else x.onlyText||Je.push({segments:gr?ct.icon.segments:new i.b8([]),sortKey:0,state:zn}),x.onlyIcons||Je.push({segments:or?ct.text.segments:new i.b8([]),sortKey:0,state:wr})}rt&&Je.sort((ot,$e)=>ot.sortKey-$e.sortKey);for(const ot of Je){const $e=ot.state;if($e)if(d.terrain?d.terrain.setupElevationDraw($e.tile,$e.program,{useDepthForOcclusion:me.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:$e.labelPlaneMatrixInv}):d.setupDepthForOcclusion(me.depthOcclusionForSymbolsAndCircles,$e.program),pe.activeTexture.set(_e.TEXTURE0),$e.atlasTexture&&$e.atlasTexture.bind($e.atlasInterpolation,_e.CLAMP_TO_EDGE,!0),$e.atlasTextureIcon&&(pe.activeTexture.set(_e.TEXTURE1),$e.atlasTextureIcon&&$e.atlasTextureIcon.bind($e.atlasInterpolationIcon,_e.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,$e.program),$e.hasHalo){const ct=$e.uniformValues;ct.u_is_halo=1,bn($e.buffers,ot.segments,s,d,$e.program,_t,m,g,ct,2),ct.u_is_halo=0}else{if($e.isSDF){const ct=$e.uniformValues;$e.hasHalo&&(ct.u_is_halo=1,bn($e.buffers,ot.segments,s,d,$e.program,_t,m,g,ct,1)),ct.u_is_halo=0}bn($e.buffers,ot.segments,s,d,$e.program,_t,m,g,$e.uniformValues,1)}}}function bn(d,t,s,h,m,g,x,I,P,z){const L=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];m.draw(h,h.context.gl.TRIANGLES,g,x,I,fr.disabled,P,s.id,d.layoutVertexBuffer,d.indexBuffer,t,s.paint,h.transform.zoom,d.programConfigurations.get(s.id),L,z)}function Ah(d,t){const s=1<<d.canonical.z,h=(t.x*s-d.canonical.x-d.wrap*s)*i.ai,m=(t.y*s-d.canonical.y)*i.ai,g=i.d5(t.z,t.y);return i.ad.vec3.fromValues(h,m,g)}function Mh(d,t,s,h,m){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const g=d.context.gl,x=new Xt(d.context.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D),I=new Xt(d.context.gl.GREATER,Xt.ReadWrite,d.depthRangeFor3D),P=function(j){const X=i.c4(j.pitch);let q=.01;return j.isOrthographic&&(q=i.ah(1e-4,q,i.c9(X>=Go?1:X/Go))),2*q}(d.transform),z=d.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",F=d.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),B=d.getOrCreateProgram(L);for(const j of h){const X=t.getTile(j),q=X.getBucket(s);if(!q)continue;const J=q.elevatedStructures;if(!J)continue;const Q=q.elevationBufferData.heightRange,oe=Ah(j.toUnwrapped(),z),ue=d.translatePosMatrix(j.projMatrix,X,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let ce,ge,pe,_e;if(m==="initialize"){if(!Q||Q.min>=1||J.depthSegments.segments[0].primitiveLength===0)continue;ce=Ol(ue,oe,P,1,0),ge=x,pe=J.depthSegments,_e=F}else if(m==="reset"){if(!Q||Q.min>=0||J.maskSegments.segments[0].primitiveLength===0)continue;ce=Ol(ue,oe,0,0,1),ge=I,pe=J.maskSegments,_e=F}else if(m==="geometry"){if(J.depthSegments.segments[0].primitiveLength===0)continue;ce=Ol(ue,oe,P,1,0),ge=x,pe=J.depthSegments,_e=B}_e.draw(d,g.TRIANGLES,ge,br.disabled,Rr.disabled,fr.disabled,ce,s.id,J.vertexBuffer,J.indexBuffer,pe,s.paint,d.transform.zoom)}}function Ih(d,t,s){const{painter:h,sourceCache:m,layer:g,coords:x,colorMode:I,elevationType:P,terrainEnabled:z,pass:L}=d,F=h.context.gl,B=g.paint.get("fill-pattern");let j=P;P!=="road"||t&&!z||(j="none");const X=j==="road",q=new Xt(h.context.gl.LEQUAL,Xt.ReadWrite,h.depthRangeFor3D),J=B&&B.constantOr(1),Q=(oe,ue)=>{let ce,ge,pe,_e,me;ue?(ge=J&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ce=F.LINES):(ge=J?"fillPattern":"fill",ce=F.TRIANGLES);for(const we of x){const Ee=m.getTile(we);if(J&&!Ee.patternsLoaded())continue;const He=Ee.getBucket(g);if(!He)continue;const Be=t?He.elevationBufferData:He.bufferData;if(Be.isEmpty())continue;h.prepareDrawTile();const et=Be.programConfigurations.get(g.id),rt=h.isTileAffectedByFog(we),_t=[],Oe=[];X&&(_t.push("ELEVATED_ROADS"),Oe.push(Be.elevatedLayoutVertexBuffer));const Qe=h.getOrCreateProgram(ge,{config:et,overrideFog:rt,defines:_t});J&&(h.context.activeTexture.set(F.TEXTURE0),Ee.imageAtlasTexture&&Ee.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),et.updatePaintBuffers());const De=B.constantOr(null);if(De&&Ee.imageAtlas){const ot=Ee.imageAtlas,$e=i.d0.from(De).getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),ct=ot.patternPositions.get($e);ct&&et.setConstantPatternPositions(ct)}const Je=h.translatePosMatrix(we.projMatrix,Ee,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor")),Ze=g.paint.get("fill-emissive-strength");if(ue){_e=Be.lineIndexBuffer,me=Be.lineSegments;const ot=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];pe=ge==="fillOutlinePattern"&&J?bh(Je,Ze,h,Ee,ot):p_(Je,Ze,ot)}else _e=Be.indexBuffer,me=Be.triangleSegments,pe=J?Ll(Je,Ze,h,Ee):xh(Je,Ze);h.uploadCommonUniforms(h.context,Qe,we.toUnwrapped()),Qe.draw(h,ce,j!=="none"?q:oe,s||h.stencilModeForClipping(we),I,fr.disabled,pe,g.id,Be.layoutVertexBuffer,_e,me,g.paint,h.transform.zoom,et,Oe)}};h.renderPass===L&&Q(h.depthModeForSublayer(1,h.renderPass==="opaque"?Xt.ReadWrite:Xt.ReadOnly),!1),j==="none"&&h.renderPass==="translucent"&&g.paint.get("fill-antialias")&&Q(h.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,Xt.ReadOnly),!0)}function Kc(d,t,s,h,m,g,x,I){s.resetLayerRenderingStats(d);const P=d.context,z=P.gl,L=d.transform,F=s.paint.get("fill-extrusion-pattern"),B=F.constantOr(1),j=s.paint.get("fill-extrusion-opacity"),X=d.style.enable3dLights(),q=s.paint.get(X&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),J=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),q],Q=s.layout.get("fill-extrusion-edge-radius"),oe=Q>0&&!s.paint.get("fill-extrusion-rounded-roof"),ue=oe?0:Q,ce=L.projection.name==="globe"?i.d6():0,ge=L.projection.name==="globe",pe=ge?i.ag(L.zoom):0,_e=[i.av(L.center.lng),i.aC(L.center.lat)],me=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",we=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(me?null:s.lut).toArray01().slice(0,3),Ee=s.paint.get("fill-extrusion-flood-light-intensity"),He=s.paint.get("fill-extrusion-vertical-scale"),Be=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,et=s.paint.get("fill-extrusion-height-alignment"),rt=s.paint.get("fill-extrusion-base-alignment"),_t=ga(d,s.paint.get("fill-extrusion-cutoff-fade-range")),Oe=[];let Qe;ge&&Oe.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&Oe.push("FAUX_AO"),oe&&Oe.push("ZERO_ROOF_RADIUS"),I&&Oe.push("HAS_CENTROID"),Ee>0&&Oe.push("FLOOD_LIGHT"),_t.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),Be&&Oe.push("RENDER_WALL_MODE");const De=d.renderPass==="shadow",Je=d.shadowRenderer,Ze=De&&!!Je;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let ot=[0,0,0];if(Je){const Tt=d.style.directionalLight,Mt=d.style.ambientLight;Tt&&Mt&&(ot=Ho(d.style,Tt,Mt)),De||(Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Je.useNormalOffset&&Oe.push("NORMAL_OFFSET")),Qe=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const $e=Ze?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",ct=s.getLayerRenderingStats();for(const Tt of h){const Mt=t.getTile(Tt),Lt=Mt.getBucket(s);if(!Lt||Lt.projection.name!==L.projection.name)continue;let Wt=!1;Je&&(Wt=Je.getMaxCascadeForTile(Tt.toUnwrapped())===0);const pr=d.isTileAffectedByFog(Tt),nr=Lt.programConfigurations.get(s.id),mr=d.getOrCreateProgram($e,{config:nr,defines:Wt?Qe:Oe,overrideFog:pr});if(d.terrain&&d.terrain.setupElevationDraw(Mt,mr,{useMeterToDem:!0}),!Lt.centroidVertexBuffer){const wr=mr.attributes.a_centroid_pos;wr!==void 0&&z.vertexAttrib2f(wr,0,0)}!De&&Je&&Je.setupShadows(Mt.tileID.toUnwrapped(),mr,"vector-tile",Mt.tileID.overscaledZ),B&&(d.context.activeTexture.set(z.TEXTURE0),Mt.imageAtlasTexture&&Mt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),nr.updatePaintBuffers());const hr=F.constantOr(null);if(hr&&Mt.imageAtlas){const wr=Mt.imageAtlas,gr=i.d0.from(hr).getPrimary().scaleSelf(i.q.devicePixelRatio),or=wr.patternPositions.get(gr.toString());or&&nr.setConstantPatternPositions(or)}const Br=s.paint.get("fill-extrusion-vertical-gradient"),on=1/Lt.tileToMeter;let pn;if(De&&Je){if(kt(Mt.tileID,Lt,d))continue;const wr=Je.calculateShadowPassMatrixFromTile(Mt.tileID.toUnwrapped());pn=Ef(wr,ue,on,He,et,rt)}else{const wr=d.translatePosMatrix(Tt.expandedProjMatrix,Mt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),gr=L.projection.createInversionMatrix(L,Tt.canonical);pn=B?zl(wr,d,Br,j,J,ue,on,Tt,Mt,ce,et,rt,pe,_e,gr,we,He):vh(wr,d,Br,j,J,ue,on,Tt,ce,et,rt,pe,_e,gr,we,He,Ee,ot)}d.uploadCommonUniforms(P,mr,Tt.toUnwrapped(),null,_t);let Dr=Lt.segments;if(L.projection.name==="mercator"&&!De&&(Dr=Lt.getVisibleSegments(Mt.tileID,d.terrain,d.transform.getFrustum(0)),!Dr.get().length))continue;if(ct)if(De)for(const wr of Dr.get())ct.numRenderedVerticesInShadowPass+=wr.primitiveLength;else for(const wr of Dr.get())ct.numRenderedVerticesInTransparentPass+=wr.primitiveLength;const zn=[];(d.terrain||I)&&zn.push(Lt.centroidVertexBuffer),ge&&zn.push(Lt.layoutVertexExtBuffer),Be&&zn.push(Lt.wallVertexBuffer),mr.draw(d,P.gl.TRIANGLES,m,g,x,fr.backCCW,pn,s.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Dr,s.paint,d.transform.zoom,nr,zn)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function el(d,t,s,h,m,g,x,I,P,z,L,F,B,j,X,q,J,Q,oe){const ue=d.context,ce=ue.gl,ge=d.transform,pe=d.transform.zoom,_e=[],me=ga(d,s.paint.get("fill-extrusion-cutoff-fade-range"));z==="clear"?(_e.push("CLEAR_SUBPASS"),oe&&(_e.push("CLEAR_FROM_TEXTURE"),ue.activeTexture.set(ce.TEXTURE0),oe.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):z==="sdf"&&_e.push("SDF_SUBPASS"),J&&_e.push("HAS_CENTROID"),me.shouldRenderCutoff&&_e.push("RENDER_CUTOFF");const we=s.layout.get("fill-extrusion-edge-radius"),Ee=(He,Be,et,rt,_t)=>{const Oe=Be.programConfigurations.get(s.id),Qe=d.isTileAffectedByFog(He),De=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:Oe,defines:_e,overrideFog:Qe}),Je=((ot,$e,ct,Tt,Mt,Lt,Wt,pr,nr,mr,hr)=>({u_matrix:$e,u_opacity:ct,u_ao_pass:Tt?1:0,u_meter_to_tile:Mt,u_ao:Lt,u_flood_light_intensity:Wt,u_flood_light_color:pr,u_attenuation:nr,u_edge_radius:mr,u_fb:0,u_fb_size:hr,u_dynamic_offset:1}))(0,rt,L,P,_t,[F,B*_t],j,X,q,pe>=17?0:we*_t,oe?oe.size[0]:0),Ze=[];J&&Ze.push(Be.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(ue,De,He.toUnwrapped(),null,me),De.draw(d,ue.gl.TRIANGLES,m,g,x,I,Je,s.id,Be.vertexBuffer,Be.indexBuffer,et,s.paint,pe,Oe,Ze)};for(const He of h){const Be=t.getTile(He),et=Be.getBucket(s);if(!et||et.projection.name!==ge.projection.name||!et.groundEffect||et.groundEffect&&!et.groundEffect.hasData())continue;const rt=et.groundEffect,_t=1/et.tileToMeter;{const Oe=d.translatePosMatrix(He.projMatrix,Be,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Qe=rt.getDefaultSegment();Ee(He,rt,Qe,Oe,_t)}if(Q)for(let Oe=0;Oe<4;Oe++){const Qe=i.d7[Oe](He),De=t.getTile(Qe);if(!De)continue;const Je=De.getBucket(s);if(!Je||Je.projection.name!==ge.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const Ze=Je.groundEffect;let ot,$e;Oe===0?(ot=[-i.ai,0,0],$e=1):Oe===1?(ot=[i.ai,0,0],$e=0):Oe===2?(ot=[0,-i.ai,0],$e=3):(ot=[0,i.ai,0],$e=2);const ct=Ze.regionSegments[$e];if(!ct)continue;const Tt=new Float32Array(16);i.ad.mat4.translate(Tt,He.projMatrix,ot),Ee(He,Ze,ct,d.translatePosMatrix(Tt,Be,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),_t)}}}function T0(d,t,s,h,m,g,x){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const I=g?g.findDEMTileFor(s):null;if(!(I&&I.dem||x))return;g&&I&&I.dem&&h.selfDEMTileTimestamp!==I.dem._timestamp&&(h.borderDoneWithNeighborZ=[-1,-1,-1,-1],h.selfDEMTileTimestamp=I.dem._timestamp);const P=Q=>new i.P(Math.ceil((Q+i.da)*i.db),0),z=Q=>{const oe=t.getSource().minzoom,ue=ge=>{const pe=t.getTileByID(ge);if(pe&&pe.hasData())return pe.getBucket(m)},ce=[0,-1,1];for(const ge of ce){if(Q.overscaledZ+ge<oe)continue;const pe=ue(Q.calculateScaledKey(Q.overscaledZ+ge));if(pe)return pe}},L=[0,0,0],F=(Q,oe)=>(L[0]=Math.min(Q.min.y,oe.min.y),L[1]=Math.max(Q.max.y,oe.max.y),L[2]=i.ai-oe.min.x>Q.max.x?oe.min.x-i.ai:Q.max.x,L),B=(Q,oe)=>(L[0]=Math.min(Q.min.x,oe.min.x),L[1]=Math.max(Q.max.x,oe.max.x),L[2]=i.ai-oe.min.y>Q.max.y?oe.min.y-i.ai:Q.max.y,L),j=[(Q,oe)=>F(Q,oe),(Q,oe)=>F(oe,Q),(Q,oe)=>B(Q,oe),(Q,oe)=>B(oe,Q)],X=(Q,oe,ue,ce,ge,pe,_e)=>{if(!g)return 0;const me=[[pe?ue:Q,pe?Q:ue,0],[pe?ue:oe,pe?oe:ue,0]],we=_e<0?i.ai+_e:_e,Ee=[pe?we:(Q+oe)/2,pe?(Q+oe)/2:we,0];return ue===0&&_e<0||ue!==0&&_e>0?g.getForTilePoints(ge,[Ee],!0,ce):me.push(Ee),g.getForTilePoints(s,me,!0,I),Math.max(me[0][2],me[1][2],Ee[2])/g.exaggeration()};for(let Q=0;Q<4;Q++){const oe=h.borderFeatureIndices[Q];if(oe.length===0)continue;const ue=i.d7[Q](s),ce=z(ue);if(!(ce&&ce instanceof i.d8))continue;const ge=g?g.findDEMTileFor(ue):null;if(!(ge&&ge.dem||x)||(g&&ge&&ge.dem&&h.borderDEMTileTimestamp[Q]!==ge.dem._timestamp&&(h.borderDoneWithNeighborZ[Q]=-1,h.borderDEMTileTimestamp[Q]=ge.dem._timestamp),h.borderDoneWithNeighborZ[Q]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const pe=(Q<2?1:5)-Q,_e=ce.borderDoneWithNeighborZ[pe]!==h.canonical.z,me=ce.borderFeatureIndices[pe];let we=0;if(h.canonical.z!==ce.canonical.z){for(const Ee of oe)h.showCentroid(h.featuresOnBorder[Ee]);if(_e)for(const Ee of me)ce.showCentroid(ce.featuresOnBorder[Ee]);h.borderDoneWithNeighborZ[Q]=ce.canonical.z,ce.borderDoneWithNeighborZ[pe]=h.canonical.z}for(const Ee of oe){const He=h.featuresOnBorder[Ee],Be=h.centroidData[He.centroidDataIndex],et=He.borders[Q];let rt;for(;we<me.length;){rt=ce.featuresOnBorder[me[we]];const _t=rt.borders[pe];if(_t[1]>et[0]+3||_t[0]>et[0]-3)break;ce.showCentroid(rt),we++}if(rt&&we<me.length){const _t=we;let Oe=0;for(;!(rt.borders[pe][0]>et[1]-3)&&(Oe++,++we!==me.length);)rt=ce.featuresOnBorder[me[we]];rt=ce.featuresOnBorder[me[_t]];let Qe=!1;if(Oe>=1){const Ze=rt.borders[pe];Math.abs(et[0]-Ze[0])<3&&Math.abs(et[1]-Ze[1])<3&&(Oe=1,Qe=!0,we=_t+1)}else if(Oe===0){h.showCentroid(He);continue}const De=ce.centroidData[rt.centroidDataIndex];x&&Qe&&(((q=Be).flags|(J=De).flags)&i.d9?(q.flags|=i.d9,J.flags|=i.d9):(q.flags&=~i.d9,J.flags&=~i.d9));const Je=He.intersectsCount()>1||rt.intersectsCount()>1;if(Oe>1)we=_t,Be.centroidXY=De.centroidXY=new i.P(0,0);else if(ge&&ge.dem&&!Je){const Ze=j[Q](Be,De),ot=Q%2?i.ai-1:0,$e=X(Ze[0],Math.min(i.ai-1,Ze[1]),ot,ge,ue,Q<2,Ze[2]);Be.centroidXY=De.centroidXY=P($e)}else Je?Be.centroidXY=De.centroidXY=new i.P(0,0):(Be.centroidXY=h.encodeBorderCentroid(He),De.centroidXY=ce.encodeBorderCentroid(rt));h.writeCentroidToBuffer(Be),ce.writeCentroidToBuffer(De)}else h.showCentroid(He)}h.borderDoneWithNeighborZ[Q]=ce.canonical.z,ce.borderDoneWithNeighborZ[pe]=h.canonical.z}var q,J;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(d)}const Bl=[1,0,0],Nl=[0,1,0],wt=[0,0,1];function kt(d,t,s){const h=s.transform,m=s.shadowRenderer;if(!m)return!0;const g=d.toUnwrapped(),x=h.tileSize*m._cascades[s.currentShadowCascade].scale;let I=t.maxHeight;if(h.elevation){const q=h.elevation.getMinMaxForTile(d);q&&(I+=q.max)}const P=[...m.shadowDirection];P[2]=-P[2];const z=m.computeSimplifiedTileShadowVolume(g,I,x,P);if(!z)return!1;const L=[Bl,Nl,wt,P,[P[0],0,P[2]],[0,P[1],P[2]]],F=h.projection.name==="globe",B=h.scaleZoom(x),j=i.bR.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,B,!F),X=m.getCurrentCascadeFrustum();return j.intersectsPrecise(z.vertices,z.planes,L)===0||X.intersectsPrecise(z.vertices,z.planes,L)===0}function tl(d){return[d[0]*i.dc,d[1]*i.dc,d[2]*i.dc,0]}function jn(d,t,s,h,m,g,x,I,P){const z=h.getSource(),L=s.globeSharedBuffers;if(!L)return;let F,B,j;if(t&&(F=h.getTile(t)),z instanceof i.aK?(B=z.texture,j=i.cJ(0,0,s.transform)):F&&t&&(B=F.texture,j=i.cJ(t.canonical.z,t.canonical.x,s.transform)),!B||!j)return;d||(j=i.ad.mat4.scale(i.ad.mat4.create(),j,[1,-1,1]));const X=s.context,q=X.gl,J=m.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR,Q=s.colorModeForDrapableLayerRenderPass(g),oe=x.defines;oe.push("GLOBE_POLES");const ue=new Xt(q.LEQUAL,Xt.ReadWrite,s.depthRangeFor3D),ce=Float32Array.from(s.transform.expandedFarZProjMatrix),ge=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),X.activeTexture.set(q.TEXTURE0),B.bind(J,q.CLAMP_TO_EDGE),X.activeTexture.set(q.TEXTURE1),B.bind(J,q.CLAMP_TO_EDGE),"useMipmap"in B&&X.extTextureFilterAnisotropic&&s.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax);const[pe,_e,me,we]=t?L.getPoleBuffers(t.canonical.z,!1):L.getPoleBuffers(0,!0),Ee=m.paint.get("raster-elevation");let He;d?(He=pe,s.renderDefaultNorthPole=Ee!==0):(He=_e,s.renderDefaultSouthPole=Ee!==0);const Be=tl(x.mix),et=((_t,Oe,Qe,De,Je,Ze,ot,$e,ct,Tt,Mt,Lt,Wt)=>If(_t,Oe,Qe,new Float32Array(16),new Float32Array(9),[0,0],De,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],$e,2,Tt,Mt,Lt,1,0,Wt))(ce,ge,j,i.ag(s.transform.zoom),0,m,0,Ee,0,Be,x.offset,x.range,g),rt=s.getOrCreateProgram("raster",{defines:oe});s.uploadCommonUniforms(X,rt,null),rt.draw(s,q.TRIANGLES,ue,P,Q,I,et,m.id,He,me,we)}function Ue(d){const t=d._nearZ,s=d.projection.farthestPixelDistance(d),h=s-t,m=.2*d.height,g=t+m;return[t,s,(g-m-t)/h,(g-t)/h]}function x_(d,t,s,h){if(d)return t instanceof xs&&d instanceof _a?t.getTextureDescriptor(d,s,!0):{texture:d.texture,mix:tl(h.mix),offset:h.offset,buffer:0,tileSize:1}}var Ch=i.dd([{name:"a_index",type:"Int16",components:1}]);class kf{constructor(t,s,h,m){const g={width:h[0],height:h[1],data:null},x=t.gl;this.targetColorTexture=new i.T(t,g,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(t,g,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,m),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const h=this.context.gl,m=s.width*s.height;this.particleTexture0=new i.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1});const g=new i.de;g.reserve(m);for(let x=0;x<m;x++)g.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(g,Ch.members,!0),this.particleSegment=i.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ff(d,t,s){if(!d)return null;const h=t.getTextureDescriptor(d,s,!0);if(!h)return null;let{texture:m,mix:g,offset:x,tileSize:I,buffer:P,format:z}=h;if(!m||!z)return null;let L=!1;return z==="uint32"&&(L=!0,g[3]=0,g=Xc(i.df,g,[0,s.paint.get("raster-particle-max-speed")]),x=Ft(i.df,x,[0,s.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[P/(I+2*P),I/(I+2*P)],tileSize:I,scalarData:L,scale:g,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function b_(d){const t=d._nearZ,s=d.projection.farthestPixelDistance(d),h=s-t,m=.2*d.height,g=t+m;return[t,s,(g-m-t)/h,(g-t)/h]}const w_=new i.al(1,0,0,1),Vl=new i.al(0,1,0,1),S0=new i.al(0,0,1,1),E0=new i.al(1,0,1,1),T_=new i.al(0,1,1,1);function Zo(d,t,s,h,m,g,x){const I=d.context,P=d.transform,z=I.gl,L=P.projection.name==="globe",F=L?["PROJECTION_GLOBE_VIEW"]:[];let B=i.ad.mat4.clone(s.projMatrix);if(L&&i.ag(P.zoom)>0){const Be=i.bb(s.canonical,P),et=i.dg(Be);B=i.ad.mat4.multiply(new Float32Array(16),P.globeMatrix,et),i.ad.mat4.multiply(B,P.projMatrix,B)}const j=i.ad.mat4.create();j[12]+=2*m/(i.q.devicePixelRatio*P.width),j[13]+=2*g/(i.q.devicePixelRatio*P.height),i.ad.mat4.multiply(B,j,B);const X=d.getOrCreateProgram("debug",{defines:F}),q=t.getTileByID(s.key);d.terrain&&d.terrain.setupElevationDraw(q,X);const J=Xt.disabled,Q=br.disabled,oe=d.colorModeForRenderPass(),ue="$debug";I.activeTexture.set(z.TEXTURE0),d.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),L?q._makeGlobeTileDebugBuffers(d.context,P):q._makeDebugTileBoundsBuffers(d.context,P.projection);const ce=q._tileDebugBuffer||d.debugBuffer,ge=q._tileDebugIndexBuffer||d.debugIndexBuffer,pe=q._tileDebugSegments||d.debugSegments;if(X.draw(d,z.LINE_STRIP,J,Q,oe,fr.disabled,Mf(B,h),ue,ce,ge,pe,null,null,null,[q._globeTileDebugBorderBuffer]),x){const Be=q.latestRawTileData,et=Math.floor((Be&&Be.byteLength||0)/1024);let rt=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(rt+=` => ${s.overscaledZ}`),rt+=` ${q.state}`,rt+=` ${et}kb`,function(_t,Oe){_t.initDebugOverlayCanvas();const Qe=_t.debugOverlayCanvas,De=_t.context.gl,Je=_t.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,Qe.width,Qe.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(Oe,5,5),Je.strokeText(Oe,5,5),_t.debugOverlayTexture.update(Qe),_t.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(d,rt)}const _e=t.getTile(s).tileSize,me=512/Math.min(_e,512)*(s.overscaledZ/P.zoom)*.5,we=q._tileDebugTextBuffer||d.debugBuffer,Ee=q._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,He=q._tileDebugTextSegments||d.debugSegments;X.draw(d,z.TRIANGLES,J,Q,Rr.alphaBlended,fr.disabled,Mf(B,i.al.transparent,me),ue,we,Ee,He,null,null,null,[q._globeTileDebugTextBuffer])}function Ph(d,t,s,h){Yc(d,0,t+s/2,d.transform.width,s,h)}function Bf(d,t,s,h){Yc(d,t-s/2,0,s,d.transform.height,h)}function Yc(d,t,s,h,m,g){const x=d.context,I=x.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*i.q.devicePixelRatio,s*i.q.devicePixelRatio,h*i.q.devicePixelRatio,m*i.q.devicePixelRatio),x.clear({color:g}),I.disable(I.SCISSOR_TEST)}const Rh=i.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Dh}=Rh;function Es(d,t,s,h){d.emplaceBack(t,s,h)}class Nf{constructor(t){this.vertexArray=new i.dh,this.indices=new i.aV,Es(this.vertexArray,-1,-1,1),Es(this.vertexArray,1,-1,1),Es(this.vertexArray,-1,1,1),Es(this.vertexArray,1,1,1),Es(this.vertexArray,-1,-1,-1),Es(this.vertexArray,1,-1,-1),Es(this.vertexArray,-1,1,-1),Es(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Dh),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=i.b8.simpleSegment(0,0,36,12)}}function Ul(d,t,s,h,m,g){const x=d.context.gl,I=t.paint.get("sky-atmosphere-color"),P=t.paint.get("sky-atmosphere-halo-color"),z=t.paint.get("sky-atmosphere-sun-intensity"),L=((F,B,j,X,q)=>({u_matrix_3f:F,u_sun_direction:B,u_sun_intensity:j,u_color_tint_r:[X.r,X.g,X.b,X.a],u_color_tint_m:[q.r,q.g,q.b,q.a],u_luminance:5e-5}))(i.ad.mat3.fromMat4(i.ad.mat3.create(),h),m,z,I,P);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),s.draw(d,x.TRIANGLES,Xt.disabled,br.disabled,Rr.unblended,fr.frontCW,L,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Yi=i.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class A0{constructor(t){const s=new i.di;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new i.aV;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,Yi.members),this.indexBuffer=t.createIndexBuffer(h),this.segments=i.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Jc=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class En{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Jr{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Rr([1,El,1,El],i.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Rr([1,0,1,0],i.al.transparent,[!1,!1,!1,!0]),this.params=new En,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new A0(s);const h=this.params.sizeRange,m=this.params.intensityRange,g=function(L){const F=i.dl(30),B=[];for(let j=0;j<L;++j){const X=2*Math.PI*F(),q=Math.acos(1-2*F())-.5*Math.PI;B.push(i.ad.vec3.fromValues(Math.cos(q)*Math.cos(X),Math.cos(q)*Math.sin(X),Math.sin(q)))}return B}(this.params.starsCount),x=i.dl(300),I=new i.dj,P=new i.aV;let z=0;for(let L=0;L<g.length;++L){const F=i.ad.vec3.scale([],g[L],200),B=Math.max(0,1+.01*h*(1*x()-.5)),j=Math.max(0,1+.01*m*(1*x()-.5));I.emplaceBack(F[0],F[1],F[2],-1,-1,B,j),I.emplaceBack(F[0],F[1],F[2],1,-1,B,j),I.emplaceBack(F[0],F[1],F[2],1,1,B,j),I.emplaceBack(F[0],F[1],F[2],-1,1,B,j),P.emplaceBack(z+0,z+1,z+2),P.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=s.createVertexBuffer(I,Jc.members),this.starsIdx=s.createIndexBuffer(P),this.starsSegments=i.b8.simpleSegment(0,0,I.length,P.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const h=t.context,m=h.gl,g=t.transform,x=new Xt(m.LEQUAL,Xt.ReadOnly,[0,1]),I=i.ag(g.zoom),P=t.style.getLut(s.scope),z=s.properties.get("color-use-theme")==="none",L=s.properties.get("color").toRenderColor(z?null:P).toArray01(),F=s.properties.get("high-color-use-theme")==="none",B=s.properties.get("high-color").toRenderColor(F?null:P).toArray01(),j=s.properties.get("space-color-use-theme")==="none",X=s.properties.get("space-color").toRenderColor(j?null:P).toArray01PremultipliedAlpha(),q=5e-4,J=i.dk(s.properties.get("horizon-blend"),0,1,q,.25),Q=i.cD(t,h,g)&&J===q?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,oe=t.frameCounter/1e3%1,ue=i.ad.vec3.length(g.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(ue,2)-Math.pow(Q,2)),ge=Math.acos(ce/ue),pe=_e=>{const me=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];_e&&me.push("ALPHA_PASS");const we=t.getOrCreateProgram("globeAtmosphere",{defines:me}),Ee=((Be,et,rt,_t,Oe,Qe,De,Je,Ze,ot,$e,ct)=>({u_frustum_tl:Be,u_frustum_tr:et,u_frustum_br:rt,u_frustum_bl:_t,u_horizon:Oe,u_transition:Qe,u_fadeout_range:De,u_color:Je,u_high_color:Ze,u_space_color:ot,u_temporal_offset:$e,u_horizon_angle:ct}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,I,J,L,B,X,oe,ge);t.uploadCommonUniforms(h,we);const He=this.atmosphereBuffer;He&&we.draw(t,m.TRIANGLES,x,br.disabled,_e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,fr.backCW,Ee,_e?"atmosphere_glow_alpha":"atmosphere_glow",He.vertexBuffer,He.indexBuffer,He.segments)};pe(!1),pe(!0)}drawStars(t,s){const h=i.ay(s.properties.get("star-intensity"),0,1);if(h===0)return;const m=t.context,g=m.gl,x=t.transform,I=t.getOrCreateProgram("stars"),P=i.ad.quat.identity([]);i.ad.quat.rotateX(P,P,-x._pitch),i.ad.quat.rotateZ(P,P,-x.angle),i.ad.quat.rotateX(P,P,i.ak(x._center.lat)),i.ad.quat.rotateY(P,P,-i.ak(x._center.lng));const z=i.ad.mat4.fromQuat(new Float32Array(16),P),L=i.ad.mat4.multiply([],x.starsProjMatrix,z),F=i.ad.mat3.fromMat4([],z),B=i.ad.mat3.invert([],F),j=[0,1,0];i.ad.vec3.transformMat3(j,j,B),i.ad.vec3.scale(j,j,this.params.sizeMultiplier);const X=[1,0,0];i.ad.vec3.transformMat3(X,X,B),i.ad.vec3.scale(X,X,this.params.sizeMultiplier);const q=(J=j,Q=X,oe=h,{u_matrix:Float32Array.from(L),u_up:J,u_right:Q,u_intensity_multiplier:oe});var J,Q,oe;t.uploadCommonUniforms(m,I),this.starsVx&&this.starsIdx&&I.draw(t,g.TRIANGLES,Xt.disabled,br.disabled,this.colorModeAlphaBlendedWriteRGB,fr.disabled,q,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Vf(d,t){const s=[...d],h=t.cameraWorldSizeForFog/t.worldSize,m=i.ad.mat4.identity([]);return i.ad.mat4.scale(m,m,[h,h,1]),i.ad.mat4.multiply(s,m,s),i.ad.mat4.multiply(s,t.worldToFogMatrix,s),s}function Io(d,t,s,h,m){const g=s.material,x=h.context,{baseColorTexture:I,metallicRoughnessTexture:P}=g.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:L,emissionTexture:F}=g;function B(X,q,J){if(X&&(d.push(q),x.activeTexture.set(x.gl.TEXTURE0+J),X.gfxTexture)){const{minFilter:Q,magFilter:oe,wrapS:ue,wrapT:ce}=X.sampler;X.gfxTexture.bindExtraParam(Q,oe,ue,ce)}}B(I,"HAS_TEXTURE_u_baseColorTexture",Ri.BaseColor),B(P,"HAS_TEXTURE_u_metallicRoughnessTexture",Ri.MetallicRoughness),B(z,"HAS_TEXTURE_u_normalTexture",Ri.Normal),B(L,"HAS_TEXTURE_u_occlusionTexture",Ri.Occlusion),B(F,"HAS_TEXTURE_u_emissionTexture",Ri.Emission),m&&(m.texture||(m.texture=new i.dn(h.context,m.image,[m.image.height,m.image.height,m.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+Ri.LUT),m.texture&&m.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(d.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||d.push("DIFFUSE_SHADED");const j=h.shadowRenderer;j&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&d.push("NORMAL_OFFSET"))}function rl(d,t,s,h,m,g){const x=s.paint.get("model-opacity").constantOr(1),I=t.context,P=new Xt(t.context.gl.LEQUAL,Xt.ReadWrite,t.depthRangeFor3D),z=t.transform,L=d.mesh,F=L.material,B=F.pbrMetallicRoughness,j=t.style.fog;let X;X=t.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:i.ad.mat4.multiply([],h.zScaleMatrix,d.nodeModelMatrix),i.ad.mat4.multiply(X,h.negCameraPosMatrix,X);const q=i.ad.mat4.invert([],X);i.ad.mat4.transpose(q,q);const J=s.paint.get("model-color-use-theme").constantOr("default")==="none",Q=s.paint.get("model-emissive-strength").constantOr(0),oe=Th(new Float32Array(d.worldViewProjection),new Float32Array(X),new Float32Array(q),null,t,x,B.baseColorFactor.toRenderColor(null),F.emissiveFactor,B.metallicFactor,B.roughnessFactor,F,Q,s),ue={defines:[]},ce=[],ge=t.shadowRenderer;ge&&(ge.useNormalOffset=!1),Io(ue.defines,ce,L,t,J?null:s.lut);let pe=null;if(j){const we=Vf(d.nodeModelMatrix,t.transform);if(pe=new Float32Array(we),z.projection.name!=="globe"){const Ee=L.aabb.min,He=L.aabb.max,[Be,et]=j.getOpacityForBounds(we,Ee[0],Ee[1],He[0],He[1]);ue.overrideFog=Be>=mt||et>=mt}}const _e=ga(t,s.paint.get("model-cutoff-fade-range"));_e.shouldRenderCutoff&&ue.defines.push("RENDER_CUTOFF");const me=t.getOrCreateProgram("model",ue);t.uploadCommonUniforms(I,me,null,pe,_e),t.renderPass!=="shadow"&&ge&&ge.setupShadowsFromMatrix(d.nodeModelMatrix,me),me.draw(t,I.gl.TRIANGLES,P,m,g,L.material.doubleSided?fr.disabled:fr.backCCW,oe,s.id,L.vertexBuffer,L.indexBuffer,L.segments,s.paint,t.transform.zoom,void 0,ce)}function nl(d,t,s,h,m,g,x){let I;I=d.projection.name==="globe"?i.dp(s,d):[...s],i.ad.mat4.multiply(I,I,t.matrix);const P=i.ad.mat4.multiply([],h,I);if(t.meshes)for(const z of t.meshes){if(z.material.alphaMode!=="BLEND"){x.push({mesh:z,depth:0,modelIndex:m,worldViewProjection:P,nodeModelMatrix:I});continue}const L=i.ad.vec3.transformMat4([],z.centroid,P);!d.isOrthographic&&L[2]<=0||g.push({mesh:z,depth:L[2],modelIndex:m,worldViewProjection:P,nodeModelMatrix:I})}if(t.children)for(const z of t.children)nl(d,z,s,h,m,g,x)}function Ta(d,t,s,h){const m=s.shadowRenderer;if(!m)return;const g=m.getShadowPassDepthMode(),x=m.getShadowPassColorMode(),I=m.calculateShadowPassMatrixFromMatrix(t),P=y_(I);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,g,br.disabled,x,fr.backCCW,P,h.id,d.vertexBuffer,d.indexBuffer,d.segments,h.paint,s.transform.zoom,void 0,void 0)}function Uf(d,t,s){const h=t.updateZoomBasedPaintProperties(),m=function(g,x,I){let P,z,L,F=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&F>0){const B=g.terrain,j=B.findDEMTileFor(I);j&&j.dem?P=i.dr.create(B,I,j):F=0}if(F===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),F===x.validForExaggeration&&(F===0||P&&P._demTile&&P._demTile.tileID===x.validForDEMTile.id&&P._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const B in x.instancesPerModel){const j=x.instancesPerModel[B];for(let X=0;X<j.instancedDataArray.length;++X){const q=(P?F*P.getElevationAt(0|j.instancedDataArray.float32[16*X],0|j.instancedDataArray.float32[16*X+1],!0,!0):0)+j.instancesEvaluatedElevation[X];j.instancedDataArray.float32[16*X+6]=q,z=z?Math.min(x.terrainElevationMin,q):q,L=L?Math.max(x.terrainElevationMax,q):q}}return x.terrainElevationMin=z||0,x.terrainElevationMax=L||0,x.validForExaggeration=F,x.validForDEMTile=P&&P._demTile?{id:P._demTile.tileID,timestamp:P._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,t,s);(h||m)&&(t.uploaded=!1,t.upload(d.context))}const $s={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.ce([0,0,0],[i.ai,i.ai,0])};function jf(d,t){const s=1<<d.canonical.z,h=t.getFreeCameraOptions().position,m=t.elevation,g=d.canonical.x/s,x=(d.canonical.x+1)/s,I=d.canonical.y/s,P=(d.canonical.y+1)/s;let z=t._centerAltitude;if(m){const j=m.getMinMaxForTile(d);j&&j.max>z&&(z=j.max)}const L=i.ay(h.x,g,x)-h.x,F=i.ay(h.y,I,P)-h.y,B=i.bH(z,t.center.lat)-h.z;return t._zoomFromMercatorZ(Math.sqrt(L*L+F*F+B*B))}function zh(d,t,s,h,m,g,x){const I=d.context,P=d.renderPass==="shadow",z=d.shadowRenderer,L=P&&z?z.getShadowPassDepthMode():new Xt(I.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D),F=d.isTileAffectedByFog(g);if(s.meshes)for(const B of s.meshes){const j=["MODEL_POSITION_ON_GPU"],X=[];let q,J,Q;h.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const oe=ga(d,t.paint.get("model-cutoff-fade-range"));if(oe.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),P&&z)q=d.getOrCreateProgram("modelDepth",{defines:j}),J=y_(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(s.matrix)),Q=z.getShadowPassColorMode();else{Io(j,X,B,d,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),q=d.getOrCreateProgram("model",{defines:j,overrideFog:F});const ce=B.material,ge=ce.pbrMetallicRoughness,pe=t.paint.get("model-opacity").constantOr(1),_e=t.paint.get("model-emissive-strength").constantOr(0);J=Th(g.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,d,pe,ge.baseColorFactor.toRenderColor(null),ce.emissiveFactor,ge.metallicFactor,ge.roughnessFactor,ce,_e,t,m),z&&(x.shadowUniformsInitialized?q.setShadowUniformValues(I,z.getShadowUniformValues()):(z.setupShadows(g.toUnwrapped(),q,"model-tile",g.overscaledZ),x.shadowUniformsInitialized=!0)),Q=oe.shouldRenderCutoff||pe<1||ce.alphaMode!=="OPAQUE"?Rr.alphaBlended:Rr.unblended}d.uploadCommonUniforms(I,q,g.toUnwrapped(),null,oe);const ue=B.material.doubleSided?fr.disabled:fr.backCCW;if(h.instancedDataArray.length>20)X.push(h.instancedDataBuffer),q.draw(d,I.gl.TRIANGLES,L,br.disabled,Q,ue,J,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,d.transform.zoom,void 0,X,h.instancedDataArray.length);else{const ce=P?"u_instance":"u_normal_matrix";for(let ge=0;ge<h.instancedDataArray.length;++ge)J[ce]=new Float32Array(h.instancedDataArray.arrayBuffer,64*ge,16),q.draw(d,I.gl.TRIANGLES,L,br.disabled,Q,ue,J,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,d.transform.zoom,void 0,X)}}if(s.children)for(const B of s.children)zh(d,t,B,h,m,g,x)}const Co=[1,-1,1];function Sa(d,t,s,h){if(!s.modelManager)return!0;const m=s.modelManager;if(!s.shadowRenderer)return!0;const g=s.shadowRenderer,x=t.aabb;let I=!0,P=d.maxHeight;if(P===0){let L=0;for(const F in d.instancesPerModel){const B=m.getModel(F,h);B?L=Math.max(L,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):I=!1}P=d.maxScale*L*1.41+d.maxVerticalOffset,I&&(d.maxHeight=P)}x.max[2]=P,x.min[2]+=d.terrainElevationMin,x.max[2]+=d.terrainElevationMax,i.ad.vec3.transformMat4(x.min,x.min,t.tileMatrix),i.ad.vec3.transformMat4(x.max,x.max,t.tileMatrix);const z=x.intersects(g.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=z===2),z===0}function Lh(d,t){const s=d.uniformValues.u_cutoff_params[0],h=d.uniformValues.u_cutoff_params[1],m=d.uniformValues.u_cutoff_params[2],g=d.uniformValues.u_cutoff_params[3];return h===s||g===m?1:i.ay(((t-s)/(h-s)-m)/(g-m),0,1)}function Oh(d,t,s,h){if(t.pitch<20)return 1;const m=t.getWorldToCameraMatrix();i.ad.mat4.multiply(m,m,d);const g=i.ad.vec4.fromValues(s.min[0],s.min[1],s.min[2],1);let x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),I=x,P=x;g[1]=s.max[1],x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),I=x[1]<I[1]?x:I,P=x[1]>P[1]?x:P,g[0]=s.max[0],x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),I=x[1]<I[1]?x:I,P=x[1]>P[1]?x:P,g[1]=s.min[1],x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),I=x[1]<I[1]?x:I,P=x[1]>P[1]?x:P;const z=i.ay(h[0],0,1),L=100*t.pixelsPerMeter*i.ay(h[1],0,1),F=i.ay(h[2],0,1),B=i.ad.vec4.lerp(i.ad.vec4.create(),I,P,z),j=Math.tan(.5*t.fovX),X=-B[2]*j;if(L===0)return B[1]<-Math.abs(X)?F:1;const q=(-Math.abs(X)-B[1])/L,J=(oe,ue,ce)=>(1-ce)*oe+ce*ue,Q=i.ay(J(1,F,q),F,1);return J(1,Q,i.ay((t.pitch-20)/20,0,1))}class $f{}class Gf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,h){{const F=this._storage.get(s.id);if(F)return F.lastUsedFrameIdx=t,F.buf}const m=h.gl,g=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),x=new ArrayBuffer(g),I=new Int16Array(x);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const P=new i.dt;for(let F=0;F<g/2;F+=3){const B=I[F],j=I[F+1],X=I[F+2];P.emplaceBack(B,j),P.emplaceBack(j,X),P.emplaceBack(X,B)}const z=h.bindVertexArrayOES.current,L=new $f;return L.buf=new Mo(h,P),L.lastUsedFrameIdx=t,this._storage.set(s.id,L),h.bindVertexArrayOES.set(z),L.buf}update(t){for(const[s,h]of this._storage)t-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class il{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Hf=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Ea{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class kh{constructor(t,s){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Fh=i.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class qf{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const h=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const x=new i.du,I=new i.aV;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(x,Fh.members),this.vignetteIdx=t.context.createIndexBuffer(I)}const m=i.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,h);const x={u_vignetteShape:(g={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:g.vignetteColor};h.draw(t,t.context.gl.TRIANGLES,Xt.disabled,br.disabled,Rr.alphaBlended,fr.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,m)}var g}}class Wf{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const h=t.getFreeCameraOptions().position,m=h.toAltitude(),g=h.toLngLat(),x=i.ak(g.lng),I=i.ak(g.lat),P=t.pixelsPerMeter/s,z=x*i.dv,L=i.dv*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const F=-this._offsetYPrev+L,B=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*P,this._accumulatedOffsetY+=F*P,this._accumulatedElevation+=B*P,this._offsetXPrev=z,this._offsetYPrev=L,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function wi(d,t){return[-(d[0]-Math.floor(d[0]/t)*t),-(d[1]-Math.floor(d[1]/t)*t),-(d[2]-Math.floor(d[2]/t)*t)]}function Bh(d){const t=i.dl(1323123451230),s=[];for(let h=0;h<d;++h){const m=2*t()-1,g=2*t()-1,x=2*t()-1;s.push(i.ad.vec3.fromValues(m,g,x))}return s}function Po(d,t,s,h,m){const g=i.ay((m-s)/(h-s),0,1);return(1-g)*d+g*t}class Aa{constructor(t){this._movement=new Wf,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new qf,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const h=t.transform;this._movement.update(h,this._ppmScaleFactor);const m=h.starsProjMatrix,g=i.ad.quat.identity([]);i.ad.quat.rotateX(g,g,i.ak(90)-h._pitch),i.ad.quat.rotateZ(g,g,-h.angle);const x=i.ad.mat4.fromQuat(new Float32Array(16),g),I=i.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),P=i.ad.mat4.transpose([],I),z=i.ad.mat4.multiply([],P,x),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*s,this._prevTime=L,{projectionMatrix:m,modelviewMatrix:z}}}class Zf extends Aa{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new kh(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=Bh(this.particlesCount),m=new i.dw,g=new i.aV;let x=0;const I=i.dl(1323123451230);for(let P=0;P<h.length;++P){const z=h[P],L=[2*I()-1,I(),I(),I()];m.emplaceBack(z[0],z[1],z[2],-1,-1,...L),m.emplaceBack(z[0],z[1],z[2],1,-1,...L),m.emplaceBack(z[0],z[1],z[2],1,1,...L),m.emplaceBack(z[0],z[1],z[2],-1,1,...L),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=s.createVertexBuffer(m,Hf.members),this.particlesIdx=s.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},h=t.transform.zoom;if(s.revealStart>h)return;const m=Po(0,1,s.revealStart,s.revealStart+s.revealRange,h);if(!this.particlesVx||!this.particlesIdx)return;const g=structuredClone(this._params);let x=[-g.direction.x,g.direction.y,-100];i.ad.vec3.normalize(x,x);const I=structuredClone(this._vignetteParams);I.strength*=m,g.overrideStyleParameters||(g.intensity=t.style.rain.state.density,g.timeFactor=t.style.rain.state.intensity,g.color=structuredClone(t.style.rain.state.color),x=structuredClone(t.style.rain.state.direction),g.screenThinning.intensity=t.style.rain.state.centerThinning,g.dropletSizeX=t.style.rain.state.dropletSize[0],g.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],g.distortionStrength=100*t.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(t.style.rain.state.vignetteColor));const P=this.updateOnRender(t,g.timeFactor),z=t.context,L=z.gl,F=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new i.T(z,{width:t.width,height:t.height,data:null},L.RGBA8)),g.distortionStrength>0&&(z.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const B=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(z,B),z.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const j=[g.color.r,g.color.g,g.color.b,g.color.a],X=(q,J)=>{const Q=wi(this._movement.getPosition(),q),oe=g.dropletSizeX,ue=g.dropletSizeX*g.dropletSizeYScale,ce=t.width/2,ge=t.height/2,pe=Po(0,g.screenThinning.start,0,1,g.screenThinning.intensity),_e=Po(.001,g.screenThinning.range,0,1,g.screenThinning.intensity),me=Po(0,g.screenThinning.particleOffset,0,1,g.screenThinning.intensity),we=(Ee={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Q,velocityConeAperture:g.velocityConeAperture,velocity:g.velocity,boxSize:q,rainDropletSize:[oe,ue],distortionStrength:g.distortionStrength,rainDirection:x,color:j,screenSize:[F.width,F.height],thinningCenterPos:[ce,ge],thinningShape:[pe,_e,Math.pow(10,g.screenThinning.fadePower)],thinningAffectedRatio:g.screenThinning.affectedRatio,thinningParticleOffset:me,shapeDirectionalPower:g.shapeDirPower,shapeNormalPower:g.shapeNormalPower,mode:J?0:1},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_texScreen:0,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_boxSize:Ee.boxSize,u_rainDropletSize:Ee.rainDropletSize,u_distortionStrength:Ee.distortionStrength,u_rainDirection:Ee.rainDirection,u_color:Ee.color,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_shapeDirectionalPower:Ee.shapeDirectionalPower,u_shapeNormalPower:Ee.shapeNormalPower,u_mode:Ee.mode});var Ee;const He=Math.round(g.intensity*this.particlesCount),Be=i.b8.simpleSegment(0,0,4*He,2*He);B.draw(t,L.TRIANGLES,Xt.disabled,br.disabled,Rr.alphaBlended,fr.disabled,we,"rain_particles",this.particlesVx,this.particlesIdx,Be)};g.distortionStrength>0&&X(g.boxSize,!0),X(g.boxSize,!1),this._vignette.draw(t,I)}}const Xf=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Kf extends Aa{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new kh(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=Bh(this.particlesCount),m=new i.dx,g=new i.aV;let x=0;const I=i.dl(1323123451230);for(let P=0;P<h.length;++P){const z=h[P],L=I(),F=I(),B=I(),j=[P/h.length,L,F,B],X=[I(),I()];m.emplaceBack(z[0],z[1],z[2],-1,-1,...j,...X),m.emplaceBack(z[0],z[1],z[2],1,-1,...j,...X),m.emplaceBack(z[0],z[1],z[2],1,1,...j,...X),m.emplaceBack(z[0],z[1],z[2],-1,1,...j,...X),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=s.createVertexBuffer(m,Xf.members),this.particlesIdx=s.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let h=[-s.direction.x,s.direction.y,-100];i.ad.vec3.normalize(h,h);const m=structuredClone(this._vignetteParams),g=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=t.transform.zoom;if(g.revealStart>x)return;const I=Po(0,1,g.revealStart,g.revealStart+g.revealRange,x);m.strength*=I,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),h=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));const P=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=t.context,L=z.gl,F=t.transform,B=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(z,B),((j,X,q)=>{const J=wi(this._movement.getPosition(),j),Q=F.width/2,oe=F.height/2,ue=Po(0,q.screenThinning.start,0,1,q.screenThinning.intensity),ce=Po(.001,q.screenThinning.range,0,1,q.screenThinning.intensity),ge=Po(0,q.screenThinning.particleOffset,0,1,q.screenThinning.intensity),pe=(_e={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:q.velocityConeAperture,velocity:q.velocity,horizontalOscillationRadius:q.horizontalOscillationRadius,horizontalOscillationRate:q.horizontalOscillationRate,boxSize:j,billboardSize:1*q.billboardSize,simpleShapeParameters:[q.shapeFadeStart,q.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[Q,oe],thinningShape:[ue,ce,Math.pow(10,q.screenThinning.fadePower)],thinningAffectedRatio:q.screenThinning.affectedRatio,thinningParticleOffset:ge,color:[q.color.r,q.color.g,q.color.b,q.color.a],direction:h},{u_modelview:Float32Array.from(_e.modelview),u_projection:Float32Array.from(_e.projection),u_time:_e.time,u_cam_pos:_e.camPos,u_velocityConeAperture:_e.velocityConeAperture,u_velocity:_e.velocity,u_horizontalOscillationRadius:_e.horizontalOscillationRadius,u_horizontalOscillationRate:_e.horizontalOscillationRate,u_boxSize:_e.boxSize,u_billboardSize:_e.billboardSize,u_simpleShapeParameters:_e.simpleShapeParameters,u_screenSize:_e.screenSize,u_thinningCenterPos:_e.thinningCenterPos,u_thinningShape:_e.thinningShape,u_thinningAffectedRatio:_e.thinningAffectedRatio,u_thinningParticleOffset:_e.thinningParticleOffset,u_particleColor:_e.color,u_direction:_e.direction});var _e;const me=Math.round(q.intensity*this.particlesCount),we=i.b8.simpleSegment(0,0,4*me,2*me);this.particlesVx&&this.particlesIdx&&B.draw(t,L.TRIANGLES,Xt.disabled,br.disabled,Rr.alphaBlended,fr.disabled,pe,"snow_particles",this.particlesVx,this.particlesIdx,we)})(s.boxSize,0,s),this._vignette.draw(t,m)}}const Ma={symbol:function(d,t,s,h,m){if(d.renderPass!=="translucent")return;const g=br.disabled,x=d.colorModeForRenderPass(),I=s.layout.get("text-variable-anchor"),P=s.layout.get("text-size-scale-range"),z=i.ay(d.scaleFactor,P[0],P[1]);I&&function(B,j,X,q,J,Q,oe,ue){const ce=j.transform,ge=J==="map",pe=Q==="map";for(const _e of B){const me=q.getTile(_e),we=me.getBucket(X);if(!we||!we.text||!we.text.segments.get().length)continue;const Ee=i.bp(we.textSizeData,ce.zoom,ue),He=kc(_e,we.getProjection(),ce),Be=ce.calculatePixelsToTileUnitsMatrix(me),et=Vo(He,me.tileID.canonical,pe,ge,ce,we.getProjection(),Be),rt=we.hasIconTextFit()&&we.hasIconData();if(Ee){const _t=Math.pow(2,ce.zoom-me.tileID.overscaledZ);v_(we,ge,pe,oe,i.cY,ce,et,_e,_t,Ee,rt)}}}(h,d,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m,z);const L=s.paint.get("icon-opacity").constantOr(1)!==0,F=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||F)?ls(d,t,s,h,g,x):(L&&ls(d,t,s,h,g,x,{onlyIcons:!0}),F&&ls(d,t,s,h,g,x,{onlyText:!0})),t.map.showCollisionBoxes&&(Lf(d,t,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Lf(d,t,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,s,h){if(d.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),g=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),I=s.layout.get("circle-sort-key").constantOr(1)!==void 0,P=s.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const z=d.context,L=z.gl,F=d.transform,B=d.depthModeForSublayer(0,Xt.ReadOnly),j=br.disabled,X=d.colorModeForDrapableLayerRenderPass(P),q=F.projection.name==="globe",J=[i.av(F.center.lng),i.aC(F.center.lat)],Q=[];for(let ue=0;ue<h.length;ue++){const ce=h[ue],ge=t.getTile(ce),pe=ge.getBucket(s);if(!pe||pe.projection.name!==F.projection.name)continue;const _e=pe.programConfigurations.get(s.id),me=i.cZ(s),we=d.isTileAffectedByFog(ce);q&&me.push("PROJECTION_GLOBE_VIEW"),me.push("DEPTH_D24"),d.terrain&&F.depthOcclusionForSymbolsAndCircles&&me.push("DEPTH_OCCLUSION");const Ee=d.getOrCreateProgram("circle",{config:_e,defines:me,overrideFog:we}),He=pe.layoutVertexBuffer,Be=pe.globeExtVertexBuffer,et=pe.indexBuffer,rt=F.projection.createInversionMatrix(F,ce.canonical),_t={programConfiguration:_e,program:Ee,layoutVertexBuffer:He,globeExtVertexBuffer:Be,indexBuffer:et,uniformValues:i.c_(d,ce,ge,rt,J,s),tile:ge};if(I){const Oe=pe.segments.get();for(const Qe of Oe)Q.push({segments:new i.b8([Qe]),sortKey:Qe.sortKey,state:_t})}else Q.push({segments:pe.segments,sortKey:0,state:_t})}I&&Q.sort((ue,ce)=>ue.sortKey-ce.sortKey);const oe={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const ue of Q){const{programConfiguration:ce,program:ge,layoutVertexBuffer:pe,globeExtVertexBuffer:_e,indexBuffer:me,uniformValues:we,tile:Ee}=ue.state,He=ue.segments;d.terrain&&d.terrain.setupElevationDraw(Ee,ge,oe),d.uploadCommonUniforms(z,ge,Ee.tileID.toUnwrapped()),ge.draw(d,L.TRIANGLES,B,j,X,fr.disabled,we,s.id,pe,me,He,s.paint,F.zoom,ce,[_e])}},heatmap:function(d,t,s,h){if(s.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const m=d.context,g=m.gl,x=br.disabled,I=new Rr([g.ONE,g.ONE,g.ONE,g.ONE],i.al.transparent,[!0,!0,!0,!0]);(function(j,X,q,J){const Q=j.gl,oe=X.width*J,ue=X.height*J;j.activeTexture.set(Q.TEXTURE1),j.viewport.set([0,0,oe,ue]);let ce=q.heatmapFbo;if(!ce||ce&&(ce.width!==oe||ce.height!==ue)){ce&&ce.destroy();const ge=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,ge),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),ce=q.heatmapFbo=j.createFramebuffer(oe,ue,!0,null),function(pe,_e,me,we,Ee,He){const Be=pe.gl;Be.texImage2D(Be.TEXTURE_2D,0,pe.extRenderToTextureHalfFloat?Be.RGBA16F:Be.RGBA,Ee,He,0,Be.RGBA,pe.extRenderToTextureHalfFloat?Be.HALF_FLOAT:Be.UNSIGNED_BYTE,null),we.colorAttachment.set(me)}(j,0,ge,ce,oe,ue)}else Q.bindTexture(Q.TEXTURE_2D,ce.colorAttachment.get()),j.bindFramebuffer.set(ce.framebuffer)})(m,d,s,d.transform.projection.name==="globe"?.5:.25),m.clear({color:i.al.transparent});const P=d.transform,z=P.projection.name==="globe",L=z?["PROJECTION_GLOBE_VIEW"]:[],F=z?fr.frontCCW:fr.disabled,B=[i.av(P.center.lng),i.aC(P.center.lat)];for(let j=0;j<h.length;j++){const X=h[j];if(t.hasRenderableParent(X))continue;const q=t.getTile(X),J=q.getBucket(s);if(!J||J.projection.name!==P.projection.name)continue;const Q=d.isTileAffectedByFog(X),oe=J.programConfigurations.get(s.id),ue=d.getOrCreateProgram("heatmap",{config:oe,defines:L,overrideFog:Q}),{zoom:ce}=d.transform;d.terrain&&d.terrain.setupElevationDraw(q,ue),d.uploadCommonUniforms(m,ue,X.toUnwrapped());const ge=P.projection.createInversionMatrix(P,X.canonical);ue.draw(d,g.TRIANGLES,Xt.disabled,x,I,F,kl(d,X,q,ge,B,ce,s.paint.get("heatmap-intensity")),s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,d.transform.zoom,oe,z?[J.globeExtVertexBuffer]:null)}m.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(m,g){const x=m.context,I=x.gl,P=g.heatmapFbo;if(!P)return;x.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get()),x.activeTexture.set(I.TEXTURE1);let z=g.colorRampTexture;z||(z=g.colorRampTexture=new i.T(x,g.colorRamp,I.RGBA8)),z.bind(I.LINEAR,I.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,I.TRIANGLES,Xt.disabled,br.disabled,m.colorModeForRenderPass(),fr.disabled,((L,F,B,j)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,g),g.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,g.paint,m.transform.zoom)}(d,s))},line:function(d,t,s,h){if(d.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),g=s.paint.get("line-width");if(m.constantOr(1)===0||g.constantOr(1)===0)return;const x=s.paint.get("line-emissive-strength"),I=s.paint.get("line-occlusion-opacity"),P=s.layout.get("line-elevation-reference"),z=s.layout.get("line-width-unit")==="meters",L=P==="sea",F=d.context,B=F.gl;if(s.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const j=s.layout.get("line-cross-slope"),X=j!==void 0,q=j<1,J=d.colorModeForDrapableLayerRenderPass(x),Q=d.terrain&&d.terrain.renderingToTexture,oe=Q?1:i.q.devicePixelRatio,ue=s.paint.get("line-dasharray"),ce=ue.constantOr(1),ge=s.layout.get("line-cap"),pe=ue.constantOr(null),_e=ge.constantOr(null),me=s.paint.get("line-pattern"),we=me.constantOr(1),Ee=me.constantOr(null),He=s.paint.get("line-opacity").constantOr(1);let Be=!we&&He!==1||d.depthOcclusion&&I>0&&I<1;const et=s.paint.get("line-gradient"),rt=we?"linePattern":"line",_t=i.c$(s);let Oe;if(Q&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Be=!1),I!==0&&d.depthOcclusion){const De=s.paint._values["line-opacity"];De&&De.value&&De.value.kind==="constant"?Oe=De.value:i.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}g.value.kind!=="constant"&&g.value.isLineProgressConstant===!1&&_t.push("VARIABLE_LINE_WIDTH");const Qe=(De,Je,Ze,ot,$e,ct)=>{for(const Tt of De){const Mt=t.getTile(Tt);if(we&&!Mt.patternsLoaded())continue;const Lt=Mt.getBucket(s);if(!Lt||Lt.hasZOffset&&!$e||!Lt.hasZOffset&&$e)continue;d.prepareDrawTile();const Wt=Lt.programConfigurations.get(s.id),pr=d.isTileAffectedByFog(Tt),nr=d.getOrCreateProgram(rt,{config:Wt,defines:Je,overrideFog:pr,overrideRtt:!$e&&void 0});if(Ee&&Mt.imageAtlas){const wr=i.d0.from(Ee).getPrimary().scaleSelf(oe).toString(),gr=Mt.imageAtlas.patternPositions.get(wr);gr&&Wt.setConstantPatternPositions(gr)}if(!we&&pe&&_e&&Mt.lineAtlas){const wr=Mt.lineAtlas.getDash(pe,_e);wr&&Wt.setConstantPatternPositions(wr)}let[mr,hr]=s.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&mr!==hr&&(mr===0&&(mr-=1),hr===1&&(hr+=1));const Br=Q?Tt.projMatrix:null,on=z?1/Lt.tileToMeter/i.at(Mt,1,d.transform.zoom):1,pn=z?1/Lt.tileToMeter/i.at(Mt,1,Math.floor(d.transform.zoom)):1,Dr=we?i.d1(d,Mt,s,Br,oe,on,pn,[mr,hr]):i.d2(d,Mt,s,Br,Lt.lineClipsArray.length,oe,on,pn,[mr,hr]);if(et){const wr=Lt.gradients[s.id];let gr=wr.texture;if(s.gradientVersion!==wr.version){let or=256;if(s.stepInterpolant){const en=t.getSource().maxzoom,tn=Tt.canonical.z===en?Math.ceil(1<<d.transform.maxZoom-Tt.canonical.z):1;or=i.ay(i.d3(Lt.maxLineLength/i.ai*1024*tn),256,F.maxTextureSize)}wr.gradient=i.d4({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:or,image:wr.gradient||void 0,clips:Lt.lineClipsArray}),wr.texture?wr.texture.update(wr.gradient):wr.texture=new i.T(F,wr.gradient,B.RGBA8),wr.version=s.gradientVersion,gr=wr.texture}F.activeTexture.set(B.TEXTURE1),gr.bind(s.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}ce&&(F.activeTexture.set(B.TEXTURE0),Mt.lineAtlasTexture&&Mt.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),Wt.updatePaintBuffers()),we&&(F.activeTexture.set(B.TEXTURE0),Mt.imageAtlasTexture&&Mt.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Wt.updatePaintBuffers()),$e&&!L&&d.terrain.setupElevationDraw(Mt,nr),d.uploadCommonUniforms(F,nr,Tt.toUnwrapped());const zn=wr=>{Oe!=null&&(Oe.value=He*I),nr.draw(d,B.TRIANGLES,Ze,wr,J,fr.disabled,Dr,s.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,s.paint,d.transform.zoom,Wt,[Lt.layoutVertexBuffer2,Lt.patternVertexBuffer,Lt.zOffsetVertexBuffer]),Oe!=null&&(Oe.value=He)};if(Be&&!$e){const wr=d.stencilModeForClipping(Tt).ref;wr===0&&Q&&F.clear({stencil:0});const gr={func:B.EQUAL,mask:255};Dr.u_alpha_discard_threshold=.8,zn(new br(gr,wr,255,B.KEEP,B.KEEP,B.INVERT)),Dr.u_alpha_discard_threshold=0,zn(new br(gr,wr,255,B.KEEP,B.KEEP,B.KEEP))}else Dr.u_alpha_discard_threshold=Be&&$e&&ct?.8:0,zn($e?ot:d.stencilModeForClipping(Tt))}};if(s.hasNonElevatedBuckets){const De=!Q&&d.terrain;I!==0&&De?i.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):De?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):Qe(h,_t,d.depthModeForSublayer(0,Xt.ReadOnly),br.disabled,!1,!0)}if(s.hasElevatedBuckets){_t.push("ELEVATED"),X&&_t.push(q?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&_t.push("ELEVATION_REFERENCE_SEA");const De=Be?d.stencilModeFor3D():br.disabled,Je=new Xt(d.depthOcclusion?B.GREATER:B.LEQUAL,Xt.ReadOnly,d.depthRangeFor3D);d.forceTerrainMode=!0,Qe(h,_t,Je,De,!0,!0),Be&&Qe(h,_t,Je,De,!0,!1),d.forceTerrainMode=!1}Be&&(d.resetStencilClippingMasks(),Q&&F.clear({stencil:0})),I===0||d.depthOcclusion||Q||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,t,s,h){const m=s.paint.get("fill-color"),g=s.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const x=s.paint.get("fill-emissive-strength"),I=d.colorModeForDrapableLayerRenderPass(x),P=s.paint.get("fill-pattern"),z=d.opaquePassEnabledForLayer()&&!P.constantOr(1)&&m.constantOr(i.al.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";let L="none";s.layout.get("fill-elevation-reference")!=="none"?L="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const F=!(!d.terrain||!d.terrain.enabled),B={painter:d,sourceCache:t,layer:s,coords:h,colorMode:I,elevationType:L,terrainEnabled:F,pass:z};if(L!=="offset"){if(Ih(B,!1),L==="road"){const j=!F&&d.renderPass==="translucent";j&&Mh(d,t,s,h,"geometry"),Ih(B,!0,br.disabled),j&&function(X){const{painter:q,sourceCache:J,layer:Q,coords:oe,colorMode:ue}=X,ce=q.context.gl,ge=new Xt(q.context.gl.LEQUAL,Xt.ReadOnly,q.depthRangeFor3D);for(const pe of oe){const _e=J.getTile(pe),me=_e.getBucket(Q);if(!me)continue;const we=me.elevatedStructures;if(!we||!we.renderableSegments||we.renderableSegments.segments[0].primitiveLength===0)continue;q.prepareDrawTile();const Ee=me.bufferData.programConfigurations.get(Q.id),He=q.isTileAffectedByFog(pe),Be=q.getOrCreateProgram("elevatedStructures",{config:Ee,overrideFog:He,defines:["NORMAL_OFFSET"]}),et={u_matrix:q.translatePosMatrix(pe.projMatrix,_e,Q.paint.get("fill-translate"),Q.paint.get("fill-translate-anchor"))};q.uploadCommonUniforms(q.context,Be,pe.toUnwrapped()),Be.draw(q,ce.TRIANGLES,ge,br.disabled,ue,fr.backCCW,et,Q.id,we.vertexBuffer,we.indexBuffer,we.renderableSegments,Q.paint,q.transform.zoom,Ee,[we.vertexBufferNormal])}}(B)}}else Ih(B,!1,d.stencilModeFor3D())},"fill-extrusion":function(d,t,s,h){const m=s.paint.get("fill-extrusion-opacity"),g=d.context,x=g.gl,I=d.terrain,P=I&&I.renderingToTexture;if(m===0)return;const z=d.conflationActive&&d.style.isLayerClipped(s,t.getSource()),L=d.style.order.indexOf(s.fqid);if(z&&function(F,B,j,X,q){for(const J of X){const Q=B.getTile(J).getBucket(j);Q&&(Q.updateReplacement(J,F.replacementSource,q),Q.uploadCentroid(F.context))}}(d,t,s,h,L),I||z)for(const F of h){const B=t.getTile(F).getBucket(s);B&&T0(d.context,t,F,B,s,I,z)}if(d.renderPass==="shadow"&&d.shadowRenderer){const F=d.shadowRenderer;if(I&&m<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const B=F.getShadowPassDepthMode(),j=F.getShadowPassColorMode();Kc(d,t,s,h,B,br.disabled,j,z)}else if(d.renderPass==="translucent"){const F=!s.paint.get("fill-extrusion-pattern").constantOr(1),B=s.paint.get("fill-extrusion-color").constantOr(i.al.white);if(!P&&B.a!==0){const j=new Xt(d.context.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D);m===1&&F?Kc(d,t,s,h,j,br.disabled,Rr.unblended,z):(Kc(d,t,s,h,j,br.disabled,Rr.disabled,z),Kc(d,t,s,h,j,d.stencilModeFor3D(),d.colorModeForRenderPass(),z),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&F&&(!I&&d.transform.projection.name!=="globe"||P)){const j=s.paint.get("fill-extrusion-opacity"),X=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),q=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),J=s.paint.get("fill-extrusion-flood-light-intensity"),Q=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",oe=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(Q?null:s.lut).toArray01().slice(0,3),ue=X>0&&q>0,ce=J>0,ge=(_e,me,we)=>(1-we)*_e+we*me,pe=_e=>{const me=d.depthModeForSublayer(1,Xt.ReadOnly,x.LEQUAL,!0),we=s.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ee=ge(.1,3,we),He=d._showOverdrawInspector;if(!He){const Be=new br({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),et=new Rr([x.ONE,x.ONE,x.ONE,x.ONE],i.al.transparent,[!1,!1,!1,!0],x.MIN);el(d,t,s,h,me,Be,et,fr.disabled,_e,"sdf",j,X,q,J,oe,Ee,z,!1)}{const Be=He?br.disabled:new br({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),et=He?d.colorModeForRenderPass():new Rr([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],i.al.transparent,[!0,!0,!0,!0]);el(d,t,s,h,me,Be,et,fr.disabled,_e,"color",j,X,q,J,oe,Ee,z,!1)}};if(P){const _e=(me,we,Ee)=>{const He=d.depthModeForSublayer(1,Xt.ReadOnly,x.LEQUAL,!1),Be=s.paint.get(me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),et=ge(.1,3,Be);{const rt=new Rr([x.ONE,x.ONE,x.ONE,x.ONE],i.al.transparent,[!1,!1,!1,!0]);el(d,t,s,h,He,br.disabled,rt,fr.disabled,me,"clear",j,X,q,J,oe,et,z,we)}{const rt=new br({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),_t=new Rr([x.ONE,x.ONE,x.ONE,x.ONE],i.al.transparent,[!1,!1,!1,!0],x.MIN);el(d,t,s,h,He,rt,_t,fr.disabled,me,"sdf",j,X,q,J,oe,et,z,we)}{const rt=me?x.ZERO:x.ONE_MINUS_DST_ALPHA,_t=new br({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Oe=new Rr([rt,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],i.al.transparent,[!0,!0,!0,!0]);el(d,t,s,h,He,_t,Oe,fr.disabled,me,"color",j,X,q,J,oe,et,z,we)}{const rt=new Rr([x.ONE,x.ONE,x.ONE,me?x.ZERO:x.ONE],i.al.transparent,[!1,!1,!1,!0],me?x.FUNC_ADD:x.MAX);el(d,t,s,h,He,br.disabled,rt,fr.disabled,me,"clear",j,X,q,J,oe,et,z,we,Ee)}};if(ue||ce){let me;if(d.prepareDrawTile(),I){const we=I.drapeBufferSize[0],Ee=I.drapeBufferSize[1];me=I.framebufferCopyTexture,me&&(!me||me.size[0]===we&&me.size[1]===Ee)||(me&&me.destroy(),me=I.framebufferCopyTexture=new i.T(g,new i.r({width:we,height:Ee}),x.RGBA8)),me.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,we,Ee)}ue&&_e(!0,!1,me),ce&&_e(!1,!0,me)}}else ue&&pe(!0),ce&&pe(!1),(ue||ce)&&d.resetStencilClippingMasks()}}},hillshade:function(d,t,s,h){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const m=d.context,g=d.terrain&&d.terrain.renderingToTexture,[x,I]=d.renderPass!=="translucent"||g?[{},h]:d.stencilConfigForOverlap(h);for(const P of I){const z=t.getTile(P);if(z.needsHillshadePrepare&&d.renderPass==="offscreen")t_(d,z,s);else if(d.renderPass==="translucent"){const L=d.depthModeForSublayer(0,Xt.ReadOnly),F=s.paint.get("hillshade-emissive-strength"),B=d.colorModeForDrapableLayerRenderPass(F),j=g&&d.terrain?d.terrain.stencilModeForRTTOverlap(P):x[P.overscaledZ];e_(d,P,z,s,L,j,B)}}m.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,t,s,h,m,g){if(d.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const x=d.transform.projection.name==="globe",I=s.paint.get("raster-elevation")!==0,P=I&&x;if(d.renderElevatedRasterBackface&&!P)return;const z=d.context,L=z.gl,F=t.getSource(),B=function(pe,_e,me,we){const Ee=_e.paint.get("raster-color"),He=pe.type==="raster-array",Be=[],et=_e.paint.get("raster-resampling"),rt=_e.paint.get("raster-color-mix");let _t=_e.paint.get("raster-color-range");const Oe=[rt[0],rt[1],rt[2],0],Qe=rt[3];let De=et==="nearest"?we.NEAREST:we.LINEAR;if(He&&(Be.push("RASTER_ARRAY"),Ee||Be.push("RASTER_COLOR"),et==="linear"&&Be.push("RASTER_ARRAY_LINEAR"),De=we.NEAREST,!_t&&pe.rasterLayers)){const Je=pe.rasterLayers.find(({id:Ze})=>Ze===_e.sourceLayer);Je&&Je.fields&&Je.fields.range&&(_t=Je.fields.range)}if(_t=_t||[0,1],Ee){Be.push("RASTER_COLOR"),me.activeTexture.set(we.TEXTURE2),_e.updateColorRamp(_t);let Je=_e.colorRampTexture;Je||(Je=_e.colorRampTexture=new i.T(me,_e.colorRamp,we.RGBA8)),Je.bind(we.LINEAR,we.CLAMP_TO_EDGE)}return{mix:Oe,range:_t,offset:Qe,defines:Be,resampling:De}}(F,s,z,L);if(F instanceof i.aK&&!h.length&&!x)return;const j=s.paint.get("raster-emissive-strength"),X=d.colorModeForDrapableLayerRenderPass(j),q=d.terrain&&d.terrain.renderingToTexture,J=!d.options.moving,Q=s.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(F instanceof i.aK&&!h.length&&(F.onNorthPole||F.onSouthPole)){const pe=I?d.stencilModeFor3D():br.disabled;return void jn(!!F.onNorthPole,null,d,t,s,j,B,fr.disabled,pe)}if(!h.length)return;const[oe,ue]=F instanceof i.aK||q?[{},h]:d.stencilConfigForOverlap(h),ce=ue[ue.length-1].overscaledZ;P&&B.defines.push("PROJECTION_GLOBE_VIEW"),I&&B.defines.push("RENDER_CUTOFF");const ge=(pe,_e,me)=>{for(const we of pe){const Ee=we.toUnwrapped(),He=t.getTile(we);if(q&&(!He||!He.hasData()))continue;z.activeTexture.set(L.TEXTURE0);const Be=x_(He,F,s,B);if(!Be||!Be.texture)continue;const{texture:et,mix:rt,offset:_t,tileSize:Oe,buffer:Qe}=Be;let De,Je;q?(De=Xt.disabled,Je=we.projMatrix):I?(De=new Xt(L.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D),Je=x?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(Ee,J)):(De=d.depthModeForSublayer(we.overscaledZ-ce,s.paint.get("raster-opacity")===1?Xt.ReadWrite:Xt.ReadOnly,L.LESS),Je=d.transform.calculateProjMatrix(Ee,J));const Ze=d.terrain&&q?d.terrain.stencilModeForRTTOverlap(we):oe[we.overscaledZ],ot=g?0:s.paint.get("raster-fade-duration");He.registerFadeDuration(ot);const $e=t.findLoadedParent(we,0),ct=Dl(He,$e,t,d.transform,ot);let Tt,Mt;d.terrain&&d.terrain.prepareDrawTile(),z.activeTexture.set(L.TEXTURE0),et.bind(Q,L.CLAMP_TO_EDGE),z.activeTexture.set(L.TEXTURE1),$e?($e.texture&&$e.texture.bind(Q,L.CLAMP_TO_EDGE),Tt=Math.pow(2,$e.tileID.overscaledZ-He.tileID.overscaledZ),Mt=[He.tileID.canonical.x*Tt%1,He.tileID.canonical.y*Tt%1]):et.bind(Q,L.CLAMP_TO_EDGE),"useMipmap"in et&&z.extTextureFilterAnisotropic&&d.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Lt=d.transform;let Wt;const pr=I?Ue(Lt):[0,0,0,0];let nr,mr,hr,Br,on,pn=0;if(P&&F instanceof i.aK&&F.coordinates.length>3)nr=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0)))),mr=Float32Array.from(Lt.globeMatrix),hr=Float32Array.from(i.cE(Lt)),Br=[i.av(Lt.center.lng),i.aC(Lt.center.lat)],Wt=F.elevatedGlobePerspectiveTransform,on=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(P){const gr=i.cF(we.canonical);pn=i.cG(gr.getCenter().lat),nr=Float32Array.from(i.bc(i.cI(we.canonical))),mr=Float32Array.from(Lt.globeMatrix),hr=Float32Array.from(i.cE(Lt)),Br=[i.av(Lt.center.lng),i.aC(Lt.center.lat)],Wt=[0,0],on=Float32Array.from(i.cH(we.canonical,gr,pn,Lt.worldSize/Lt._pixelsPerMercatorPixel))}else Wt=F instanceof i.aK?F.perspectiveTransform:[0,0],nr=new Float32Array(16),mr=new Float32Array(9),hr=new Float32Array(16),Br=[0,0],on=new Float32Array(9);const Dr=If(Je,nr,mr,hr,on,Mt||[0,0],i.ag(d.transform.zoom),Br,pr,Tt||1,ct,s,Wt,I?s.paint.get("raster-elevation"):0,2,rt,_t,B.range,Oe,Qe,j),zn=d.isTileAffectedByFog(we),wr=d.getOrCreateProgram("raster",{defines:B.defines,overrideFog:zn});if(d.uploadCommonUniforms(z,wr,Ee),F instanceof i.aK){const gr=F.elevatedGlobeVertexBuffer,or=F.elevatedGlobeIndexBuffer;if(q||!x)F.boundsBuffer&&F.boundsSegments&&wr.draw(d,L.TRIANGLES,De,br.disabled,X,fr.disabled,Dr,s.id,F.boundsBuffer,d.quadTriangleIndexBuffer,F.boundsSegments);else if(gr&&or){const en=Lt.zoom<=i.c6?F.elevatedGlobeSegments:F.getSegmentsForLongitude(Lt.center.lng);en&&wr.draw(d,L.TRIANGLES,De,br.disabled,X,_e,Dr,s.id,gr,or,en)}}else if(P){De=new Xt(L.LEQUAL,Xt.ReadOnly,d.depthRangeFor3D);const gr=d.globeSharedBuffers;if(gr){const[or,en,tn]=gr.getGridBuffers(pn,!1);wr.draw(d,L.TRIANGLES,De,me||Ze,d.colorModeForRenderPass(),_e,Dr,s.id,or,en,tn)}}else{const{tileBoundsBuffer:gr,tileBoundsIndexBuffer:or,tileBoundsSegments:en}=d.getTileBoundsBuffers(He);wr.draw(d,L.TRIANGLES,De,Ze,X,fr.disabled,Dr,s.id,gr,or,en)}}if(!(F instanceof i.aK)&&P)for(const we of pe){const Ee=we.canonical.y===(1<<we.canonical.z)-1;we.canonical.y===0&&jn(!0,we,d,t,s,j,B,_e,me||br.disabled),Ee&&jn(!1,we,d,t,s,j,B,_e===fr.frontCW?fr.backCW:fr.frontCW,me||br.disabled)}};P?ge(ue,d.renderElevatedRasterBackface?fr.backCW:fr.frontCW,d.stencilModeFor3D()):ge(ue,fr.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,t,s,h,m,g){d.renderPass==="offscreen"&&function(x,I,P,z){if(!z.length)return;const L=x.context,F=L.gl,B=I.getSource();if(!(B instanceof xs))return;const j=Math.ceil(Math.sqrt(P.paint.get("raster-particle-count")));let X=P.particlePositionRGBAImage;if(!X||X.width!==j){const ue=function(ce){const ge=ce*ce,pe=new Uint8Array(4*ge),_e=function(we){return we|=0,we=Math.imul(2747636419^we,2654435769),we=Math.imul(we^we>>>16,2654435769),((we=Math.imul(we^we>>>16,2654435769))>>>0)/4294967296},me=1/1.1;for(let we=0;we<ge;we++){const Ee=me*(_e(2*we+0)+Ss),He=me*(_e(2*we+1)+Ss),Be=255*Ee%1,et=255*He%1,rt=Be,_t=He-et/255,Oe=et;pe[4*we+0]=255*(Ee-Be/255),pe[4*we+1]=255*rt,pe[4*we+2]=255*_t,pe[4*we+3]=255*Oe}return pe}(j);X=P.particlePositionRGBAImage=new i.r({width:j,height:j},ue)}let q=P.particleFramebuffer;q?q.width!==j&&(q.destroy(),q=P.particleFramebuffer=L.createFramebuffer(j,j,!0,null)):q=P.particleFramebuffer=L.createFramebuffer(j,j,!0,null);const J=[];for(const ue of z){const ce=I.getTile(ue);if(!(ce instanceof _a))continue;const ge=Ff(ce,B,P);if(!ge)continue;const pe=[ce.tileSize,ce.tileSize];let _e=P.tileFramebuffer;_e||(_e=P.tileFramebuffer=L.createFramebuffer(pe[0],pe[1],!0,null));let me=ce.rasterParticleState;me||(me=ce.rasterParticleState=new kf(L,ue,pe,X));const we=me.update(P.lastInvalidatedAt);me.particleTextureDimension!==j&&me.updateParticleTexture(ue,X);const Ee=me.targetColorTexture;me.targetColorTexture=me.backgroundColorTexture,me.backgroundColorTexture=Ee;const He=me.particleTexture0;me.particleTexture0=me.particleTexture1,me.particleTexture1=He,J.push([ue,ge,me,we])}if(J.length===0)return;const Q=i.q.now(),oe=P.previousDrawTimestamp?.001*(Q-P.previousDrawTimestamp):.0167;if(P.previousDrawTimestamp=Q,P.hasColorMap()){L.activeTexture.set(F.TEXTURE0+2);let ue=P.colorRampTexture;ue||(ue=P.colorRampTexture=new i.T(L,P.colorRamp,F.RGBA8)),ue.bind(F.LINEAR,F.CLAMP_TO_EDGE)}L.bindFramebuffer.set(P.tileFramebuffer.framebuffer),function(ue,ce,ge){const pe=ue.context,_e=pe.gl,me=ce.tileFramebuffer;pe.activeTexture.set(_e.TEXTURE0);const we={u_texture:0,u_opacity:1.05*(He=ce.paint.get("raster-particle-fade-opacity-factor"))/(He+.05)},Ee=ue.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var He;for(const Be of ge){const[,,et,rt]=Be;me.colorAttachment.set(et.targetColorTexture.texture),pe.viewport.set([0,0,me.width,me.height]),pe.clear({color:i.al.transparent}),rt&&(et.backgroundColorTexture.bind(_e.NEAREST,_e.CLAMP_TO_EDGE),Ee.draw(ue,_e.TRIANGLES,Xt.disabled,br.disabled,Rr.alphaBlended,fr.disabled,we,ce.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments))}}(x,P,J),function(ue,ce,ge,pe){const _e=ue.context,me=_e.gl,we=ge.tileFramebuffer,Ee=ue.transform.projection.name==="globe",He=ge.paint.get("raster-particle-max-speed");for(const Be of pe){const[et,rt,_t]=Be;_e.activeTexture.set(me.TEXTURE0+0),rt.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),we.colorAttachment.set(_t.targetColorTexture.texture);const Oe=ue.getOrCreateProgram("rasterParticleDraw",{defines:rt.defines,overrideFog:!1});_e.activeTexture.set(me.TEXTURE0+1);const Qe=rt.scalarData?[]:[0,1,2,3].map(Ze=>i.d7[Ze](et));Qe.push(et);const De=et.canonical.x,Je=et.canonical.y;for(const Ze of Qe){const ot=ce.getTile(Ee?Ze.wrapped():Ze);if(!ot)continue;const $e=ot.rasterParticleState;if(!$e)continue;const ct=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-et.wrap),Tt=Ze.canonical.y;$e.particleTexture0.bind(me.NEAREST,me.CLAMP_TO_EDGE);const Mt=Qt(1,$e.particleTexture0.size[0],[ct-De,Tt-Je],0,rt.texture.size,2,He,rt.textureOffset,rt.scale,rt.offset);Oe.draw(ue,me.POINTS,Xt.disabled,br.disabled,Rr.alphaBlended,fr.disabled,Mt,ge.id,$e.particleIndexBuffer,void 0,$e.particleSegment)}}}(x,I,P,J),L.bindFramebuffer.set(P.particleFramebuffer.framebuffer),function(ue,ce,ge,pe){const _e=ue.context,me=_e.gl,we=ce.paint.get("raster-particle-max-speed"),Ee=pe*ce.paint.get("raster-particle-speed-factor")*.15,He=function(et){return Math.pow(et,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Be=ce.particleFramebuffer;_e.viewport.set([0,0,Be.width,Be.height]);for(const et of ge){const[,rt,_t]=et;_e.activeTexture.set(me.TEXTURE0+0),rt.texture.bind(me.LINEAR,me.CLAMP_TO_EDGE),_e.activeTexture.set(me.TEXTURE0+1);const Oe=_t.particleTexture0;Oe.bind(me.NEAREST,me.CLAMP_TO_EDGE);const Qe=Cf(1,Oe.size[0],0,rt.texture.size,we,Ee,He,rt.textureOffset,rt.scale,rt.offset);Be.colorAttachment.set(_t.particleTexture1.texture),_e.clear({color:i.al.transparent}),ue.getOrCreateProgram("rasterParticleUpdate",{defines:rt.defines}).draw(ue,me.TRIANGLES,Xt.disabled,br.disabled,Rr.unblended,fr.disabled,Qe,ce.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments)}}(x,P,J,oe)}(d,t,s,h),d.renderPass==="translucent"&&(function(x,I,P,z,L){const F=x.context,B=F.gl,j=I.getSource().tileSize,X=5*(1-i.ae(i.bY,i.bY+1,x.transform.zoom))*j+P.paint.get("raster-particle-elevation"),q=!x.options.moving,J=x.transform.projection.name==="globe";if(!z.length)return;const[Q,oe]=x.stencilConfigForOverlap(z),ue=[];J&&ue.push("PROJECTION_GLOBE_VIEW");const ce=x.stencilModeFor3D();for(const ge of oe){const pe=ge.toUnwrapped(),_e=I.getTile(ge);if(!_e.rasterParticleState)continue;const me=_e.rasterParticleState,we=100;_e.registerFadeDuration(we);const Ee=I.findLoadedParent(ge,0),He=Dl(_e,Ee,I,x.transform,we);let Be,et;x.terrain&&x.terrain.prepareDrawTile(),F.activeTexture.set(B.TEXTURE0),me.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),F.activeTexture.set(B.TEXTURE1),Ee&&Ee.rasterParticleState?(Ee.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Be=Math.pow(2,Ee.tileID.overscaledZ-_e.tileID.overscaledZ),et=[_e.tileID.canonical.x*Be%1,_e.tileID.canonical.y*Be%1]):me.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const rt=J?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(pe,q),_t=x.transform,Oe=b_(_t),Qe=i.cF(ge.canonical),De=i.cG(Qe.getCenter().lat);let Je,Ze,ot,$e,ct;J?(Je=Float32Array.from(i.bc(i.cI(ge.canonical))),Ze=Float32Array.from(_t.globeMatrix),ot=Float32Array.from(i.cE(_t)),$e=[i.av(_t.center.lng),i.aC(_t.center.lat)],ct=Float32Array.from(i.cH(ge.canonical,Qe,De,_t.worldSize/_t._pixelsPerMercatorPixel))):(Je=new Float32Array(16),Ze=new Float32Array(9),ot=new Float32Array(16),$e=[0,0],ct=new Float32Array(9));const Tt=wa(rt,Je,Ze,ot,ct,et||[0,0],i.ag(x.transform.zoom),$e,Oe,Be||1,He,X),Mt=x.isTileAffectedByFog(ge),Lt=x.getOrCreateProgram("rasterParticle",{defines:ue,overrideFog:Mt});if(x.uploadCommonUniforms(F,Lt,pe),J){const Wt=new Xt(B.LEQUAL,Xt.ReadOnly,x.depthRangeFor3D),pr=0,nr=x.globeSharedBuffers;if(nr){const[mr,hr,Br]=nr.getGridBuffers(De,pr!==0);Lt.draw(x,B.TRIANGLES,Wt,ce,Rr.alphaBlended,x.renderElevatedRasterBackface?fr.frontCCW:fr.backCCW,Tt,P.id,mr,hr,Br)}}else{const Wt=x.depthModeForSublayer(0,Xt.ReadOnly),pr=Q[ge.overscaledZ],{tileBoundsBuffer:nr,tileBoundsIndexBuffer:mr,tileBoundsSegments:hr}=x.getTileBoundsBuffers(_e);Lt.draw(x,B.TRIANGLES,Wt,pr,Rr.alphaBlended,fr.disabled,Tt,P.id,nr,mr,hr)}}x.resetStencilClippingMasks()}(d,t,s,h),d.style.map.triggerRepaint())},background:function(d,t,s,h){const m=s.paint.get("background-color"),g=s.paint.get("background-color-use-theme").constantOr("default")==="none",x=s.paint.get("background-opacity"),I=s.paint.get("background-emissive-strength"),P=s.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const z=d.context,L=z.gl,F=d.transform,B=F.tileSize,j=s.paint.get("background-pattern");let X;if(j!==void 0&&(j===null||(X=d.imageManager.getPattern(i.I.from(j.toString()),s.scope,d.style.getLut(s.scope)),!X)))return;const q=!j&&m.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==q)return;const J=br.disabled,Q=d.depthModeForSublayer(0,q==="opaque"?Xt.ReadWrite:Xt.ReadOnly),oe=d.colorModeForDrapableLayerRenderPass(I),ue=j?"backgroundPattern":"background";let ce,ge=h;if(ge||(ce=d.getBackgroundTiles(),ge=Object.values(ce).map(pe=>pe.tileID)),j&&(z.activeTexture.set(L.TEXTURE0),d.imageManager.bind(d.context,s.scope)),P){const pe=d.getOrCreateProgram(ue,{overrideFog:!1,overrideRtt:!0}),_e=new Float32Array(i.ad.mat4.identity([])),me=new i.aH(0,0,0,0,0),we=j?Pf(_e,I,x,d,0,s.scope,X,P,{tileID:me,tileSize:B}):wh(_e,I,x,m.toRenderColor(g?null:s.lut));pe.draw(d,L.TRIANGLES,Q,J,oe,fr.disabled,we,s.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const pe of ge){const _e=d.isTileAffectedByFog(pe),me=d.getOrCreateProgram(ue,{overrideFog:_e}),we=pe.toUnwrapped(),Ee=h?pe.projMatrix:d.transform.calculateProjMatrix(we);d.prepareDrawTile();const He=t?t.getTile(pe):ce?ce[pe.key]:new ma(pe,B,F.zoom,d),Be=j?Pf(Ee,I,x,d,0,s.scope,X,P,{tileID:pe,tileSize:B}):wh(Ee,I,x,m.toRenderColor(g?null:s.lut));d.uploadCommonUniforms(z,me,we);const{tileBoundsBuffer:et,tileBoundsIndexBuffer:rt,tileBoundsSegments:_t}=d.getTileBoundsBuffers(He);me.draw(d,L.TRIANGLES,Q,J,oe,fr.disabled,Be,s.id,et,rt,_t)}},sky:function(d,t,s){const h=d._atmosphere?i.ag(d.transform.zoom):1,m=s.paint.get("sky-opacity")*h;if(m===0)return;const g=d.context,x=s.paint.get("sky-type"),I=new Xt(g.gl.LEQUAL,Xt.ReadOnly,[0,1]),P=d.frameCounter/1e3%1;x==="atmosphere"?d.renderPass==="offscreen"?s.needsSkyboxCapture(d)&&(function(z,L,F,B){const j=z.context,X=j.gl;let q=L.skyboxFbo;if(!q){q=L.skyboxFbo=j.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Nf(j),L.skyboxTexture=j.gl.createTexture(),X.bindTexture(X.TEXTURE_CUBE_MAP,L.skyboxTexture),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR);for(let ue=0;ue<6;++ue)X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,X.RGBA,32,32,0,X.RGBA,X.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(q.framebuffer),j.viewport.set([0,0,32,32]);const J=L.getCenter(z,!0),Q=z.getOrCreateProgram("skyboxCapture"),oe=new Float64Array(16);i.ad.mat4.identity(oe),i.ad.mat4.rotateY(oe,oe,.5*-Math.PI),Ul(z,L,Q,oe,J,0),i.ad.mat4.identity(oe),i.ad.mat4.rotateY(oe,oe,.5*Math.PI),Ul(z,L,Q,oe,J,1),i.ad.mat4.identity(oe),i.ad.mat4.rotateX(oe,oe,.5*-Math.PI),Ul(z,L,Q,oe,J,2),i.ad.mat4.identity(oe),i.ad.mat4.rotateX(oe,oe,.5*Math.PI),Ul(z,L,Q,oe,J,3),i.ad.mat4.identity(oe),Ul(z,L,Q,oe,J,4),i.ad.mat4.identity(oe),i.ad.mat4.rotateY(oe,oe,Math.PI),Ul(z,L,Q,oe,J,5),j.viewport.set([0,0,z.width,z.height])}(d,s),s.markSkyboxValid(d)):d.renderPass==="sky"&&function(z,L,F,B,j){const X=z.context,q=X.gl,J=z.transform,Q=z.getOrCreateProgram("skybox");X.activeTexture.set(q.TEXTURE0),q.bindTexture(q.TEXTURE_CUBE_MAP,L.skyboxTexture);const oe=((ue,ce,ge,pe,_e)=>({u_matrix:ue,u_sun_direction:ce,u_cubemap:0,u_opacity:pe,u_temporal_offset:_e}))(J.skyboxMatrix,L.getCenter(z,!1),0,B,j);z.uploadCommonUniforms(X,Q),Q.draw(z,q.TRIANGLES,F,br.disabled,z.colorModeForRenderPass(),fr.backCW,oe,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,s,I,m,P):x==="gradient"&&d.renderPass==="sky"&&function(z,L,F,B,j){const X=z.context,q=X.gl,J=z.transform,Q=z.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Nf(X)),X.activeTexture.set(q.TEXTURE0);let oe=L.colorRampTexture;oe||(oe=L.colorRampTexture=new i.T(X,L.colorRamp,q.RGBA8)),oe.bind(q.LINEAR,q.CLAMP_TO_EDGE);const ue=((ce,ge,pe,_e,me)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:ge,u_radius:i.ak(pe),u_opacity:_e,u_temporal_offset:me}))(J.skyboxMatrix,L.getCenter(z,!1),L.paint.get("sky-gradient-radius"),B,j);z.uploadCommonUniforms(X,Q),Q.draw(z,q.TRIANGLES,F,br.disabled,z.colorModeForRenderPass(),fr.backCW,ue,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,s,I,m,P)},debug:function(d,t,s,h,m,g){for(let x=0;x<s.length;x++)if(m){const z=new i.al(h.r*.8,h.g*.8,h.b*.8,1);Zo(d,t,s[x],h,-1,-1,g),Zo(d,t,s[x],h,-1,1,g),Zo(d,t,s[x],h,1,1,g),Zo(d,t,s[x],h,1,-1,g),Zo(d,t,s[x],z,0,0,g)}else Zo(d,t,s[x],h,0,0,g)},custom:function(d,t,s,h){const m=d.context,g=s.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&s.isDraped(t)){if(d.renderPass==="offscreen"){const x=g.prerender;if(x){if(d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const I=d.transform.pointMerc;x.call(g,m.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.ag(d.transform.zoom),[I.x,I.y],d.transform.pixelsPerMeterRatio)}else x.call(g,m.gl,d.transform.customLayerMatrix());m.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const I=g.renderToTile;if(I){const P=h[0].canonical,z=new i.ac(P.x+h[0].wrap*(1<<P.z),P.y,P.z);m.setDepthMode(Xt.disabled),m.setStencilMode(br.disabled),m.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),I.call(g,m.gl,z),m.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),m.setStencilMode(br.disabled);const x=g.renderingMode==="3d"?new Xt(d.context.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Xt.ReadOnly);if(m.setDepthMode(x),d.transform.projection.name==="globe"){const I=d.transform.pointMerc;g.render(m.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.ag(d.transform.zoom),[I.x,I.y],d.transform.pixelsPerMeterRatio)}else g.render(m.gl,d.transform.customLayerMatrix());m.setDirty(),d.setBaseState(),m.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,t,s,h){if(d.renderPass==="opaque")return;const m=s.paint.get("model-opacity").constantOr(1);if(m===0)return;const g=s.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!g||d.terrain&&m<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const x=d.shadowRenderer,I=s.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,I||(x.enabled=!1));const P=()=>{x&&(x.useNormalOffset=!0,I||(x.enabled=!0))},z=t.getSource();if(d.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(Q,oe,ue,ce,ge){const pe=Q.transform;if(pe.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${pe.projection.name} projection is not yet implemented`);const _e=pe.getFreeCameraOptions().position;if(!Q.modelManager)return;const me=Q.modelManager;ue.modelManager=me;const we=Q.shadowRenderer;if(!ue._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ee=ue._unevaluatedLayout._values["model-id"],He=Object.assign({},ue.layout.get("model-id").parameters),Be=Q.style.order.indexOf(ue.fqid);for(const et of ce){const rt=oe.getTile(et).getBucket(ue);if(!rt||rt.projection.name!==pe.projection.name)continue;const _t=rt.getModelUris();_t&&!rt.modelsRequested&&(me.addModelsFromBucket(_t,ge),rt.modelsRequested=!0);const Oe=jf(et,pe);He.zoom=Oe;const Qe=Ee.possiblyEvaluate(He);if(Uf(Q,rt,et),$s.shadowUniformsInitialized=!1,$s.useSingleShadowCascade=!!we&&we.getMaxCascadeForTile(et.toUnwrapped())===0,Q.renderPass==="shadow"&&we){if(Q.currentShadowCascade===1&&rt.isInsideFirstShadowMapFrustum)continue;const Ze=pe.calculatePosMatrix(et.toUnwrapped(),pe.worldSize);if($s.tileMatrix.set(Ze),$s.shadowTileMatrix=Float32Array.from(we.calculateShadowPassMatrixFromMatrix(Ze)),$s.aabb.min.fill(0),$s.aabb.max[0]=$s.aabb.max[1]=i.ai,$s.aabb.max[2]=0,Sa(rt,$s,Q,ue.scope))continue}const De=1<<et.canonical.z,Je=[((_e.x-et.wrap)*De-et.canonical.x)*i.ai,(_e.y*De-et.canonical.y)*i.ai,_e.z*De*i.ai];Q.conflationActive&&Object.keys(rt.instancesPerModel).length>0&&Q.style.isLayerClipped(ue,oe.getSource())&&rt.updateReplacement(et,Q.replacementSource,Be,ge)&&(rt.uploaded=!1,rt.upload(Q.context));for(let Ze in rt.instancesPerModel){const ot=rt.instancesPerModel[Ze];ot.features.length>0&&(Ze=Qe.evaluate(ot.features[0].feature,{}));const $e=me.getModel(Ze,ge);if($e&&$e.uploaded)for(const ct of $e.nodes)zh(Q,ue,ct,ot,Je,et,$s)}}}(d,t,s,h,z.type==="vector"?s.scope:""),void P();if(!z.loaded())return;if(z.type==="batched-model")return function(Q,oe,ue,ce){ue.resetLayerRenderingStats(Q);const ge=Q.context,pe=Q.transform,_e=Q.style.fog,me=Q.shadowRenderer;if(pe.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${pe.projection.name} projection is not yet implemented`);const we=Q.transform.getFreeCameraOptions().position,Ee=i.ad.vec3.scale([],[we.x,we.y,we.z],Q.transform.worldSize),He=i.ad.vec3.negate([],Ee),Be=i.ad.mat4.identity([]),et=i.dm(pe.center.lat,pe.zoom),rt=i.ad.mat4.fromScaling([],[1,1,1/et]);i.ad.mat4.translate(Be,Be,He);const _t=ue.paint.get("model-opacity").constantOr(1),Oe=new Xt(ge.gl.LEQUAL,Xt.ReadWrite,Q.depthRangeFor3D),Qe=new Xt(ge.gl.LEQUAL,Xt.ReadOnly,Q.depthRangeFor3D),De=new i.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Je=Q.renderPass==="shadow",Ze=Je&&me?me.getCurrentCascadeFrustum():pe.getFrustum(pe.scaleZoom(pe.worldSize)),ot=ue.paint.get("model-front-cutoff"),$e=ot[2]<1,ct=ga(Q,ue.paint.get("model-cutoff-fade-range")),Tt=ue.getLayerRenderingStats();(function(Mt,Lt,Wt,pr){const nr=Mt.terrain?Mt.terrain.exaggeration():0,mr=Mt.transform.zoom;for(const hr of pr){const Br=Lt.getTile(hr).getBucket(Wt);Br&&(Br.setFilter(Wt.filter),Mt.conflationActive&&Br.updateReplacement(hr,Mt.replacementSource),Br.evaluateScale(Mt,Wt),Mt.terrain&&nr>0&&Br.elevationUpdate(Mt.terrain,nr,hr,Wt.source),Br.needsReEvaluation(Mt,mr,Wt)&&Br.evaluate(Wt))}})(Q,oe,ue,ce),function(){let Mt,Lt,Wt;$e?(Mt=ce.length-1,Lt=-1,Wt=-1):(Mt=0,Lt=ce.length,Wt=1);const pr=new Float64Array(16),nr=i.ad.vec3.create(),mr=new i.P(0,0);for(let hr=Mt;hr!==Lt;hr+=Wt){const Br=ce[hr],on=oe.getTile(Br).getBucket(ue);if(!on||!on.uploaded)continue;let pn=!1;me&&(pn=me.getMaxCascadeForTile(Br.toUnwrapped())===0);const Dr=pe.calculatePosMatrix(Br.toUnwrapped(),pe.worldSize),zn=on.modelTraits;!Je&&$e&&(i.ad.mat4.invert(pr,Dr),i.ad.vec3.transformMat4(nr,Ee,pr),mr.x=nr[0],mr.y=nr[1]);const wr=[];on.setFilter(ue.filter);for(const gr of on.getNodesInfo()){if(gr.hiddenByReplacement||!gr.node.meshes)continue;const or=gr.node;let en=0;Q.terrain&&or.elevation&&(en=or.elevation*Q.terrain.exaggeration());const tn=(()=>{const mn=gr.aabb;return De.min=[...mn.min],De.max=[...mn.max],De.min[2]+=en,De.max[2]+=en,i.ad.vec3.transformMat4(De.min,De.min,Dr),i.ad.vec3.transformMat4(De.max,De.max,Dr),De})(),qn=gr.evaluatedScale;if(qn[0]<=1&&qn[1]<=1&&qn[2]<=1&&tn.intersects(Ze)===0)continue;if(!Je&&$e){const mn=.16666666666666666;gr.cameraCollisionOpacity=Ee[0]>tn.min[0]&&Ee[0]<tn.max[0]&&Ee[1]>tn.min[1]&&Ee[1]<tn.max[1]&&Ee[2]*et<tn.max[2]&&or.footprint&&i.bA(mr,or.footprint)?Math.max(gr.cameraCollisionOpacity-mn,0):Math.min(1,gr.cameraCollisionOpacity+mn)}const di=[...Dr],Qi=or.anchor?or.anchor[0]:0,fi=or.anchor?or.anchor[1]:0;i.ad.mat4.translate(di,di,[Qi*(qn[0]-1),fi*(qn[1]-1),en]),i.ad.vec3.exactEquals(qn,i.dq)||i.ad.mat4.scale(di,di,qn);const Ti=i.ad.mat4.multiply([],di,or.matrix),Ui=i.ad.mat4.multiply([],pe.expandedFarZProjMatrix,Ti),rn=i.ad.mat4.multiply([],pe.expandedFarZProjMatrix,di),In=i.ad.vec4.transformMat4([],[Qi,fi,en,1],Ui)[2];or.hidden=!1;let an=_t;Je||($e&&(an*=gr.cameraCollisionOpacity,an*=Oh(di,pe,gr.aabb,ot)),an*=Lh(ct,In)),an!==0?wr.push({nodeInfo:gr,depth:In,opacity:an,wvpForNode:Ui,wvpForTile:rn,nodeModelMatrix:Ti,tileModelMatrix:di}):or.hidden=!0}Je||wr.sort((gr,or)=>!$e||gr.opacity===1&&or.opacity===1?gr.depth<or.depth?-1:1:gr.opacity===1?-1:or.opacity===1?1:gr.depth>or.depth?-1:1);for(const gr of wr){const or=gr.nodeInfo,en=or.node;let tn=i.ad.mat4.multiply([],rt,gr.tileModelMatrix);i.ad.mat4.multiply(tn,Be,tn);const qn=i.ad.mat4.invert([],tn);i.ad.mat4.transpose(qn,qn),i.ad.mat4.scale(qn,qn,Co),tn=i.ad.mat4.multiply(tn,tn,en.matrix);const di=Q.renderPass==="light-beam",Qi=ue.paint.get("model-color-use-theme").constantOr("default")==="none",fi=zn&i.ds.HasMapboxMeshFeatures,Ti=fi?0:or.evaluatedRMEA[0][2];for(let Ui=0;Ui<en.meshes.length;++Ui){const rn=en.meshes[Ui],In=Ui===en.lightMeshIndex;let an=gr.wvpForNode;if(In){if(!di&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}an=gr.wvpForTile}else if(di)continue;const mn={defines:[]},mi=[];if(!Je&&me&&(me.useNormalOffset=!!rn.normalBuffer),Io(mn.defines,mi,rn,Q,Qi?null:ue.lut),fi||mn.defines.push("DIFFUSE_SHADED"),pn&&mn.defines.push("SHADOWS_SINGLE_CASCADE"),Tt&&(Je?Tt.numRenderedVerticesInShadowPass+=rn.vertexArray.length:Tt.numRenderedVerticesInTransparentPass+=rn.vertexArray.length),Je){Ta(rn,gr.nodeModelMatrix,Q,ue);continue}let Fn=null;if(_e){const zi=Vf(gr.nodeModelMatrix,Q.transform);if(Fn=new Float32Array(zi),pe.projection.name!=="globe"){const Cs=rn.aabb.min,zo=rn.aabb.max,[oo,Yo]=_e.getOpacityForBounds(zi,Cs[0],Cs[1],zo[0],zo[1]);mn.overrideFog=oo>=mt||Yo>=mt}}const li=rn.material;let Do;li.occlusionTexture&&li.occlusionTexture.offsetScale&&(Do=li.occlusionTexture.offsetScale,mn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const es=Q.getOrCreateProgram("model",mn);!Je&&me&&me.setupShadowsFromMatrix(gr.tileModelMatrix,es,me.useNormalOffset),Q.uploadCommonUniforms(ge,es,null,Fn);const Hs=li.pbrMetallicRoughness;Hs.metallicFactor=.9,Hs.roughnessFactor=.5;const Ko=Th(new Float32Array(an),new Float32Array(tn),new Float32Array(qn),new Float32Array(en.matrix),Q,gr.opacity,Hs.baseColorFactor.toRenderColor(null),li.emissiveFactor,Hs.metallicFactor,Hs.roughnessFactor,li,Ti,ue,[0,0,0],Do);!In&&(or.hasTranslucentParts||gr.opacity<1)&&es.draw(Q,ge.gl.TRIANGLES,Oe,br.disabled,Rr.disabled,fr.backCCW,Ko,ue.id,rn.vertexBuffer,rn.indexBuffer,rn.segments,ue.paint,Q.transform.zoom,void 0,mi),es.draw(Q,ge.gl.TRIANGLES,In?Qe:Oe,br.disabled,In||gr.opacity<1||or.hasTranslucentParts?Rr.alphaBlended:Rr.unblended,fr.backCCW,Ko,ue.id,rn.vertexBuffer,rn.indexBuffer,rn.segments,ue.paint,Q.transform.zoom,void 0,mi)}}}}()}(d,t,s,h),void P();if(z.type!=="model")return;const L=z.getModels(),F=[],B=d.transform.getFreeCameraOptions().position,j=i.ad.vec3.scale([],[B.x,B.y,B.z],d.transform.worldSize);i.ad.vec3.negate(j,j);const X=[],q=[];let J=0;for(const Q of L){const oe=s.paint.get("model-rotation").constantOr(null),ue=s.paint.get("model-scale").constantOr(null),ce=s.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(d,oe,ue,ce,!0,!0,!1);const ge=i.ad.mat4.identity([]),pe=i.dm(Q.position.lat,d.transform.zoom),_e=i.ad.mat4.fromScaling([],[1,1,1/pe]);i.ad.mat4.translate(ge,ge,j),F.push({zScaleMatrix:_e,negCameraPosMatrix:ge});for(const me of Q.nodes)nl(d.transform,me,Q.matrix,d.transform.expandedFarZProjMatrix,J,X,q);J++}if(X.sort((Q,oe)=>oe.depth-Q.depth),d.renderPass!=="shadow"){if(m===1)for(const Q of q)rl(Q,d,s,F[Q.modelIndex],br.disabled,d.colorModeForRenderPass());else{for(const Q of q)rl(Q,d,s,F[Q.modelIndex],br.disabled,Rr.disabled);for(const Q of q)rl(Q,d,s,F[Q.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const Q of X)rl(Q,d,s,F[Q.modelIndex],br.disabled,d.colorModeForRenderPass());P()}else{for(const Q of q)Ta(Q.mesh,Q.nodeModelMatrix,d,s);for(const Q of X)Ta(Q.mesh,Q.nodeModelMatrix,d,s);P()}}},Nh={line:function(d,t,s){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const h=t.getVisibleCoordinates();for(const m of h){const g=t.getTile(m).getBucket(d);if(g&&(g.hasZOffset?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,t,s){const h=t.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,h.type==="vector"?d.scope:""));if(h.type==="batched-model"||h.type!=="model")return;const m=h.getModels();for(const g of m)g.upload(s.context)},raster:function(d,t,s){const h=t.getSource();if(!(h instanceof xs&&h.loaded()))return;const m=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!m)return;const g=d.paint.get("raster-array-band")||h.getInitialBand(m);if(g==null)return;const x=t.getIds().map(I=>t.getTileByID(I));for(const I of x)I.updateNeeded(m,g)&&h.prepareTile(I,m,g)},"raster-particle":function(d,t,s){const h=t.getSource();if(!(h instanceof xs&&h.loaded()))return;const m=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!m)return;const g=d.paint.get("raster-particle-array-band")||h.getInitialBand(m);if(g==null)return;const x=t.getIds().map(I=>t.getTileByID(I));for(const I of x)I.updateNeeded(m,g)&&h.prepareTile(I,m,g)}},Vh={fill:Mh};class Yf{constructor(t,s,h,m,g){this.context=new as(t,s),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const P of x)this._debugParams.enabledLayers[P]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const P of x)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],P);this.occlusionParams=new il(g),this.setup(),this.numSublayers=ws.maxUnderzooming+ws.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new nh(this),this._wireframeDebugCache=new Gf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,I,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m}updateTerrain(t,s){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new yh(this,t));const m=this._terrain;this.transform.elevation=h?m:null,m.update(t,this.transform,s),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=s.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const g=h+.78*(m-h);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new yh(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*i.q.devicePixelRatio,this.height=s*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const t=this.context,s=new i.b5;s.emplaceBack(0,0),s.emplaceBack(i.ai,0),s.emplaceBack(0,i.ai),s.emplaceBack(i.ai,i.ai),this.tileExtentBuffer=t.createVertexBuffer(s,i.b7.members),this.tileExtentSegments=i.b8.simpleSegment(0,0,4,2);const h=new i.b5;h.emplaceBack(0,0),h.emplaceBack(i.ai,0),h.emplaceBack(0,i.ai),h.emplaceBack(i.ai,i.ai),this.debugBuffer=t.createVertexBuffer(h,i.b7.members),this.debugSegments=i.b8.simpleSegment(0,0,4,5);const m=new i.b5;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,i.b7.members),this.viewportSegments=i.b8.simpleSegment(0,0,4,2);const g=new i.aU;g.emplaceBack(0,0,0,0),g.emplaceBack(i.ai,0,i.ai,0),g.emplaceBack(0,i.ai,0,i.ai),g.emplaceBack(i.ai,i.ai,i.ai,i.ai),this.mercatorBoundsBuffer=t.createVertexBuffer(g,i.ba.members),this.mercatorBoundsSegments=i.b8.simpleSegment(0,0,4,2);const x=new i.aV;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const I=new i.b6;for(const z of[0,1,3,2,0])I.emplaceBack(z);this.debugIndexBuffer=t.createIndexBuffer(I),this.emptyTexture=new i.T(t,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=i.ad.mat4.create();const P=this.context.gl;this.stencilClearMode=new br({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Xt.disabled,this.stencilClearMode,Rr.disabled,fr.disabled,qc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,h){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const P of h)if(this._tileClippingMaskIDs[P.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=s.id;const m=this.context,g=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(Rr.disabled),m.setDepthMode(Xt.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of h){const P=s.getTile(I),z=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:F,tileBoundsSegments:B}=this.getTileBoundsBuffers(P);x.draw(this,g.TRIANGLES,Xt.disabled,new br({func:g.ALWAYS,mask:0},z,255,g.KEEP,g.KEEP,g.REPLACE),Rr.disabled,fr.disabled,qc(I.projMatrix),"$clipping",L,F,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new br({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new br({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,h=t.sort((x,I)=>I.overscaledZ-x.overscaledZ),m=h[h.length-1].overscaledZ,g=h[0].overscaledZ-m+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let I=0;I<g;I++)x[I+m]=new br({func:s.GEQUAL,mask:255},I+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[x,h]}return[{[m]:br.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Rr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new i.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Rr.unblended:Rr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Rr([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new i.al(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,s,h,m=!1){if(this.depthOcclusion)return new Xt(this.context.gl.GREATER,Xt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return Xt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Xt(h||this.context.gl.LEQUAL,s,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),h=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),g=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&h!==0&&(this.depthFBO=new Sh(this.context,s,h,!1,"texture"),this.depthTexture=new i.T(this.context,{width:s,height:h,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,g),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,h,0,0,s,h,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,s)=>t+s/this._fpsHistory.length,0))}render(t,s){const h=i.q.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const m=this.style._mergedLayers,g=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(g).filter(Oe=>{const Qe=m[Oe];return!(Qe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Qe.type]});let I=x(),P=!1,z=!1;for(const Oe of I){const Qe=m[Oe];Qe.type==="circle"&&(P=!0),Qe.type==="symbol"&&(Qe.hasInitialOcclusionOpacityProperties?z=!0:P=!0)}let L=I.map(Oe=>m[Oe]);const F=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let B=0,j=!1;for(const Oe in F){const Qe=F[Oe];Qe.used&&(Qe.prepare(this.context),Qe.getSource().usedInConflation&&++B)}let X=!1;for(const Oe of L)Oe.isHidden(this.transform.zoom)||(Oe.type==="clip"&&(X=!0),this.prepareLayer(Oe));const q={},J={},Q={},oe={},ue={};for(const Oe in F){const Qe=F[Oe];q[Oe]=Qe.getVisibleCoordinates(),J[Oe]=q[Oe].slice().reverse(),Q[Oe]=Qe.getVisibleCoordinates(!0).reverse(),oe[Oe]=Qe.getShadowCasterCoordinates(),ue[Oe]=Qe.sortCoordinatesByDistance(q[Oe])}const ce=Oe=>{const Qe=this.style.getLayerSourceCache(Oe);return Qe&&Qe.used?Qe.getSource():null};if(B||X||this._clippingActiveLastFrame){const Oe=[],Qe=[];let De=0;for(const Je of L)this.isSourceForClippingOrConflation(Je,ce(Je))&&(Oe.push(Je),Qe.push(De)),De++;if(Oe&&(X||Oe.length>1)||this._clippingActiveLastFrame){X=!1;const Je=[];for(let Ze=0;Ze<Oe.length;Ze++){const ot=Oe[Ze],$e=Qe[Ze],ct=this.style.getLayerSourceCache(ot);if(!ct||!ct.used||!ct.getSource().usedInConflation&&ot.type!=="clip")continue;let Tt=i.dA,Mt=i.by.None;const Lt=[];let Wt=!0;if(ot.type==="clip"){Tt=$e;for(const pr of ot.layout.get("clip-layer-types"))Mt|=pr==="model"?i.by.Model:pr==="symbol"?i.by.Symbol:i.by.FillExtrusion;for(const pr of ot.layout.get("clip-layer-scope"))Lt.push(pr);ot.isHidden(this.transform.zoom)?Wt=!1:X=!0}Wt&&Je.push({layer:ot.fqid,cache:ct,order:Tt,clipMask:Mt,clipScope:Lt})}this.replacementSource.setSources(Je),j=!0}}this._clippingActiveLastFrame=X,j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Oe=0;Oe<L.length;Oe++){const Qe=L[Oe],De=Qe.cutoffRange();if(this.longestCutoffRange=Math.max(De,this.longestCutoffRange),De>0){const Je=ce(Qe);Je&&(this.minCutoffZoom=Math.max(Je.minzoom,this.minCutoffZoom)),Qe.minzoom&&(this.minCutoffZoom=Math.max(Qe.minzoom,this.minCutoffZoom))}Qe.is3D(g)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Oe),this._lastOcclusionLayer=Oe)}const ge=this.style&&this.style.fog;ge?(this._fogVisible=ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Q),this.opaquePassCutoff=0,I=x(),L=I.map(Oe=>m[Oe]));const pe=this._shadowRenderer;if(pe){pe.updateShadowParameters(this.transform,this.style.directionalLight);for(const Oe in F)for(const Qe of q[Oe]){let De={min:0,max:0};this.terrain&&(De=this.terrain.getMinMaxForTile(Qe)||De),pe.addShadowReceiver(Qe.toUnwrapped(),De.min,De.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Jr(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const _e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),me=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(_e&&!this._snow&&(this._snow=new Kf(this)),!_e&&this._snow&&(this._snow.destroy(),delete this._snow),me&&!this._rain&&(this._rain=new Zf(this)),!me&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!vn.has(this.context.gl))return;this.renderPass="offscreen";for(const Oe of L){const Qe=t.getLayerSourceCache(Oe);if(!Oe.hasOffscreenPass()||Oe.isHidden(this.transform.zoom))continue;const De=Qe?J[Qe.id]:void 0;(Oe.type==="custom"||Oe.type==="raster"||Oe.type==="raster-particle"||Oe.isSky()||De&&De.length)&&this.renderLayer(this,Qe,Oe,De)}this.depthRangeFor3D=[0,1-(L.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,oe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const we=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ee=(()=>{if(s.showOverdrawInspector)return i.al.black;const Oe=this.style.fog;if(Oe&&this.transform.projection.supportsFog){const Qe=this.style.getLut(Oe.scope);if(!we){const De=Oe.properties.get("color-use-theme")==="none",Je=Oe.properties.get("color").toRenderColor(De?null:Qe).toArray01();return new i.al(...Je)}if(we){const De=Oe.properties.get("space-color-use-theme")==="none",Je=Oe.properties.get("space-color").toRenderColor(De?null:Qe).toArray01();return new i.al(...Je)}}return i.al.transparent})();if(this.context.clear({color:Ee,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const Oe=L[this.currentLayer],Qe=t.getLayerSourceCache(Oe);if(Oe.isSky())continue;const De=Qe?(Oe.is3D(g)?ue:J)[Qe.id]:void 0;this._renderTileClippingMasks(Oe,Qe,De),this.renderLayer(this,Qe,Oe,De)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const Oe=L[this.currentLayer],Qe=t.getLayerSourceCache(Oe);Oe.isSky()&&this.renderLayer(this,Qe,Oe,Qe?J[Qe.id]:void 0)}function He(Oe,Qe){let De;return Qe&&(De=(Oe.type==="symbol"?Q:Oe.is3D(g)?ue:J)[Qe.id]),De}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const Oe=L[this.currentLayer];if(Oe.type==="raster"||Oe.type==="raster-particle"){const Qe=t.getLayerSourceCache(Oe);this.renderLayer(this,Qe,Oe,He(Oe,Qe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Be=0;pe&&(Be=pe.getShadowCastingLayerCount());let et=!1,rt=-1;for(let Oe=0;Oe<I.length;++Oe){const Qe=L[Oe];Qe.isHidden(this.transform.zoom)||Qe.is3D(g)&&(rt=Oe)}z&&rt===-1&&(P=!0);let _t=!1;for(;this.currentLayer<I.length;){const Oe=L[this.currentLayer],Qe=t.getLayerSourceCache(Oe);if(Oe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Oe)){if(Oe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!_t&&Oe.is3D(g)&&!g){const De=this.currentLayer,Je=Ze=>{for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const ot=L[this.currentLayer];if(Vh[ot.type]){const $e=this.style.getLayerSourceCache(ot);Vh[ot.type](this,$e,ot,He(ot,$e),Ze)}}};Je("initialize"),Je("reset"),this.currentLayer=De,_t=!0}if(P&&!et&&this.terrain&&!this.transform.isOrthographic&&(et=!0,this.blitDepth()),z&&rt!==-1&&this.currentLayer===rt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Oe,Qe,Qe?q[Qe.id]:void 0),this.renderLayer(this,Qe,Oe,He(Oe,Qe)),!this.terrain&&pe&&Be>0&&Oe.hasShadowPass()&&--Be==0&&(pe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const De=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=De;this.currentLayer++){const Je=L[this.currentLayer];if(!Je.hasLightBeamPass())continue;const Ze=t.getLayerSourceCache(Je);this.renderLayer(this,Ze,Je,Ze?J[Ze.id]:void 0)}this.currentLayer=De,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const De=this.currentLayer;this.depthOcclusion=!0;for(const Je of this.layersWithOcclusionOpacity){this.currentLayer=Je;const Ze=L[this.currentLayer],ot=t.getLayerSourceCache(Ze),$e=ot?J[ot.id]:void 0;this.terrain||this._renderTileClippingMasks(Ze,ot,ot?q[ot.id]:void 0),this.renderLayer(this,ot,Ze,$e)}this.depthOcclusion=!1,this.currentLayer=De,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Oe=null;L.forEach(Qe=>{const De=t.getLayerSourceCache(Qe);De&&!Qe.isHidden(this.transform.zoom)&&De.getVisibleCoordinates().length&&(!Oe||Oe.getSource().maxzoom<De.getSource().maxzoom)&&(Oe=De)}),Oe&&this.options.showTileBoundaries&&Ma.debug(this,Oe,Oe.getVisibleCoordinates(),i.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ma.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Oe){const Qe=Oe.transform.padding;Ph(Oe,Oe.transform.height-(Qe.top||0),3,w_),Ph(Oe,Qe.bottom||0,3,Vl),Bf(Oe,Qe.left||0,3,S0),Bf(Oe,Oe.transform.width-(Qe.right||0),3,E0);const De=Oe.transform.centerPoint;(function(Je,Ze,ot,$e){Yc(Je,Ze-1,ot-10,2,20,$e),Yc(Je,Ze-10,ot-1,20,2,$e)})(Oe,De.x,Oe.transform.height-De.y,T_)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,h=!s||!s.includes(t.type);if(Nh[t.type]&&(h||this.terrain&&t.type==="custom")){const m=this.style.getLayerSourceCache(t);Nh[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,s,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)&&(!t.terrain||h.type!=="custom")||h.type==="clip"||Ma[h.type](t,s,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,h=this.context.gl;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:h.createQuery()}),m.calls++,h.beginQuery(s.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,h=s.createQuery();this.deferredRenderGpuTimeQueries.push(h),s.beginQuery(t.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const h in t){const m=t[h],g=this.context.extTimerQuery,x=g.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(m.query),s[h]=x}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let h=0;for(const m of t)h+=s.getQueryParameter(m,s.QUERY_RESULT)/1e6,s.deleteQuery(m);return h}translatePosMatrix(t,s,h,m,g){if(!h[0]&&!h[1])return t;const x=g?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(x){const z=Math.sin(x),L=Math.cos(x);h=[h[0]*L-h[1]*z,h[0]*z+h[1]*L]}const I=[g?h[0]:i.at(s,h[0],this.transform.zoom),g?h[1]:i.at(s,h[1],this.transform.zoom),0],P=new Float32Array(16);return i.ad.mat4.translate(P,t,I),P}saveTileTexture(t){const s=t.size[0],h=this._tileTextures[s];h?h.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,h){const m=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,g=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(g.push("LIGHTING_3D_MODE"),g.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||g.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||g.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(g.push("TERRAIN"),this.linearFloatFilteringSupported()&&g.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&g.push("GLOBE"),!this._fogVisible||m||s!==void 0&&!s||g.push("FOG","FOG_DITHERING"),m&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}getOrCreateProgram(t,s){this.cache=this.cache||{};const h=s&&s.defines||[],m=s&&s.config,g=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(h),x=d_.cacheKey(hh[t],t,g,m);return this.cache[x]||(this.cache[x]=new d_(this.context,t,hh[t],m,w0[t],g)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const h=this.style.directionalLight,m=this.style.ambientLight;if(h&&m){const g=((x,I,P)=>{const z=x.properties.get("direction"),L=x.properties.get("color-use-theme")==="none",F=x.properties.get("color").toRenderColor(L?null:P.getLut(x.scope)).toArray01(),B=x.properties.get("intensity"),j=I.properties.get("color-use-theme")==="none",X=I.properties.get("color").toRenderColor(j?null:P.getLut(I.scope)).toArray01(),q=I.properties.get("intensity"),J=[z.x,z.y,z.z],Q=i.cN(X,q),oe=i.cN(F,B);return{u_lighting_ambient_color:Q,u_lighting_directional_dir:J,u_lighting_directional_color:oe,u_ground_radiance:v0(J,oe,Q)}})(h,m,this.style);s.setLightsUniformValues(t,g)}}}uploadCommonUniforms(t,s,h,m,g){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const I=x.getOpacity(this.transform.pitch),P=((z,L,F,B,j,X,q,J,Q,oe,ue,ce)=>{const ge=z.transform,pe=L.properties.get("color-use-theme")==="none",_e=L.properties.get("color").toRenderColor(pe?null:z.style.getLut(L.scope)).toArray01();_e[3]=B;const me=z.frameCounter/1e3%1,[we,Ee]=L.properties.get("vertical-range");return{u_fog_matrix:F?ge.calculateFogTileMatrix(F):ce||z.identityMat,u_fog_range:L.getFovAdjustedRange(ge._fov),u_fog_color:_e,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(we,Ee),Ee],u_fog_temporal_offset:me,u_frustum_tl:j,u_frustum_tr:X,u_frustum_br:q,u_frustum_bl:J,u_globe_pos:Q,u_globe_radius:oe,u_viewport:ue,u_globe_transition:i.ag(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,x,h,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],m);s.setFogUniformValues(t,P)}g&&s.setCutoffUniformValues(t,g.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const m of h)s[m.key]=t[m.key]||new ma(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=mt||s[1]>=mt}setupDepthForOcclusion(t,s,h){const m=this.context,g=m.gl,x=!!h;var I;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(g.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE0),x||s.setTerrainUniformValues(m,h)}}function Qc(d,t){let s=!1,h=null;const m=()=>{h=null,s&&(d(),h=setTimeout(m,t),s=!1)};return()=>(s=!0,h||m(),h)}class Jf{constructor(t){this._hashName=t&&encodeURIComponent(t),i.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Qc(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=Uh(t);if(this._hashName){const h=this._hashName;let m=!1;const g=location.hash.slice(1).split("&").map(x=>{const I=x.split("=")[0];return I===h?(m=!0,`${I}=${s}`):x}).filter(x=>x);return m||g.push(`${h}=${s}`),`#${g.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Uh(d,t){const s=d.getCenter(),h=Math.round(100*d.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,m),x=Math.round(s.lng*g)/g,I=Math.round(s.lat*g)/g,P=d.getBearing(),z=d.getPitch();let L=t?`/${x}/${I}/${h}`:`${h}/${I}/${x}`;return(P||z)&&(L+="/"+Math.round(10*P)/10),z&&(L+=`/${Math.round(z)}`),L}const eu={linearity:.3,easing:i.dB(0,0,.3,1)},S_=i.l({deceleration:2500,maxSpeed:1400},eu),E_=i.l({deceleration:20,maxSpeed:1400},eu),A_=i.l({deceleration:1e3,maxSpeed:360},eu),M_=i.l({deceleration:1e3,maxSpeed:90},eu);class I_{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=i.q.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const g=ru(s.pan.mag(),h,i.l({},S_,t||{}));m.offset=s.pan.mult(g.amount/s.pan.mag()),m.center=this._map.transform.center,tu(m,g)}if(s.zoom){const g=ru(s.zoom,h,E_);m.zoom=this._map.transform.zoom+g.amount,tu(m,g)}if(s.bearing){const g=ru(s.bearing,h,A_);m.bearing=this._map.transform.bearing+i.ay(g.amount,-179,179),tu(m,g)}if(s.pitch){const g=ru(s.pitch,h,M_);m.pitch=this._map.transform.pitch+g.amount,tu(m,g)}if(m.zoom||m.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;m.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function tu(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function ru(d,t,s){const{maxSpeed:h,linearity:m,deceleration:g}=s,x=i.ay(d*m/(t/1e3),-h,h),I=Math.abs(x)/(g*m);return{easing:s.easing,duration:1e3*I,amount:x*(I/2)}}class cs extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h,m={}){const g=At(s.getCanvasContainer(),h),x=s.unproject(g);super(t,i.l({point:g,lngLat:x,originalEvent:h},m)),this._defaultPrevented=!1,this.target=s}}class nu extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){const m=t==="touchend"?h.changedTouches:h.touches,g=pt(s.getCanvasContainer(),m),x=g.map(P=>s.unproject(P)),I=g.reduce((P,z,L,F)=>P.add(z.div(F.length)),new i.P(0,0));super(t,{points:g,point:I,lngLats:x,lngLat:s.unproject(I),originalEvent:h}),this._defaultPrevented=!1}}class C_ extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class P_{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new C_(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new cs(t.type,this._map,t))}mouseup(t){this._map.fire(new cs(t.type,this._map,t))}preclick(t){const s=i.l({},t);s.type="preclick",this._map.fire(new cs(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new cs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new cs(t.type,this._map,t))}mouseover(t){this._map.fire(new cs(t.type,this._map,t))}mouseout(t){this._map.fire(new cs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new nu(t.type,this._map,t))}touchmove(t){this._map.fire(new nu(t.type,this._map,t))}touchend(t){this._map.fire(new nu(t.type,this._map,t))}touchcancel(t){this._map.fire(new nu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class R_{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new cs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new cs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new cs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class M0{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(ut(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const h=s,m=this._startPos,g=this._lastPos;if(!m||!g||g.equals(h)||!this._box&&h.dist(m)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const x=Math.min(m.x,h.x),I=Math.max(m.x,h.x),P=Math.min(m.y,h.y),z=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${P}px)`,this._box.style.width=I-x+"px",this._box.style.height=z-P+"px")})}mouseupWindow(t,s){if(!this._active)return;const h=this._startPos,m=s;if(h&&t.button===0){if(this.reset(),tt(),h.x!==m.x||h.y!==m.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ht(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new i.A(t,{originalEvent:s}))}}function Qf(d,t){const s={};for(let h=0;h<d.length;h++)s[d[h].identifier]=t[h];return s}class $n{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const g=new i.P(0,0);for(const x of m)g._add(x);return g.div(m.length)}(s),this.touches=Qf(h,s)))}touchmove(t,s,h){if(this.aborted||!this.centroid)return;const m=Qf(h,s);for(const g in this.touches){const x=m[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,s,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class jh{constructor(t){this.singleTap=new $n(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,h){this.singleTap.touchstart(t,s,h)}touchmove(t,s,h){this.singleTap.touchmove(t,s,h)}touchend(t,s,h){const m=this.singleTap.touchend(t,s,h);if(m){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(m)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class I0{constructor(){this._zoomIn=new jh({numTouches:1,numTaps:2}),this._zoomOut=new jh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,h){this._zoomIn.touchstart(t,s,h),this._zoomOut.touchstart(t,s,h)}touchmove(t,s,h){this._zoomIn.touchmove(t,s,h),this._zoomOut.touchmove(t,s,h)}touchend(t,s,h){const m=this._zoomIn.touchend(t,s,h),g=this._zoomOut.touchend(t,s,h);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(m)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const C0={0:1,2:2},jl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class $h{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const h=at(t);this._correctButton(t,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(t,s){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(m,g){const x=C0[g];return m.buttons===void 0||(m.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(t){this._lastPoint&&at(t)===this._eventButton&&(this._moved&&tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ep extends $h{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class iu extends $h{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?jl[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=.8*(s.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Ro extends $h{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?jl[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=-.5*(s.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Gh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),i.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(t,s,h){return this._calculateTransform(t,s,h)}touchmove(t,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!i.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,h)}}touchend(t,s,h){this._calculateTransform(t,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,h){h.length>0&&(this._active=!0);const m=Qf(h,s),g=new i.P(0,0),x=new i.P(0,0);let I=0;for(const z in m){const L=m[z],F=this._touches[z];F&&(g._add(L),x._add(L.sub(F)),I++,m[z]=L)}if(this._touches=m,I<this._minTouches||!x.mag())return;const P=x.div(I);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(I),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class ei{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,h){return{}}touchstart(t,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,h){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[g,x]=m,I=As(h,s,g),P=As(h,s,x);if(!I||!P)return;const z=this._aroundCenter?null:I.add(P).div(2);return this._move([I,P],z,t)}touchend(t,s,h){if(!this._firstTwoTouches)return;const[m,g]=this._firstTwoTouches,x=As(h,s,m),I=As(h,s,g);x&&I||(this._active&&tt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function As(d,t,s){for(let h=0;h<d.length;h++)if(d[h].identifier===s)return t[h]}function Hh(d,t){return Math.log(d/t)/Math.LN2}class qh extends ei{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Hh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hh(this._distance,h),pinchAround:s}}}function tp(d,t){return 180*d.angleWith(t)/Math.PI}class P0 extends ei{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const h=this._vector;if(this._vector=t[0].sub(t[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:tp(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const m=tp(t,h);return Math.abs(m)<s}}function sl(d){return Math.abs(d.y)>Math.abs(d.x)}class R0 extends ei{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,sl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,h){const m=this._lastPoints;if(!m)return;const g=t[0].sub(m[0]),x=t[1].sub(m[1]);return this._map._cooperativeGestures&&!i.dC()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(g,x,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5})}gestureBeginsVertically(t,s,h){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,g=s.mag()>=2;if(!m&&!g)return;if(!m||!g)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return sl(t)&&sl(s)&&x}}const D0={panStep:100,bearingStep:15,pitchStep:10};class rp{constructor(){const t=D0;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,h=0,m=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:I=>{const P=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:np,zoom:s?Math.round(P)+s*(t.shiftKey?2:1):P,bearing:I.getBearing()+h*this._bearingStep,pitch:I.getPitch()+m*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:I.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function np(d){return d*(2-d)}const $l=4.000244140625,Gl=1/450;class Xo{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Gl,i.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||i.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=i.q.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%$l==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=At(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>$l?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&L!==0&&(L=1/L);const F=s(),B=Math.pow(2,F),j=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(j*L))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,g=this._easing;let x,I=!1;if(this._type==="wheel"&&m&&g){const z=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),L=g(z);x=i.ah(m,h,L),z<1?this._frameId||(this._frameId=!0):I=!0}else x=h,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let P=x-s();return P*this._lastDelta<0&&(P=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:P,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=i.dD;if(this._prevEase){const h=this._prevEase,m=(i.q.now()-h.start)/h.duration,g=h.easing(m+.01)-h.easing(m),x=.27/Math.sqrt(g*g+1e-4)*.01,I=Math.sqrt(.0729-x*x);s=i.dB(x,I,.25,1)}return this._prevEase={start:i.q.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class io{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ia{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ol{constructor(){this._tap=new jh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,s,h))}touchmove(t,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=s[0],g=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,h)}touchend(t,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,s,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ca{constructor(t,s,h){this._el=t,this._mousePan=s,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class z0{constructor(t,s,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class L0{constructor(t,s,h,m){this._el=t,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Wh=d=>d.zoom||d.drag||d.pitch||d.rotate;class O0 extends i.A{}class D_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const h=i.ad.vec3.sub([],s,t);this.radius=i.ad.vec3.length(h[2]<0?i.ad.vec3.div([],h,this.constants):[h[0],h[1],0])}projectRay(t){i.ad.vec3.div(t,t,this.constants),i.ad.vec3.normalize(t,t),i.ad.vec3.mul(t,t,this.constants);const s=i.ad.vec3.scale([],t,this.radius);if(s[2]>0){const h=i.ad.vec3.scale([],[0,0,1],i.ad.vec3.dot(s,[0,0,1])),m=i.ad.vec3.scale([],i.ad.vec3.normalize([],[s[0],s[1],0]),this.radius),g=i.ad.vec3.add([],s,i.ad.vec3.scale([],i.ad.vec3.sub([],i.ad.vec3.add([],m,h),s),2));s[0]=g[0],s[1]=g[1]}return s}}function Ai(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class ip{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new I_(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new D_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),i.aQ(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,g,x]of this._listeners){const I=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(g,I,x)}}destroy(){for(const[t,s,h]of this._listeners){const m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,m,h)}}_addDefaultHandlers(t){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new P_(s,t));const m=s.boxZoom=new M0(s,t);this._add("boxZoom",m);const g=new I0,x=new Ia;s.doubleClickZoom=new io(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const I=new ol;this._add("tapDragZoom",I);const P=s.touchPitch=new R0(s);this._add("touchPitch",P);const z=new iu(t),L=new Ro(t);s.dragRotate=new z0(t,z,L),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const F=new ep(t),B=new Gh(s,t);s.dragPan=new Ca(h,F,B),this._add("mousePan",F),this._add("touchPan",B,["touchZoom","touchRotate"]);const j=new P0,X=new qh;s.touchZoomRotate=new L0(h,X,j,I),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",X,["touchPan","touchRotate"]),this._add("blockableMapEvent",new R_(s));const q=s.scrollZoom=new Xo(s,this);this._add("scrollZoom",q,["mousePan"]);const J=s.keyboard=new rp;this._add("keyboard",J);for(const Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Q]&&s[Q].enable(t[Q])}_add(t,s,h){this._handlers.push({handlerName:t,handler:s,allowed:h}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,h){for(const m in t)if(m!==h&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const h of t)this._el.contains(h.target)&&s.push(h);return s}handleEvent(t,s){this._updatingCamera=!0;const h=t.type==="renderFrame",m=h?void 0:t,g={needsRenderFrame:!1},x={},I={},P=t.touches?this._getMapTouches(t.touches):void 0,z=P?pt(this._el,P):h?void 0:At(this._el,t);for(const{handlerName:B,handler:j,allowed:X}of this._handlers){if(!j.isEnabled())continue;let q;this._blockedByActive(I,X,B)?j.reset():j[s||t.type]&&(q=j[s||t.type](t,z,P),this.mergeHandlerResult(g,x,q,B,m),q&&q.needsRenderFrame&&this._triggerRenderFrame()),(q||j.isActive())&&(I[B]=j)}const L={};for(const B in this._previousActiveHandlers)I[B]||(L[B]=m);this._previousActiveHandlers=I,(Object.keys(L).length||Ai(g))&&(this._changes.push([g,x,L]),this._triggerRenderFrame()),(Object.keys(I).length||Ai(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=g;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,s,h,m,g){if(!h)return;i.l(t,h);const x={handlerName:m,originalEvent:h.originalEvent||g};h.zoomDelta!==void 0&&(s.zoom=x),h.panDelta!==void 0&&(s.drag=x),h.pitchDelta!==void 0&&(s.pitch=x),h.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},h={};for(const[m,g,x]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new i.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),i.l(s,g),i.l(h,x);this._updateMapTransform(t,s,h),this._changes=[]}_updateMapTransform(t,s,h){const m=this._map,g=m.transform,x=oe=>[oe.x,oe.y,oe.z];if((oe=>{const ue=this._eventsInProgress.drag;return ue&&!this._handlersById[ue.handlerName].isActive()})()&&!Ai(t)){const oe=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),oe!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&m._stop(!0),!Ai(t))return void this._fireEvents(s,h,!0);let{panDelta:I,zoomDelta:P,bearingDelta:z,pitchDelta:L,around:F,aroundCoord:B,pinchAround:j}=t;g._isCameraConstrained&&(P>0&&(P=0),g._isCameraConstrained=!1),j!==void 0&&(F=j),(P||(oe=>s[oe]&&!this._eventsInProgress[oe])("drag"))&&F&&(this._dragOrigin=x(g.pointCoordinate3D(F)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",m._stop(!0),F=F||m.transform.centerPoint,z&&(g.bearing+=z),L&&(g.pitch+=L),g._updateCameraState();const X=[0,0,0];if(I)if(g.projection.name==="mercator"){const oe=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(F).dir),ue=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(F.sub(I)).dir);X[0]=ue[0]-oe[0],X[1]=ue[1]-oe[1]}else{const oe=g.pointCoordinate(F);if(g.projection.name==="globe"){I=I.rotate(-g.angle);const ue=g._pixelsPerMercatorPixel/g.worldSize;X[0]=-I.x*i.dE(i.aT(oe.y))*ue,X[1]=-I.y*i.dE(g.center.lat)*ue}else{const ue=g.pointCoordinate(F.sub(I));oe&&ue&&(X[0]=ue.x-oe.x,X[1]=ue.y-oe.y)}}const q=g.zoom,J=[0,0,0];if(P){const oe=x(B||g.pointCoordinate3D(F)),ue={dir:i.ad.vec3.normalize([],i.ad.vec3.sub([],oe,g._camera.position))};if(ue.dir[2]<0){const ce=g.zoomDeltaToMovement(oe,P);i.ad.vec3.scale(J,ue.dir,ce)}}const Q=i.ad.vec3.add(X,X,J);g._translateCameraConstrained(Q),P&&Math.abs(g.zoom-q)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,h,!0)}_fireEvents(t,s,h){const m=Wh(this._eventsInProgress),g=Wh(t),x={};for(const L in t){const{originalEvent:F}=t[L];this._eventsInProgress[L]||(x[`${L}start`]=F),this._eventsInProgress[L]=t[L]}!m&&g&&this._fireEvent("movestart",g.originalEvent);for(const L in x)this._fireEvent(L,x[L]);g&&this._fireEvent("move",g.originalEvent);for(const L in t){const{originalEvent:F}=t[L];this._fireEvent(L,F)}const I={};let P;for(const L in this._eventsInProgress){const{handlerName:F,originalEvent:B}=this._eventsInProgress[L];this._handlersById[F].isActive()||(delete this._eventsInProgress[L],P=s[F]||B,I[`${L}end`]=P)}for(const L in I)this._fireEvent(L,I[L]);const z=Wh(this._eventsInProgress);if(h&&(m||g)&&!z){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;L?(F(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:P})):(this._map.fire(new i.A("moveend",{originalEvent:P})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new i.A(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new O0("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const sp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class k0 extends i.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,i.aQ(["_renderFrameCallback"],this)}getCenter(){return new i.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,h){return t=i.P.convert(t).mult(-1),this.panTo(this.transform.center,i.l({offset:t},s),h)}panTo(t,s,h){return this.easeTo(i.l({center:t},s),h)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,h){return this.easeTo(i.l({zoom:t},s),h)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,h){return this.easeTo(i.l({bearing:t},s),h)}resetNorth(t,s){return this.rotateTo(0,i.l({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=i.aB.convert(t);const h=s&&s.bearing||0,m=s&&s.pitch||0,g=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,g,x,h,m,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?i.l({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:i.l({},s,t)}_extendCameraOptions(t){return(t=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const h=s.max[0]-s.min[0],m=s.max[1]-s.min[1];return h/m>t.aspect?h/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,h,m,g,x){const I=t.clone(),P=this._extendCameraOptions(x);I.bearing=m,I.pitch=g;const z=i.bO.convert(s),L=i.bO.convert(h),F=.5*(z.lat+L.lat),B=.5*(z.lng+L.lng),j=i.dF(F,B),X=i.ad.vec3.normalize([],j),q=i.ad.vec3.normalize([],i.ad.vec3.cross([],X,[0,1,0])),J=i.ad.vec3.cross([],q,X),Q=[q[0],q[1],q[2],0,J[0],J[1],J[2],0,X[0],X[1],X[2],0,0,0,0,1],oe=[j,i.dF(z.lat,z.lng),i.dF(L.lat,z.lng),i.dF(L.lat,L.lng),i.dF(z.lat,L.lng),i.dF(F,z.lng),i.dF(F,L.lng),i.dF(z.lat,B),i.dF(L.lat,B)];let ue=i.ce.fromPoints(oe.map(Ze=>[i.ad.vec3.dot(q,Ze),i.ad.vec3.dot(J,Ze),i.ad.vec3.dot(X,Ze)]));const ce=i.ad.vec3.transformMat4([],ue.center,Q);i.ad.vec3.squaredLength(ce)===0&&i.ad.vec3.set(ce,0,0,1),i.ad.vec3.normalize(ce,ce),i.ad.vec3.scale(ce,ce,i.az),I.center=i.dG(ce);const ge=I.getWorldToCameraMatrix(),pe=i.ad.mat4.invert(new Float64Array(16),ge);ue=i.ce.applyTransform(ue,i.ad.mat4.multiply([],ge,Q));const _e=this._extendAABB(ue,I,P,m);if(!_e)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=_e,i.ad.vec3.transformMat4(ce,ce,ge);const me=.5*(ue.max[2]-ue.min[2]),we=this._minimumAABBFrustumDistance(I,ue),Ee=i.ad.vec3.scale([],[0,0,1],me),He=i.ad.vec3.add(Ee,ce,Ee),Be=we+(I.pitch===0?0:i.ad.vec3.distance(ce,He)),et=I.globeCenterInViewSpace,rt=i.ad.vec3.sub([],ce,[et[0],et[1],et[2]]);i.ad.vec3.normalize(rt,rt),i.ad.vec3.scale(rt,rt,Be);const _t=i.ad.vec3.add([],ce,rt);i.ad.vec3.transformMat4(_t,_t,pe);const Oe=i.dv/i.az,Qe=i.ad.vec3.length(_t),De=i.bH(Math.max(Qe*Oe-i.dv,Number.EPSILON),0),Je=Math.min(I.zoomFromMercatorZAdjusted(De),P.maxZoom);return Je>.5*(i.c6+i.bY)?(I.setProjection({name:"mercator"}),I.zoom=Je,this._cameraForBounds(I,s,h,m,g,x)):{center:I.center,zoom:Je,bearing:m,pitch:g}}_extendAABB(t,s,h,m){const g=.5*((h.padding.left||0)+(h.padding.right||0)),x=.5*((h.padding.top||0)+(h.padding.bottom||0)),I=x,P=g,z=g,L=x,F=s.width-(P+z),B=s.height-(I+L),j=i.ad.vec3.sub([],t.max,t.min),X=Math.min(F/j[0],B/j[1]),q=Math.min(s.scaleZoom(s.scale*X),h.maxZoom);if(isNaN(q))return null;const J=s.scale/s.zoomScale(q),Q=new i.ce([t.min[0]-P*J,t.min[1]-L*J,t.min[2]],[t.max[0]+z*J,t.max[1]+I*J,t.max[2]]),oe=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new i.P(h.offset.x,h.offset.y):i.P.convert(h.offset)).rotate(-i.ak(m));return Q.center[0]-=oe.x*J,Q.center[1]+=oe.y*J,Q}queryTerrainElevation(t,s){const h=this.transform.elevation;return h?(s=i.l({},{exaggerated:!0},s),h.getAtPoint(i.ac.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,h,m,g,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,h,m,g,x);const I=t.clone(),P=this._extendCameraOptions(x);I.bearing=m,I.pitch=g;const z=i.bO.convert(s),L=i.bO.convert(h),F=new i.bO(z.lng,L.lat),B=new i.bO(L.lng,z.lat),j=I.project(z),X=I.project(L),q=this.queryTerrainElevation(z),J=this.queryTerrainElevation(L),Q=this.queryTerrainElevation(F),oe=this.queryTerrainElevation(B),ue=[[j.x,j.y,Math.min(q||0,J||0,Q||0,oe||0)],[X.x,X.y,Math.max(q||0,J||0,Q||0,oe||0)]];let ce=i.ce.fromPoints(ue);const ge=I.getWorldToCameraMatrix(),pe=i.ad.mat4.invert(new Float64Array(16),ge);ce=i.ce.applyTransform(ce,ge);const _e=this._extendAABB(ce,I,P,m);if(!_e)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=_e;const me=.5*i.ad.vec3.sub([],ce.max,ce.min)[2],we=this._minimumAABBFrustumDistance(I,ce),Ee=[0,0,1,0];i.ad.vec4.transformMat4(Ee,Ee,ge),i.ad.vec4.normalize(Ee,Ee);const He=i.ad.vec3.scale([],Ee,we+me),Be=i.ad.vec3.add([],ce.center,He);i.ad.vec3.transformMat4(ce.center,ce.center,pe),i.ad.vec3.transformMat4(Be,Be,pe);const et=I.unproject(new i.P(ce.center[0],ce.center[1])),rt=i.dH(I.projection,et),_t=Math.pow(2,rt),Oe=Math.min(I._zoomFromMercatorZ(Be[2]*I.pixelsPerMeter*_t/I.worldSize),P.maxZoom);return I.mercatorFromTransition&&Oe<.5*(i.c6+i.bY)?(I.setProjection({name:"globe"}),I.zoom=Oe,this._cameraForBounds(I,s,h,m,g,x)):{center:et,zoom:Oe,bearing:m,pitch:g}}fitBounds(t,s,h){const m=this.cameraForBounds(t,s);return this._fitInternal(m,s,h)}fitScreenCoordinates(t,s,h,m,g){const x=i.P.convert(t),I=i.P.convert(s),P=new i.P(Math.min(x.x,I.x),Math.min(x.y,I.y)),z=new i.P(Math.max(x.x,I.x),Math.max(x.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,I))return this;const L=this.transform.pointLocation3D(P),F=this.transform.pointLocation3D(z),B=this.transform.pointLocation3D(new i.P(P.x,z.y)),j=this.transform.pointLocation3D(new i.P(z.x,P.y)),X=[Math.min(L.lng,F.lng,B.lng,j.lng),Math.min(L.lat,F.lat,B.lat,j.lat)],q=[Math.max(L.lng,F.lng,B.lng,j.lng),Math.max(L.lat,F.lat,B.lat,j.lat)],J=m&&m.pitch?m.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,X,q,h,J,m);return this._fitInternal(Q,m,g)}_fitInternal(t,s,h){return t?(s=i.l(t,s)).linear?this.easeTo(s,h):this.flyTo(s,h):this}jumpTo(t,s){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let m=!1,g=!1,x=!1;"zoom"in t&&h.zoom!==+t.zoom&&(m=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=i.bO.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(g=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(x=!0,h.pitch=+t.pitch);const I=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!h.isPaddingEqual(I))if(t.retainPadding===!1){const P=h.clone();P.padding=I,h.setLocationAtPoint(h.center,P.centerPoint)}else h.padding=I;return t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new i.A("movestart",s)).fire(new i.A("move",s)),m&&this.fire(new i.A("zoomstart",s)).fire(new i.A("zoom",s)).fire(new i.A("zoomend",s)),g&&this.fire(new i.A("rotatestart",s)).fire(new i.A("rotate",s)).fire(new i.A("rotateend",s)),x&&this.fire(new i.A("pitchstart",s)).fire(new i.A("pitch",s)).fire(new i.A("pitchend",s)),this.fire(new i.A("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(sp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return i.w(sp),this;this.stop();const m=h.zoom,g=h.pitch,x=h.bearing;h.setFreeCameraOptions(t);const I=m!==h.zoom,P=g!==h.pitch,z=x!==h.bearing;return this.fire(new i.A("movestart",s)).fire(new i.A("move",s)),I&&this.fire(new i.A("zoomstart",s)).fire(new i.A("zoom",s)).fire(new i.A("zoomend",s)),z&&this.fire(new i.A("rotatestart",s)).fire(new i.A("rotate",s)).fire(new i.A("rotateend",s)),P&&this.fire(new i.A("pitchstart",s)).fire(new i.A("pitch",s)).fire(new i.A("pitchend",s)),this.fire(new i.A("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=i.l({offset:[0,0],duration:500,easing:i.dD},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const h=this.transform,m=this.getZoom(),g=this.getBearing(),x=this.getPitch(),I=this.getPadding(),P="zoom"in t?+t.zoom:m,z="bearing"in t?this._normalizeBearing(t.bearing,g):g,L="pitch"in t?+t.pitch:x,F=this._extendPadding(t.padding),B=i.P.convert(t.offset);let j,X,q;if(h.projection.name==="globe"){const Ee=i.ac.fromLngLat(h.center),He=B.rotate(-h.angle);Ee.x+=He.x/h.worldSize,Ee.y+=He.y/h.worldSize;const Be=Ee.toLngLat(),et=i.bO.convert(t.center||Be);this._normalizeCenter(et),j=h.centerPoint.add(He),X=new i.P(Ee.x,Ee.y).mult(h.worldSize),q=new i.P(i.av(et.lng),i.aC(et.lat)).mult(h.worldSize).sub(X)}else{j=h.centerPoint.add(B);const Ee=h.pointLocation(j),He=i.bO.convert(t.center||Ee);this._normalizeCenter(He),X=h.project(Ee),q=h.project(He).sub(X)}const J=h.zoomScale(P-m);let Q,oe;t.around&&(Q=i.bO.convert(t.around),oe=h.locationPoint(Q));const ue=this._zooming||P!==m,ce=this._rotating||g!==z,ge=this._pitching||L!==x,pe=!h.isPaddingEqual(F),_e=t.retainPadding===!1?h.clone():h,me=Ee=>He=>{if(ue&&(Ee.zoom=i.ah(m,P,He)),ce&&(Ee.bearing=i.ah(g,z,He)),ge&&(Ee.pitch=i.ah(x,L,He)),pe&&(_e.interpolatePadding(I,F,He),j=_e.centerPoint.add(B)),Q)Ee.setLocationAtPoint(Q,oe);else{const Be=Ee.zoomScale(Ee.zoom-m),et=P>m?Math.min(2,J):Math.max(.5,J),rt=Math.pow(et,1-He),_t=Ee.unproject(X.add(q.mult(He*rt)).mult(Be));Ee.setLocationAtPoint(Ee.renderWorldCopies?_t.wrap():_t,j)}return t.preloadOnly||this._fireMoveEvents(s),Ee};if(t.preloadOnly){const Ee=this._emulate(me,t.duration,h);return this._preloadTiles(Ee),this}const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ue,this._rotating=ce,this._pitching=ge,this._padding=pe,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,we),this._ease(me(h),Ee=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(s,Ee)},t),this}_prepareEase(t,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||h.moving||this.fire(new i.A("movestart",t)),this._zooming&&!h.zooming&&this.fire(new i.A("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new i.A("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new i.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new i.A("move",t)),this._zooming&&this.fire(new i.A("zoom",t)),this._rotating&&this.fire(new i.A("rotate",t)),this._pitching&&this.fire(new i.A("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new i.A("zoomend",t)),m&&this.fire(new i.A("rotateend",t)),g&&this.fire(new i.A("pitchend",t)),this.fire(new i.A("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const Ze=i.aA(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ze,s)}this.stop(),t=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.dD},t);const h=this.transform,m=this.getZoom(),g=this.getBearing(),x=this.getPitch(),I=this.getPadding(),P="zoom"in t?i.ay(+t.zoom,h.minZoom,h.maxZoom):m,z="bearing"in t?this._normalizeBearing(t.bearing,g):g,L="pitch"in t?+t.pitch:x,F=this._extendPadding(t.padding),B=h.zoomScale(P-m),j=i.P.convert(t.offset);let X=h.centerPoint.add(j);const q=h.pointLocation(X),J=i.bO.convert(t.center||q);this._normalizeCenter(J);const Q=h.project(q),oe=h.project(J).sub(Q);let ue=t.curve;const ce=Math.max(h.width,h.height),ge=ce/B,pe=oe.mag();if("minZoom"in t){const Ze=i.ay(Math.min(t.minZoom,m,P),h.minZoom,h.maxZoom),ot=ce/h.zoomScale(Ze-m);ue=Math.sqrt(ot/pe*2)}const _e=ue*ue;function me(Ze){const ot=(ge*ge-ce*ce+(Ze?-1:1)*_e*_e*pe*pe)/(2*(Ze?ge:ce)*_e*pe);return Math.log(Math.sqrt(ot*ot+1)-ot)}function we(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Ee(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const He=me(0);let Be=function(Ze){return Ee(He)/Ee(He+ue*Ze)},et=function(Ze){return ce*((Ee(He)*(we(ot=He+ue*Ze)/Ee(ot))-we(He))/_e)/pe;var ot},rt=(me(1)-He)/ue;if(Math.abs(pe)<1e-6||!isFinite(rt)){if(Math.abs(ce-ge)<1e-6)return this.easeTo(t,s);const Ze=ge<ce?-1:1;rt=Math.abs(Math.log(ge/ce))/ue,et=function(){return 0},Be=function(ot){return Math.exp(Ze*ue*ot)}}t.duration="duration"in t?+t.duration:1e3*rt/("screenSpeed"in t?+t.screenSpeed/ue:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const _t=g!==z,Oe=L!==x,Qe=!h.isPaddingEqual(F),De=t.retainPadding===!1?h.clone():h,Je=Ze=>ot=>{const $e=ot*rt,ct=1/Be($e);Ze.zoom=ot===1?P:m+Ze.scaleZoom(ct),_t&&(Ze.bearing=i.ah(g,z,ot)),Oe&&(Ze.pitch=i.ah(x,L,ot)),Qe&&(De.interpolatePadding(I,F,ot),X=De.centerPoint.add(j));const Tt=ot===1?J:Ze.unproject(Q.add(oe.mult(et($e))).mult(ct));return Ze.setLocationAtPoint(Ze.renderWorldCopies?Tt.wrap():Tt,X),Ze._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),Ze};if(t.preloadOnly){const Ze=this._emulate(Je,t.duration,h);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=_t,this._pitching=Oe,this._padding=Qe,this._prepareEase(s,!1),this._ease(Je(h),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,s,h){h.animate===!1||h.duration===0?(t(1),s()):(this._easeStart=i.q.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=i.bF(t,-180,180);const h=Math.abs(t-s);return Math.abs(t-360-s)<h&&(t-=360),Math.abs(t+360-s)<h&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const h=t.lng-s.center.lng;t.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,h){const m=Math.ceil(15*s/1e3),g=[],x=t(h.clone());for(let I=0;I<=m;I++){const P=x(I/m);g.push(P.clone())}return g}_preloadTiles(t,s){}}class al{constructor(t={}){this.options=t,i.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,h=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ye("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);const m=ye("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",h),this._innerContainer=ye("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(t){const h=s.reduce((m,g,x)=>(g.value&&(m+=`${g.key}=${g.value}${x<s.length-1?"&":""}`),m),"?");t.href=`${i.e.FEEDBACK_URL}/${h}#${Uh(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._mergedSourceCaches;for(const m in s){const g=s[m];if(g.used){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((m,g)=>m.length-g.length),t=t.filter((m,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class op{constructor(){i.aQ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=ye("div","mapboxgl-ctrl");const s=ye("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const h=t[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Ms{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const m of h)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Gs{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=i.cC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,h){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+h}}const Hl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Pa extends i.A{constructor(t,s,h,m){const{point:g,lngLat:x,originalEvent:I,target:P}=t;super(t.type,{point:g,lngLat:x,originalEvent:I,target:P}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=h,this.feature=m}}class ql{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const h=s.filter;let m=s.type;h&&this.filters.set(t,i.a_(h)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const g=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):g.size===0&&this.map.on(m,this.handleType),g.size===0&&this.interactionsByType.set(m,g),g.set(t,s),this.typeById.set(t,m)}get(t){const s=this.typeById.get(t);if(!s)return;const h=this.interactionsByType.get(s);return h?h.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const h=this.interactionsByType.get(s);h&&(h.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):h.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const h=[];for(const[m,g]of s)g.target&&h.push({targetId:m,target:g.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,h,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const h=new Map;for(const[m,{feature:g}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||h.set(g.id,g);h.size&&(t.type="mouseleave",this.handleType(t,Array.from(h.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map(({feature:h})=>h);s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const h=Array.from(this.interactionsByType.get(t.type)).reverse(),m=!!s;s=s||this.queryTargets(t.point,h);const g=t.type==="mouseenter";let x=!1;const I=new Set;for(const P of s){for(const[z,L]of h){if(!L.target)continue;const F=P.variants?P.variants[z]:null;if(F){for(const B of F){if(Rc(B,P,I,z))continue;const j=new i.cx(P,B),X=qd(B,P,z);m&&(j.state=this.map.getFeatureState(j));const q=g?this.prevHoveredFeatures.get(X):null,J=new Pa(t,z,L,j),Q=q?q.stop:L.handler(J);if(g&&this.hoveredFeatures.set(X,{feature:P,stop:Q}),Q!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(const[P,z]of h){const{handler:L,target:F}=z;if(!F&&L(new Pa(t,P,z,null))!==!1)break}}}function ap(d,t){if(Array.isArray(d)&&Array.isArray(t)){const s=new Set(d),h=new Set(t);return s.size===h.size&&d.every(m=>h.has(m))}return i.bn(d,t)}const Qr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Ra={showCompass:!0,showZoom:!0,visualizePitch:!1};class F0{constructor(t,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new iu({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new Ro({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),i.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),ut()}move(t,s){const h=this.map,m=this.mouseRotate.mousemoveWindow(t,s),g=m&&m.bearingDelta;if(g&&h.setBearing(h.getBearing()+g),this.mousePitch){const x=this.mousePitch.mousemoveWindow(t,s),I=x&&x.pitchDelta;I&&h.setPitch(h.getPitch()+I)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ht(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(i.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),At(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,At(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=pt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function z_(d,t,s){if(d=new i.bO(d.lng,d.lat),t){const h=new i.bO(d.lng-360,d.lat),m=new i.bO(d.lng+360,d.lat),g=360*Math.ceil(Math.abs(d.lng-s.center.lng)/360),x=s.locationPoint3D(d).distSqr(t),I=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(h).distSqr(t)<x&&(I||Math.abs(h.lng-s.center.lng)<g)?d=h:s.locationPoint3D(m).distSqr(t)<x&&(I||Math.abs(m.lng-s.center.lng)<g)&&(d=m)}for(;Math.abs(d.lng-s.center.lng)>180;){const h=s.locationPoint3D(d);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;d.lng>s.center.lng?d.lng-=360:d.lng+=360}return d}const su={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Is={anchor:"center",color:"#3FB1CE",scale:1,draggable:!1,clickTolerance:0,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class so extends i.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=i.l({element:t},s)),i.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),t=i.l({},Is,t),this._anchor=t.anchor,this._color=t.color,this._scale=t.scale,this._draggable=t.draggable,this._clickTolerance=t.clickTolerance,this._rotation=t.rotation,this._rotationAlignment=t.rotationAlignment,this._pitchAlignment=t.pitchAlignment,this._occludedOpacity=t.occludedOpacity,this._altitude=t.altitude,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=i.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const h=this._element.classList;for(const g in su)h.remove(`mapboxgl-marker-anchor-${g}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`);const m=t&&t.className?t.className.trim().split(/\s+/):[];h.add(...m),this._popup=null}_createDefaultMarker(){const t=ye("div"),s=Le("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const h=Le("radialGradient",{id:"shadowGradient"},Le("defs",{},s));Le("stop",{offset:"10%","stop-opacity":.4},h),Le("stop",{offset:"100%","stop-opacity":.05},h),Le("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return Le("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),Le("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),Le("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=i.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Is.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,h=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const h=t.unproject(s,this._altitude),m=t.getFreeCameraOptions();if(!m.position)return!1;const g=m.position.toLngLat();return g.distanceTo(h)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(s,this._altitude);let m;t._showingGlobe()&&i.dK(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(h),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${su[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!t||h!=="map")return"";if(!s._showingGlobe()){const P=s.getPitch();return P?`rotateX(${P}deg)`:""}const m=i.c4(i.dL(s.transform,this._lngLat)),g=t.sub(i.dM(s.transform)),x=Math.abs(g.x)+Math.abs(g.y);if(x===0)return"";const I=m/x;return`rotateX(${-g.y*I}deg) rotateY(${g.x*I}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let h=0;const m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){const g=s.project(new i.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=s.project(new i.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(g);h=i.c4(Math.atan2(x.y,x.x))-90}else h=-s.getBearing();else if(m==="horizon"){const g=i.ae(4,6,s.getZoom()),x=i.dM(s.transform);x.y+=g*s.transform.height;const I=t.sub(x),P=i.c4(Math.atan2(I.y,I.x));h=(P>90?P-270:P+90)*(1-g)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=z_(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=i.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const h=this._pointerdownPos,m=this._positionDelta;if(h&&m){if(!this._isDragging){const g=this._clickTolerance||s._clickTolerance;if(t.point.dist(h)<g)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,h=this._pos;s&&h&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(h),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Is.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Is.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Is.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Is.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Wi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},us={maxWidth:100,unit:"metric"},Mi={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},lp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ji=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function cp(d=new i.P(0,0),t="bottom"){if(typeof d=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(t){case"top":return new i.P(0,d);case"top-left":return new i.P(s,s);case"top-right":return new i.P(-s,s);case"bottom":return new i.P(0,-d);case"bottom-left":return new i.P(s,-s);case"bottom-right":return new i.P(-s,-s);case"left":return new i.P(d,0);case"right":return new i.P(-d,0)}return new i.P(0,0)}return d instanceof i.P||Array.isArray(d)?i.P.convert(d):i.P.convert(d[t]||[0,0])}return{version:G,supported:he.supported,setRTLTextPlugin:i.dN,getRTLTextPluginStatus:i.dO,Map:class extends k0{constructor(d){H.mark(W.create);const t=d;if((d=i.l({},Qr,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&i.dI(window)&&(d.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ct(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies,null,null),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Ms,this._domRenderTaskQueue=new Ms,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aW(),this._locale=i.l({},Hl,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Gs(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new zr(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const s=document.getElementById(d.container);if(!s)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=s}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,i.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Ea),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ip(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||i.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this.indoor=new l0(this),d.hash&&(this._hash=new Jf(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const s=d.bounds;s&&(this.resize(),this.fitBounds(s,i.l({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new al({customAttribution:d.customAttribution})),this._logoControl=new op,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new i.A(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new i.A(`${s.dataType}dataloading`,s))}),this._interactions=new ql(this)}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=d.onAdd(this);this._controls.push(d);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new i.A("movestart",d)).fire(new i.A("move",d)),this.fire(new i.A("resize",d)),t&&this.fire(new i.A("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(i.aB.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(t=>t==="auto"?navigator.language:t):d}setLanguage(d){const t=this._parseLanguage(d);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,t=d.projection.name;let s;t==="globe"&&d.zoom>=i.bY?(d.setMercatorFromTransition(),s=!0):t==="mercator"&&d.zoom<i.bY&&(d.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,t){return this._updateProjection(d||t||{name:"mercator"})}_updateProjection(d){let t;return t=d.name==="globe"&&this.transform.zoom>=i.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d,t){return this.transform.locationPoint3D(i.bO.convert(d),t)}unproject(d,t){return this.transform.pointLocation3D(i.P.convert(d),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,t,s){const h=m=>{let g=[];if(Array.isArray(t)){const x=t.filter(I=>this.getLayer(I));g=x.length?this.queryRenderedFeatures(m,{layers:x}):[]}else g=this.queryRenderedFeatures(m,{target:t});return g};if(d==="mouseenter"||d==="mouseover"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:x=>{const I=h(x.point);I.length?m||(m=!0,s.call(this,new cs(d,this,x.originalEvent,{features:I}))):m=!1},mouseout:()=>{m=!1}}}}if(d==="mouseleave"||d==="mouseout"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:I=>{h(I.point).length?m=!0:m&&(m=!1,s.call(this,new cs(d,this,I.originalEvent)))},mouseout:I=>{m&&(m=!1,s.call(this,new cs(d,this,I.originalEvent)))}}}}{const m=g=>{const x=h(g.point);x.length&&(g.features=x,s.call(this,g),delete g.features)};return{listener:s,targets:t,delegates:{[d]:m}}}}on(d,t,s){if(typeof t=="function"||s===void 0)return super.on(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(d,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(d,t,s){if(typeof t=="function"||s===void 0)return super.once(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(d,t,s);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(d,t,s){if(typeof t=="function"||s===void 0)return super.off(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._delegatedListeners?this._delegatedListeners[d]:void 0;return h&&(m=>{for(let g=0;g<m.length;g++){const x=m[g];if(x.listener===s&&ap(x.targets,t)){for(const I in x.delegates)this.off(I,x.delegates[I]);return m.splice(g,1),this}}})(h),this}queryRenderedFeatures(d,t){if(!this.style)return[];if(d===void 0||d instanceof i.P||Array.isArray(d)||t!==void 0||(t=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!t){const g=this.style.queryRenderedFeatures(d,void 0,this.transform),x=this.style.queryRenderedFeatureset(d,void 0,this.transform);return g.concat(x)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(d,t,this.transform);let h=!0;if(t.layers&&Array.isArray(t.layers)){for(const g of t.layers)if(!this._isValidId(g)){h=!1;break}if(h&&!t.target)return this.style.queryRenderedFeatures(d,t,this.transform)}let m=[];return h&&(m=m.concat(this.style.queryRenderedFeatures(d,t,this.transform))),s&&(m=m.concat(this.style.queryRenderedFeatureset(d,t,this.transform))),m}querySourceFeatures(d,t){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,t)}isPointOnSurface(d){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&i.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(d))}addInteraction(d,t){return this._interactions.add(d,t),this}removeInteraction(d){return this._interactions.remove(d),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this}setStyle(d,t){return t=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&d&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(d,(s,h)=>{s?(i.w(`Unable to perform style diff: ${String(s.message||s.error||s)}. Rebuilding the style from scratch.`),this._updateStyle(d,t)):h&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const s=i.l({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new os(this,s).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new os(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.cs(d)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const t of d)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(d)}addSource(d,t){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,s)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,t,{pixelRatio:s=1,sdf:h=!1,stretchX:m,stretchY:g,content:x}={}){this._lazyInitEmptyStyle();const I=i.I.from(d);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:P,height:z,data:L}=i.q.getImageData(t);this.style.addImage(I,{data:new i.r({width:P,height:z},L),pixelRatio:s,stretchX:m,stretchY:g,content:x,sdf:h,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:z}=t,L=t;this.style.addImage(I,{data:new i.r({width:P,height:z},new Uint8Array(L.data)),pixelRatio:s,stretchX:m,stretchY:g,content:x,sdf:h,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,d)}}updateImage(d,t){this._lazyInitEmptyStyle();const s=i.I.from(d),h=this.style.getImage(s);if(!h)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?i.q.getImageData(t):t,{width:g,height:x,data:I}=m;if(g===void 0||x===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(h.usvg?h.icon.usvg_tree.width:h.data.width)||x!==(h.usvg?h.icon.usvg_tree.height:h.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${g}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const P=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let z=!1;h.usvg?(h.data=new i.r({width:g,height:x},new Uint8Array(I)),h.usvg=!1,h.icon=void 0,z=!0):h.data.replace(I,P),this.style.updateImage(s,h,z)}hasImage(d){return d?!!this.style&&!!this.style.getImage(i.I.from(d)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(i.I.from(d))}loadImage(d,t){i.o(this._requestManager.transformRequest(d,i.R.Image),(s,h)=>{t(s,h instanceof HTMLImageElement?i.q.getImageData(h):h)})}listImages(){return this.style.listImages().map(d=>d.name)}addModel(d,t){this._lazyInitEmptyStyle(),this.style.addModel(d,t)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,t){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)):this}getSlot(d){const t=this.getLayer(d);return t&&t.slot||null}setSlot(d,t){return this.style.setSlot(d,t),this.style.mergeLayers(),this._update(!0)}addImport(d,t){return this.style.addImport(d,t),this}updateImport(d,t){return typeof t!="string"&&t.id!==d?(this.removeImport(d),this.addImport(t)):(this.style.updateImport(d,t),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,t){return this.style.moveImport(d,t),this._update(!0)}moveLayer(d,t){return this._isValidId(d)?(this.style.moveLayer(d,t),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const t=this.style.getOwnLayer(d);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,t,s){return this._isValidId(d)?(this.style.setLayerZoomRange(d,t,s),this._update(!0)):this}setFilter(d,t,s={}){return this._isValidId(d)?(this.style.setFilter(d,t,s),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,t,s,h={}){return this._isValidId(d)?(this.style.setPaintProperty(d,t,s,h),this._update(!0)):this}getPaintProperty(d,t){return this._isValidId(d)?this.style.getPaintProperty(d,t):null}setLayoutProperty(d,t,s,h={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,t,s,h),this._update(!0)):this}getLayoutProperty(d,t){return this._isValidId(d)?this.style.getLayoutProperty(d,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(d){return this.style.setGlyphsUrl(d),this._update(!0)}getSchema(d){return this.style.getSchema(d)}setSchema(d,t){return this.style.setSchema(d,t),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,t){return this.style.setConfig(d,t),this._update(!0)}getConfigProperty(d,t){return this.style.getConfigProperty(d,t)}setConfigProperty(d,t,s){return this.style.setConfigProperty(d,t,s),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const t=d[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,t),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bO.convert(d),this.transform):0}setFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,t),this._update())}removeFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,t),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,h,m,g=this._container;for(;g&&(!h||!m);){const x=window.getComputedStyle(g).transform;x&&x!=="none"&&(s=x.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),g=g.parentElement}this._containerWidth=h?Math.abs(d/h):d,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=ye("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ye("div","mapboxgl-canvas-container",d);this._canvas=ye("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=ye("div","mapboxgl-control-container",d),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{h[m]=ye("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){const s=i.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(d),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const t=this._markers.indexOf(d);t!==-1&&this._markers.splice(t,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const t=this._popups.indexOf(d);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const d=i.l({},he.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",d);t?(function(s,h){vn.add(s)}(t),this.painter=new Yf(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(t)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;this.fire(new i.A("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,h=i.q.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,L=this.transform.pitch,F=i.q.now(),B=new i.aa(z,{now:F,fadeDuration:g,pitch:L,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(h),this.style.updateSources(this.transform),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(h);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,H.mark(W.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const z=i.q.now()-h;m.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const L=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new i.A("gpu-timing-frame",{cpuTime:z,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(z);this.fire(new i.A("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(z);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:L}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(P||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(x=this._updateAverageElevation(h,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,H.mark(W.fullLoad),this._performanceMetricsCollection&&er(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const t of this._markers)d&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!d||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(d,t=!1){const s=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=d;const x=Math.abs(m-g);if(x>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(g),s(g);this._averageElevation.easeTo(g,d,300)}else if(x>1e-4)return this._averageElevation.jumpTo(g),s(g)}return!!this._averageElevation.isEasing(d)&&s(this._averageElevation.getValue(d))}_authenticate(){te(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{}),vi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&yn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function m(g){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,g,0);const x=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,x),x}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(m(d),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(d,t,s){let h=s[1]-s[0];const m=d.length/4;for(let g=0;g<t.length;g++){const x=t[g];let I=0;for(let P=0;P<x.length;P+=4)x[P]===d[P]&&x[P+1]===d[P+1]&&x[P+2]===d[P+2]&&x[P+3]===d[P+3]&&(I+=1);h+=(s[g+2]-s[g+1])*(1-I/m)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),vn.delete(this.painter.context.gl),Kt.remove(),$t.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=i.q.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(d){const t=this.style?this.style.getSourceCaches():[];return i.bl(t,(s,h)=>s._preloadTiles(d,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,t){i.dJ(d,t)}get version(){return G}},NavigationControl:class{constructor(d={}){this.options=i.l({},Ra,d),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(i.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const t=d.getZoom(),s=t===d.getMaxZoom(),h=t===d.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new F0(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,t){const s=ye("button",d,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(d,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);d.setAttribute("aria-label",s),d.firstElementChild&&d.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends i.E{constructor(d={}){super();const t=navigator.geolocation;this.options=i.l({geolocation:t},Wi,d),i.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Qc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,d(s)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>t(s.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),s=d.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",d)),this._finish()}}_updateCamera(d){const t=new i.bO(d.coords.longitude,d.coords.latitude),s=d.coords.accuracy,h=this._map.getBearing(),m=i.l({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(d){if(d){const t=new i.bO(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,t=i.bH(1,d._center.lat)*d.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ye("button","mapboxgl-ctrl-geolocate",this._container),ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ye("div","mapboxgl-user-location"),this._dotElement.appendChild(ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new so({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new so({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:al,ScaleControl:class{constructor(d={}){this.options=i.l({},us,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,h=t._containerWidth/2-d/2,m=t.unproject([h,s]),g=t.unproject([h+d,s]),x=m.distanceTo(g);if(this.options.unit==="imperial"){const I=3.2808*x;I>5280?this._setScale(d,I/5280,"mile"):this._setScale(d,I,"foot")}else this.options.unit==="nautical"?this._setScale(d,x/1852,"nautical-mile"):x>=1e3?this._setScale(d,x/1e3,"kilometer"):this._setScale(d,x,"meter")}_setScale(d,t,s){this._map._requestDomTask(()=>{const h=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let I=g/x;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(P){const z=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*z)/z}(I),x*I}(t),m=h/t;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(h):`${h}&nbsp;${Mi[s]}`,this._container.style.width=d*m+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:i.w("Full screen control 'container' must be a DOM element.")),i.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ye("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(d){super(),this.options=i.l(Object.create(lp),d),this._altitude=this.options.altitude,i.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=i.bO.convert(d),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(d){return this._altitude=d,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),s=document.createElement("body");let h;for(s.innerHTML=d;h=s.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ye("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(d),this.options.closeButton){const s=this._closeButton=ye("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let t;return this._classList.delete(d)?t=!1:(this._classList.add(d),t=!0),this._updateClassList(),t}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,h=this._pos;if(!t||!s||!h)return"bottom";const m=s.offsetWidth,g=s.offsetHeight,x=h.x<m/2,I=h.x>t.transform.width-m/2;if(h.y+d<g)return x?"top-left":I?"top-right":"top";if(h.y>t.transform.height-g){if(x)return"bottom-left";if(I)return"bottom-right"}return x?"left":I?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),d.className=t.join(" ")}_update(d){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=ye("div","mapboxgl-popup",t.getContainer()),this._tip=ye("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=z_(this._lngLat,this._pos,t.transform)),!this._trackPointer||d){const m=this._pos=this._trackPointer&&d instanceof i.P?d:t.project(this._lngLat,this._altitude),g=cp(this.options.offset),x=this._anchor=this._getAnchor(g.y),I=cp(this.options.offset,x),P=m.add(I).round();t._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${su[x]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&t._showingGlobe()){const m=i.dK(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Ji);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:so,Style:os,LngLat:i.bO,LngLatBounds:i.aB,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:Ml,Evented:i.E,config:i.e,prewarm:i.dP,clearPrewarmedResources:i.dQ,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(d){i.e.ACCESS_TOKEN=d},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(d){i.e.API_URL=d},get workerCount(){return i.dR.workerCount},set workerCount(d){i.dR.workerCount=d},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){i.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){i.dS(d)},get workerUrl(){return i.dT.workerUrl},set workerUrl(d){i.dT.workerUrl=d},get workerClass(){return i.dT.workerClass},set workerClass(d){i.dT.workerClass=d},get workerParams(){return i.dT.workerParams},set workerParams(d){i.dT.workerParams=d},get dracoUrl(){return i.dU()},set dracoUrl(d){i.dV(d)},get meshoptUrl(){return i.dW()},set meshoptUrl(d){i.dX(d)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var D=A;return D})}(Gg)),Gg.exports}var UB=VB();const $j=PB(UB);function a3(n,l){return function(){return n.apply(l,arguments)}}const{toString:jB}=Object.prototype,{getPrototypeOf:W1}=Object,Fy=(n=>l=>{const p=jB.call(l);return n[p]||(n[p]=p.slice(8,-1).toLowerCase())})(Object.create(null)),fa=n=>(n=n.toLowerCase(),l=>Fy(l)===n),By=n=>l=>typeof l===n,{isArray:Vd}=Array,xm=By("undefined");function $B(n){return n!==null&&!xm(n)&&n.constructor!==null&&!xm(n.constructor)&&yo(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const l3=fa("ArrayBuffer");function GB(n){let l;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?l=ArrayBuffer.isView(n):l=n&&n.buffer&&l3(n.buffer),l}const HB=By("string"),yo=By("function"),c3=By("number"),Ny=n=>n!==null&&typeof n=="object",qB=n=>n===!0||n===!1,Hg=n=>{if(Fy(n)!=="object")return!1;const l=W1(n);return(l===null||l===Object.prototype||Object.getPrototypeOf(l)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},WB=fa("Date"),ZB=fa("File"),XB=fa("Blob"),KB=fa("FileList"),YB=n=>Ny(n)&&yo(n.pipe),JB=n=>{let l;return n&&(typeof FormData=="function"&&n instanceof FormData||yo(n.append)&&((l=Fy(n))==="formdata"||l==="object"&&yo(n.toString)&&n.toString()==="[object FormData]"))},QB=fa("URLSearchParams"),[e6,t6,r6,n6]=["ReadableStream","Request","Response","Headers"].map(fa),i6=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function zm(n,l,{allOwnKeys:p=!1}={}){if(n===null||typeof n>"u")return;let v,A;if(typeof n!="object"&&(n=[n]),Vd(n))for(v=0,A=n.length;v<A;v++)l.call(null,n[v],v,n);else{const R=p?Object.getOwnPropertyNames(n):Object.keys(n),D=R.length;let i;for(v=0;v<D;v++)i=R[v],l.call(null,n[i],i,n)}}function u3(n,l){l=l.toLowerCase();const p=Object.keys(n);let v=p.length,A;for(;v-- >0;)if(A=p[v],l===A.toLowerCase())return A;return null}const Iu=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,h3=n=>!xm(n)&&n!==Iu;function Hx(){const{caseless:n}=h3(this)&&this||{},l={},p=(v,A)=>{const R=n&&u3(l,A)||A;Hg(l[R])&&Hg(v)?l[R]=Hx(l[R],v):Hg(v)?l[R]=Hx({},v):Vd(v)?l[R]=v.slice():l[R]=v};for(let v=0,A=arguments.length;v<A;v++)arguments[v]&&zm(arguments[v],p);return l}const s6=(n,l,p,{allOwnKeys:v}={})=>(zm(l,(A,R)=>{p&&yo(A)?n[R]=a3(A,p):n[R]=A},{allOwnKeys:v}),n),o6=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),a6=(n,l,p,v)=>{n.prototype=Object.create(l.prototype,v),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:l.prototype}),p&&Object.assign(n.prototype,p)},l6=(n,l,p,v)=>{let A,R,D;const i={};if(l=l||{},n==null)return l;do{for(A=Object.getOwnPropertyNames(n),R=A.length;R-- >0;)D=A[R],(!v||v(D,n,l))&&!i[D]&&(l[D]=n[D],i[D]=!0);n=p!==!1&&W1(n)}while(n&&(!p||p(n,l))&&n!==Object.prototype);return l},c6=(n,l,p)=>{n=String(n),(p===void 0||p>n.length)&&(p=n.length),p-=l.length;const v=n.indexOf(l,p);return v!==-1&&v===p},u6=n=>{if(!n)return null;if(Vd(n))return n;let l=n.length;if(!c3(l))return null;const p=new Array(l);for(;l-- >0;)p[l]=n[l];return p},h6=(n=>l=>n&&l instanceof n)(typeof Uint8Array<"u"&&W1(Uint8Array)),d6=(n,l)=>{const v=(n&&n[Symbol.iterator]).call(n);let A;for(;(A=v.next())&&!A.done;){const R=A.value;l.call(n,R[0],R[1])}},f6=(n,l)=>{let p;const v=[];for(;(p=n.exec(l))!==null;)v.push(p);return v},p6=fa("HTMLFormElement"),m6=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(p,v,A){return v.toUpperCase()+A}),SE=(({hasOwnProperty:n})=>(l,p)=>n.call(l,p))(Object.prototype),_6=fa("RegExp"),d3=(n,l)=>{const p=Object.getOwnPropertyDescriptors(n),v={};zm(p,(A,R)=>{let D;(D=l(A,R,n))!==!1&&(v[R]=D||A)}),Object.defineProperties(n,v)},g6=n=>{d3(n,(l,p)=>{if(yo(n)&&["arguments","caller","callee"].indexOf(p)!==-1)return!1;const v=n[p];if(yo(v)){if(l.enumerable=!1,"writable"in l){l.writable=!1;return}l.set||(l.set=()=>{throw Error("Can not rewrite read-only method '"+p+"'")})}})},y6=(n,l)=>{const p={},v=A=>{A.forEach(R=>{p[R]=!0})};return Vd(n)?v(n):v(String(n).split(l)),p},v6=()=>{},x6=(n,l)=>n!=null&&Number.isFinite(n=+n)?n:l;function b6(n){return!!(n&&yo(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const w6=n=>{const l=new Array(10),p=(v,A)=>{if(Ny(v)){if(l.indexOf(v)>=0)return;if(!("toJSON"in v)){l[A]=v;const R=Vd(v)?[]:{};return zm(v,(D,i)=>{const G=p(D,A+1);!xm(G)&&(R[i]=G)}),l[A]=void 0,R}}return v};return p(n,0)},T6=fa("AsyncFunction"),S6=n=>n&&(Ny(n)||yo(n))&&yo(n.then)&&yo(n.catch),f3=((n,l)=>n?setImmediate:l?((p,v)=>(Iu.addEventListener("message",({source:A,data:R})=>{A===Iu&&R===p&&v.length&&v.shift()()},!1),A=>{v.push(A),Iu.postMessage(p,"*")}))(`axios@${Math.random()}`,[]):p=>setTimeout(p))(typeof setImmediate=="function",yo(Iu.postMessage)),E6=typeof queueMicrotask<"u"?queueMicrotask.bind(Iu):typeof process<"u"&&process.nextTick||f3,It={isArray:Vd,isArrayBuffer:l3,isBuffer:$B,isFormData:JB,isArrayBufferView:GB,isString:HB,isNumber:c3,isBoolean:qB,isObject:Ny,isPlainObject:Hg,isReadableStream:e6,isRequest:t6,isResponse:r6,isHeaders:n6,isUndefined:xm,isDate:WB,isFile:ZB,isBlob:XB,isRegExp:_6,isFunction:yo,isStream:YB,isURLSearchParams:QB,isTypedArray:h6,isFileList:KB,forEach:zm,merge:Hx,extend:s6,trim:i6,stripBOM:o6,inherits:a6,toFlatObject:l6,kindOf:Fy,kindOfTest:fa,endsWith:c6,toArray:u6,forEachEntry:d6,matchAll:f6,isHTMLForm:p6,hasOwnProperty:SE,hasOwnProp:SE,reduceDescriptors:d3,freezeMethods:g6,toObjectSet:y6,toCamelCase:m6,noop:v6,toFiniteNumber:x6,findKey:u3,global:Iu,isContextDefined:h3,isSpecCompliantForm:b6,toJSONObject:w6,isAsyncFn:T6,isThenable:S6,setImmediate:f3,asap:E6};function dn(n,l,p,v,A){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",l&&(this.code=l),p&&(this.config=p),v&&(this.request=v),A&&(this.response=A,this.status=A.status?A.status:null)}It.inherits(dn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:It.toJSONObject(this.config),code:this.code,status:this.status}}});const p3=dn.prototype,m3={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{m3[n]={value:n}});Object.defineProperties(dn,m3);Object.defineProperty(p3,"isAxiosError",{value:!0});dn.from=(n,l,p,v,A,R)=>{const D=Object.create(p3);return It.toFlatObject(n,D,function(G){return G!==Error.prototype},i=>i!=="isAxiosError"),dn.call(D,n.message,l,p,v,A),D.cause=n,D.name=n.name,R&&Object.assign(D,R),D};const A6=null;function qx(n){return It.isPlainObject(n)||It.isArray(n)}function _3(n){return It.endsWith(n,"[]")?n.slice(0,-2):n}function EE(n,l,p){return n?n.concat(l).map(function(A,R){return A=_3(A),!p&&R?"["+A+"]":A}).join(p?".":""):l}function M6(n){return It.isArray(n)&&!n.some(qx)}const I6=It.toFlatObject(It,{},null,function(l){return/^is[A-Z]/.test(l)});function Vy(n,l,p){if(!It.isObject(n))throw new TypeError("target must be an object");l=l||new FormData,p=It.toFlatObject(p,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ye,Le){return!It.isUndefined(Le[ye])});const v=p.metaTokens,A=p.visitor||H,R=p.dots,D=p.indexes,G=(p.Blob||typeof Blob<"u"&&Blob)&&It.isSpecCompliantForm(l);if(!It.isFunction(A))throw new TypeError("visitor must be a function");function W(he){if(he===null)return"";if(It.isDate(he))return he.toISOString();if(!G&&It.isBlob(he))throw new dn("Blob is not supported. Use a Buffer instead.");return It.isArrayBuffer(he)||It.isTypedArray(he)?G&&typeof Blob=="function"?new Blob([he]):Buffer.from(he):he}function H(he,ye,Le){let je=he;if(he&&!Le&&typeof he=="object"){if(It.endsWith(ye,"{}"))ye=v?ye:ye.slice(0,-2),he=JSON.stringify(he);else if(It.isArray(he)&&M6(he)||(It.isFileList(he)||It.endsWith(ye,"[]"))&&(je=It.toArray(he)))return ye=_3(ye),je.forEach(function(Dt,ut){!(It.isUndefined(Dt)||Dt===null)&&l.append(D===!0?EE([ye],ut,R):D===null?ye:ye+"[]",W(Dt))}),!1}return qx(he)?!0:(l.append(EE(Le,ye,R),W(he)),!1)}const ee=[],ne=Object.assign(I6,{defaultVisitor:H,convertValue:W,isVisitable:qx});function de(he,ye){if(!It.isUndefined(he)){if(ee.indexOf(he)!==-1)throw Error("Circular reference detected in "+ye.join("."));ee.push(he),It.forEach(he,function(je,xt){(!(It.isUndefined(je)||je===null)&&A.call(l,je,It.isString(xt)?xt.trim():xt,ye,ne))===!0&&de(je,ye?ye.concat(xt):[xt])}),ee.pop()}}if(!It.isObject(n))throw new TypeError("data must be an object");return de(n),l}function AE(n){const l={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(v){return l[v]})}function Z1(n,l){this._pairs=[],n&&Vy(n,this,l)}const g3=Z1.prototype;g3.append=function(l,p){this._pairs.push([l,p])};g3.toString=function(l){const p=l?function(v){return l.call(this,v,AE)}:AE;return this._pairs.map(function(A){return p(A[0])+"="+p(A[1])},"").join("&")};function C6(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function y3(n,l,p){if(!l)return n;const v=p&&p.encode||C6;It.isFunction(p)&&(p={serialize:p});const A=p&&p.serialize;let R;if(A?R=A(l,p):R=It.isURLSearchParams(l)?l.toString():new Z1(l,p).toString(v),R){const D=n.indexOf("#");D!==-1&&(n=n.slice(0,D)),n+=(n.indexOf("?")===-1?"?":"&")+R}return n}class ME{constructor(){this.handlers=[]}use(l,p,v){return this.handlers.push({fulfilled:l,rejected:p,synchronous:v?v.synchronous:!1,runWhen:v?v.runWhen:null}),this.handlers.length-1}eject(l){this.handlers[l]&&(this.handlers[l]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(l){It.forEach(this.handlers,function(v){v!==null&&l(v)})}}const v3={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},P6=typeof URLSearchParams<"u"?URLSearchParams:Z1,R6=typeof FormData<"u"?FormData:null,D6=typeof Blob<"u"?Blob:null,z6={isBrowser:!0,classes:{URLSearchParams:P6,FormData:R6,Blob:D6},protocols:["http","https","file","blob","url","data"]},X1=typeof window<"u"&&typeof document<"u",Wx=typeof navigator=="object"&&navigator||void 0,L6=X1&&(!Wx||["ReactNative","NativeScript","NS"].indexOf(Wx.product)<0),O6=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",k6=X1&&window.location.href||"http://localhost",F6=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:X1,hasStandardBrowserEnv:L6,hasStandardBrowserWebWorkerEnv:O6,navigator:Wx,origin:k6},Symbol.toStringTag,{value:"Module"})),fs={...F6,...z6};function B6(n,l){return Vy(n,new fs.classes.URLSearchParams,Object.assign({visitor:function(p,v,A,R){return fs.isNode&&It.isBuffer(p)?(this.append(v,p.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},l))}function N6(n){return It.matchAll(/\w+|\[(\w*)]/g,n).map(l=>l[0]==="[]"?"":l[1]||l[0])}function V6(n){const l={},p=Object.keys(n);let v;const A=p.length;let R;for(v=0;v<A;v++)R=p[v],l[R]=n[R];return l}function x3(n){function l(p,v,A,R){let D=p[R++];if(D==="__proto__")return!0;const i=Number.isFinite(+D),G=R>=p.length;return D=!D&&It.isArray(A)?A.length:D,G?(It.hasOwnProp(A,D)?A[D]=[A[D],v]:A[D]=v,!i):((!A[D]||!It.isObject(A[D]))&&(A[D]=[]),l(p,v,A[D],R)&&It.isArray(A[D])&&(A[D]=V6(A[D])),!i)}if(It.isFormData(n)&&It.isFunction(n.entries)){const p={};return It.forEachEntry(n,(v,A)=>{l(N6(v),A,p,0)}),p}return null}function U6(n,l,p){if(It.isString(n))try{return(l||JSON.parse)(n),It.trim(n)}catch(v){if(v.name!=="SyntaxError")throw v}return(p||JSON.stringify)(n)}const Lm={transitional:v3,adapter:["xhr","http","fetch"],transformRequest:[function(l,p){const v=p.getContentType()||"",A=v.indexOf("application/json")>-1,R=It.isObject(l);if(R&&It.isHTMLForm(l)&&(l=new FormData(l)),It.isFormData(l))return A?JSON.stringify(x3(l)):l;if(It.isArrayBuffer(l)||It.isBuffer(l)||It.isStream(l)||It.isFile(l)||It.isBlob(l)||It.isReadableStream(l))return l;if(It.isArrayBufferView(l))return l.buffer;if(It.isURLSearchParams(l))return p.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),l.toString();let i;if(R){if(v.indexOf("application/x-www-form-urlencoded")>-1)return B6(l,this.formSerializer).toString();if((i=It.isFileList(l))||v.indexOf("multipart/form-data")>-1){const G=this.env&&this.env.FormData;return Vy(i?{"files[]":l}:l,G&&new G,this.formSerializer)}}return R||A?(p.setContentType("application/json",!1),U6(l)):l}],transformResponse:[function(l){const p=this.transitional||Lm.transitional,v=p&&p.forcedJSONParsing,A=this.responseType==="json";if(It.isResponse(l)||It.isReadableStream(l))return l;if(l&&It.isString(l)&&(v&&!this.responseType||A)){const D=!(p&&p.silentJSONParsing)&&A;try{return JSON.parse(l)}catch(i){if(D)throw i.name==="SyntaxError"?dn.from(i,dn.ERR_BAD_RESPONSE,this,null,this.response):i}}return l}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:fs.classes.FormData,Blob:fs.classes.Blob},validateStatus:function(l){return l>=200&&l<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};It.forEach(["delete","get","head","post","put","patch"],n=>{Lm.headers[n]={}});const j6=It.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),$6=n=>{const l={};let p,v,A;return n&&n.split(`
`).forEach(function(D){A=D.indexOf(":"),p=D.substring(0,A).trim().toLowerCase(),v=D.substring(A+1).trim(),!(!p||l[p]&&j6[p])&&(p==="set-cookie"?l[p]?l[p].push(v):l[p]=[v]:l[p]=l[p]?l[p]+", "+v:v)}),l},IE=Symbol("internals");function Zp(n){return n&&String(n).trim().toLowerCase()}function qg(n){return n===!1||n==null?n:It.isArray(n)?n.map(qg):String(n)}function G6(n){const l=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let v;for(;v=p.exec(n);)l[v[1]]=v[2];return l}const H6=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function vx(n,l,p,v,A){if(It.isFunction(v))return v.call(this,l,p);if(A&&(l=p),!!It.isString(l)){if(It.isString(v))return l.indexOf(v)!==-1;if(It.isRegExp(v))return v.test(l)}}function q6(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(l,p,v)=>p.toUpperCase()+v)}function W6(n,l){const p=It.toCamelCase(" "+l);["get","set","has"].forEach(v=>{Object.defineProperty(n,v+p,{value:function(A,R,D){return this[v].call(this,l,A,R,D)},configurable:!0})})}let Ks=class{constructor(l){l&&this.set(l)}set(l,p,v){const A=this;function R(i,G,W){const H=Zp(G);if(!H)throw new Error("header name must be a non-empty string");const ee=It.findKey(A,H);(!ee||A[ee]===void 0||W===!0||W===void 0&&A[ee]!==!1)&&(A[ee||G]=qg(i))}const D=(i,G)=>It.forEach(i,(W,H)=>R(W,H,G));if(It.isPlainObject(l)||l instanceof this.constructor)D(l,p);else if(It.isString(l)&&(l=l.trim())&&!H6(l))D($6(l),p);else if(It.isHeaders(l))for(const[i,G]of l.entries())R(G,i,v);else l!=null&&R(p,l,v);return this}get(l,p){if(l=Zp(l),l){const v=It.findKey(this,l);if(v){const A=this[v];if(!p)return A;if(p===!0)return G6(A);if(It.isFunction(p))return p.call(this,A,v);if(It.isRegExp(p))return p.exec(A);throw new TypeError("parser must be boolean|regexp|function")}}}has(l,p){if(l=Zp(l),l){const v=It.findKey(this,l);return!!(v&&this[v]!==void 0&&(!p||vx(this,this[v],v,p)))}return!1}delete(l,p){const v=this;let A=!1;function R(D){if(D=Zp(D),D){const i=It.findKey(v,D);i&&(!p||vx(v,v[i],i,p))&&(delete v[i],A=!0)}}return It.isArray(l)?l.forEach(R):R(l),A}clear(l){const p=Object.keys(this);let v=p.length,A=!1;for(;v--;){const R=p[v];(!l||vx(this,this[R],R,l,!0))&&(delete this[R],A=!0)}return A}normalize(l){const p=this,v={};return It.forEach(this,(A,R)=>{const D=It.findKey(v,R);if(D){p[D]=qg(A),delete p[R];return}const i=l?q6(R):String(R).trim();i!==R&&delete p[R],p[i]=qg(A),v[i]=!0}),this}concat(...l){return this.constructor.concat(this,...l)}toJSON(l){const p=Object.create(null);return It.forEach(this,(v,A)=>{v!=null&&v!==!1&&(p[A]=l&&It.isArray(v)?v.join(", "):v)}),p}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([l,p])=>l+": "+p).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(l){return l instanceof this?l:new this(l)}static concat(l,...p){const v=new this(l);return p.forEach(A=>v.set(A)),v}static accessor(l){const v=(this[IE]=this[IE]={accessors:{}}).accessors,A=this.prototype;function R(D){const i=Zp(D);v[i]||(W6(A,D),v[i]=!0)}return It.isArray(l)?l.forEach(R):R(l),this}};Ks.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);It.reduceDescriptors(Ks.prototype,({value:n},l)=>{let p=l[0].toUpperCase()+l.slice(1);return{get:()=>n,set(v){this[p]=v}}});It.freezeMethods(Ks);function xx(n,l){const p=this||Lm,v=l||p,A=Ks.from(v.headers);let R=v.data;return It.forEach(n,function(i){R=i.call(p,R,A.normalize(),l?l.status:void 0)}),A.normalize(),R}function b3(n){return!!(n&&n.__CANCEL__)}function Ud(n,l,p){dn.call(this,n??"canceled",dn.ERR_CANCELED,l,p),this.name="CanceledError"}It.inherits(Ud,dn,{__CANCEL__:!0});function w3(n,l,p){const v=p.config.validateStatus;!p.status||!v||v(p.status)?n(p):l(new dn("Request failed with status code "+p.status,[dn.ERR_BAD_REQUEST,dn.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p))}function Z6(n){const l=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return l&&l[1]||""}function X6(n,l){n=n||10;const p=new Array(n),v=new Array(n);let A=0,R=0,D;return l=l!==void 0?l:1e3,function(G){const W=Date.now(),H=v[R];D||(D=W),p[A]=G,v[A]=W;let ee=R,ne=0;for(;ee!==A;)ne+=p[ee++],ee=ee%n;if(A=(A+1)%n,A===R&&(R=(R+1)%n),W-D<l)return;const de=H&&W-H;return de?Math.round(ne*1e3/de):void 0}}function K6(n,l){let p=0,v=1e3/l,A,R;const D=(W,H=Date.now())=>{p=H,A=null,R&&(clearTimeout(R),R=null),n.apply(null,W)};return[(...W)=>{const H=Date.now(),ee=H-p;ee>=v?D(W,H):(A=W,R||(R=setTimeout(()=>{R=null,D(A)},v-ee)))},()=>A&&D(A)]}const ly=(n,l,p=3)=>{let v=0;const A=X6(50,250);return K6(R=>{const D=R.loaded,i=R.lengthComputable?R.total:void 0,G=D-v,W=A(G),H=D<=i;v=D;const ee={loaded:D,total:i,progress:i?D/i:void 0,bytes:G,rate:W||void 0,estimated:W&&i&&H?(i-D)/W:void 0,event:R,lengthComputable:i!=null,[l?"download":"upload"]:!0};n(ee)},p)},CE=(n,l)=>{const p=n!=null;return[v=>l[0]({lengthComputable:p,total:n,loaded:v}),l[1]]},PE=n=>(...l)=>It.asap(()=>n(...l)),Y6=fs.hasStandardBrowserEnv?((n,l)=>p=>(p=new URL(p,fs.origin),n.protocol===p.protocol&&n.host===p.host&&(l||n.port===p.port)))(new URL(fs.origin),fs.navigator&&/(msie|trident)/i.test(fs.navigator.userAgent)):()=>!0,J6=fs.hasStandardBrowserEnv?{write(n,l,p,v,A,R){const D=[n+"="+encodeURIComponent(l)];It.isNumber(p)&&D.push("expires="+new Date(p).toGMTString()),It.isString(v)&&D.push("path="+v),It.isString(A)&&D.push("domain="+A),R===!0&&D.push("secure"),document.cookie=D.join("; ")},read(n){const l=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return l?decodeURIComponent(l[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Q6(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function eN(n,l){return l?n.replace(/\/?\/$/,"")+"/"+l.replace(/^\/+/,""):n}function T3(n,l,p){let v=!Q6(l);return n&&(v||p==!1)?eN(n,l):l}const RE=n=>n instanceof Ks?{...n}:n;function Nu(n,l){l=l||{};const p={};function v(W,H,ee,ne){return It.isPlainObject(W)&&It.isPlainObject(H)?It.merge.call({caseless:ne},W,H):It.isPlainObject(H)?It.merge({},H):It.isArray(H)?H.slice():H}function A(W,H,ee,ne){if(It.isUndefined(H)){if(!It.isUndefined(W))return v(void 0,W,ee,ne)}else return v(W,H,ee,ne)}function R(W,H){if(!It.isUndefined(H))return v(void 0,H)}function D(W,H){if(It.isUndefined(H)){if(!It.isUndefined(W))return v(void 0,W)}else return v(void 0,H)}function i(W,H,ee){if(ee in l)return v(W,H);if(ee in n)return v(void 0,W)}const G={url:R,method:R,data:R,baseURL:D,transformRequest:D,transformResponse:D,paramsSerializer:D,timeout:D,timeoutMessage:D,withCredentials:D,withXSRFToken:D,adapter:D,responseType:D,xsrfCookieName:D,xsrfHeaderName:D,onUploadProgress:D,onDownloadProgress:D,decompress:D,maxContentLength:D,maxBodyLength:D,beforeRedirect:D,transport:D,httpAgent:D,httpsAgent:D,cancelToken:D,socketPath:D,responseEncoding:D,validateStatus:i,headers:(W,H,ee)=>A(RE(W),RE(H),ee,!0)};return It.forEach(Object.keys(Object.assign({},n,l)),function(H){const ee=G[H]||A,ne=ee(n[H],l[H],H);It.isUndefined(ne)&&ee!==i||(p[H]=ne)}),p}const S3=n=>{const l=Nu({},n);let{data:p,withXSRFToken:v,xsrfHeaderName:A,xsrfCookieName:R,headers:D,auth:i}=l;l.headers=D=Ks.from(D),l.url=y3(T3(l.baseURL,l.url,l.allowAbsoluteUrls),n.params,n.paramsSerializer),i&&D.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):"")));let G;if(It.isFormData(p)){if(fs.hasStandardBrowserEnv||fs.hasStandardBrowserWebWorkerEnv)D.setContentType(void 0);else if((G=D.getContentType())!==!1){const[W,...H]=G?G.split(";").map(ee=>ee.trim()).filter(Boolean):[];D.setContentType([W||"multipart/form-data",...H].join("; "))}}if(fs.hasStandardBrowserEnv&&(v&&It.isFunction(v)&&(v=v(l)),v||v!==!1&&Y6(l.url))){const W=A&&R&&J6.read(R);W&&D.set(A,W)}return l},tN=typeof XMLHttpRequest<"u",rN=tN&&function(n){return new Promise(function(p,v){const A=S3(n);let R=A.data;const D=Ks.from(A.headers).normalize();let{responseType:i,onUploadProgress:G,onDownloadProgress:W}=A,H,ee,ne,de,he;function ye(){de&&de(),he&&he(),A.cancelToken&&A.cancelToken.unsubscribe(H),A.signal&&A.signal.removeEventListener("abort",H)}let Le=new XMLHttpRequest;Le.open(A.method.toUpperCase(),A.url,!0),Le.timeout=A.timeout;function je(){if(!Le)return;const Dt=Ks.from("getAllResponseHeaders"in Le&&Le.getAllResponseHeaders()),ht={data:!i||i==="text"||i==="json"?Le.responseText:Le.response,status:Le.status,statusText:Le.statusText,headers:Dt,config:n,request:Le};w3(function(tt){p(tt),ye()},function(tt){v(tt),ye()},ht),Le=null}"onloadend"in Le?Le.onloadend=je:Le.onreadystatechange=function(){!Le||Le.readyState!==4||Le.status===0&&!(Le.responseURL&&Le.responseURL.indexOf("file:")===0)||setTimeout(je)},Le.onabort=function(){Le&&(v(new dn("Request aborted",dn.ECONNABORTED,n,Le)),Le=null)},Le.onerror=function(){v(new dn("Network Error",dn.ERR_NETWORK,n,Le)),Le=null},Le.ontimeout=function(){let ut=A.timeout?"timeout of "+A.timeout+"ms exceeded":"timeout exceeded";const ht=A.transitional||v3;A.timeoutErrorMessage&&(ut=A.timeoutErrorMessage),v(new dn(ut,ht.clarifyTimeoutError?dn.ETIMEDOUT:dn.ECONNABORTED,n,Le)),Le=null},R===void 0&&D.setContentType(null),"setRequestHeader"in Le&&It.forEach(D.toJSON(),function(ut,ht){Le.setRequestHeader(ht,ut)}),It.isUndefined(A.withCredentials)||(Le.withCredentials=!!A.withCredentials),i&&i!=="json"&&(Le.responseType=A.responseType),W&&([ne,he]=ly(W,!0),Le.addEventListener("progress",ne)),G&&Le.upload&&([ee,de]=ly(G),Le.upload.addEventListener("progress",ee),Le.upload.addEventListener("loadend",de)),(A.cancelToken||A.signal)&&(H=Dt=>{Le&&(v(!Dt||Dt.type?new Ud(null,n,Le):Dt),Le.abort(),Le=null)},A.cancelToken&&A.cancelToken.subscribe(H),A.signal&&(A.signal.aborted?H():A.signal.addEventListener("abort",H)));const xt=Z6(A.url);if(xt&&fs.protocols.indexOf(xt)===-1){v(new dn("Unsupported protocol "+xt+":",dn.ERR_BAD_REQUEST,n));return}Le.send(R||null)})},nN=(n,l)=>{const{length:p}=n=n?n.filter(Boolean):[];if(l||p){let v=new AbortController,A;const R=function(W){if(!A){A=!0,i();const H=W instanceof Error?W:this.reason;v.abort(H instanceof dn?H:new Ud(H instanceof Error?H.message:H))}};let D=l&&setTimeout(()=>{D=null,R(new dn(`timeout ${l} of ms exceeded`,dn.ETIMEDOUT))},l);const i=()=>{n&&(D&&clearTimeout(D),D=null,n.forEach(W=>{W.unsubscribe?W.unsubscribe(R):W.removeEventListener("abort",R)}),n=null)};n.forEach(W=>W.addEventListener("abort",R));const{signal:G}=v;return G.unsubscribe=()=>It.asap(i),G}},iN=function*(n,l){let p=n.byteLength;if(p<l){yield n;return}let v=0,A;for(;v<p;)A=v+l,yield n.slice(v,A),v=A},sN=async function*(n,l){for await(const p of oN(n))yield*iN(p,l)},oN=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const l=n.getReader();try{for(;;){const{done:p,value:v}=await l.read();if(p)break;yield v}}finally{await l.cancel()}},DE=(n,l,p,v)=>{const A=sN(n,l);let R=0,D,i=G=>{D||(D=!0,v&&v(G))};return new ReadableStream({async pull(G){try{const{done:W,value:H}=await A.next();if(W){i(),G.close();return}let ee=H.byteLength;if(p){let ne=R+=ee;p(ne)}G.enqueue(new Uint8Array(H))}catch(W){throw i(W),W}},cancel(G){return i(G),A.return()}},{highWaterMark:2})},Uy=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",E3=Uy&&typeof ReadableStream=="function",aN=Uy&&(typeof TextEncoder=="function"?(n=>l=>n.encode(l))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),A3=(n,...l)=>{try{return!!n(...l)}catch{return!1}},lN=E3&&A3(()=>{let n=!1;const l=new Request(fs.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!l}),zE=64*1024,Zx=E3&&A3(()=>It.isReadableStream(new Response("").body)),cy={stream:Zx&&(n=>n.body)};Uy&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(l=>{!cy[l]&&(cy[l]=It.isFunction(n[l])?p=>p[l]():(p,v)=>{throw new dn(`Response type '${l}' is not supported`,dn.ERR_NOT_SUPPORT,v)})})})(new Response);const cN=async n=>{if(n==null)return 0;if(It.isBlob(n))return n.size;if(It.isSpecCompliantForm(n))return(await new Request(fs.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(It.isArrayBufferView(n)||It.isArrayBuffer(n))return n.byteLength;if(It.isURLSearchParams(n)&&(n=n+""),It.isString(n))return(await aN(n)).byteLength},uN=async(n,l)=>{const p=It.toFiniteNumber(n.getContentLength());return p??cN(l)},hN=Uy&&(async n=>{let{url:l,method:p,data:v,signal:A,cancelToken:R,timeout:D,onDownloadProgress:i,onUploadProgress:G,responseType:W,headers:H,withCredentials:ee="same-origin",fetchOptions:ne}=S3(n);W=W?(W+"").toLowerCase():"text";let de=nN([A,R&&R.toAbortSignal()],D),he;const ye=de&&de.unsubscribe&&(()=>{de.unsubscribe()});let Le;try{if(G&&lN&&p!=="get"&&p!=="head"&&(Le=await uN(H,v))!==0){let ht=new Request(l,{method:"POST",body:v,duplex:"half"}),Et;if(It.isFormData(v)&&(Et=ht.headers.get("content-type"))&&H.setContentType(Et),ht.body){const[tt,At]=CE(Le,ly(PE(G)));v=DE(ht.body,zE,tt,At)}}It.isString(ee)||(ee=ee?"include":"omit");const je="credentials"in Request.prototype;he=new Request(l,{...ne,signal:de,method:p.toUpperCase(),headers:H.normalize().toJSON(),body:v,duplex:"half",credentials:je?ee:void 0});let xt=await fetch(he);const Dt=Zx&&(W==="stream"||W==="response");if(Zx&&(i||Dt&&ye)){const ht={};["status","statusText","headers"].forEach(pt=>{ht[pt]=xt[pt]});const Et=It.toFiniteNumber(xt.headers.get("content-length")),[tt,At]=i&&CE(Et,ly(PE(i),!0))||[];xt=new Response(DE(xt.body,zE,tt,()=>{At&&At(),ye&&ye()}),ht)}W=W||"text";let ut=await cy[It.findKey(cy,W)||"text"](xt,n);return!Dt&&ye&&ye(),await new Promise((ht,Et)=>{w3(ht,Et,{data:ut,headers:Ks.from(xt.headers),status:xt.status,statusText:xt.statusText,config:n,request:he})})}catch(je){throw ye&&ye(),je&&je.name==="TypeError"&&/fetch/i.test(je.message)?Object.assign(new dn("Network Error",dn.ERR_NETWORK,n,he),{cause:je.cause||je}):dn.from(je,je&&je.code,n,he)}}),Xx={http:A6,xhr:rN,fetch:hN};It.forEach(Xx,(n,l)=>{if(n){try{Object.defineProperty(n,"name",{value:l})}catch{}Object.defineProperty(n,"adapterName",{value:l})}});const LE=n=>`- ${n}`,dN=n=>It.isFunction(n)||n===null||n===!1,M3={getAdapter:n=>{n=It.isArray(n)?n:[n];const{length:l}=n;let p,v;const A={};for(let R=0;R<l;R++){p=n[R];let D;if(v=p,!dN(p)&&(v=Xx[(D=String(p)).toLowerCase()],v===void 0))throw new dn(`Unknown adapter '${D}'`);if(v)break;A[D||"#"+R]=v}if(!v){const R=Object.entries(A).map(([i,G])=>`adapter ${i} `+(G===!1?"is not supported by the environment":"is not available in the build"));let D=l?R.length>1?`since :
`+R.map(LE).join(`
`):" "+LE(R[0]):"as no adapter specified";throw new dn("There is no suitable adapter to dispatch the request "+D,"ERR_NOT_SUPPORT")}return v},adapters:Xx};function bx(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Ud(null,n)}function OE(n){return bx(n),n.headers=Ks.from(n.headers),n.data=xx.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),M3.getAdapter(n.adapter||Lm.adapter)(n).then(function(v){return bx(n),v.data=xx.call(n,n.transformResponse,v),v.headers=Ks.from(v.headers),v},function(v){return b3(v)||(bx(n),v&&v.response&&(v.response.data=xx.call(n,n.transformResponse,v.response),v.response.headers=Ks.from(v.response.headers))),Promise.reject(v)})}const I3="1.8.4",jy={};["object","boolean","number","function","string","symbol"].forEach((n,l)=>{jy[n]=function(v){return typeof v===n||"a"+(l<1?"n ":" ")+n}});const kE={};jy.transitional=function(l,p,v){function A(R,D){return"[Axios v"+I3+"] Transitional option '"+R+"'"+D+(v?". "+v:"")}return(R,D,i)=>{if(l===!1)throw new dn(A(D," has been removed"+(p?" in "+p:"")),dn.ERR_DEPRECATED);return p&&!kE[D]&&(kE[D]=!0,console.warn(A(D," has been deprecated since v"+p+" and will be removed in the near future"))),l?l(R,D,i):!0}};jy.spelling=function(l){return(p,v)=>(console.warn(`${v} is likely a misspelling of ${l}`),!0)};function fN(n,l,p){if(typeof n!="object")throw new dn("options must be an object",dn.ERR_BAD_OPTION_VALUE);const v=Object.keys(n);let A=v.length;for(;A-- >0;){const R=v[A],D=l[R];if(D){const i=n[R],G=i===void 0||D(i,R,n);if(G!==!0)throw new dn("option "+R+" must be "+G,dn.ERR_BAD_OPTION_VALUE);continue}if(p!==!0)throw new dn("Unknown option "+R,dn.ERR_BAD_OPTION)}}const Wg={assertOptions:fN,validators:jy},Oa=Wg.validators;let zu=class{constructor(l){this.defaults=l,this.interceptors={request:new ME,response:new ME}}async request(l,p){try{return await this._request(l,p)}catch(v){if(v instanceof Error){let A={};Error.captureStackTrace?Error.captureStackTrace(A):A=new Error;const R=A.stack?A.stack.replace(/^.+\n/,""):"";try{v.stack?R&&!String(v.stack).endsWith(R.replace(/^.+\n.+\n/,""))&&(v.stack+=`
`+R):v.stack=R}catch{}}throw v}}_request(l,p){typeof l=="string"?(p=p||{},p.url=l):p=l||{},p=Nu(this.defaults,p);const{transitional:v,paramsSerializer:A,headers:R}=p;v!==void 0&&Wg.assertOptions(v,{silentJSONParsing:Oa.transitional(Oa.boolean),forcedJSONParsing:Oa.transitional(Oa.boolean),clarifyTimeoutError:Oa.transitional(Oa.boolean)},!1),A!=null&&(It.isFunction(A)?p.paramsSerializer={serialize:A}:Wg.assertOptions(A,{encode:Oa.function,serialize:Oa.function},!0)),p.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?p.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:p.allowAbsoluteUrls=!0),Wg.assertOptions(p,{baseUrl:Oa.spelling("baseURL"),withXsrfToken:Oa.spelling("withXSRFToken")},!0),p.method=(p.method||this.defaults.method||"get").toLowerCase();let D=R&&It.merge(R.common,R[p.method]);R&&It.forEach(["delete","get","head","post","put","patch","common"],he=>{delete R[he]}),p.headers=Ks.concat(D,R);const i=[];let G=!0;this.interceptors.request.forEach(function(ye){typeof ye.runWhen=="function"&&ye.runWhen(p)===!1||(G=G&&ye.synchronous,i.unshift(ye.fulfilled,ye.rejected))});const W=[];this.interceptors.response.forEach(function(ye){W.push(ye.fulfilled,ye.rejected)});let H,ee=0,ne;if(!G){const he=[OE.bind(this),void 0];for(he.unshift.apply(he,i),he.push.apply(he,W),ne=he.length,H=Promise.resolve(p);ee<ne;)H=H.then(he[ee++],he[ee++]);return H}ne=i.length;let de=p;for(ee=0;ee<ne;){const he=i[ee++],ye=i[ee++];try{de=he(de)}catch(Le){ye.call(this,Le);break}}try{H=OE.call(this,de)}catch(he){return Promise.reject(he)}for(ee=0,ne=W.length;ee<ne;)H=H.then(W[ee++],W[ee++]);return H}getUri(l){l=Nu(this.defaults,l);const p=T3(l.baseURL,l.url,l.allowAbsoluteUrls);return y3(p,l.params,l.paramsSerializer)}};It.forEach(["delete","get","head","options"],function(l){zu.prototype[l]=function(p,v){return this.request(Nu(v||{},{method:l,url:p,data:(v||{}).data}))}});It.forEach(["post","put","patch"],function(l){function p(v){return function(R,D,i){return this.request(Nu(i||{},{method:l,headers:v?{"Content-Type":"multipart/form-data"}:{},url:R,data:D}))}}zu.prototype[l]=p(),zu.prototype[l+"Form"]=p(!0)});let pN=class C3{constructor(l){if(typeof l!="function")throw new TypeError("executor must be a function.");let p;this.promise=new Promise(function(R){p=R});const v=this;this.promise.then(A=>{if(!v._listeners)return;let R=v._listeners.length;for(;R-- >0;)v._listeners[R](A);v._listeners=null}),this.promise.then=A=>{let R;const D=new Promise(i=>{v.subscribe(i),R=i}).then(A);return D.cancel=function(){v.unsubscribe(R)},D},l(function(R,D,i){v.reason||(v.reason=new Ud(R,D,i),p(v.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(l){if(this.reason){l(this.reason);return}this._listeners?this._listeners.push(l):this._listeners=[l]}unsubscribe(l){if(!this._listeners)return;const p=this._listeners.indexOf(l);p!==-1&&this._listeners.splice(p,1)}toAbortSignal(){const l=new AbortController,p=v=>{l.abort(v)};return this.subscribe(p),l.signal.unsubscribe=()=>this.unsubscribe(p),l.signal}static source(){let l;return{token:new C3(function(A){l=A}),cancel:l}}};function mN(n){return function(p){return n.apply(null,p)}}function _N(n){return It.isObject(n)&&n.isAxiosError===!0}const Kx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Kx).forEach(([n,l])=>{Kx[l]=n});function P3(n){const l=new zu(n),p=a3(zu.prototype.request,l);return It.extend(p,zu.prototype,l,{allOwnKeys:!0}),It.extend(p,l,null,{allOwnKeys:!0}),p.create=function(A){return P3(Nu(n,A))},p}const Ci=P3(Lm);Ci.Axios=zu;Ci.CanceledError=Ud;Ci.CancelToken=pN;Ci.isCancel=b3;Ci.VERSION=I3;Ci.toFormData=Vy;Ci.AxiosError=dn;Ci.Cancel=Ci.CanceledError;Ci.all=function(l){return Promise.all(l)};Ci.spread=mN;Ci.isAxiosError=_N;Ci.mergeConfig=Nu;Ci.AxiosHeaders=Ks;Ci.formToJSON=n=>x3(It.isHTMLForm(n)?new FormData(n):n);Ci.getAdapter=M3.getAdapter;Ci.HttpStatusCode=Kx;Ci.default=Ci;const{Axios:qj,AxiosError:Wj,CanceledError:Zj,isCancel:Xj,CancelToken:Kj,VERSION:Yj,all:Jj,Cancel:Qj,isAxiosError:e$,spread:t$,toFormData:r$,AxiosHeaders:n$,HttpStatusCode:i$,formToJSON:s$,getAdapter:o$,mergeConfig:a$}=Ci,gN=iI("GameMap",{state:()=>({isinit:!1,marks:[],unshowMarks:[],pointsIds:[],showName:!1,loading:!0,showAddMarker:!1,editPointData:{mark_name:"",mark_type:"points",mark_position:[0,0]}}),getters:{fillterMarks(n){return n.marks.filter(l=>!n.unshowMarks.includes(l.id))}},actions:{async getMarksData(){const{data:n}=await Ci.get("/data/points.json");return this.marks=n,this.marks}}}),ms=typeof window<"u",K1=ms&&"IntersectionObserver"in window,yN=ms&&("ontouchstart"in window||window.navigator.maxTouchPoints>0);function FE(n,l,p){vN(n,l),l.set(n,p)}function vN(n,l){if(l.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function xN(n,l,p){return n.set(R3(n,l),p),p}function Tu(n,l){return n.get(R3(n,l))}function R3(n,l,p){if(typeof n=="function"?n===l:n.has(l))return arguments.length<3?l:p;throw new TypeError("Private element is not present on this object")}function bN(n,l,p){const v=l.length-1;if(v<0)return n===void 0?p:n;for(let A=0;A<v;A++){if(n==null)return p;n=n[l[A]]}return n==null||n[l[v]]===void 0?p:n[l[v]]}function $y(n,l){if(n===l)return!0;if(n instanceof Date&&l instanceof Date&&n.getTime()!==l.getTime()||n!==Object(n)||l!==Object(l))return!1;const p=Object.keys(n);return p.length!==Object.keys(l).length?!1:p.every(v=>$y(n[v],l[v]))}function BE(n,l,p){return n==null||!l||typeof l!="string"?p:n[l]!==void 0?n[l]:(l=l.replace(/\[(\w+)\]/g,".$1"),l=l.replace(/^\./,""),bN(n,l.split("."),p))}function D3(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Array.from({length:n},(p,v)=>l+v)}function oi(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"px";if(n==null||n==="")return;const p=Number(n);return isNaN(p)?String(n):isFinite(p)?`${p}${l}`:void 0}function wN(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function NE(n){let l;return n!==null&&typeof n=="object"&&((l=Object.getPrototypeOf(n))===Object.prototype||l===null)}function z3(n){if(n&&"$el"in n){const l=n.$el;return(l==null?void 0:l.nodeType)===Node.TEXT_NODE?l.nextElementSibling:l}return n}const VE=Object.freeze({enter:13,tab:9,delete:46,esc:27,space:32,up:38,down:40,left:37,right:39,end:35,home:36,del:46,backspace:8,insert:45,pageup:33,pagedown:34,shift:16});function wx(n,l){return l.every(p=>n.hasOwnProperty(p))}function TN(n,l){const p={};for(const v of l)Object.hasOwn(n,v)&&(p[v]=n[v]);return p}function SN(n){return n==null?[]:Array.isArray(n)?n:[n]}function uy(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.max(l,Math.min(p,n))}function UE(n,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0";return n+p.repeat(Math.max(0,l-n.length))}function jE(n,l){return(arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0").repeat(Math.max(0,l-n.length))+n}function EN(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const p=[];let v=0;for(;v<n.length;)p.push(n.substr(v,l)),v+=l;return p}function _s(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const v={};for(const A in n)v[A]=n[A];for(const A in l){const R=n[A],D=l[A];if(NE(R)&&NE(D)){v[A]=_s(R,D,p);continue}if(p&&Array.isArray(R)&&Array.isArray(D)){v[A]=p(R,D);continue}v[A]=D}return v}function L3(n){return n.map(l=>l.type===ti?L3(l.children):l).flat()}function Lu(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";if(Lu.cache.has(n))return Lu.cache.get(n);const l=n.replace(/[^a-z]/gi,"-").replace(/\B([A-Z])/g,"-$1").toLowerCase();return Lu.cache.set(n,l),l}Lu.cache=new Map;function xd(n,l){if(!l||typeof l!="object")return[];if(Array.isArray(l))return l.map(p=>xd(n,p)).flat(1);if(l.suspense)return xd(n,l.ssContent);if(Array.isArray(l.children))return l.children.map(p=>xd(n,p)).flat(1);if(l.component){if(Object.getOwnPropertySymbols(l.component.provides).includes(n))return[l.component];if(l.component.subTree)return xd(n,l.component.subTree).flat(1)}return[]}var Dg=new WeakMap,pd=new WeakMap;class AN{constructor(l){FE(this,Dg,[]),FE(this,pd,0),this.size=l}push(l){Tu(Dg,this)[Tu(pd,this)]=l,xN(pd,this,(Tu(pd,this)+1)%this.size)}values(){return Tu(Dg,this).slice(Tu(pd,this)).concat(Tu(Dg,this).slice(0,Tu(pd,this)))}}function O3(n){const l=Zi({}),p=it(n);return kd(()=>{for(const v in p.value)l[v]=p.value[v]},{flush:"sync"}),Ty(l)}function Yx(n,l){return n.includes(l)}const $E=()=>[Function,Array];function GE(n,l){return l="on"+Ec(l),!!(n[l]||n[`${l}Once`]||n[`${l}Capture`]||n[`${l}OnceCapture`]||n[`${l}CaptureOnce`])}function MN(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const p=["button","[href]",'input:not([type="hidden"])',"select","textarea","[tabindex]"].map(v=>`${v}${l?':not([tabindex="-1"])':""}:not([disabled])`).join(", ");return[...n.querySelectorAll(p)]}function IN(n,l){if(!ms||n===0)return l(),()=>{};const p=window.setTimeout(l,n);return()=>window.clearTimeout(p)}function CN(){const n=Nn(),l=p=>{n.value=p};return Object.defineProperty(l,"value",{enumerable:!0,get:()=>n.value,set:p=>n.value=p}),Object.defineProperty(l,"el",{enumerable:!0,get:()=>z3(n.value)}),l}function Ns(n,l){const p=Bs();if(!p)throw new Error(`[Vuetify] ${n} must be called from inside a setup function`);return p}function Ic(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"composables";const l=Ns(n).type;return Lu((l==null?void 0:l.aliasName)||(l==null?void 0:l.name))}let k3=0,Zg=new WeakMap;function Gy(){const n=Ns("getUid");if(Zg.has(n))return Zg.get(n);{const l=k3++;return Zg.set(n,l),l}}Gy.reset=()=>{k3=0,Zg=new WeakMap};function PN(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ns("injectSelf");const{provides:p}=l;if(p&&n in p)return p[n]}const Ld=Symbol.for("vuetify:defaults");function RN(n){return hn(n)}function Y1(){const n=Mn(Ld);if(!n)throw new Error("[Vuetify] Could not find defaults instance");return n}function Hy(n,l){const p=Y1(),v=hn(n),A=it(()=>{if(vt(l==null?void 0:l.disabled))return p.value;const D=vt(l==null?void 0:l.scoped),i=vt(l==null?void 0:l.reset),G=vt(l==null?void 0:l.root);if(v.value==null&&!(D||i||G))return p.value;let W=_s(v.value,{prev:p.value});if(D)return W;if(i||G){const H=Number(i||1/0);for(let ee=0;ee<=H&&!(!W||!("prev"in W));ee++)W=W.prev;return W&&typeof G=="string"&&G in W&&(W=_s(_s(W,{prev:W}),W[G])),W}return W.prev?_s(W.prev,W):W});return go(Ld,A),A}function DN(n,l){var p,v;return typeof((p=n.props)==null?void 0:p[l])<"u"||typeof((v=n.props)==null?void 0:v[Lu(l)])<"u"}function zN(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=arguments.length>1?arguments[1]:void 0,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Y1();const v=Ns("useDefaults");if(l=l??v.type.name??v.type.__name,!l)throw new Error("[Vuetify] Could not determine component name");const A=it(()=>{var G;return(G=p.value)==null?void 0:G[n._as??l]}),R=new Proxy(n,{get(G,W){var ee,ne,de,he,ye,Le,je;const H=Reflect.get(G,W);return W==="class"||W==="style"?[(ee=A.value)==null?void 0:ee[W],H].filter(xt=>xt!=null):typeof W=="string"&&!DN(v.vnode,W)?((ne=A.value)==null?void 0:ne[W])!==void 0?(de=A.value)==null?void 0:de[W]:((ye=(he=p.value)==null?void 0:he.global)==null?void 0:ye[W])!==void 0?(je=(Le=p.value)==null?void 0:Le.global)==null?void 0:je[W]:H:H}}),D=Nn();kd(()=>{if(A.value){const G=Object.entries(A.value).filter(W=>{let[H]=W;return H.startsWith(H[0].toUpperCase())});D.value=G.length?Object.fromEntries(G):void 0}else D.value=void 0});function i(){const G=PN(Ld,v);go(Ld,it(()=>D.value?_s((G==null?void 0:G.value)??{},D.value):G==null?void 0:G.value))}return{props:R,provideSubDefaults:i}}const LN=["top","bottom"],ON=["start","end","left","right"];function kN(n,l){let[p,v]=n.split(" ");return v||(v=Yx(LN,p)?"start":Yx(ON,p)?"top":"center"),{side:Jx(p,l),align:Jx(v,l)}}function Jx(n,l){return n==="start"?l?"right":"left":n==="end"?l?"left":"right":n}const md=2.4,HE=.2126729,qE=.7151522,WE=.072175,FN=.55,BN=.58,NN=.57,VN=.62,zg=.03,ZE=1.45,UN=5e-4,jN=1.25,$N=1.25,GN=.078,XE=12.82051282051282,Lg=.06,HN=.001;function KE(n,l){const p=(n.r/255)**md,v=(n.g/255)**md,A=(n.b/255)**md,R=(l.r/255)**md,D=(l.g/255)**md,i=(l.b/255)**md;let G=p*HE+v*qE+A*WE,W=R*HE+D*qE+i*WE;if(G<=zg&&(G+=(zg-G)**ZE),W<=zg&&(W+=(zg-W)**ZE),Math.abs(W-G)<UN)return 0;let H;if(W>G){const ee=(W**FN-G**BN)*jN;H=ee<HN?0:ee<GN?ee-ee*XE*Lg:ee-Lg}else{const ee=(W**VN-G**NN)*$N;H=ee>-.001?0:ee>-.078?ee-ee*XE*Lg:ee+Lg}return H*100}const hy=.20689655172413793,qN=n=>n>hy**3?Math.cbrt(n):n/(3*hy**2)+4/29,WN=n=>n>hy?n**3:3*hy**2*(n-4/29);function F3(n){const l=qN,p=l(n[1]);return[116*p-16,500*(l(n[0]/.95047)-p),200*(p-l(n[2]/1.08883))]}function B3(n){const l=WN,p=(n[0]+16)/116;return[l(p+n[1]/500)*.95047,l(p),l(p-n[2]/200)*1.08883]}const ZN=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],XN=n=>n<=.0031308?n*12.92:1.055*n**(1/2.4)-.055,KN=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],YN=n=>n<=.04045?n/12.92:((n+.055)/1.055)**2.4;function N3(n){const l=Array(3),p=XN,v=ZN;for(let A=0;A<3;++A)l[A]=Math.round(uy(p(v[A][0]*n[0]+v[A][1]*n[1]+v[A][2]*n[2]))*255);return{r:l[0],g:l[1],b:l[2]}}function J1(n){let{r:l,g:p,b:v}=n;const A=[0,0,0],R=YN,D=KN;l=R(l/255),p=R(p/255),v=R(v/255);for(let i=0;i<3;++i)A[i]=D[i][0]*l+D[i][1]*p+D[i][2]*v;return A}function Qx(n){return!!n&&/^(#|var\(--|(rgb|hsl)a?\()/.test(n)}function JN(n){return Qx(n)&&!/^((rgb|hsl)a?\()?var\(--/.test(n)}const YE=/^(?<fn>(?:rgb|hsl)a?)\((?<values>.+)\)/,QN={rgb:(n,l,p,v)=>({r:n,g:l,b:p,a:v}),rgba:(n,l,p,v)=>({r:n,g:l,b:p,a:v}),hsl:(n,l,p,v)=>JE({h:n,s:l,l:p,a:v}),hsla:(n,l,p,v)=>JE({h:n,s:l,l:p,a:v}),hsv:(n,l,p,v)=>bm({h:n,s:l,v:p,a:v}),hsva:(n,l,p,v)=>bm({h:n,s:l,v:p,a:v})};function Na(n){if(typeof n=="number")return{r:(n&16711680)>>16,g:(n&65280)>>8,b:n&255};if(typeof n=="string"&&YE.test(n)){const{groups:l}=n.match(YE),{fn:p,values:v}=l,A=v.split(/,\s*/).map(R=>R.endsWith("%")&&["hsl","hsla","hsv","hsva"].includes(p)?parseFloat(R)/100:parseFloat(R));return QN[p](...A)}else if(typeof n=="string"){let l=n.startsWith("#")?n.slice(1):n;return[3,4].includes(l.length)?l=l.split("").map(p=>p+p).join(""):[6,8].includes(l.length),tV(l)}else if(typeof n=="object"){if(wx(n,["r","g","b"]))return n;if(wx(n,["h","s","l"]))return bm(V3(n));if(wx(n,["h","s","v"]))return bm(n)}throw new TypeError(`Invalid color: ${n==null?n:String(n)||n.constructor.name}
Expected #hex, #hexa, rgb(), rgba(), hsl(), hsla(), object or number`)}function bm(n){const{h:l,s:p,v,a:A}=n,R=i=>{const G=(i+l/60)%6;return v-v*p*Math.max(Math.min(G,4-G,1),0)},D=[R(5),R(3),R(1)].map(i=>Math.round(i*255));return{r:D[0],g:D[1],b:D[2],a:A}}function JE(n){return bm(V3(n))}function V3(n){const{h:l,s:p,l:v,a:A}=n,R=v+p*Math.min(v,1-v),D=R===0?0:2-2*v/R;return{h:l,s:D,v:R,a:A}}function Og(n){const l=Math.round(n).toString(16);return("00".substr(0,2-l.length)+l).toUpperCase()}function eV(n){let{r:l,g:p,b:v,a:A}=n;return`#${[Og(l),Og(p),Og(v),A!==void 0?Og(Math.round(A*255)):""].join("")}`}function tV(n){n=rV(n);let[l,p,v,A]=EN(n,2).map(R=>parseInt(R,16));return A=A===void 0?A:A/255,{r:l,g:p,b:v,a:A}}function rV(n){return n.startsWith("#")&&(n=n.slice(1)),n=n.replace(/([^0-9a-f])/gi,"F"),(n.length===3||n.length===4)&&(n=n.split("").map(l=>l+l).join("")),n.length!==6&&(n=UE(UE(n,6),8,"F")),n}function nV(n,l){const p=F3(J1(n));return p[0]=p[0]+l*10,N3(B3(p))}function iV(n,l){const p=F3(J1(n));return p[0]=p[0]-l*10,N3(B3(p))}function sV(n){const l=Na(n);return J1(l)[1]}function U3(n){const l=Math.abs(KE(Na(0),Na(n)));return Math.abs(KE(Na(16777215),Na(n)))>Math.min(l,50)?"#fff":"#000"}function fn(n,l){return p=>Object.keys(n).reduce((v,A)=>{const D=typeof n[A]=="object"&&n[A]!=null&&!Array.isArray(n[A])?n[A]:{type:n[A]};return p&&A in p?v[A]={...D,default:p[A]}:v[A]=D,l&&!v[A].source&&(v[A].source=l),v},{})}const Hi=fn({class:[String,Array,Object],style:{type:[String,Array,Object],default:null}},"component");function Om(n){if(n._setup=n._setup??n.setup,!n.name)return n;if(n._setup){n.props=fn(n.props??{},n.name)();const l=Object.keys(n.props).filter(p=>p!=="class"&&p!=="style");n.filterProps=function(v){return TN(v,l)},n.props._as=String,n.setup=function(v,A){const R=Y1();if(!R.value)return n._setup(v,A);const{props:D,provideSubDefaults:i}=zN(v,v._as??n.name,R),G=n._setup(D,A);return i(),G}}return n}function yi(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return l=>(n?Om:_n)(l)}function oV(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"div",p=arguments.length>2?arguments[2]:void 0;return yi()({name:p??Ec(Fs(n.replace(/__/g,"-"))),props:{tag:{type:String,default:l},...Hi()},setup(v,A){let{slots:R}=A;return()=>{var D;return vl(v.tag,{class:[n,v.class],style:v.style},(D=R.default)==null?void 0:D.call(R))}}})}function gs(n){const l=Ns("useRender");l.render=n}const aV=fn({defaults:Object,disabled:Boolean,reset:[Number,String],root:[Boolean,String],scoped:Boolean},"VDefaultsProvider"),_l=yi(!1)({name:"VDefaultsProvider",props:aV(),setup(n,l){let{slots:p}=l;const{defaults:v,disabled:A,reset:R,root:D,scoped:i}=Ty(n);return Hy(v,{reset:R,root:D,scoped:i,disabled:A}),()=>{var G;return(G=p.default)==null?void 0:G.call(p)}}});function Q1(n){return O3(()=>{const l=[],p={};if(n.value.background)if(Qx(n.value.background)){if(p.backgroundColor=n.value.background,!n.value.text&&JN(n.value.background)){const v=Na(n.value.background);if(v.a==null||v.a===1){const A=U3(v);p.color=A,p.caretColor=A}}}else l.push(`bg-${n.value.background}`);return n.value.text&&(Qx(n.value.text)?(p.color=n.value.text,p.caretColor=n.value.text):l.push(`text-${n.value.text}`)),{colorClasses:l,colorStyles:p}})}function j3(n,l){const p=it(()=>({text:Yn(n)?n.value:l?n[l]:null})),{colorClasses:v,colorStyles:A}=Q1(p);return{textColorClasses:v,textColorStyles:A}}function Ad(n,l){const p=it(()=>({background:Yn(n)?n.value:l?n[l]:null})),{colorClasses:v,colorStyles:A}=Q1(p);return{backgroundColorClasses:v,backgroundColorStyles:A}}const lV={collapse:"mdi-chevron-up",complete:"mdi-check",cancel:"mdi-close-circle",close:"mdi-close",delete:"mdi-close-circle",clear:"mdi-close-circle",success:"mdi-check-circle",info:"mdi-information",warning:"mdi-alert-circle",error:"mdi-close-circle",prev:"mdi-chevron-left",next:"mdi-chevron-right",checkboxOn:"mdi-checkbox-marked",checkboxOff:"mdi-checkbox-blank-outline",checkboxIndeterminate:"mdi-minus-box",delimiter:"mdi-circle",sortAsc:"mdi-arrow-up",sortDesc:"mdi-arrow-down",expand:"mdi-chevron-down",menu:"mdi-menu",subgroup:"mdi-menu-down",dropdown:"mdi-menu-down",radioOn:"mdi-radiobox-marked",radioOff:"mdi-radiobox-blank",edit:"mdi-pencil",ratingEmpty:"mdi-star-outline",ratingFull:"mdi-star",ratingHalf:"mdi-star-half-full",loading:"mdi-cached",first:"mdi-page-first",last:"mdi-page-last",unfold:"mdi-unfold-more-horizontal",file:"mdi-paperclip",plus:"mdi-plus",minus:"mdi-minus",calendar:"mdi-calendar",treeviewCollapse:"mdi-menu-down",treeviewExpand:"mdi-menu-right",eyeDropper:"mdi-eyedropper",upload:"mdi-cloud-upload"},cV={component:n=>vl(G3,{...n,class:"mdi"})},mo=[String,Function,Object,Array],e1=Symbol.for("vuetify:icons"),qy=fn({icon:{type:mo},tag:{type:String,required:!0}},"icon"),QE=yi()({name:"VComponentIcon",props:qy(),setup(n,l){let{slots:p}=l;return()=>{const v=n.icon;return dt(n.tag,null,{default:()=>{var A;return[n.icon?dt(v,null,null):(A=p.default)==null?void 0:A.call(p)]}})}}}),$3=Om({name:"VSvgIcon",inheritAttrs:!1,props:qy(),setup(n,l){let{attrs:p}=l;return()=>dt(n.tag,Ys(p,{style:null}),{default:()=>[dt("svg",{class:"v-icon__svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true"},[Array.isArray(n.icon)?n.icon.map(v=>Array.isArray(v)?dt("path",{d:v[0],"fill-opacity":v[1]},null):dt("path",{d:v},null)):dt("path",{d:n.icon},null)])]})}});Om({name:"VLigatureIcon",props:qy(),setup(n){return()=>dt(n.tag,null,{default:()=>[n.icon]})}});const G3=Om({name:"VClassIcon",props:qy(),setup(n){return()=>dt(n.tag,{class:n.icon},null)}});function uV(){return{svg:{component:$3},class:{component:G3}}}function hV(n){const l=uV(),p=(n==null?void 0:n.defaultSet)??"mdi";return p==="mdi"&&!l.mdi&&(l.mdi=cV),_s({defaultSet:p,sets:l,aliases:{...lV,vuetify:["M8.2241 14.2009L12 21L22 3H14.4459L8.2241 14.2009Z",["M7.26303 12.4733L7.00113 12L2 3H12.5261C12.5261 3 12.5261 3 12.5261 3L7.26303 12.4733Z",.6]],"vuetify-outline":"svg:M7.26 12.47 12.53 3H2L7.26 12.47ZM14.45 3 8.22 14.2 12 21 22 3H14.45ZM18.6 5 12 16.88 10.51 14.2 15.62 5ZM7.26 8.35 5.4 5H9.13L7.26 8.35Z","vuetify-play":["m6.376 13.184-4.11-7.192C1.505 4.66 2.467 3 4.003 3h8.532l-.953 1.576-.006.01-.396.677c-.429.732-.214 1.507.194 2.015.404.503 1.092.878 1.869.806a3.72 3.72 0 0 1 1.005.022c.276.053.434.143.523.237.138.146.38.635-.25 2.09-.893 1.63-1.553 1.722-1.847 1.677-.213-.033-.468-.158-.756-.406a4.95 4.95 0 0 1-.8-.927c-.39-.564-1.04-.84-1.66-.846-.625-.006-1.316.27-1.693.921l-.478.826-.911 1.506Z",["M9.093 11.552c.046-.079.144-.15.32-.148a.53.53 0 0 1 .43.207c.285.414.636.847 1.046 1.2.405.35.914.662 1.516.754 1.334.205 2.502-.698 3.48-2.495l.014-.028.013-.03c.687-1.574.774-2.852-.005-3.675-.37-.391-.861-.586-1.333-.676a5.243 5.243 0 0 0-1.447-.044c-.173.016-.393-.073-.54-.257-.145-.18-.127-.316-.082-.392l.393-.672L14.287 3h5.71c1.536 0 2.499 1.659 1.737 2.992l-7.997 13.996c-.768 1.344-2.706 1.344-3.473 0l-3.037-5.314 1.377-2.278.004-.006.004-.007.481-.831Z",.6]]}},n)}const dV=n=>{const l=Mn(e1);if(!l)throw new Error("Missing Vuetify Icons provide!");return{iconData:it(()=>{var G;const v=vt(n);if(!v)return{component:QE};let A=v;if(typeof A=="string"&&(A=A.trim(),A.startsWith("$")&&(A=(G=l.aliases)==null?void 0:G[A.slice(1)])),Array.isArray(A))return{component:$3,icon:A};if(typeof A!="string")return{component:QE,icon:A};const R=Object.keys(l.sets).find(W=>typeof A=="string"&&A.startsWith(`${W}:`)),D=R?A.slice(R.length+1):A;return{component:l.sets[R??l.defaultSet].component,icon:D}})}},fV=["x-small","small","default","large","x-large"],eb=fn({size:{type:[String,Number],default:"default"}},"size");function tb(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ic();return O3(()=>{let p,v;return Yx(fV,n.size)?p=`${l}--size-${n.size}`:n.size&&(v={width:oi(n.size),height:oi(n.size)}),{sizeClasses:p,sizeStyles:v}})}const vo=fn({tag:{type:String,default:"div"}},"tag"),dy=Symbol.for("vuetify:theme"),ju=fn({theme:String},"theme");function eA(){return{defaultTheme:"light",variations:{colors:[],lighten:0,darken:0},themes:{light:{dark:!1,colors:{background:"#FFFFFF",surface:"#FFFFFF","surface-bright":"#FFFFFF","surface-light":"#EEEEEE","surface-variant":"#424242","on-surface-variant":"#EEEEEE",primary:"#1867C0","primary-darken-1":"#1F5592",secondary:"#48A9A6","secondary-darken-1":"#018786",error:"#B00020",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#000000","border-opacity":.12,"high-emphasis-opacity":.87,"medium-emphasis-opacity":.6,"disabled-opacity":.38,"idle-opacity":.04,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.12,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#F5F5F5","theme-on-code":"#000000"}},dark:{dark:!0,colors:{background:"#121212",surface:"#212121","surface-bright":"#ccbfd6","surface-light":"#424242","surface-variant":"#a3a3a3","on-surface-variant":"#424242",primary:"#2196F3","primary-darken-1":"#277CC1",secondary:"#54B6B2","secondary-darken-1":"#48A9A6",error:"#CF6679",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#FFFFFF","border-opacity":.12,"high-emphasis-opacity":1,"medium-emphasis-opacity":.7,"disabled-opacity":.5,"idle-opacity":.1,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.16,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#343434","theme-on-code":"#CCCCCC"}}}}}function pV(){var v,A;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:eA();const l=eA();if(!n)return{...l,isDisabled:!0};const p={};for(const[R,D]of Object.entries(n.themes??{})){const i=D.dark||R==="dark"?(v=l.themes)==null?void 0:v.dark:(A=l.themes)==null?void 0:A.light;p[R]=_s(i,D)}return _s(l,{...n,themes:p})}function mV(n){const l=pV(n),p=hn(l.defaultTheme),v=hn(l.themes),A=it(()=>{const H={};for(const[ee,ne]of Object.entries(v.value)){const de=H[ee]={...ne,colors:{...ne.colors}};if(l.variations)for(const he of l.variations.colors){const ye=de.colors[he];if(ye)for(const Le of["lighten","darken"]){const je=Le==="lighten"?nV:iV;for(const xt of D3(l.variations[Le],1))de.colors[`${he}-${Le}-${xt}`]=eV(je(Na(ye),xt))}}for(const he of Object.keys(de.colors)){if(/^on-[a-z]/.test(he)||de.colors[`on-${he}`])continue;const ye=`on-${he}`,Le=Na(de.colors[he]);de.colors[ye]=U3(Le)}}return H}),R=it(()=>A.value[p.value]),D=it(()=>{var he;const H=[];(he=R.value)!=null&&he.dark&&Su(H,":root",["color-scheme: dark"]),Su(H,":root",tA(R.value));for(const[ye,Le]of Object.entries(A.value))Su(H,`.v-theme--${ye}`,[`color-scheme: ${Le.dark?"dark":"normal"}`,...tA(Le)]);const ee=[],ne=[],de=new Set(Object.values(A.value).flatMap(ye=>Object.keys(ye.colors)));for(const ye of de)/^on-[a-z]/.test(ye)?Su(ne,`.${ye}`,[`color: rgb(var(--v-theme-${ye})) !important`]):(Su(ee,`.bg-${ye}`,[`--v-theme-overlay-multiplier: var(--v-theme-${ye}-overlay-multiplier)`,`background-color: rgb(var(--v-theme-${ye})) !important`,`color: rgb(var(--v-theme-on-${ye})) !important`]),Su(ne,`.text-${ye}`,[`color: rgb(var(--v-theme-${ye})) !important`]),Su(ne,`.border-${ye}`,[`--v-border-color: var(--v-theme-${ye})`]));return H.push(...ee,...ne),H.map((ye,Le)=>Le===0?ye:`    ${ye}`).join("")});function i(){return{style:[{textContent:D.value,id:"vuetify-theme-stylesheet",nonce:l.cspNonce||!1}]}}function G(H){if(l.isDisabled)return;const ee=H._context.provides.usehead;if(ee)if(ee.push){const ne=ee.push(i);ms&&Tn(D,()=>{ne.patch(i)})}else ms?(ee.addHeadObjs(it(i)),kd(()=>ee.updateDOM())):ee.addHeadObjs(i());else{let de=function(){if(typeof document<"u"&&!ne){const he=document.createElement("style");he.type="text/css",he.id="vuetify-theme-stylesheet",l.cspNonce&&he.setAttribute("nonce",l.cspNonce),ne=he,document.head.appendChild(ne)}ne&&(ne.innerHTML=D.value)},ne=ms?document.getElementById("vuetify-theme-stylesheet"):null;ms?Tn(D,de,{immediate:!0}):de()}}const W=it(()=>l.isDisabled?void 0:`v-theme--${p.value}`);return{install:G,isDisabled:l.isDisabled,name:p,themes:v,current:R,computedThemes:A,themeClasses:W,styles:D,global:{name:p,current:R}}}function $u(n){Ns("provideTheme");const l=Mn(dy,null);if(!l)throw new Error("Could not find Vuetify theme injection");const p=it(()=>n.theme??l.name.value),v=it(()=>l.themes.value[p.value]),A=it(()=>l.isDisabled?void 0:`v-theme--${p.value}`),R={...l,name:p,current:v,themeClasses:A};return go(dy,R),R}function Su(n,l,p){n.push(`${l} {
`,...p.map(v=>`  ${v};
`),`}
`)}function tA(n){const l=n.dark?2:1,p=n.dark?1:2,v=[];for(const[A,R]of Object.entries(n.colors)){const D=Na(R);v.push(`--v-theme-${A}: ${D.r},${D.g},${D.b}`),A.startsWith("on-")||v.push(`--v-theme-${A}-overlay-multiplier: ${sV(R)>.18?l:p}`)}for(const[A,R]of Object.entries(n.variables)){const D=typeof R=="string"&&R.startsWith("#")?Na(R):void 0,i=D?`${D.r}, ${D.g}, ${D.b}`:void 0;v.push(`--v-${A}: ${i??R}`)}return v}const _V=fn({color:String,disabled:Boolean,start:Boolean,end:Boolean,icon:mo,...Hi(),...eb(),...vo({tag:"i"}),...ju()},"VIcon"),aa=yi()({name:"VIcon",props:_V(),setup(n,l){let{attrs:p,slots:v}=l;const A=hn(),{themeClasses:R}=$u(n),{iconData:D}=dV(it(()=>A.value||n.icon)),{sizeClasses:i}=tb(n),{textColorClasses:G,textColorStyles:W}=j3(ps(n,"color"));return gs(()=>{var ne,de;const H=(ne=v.default)==null?void 0:ne.call(v);H&&(A.value=(de=L3(H).filter(he=>he.type===Fd&&he.children&&typeof he.children=="string")[0])==null?void 0:de.children);const ee=!!(p.onClick||p.onClickOnce);return dt(D.value.component,{tag:n.tag,icon:D.value.icon,class:["v-icon","notranslate",R.value,i.value,G.value,{"v-icon--clickable":ee,"v-icon--disabled":n.disabled,"v-icon--start":n.start,"v-icon--end":n.end},n.class],style:[i.value?void 0:{fontSize:oi(n.size),height:oi(n.size),width:oi(n.size)},W.value,n.style],role:ee?"button":void 0,"aria-hidden":!ee,tabindex:ee?n.disabled?-1:0:void 0},{default:()=>[H]})}),{}}}),km=fn({height:[Number,String],maxHeight:[Number,String],maxWidth:[Number,String],minHeight:[Number,String],minWidth:[Number,String],width:[Number,String]},"dimension");function Fm(n){return{dimensionStyles:it(()=>{const p={},v=oi(n.height),A=oi(n.maxHeight),R=oi(n.maxWidth),D=oi(n.minHeight),i=oi(n.minWidth),G=oi(n.width);return v!=null&&(p.height=v),A!=null&&(p.maxHeight=A),R!=null&&(p.maxWidth=R),D!=null&&(p.minHeight=D),i!=null&&(p.minWidth=i),G!=null&&(p.width=G),p})}}function gV(n){return{aspectStyles:it(()=>{const l=Number(n.aspectRatio);return l?{paddingBottom:String(1/l*100)+"%"}:void 0})}}const H3=fn({aspectRatio:[String,Number],contentClass:null,inline:Boolean,...Hi(),...km()},"VResponsive"),rA=yi()({name:"VResponsive",props:H3(),setup(n,l){let{slots:p}=l;const{aspectStyles:v}=gV(n),{dimensionStyles:A}=Fm(n);return gs(()=>{var R;return dt("div",{class:["v-responsive",{"v-responsive--inline":n.inline},n.class],style:[A.value,n.style]},[dt("div",{class:"v-responsive__sizer",style:v.value},null),(R=p.additional)==null?void 0:R.call(p),p.default&&dt("div",{class:["v-responsive__content",n.contentClass]},[p.default()])])}),{}}}),jd=fn({rounded:{type:[Boolean,Number,String],default:void 0},tile:Boolean},"rounded");function $d(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ic();return{roundedClasses:it(()=>{const v=Yn(n)?n.value:n.rounded,A=Yn(n)?n.value:n.tile,R=[];if(v===!0||v==="")R.push(`${l}--rounded`);else if(typeof v=="string"||v===0)for(const D of String(v).split(" "))R.push(`rounded-${D}`);else(A||v===!1)&&R.push("rounded-0");return R})}}const yV=fn({transition:{type:[Boolean,String,Object],default:"fade-transition",validator:n=>n!==!0}},"transition"),kg=(n,l)=>{let{slots:p}=l;const{transition:v,disabled:A,group:R,...D}=n,{component:i=R?R1:Cm,...G}=typeof v=="object"?v:{};return vl(i,Ys(typeof v=="string"?{name:A?"":v}:G,typeof v=="string"?{}:Object.fromEntries(Object.entries({disabled:A,group:R}).filter(W=>{let[H,ee]=W;return ee!==void 0})),D),p)};function vV(n,l){if(!K1)return;const p=l.modifiers||{},v=l.value,{handler:A,options:R}=typeof v=="object"?v:{handler:v,options:{}},D=new IntersectionObserver(function(){var ee;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],G=arguments.length>1?arguments[1]:void 0;const W=(ee=n._observe)==null?void 0:ee[l.instance.$.uid];if(!W)return;const H=i.some(ne=>ne.isIntersecting);A&&(!p.quiet||W.init)&&(!p.once||H||W.init)&&A(H,i,G),H&&p.once?q3(n,l):W.init=!0},R);n._observe=Object(n._observe),n._observe[l.instance.$.uid]={init:!1,observer:D},D.observe(n)}function q3(n,l){var v;const p=(v=n._observe)==null?void 0:v[l.instance.$.uid];p&&(p.observer.unobserve(n),delete n._observe[l.instance.$.uid])}const xV={mounted:vV,unmounted:q3},bV=fn({absolute:Boolean,alt:String,cover:Boolean,color:String,draggable:{type:[Boolean,String],default:void 0},eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},crossorigin:String,referrerpolicy:String,srcset:String,position:String,...H3(),...Hi(),...jd(),...yV()},"VImg"),Wy=yi()({name:"VImg",directives:{intersect:xV},props:bV(),emits:{loadstart:n=>!0,load:n=>!0,error:n=>!0},setup(n,l){let{emit:p,slots:v}=l;const{backgroundColorClasses:A,backgroundColorStyles:R}=Ad(ps(n,"color")),{roundedClasses:D}=$d(n),i=Ns("VImg"),G=Nn(""),W=hn(),H=Nn(n.eager?"loading":"idle"),ee=Nn(),ne=Nn(),de=it(()=>n.src&&typeof n.src=="object"?{src:n.src.src,srcset:n.srcset||n.src.srcset,lazySrc:n.lazySrc||n.src.lazySrc,aspect:Number(n.aspectRatio||n.src.aspect||0)}:{src:n.src,srcset:n.srcset,lazySrc:n.lazySrc,aspect:Number(n.aspectRatio||0)}),he=it(()=>de.value.aspect||ee.value/ne.value||0);Tn(()=>n.src,()=>{ye(H.value!=="idle")}),Tn(he,(yt,sr)=>{!yt&&sr&&W.value&&ut(W.value)}),pM(()=>ye());function ye(yt){if(!(n.eager&&yt)&&!(K1&&!yt&&!n.eager)){if(H.value="loading",de.value.lazySrc){const sr=new Image;sr.src=de.value.lazySrc,ut(sr,null)}de.value.src&&Zs(()=>{var sr;p("loadstart",((sr=W.value)==null?void 0:sr.currentSrc)||de.value.src),setTimeout(()=>{var zr;if(!i.isUnmounted)if((zr=W.value)!=null&&zr.complete){if(W.value.naturalWidth||je(),H.value==="error")return;he.value||ut(W.value,null),H.value==="loading"&&Le()}else he.value||ut(W.value),xt()})})}}function Le(){var yt;i.isUnmounted||(xt(),ut(W.value),H.value="loaded",p("load",((yt=W.value)==null?void 0:yt.currentSrc)||de.value.src))}function je(){var yt;i.isUnmounted||(H.value="error",p("error",((yt=W.value)==null?void 0:yt.currentSrc)||de.value.src))}function xt(){const yt=W.value;yt&&(G.value=yt.currentSrc||yt.src)}let Dt=-1;Va(()=>{clearTimeout(Dt)});function ut(yt){let sr=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const zr=()=>{if(clearTimeout(Dt),i.isUnmounted)return;const{naturalHeight:Zt,naturalWidth:Ir}=yt;Zt||Ir?(ee.value=Ir,ne.value=Zt):!yt.complete&&H.value==="loading"&&sr!=null?Dt=window.setTimeout(zr,sr):(yt.currentSrc.endsWith(".svg")||yt.currentSrc.startsWith("data:image/svg+xml"))&&(ee.value=1,ne.value=1)};zr()}const ht=it(()=>({"v-img__img--cover":n.cover,"v-img__img--contain":!n.cover})),Et=()=>{var zr;if(!de.value.src||H.value==="idle")return null;const yt=dt("img",{class:["v-img__img",ht.value],style:{objectPosition:n.position},crossorigin:n.crossorigin,src:de.value.src,srcset:de.value.srcset,alt:n.alt,referrerpolicy:n.referrerpolicy,draggable:n.draggable,sizes:n.sizes,ref:W,onLoad:Le,onError:je},null),sr=(zr=v.sources)==null?void 0:zr.call(v);return dt(kg,{transition:n.transition,appear:!0},{default:()=>[um(sr?dt("picture",{class:"v-img__picture"},[sr,yt]):yt,[[WM,H.value==="loaded"]])]})},tt=()=>dt(kg,{transition:n.transition},{default:()=>[de.value.lazySrc&&H.value!=="loaded"&&dt("img",{class:["v-img__img","v-img__img--preload",ht.value],style:{objectPosition:n.position},crossorigin:n.crossorigin,src:de.value.lazySrc,alt:n.alt,referrerpolicy:n.referrerpolicy,draggable:n.draggable},null)]}),At=()=>v.placeholder?dt(kg,{transition:n.transition,appear:!0},{default:()=>[(H.value==="loading"||H.value==="error"&&!v.error)&&dt("div",{class:"v-img__placeholder"},[v.placeholder()])]}):null,pt=()=>v.error?dt(kg,{transition:n.transition,appear:!0},{default:()=>[H.value==="error"&&dt("div",{class:"v-img__error"},[v.error()])]}):null,at=()=>n.gradient?dt("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${n.gradient})`}},null):null,gt=Nn(!1);{const yt=Tn(he,sr=>{sr&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{gt.value=!0})}),yt())})}return gs(()=>{const yt=rA.filterProps(n);return um(dt(rA,Ys({class:["v-img",{"v-img--absolute":n.absolute,"v-img--booting":!gt.value},A.value,D.value,n.class],style:[{width:oi(n.width==="auto"?ee.value:n.width)},R.value,n.style]},yt,{aspectRatio:he.value,"aria-label":n.alt,role:n.alt?"img":void 0}),{additional:()=>dt(ti,null,[dt(Et,null,null),dt(tt,null,null),dt(at,null,null),dt(At,null,null),dt(pt,null,null)]),default:v.default}),[[E1("intersect"),{handler:ye,options:n.options},null,{once:!0}]])}),{currentSrc:G,image:W,state:H,naturalWidth:ee,naturalHeight:ne}}}),Zy=fn({border:[Boolean,Number,String]},"border");function Xy(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ic();return{borderClasses:it(()=>{const v=Yn(n)?n.value:n.border,A=[];if(v===!0||v==="")A.push(`${l}--border`);else if(typeof v=="string"||v===0)for(const R of String(v).split(" "))A.push(`border-${R}`);return A})}}const wV=[null,"default","comfortable","compact"],Ky=fn({density:{type:String,default:"default",validator:n=>wV.includes(n)}},"density");function rb(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ic();return{densityClasses:it(()=>`${l}--density-${n.density}`)}}const TV=["elevated","flat","tonal","outlined","text","plain"];function nb(n,l){return dt(ti,null,[n&&dt("span",{key:"overlay",class:`${l}__overlay`},null),dt("span",{key:"underlay",class:`${l}__underlay`},null)])}const Yy=fn({color:String,variant:{type:String,default:"elevated",validator:n=>TV.includes(n)}},"variant");function ib(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ic();const p=it(()=>{const{variant:R}=vt(n);return`${l}--variant-${R}`}),{colorClasses:v,colorStyles:A}=Q1(it(()=>{const{variant:R,color:D}=vt(n);return{[["elevated","flat"].includes(R)?"background":"text"]:D}}));return{colorClasses:v,colorStyles:A,variantClasses:p}}const SV=fn({start:Boolean,end:Boolean,icon:mo,image:String,text:String,...Zy(),...Hi(),...Ky(),...jd(),...eb(),...vo(),...ju(),...Yy({variant:"flat"})},"VAvatar"),wm=yi()({name:"VAvatar",props:SV(),setup(n,l){let{slots:p}=l;const{themeClasses:v}=$u(n),{borderClasses:A}=Xy(n),{colorClasses:R,colorStyles:D,variantClasses:i}=ib(n),{densityClasses:G}=rb(n),{roundedClasses:W}=$d(n),{sizeClasses:H,sizeStyles:ee}=tb(n);return gs(()=>dt(n.tag,{class:["v-avatar",{"v-avatar--start":n.start,"v-avatar--end":n.end},v.value,A.value,R.value,G.value,W.value,H.value,i.value,n.class],style:[D.value,ee.value,n.style]},{default:()=>[p.default?dt(_l,{key:"content-defaults",defaults:{VImg:{cover:!0,src:n.image},VIcon:{icon:n.icon}}},{default:()=>[p.default()]}):n.image?dt(Wy,{key:"image",src:n.image,alt:"",cover:!0},null):n.icon?dt(aa,{key:"icon",icon:n.icon},null):n.text,nb(!1,"v-avatar")]})),{}}}),EV=yi()({name:"VCardActions",props:Hi(),setup(n,l){let{slots:p}=l;return Hy({VBtn:{slim:!0,variant:"text"}}),gs(()=>{var v;return dt("div",{class:["v-card-actions",n.class],style:n.style},[(v=p.default)==null?void 0:v.call(p)])}),{}}}),AV=fn({opacity:[Number,String],...Hi(),...vo()},"VCardSubtitle"),MV=yi()({name:"VCardSubtitle",props:AV(),setup(n,l){let{slots:p}=l;return gs(()=>dt(n.tag,{class:["v-card-subtitle",n.class],style:[{"--v-card-subtitle-opacity":n.opacity},n.style]},p)),{}}}),IV=oV("v-card-title"),CV=fn({appendAvatar:String,appendIcon:mo,prependAvatar:String,prependIcon:mo,subtitle:{type:[String,Number,Boolean],default:void 0},title:{type:[String,Number,Boolean],default:void 0},...Hi(),...Ky()},"VCardItem"),PV=yi()({name:"VCardItem",props:CV(),setup(n,l){let{slots:p}=l;return gs(()=>{var W;const v=!!(n.prependAvatar||n.prependIcon),A=!!(v||p.prepend),R=!!(n.appendAvatar||n.appendIcon),D=!!(R||p.append),i=!!(n.title!=null||p.title),G=!!(n.subtitle!=null||p.subtitle);return dt("div",{class:["v-card-item",n.class],style:n.style},[A&&dt("div",{key:"prepend",class:"v-card-item__prepend"},[p.prepend?dt(_l,{key:"prepend-defaults",disabled:!v,defaults:{VAvatar:{density:n.density,image:n.prependAvatar},VIcon:{density:n.density,icon:n.prependIcon}}},p.prepend):dt(ti,null,[n.prependAvatar&&dt(wm,{key:"prepend-avatar",density:n.density,image:n.prependAvatar},null),n.prependIcon&&dt(aa,{key:"prepend-icon",density:n.density,icon:n.prependIcon},null)])]),dt("div",{class:"v-card-item__content"},[i&&dt(IV,{key:"title"},{default:()=>{var H;return[((H=p.title)==null?void 0:H.call(p))??Xs(n.title)]}}),G&&dt(MV,{key:"subtitle"},{default:()=>{var H;return[((H=p.subtitle)==null?void 0:H.call(p))??Xs(n.subtitle)]}}),(W=p.default)==null?void 0:W.call(p)]),D&&dt("div",{key:"append",class:"v-card-item__append"},[p.append?dt(_l,{key:"append-defaults",disabled:!R,defaults:{VAvatar:{density:n.density,image:n.appendAvatar},VIcon:{density:n.density,icon:n.appendIcon}}},p.append):dt(ti,null,[n.appendIcon&&dt(aa,{key:"append-icon",density:n.density,icon:n.appendIcon},null),n.appendAvatar&&dt(wm,{key:"append-avatar",density:n.density,image:n.appendAvatar},null)])])])}),{}}}),RV=fn({opacity:[Number,String],...Hi(),...vo()},"VCardText"),W3=yi()({name:"VCardText",props:RV(),setup(n,l){let{slots:p}=l;return gs(()=>dt(n.tag,{class:["v-card-text",n.class],style:[{"--v-card-text-opacity":n.opacity},n.style]},p)),{}}}),sb=fn({elevation:{type:[Number,String],validator(n){const l=parseInt(n);return!isNaN(l)&&l>=0&&l<=24}}},"elevation");function ob(n){return{elevationClasses:it(()=>{const p=Yn(n)?n.value:n.elevation,v=[];return p==null||v.push(`elevation-${p}`),v})}}function DV(n,l){const p=hn(),v=Nn(!1);if(K1){const A=new IntersectionObserver(R=>{v.value=!!R.find(D=>D.isIntersecting)},l);Va(()=>{A.disconnect()}),Tn(p,(R,D)=>{D&&(A.unobserve(D),v.value=!1),R&&A.observe(R)},{flush:"post"})}return{intersectionRef:p,isIntersecting:v}}function om(n,l){let p;function v(){p=u1(),p.run(()=>l.length?l(()=>{p==null||p.stop(),v()}):l())}Tn(n,A=>{A&&!p?v():A||(p==null||p.stop(),p=void 0)},{immediate:!0}),by(()=>{p==null||p.stop()})}function Bm(n,l,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ee=>ee,A=arguments.length>4&&arguments[4]!==void 0?arguments[4]:ee=>ee;const R=Ns("useProxiedModel"),D=hn(n[l]!==void 0?n[l]:p),i=Lu(l),W=it(i!==l?()=>{var ee,ne,de,he;return n[l],!!(((ee=R.vnode.props)!=null&&ee.hasOwnProperty(l)||(ne=R.vnode.props)!=null&&ne.hasOwnProperty(i))&&((de=R.vnode.props)!=null&&de.hasOwnProperty(`onUpdate:${l}`)||(he=R.vnode.props)!=null&&he.hasOwnProperty(`onUpdate:${i}`)))}:()=>{var ee,ne;return n[l],!!((ee=R.vnode.props)!=null&&ee.hasOwnProperty(l)&&((ne=R.vnode.props)!=null&&ne.hasOwnProperty(`onUpdate:${l}`)))});om(()=>!W.value,()=>{Tn(()=>n[l],ee=>{D.value=ee})});const H=it({get(){const ee=n[l];return v(W.value?ee:D.value)},set(ee){const ne=A(ee),de=Rn(W.value?n[l]:D.value);de===ne||v(de)===ee||(D.value=ne,R==null||R.emit(`update:${l}`,ne))}});return Object.defineProperty(H,"externalValue",{get:()=>W.value?n[l]:D.value}),H}const zV={badge:"Badge",open:"Open",close:"Close",dismiss:"Dismiss",confirmEdit:{ok:"OK",cancel:"Cancel"},dataIterator:{noResultsText:"No matching records found",loadingText:"Loading items..."},dataTable:{itemsPerPageText:"Rows per page:",ariaLabel:{sortDescending:"Sorted descending.",sortAscending:"Sorted ascending.",sortNone:"Not sorted.",activateNone:"Activate to remove sorting.",activateDescending:"Activate to sort descending.",activateAscending:"Activate to sort ascending."},sortBy:"Sort by"},dataFooter:{itemsPerPageText:"Items per page:",itemsPerPageAll:"All",nextPage:"Next page",prevPage:"Previous page",firstPage:"First page",lastPage:"Last page",pageText:"{0}-{1} of {2}"},dateRangeInput:{divider:"to"},datePicker:{itemsSelected:"{0} selected",range:{title:"Select dates",header:"Enter dates"},title:"Select date",header:"Enter date",input:{placeholder:"Enter date"}},noDataText:"No data available",carousel:{prev:"Previous visual",next:"Next visual",ariaLabel:{delimiter:"Carousel slide {0} of {1}"}},calendar:{moreEvents:"{0} more",today:"Today"},input:{clear:"Clear {0}",prependAction:"{0} prepended action",appendAction:"{0} appended action",otp:"Please enter OTP character {0}"},fileInput:{counter:"{0} files",counterSize:"{0} files ({1} in total)"},fileUpload:{title:"Drag and drop files here",divider:"or",browse:"Browse Files"},timePicker:{am:"AM",pm:"PM",title:"Select Time"},pagination:{ariaLabel:{root:"Pagination Navigation",next:"Next page",previous:"Previous page",page:"Go to page {0}",currentPage:"Page {0}, Current page",first:"First page",last:"Last page"}},stepper:{next:"Next",prev:"Previous"},rating:{ariaLabel:{item:"Rating {0} of {1}"}},loading:"Loading...",infiniteScroll:{loadMore:"Load more",empty:"No more"}},nA="$vuetify.",iA=(n,l)=>n.replace(/\{(\d+)\}/g,(p,v)=>String(l[Number(v)])),Z3=(n,l,p)=>function(v){for(var A=arguments.length,R=new Array(A>1?A-1:0),D=1;D<A;D++)R[D-1]=arguments[D];if(!v.startsWith(nA))return iA(v,R);const i=v.replace(nA,""),G=n.value&&p.value[n.value],W=l.value&&p.value[l.value];let H=BE(G,i,null);return H||(`${v}${n.value}`,H=BE(W,i,null)),H||(H=v),typeof H!="string"&&(H=v),iA(H,R)};function X3(n,l){return(p,v)=>new Intl.NumberFormat([n.value,l.value],v).format(p)}function Tx(n,l,p){const v=Bm(n,l,n[l]??p.value);return v.value=n[l]??p.value,Tn(p,A=>{n[l]==null&&(v.value=p.value)}),v}function K3(n){return l=>{const p=Tx(l,"locale",n.current),v=Tx(l,"fallback",n.fallback),A=Tx(l,"messages",n.messages);return{name:"vuetify",current:p,fallback:v,messages:A,t:Z3(p,v,A),n:X3(p,v),provide:K3({current:p,fallback:v,messages:A})}}}function LV(n){const l=Nn((n==null?void 0:n.locale)??"en"),p=Nn((n==null?void 0:n.fallback)??"en"),v=hn({en:zV,...n==null?void 0:n.messages});return{name:"vuetify",current:l,fallback:p,messages:v,t:Z3(l,p,v),n:X3(l,p),provide:K3({current:l,fallback:p,messages:v})}}const fy=Symbol.for("vuetify:locale");function OV(n){return n.name!=null}function kV(n){const l=n!=null&&n.adapter&&OV(n==null?void 0:n.adapter)?n==null?void 0:n.adapter:LV(n),p=NV(l,n);return{...l,...p}}function FV(){const n=Mn(fy);if(!n)throw new Error("[Vuetify] Could not find injected locale instance");return n}function BV(){return{af:!1,ar:!0,bg:!1,ca:!1,ckb:!1,cs:!1,de:!1,el:!1,en:!1,es:!1,et:!1,fa:!0,fi:!1,fr:!1,hr:!1,hu:!1,he:!0,id:!1,it:!1,ja:!1,km:!1,ko:!1,lv:!1,lt:!1,nl:!1,no:!1,pl:!1,pt:!1,ro:!1,ru:!1,sk:!1,sl:!1,srCyrl:!1,srLatn:!1,sv:!1,th:!1,tr:!1,az:!1,uk:!1,vi:!1,zhHans:!1,zhHant:!1}}function NV(n,l){const p=hn((l==null?void 0:l.rtl)??BV()),v=it(()=>p.value[n.current.value]??!1);return{isRtl:v,rtl:p,rtlClasses:it(()=>`v-locale--is-${v.value?"rtl":"ltr"}`)}}function Gd(){const n=Mn(fy);if(!n)throw new Error("[Vuetify] Could not find injected rtl instance");return{isRtl:n.isRtl,rtlClasses:n.rtlClasses}}const sA={center:"center",top:"bottom",bottom:"top",left:"right",right:"left"},Y3=fn({location:String},"location");function J3(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,p=arguments.length>2?arguments[2]:void 0;const{isRtl:v}=Gd();return{locationStyles:it(()=>{if(!n.location)return{};const{side:R,align:D}=kN(n.location.split(" ").length>1?n.location:`${n.location} center`,v.value);function i(W){return p?p(W):0}const G={};return R!=="center"&&(l?G[sA[R]]=`calc(100% - ${i(R)}px)`:G[R]=0),D!=="center"?l?G[sA[D]]=`calc(100% - ${i(D)}px)`:G[D]=0:(R==="center"?G.top=G.left="50%":G[{top:"left",bottom:"left",left:"top",right:"top"}[R]]="50%",G.transform={top:"translateX(-50%)",bottom:"translateX(-50%)",left:"translateY(-50%)",right:"translateY(-50%)",center:"translate(-50%, -50%)"}[R]),G})}}const VV=fn({absolute:Boolean,active:{type:Boolean,default:!0},bgColor:String,bgOpacity:[Number,String],bufferValue:{type:[Number,String],default:0},bufferColor:String,bufferOpacity:[Number,String],clickable:Boolean,color:String,height:{type:[Number,String],default:4},indeterminate:Boolean,max:{type:[Number,String],default:100},modelValue:{type:[Number,String],default:0},opacity:[Number,String],reverse:Boolean,stream:Boolean,striped:Boolean,roundedBar:Boolean,...Hi(),...Y3({location:"top"}),...jd(),...vo(),...ju()},"VProgressLinear"),UV=yi()({name:"VProgressLinear",props:VV(),emits:{"update:modelValue":n=>!0},setup(n,l){var gt;let{slots:p}=l;const v=Bm(n,"modelValue"),{isRtl:A,rtlClasses:R}=Gd(),{themeClasses:D}=$u(n),{locationStyles:i}=J3(n),{textColorClasses:G,textColorStyles:W}=j3(n,"color"),{backgroundColorClasses:H,backgroundColorStyles:ee}=Ad(it(()=>n.bgColor||n.color)),{backgroundColorClasses:ne,backgroundColorStyles:de}=Ad(it(()=>n.bufferColor||n.bgColor||n.color)),{backgroundColorClasses:he,backgroundColorStyles:ye}=Ad(n,"color"),{roundedClasses:Le}=$d(n),{intersectionRef:je,isIntersecting:xt}=DV(),Dt=it(()=>parseFloat(n.max)),ut=it(()=>parseFloat(n.height)),ht=it(()=>uy(parseFloat(n.bufferValue)/Dt.value*100,0,100)),Et=it(()=>uy(parseFloat(v.value)/Dt.value*100,0,100)),tt=it(()=>A.value!==n.reverse),At=it(()=>n.indeterminate?"fade-transition":"slide-x-transition"),pt=ms&&((gt=window.matchMedia)==null?void 0:gt.call(window,"(forced-colors: active)").matches);function at(yt){if(!je.value)return;const{left:sr,right:zr,width:Zt}=je.value.getBoundingClientRect(),Ir=tt.value?Zt-yt.clientX+(zr-Zt):yt.clientX-sr;v.value=Math.round(Ir/Zt*Dt.value)}return gs(()=>dt(n.tag,{ref:je,class:["v-progress-linear",{"v-progress-linear--absolute":n.absolute,"v-progress-linear--active":n.active&&xt.value,"v-progress-linear--reverse":tt.value,"v-progress-linear--rounded":n.rounded,"v-progress-linear--rounded-bar":n.roundedBar,"v-progress-linear--striped":n.striped},Le.value,D.value,R.value,n.class],style:[{bottom:n.location==="bottom"?0:void 0,top:n.location==="top"?0:void 0,height:n.active?oi(ut.value):0,"--v-progress-linear-height":oi(ut.value),...n.absolute?i.value:{}},n.style],role:"progressbar","aria-hidden":n.active?"false":"true","aria-valuemin":"0","aria-valuemax":n.max,"aria-valuenow":n.indeterminate?void 0:Math.min(parseFloat(v.value),Dt.value),onClick:n.clickable&&at},{default:()=>[n.stream&&dt("div",{key:"stream",class:["v-progress-linear__stream",G.value],style:{...W.value,[tt.value?"left":"right"]:oi(-ut.value),borderTop:`${oi(ut.value/2)} dotted`,opacity:parseFloat(n.bufferOpacity),top:`calc(50% - ${oi(ut.value/4)})`,width:oi(100-ht.value,"%"),"--v-progress-linear-stream-to":oi(ut.value*(tt.value?1:-1))}},null),dt("div",{class:["v-progress-linear__background",pt?void 0:H.value],style:[ee.value,{opacity:parseFloat(n.bgOpacity),width:n.stream?0:void 0}]},null),dt("div",{class:["v-progress-linear__buffer",pt?void 0:ne.value],style:[de.value,{opacity:parseFloat(n.bufferOpacity),width:oi(ht.value,"%")}]},null),dt(Cm,{name:At.value},{default:()=>[n.indeterminate?dt("div",{class:"v-progress-linear__indeterminate"},[["long","short"].map(yt=>dt("div",{key:yt,class:["v-progress-linear__indeterminate",yt,pt?void 0:he.value],style:ye.value},null))]):dt("div",{class:["v-progress-linear__determinate",pt?void 0:he.value],style:[ye.value,{width:oi(Et.value,"%")}]},null)]}),p.default&&dt("div",{class:"v-progress-linear__content"},[p.default({value:Et.value,buffer:ht.value})])]})),{}}}),jV=fn({loading:[Boolean,String]},"loader");function $V(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ic();return{loaderClasses:it(()=>({[`${l}--loading`]:n.loading}))}}function GV(n,l){var v;let{slots:p}=l;return dt("div",{class:`${n.name}__loader`},[((v=p.default)==null?void 0:v.call(p,{color:n.color,isActive:n.active}))||dt(UV,{absolute:n.absolute,active:n.active,color:n.color,height:"2",indeterminate:!0},null)])}const HV=["static","relative","fixed","absolute","sticky"],qV=fn({position:{type:String,validator:n=>HV.includes(n)}},"position");function WV(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ic();return{positionClasses:it(()=>n.position?`${l}--${n.position}`:void 0)}}function ZV(){const n=Ns("useRoute");return it(()=>{var l;return(l=n==null?void 0:n.proxy)==null?void 0:l.$route})}function XV(){var n,l;return(l=(n=Ns("useRouter"))==null?void 0:n.proxy)==null?void 0:l.$router}function Q3(n,l){var ee,ne;const p=ho("RouterLink"),v=it(()=>!!(n.href||n.to)),A=it(()=>(v==null?void 0:v.value)||GE(l,"click")||GE(n,"click"));if(typeof p=="string"||!("useLink"in p)){const de=ps(n,"href");return{isLink:v,isClickable:A,href:de,linkProps:Zi({href:de})}}const R=it(()=>({...n,to:ps(()=>n.to||"")})),D=p.useLink(R.value),i=it(()=>n.to?D:void 0),G=ZV(),W=it(()=>{var de,he,ye;return i.value?n.exact?G.value?((ye=i.value.isExactActive)==null?void 0:ye.value)&&$y(i.value.route.value.query,G.value.query):((he=i.value.isExactActive)==null?void 0:he.value)??!1:((de=i.value.isActive)==null?void 0:de.value)??!1:!1}),H=it(()=>{var de;return n.to?(de=i.value)==null?void 0:de.route.value.href:n.href});return{isLink:v,isClickable:A,isActive:W,route:(ee=i.value)==null?void 0:ee.route,navigate:(ne=i.value)==null?void 0:ne.navigate,href:H,linkProps:Zi({href:H,"aria-current":it(()=>W.value?"page":void 0)})}}const eC=fn({href:String,replace:Boolean,to:[String,Object],exact:Boolean},"router"),t1=Symbol("rippleStop"),KV=80;function oA(n,l){n.style.transform=l,n.style.webkitTransform=l}function r1(n){return n.constructor.name==="TouchEvent"}function tC(n){return n.constructor.name==="KeyboardEvent"}const YV=function(n,l){var ee;let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=0,A=0;if(!tC(n)){const ne=l.getBoundingClientRect(),de=r1(n)?n.touches[n.touches.length-1]:n;v=de.clientX-ne.left,A=de.clientY-ne.top}let R=0,D=.3;(ee=l._ripple)!=null&&ee.circle?(D=.15,R=l.clientWidth/2,R=p.center?R:R+Math.sqrt((v-R)**2+(A-R)**2)/4):R=Math.sqrt(l.clientWidth**2+l.clientHeight**2)/2;const i=`${(l.clientWidth-R*2)/2}px`,G=`${(l.clientHeight-R*2)/2}px`,W=p.center?i:`${v-R}px`,H=p.center?G:`${A-R}px`;return{radius:R,scale:D,x:W,y:H,centerX:i,centerY:G}},py={show(n,l){var de;let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!((de=l==null?void 0:l._ripple)!=null&&de.enabled))return;const v=document.createElement("span"),A=document.createElement("span");v.appendChild(A),v.className="v-ripple__container",p.class&&(v.className+=` ${p.class}`);const{radius:R,scale:D,x:i,y:G,centerX:W,centerY:H}=YV(n,l,p),ee=`${R*2}px`;A.className="v-ripple__animation",A.style.width=ee,A.style.height=ee,l.appendChild(v);const ne=window.getComputedStyle(l);ne&&ne.position==="static"&&(l.style.position="relative",l.dataset.previousPosition="static"),A.classList.add("v-ripple__animation--enter"),A.classList.add("v-ripple__animation--visible"),oA(A,`translate(${i}, ${G}) scale3d(${D},${D},${D})`),A.dataset.activated=String(performance.now()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{A.classList.remove("v-ripple__animation--enter"),A.classList.add("v-ripple__animation--in"),oA(A,`translate(${W}, ${H}) scale3d(1,1,1)`)})})},hide(n){var R;if(!((R=n==null?void 0:n._ripple)!=null&&R.enabled))return;const l=n.getElementsByClassName("v-ripple__animation");if(l.length===0)return;const p=l[l.length-1];if(p.dataset.isHiding)return;p.dataset.isHiding="true";const v=performance.now()-Number(p.dataset.activated),A=Math.max(250-v,0);setTimeout(()=>{p.classList.remove("v-ripple__animation--in"),p.classList.add("v-ripple__animation--out"),setTimeout(()=>{var i;n.getElementsByClassName("v-ripple__animation").length===1&&n.dataset.previousPosition&&(n.style.position=n.dataset.previousPosition,delete n.dataset.previousPosition),((i=p.parentNode)==null?void 0:i.parentNode)===n&&n.removeChild(p.parentNode)},300)},A)}};function rC(n){return typeof n>"u"||!!n}function Tm(n){const l={},p=n.currentTarget;if(!(!(p!=null&&p._ripple)||p._ripple.touched||n[t1])){if(n[t1]=!0,r1(n))p._ripple.touched=!0,p._ripple.isTouch=!0;else if(p._ripple.isTouch)return;if(l.center=p._ripple.centered||tC(n),p._ripple.class&&(l.class=p._ripple.class),r1(n)){if(p._ripple.showTimerCommit)return;p._ripple.showTimerCommit=()=>{py.show(n,p,l)},p._ripple.showTimer=window.setTimeout(()=>{var v;(v=p==null?void 0:p._ripple)!=null&&v.showTimerCommit&&(p._ripple.showTimerCommit(),p._ripple.showTimerCommit=null)},KV)}else py.show(n,p,l)}}function aA(n){n[t1]=!0}function fo(n){const l=n.currentTarget;if(l!=null&&l._ripple){if(window.clearTimeout(l._ripple.showTimer),n.type==="touchend"&&l._ripple.showTimerCommit){l._ripple.showTimerCommit(),l._ripple.showTimerCommit=null,l._ripple.showTimer=window.setTimeout(()=>{fo(n)});return}window.setTimeout(()=>{l._ripple&&(l._ripple.touched=!1)}),py.hide(l)}}function nC(n){const l=n.currentTarget;l!=null&&l._ripple&&(l._ripple.showTimerCommit&&(l._ripple.showTimerCommit=null),window.clearTimeout(l._ripple.showTimer))}let Sm=!1;function iC(n){!Sm&&(n.keyCode===VE.enter||n.keyCode===VE.space)&&(Sm=!0,Tm(n))}function sC(n){Sm=!1,fo(n)}function oC(n){Sm&&(Sm=!1,fo(n))}function aC(n,l,p){const{value:v,modifiers:A}=l,R=rC(v);if(R||py.hide(n),n._ripple=n._ripple??{},n._ripple.enabled=R,n._ripple.centered=A.center,n._ripple.circle=A.circle,wN(v)&&v.class&&(n._ripple.class=v.class),R&&!p){if(A.stop){n.addEventListener("touchstart",aA,{passive:!0}),n.addEventListener("mousedown",aA);return}n.addEventListener("touchstart",Tm,{passive:!0}),n.addEventListener("touchend",fo,{passive:!0}),n.addEventListener("touchmove",nC,{passive:!0}),n.addEventListener("touchcancel",fo),n.addEventListener("mousedown",Tm),n.addEventListener("mouseup",fo),n.addEventListener("mouseleave",fo),n.addEventListener("keydown",iC),n.addEventListener("keyup",sC),n.addEventListener("blur",oC),n.addEventListener("dragstart",fo,{passive:!0})}else!R&&p&&lC(n)}function lC(n){n.removeEventListener("mousedown",Tm),n.removeEventListener("touchstart",Tm),n.removeEventListener("touchend",fo),n.removeEventListener("touchmove",nC),n.removeEventListener("touchcancel",fo),n.removeEventListener("mouseup",fo),n.removeEventListener("mouseleave",fo),n.removeEventListener("keydown",iC),n.removeEventListener("keyup",sC),n.removeEventListener("dragstart",fo),n.removeEventListener("blur",oC)}function JV(n,l){aC(n,l,!1)}function QV(n){delete n._ripple,lC(n)}function e8(n,l){if(l.value===l.oldValue)return;const p=rC(l.oldValue);aC(n,l,p)}const cC={mounted:JV,unmounted:QV,updated:e8},t8=fn({appendAvatar:String,appendIcon:mo,disabled:Boolean,flat:Boolean,hover:Boolean,image:String,link:{type:Boolean,default:void 0},prependAvatar:String,prependIcon:mo,ripple:{type:[Boolean,Object],default:!0},subtitle:{type:[String,Number,Boolean],default:void 0},text:{type:[String,Number,Boolean],default:void 0},title:{type:[String,Number,Boolean],default:void 0},...Zy(),...Hi(),...Ky(),...km(),...sb(),...jV(),...Y3(),...qV(),...jd(),...eC(),...vo(),...ju(),...Yy({variant:"elevated"})},"VCard"),r8=yi()({name:"VCard",directives:{Ripple:cC},props:t8(),setup(n,l){let{attrs:p,slots:v}=l;const{themeClasses:A}=$u(n),{borderClasses:R}=Xy(n),{colorClasses:D,colorStyles:i,variantClasses:G}=ib(n),{densityClasses:W}=rb(n),{dimensionStyles:H}=Fm(n),{elevationClasses:ee}=ob(n),{loaderClasses:ne}=$V(n),{locationStyles:de}=J3(n),{positionClasses:he}=WV(n),{roundedClasses:ye}=$d(n),Le=Q3(n,p),je=it(()=>n.link!==!1&&Le.isLink.value),xt=it(()=>!n.disabled&&n.link!==!1&&(n.link||Le.isClickable.value));return gs(()=>{const Dt=je.value?"a":n.tag,ut=!!(v.title||n.title!=null),ht=!!(v.subtitle||n.subtitle!=null),Et=ut||ht,tt=!!(v.append||n.appendAvatar||n.appendIcon),At=!!(v.prepend||n.prependAvatar||n.prependIcon),pt=!!(v.image||n.image),at=Et||At||tt,gt=!!(v.text||n.text!=null);return um(dt(Dt,Ys({class:["v-card",{"v-card--disabled":n.disabled,"v-card--flat":n.flat,"v-card--hover":n.hover&&!(n.disabled||n.flat),"v-card--link":xt.value},A.value,R.value,D.value,W.value,ee.value,ne.value,he.value,ye.value,G.value,n.class],style:[i.value,H.value,de.value,n.style],onClick:xt.value&&Le.navigate,tabindex:n.disabled?-1:void 0},Le.linkProps),{default:()=>{var yt;return[pt&&dt("div",{key:"image",class:"v-card__image"},[v.image?dt(_l,{key:"image-defaults",disabled:!n.image,defaults:{VImg:{cover:!0,src:n.image}}},v.image):dt(Wy,{key:"image-img",cover:!0,src:n.image},null)]),dt(GV,{name:"v-card",active:!!n.loading,color:typeof n.loading=="boolean"?void 0:n.loading},{default:v.loader}),at&&dt(PV,{key:"item",prependAvatar:n.prependAvatar,prependIcon:n.prependIcon,title:n.title,subtitle:n.subtitle,appendAvatar:n.appendAvatar,appendIcon:n.appendIcon},{default:v.item,prepend:v.prepend,title:v.title,subtitle:v.subtitle,append:v.append}),gt&&dt(W3,{key:"text"},{default:()=>{var sr;return[((sr=v.text)==null?void 0:sr.call(v))??n.text]}}),(yt=v.default)==null?void 0:yt.call(v),v.actions&&dt(EV,null,{default:v.actions}),nb(xt.value,"v-card")]}}),[[E1("ripple"),xt.value&&n.ripple]])}),{}}}),n8=fn({disabled:Boolean,group:Boolean,hideOnLeave:Boolean,leaveAbsolute:Boolean,mode:String,origin:String},"transition");function xo(n,l,p){return yi()({name:n,props:n8({mode:p,origin:l}),setup(v,A){let{slots:R}=A;const D={onBeforeEnter(i){v.origin&&(i.style.transformOrigin=v.origin)},onLeave(i){if(v.leaveAbsolute){const{offsetTop:G,offsetLeft:W,offsetWidth:H,offsetHeight:ee}=i;i._transitionInitialStyles={position:i.style.position,top:i.style.top,left:i.style.left,width:i.style.width,height:i.style.height},i.style.position="absolute",i.style.top=`${G}px`,i.style.left=`${W}px`,i.style.width=`${H}px`,i.style.height=`${ee}px`}v.hideOnLeave&&i.style.setProperty("display","none","important")},onAfterLeave(i){if(v.leaveAbsolute&&(i!=null&&i._transitionInitialStyles)){const{position:G,top:W,left:H,width:ee,height:ne}=i._transitionInitialStyles;delete i._transitionInitialStyles,i.style.position=G||"",i.style.top=W||"",i.style.left=H||"",i.style.width=ee||"",i.style.height=ne||""}}};return()=>{const i=v.group?R1:Cm;return vl(i,{name:v.disabled?"":n,css:!v.disabled,...v.group?void 0:{mode:v.mode},...v.disabled?{}:D},R.default)}}})}function uC(n,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"in-out";return yi()({name:n,props:{mode:{type:String,default:p},disabled:Boolean,group:Boolean},setup(v,A){let{slots:R}=A;const D=v.group?R1:Cm;return()=>vl(D,{name:v.disabled?"":n,css:!v.disabled,...v.disabled?{}:l},R.default)}})}function hC(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";const p=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)?"width":"height",v=Fs(`offset-${p}`);return{onBeforeEnter(D){D._parent=D.parentNode,D._initialStyle={transition:D.style.transition,overflow:D.style.overflow,[p]:D.style[p]}},onEnter(D){const i=D._initialStyle;if(!i)return;D.style.setProperty("transition","none","important"),D.style.overflow="hidden";const G=`${D[v]}px`;D.style[p]="0",D.offsetHeight,D.style.transition=i.transition,n&&D._parent&&D._parent.classList.add(n),requestAnimationFrame(()=>{D.style[p]=G})},onAfterEnter:R,onEnterCancelled:R,onLeave(D){D._initialStyle={transition:"",overflow:D.style.overflow,[p]:D.style[p]},D.style.overflow="hidden",D.style[p]=`${D[v]}px`,D.offsetHeight,requestAnimationFrame(()=>D.style[p]="0")},onAfterLeave:A,onLeaveCancelled:A};function A(D){n&&D._parent&&D._parent.classList.remove(n),R(D)}function R(D){if(!D._initialStyle)return;const i=D._initialStyle[p];D.style.overflow=D._initialStyle.overflow,i!=null&&(D.style[p]=i),delete D._initialStyle}}xo("fab-transition","center center","out-in");xo("dialog-bottom-transition");xo("dialog-top-transition");const lA=xo("fade-transition");xo("scale-transition");xo("scroll-x-transition");xo("scroll-x-reverse-transition");xo("scroll-y-transition");xo("scroll-y-reverse-transition");xo("slide-x-transition");xo("slide-x-reverse-transition");xo("slide-y-transition");xo("slide-y-reverse-transition");uC("expand-transition",hC());const i8=uC("expand-x-transition",hC("",!0)),ab=["sm","md","lg","xl","xxl"],n1=Symbol.for("vuetify:display"),cA={mobileBreakpoint:"lg",thresholds:{xs:0,sm:600,md:960,lg:1280,xl:1920,xxl:2560}},s8=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:cA;return _s(cA,n)};function uA(n){return ms&&!n?window.innerWidth:typeof n=="object"&&n.clientWidth||0}function hA(n){return ms&&!n?window.innerHeight:typeof n=="object"&&n.clientHeight||0}function dA(n){const l=ms&&!n?window.navigator.userAgent:"ssr";function p(he){return!!l.match(he)}const v=p(/android/i),A=p(/iphone|ipad|ipod/i),R=p(/cordova/i),D=p(/electron/i),i=p(/chrome/i),G=p(/edge/i),W=p(/firefox/i),H=p(/opera/i),ee=p(/win/i),ne=p(/mac/i),de=p(/linux/i);return{android:v,ios:A,cordova:R,electron:D,chrome:i,edge:G,firefox:W,opera:H,win:ee,mac:ne,linux:de,touch:yN,ssr:l==="ssr"}}function o8(n,l){const{thresholds:p,mobileBreakpoint:v}=s8(n),A=Nn(hA(l)),R=Nn(dA(l)),D=Zi({}),i=Nn(uA(l));function G(){A.value=hA(),i.value=uA()}function W(){G(),R.value=dA()}return kd(()=>{const H=i.value<p.sm,ee=i.value<p.md&&!H,ne=i.value<p.lg&&!(ee||H),de=i.value<p.xl&&!(ne||ee||H),he=i.value<p.xxl&&!(de||ne||ee||H),ye=i.value>=p.xxl,Le=H?"xs":ee?"sm":ne?"md":de?"lg":he?"xl":"xxl",je=typeof v=="number"?v:p[v],xt=i.value<je;D.xs=H,D.sm=ee,D.md=ne,D.lg=de,D.xl=he,D.xxl=ye,D.smAndUp=!H,D.mdAndUp=!(H||ee),D.lgAndUp=!(H||ee||ne),D.xlAndUp=!(H||ee||ne||de),D.smAndDown=!(ne||de||he||ye),D.mdAndDown=!(de||he||ye),D.lgAndDown=!(he||ye),D.xlAndDown=!ye,D.name=Le,D.height=A.value,D.width=i.value,D.mobile=xt,D.mobileBreakpoint=v,D.platform=R.value,D.thresholds=p}),ms&&window.addEventListener("resize",G,{passive:!0}),{...Ty(D),update:W,ssr:!!l}}const dC=fn({mobile:{type:Boolean,default:!1},mobileBreakpoint:[Number,String]},"display");function fC(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{mobile:null},l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ic();const p=Mn(n1);if(!p)throw new Error("Could not find Vuetify display injection");const v=it(()=>n.mobile?!0:typeof n.mobileBreakpoint=="number"?p.width.value<n.mobileBreakpoint:n.mobileBreakpoint?p.width.value<p.thresholds.value[n.mobileBreakpoint]:n.mobile===null?p.mobile.value:!1),A=it(()=>l?{[`${l}--mobile`]:v.value}:{});return{...p,displayClasses:A,mobile:v}}const pC=Symbol.for("vuetify:goto");function mC(){return{container:void 0,duration:300,layout:!1,offset:0,easing:"easeInOutCubic",patterns:{linear:n=>n,easeInQuad:n=>n**2,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n**2:-1+(4-2*n)*n,easeInCubic:n=>n**3,easeOutCubic:n=>--n**3+1,easeInOutCubic:n=>n<.5?4*n**3:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n**4,easeOutQuart:n=>1- --n**4,easeInOutQuart:n=>n<.5?8*n**4:1-8*--n**4,easeInQuint:n=>n**5,easeOutQuint:n=>1+--n**5,easeInOutQuint:n=>n<.5?16*n**5:1+16*--n**5}}}function a8(n){return lb(n)??(document.scrollingElement||document.body)}function lb(n){return typeof n=="string"?document.querySelector(n):z3(n)}function Sx(n,l,p){if(typeof n=="number")return l&&p?-n:n;let v=lb(n),A=0;for(;v;)A+=l?v.offsetLeft:v.offsetTop,v=v.offsetParent;return A}function l8(n,l){return{rtl:l.isRtl,options:_s(mC(),n)}}async function fA(n,l,p,v){const A=p?"scrollLeft":"scrollTop",R=_s((v==null?void 0:v.options)??mC(),l),D=v==null?void 0:v.rtl.value,i=(typeof n=="number"?n:lb(n))??0,G=R.container==="parent"&&i instanceof HTMLElement?i.parentElement:a8(R.container),W=typeof R.easing=="function"?R.easing:R.patterns[R.easing];if(!W)throw new TypeError(`Easing function "${R.easing}" not found.`);let H;if(typeof i=="number")H=Sx(i,p,D);else if(H=Sx(i,p,D)-Sx(G,p,D),R.layout){const he=window.getComputedStyle(i).getPropertyValue("--v-layout-top");he&&(H-=parseInt(he,10))}H+=R.offset,H=u8(G,H,!!D,!!p);const ee=G[A]??0;if(H===ee)return Promise.resolve(H);const ne=performance.now();return new Promise(de=>requestAnimationFrame(function he(ye){const je=(ye-ne)/R.duration,xt=Math.floor(ee+(H-ee)*W(uy(je,0,1)));if(G[A]=xt,je>=1&&Math.abs(xt-G[A])<10)return de(H);if(je>2)return de(G[A]);requestAnimationFrame(he)}))}function c8(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const l=Mn(pC),{isRtl:p}=Gd();if(!l)throw new Error("[Vuetify] Could not find injected goto instance");const v={...l,rtl:it(()=>l.rtl.value||p.value)};async function A(R,D){return fA(R,_s(n,D),!1,v)}return A.horizontal=async(R,D)=>fA(R,_s(n,D),!0,v),A}function u8(n,l,p,v){const{scrollWidth:A,scrollHeight:R}=n,[D,i]=n===document.scrollingElement?[window.innerWidth,window.innerHeight]:[n.offsetWidth,n.offsetHeight];let G,W;return v?p?(G=-(A-D),W=0):(G=0,W=A-D):(G=0,W=R+-i),Math.max(Math.min(l,W),G)}const _C=fn({modelValue:{type:null,default:void 0},multiple:Boolean,mandatory:[Boolean,String],max:Number,selectedClass:String,disabled:Boolean},"group"),h8=fn({value:null,disabled:Boolean,selectedClass:String},"group-item");function d8(n,l){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const v=Ns("useGroupItem");if(!v)throw new Error("[Vuetify] useGroupItem composable must be used inside a component setup function");const A=Gy();go(Symbol.for(`${l.description}:id`),A);const R=Mn(l,null);if(!R){if(!p)return R;throw new Error(`[Vuetify] Could not find useGroup injection with symbol ${l.description}`)}const D=ps(n,"value"),i=it(()=>!!(R.disabled.value||n.disabled));R.register({id:A,value:D,disabled:i},v),Va(()=>{R.unregister(A)});const G=it(()=>R.isSelected(A)),W=it(()=>R.items.value[0].id===A),H=it(()=>R.items.value[R.items.value.length-1].id===A),ee=it(()=>G.value&&[R.selectedClass.value,n.selectedClass]);return Tn(G,ne=>{v.emit("group:selected",{value:ne})},{flush:"sync"}),{id:A,isSelected:G,isFirst:W,isLast:H,toggle:()=>R.select(A,!G.value),select:ne=>R.select(A,ne),selectedClass:ee,value:D,disabled:i,group:R}}function gC(n,l){let p=!1;const v=Zi([]),A=Bm(n,"modelValue",[],ne=>ne==null?[]:yC(v,SN(ne)),ne=>{const de=p8(v,ne);return n.multiple?de:de[0]}),R=Ns("useGroup");function D(ne,de){const he=ne,ye=Symbol.for(`${l.description}:id`),je=xd(ye,R==null?void 0:R.vnode).indexOf(de);vt(he.value)==null&&(he.value=je,he.useIndexAsValue=!0),je>-1?v.splice(je,0,he):v.push(he)}function i(ne){if(p)return;G();const de=v.findIndex(he=>he.id===ne);v.splice(de,1)}function G(){const ne=v.find(de=>!de.disabled);ne&&n.mandatory==="force"&&!A.value.length&&(A.value=[ne.id])}da(()=>{G()}),Va(()=>{p=!0}),w1(()=>{for(let ne=0;ne<v.length;ne++)v[ne].useIndexAsValue&&(v[ne].value=ne)});function W(ne,de){const he=v.find(ye=>ye.id===ne);if(!(de&&(he!=null&&he.disabled)))if(n.multiple){const ye=A.value.slice(),Le=ye.findIndex(xt=>xt===ne),je=~Le;if(de=de??!je,je&&n.mandatory&&ye.length<=1||!je&&n.max!=null&&ye.length+1>n.max)return;Le<0&&de?ye.push(ne):Le>=0&&!de&&ye.splice(Le,1),A.value=ye}else{const ye=A.value.includes(ne);if(n.mandatory&&ye)return;A.value=de??!ye?[ne]:[]}}function H(ne){if(n.multiple,A.value.length){const de=A.value[0],he=v.findIndex(je=>je.id===de);let ye=(he+ne)%v.length,Le=v[ye];for(;Le.disabled&&ye!==he;)ye=(ye+ne)%v.length,Le=v[ye];if(Le.disabled)return;A.value=[v[ye].id]}else{const de=v.find(he=>!he.disabled);de&&(A.value=[de.id])}}const ee={register:D,unregister:i,selected:A,select:W,disabled:ps(n,"disabled"),prev:()=>H(v.length-1),next:()=>H(1),isSelected:ne=>A.value.includes(ne),selectedClass:it(()=>n.selectedClass),items:it(()=>v),getItemIndex:ne=>f8(v,ne)};return go(l,ee),ee}function f8(n,l){const p=yC(n,[l]);return p.length?n.findIndex(v=>v.id===p[0]):-1}function yC(n,l){const p=[];return l.forEach(v=>{const A=n.find(D=>$y(v,D.value)),R=n[v];(A==null?void 0:A.value)!=null?p.push(A.id):R!=null&&p.push(R.id)}),p}function p8(n,l){const p=[];return l.forEach(v=>{const A=n.findIndex(R=>R.id===v);if(~A){const R=n[A];p.push(R.value!=null?R.value:A)}}),p}function i1(n){let l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"content";const p=CN(),v=hn();if(ms){const A=new ResizeObserver(R=>{R.length&&(l==="content"?v.value=R[0].contentRect:v.value=R[0].target.getBoundingClientRect())});Va(()=>{A.disconnect()}),Tn(()=>p.el,(R,D)=>{D&&(A.unobserve(D),v.value=void 0),R&&A.observe(R)},{flush:"post"})}return{resizeRef:p,contentRect:Od(v)}}function m8(n){let{selectedElement:l,containerElement:p,isRtl:v,isHorizontal:A}=n;const R=Em(A,p),D=vC(A,v,p),i=Em(A,l),G=xC(A,l),W=i*.4;return D>G?G-W:D+R<G+i?G-R+i+W:D}function _8(n){let{selectedElement:l,containerElement:p,isHorizontal:v}=n;const A=Em(v,p),R=xC(v,l),D=Em(v,l);return R-A/2+D/2}function pA(n,l){const p=n?"scrollWidth":"scrollHeight";return(l==null?void 0:l[p])||0}function g8(n,l){const p=n?"clientWidth":"clientHeight";return(l==null?void 0:l[p])||0}function vC(n,l,p){if(!p)return 0;const{scrollLeft:v,offsetWidth:A,scrollWidth:R}=p;return n?l?R-A+v:v:p.scrollTop}function Em(n,l){const p=n?"offsetWidth":"offsetHeight";return(l==null?void 0:l[p])||0}function xC(n,l){const p=n?"offsetLeft":"offsetTop";return(l==null?void 0:l[p])||0}const y8=Symbol.for("vuetify:v-slide-group"),bC=fn({centerActive:Boolean,direction:{type:String,default:"horizontal"},symbol:{type:null,default:y8},nextIcon:{type:mo,default:"$next"},prevIcon:{type:mo,default:"$prev"},showArrows:{type:[Boolean,String],validator:n=>typeof n=="boolean"||["always","desktop","mobile"].includes(n)},...Hi(),...dC({mobile:null}),...vo(),..._C({selectedClass:"v-slide-group-item--active"})},"VSlideGroup"),mA=yi()({name:"VSlideGroup",props:bC(),emits:{"update:modelValue":n=>!0},setup(n,l){let{slots:p}=l;const{isRtl:v}=Gd(),{displayClasses:A,mobile:R}=fC(n),D=gC(n,n.symbol),i=Nn(!1),G=Nn(0),W=Nn(0),H=Nn(0),ee=it(()=>n.direction==="horizontal"),{resizeRef:ne,contentRect:de}=i1(),{resizeRef:he,contentRect:ye}=i1(),Le=c8(),je=it(()=>({container:ne.el,duration:200,easing:"easeOutQuart"})),xt=it(()=>D.selected.value.length?D.items.value.findIndex(ur=>ur.id===D.selected.value[0]):-1),Dt=it(()=>D.selected.value.length?D.items.value.findIndex(ur=>ur.id===D.selected.value[D.selected.value.length-1]):-1);if(ms){let ur=-1;Tn(()=>[D.selected.value,de.value,ye.value,ee.value],()=>{cancelAnimationFrame(ur),ur=requestAnimationFrame(()=>{if(de.value&&ye.value){const rr=ee.value?"width":"height";W.value=de.value[rr],H.value=ye.value[rr],i.value=W.value+1<H.value}if(xt.value>=0&&he.el){const rr=he.el.children[Dt.value];ht(rr,n.centerActive)}})})}const ut=Nn(!1);function ht(ur,rr){let $t=0;rr?$t=_8({containerElement:ne.el,isHorizontal:ee.value,selectedElement:ur}):$t=m8({containerElement:ne.el,isHorizontal:ee.value,isRtl:v.value,selectedElement:ur}),Et($t)}function Et(ur){if(!ms||!ne.el)return;const rr=Em(ee.value,ne.el),$t=vC(ee.value,v.value,ne.el);if(!(pA(ee.value,ne.el)<=rr||Math.abs(ur-$t)<16)){if(ee.value&&v.value&&ne.el){const{scrollWidth:hi,offsetWidth:yn}=ne.el;ur=hi-yn-ur}ee.value?Le.horizontal(ur,je.value):Le(ur,je.value)}}function tt(ur){const{scrollTop:rr,scrollLeft:$t}=ur.target;G.value=ee.value?$t:rr}function At(ur){if(ut.value=!0,!(!i.value||!he.el)){for(const rr of ur.composedPath())for(const $t of he.el.children)if($t===rr){ht($t);return}}}function pt(ur){ut.value=!1}let at=!1;function gt(ur){var rr;!at&&!ut.value&&!(ur.relatedTarget&&((rr=he.el)!=null&&rr.contains(ur.relatedTarget)))&&Zt(),at=!1}function yt(){at=!0}function sr(ur){if(!he.el)return;function rr($t){ur.preventDefault(),Zt($t)}ee.value?ur.key==="ArrowRight"?rr(v.value?"prev":"next"):ur.key==="ArrowLeft"&&rr(v.value?"next":"prev"):ur.key==="ArrowDown"?rr("next"):ur.key==="ArrowUp"&&rr("prev"),ur.key==="Home"?rr("first"):ur.key==="End"&&rr("last")}function zr(ur,rr){if(!ur)return;let $t=ur;do $t=$t==null?void 0:$t[rr==="next"?"nextElementSibling":"previousElementSibling"];while($t!=null&&$t.hasAttribute("disabled"));return $t}function Zt(ur){if(!he.el)return;let rr;if(!ur)rr=MN(he.el)[0];else if(ur==="next"){if(rr=zr(he.el.querySelector(":focus"),ur),!rr)return Zt("first")}else if(ur==="prev"){if(rr=zr(he.el.querySelector(":focus"),ur),!rr)return Zt("last")}else ur==="first"?(rr=he.el.firstElementChild,rr!=null&&rr.hasAttribute("disabled")&&(rr=zr(rr,"next"))):ur==="last"&&(rr=he.el.lastElementChild,rr!=null&&rr.hasAttribute("disabled")&&(rr=zr(rr,"prev")));rr&&rr.focus({preventScroll:!0})}function Ir(ur){const rr=ee.value&&v.value?-1:1,$t=(ur==="prev"?-rr:rr)*W.value;let vi=G.value+$t;if(ee.value&&v.value&&ne.el){const{scrollWidth:hi,offsetWidth:yn}=ne.el;vi+=hi-yn}Et(vi)}const vr=it(()=>({next:D.next,prev:D.prev,select:D.select,isSelected:D.isSelected})),Vr=it(()=>{switch(n.showArrows){case"always":return!0;case"desktop":return!R.value;case!0:return i.value||Math.abs(G.value)>0;case"mobile":return R.value||i.value||Math.abs(G.value)>0;default:return!R.value&&(i.value||Math.abs(G.value)>0)}}),lr=it(()=>Math.abs(G.value)>1),Hr=it(()=>{if(!ne.value)return!1;const ur=pA(ee.value,ne.el),rr=g8(ee.value,ne.el);return ur-rr-Math.abs(G.value)>1});return gs(()=>dt(n.tag,{class:["v-slide-group",{"v-slide-group--vertical":!ee.value,"v-slide-group--has-affixes":Vr.value,"v-slide-group--is-overflowing":i.value},A.value,n.class],style:n.style,tabindex:ut.value||D.selected.value.length?-1:0,onFocus:gt},{default:()=>{var ur,rr,$t;return[Vr.value&&dt("div",{key:"prev",class:["v-slide-group__prev",{"v-slide-group__prev--disabled":!lr.value}],onMousedown:yt,onClick:()=>lr.value&&Ir("prev")},[((ur=p.prev)==null?void 0:ur.call(p,vr.value))??dt(lA,null,{default:()=>[dt(aa,{icon:v.value?n.nextIcon:n.prevIcon},null)]})]),dt("div",{key:"container",ref:ne,class:"v-slide-group__container",onScroll:tt},[dt("div",{ref:he,class:"v-slide-group__content",onFocusin:At,onFocusout:pt,onKeydown:sr},[(rr=p.default)==null?void 0:rr.call(p,vr.value)])]),Vr.value&&dt("div",{key:"next",class:["v-slide-group__next",{"v-slide-group__next--disabled":!Hr.value}],onMousedown:yt,onClick:()=>Hr.value&&Ir("next")},[(($t=p.next)==null?void 0:$t.call(p,vr.value))??dt(lA,null,{default:()=>[dt(aa,{icon:v.value?n.prevIcon:n.nextIcon},null)]})])]}})),{selected:D.selected,scrollTo:Ir,scrollOffset:G,focus:Zt,hasPrev:lr,hasNext:Hr}}}),wC=Symbol.for("vuetify:v-chip-group"),v8=fn({column:Boolean,filter:Boolean,valueComparator:{type:Function,default:$y},...bC(),...Hi(),..._C({selectedClass:"v-chip--selected"}),...vo(),...ju(),...Yy({variant:"tonal"})},"VChipGroup");yi()({name:"VChipGroup",props:v8(),emits:{"update:modelValue":n=>!0},setup(n,l){let{slots:p}=l;const{themeClasses:v}=$u(n),{isSelected:A,select:R,next:D,prev:i,selected:G}=gC(n,wC);return Hy({VChip:{color:ps(n,"color"),disabled:ps(n,"disabled"),filter:ps(n,"filter"),variant:ps(n,"variant")}}),gs(()=>{const W=mA.filterProps(n);return dt(mA,Ys(W,{class:["v-chip-group",{"v-chip-group--column":n.column},v.value,n.class],style:n.style}),{default:()=>{var H;return[(H=p.default)==null?void 0:H.call(p,{isSelected:A,select:R,next:D,prev:i,selected:G.value})]}})}),{}}});const x8=fn({activeClass:String,appendAvatar:String,appendIcon:mo,closable:Boolean,closeIcon:{type:mo,default:"$delete"},closeLabel:{type:String,default:"$vuetify.close"},draggable:Boolean,filter:Boolean,filterIcon:{type:mo,default:"$complete"},label:Boolean,link:{type:Boolean,default:void 0},pill:Boolean,prependAvatar:String,prependIcon:mo,ripple:{type:[Boolean,Object],default:!0},text:{type:[String,Number,Boolean],default:void 0},modelValue:{type:Boolean,default:!0},onClick:$E(),onClickOnce:$E(),...Zy(),...Hi(),...Ky(),...sb(),...h8(),...jd(),...eC(),...eb(),...vo({tag:"span"}),...ju(),...Yy({variant:"tonal"})},"VChip"),b8=yi()({name:"VChip",directives:{Ripple:cC},props:x8(),emits:{"click:close":n=>!0,"update:modelValue":n=>!0,"group:selected":n=>!0,click:n=>!0},setup(n,l){let{attrs:p,emit:v,slots:A}=l;const{t:R}=FV(),{borderClasses:D}=Xy(n),{colorClasses:i,colorStyles:G,variantClasses:W}=ib(n),{densityClasses:H}=rb(n),{elevationClasses:ee}=ob(n),{roundedClasses:ne}=$d(n),{sizeClasses:de}=tb(n),{themeClasses:he}=$u(n),ye=Bm(n,"modelValue"),Le=d8(n,wC,!1),je=Q3(n,p),xt=it(()=>n.link!==!1&&je.isLink.value),Dt=it(()=>!n.disabled&&n.link!==!1&&(!!Le||n.link||je.isClickable.value)),ut=it(()=>({"aria-label":R(n.closeLabel),onClick(tt){tt.preventDefault(),tt.stopPropagation(),ye.value=!1,v("click:close",tt)}}));function ht(tt){var At;v("click",tt),Dt.value&&((At=je.navigate)==null||At.call(je,tt),Le==null||Le.toggle())}function Et(tt){(tt.key==="Enter"||tt.key===" ")&&(tt.preventDefault(),ht(tt))}return()=>{var Zt;const tt=je.isLink.value?"a":n.tag,At=!!(n.appendIcon||n.appendAvatar),pt=!!(At||A.append),at=!!(A.close||n.closable),gt=!!(A.filter||n.filter)&&Le,yt=!!(n.prependIcon||n.prependAvatar),sr=!!(yt||A.prepend),zr=!Le||Le.isSelected.value;return ye.value&&um(dt(tt,Ys({class:["v-chip",{"v-chip--disabled":n.disabled,"v-chip--label":n.label,"v-chip--link":Dt.value,"v-chip--filter":gt,"v-chip--pill":n.pill,[`${n.activeClass}`]:n.activeClass&&((Zt=je.isActive)==null?void 0:Zt.value)},he.value,D.value,zr?i.value:void 0,H.value,ee.value,ne.value,de.value,W.value,Le==null?void 0:Le.selectedClass.value,n.class],style:[zr?G.value:void 0,n.style],disabled:n.disabled||void 0,draggable:n.draggable,tabindex:Dt.value?0:void 0,onClick:ht,onKeydown:Dt.value&&!xt.value&&Et},je.linkProps),{default:()=>{var Ir;return[nb(Dt.value,"v-chip"),gt&&dt(i8,{key:"filter"},{default:()=>[um(dt("div",{class:"v-chip__filter"},[A.filter?dt(_l,{key:"filter-defaults",disabled:!n.filterIcon,defaults:{VIcon:{icon:n.filterIcon}}},A.filter):dt(aa,{key:"filter-icon",icon:n.filterIcon},null)]),[[WM,Le.isSelected.value]])]}),sr&&dt("div",{key:"prepend",class:"v-chip__prepend"},[A.prepend?dt(_l,{key:"prepend-defaults",disabled:!yt,defaults:{VAvatar:{image:n.prependAvatar,start:!0},VIcon:{icon:n.prependIcon,start:!0}}},A.prepend):dt(ti,null,[n.prependIcon&&dt(aa,{key:"prepend-icon",icon:n.prependIcon,start:!0},null),n.prependAvatar&&dt(wm,{key:"prepend-avatar",image:n.prependAvatar,start:!0},null)])]),dt("div",{class:"v-chip__content","data-no-activator":""},[((Ir=A.default)==null?void 0:Ir.call(A,{isSelected:Le==null?void 0:Le.isSelected.value,selectedClass:Le==null?void 0:Le.selectedClass.value,select:Le==null?void 0:Le.select,toggle:Le==null?void 0:Le.toggle,value:Le==null?void 0:Le.value.value,disabled:n.disabled}))??Xs(n.text)]),pt&&dt("div",{key:"append",class:"v-chip__append"},[A.append?dt(_l,{key:"append-defaults",disabled:!At,defaults:{VAvatar:{end:!0,image:n.appendAvatar},VIcon:{end:!0,icon:n.appendIcon}}},A.append):dt(ti,null,[n.appendIcon&&dt(aa,{key:"append-icon",end:!0,icon:n.appendIcon},null),n.appendAvatar&&dt(wm,{key:"append-avatar",end:!0,image:n.appendAvatar},null)])]),at&&dt("button",Ys({key:"close",class:"v-chip__close",type:"button","data-testid":"close-chip"},ut.value),[A.close?dt(_l,{key:"close-defaults",defaults:{VIcon:{icon:n.closeIcon,size:"x-small"}}},A.close):dt(aa,{key:"close-icon",icon:n.closeIcon,size:"x-small"},null)])]}}),[[E1("ripple"),Dt.value&&n.ripple,null]])}}}),w8=fn({fluid:{type:Boolean,default:!1},...Hi(),...km(),...vo()},"VContainer"),T8=yi()({name:"VContainer",props:w8(),setup(n,l){let{slots:p}=l;const{rtlClasses:v}=Gd(),{dimensionStyles:A}=Fm(n);return gs(()=>dt(n.tag,{class:["v-container",{"v-container--fluid":n.fluid},v.value,n.class],style:[A.value,n.style]},p)),{}}}),TC=ab.reduce((n,l)=>(n[l]={type:[Boolean,String,Number],default:!1},n),{}),SC=ab.reduce((n,l)=>{const p="offset"+Ec(l);return n[p]={type:[String,Number],default:null},n},{}),EC=ab.reduce((n,l)=>{const p="order"+Ec(l);return n[p]={type:[String,Number],default:null},n},{}),_A={col:Object.keys(TC),offset:Object.keys(SC),order:Object.keys(EC)};function S8(n,l,p){let v=n;if(!(p==null||p===!1)){if(l){const A=l.replace(n,"");v+=`-${A}`}return n==="col"&&(v="v-"+v),n==="col"&&(p===""||p===!0)||(v+=`-${p}`),v.toLowerCase()}}const E8=["auto","start","end","center","baseline","stretch"],A8=fn({cols:{type:[Boolean,String,Number],default:!1},...TC,offset:{type:[String,Number],default:null},...SC,order:{type:[String,Number],default:null},...EC,alignSelf:{type:String,default:null,validator:n=>E8.includes(n)},...Hi(),...vo()},"VCol"),Fg=yi()({name:"VCol",props:A8(),setup(n,l){let{slots:p}=l;const v=it(()=>{const A=[];let R;for(R in _A)_A[R].forEach(i=>{const G=n[i],W=S8(R,i,G);W&&A.push(W)});const D=A.some(i=>i.startsWith("v-col-"));return A.push({"v-col":!D||!n.cols,[`v-col-${n.cols}`]:n.cols,[`offset-${n.offset}`]:n.offset,[`order-${n.order}`]:n.order,[`align-self-${n.alignSelf}`]:n.alignSelf}),A});return()=>{var A;return vl(n.tag,{class:[v.value,n.class],style:n.style},(A=p.default)==null?void 0:A.call(p))}}});function M8(n){let{rootEl:l,isSticky:p,layoutItemStyles:v}=n;const A=Nn(!1),R=Nn(0),D=it(()=>{const W=typeof A.value=="boolean"?"top":A.value;return[p.value?{top:"auto",bottom:"auto",height:void 0}:void 0,A.value?{[W]:oi(R.value)}:{top:v.value.top}]});da(()=>{Tn(p,W=>{W?window.addEventListener("scroll",G,{passive:!0}):window.removeEventListener("scroll",G)},{immediate:!0})}),Va(()=>{window.removeEventListener("scroll",G)});let i=0;function G(){const W=i>window.scrollY?"up":"down",H=l.value.getBoundingClientRect(),ee=parseFloat(v.value.top??0),ne=window.scrollY-Math.max(0,R.value-ee),de=H.height+Math.max(R.value,ee)-window.scrollY-window.innerHeight,he=parseFloat(getComputedStyle(l.value).getPropertyValue("--v-body-scroll-y"))||0;H.height<window.innerHeight-ee?(A.value="top",R.value=ee):W==="up"&&A.value==="bottom"||W==="down"&&A.value==="top"?(R.value=window.scrollY+H.top-he,A.value=!0):W==="down"&&de<=0?(R.value=0,A.value="bottom"):W==="up"&&ne<=0&&(he?A.value!=="top"&&(R.value=-ne+he+ee,A.value="top"):(R.value=H.top+ne,A.value="top")),i=window.scrollY}return{isStuck:A,stickyStyles:D}}const I8=100,C8=20;function gA(n){return(n<0?-1:1)*Math.sqrt(Math.abs(n))*1.41421356237}function yA(n){if(n.length<2)return 0;if(n.length===2)return n[1].t===n[0].t?0:(n[1].d-n[0].d)/(n[1].t-n[0].t);let l=0;for(let p=n.length-1;p>0;p--){if(n[p].t===n[p-1].t)continue;const v=gA(l),A=(n[p].d-n[p-1].d)/(n[p].t-n[p-1].t);l+=(A-v)*Math.abs(A),p===n.length-1&&(l*=.5)}return gA(l)*1e3}function P8(){const n={};function l(A){Array.from(A.changedTouches).forEach(R=>{(n[R.identifier]??(n[R.identifier]=new AN(C8))).push([A.timeStamp,R])})}function p(A){Array.from(A.changedTouches).forEach(R=>{delete n[R.identifier]})}function v(A){var W;const R=(W=n[A])==null?void 0:W.values().reverse();if(!R)throw new Error(`No samples for touch id ${A}`);const D=R[0],i=[],G=[];for(const H of R){if(D[0]-H[0]>I8)break;i.push({t:H[0],d:H[1].clientX}),G.push({t:H[0],d:H[1].clientY})}return{x:yA(i),y:yA(G),get direction(){const{x:H,y:ee}=this,[ne,de]=[Math.abs(H),Math.abs(ee)];return ne>de&&H>=0?"right":ne>de&&H<=0?"left":de>ne&&ee>=0?"down":de>ne&&ee<=0?"up":R8()}}}return{addMovement:l,endTouch:p,getVelocity:v}}function R8(){throw new Error}function D8(n){let{el:l,isActive:p,isTemporary:v,width:A,touchless:R,position:D}=n;da(()=>{window.addEventListener("touchstart",xt,{passive:!0}),window.addEventListener("touchmove",Dt,{passive:!1}),window.addEventListener("touchend",ut,{passive:!0})}),Va(()=>{window.removeEventListener("touchstart",xt),window.removeEventListener("touchmove",Dt),window.removeEventListener("touchend",ut)});const i=it(()=>["left","right"].includes(D.value)),{addMovement:G,endTouch:W,getVelocity:H}=P8();let ee=!1;const ne=Nn(!1),de=Nn(0),he=Nn(0);let ye;function Le(Et,tt){return(D.value==="left"?Et:D.value==="right"?document.documentElement.clientWidth-Et:D.value==="top"?Et:D.value==="bottom"?document.documentElement.clientHeight-Et:_d())-(tt?A.value:0)}function je(Et){let tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const At=D.value==="left"?(Et-he.value)/A.value:D.value==="right"?(document.documentElement.clientWidth-Et-he.value)/A.value:D.value==="top"?(Et-he.value)/A.value:D.value==="bottom"?(document.documentElement.clientHeight-Et-he.value)/A.value:_d();return tt?Math.max(0,Math.min(1,At)):At}function xt(Et){if(R.value)return;const tt=Et.changedTouches[0].clientX,At=Et.changedTouches[0].clientY,pt=25,at=D.value==="left"?tt<pt:D.value==="right"?tt>document.documentElement.clientWidth-pt:D.value==="top"?At<pt:D.value==="bottom"?At>document.documentElement.clientHeight-pt:_d(),gt=p.value&&(D.value==="left"?tt<A.value:D.value==="right"?tt>document.documentElement.clientWidth-A.value:D.value==="top"?At<A.value:D.value==="bottom"?At>document.documentElement.clientHeight-A.value:_d());(at||gt||p.value&&v.value)&&(ye=[tt,At],he.value=Le(i.value?tt:At,p.value),de.value=je(i.value?tt:At),ee=he.value>-20&&he.value<80,W(Et),G(Et))}function Dt(Et){const tt=Et.changedTouches[0].clientX,At=Et.changedTouches[0].clientY;if(ee){if(!Et.cancelable){ee=!1;return}const at=Math.abs(tt-ye[0]),gt=Math.abs(At-ye[1]);(i.value?at>gt&&at>3:gt>at&&gt>3)?(ne.value=!0,ee=!1):(i.value?gt:at)>3&&(ee=!1)}if(!ne.value)return;Et.preventDefault(),G(Et);const pt=je(i.value?tt:At,!1);de.value=Math.max(0,Math.min(1,pt)),pt>1?he.value=Le(i.value?tt:At,!0):pt<0&&(he.value=Le(i.value?tt:At,!1))}function ut(Et){if(ee=!1,!ne.value)return;G(Et),ne.value=!1;const tt=H(Et.changedTouches[0].identifier),At=Math.abs(tt.x),pt=Math.abs(tt.y);(i.value?At>pt&&At>400:pt>At&&pt>3)?p.value=tt.direction===({left:"right",right:"left",top:"down",bottom:"up"}[D.value]||_d()):p.value=de.value>.5}const ht=it(()=>ne.value?{transform:D.value==="left"?`translateX(calc(-100% + ${de.value*A.value}px))`:D.value==="right"?`translateX(calc(100% - ${de.value*A.value}px))`:D.value==="top"?`translateY(calc(-100% + ${de.value*A.value}px))`:D.value==="bottom"?`translateY(calc(100% - ${de.value*A.value}px))`:_d(),transition:"none"}:void 0);return om(ne,()=>{var At,pt;const Et=((At=l.value)==null?void 0:At.style.transform)??null,tt=((pt=l.value)==null?void 0:pt.style.transition)??null;kd(()=>{var at,gt,yt,sr;(gt=l.value)==null||gt.style.setProperty("transform",((at=ht.value)==null?void 0:at.transform)||"none"),(sr=l.value)==null||sr.style.setProperty("transition",((yt=ht.value)==null?void 0:yt.transition)||null)}),by(()=>{var at,gt;(at=l.value)==null||at.style.setProperty("transform",Et),(gt=l.value)==null||gt.style.setProperty("transition",tt)})}),{isDragging:ne,dragProgress:de,dragStyles:ht}}function _d(){throw new Error}const Jy={"001":1,AD:1,AE:6,AF:6,AG:0,AI:1,AL:1,AM:1,AN:1,AR:1,AS:0,AT:1,AU:1,AX:1,AZ:1,BA:1,BD:0,BE:1,BG:1,BH:6,BM:1,BN:1,BR:0,BS:0,BT:0,BW:0,BY:1,BZ:0,CA:0,CH:1,CL:1,CM:1,CN:1,CO:0,CR:1,CY:1,CZ:1,DE:1,DJ:6,DK:1,DM:0,DO:0,DZ:6,EC:1,EE:1,EG:6,ES:1,ET:0,FI:1,FJ:1,FO:1,FR:1,GB:1,"GB-alt-variant":0,GE:1,GF:1,GP:1,GR:1,GT:0,GU:0,HK:0,HN:0,HR:1,HU:1,ID:0,IE:1,IL:0,IN:0,IQ:6,IR:6,IS:1,IT:1,JM:0,JO:6,JP:0,KE:0,KG:1,KH:0,KR:0,KW:6,KZ:1,LA:0,LB:1,LI:1,LK:1,LT:1,LU:1,LV:1,LY:6,MC:1,MD:1,ME:1,MH:0,MK:1,MM:0,MN:1,MO:0,MQ:1,MT:0,MV:5,MX:0,MY:1,MZ:0,NI:0,NL:1,NO:1,NP:0,NZ:1,OM:6,PA:0,PE:0,PH:0,PK:0,PL:1,PR:0,PT:0,PY:0,QA:6,RE:1,RO:1,RS:1,RU:1,SA:0,SD:6,SE:1,SG:0,SI:1,SK:1,SM:1,SV:0,SY:6,TH:0,TJ:1,TM:1,TR:1,TT:0,TW:0,UA:1,UM:0,US:0,UY:1,UZ:1,VA:1,VE:0,VI:0,VN:1,WS:0,XK:1,YE:0,ZA:0,ZW:0};function z8(n,l,p){const v=[];let A=[];const R=AC(n),D=MC(n),i=p??Jy[l.slice(-2).toUpperCase()]??0,G=(R.getDay()-i+7)%7,W=(D.getDay()-i+7)%7;for(let H=0;H<G;H++){const ee=new Date(R);ee.setDate(ee.getDate()-(G-H)),A.push(ee)}for(let H=1;H<=D.getDate();H++){const ee=new Date(n.getFullYear(),n.getMonth(),H);A.push(ee),A.length===7&&(v.push(A),A=[])}for(let H=1;H<7-W;H++){const ee=new Date(D);ee.setDate(ee.getDate()+H),A.push(ee)}return A.length>0&&v.push(A),v}function L8(n,l,p){const v=p??Jy[l.slice(-2).toUpperCase()]??0,A=new Date(n);for(;A.getDay()!==v;)A.setDate(A.getDate()-1);return A}function O8(n,l){const p=new Date(n),v=((Jy[l.slice(-2).toUpperCase()]??0)+6)%7;for(;p.getDay()!==v;)p.setDate(p.getDate()+1);return p}function AC(n){return new Date(n.getFullYear(),n.getMonth(),1)}function MC(n){return new Date(n.getFullYear(),n.getMonth()+1,0)}function k8(n){const l=n.split("-").map(Number);return new Date(l[0],l[1]-1,l[2])}const F8=/^([12]\d{3}-([1-9]|0[1-9]|1[0-2])-([1-9]|0[1-9]|[12]\d|3[01]))$/;function IC(n){if(n==null)return new Date;if(n instanceof Date)return n;if(typeof n=="string"){let l;if(F8.test(n))return k8(n);if(l=Date.parse(n),!isNaN(l))return new Date(l)}return null}const vA=new Date(2e3,0,2);function B8(n,l){const p=l??Jy[n.slice(-2).toUpperCase()]??0;return D3(7).map(v=>{const A=new Date(vA);return A.setDate(vA.getDate()+p+v),new Intl.DateTimeFormat(n,{weekday:"narrow"}).format(A)})}function N8(n,l,p,v){const A=IC(n)??new Date,R=v==null?void 0:v[l];if(typeof R=="function")return R(A,l,p);let D={};switch(l){case"fullDate":D={year:"numeric",month:"long",day:"numeric"};break;case"fullDateWithWeekday":D={weekday:"long",year:"numeric",month:"long",day:"numeric"};break;case"normalDate":const i=A.getDate(),G=new Intl.DateTimeFormat(p,{month:"long"}).format(A);return`${i} ${G}`;case"normalDateWithWeekday":D={weekday:"short",day:"numeric",month:"short"};break;case"shortDate":D={month:"short",day:"numeric"};break;case"year":D={year:"numeric"};break;case"month":D={month:"long"};break;case"monthShort":D={month:"short"};break;case"monthAndYear":D={month:"long",year:"numeric"};break;case"monthAndDate":D={month:"long",day:"numeric"};break;case"weekday":D={weekday:"long"};break;case"weekdayShort":D={weekday:"short"};break;case"dayOfMonth":return new Intl.NumberFormat(p).format(A.getDate());case"hours12h":D={hour:"numeric",hour12:!0};break;case"hours24h":D={hour:"numeric",hour12:!1};break;case"minutes":D={minute:"numeric"};break;case"seconds":D={second:"numeric"};break;case"fullTime":D={hour:"numeric",minute:"numeric"};break;case"fullTime12h":D={hour:"numeric",minute:"numeric",hour12:!0};break;case"fullTime24h":D={hour:"numeric",minute:"numeric",hour12:!1};break;case"fullDateTime":D={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};break;case"fullDateTime12h":D={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0};break;case"fullDateTime24h":D={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1};break;case"keyboardDate":D={year:"numeric",month:"2-digit",day:"2-digit"};break;case"keyboardDateTime":return D={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric"},new Intl.DateTimeFormat(p,D).format(A).replace(/, /g," ");case"keyboardDateTime12h":return D={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",hour12:!0},new Intl.DateTimeFormat(p,D).format(A).replace(/, /g," ");case"keyboardDateTime24h":return D={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",hour12:!1},new Intl.DateTimeFormat(p,D).format(A).replace(/, /g," ");default:D=R??{timeZone:"UTC",timeZoneName:"short"}}return new Intl.DateTimeFormat(p,D).format(A)}function V8(n,l){const p=n.toJsDate(l),v=p.getFullYear(),A=jE(String(p.getMonth()+1),2,"0"),R=jE(String(p.getDate()),2,"0");return`${v}-${A}-${R}`}function U8(n){const[l,p,v]=n.split("-").map(Number);return new Date(l,p-1,v)}function j8(n,l){const p=new Date(n);return p.setMinutes(p.getMinutes()+l),p}function $8(n,l){const p=new Date(n);return p.setHours(p.getHours()+l),p}function G8(n,l){const p=new Date(n);return p.setDate(p.getDate()+l),p}function H8(n,l){const p=new Date(n);return p.setDate(p.getDate()+l*7),p}function q8(n,l){const p=new Date(n);return p.setDate(1),p.setMonth(p.getMonth()+l),p}function W8(n){return n.getFullYear()}function Z8(n){return n.getMonth()}function X8(n){return n.getDate()}function K8(n){return new Date(n.getFullYear(),n.getMonth()+1,1)}function Y8(n){return new Date(n.getFullYear(),n.getMonth()-1,1)}function J8(n){return n.getHours()}function Q8(n){return n.getMinutes()}function eU(n){return new Date(n.getFullYear(),0,1)}function tU(n){return new Date(n.getFullYear(),11,31)}function rU(n,l){return my(n,l[0])&&sU(n,l[1])}function nU(n){const l=new Date(n);return l instanceof Date&&!isNaN(l.getTime())}function my(n,l){return n.getTime()>l.getTime()}function iU(n,l){return my(s1(n),s1(l))}function sU(n,l){return n.getTime()<l.getTime()}function xA(n,l){return n.getTime()===l.getTime()}function oU(n,l){return n.getDate()===l.getDate()&&n.getMonth()===l.getMonth()&&n.getFullYear()===l.getFullYear()}function aU(n,l){return n.getMonth()===l.getMonth()&&n.getFullYear()===l.getFullYear()}function lU(n,l){return n.getFullYear()===l.getFullYear()}function cU(n,l,p){const v=new Date(n),A=new Date(l);switch(p){case"years":return v.getFullYear()-A.getFullYear();case"quarters":return Math.floor((v.getMonth()-A.getMonth()+(v.getFullYear()-A.getFullYear())*12)/4);case"months":return v.getMonth()-A.getMonth()+(v.getFullYear()-A.getFullYear())*12;case"weeks":return Math.floor((v.getTime()-A.getTime())/(1e3*60*60*24*7));case"days":return Math.floor((v.getTime()-A.getTime())/(1e3*60*60*24));case"hours":return Math.floor((v.getTime()-A.getTime())/(1e3*60*60));case"minutes":return Math.floor((v.getTime()-A.getTime())/(1e3*60));case"seconds":return Math.floor((v.getTime()-A.getTime())/1e3);default:return v.getTime()-A.getTime()}}function uU(n,l){const p=new Date(n);return p.setHours(l),p}function hU(n,l){const p=new Date(n);return p.setMinutes(l),p}function dU(n,l){const p=new Date(n);return p.setMonth(l),p}function fU(n,l){const p=new Date(n);return p.setDate(l),p}function pU(n,l){const p=new Date(n);return p.setFullYear(l),p}function s1(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0)}function mU(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999)}class _U{constructor(l){this.locale=l.locale,this.formats=l.formats}date(l){return IC(l)}toJsDate(l){return l}toISO(l){return V8(this,l)}parseISO(l){return U8(l)}addMinutes(l,p){return j8(l,p)}addHours(l,p){return $8(l,p)}addDays(l,p){return G8(l,p)}addWeeks(l,p){return H8(l,p)}addMonths(l,p){return q8(l,p)}getWeekArray(l,p){return z8(l,this.locale,p?Number(p):void 0)}startOfWeek(l,p){return L8(l,this.locale,p?Number(p):void 0)}endOfWeek(l){return O8(l,this.locale)}startOfMonth(l){return AC(l)}endOfMonth(l){return MC(l)}format(l,p){return N8(l,p,this.locale,this.formats)}isEqual(l,p){return xA(l,p)}isValid(l){return nU(l)}isWithinRange(l,p){return rU(l,p)}isAfter(l,p){return my(l,p)}isAfterDay(l,p){return iU(l,p)}isBefore(l,p){return!my(l,p)&&!xA(l,p)}isSameDay(l,p){return oU(l,p)}isSameMonth(l,p){return aU(l,p)}isSameYear(l,p){return lU(l,p)}setMinutes(l,p){return hU(l,p)}setHours(l,p){return uU(l,p)}setMonth(l,p){return dU(l,p)}setDate(l,p){return fU(l,p)}setYear(l,p){return pU(l,p)}getDiff(l,p,v){return cU(l,p,v)}getWeekdays(l){return B8(this.locale,l?Number(l):void 0)}getYear(l){return W8(l)}getMonth(l){return Z8(l)}getDate(l){return X8(l)}getNextMonth(l){return K8(l)}getPreviousMonth(l){return Y8(l)}getHours(l){return J8(l)}getMinutes(l){return Q8(l)}startOfDay(l){return s1(l)}endOfDay(l){return mU(l)}startOfYear(l){return eU(l)}endOfYear(l){return tU(l)}}const gU=Symbol.for("vuetify:date-options"),bA=Symbol.for("vuetify:date-adapter");function yU(n,l){const p=_s({adapter:_U,locale:{af:"af-ZA",bg:"bg-BG",ca:"ca-ES",ckb:"",cs:"cs-CZ",de:"de-DE",el:"el-GR",en:"en-US",et:"et-EE",fa:"fa-IR",fi:"fi-FI",hr:"hr-HR",hu:"hu-HU",he:"he-IL",id:"id-ID",it:"it-IT",ja:"ja-JP",ko:"ko-KR",lv:"lv-LV",lt:"lt-LT",nl:"nl-NL",no:"no-NO",pl:"pl-PL",pt:"pt-PT",ro:"ro-RO",ru:"ru-RU",sk:"sk-SK",sl:"sl-SI",srCyrl:"sr-SP",srLatn:"sr-SP",sv:"sv-SE",th:"th-TH",tr:"tr-TR",az:"az-AZ",uk:"uk-UA",vi:"vi-VN",zhHans:"zh-CN",zhHant:"zh-TW"}},n);return{options:p,instance:vU(p,l)}}function vU(n,l){const p=Zi(typeof n.adapter=="function"?new n.adapter({locale:n.locale[l.current.value]??l.current.value,formats:n.formats}):n.adapter);return Tn(l.current,v=>{p.locale=n.locale[v]??v??p.locale}),p}const _y=Symbol.for("vuetify:layout"),CC=Symbol.for("vuetify:layout-item"),wA=1e3,xU=fn({overlaps:{type:Array,default:()=>[]},fullHeight:Boolean},"layout"),bU=fn({name:{type:String},order:{type:[Number,String],default:0},absolute:Boolean},"layout-item");function wU(){const n=Mn(_y);if(!n)throw new Error("[Vuetify] Could not find injected layout");return{getLayoutItem:n.getLayoutItem,mainRect:n.mainRect,mainStyles:n.mainStyles}}function TU(n){const l=Mn(_y);if(!l)throw new Error("[Vuetify] Could not find injected layout");const p=n.id??`layout-item-${Gy()}`,v=Ns("useLayoutItem");go(CC,{id:p});const A=Nn(!1);dM(()=>A.value=!0),hM(()=>A.value=!1);const{layoutItemStyles:R,layoutItemScrimStyles:D}=l.register(v,{...n,active:it(()=>A.value?!1:n.active.value),id:p});return Va(()=>l.unregister(p)),{layoutItemStyles:R,layoutRect:l.layoutRect,layoutItemScrimStyles:D}}const SU=(n,l,p,v)=>{let A={top:0,left:0,right:0,bottom:0};const R=[{id:"",layer:{...A}}];for(const D of n){const i=l.get(D),G=p.get(D),W=v.get(D);if(!i||!G||!W)continue;const H={...A,[i.value]:parseInt(A[i.value],10)+(W.value?parseInt(G.value,10):0)};R.push({id:D,layer:H}),A=H}return R};function EU(n){const l=Mn(_y,null),p=it(()=>l?l.rootZIndex.value-100:wA),v=hn([]),A=Zi(new Map),R=Zi(new Map),D=Zi(new Map),i=Zi(new Map),G=Zi(new Map),{resizeRef:W,contentRect:H}=i1(),ee=it(()=>{const Et=new Map,tt=n.overlaps??[];for(const At of tt.filter(pt=>pt.includes(":"))){const[pt,at]=At.split(":");if(!v.value.includes(pt)||!v.value.includes(at))continue;const gt=A.get(pt),yt=A.get(at),sr=R.get(pt),zr=R.get(at);!gt||!yt||!sr||!zr||(Et.set(at,{position:gt.value,amount:parseInt(sr.value,10)}),Et.set(pt,{position:yt.value,amount:-parseInt(zr.value,10)}))}return Et}),ne=it(()=>{const Et=[...new Set([...D.values()].map(At=>At.value))].sort((At,pt)=>At-pt),tt=[];for(const At of Et){const pt=v.value.filter(at=>{var gt;return((gt=D.get(at))==null?void 0:gt.value)===At});tt.push(...pt)}return SU(tt,A,R,i)}),de=it(()=>!Array.from(G.values()).some(Et=>Et.value)),he=it(()=>ne.value[ne.value.length-1].layer),ye=it(()=>({"--v-layout-left":oi(he.value.left),"--v-layout-right":oi(he.value.right),"--v-layout-top":oi(he.value.top),"--v-layout-bottom":oi(he.value.bottom),...de.value?void 0:{transition:"none"}})),Le=it(()=>ne.value.slice(1).map((Et,tt)=>{let{id:At}=Et;const{layer:pt}=ne.value[tt],at=R.get(At),gt=A.get(At);return{id:At,...pt,size:Number(at.value),position:gt.value}})),je=Et=>Le.value.find(tt=>tt.id===Et),xt=Ns("createLayout"),Dt=Nn(!1);da(()=>{Dt.value=!0}),go(_y,{register:(Et,tt)=>{let{id:At,order:pt,position:at,layoutSize:gt,elementSize:yt,active:sr,disableTransitions:zr,absolute:Zt}=tt;D.set(At,pt),A.set(At,at),R.set(At,gt),i.set(At,sr),zr&&G.set(At,zr);const vr=xd(CC,xt==null?void 0:xt.vnode).indexOf(Et);vr>-1?v.value.splice(vr,0,At):v.value.push(At);const Vr=it(()=>Le.value.findIndex(rr=>rr.id===At)),lr=it(()=>p.value+ne.value.length*2-Vr.value*2),Hr=it(()=>{const rr=at.value==="left"||at.value==="right",$t=at.value==="right",vi=at.value==="bottom",hi=yt.value??gt.value,yn=hi===0?"%":"px",Pt={[at.value]:0,zIndex:lr.value,transform:`translate${rr?"X":"Y"}(${(sr.value?0:-(hi===0?100:hi))*($t||vi?-1:1)}${yn})`,position:Zt.value||p.value!==wA?"absolute":"fixed",...de.value?void 0:{transition:"none"}};if(!Dt.value)return Pt;const er=Le.value[Vr.value];if(!er)throw new Error(`[Vuetify] Could not find layout item "${At}"`);const Kt=ee.value.get(At);return Kt&&(er[Kt.position]+=Kt.amount),{...Pt,height:rr?`calc(100% - ${er.top}px - ${er.bottom}px)`:yt.value?`${yt.value}px`:void 0,left:$t?void 0:`${er.left}px`,right:$t?`${er.right}px`:void 0,top:at.value!=="bottom"?`${er.top}px`:void 0,bottom:at.value!=="top"?`${er.bottom}px`:void 0,width:rr?yt.value?`${yt.value}px`:void 0:`calc(100% - ${er.left}px - ${er.right}px)`}}),ur=it(()=>({zIndex:lr.value-1}));return{layoutItemStyles:Hr,layoutItemScrimStyles:ur,zIndex:lr}},unregister:Et=>{D.delete(Et),A.delete(Et),R.delete(Et),i.delete(Et),G.delete(Et),v.value=v.value.filter(tt=>tt!==Et)},mainRect:he,mainStyles:ye,getLayoutItem:je,items:Le,layoutRect:H,rootZIndex:p});const ut=it(()=>["v-layout",{"v-layout--full-height":n.fullHeight}]),ht=it(()=>({zIndex:l?p.value:void 0,position:l?"relative":void 0,overflow:l?"hidden":void 0}));return{layoutClasses:ut,layoutStyles:ht,getLayoutItem:je,items:Le,layoutRect:H,layoutRef:W}}const AU=fn({closeDelay:[Number,String],openDelay:[Number,String]},"delay");function MU(n,l){let p=()=>{};function v(D){p==null||p();const i=Number(D?n.openDelay:n.closeDelay);return new Promise(G=>{p=IN(i,()=>{l==null||l(D),G(D)})})}function A(){return v(!0)}function R(){return v(!1)}return{clearDelay:p,runOpenDelay:A,runCloseDelay:R}}function IU(){const l=Ns("useScopeId").vnode.scopeId;return{scopeId:l?{[l]:""}:void 0}}function PC(){const n=Nn(!1);return da(()=>{window.requestAnimationFrame(()=>{n.value=!0})}),{ssrBootStyles:it(()=>n.value?void 0:{transition:"none !important"}),isBooted:Od(n)}}const CU=["start","end","left","right","top","bottom"],PU=fn({color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:{type:Boolean,default:null},railWidth:{type:[Number,String],default:56},scrim:{type:[Boolean,String],default:!0},image:String,temporary:Boolean,persistent:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:n=>CU.includes(n)},sticky:Boolean,...Zy(),...Hi(),...AU(),...dC({mobile:null}),...sb(),...bU(),...jd(),...vo({tag:"nav"}),...ju()},"VNavigationDrawer"),RU=yi()({name:"VNavigationDrawer",props:PU(),emits:{"update:modelValue":n=>!0,"update:rail":n=>!0},setup(n,l){let{attrs:p,emit:v,slots:A}=l;const{isRtl:R}=Gd(),{themeClasses:D}=$u(n),{borderClasses:i}=Xy(n),{backgroundColorClasses:G,backgroundColorStyles:W}=Ad(ps(n,"color")),{elevationClasses:H}=ob(n),{displayClasses:ee,mobile:ne}=fC(n),{roundedClasses:de}=$d(n),he=XV(),ye=Bm(n,"modelValue",null,Hr=>!!Hr),{ssrBootStyles:Le}=PC(),{scopeId:je}=IU(),xt=hn(),Dt=Nn(!1),{runOpenDelay:ut,runCloseDelay:ht}=MU(n,Hr=>{Dt.value=Hr}),Et=it(()=>n.rail&&n.expandOnHover&&Dt.value?Number(n.width):Number(n.rail?n.railWidth:n.width)),tt=it(()=>Jx(n.location,R.value)),At=it(()=>n.persistent),pt=it(()=>!n.permanent&&(ne.value||n.temporary)),at=it(()=>n.sticky&&!pt.value&&tt.value!=="bottom");om(()=>n.expandOnHover&&n.rail!=null,()=>{Tn(Dt,Hr=>v("update:rail",!Hr))}),om(()=>!n.disableResizeWatcher,()=>{Tn(pt,Hr=>!n.permanent&&Zs(()=>ye.value=!Hr))}),om(()=>!n.disableRouteWatcher&&!!he,()=>{Tn(he.currentRoute,()=>pt.value&&(ye.value=!1))}),Tn(()=>n.permanent,Hr=>{Hr&&(ye.value=!0)}),n.modelValue==null&&!pt.value&&(ye.value=n.permanent||!ne.value);const{isDragging:gt,dragProgress:yt}=D8({el:xt,isActive:ye,isTemporary:pt,width:Et,touchless:ps(n,"touchless"),position:tt}),sr=it(()=>{const Hr=pt.value?0:n.rail&&n.expandOnHover?Number(n.railWidth):Et.value;return gt.value?Hr*yt.value:Hr}),{layoutItemStyles:zr,layoutItemScrimStyles:Zt}=TU({id:n.name,order:it(()=>parseInt(n.order,10)),position:tt,layoutSize:sr,elementSize:Et,active:it(()=>ye.value||gt.value),disableTransitions:it(()=>gt.value),absolute:it(()=>n.absolute||at.value&&typeof Ir.value!="string")}),{isStuck:Ir,stickyStyles:vr}=M8({rootEl:xt,isSticky:at,layoutItemStyles:zr}),Vr=Ad(it(()=>typeof n.scrim=="string"?n.scrim:null)),lr=it(()=>({...gt.value?{opacity:yt.value*.2,transition:"none"}:void 0,...Zt.value}));return Hy({VList:{bgColor:"transparent"}}),gs(()=>{const Hr=A.image||n.image;return dt(ti,null,[dt(n.tag,Ys({ref:xt,onMouseenter:ut,onMouseleave:ht,class:["v-navigation-drawer",`v-navigation-drawer--${tt.value}`,{"v-navigation-drawer--expand-on-hover":n.expandOnHover,"v-navigation-drawer--floating":n.floating,"v-navigation-drawer--is-hovering":Dt.value,"v-navigation-drawer--rail":n.rail,"v-navigation-drawer--temporary":pt.value,"v-navigation-drawer--persistent":At.value,"v-navigation-drawer--active":ye.value,"v-navigation-drawer--sticky":at.value},D.value,G.value,i.value,ee.value,H.value,de.value,n.class],style:[W.value,zr.value,Le.value,vr.value,n.style]},je,p),{default:()=>{var ur,rr,$t;return[Hr&&dt("div",{key:"image",class:"v-navigation-drawer__img"},[A.image?dt(_l,{key:"image-defaults",disabled:!n.image,defaults:{VImg:{alt:"",cover:!0,height:"inherit",src:n.image}}},A.image):dt(Wy,{key:"image-img",alt:"",cover:!0,height:"inherit",src:n.image},null)]),A.prepend&&dt("div",{class:"v-navigation-drawer__prepend"},[(ur=A.prepend)==null?void 0:ur.call(A)]),dt("div",{class:"v-navigation-drawer__content"},[(rr=A.default)==null?void 0:rr.call(A)]),A.append&&dt("div",{class:"v-navigation-drawer__append"},[($t=A.append)==null?void 0:$t.call(A)])]}}),dt(Cm,{name:"fade-transition"},{default:()=>[pt.value&&(gt.value||ye.value)&&!!n.scrim&&dt("div",Ys({class:["v-navigation-drawer__scrim",Vr.backgroundColorClasses.value],style:[lr.value,Vr.backgroundColorStyles.value],onClick:()=>{At.value||(ye.value=!1)}},je),null)]})])}),{isStuck:Ir}}}),DU={class:"mark"},zU={class:"mark-parent"},LU={class:"mark-types"},OU={class:"name"},kU={class:"total"},FU={name:"BassDrawer"},BU=_n({...FU,setup(n){const l=BB(),p=gN(),v=hn(""),A=it(()=>{const W=[];return(v.value?p.marks.filter(ee=>ee.mark_type_name.toLowerCase().includes(v.value.toLowerCase())):p.marks).forEach(ee=>{const ne=W.find(de=>de.name==ee.mark_type_parent);ne?(ne.list.push(ee),ne.total=ne.list.reduce((de,he)=>de+he.marks.length,0)):W.push({name:ee.mark_type_parent,list:[ee],total:ee.marks.length})}),W});Tn([()=>p.unshowMarks,()=>p.showName],()=>{var W;(W=window.$gmap)==null||W.addPoints(p.fillterMarks,p.showName,p.pointsIds)},{deep:!0});function R(){var W;(W=window.$gmap)==null||W.addPoints(p.fillterMarks,p.showName,p.pointsIds)}function D(W){p.unshowMarks.includes(W.id)?p.unshowMarks=p.unshowMarks.filter(H=>H!=W.id):p.unshowMarks.push(W.id)}function i(){p.unshowMarks=p.marks.map(W=>W.id)}function G(){p.unshowMarks=[]}return(W,H)=>{const ee=CB,ne=FB,de=M5,he=Ws,ye=nB;return ir(),On(RU,{class:"drawer",floating:"",modelValue:vt(l).drawer,"onUpdate:modelValue":H[3]||(H[3]=Le=>vt(l).drawer=Le),width:"375"},{default:Pn(()=>[dt(r8,null,{default:Pn(()=>[dt(W3,{class:"content"},{default:Pn(()=>[dt(Fg,{cols:"12"},{default:Pn(()=>H[4]||(H[4]=[Wr("h1",{class:"title"},"潜行者2 互动地图",-1)])),_:1}),dt(Fg,{cols:"12"},{default:Pn(()=>[dt(Wy,{cover:"",src:"https://mod.3dmgame.com/static/upload/logo/croppedImg_67e41b904f5c9.jpg"})]),_:1}),dt(Fg,{cols:"12",class:"buttons"},{default:Pn(()=>[Wr("div",null,[dt(ee,{onClick:G},{default:Pn(()=>H[5]||(H[5]=[Kp("显示全部")])),_:1}),dt(ee,{onClick:i},{default:Pn(()=>H[6]||(H[6]=[Kp("隐藏全部")])),_:1})]),Wr("div",null,[dt(ne,{modelValue:vt(p).showName,"onUpdate:modelValue":H[0]||(H[0]=Le=>vt(p).showName=Le),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"显示标记点名称"},null,8,["modelValue"])])]),_:1}),dt(Fg,{cols:"12"},{default:Pn(()=>[dt(ye,{modelValue:vt(v),"onUpdate:modelValue":H[1]||(H[1]=Le=>Yn(v)?v.value=Le:null),placeholder:"搜索标记点",onInput:R},{append:Pn(()=>[dt(ee,null,{default:Pn(()=>[dt(he,null,{default:Pn(()=>[dt(de)]),_:1})]),_:1})]),_:1},8,["modelValue"]),(ir(!0),qr(ti,null,JT(vt(A),Le=>(ir(),qr("div",DU,[Wr("h3",zU,Xs(Le.name),1),Wr("div",LU,[(ir(!0),qr(ti,null,JT(Le.list,je=>(ir(),On(b8,{class:Ln(["type-list",{unshow:vt(p).unshowMarks.includes(je.id)}]),variant:"text",label:"",onClick:xt=>D(je)},{prepend:Pn(()=>[dt(wm,{image:je.mark_type_icon,size:"25"},null,8,["image"])]),append:Pn(()=>[Wr("span",kU,Xs(Le.total),1)]),default:Pn(()=>[Wr("span",OU,Xs(je.mark_type_name),1)]),_:2},1032,["onClick","class"]))),256))])]))),256))]),_:1})]),_:1})]),_:1}),Wr("div",{class:"sidebar-close",onClick:H[2]||(H[2]=Le=>vt(l).drawer=!vt(l).drawer)},[vt(l).drawer?(ir(),On(aa,{key:0},{default:Pn(()=>H[7]||(H[7]=[Kp("mdi-chevron-double-left")])),_:1})):(ir(),On(aa,{key:1},{default:Pn(()=>H[8]||(H[8]=[Kp("mdi-chevron-double-right")])),_:1}))])]),_:1},8,["modelValue"])}}}),NU=D1(BU,[["__scopeId","data-v-91e50eb4"]]),VU={name:"DefaultLayout"},UU=fn({...Hi(),...km(),...xU()},"VLayout"),jU=yi()({name:"VLayout",props:UU(),setup(n,l){let{slots:p}=l;const{layoutClasses:v,layoutStyles:A,getLayoutItem:R,items:D,layoutRef:i}=EU(n),{dimensionStyles:G}=Fm(n);return gs(()=>{var W;return dt("div",{ref:i,class:[v.value,n.class],style:[G.value,A.value,n.style]},[(W=p.default)==null?void 0:W.call(p)])}),{getLayoutItem:R,items:D}}}),$U=fn({scrollable:Boolean,...Hi(),...km(),...vo({tag:"main"})},"VMain"),GU=yi()({name:"VMain",props:$U(),setup(n,l){let{slots:p}=l;const{dimensionStyles:v}=Fm(n),{mainStyles:A}=wU(),{ssrBootStyles:R}=PC();return gs(()=>dt(n.tag,{class:["v-main",{"v-main--scrollable":n.scrollable},n.class],style:[A.value,R.value,v.value,n.style]},{default:()=>{var D,i;return[n.scrollable?dt("div",{class:"v-main__scroller"},[(D=p.default)==null?void 0:D.call(p)]):(i=p.default)==null?void 0:i.call(p)]}})),{}}});function HU(n,l,p,v,A,R){const D=NU,i=mM("RouterView");return ir(),On(jU,null,{default:Pn(()=>[dt(D),dt(GU,null,{default:Pn(()=>[dt(T8,{style:{padding:"0"},fluid:""},{default:Pn(()=>[dt(i)]),_:1})]),_:1})]),_:1})}const qU=D1(VU,[["render",HU]]),TA={default:qU};function WU(n){function l(p,v=!0){return p.map(A=>{var R,D,i,G,W,H;if(((R=A.children)==null?void 0:R.length)>0&&(A.children=l(A.children,!1)),v){if(!A.component&&((D=A.children)==null?void 0:D.find(ne=>{var de;return(ne.path===""||ne.path==="/")&&((de=ne.meta)==null?void 0:de.isLayout)})))return A;if(((i=A.meta)==null?void 0:i.layout)!==!1)return{path:A.path,component:TA[((G=A.meta)==null?void 0:G.layout)||"default"],children:A.path==="/"?[A]:[{...A,path:""}],meta:{isLayout:!0}}}return(W=A.meta)!=null&&W.layout?{path:A.path,component:TA[(H=A.meta)==null?void 0:H.layout],children:[{...A,path:""}],meta:{isLayout:!0}}:A})}return l(n)}const ZU=fO({history:jL("/"),routes:WU(yO)});function RC(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{blueprint:l,...p}=n,v=_s(l,p),{aliases:A={},components:R={},directives:D={}}=v,i=RN(v.defaults),G=o8(v.display,v.ssr),W=mV(v.theme),H=hV(v.icons),ee=kV(v.locale),ne=yU(v.date,ee),de=l8(v.goTo,ee);return{install:ye=>{for(const Le in D)ye.directive(Le,D[Le]);for(const Le in R)ye.component(Le,R[Le]);for(const Le in A)ye.component(Le,Om({...A[Le],name:Le,aliasName:A[Le].name}));if(W.install(ye),ye.provide(Ld,i),ye.provide(n1,G),ye.provide(dy,W),ye.provide(e1,H),ye.provide(fy,ee),ye.provide(gU,ne.options),ye.provide(bA,ne.instance),ye.provide(pC,de),ms&&v.ssr)if(ye.$nuxt)ye.$nuxt.hook("app:suspense:resolve",()=>{G.update()});else{const{mount:Le}=ye;ye.mount=function(){const je=Le(...arguments);return Zs(()=>G.update()),ye.mount=Le,je}}Gy.reset(),ye.mixin({computed:{$vuetify(){return Zi({defaults:gd.call(this,Ld),display:gd.call(this,n1),theme:gd.call(this,dy),icons:gd.call(this,e1),locale:gd.call(this,fy),date:gd.call(this,bA)})}}})},defaults:i,display:G,theme:W,icons:H,locale:ee,date:ne,goTo:de}}const XU="3.7.18";RC.version=XU;function gd(n){var v,A;const l=this.$,p=((v=l.parent)==null?void 0:v.provides)??((A=l.vnode.appContext)==null?void 0:A.provides);if(p&&n in p)return p[n]}const KU=RC({theme:{defaultTheme:"dark"}}),Qy=eL(hL);Qy.use(nL());Qy.use(KU);Qy.use(ZU);Qy.mount("#app");export{ti as $,bj as A,Nd as B,_n as C,Mn as D,bc as E,NF as F,hn as G,it as H,Va as I,Ed as J,ps as K,Bd as L,Bk as M,On as N,ir as O,Pn as P,um as Q,Wr as R,wc as S,Ln as T,vt as U,Ou as V,WM as W,Cm as X,qr as Y,dt as Z,Dm as _,sy as a,oj as a$,Ru as a0,JI as a1,Du as a2,HI as a3,Tn as a4,CF as a5,Zs as a6,go as a7,Zi as a8,hM as a9,JU as aA,pM as aB,xI as aC,W5 as aD,uj as aE,Z5 as aF,Od as aG,dM as aH,Xs as aI,Kp as aJ,fm as aK,yM as aL,ym as aM,HF as aN,JM as aO,Ws as aP,Ej as aQ,Aj as aR,JT as aS,T1 as aT,cF as aU,JF as aV,UI as aW,zd as aX,ky as aY,H1 as aZ,fj as a_,da as aa,w1 as ab,Zn as ac,oa as ad,ho as ae,Vn as af,Oy as ag,_o as ah,xc as ai,Fd as aj,ks as ak,mc as al,sj as am,RI as an,Ys as ao,Hn as ap,Nn as aq,PI as ar,VF as as,QI as at,Ly as au,NI as av,Bs as aw,Zr as ax,$g as ay,Nr as az,ak as b,Qv as b$,Rn as b0,q1 as b1,e3 as b2,iB as b3,Yn as b4,tj as b5,aF as b6,Ty as b7,rj as b8,vl as b9,xj as bA,j1 as bB,jg as bC,cj as bD,G1 as bE,aj as bF,_j as bG,R1 as bH,N5 as bI,v1 as bJ,Fj as bK,Rj as bL,u1 as bM,Nj as bN,Bj as bO,Oj as bP,kj as bQ,_E as bR,H5 as bS,YU as bT,h4 as bU,lj as bV,X5 as bW,L5 as bX,xF as bY,EA as bZ,E1 as b_,mM as ba,$1 as bb,Mj as bc,Ec as bd,ij as be,Mz as bf,VI as bg,ZI as bh,pj as bi,Lz as bj,mj as bk,Y5 as bl,Xg as bm,nB as bn,QU as bo,WI as bp,Sj as bq,J4 as br,ej as bs,hj as bt,_c as bu,kd as bv,Vj as bw,yj as bx,vj as by,by as bz,uk as c,dj as c0,Lj as c1,oB as c2,CB as c3,Tj as c4,qA as c5,gj as c6,jj as c7,Uj as c8,nj as c9,wj as ca,RB as cb,Gn as cc,gN as cd,Pj as ce,Cj as cf,Dj as cg,zj as ch,D1 as ci,PB as cj,r8 as ck,IV as cl,aa as cm,Ij as cn,W3 as co,b8 as cp,EV as cq,$j as cr,BB as cs,fk as d,FO as e,F1 as f,N1 as g,k1 as h,B1 as i,xO as j,AI as k,TI as l,Pm as m,Vu as n,Jk as o,SI as p,vk as q,O1 as r,U1 as s,UO as t,II as u,iF as v,MI as w,DO as x,CI as y,Uu as z};

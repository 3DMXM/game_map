const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DExD_eZX.js","assets/index-DBviQ9sM.css"])))=>i.map(i=>d[i]);
(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const I of document.querySelectorAll('link[rel="modulepreload"]'))v(I);new MutationObserver(I=>{for(const R of I)if(R.type==="childList")for(const D of R.addedNodes)D.tagName==="LINK"&&D.rel==="modulepreload"&&v(D)}).observe(document,{childList:!0,subtree:!0});function p(I){const R={};return I.integrity&&(R.integrity=I.integrity),I.referrerPolicy&&(R.referrerPolicy=I.referrerPolicy),I.crossOrigin==="use-credentials"?R.credentials="include":I.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function v(I){if(I.ep)return;I.ep=!0;const R=p(I);fetch(I.href,R)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Xx(n){const c=Object.create(null);for(const p of n.split(","))c[p]=1;return p=>p in c}const ni={},md=[],mo=()=>{},XR=()=>!1,iy=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),Kx=n=>n.startsWith("onUpdate:"),Gi=Object.assign,Yx=(n,c)=>{const p=n.indexOf(c);p>-1&&n.splice(p,1)},KR=Object.prototype.hasOwnProperty,Un=(n,c)=>KR.call(n,c),Qr=Array.isArray,_d=n=>sy(n)==="[object Map]",sA=n=>sy(n)==="[object Set]",en=n=>typeof n=="function",jn=n=>typeof n=="string",_l=n=>typeof n=="symbol",Xn=n=>n!==null&&typeof n=="object",Fg=n=>(Xn(n)||en(n))&&en(n.then)&&en(n.catch),oA=Object.prototype.toString,sy=n=>oA.call(n),YR=n=>sy(n).slice(8,-1),aA=n=>sy(n)==="[object Object]",Jx=n=>jn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,Vp=Xx(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),oy=n=>{const c=Object.create(null);return p=>c[p]||(c[p]=n(p))},JR=/-(\w)/g,Fs=oy(n=>n.replace(JR,(c,p)=>p?p.toUpperCase():"")),QR=/\B([A-Z])/g,vc=oy(n=>n.replace(QR,"-$1").toLowerCase()),xc=oy(n=>n.charAt(0).toUpperCase()+n.slice(1)),N0=oy(n=>n?`on${xc(n)}`:""),mc=(n,c)=>!Object.is(n,c),V0=(n,...c)=>{for(let p=0;p<n.length;p++)n[p](...c)},lA=(n,c,p,v=!1)=>{Object.defineProperty(n,c,{configurable:!0,enumerable:!1,writable:v,value:p})},eD=n=>{const c=parseFloat(n);return isNaN(c)?n:c},tD=n=>{const c=jn(n)?Number(n):NaN;return isNaN(c)?n:c};let RT;const ay=()=>RT||(RT=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Cu(n){if(Qr(n)){const c={};for(let p=0;p<n.length;p++){const v=n[p],I=jn(v)?sD(v):Cu(v);if(I)for(const R in I)c[R]=I[R]}return c}else if(jn(n)||Xn(n))return n}const rD=/;(?![^(]*\))/g,nD=/:([^]+)/,iD=/\/\*[^]*?\*\//g;function sD(n){const c={};return n.replace(iD,"").split(rD).forEach(p=>{if(p){const v=p.split(nD);v.length>1&&(c[v[0].trim()]=v[1].trim())}}),c}function Rn(n){let c="";if(jn(n))c=n;else if(Qr(n))for(let p=0;p<n.length;p++){const v=Rn(n[p]);v&&(c+=v+" ")}else if(Xn(n))for(const p in n)n[p]&&(c+=p+" ");return c.trim()}function ZU(n){if(!n)return null;let{class:c,style:p}=n;return c&&!jn(c)&&(n.class=Rn(c)),p&&(n.style=Cu(p)),n}const oD="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",aD=Xx(oD);function cA(n){return!!n||n===""}const uA=n=>!!(n&&n.__v_isRef===!0),Zs=n=>jn(n)?n:n==null?"":Qr(n)||Xn(n)&&(n.toString===oA||!en(n.toString))?uA(n)?Zs(n.value):JSON.stringify(n,hA,2):String(n),hA=(n,c)=>uA(c)?hA(n,c.value):_d(c)?{[`Map(${c.size})`]:[...c.entries()].reduce((p,[v,I],R)=>(p[U0(v,R)+" =>"]=I,p),{})}:sA(c)?{[`Set(${c.size})`]:[...c.values()].map(p=>U0(p))}:_l(c)?U0(c):Xn(c)&&!Qr(c)&&!aA(c)?String(c):c,U0=(n,c="")=>{var p;return _l(n)?`Symbol(${(p=n.description)!=null?p:c})`:n};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ls;class dA{constructor(c=!1){this.detached=c,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ls,!c&&Ls&&(this.index=(Ls.scopes||(Ls.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let c,p;if(this.scopes)for(c=0,p=this.scopes.length;c<p;c++)this.scopes[c].pause();for(c=0,p=this.effects.length;c<p;c++)this.effects[c].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let c,p;if(this.scopes)for(c=0,p=this.scopes.length;c<p;c++)this.scopes[c].resume();for(c=0,p=this.effects.length;c<p;c++)this.effects[c].resume()}}run(c){if(this._active){const p=Ls;try{return Ls=this,c()}finally{Ls=p}}}on(){Ls=this}off(){Ls=this.parent}stop(c){if(this._active){this._active=!1;let p,v;for(p=0,v=this.effects.length;p<v;p++)this.effects[p].stop();for(this.effects.length=0,p=0,v=this.cleanups.length;p<v;p++)this.cleanups[p]();if(this.cleanups.length=0,this.scopes){for(p=0,v=this.scopes.length;p<v;p++)this.scopes[p].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!c){const I=this.parent.scopes.pop();I&&I!==this&&(this.parent.scopes[this.index]=I,I.index=this.index)}this.parent=void 0}}}function Qx(n){return new dA(n)}function e1(){return Ls}function ly(n,c=!1){Ls&&Ls.cleanups.push(n)}let si;const j0=new WeakSet;class fA{constructor(c){this.fn=c,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ls&&Ls.active&&Ls.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,j0.has(this)&&(j0.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||mA(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,DT(this),_A(this);const c=si,p=aa;si=this,aa=!0;try{return this.fn()}finally{gA(this),si=c,aa=p,this.flags&=-3}}stop(){if(this.flags&1){for(let c=this.deps;c;c=c.nextDep)n1(c);this.deps=this.depsTail=void 0,DT(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?j0.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){px(this)&&this.run()}get dirty(){return px(this)}}let pA=0,Up,jp;function mA(n,c=!1){if(n.flags|=8,c){n.next=jp,jp=n;return}n.next=Up,Up=n}function t1(){pA++}function r1(){if(--pA>0)return;if(jp){let c=jp;for(jp=void 0;c;){const p=c.next;c.next=void 0,c.flags&=-9,c=p}}let n;for(;Up;){let c=Up;for(Up=void 0;c;){const p=c.next;if(c.next=void 0,c.flags&=-9,c.flags&1)try{c.trigger()}catch(v){n||(n=v)}c=p}}if(n)throw n}function _A(n){for(let c=n.deps;c;c=c.nextDep)c.version=-1,c.prevActiveLink=c.dep.activeLink,c.dep.activeLink=c}function gA(n){let c,p=n.depsTail,v=p;for(;v;){const I=v.prevDep;v.version===-1?(v===p&&(p=I),n1(v),lD(v)):c=v,v.dep.activeLink=v.prevActiveLink,v.prevActiveLink=void 0,v=I}n.deps=c,n.depsTail=p}function px(n){for(let c=n.deps;c;c=c.nextDep)if(c.dep.version!==c.version||c.dep.computed&&(yA(c.dep.computed)||c.dep.version!==c.version))return!0;return!!n._dirty}function yA(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===Kp))return;n.globalVersion=Kp;const c=n.dep;if(n.flags|=2,c.version>0&&!n.isSSR&&n.deps&&!px(n)){n.flags&=-3;return}const p=si,v=aa;si=n,aa=!0;try{_A(n);const I=n.fn(n._value);(c.version===0||mc(I,n._value))&&(n._value=I,c.version++)}catch(I){throw c.version++,I}finally{si=p,aa=v,gA(n),n.flags&=-3}}function n1(n,c=!1){const{dep:p,prevSub:v,nextSub:I}=n;if(v&&(v.nextSub=I,n.prevSub=void 0),I&&(I.prevSub=v,n.nextSub=void 0),p.subs===n&&(p.subs=v,!v&&p.computed)){p.computed.flags&=-5;for(let R=p.computed.deps;R;R=R.nextDep)n1(R,!0)}!c&&!--p.sc&&p.map&&p.map.delete(p.key)}function lD(n){const{prevDep:c,nextDep:p}=n;c&&(c.nextDep=p,n.prevDep=void 0),p&&(p.prevDep=c,n.nextDep=void 0)}let aa=!0;const vA=[];function bc(){vA.push(aa),aa=!1}function wc(){const n=vA.pop();aa=n===void 0?!0:n}function DT(n){const{cleanup:c}=n;if(n.cleanup=void 0,c){const p=si;si=void 0;try{c()}finally{si=p}}}let Kp=0;class cD{constructor(c,p){this.sub=c,this.dep=p,this.version=p.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class i1{constructor(c){this.computed=c,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(c){if(!si||!aa||si===this.computed)return;let p=this.activeLink;if(p===void 0||p.sub!==si)p=this.activeLink=new cD(si,this),si.deps?(p.prevDep=si.depsTail,si.depsTail.nextDep=p,si.depsTail=p):si.deps=si.depsTail=p,xA(p);else if(p.version===-1&&(p.version=this.version,p.nextDep)){const v=p.nextDep;v.prevDep=p.prevDep,p.prevDep&&(p.prevDep.nextDep=v),p.prevDep=si.depsTail,p.nextDep=void 0,si.depsTail.nextDep=p,si.depsTail=p,si.deps===p&&(si.deps=v)}return p}trigger(c){this.version++,Kp++,this.notify(c)}notify(c){t1();try{for(let p=this.subs;p;p=p.prevSub)p.sub.notify()&&p.sub.dep.notify()}finally{r1()}}}function xA(n){if(n.dep.sc++,n.sub.flags&4){const c=n.dep.computed;if(c&&!n.dep.subs){c.flags|=20;for(let v=c.deps;v;v=v.nextDep)xA(v)}const p=n.dep.subs;p!==n&&(n.prevSub=p,p&&(p.nextSub=n)),n.dep.subs=n}}const Bg=new WeakMap,Su=Symbol(""),mx=Symbol(""),Yp=Symbol("");function hs(n,c,p){if(aa&&si){let v=Bg.get(n);v||Bg.set(n,v=new Map);let I=v.get(p);I||(v.set(p,I=new i1),I.map=v,I.key=p),I.track()}}function fl(n,c,p,v,I,R){const D=Bg.get(n);if(!D){Kp++;return}const i=G=>{G&&G.trigger()};if(t1(),c==="clear")D.forEach(i);else{const G=Qr(n),X=G&&Jx(p);if(G&&p==="length"){const q=Number(v);D.forEach((ee,ne)=>{(ne==="length"||ne===Yp||!_l(ne)&&ne>=q)&&i(ee)})}else switch((p!==void 0||D.has(void 0))&&i(D.get(p)),X&&i(D.get(Yp)),c){case"add":G?X&&i(D.get("length")):(i(D.get(Su)),_d(n)&&i(D.get(mx)));break;case"delete":G||(i(D.get(Su)),_d(n)&&i(D.get(mx)));break;case"set":_d(n)&&i(D.get(Su));break}}r1()}function uD(n,c){const p=Bg.get(n);return p&&p.get(c)}function od(n){const c=Mn(n);return c===n?c:(hs(c,"iterate",Yp),Oo(n)?c:c.map(ds))}function cy(n){return hs(n=Mn(n),"iterate",Yp),n}const hD={__proto__:null,[Symbol.iterator](){return $0(this,Symbol.iterator,ds)},concat(...n){return od(this).concat(...n.map(c=>Qr(c)?od(c):c))},entries(){return $0(this,"entries",n=>(n[1]=ds(n[1]),n))},every(n,c){return cl(this,"every",n,c,void 0,arguments)},filter(n,c){return cl(this,"filter",n,c,p=>p.map(ds),arguments)},find(n,c){return cl(this,"find",n,c,ds,arguments)},findIndex(n,c){return cl(this,"findIndex",n,c,void 0,arguments)},findLast(n,c){return cl(this,"findLast",n,c,ds,arguments)},findLastIndex(n,c){return cl(this,"findLastIndex",n,c,void 0,arguments)},forEach(n,c){return cl(this,"forEach",n,c,void 0,arguments)},includes(...n){return G0(this,"includes",n)},indexOf(...n){return G0(this,"indexOf",n)},join(n){return od(this).join(n)},lastIndexOf(...n){return G0(this,"lastIndexOf",n)},map(n,c){return cl(this,"map",n,c,void 0,arguments)},pop(){return Dp(this,"pop")},push(...n){return Dp(this,"push",n)},reduce(n,...c){return zT(this,"reduce",n,c)},reduceRight(n,...c){return zT(this,"reduceRight",n,c)},shift(){return Dp(this,"shift")},some(n,c){return cl(this,"some",n,c,void 0,arguments)},splice(...n){return Dp(this,"splice",n)},toReversed(){return od(this).toReversed()},toSorted(n){return od(this).toSorted(n)},toSpliced(...n){return od(this).toSpliced(...n)},unshift(...n){return Dp(this,"unshift",n)},values(){return $0(this,"values",ds)}};function $0(n,c,p){const v=cy(n),I=v[c]();return v!==n&&!Oo(n)&&(I._next=I.next,I.next=()=>{const R=I._next();return R.value&&(R.value=p(R.value)),R}),I}const dD=Array.prototype;function cl(n,c,p,v,I,R){const D=cy(n),i=D!==n&&!Oo(n),G=D[c];if(G!==dD[c]){const ee=G.apply(n,R);return i?ds(ee):ee}let X=p;D!==n&&(i?X=function(ee,ne){return p.call(this,ds(ee),ne,n)}:p.length>2&&(X=function(ee,ne){return p.call(this,ee,ne,n)}));const q=G.call(D,X,v);return i&&I?I(q):q}function zT(n,c,p,v){const I=cy(n);let R=p;return I!==n&&(Oo(n)?p.length>3&&(R=function(D,i,G){return p.call(this,D,i,G,n)}):R=function(D,i,G){return p.call(this,D,ds(i),G,n)}),I[c](R,...v)}function G0(n,c,p){const v=Mn(n);hs(v,"iterate",Yp);const I=v[c](...p);return(I===-1||I===!1)&&a1(p[0])?(p[0]=Mn(p[0]),v[c](...p)):I}function Dp(n,c,p=[]){bc(),t1();const v=Mn(n)[c].apply(n,p);return r1(),wc(),v}const fD=Xx("__proto__,__v_isRef,__isVue"),bA=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(_l));function pD(n){_l(n)||(n=String(n));const c=Mn(this);return hs(c,"has",n),c.hasOwnProperty(n)}class wA{constructor(c=!1,p=!1){this._isReadonly=c,this._isShallow=p}get(c,p,v){if(p==="__v_skip")return c.__v_skip;const I=this._isReadonly,R=this._isShallow;if(p==="__v_isReactive")return!I;if(p==="__v_isReadonly")return I;if(p==="__v_isShallow")return R;if(p==="__v_raw")return v===(I?R?SD:AA:R?EA:SA).get(c)||Object.getPrototypeOf(c)===Object.getPrototypeOf(v)?c:void 0;const D=Qr(c);if(!I){let G;if(D&&(G=hD[p]))return G;if(p==="hasOwnProperty")return pD}const i=Reflect.get(c,p,Qn(c)?c:v);return(_l(p)?bA.has(p):fD(p))||(I||hs(c,"get",p),R)?i:Qn(i)?D&&Jx(p)?i:i.value:Xn(i)?I?mm(i):Zi(i):i}}class TA extends wA{constructor(c=!1){super(!1,c)}set(c,p,v,I){let R=c[p];if(!this._isShallow){const G=Pu(R);if(!Oo(v)&&!Pu(v)&&(R=Mn(R),v=Mn(v)),!Qr(c)&&Qn(R)&&!Qn(v))return G?!1:(R.value=v,!0)}const D=Qr(c)&&Jx(p)?Number(p)<c.length:Un(c,p),i=Reflect.set(c,p,v,Qn(c)?c:I);return c===Mn(I)&&(D?mc(v,R)&&fl(c,"set",p,v):fl(c,"add",p,v)),i}deleteProperty(c,p){const v=Un(c,p);c[p];const I=Reflect.deleteProperty(c,p);return I&&v&&fl(c,"delete",p,void 0),I}has(c,p){const v=Reflect.has(c,p);return(!_l(p)||!bA.has(p))&&hs(c,"has",p),v}ownKeys(c){return hs(c,"iterate",Qr(c)?"length":Su),Reflect.ownKeys(c)}}class mD extends wA{constructor(c=!1){super(!0,c)}set(c,p){return!0}deleteProperty(c,p){return!0}}const _D=new TA,gD=new mD,yD=new TA(!0);const _x=n=>n,mg=n=>Reflect.getPrototypeOf(n);function vD(n,c,p){return function(...v){const I=this.__v_raw,R=Mn(I),D=_d(R),i=n==="entries"||n===Symbol.iterator&&D,G=n==="keys"&&D,X=I[n](...v),q=p?_x:c?gx:ds;return!c&&hs(R,"iterate",G?mx:Su),{next(){const{value:ee,done:ne}=X.next();return ne?{value:ee,done:ne}:{value:i?[q(ee[0]),q(ee[1])]:q(ee),done:ne}},[Symbol.iterator](){return this}}}}function _g(n){return function(...c){return n==="delete"?!1:n==="clear"?void 0:this}}function xD(n,c){const p={get(I){const R=this.__v_raw,D=Mn(R),i=Mn(I);n||(mc(I,i)&&hs(D,"get",I),hs(D,"get",i));const{has:G}=mg(D),X=c?_x:n?gx:ds;if(G.call(D,I))return X(R.get(I));if(G.call(D,i))return X(R.get(i));R!==D&&R.get(I)},get size(){const I=this.__v_raw;return!n&&hs(Mn(I),"iterate",Su),Reflect.get(I,"size",I)},has(I){const R=this.__v_raw,D=Mn(R),i=Mn(I);return n||(mc(I,i)&&hs(D,"has",I),hs(D,"has",i)),I===i?R.has(I):R.has(I)||R.has(i)},forEach(I,R){const D=this,i=D.__v_raw,G=Mn(i),X=c?_x:n?gx:ds;return!n&&hs(G,"iterate",Su),i.forEach((q,ee)=>I.call(R,X(q),X(ee),D))}};return Gi(p,n?{add:_g("add"),set:_g("set"),delete:_g("delete"),clear:_g("clear")}:{add(I){!c&&!Oo(I)&&!Pu(I)&&(I=Mn(I));const R=Mn(this);return mg(R).has.call(R,I)||(R.add(I),fl(R,"add",I,I)),this},set(I,R){!c&&!Oo(R)&&!Pu(R)&&(R=Mn(R));const D=Mn(this),{has:i,get:G}=mg(D);let X=i.call(D,I);X||(I=Mn(I),X=i.call(D,I));const q=G.call(D,I);return D.set(I,R),X?mc(R,q)&&fl(D,"set",I,R):fl(D,"add",I,R),this},delete(I){const R=Mn(this),{has:D,get:i}=mg(R);let G=D.call(R,I);G||(I=Mn(I),G=D.call(R,I)),i&&i.call(R,I);const X=R.delete(I);return G&&fl(R,"delete",I,void 0),X},clear(){const I=Mn(this),R=I.size!==0,D=I.clear();return R&&fl(I,"clear",void 0,void 0),D}}),["keys","values","entries",Symbol.iterator].forEach(I=>{p[I]=vD(I,n,c)}),p}function s1(n,c){const p=xD(n,c);return(v,I,R)=>I==="__v_isReactive"?!n:I==="__v_isReadonly"?n:I==="__v_raw"?v:Reflect.get(Un(p,I)&&I in v?p:v,I,R)}const bD={get:s1(!1,!1)},wD={get:s1(!1,!0)},TD={get:s1(!0,!1)};const SA=new WeakMap,EA=new WeakMap,AA=new WeakMap,SD=new WeakMap;function ED(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function AD(n){return n.__v_skip||!Object.isExtensible(n)?0:ED(YR(n))}function Zi(n){return Pu(n)?n:o1(n,!1,_D,bD,SA)}function MA(n){return o1(n,!1,yD,wD,EA)}function mm(n){return o1(n,!0,gD,TD,AA)}function o1(n,c,p,v,I){if(!Xn(n)||n.__v_raw&&!(c&&n.__v_isReactive))return n;const R=I.get(n);if(R)return R;const D=AD(n);if(D===0)return n;const i=new Proxy(n,D===2?v:p);return I.set(n,i),i}function _c(n){return Pu(n)?_c(n.__v_raw):!!(n&&n.__v_isReactive)}function Pu(n){return!!(n&&n.__v_isReadonly)}function Oo(n){return!!(n&&n.__v_isShallow)}function a1(n){return n?!!n.__v_raw:!1}function Mn(n){const c=n&&n.__v_raw;return c?Mn(c):n}function l1(n){return!Un(n,"__v_skip")&&Object.isExtensible(n)&&lA(n,"__v_skip",!0),n}const ds=n=>Xn(n)?Zi(n):n,gx=n=>Xn(n)?mm(n):n;function Qn(n){return n?n.__v_isRef===!0:!1}function In(n){return IA(n,!1)}function Fn(n){return IA(n,!0)}function IA(n,c){return Qn(n)?n:new MD(n,c)}class MD{constructor(c,p){this.dep=new i1,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=p?c:Mn(c),this._value=p?c:ds(c),this.__v_isShallow=p}get value(){return this.dep.track(),this._value}set value(c){const p=this._rawValue,v=this.__v_isShallow||Oo(c)||Pu(c);c=v?c:Mn(c),mc(c,p)&&(this._rawValue=c,this._value=v?c:ds(c),this.dep.trigger())}}function At(n){return Qn(n)?n.value:n}const ID={get:(n,c,p)=>c==="__v_raw"?n:At(Reflect.get(n,c,p)),set:(n,c,p,v)=>{const I=n[c];return Qn(I)&&!Qn(p)?(I.value=p,!0):Reflect.set(n,c,p,v)}};function CA(n){return _c(n)?n:new Proxy(n,ID)}function uy(n){const c=Qr(n)?new Array(n.length):{};for(const p in n)c[p]=PA(n,p);return c}class CD{constructor(c,p,v){this._object=c,this._key=p,this._defaultValue=v,this.__v_isRef=!0,this._value=void 0}get value(){const c=this._object[this._key];return this._value=c===void 0?this._defaultValue:c}set value(c){this._object[this._key]=c}get dep(){return uD(Mn(this._object),this._key)}}class PD{constructor(c){this._getter=c,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function ps(n,c,p){return Qn(n)?n:en(n)?new PD(n):Xn(n)&&arguments.length>1?PA(n,c,p):In(n)}function PA(n,c,p){const v=n[c];return Qn(v)?v:new CD(n,c,p)}class RD{constructor(c,p,v){this.fn=c,this.setter=p,this._value=void 0,this.dep=new i1(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Kp-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!p,this.isSSR=v}notify(){if(this.flags|=16,!(this.flags&8)&&si!==this)return mA(this,!0),!0}get value(){const c=this.dep.track();return yA(this),c&&(c.version=this.dep.version),this._value}set value(c){this.setter&&this.setter(c)}}function DD(n,c,p=!1){let v,I;return en(n)?v=n:(v=n.get,I=n.set),new RD(v,I,p)}const gg={},Ng=new WeakMap;let xu;function zD(n,c=!1,p=xu){if(p){let v=Ng.get(p);v||Ng.set(p,v=[]),v.push(n)}}function LD(n,c,p=ni){const{immediate:v,deep:I,once:R,scheduler:D,augmentJob:i,call:G}=p,X=ut=>I?ut:Oo(ut)||I===!1||I===0?pl(ut,1):pl(ut);let q,ee,ne,me,he=!1,ye=!1;if(Qn(n)?(ee=()=>n.value,he=Oo(n)):_c(n)?(ee=()=>X(n),he=!0):Qr(n)?(ye=!0,he=n.some(ut=>_c(ut)||Oo(ut)),ee=()=>n.map(ut=>{if(Qn(ut))return ut.value;if(_c(ut))return X(ut);if(en(ut))return G?G(ut,2):ut()})):en(n)?c?ee=G?()=>G(n,2):n:ee=()=>{if(ne){bc();try{ne()}finally{wc()}}const ut=xu;xu=q;try{return G?G(n,3,[me]):n(me)}finally{xu=ut}}:ee=mo,c&&I){const ut=ee,ht=I===!0?1/0:I;ee=()=>pl(ut(),ht)}const Le=e1(),je=()=>{q.stop(),Le&&Le.active&&Yx(Le.effects,q)};if(R&&c){const ut=c;c=(...ht)=>{ut(...ht),je()}}let vt=ye?new Array(n.length).fill(gg):gg;const Dt=ut=>{if(!(!(q.flags&1)||!q.dirty&&!ut))if(c){const ht=q.run();if(I||he||(ye?ht.some((St,tt)=>mc(St,vt[tt])):mc(ht,vt))){ne&&ne();const St=xu;xu=q;try{const tt=[ht,vt===gg?void 0:ye&&vt[0]===gg?[]:vt,me];G?G(c,3,tt):c(...tt),vt=ht}finally{xu=St}}}else q.run()};return i&&i(Dt),q=new fA(ee),q.scheduler=D?()=>D(Dt,!1):Dt,me=ut=>zD(ut,!1,q),ne=q.onStop=()=>{const ut=Ng.get(q);if(ut){if(G)G(ut,4);else for(const ht of ut)ht();Ng.delete(q)}},c?v?Dt(!0):vt=q.run():D?D(Dt.bind(null,!0),!0):q.run(),je.pause=q.pause.bind(q),je.resume=q.resume.bind(q),je.stop=je,je}function pl(n,c=1/0,p){if(c<=0||!Xn(n)||n.__v_skip||(p=p||new Set,p.has(n)))return n;if(p.add(n),c--,Qn(n))pl(n.value,c,p);else if(Qr(n))for(let v=0;v<n.length;v++)pl(n[v],c,p);else if(sA(n)||_d(n))n.forEach(v=>{pl(v,c,p)});else if(aA(n)){for(const v in n)pl(n[v],c,p);for(const v of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,v)&&pl(n[v],c,p)}return n}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function _m(n,c,p,v){try{return v?n(...v):n()}catch(I){hy(I,c,p)}}function la(n,c,p,v){if(en(n)){const I=_m(n,c,p,v);return I&&Fg(I)&&I.catch(R=>{hy(R,c,p)}),I}if(Qr(n)){const I=[];for(let R=0;R<n.length;R++)I.push(la(n[R],c,p,v));return I}}function hy(n,c,p,v=!0){const I=c?c.vnode:null,{errorHandler:R,throwUnhandledErrorInProduction:D}=c&&c.appContext.config||ni;if(c){let i=c.parent;const G=c.proxy,X=`https://vuejs.org/error-reference/#runtime-${p}`;for(;i;){const q=i.ec;if(q){for(let ee=0;ee<q.length;ee++)if(q[ee](n,G,X)===!1)return}i=i.parent}if(R){bc(),_m(R,null,10,[n,G,X]),wc();return}}OD(n,p,I,v,D)}function OD(n,c,p,v=!0,I=!1){if(I)throw n;console.error(n)}const Os=[];let ka=-1;const gd=[];let cc=null,dd=0;const RA=Promise.resolve();let Vg=null;function Ws(n){const c=Vg||RA;return n?c.then(this?n.bind(this):n):c}function kD(n){let c=ka+1,p=Os.length;for(;c<p;){const v=c+p>>>1,I=Os[v],R=Jp(I);R<n||R===n&&I.flags&2?c=v+1:p=v}return c}function c1(n){if(!(n.flags&1)){const c=Jp(n),p=Os[Os.length-1];!p||!(n.flags&2)&&c>=Jp(p)?Os.push(n):Os.splice(kD(c),0,n),n.flags|=1,DA()}}function DA(){Vg||(Vg=RA.then(LA))}function FD(n){Qr(n)?gd.push(...n):cc&&n.id===-1?cc.splice(dd+1,0,n):n.flags&1||(gd.push(n),n.flags|=1),DA()}function LT(n,c,p=ka+1){for(;p<Os.length;p++){const v=Os[p];if(v&&v.flags&2){if(n&&v.id!==n.uid)continue;Os.splice(p,1),p--,v.flags&4&&(v.flags&=-2),v(),v.flags&4||(v.flags&=-2)}}}function zA(n){if(gd.length){const c=[...new Set(gd)].sort((p,v)=>Jp(p)-Jp(v));if(gd.length=0,cc){cc.push(...c);return}for(cc=c,dd=0;dd<cc.length;dd++){const p=cc[dd];p.flags&4&&(p.flags&=-2),p.flags&8||p(),p.flags&=-2}cc=null,dd=0}}const Jp=n=>n.id==null?n.flags&2?-1:1/0:n.id;function LA(n){try{for(ka=0;ka<Os.length;ka++){const c=Os[ka];c&&!(c.flags&8)&&(c.flags&4&&(c.flags&=-2),_m(c,c.i,c.i?15:14),c.flags&4||(c.flags&=-2))}}finally{for(;ka<Os.length;ka++){const c=Os[ka];c&&(c.flags&=-2)}ka=-1,Os.length=0,zA(),Vg=null,(Os.length||gd.length)&&LA()}}let $i=null,OA=null;function Ug(n){const c=$i;return $i=n,OA=n&&n.type.__scopeId||null,c}function An(n,c=$i,p){if(!c||n._n)return n;const v=(...I)=>{v._d&&XT(-1);const R=Ug(c);let D;try{D=n(...I)}finally{Ug(R),v._d&&XT(1)}return D};return v._n=!0,v._c=!0,v._d=!0,v}function Qp(n,c){if($i===null)return n;const p=my($i),v=n.dirs||(n.dirs=[]);for(let I=0;I<c.length;I++){let[R,D,i,G=ni]=c[I];R&&(en(R)&&(R={mounted:R,updated:R}),R.deep&&pl(D),v.push({dir:R,instance:p,value:D,oldValue:void 0,arg:i,modifiers:G}))}return n}function pu(n,c,p,v){const I=n.dirs,R=c&&c.dirs;for(let D=0;D<I.length;D++){const i=I[D];R&&(i.oldValue=R[D].value);let G=i.dir[v];G&&(bc(),la(G,p,8,[n.el,i,n,c]),wc())}}const kA=Symbol("_vte"),FA=n=>n.__isTeleport,$p=n=>n&&(n.disabled||n.disabled===""),OT=n=>n&&(n.defer||n.defer===""),kT=n=>typeof SVGElement<"u"&&n instanceof SVGElement,FT=n=>typeof MathMLElement=="function"&&n instanceof MathMLElement,yx=(n,c)=>{const p=n&&n.to;return jn(p)?c?c(p):null:p},BA={name:"Teleport",__isTeleport:!0,process(n,c,p,v,I,R,D,i,G,X){const{mc:q,pc:ee,pbc:ne,o:{insert:me,querySelector:he,createText:ye,createComment:Le}}=X,je=$p(c.props);let{shapeFlag:vt,children:Dt,dynamicChildren:ut}=c;if(n==null){const ht=c.el=ye(""),St=c.anchor=ye("");me(ht,p,v),me(St,p,v);const tt=(pt,ot)=>{vt&16&&(I&&I.isCE&&(I.ce._teleportTarget=pt),q(Dt,pt,ot,I,R,D,i,G))},Et=()=>{const pt=c.target=yx(c.props,he),ot=NA(pt,c,ye,me);pt&&(D!=="svg"&&kT(pt)?D="svg":D!=="mathml"&&FT(pt)&&(D="mathml"),je||(tt(pt,ot),Ig(c,!1)))};je&&(tt(p,St),Ig(c,!0)),OT(c.props)?zs(()=>{Et(),c.el.__isMounted=!0},R):Et()}else{if(OT(c.props)&&!n.el.__isMounted){zs(()=>{BA.process(n,c,p,v,I,R,D,i,G,X),delete n.el.__isMounted},R);return}c.el=n.el,c.targetStart=n.targetStart;const ht=c.anchor=n.anchor,St=c.target=n.target,tt=c.targetAnchor=n.targetAnchor,Et=$p(n.props),pt=Et?p:St,ot=Et?ht:tt;if(D==="svg"||kT(St)?D="svg":(D==="mathml"||FT(St))&&(D="mathml"),ut?(ne(n.dynamicChildren,ut,pt,I,R,D,i),g1(n,c,!0)):G||ee(n,c,pt,ot,I,R,D,i,!1),je)Et?c.props&&n.props&&c.props.to!==n.props.to&&(c.props.to=n.props.to):yg(c,p,ht,X,1);else if((c.props&&c.props.to)!==(n.props&&n.props.to)){const gt=c.target=yx(c.props,he);gt&&yg(c,gt,null,X,0)}else Et&&yg(c,St,tt,X,1);Ig(c,je)}},remove(n,c,p,{um:v,o:{remove:I}},R){const{shapeFlag:D,children:i,anchor:G,targetStart:X,targetAnchor:q,target:ee,props:ne}=n;if(ee&&(I(X),I(q)),R&&I(G),D&16){const me=R||!$p(ne);for(let he=0;he<i.length;he++){const ye=i[he];v(ye,c,p,me,!!ye.dynamicChildren)}}},move:yg,hydrate:BD};function yg(n,c,p,{o:{insert:v},m:I},R=2){R===0&&v(n.targetAnchor,c,p);const{el:D,anchor:i,shapeFlag:G,children:X,props:q}=n,ee=R===2;if(ee&&v(D,c,p),(!ee||$p(q))&&G&16)for(let ne=0;ne<X.length;ne++)I(X[ne],c,p,2);ee&&v(i,c,p)}function BD(n,c,p,v,I,R,{o:{nextSibling:D,parentNode:i,querySelector:G,insert:X,createText:q}},ee){const ne=c.target=yx(c.props,G);if(ne){const me=$p(c.props),he=ne._lpa||ne.firstChild;if(c.shapeFlag&16)if(me)c.anchor=ee(D(n),c,i(n),p,v,I,R),c.targetStart=he,c.targetAnchor=he&&D(he);else{c.anchor=D(n);let ye=he;for(;ye;){if(ye&&ye.nodeType===8){if(ye.data==="teleport start anchor")c.targetStart=ye;else if(ye.data==="teleport anchor"){c.targetAnchor=ye,ne._lpa=c.targetAnchor&&D(c.targetAnchor);break}}ye=D(ye)}c.targetAnchor||NA(ne,c,q,X),ee(he&&D(he),c,ne,p,v,I,R)}Ig(c,me)}return c.anchor&&D(c.anchor)}const XU=BA;function Ig(n,c){const p=n.ctx;if(p&&p.ut){let v,I;for(c?(v=n.el,I=n.anchor):(v=n.targetStart,I=n.targetAnchor);v&&v!==I;)v.nodeType===1&&v.setAttribute("data-v-owner",p.uid),v=v.nextSibling;p.ut()}}function NA(n,c,p,v){const I=c.targetStart=p(""),R=c.targetAnchor=p("");return I[kA]=R,n&&(v(I,n),v(R,n)),R}const uc=Symbol("_leaveCb"),vg=Symbol("_enterCb");function VA(){const n={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ua(()=>{n.isMounted=!0}),Na(()=>{n.isUnmounting=!0}),n}const Lo=[Function,Array],UA={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Lo,onEnter:Lo,onAfterEnter:Lo,onEnterCancelled:Lo,onBeforeLeave:Lo,onLeave:Lo,onAfterLeave:Lo,onLeaveCancelled:Lo,onBeforeAppear:Lo,onAppear:Lo,onAfterAppear:Lo,onAppearCancelled:Lo},jA=n=>{const c=n.subTree;return c.component?jA(c.component):c},ND={name:"BaseTransition",props:UA,setup(n,{slots:c}){const p=ha(),v=VA();return()=>{const I=c.default&&u1(c.default(),!0);if(!I||!I.length)return;const R=$A(I),D=Mn(n),{mode:i}=D;if(v.isLeaving)return q0(R);const G=BT(R);if(!G)return q0(R);let X=em(G,D,v,p,ee=>X=ee);G.type!==ks&&Ru(G,X);let q=p.subTree&&BT(p.subTree);if(q&&q.type!==ks&&!bu(G,q)&&jA(p).type!==ks){let ee=em(q,D,v,p);if(Ru(q,ee),i==="out-in"&&G.type!==ks)return v.isLeaving=!0,ee.afterLeave=()=>{v.isLeaving=!1,p.job.flags&8||p.update(),delete ee.afterLeave,q=void 0},q0(R);i==="in-out"&&G.type!==ks?ee.delayLeave=(ne,me,he)=>{const ye=GA(v,q);ye[String(q.key)]=q,ne[uc]=()=>{me(),ne[uc]=void 0,delete X.delayedLeave,q=void 0},X.delayedLeave=()=>{he(),delete X.delayedLeave,q=void 0}}:q=void 0}else q&&(q=void 0);return R}}};function $A(n){let c=n[0];if(n.length>1){for(const p of n)if(p.type!==ks){c=p;break}}return c}const VD=ND;function GA(n,c){const{leavingVNodes:p}=n;let v=p.get(c.type);return v||(v=Object.create(null),p.set(c.type,v)),v}function em(n,c,p,v,I){const{appear:R,mode:D,persisted:i=!1,onBeforeEnter:G,onEnter:X,onAfterEnter:q,onEnterCancelled:ee,onBeforeLeave:ne,onLeave:me,onAfterLeave:he,onLeaveCancelled:ye,onBeforeAppear:Le,onAppear:je,onAfterAppear:vt,onAppearCancelled:Dt}=c,ut=String(n.key),ht=GA(p,n),St=(pt,ot)=>{pt&&la(pt,v,9,ot)},tt=(pt,ot)=>{const gt=ot[1];St(pt,ot),Qr(pt)?pt.every(yt=>yt.length<=1)&&gt():pt.length<=1&&gt()},Et={mode:D,persisted:i,beforeEnter(pt){let ot=G;if(!p.isMounted)if(R)ot=Le||G;else return;pt[uc]&&pt[uc](!0);const gt=ht[ut];gt&&bu(n,gt)&&gt.el[uc]&&gt.el[uc](),St(ot,[pt])},enter(pt){let ot=X,gt=q,yt=ee;if(!p.isMounted)if(R)ot=je||X,gt=vt||q,yt=Dt||ee;else return;let ir=!1;const zr=pt[vg]=Zt=>{ir||(ir=!0,Zt?St(yt,[pt]):St(gt,[pt]),Et.delayedLeave&&Et.delayedLeave(),pt[vg]=void 0)};ot?tt(ot,[pt,zr]):zr()},leave(pt,ot){const gt=String(n.key);if(pt[vg]&&pt[vg](!0),p.isUnmounting)return ot();St(ne,[pt]);let yt=!1;const ir=pt[uc]=zr=>{yt||(yt=!0,ot(),zr?St(ye,[pt]):St(he,[pt]),pt[uc]=void 0,ht[gt]===n&&delete ht[gt])};ht[gt]=n,me?tt(me,[pt,ir]):ir()},clone(pt){const ot=em(pt,c,p,v,I);return I&&I(ot),ot}};return Et}function q0(n){if(dy(n))return n=gc(n),n.children=null,n}function BT(n){if(!dy(n))return FA(n.type)&&n.children?$A(n.children):n;const{shapeFlag:c,children:p}=n;if(p){if(c&16)return p[0];if(c&32&&en(p.default))return p.default()}}function Ru(n,c){n.shapeFlag&6&&n.component?(n.transition=c,Ru(n.component.subTree,c)):n.shapeFlag&128?(n.ssContent.transition=c.clone(n.ssContent),n.ssFallback.transition=c.clone(n.ssFallback)):n.transition=c}function u1(n,c=!1,p){let v=[],I=0;for(let R=0;R<n.length;R++){let D=n[R];const i=p==null?D.key:String(p)+String(D.key!=null?D.key:R);D.type===ti?(D.patchFlag&128&&I++,v=v.concat(u1(D.children,c,i))):(c||D.type!==ks)&&v.push(i!=null?gc(D,{key:i}):D)}if(I>1)for(let R=0;R<v.length;R++)v[R].patchFlag=-2;return v}/*! #__NO_SIDE_EFFECTS__ */function ei(n,c){return en(n)?Gi({name:n.name},c,{setup:n}):n}function qA(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function jg(n,c,p,v,I=!1){if(Qr(n)){n.forEach((he,ye)=>jg(he,c&&(Qr(c)?c[ye]:c),p,v,I));return}if(yd(v)&&!I){v.shapeFlag&512&&v.type.__asyncResolved&&v.component.subTree.component&&jg(n,c,p,v.component.subTree);return}const R=v.shapeFlag&4?my(v.component):v.el,D=I?null:R,{i,r:G}=n,X=c&&c.r,q=i.refs===ni?i.refs={}:i.refs,ee=i.setupState,ne=Mn(ee),me=ee===ni?()=>!1:he=>Un(ne,he);if(X!=null&&X!==G&&(jn(X)?(q[X]=null,me(X)&&(ee[X]=null)):Qn(X)&&(X.value=null)),en(G))_m(G,i,12,[D,q]);else{const he=jn(G),ye=Qn(G);if(he||ye){const Le=()=>{if(n.f){const je=he?me(G)?ee[G]:q[G]:G.value;I?Qr(je)&&Yx(je,R):Qr(je)?je.includes(R)||je.push(R):he?(q[G]=[R],me(G)&&(ee[G]=q[G])):(G.value=[R],n.k&&(q[n.k]=G.value))}else he?(q[G]=D,me(G)&&(ee[G]=D)):ye&&(G.value=D,n.k&&(q[n.k]=D))};D?(Le.id=-1,zs(Le,p)):Le()}}}ay().requestIdleCallback;ay().cancelIdleCallback;const yd=n=>!!n.type.__asyncLoader,dy=n=>n.type.__isKeepAlive;function HA(n,c){ZA(n,"a",c)}function WA(n,c){ZA(n,"da",c)}function ZA(n,c,p=Xi){const v=n.__wdc||(n.__wdc=()=>{let I=p;for(;I;){if(I.isDeactivated)return;I=I.parent}return n()});if(fy(c,v,p),p){let I=p.parent;for(;I&&I.parent;)dy(I.parent.vnode)&&UD(v,c,p,I),I=I.parent}}function UD(n,c,p,v){const I=fy(c,n,v,!0);d1(()=>{Yx(v[c],I)},p)}function fy(n,c,p=Xi,v=!1){if(p){const I=p[n]||(p[n]=[]),R=c.__weh||(c.__weh=(...D)=>{bc();const i=gm(p),G=la(c,p,n,D);return i(),wc(),G});return v?I.unshift(R):I.push(R),R}}const gl=n=>(c,p=Xi)=>{(!nm||n==="sp")&&fy(n,(...v)=>c(...v),p)},XA=gl("bm"),ua=gl("m"),jD=gl("bu"),h1=gl("u"),Na=gl("bum"),d1=gl("um"),$D=gl("sp"),GD=gl("rtg"),qD=gl("rtc");function HD(n,c=Xi){fy("ec",n,c)}const f1="components",WD="directives";function KA(n,c){return m1(f1,n,!0,c)||n}const YA=Symbol.for("v-ndc");function uo(n){return jn(n)?m1(f1,n,!1)||n:n||YA}function p1(n){return m1(WD,n)}function m1(n,c,p=!0,v=!1){const I=$i||Xi;if(I){const R=I.type;if(n===f1){const i=zz(R,!1);if(i&&(i===c||i===Fs(c)||i===xc(Fs(c))))return R}const D=NT(I[n]||R[n],c)||NT(I.appContext[n],c);return!D&&v?R:D}}function NT(n,c){return n&&(n[c]||n[Fs(c)]||n[xc(Fs(c))])}function VT(n,c,p,v){let I;const R=p,D=Qr(n);if(D||jn(n)){const i=D&&_c(n);let G=!1;i&&(G=!Oo(n),n=cy(n)),I=new Array(n.length);for(let X=0,q=n.length;X<q;X++)I[X]=c(G?ds(n[X]):n[X],X,void 0,R)}else if(typeof n=="number"){I=new Array(n);for(let i=0;i<n;i++)I[i]=c(i+1,i,void 0,R)}else if(Xn(n))if(n[Symbol.iterator])I=Array.from(n,(i,G)=>c(i,G,void 0,R));else{const i=Object.keys(n);I=new Array(i.length);for(let G=0,X=i.length;G<X;G++){const q=i[G];I[G]=c(n[q],q,G,R)}}else I=[];return I}function sa(n,c,p={},v,I){if($i.ce||$i.parent&&yd($i.parent)&&$i.parent.ce)return c!=="default"&&(p.name=c),vr(),Dn(ti,null,[dt("slot",p,v&&v())],64);let R=n[c];R&&R._c&&(R._d=!1),vr();const D=R&&JA(R(p)),i=p.key||D&&D.key,G=Dn(ti,{key:(i&&!_l(i)?i:`_${c}`)+(!D&&v?"_fb":"")},D||(v?v():[]),D&&n._===1?64:-2);return G.scopeId&&(G.slotScopeIds=[G.scopeId+"-s"]),R&&R._c&&(R._d=!0),G}function JA(n){return n.some(c=>rm(c)?!(c.type===ks||c.type===ti&&!JA(c.children)):!0)?n:null}const vx=n=>n?vM(n)?my(n):vx(n.parent):null,Gp=Gi(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>vx(n.parent),$root:n=>vx(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>rM(n),$forceUpdate:n=>n.f||(n.f=()=>{c1(n.update)}),$nextTick:n=>n.n||(n.n=Ws.bind(n.proxy)),$watch:n=>_z.bind(n)}),H0=(n,c)=>n!==ni&&!n.__isScriptSetup&&Un(n,c),ZD={get({_:n},c){if(c==="__v_skip")return!0;const{ctx:p,setupState:v,data:I,props:R,accessCache:D,type:i,appContext:G}=n;let X;if(c[0]!=="$"){const me=D[c];if(me!==void 0)switch(me){case 1:return v[c];case 2:return I[c];case 4:return p[c];case 3:return R[c]}else{if(H0(v,c))return D[c]=1,v[c];if(I!==ni&&Un(I,c))return D[c]=2,I[c];if((X=n.propsOptions[0])&&Un(X,c))return D[c]=3,R[c];if(p!==ni&&Un(p,c))return D[c]=4,p[c];xx&&(D[c]=0)}}const q=Gp[c];let ee,ne;if(q)return c==="$attrs"&&hs(n.attrs,"get",""),q(n);if((ee=i.__cssModules)&&(ee=ee[c]))return ee;if(p!==ni&&Un(p,c))return D[c]=4,p[c];if(ne=G.config.globalProperties,Un(ne,c))return ne[c]},set({_:n},c,p){const{data:v,setupState:I,ctx:R}=n;return H0(I,c)?(I[c]=p,!0):v!==ni&&Un(v,c)?(v[c]=p,!0):Un(n.props,c)||c[0]==="$"&&c.slice(1)in n?!1:(R[c]=p,!0)},has({_:{data:n,setupState:c,accessCache:p,ctx:v,appContext:I,propsOptions:R}},D){let i;return!!p[D]||n!==ni&&Un(n,D)||H0(c,D)||(i=R[0])&&Un(i,D)||Un(v,D)||Un(Gp,D)||Un(I.config.globalProperties,D)},defineProperty(n,c,p){return p.get!=null?n._.accessCache[c]=0:Un(p,"value")&&this.set(n,c,p.value,null),Reflect.defineProperty(n,c,p)}};function QA(){return eM().slots}function XD(){return eM().attrs}function eM(){const n=ha();return n.setupContext||(n.setupContext=bM(n))}function UT(n){return Qr(n)?n.reduce((c,p)=>(c[p]=null,c),{}):n}let xx=!0;function KD(n){const c=rM(n),p=n.proxy,v=n.ctx;xx=!1,c.beforeCreate&&jT(c.beforeCreate,n,"bc");const{data:I,computed:R,methods:D,watch:i,provide:G,inject:X,created:q,beforeMount:ee,mounted:ne,beforeUpdate:me,updated:he,activated:ye,deactivated:Le,beforeDestroy:je,beforeUnmount:vt,destroyed:Dt,unmounted:ut,render:ht,renderTracked:St,renderTriggered:tt,errorCaptured:Et,serverPrefetch:pt,expose:ot,inheritAttrs:gt,components:yt,directives:ir,filters:zr}=c;if(X&&YD(X,v,null),D)for(const yr in D){const Nr=D[yr];en(Nr)&&(v[yr]=Nr.bind(p))}if(I){const yr=I.call(p,p);Xn(yr)&&(n.data=Zi(yr))}if(xx=!0,R)for(const yr in R){const Nr=R[yr],ar=en(Nr)?Nr.bind(p,p):en(Nr.get)?Nr.get.bind(p,p):mo,Gr=!en(Nr)&&en(Nr.set)?Nr.set.bind(p):mo,cr=ct({get:ar,set:Gr});Object.defineProperty(v,yr,{enumerable:!0,configurable:!0,get:()=>cr.value,set:rr=>cr.value=rr})}if(i)for(const yr in i)tM(i[yr],v,p,yr);if(G){const yr=en(G)?G.call(p):G;Reflect.ownKeys(yr).forEach(Nr=>{ko(Nr,yr[Nr])})}q&&jT(q,n,"c");function Ir(yr,Nr){Qr(Nr)?Nr.forEach(ar=>yr(ar.bind(p))):Nr&&yr(Nr.bind(p))}if(Ir(XA,ee),Ir(ua,ne),Ir(jD,me),Ir(h1,he),Ir(HA,ye),Ir(WA,Le),Ir(HD,Et),Ir(qD,St),Ir(GD,tt),Ir(Na,vt),Ir(d1,ut),Ir($D,pt),Qr(ot))if(ot.length){const yr=n.exposed||(n.exposed={});ot.forEach(Nr=>{Object.defineProperty(yr,Nr,{get:()=>p[Nr],set:ar=>p[Nr]=ar})})}else n.exposed||(n.exposed={});ht&&n.render===mo&&(n.render=ht),gt!=null&&(n.inheritAttrs=gt),yt&&(n.components=yt),ir&&(n.directives=ir),pt&&qA(n)}function YD(n,c,p=mo){Qr(n)&&(n=bx(n));for(const v in n){const I=n[v];let R;Xn(I)?"default"in I?R=Hn(I.from||v,I.default,!0):R=Hn(I.from||v):R=Hn(I),Qn(R)?Object.defineProperty(c,v,{enumerable:!0,configurable:!0,get:()=>R.value,set:D=>R.value=D}):c[v]=R}}function jT(n,c,p){la(Qr(n)?n.map(v=>v.bind(c.proxy)):n.bind(c.proxy),c,p)}function tM(n,c,p,v){let I=v.includes(".")?pM(p,v):()=>p[v];if(jn(n)){const R=c[n];en(R)&&zn(I,R)}else if(en(n))zn(I,n.bind(p));else if(Xn(n))if(Qr(n))n.forEach(R=>tM(R,c,p,v));else{const R=en(n.handler)?n.handler.bind(p):c[n.handler];en(R)&&zn(I,R,n)}}function rM(n){const c=n.type,{mixins:p,extends:v}=c,{mixins:I,optionsCache:R,config:{optionMergeStrategies:D}}=n.appContext,i=R.get(c);let G;return i?G=i:!I.length&&!p&&!v?G=c:(G={},I.length&&I.forEach(X=>$g(G,X,D,!0)),$g(G,c,D)),Xn(c)&&R.set(c,G),G}function $g(n,c,p,v=!1){const{mixins:I,extends:R}=c;R&&$g(n,R,p,!0),I&&I.forEach(D=>$g(n,D,p,!0));for(const D in c)if(!(v&&D==="expose")){const i=JD[D]||p&&p[D];n[D]=i?i(n[D],c[D]):c[D]}return n}const JD={data:$T,props:GT,emits:GT,methods:Bp,computed:Bp,beforeCreate:Ds,created:Ds,beforeMount:Ds,mounted:Ds,beforeUpdate:Ds,updated:Ds,beforeDestroy:Ds,beforeUnmount:Ds,destroyed:Ds,unmounted:Ds,activated:Ds,deactivated:Ds,errorCaptured:Ds,serverPrefetch:Ds,components:Bp,directives:Bp,watch:ez,provide:$T,inject:QD};function $T(n,c){return c?n?function(){return Gi(en(n)?n.call(this,this):n,en(c)?c.call(this,this):c)}:c:n}function QD(n,c){return Bp(bx(n),bx(c))}function bx(n){if(Qr(n)){const c={};for(let p=0;p<n.length;p++)c[n[p]]=n[p];return c}return n}function Ds(n,c){return n?[...new Set([].concat(n,c))]:c}function Bp(n,c){return n?Gi(Object.create(null),n,c):c}function GT(n,c){return n?Qr(n)&&Qr(c)?[...new Set([...n,...c])]:Gi(Object.create(null),UT(n),UT(c??{})):c}function ez(n,c){if(!n)return c;if(!c)return n;const p=Gi(Object.create(null),n);for(const v in c)p[v]=Ds(n[v],c[v]);return p}function nM(){return{app:null,config:{isNativeTag:XR,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let tz=0;function rz(n,c){return function(v,I=null){en(v)||(v=Gi({},v)),I!=null&&!Xn(I)&&(I=null);const R=nM(),D=new WeakSet,i=[];let G=!1;const X=R.app={_uid:tz++,_component:v,_props:I,_container:null,_context:R,_instance:null,version:Oz,get config(){return R.config},set config(q){},use(q,...ee){return D.has(q)||(q&&en(q.install)?(D.add(q),q.install(X,...ee)):en(q)&&(D.add(q),q(X,...ee))),X},mixin(q){return R.mixins.includes(q)||R.mixins.push(q),X},component(q,ee){return ee?(R.components[q]=ee,X):R.components[q]},directive(q,ee){return ee?(R.directives[q]=ee,X):R.directives[q]},mount(q,ee,ne){if(!G){const me=X._ceVNode||dt(v,I);return me.appContext=R,ne===!0?ne="svg":ne===!1&&(ne=void 0),n(me,q,ne),G=!0,X._container=q,q.__vue_app__=X,my(me.component)}},onUnmount(q){i.push(q)},unmount(){G&&(la(i,X._instance,16),n(null,X._container),delete X._container.__vue_app__)},provide(q,ee){return R.provides[q]=ee,X},runWithContext(q){const ee=Eu;Eu=X;try{return q()}finally{Eu=ee}}};return X}}let Eu=null;function ko(n,c){if(Xi){let p=Xi.provides;const v=Xi.parent&&Xi.parent.provides;v===p&&(p=Xi.provides=Object.create(v)),p[n]=c}}function Hn(n,c,p=!1){const v=Xi||$i;if(v||Eu){const I=Eu?Eu._context.provides:v?v.parent==null?v.vnode.appContext&&v.vnode.appContext.provides:v.parent.provides:void 0;if(I&&n in I)return I[n];if(arguments.length>1)return p&&en(c)?c.call(v&&v.proxy):c}}function nz(){return!!(Xi||$i||Eu)}const iM={},sM=()=>Object.create(iM),oM=n=>Object.getPrototypeOf(n)===iM;function iz(n,c,p,v=!1){const I={},R=sM();n.propsDefaults=Object.create(null),aM(n,c,I,R);for(const D in n.propsOptions[0])D in I||(I[D]=void 0);p?n.props=v?I:MA(I):n.type.props?n.props=I:n.props=R,n.attrs=R}function sz(n,c,p,v){const{props:I,attrs:R,vnode:{patchFlag:D}}=n,i=Mn(I),[G]=n.propsOptions;let X=!1;if((v||D>0)&&!(D&16)){if(D&8){const q=n.vnode.dynamicProps;for(let ee=0;ee<q.length;ee++){let ne=q[ee];if(py(n.emitsOptions,ne))continue;const me=c[ne];if(G)if(Un(R,ne))me!==R[ne]&&(R[ne]=me,X=!0);else{const he=Fs(ne);I[he]=wx(G,i,he,me,n,!1)}else me!==R[ne]&&(R[ne]=me,X=!0)}}}else{aM(n,c,I,R)&&(X=!0);let q;for(const ee in i)(!c||!Un(c,ee)&&((q=vc(ee))===ee||!Un(c,q)))&&(G?p&&(p[ee]!==void 0||p[q]!==void 0)&&(I[ee]=wx(G,i,ee,void 0,n,!0)):delete I[ee]);if(R!==i)for(const ee in R)(!c||!Un(c,ee))&&(delete R[ee],X=!0)}X&&fl(n.attrs,"set","")}function aM(n,c,p,v){const[I,R]=n.propsOptions;let D=!1,i;if(c)for(let G in c){if(Vp(G))continue;const X=c[G];let q;I&&Un(I,q=Fs(G))?!R||!R.includes(q)?p[q]=X:(i||(i={}))[q]=X:py(n.emitsOptions,G)||(!(G in v)||X!==v[G])&&(v[G]=X,D=!0)}if(R){const G=Mn(p),X=i||ni;for(let q=0;q<R.length;q++){const ee=R[q];p[ee]=wx(I,G,ee,X[ee],n,!Un(X,ee))}}return D}function wx(n,c,p,v,I,R){const D=n[p];if(D!=null){const i=Un(D,"default");if(i&&v===void 0){const G=D.default;if(D.type!==Function&&!D.skipFactory&&en(G)){const{propsDefaults:X}=I;if(p in X)v=X[p];else{const q=gm(I);v=X[p]=G.call(null,c),q()}}else v=G;I.ce&&I.ce._setProp(p,v)}D[0]&&(R&&!i?v=!1:D[1]&&(v===""||v===vc(p))&&(v=!0))}return v}const oz=new WeakMap;function lM(n,c,p=!1){const v=p?oz:c.propsCache,I=v.get(n);if(I)return I;const R=n.props,D={},i=[];let G=!1;if(!en(n)){const q=ee=>{G=!0;const[ne,me]=lM(ee,c,!0);Gi(D,ne),me&&i.push(...me)};!p&&c.mixins.length&&c.mixins.forEach(q),n.extends&&q(n.extends),n.mixins&&n.mixins.forEach(q)}if(!R&&!G)return Xn(n)&&v.set(n,md),md;if(Qr(R))for(let q=0;q<R.length;q++){const ee=Fs(R[q]);qT(ee)&&(D[ee]=ni)}else if(R)for(const q in R){const ee=Fs(q);if(qT(ee)){const ne=R[q],me=D[ee]=Qr(ne)||en(ne)?{type:ne}:Gi({},ne),he=me.type;let ye=!1,Le=!0;if(Qr(he))for(let je=0;je<he.length;++je){const vt=he[je],Dt=en(vt)&&vt.name;if(Dt==="Boolean"){ye=!0;break}else Dt==="String"&&(Le=!1)}else ye=en(he)&&he.name==="Boolean";me[0]=ye,me[1]=Le,(ye||Un(me,"default"))&&i.push(ee)}}const X=[D,i];return Xn(n)&&v.set(n,X),X}function qT(n){return n[0]!=="$"&&!Vp(n)}const cM=n=>n[0]==="_"||n==="$stable",_1=n=>Qr(n)?n.map(Fa):[Fa(n)],az=(n,c,p)=>{if(c._n)return c;const v=An((...I)=>_1(c(...I)),p);return v._c=!1,v},uM=(n,c,p)=>{const v=n._ctx;for(const I in n){if(cM(I))continue;const R=n[I];if(en(R))c[I]=az(I,R,v);else if(R!=null){const D=_1(R);c[I]=()=>D}}},hM=(n,c)=>{const p=_1(c);n.slots.default=()=>p},dM=(n,c,p)=>{for(const v in c)(p||v!=="_")&&(n[v]=c[v])},lz=(n,c,p)=>{const v=n.slots=sM();if(n.vnode.shapeFlag&32){const I=c._;I?(dM(v,c,p),p&&lA(v,"_",I,!0)):uM(c,v)}else c&&hM(n,c)},cz=(n,c,p)=>{const{vnode:v,slots:I}=n;let R=!0,D=ni;if(v.shapeFlag&32){const i=c._;i?p&&i===1?R=!1:dM(I,c,p):(R=!c.$stable,uM(c,I)),D=c}else c&&(hM(n,c),D={default:1});if(R)for(const i in I)!cM(i)&&D[i]==null&&delete I[i]},zs=Tz;function uz(n){return hz(n)}function hz(n,c){const p=ay();p.__VUE__=!0;const{insert:v,remove:I,patchProp:R,createElement:D,createText:i,createComment:G,setText:X,setElementText:q,parentNode:ee,nextSibling:ne,setScopeId:me=mo,insertStaticContent:he}=n,ye=(ke,Ve,Ae,xt=null,Vt=null,zt=null,Rt=void 0,jt=null,Yt=!!Ve.dynamicChildren)=>{if(ke===Ve)return;ke&&!bu(ke,Ve)&&(xt=Pt(ke),rr(ke,Vt,zt,!0),ke=null),Ve.patchFlag===-2&&(Yt=!1,Ve.dynamicChildren=null);const{type:Gt,ref:Cr,shapeFlag:lr}=Ve;switch(Gt){case Md:Le(ke,Ve,Ae,xt);break;case ks:je(ke,Ve,Ae,xt);break;case Z0:ke==null&&vt(Ve,Ae,xt,Rt);break;case ti:yt(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt);break;default:lr&1?ht(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt):lr&6?ir(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt):(lr&64||lr&128)&&Gt.process(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt,te)}Cr!=null&&Vt&&jg(Cr,ke&&ke.ref,zt,Ve||ke,!Ve)},Le=(ke,Ve,Ae,xt)=>{if(ke==null)v(Ve.el=i(Ve.children),Ae,xt);else{const Vt=Ve.el=ke.el;Ve.children!==ke.children&&X(Vt,Ve.children)}},je=(ke,Ve,Ae,xt)=>{ke==null?v(Ve.el=G(Ve.children||""),Ae,xt):Ve.el=ke.el},vt=(ke,Ve,Ae,xt)=>{[ke.el,ke.anchor]=he(ke.children,Ve,Ae,xt,ke.el,ke.anchor)},Dt=({el:ke,anchor:Ve},Ae,xt)=>{let Vt;for(;ke&&ke!==Ve;)Vt=ne(ke),v(ke,Ae,xt),ke=Vt;v(Ve,Ae,xt)},ut=({el:ke,anchor:Ve})=>{let Ae;for(;ke&&ke!==Ve;)Ae=ne(ke),I(ke),ke=Ae;I(Ve)},ht=(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt)=>{Ve.type==="svg"?Rt="svg":Ve.type==="math"&&(Rt="mathml"),ke==null?St(Ve,Ae,xt,Vt,zt,Rt,jt,Yt):pt(ke,Ve,Vt,zt,Rt,jt,Yt)},St=(ke,Ve,Ae,xt,Vt,zt,Rt,jt)=>{let Yt,Gt;const{props:Cr,shapeFlag:lr,transition:Ye,dirs:Jt}=ke;if(Yt=ke.el=D(ke.type,zt,Cr&&Cr.is,Cr),lr&8?q(Yt,ke.children):lr&16&&Et(ke.children,Yt,null,xt,Vt,W0(ke,zt),Rt,jt),Jt&&pu(ke,null,xt,"created"),tt(Yt,ke,ke.scopeId,Rt,xt),Cr){for(const _n in Cr)_n!=="value"&&!Vp(_n)&&R(Yt,_n,null,Cr[_n],zt,xt);"value"in Cr&&R(Yt,"value",null,Cr.value,zt),(Gt=Cr.onVnodeBeforeMount)&&za(Gt,xt,ke)}Jt&&pu(ke,null,xt,"beforeMount");const jr=dz(Vt,Ye);jr&&Ye.beforeEnter(Yt),v(Yt,Ve,Ae),((Gt=Cr&&Cr.onVnodeMounted)||jr||Jt)&&zs(()=>{Gt&&za(Gt,xt,ke),jr&&Ye.enter(Yt),Jt&&pu(ke,null,xt,"mounted")},Vt)},tt=(ke,Ve,Ae,xt,Vt)=>{if(Ae&&me(ke,Ae),xt)for(let zt=0;zt<xt.length;zt++)me(ke,xt[zt]);if(Vt){let zt=Vt.subTree;if(Ve===zt||_M(zt.type)&&(zt.ssContent===Ve||zt.ssFallback===Ve)){const Rt=Vt.vnode;tt(ke,Rt,Rt.scopeId,Rt.slotScopeIds,Vt.parent)}}},Et=(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt=0)=>{for(let Gt=Yt;Gt<ke.length;Gt++){const Cr=ke[Gt]=jt?hc(ke[Gt]):Fa(ke[Gt]);ye(null,Cr,Ve,Ae,xt,Vt,zt,Rt,jt)}},pt=(ke,Ve,Ae,xt,Vt,zt,Rt)=>{const jt=Ve.el=ke.el;let{patchFlag:Yt,dynamicChildren:Gt,dirs:Cr}=Ve;Yt|=ke.patchFlag&16;const lr=ke.props||ni,Ye=Ve.props||ni;let Jt;if(Ae&&mu(Ae,!1),(Jt=Ye.onVnodeBeforeUpdate)&&za(Jt,Ae,Ve,ke),Cr&&pu(Ve,ke,Ae,"beforeUpdate"),Ae&&mu(Ae,!0),(lr.innerHTML&&Ye.innerHTML==null||lr.textContent&&Ye.textContent==null)&&q(jt,""),Gt?ot(ke.dynamicChildren,Gt,jt,Ae,xt,W0(Ve,Vt),zt):Rt||Nr(ke,Ve,jt,null,Ae,xt,W0(Ve,Vt),zt,!1),Yt>0){if(Yt&16)gt(jt,lr,Ye,Ae,Vt);else if(Yt&2&&lr.class!==Ye.class&&R(jt,"class",null,Ye.class,Vt),Yt&4&&R(jt,"style",lr.style,Ye.style,Vt),Yt&8){const jr=Ve.dynamicProps;for(let _n=0;_n<jr.length;_n++){const Vr=jr[_n],xi=lr[Vr],ri=Ye[Vr];(ri!==xi||Vr==="value")&&R(jt,Vr,xi,ri,Vt,Ae)}}Yt&1&&ke.children!==Ve.children&&q(jt,Ve.children)}else!Rt&&Gt==null&&gt(jt,lr,Ye,Ae,Vt);((Jt=Ye.onVnodeUpdated)||Cr)&&zs(()=>{Jt&&za(Jt,Ae,Ve,ke),Cr&&pu(Ve,ke,Ae,"updated")},xt)},ot=(ke,Ve,Ae,xt,Vt,zt,Rt)=>{for(let jt=0;jt<Ve.length;jt++){const Yt=ke[jt],Gt=Ve[jt],Cr=Yt.el&&(Yt.type===ti||!bu(Yt,Gt)||Yt.shapeFlag&70)?ee(Yt.el):Ae;ye(Yt,Gt,Cr,null,xt,Vt,zt,Rt,!0)}},gt=(ke,Ve,Ae,xt,Vt)=>{if(Ve!==Ae){if(Ve!==ni)for(const zt in Ve)!Vp(zt)&&!(zt in Ae)&&R(ke,zt,Ve[zt],null,Vt,xt);for(const zt in Ae){if(Vp(zt))continue;const Rt=Ae[zt],jt=Ve[zt];Rt!==jt&&zt!=="value"&&R(ke,zt,jt,Rt,Vt,xt)}"value"in Ae&&R(ke,"value",Ve.value,Ae.value,Vt)}},yt=(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt)=>{const Gt=Ve.el=ke?ke.el:i(""),Cr=Ve.anchor=ke?ke.anchor:i("");let{patchFlag:lr,dynamicChildren:Ye,slotScopeIds:Jt}=Ve;Jt&&(jt=jt?jt.concat(Jt):Jt),ke==null?(v(Gt,Ae,xt),v(Cr,Ae,xt),Et(Ve.children||[],Ae,Cr,Vt,zt,Rt,jt,Yt)):lr>0&&lr&64&&Ye&&ke.dynamicChildren?(ot(ke.dynamicChildren,Ye,Ae,Vt,zt,Rt,jt),(Ve.key!=null||Vt&&Ve===Vt.subTree)&&g1(ke,Ve,!0)):Nr(ke,Ve,Ae,Cr,Vt,zt,Rt,jt,Yt)},ir=(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt)=>{Ve.slotScopeIds=jt,ke==null?Ve.shapeFlag&512?Vt.ctx.activate(Ve,Ae,xt,Rt,Yt):zr(Ve,Ae,xt,Vt,zt,Rt,Yt):Zt(ke,Ve,Yt)},zr=(ke,Ve,Ae,xt,Vt,zt,Rt)=>{const jt=ke.component=Cz(ke,xt,Vt);if(dy(ke)&&(jt.ctx.renderer=te),Pz(jt,!1,Rt),jt.asyncDep){if(Vt&&Vt.registerDep(jt,Ir,Rt),!ke.el){const Yt=jt.subTree=dt(ks);je(null,Yt,Ve,Ae)}}else Ir(jt,ke,Ve,Ae,Vt,zt,Rt)},Zt=(ke,Ve,Ae)=>{const xt=Ve.component=ke.component;if(bz(ke,Ve,Ae))if(xt.asyncDep&&!xt.asyncResolved){yr(xt,Ve,Ae);return}else xt.next=Ve,xt.update();else Ve.el=ke.el,xt.vnode=Ve},Ir=(ke,Ve,Ae,xt,Vt,zt,Rt)=>{const jt=()=>{if(ke.isMounted){let{next:lr,bu:Ye,u:Jt,parent:jr,vnode:_n}=ke;{const ki=fM(ke);if(ki){lr&&(lr.el=_n.el,yr(ke,lr,Rt)),ki.asyncDep.then(()=>{ke.isUnmounted||jt()});return}}let Vr=lr,xi;mu(ke,!1),lr?(lr.el=_n.el,yr(ke,lr,Rt)):lr=_n,Ye&&V0(Ye),(xi=lr.props&&lr.props.onVnodeBeforeUpdate)&&za(xi,jr,lr,_n),mu(ke,!0);const ri=WT(ke),Ki=ke.subTree;ke.subTree=ri,ye(Ki,ri,ee(Ki.el),Pt(Ki),ke,Vt,zt),lr.el=ri.el,Vr===null&&wz(ke,ri.el),Jt&&zs(Jt,Vt),(xi=lr.props&&lr.props.onVnodeUpdated)&&zs(()=>za(xi,jr,lr,_n),Vt)}else{let lr;const{el:Ye,props:Jt}=Ve,{bm:jr,m:_n,parent:Vr,root:xi,type:ri}=ke,Ki=yd(Ve);mu(ke,!1),jr&&V0(jr),!Ki&&(lr=Jt&&Jt.onVnodeBeforeMount)&&za(lr,Vr,Ve),mu(ke,!0);{xi.ce&&xi.ce._injectChildStyle(ri);const ki=ke.subTree=WT(ke);ye(null,ki,Ae,xt,ke,Vt,zt),Ve.el=ki.el}if(_n&&zs(_n,Vt),!Ki&&(lr=Jt&&Jt.onVnodeMounted)){const ki=Ve;zs(()=>za(lr,Vr,ki),Vt)}(Ve.shapeFlag&256||Vr&&yd(Vr.vnode)&&Vr.vnode.shapeFlag&256)&&ke.a&&zs(ke.a,Vt),ke.isMounted=!0,Ve=Ae=xt=null}};ke.scope.on();const Yt=ke.effect=new fA(jt);ke.scope.off();const Gt=ke.update=Yt.run.bind(Yt),Cr=ke.job=Yt.runIfDirty.bind(Yt);Cr.i=ke,Cr.id=ke.uid,Yt.scheduler=()=>c1(Cr),mu(ke,!0),Gt()},yr=(ke,Ve,Ae)=>{Ve.component=ke;const xt=ke.vnode.props;ke.vnode=Ve,ke.next=null,sz(ke,Ve.props,xt,Ae),cz(ke,Ve.children,Ae),bc(),LT(ke),wc()},Nr=(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt=!1)=>{const Gt=ke&&ke.children,Cr=ke?ke.shapeFlag:0,lr=Ve.children,{patchFlag:Ye,shapeFlag:Jt}=Ve;if(Ye>0){if(Ye&128){Gr(Gt,lr,Ae,xt,Vt,zt,Rt,jt,Yt);return}else if(Ye&256){ar(Gt,lr,Ae,xt,Vt,zt,Rt,jt,Yt);return}}Jt&8?(Cr&16&&pn(Gt,Vt,zt),lr!==Gt&&q(Ae,lr)):Cr&16?Jt&16?Gr(Gt,lr,Ae,xt,Vt,zt,Rt,jt,Yt):pn(Gt,Vt,zt,!0):(Cr&8&&q(Ae,""),Jt&16&&Et(lr,Ae,xt,Vt,zt,Rt,jt,Yt))},ar=(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt)=>{ke=ke||md,Ve=Ve||md;const Gt=ke.length,Cr=Ve.length,lr=Math.min(Gt,Cr);let Ye;for(Ye=0;Ye<lr;Ye++){const Jt=Ve[Ye]=Yt?hc(Ve[Ye]):Fa(Ve[Ye]);ye(ke[Ye],Jt,Ae,null,Vt,zt,Rt,jt,Yt)}Gt>Cr?pn(ke,Vt,zt,!0,!1,lr):Et(Ve,Ae,xt,Vt,zt,Rt,jt,Yt,lr)},Gr=(ke,Ve,Ae,xt,Vt,zt,Rt,jt,Yt)=>{let Gt=0;const Cr=Ve.length;let lr=ke.length-1,Ye=Cr-1;for(;Gt<=lr&&Gt<=Ye;){const Jt=ke[Gt],jr=Ve[Gt]=Yt?hc(Ve[Gt]):Fa(Ve[Gt]);if(bu(Jt,jr))ye(Jt,jr,Ae,null,Vt,zt,Rt,jt,Yt);else break;Gt++}for(;Gt<=lr&&Gt<=Ye;){const Jt=ke[lr],jr=Ve[Ye]=Yt?hc(Ve[Ye]):Fa(Ve[Ye]);if(bu(Jt,jr))ye(Jt,jr,Ae,null,Vt,zt,Rt,jt,Yt);else break;lr--,Ye--}if(Gt>lr){if(Gt<=Ye){const Jt=Ye+1,jr=Jt<Cr?Ve[Jt].el:xt;for(;Gt<=Ye;)ye(null,Ve[Gt]=Yt?hc(Ve[Gt]):Fa(Ve[Gt]),Ae,jr,Vt,zt,Rt,jt,Yt),Gt++}}else if(Gt>Ye)for(;Gt<=lr;)rr(ke[Gt],Vt,zt,!0),Gt++;else{const Jt=Gt,jr=Gt,_n=new Map;for(Gt=jr;Gt<=Ye;Gt++){const Kn=Ve[Gt]=Yt?hc(Ve[Gt]):Fa(Ve[Gt]);Kn.key!=null&&_n.set(Kn.key,Gt)}let Vr,xi=0;const ri=Ye-jr+1;let Ki=!1,ki=0;const ys=new Array(ri);for(Gt=0;Gt<ri;Gt++)ys[Gt]=0;for(Gt=Jt;Gt<=lr;Gt++){const Kn=ke[Gt];if(xi>=ri){rr(Kn,Vt,zt,!0);continue}let Fi;if(Kn.key!=null)Fi=_n.get(Kn.key);else for(Vr=jr;Vr<=Ye;Vr++)if(ys[Vr-jr]===0&&bu(Kn,Ve[Vr])){Fi=Vr;break}Fi===void 0?rr(Kn,Vt,zt,!0):(ys[Fi-jr]=Gt+1,Fi>=ki?ki=Fi:Ki=!0,ye(Kn,Ve[Fi],Ae,null,Vt,zt,Rt,jt,Yt),xi++)}const vo=Ki?fz(ys):md;for(Vr=vo.length-1,Gt=ri-1;Gt>=0;Gt--){const Kn=jr+Gt,Fi=Ve[Kn],Pr=Kn+1<Cr?Ve[Kn+1].el:xt;ys[Gt]===0?ye(null,Fi,Ae,Pr,Vt,zt,Rt,jt,Yt):Ki&&(Vr<0||Gt!==vo[Vr]?cr(Fi,Ae,Pr,2):Vr--)}}},cr=(ke,Ve,Ae,xt,Vt=null)=>{const{el:zt,type:Rt,transition:jt,children:Yt,shapeFlag:Gt}=ke;if(Gt&6){cr(ke.component.subTree,Ve,Ae,xt);return}if(Gt&128){ke.suspense.move(Ve,Ae,xt);return}if(Gt&64){Rt.move(ke,Ve,Ae,te);return}if(Rt===ti){v(zt,Ve,Ae);for(let lr=0;lr<Yt.length;lr++)cr(Yt[lr],Ve,Ae,xt);v(ke.anchor,Ve,Ae);return}if(Rt===Z0){Dt(ke,Ve,Ae);return}if(xt!==2&&Gt&1&&jt)if(xt===0)jt.beforeEnter(zt),v(zt,Ve,Ae),zs(()=>jt.enter(zt),Vt);else{const{leave:lr,delayLeave:Ye,afterLeave:Jt}=jt,jr=()=>v(zt,Ve,Ae),_n=()=>{lr(zt,()=>{jr(),Jt&&Jt()})};Ye?Ye(zt,jr,_n):_n()}else v(zt,Ve,Ae)},rr=(ke,Ve,Ae,xt=!1,Vt=!1)=>{const{type:zt,props:Rt,ref:jt,children:Yt,dynamicChildren:Gt,shapeFlag:Cr,patchFlag:lr,dirs:Ye,cacheIndex:Jt}=ke;if(lr===-2&&(Vt=!1),jt!=null&&jg(jt,null,Ae,ke,!0),Jt!=null&&(Ve.renderCache[Jt]=void 0),Cr&256){Ve.ctx.deactivate(ke);return}const jr=Cr&1&&Ye,_n=!yd(ke);let Vr;if(_n&&(Vr=Rt&&Rt.onVnodeBeforeUnmount)&&za(Vr,Ve,ke),Cr&6)hi(ke.component,Ae,xt);else{if(Cr&128){ke.suspense.unmount(Ae,xt);return}jr&&pu(ke,null,Ve,"beforeUnmount"),Cr&64?ke.type.remove(ke,Ve,Ae,te,xt):Gt&&!Gt.hasOnce&&(zt!==ti||lr>0&&lr&64)?pn(Gt,Ve,Ae,!1,!0):(zt===ti&&lr&384||!Vt&&Cr&16)&&pn(Yt,Ve,Ae),xt&&$t(ke)}(_n&&(Vr=Rt&&Rt.onVnodeUnmounted)||jr)&&zs(()=>{Vr&&za(Vr,Ve,ke),jr&&pu(ke,null,Ve,"unmounted")},Ae)},$t=ke=>{const{type:Ve,el:Ae,anchor:xt,transition:Vt}=ke;if(Ve===ti){vi(Ae,xt);return}if(Ve===Z0){ut(ke);return}const zt=()=>{I(Ae),Vt&&!Vt.persisted&&Vt.afterLeave&&Vt.afterLeave()};if(ke.shapeFlag&1&&Vt&&!Vt.persisted){const{leave:Rt,delayLeave:jt}=Vt,Yt=()=>Rt(Ae,zt);jt?jt(ke.el,zt,Yt):Yt()}else zt()},vi=(ke,Ve)=>{let Ae;for(;ke!==Ve;)Ae=ne(ke),I(ke),ke=Ae;I(Ve)},hi=(ke,Ve,Ae)=>{const{bum:xt,scope:Vt,job:zt,subTree:Rt,um:jt,m:Yt,a:Gt}=ke;HT(Yt),HT(Gt),xt&&V0(xt),Vt.stop(),zt&&(zt.flags|=8,rr(Rt,ke,Ve,Ae)),jt&&zs(jt,Ve),zs(()=>{ke.isUnmounted=!0},Ve),Ve&&Ve.pendingBranch&&!Ve.isUnmounted&&ke.asyncDep&&!ke.asyncResolved&&ke.suspenseId===Ve.pendingId&&(Ve.deps--,Ve.deps===0&&Ve.resolve())},pn=(ke,Ve,Ae,xt=!1,Vt=!1,zt=0)=>{for(let Rt=zt;Rt<ke.length;Rt++)rr(ke[Rt],Ve,Ae,xt,Vt)},Pt=ke=>{if(ke.shapeFlag&6)return Pt(ke.component.subTree);if(ke.shapeFlag&128)return ke.suspense.next();const Ve=ne(ke.anchor||ke.el),Ae=Ve&&Ve[kA];return Ae?ne(Ae):Ve};let er=!1;const Kt=(ke,Ve,Ae)=>{ke==null?Ve._vnode&&rr(Ve._vnode,null,null,!0):ye(Ve._vnode||null,ke,Ve,null,null,null,Ae),Ve._vnode=ke,er||(er=!0,LT(),zA(),er=!1)},te={p:ye,um:rr,m:cr,r:$t,mt:zr,mc:Et,pc:Nr,pbc:ot,n:Pt,o:n};return{render:Kt,hydrate:void 0,createApp:rz(Kt)}}function W0({type:n,props:c},p){return p==="svg"&&n==="foreignObject"||p==="mathml"&&n==="annotation-xml"&&c&&c.encoding&&c.encoding.includes("html")?void 0:p}function mu({effect:n,job:c},p){p?(n.flags|=32,c.flags|=4):(n.flags&=-33,c.flags&=-5)}function dz(n,c){return(!n||n&&!n.pendingBranch)&&c&&!c.persisted}function g1(n,c,p=!1){const v=n.children,I=c.children;if(Qr(v)&&Qr(I))for(let R=0;R<v.length;R++){const D=v[R];let i=I[R];i.shapeFlag&1&&!i.dynamicChildren&&((i.patchFlag<=0||i.patchFlag===32)&&(i=I[R]=hc(I[R]),i.el=D.el),!p&&i.patchFlag!==-2&&g1(D,i)),i.type===Md&&(i.el=D.el)}}function fz(n){const c=n.slice(),p=[0];let v,I,R,D,i;const G=n.length;for(v=0;v<G;v++){const X=n[v];if(X!==0){if(I=p[p.length-1],n[I]<X){c[v]=I,p.push(v);continue}for(R=0,D=p.length-1;R<D;)i=R+D>>1,n[p[i]]<X?R=i+1:D=i;X<n[p[R]]&&(R>0&&(c[v]=p[R-1]),p[R]=v)}}for(R=p.length,D=p[R-1];R-- >0;)p[R]=D,D=c[D];return p}function fM(n){const c=n.subTree.component;if(c)return c.asyncDep&&!c.asyncResolved?c:fM(c)}function HT(n){if(n)for(let c=0;c<n.length;c++)n[c].flags|=8}const pz=Symbol.for("v-scx"),mz=()=>Hn(pz);function Ad(n,c){return y1(n,null,c)}function zn(n,c,p){return y1(n,c,p)}function y1(n,c,p=ni){const{immediate:v,deep:I,flush:R,once:D}=p,i=Gi({},p),G=c&&v||!c&&R!=="post";let X;if(nm){if(R==="sync"){const me=mz();X=me.__watcherHandles||(me.__watcherHandles=[])}else if(!G){const me=()=>{};return me.stop=mo,me.resume=mo,me.pause=mo,me}}const q=Xi;i.call=(me,he,ye)=>la(me,q,he,ye);let ee=!1;R==="post"?i.scheduler=me=>{zs(me,q&&q.suspense)}:R!=="sync"&&(ee=!0,i.scheduler=(me,he)=>{he?me():c1(me)}),i.augmentJob=me=>{c&&(me.flags|=4),ee&&(me.flags|=2,q&&(me.id=q.uid,me.i=q))};const ne=LD(n,c,i);return nm&&(X?X.push(ne):G&&ne()),ne}function _z(n,c,p){const v=this.proxy,I=jn(n)?n.includes(".")?pM(v,n):()=>v[n]:n.bind(v,v);let R;en(c)?R=c:(R=c.handler,p=c);const D=gm(this),i=y1(I,R.bind(v),p);return D(),i}function pM(n,c){const p=c.split(".");return()=>{let v=n;for(let I=0;I<p.length&&v;I++)v=v[p[I]];return v}}const gz=(n,c)=>c==="modelValue"||c==="model-value"?n.modelModifiers:n[`${c}Modifiers`]||n[`${Fs(c)}Modifiers`]||n[`${vc(c)}Modifiers`];function yz(n,c,...p){if(n.isUnmounted)return;const v=n.vnode.props||ni;let I=p;const R=c.startsWith("update:"),D=R&&gz(v,c.slice(7));D&&(D.trim&&(I=p.map(q=>jn(q)?q.trim():q)),D.number&&(I=p.map(eD)));let i,G=v[i=N0(c)]||v[i=N0(Fs(c))];!G&&R&&(G=v[i=N0(vc(c))]),G&&la(G,n,6,I);const X=v[i+"Once"];if(X){if(!n.emitted)n.emitted={};else if(n.emitted[i])return;n.emitted[i]=!0,la(X,n,6,I)}}function mM(n,c,p=!1){const v=c.emitsCache,I=v.get(n);if(I!==void 0)return I;const R=n.emits;let D={},i=!1;if(!en(n)){const G=X=>{const q=mM(X,c,!0);q&&(i=!0,Gi(D,q))};!p&&c.mixins.length&&c.mixins.forEach(G),n.extends&&G(n.extends),n.mixins&&n.mixins.forEach(G)}return!R&&!i?(Xn(n)&&v.set(n,null),null):(Qr(R)?R.forEach(G=>D[G]=null):Gi(D,R),Xn(n)&&v.set(n,D),D)}function py(n,c){return!n||!iy(c)?!1:(c=c.slice(2).replace(/Once$/,""),Un(n,c[0].toLowerCase()+c.slice(1))||Un(n,vc(c))||Un(n,c))}function WT(n){const{type:c,vnode:p,proxy:v,withProxy:I,propsOptions:[R],slots:D,attrs:i,emit:G,render:X,renderCache:q,props:ee,data:ne,setupState:me,ctx:he,inheritAttrs:ye}=n,Le=Ug(n);let je,vt;try{if(p.shapeFlag&4){const ut=I||v,ht=ut;je=Fa(X.call(ht,ut,q,ee,me,ne,he)),vt=i}else{const ut=c;je=Fa(ut.length>1?ut(ee,{attrs:i,slots:D,emit:G}):ut(ee,null)),vt=c.props?i:vz(i)}}catch(ut){qp.length=0,hy(ut,n,1),je=dt(ks)}let Dt=je;if(vt&&ye!==!1){const ut=Object.keys(vt),{shapeFlag:ht}=Dt;ut.length&&ht&7&&(R&&ut.some(Kx)&&(vt=xz(vt,R)),Dt=gc(Dt,vt,!1,!0))}return p.dirs&&(Dt=gc(Dt,null,!1,!0),Dt.dirs=Dt.dirs?Dt.dirs.concat(p.dirs):p.dirs),p.transition&&Ru(Dt,p.transition),je=Dt,Ug(Le),je}const vz=n=>{let c;for(const p in n)(p==="class"||p==="style"||iy(p))&&((c||(c={}))[p]=n[p]);return c},xz=(n,c)=>{const p={};for(const v in n)(!Kx(v)||!(v.slice(9)in c))&&(p[v]=n[v]);return p};function bz(n,c,p){const{props:v,children:I,component:R}=n,{props:D,children:i,patchFlag:G}=c,X=R.emitsOptions;if(c.dirs||c.transition)return!0;if(p&&G>=0){if(G&1024)return!0;if(G&16)return v?ZT(v,D,X):!!D;if(G&8){const q=c.dynamicProps;for(let ee=0;ee<q.length;ee++){const ne=q[ee];if(D[ne]!==v[ne]&&!py(X,ne))return!0}}}else return(I||i)&&(!i||!i.$stable)?!0:v===D?!1:v?D?ZT(v,D,X):!0:!!D;return!1}function ZT(n,c,p){const v=Object.keys(c);if(v.length!==Object.keys(n).length)return!0;for(let I=0;I<v.length;I++){const R=v[I];if(c[R]!==n[R]&&!py(p,R))return!0}return!1}function wz({vnode:n,parent:c},p){for(;c;){const v=c.subTree;if(v.suspense&&v.suspense.activeBranch===n&&(v.el=n.el),v===n)(n=c.vnode).el=p,c=c.parent;else break}}const _M=n=>n.__isSuspense;function Tz(n,c){c&&c.pendingBranch?Qr(n)?c.effects.push(...n):c.effects.push(n):FD(n)}const ti=Symbol.for("v-fgt"),Md=Symbol.for("v-txt"),ks=Symbol.for("v-cmt"),Z0=Symbol.for("v-stc"),qp=[];let fo=null;function vr(n=!1){qp.push(fo=n?null:[])}function Sz(){qp.pop(),fo=qp[qp.length-1]||null}let tm=1;function XT(n,c=!1){tm+=n,n<0&&fo&&c&&(fo.hasOnce=!0)}function gM(n){return n.dynamicChildren=tm>0?fo||md:null,Sz(),tm>0&&fo&&fo.push(n),n}function vn(n,c,p,v,I,R){return gM(wn(n,c,p,v,I,R,!0))}function Dn(n,c,p,v,I){return gM(dt(n,c,p,v,I,!0))}function rm(n){return n?n.__v_isVNode===!0:!1}function bu(n,c){return n.type===c.type&&n.key===c.key}const yM=({key:n})=>n??null,Cg=({ref:n,ref_key:c,ref_for:p})=>(typeof n=="number"&&(n=""+n),n!=null?jn(n)||Qn(n)||en(n)?{i:$i,r:n,k:c,f:!!p}:n:null);function wn(n,c=null,p=null,v=0,I=null,R=n===ti?0:1,D=!1,i=!1){const G={__v_isVNode:!0,__v_skip:!0,type:n,props:c,key:c&&yM(c),ref:c&&Cg(c),scopeId:OA,slotScopeIds:null,children:p,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:R,patchFlag:v,dynamicProps:I,dynamicChildren:null,appContext:null,ctx:$i};return i?(v1(G,p),R&128&&n.normalize(G)):p&&(G.shapeFlag|=jn(p)?8:16),tm>0&&!D&&fo&&(G.patchFlag>0||R&6)&&G.patchFlag!==32&&fo.push(G),G}const dt=Ez;function Ez(n,c=null,p=null,v=0,I=null,R=!1){if((!n||n===YA)&&(n=ks),rm(n)){const i=gc(n,c,!0);return p&&v1(i,p),tm>0&&!R&&fo&&(i.shapeFlag&6?fo[fo.indexOf(n)]=i:fo.push(i)),i.patchFlag=-2,i}if(Lz(n)&&(n=n.__vccOpts),c){c=Az(c);let{class:i,style:G}=c;i&&!jn(i)&&(c.class=Rn(i)),Xn(G)&&(a1(G)&&!Qr(G)&&(G=Gi({},G)),c.style=Cu(G))}const D=jn(n)?1:_M(n)?128:FA(n)?64:Xn(n)?4:en(n)?2:0;return wn(n,c,p,v,I,D,R,!0)}function Az(n){return n?a1(n)||oM(n)?Gi({},n):n:null}function gc(n,c,p=!1,v=!1){const{props:I,ref:R,patchFlag:D,children:i,transition:G}=n,X=c?Ks(I||{},c):I,q={__v_isVNode:!0,__v_skip:!0,type:n.type,props:X,key:X&&yM(X),ref:c&&c.ref?p&&R?Qr(R)?R.concat(Cg(c)):[R,Cg(c)]:Cg(c):R,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:i,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:c&&n.type!==ti?D===-1?16:D|16:D,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:G,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&gc(n.ssContent),ssFallback:n.ssFallback&&gc(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return G&&v&&Ru(q,G.clone(q)),q}function Np(n=" ",c=0){return dt(Md,null,n,c)}function qn(n="",c=!1){return c?(vr(),Dn(ks,null,n)):dt(ks,null,n)}function Fa(n){return n==null||typeof n=="boolean"?dt(ks):Qr(n)?dt(ti,null,n.slice()):rm(n)?hc(n):dt(Md,null,String(n))}function hc(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:gc(n)}function v1(n,c){let p=0;const{shapeFlag:v}=n;if(c==null)c=null;else if(Qr(c))p=16;else if(typeof c=="object")if(v&65){const I=c.default;I&&(I._c&&(I._d=!1),v1(n,I()),I._c&&(I._d=!0));return}else{p=32;const I=c._;!I&&!oM(c)?c._ctx=$i:I===3&&$i&&($i.slots._===1?c._=1:(c._=2,n.patchFlag|=1024))}else en(c)?(c={default:c,_ctx:$i},p=32):(c=String(c),v&64?(p=16,c=[Np(c)]):p=8);n.children=c,n.shapeFlag|=p}function Ks(...n){const c={};for(let p=0;p<n.length;p++){const v=n[p];for(const I in v)if(I==="class")c.class!==v.class&&(c.class=Rn([c.class,v.class]));else if(I==="style")c.style=Cu([c.style,v.style]);else if(iy(I)){const R=c[I],D=v[I];D&&R!==D&&!(Qr(R)&&R.includes(D))&&(c[I]=R?[].concat(R,D):D)}else I!==""&&(c[I]=v[I])}return c}function za(n,c,p,v=null){la(n,c,7,[p,v])}const Mz=nM();let Iz=0;function Cz(n,c,p){const v=n.type,I=(c?c.appContext:n.appContext)||Mz,R={uid:Iz++,vnode:n,type:v,parent:c,appContext:I,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new dA(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:c?c.provides:Object.create(I.provides),ids:c?c.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:lM(v,I),emitsOptions:mM(v,I),emit:null,emitted:null,propsDefaults:ni,inheritAttrs:v.inheritAttrs,ctx:ni,data:ni,props:ni,attrs:ni,slots:ni,refs:ni,setupState:ni,setupContext:null,suspense:p,suspenseId:p?p.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return R.ctx={_:R},R.root=c?c.root:R,R.emit=yz.bind(null,R),n.ce&&n.ce(R),R}let Xi=null;const ha=()=>Xi||$i;let Gg,Tx;{const n=ay(),c=(p,v)=>{let I;return(I=n[p])||(I=n[p]=[]),I.push(v),R=>{I.length>1?I.forEach(D=>D(R)):I[0](R)}};Gg=c("__VUE_INSTANCE_SETTERS__",p=>Xi=p),Tx=c("__VUE_SSR_SETTERS__",p=>nm=p)}const gm=n=>{const c=Xi;return Gg(n),n.scope.on(),()=>{n.scope.off(),Gg(c)}},KT=()=>{Xi&&Xi.scope.off(),Gg(null)};function vM(n){return n.vnode.shapeFlag&4}let nm=!1;function Pz(n,c=!1,p=!1){c&&Tx(c);const{props:v,children:I}=n.vnode,R=vM(n);iz(n,v,R,c),lz(n,I,p);const D=R?Rz(n,c):void 0;return c&&Tx(!1),D}function Rz(n,c){const p=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,ZD);const{setup:v}=p;if(v){bc();const I=n.setupContext=v.length>1?bM(n):null,R=gm(n),D=_m(v,n,0,[n.props,I]),i=Fg(D);if(wc(),R(),(i||n.sp)&&!yd(n)&&qA(n),i){if(D.then(KT,KT),c)return D.then(G=>{YT(n,G)}).catch(G=>{hy(G,n,0)});n.asyncDep=D}else YT(n,D)}else xM(n)}function YT(n,c,p){en(c)?n.type.__ssrInlineRender?n.ssrRender=c:n.render=c:Xn(c)&&(n.setupState=CA(c)),xM(n)}function xM(n,c,p){const v=n.type;n.render||(n.render=v.render||mo);{const I=gm(n);bc();try{KD(n)}finally{wc(),I()}}}const Dz={get(n,c){return hs(n,"get",""),n[c]}};function bM(n){const c=p=>{n.exposed=p||{}};return{attrs:new Proxy(n.attrs,Dz),slots:n.slots,emit:n.emit,expose:c}}function my(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(CA(l1(n.exposed)),{get(c,p){if(p in c)return c[p];if(p in Gp)return Gp[p](n)},has(c,p){return p in c||p in Gp}})):n.proxy}function zz(n,c=!0){return en(n)?n.displayName||n.name:n.name||c&&n.__name}function Lz(n){return en(n)&&"__vccOpts"in n}const ct=(n,c)=>DD(n,c,nm);function yl(n,c,p){const v=arguments.length;return v===2?Xn(c)&&!Qr(c)?rm(c)?dt(n,null,[c]):dt(n,c):dt(n,null,c):(v>3?p=Array.prototype.slice.call(arguments,2):v===3&&rm(p)&&(p=[p]),dt(n,c,p))}const Oz="3.5.13",kz=mo;/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Sx;const JT=typeof window<"u"&&window.trustedTypes;if(JT)try{Sx=JT.createPolicy("vue",{createHTML:n=>n})}catch{}const wM=Sx?n=>Sx.createHTML(n):n=>n,Fz="http://www.w3.org/2000/svg",Bz="http://www.w3.org/1998/Math/MathML",dl=typeof document<"u"?document:null,QT=dl&&dl.createElement("template"),Nz={insert:(n,c,p)=>{c.insertBefore(n,p||null)},remove:n=>{const c=n.parentNode;c&&c.removeChild(n)},createElement:(n,c,p,v)=>{const I=c==="svg"?dl.createElementNS(Fz,n):c==="mathml"?dl.createElementNS(Bz,n):p?dl.createElement(n,{is:p}):dl.createElement(n);return n==="select"&&v&&v.multiple!=null&&I.setAttribute("multiple",v.multiple),I},createText:n=>dl.createTextNode(n),createComment:n=>dl.createComment(n),setText:(n,c)=>{n.nodeValue=c},setElementText:(n,c)=>{n.textContent=c},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>dl.querySelector(n),setScopeId(n,c){n.setAttribute(c,"")},insertStaticContent(n,c,p,v,I,R){const D=p?p.previousSibling:c.lastChild;if(I&&(I===R||I.nextSibling))for(;c.insertBefore(I.cloneNode(!0),p),!(I===R||!(I=I.nextSibling)););else{QT.innerHTML=wM(v==="svg"?`<svg>${n}</svg>`:v==="mathml"?`<math>${n}</math>`:n);const i=QT.content;if(v==="svg"||v==="mathml"){const G=i.firstChild;for(;G.firstChild;)i.appendChild(G.firstChild);i.removeChild(G)}c.insertBefore(i,p)}return[D?D.nextSibling:c.firstChild,p?p.previousSibling:c.lastChild]}},ic="transition",zp="animation",bd=Symbol("_vtc"),TM={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},SM=Gi({},UA,TM),Vz=n=>(n.displayName="Transition",n.props=SM,n),ym=Vz((n,{slots:c})=>yl(VD,EM(n),c)),_u=(n,c=[])=>{Qr(n)?n.forEach(p=>p(...c)):n&&n(...c)},eS=n=>n?Qr(n)?n.some(c=>c.length>1):n.length>1:!1;function EM(n){const c={};for(const yt in n)yt in TM||(c[yt]=n[yt]);if(n.css===!1)return c;const{name:p="v",type:v,duration:I,enterFromClass:R=`${p}-enter-from`,enterActiveClass:D=`${p}-enter-active`,enterToClass:i=`${p}-enter-to`,appearFromClass:G=R,appearActiveClass:X=D,appearToClass:q=i,leaveFromClass:ee=`${p}-leave-from`,leaveActiveClass:ne=`${p}-leave-active`,leaveToClass:me=`${p}-leave-to`}=n,he=Uz(I),ye=he&&he[0],Le=he&&he[1],{onBeforeEnter:je,onEnter:vt,onEnterCancelled:Dt,onLeave:ut,onLeaveCancelled:ht,onBeforeAppear:St=je,onAppear:tt=vt,onAppearCancelled:Et=Dt}=c,pt=(yt,ir,zr,Zt)=>{yt._enterCancelled=Zt,ac(yt,ir?q:i),ac(yt,ir?X:D),zr&&zr()},ot=(yt,ir)=>{yt._isLeaving=!1,ac(yt,ee),ac(yt,me),ac(yt,ne),ir&&ir()},gt=yt=>(ir,zr)=>{const Zt=yt?tt:vt,Ir=()=>pt(ir,yt,zr);_u(Zt,[ir,Ir]),tS(()=>{ac(ir,yt?G:R),Oa(ir,yt?q:i),eS(Zt)||rS(ir,v,ye,Ir)})};return Gi(c,{onBeforeEnter(yt){_u(je,[yt]),Oa(yt,R),Oa(yt,D)},onBeforeAppear(yt){_u(St,[yt]),Oa(yt,G),Oa(yt,X)},onEnter:gt(!1),onAppear:gt(!0),onLeave(yt,ir){yt._isLeaving=!0;const zr=()=>ot(yt,ir);Oa(yt,ee),yt._enterCancelled?(Oa(yt,ne),Ex()):(Ex(),Oa(yt,ne)),tS(()=>{yt._isLeaving&&(ac(yt,ee),Oa(yt,me),eS(ut)||rS(yt,v,Le,zr))}),_u(ut,[yt,zr])},onEnterCancelled(yt){pt(yt,!1,void 0,!0),_u(Dt,[yt])},onAppearCancelled(yt){pt(yt,!0,void 0,!0),_u(Et,[yt])},onLeaveCancelled(yt){ot(yt),_u(ht,[yt])}})}function Uz(n){if(n==null)return null;if(Xn(n))return[X0(n.enter),X0(n.leave)];{const c=X0(n);return[c,c]}}function X0(n){return tD(n)}function Oa(n,c){c.split(/\s+/).forEach(p=>p&&n.classList.add(p)),(n[bd]||(n[bd]=new Set)).add(c)}function ac(n,c){c.split(/\s+/).forEach(v=>v&&n.classList.remove(v));const p=n[bd];p&&(p.delete(c),p.size||(n[bd]=void 0))}function tS(n){requestAnimationFrame(()=>{requestAnimationFrame(n)})}let jz=0;function rS(n,c,p,v){const I=n._endId=++jz,R=()=>{I===n._endId&&v()};if(p!=null)return setTimeout(R,p);const{type:D,timeout:i,propCount:G}=AM(n,c);if(!D)return v();const X=D+"end";let q=0;const ee=()=>{n.removeEventListener(X,ne),R()},ne=me=>{me.target===n&&++q>=G&&ee()};setTimeout(()=>{q<G&&ee()},i+1),n.addEventListener(X,ne)}function AM(n,c){const p=window.getComputedStyle(n),v=he=>(p[he]||"").split(", "),I=v(`${ic}Delay`),R=v(`${ic}Duration`),D=nS(I,R),i=v(`${zp}Delay`),G=v(`${zp}Duration`),X=nS(i,G);let q=null,ee=0,ne=0;c===ic?D>0&&(q=ic,ee=D,ne=R.length):c===zp?X>0&&(q=zp,ee=X,ne=G.length):(ee=Math.max(D,X),q=ee>0?D>X?ic:zp:null,ne=q?q===ic?R.length:G.length:0);const me=q===ic&&/\b(transform|all)(,|$)/.test(v(`${ic}Property`).toString());return{type:q,timeout:ee,propCount:ne,hasTransform:me}}function nS(n,c){for(;n.length<c.length;)n=n.concat(n);return Math.max(...c.map((p,v)=>iS(p)+iS(n[v])))}function iS(n){return n==="auto"?0:Number(n.slice(0,-1).replace(",","."))*1e3}function Ex(){return document.body.offsetHeight}function $z(n,c,p){const v=n[bd];v&&(c=(c?[c,...v]:[...v]).join(" ")),c==null?n.removeAttribute("class"):p?n.setAttribute("class",c):n.className=c}const qg=Symbol("_vod"),MM=Symbol("_vsh"),IM={beforeMount(n,{value:c},{transition:p}){n[qg]=n.style.display==="none"?"":n.style.display,p&&c?p.beforeEnter(n):Lp(n,c)},mounted(n,{value:c},{transition:p}){p&&c&&p.enter(n)},updated(n,{value:c,oldValue:p},{transition:v}){!c!=!p&&(v?c?(v.beforeEnter(n),Lp(n,!0),v.enter(n)):v.leave(n,()=>{Lp(n,!1)}):Lp(n,c))},beforeUnmount(n,{value:c}){Lp(n,c)}};function Lp(n,c){n.style.display=c?n[qg]:"none",n[MM]=!c}const Gz=Symbol(""),qz=/(^|;)\s*display\s*:/;function Hz(n,c,p){const v=n.style,I=jn(p);let R=!1;if(p&&!I){if(c)if(jn(c))for(const D of c.split(";")){const i=D.slice(0,D.indexOf(":")).trim();p[i]==null&&Pg(v,i,"")}else for(const D in c)p[D]==null&&Pg(v,D,"");for(const D in p)D==="display"&&(R=!0),Pg(v,D,p[D])}else if(I){if(c!==p){const D=v[Gz];D&&(p+=";"+D),v.cssText=p,R=qz.test(p)}}else c&&n.removeAttribute("style");qg in n&&(n[qg]=R?v.display:"",n[MM]&&(v.display="none"))}const sS=/\s*!important$/;function Pg(n,c,p){if(Qr(p))p.forEach(v=>Pg(n,c,v));else if(p==null&&(p=""),c.startsWith("--"))n.setProperty(c,p);else{const v=Wz(n,c);sS.test(p)?n.setProperty(vc(v),p.replace(sS,""),"important"):n[v]=p}}const oS=["Webkit","Moz","ms"],K0={};function Wz(n,c){const p=K0[c];if(p)return p;let v=Fs(c);if(v!=="filter"&&v in n)return K0[c]=v;v=xc(v);for(let I=0;I<oS.length;I++){const R=oS[I]+v;if(R in n)return K0[c]=R}return c}const aS="http://www.w3.org/1999/xlink";function lS(n,c,p,v,I,R=aD(c)){v&&c.startsWith("xlink:")?p==null?n.removeAttributeNS(aS,c.slice(6,c.length)):n.setAttributeNS(aS,c,p):p==null||R&&!cA(p)?n.removeAttribute(c):n.setAttribute(c,R?"":_l(p)?String(p):p)}function cS(n,c,p,v,I){if(c==="innerHTML"||c==="textContent"){p!=null&&(n[c]=c==="innerHTML"?wM(p):p);return}const R=n.tagName;if(c==="value"&&R!=="PROGRESS"&&!R.includes("-")){const i=R==="OPTION"?n.getAttribute("value")||"":n.value,G=p==null?n.type==="checkbox"?"on":"":String(p);(i!==G||!("_value"in n))&&(n.value=G),p==null&&n.removeAttribute(c),n._value=p;return}let D=!1;if(p===""||p==null){const i=typeof n[c];i==="boolean"?p=cA(p):p==null&&i==="string"?(p="",D=!0):i==="number"&&(p=0,D=!0)}try{n[c]=p}catch{}D&&n.removeAttribute(I||c)}function Zz(n,c,p,v){n.addEventListener(c,p,v)}function Xz(n,c,p,v){n.removeEventListener(c,p,v)}const uS=Symbol("_vei");function Kz(n,c,p,v,I=null){const R=n[uS]||(n[uS]={}),D=R[c];if(v&&D)D.value=v;else{const[i,G]=Yz(c);if(v){const X=R[c]=eL(v,I);Zz(n,i,X,G)}else D&&(Xz(n,i,D,G),R[c]=void 0)}}const hS=/(?:Once|Passive|Capture)$/;function Yz(n){let c;if(hS.test(n)){c={};let v;for(;v=n.match(hS);)n=n.slice(0,n.length-v[0].length),c[v[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):vc(n.slice(2)),c]}let Y0=0;const Jz=Promise.resolve(),Qz=()=>Y0||(Jz.then(()=>Y0=0),Y0=Date.now());function eL(n,c){const p=v=>{if(!v._vts)v._vts=Date.now();else if(v._vts<=p.attached)return;la(tL(v,p.value),c,5,[v])};return p.value=n,p.attached=Qz(),p}function tL(n,c){if(Qr(c)){const p=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{p.call(n),n._stopped=!0},c.map(v=>I=>!I._stopped&&v&&v(I))}else return c}const dS=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,rL=(n,c,p,v,I,R)=>{const D=I==="svg";c==="class"?$z(n,v,D):c==="style"?Hz(n,p,v):iy(c)?Kx(c)||Kz(n,c,p,v,R):(c[0]==="."?(c=c.slice(1),!0):c[0]==="^"?(c=c.slice(1),!1):nL(n,c,v,D))?(cS(n,c,v),!n.tagName.includes("-")&&(c==="value"||c==="checked"||c==="selected")&&lS(n,c,v,D,R,c!=="value")):n._isVueCE&&(/[A-Z]/.test(c)||!jn(v))?cS(n,Fs(c),v,R,c):(c==="true-value"?n._trueValue=v:c==="false-value"&&(n._falseValue=v),lS(n,c,v,D))};function nL(n,c,p,v){if(v)return!!(c==="innerHTML"||c==="textContent"||c in n&&dS(c)&&en(p));if(c==="spellcheck"||c==="draggable"||c==="translate"||c==="form"||c==="list"&&n.tagName==="INPUT"||c==="type"&&n.tagName==="TEXTAREA")return!1;if(c==="width"||c==="height"){const I=n.tagName;if(I==="IMG"||I==="VIDEO"||I==="CANVAS"||I==="SOURCE")return!1}return dS(c)&&jn(p)?!1:c in n}const CM=new WeakMap,PM=new WeakMap,Hg=Symbol("_moveCb"),fS=Symbol("_enterCb"),iL=n=>(delete n.props.mode,n),sL=iL({name:"TransitionGroup",props:Gi({},SM,{tag:String,moveClass:String}),setup(n,{slots:c}){const p=ha(),v=VA();let I,R;return h1(()=>{if(!I.length)return;const D=n.moveClass||`${n.name||"v"}-move`;if(!cL(I[0].el,p.vnode.el,D))return;I.forEach(oL),I.forEach(aL);const i=I.filter(lL);Ex(),i.forEach(G=>{const X=G.el,q=X.style;Oa(X,D),q.transform=q.webkitTransform=q.transitionDuration="";const ee=X[Hg]=ne=>{ne&&ne.target!==X||(!ne||/transform$/.test(ne.propertyName))&&(X.removeEventListener("transitionend",ee),X[Hg]=null,ac(X,D))};X.addEventListener("transitionend",ee)})}),()=>{const D=Mn(n),i=EM(D);let G=D.tag||ti;if(I=[],R)for(let X=0;X<R.length;X++){const q=R[X];q.el&&q.el instanceof Element&&(I.push(q),Ru(q,em(q,i,v,p)),CM.set(q,q.el.getBoundingClientRect()))}R=c.default?u1(c.default()):[];for(let X=0;X<R.length;X++){const q=R[X];q.key!=null&&Ru(q,em(q,i,v,p))}return dt(G,null,R)}}}),x1=sL;function oL(n){const c=n.el;c[Hg]&&c[Hg](),c[fS]&&c[fS]()}function aL(n){PM.set(n,n.el.getBoundingClientRect())}function lL(n){const c=CM.get(n),p=PM.get(n),v=c.left-p.left,I=c.top-p.top;if(v||I){const R=n.el.style;return R.transform=R.webkitTransform=`translate(${v}px,${I}px)`,R.transitionDuration="0s",n}}function cL(n,c,p){const v=n.cloneNode(),I=n[bd];I&&I.forEach(i=>{i.split(/\s+/).forEach(G=>G&&v.classList.remove(G))}),p.split(/\s+/).forEach(i=>i&&v.classList.add(i)),v.style.display="none";const R=c.nodeType===1?c:c.parentNode;R.appendChild(v);const{hasTransform:D}=AM(v);return R.removeChild(v),D}const uL=["ctrl","shift","alt","meta"],hL={stop:n=>n.stopPropagation(),prevent:n=>n.preventDefault(),self:n=>n.target!==n.currentTarget,ctrl:n=>!n.ctrlKey,shift:n=>!n.shiftKey,alt:n=>!n.altKey,meta:n=>!n.metaKey,left:n=>"button"in n&&n.button!==0,middle:n=>"button"in n&&n.button!==1,right:n=>"button"in n&&n.button!==2,exact:(n,c)=>uL.some(p=>n[`${p}Key`]&&!c.includes(p))},RM=(n,c)=>{const p=n._withMods||(n._withMods={}),v=c.join(".");return p[v]||(p[v]=(I,...R)=>{for(let D=0;D<c.length;D++){const i=hL[c[D]];if(i&&i(I,c))return}return n(I,...R)})},dL={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},fL=(n,c)=>{const p=n._withKeys||(n._withKeys={}),v=c.join(".");return p[v]||(p[v]=I=>{if(!("key"in I))return;const R=vc(I.key);if(c.some(D=>D===R||dL[D]===R))return n(I)})},pL=Gi({patchProp:rL},Nz);let pS;function mL(){return pS||(pS=uz(pL))}const _L=(...n)=>{const c=mL().createApp(...n),{mount:p}=c;return c.mount=v=>{const I=yL(v);if(!I)return;const R=c._component;!en(R)&&!R.render&&!R.template&&(R.template=I.innerHTML),I.nodeType===1&&(I.textContent="");const D=p(I,!1,gL(I));return I instanceof Element&&(I.removeAttribute("v-cloak"),I.setAttribute("data-v-app","")),D},c};function gL(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function yL(n){return jn(n)?document.querySelector(n):n}/*!
 * pinia v3.0.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let DM;const _y=n=>DM=n,zM=Symbol();function Ax(n){return n&&typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"&&typeof n.toJSON!="function"}var Hp;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(Hp||(Hp={}));function vL(){const n=Qx(!0),c=n.run(()=>In({}));let p=[],v=[];const I=l1({install(R){_y(I),I._a=R,R.provide(zM,I),R.config.globalProperties.$pinia=I,v.forEach(D=>p.push(D)),v=[]},use(R){return this._a?p.push(R):v.push(R),this},_p:p,_a:null,_e:n,_s:new Map,state:c});return I}const LM=()=>{};function mS(n,c,p,v=LM){n.push(c);const I=()=>{const R=n.indexOf(c);R>-1&&(n.splice(R,1),v())};return!p&&e1()&&ly(I),I}function ad(n,...c){n.slice().forEach(p=>{p(...c)})}const xL=n=>n(),_S=Symbol(),J0=Symbol();function Mx(n,c){n instanceof Map&&c instanceof Map?c.forEach((p,v)=>n.set(v,p)):n instanceof Set&&c instanceof Set&&c.forEach(n.add,n);for(const p in c){if(!c.hasOwnProperty(p))continue;const v=c[p],I=n[p];Ax(I)&&Ax(v)&&n.hasOwnProperty(p)&&!Qn(v)&&!_c(v)?n[p]=Mx(I,v):n[p]=v}return n}const bL=Symbol();function wL(n){return!Ax(n)||!n.hasOwnProperty(bL)}const{assign:lc}=Object;function TL(n){return!!(Qn(n)&&n.effect)}function SL(n,c,p,v){const{state:I,actions:R,getters:D}=c,i=p.state.value[n];let G;function X(){i||(p.state.value[n]=I?I():{});const q=uy(p.state.value[n]);return lc(q,R,Object.keys(D||{}).reduce((ee,ne)=>(ee[ne]=l1(ct(()=>{_y(p);const me=p._s.get(n);return D[ne].call(me,me)})),ee),{}))}return G=OM(n,X,c,p,v,!0),G}function OM(n,c,p={},v,I,R){let D;const i=lc({actions:{}},p),G={deep:!0};let X,q,ee=[],ne=[],me;const he=v.state.value[n];!R&&!he&&(v.state.value[n]={}),In({});let ye;function Le(Et){let pt;X=q=!1,typeof Et=="function"?(Et(v.state.value[n]),pt={type:Hp.patchFunction,storeId:n,events:me}):(Mx(v.state.value[n],Et),pt={type:Hp.patchObject,payload:Et,storeId:n,events:me});const ot=ye=Symbol();Ws().then(()=>{ye===ot&&(X=!0)}),q=!0,ad(ee,pt,v.state.value[n])}const je=R?function(){const{state:pt}=p,ot=pt?pt():{};this.$patch(gt=>{lc(gt,ot)})}:LM;function vt(){D.stop(),ee=[],ne=[],v._s.delete(n)}const Dt=(Et,pt="")=>{if(_S in Et)return Et[J0]=pt,Et;const ot=function(){_y(v);const gt=Array.from(arguments),yt=[],ir=[];function zr(yr){yt.push(yr)}function Zt(yr){ir.push(yr)}ad(ne,{args:gt,name:ot[J0],store:ht,after:zr,onError:Zt});let Ir;try{Ir=Et.apply(this&&this.$id===n?this:ht,gt)}catch(yr){throw ad(ir,yr),yr}return Ir instanceof Promise?Ir.then(yr=>(ad(yt,yr),yr)).catch(yr=>(ad(ir,yr),Promise.reject(yr))):(ad(yt,Ir),Ir)};return ot[_S]=!0,ot[J0]=pt,ot},ut={_p:v,$id:n,$onAction:mS.bind(null,ne),$patch:Le,$reset:je,$subscribe(Et,pt={}){const ot=mS(ee,Et,pt.detached,()=>gt()),gt=D.run(()=>zn(()=>v.state.value[n],yt=>{(pt.flush==="sync"?q:X)&&Et({storeId:n,type:Hp.direct,events:me},yt)},lc({},G,pt)));return ot},$dispose:vt},ht=Zi(ut);v._s.set(n,ht);const tt=(v._a&&v._a.runWithContext||xL)(()=>v._e.run(()=>(D=Qx()).run(()=>c({action:Dt}))));for(const Et in tt){const pt=tt[Et];if(Qn(pt)&&!TL(pt)||_c(pt))R||(he&&wL(pt)&&(Qn(pt)?pt.value=he[Et]:Mx(pt,he[Et])),v.state.value[n][Et]=pt);else if(typeof pt=="function"){const ot=Dt(pt,Et);tt[Et]=ot,i.actions[Et]=pt}}return lc(ht,tt),lc(Mn(ht),tt),Object.defineProperty(ht,"$state",{get:()=>v.state.value[n],set:Et=>{Le(pt=>{lc(pt,Et)})}}),v._p.forEach(Et=>{lc(ht,D.run(()=>Et({store:ht,app:v._a,pinia:v,options:i})))}),he&&R&&p.hydrate&&p.hydrate(ht.$state,he),X=!0,q=!0,ht}/*! #__NO_SIDE_EFFECTS__ */function kM(n,c,p){let v;const I=typeof c=="function";v=I?p:c;function R(D,i){const G=nz();return D=D||(G?Hn(zM,null):null),D&&_y(D),D=DM,D._s.has(n)||(I?OM(n,c,v,D):SL(n,v,D)),D._s.get(n)}return R.$id=n,R}const EL={name:"App"},b1=(n,c)=>{const p=n.__vccOpts||n;for(const[v,I]of c)p[v]=I;return p};function AL(n,c,p,v,I,R){const D=KA("RouterView");return vr(),Dn(D)}const ML=b1(EL,[["render",AL]]);/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const fd=typeof document<"u";function FM(n){return typeof n=="object"||"displayName"in n||"props"in n||"__vccOpts"in n}function IL(n){return n.__esModule||n[Symbol.toStringTag]==="Module"||n.default&&FM(n.default)}const Zn=Object.assign;function Q0(n,c){const p={};for(const v in c){const I=c[v];p[v]=ca(I)?I.map(n):n(I)}return p}const Wp=()=>{},ca=Array.isArray,BM=/#/g,CL=/&/g,PL=/\//g,RL=/=/g,DL=/\?/g,NM=/\+/g,zL=/%5B/g,LL=/%5D/g,VM=/%5E/g,OL=/%60/g,UM=/%7B/g,kL=/%7C/g,jM=/%7D/g,FL=/%20/g;function w1(n){return encodeURI(""+n).replace(kL,"|").replace(zL,"[").replace(LL,"]")}function BL(n){return w1(n).replace(UM,"{").replace(jM,"}").replace(VM,"^")}function Ix(n){return w1(n).replace(NM,"%2B").replace(FL,"+").replace(BM,"%23").replace(CL,"%26").replace(OL,"`").replace(UM,"{").replace(jM,"}").replace(VM,"^")}function NL(n){return Ix(n).replace(RL,"%3D")}function VL(n){return w1(n).replace(BM,"%23").replace(DL,"%3F")}function UL(n){return n==null?"":VL(n).replace(PL,"%2F")}function im(n){try{return decodeURIComponent(""+n)}catch{}return""+n}const jL=/\/$/,$L=n=>n.replace(jL,"");function ex(n,c,p="/"){let v,I={},R="",D="";const i=c.indexOf("#");let G=c.indexOf("?");return i<G&&i>=0&&(G=-1),G>-1&&(v=c.slice(0,G),R=c.slice(G+1,i>-1?i:c.length),I=n(R)),i>-1&&(v=v||c.slice(0,i),D=c.slice(i,c.length)),v=WL(v??c,p),{fullPath:v+(R&&"?")+R+D,path:v,query:I,hash:im(D)}}function GL(n,c){const p=c.query?n(c.query):"";return c.path+(p&&"?")+p+(c.hash||"")}function gS(n,c){return!c||!n.toLowerCase().startsWith(c.toLowerCase())?n:n.slice(c.length)||"/"}function qL(n,c,p){const v=c.matched.length-1,I=p.matched.length-1;return v>-1&&v===I&&wd(c.matched[v],p.matched[I])&&$M(c.params,p.params)&&n(c.query)===n(p.query)&&c.hash===p.hash}function wd(n,c){return(n.aliasOf||n)===(c.aliasOf||c)}function $M(n,c){if(Object.keys(n).length!==Object.keys(c).length)return!1;for(const p in n)if(!HL(n[p],c[p]))return!1;return!0}function HL(n,c){return ca(n)?yS(n,c):ca(c)?yS(c,n):n===c}function yS(n,c){return ca(c)?n.length===c.length&&n.every((p,v)=>p===c[v]):n.length===1&&n[0]===c}function WL(n,c){if(n.startsWith("/"))return n;if(!n)return c;const p=c.split("/"),v=n.split("/"),I=v[v.length-1];(I===".."||I===".")&&v.push("");let R=p.length-1,D,i;for(D=0;D<v.length;D++)if(i=v[D],i!==".")if(i==="..")R>1&&R--;else break;return p.slice(0,R).join("/")+"/"+v.slice(D).join("/")}const sc={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var sm;(function(n){n.pop="pop",n.push="push"})(sm||(sm={}));var Zp;(function(n){n.back="back",n.forward="forward",n.unknown=""})(Zp||(Zp={}));function ZL(n){if(!n)if(fd){const c=document.querySelector("base");n=c&&c.getAttribute("href")||"/",n=n.replace(/^\w+:\/\/[^\/]+/,"")}else n="/";return n[0]!=="/"&&n[0]!=="#"&&(n="/"+n),$L(n)}const XL=/^[^#]+#/;function KL(n,c){return n.replace(XL,"#")+c}function YL(n,c){const p=document.documentElement.getBoundingClientRect(),v=n.getBoundingClientRect();return{behavior:c.behavior,left:v.left-p.left-(c.left||0),top:v.top-p.top-(c.top||0)}}const gy=()=>({left:window.scrollX,top:window.scrollY});function JL(n){let c;if("el"in n){const p=n.el,v=typeof p=="string"&&p.startsWith("#"),I=typeof p=="string"?v?document.getElementById(p.slice(1)):document.querySelector(p):p;if(!I)return;c=YL(I,n)}else c=n;"scrollBehavior"in document.documentElement.style?window.scrollTo(c):window.scrollTo(c.left!=null?c.left:window.scrollX,c.top!=null?c.top:window.scrollY)}function vS(n,c){return(history.state?history.state.position-c:-1)+n}const Cx=new Map;function QL(n,c){Cx.set(n,c)}function eO(n){const c=Cx.get(n);return Cx.delete(n),c}let tO=()=>location.protocol+"//"+location.host;function GM(n,c){const{pathname:p,search:v,hash:I}=c,R=n.indexOf("#");if(R>-1){let i=I.includes(n.slice(R))?n.slice(R).length:1,G=I.slice(i);return G[0]!=="/"&&(G="/"+G),gS(G,"")}return gS(p,n)+v+I}function rO(n,c,p,v){let I=[],R=[],D=null;const i=({state:ne})=>{const me=GM(n,location),he=p.value,ye=c.value;let Le=0;if(ne){if(p.value=me,c.value=ne,D&&D===he){D=null;return}Le=ye?ne.position-ye.position:0}else v(me);I.forEach(je=>{je(p.value,he,{delta:Le,type:sm.pop,direction:Le?Le>0?Zp.forward:Zp.back:Zp.unknown})})};function G(){D=p.value}function X(ne){I.push(ne);const me=()=>{const he=I.indexOf(ne);he>-1&&I.splice(he,1)};return R.push(me),me}function q(){const{history:ne}=window;ne.state&&ne.replaceState(Zn({},ne.state,{scroll:gy()}),"")}function ee(){for(const ne of R)ne();R=[],window.removeEventListener("popstate",i),window.removeEventListener("beforeunload",q)}return window.addEventListener("popstate",i),window.addEventListener("beforeunload",q,{passive:!0}),{pauseListeners:G,listen:X,destroy:ee}}function xS(n,c,p,v=!1,I=!1){return{back:n,current:c,forward:p,replaced:v,position:window.history.length,scroll:I?gy():null}}function nO(n){const{history:c,location:p}=window,v={value:GM(n,p)},I={value:c.state};I.value||R(v.value,{back:null,current:v.value,forward:null,position:c.length-1,replaced:!0,scroll:null},!0);function R(G,X,q){const ee=n.indexOf("#"),ne=ee>-1?(p.host&&document.querySelector("base")?n:n.slice(ee))+G:tO()+n+G;try{c[q?"replaceState":"pushState"](X,"",ne),I.value=X}catch(me){console.error(me),p[q?"replace":"assign"](ne)}}function D(G,X){const q=Zn({},c.state,xS(I.value.back,G,I.value.forward,!0),X,{position:I.value.position});R(G,q,!0),v.value=G}function i(G,X){const q=Zn({},I.value,c.state,{forward:G,scroll:gy()});R(q.current,q,!0);const ee=Zn({},xS(v.value,G,null),{position:q.position+1},X);R(G,ee,!1),v.value=G}return{location:v,state:I,push:i,replace:D}}function iO(n){n=ZL(n);const c=nO(n),p=rO(n,c.state,c.location,c.replace);function v(R,D=!0){D||p.pauseListeners(),history.go(R)}const I=Zn({location:"",base:n,go:v,createHref:KL.bind(null,n)},c,p);return Object.defineProperty(I,"location",{enumerable:!0,get:()=>c.location.value}),Object.defineProperty(I,"state",{enumerable:!0,get:()=>c.state.value}),I}function sO(n){return typeof n=="string"||n&&typeof n=="object"}function qM(n){return typeof n=="string"||typeof n=="symbol"}const HM=Symbol("");var bS;(function(n){n[n.aborted=4]="aborted",n[n.cancelled=8]="cancelled",n[n.duplicated=16]="duplicated"})(bS||(bS={}));function Td(n,c){return Zn(new Error,{type:n,[HM]:!0},c)}function ul(n,c){return n instanceof Error&&HM in n&&(c==null||!!(n.type&c))}const wS="[^/]+?",oO={sensitive:!1,strict:!1,start:!0,end:!0},aO=/[.+*?^${}()[\]/\\]/g;function lO(n,c){const p=Zn({},oO,c),v=[];let I=p.start?"^":"";const R=[];for(const X of n){const q=X.length?[]:[90];p.strict&&!X.length&&(I+="/");for(let ee=0;ee<X.length;ee++){const ne=X[ee];let me=40+(p.sensitive?.25:0);if(ne.type===0)ee||(I+="/"),I+=ne.value.replace(aO,"\\$&"),me+=40;else if(ne.type===1){const{value:he,repeatable:ye,optional:Le,regexp:je}=ne;R.push({name:he,repeatable:ye,optional:Le});const vt=je||wS;if(vt!==wS){me+=10;try{new RegExp(`(${vt})`)}catch(ut){throw new Error(`Invalid custom RegExp for param "${he}" (${vt}): `+ut.message)}}let Dt=ye?`((?:${vt})(?:/(?:${vt}))*)`:`(${vt})`;ee||(Dt=Le&&X.length<2?`(?:/${Dt})`:"/"+Dt),Le&&(Dt+="?"),I+=Dt,me+=20,Le&&(me+=-8),ye&&(me+=-20),vt===".*"&&(me+=-50)}q.push(me)}v.push(q)}if(p.strict&&p.end){const X=v.length-1;v[X][v[X].length-1]+=.7000000000000001}p.strict||(I+="/?"),p.end?I+="$":p.strict&&!I.endsWith("/")&&(I+="(?:/|$)");const D=new RegExp(I,p.sensitive?"":"i");function i(X){const q=X.match(D),ee={};if(!q)return null;for(let ne=1;ne<q.length;ne++){const me=q[ne]||"",he=R[ne-1];ee[he.name]=me&&he.repeatable?me.split("/"):me}return ee}function G(X){let q="",ee=!1;for(const ne of n){(!ee||!q.endsWith("/"))&&(q+="/"),ee=!1;for(const me of ne)if(me.type===0)q+=me.value;else if(me.type===1){const{value:he,repeatable:ye,optional:Le}=me,je=he in X?X[he]:"";if(ca(je)&&!ye)throw new Error(`Provided param "${he}" is an array but it is not repeatable (* or + modifiers)`);const vt=ca(je)?je.join("/"):je;if(!vt)if(Le)ne.length<2&&(q.endsWith("/")?q=q.slice(0,-1):ee=!0);else throw new Error(`Missing required param "${he}"`);q+=vt}}return q||"/"}return{re:D,score:v,keys:R,parse:i,stringify:G}}function cO(n,c){let p=0;for(;p<n.length&&p<c.length;){const v=c[p]-n[p];if(v)return v;p++}return n.length<c.length?n.length===1&&n[0]===80?-1:1:n.length>c.length?c.length===1&&c[0]===80?1:-1:0}function WM(n,c){let p=0;const v=n.score,I=c.score;for(;p<v.length&&p<I.length;){const R=cO(v[p],I[p]);if(R)return R;p++}if(Math.abs(I.length-v.length)===1){if(TS(v))return 1;if(TS(I))return-1}return I.length-v.length}function TS(n){const c=n[n.length-1];return n.length>0&&c[c.length-1]<0}const uO={type:0,value:""},hO=/[a-zA-Z0-9_]/;function dO(n){if(!n)return[[]];if(n==="/")return[[uO]];if(!n.startsWith("/"))throw new Error(`Invalid path "${n}"`);function c(me){throw new Error(`ERR (${p})/"${X}": ${me}`)}let p=0,v=p;const I=[];let R;function D(){R&&I.push(R),R=[]}let i=0,G,X="",q="";function ee(){X&&(p===0?R.push({type:0,value:X}):p===1||p===2||p===3?(R.length>1&&(G==="*"||G==="+")&&c(`A repeatable param (${X}) must be alone in its segment. eg: '/:ids+.`),R.push({type:1,value:X,regexp:q,repeatable:G==="*"||G==="+",optional:G==="*"||G==="?"})):c("Invalid state to consume buffer"),X="")}function ne(){X+=G}for(;i<n.length;){if(G=n[i++],G==="\\"&&p!==2){v=p,p=4;continue}switch(p){case 0:G==="/"?(X&&ee(),D()):G===":"?(ee(),p=1):ne();break;case 4:ne(),p=v;break;case 1:G==="("?p=2:hO.test(G)?ne():(ee(),p=0,G!=="*"&&G!=="?"&&G!=="+"&&i--);break;case 2:G===")"?q[q.length-1]=="\\"?q=q.slice(0,-1)+G:p=3:q+=G;break;case 3:ee(),p=0,G!=="*"&&G!=="?"&&G!=="+"&&i--,q="";break;default:c("Unknown state");break}}return p===2&&c(`Unfinished custom RegExp for param "${X}"`),ee(),D(),I}function fO(n,c,p){const v=lO(dO(n.path),p),I=Zn(v,{record:n,parent:c,children:[],alias:[]});return c&&!I.record.aliasOf==!c.record.aliasOf&&c.children.push(I),I}function pO(n,c){const p=[],v=new Map;c=MS({strict:!1,end:!0,sensitive:!1},c);function I(ee){return v.get(ee)}function R(ee,ne,me){const he=!me,ye=ES(ee);ye.aliasOf=me&&me.record;const Le=MS(c,ee),je=[ye];if("alias"in ee){const ut=typeof ee.alias=="string"?[ee.alias]:ee.alias;for(const ht of ut)je.push(ES(Zn({},ye,{components:me?me.record.components:ye.components,path:ht,aliasOf:me?me.record:ye})))}let vt,Dt;for(const ut of je){const{path:ht}=ut;if(ne&&ht[0]!=="/"){const St=ne.record.path,tt=St[St.length-1]==="/"?"":"/";ut.path=ne.record.path+(ht&&tt+ht)}if(vt=fO(ut,ne,Le),me?me.alias.push(vt):(Dt=Dt||vt,Dt!==vt&&Dt.alias.push(vt),he&&ee.name&&!AS(vt)&&D(ee.name)),ZM(vt)&&G(vt),ye.children){const St=ye.children;for(let tt=0;tt<St.length;tt++)R(St[tt],vt,me&&me.children[tt])}me=me||vt}return Dt?()=>{D(Dt)}:Wp}function D(ee){if(qM(ee)){const ne=v.get(ee);ne&&(v.delete(ee),p.splice(p.indexOf(ne),1),ne.children.forEach(D),ne.alias.forEach(D))}else{const ne=p.indexOf(ee);ne>-1&&(p.splice(ne,1),ee.record.name&&v.delete(ee.record.name),ee.children.forEach(D),ee.alias.forEach(D))}}function i(){return p}function G(ee){const ne=gO(ee,p);p.splice(ne,0,ee),ee.record.name&&!AS(ee)&&v.set(ee.record.name,ee)}function X(ee,ne){let me,he={},ye,Le;if("name"in ee&&ee.name){if(me=v.get(ee.name),!me)throw Td(1,{location:ee});Le=me.record.name,he=Zn(SS(ne.params,me.keys.filter(Dt=>!Dt.optional).concat(me.parent?me.parent.keys.filter(Dt=>Dt.optional):[]).map(Dt=>Dt.name)),ee.params&&SS(ee.params,me.keys.map(Dt=>Dt.name))),ye=me.stringify(he)}else if(ee.path!=null)ye=ee.path,me=p.find(Dt=>Dt.re.test(ye)),me&&(he=me.parse(ye),Le=me.record.name);else{if(me=ne.name?v.get(ne.name):p.find(Dt=>Dt.re.test(ne.path)),!me)throw Td(1,{location:ee,currentLocation:ne});Le=me.record.name,he=Zn({},ne.params,ee.params),ye=me.stringify(he)}const je=[];let vt=me;for(;vt;)je.unshift(vt.record),vt=vt.parent;return{name:Le,path:ye,params:he,matched:je,meta:_O(je)}}n.forEach(ee=>R(ee));function q(){p.length=0,v.clear()}return{addRoute:R,resolve:X,removeRoute:D,clearRoutes:q,getRoutes:i,getRecordMatcher:I}}function SS(n,c){const p={};for(const v of c)v in n&&(p[v]=n[v]);return p}function ES(n){const c={path:n.path,redirect:n.redirect,name:n.name,meta:n.meta||{},aliasOf:n.aliasOf,beforeEnter:n.beforeEnter,props:mO(n),children:n.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in n?n.components||null:n.component&&{default:n.component}};return Object.defineProperty(c,"mods",{value:{}}),c}function mO(n){const c={},p=n.props||!1;if("component"in n)c.default=p;else for(const v in n.components)c[v]=typeof p=="object"?p[v]:p;return c}function AS(n){for(;n;){if(n.record.aliasOf)return!0;n=n.parent}return!1}function _O(n){return n.reduce((c,p)=>Zn(c,p.meta),{})}function MS(n,c){const p={};for(const v in n)p[v]=v in c?c[v]:n[v];return p}function gO(n,c){let p=0,v=c.length;for(;p!==v;){const R=p+v>>1;WM(n,c[R])<0?v=R:p=R+1}const I=yO(n);return I&&(v=c.lastIndexOf(I,v-1)),v}function yO(n){let c=n;for(;c=c.parent;)if(ZM(c)&&WM(n,c)===0)return c}function ZM({record:n}){return!!(n.name||n.components&&Object.keys(n.components).length||n.redirect)}function vO(n){const c={};if(n===""||n==="?")return c;const v=(n[0]==="?"?n.slice(1):n).split("&");for(let I=0;I<v.length;++I){const R=v[I].replace(NM," "),D=R.indexOf("="),i=im(D<0?R:R.slice(0,D)),G=D<0?null:im(R.slice(D+1));if(i in c){let X=c[i];ca(X)||(X=c[i]=[X]),X.push(G)}else c[i]=G}return c}function IS(n){let c="";for(let p in n){const v=n[p];if(p=NL(p),v==null){v!==void 0&&(c+=(c.length?"&":"")+p);continue}(ca(v)?v.map(R=>R&&Ix(R)):[v&&Ix(v)]).forEach(R=>{R!==void 0&&(c+=(c.length?"&":"")+p,R!=null&&(c+="="+R))})}return c}function xO(n){const c={};for(const p in n){const v=n[p];v!==void 0&&(c[p]=ca(v)?v.map(I=>I==null?null:""+I):v==null?v:""+v)}return c}const bO=Symbol(""),CS=Symbol(""),T1=Symbol(""),XM=Symbol(""),Px=Symbol("");function Op(){let n=[];function c(v){return n.push(v),()=>{const I=n.indexOf(v);I>-1&&n.splice(I,1)}}function p(){n=[]}return{add:c,list:()=>n.slice(),reset:p}}function dc(n,c,p,v,I,R=D=>D()){const D=v&&(v.enterCallbacks[I]=v.enterCallbacks[I]||[]);return()=>new Promise((i,G)=>{const X=ne=>{ne===!1?G(Td(4,{from:p,to:c})):ne instanceof Error?G(ne):sO(ne)?G(Td(2,{from:c,to:ne})):(D&&v.enterCallbacks[I]===D&&typeof ne=="function"&&D.push(ne),i())},q=R(()=>n.call(v&&v.instances[I],c,p,X));let ee=Promise.resolve(q);n.length<3&&(ee=ee.then(X)),ee.catch(ne=>G(ne))})}function tx(n,c,p,v,I=R=>R()){const R=[];for(const D of n)for(const i in D.components){let G=D.components[i];if(!(c!=="beforeRouteEnter"&&!D.instances[i]))if(FM(G)){const q=(G.__vccOpts||G)[c];q&&R.push(dc(q,p,v,D,i,I))}else{let X=G();R.push(()=>X.then(q=>{if(!q)throw new Error(`Couldn't resolve component "${i}" at "${D.path}"`);const ee=IL(q)?q.default:q;D.mods[i]=q,D.components[i]=ee;const me=(ee.__vccOpts||ee)[c];return me&&dc(me,p,v,D,i,I)()}))}}return R}function PS(n){const c=Hn(T1),p=Hn(XM),v=ct(()=>{const G=At(n.to);return c.resolve(G)}),I=ct(()=>{const{matched:G}=v.value,{length:X}=G,q=G[X-1],ee=p.matched;if(!q||!ee.length)return-1;const ne=ee.findIndex(wd.bind(null,q));if(ne>-1)return ne;const me=RS(G[X-2]);return X>1&&RS(q)===me&&ee[ee.length-1].path!==me?ee.findIndex(wd.bind(null,G[X-2])):ne}),R=ct(()=>I.value>-1&&AO(p.params,v.value.params)),D=ct(()=>I.value>-1&&I.value===p.matched.length-1&&$M(p.params,v.value.params));function i(G={}){if(EO(G)){const X=c[At(n.replace)?"replace":"push"](At(n.to)).catch(Wp);return n.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>X),X}return Promise.resolve()}return{route:v,href:ct(()=>v.value.href),isActive:R,isExactActive:D,navigate:i}}function wO(n){return n.length===1?n[0]:n}const TO=ei({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:PS,setup(n,{slots:c}){const p=Zi(PS(n)),{options:v}=Hn(T1),I=ct(()=>({[DS(n.activeClass,v.linkActiveClass,"router-link-active")]:p.isActive,[DS(n.exactActiveClass,v.linkExactActiveClass,"router-link-exact-active")]:p.isExactActive}));return()=>{const R=c.default&&wO(c.default(p));return n.custom?R:yl("a",{"aria-current":p.isExactActive?n.ariaCurrentValue:null,href:p.href,onClick:p.navigate,class:I.value},R)}}}),SO=TO;function EO(n){if(!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)&&!n.defaultPrevented&&!(n.button!==void 0&&n.button!==0)){if(n.currentTarget&&n.currentTarget.getAttribute){const c=n.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(c))return}return n.preventDefault&&n.preventDefault(),!0}}function AO(n,c){for(const p in c){const v=c[p],I=n[p];if(typeof v=="string"){if(v!==I)return!1}else if(!ca(I)||I.length!==v.length||v.some((R,D)=>R!==I[D]))return!1}return!0}function RS(n){return n?n.aliasOf?n.aliasOf.path:n.path:""}const DS=(n,c,p)=>n??c??p,MO=ei({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(n,{attrs:c,slots:p}){const v=Hn(Px),I=ct(()=>n.route||v.value),R=Hn(CS,0),D=ct(()=>{let X=At(R);const{matched:q}=I.value;let ee;for(;(ee=q[X])&&!ee.components;)X++;return X}),i=ct(()=>I.value.matched[D.value]);ko(CS,ct(()=>D.value+1)),ko(bO,i),ko(Px,I);const G=In();return zn(()=>[G.value,i.value,n.name],([X,q,ee],[ne,me,he])=>{q&&(q.instances[ee]=X,me&&me!==q&&X&&X===ne&&(q.leaveGuards.size||(q.leaveGuards=me.leaveGuards),q.updateGuards.size||(q.updateGuards=me.updateGuards))),X&&q&&(!me||!wd(q,me)||!ne)&&(q.enterCallbacks[ee]||[]).forEach(ye=>ye(X))},{flush:"post"}),()=>{const X=I.value,q=n.name,ee=i.value,ne=ee&&ee.components[q];if(!ne)return zS(p.default,{Component:ne,route:X});const me=ee.props[q],he=me?me===!0?X.params:typeof me=="function"?me(X):me:null,Le=yl(ne,Zn({},he,c,{onVnodeUnmounted:je=>{je.component.isUnmounted&&(ee.instances[q]=null)},ref:G}));return zS(p.default,{Component:Le,route:X})||Le}}});function zS(n,c){if(!n)return null;const p=n(c);return p.length===1?p[0]:p}const IO=MO;function CO(n){const c=pO(n.routes,n),p=n.parseQuery||vO,v=n.stringifyQuery||IS,I=n.history,R=Op(),D=Op(),i=Op(),G=Fn(sc);let X=sc;fd&&n.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const q=Q0.bind(null,Pt=>""+Pt),ee=Q0.bind(null,UL),ne=Q0.bind(null,im);function me(Pt,er){let Kt,te;return qM(Pt)?(Kt=c.getRecordMatcher(Pt),te=er):te=Pt,c.addRoute(te,Kt)}function he(Pt){const er=c.getRecordMatcher(Pt);er&&c.removeRoute(er)}function ye(){return c.getRoutes().map(Pt=>Pt.record)}function Le(Pt){return!!c.getRecordMatcher(Pt)}function je(Pt,er){if(er=Zn({},er||G.value),typeof Pt=="string"){const Ae=ex(p,Pt,er.path),xt=c.resolve({path:Ae.path},er),Vt=I.createHref(Ae.fullPath);return Zn(Ae,xt,{params:ne(xt.params),hash:im(Ae.hash),redirectedFrom:void 0,href:Vt})}let Kt;if(Pt.path!=null)Kt=Zn({},Pt,{path:ex(p,Pt.path,er.path).path});else{const Ae=Zn({},Pt.params);for(const xt in Ae)Ae[xt]==null&&delete Ae[xt];Kt=Zn({},Pt,{params:ee(Ae)}),er.params=ee(er.params)}const te=c.resolve(Kt,er),mn=Pt.hash||"";te.params=q(ne(te.params));const ke=GL(v,Zn({},Pt,{hash:BL(mn),path:te.path})),Ve=I.createHref(ke);return Zn({fullPath:ke,hash:mn,query:v===IS?xO(Pt.query):Pt.query||{}},te,{redirectedFrom:void 0,href:Ve})}function vt(Pt){return typeof Pt=="string"?ex(p,Pt,G.value.path):Zn({},Pt)}function Dt(Pt,er){if(X!==Pt)return Td(8,{from:er,to:Pt})}function ut(Pt){return tt(Pt)}function ht(Pt){return ut(Zn(vt(Pt),{replace:!0}))}function St(Pt){const er=Pt.matched[Pt.matched.length-1];if(er&&er.redirect){const{redirect:Kt}=er;let te=typeof Kt=="function"?Kt(Pt):Kt;return typeof te=="string"&&(te=te.includes("?")||te.includes("#")?te=vt(te):{path:te},te.params={}),Zn({query:Pt.query,hash:Pt.hash,params:te.path!=null?{}:Pt.params},te)}}function tt(Pt,er){const Kt=X=je(Pt),te=G.value,mn=Pt.state,ke=Pt.force,Ve=Pt.replace===!0,Ae=St(Kt);if(Ae)return tt(Zn(vt(Ae),{state:typeof Ae=="object"?Zn({},mn,Ae.state):mn,force:ke,replace:Ve}),er||Kt);const xt=Kt;xt.redirectedFrom=er;let Vt;return!ke&&qL(v,te,Kt)&&(Vt=Td(16,{to:xt,from:te}),cr(te,te,!0,!1)),(Vt?Promise.resolve(Vt):ot(xt,te)).catch(zt=>ul(zt)?ul(zt,2)?zt:Gr(zt):Nr(zt,xt,te)).then(zt=>{if(zt){if(ul(zt,2))return tt(Zn({replace:Ve},vt(zt.to),{state:typeof zt.to=="object"?Zn({},mn,zt.to.state):mn,force:ke}),er||xt)}else zt=yt(xt,te,!0,Ve,mn);return gt(xt,te,zt),zt})}function Et(Pt,er){const Kt=Dt(Pt,er);return Kt?Promise.reject(Kt):Promise.resolve()}function pt(Pt){const er=vi.values().next().value;return er&&typeof er.runWithContext=="function"?er.runWithContext(Pt):Pt()}function ot(Pt,er){let Kt;const[te,mn,ke]=PO(Pt,er);Kt=tx(te.reverse(),"beforeRouteLeave",Pt,er);for(const Ae of te)Ae.leaveGuards.forEach(xt=>{Kt.push(dc(xt,Pt,er))});const Ve=Et.bind(null,Pt,er);return Kt.push(Ve),pn(Kt).then(()=>{Kt=[];for(const Ae of R.list())Kt.push(dc(Ae,Pt,er));return Kt.push(Ve),pn(Kt)}).then(()=>{Kt=tx(mn,"beforeRouteUpdate",Pt,er);for(const Ae of mn)Ae.updateGuards.forEach(xt=>{Kt.push(dc(xt,Pt,er))});return Kt.push(Ve),pn(Kt)}).then(()=>{Kt=[];for(const Ae of ke)if(Ae.beforeEnter)if(ca(Ae.beforeEnter))for(const xt of Ae.beforeEnter)Kt.push(dc(xt,Pt,er));else Kt.push(dc(Ae.beforeEnter,Pt,er));return Kt.push(Ve),pn(Kt)}).then(()=>(Pt.matched.forEach(Ae=>Ae.enterCallbacks={}),Kt=tx(ke,"beforeRouteEnter",Pt,er,pt),Kt.push(Ve),pn(Kt))).then(()=>{Kt=[];for(const Ae of D.list())Kt.push(dc(Ae,Pt,er));return Kt.push(Ve),pn(Kt)}).catch(Ae=>ul(Ae,8)?Ae:Promise.reject(Ae))}function gt(Pt,er,Kt){i.list().forEach(te=>pt(()=>te(Pt,er,Kt)))}function yt(Pt,er,Kt,te,mn){const ke=Dt(Pt,er);if(ke)return ke;const Ve=er===sc,Ae=fd?history.state:{};Kt&&(te||Ve?I.replace(Pt.fullPath,Zn({scroll:Ve&&Ae&&Ae.scroll},mn)):I.push(Pt.fullPath,mn)),G.value=Pt,cr(Pt,er,Kt,Ve),Gr()}let ir;function zr(){ir||(ir=I.listen((Pt,er,Kt)=>{if(!hi.listening)return;const te=je(Pt),mn=St(te);if(mn){tt(Zn(mn,{replace:!0,force:!0}),te).catch(Wp);return}X=te;const ke=G.value;fd&&QL(vS(ke.fullPath,Kt.delta),gy()),ot(te,ke).catch(Ve=>ul(Ve,12)?Ve:ul(Ve,2)?(tt(Zn(vt(Ve.to),{force:!0}),te).then(Ae=>{ul(Ae,20)&&!Kt.delta&&Kt.type===sm.pop&&I.go(-1,!1)}).catch(Wp),Promise.reject()):(Kt.delta&&I.go(-Kt.delta,!1),Nr(Ve,te,ke))).then(Ve=>{Ve=Ve||yt(te,ke,!1),Ve&&(Kt.delta&&!ul(Ve,8)?I.go(-Kt.delta,!1):Kt.type===sm.pop&&ul(Ve,20)&&I.go(-1,!1)),gt(te,ke,Ve)}).catch(Wp)}))}let Zt=Op(),Ir=Op(),yr;function Nr(Pt,er,Kt){Gr(Pt);const te=Ir.list();return te.length?te.forEach(mn=>mn(Pt,er,Kt)):console.error(Pt),Promise.reject(Pt)}function ar(){return yr&&G.value!==sc?Promise.resolve():new Promise((Pt,er)=>{Zt.add([Pt,er])})}function Gr(Pt){return yr||(yr=!Pt,zr(),Zt.list().forEach(([er,Kt])=>Pt?Kt(Pt):er()),Zt.reset()),Pt}function cr(Pt,er,Kt,te){const{scrollBehavior:mn}=n;if(!fd||!mn)return Promise.resolve();const ke=!Kt&&eO(vS(Pt.fullPath,0))||(te||!Kt)&&history.state&&history.state.scroll||null;return Ws().then(()=>mn(Pt,er,ke)).then(Ve=>Ve&&JL(Ve)).catch(Ve=>Nr(Ve,Pt,er))}const rr=Pt=>I.go(Pt);let $t;const vi=new Set,hi={currentRoute:G,listening:!0,addRoute:me,removeRoute:he,clearRoutes:c.clearRoutes,hasRoute:Le,getRoutes:ye,resolve:je,options:n,push:ut,replace:ht,go:rr,back:()=>rr(-1),forward:()=>rr(1),beforeEach:R.add,beforeResolve:D.add,afterEach:i.add,onError:Ir.add,isReady:ar,install(Pt){const er=this;Pt.component("RouterLink",SO),Pt.component("RouterView",IO),Pt.config.globalProperties.$router=er,Object.defineProperty(Pt.config.globalProperties,"$route",{enumerable:!0,get:()=>At(G)}),fd&&!$t&&G.value===sc&&($t=!0,ut(I.location).catch(mn=>{}));const Kt={};for(const mn in sc)Object.defineProperty(Kt,mn,{get:()=>G.value[mn],enumerable:!0});Pt.provide(T1,er),Pt.provide(XM,MA(Kt)),Pt.provide(Px,G);const te=Pt.unmount;vi.add(Pt),Pt.unmount=function(){vi.delete(Pt),vi.size<1&&(X=sc,ir&&ir(),ir=null,G.value=sc,$t=!1,yr=!1),te()}}};function pn(Pt){return Pt.reduce((er,Kt)=>er.then(()=>pt(Kt)),Promise.resolve())}return hi}function PO(n,c){const p=[],v=[],I=[],R=Math.max(c.matched.length,n.matched.length);for(let D=0;D<R;D++){const i=c.matched[D];i&&(n.matched.find(X=>wd(X,i))?v.push(i):p.push(i));const G=n.matched[D];G&&(c.matched.find(X=>wd(X,G))||I.push(G))}return[p,v,I]}const RO="modulepreload",DO=function(n){return"/"+n},LS={},zO=function(c,p,v){let I=Promise.resolve();if(p&&p.length>0){document.getElementsByTagName("link");const D=document.querySelector("meta[property=csp-nonce]"),i=(D==null?void 0:D.nonce)||(D==null?void 0:D.getAttribute("nonce"));I=Promise.allSettled(p.map(G=>{if(G=DO(G),G in LS)return;LS[G]=!0;const X=G.endsWith(".css"),q=X?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${G}"]${q}`))return;const ee=document.createElement("link");if(ee.rel=X?"stylesheet":RO,X||(ee.as="script"),ee.crossOrigin="",ee.href=G,i&&ee.setAttribute("nonce",i),document.head.appendChild(ee),X)return new Promise((ne,me)=>{ee.addEventListener("load",ne),ee.addEventListener("error",()=>me(new Error(`Unable to preload CSS for ${G}`)))})}))}function R(D){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=D,window.dispatchEvent(i),!i.defaultPrevented)throw D}return I.then(D=>{for(const i of D||[])i.status==="rejected"&&R(i.reason);return c().catch(R)})},LO=[{path:"/",name:"/",component:()=>zO(()=>import("./index-DExD_eZX.js"),__vite__mapDeps([0,1]))}],OO=Symbol(),rx="el",kO="is-",gu=(n,c,p,v,I)=>{let R=`${n}-${c}`;return p&&(R+=`-${p}`),v&&(R+=`__${v}`),I&&(R+=`--${I}`),R},FO=Symbol("namespaceContextKey"),KM=n=>{const c=ha()?Hn(FO,In(rx)):In(rx);return ct(()=>At(c)||rx)},Du=(n,c)=>{const p=KM();return{namespace:p,b:(ye="")=>gu(p.value,n,ye,"",""),e:ye=>ye?gu(p.value,n,"",ye,""):"",m:ye=>ye?gu(p.value,n,"","",ye):"",be:(ye,Le)=>ye&&Le?gu(p.value,n,ye,Le,""):"",em:(ye,Le)=>ye&&Le?gu(p.value,n,"",ye,Le):"",bm:(ye,Le)=>ye&&Le?gu(p.value,n,ye,"",Le):"",bem:(ye,Le,je)=>ye&&Le&&je?gu(p.value,n,ye,Le,je):"",is:(ye,...Le)=>{const je=Le.length>=1?Le[0]:!0;return ye&&je?`${kO}${ye}`:""},cssVar:ye=>{const Le={};for(const je in ye)ye[je]&&(Le[`--${p.value}-${je}`]=ye[je]);return Le},cssVarName:ye=>`--${p.value}-${ye}`,cssVarBlock:ye=>{const Le={};for(const je in ye)ye[je]&&(Le[`--${p.value}-${n}-${je}`]=ye[je]);return Le},cssVarBlockName:ye=>`--${p.value}-${n}-${ye}`}};var BO=typeof global=="object"&&global&&global.Object===Object&&global,NO=typeof self=="object"&&self&&self.Object===Object&&self,S1=BO||NO||Function("return this")(),yc=S1.Symbol,YM=Object.prototype,VO=YM.hasOwnProperty,UO=YM.toString,kp=yc?yc.toStringTag:void 0;function jO(n){var c=VO.call(n,kp),p=n[kp];try{n[kp]=void 0;var v=!0}catch{}var I=UO.call(n);return v&&(c?n[kp]=p:delete n[kp]),I}var $O=Object.prototype,GO=$O.toString;function qO(n){return GO.call(n)}var HO="[object Null]",WO="[object Undefined]",OS=yc?yc.toStringTag:void 0;function E1(n){return n==null?n===void 0?WO:HO:OS&&OS in Object(n)?jO(n):qO(n)}function A1(n){return n!=null&&typeof n=="object"}var ZO="[object Symbol]";function M1(n){return typeof n=="symbol"||A1(n)&&E1(n)==ZO}function XO(n,c){for(var p=-1,v=n==null?0:n.length,I=Array(v);++p<v;)I[p]=c(n[p],p,n);return I}var vm=Array.isArray,kS=yc?yc.prototype:void 0,FS=kS?kS.toString:void 0;function JM(n){if(typeof n=="string")return n;if(vm(n))return XO(n,JM)+"";if(M1(n))return FS?FS.call(n):"";var c=n+"";return c=="0"&&1/n==-1/0?"-0":c}function Wg(n){var c=typeof n;return n!=null&&(c=="object"||c=="function")}function KO(n){return n}var YO="[object AsyncFunction]",JO="[object Function]",QO="[object GeneratorFunction]",ek="[object Proxy]";function tk(n){if(!Wg(n))return!1;var c=E1(n);return c==JO||c==QO||c==YO||c==ek}var nx=S1["__core-js_shared__"],BS=function(){var n=/[^.]+$/.exec(nx&&nx.keys&&nx.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}();function rk(n){return!!BS&&BS in n}var nk=Function.prototype,ik=nk.toString;function sk(n){if(n!=null){try{return ik.call(n)}catch{}try{return n+""}catch{}}return""}var ok=/[\\^$.*+?()[\]{}|]/g,ak=/^\[object .+?Constructor\]$/,lk=Function.prototype,ck=Object.prototype,uk=lk.toString,hk=ck.hasOwnProperty,dk=RegExp("^"+uk.call(hk).replace(ok,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function fk(n){if(!Wg(n)||rk(n))return!1;var c=tk(n)?dk:ak;return c.test(sk(n))}function pk(n,c){return n==null?void 0:n[c]}function I1(n,c){var p=pk(n,c);return fk(p)?p:void 0}function mk(n,c,p){switch(p.length){case 0:return n.call(c);case 1:return n.call(c,p[0]);case 2:return n.call(c,p[0],p[1]);case 3:return n.call(c,p[0],p[1],p[2])}return n.apply(c,p)}var _k=800,gk=16,yk=Date.now;function vk(n){var c=0,p=0;return function(){var v=yk(),I=gk-(v-p);if(p=v,I>0){if(++c>=_k)return arguments[0]}else c=0;return n.apply(void 0,arguments)}}function xk(n){return function(){return n}}var Zg=function(){try{var n=I1(Object,"defineProperty");return n({},"",{}),n}catch{}}(),bk=Zg?function(n,c){return Zg(n,"toString",{configurable:!0,enumerable:!1,value:xk(c),writable:!0})}:KO,wk=vk(bk),Tk=9007199254740991,Sk=/^(?:0|[1-9]\d*)$/;function QM(n,c){var p=typeof n;return c=c??Tk,!!c&&(p=="number"||p!="symbol"&&Sk.test(n))&&n>-1&&n%1==0&&n<c}function Ek(n,c,p){c=="__proto__"&&Zg?Zg(n,c,{configurable:!0,enumerable:!0,value:p,writable:!0}):n[c]=p}function eI(n,c){return n===c||n!==n&&c!==c}var Ak=Object.prototype,Mk=Ak.hasOwnProperty;function Ik(n,c,p){var v=n[c];(!(Mk.call(n,c)&&eI(v,p))||p===void 0&&!(c in n))&&Ek(n,c,p)}var NS=Math.max;function Ck(n,c,p){return c=NS(c===void 0?n.length-1:c,0),function(){for(var v=arguments,I=-1,R=NS(v.length-c,0),D=Array(R);++I<R;)D[I]=v[c+I];I=-1;for(var i=Array(c+1);++I<c;)i[I]=v[I];return i[c]=p(D),mk(n,this,i)}}var Pk=9007199254740991;function Rk(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=Pk}var Dk="[object Arguments]";function VS(n){return A1(n)&&E1(n)==Dk}var tI=Object.prototype,zk=tI.hasOwnProperty,Lk=tI.propertyIsEnumerable,rI=VS(function(){return arguments}())?VS:function(n){return A1(n)&&zk.call(n,"callee")&&!Lk.call(n,"callee")},Ok=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,kk=/^\w*$/;function Fk(n,c){if(vm(n))return!1;var p=typeof n;return p=="number"||p=="symbol"||p=="boolean"||n==null||M1(n)?!0:kk.test(n)||!Ok.test(n)||c!=null&&n in Object(c)}var om=I1(Object,"create");function Bk(){this.__data__=om?om(null):{},this.size=0}function Nk(n){var c=this.has(n)&&delete this.__data__[n];return this.size-=c?1:0,c}var Vk="__lodash_hash_undefined__",Uk=Object.prototype,jk=Uk.hasOwnProperty;function $k(n){var c=this.__data__;if(om){var p=c[n];return p===Vk?void 0:p}return jk.call(c,n)?c[n]:void 0}var Gk=Object.prototype,qk=Gk.hasOwnProperty;function Hk(n){var c=this.__data__;return om?c[n]!==void 0:qk.call(c,n)}var Wk="__lodash_hash_undefined__";function Zk(n,c){var p=this.__data__;return this.size+=this.has(n)?0:1,p[n]=om&&c===void 0?Wk:c,this}function zu(n){var c=-1,p=n==null?0:n.length;for(this.clear();++c<p;){var v=n[c];this.set(v[0],v[1])}}zu.prototype.clear=Bk;zu.prototype.delete=Nk;zu.prototype.get=$k;zu.prototype.has=Hk;zu.prototype.set=Zk;function Xk(){this.__data__=[],this.size=0}function yy(n,c){for(var p=n.length;p--;)if(eI(n[p][0],c))return p;return-1}var Kk=Array.prototype,Yk=Kk.splice;function Jk(n){var c=this.__data__,p=yy(c,n);if(p<0)return!1;var v=c.length-1;return p==v?c.pop():Yk.call(c,p,1),--this.size,!0}function Qk(n){var c=this.__data__,p=yy(c,n);return p<0?void 0:c[p][1]}function e4(n){return yy(this.__data__,n)>-1}function t4(n,c){var p=this.__data__,v=yy(p,n);return v<0?(++this.size,p.push([n,c])):p[v][1]=c,this}function Id(n){var c=-1,p=n==null?0:n.length;for(this.clear();++c<p;){var v=n[c];this.set(v[0],v[1])}}Id.prototype.clear=Xk;Id.prototype.delete=Jk;Id.prototype.get=Qk;Id.prototype.has=e4;Id.prototype.set=t4;var r4=I1(S1,"Map");function n4(){this.size=0,this.__data__={hash:new zu,map:new(r4||Id),string:new zu}}function i4(n){var c=typeof n;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?n!=="__proto__":n===null}function vy(n,c){var p=n.__data__;return i4(c)?p[typeof c=="string"?"string":"hash"]:p.map}function s4(n){var c=vy(this,n).delete(n);return this.size-=c?1:0,c}function o4(n){return vy(this,n).get(n)}function a4(n){return vy(this,n).has(n)}function l4(n,c){var p=vy(this,n),v=p.size;return p.set(n,c),this.size+=p.size==v?0:1,this}function Ou(n){var c=-1,p=n==null?0:n.length;for(this.clear();++c<p;){var v=n[c];this.set(v[0],v[1])}}Ou.prototype.clear=n4;Ou.prototype.delete=s4;Ou.prototype.get=o4;Ou.prototype.has=a4;Ou.prototype.set=l4;var c4="Expected a function";function C1(n,c){if(typeof n!="function"||c!=null&&typeof c!="function")throw new TypeError(c4);var p=function(){var v=arguments,I=c?c.apply(this,v):v[0],R=p.cache;if(R.has(I))return R.get(I);var D=n.apply(this,v);return p.cache=R.set(I,D)||R,D};return p.cache=new(C1.Cache||Ou),p}C1.Cache=Ou;var u4=500;function h4(n){var c=C1(n,function(v){return p.size===u4&&p.clear(),v}),p=c.cache;return c}var d4=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,f4=/\\(\\)?/g,p4=h4(function(n){var c=[];return n.charCodeAt(0)===46&&c.push(""),n.replace(d4,function(p,v,I,R){c.push(I?R.replace(f4,"$1"):v||p)}),c});function m4(n){return n==null?"":JM(n)}function xy(n,c){return vm(n)?n:Fk(n,c)?[n]:p4(m4(n))}function P1(n){if(typeof n=="string"||M1(n))return n;var c=n+"";return c=="0"&&1/n==-1/0?"-0":c}function _4(n,c){c=xy(c,n);for(var p=0,v=c.length;n!=null&&p<v;)n=n[P1(c[p++])];return p&&p==v?n:void 0}function g4(n,c){for(var p=-1,v=c.length,I=n.length;++p<v;)n[I+p]=c[p];return n}var US=yc?yc.isConcatSpreadable:void 0;function y4(n){return vm(n)||rI(n)||!!(US&&n&&n[US])}function v4(n,c,p,v,I){var R=-1,D=n.length;for(p||(p=y4),I||(I=[]);++R<D;){var i=n[R];p(i)?g4(I,i):I[I.length]=i}return I}function x4(n){var c=n==null?0:n.length;return c?v4(n):[]}function b4(n){return wk(Ck(n,void 0,x4),n+"")}function w4(n,c){return n!=null&&c in Object(n)}function T4(n,c,p){c=xy(c,n);for(var v=-1,I=c.length,R=!1;++v<I;){var D=P1(c[v]);if(!(R=n!=null&&p(n,D)))break;n=n[D]}return R||++v!=I?R:(I=n==null?0:n.length,!!I&&Rk(I)&&QM(D,I)&&(vm(n)||rI(n)))}function S4(n,c){return n!=null&&T4(n,c,w4)}function nI(n){for(var c=-1,p=n==null?0:n.length,v={};++c<p;){var I=n[c];v[I[0]]=I[1]}return v}function E4(n){return n==null}function A4(n,c,p,v){if(!Wg(n))return n;c=xy(c,n);for(var I=-1,R=c.length,D=R-1,i=n;i!=null&&++I<R;){var G=P1(c[I]),X=p;if(G==="__proto__"||G==="constructor"||G==="prototype")return n;if(I!=D){var q=i[G];X=void 0,X===void 0&&(X=Wg(q)?q:QM(c[I+1])?[]:{})}Ik(i,G,X),i=i[G]}return n}function M4(n,c,p){for(var v=-1,I=c.length,R={};++v<I;){var D=c[v],i=_4(n,D);p(i,D)&&A4(R,xy(D,n),i)}return R}function I4(n,c){return M4(n,c,function(p,v){return S4(n,v)})}var C4=b4(function(n,c){return n==null?{}:I4(n,c)});const P4=n=>n===void 0,Rg=n=>typeof n=="boolean",vd=n=>typeof n=="number",KU=n=>typeof Element>"u"?!1:n instanceof Element,R4=n=>jn(n)?!Number.isNaN(Number(n)):!1;var D4=Object.defineProperty,z4=Object.defineProperties,L4=Object.getOwnPropertyDescriptors,jS=Object.getOwnPropertySymbols,O4=Object.prototype.hasOwnProperty,k4=Object.prototype.propertyIsEnumerable,$S=(n,c,p)=>c in n?D4(n,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):n[c]=p,F4=(n,c)=>{for(var p in c||(c={}))O4.call(c,p)&&$S(n,p,c[p]);if(jS)for(var p of jS(c))k4.call(c,p)&&$S(n,p,c[p]);return n},B4=(n,c)=>z4(n,L4(c));function N4(n,c){var p;const v=Fn();return Ad(()=>{v.value=n()},B4(F4({},c),{flush:(p=void 0)!=null?p:"sync"})),mm(v)}var GS;const xm=typeof window<"u",V4=n=>typeof n=="string",Rx=()=>{};xm&&((GS=window==null?void 0:window.navigator)!=null&&GS.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function R1(n){return typeof n=="function"?n():At(n)}function U4(n,c){function p(...v){return new Promise((I,R)=>{Promise.resolve(n(()=>c.apply(this,v),{fn:c,thisArg:this,args:v})).then(I).catch(R)})}return p}function j4(n,c=!0,p=!0,v=!1){let I=0,R,D=!0,i=Rx,G;const X=()=>{R&&(clearTimeout(R),R=void 0,i(),i=Rx)};return ee=>{const ne=R1(n),me=Date.now()-I,he=()=>G=ee();return X(),ne<=0?(I=Date.now(),he()):(me>ne&&(p||!D)?(I=Date.now(),he()):c&&(G=new Promise((ye,Le)=>{i=v?Le:ye,R=setTimeout(()=>{I=Date.now(),D=!0,ye(he()),X()},Math.max(0,ne-me))})),!p&&!R&&(R=setTimeout(()=>D=!0,ne)),D=!1,G)}}function $4(n){return n}function iI(n){return e1()?(ly(n),!0):!1}function YU(n,c=200,p=!1,v=!0,I=!1){return U4(j4(c,p,v,I),n)}function G4(n,c=!0){ha()?ua(n):c?n():Ws(n)}function sI(n){var c;const p=R1(n);return(c=p==null?void 0:p.$el)!=null?c:p}const oI=xm?window:void 0;function ix(...n){let c,p,v,I;if(V4(n[0])||Array.isArray(n[0])?([p,v,I]=n,c=oI):[c,p,v,I]=n,!c)return Rx;Array.isArray(p)||(p=[p]),Array.isArray(v)||(v=[v]);const R=[],D=()=>{R.forEach(q=>q()),R.length=0},i=(q,ee,ne,me)=>(q.addEventListener(ee,ne,me),()=>q.removeEventListener(ee,ne,me)),G=zn(()=>[sI(c),R1(I)],([q,ee])=>{D(),q&&R.push(...p.flatMap(ne=>v.map(me=>i(q,ne,me,ee))))},{immediate:!0,flush:"post"}),X=()=>{G(),D()};return iI(X),X}function q4(n,c=!1){const p=In(),v=()=>p.value=!!n();return v(),G4(v,c),p}const qS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},HS="__vueuse_ssr_handlers__";qS[HS]=qS[HS]||{};var WS=Object.getOwnPropertySymbols,H4=Object.prototype.hasOwnProperty,W4=Object.prototype.propertyIsEnumerable,Z4=(n,c)=>{var p={};for(var v in n)H4.call(n,v)&&c.indexOf(v)<0&&(p[v]=n[v]);if(n!=null&&WS)for(var v of WS(n))c.indexOf(v)<0&&W4.call(n,v)&&(p[v]=n[v]);return p};function X4(n,c,p={}){const v=p,{window:I=oI}=v,R=Z4(v,["window"]);let D;const i=q4(()=>I&&"ResizeObserver"in I),G=()=>{D&&(D.disconnect(),D=void 0)},X=zn(()=>sI(n),ee=>{G(),i.value&&I&&ee&&(D=new ResizeObserver(c),D.observe(ee,R))},{immediate:!0,flush:"post"}),q=()=>{G(),X()};return iI(q),{isSupported:i,stop:q}}var ZS;(function(n){n.UP="UP",n.RIGHT="RIGHT",n.DOWN="DOWN",n.LEFT="LEFT",n.NONE="NONE"})(ZS||(ZS={}));var K4=Object.defineProperty,XS=Object.getOwnPropertySymbols,Y4=Object.prototype.hasOwnProperty,J4=Object.prototype.propertyIsEnumerable,KS=(n,c,p)=>c in n?K4(n,c,{enumerable:!0,configurable:!0,writable:!0,value:p}):n[c]=p,Q4=(n,c)=>{for(var p in c||(c={}))Y4.call(c,p)&&KS(n,p,c[p]);if(XS)for(var p of XS(c))J4.call(c,p)&&KS(n,p,c[p]);return n};const eF={easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]};Q4({linear:$4},eF);class tF extends Error{constructor(c){super(c),this.name="ElementPlusError"}}function rF(n,c){throw new tF(`[${n}] ${c}`)}const aI="__epPropKey",Au=n=>n,nF=n=>Xn(n)&&!!n[aI],lI=(n,c)=>{if(!Xn(n)||nF(n))return n;const{values:p,required:v,default:I,type:R,validator:D}=n,G={type:R,required:!!v,validator:p||D?X=>{let q=!1,ee=[];if(p&&(ee=Array.from(p),Un(n,"default")&&ee.push(I),q||(q=ee.includes(X))),D&&(q||(q=D(X))),!q&&ee.length>0){const ne=[...new Set(ee)].map(me=>JSON.stringify(me)).join(", ");kz(`Invalid prop: validation failed${c?` for prop "${c}"`:""}. Expected one of [${ne}], got value ${JSON.stringify(X)}.`)}return q}:void 0,[aI]:!0};return Un(n,"default")&&(G.default=I),G},bm=n=>nI(Object.entries(n).map(([c,p])=>[c,lI(p,c)])),cI=["","default","small","large"],uI=lI({type:String,values:cI,required:!1}),iF=Symbol("size"),sF=()=>{const n=Hn(iF,{});return ct(()=>At(n.size)||"")},YS=In();function oF(n,c=void 0){const p=ha()?Hn(OO,YS):YS;return ct(()=>{var v,I;return(I=(v=p.value)==null?void 0:v[n])!=null?I:c})}const Sd="update:modelValue",am="change",lm="input";var wm=(n,c)=>{const p=n.__vccOpts||n;for(const[v,I]of c)p[v]=I;return p};const JU=(n,c)=>{var p;if(!xm||!n||!c)return"";let v=Fs(c);v==="float"&&(v="cssFloat");try{const I=n.style[v];if(I)return I;const R=(p=document.defaultView)==null?void 0:p.getComputedStyle(n,"");return R?R[v]:""}catch{return n.style[v]}};function hI(n,c="px"){if(!n)return"";if(vd(n)||R4(n))return`${n}${c}`;if(jn(n))return n}const by=(n,c)=>{if(n.install=p=>{for(const v of[n,...Object.values(c??{})])p.component(v.name,v)},c)for(const[p,v]of Object.entries(c))n[p]=v;return n},aF=n=>(n.install=mo,n),lF=bm({size:{type:Au([Number,String])},color:{type:String}}),cF=ei({name:"ElIcon",inheritAttrs:!1}),uF=ei({...cF,props:lF,setup(n){const c=n,p=Du("icon"),v=ct(()=>{const{size:I,color:R}=c;return!I&&!R?{}:{fontSize:P4(I)?void 0:hI(I),"--color":R}});return(I,R)=>(vr(),vn("i",Ks({class:At(p).b(),style:At(v)},I.$attrs),[sa(I.$slots,"default")],16))}});var hF=wm(uF,[["__file","icon.vue"]]);const Hs=by(hF);/*! Element Plus Icons Vue v2.3.1 */var dF=ei({name:"ArrowLeft",__name:"arrow-left",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"M609.408 149.376 277.76 489.6a32 32 0 0 0 0 44.672l331.648 340.352a29.12 29.12 0 0 0 41.728 0 30.592 30.592 0 0 0 0-42.752L339.264 511.936l311.872-319.872a30.592 30.592 0 0 0 0-42.688 29.12 29.12 0 0 0-41.728 0z"})]))}}),QU=dF,fF=ei({name:"ArrowRight",__name:"arrow-right",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"M340.864 149.312a30.592 30.592 0 0 0 0 42.752L652.736 512 340.864 831.872a30.592 30.592 0 0 0 0 42.752 29.12 29.12 0 0 0 41.728 0L714.24 534.336a32 32 0 0 0 0-44.672L382.592 149.376a29.12 29.12 0 0 0-41.728 0z"})]))}}),e8=fF,pF=ei({name:"CircleCheck",__name:"circle-check",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896"}),wn("path",{fill:"currentColor",d:"M745.344 361.344a32 32 0 0 1 45.312 45.312l-288 288a32 32 0 0 1-45.312 0l-160-160a32 32 0 1 1 45.312-45.312L480 626.752l265.344-265.408z"})]))}}),mF=pF,_F=ei({name:"CircleClose",__name:"circle-close",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"m466.752 512-90.496-90.496a32 32 0 0 1 45.248-45.248L512 466.752l90.496-90.496a32 32 0 1 1 45.248 45.248L557.248 512l90.496 90.496a32 32 0 1 1-45.248 45.248L512 557.248l-90.496 90.496a32 32 0 0 1-45.248-45.248z"}),wn("path",{fill:"currentColor",d:"M512 896a384 384 0 1 0 0-768 384 384 0 0 0 0 768m0 64a448 448 0 1 1 0-896 448 448 0 0 1 0 896"})]))}}),dI=_F,gF=ei({name:"Close",__name:"close",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"})]))}}),t8=gF,yF=ei({name:"FullScreen",__name:"full-screen",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"m160 96.064 192 .192a32 32 0 0 1 0 64l-192-.192V352a32 32 0 0 1-64 0V96h64zm0 831.872V928H96V672a32 32 0 1 1 64 0v191.936l192-.192a32 32 0 1 1 0 64zM864 96.064V96h64v256a32 32 0 1 1-64 0V160.064l-192 .192a32 32 0 1 1 0-64l192-.192zm0 831.872-192-.192a32 32 0 0 1 0-64l192 .192V672a32 32 0 1 1 64 0v256h-64z"})]))}}),r8=yF,vF=ei({name:"Hide",__name:"hide",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"M876.8 156.8c0-9.6-3.2-16-9.6-22.4-6.4-6.4-12.8-9.6-22.4-9.6-9.6 0-16 3.2-22.4 9.6L736 220.8c-64-32-137.6-51.2-224-60.8-160 16-288 73.6-377.6 176C44.8 438.4 0 496 0 512s48 73.6 134.4 176c22.4 25.6 44.8 48 73.6 67.2l-86.4 89.6c-6.4 6.4-9.6 12.8-9.6 22.4 0 9.6 3.2 16 9.6 22.4 6.4 6.4 12.8 9.6 22.4 9.6 9.6 0 16-3.2 22.4-9.6l704-710.4c3.2-6.4 6.4-12.8 6.4-22.4Zm-646.4 528c-76.8-70.4-128-128-153.6-172.8 28.8-48 80-105.6 153.6-172.8C304 272 400 230.4 512 224c64 3.2 124.8 19.2 176 44.8l-54.4 54.4C598.4 300.8 560 288 512 288c-64 0-115.2 22.4-160 64s-64 96-64 160c0 48 12.8 89.6 35.2 124.8L256 707.2c-9.6-6.4-19.2-16-25.6-22.4Zm140.8-96c-12.8-22.4-19.2-48-19.2-76.8 0-44.8 16-83.2 48-112 32-28.8 67.2-48 112-48 28.8 0 54.4 6.4 73.6 19.2zM889.599 336c-12.8-16-28.8-28.8-41.6-41.6l-48 48c73.6 67.2 124.8 124.8 150.4 169.6-28.8 48-80 105.6-153.6 172.8-73.6 67.2-172.8 108.8-284.8 115.2-51.2-3.2-99.2-12.8-140.8-28.8l-48 48c57.6 22.4 118.4 38.4 188.8 44.8 160-16 288-73.6 377.6-176C979.199 585.6 1024 528 1024 512s-48.001-73.6-134.401-176Z"}),wn("path",{fill:"currentColor",d:"M511.998 672c-12.8 0-25.6-3.2-38.4-6.4l-51.2 51.2c28.8 12.8 57.6 19.2 89.6 19.2 64 0 115.2-22.4 160-64 41.6-41.6 64-96 64-160 0-32-6.4-64-19.2-89.6l-51.2 51.2c3.2 12.8 6.4 25.6 6.4 38.4 0 44.8-16 83.2-48 112-32 28.8-67.2 48-112 48Z"})]))}}),xF=vF,bF=ei({name:"Loading",__name:"loading",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32m0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32m448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32m-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32M195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0m-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"})]))}}),D1=bF,wF=ei({name:"RefreshLeft",__name:"refresh-left",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"M289.088 296.704h92.992a32 32 0 0 1 0 64H232.96a32 32 0 0 1-32-32V179.712a32 32 0 0 1 64 0v50.56a384 384 0 0 1 643.84 282.88 384 384 0 0 1-383.936 384 384 384 0 0 1-384-384h64a320 320 0 1 0 640 0 320 320 0 0 0-555.712-216.448z"})]))}}),n8=wF,TF=ei({name:"RefreshRight",__name:"refresh-right",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"M784.512 230.272v-50.56a32 32 0 1 1 64 0v149.056a32 32 0 0 1-32 32H667.52a32 32 0 1 1 0-64h92.992A320 320 0 1 0 524.8 833.152a320 320 0 0 0 320-320h64a384 384 0 0 1-384 384 384 384 0 0 1-384-384 384 384 0 0 1 643.712-282.88z"})]))}}),i8=TF,SF=ei({name:"ScaleToOriginal",__name:"scale-to-original",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"M813.176 180.706a60.235 60.235 0 0 1 60.236 60.235v481.883a60.235 60.235 0 0 1-60.236 60.235H210.824a60.235 60.235 0 0 1-60.236-60.235V240.94a60.235 60.235 0 0 1 60.236-60.235h602.352zm0-60.235H210.824A120.47 120.47 0 0 0 90.353 240.94v481.883a120.47 120.47 0 0 0 120.47 120.47h602.353a120.47 120.47 0 0 0 120.471-120.47V240.94a120.47 120.47 0 0 0-120.47-120.47zm-120.47 180.705a30.118 30.118 0 0 0-30.118 30.118v301.177a30.118 30.118 0 0 0 60.236 0V331.294a30.118 30.118 0 0 0-30.118-30.118zm-361.412 0a30.118 30.118 0 0 0-30.118 30.118v301.177a30.118 30.118 0 1 0 60.236 0V331.294a30.118 30.118 0 0 0-30.118-30.118M512 361.412a30.118 30.118 0 0 0-30.118 30.117v30.118a30.118 30.118 0 0 0 60.236 0V391.53A30.118 30.118 0 0 0 512 361.412M512 512a30.118 30.118 0 0 0-30.118 30.118v30.117a30.118 30.118 0 0 0 60.236 0v-30.117A30.118 30.118 0 0 0 512 512"})]))}}),s8=SF,EF=ei({name:"Search",__name:"search",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704"})]))}}),AF=EF,MF=ei({name:"View",__name:"view",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"M512 160c320 0 512 352 512 352S832 864 512 864 0 512 0 512s192-352 512-352m0 64c-225.28 0-384.128 208.064-436.8 288 52.608 79.872 211.456 288 436.8 288 225.28 0 384.128-208.064 436.8-288-52.608-79.872-211.456-288-436.8-288zm0 64a224 224 0 1 1 0 448 224 224 0 0 1 0-448m0 64a160.192 160.192 0 0 0-160 160c0 88.192 71.744 160 160 160s160-71.808 160-160-71.744-160-160-160"})]))}}),IF=MF,CF=ei({name:"ZoomIn",__name:"zoom-in",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704m-32-384v-96a32 32 0 0 1 64 0v96h96a32 32 0 0 1 0 64h-96v96a32 32 0 0 1-64 0v-96h-96a32 32 0 0 1 0-64z"})]))}}),o8=CF,PF=ei({name:"ZoomOut",__name:"zoom-out",setup(n){return(c,p)=>(vr(),vn("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[wn("path",{fill:"currentColor",d:"m795.904 750.72 124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704 352 352 0 0 0 0 704M352 448h256a32 32 0 0 1 0 64H352a32 32 0 0 1 0-64"})]))}}),a8=PF;const fc=Au([String,Object,Function]),RF={validating:D1,success:mF,error:dI},DF=()=>xm&&/firefox/i.test(window.navigator.userAgent);let qs;const zF={height:"0",visibility:"hidden",overflow:DF()?"":"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},LF=["letter-spacing","line-height","padding-top","padding-bottom","font-family","font-weight","font-size","text-rendering","text-transform","width","text-indent","padding-left","padding-right","border-width","box-sizing"];function OF(n){const c=window.getComputedStyle(n),p=c.getPropertyValue("box-sizing"),v=Number.parseFloat(c.getPropertyValue("padding-bottom"))+Number.parseFloat(c.getPropertyValue("padding-top")),I=Number.parseFloat(c.getPropertyValue("border-bottom-width"))+Number.parseFloat(c.getPropertyValue("border-top-width"));return{contextStyle:LF.map(D=>[D,c.getPropertyValue(D)]),paddingSize:v,borderSize:I,boxSizing:p}}function JS(n,c=1,p){var v;qs||(qs=document.createElement("textarea"),document.body.appendChild(qs));const{paddingSize:I,borderSize:R,boxSizing:D,contextStyle:i}=OF(n);i.forEach(([ee,ne])=>qs==null?void 0:qs.style.setProperty(ee,ne)),Object.entries(zF).forEach(([ee,ne])=>qs==null?void 0:qs.style.setProperty(ee,ne,"important")),qs.value=n.value||n.placeholder||"";let G=qs.scrollHeight;const X={};D==="border-box"?G=G+R:D==="content-box"&&(G=G-I),qs.value="";const q=qs.scrollHeight-I;if(vd(c)){let ee=q*c;D==="border-box"&&(ee=ee+I+R),G=Math.max(ee,G),X.minHeight=`${ee}px`}if(vd(p)){let ee=q*p;D==="border-box"&&(ee=ee+I+R),G=Math.min(ee,G)}return X.height=`${G}px`,(v=qs.parentNode)==null||v.removeChild(qs),qs=void 0,X}const kF=n=>n,FF=bm({ariaLabel:String,ariaOrientation:{type:String,values:["horizontal","vertical","undefined"]},ariaControls:String}),fI=n=>C4(FF,n),BF=bm({id:{type:String,default:void 0},size:uI,disabled:Boolean,modelValue:{type:Au([String,Number,Object]),default:""},maxlength:{type:[String,Number]},minlength:{type:[String,Number]},type:{type:String,default:"text"},resize:{type:String,values:["none","both","horizontal","vertical"]},autosize:{type:Au([Boolean,Object]),default:!1},autocomplete:{type:String,default:"off"},formatter:{type:Function},parser:{type:Function},placeholder:{type:String},form:{type:String},readonly:Boolean,clearable:Boolean,showPassword:Boolean,showWordLimit:Boolean,suffixIcon:{type:fc},prefixIcon:{type:fc},containerRole:{type:String,default:void 0},tabindex:{type:[String,Number],default:0},validateEvent:{type:Boolean,default:!0},inputStyle:{type:Au([Object,Array,String]),default:()=>kF({})},autofocus:Boolean,rows:{type:Number,default:2},...fI(["ariaLabel"])}),NF={[Sd]:n=>jn(n),input:n=>jn(n),change:n=>jn(n),focus:n=>n instanceof FocusEvent,blur:n=>n instanceof FocusEvent,clear:()=>!0,mouseleave:n=>n instanceof MouseEvent,mouseenter:n=>n instanceof MouseEvent,keydown:n=>n instanceof Event,compositionstart:n=>n instanceof CompositionEvent,compositionupdate:n=>n instanceof CompositionEvent,compositionend:n=>n instanceof CompositionEvent},VF=["class","style"],UF=/^on[A-Z]/,jF=(n={})=>{const{excludeListeners:c=!1,excludeKeys:p}=n,v=ct(()=>((p==null?void 0:p.value)||[]).concat(VF)),I=ha();return ct(I?()=>{var R;return nI(Object.entries((R=I.proxy)==null?void 0:R.$attrs).filter(([D])=>!v.value.includes(D)&&!(c&&UF.test(D))))}:()=>({}))},z1=Symbol("formContextKey"),pI=Symbol("formItemContextKey"),QS={prefix:Math.floor(Math.random()*1e4),current:0},$F=Symbol("elIdInjection"),GF=()=>ha()?Hn($F,QS):QS,qF=n=>{const c=GF(),p=KM();return N4(()=>At(n)||`${p.value}-id-${c.prefix}-${c.current++}`)},L1=()=>{const n=Hn(z1,void 0),c=Hn(pI,void 0);return{form:n,formItem:c}},mI=(n,{formItemContext:c,disableIdGeneration:p,disableIdManagement:v})=>{p||(p=In(!1)),v||(v=In(!1));const I=In();let R;const D=ct(()=>{var i;return!!(!(n.label||n.ariaLabel)&&c&&c.inputIds&&((i=c.inputIds)==null?void 0:i.length)<=1)});return ua(()=>{R=zn([ps(n,"id"),p],([i,G])=>{const X=i??(G?void 0:qF().value);X!==I.value&&(c!=null&&c.removeInputId&&(I.value&&c.removeInputId(I.value),!(v!=null&&v.value)&&!G&&X&&c.addInputId(X)),I.value=X)},{immediate:!0})}),d1(()=>{R&&R(),c!=null&&c.removeInputId&&I.value&&c.removeInputId(I.value)}),{isLabeledByFormItem:D,inputId:I}},_I=n=>{const c=ha();return ct(()=>{var p,v;return(v=(p=c==null?void 0:c.proxy)==null?void 0:p.$props)==null?void 0:v[n]})},O1=(n,c={})=>{const p=In(void 0),v=c.prop?p:_I("size"),I=c.global?p:sF(),R=c.form?{size:void 0}:Hn(z1,void 0),D=c.formItem?{size:void 0}:Hn(pI,void 0);return ct(()=>v.value||At(n)||(D==null?void 0:D.size)||(R==null?void 0:R.size)||I.value||"")},wy=n=>{const c=_I("disabled"),p=Hn(z1,void 0);return ct(()=>c.value||At(n)||(p==null?void 0:p.disabled)||!1)};function HF(n,{beforeFocus:c,afterFocus:p,beforeBlur:v,afterBlur:I}={}){const R=ha(),{emit:D}=R,i=Fn(),G=In(!1),X=ne=>{en(c)&&c(ne)||G.value||(G.value=!0,D("focus",ne),p==null||p())},q=ne=>{var me;en(v)&&v(ne)||ne.relatedTarget&&((me=i.value)!=null&&me.contains(ne.relatedTarget))||(G.value=!1,D("blur",ne),I==null||I())},ee=()=>{var ne,me;(ne=i.value)!=null&&ne.contains(document.activeElement)&&i.value!==document.activeElement||(me=n.value)==null||me.focus()};return zn(i,ne=>{ne&&ne.setAttribute("tabindex","-1")}),ix(i,"focus",X,!0),ix(i,"blur",q,!0),ix(i,"click",ee,!0),{isFocused:G,wrapperRef:i,handleFocus:X,handleBlur:q}}const WF=n=>/([\uAC00-\uD7AF\u3130-\u318F])+/gi.test(n);function ZF({afterComposition:n,emit:c}){const p=In(!1),v=i=>{c==null||c("compositionstart",i),p.value=!0},I=i=>{var G;c==null||c("compositionupdate",i);const X=(G=i.target)==null?void 0:G.value,q=X[X.length-1]||"";p.value=!WF(q)},R=i=>{c==null||c("compositionend",i),p.value&&(p.value=!1,Ws(()=>n(i)))};return{isComposing:p,handleComposition:i=>{i.type==="compositionend"?R(i):I(i)},handleCompositionStart:v,handleCompositionUpdate:I,handleCompositionEnd:R}}function XF(n){let c;function p(){if(n.value==null)return;const{selectionStart:I,selectionEnd:R,value:D}=n.value;if(I==null||R==null)return;const i=D.slice(0,Math.max(0,I)),G=D.slice(Math.max(0,R));c={selectionStart:I,selectionEnd:R,value:D,beforeTxt:i,afterTxt:G}}function v(){if(n.value==null||c==null)return;const{value:I}=n.value,{beforeTxt:R,afterTxt:D,selectionStart:i}=c;if(R==null||D==null||i==null)return;let G=I.length;if(I.endsWith(D))G=I.length-D.length;else if(I.startsWith(R))G=R.length;else{const X=R[i-1],q=I.indexOf(X,i-1);q!==-1&&(G=q+1)}n.value.setSelectionRange(G,G)}return[p,v]}const KF="ElInput",YF=ei({name:KF,inheritAttrs:!1}),JF=ei({...YF,props:BF,emits:NF,setup(n,{expose:c,emit:p}){const v=n,I=XD(),R=jF(),D=QA(),i=ct(()=>[v.type==="textarea"?ye.b():he.b(),he.m(ne.value),he.is("disabled",me.value),he.is("exceed",rr.value),{[he.b("group")]:D.prepend||D.append,[he.m("prefix")]:D.prefix||v.prefixIcon,[he.m("suffix")]:D.suffix||v.suffixIcon||v.clearable||v.showPassword,[he.bm("suffix","password-clear")]:Nr.value&&ar.value,[he.b("hidden")]:v.type==="hidden"},I.class]),G=ct(()=>[he.e("wrapper"),he.is("focus",Et.value)]),{form:X,formItem:q}=L1(),{inputId:ee}=mI(v,{formItemContext:q}),ne=O1(),me=wy(),he=Du("input"),ye=Du("textarea"),Le=Fn(),je=Fn(),vt=In(!1),Dt=In(!1),ut=In(),ht=Fn(v.inputStyle),St=ct(()=>Le.value||je.value),{wrapperRef:tt,isFocused:Et,handleFocus:pt,handleBlur:ot}=HF(St,{beforeFocus(){return me.value},afterBlur(){var Ye;v.validateEvent&&((Ye=q==null?void 0:q.validate)==null||Ye.call(q,"blur").catch(Jt=>void 0))}}),gt=ct(()=>{var Ye;return(Ye=X==null?void 0:X.statusIcon)!=null?Ye:!1}),yt=ct(()=>(q==null?void 0:q.validateState)||""),ir=ct(()=>yt.value&&RF[yt.value]),zr=ct(()=>Dt.value?IF:xF),Zt=ct(()=>[I.style]),Ir=ct(()=>[v.inputStyle,ht.value,{resize:v.resize}]),yr=ct(()=>E4(v.modelValue)?"":String(v.modelValue)),Nr=ct(()=>v.clearable&&!me.value&&!v.readonly&&!!yr.value&&(Et.value||vt.value)),ar=ct(()=>v.showPassword&&!me.value&&!!yr.value&&(!!yr.value||Et.value)),Gr=ct(()=>v.showWordLimit&&!!v.maxlength&&(v.type==="text"||v.type==="textarea")&&!me.value&&!v.readonly&&!v.showPassword),cr=ct(()=>yr.value.length),rr=ct(()=>!!Gr.value&&cr.value>Number(v.maxlength)),$t=ct(()=>!!D.suffix||!!v.suffixIcon||Nr.value||v.showPassword||Gr.value||!!yt.value&&gt.value),[vi,hi]=XF(Le);X4(je,Ye=>{if(er(),!Gr.value||v.resize!=="both")return;const Jt=Ye[0],{width:jr}=Jt.contentRect;ut.value={right:`calc(100% - ${jr+15+6}px)`}});const pn=()=>{const{type:Ye,autosize:Jt}=v;if(!(!xm||Ye!=="textarea"||!je.value))if(Jt){const jr=Xn(Jt)?Jt.minRows:void 0,_n=Xn(Jt)?Jt.maxRows:void 0,Vr=JS(je.value,jr,_n);ht.value={overflowY:"hidden",...Vr},Ws(()=>{je.value.offsetHeight,ht.value=Vr})}else ht.value={minHeight:JS(je.value).minHeight}},er=(Ye=>{let Jt=!1;return()=>{var jr;if(Jt||!v.autosize)return;((jr=je.value)==null?void 0:jr.offsetParent)===null||(Ye(),Jt=!0)}})(pn),Kt=()=>{const Ye=St.value,Jt=v.formatter?v.formatter(yr.value):yr.value;!Ye||Ye.value===Jt||(Ye.value=Jt)},te=async Ye=>{vi();let{value:Jt}=Ye.target;if(v.formatter&&v.parser&&(Jt=v.parser(Jt)),!ke.value){if(Jt===yr.value){Kt();return}p(Sd,Jt),p(lm,Jt),await Ws(),Kt(),hi()}},mn=Ye=>{let{value:Jt}=Ye.target;v.formatter&&v.parser&&(Jt=v.parser(Jt)),p(am,Jt)},{isComposing:ke,handleCompositionStart:Ve,handleCompositionUpdate:Ae,handleCompositionEnd:xt}=ZF({emit:p,afterComposition:te}),Vt=()=>{vi(),Dt.value=!Dt.value,setTimeout(hi)},zt=()=>{var Ye;return(Ye=St.value)==null?void 0:Ye.focus()},Rt=()=>{var Ye;return(Ye=St.value)==null?void 0:Ye.blur()},jt=Ye=>{vt.value=!1,p("mouseleave",Ye)},Yt=Ye=>{vt.value=!0,p("mouseenter",Ye)},Gt=Ye=>{p("keydown",Ye)},Cr=()=>{var Ye;(Ye=St.value)==null||Ye.select()},lr=()=>{p(Sd,""),p(am,""),p("clear"),p(lm,"")};return zn(()=>v.modelValue,()=>{var Ye;Ws(()=>pn()),v.validateEvent&&((Ye=q==null?void 0:q.validate)==null||Ye.call(q,"change").catch(Jt=>void 0))}),zn(yr,()=>Kt()),zn(()=>v.type,async()=>{await Ws(),Kt(),pn()}),ua(()=>{!v.formatter&&v.parser,Kt(),Ws(pn)}),c({input:Le,textarea:je,ref:St,textareaStyle:Ir,autosize:ps(v,"autosize"),isComposing:ke,focus:zt,blur:Rt,select:Cr,clear:lr,resizeTextarea:pn}),(Ye,Jt)=>(vr(),vn("div",{class:Rn([At(i),{[At(he).bm("group","append")]:Ye.$slots.append,[At(he).bm("group","prepend")]:Ye.$slots.prepend}]),style:Cu(At(Zt)),onMouseenter:Yt,onMouseleave:jt},[qn(" input "),Ye.type!=="textarea"?(vr(),vn(ti,{key:0},[qn(" prepend slot "),Ye.$slots.prepend?(vr(),vn("div",{key:0,class:Rn(At(he).be("group","prepend"))},[sa(Ye.$slots,"prepend")],2)):qn("v-if",!0),wn("div",{ref_key:"wrapperRef",ref:tt,class:Rn(At(G))},[qn(" prefix slot "),Ye.$slots.prefix||Ye.prefixIcon?(vr(),vn("span",{key:0,class:Rn(At(he).e("prefix"))},[wn("span",{class:Rn(At(he).e("prefix-inner"))},[sa(Ye.$slots,"prefix"),Ye.prefixIcon?(vr(),Dn(At(Hs),{key:0,class:Rn(At(he).e("icon"))},{default:An(()=>[(vr(),Dn(uo(Ye.prefixIcon)))]),_:1},8,["class"])):qn("v-if",!0)],2)],2)):qn("v-if",!0),wn("input",Ks({id:At(ee),ref_key:"input",ref:Le,class:At(he).e("inner")},At(R),{minlength:Ye.minlength,maxlength:Ye.maxlength,type:Ye.showPassword?Dt.value?"text":"password":Ye.type,disabled:At(me),readonly:Ye.readonly,autocomplete:Ye.autocomplete,tabindex:Ye.tabindex,"aria-label":Ye.ariaLabel,placeholder:Ye.placeholder,style:Ye.inputStyle,form:Ye.form,autofocus:Ye.autofocus,role:Ye.containerRole,onCompositionstart:At(Ve),onCompositionupdate:At(Ae),onCompositionend:At(xt),onInput:te,onChange:mn,onKeydown:Gt}),null,16,["id","minlength","maxlength","type","disabled","readonly","autocomplete","tabindex","aria-label","placeholder","form","autofocus","role","onCompositionstart","onCompositionupdate","onCompositionend"]),qn(" suffix slot "),At($t)?(vr(),vn("span",{key:1,class:Rn(At(he).e("suffix"))},[wn("span",{class:Rn(At(he).e("suffix-inner"))},[!At(Nr)||!At(ar)||!At(Gr)?(vr(),vn(ti,{key:0},[sa(Ye.$slots,"suffix"),Ye.suffixIcon?(vr(),Dn(At(Hs),{key:0,class:Rn(At(he).e("icon"))},{default:An(()=>[(vr(),Dn(uo(Ye.suffixIcon)))]),_:1},8,["class"])):qn("v-if",!0)],64)):qn("v-if",!0),At(Nr)?(vr(),Dn(At(Hs),{key:1,class:Rn([At(he).e("icon"),At(he).e("clear")]),onMousedown:RM(At(mo),["prevent"]),onClick:lr},{default:An(()=>[dt(At(dI))]),_:1},8,["class","onMousedown"])):qn("v-if",!0),At(ar)?(vr(),Dn(At(Hs),{key:2,class:Rn([At(he).e("icon"),At(he).e("password")]),onClick:Vt},{default:An(()=>[(vr(),Dn(uo(At(zr))))]),_:1},8,["class"])):qn("v-if",!0),At(Gr)?(vr(),vn("span",{key:3,class:Rn(At(he).e("count"))},[wn("span",{class:Rn(At(he).e("count-inner"))},Zs(At(cr))+" / "+Zs(Ye.maxlength),3)],2)):qn("v-if",!0),At(yt)&&At(ir)&&At(gt)?(vr(),Dn(At(Hs),{key:4,class:Rn([At(he).e("icon"),At(he).e("validateIcon"),At(he).is("loading",At(yt)==="validating")])},{default:An(()=>[(vr(),Dn(uo(At(ir))))]),_:1},8,["class"])):qn("v-if",!0)],2)],2)):qn("v-if",!0)],2),qn(" append slot "),Ye.$slots.append?(vr(),vn("div",{key:1,class:Rn(At(he).be("group","append"))},[sa(Ye.$slots,"append")],2)):qn("v-if",!0)],64)):(vr(),vn(ti,{key:1},[qn(" textarea "),wn("textarea",Ks({id:At(ee),ref_key:"textarea",ref:je,class:[At(ye).e("inner"),At(he).is("focus",At(Et))]},At(R),{minlength:Ye.minlength,maxlength:Ye.maxlength,tabindex:Ye.tabindex,disabled:At(me),readonly:Ye.readonly,autocomplete:Ye.autocomplete,style:At(Ir),"aria-label":Ye.ariaLabel,placeholder:Ye.placeholder,form:Ye.form,autofocus:Ye.autofocus,rows:Ye.rows,role:Ye.containerRole,onCompositionstart:At(Ve),onCompositionupdate:At(Ae),onCompositionend:At(xt),onInput:te,onFocus:At(pt),onBlur:At(ot),onChange:mn,onKeydown:Gt}),null,16,["id","minlength","maxlength","tabindex","disabled","readonly","autocomplete","aria-label","placeholder","form","autofocus","rows","role","onCompositionstart","onCompositionupdate","onCompositionend","onFocus","onBlur"]),At(Gr)?(vr(),vn("span",{key:0,style:Cu(ut.value),class:Rn(At(he).e("count"))},Zs(At(cr))+" / "+Zs(Ye.maxlength),7)):qn("v-if",!0)],64))],38))}});var QF=wm(JF,[["__file","input.vue"]]);const e5=by(QF),gI=Symbol("buttonGroupContextKey"),t5=({from:n,replacement:c,scope:p,version:v,ref:I,type:R="API"},D)=>{zn(()=>At(D),i=>{},{immediate:!0})},r5=(n,c)=>{t5({from:"type.text",replacement:"link",version:"3.0.0",scope:"props",ref:"https://element-plus.org/en-US/component/button.html#button-attributes"},ct(()=>n.type==="text"));const p=Hn(gI,void 0),v=oF("button"),{form:I}=L1(),R=O1(ct(()=>p==null?void 0:p.size)),D=wy(),i=In(),G=QA(),X=ct(()=>n.type||(p==null?void 0:p.type)||""),q=ct(()=>{var he,ye,Le;return(Le=(ye=n.autoInsertSpace)!=null?ye:(he=v.value)==null?void 0:he.autoInsertSpace)!=null?Le:!1}),ee=ct(()=>n.tag==="button"?{ariaDisabled:D.value||n.loading,disabled:D.value||n.loading,autofocus:n.autofocus,type:n.nativeType}:{}),ne=ct(()=>{var he;const ye=(he=G.default)==null?void 0:he.call(G);if(q.value&&(ye==null?void 0:ye.length)===1){const Le=ye[0];if((Le==null?void 0:Le.type)===Md){const je=Le.children;return new RegExp("^\\p{Unified_Ideograph}{2}$","u").test(je.trim())}}return!1});return{_disabled:D,_size:R,_type:X,_ref:i,_props:ee,shouldAddSpace:ne,handleClick:he=>{if(D.value||n.loading){he.stopPropagation();return}n.nativeType==="reset"&&(I==null||I.resetFields()),c("click",he)}}},n5=["default","primary","success","warning","info","danger","text",""],i5=["button","submit","reset"],Dx=bm({size:uI,disabled:Boolean,type:{type:String,values:n5,default:""},icon:{type:fc},nativeType:{type:String,values:i5,default:"button"},loading:Boolean,loadingIcon:{type:fc,default:()=>D1},plain:Boolean,text:Boolean,link:Boolean,bg:Boolean,autofocus:Boolean,round:Boolean,circle:Boolean,color:String,dark:Boolean,autoInsertSpace:{type:Boolean,default:void 0},tag:{type:Au([String,Object]),default:"button"}}),s5={click:n=>n instanceof MouseEvent};function rs(n,c){o5(n)&&(n="100%");var p=a5(n);return n=c===360?n:Math.min(c,Math.max(0,parseFloat(n))),p&&(n=parseInt(String(n*c),10)/100),Math.abs(n-c)<1e-6?1:(c===360?n=(n<0?n%c+c:n%c)/parseFloat(String(c)):n=n%c/parseFloat(String(c)),n)}function xg(n){return Math.min(1,Math.max(0,n))}function o5(n){return typeof n=="string"&&n.indexOf(".")!==-1&&parseFloat(n)===1}function a5(n){return typeof n=="string"&&n.indexOf("%")!==-1}function yI(n){return n=parseFloat(n),(isNaN(n)||n<0||n>1)&&(n=1),n}function bg(n){return n<=1?"".concat(Number(n)*100,"%"):n}function wu(n){return n.length===1?"0"+n:String(n)}function l5(n,c,p){return{r:rs(n,255)*255,g:rs(c,255)*255,b:rs(p,255)*255}}function eE(n,c,p){n=rs(n,255),c=rs(c,255),p=rs(p,255);var v=Math.max(n,c,p),I=Math.min(n,c,p),R=0,D=0,i=(v+I)/2;if(v===I)D=0,R=0;else{var G=v-I;switch(D=i>.5?G/(2-v-I):G/(v+I),v){case n:R=(c-p)/G+(c<p?6:0);break;case c:R=(p-n)/G+2;break;case p:R=(n-c)/G+4;break}R/=6}return{h:R,s:D,l:i}}function sx(n,c,p){return p<0&&(p+=1),p>1&&(p-=1),p<1/6?n+(c-n)*(6*p):p<1/2?c:p<2/3?n+(c-n)*(2/3-p)*6:n}function c5(n,c,p){var v,I,R;if(n=rs(n,360),c=rs(c,100),p=rs(p,100),c===0)I=p,R=p,v=p;else{var D=p<.5?p*(1+c):p+c-p*c,i=2*p-D;v=sx(i,D,n+1/3),I=sx(i,D,n),R=sx(i,D,n-1/3)}return{r:v*255,g:I*255,b:R*255}}function tE(n,c,p){n=rs(n,255),c=rs(c,255),p=rs(p,255);var v=Math.max(n,c,p),I=Math.min(n,c,p),R=0,D=v,i=v-I,G=v===0?0:i/v;if(v===I)R=0;else{switch(v){case n:R=(c-p)/i+(c<p?6:0);break;case c:R=(p-n)/i+2;break;case p:R=(n-c)/i+4;break}R/=6}return{h:R,s:G,v:D}}function u5(n,c,p){n=rs(n,360)*6,c=rs(c,100),p=rs(p,100);var v=Math.floor(n),I=n-v,R=p*(1-c),D=p*(1-I*c),i=p*(1-(1-I)*c),G=v%6,X=[p,D,R,R,i,p][G],q=[i,p,p,D,R,R][G],ee=[R,R,i,p,p,D][G];return{r:X*255,g:q*255,b:ee*255}}function rE(n,c,p,v){var I=[wu(Math.round(n).toString(16)),wu(Math.round(c).toString(16)),wu(Math.round(p).toString(16))];return v&&I[0].startsWith(I[0].charAt(1))&&I[1].startsWith(I[1].charAt(1))&&I[2].startsWith(I[2].charAt(1))?I[0].charAt(0)+I[1].charAt(0)+I[2].charAt(0):I.join("")}function h5(n,c,p,v,I){var R=[wu(Math.round(n).toString(16)),wu(Math.round(c).toString(16)),wu(Math.round(p).toString(16)),wu(d5(v))];return I&&R[0].startsWith(R[0].charAt(1))&&R[1].startsWith(R[1].charAt(1))&&R[2].startsWith(R[2].charAt(1))&&R[3].startsWith(R[3].charAt(1))?R[0].charAt(0)+R[1].charAt(0)+R[2].charAt(0)+R[3].charAt(0):R.join("")}function d5(n){return Math.round(parseFloat(n)*255).toString(16)}function nE(n){return co(n)/255}function co(n){return parseInt(n,16)}function f5(n){return{r:n>>16,g:(n&65280)>>8,b:n&255}}var zx={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function p5(n){var c={r:0,g:0,b:0},p=1,v=null,I=null,R=null,D=!1,i=!1;return typeof n=="string"&&(n=g5(n)),typeof n=="object"&&(hl(n.r)&&hl(n.g)&&hl(n.b)?(c=l5(n.r,n.g,n.b),D=!0,i=String(n.r).substr(-1)==="%"?"prgb":"rgb"):hl(n.h)&&hl(n.s)&&hl(n.v)?(v=bg(n.s),I=bg(n.v),c=u5(n.h,v,I),D=!0,i="hsv"):hl(n.h)&&hl(n.s)&&hl(n.l)&&(v=bg(n.s),R=bg(n.l),c=c5(n.h,v,R),D=!0,i="hsl"),Object.prototype.hasOwnProperty.call(n,"a")&&(p=n.a)),p=yI(p),{ok:D,format:n.format||i,r:Math.min(255,Math.max(c.r,0)),g:Math.min(255,Math.max(c.g,0)),b:Math.min(255,Math.max(c.b,0)),a:p}}var m5="[-\\+]?\\d+%?",_5="[-\\+]?\\d*\\.\\d+%?",pc="(?:".concat(_5,")|(?:").concat(m5,")"),ox="[\\s|\\(]+(".concat(pc,")[,|\\s]+(").concat(pc,")[,|\\s]+(").concat(pc,")\\s*\\)?"),ax="[\\s|\\(]+(".concat(pc,")[,|\\s]+(").concat(pc,")[,|\\s]+(").concat(pc,")[,|\\s]+(").concat(pc,")\\s*\\)?"),ia={CSS_UNIT:new RegExp(pc),rgb:new RegExp("rgb"+ox),rgba:new RegExp("rgba"+ax),hsl:new RegExp("hsl"+ox),hsla:new RegExp("hsla"+ax),hsv:new RegExp("hsv"+ox),hsva:new RegExp("hsva"+ax),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function g5(n){if(n=n.trim().toLowerCase(),n.length===0)return!1;var c=!1;if(zx[n])n=zx[n],c=!0;else if(n==="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var p=ia.rgb.exec(n);return p?{r:p[1],g:p[2],b:p[3]}:(p=ia.rgba.exec(n),p?{r:p[1],g:p[2],b:p[3],a:p[4]}:(p=ia.hsl.exec(n),p?{h:p[1],s:p[2],l:p[3]}:(p=ia.hsla.exec(n),p?{h:p[1],s:p[2],l:p[3],a:p[4]}:(p=ia.hsv.exec(n),p?{h:p[1],s:p[2],v:p[3]}:(p=ia.hsva.exec(n),p?{h:p[1],s:p[2],v:p[3],a:p[4]}:(p=ia.hex8.exec(n),p?{r:co(p[1]),g:co(p[2]),b:co(p[3]),a:nE(p[4]),format:c?"name":"hex8"}:(p=ia.hex6.exec(n),p?{r:co(p[1]),g:co(p[2]),b:co(p[3]),format:c?"name":"hex"}:(p=ia.hex4.exec(n),p?{r:co(p[1]+p[1]),g:co(p[2]+p[2]),b:co(p[3]+p[3]),a:nE(p[4]+p[4]),format:c?"name":"hex8"}:(p=ia.hex3.exec(n),p?{r:co(p[1]+p[1]),g:co(p[2]+p[2]),b:co(p[3]+p[3]),format:c?"name":"hex"}:!1)))))))))}function hl(n){return!!ia.CSS_UNIT.exec(String(n))}var y5=function(){function n(c,p){c===void 0&&(c=""),p===void 0&&(p={});var v;if(c instanceof n)return c;typeof c=="number"&&(c=f5(c)),this.originalInput=c;var I=p5(c);this.originalInput=c,this.r=I.r,this.g=I.g,this.b=I.b,this.a=I.a,this.roundA=Math.round(100*this.a)/100,this.format=(v=p.format)!==null&&v!==void 0?v:I.format,this.gradientType=p.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=I.ok}return n.prototype.isDark=function(){return this.getBrightness()<128},n.prototype.isLight=function(){return!this.isDark()},n.prototype.getBrightness=function(){var c=this.toRgb();return(c.r*299+c.g*587+c.b*114)/1e3},n.prototype.getLuminance=function(){var c=this.toRgb(),p,v,I,R=c.r/255,D=c.g/255,i=c.b/255;return R<=.03928?p=R/12.92:p=Math.pow((R+.055)/1.055,2.4),D<=.03928?v=D/12.92:v=Math.pow((D+.055)/1.055,2.4),i<=.03928?I=i/12.92:I=Math.pow((i+.055)/1.055,2.4),.2126*p+.7152*v+.0722*I},n.prototype.getAlpha=function(){return this.a},n.prototype.setAlpha=function(c){return this.a=yI(c),this.roundA=Math.round(100*this.a)/100,this},n.prototype.isMonochrome=function(){var c=this.toHsl().s;return c===0},n.prototype.toHsv=function(){var c=tE(this.r,this.g,this.b);return{h:c.h*360,s:c.s,v:c.v,a:this.a}},n.prototype.toHsvString=function(){var c=tE(this.r,this.g,this.b),p=Math.round(c.h*360),v=Math.round(c.s*100),I=Math.round(c.v*100);return this.a===1?"hsv(".concat(p,", ").concat(v,"%, ").concat(I,"%)"):"hsva(".concat(p,", ").concat(v,"%, ").concat(I,"%, ").concat(this.roundA,")")},n.prototype.toHsl=function(){var c=eE(this.r,this.g,this.b);return{h:c.h*360,s:c.s,l:c.l,a:this.a}},n.prototype.toHslString=function(){var c=eE(this.r,this.g,this.b),p=Math.round(c.h*360),v=Math.round(c.s*100),I=Math.round(c.l*100);return this.a===1?"hsl(".concat(p,", ").concat(v,"%, ").concat(I,"%)"):"hsla(".concat(p,", ").concat(v,"%, ").concat(I,"%, ").concat(this.roundA,")")},n.prototype.toHex=function(c){return c===void 0&&(c=!1),rE(this.r,this.g,this.b,c)},n.prototype.toHexString=function(c){return c===void 0&&(c=!1),"#"+this.toHex(c)},n.prototype.toHex8=function(c){return c===void 0&&(c=!1),h5(this.r,this.g,this.b,this.a,c)},n.prototype.toHex8String=function(c){return c===void 0&&(c=!1),"#"+this.toHex8(c)},n.prototype.toHexShortString=function(c){return c===void 0&&(c=!1),this.a===1?this.toHexString(c):this.toHex8String(c)},n.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},n.prototype.toRgbString=function(){var c=Math.round(this.r),p=Math.round(this.g),v=Math.round(this.b);return this.a===1?"rgb(".concat(c,", ").concat(p,", ").concat(v,")"):"rgba(".concat(c,", ").concat(p,", ").concat(v,", ").concat(this.roundA,")")},n.prototype.toPercentageRgb=function(){var c=function(p){return"".concat(Math.round(rs(p,255)*100),"%")};return{r:c(this.r),g:c(this.g),b:c(this.b),a:this.a}},n.prototype.toPercentageRgbString=function(){var c=function(p){return Math.round(rs(p,255)*100)};return this.a===1?"rgb(".concat(c(this.r),"%, ").concat(c(this.g),"%, ").concat(c(this.b),"%)"):"rgba(".concat(c(this.r),"%, ").concat(c(this.g),"%, ").concat(c(this.b),"%, ").concat(this.roundA,")")},n.prototype.toName=function(){if(this.a===0)return"transparent";if(this.a<1)return!1;for(var c="#"+rE(this.r,this.g,this.b,!1),p=0,v=Object.entries(zx);p<v.length;p++){var I=v[p],R=I[0],D=I[1];if(c===D)return R}return!1},n.prototype.toString=function(c){var p=!!c;c=c??this.format;var v=!1,I=this.a<1&&this.a>=0,R=!p&&I&&(c.startsWith("hex")||c==="name");return R?c==="name"&&this.a===0?this.toName():this.toRgbString():(c==="rgb"&&(v=this.toRgbString()),c==="prgb"&&(v=this.toPercentageRgbString()),(c==="hex"||c==="hex6")&&(v=this.toHexString()),c==="hex3"&&(v=this.toHexString(!0)),c==="hex4"&&(v=this.toHex8String(!0)),c==="hex8"&&(v=this.toHex8String()),c==="name"&&(v=this.toName()),c==="hsl"&&(v=this.toHslString()),c==="hsv"&&(v=this.toHsvString()),v||this.toHexString())},n.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},n.prototype.clone=function(){return new n(this.toString())},n.prototype.lighten=function(c){c===void 0&&(c=10);var p=this.toHsl();return p.l+=c/100,p.l=xg(p.l),new n(p)},n.prototype.brighten=function(c){c===void 0&&(c=10);var p=this.toRgb();return p.r=Math.max(0,Math.min(255,p.r-Math.round(255*-(c/100)))),p.g=Math.max(0,Math.min(255,p.g-Math.round(255*-(c/100)))),p.b=Math.max(0,Math.min(255,p.b-Math.round(255*-(c/100)))),new n(p)},n.prototype.darken=function(c){c===void 0&&(c=10);var p=this.toHsl();return p.l-=c/100,p.l=xg(p.l),new n(p)},n.prototype.tint=function(c){return c===void 0&&(c=10),this.mix("white",c)},n.prototype.shade=function(c){return c===void 0&&(c=10),this.mix("black",c)},n.prototype.desaturate=function(c){c===void 0&&(c=10);var p=this.toHsl();return p.s-=c/100,p.s=xg(p.s),new n(p)},n.prototype.saturate=function(c){c===void 0&&(c=10);var p=this.toHsl();return p.s+=c/100,p.s=xg(p.s),new n(p)},n.prototype.greyscale=function(){return this.desaturate(100)},n.prototype.spin=function(c){var p=this.toHsl(),v=(p.h+c)%360;return p.h=v<0?360+v:v,new n(p)},n.prototype.mix=function(c,p){p===void 0&&(p=50);var v=this.toRgb(),I=new n(c).toRgb(),R=p/100,D={r:(I.r-v.r)*R+v.r,g:(I.g-v.g)*R+v.g,b:(I.b-v.b)*R+v.b,a:(I.a-v.a)*R+v.a};return new n(D)},n.prototype.analogous=function(c,p){c===void 0&&(c=6),p===void 0&&(p=30);var v=this.toHsl(),I=360/p,R=[this];for(v.h=(v.h-(I*c>>1)+720)%360;--c;)v.h=(v.h+I)%360,R.push(new n(v));return R},n.prototype.complement=function(){var c=this.toHsl();return c.h=(c.h+180)%360,new n(c)},n.prototype.monochromatic=function(c){c===void 0&&(c=6);for(var p=this.toHsv(),v=p.h,I=p.s,R=p.v,D=[],i=1/c;c--;)D.push(new n({h:v,s:I,v:R})),R=(R+i)%1;return D},n.prototype.splitcomplement=function(){var c=this.toHsl(),p=c.h;return[this,new n({h:(p+72)%360,s:c.s,l:c.l}),new n({h:(p+216)%360,s:c.s,l:c.l})]},n.prototype.onBackground=function(c){var p=this.toRgb(),v=new n(c).toRgb(),I=p.a+v.a*(1-p.a);return new n({r:(p.r*p.a+v.r*v.a*(1-p.a))/I,g:(p.g*p.a+v.g*v.a*(1-p.a))/I,b:(p.b*p.a+v.b*v.a*(1-p.a))/I,a:I})},n.prototype.triad=function(){return this.polyad(3)},n.prototype.tetrad=function(){return this.polyad(4)},n.prototype.polyad=function(c){for(var p=this.toHsl(),v=p.h,I=[this],R=360/c,D=1;D<c;D++)I.push(new n({h:(v+D*R)%360,s:p.s,l:p.l}));return I},n.prototype.equals=function(c){return this.toRgbString()===new n(c).toRgbString()},n}();function oc(n,c=20){return n.mix("#141414",c).toString()}function v5(n){const c=wy(),p=Du("button");return ct(()=>{let v={},I=n.color;if(I){const R=I.match(/var\((.*?)\)/);R&&(I=window.getComputedStyle(window.document.documentElement).getPropertyValue(R[1]));const D=new y5(I),i=n.dark?D.tint(20).toString():oc(D,20);if(n.plain)v=p.cssVarBlock({"bg-color":n.dark?oc(D,90):D.tint(90).toString(),"text-color":I,"border-color":n.dark?oc(D,50):D.tint(50).toString(),"hover-text-color":`var(${p.cssVarName("color-white")})`,"hover-bg-color":I,"hover-border-color":I,"active-bg-color":i,"active-text-color":`var(${p.cssVarName("color-white")})`,"active-border-color":i}),c.value&&(v[p.cssVarBlockName("disabled-bg-color")]=n.dark?oc(D,90):D.tint(90).toString(),v[p.cssVarBlockName("disabled-text-color")]=n.dark?oc(D,50):D.tint(50).toString(),v[p.cssVarBlockName("disabled-border-color")]=n.dark?oc(D,80):D.tint(80).toString());else{const G=n.dark?oc(D,30):D.tint(30).toString(),X=D.isDark()?`var(${p.cssVarName("color-white")})`:`var(${p.cssVarName("color-black")})`;if(v=p.cssVarBlock({"bg-color":I,"text-color":X,"border-color":I,"hover-bg-color":G,"hover-text-color":X,"hover-border-color":G,"active-bg-color":i,"active-border-color":i}),c.value){const q=n.dark?oc(D,50):D.tint(50).toString();v[p.cssVarBlockName("disabled-bg-color")]=q,v[p.cssVarBlockName("disabled-text-color")]=n.dark?"rgba(255, 255, 255, 0.5)":`var(${p.cssVarName("color-white")})`,v[p.cssVarBlockName("disabled-border-color")]=q}}}return v})}const x5=ei({name:"ElButton"}),b5=ei({...x5,props:Dx,emits:s5,setup(n,{expose:c,emit:p}){const v=n,I=v5(v),R=Du("button"),{_ref:D,_size:i,_type:G,_disabled:X,_props:q,shouldAddSpace:ee,handleClick:ne}=r5(v,p),me=ct(()=>[R.b(),R.m(G.value),R.m(i.value),R.is("disabled",X.value),R.is("loading",v.loading),R.is("plain",v.plain),R.is("round",v.round),R.is("circle",v.circle),R.is("text",v.text),R.is("link",v.link),R.is("has-bg",v.bg)]);return c({ref:D,size:i,type:G,disabled:X,shouldAddSpace:ee}),(he,ye)=>(vr(),Dn(uo(he.tag),Ks({ref_key:"_ref",ref:D},At(q),{class:At(me),style:At(I),onClick:At(ne)}),{default:An(()=>[he.loading?(vr(),vn(ti,{key:0},[he.$slots.loading?sa(he.$slots,"loading",{key:0}):(vr(),Dn(At(Hs),{key:1,class:Rn(At(R).is("loading"))},{default:An(()=>[(vr(),Dn(uo(he.loadingIcon)))]),_:1},8,["class"]))],64)):he.icon||he.$slots.icon?(vr(),Dn(At(Hs),{key:1},{default:An(()=>[he.icon?(vr(),Dn(uo(he.icon),{key:0})):sa(he.$slots,"icon",{key:1})]),_:3})):qn("v-if",!0),he.$slots.default?(vr(),vn("span",{key:2,class:Rn({[At(R).em("text","expand")]:At(ee)})},[sa(he.$slots,"default")],2)):qn("v-if",!0)]),_:3},16,["class","style","onClick"]))}});var w5=wm(b5,[["__file","button.vue"]]);const T5={size:Dx.size,type:Dx.type},S5=ei({name:"ElButtonGroup"}),E5=ei({...S5,props:T5,setup(n){const c=n;ko(gI,Zi({size:ps(c,"size"),type:ps(c,"type")}));const p=Du("button");return(v,I)=>(vr(),vn("div",{class:Rn(At(p).b("group"))},[sa(v.$slots,"default")],2))}});var vI=wm(E5,[["__file","button-group.vue"]]);const A5=by(w5,{ButtonGroup:vI});aF(vI);function M5(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}const I5=n=>["",...cI].includes(n),C5=bm({modelValue:{type:[Boolean,String,Number],default:!1},disabled:Boolean,loading:Boolean,size:{type:String,validator:I5},width:{type:[String,Number],default:""},inlinePrompt:Boolean,inactiveActionIcon:{type:fc},activeActionIcon:{type:fc},activeIcon:{type:fc},inactiveIcon:{type:fc},activeText:{type:String,default:""},inactiveText:{type:String,default:""},activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},name:{type:String,default:""},validateEvent:{type:Boolean,default:!0},beforeChange:{type:Au(Function)},id:String,tabindex:{type:[String,Number]},...fI(["ariaLabel"])}),P5={[Sd]:n=>Rg(n)||jn(n)||vd(n),[am]:n=>Rg(n)||jn(n)||vd(n),[lm]:n=>Rg(n)||jn(n)||vd(n)},xI="ElSwitch",R5=ei({name:xI}),D5=ei({...R5,props:C5,emits:P5,setup(n,{expose:c,emit:p}){const v=n,{formItem:I}=L1(),R=O1(),D=Du("switch"),{inputId:i}=mI(v,{formItemContext:I}),G=wy(ct(()=>v.loading)),X=In(v.modelValue!==!1),q=In(),ee=In(),ne=ct(()=>[D.b(),D.m(R.value),D.is("disabled",G.value),D.is("checked",je.value)]),me=ct(()=>[D.e("label"),D.em("label","left"),D.is("active",!je.value)]),he=ct(()=>[D.e("label"),D.em("label","right"),D.is("active",je.value)]),ye=ct(()=>({width:hI(v.width)}));zn(()=>v.modelValue,()=>{X.value=!0});const Le=ct(()=>X.value?v.modelValue:!1),je=ct(()=>Le.value===v.activeValue);[v.activeValue,v.inactiveValue].includes(Le.value)||(p(Sd,v.inactiveValue),p(am,v.inactiveValue),p(lm,v.inactiveValue)),zn(je,ht=>{var St;q.value.checked=ht,v.validateEvent&&((St=I==null?void 0:I.validate)==null||St.call(I,"change").catch(tt=>void 0))});const vt=()=>{const ht=je.value?v.inactiveValue:v.activeValue;p(Sd,ht),p(am,ht),p(lm,ht),Ws(()=>{q.value.checked=je.value})},Dt=()=>{if(G.value)return;const{beforeChange:ht}=v;if(!ht){vt();return}const St=ht();[Fg(St),Rg(St)].includes(!0)||rF(xI,"beforeChange must return type `Promise<boolean>` or `boolean`"),Fg(St)?St.then(Et=>{Et&&vt()}).catch(Et=>{}):St&&vt()},ut=()=>{var ht,St;(St=(ht=q.value)==null?void 0:ht.focus)==null||St.call(ht)};return ua(()=>{q.value.checked=je.value}),c({focus:ut,checked:je}),(ht,St)=>(vr(),vn("div",{class:Rn(At(ne)),onClick:RM(Dt,["prevent"])},[wn("input",{id:At(i),ref_key:"input",ref:q,class:Rn(At(D).e("input")),type:"checkbox",role:"switch","aria-checked":At(je),"aria-disabled":At(G),"aria-label":ht.ariaLabel,name:ht.name,"true-value":ht.activeValue,"false-value":ht.inactiveValue,disabled:At(G),tabindex:ht.tabindex,onChange:vt,onKeydown:fL(Dt,["enter"])},null,42,["id","aria-checked","aria-disabled","aria-label","name","true-value","false-value","disabled","tabindex","onKeydown"]),!ht.inlinePrompt&&(ht.inactiveIcon||ht.inactiveText)?(vr(),vn("span",{key:0,class:Rn(At(me))},[ht.inactiveIcon?(vr(),Dn(At(Hs),{key:0},{default:An(()=>[(vr(),Dn(uo(ht.inactiveIcon)))]),_:1})):qn("v-if",!0),!ht.inactiveIcon&&ht.inactiveText?(vr(),vn("span",{key:1,"aria-hidden":At(je)},Zs(ht.inactiveText),9,["aria-hidden"])):qn("v-if",!0)],2)):qn("v-if",!0),wn("span",{ref_key:"core",ref:ee,class:Rn(At(D).e("core")),style:Cu(At(ye))},[ht.inlinePrompt?(vr(),vn("div",{key:0,class:Rn(At(D).e("inner"))},[ht.activeIcon||ht.inactiveIcon?(vr(),Dn(At(Hs),{key:0,class:Rn(At(D).is("icon"))},{default:An(()=>[(vr(),Dn(uo(At(je)?ht.activeIcon:ht.inactiveIcon)))]),_:1},8,["class"])):ht.activeText||ht.inactiveText?(vr(),vn("span",{key:1,class:Rn(At(D).is("text")),"aria-hidden":!At(je)},Zs(At(je)?ht.activeText:ht.inactiveText),11,["aria-hidden"])):qn("v-if",!0)],2)):qn("v-if",!0),wn("div",{class:Rn(At(D).e("action"))},[ht.loading?(vr(),Dn(At(Hs),{key:0,class:Rn(At(D).is("loading"))},{default:An(()=>[dt(At(D1))]),_:1},8,["class"])):At(je)?sa(ht.$slots,"active-action",{key:1},()=>[ht.activeActionIcon?(vr(),Dn(At(Hs),{key:0},{default:An(()=>[(vr(),Dn(uo(ht.activeActionIcon)))]),_:1})):qn("v-if",!0)]):At(je)?qn("v-if",!0):sa(ht.$slots,"inactive-action",{key:2},()=>[ht.inactiveActionIcon?(vr(),Dn(At(Hs),{key:0},{default:An(()=>[(vr(),Dn(uo(ht.inactiveActionIcon)))]),_:1})):qn("v-if",!0)])],2)],6),!ht.inlinePrompt&&(ht.activeIcon||ht.activeText)?(vr(),vn("span",{key:1,class:Rn(At(he))},[ht.activeIcon?(vr(),Dn(At(Hs),{key:0},{default:An(()=>[(vr(),Dn(uo(ht.activeIcon)))]),_:1})):qn("v-if",!0),!ht.activeIcon&&ht.activeText?(vr(),vn("span",{key:1,"aria-hidden":!At(je)},Zs(ht.activeText),9,["aria-hidden"])):qn("v-if",!0)],2)):qn("v-if",!0)],10,["onClick"]))}});var z5=wm(D5,[["__file","switch.vue"]]);const L5=by(z5),O5=kM("main",{state:()=>({drawer:!0})});var Dg={exports:{}},k5=Dg.exports,iE;function F5(){return iE||(iE=1,function(n,c){(function(p,v){n.exports=v()})(k5,function(){var p,v,I;function R(i,G){if(!p)p=G;else if(!v)v=G;else{var X="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+p+")(sharedChunk); ("+v+")(sharedChunk); self.onerror = null;",q={};p(q),I=G(q),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(I.workerUrl=window.URL.createObjectURL(new Blob([X],{type:"text/javascript"})))}}R(["exports"],function(i){function G(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var X,q={},ee={};function ne(){if(X)return ee;X=1,Object.defineProperty(ee,"__esModule",{value:!0}),ee.setMatrixArrayType=function(u){ee.ARRAY_TYPE=e=u},ee.toRadian=function(u){return u*a},ee.equals=function(u,l){return Math.abs(u-l)<=o*Math.max(1,Math.abs(u),Math.abs(l))},ee.RANDOM=ee.ARRAY_TYPE=ee.EPSILON=void 0;var o=1e-6;ee.EPSILON=o;var e=typeof Float32Array<"u"?Float32Array:Array;ee.ARRAY_TYPE=e;var r=Math.random;ee.RANDOM=r;var a=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var u=0,l=arguments.length;l--;)u+=arguments[l]*arguments[l];return Math.sqrt(u)}),ee}var me,he={};function ye(){if(me)return he;function o(l){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},o(l)}me=1,Object.defineProperty(he,"__esModule",{value:!0}),he.create=function(){var l=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l},he.clone=function(l){var f=new e.ARRAY_TYPE(4);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f},he.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l},he.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l},he.fromValues=function(l,f,y,b){var S=new e.ARRAY_TYPE(4);return S[0]=l,S[1]=f,S[2]=y,S[3]=b,S},he.set=function(l,f,y,b,S){return l[0]=f,l[1]=y,l[2]=b,l[3]=S,l},he.transpose=function(l,f){if(l===f){var y=f[1];l[1]=f[2],l[2]=y}else l[0]=f[0],l[1]=f[2],l[2]=f[1],l[3]=f[3];return l},he.invert=function(l,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=y*_-S*b;return w?(l[0]=_*(w=1/w),l[1]=-b*w,l[2]=-S*w,l[3]=y*w,l):null},he.adjoint=function(l,f){var y=f[0];return l[0]=f[3],l[1]=-f[1],l[2]=-f[2],l[3]=y,l},he.determinant=function(l){return l[0]*l[3]-l[2]*l[1]},he.multiply=a,he.rotate=function(l,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],A=Math.sin(y),T=Math.cos(y);return l[0]=b*T+_*A,l[1]=S*T+w*A,l[2]=b*-A+_*T,l[3]=S*-A+w*T,l},he.scale=function(l,f,y){var b=f[1],S=f[2],_=f[3],w=y[0],A=y[1];return l[0]=f[0]*w,l[1]=b*w,l[2]=S*A,l[3]=_*A,l},he.fromRotation=function(l,f){var y=Math.sin(f),b=Math.cos(f);return l[0]=b,l[1]=y,l[2]=-y,l[3]=b,l},he.fromScaling=function(l,f){return l[0]=f[0],l[1]=0,l[2]=0,l[3]=f[1],l},he.str=function(l){return"mat2("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")"},he.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3])},he.LDU=function(l,f,y,b){return l[2]=b[2]/b[0],y[0]=b[0],y[1]=b[1],y[3]=b[3]-l[2]*y[1],[l,f,y]},he.add=function(l,f,y){return l[0]=f[0]+y[0],l[1]=f[1]+y[1],l[2]=f[2]+y[2],l[3]=f[3]+y[3],l},he.subtract=u,he.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]},he.equals=function(l,f){var y=l[0],b=l[1],S=l[2],_=l[3],w=f[0],A=f[1],T=f[2],E=f[3];return Math.abs(y-w)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(w))&&Math.abs(b-A)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(A))&&Math.abs(S-T)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(T))&&Math.abs(_-E)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(E))},he.multiplyScalar=function(l,f,y){return l[0]=f[0]*y,l[1]=f[1]*y,l[2]=f[2]*y,l[3]=f[3]*y,l},he.multiplyScalarAndAdd=function(l,f,y,b){return l[0]=f[0]+y[0]*b,l[1]=f[1]+y[1]*b,l[2]=f[2]+y[2]*b,l[3]=f[3]+y[3]*b,l},he.sub=he.mul=void 0;var e=function(l,f){if(l&&l.__esModule)return l;if(l===null||o(l)!=="object"&&typeof l!="function")return{default:l};var y=r(void 0);if(y&&y.has(l))return y.get(l);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in l)if(_!=="default"&&Object.prototype.hasOwnProperty.call(l,_)){var w=S?Object.getOwnPropertyDescriptor(l,_):null;w&&(w.get||w.set)?Object.defineProperty(b,_,w):b[_]=l[_]}return b.default=l,y&&y.set(l,b),b}(ne());function r(l){if(typeof WeakMap!="function")return null;var f=new WeakMap,y=new WeakMap;return(r=function(b){return b?y:f})(l)}function a(l,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],A=y[0],T=y[1],E=y[2],C=y[3];return l[0]=b*A+_*T,l[1]=S*A+w*T,l[2]=b*E+_*C,l[3]=S*E+w*C,l}function u(l,f,y){return l[0]=f[0]-y[0],l[1]=f[1]-y[1],l[2]=f[2]-y[2],l[3]=f[3]-y[3],l}return he.mul=a,he.sub=u,he}var Le,je={};function vt(){if(Le)return je;function o(l){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},o(l)}Le=1,Object.defineProperty(je,"__esModule",{value:!0}),je.create=function(){var l=new e.ARRAY_TYPE(6);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[4]=0,l[5]=0),l[0]=1,l[3]=1,l},je.clone=function(l){var f=new e.ARRAY_TYPE(6);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f},je.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l},je.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=0,l[5]=0,l},je.fromValues=function(l,f,y,b,S,_){var w=new e.ARRAY_TYPE(6);return w[0]=l,w[1]=f,w[2]=y,w[3]=b,w[4]=S,w[5]=_,w},je.set=function(l,f,y,b,S,_,w){return l[0]=f,l[1]=y,l[2]=b,l[3]=S,l[4]=_,l[5]=w,l},je.invert=function(l,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],A=f[5],T=y*_-b*S;return T?(l[0]=_*(T=1/T),l[1]=-b*T,l[2]=-S*T,l[3]=y*T,l[4]=(S*A-_*w)*T,l[5]=(b*w-y*A)*T,l):null},je.determinant=function(l){return l[0]*l[3]-l[1]*l[2]},je.multiply=a,je.rotate=function(l,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],A=f[4],T=f[5],E=Math.sin(y),C=Math.cos(y);return l[0]=b*C+_*E,l[1]=S*C+w*E,l[2]=b*-E+_*C,l[3]=S*-E+w*C,l[4]=A,l[5]=T,l},je.scale=function(l,f,y){var b=f[1],S=f[2],_=f[3],w=f[4],A=f[5],T=y[0],E=y[1];return l[0]=f[0]*T,l[1]=b*T,l[2]=S*E,l[3]=_*E,l[4]=w,l[5]=A,l},je.translate=function(l,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],A=f[4],T=f[5],E=y[0],C=y[1];return l[0]=b,l[1]=S,l[2]=_,l[3]=w,l[4]=b*E+_*C+A,l[5]=S*E+w*C+T,l},je.fromRotation=function(l,f){var y=Math.sin(f),b=Math.cos(f);return l[0]=b,l[1]=y,l[2]=-y,l[3]=b,l[4]=0,l[5]=0,l},je.fromScaling=function(l,f){return l[0]=f[0],l[1]=0,l[2]=0,l[3]=f[1],l[4]=0,l[5]=0,l},je.fromTranslation=function(l,f){return l[0]=1,l[1]=0,l[2]=0,l[3]=1,l[4]=f[0],l[5]=f[1],l},je.str=function(l){return"mat2d("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+")"},je.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],1)},je.add=function(l,f,y){return l[0]=f[0]+y[0],l[1]=f[1]+y[1],l[2]=f[2]+y[2],l[3]=f[3]+y[3],l[4]=f[4]+y[4],l[5]=f[5]+y[5],l},je.subtract=u,je.multiplyScalar=function(l,f,y){return l[0]=f[0]*y,l[1]=f[1]*y,l[2]=f[2]*y,l[3]=f[3]*y,l[4]=f[4]*y,l[5]=f[5]*y,l},je.multiplyScalarAndAdd=function(l,f,y,b){return l[0]=f[0]+y[0]*b,l[1]=f[1]+y[1]*b,l[2]=f[2]+y[2]*b,l[3]=f[3]+y[3]*b,l[4]=f[4]+y[4]*b,l[5]=f[5]+y[5]*b,l},je.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]&&l[4]===f[4]&&l[5]===f[5]},je.equals=function(l,f){var y=l[0],b=l[1],S=l[2],_=l[3],w=l[4],A=l[5],T=f[0],E=f[1],C=f[2],O=f[3],k=f[4],U=f[5];return Math.abs(y-T)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(T))&&Math.abs(b-E)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(S-C)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(C))&&Math.abs(_-O)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(O))&&Math.abs(w-k)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(k))&&Math.abs(A-U)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(U))},je.sub=je.mul=void 0;var e=function(l,f){if(l&&l.__esModule)return l;if(l===null||o(l)!=="object"&&typeof l!="function")return{default:l};var y=r(void 0);if(y&&y.has(l))return y.get(l);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in l)if(_!=="default"&&Object.prototype.hasOwnProperty.call(l,_)){var w=S?Object.getOwnPropertyDescriptor(l,_):null;w&&(w.get||w.set)?Object.defineProperty(b,_,w):b[_]=l[_]}return b.default=l,y&&y.set(l,b),b}(ne());function r(l){if(typeof WeakMap!="function")return null;var f=new WeakMap,y=new WeakMap;return(r=function(b){return b?y:f})(l)}function a(l,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],A=f[4],T=f[5],E=y[0],C=y[1],O=y[2],k=y[3],U=y[4],V=y[5];return l[0]=b*E+_*C,l[1]=S*E+w*C,l[2]=b*O+_*k,l[3]=S*O+w*k,l[4]=b*U+_*V+A,l[5]=S*U+w*V+T,l}function u(l,f,y){return l[0]=f[0]-y[0],l[1]=f[1]-y[1],l[2]=f[2]-y[2],l[3]=f[3]-y[3],l[4]=f[4]-y[4],l[5]=f[5]-y[5],l}return je.mul=a,je.sub=u,je}var Dt,ut={};function ht(){if(Dt)return ut;function o(l){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},o(l)}Dt=1,Object.defineProperty(ut,"__esModule",{value:!0}),ut.create=function(){var l=new e.ARRAY_TYPE(9);return e.ARRAY_TYPE!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1,l},ut.fromMat4=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[4],l[4]=f[5],l[5]=f[6],l[6]=f[8],l[7]=f[9],l[8]=f[10],l},ut.clone=function(l){var f=new e.ARRAY_TYPE(9);return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[8]=l[8],f},ut.copy=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l},ut.fromValues=function(l,f,y,b,S,_,w,A,T){var E=new e.ARRAY_TYPE(9);return E[0]=l,E[1]=f,E[2]=y,E[3]=b,E[4]=S,E[5]=_,E[6]=w,E[7]=A,E[8]=T,E},ut.set=function(l,f,y,b,S,_,w,A,T,E){return l[0]=f,l[1]=y,l[2]=b,l[3]=S,l[4]=_,l[5]=w,l[6]=A,l[7]=T,l[8]=E,l},ut.identity=function(l){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},ut.transpose=function(l,f){if(l===f){var y=f[1],b=f[2],S=f[5];l[1]=f[3],l[2]=f[6],l[3]=y,l[5]=f[7],l[6]=b,l[7]=S}else l[0]=f[0],l[1]=f[3],l[2]=f[6],l[3]=f[1],l[4]=f[4],l[5]=f[7],l[6]=f[2],l[7]=f[5],l[8]=f[8];return l},ut.invert=function(l,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],A=f[5],T=f[6],E=f[7],C=f[8],O=C*w-A*E,k=-C*_+A*T,U=E*_-w*T,V=y*O+b*k+S*U;return V?(l[0]=O*(V=1/V),l[1]=(-C*b+S*E)*V,l[2]=(A*b-S*w)*V,l[3]=k*V,l[4]=(C*y-S*T)*V,l[5]=(-A*y+S*_)*V,l[6]=U*V,l[7]=(-E*y+b*T)*V,l[8]=(w*y-b*_)*V,l):null},ut.adjoint=function(l,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],A=f[5],T=f[6],E=f[7],C=f[8];return l[0]=w*C-A*E,l[1]=S*E-b*C,l[2]=b*A-S*w,l[3]=A*T-_*C,l[4]=y*C-S*T,l[5]=S*_-y*A,l[6]=_*E-w*T,l[7]=b*T-y*E,l[8]=y*w-b*_,l},ut.determinant=function(l){var f=l[3],y=l[4],b=l[5],S=l[6],_=l[7],w=l[8];return l[0]*(w*y-b*_)+l[1]*(-w*f+b*S)+l[2]*(_*f-y*S)},ut.multiply=a,ut.translate=function(l,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],A=f[4],T=f[5],E=f[6],C=f[7],O=f[8],k=y[0],U=y[1];return l[0]=b,l[1]=S,l[2]=_,l[3]=w,l[4]=A,l[5]=T,l[6]=k*b+U*w+E,l[7]=k*S+U*A+C,l[8]=k*_+U*T+O,l},ut.rotate=function(l,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],A=f[4],T=f[5],E=f[6],C=f[7],O=f[8],k=Math.sin(y),U=Math.cos(y);return l[0]=U*b+k*w,l[1]=U*S+k*A,l[2]=U*_+k*T,l[3]=U*w-k*b,l[4]=U*A-k*S,l[5]=U*T-k*_,l[6]=E,l[7]=C,l[8]=O,l},ut.scale=function(l,f,y){var b=y[0],S=y[1];return l[0]=b*f[0],l[1]=b*f[1],l[2]=b*f[2],l[3]=S*f[3],l[4]=S*f[4],l[5]=S*f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l},ut.fromTranslation=function(l,f){return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=f[0],l[7]=f[1],l[8]=1,l},ut.fromRotation=function(l,f){var y=Math.sin(f),b=Math.cos(f);return l[0]=b,l[1]=y,l[2]=0,l[3]=-y,l[4]=b,l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},ut.fromScaling=function(l,f){return l[0]=f[0],l[1]=0,l[2]=0,l[3]=0,l[4]=f[1],l[5]=0,l[6]=0,l[7]=0,l[8]=1,l},ut.fromMat2d=function(l,f){return l[0]=f[0],l[1]=f[1],l[2]=0,l[3]=f[2],l[4]=f[3],l[5]=0,l[6]=f[4],l[7]=f[5],l[8]=1,l},ut.fromQuat=function(l,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=y+y,A=b+b,T=S+S,E=y*w,C=b*w,O=b*A,k=S*w,U=S*A,V=S*T,N=_*w,$=_*A,W=_*T;return l[0]=1-O-V,l[3]=C-W,l[6]=k+$,l[1]=C+W,l[4]=1-E-V,l[7]=U-N,l[2]=k-$,l[5]=U+N,l[8]=1-E-O,l},ut.normalFromMat4=function(l,f){var y=f[0],b=f[1],S=f[2],_=f[3],w=f[4],A=f[5],T=f[6],E=f[7],C=f[8],O=f[9],k=f[10],U=f[11],V=f[12],N=f[13],$=f[14],W=f[15],K=y*A-b*w,ae=y*T-S*w,ie=y*E-_*w,se=b*T-S*A,ve=b*E-_*A,le=S*E-_*T,xe=C*N-O*V,Me=C*$-k*V,Se=C*W-U*V,Ce=O*$-k*N,Ie=O*W-U*N,Fe=k*W-U*$,ze=K*Fe-ae*Ie+ie*Ce+se*Se-ve*Me+le*xe;return ze?(l[0]=(A*Fe-T*Ie+E*Ce)*(ze=1/ze),l[1]=(T*Se-w*Fe-E*Me)*ze,l[2]=(w*Ie-A*Se+E*xe)*ze,l[3]=(S*Ie-b*Fe-_*Ce)*ze,l[4]=(y*Fe-S*Se+_*Me)*ze,l[5]=(b*Se-y*Ie-_*xe)*ze,l[6]=(N*le-$*ve+W*se)*ze,l[7]=($*ie-V*le-W*ae)*ze,l[8]=(V*ve-N*ie+W*K)*ze,l):null},ut.projection=function(l,f,y){return l[0]=2/f,l[1]=0,l[2]=0,l[3]=0,l[4]=-2/y,l[5]=0,l[6]=-1,l[7]=1,l[8]=1,l},ut.str=function(l){return"mat3("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+", "+l[4]+", "+l[5]+", "+l[6]+", "+l[7]+", "+l[8]+")"},ut.frob=function(l){return Math.hypot(l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],l[8])},ut.add=function(l,f,y){return l[0]=f[0]+y[0],l[1]=f[1]+y[1],l[2]=f[2]+y[2],l[3]=f[3]+y[3],l[4]=f[4]+y[4],l[5]=f[5]+y[5],l[6]=f[6]+y[6],l[7]=f[7]+y[7],l[8]=f[8]+y[8],l},ut.subtract=u,ut.multiplyScalar=function(l,f,y){return l[0]=f[0]*y,l[1]=f[1]*y,l[2]=f[2]*y,l[3]=f[3]*y,l[4]=f[4]*y,l[5]=f[5]*y,l[6]=f[6]*y,l[7]=f[7]*y,l[8]=f[8]*y,l},ut.multiplyScalarAndAdd=function(l,f,y,b){return l[0]=f[0]+y[0]*b,l[1]=f[1]+y[1]*b,l[2]=f[2]+y[2]*b,l[3]=f[3]+y[3]*b,l[4]=f[4]+y[4]*b,l[5]=f[5]+y[5]*b,l[6]=f[6]+y[6]*b,l[7]=f[7]+y[7]*b,l[8]=f[8]+y[8]*b,l},ut.exactEquals=function(l,f){return l[0]===f[0]&&l[1]===f[1]&&l[2]===f[2]&&l[3]===f[3]&&l[4]===f[4]&&l[5]===f[5]&&l[6]===f[6]&&l[7]===f[7]&&l[8]===f[8]},ut.equals=function(l,f){var y=l[0],b=l[1],S=l[2],_=l[3],w=l[4],A=l[5],T=l[6],E=l[7],C=l[8],O=f[0],k=f[1],U=f[2],V=f[3],N=f[4],$=f[5],W=f[6],K=f[7],ae=f[8];return Math.abs(y-O)<=e.EPSILON*Math.max(1,Math.abs(y),Math.abs(O))&&Math.abs(b-k)<=e.EPSILON*Math.max(1,Math.abs(b),Math.abs(k))&&Math.abs(S-U)<=e.EPSILON*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(_-V)<=e.EPSILON*Math.max(1,Math.abs(_),Math.abs(V))&&Math.abs(w-N)<=e.EPSILON*Math.max(1,Math.abs(w),Math.abs(N))&&Math.abs(A-$)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs($))&&Math.abs(T-W)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(W))&&Math.abs(E-K)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(K))&&Math.abs(C-ae)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(ae))},ut.sub=ut.mul=void 0;var e=function(l,f){if(l&&l.__esModule)return l;if(l===null||o(l)!=="object"&&typeof l!="function")return{default:l};var y=r(void 0);if(y&&y.has(l))return y.get(l);var b={},S=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _ in l)if(_!=="default"&&Object.prototype.hasOwnProperty.call(l,_)){var w=S?Object.getOwnPropertyDescriptor(l,_):null;w&&(w.get||w.set)?Object.defineProperty(b,_,w):b[_]=l[_]}return b.default=l,y&&y.set(l,b),b}(ne());function r(l){if(typeof WeakMap!="function")return null;var f=new WeakMap,y=new WeakMap;return(r=function(b){return b?y:f})(l)}function a(l,f,y){var b=f[0],S=f[1],_=f[2],w=f[3],A=f[4],T=f[5],E=f[6],C=f[7],O=f[8],k=y[0],U=y[1],V=y[2],N=y[3],$=y[4],W=y[5],K=y[6],ae=y[7],ie=y[8];return l[0]=k*b+U*w+V*E,l[1]=k*S+U*A+V*C,l[2]=k*_+U*T+V*O,l[3]=N*b+$*w+W*E,l[4]=N*S+$*A+W*C,l[5]=N*_+$*T+W*O,l[6]=K*b+ae*w+ie*E,l[7]=K*S+ae*A+ie*C,l[8]=K*_+ae*T+ie*O,l}function u(l,f,y){return l[0]=f[0]-y[0],l[1]=f[1]-y[1],l[2]=f[2]-y[2],l[3]=f[3]-y[3],l[4]=f[4]-y[4],l[5]=f[5]-y[5],l[6]=f[6]-y[6],l[7]=f[7]-y[7],l[8]=f[8]-y[8],l}return ut.mul=a,ut.sub=u,ut}var St,tt={};function Et(){if(St)return tt;function o(_){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(w){return typeof w}:function(w){return w&&typeof Symbol=="function"&&w.constructor===Symbol&&w!==Symbol.prototype?"symbol":typeof w},o(_)}St=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.create=function(){var _=new e.ARRAY_TYPE(16);return e.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=0,_[12]=0,_[13]=0,_[14]=0),_[0]=1,_[5]=1,_[10]=1,_[15]=1,_},tt.clone=function(_){var w=new e.ARRAY_TYPE(16);return w[0]=_[0],w[1]=_[1],w[2]=_[2],w[3]=_[3],w[4]=_[4],w[5]=_[5],w[6]=_[6],w[7]=_[7],w[8]=_[8],w[9]=_[9],w[10]=_[10],w[11]=_[11],w[12]=_[12],w[13]=_[13],w[14]=_[14],w[15]=_[15],w},tt.copy=function(_,w){return _[0]=w[0],_[1]=w[1],_[2]=w[2],_[3]=w[3],_[4]=w[4],_[5]=w[5],_[6]=w[6],_[7]=w[7],_[8]=w[8],_[9]=w[9],_[10]=w[10],_[11]=w[11],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15],_},tt.fromValues=function(_,w,A,T,E,C,O,k,U,V,N,$,W,K,ae,ie){var se=new e.ARRAY_TYPE(16);return se[0]=_,se[1]=w,se[2]=A,se[3]=T,se[4]=E,se[5]=C,se[6]=O,se[7]=k,se[8]=U,se[9]=V,se[10]=N,se[11]=$,se[12]=W,se[13]=K,se[14]=ae,se[15]=ie,se},tt.set=function(_,w,A,T,E,C,O,k,U,V,N,$,W,K,ae,ie,se){return _[0]=w,_[1]=A,_[2]=T,_[3]=E,_[4]=C,_[5]=O,_[6]=k,_[7]=U,_[8]=V,_[9]=N,_[10]=$,_[11]=W,_[12]=K,_[13]=ae,_[14]=ie,_[15]=se,_},tt.identity=a,tt.transpose=function(_,w){if(_===w){var A=w[1],T=w[2],E=w[3],C=w[6],O=w[7],k=w[11];_[1]=w[4],_[2]=w[8],_[3]=w[12],_[4]=A,_[6]=w[9],_[7]=w[13],_[8]=T,_[9]=C,_[11]=w[14],_[12]=E,_[13]=O,_[14]=k}else _[0]=w[0],_[1]=w[4],_[2]=w[8],_[3]=w[12],_[4]=w[1],_[5]=w[5],_[6]=w[9],_[7]=w[13],_[8]=w[2],_[9]=w[6],_[10]=w[10],_[11]=w[14],_[12]=w[3],_[13]=w[7],_[14]=w[11],_[15]=w[15];return _},tt.invert=function(_,w){var A=w[0],T=w[1],E=w[2],C=w[3],O=w[4],k=w[5],U=w[6],V=w[7],N=w[8],$=w[9],W=w[10],K=w[11],ae=w[12],ie=w[13],se=w[14],ve=w[15],le=A*k-T*O,xe=A*U-E*O,Me=A*V-C*O,Se=T*U-E*k,Ce=T*V-C*k,Ie=E*V-C*U,Fe=N*ie-$*ae,ze=N*se-W*ae,Ne=N*ve-K*ae,it=$*se-W*ie,nt=$*ve-K*ie,Bt=W*ve-K*se,ft=le*Bt-xe*nt+Me*it+Se*Ne-Ce*ze+Ie*Fe;return ft?(_[0]=(k*Bt-U*nt+V*it)*(ft=1/ft),_[1]=(E*nt-T*Bt-C*it)*ft,_[2]=(ie*Ie-se*Ce+ve*Se)*ft,_[3]=(W*Ce-$*Ie-K*Se)*ft,_[4]=(U*Ne-O*Bt-V*ze)*ft,_[5]=(A*Bt-E*Ne+C*ze)*ft,_[6]=(se*Me-ae*Ie-ve*xe)*ft,_[7]=(N*Ie-W*Me+K*xe)*ft,_[8]=(O*nt-k*Ne+V*Fe)*ft,_[9]=(T*Ne-A*nt-C*Fe)*ft,_[10]=(ae*Ce-ie*Me+ve*le)*ft,_[11]=($*Me-N*Ce-K*le)*ft,_[12]=(k*ze-O*it-U*Fe)*ft,_[13]=(A*it-T*ze+E*Fe)*ft,_[14]=(ie*xe-ae*Se-se*le)*ft,_[15]=(N*Se-$*xe+W*le)*ft,_):null},tt.adjoint=function(_,w){var A=w[0],T=w[1],E=w[2],C=w[3],O=w[4],k=w[5],U=w[6],V=w[7],N=w[8],$=w[9],W=w[10],K=w[11],ae=w[12],ie=w[13],se=w[14],ve=w[15];return _[0]=k*(W*ve-K*se)-$*(U*ve-V*se)+ie*(U*K-V*W),_[1]=-(T*(W*ve-K*se)-$*(E*ve-C*se)+ie*(E*K-C*W)),_[2]=T*(U*ve-V*se)-k*(E*ve-C*se)+ie*(E*V-C*U),_[3]=-(T*(U*K-V*W)-k*(E*K-C*W)+$*(E*V-C*U)),_[4]=-(O*(W*ve-K*se)-N*(U*ve-V*se)+ae*(U*K-V*W)),_[5]=A*(W*ve-K*se)-N*(E*ve-C*se)+ae*(E*K-C*W),_[6]=-(A*(U*ve-V*se)-O*(E*ve-C*se)+ae*(E*V-C*U)),_[7]=A*(U*K-V*W)-O*(E*K-C*W)+N*(E*V-C*U),_[8]=O*($*ve-K*ie)-N*(k*ve-V*ie)+ae*(k*K-V*$),_[9]=-(A*($*ve-K*ie)-N*(T*ve-C*ie)+ae*(T*K-C*$)),_[10]=A*(k*ve-V*ie)-O*(T*ve-C*ie)+ae*(T*V-C*k),_[11]=-(A*(k*K-V*$)-O*(T*K-C*$)+N*(T*V-C*k)),_[12]=-(O*($*se-W*ie)-N*(k*se-U*ie)+ae*(k*W-U*$)),_[13]=A*($*se-W*ie)-N*(T*se-E*ie)+ae*(T*W-E*$),_[14]=-(A*(k*se-U*ie)-O*(T*se-E*ie)+ae*(T*U-E*k)),_[15]=A*(k*W-U*$)-O*(T*W-E*$)+N*(T*U-E*k),_},tt.determinant=function(_){var w=_[0],A=_[1],T=_[2],E=_[3],C=_[4],O=_[5],k=_[6],U=_[7],V=_[8],N=_[9],$=_[10],W=_[11],K=_[12],ae=_[13],ie=_[14],se=_[15];return(w*O-A*C)*($*se-W*ie)-(w*k-T*C)*(N*se-W*ae)+(w*U-E*C)*(N*ie-$*ae)+(A*k-T*O)*(V*se-W*K)-(A*U-E*O)*(V*ie-$*K)+(T*U-E*k)*(V*ae-N*K)},tt.multiply=u,tt.translate=function(_,w,A){var T,E,C,O,k,U,V,N,$,W,K,ae,ie=A[0],se=A[1],ve=A[2];return w===_?(_[12]=w[0]*ie+w[4]*se+w[8]*ve+w[12],_[13]=w[1]*ie+w[5]*se+w[9]*ve+w[13],_[14]=w[2]*ie+w[6]*se+w[10]*ve+w[14],_[15]=w[3]*ie+w[7]*se+w[11]*ve+w[15]):(E=w[1],C=w[2],O=w[3],k=w[4],U=w[5],V=w[6],N=w[7],$=w[8],W=w[9],K=w[10],ae=w[11],_[0]=T=w[0],_[1]=E,_[2]=C,_[3]=O,_[4]=k,_[5]=U,_[6]=V,_[7]=N,_[8]=$,_[9]=W,_[10]=K,_[11]=ae,_[12]=T*ie+k*se+$*ve+w[12],_[13]=E*ie+U*se+W*ve+w[13],_[14]=C*ie+V*se+K*ve+w[14],_[15]=O*ie+N*se+ae*ve+w[15]),_},tt.scale=function(_,w,A){var T=A[0],E=A[1],C=A[2];return _[0]=w[0]*T,_[1]=w[1]*T,_[2]=w[2]*T,_[3]=w[3]*T,_[4]=w[4]*E,_[5]=w[5]*E,_[6]=w[6]*E,_[7]=w[7]*E,_[8]=w[8]*C,_[9]=w[9]*C,_[10]=w[10]*C,_[11]=w[11]*C,_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15],_},tt.rotate=function(_,w,A,T){var E,C,O,k,U,V,N,$,W,K,ae,ie,se,ve,le,xe,Me,Se,Ce,Ie,Fe,ze,Ne,it,nt=T[0],Bt=T[1],ft=T[2],Tt=Math.hypot(nt,Bt,ft);return Tt<e.EPSILON?null:(nt*=Tt=1/Tt,Bt*=Tt,ft*=Tt,E=Math.sin(A),C=Math.cos(A),U=w[1],V=w[2],N=w[3],W=w[5],K=w[6],ae=w[7],se=w[9],ve=w[10],le=w[11],xe=nt*nt*(O=1-C)+C,Ce=nt*Bt*O-ft*E,Ie=Bt*Bt*O+C,Fe=ft*Bt*O+nt*E,ze=nt*ft*O+Bt*E,Ne=Bt*ft*O-nt*E,it=ft*ft*O+C,_[0]=(k=w[0])*xe+($=w[4])*(Me=Bt*nt*O+ft*E)+(ie=w[8])*(Se=ft*nt*O-Bt*E),_[1]=U*xe+W*Me+se*Se,_[2]=V*xe+K*Me+ve*Se,_[3]=N*xe+ae*Me+le*Se,_[4]=k*Ce+$*Ie+ie*Fe,_[5]=U*Ce+W*Ie+se*Fe,_[6]=V*Ce+K*Ie+ve*Fe,_[7]=N*Ce+ae*Ie+le*Fe,_[8]=k*ze+$*Ne+ie*it,_[9]=U*ze+W*Ne+se*it,_[10]=V*ze+K*Ne+ve*it,_[11]=N*ze+ae*Ne+le*it,w!==_&&(_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_)},tt.rotateX=function(_,w,A){var T=Math.sin(A),E=Math.cos(A),C=w[4],O=w[5],k=w[6],U=w[7],V=w[8],N=w[9],$=w[10],W=w[11];return w!==_&&(_[0]=w[0],_[1]=w[1],_[2]=w[2],_[3]=w[3],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_[4]=C*E+V*T,_[5]=O*E+N*T,_[6]=k*E+$*T,_[7]=U*E+W*T,_[8]=V*E-C*T,_[9]=N*E-O*T,_[10]=$*E-k*T,_[11]=W*E-U*T,_},tt.rotateY=function(_,w,A){var T=Math.sin(A),E=Math.cos(A),C=w[0],O=w[1],k=w[2],U=w[3],V=w[8],N=w[9],$=w[10],W=w[11];return w!==_&&(_[4]=w[4],_[5]=w[5],_[6]=w[6],_[7]=w[7],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_[0]=C*E-V*T,_[1]=O*E-N*T,_[2]=k*E-$*T,_[3]=U*E-W*T,_[8]=C*T+V*E,_[9]=O*T+N*E,_[10]=k*T+$*E,_[11]=U*T+W*E,_},tt.rotateZ=function(_,w,A){var T=Math.sin(A),E=Math.cos(A),C=w[0],O=w[1],k=w[2],U=w[3],V=w[4],N=w[5],$=w[6],W=w[7];return w!==_&&(_[8]=w[8],_[9]=w[9],_[10]=w[10],_[11]=w[11],_[12]=w[12],_[13]=w[13],_[14]=w[14],_[15]=w[15]),_[0]=C*E+V*T,_[1]=O*E+N*T,_[2]=k*E+$*T,_[3]=U*E+W*T,_[4]=V*E-C*T,_[5]=N*E-O*T,_[6]=$*E-k*T,_[7]=W*E-U*T,_},tt.fromTranslation=function(_,w){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=w[0],_[13]=w[1],_[14]=w[2],_[15]=1,_},tt.fromScaling=function(_,w){return _[0]=w[0],_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=w[1],_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=w[2],_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},tt.fromRotation=function(_,w,A){var T,E,C,O=A[0],k=A[1],U=A[2],V=Math.hypot(O,k,U);return V<e.EPSILON?null:(O*=V=1/V,k*=V,U*=V,T=Math.sin(w),E=Math.cos(w),_[0]=O*O*(C=1-E)+E,_[1]=k*O*C+U*T,_[2]=U*O*C-k*T,_[3]=0,_[4]=O*k*C-U*T,_[5]=k*k*C+E,_[6]=U*k*C+O*T,_[7]=0,_[8]=O*U*C+k*T,_[9]=k*U*C-O*T,_[10]=U*U*C+E,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_)},tt.fromXRotation=function(_,w){var A=Math.sin(w),T=Math.cos(w);return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=T,_[6]=A,_[7]=0,_[8]=0,_[9]=-A,_[10]=T,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},tt.fromYRotation=function(_,w){var A=Math.sin(w),T=Math.cos(w);return _[0]=T,_[1]=0,_[2]=-A,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=A,_[9]=0,_[10]=T,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},tt.fromZRotation=function(_,w){var A=Math.sin(w),T=Math.cos(w);return _[0]=T,_[1]=A,_[2]=0,_[3]=0,_[4]=-A,_[5]=T,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},tt.fromRotationTranslation=l,tt.fromQuat2=function(_,w){var A=new e.ARRAY_TYPE(3),T=-w[0],E=-w[1],C=-w[2],O=w[3],k=w[4],U=w[5],V=w[6],N=w[7],$=T*T+E*E+C*C+O*O;return $>0?(A[0]=2*(k*O+N*T+U*C-V*E)/$,A[1]=2*(U*O+N*E+V*T-k*C)/$,A[2]=2*(V*O+N*C+k*E-U*T)/$):(A[0]=2*(k*O+N*T+U*C-V*E),A[1]=2*(U*O+N*E+V*T-k*C),A[2]=2*(V*O+N*C+k*E-U*T)),l(_,w,A),_},tt.getTranslation=function(_,w){return _[0]=w[12],_[1]=w[13],_[2]=w[14],_},tt.getScaling=f,tt.getRotation=function(_,w){var A=new e.ARRAY_TYPE(3);f(A,w);var T=1/A[0],E=1/A[1],C=1/A[2],O=w[0]*T,k=w[1]*E,U=w[2]*C,V=w[4]*T,N=w[5]*E,$=w[6]*C,W=w[8]*T,K=w[9]*E,ae=w[10]*C,ie=O+N+ae,se=0;return ie>0?(se=2*Math.sqrt(ie+1),_[3]=.25*se,_[0]=($-K)/se,_[1]=(W-U)/se,_[2]=(k-V)/se):O>N&&O>ae?(se=2*Math.sqrt(1+O-N-ae),_[3]=($-K)/se,_[0]=.25*se,_[1]=(k+V)/se,_[2]=(W+U)/se):N>ae?(se=2*Math.sqrt(1+N-O-ae),_[3]=(W-U)/se,_[0]=(k+V)/se,_[1]=.25*se,_[2]=($+K)/se):(se=2*Math.sqrt(1+ae-O-N),_[3]=(k-V)/se,_[0]=(W+U)/se,_[1]=($+K)/se,_[2]=.25*se),_},tt.fromRotationTranslationScale=function(_,w,A,T){var E=w[0],C=w[1],O=w[2],k=w[3],U=E+E,V=C+C,N=O+O,$=E*U,W=E*V,K=E*N,ae=C*V,ie=C*N,se=O*N,ve=k*U,le=k*V,xe=k*N,Me=T[0],Se=T[1],Ce=T[2];return _[0]=(1-(ae+se))*Me,_[1]=(W+xe)*Me,_[2]=(K-le)*Me,_[3]=0,_[4]=(W-xe)*Se,_[5]=(1-($+se))*Se,_[6]=(ie+ve)*Se,_[7]=0,_[8]=(K+le)*Ce,_[9]=(ie-ve)*Ce,_[10]=(1-($+ae))*Ce,_[11]=0,_[12]=A[0],_[13]=A[1],_[14]=A[2],_[15]=1,_},tt.fromRotationTranslationScaleOrigin=function(_,w,A,T,E){var C=w[0],O=w[1],k=w[2],U=w[3],V=C+C,N=O+O,$=k+k,W=C*V,K=C*N,ae=C*$,ie=O*N,se=O*$,ve=k*$,le=U*V,xe=U*N,Me=U*$,Se=T[0],Ce=T[1],Ie=T[2],Fe=E[0],ze=E[1],Ne=E[2],it=(1-(ie+ve))*Se,nt=(K+Me)*Se,Bt=(ae-xe)*Se,ft=(K-Me)*Ce,Tt=(1-(W+ve))*Ce,at=(se+le)*Ce,tr=(ae+xe)*Ie,Ot=(se-le)*Ie,Ht=(1-(W+ie))*Ie;return _[0]=it,_[1]=nt,_[2]=Bt,_[3]=0,_[4]=ft,_[5]=Tt,_[6]=at,_[7]=0,_[8]=tr,_[9]=Ot,_[10]=Ht,_[11]=0,_[12]=A[0]+Fe-(it*Fe+ft*ze+tr*Ne),_[13]=A[1]+ze-(nt*Fe+Tt*ze+Ot*Ne),_[14]=A[2]+Ne-(Bt*Fe+at*ze+Ht*Ne),_[15]=1,_},tt.fromQuat=function(_,w){var A=w[0],T=w[1],E=w[2],C=w[3],O=A+A,k=T+T,U=E+E,V=A*O,N=T*O,$=T*k,W=E*O,K=E*k,ae=E*U,ie=C*O,se=C*k,ve=C*U;return _[0]=1-$-ae,_[1]=N+ve,_[2]=W-se,_[3]=0,_[4]=N-ve,_[5]=1-V-ae,_[6]=K+ie,_[7]=0,_[8]=W+se,_[9]=K-ie,_[10]=1-V-$,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_},tt.frustum=function(_,w,A,T,E,C,O){var k=1/(A-w),U=1/(E-T),V=1/(C-O);return _[0]=2*C*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*C*U,_[6]=0,_[7]=0,_[8]=(A+w)*k,_[9]=(E+T)*U,_[10]=(O+C)*V,_[11]=-1,_[12]=0,_[13]=0,_[14]=O*C*2*V,_[15]=0,_},tt.perspectiveNO=y,tt.perspectiveZO=function(_,w,A,T,E){var C,O=1/Math.tan(w/2);return _[0]=O/A,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=O,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,E!=null&&E!==1/0?(_[10]=E*(C=1/(T-E)),_[14]=E*T*C):(_[10]=-1,_[14]=-T),_},tt.perspectiveFromFieldOfView=function(_,w,A,T){var E=Math.tan(w.upDegrees*Math.PI/180),C=Math.tan(w.downDegrees*Math.PI/180),O=Math.tan(w.leftDegrees*Math.PI/180),k=Math.tan(w.rightDegrees*Math.PI/180),U=2/(O+k),V=2/(E+C);return _[0]=U,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=V,_[6]=0,_[7]=0,_[8]=-(O-k)*U*.5,_[9]=(E-C)*V*.5,_[10]=T/(A-T),_[11]=-1,_[12]=0,_[13]=0,_[14]=T*A/(A-T),_[15]=0,_},tt.orthoNO=b,tt.orthoZO=function(_,w,A,T,E,C,O){var k=1/(w-A),U=1/(T-E),V=1/(C-O);return _[0]=-2*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*U,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=V,_[11]=0,_[12]=(w+A)*k,_[13]=(E+T)*U,_[14]=C*V,_[15]=1,_},tt.lookAt=function(_,w,A,T){var E,C,O,k,U,V,N,$,W,K,ae=w[0],ie=w[1],se=w[2],ve=T[0],le=T[1],xe=T[2],Me=A[0],Se=A[1],Ce=A[2];return Math.abs(ae-Me)<e.EPSILON&&Math.abs(ie-Se)<e.EPSILON&&Math.abs(se-Ce)<e.EPSILON?a(_):(N=ae-Me,$=ie-Se,W=se-Ce,E=le*(W*=K=1/Math.hypot(N,$,W))-xe*($*=K),C=xe*(N*=K)-ve*W,O=ve*$-le*N,(K=Math.hypot(E,C,O))?(E*=K=1/K,C*=K,O*=K):(E=0,C=0,O=0),k=$*O-W*C,U=W*E-N*O,V=N*C-$*E,(K=Math.hypot(k,U,V))?(k*=K=1/K,U*=K,V*=K):(k=0,U=0,V=0),_[0]=E,_[1]=k,_[2]=N,_[3]=0,_[4]=C,_[5]=U,_[6]=$,_[7]=0,_[8]=O,_[9]=V,_[10]=W,_[11]=0,_[12]=-(E*ae+C*ie+O*se),_[13]=-(k*ae+U*ie+V*se),_[14]=-(N*ae+$*ie+W*se),_[15]=1,_)},tt.targetTo=function(_,w,A,T){var E=w[0],C=w[1],O=w[2],k=T[0],U=T[1],V=T[2],N=E-A[0],$=C-A[1],W=O-A[2],K=N*N+$*$+W*W;K>0&&(N*=K=1/Math.sqrt(K),$*=K,W*=K);var ae=U*W-V*$,ie=V*N-k*W,se=k*$-U*N;return(K=ae*ae+ie*ie+se*se)>0&&(ae*=K=1/Math.sqrt(K),ie*=K,se*=K),_[0]=ae,_[1]=ie,_[2]=se,_[3]=0,_[4]=$*se-W*ie,_[5]=W*ae-N*se,_[6]=N*ie-$*ae,_[7]=0,_[8]=N,_[9]=$,_[10]=W,_[11]=0,_[12]=E,_[13]=C,_[14]=O,_[15]=1,_},tt.str=function(_){return"mat4("+_[0]+", "+_[1]+", "+_[2]+", "+_[3]+", "+_[4]+", "+_[5]+", "+_[6]+", "+_[7]+", "+_[8]+", "+_[9]+", "+_[10]+", "+_[11]+", "+_[12]+", "+_[13]+", "+_[14]+", "+_[15]+")"},tt.frob=function(_){return Math.hypot(_[0],_[1],_[2],_[3],_[4],_[5],_[6],_[7],_[8],_[9],_[10],_[11],_[12],_[13],_[14],_[15])},tt.add=function(_,w,A){return _[0]=w[0]+A[0],_[1]=w[1]+A[1],_[2]=w[2]+A[2],_[3]=w[3]+A[3],_[4]=w[4]+A[4],_[5]=w[5]+A[5],_[6]=w[6]+A[6],_[7]=w[7]+A[7],_[8]=w[8]+A[8],_[9]=w[9]+A[9],_[10]=w[10]+A[10],_[11]=w[11]+A[11],_[12]=w[12]+A[12],_[13]=w[13]+A[13],_[14]=w[14]+A[14],_[15]=w[15]+A[15],_},tt.subtract=S,tt.multiplyScalar=function(_,w,A){return _[0]=w[0]*A,_[1]=w[1]*A,_[2]=w[2]*A,_[3]=w[3]*A,_[4]=w[4]*A,_[5]=w[5]*A,_[6]=w[6]*A,_[7]=w[7]*A,_[8]=w[8]*A,_[9]=w[9]*A,_[10]=w[10]*A,_[11]=w[11]*A,_[12]=w[12]*A,_[13]=w[13]*A,_[14]=w[14]*A,_[15]=w[15]*A,_},tt.multiplyScalarAndAdd=function(_,w,A,T){return _[0]=w[0]+A[0]*T,_[1]=w[1]+A[1]*T,_[2]=w[2]+A[2]*T,_[3]=w[3]+A[3]*T,_[4]=w[4]+A[4]*T,_[5]=w[5]+A[5]*T,_[6]=w[6]+A[6]*T,_[7]=w[7]+A[7]*T,_[8]=w[8]+A[8]*T,_[9]=w[9]+A[9]*T,_[10]=w[10]+A[10]*T,_[11]=w[11]+A[11]*T,_[12]=w[12]+A[12]*T,_[13]=w[13]+A[13]*T,_[14]=w[14]+A[14]*T,_[15]=w[15]+A[15]*T,_},tt.exactEquals=function(_,w){return _[0]===w[0]&&_[1]===w[1]&&_[2]===w[2]&&_[3]===w[3]&&_[4]===w[4]&&_[5]===w[5]&&_[6]===w[6]&&_[7]===w[7]&&_[8]===w[8]&&_[9]===w[9]&&_[10]===w[10]&&_[11]===w[11]&&_[12]===w[12]&&_[13]===w[13]&&_[14]===w[14]&&_[15]===w[15]},tt.equals=function(_,w){var A=_[0],T=_[1],E=_[2],C=_[3],O=_[4],k=_[5],U=_[6],V=_[7],N=_[8],$=_[9],W=_[10],K=_[11],ae=_[12],ie=_[13],se=_[14],ve=_[15],le=w[0],xe=w[1],Me=w[2],Se=w[3],Ce=w[4],Ie=w[5],Fe=w[6],ze=w[7],Ne=w[8],it=w[9],nt=w[10],Bt=w[11],ft=w[12],Tt=w[13],at=w[14],tr=w[15];return Math.abs(A-le)<=e.EPSILON*Math.max(1,Math.abs(A),Math.abs(le))&&Math.abs(T-xe)<=e.EPSILON*Math.max(1,Math.abs(T),Math.abs(xe))&&Math.abs(E-Me)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(Me))&&Math.abs(C-Se)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(Se))&&Math.abs(O-Ce)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(Ce))&&Math.abs(k-Ie)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ie))&&Math.abs(U-Fe)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(Fe))&&Math.abs(V-ze)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(ze))&&Math.abs(N-Ne)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(Ne))&&Math.abs($-it)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(it))&&Math.abs(W-nt)<=e.EPSILON*Math.max(1,Math.abs(W),Math.abs(nt))&&Math.abs(K-Bt)<=e.EPSILON*Math.max(1,Math.abs(K),Math.abs(Bt))&&Math.abs(ae-ft)<=e.EPSILON*Math.max(1,Math.abs(ae),Math.abs(ft))&&Math.abs(ie-Tt)<=e.EPSILON*Math.max(1,Math.abs(ie),Math.abs(Tt))&&Math.abs(se-at)<=e.EPSILON*Math.max(1,Math.abs(se),Math.abs(at))&&Math.abs(ve-tr)<=e.EPSILON*Math.max(1,Math.abs(ve),Math.abs(tr))},tt.sub=tt.mul=tt.ortho=tt.perspective=void 0;var e=function(_,w){if(_&&_.__esModule)return _;if(_===null||o(_)!=="object"&&typeof _!="function")return{default:_};var A=r(void 0);if(A&&A.has(_))return A.get(_);var T={},E=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var C in _)if(C!=="default"&&Object.prototype.hasOwnProperty.call(_,C)){var O=E?Object.getOwnPropertyDescriptor(_,C):null;O&&(O.get||O.set)?Object.defineProperty(T,C,O):T[C]=_[C]}return T.default=_,A&&A.set(_,T),T}(ne());function r(_){if(typeof WeakMap!="function")return null;var w=new WeakMap,A=new WeakMap;return(r=function(T){return T?A:w})(_)}function a(_){return _[0]=1,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=1,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1,_[11]=0,_[12]=0,_[13]=0,_[14]=0,_[15]=1,_}function u(_,w,A){var T=w[0],E=w[1],C=w[2],O=w[3],k=w[4],U=w[5],V=w[6],N=w[7],$=w[8],W=w[9],K=w[10],ae=w[11],ie=w[12],se=w[13],ve=w[14],le=w[15],xe=A[0],Me=A[1],Se=A[2],Ce=A[3];return _[0]=xe*T+Me*k+Se*$+Ce*ie,_[1]=xe*E+Me*U+Se*W+Ce*se,_[2]=xe*C+Me*V+Se*K+Ce*ve,_[3]=xe*O+Me*N+Se*ae+Ce*le,_[4]=(xe=A[4])*T+(Me=A[5])*k+(Se=A[6])*$+(Ce=A[7])*ie,_[5]=xe*E+Me*U+Se*W+Ce*se,_[6]=xe*C+Me*V+Se*K+Ce*ve,_[7]=xe*O+Me*N+Se*ae+Ce*le,_[8]=(xe=A[8])*T+(Me=A[9])*k+(Se=A[10])*$+(Ce=A[11])*ie,_[9]=xe*E+Me*U+Se*W+Ce*se,_[10]=xe*C+Me*V+Se*K+Ce*ve,_[11]=xe*O+Me*N+Se*ae+Ce*le,_[12]=(xe=A[12])*T+(Me=A[13])*k+(Se=A[14])*$+(Ce=A[15])*ie,_[13]=xe*E+Me*U+Se*W+Ce*se,_[14]=xe*C+Me*V+Se*K+Ce*ve,_[15]=xe*O+Me*N+Se*ae+Ce*le,_}function l(_,w,A){var T=w[0],E=w[1],C=w[2],O=w[3],k=T+T,U=E+E,V=C+C,N=T*k,$=T*U,W=T*V,K=E*U,ae=E*V,ie=C*V,se=O*k,ve=O*U,le=O*V;return _[0]=1-(K+ie),_[1]=$+le,_[2]=W-ve,_[3]=0,_[4]=$-le,_[5]=1-(N+ie),_[6]=ae+se,_[7]=0,_[8]=W+ve,_[9]=ae-se,_[10]=1-(N+K),_[11]=0,_[12]=A[0],_[13]=A[1],_[14]=A[2],_[15]=1,_}function f(_,w){var A=w[4],T=w[5],E=w[6],C=w[8],O=w[9],k=w[10];return _[0]=Math.hypot(w[0],w[1],w[2]),_[1]=Math.hypot(A,T,E),_[2]=Math.hypot(C,O,k),_}function y(_,w,A,T,E){var C,O=1/Math.tan(w/2);return _[0]=O/A,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=O,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,E!=null&&E!==1/0?(_[10]=(E+T)*(C=1/(T-E)),_[14]=2*E*T*C):(_[10]=-1,_[14]=-2*T),_}function b(_,w,A,T,E,C,O){var k=1/(w-A),U=1/(T-E),V=1/(C-O);return _[0]=-2*k,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=-2*U,_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=2*V,_[11]=0,_[12]=(w+A)*k,_[13]=(E+T)*U,_[14]=(O+C)*V,_[15]=1,_}function S(_,w,A){return _[0]=w[0]-A[0],_[1]=w[1]-A[1],_[2]=w[2]-A[2],_[3]=w[3]-A[3],_[4]=w[4]-A[4],_[5]=w[5]-A[5],_[6]=w[6]-A[6],_[7]=w[7]-A[7],_[8]=w[8]-A[8],_[9]=w[9]-A[9],_[10]=w[10]-A[10],_[11]=w[11]-A[11],_[12]=w[12]-A[12],_[13]=w[13]-A[13],_[14]=w[14]-A[14],_[15]=w[15]-A[15],_}return tt.perspective=y,tt.ortho=b,tt.mul=u,tt.sub=S,tt}var pt,ot={},gt={};function yt(){if(pt)return gt;function o(E){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(C){return typeof C}:function(C){return C&&typeof Symbol=="function"&&C.constructor===Symbol&&C!==Symbol.prototype?"symbol":typeof C},o(E)}pt=1,Object.defineProperty(gt,"__esModule",{value:!0}),gt.create=a,gt.clone=function(E){var C=new e.ARRAY_TYPE(3);return C[0]=E[0],C[1]=E[1],C[2]=E[2],C},gt.length=u,gt.fromValues=function(E,C,O){var k=new e.ARRAY_TYPE(3);return k[0]=E,k[1]=C,k[2]=O,k},gt.copy=function(E,C){return E[0]=C[0],E[1]=C[1],E[2]=C[2],E},gt.set=function(E,C,O,k){return E[0]=C,E[1]=O,E[2]=k,E},gt.add=function(E,C,O){return E[0]=C[0]+O[0],E[1]=C[1]+O[1],E[2]=C[2]+O[2],E},gt.subtract=l,gt.multiply=f,gt.divide=y,gt.ceil=function(E,C){return E[0]=Math.ceil(C[0]),E[1]=Math.ceil(C[1]),E[2]=Math.ceil(C[2]),E},gt.floor=function(E,C){return E[0]=Math.floor(C[0]),E[1]=Math.floor(C[1]),E[2]=Math.floor(C[2]),E},gt.min=function(E,C,O){return E[0]=Math.min(C[0],O[0]),E[1]=Math.min(C[1],O[1]),E[2]=Math.min(C[2],O[2]),E},gt.max=function(E,C,O){return E[0]=Math.max(C[0],O[0]),E[1]=Math.max(C[1],O[1]),E[2]=Math.max(C[2],O[2]),E},gt.round=function(E,C){return E[0]=Math.round(C[0]),E[1]=Math.round(C[1]),E[2]=Math.round(C[2]),E},gt.scale=function(E,C,O){return E[0]=C[0]*O,E[1]=C[1]*O,E[2]=C[2]*O,E},gt.scaleAndAdd=function(E,C,O,k){return E[0]=C[0]+O[0]*k,E[1]=C[1]+O[1]*k,E[2]=C[2]+O[2]*k,E},gt.distance=b,gt.squaredDistance=S,gt.squaredLength=_,gt.negate=function(E,C){return E[0]=-C[0],E[1]=-C[1],E[2]=-C[2],E},gt.inverse=function(E,C){return E[0]=1/C[0],E[1]=1/C[1],E[2]=1/C[2],E},gt.normalize=function(E,C){var O=C[0],k=C[1],U=C[2],V=O*O+k*k+U*U;return V>0&&(V=1/Math.sqrt(V)),E[0]=C[0]*V,E[1]=C[1]*V,E[2]=C[2]*V,E},gt.dot=w,gt.cross=function(E,C,O){var k=C[0],U=C[1],V=C[2],N=O[0],$=O[1],W=O[2];return E[0]=U*W-V*$,E[1]=V*N-k*W,E[2]=k*$-U*N,E},gt.lerp=function(E,C,O,k){var U=C[0],V=C[1],N=C[2];return E[0]=U+k*(O[0]-U),E[1]=V+k*(O[1]-V),E[2]=N+k*(O[2]-N),E},gt.hermite=function(E,C,O,k,U,V){var N=V*V,$=N*(2*V-3)+1,W=N*(V-2)+V,K=N*(V-1),ae=N*(3-2*V);return E[0]=C[0]*$+O[0]*W+k[0]*K+U[0]*ae,E[1]=C[1]*$+O[1]*W+k[1]*K+U[1]*ae,E[2]=C[2]*$+O[2]*W+k[2]*K+U[2]*ae,E},gt.bezier=function(E,C,O,k,U,V){var N=1-V,$=N*N,W=V*V,K=$*N,ae=3*V*$,ie=3*W*N,se=W*V;return E[0]=C[0]*K+O[0]*ae+k[0]*ie+U[0]*se,E[1]=C[1]*K+O[1]*ae+k[1]*ie+U[1]*se,E[2]=C[2]*K+O[2]*ae+k[2]*ie+U[2]*se,E},gt.random=function(E,C){C=C||1;var O=2*e.RANDOM()*Math.PI,k=2*e.RANDOM()-1,U=Math.sqrt(1-k*k)*C;return E[0]=Math.cos(O)*U,E[1]=Math.sin(O)*U,E[2]=k*C,E},gt.transformMat4=function(E,C,O){var k=C[0],U=C[1],V=C[2],N=O[3]*k+O[7]*U+O[11]*V+O[15];return E[0]=(O[0]*k+O[4]*U+O[8]*V+O[12])/(N=N||1),E[1]=(O[1]*k+O[5]*U+O[9]*V+O[13])/N,E[2]=(O[2]*k+O[6]*U+O[10]*V+O[14])/N,E},gt.transformMat3=function(E,C,O){var k=C[0],U=C[1],V=C[2];return E[0]=k*O[0]+U*O[3]+V*O[6],E[1]=k*O[1]+U*O[4]+V*O[7],E[2]=k*O[2]+U*O[5]+V*O[8],E},gt.transformQuat=function(E,C,O){var k=O[0],U=O[1],V=O[2],N=C[0],$=C[1],W=C[2],K=U*W-V*$,ae=V*N-k*W,ie=k*$-U*N,se=U*ie-V*ae,ve=V*K-k*ie,le=k*ae-U*K,xe=2*O[3];return ae*=xe,ie*=xe,ve*=2,le*=2,E[0]=N+(K*=xe)+(se*=2),E[1]=$+ae+ve,E[2]=W+ie+le,E},gt.rotateX=function(E,C,O,k){var U=[],V=[];return U[0]=C[0]-O[0],U[1]=C[1]-O[1],U[2]=C[2]-O[2],V[0]=U[0],V[1]=U[1]*Math.cos(k)-U[2]*Math.sin(k),V[2]=U[1]*Math.sin(k)+U[2]*Math.cos(k),E[0]=V[0]+O[0],E[1]=V[1]+O[1],E[2]=V[2]+O[2],E},gt.rotateY=function(E,C,O,k){var U=[],V=[];return U[0]=C[0]-O[0],U[1]=C[1]-O[1],U[2]=C[2]-O[2],V[0]=U[2]*Math.sin(k)+U[0]*Math.cos(k),V[1]=U[1],V[2]=U[2]*Math.cos(k)-U[0]*Math.sin(k),E[0]=V[0]+O[0],E[1]=V[1]+O[1],E[2]=V[2]+O[2],E},gt.rotateZ=function(E,C,O,k){var U=[],V=[];return U[0]=C[0]-O[0],U[1]=C[1]-O[1],U[2]=C[2]-O[2],V[0]=U[0]*Math.cos(k)-U[1]*Math.sin(k),V[1]=U[0]*Math.sin(k)+U[1]*Math.cos(k),V[2]=U[2],E[0]=V[0]+O[0],E[1]=V[1]+O[1],E[2]=V[2]+O[2],E},gt.angle=function(E,C){var O=E[0],k=E[1],U=E[2],V=C[0],N=C[1],$=C[2],W=Math.sqrt(O*O+k*k+U*U)*Math.sqrt(V*V+N*N+$*$),K=W&&w(E,C)/W;return Math.acos(Math.min(Math.max(K,-1),1))},gt.zero=function(E){return E[0]=0,E[1]=0,E[2]=0,E},gt.str=function(E){return"vec3("+E[0]+", "+E[1]+", "+E[2]+")"},gt.exactEquals=function(E,C){return E[0]===C[0]&&E[1]===C[1]&&E[2]===C[2]},gt.equals=function(E,C){var O=E[0],k=E[1],U=E[2],V=C[0],N=C[1],$=C[2];return Math.abs(O-V)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(V))&&Math.abs(k-N)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(N))&&Math.abs(U-$)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs($))},gt.forEach=gt.sqrLen=gt.len=gt.sqrDist=gt.dist=gt.div=gt.mul=gt.sub=void 0;var e=function(E,C){if(E&&E.__esModule)return E;if(E===null||o(E)!=="object"&&typeof E!="function")return{default:E};var O=r(void 0);if(O&&O.has(E))return O.get(E);var k={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var V in E)if(V!=="default"&&Object.prototype.hasOwnProperty.call(E,V)){var N=U?Object.getOwnPropertyDescriptor(E,V):null;N&&(N.get||N.set)?Object.defineProperty(k,V,N):k[V]=E[V]}return k.default=E,O&&O.set(E,k),k}(ne());function r(E){if(typeof WeakMap!="function")return null;var C=new WeakMap,O=new WeakMap;return(r=function(k){return k?O:C})(E)}function a(){var E=new e.ARRAY_TYPE(3);return e.ARRAY_TYPE!=Float32Array&&(E[0]=0,E[1]=0,E[2]=0),E}function u(E){return Math.hypot(E[0],E[1],E[2])}function l(E,C,O){return E[0]=C[0]-O[0],E[1]=C[1]-O[1],E[2]=C[2]-O[2],E}function f(E,C,O){return E[0]=C[0]*O[0],E[1]=C[1]*O[1],E[2]=C[2]*O[2],E}function y(E,C,O){return E[0]=C[0]/O[0],E[1]=C[1]/O[1],E[2]=C[2]/O[2],E}function b(E,C){return Math.hypot(C[0]-E[0],C[1]-E[1],C[2]-E[2])}function S(E,C){var O=C[0]-E[0],k=C[1]-E[1],U=C[2]-E[2];return O*O+k*k+U*U}function _(E){var C=E[0],O=E[1],k=E[2];return C*C+O*O+k*k}function w(E,C){return E[0]*C[0]+E[1]*C[1]+E[2]*C[2]}gt.sub=l,gt.mul=f,gt.div=y,gt.dist=b,gt.sqrDist=S,gt.len=u,gt.sqrLen=_;var A,T=(A=a(),function(E,C,O,k,U,V){var N,$;for(C||(C=3),O||(O=0),$=k?Math.min(k*C+O,E.length):E.length,N=O;N<$;N+=C)A[0]=E[N],A[1]=E[N+1],A[2]=E[N+2],U(A,A,V),E[N]=A[0],E[N+1]=A[1],E[N+2]=A[2];return E});return gt.forEach=T,gt}var ir,zr,Zt={};function Ir(){if(ir)return Zt;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},o(T)}ir=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=a,Zt.clone=function(T){var E=new e.ARRAY_TYPE(4);return E[0]=T[0],E[1]=T[1],E[2]=T[2],E[3]=T[3],E},Zt.fromValues=function(T,E,C,O){var k=new e.ARRAY_TYPE(4);return k[0]=T,k[1]=E,k[2]=C,k[3]=O,k},Zt.copy=function(T,E){return T[0]=E[0],T[1]=E[1],T[2]=E[2],T[3]=E[3],T},Zt.set=function(T,E,C,O,k){return T[0]=E,T[1]=C,T[2]=O,T[3]=k,T},Zt.add=function(T,E,C){return T[0]=E[0]+C[0],T[1]=E[1]+C[1],T[2]=E[2]+C[2],T[3]=E[3]+C[3],T},Zt.subtract=u,Zt.multiply=l,Zt.divide=f,Zt.ceil=function(T,E){return T[0]=Math.ceil(E[0]),T[1]=Math.ceil(E[1]),T[2]=Math.ceil(E[2]),T[3]=Math.ceil(E[3]),T},Zt.floor=function(T,E){return T[0]=Math.floor(E[0]),T[1]=Math.floor(E[1]),T[2]=Math.floor(E[2]),T[3]=Math.floor(E[3]),T},Zt.min=function(T,E,C){return T[0]=Math.min(E[0],C[0]),T[1]=Math.min(E[1],C[1]),T[2]=Math.min(E[2],C[2]),T[3]=Math.min(E[3],C[3]),T},Zt.max=function(T,E,C){return T[0]=Math.max(E[0],C[0]),T[1]=Math.max(E[1],C[1]),T[2]=Math.max(E[2],C[2]),T[3]=Math.max(E[3],C[3]),T},Zt.round=function(T,E){return T[0]=Math.round(E[0]),T[1]=Math.round(E[1]),T[2]=Math.round(E[2]),T[3]=Math.round(E[3]),T},Zt.scale=function(T,E,C){return T[0]=E[0]*C,T[1]=E[1]*C,T[2]=E[2]*C,T[3]=E[3]*C,T},Zt.scaleAndAdd=function(T,E,C,O){return T[0]=E[0]+C[0]*O,T[1]=E[1]+C[1]*O,T[2]=E[2]+C[2]*O,T[3]=E[3]+C[3]*O,T},Zt.distance=y,Zt.squaredDistance=b,Zt.length=S,Zt.squaredLength=_,Zt.negate=function(T,E){return T[0]=-E[0],T[1]=-E[1],T[2]=-E[2],T[3]=-E[3],T},Zt.inverse=function(T,E){return T[0]=1/E[0],T[1]=1/E[1],T[2]=1/E[2],T[3]=1/E[3],T},Zt.normalize=function(T,E){var C=E[0],O=E[1],k=E[2],U=E[3],V=C*C+O*O+k*k+U*U;return V>0&&(V=1/Math.sqrt(V)),T[0]=C*V,T[1]=O*V,T[2]=k*V,T[3]=U*V,T},Zt.dot=function(T,E){return T[0]*E[0]+T[1]*E[1]+T[2]*E[2]+T[3]*E[3]},Zt.cross=function(T,E,C,O){var k=C[0]*O[1]-C[1]*O[0],U=C[0]*O[2]-C[2]*O[0],V=C[0]*O[3]-C[3]*O[0],N=C[1]*O[2]-C[2]*O[1],$=C[1]*O[3]-C[3]*O[1],W=C[2]*O[3]-C[3]*O[2],K=E[0],ae=E[1],ie=E[2],se=E[3];return T[0]=ae*W-ie*$+se*N,T[1]=-K*W+ie*V-se*U,T[2]=K*$-ae*V+se*k,T[3]=-K*N+ae*U-ie*k,T},Zt.lerp=function(T,E,C,O){var k=E[0],U=E[1],V=E[2],N=E[3];return T[0]=k+O*(C[0]-k),T[1]=U+O*(C[1]-U),T[2]=V+O*(C[2]-V),T[3]=N+O*(C[3]-N),T},Zt.random=function(T,E){var C,O,k,U,V,N;E=E||1;do V=(C=2*e.RANDOM()-1)*C+(O=2*e.RANDOM()-1)*O;while(V>=1);do N=(k=2*e.RANDOM()-1)*k+(U=2*e.RANDOM()-1)*U;while(N>=1);var $=Math.sqrt((1-V)/N);return T[0]=E*C,T[1]=E*O,T[2]=E*k*$,T[3]=E*U*$,T},Zt.transformMat4=function(T,E,C){var O=E[0],k=E[1],U=E[2],V=E[3];return T[0]=C[0]*O+C[4]*k+C[8]*U+C[12]*V,T[1]=C[1]*O+C[5]*k+C[9]*U+C[13]*V,T[2]=C[2]*O+C[6]*k+C[10]*U+C[14]*V,T[3]=C[3]*O+C[7]*k+C[11]*U+C[15]*V,T},Zt.transformQuat=function(T,E,C){var O=E[0],k=E[1],U=E[2],V=C[0],N=C[1],$=C[2],W=C[3],K=W*O+N*U-$*k,ae=W*k+$*O-V*U,ie=W*U+V*k-N*O,se=-V*O-N*k-$*U;return T[0]=K*W+se*-V+ae*-$-ie*-N,T[1]=ae*W+se*-N+ie*-V-K*-$,T[2]=ie*W+se*-$+K*-N-ae*-V,T[3]=E[3],T},Zt.zero=function(T){return T[0]=0,T[1]=0,T[2]=0,T[3]=0,T},Zt.str=function(T){return"vec4("+T[0]+", "+T[1]+", "+T[2]+", "+T[3]+")"},Zt.exactEquals=function(T,E){return T[0]===E[0]&&T[1]===E[1]&&T[2]===E[2]&&T[3]===E[3]},Zt.equals=function(T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=E[0],N=E[1],$=E[2],W=E[3];return Math.abs(C-V)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(V))&&Math.abs(O-N)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(N))&&Math.abs(k-$)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs($))&&Math.abs(U-W)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(W))},Zt.forEach=Zt.sqrLen=Zt.len=Zt.sqrDist=Zt.dist=Zt.div=Zt.mul=Zt.sub=void 0;var e=function(T,E){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var C=r(void 0);if(C&&C.has(T))return C.get(T);var O={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(U!=="default"&&Object.prototype.hasOwnProperty.call(T,U)){var V=k?Object.getOwnPropertyDescriptor(T,U):null;V&&(V.get||V.set)?Object.defineProperty(O,U,V):O[U]=T[U]}return O.default=T,C&&C.set(T,O),O}(ne());function r(T){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(r=function(O){return O?C:E})(T)}function a(){var T=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0,T[2]=0,T[3]=0),T}function u(T,E,C){return T[0]=E[0]-C[0],T[1]=E[1]-C[1],T[2]=E[2]-C[2],T[3]=E[3]-C[3],T}function l(T,E,C){return T[0]=E[0]*C[0],T[1]=E[1]*C[1],T[2]=E[2]*C[2],T[3]=E[3]*C[3],T}function f(T,E,C){return T[0]=E[0]/C[0],T[1]=E[1]/C[1],T[2]=E[2]/C[2],T[3]=E[3]/C[3],T}function y(T,E){return Math.hypot(E[0]-T[0],E[1]-T[1],E[2]-T[2],E[3]-T[3])}function b(T,E){var C=E[0]-T[0],O=E[1]-T[1],k=E[2]-T[2],U=E[3]-T[3];return C*C+O*O+k*k+U*U}function S(T){return Math.hypot(T[0],T[1],T[2],T[3])}function _(T){var E=T[0],C=T[1],O=T[2],k=T[3];return E*E+C*C+O*O+k*k}Zt.sub=u,Zt.mul=l,Zt.div=f,Zt.dist=y,Zt.sqrDist=b,Zt.len=S,Zt.sqrLen=_;var w,A=(w=a(),function(T,E,C,O,k,U){var V,N;for(E||(E=4),C||(C=0),N=O?Math.min(O*E+C,T.length):T.length,V=C;V<N;V+=E)w[0]=T[V],w[1]=T[V+1],w[2]=T[V+2],w[3]=T[V+3],k(w,w,U),T[V]=w[0],T[V+1]=w[1],T[V+2]=w[2],T[V+3]=w[3];return T});return Zt.forEach=A,Zt}function yr(){if(zr)return ot;function o(le){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(xe){return typeof xe}:function(xe){return xe&&typeof Symbol=="function"&&xe.constructor===Symbol&&xe!==Symbol.prototype?"symbol":typeof xe},o(le)}zr=1,Object.defineProperty(ot,"__esModule",{value:!0}),ot.create=y,ot.identity=function(le){return le[0]=0,le[1]=0,le[2]=0,le[3]=1,le},ot.setAxisAngle=b,ot.getAxisAngle=function(le,xe){var Me=2*Math.acos(xe[3]),Se=Math.sin(Me/2);return Se>e.EPSILON?(le[0]=xe[0]/Se,le[1]=xe[1]/Se,le[2]=xe[2]/Se):(le[0]=1,le[1]=0,le[2]=0),Me},ot.getAngle=function(le,xe){var Me=C(le,xe);return Math.acos(2*Me*Me-1)},ot.multiply=S,ot.rotateX=function(le,xe,Me){Me*=.5;var Se=xe[0],Ce=xe[1],Ie=xe[2],Fe=xe[3],ze=Math.sin(Me),Ne=Math.cos(Me);return le[0]=Se*Ne+Fe*ze,le[1]=Ce*Ne+Ie*ze,le[2]=Ie*Ne-Ce*ze,le[3]=Fe*Ne-Se*ze,le},ot.rotateY=function(le,xe,Me){Me*=.5;var Se=xe[0],Ce=xe[1],Ie=xe[2],Fe=xe[3],ze=Math.sin(Me),Ne=Math.cos(Me);return le[0]=Se*Ne-Ie*ze,le[1]=Ce*Ne+Fe*ze,le[2]=Ie*Ne+Se*ze,le[3]=Fe*Ne-Ce*ze,le},ot.rotateZ=function(le,xe,Me){Me*=.5;var Se=xe[0],Ce=xe[1],Ie=xe[2],Fe=xe[3],ze=Math.sin(Me),Ne=Math.cos(Me);return le[0]=Se*Ne+Ce*ze,le[1]=Ce*Ne-Se*ze,le[2]=Ie*Ne+Fe*ze,le[3]=Fe*Ne-Ie*ze,le},ot.calculateW=function(le,xe){var Me=xe[0],Se=xe[1],Ce=xe[2];return le[0]=Me,le[1]=Se,le[2]=Ce,le[3]=Math.sqrt(Math.abs(1-Me*Me-Se*Se-Ce*Ce)),le},ot.exp=_,ot.ln=w,ot.pow=function(le,xe,Me){return w(le,xe),E(le,le,Me),_(le,le),le},ot.slerp=A,ot.random=function(le){var xe=e.RANDOM(),Me=e.RANDOM(),Se=e.RANDOM(),Ce=Math.sqrt(1-xe),Ie=Math.sqrt(xe);return le[0]=Ce*Math.sin(2*Math.PI*Me),le[1]=Ce*Math.cos(2*Math.PI*Me),le[2]=Ie*Math.sin(2*Math.PI*Se),le[3]=Ie*Math.cos(2*Math.PI*Se),le},ot.invert=function(le,xe){var Me=xe[0],Se=xe[1],Ce=xe[2],Ie=xe[3],Fe=Me*Me+Se*Se+Ce*Ce+Ie*Ie,ze=Fe?1/Fe:0;return le[0]=-Me*ze,le[1]=-Se*ze,le[2]=-Ce*ze,le[3]=Ie*ze,le},ot.conjugate=function(le,xe){return le[0]=-xe[0],le[1]=-xe[1],le[2]=-xe[2],le[3]=xe[3],le},ot.fromMat3=T,ot.fromEuler=function(le,xe,Me,Se){var Ce=.5*Math.PI/180;xe*=Ce,Me*=Ce,Se*=Ce;var Ie=Math.sin(xe),Fe=Math.cos(xe),ze=Math.sin(Me),Ne=Math.cos(Me),it=Math.sin(Se),nt=Math.cos(Se);return le[0]=Ie*Ne*nt-Fe*ze*it,le[1]=Fe*ze*nt+Ie*Ne*it,le[2]=Fe*Ne*it-Ie*ze*nt,le[3]=Fe*Ne*nt+Ie*ze*it,le},ot.str=function(le){return"quat("+le[0]+", "+le[1]+", "+le[2]+", "+le[3]+")"},ot.setAxes=ot.sqlerp=ot.rotationTo=ot.equals=ot.exactEquals=ot.normalize=ot.sqrLen=ot.squaredLength=ot.len=ot.length=ot.lerp=ot.dot=ot.scale=ot.mul=ot.add=ot.set=ot.copy=ot.fromValues=ot.clone=void 0;var e=f(ne()),r=f(ht()),a=f(yt()),u=f(Ir());function l(le){if(typeof WeakMap!="function")return null;var xe=new WeakMap,Me=new WeakMap;return(l=function(Se){return Se?Me:xe})(le)}function f(le,xe){if(le&&le.__esModule)return le;if(le===null||o(le)!=="object"&&typeof le!="function")return{default:le};var Me=l(xe);if(Me&&Me.has(le))return Me.get(le);var Se={},Ce=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Ie in le)if(Ie!=="default"&&Object.prototype.hasOwnProperty.call(le,Ie)){var Fe=Ce?Object.getOwnPropertyDescriptor(le,Ie):null;Fe&&(Fe.get||Fe.set)?Object.defineProperty(Se,Ie,Fe):Se[Ie]=le[Ie]}return Se.default=le,Me&&Me.set(le,Se),Se}function y(){var le=new e.ARRAY_TYPE(4);return e.ARRAY_TYPE!=Float32Array&&(le[0]=0,le[1]=0,le[2]=0),le[3]=1,le}function b(le,xe,Me){Me*=.5;var Se=Math.sin(Me);return le[0]=Se*xe[0],le[1]=Se*xe[1],le[2]=Se*xe[2],le[3]=Math.cos(Me),le}function S(le,xe,Me){var Se=xe[0],Ce=xe[1],Ie=xe[2],Fe=xe[3],ze=Me[0],Ne=Me[1],it=Me[2],nt=Me[3];return le[0]=Se*nt+Fe*ze+Ce*it-Ie*Ne,le[1]=Ce*nt+Fe*Ne+Ie*ze-Se*it,le[2]=Ie*nt+Fe*it+Se*Ne-Ce*ze,le[3]=Fe*nt-Se*ze-Ce*Ne-Ie*it,le}function _(le,xe){var Me=xe[0],Se=xe[1],Ce=xe[2],Ie=xe[3],Fe=Math.sqrt(Me*Me+Se*Se+Ce*Ce),ze=Math.exp(Ie),Ne=Fe>0?ze*Math.sin(Fe)/Fe:0;return le[0]=Me*Ne,le[1]=Se*Ne,le[2]=Ce*Ne,le[3]=ze*Math.cos(Fe),le}function w(le,xe){var Me=xe[0],Se=xe[1],Ce=xe[2],Ie=xe[3],Fe=Math.sqrt(Me*Me+Se*Se+Ce*Ce),ze=Fe>0?Math.atan2(Fe,Ie)/Fe:0;return le[0]=Me*ze,le[1]=Se*ze,le[2]=Ce*ze,le[3]=.5*Math.log(Me*Me+Se*Se+Ce*Ce+Ie*Ie),le}function A(le,xe,Me,Se){var Ce,Ie,Fe,ze,Ne,it=xe[0],nt=xe[1],Bt=xe[2],ft=xe[3],Tt=Me[0],at=Me[1],tr=Me[2],Ot=Me[3];return(Ie=it*Tt+nt*at+Bt*tr+ft*Ot)<0&&(Ie=-Ie,Tt=-Tt,at=-at,tr=-tr,Ot=-Ot),1-Ie>e.EPSILON?(Ce=Math.acos(Ie),Fe=Math.sin(Ce),ze=Math.sin((1-Se)*Ce)/Fe,Ne=Math.sin(Se*Ce)/Fe):(ze=1-Se,Ne=Se),le[0]=ze*it+Ne*Tt,le[1]=ze*nt+Ne*at,le[2]=ze*Bt+Ne*tr,le[3]=ze*ft+Ne*Ot,le}function T(le,xe){var Me,Se=xe[0]+xe[4]+xe[8];if(Se>0)Me=Math.sqrt(Se+1),le[3]=.5*Me,le[0]=(xe[5]-xe[7])*(Me=.5/Me),le[1]=(xe[6]-xe[2])*Me,le[2]=(xe[1]-xe[3])*Me;else{var Ce=0;xe[4]>xe[0]&&(Ce=1),xe[8]>xe[3*Ce+Ce]&&(Ce=2);var Ie=(Ce+1)%3,Fe=(Ce+2)%3;Me=Math.sqrt(xe[3*Ce+Ce]-xe[3*Ie+Ie]-xe[3*Fe+Fe]+1),le[Ce]=.5*Me,le[3]=(xe[3*Ie+Fe]-xe[3*Fe+Ie])*(Me=.5/Me),le[Ie]=(xe[3*Ie+Ce]+xe[3*Ce+Ie])*Me,le[Fe]=(xe[3*Fe+Ce]+xe[3*Ce+Fe])*Me}return le}ot.clone=u.clone,ot.fromValues=u.fromValues,ot.copy=u.copy,ot.set=u.set,ot.add=u.add,ot.mul=S;var E=u.scale;ot.scale=E;var C=u.dot;ot.dot=C,ot.lerp=u.lerp;var O=u.length;ot.length=O,ot.len=O;var k=u.squaredLength;ot.squaredLength=k,ot.sqrLen=k;var U=u.normalize;ot.normalize=U,ot.exactEquals=u.exactEquals,ot.equals=u.equals;var V,N,$,W=(V=a.create(),N=a.fromValues(1,0,0),$=a.fromValues(0,1,0),function(le,xe,Me){var Se=a.dot(xe,Me);return Se<-.999999?(a.cross(V,N,xe),a.len(V)<1e-6&&a.cross(V,$,xe),a.normalize(V,V),b(le,V,Math.PI),le):Se>.999999?(le[0]=0,le[1]=0,le[2]=0,le[3]=1,le):(a.cross(V,xe,Me),le[0]=V[0],le[1]=V[1],le[2]=V[2],le[3]=1+Se,U(le,le))});ot.rotationTo=W;var K,ae,ie=(K=y(),ae=y(),function(le,xe,Me,Se,Ce,Ie){return A(K,xe,Ce,Ie),A(ae,Me,Se,Ie),A(le,K,ae,2*Ie*(1-Ie)),le});ot.sqlerp=ie;var se,ve=(se=r.create(),function(le,xe,Me,Se){return se[0]=Me[0],se[3]=Me[1],se[6]=Me[2],se[1]=Se[0],se[4]=Se[1],se[7]=Se[2],se[2]=-xe[0],se[5]=-xe[1],se[8]=-xe[2],U(le,T(le,se))});return ot.setAxes=ve,ot}var Nr,ar={};function Gr(){if(Nr)return ar;function o(A){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},o(A)}Nr=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.create=function(){var A=new e.ARRAY_TYPE(8);return e.ARRAY_TYPE!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[4]=0,A[5]=0,A[6]=0,A[7]=0),A[3]=1,A},ar.clone=function(A){var T=new e.ARRAY_TYPE(8);return T[0]=A[0],T[1]=A[1],T[2]=A[2],T[3]=A[3],T[4]=A[4],T[5]=A[5],T[6]=A[6],T[7]=A[7],T},ar.fromValues=function(A,T,E,C,O,k,U,V){var N=new e.ARRAY_TYPE(8);return N[0]=A,N[1]=T,N[2]=E,N[3]=C,N[4]=O,N[5]=k,N[6]=U,N[7]=V,N},ar.fromRotationTranslationValues=function(A,T,E,C,O,k,U){var V=new e.ARRAY_TYPE(8);V[0]=A,V[1]=T,V[2]=E,V[3]=C;var N=.5*O,$=.5*k,W=.5*U;return V[4]=N*C+$*E-W*T,V[5]=$*C+W*A-N*E,V[6]=W*C+N*T-$*A,V[7]=-N*A-$*T-W*E,V},ar.fromRotationTranslation=f,ar.fromTranslation=function(A,T){return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A[4]=.5*T[0],A[5]=.5*T[1],A[6]=.5*T[2],A[7]=0,A},ar.fromRotation=function(A,T){return A[0]=T[0],A[1]=T[1],A[2]=T[2],A[3]=T[3],A[4]=0,A[5]=0,A[6]=0,A[7]=0,A},ar.fromMat4=function(A,T){var E=r.create();a.getRotation(E,T);var C=new e.ARRAY_TYPE(3);return a.getTranslation(C,T),f(A,E,C),A},ar.copy=y,ar.identity=function(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A[4]=0,A[5]=0,A[6]=0,A[7]=0,A},ar.set=function(A,T,E,C,O,k,U,V,N){return A[0]=T,A[1]=E,A[2]=C,A[3]=O,A[4]=k,A[5]=U,A[6]=V,A[7]=N,A},ar.getDual=function(A,T){return A[0]=T[4],A[1]=T[5],A[2]=T[6],A[3]=T[7],A},ar.setDual=function(A,T){return A[4]=T[0],A[5]=T[1],A[6]=T[2],A[7]=T[3],A},ar.getTranslation=function(A,T){var E=T[4],C=T[5],O=T[6],k=T[7],U=-T[0],V=-T[1],N=-T[2],$=T[3];return A[0]=2*(E*$+k*U+C*N-O*V),A[1]=2*(C*$+k*V+O*U-E*N),A[2]=2*(O*$+k*N+E*V-C*U),A},ar.translate=function(A,T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=.5*E[0],N=.5*E[1],$=.5*E[2],W=T[4],K=T[5],ae=T[6],ie=T[7];return A[0]=C,A[1]=O,A[2]=k,A[3]=U,A[4]=U*V+O*$-k*N+W,A[5]=U*N+k*V-C*$+K,A[6]=U*$+C*N-O*V+ae,A[7]=-C*V-O*N-k*$+ie,A},ar.rotateX=function(A,T,E){var C=-T[0],O=-T[1],k=-T[2],U=T[3],V=T[4],N=T[5],$=T[6],W=T[7],K=V*U+W*C+N*k-$*O,ae=N*U+W*O+$*C-V*k,ie=$*U+W*k+V*O-N*C,se=W*U-V*C-N*O-$*k;return r.rotateX(A,T,E),A[4]=K*(U=A[3])+se*(C=A[0])+ae*(k=A[2])-ie*(O=A[1]),A[5]=ae*U+se*O+ie*C-K*k,A[6]=ie*U+se*k+K*O-ae*C,A[7]=se*U-K*C-ae*O-ie*k,A},ar.rotateY=function(A,T,E){var C=-T[0],O=-T[1],k=-T[2],U=T[3],V=T[4],N=T[5],$=T[6],W=T[7],K=V*U+W*C+N*k-$*O,ae=N*U+W*O+$*C-V*k,ie=$*U+W*k+V*O-N*C,se=W*U-V*C-N*O-$*k;return r.rotateY(A,T,E),A[4]=K*(U=A[3])+se*(C=A[0])+ae*(k=A[2])-ie*(O=A[1]),A[5]=ae*U+se*O+ie*C-K*k,A[6]=ie*U+se*k+K*O-ae*C,A[7]=se*U-K*C-ae*O-ie*k,A},ar.rotateZ=function(A,T,E){var C=-T[0],O=-T[1],k=-T[2],U=T[3],V=T[4],N=T[5],$=T[6],W=T[7],K=V*U+W*C+N*k-$*O,ae=N*U+W*O+$*C-V*k,ie=$*U+W*k+V*O-N*C,se=W*U-V*C-N*O-$*k;return r.rotateZ(A,T,E),A[4]=K*(U=A[3])+se*(C=A[0])+ae*(k=A[2])-ie*(O=A[1]),A[5]=ae*U+se*O+ie*C-K*k,A[6]=ie*U+se*k+K*O-ae*C,A[7]=se*U-K*C-ae*O-ie*k,A},ar.rotateByQuatAppend=function(A,T,E){var C=E[0],O=E[1],k=E[2],U=E[3],V=T[0],N=T[1],$=T[2],W=T[3];return A[0]=V*U+W*C+N*k-$*O,A[1]=N*U+W*O+$*C-V*k,A[2]=$*U+W*k+V*O-N*C,A[3]=W*U-V*C-N*O-$*k,A[4]=(V=T[4])*U+(W=T[7])*C+(N=T[5])*k-($=T[6])*O,A[5]=N*U+W*O+$*C-V*k,A[6]=$*U+W*k+V*O-N*C,A[7]=W*U-V*C-N*O-$*k,A},ar.rotateByQuatPrepend=function(A,T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=E[0],N=E[1],$=E[2],W=E[3];return A[0]=C*W+U*V+O*$-k*N,A[1]=O*W+U*N+k*V-C*$,A[2]=k*W+U*$+C*N-O*V,A[3]=U*W-C*V-O*N-k*$,A[4]=C*(W=E[7])+U*(V=E[4])+O*($=E[6])-k*(N=E[5]),A[5]=O*W+U*N+k*V-C*$,A[6]=k*W+U*$+C*N-O*V,A[7]=U*W-C*V-O*N-k*$,A},ar.rotateAroundAxis=function(A,T,E,C){if(Math.abs(C)<e.EPSILON)return y(A,T);var O=Math.hypot(E[0],E[1],E[2]);C*=.5;var k=Math.sin(C),U=k*E[0]/O,V=k*E[1]/O,N=k*E[2]/O,$=Math.cos(C),W=T[0],K=T[1],ae=T[2],ie=T[3];A[0]=W*$+ie*U+K*N-ae*V,A[1]=K*$+ie*V+ae*U-W*N,A[2]=ae*$+ie*N+W*V-K*U,A[3]=ie*$-W*U-K*V-ae*N;var se=T[4],ve=T[5],le=T[6],xe=T[7];return A[4]=se*$+xe*U+ve*N-le*V,A[5]=ve*$+xe*V+le*U-se*N,A[6]=le*$+xe*N+se*V-ve*U,A[7]=xe*$-se*U-ve*V-le*N,A},ar.add=function(A,T,E){return A[0]=T[0]+E[0],A[1]=T[1]+E[1],A[2]=T[2]+E[2],A[3]=T[3]+E[3],A[4]=T[4]+E[4],A[5]=T[5]+E[5],A[6]=T[6]+E[6],A[7]=T[7]+E[7],A},ar.multiply=b,ar.scale=function(A,T,E){return A[0]=T[0]*E,A[1]=T[1]*E,A[2]=T[2]*E,A[3]=T[3]*E,A[4]=T[4]*E,A[5]=T[5]*E,A[6]=T[6]*E,A[7]=T[7]*E,A},ar.lerp=function(A,T,E,C){var O=1-C;return S(T,E)<0&&(C=-C),A[0]=T[0]*O+E[0]*C,A[1]=T[1]*O+E[1]*C,A[2]=T[2]*O+E[2]*C,A[3]=T[3]*O+E[3]*C,A[4]=T[4]*O+E[4]*C,A[5]=T[5]*O+E[5]*C,A[6]=T[6]*O+E[6]*C,A[7]=T[7]*O+E[7]*C,A},ar.invert=function(A,T){var E=w(T);return A[0]=-T[0]/E,A[1]=-T[1]/E,A[2]=-T[2]/E,A[3]=T[3]/E,A[4]=-T[4]/E,A[5]=-T[5]/E,A[6]=-T[6]/E,A[7]=T[7]/E,A},ar.conjugate=function(A,T){return A[0]=-T[0],A[1]=-T[1],A[2]=-T[2],A[3]=T[3],A[4]=-T[4],A[5]=-T[5],A[6]=-T[6],A[7]=T[7],A},ar.normalize=function(A,T){var E=w(T);if(E>0){E=Math.sqrt(E);var C=T[0]/E,O=T[1]/E,k=T[2]/E,U=T[3]/E,V=T[4],N=T[5],$=T[6],W=T[7],K=C*V+O*N+k*$+U*W;A[0]=C,A[1]=O,A[2]=k,A[3]=U,A[4]=(V-C*K)/E,A[5]=(N-O*K)/E,A[6]=($-k*K)/E,A[7]=(W-U*K)/E}return A},ar.str=function(A){return"quat2("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+", "+A[4]+", "+A[5]+", "+A[6]+", "+A[7]+")"},ar.exactEquals=function(A,T){return A[0]===T[0]&&A[1]===T[1]&&A[2]===T[2]&&A[3]===T[3]&&A[4]===T[4]&&A[5]===T[5]&&A[6]===T[6]&&A[7]===T[7]},ar.equals=function(A,T){var E=A[0],C=A[1],O=A[2],k=A[3],U=A[4],V=A[5],N=A[6],$=A[7],W=T[0],K=T[1],ae=T[2],ie=T[3],se=T[4],ve=T[5],le=T[6],xe=T[7];return Math.abs(E-W)<=e.EPSILON*Math.max(1,Math.abs(E),Math.abs(W))&&Math.abs(C-K)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(K))&&Math.abs(O-ae)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(ae))&&Math.abs(k-ie)<=e.EPSILON*Math.max(1,Math.abs(k),Math.abs(ie))&&Math.abs(U-se)<=e.EPSILON*Math.max(1,Math.abs(U),Math.abs(se))&&Math.abs(V-ve)<=e.EPSILON*Math.max(1,Math.abs(V),Math.abs(ve))&&Math.abs(N-le)<=e.EPSILON*Math.max(1,Math.abs(N),Math.abs(le))&&Math.abs($-xe)<=e.EPSILON*Math.max(1,Math.abs($),Math.abs(xe))},ar.sqrLen=ar.squaredLength=ar.len=ar.length=ar.dot=ar.mul=ar.setReal=ar.getReal=void 0;var e=l(ne()),r=l(yr()),a=l(Et());function u(A){if(typeof WeakMap!="function")return null;var T=new WeakMap,E=new WeakMap;return(u=function(C){return C?E:T})(A)}function l(A,T){if(A&&A.__esModule)return A;if(A===null||o(A)!=="object"&&typeof A!="function")return{default:A};var E=u(T);if(E&&E.has(A))return E.get(A);var C={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var k in A)if(k!=="default"&&Object.prototype.hasOwnProperty.call(A,k)){var U=O?Object.getOwnPropertyDescriptor(A,k):null;U&&(U.get||U.set)?Object.defineProperty(C,k,U):C[k]=A[k]}return C.default=A,E&&E.set(A,C),C}function f(A,T,E){var C=.5*E[0],O=.5*E[1],k=.5*E[2],U=T[0],V=T[1],N=T[2],$=T[3];return A[0]=U,A[1]=V,A[2]=N,A[3]=$,A[4]=C*$+O*N-k*V,A[5]=O*$+k*U-C*N,A[6]=k*$+C*V-O*U,A[7]=-C*U-O*V-k*N,A}function y(A,T){return A[0]=T[0],A[1]=T[1],A[2]=T[2],A[3]=T[3],A[4]=T[4],A[5]=T[5],A[6]=T[6],A[7]=T[7],A}function b(A,T,E){var C=T[0],O=T[1],k=T[2],U=T[3],V=E[4],N=E[5],$=E[6],W=E[7],K=T[4],ae=T[5],ie=T[6],se=T[7],ve=E[0],le=E[1],xe=E[2],Me=E[3];return A[0]=C*Me+U*ve+O*xe-k*le,A[1]=O*Me+U*le+k*ve-C*xe,A[2]=k*Me+U*xe+C*le-O*ve,A[3]=U*Me-C*ve-O*le-k*xe,A[4]=C*W+U*V+O*$-k*N+K*Me+se*ve+ae*xe-ie*le,A[5]=O*W+U*N+k*V-C*$+ae*Me+se*le+ie*ve-K*xe,A[6]=k*W+U*$+C*N-O*V+ie*Me+se*xe+K*le-ae*ve,A[7]=U*W-C*V-O*N-k*$+se*Me-K*ve-ae*le-ie*xe,A}ar.getReal=r.copy,ar.setReal=r.copy,ar.mul=b;var S=r.dot;ar.dot=S;var _=r.length;ar.length=_,ar.len=_;var w=r.squaredLength;return ar.squaredLength=w,ar.sqrLen=w,ar}var cr,rr,$t={};function vi(){if(cr)return $t;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},o(T)}cr=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.create=a,$t.clone=function(T){var E=new e.ARRAY_TYPE(2);return E[0]=T[0],E[1]=T[1],E},$t.fromValues=function(T,E){var C=new e.ARRAY_TYPE(2);return C[0]=T,C[1]=E,C},$t.copy=function(T,E){return T[0]=E[0],T[1]=E[1],T},$t.set=function(T,E,C){return T[0]=E,T[1]=C,T},$t.add=function(T,E,C){return T[0]=E[0]+C[0],T[1]=E[1]+C[1],T},$t.subtract=u,$t.multiply=l,$t.divide=f,$t.ceil=function(T,E){return T[0]=Math.ceil(E[0]),T[1]=Math.ceil(E[1]),T},$t.floor=function(T,E){return T[0]=Math.floor(E[0]),T[1]=Math.floor(E[1]),T},$t.min=function(T,E,C){return T[0]=Math.min(E[0],C[0]),T[1]=Math.min(E[1],C[1]),T},$t.max=function(T,E,C){return T[0]=Math.max(E[0],C[0]),T[1]=Math.max(E[1],C[1]),T},$t.round=function(T,E){return T[0]=Math.round(E[0]),T[1]=Math.round(E[1]),T},$t.scale=function(T,E,C){return T[0]=E[0]*C,T[1]=E[1]*C,T},$t.scaleAndAdd=function(T,E,C,O){return T[0]=E[0]+C[0]*O,T[1]=E[1]+C[1]*O,T},$t.distance=y,$t.squaredDistance=b,$t.length=S,$t.squaredLength=_,$t.negate=function(T,E){return T[0]=-E[0],T[1]=-E[1],T},$t.inverse=function(T,E){return T[0]=1/E[0],T[1]=1/E[1],T},$t.normalize=function(T,E){var C=E[0],O=E[1],k=C*C+O*O;return k>0&&(k=1/Math.sqrt(k)),T[0]=E[0]*k,T[1]=E[1]*k,T},$t.dot=function(T,E){return T[0]*E[0]+T[1]*E[1]},$t.cross=function(T,E,C){var O=E[0]*C[1]-E[1]*C[0];return T[0]=T[1]=0,T[2]=O,T},$t.lerp=function(T,E,C,O){var k=E[0],U=E[1];return T[0]=k+O*(C[0]-k),T[1]=U+O*(C[1]-U),T},$t.random=function(T,E){E=E||1;var C=2*e.RANDOM()*Math.PI;return T[0]=Math.cos(C)*E,T[1]=Math.sin(C)*E,T},$t.transformMat2=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[2]*k,T[1]=C[1]*O+C[3]*k,T},$t.transformMat2d=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[2]*k+C[4],T[1]=C[1]*O+C[3]*k+C[5],T},$t.transformMat3=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[3]*k+C[6],T[1]=C[1]*O+C[4]*k+C[7],T},$t.transformMat4=function(T,E,C){var O=E[0],k=E[1];return T[0]=C[0]*O+C[4]*k+C[12],T[1]=C[1]*O+C[5]*k+C[13],T},$t.rotate=function(T,E,C,O){var k=E[0]-C[0],U=E[1]-C[1],V=Math.sin(O),N=Math.cos(O);return T[0]=k*N-U*V+C[0],T[1]=k*V+U*N+C[1],T},$t.angle=function(T,E){var C=T[0],O=T[1],k=E[0],U=E[1],V=Math.sqrt(C*C+O*O)*Math.sqrt(k*k+U*U);return Math.acos(Math.min(Math.max(V&&(C*k+O*U)/V,-1),1))},$t.zero=function(T){return T[0]=0,T[1]=0,T},$t.str=function(T){return"vec2("+T[0]+", "+T[1]+")"},$t.exactEquals=function(T,E){return T[0]===E[0]&&T[1]===E[1]},$t.equals=function(T,E){var C=T[0],O=T[1],k=E[0],U=E[1];return Math.abs(C-k)<=e.EPSILON*Math.max(1,Math.abs(C),Math.abs(k))&&Math.abs(O-U)<=e.EPSILON*Math.max(1,Math.abs(O),Math.abs(U))},$t.forEach=$t.sqrLen=$t.sqrDist=$t.dist=$t.div=$t.mul=$t.sub=$t.len=void 0;var e=function(T,E){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var C=r(void 0);if(C&&C.has(T))return C.get(T);var O={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(U!=="default"&&Object.prototype.hasOwnProperty.call(T,U)){var V=k?Object.getOwnPropertyDescriptor(T,U):null;V&&(V.get||V.set)?Object.defineProperty(O,U,V):O[U]=T[U]}return O.default=T,C&&C.set(T,O),O}(ne());function r(T){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(r=function(O){return O?C:E})(T)}function a(){var T=new e.ARRAY_TYPE(2);return e.ARRAY_TYPE!=Float32Array&&(T[0]=0,T[1]=0),T}function u(T,E,C){return T[0]=E[0]-C[0],T[1]=E[1]-C[1],T}function l(T,E,C){return T[0]=E[0]*C[0],T[1]=E[1]*C[1],T}function f(T,E,C){return T[0]=E[0]/C[0],T[1]=E[1]/C[1],T}function y(T,E){return Math.hypot(E[0]-T[0],E[1]-T[1])}function b(T,E){var C=E[0]-T[0],O=E[1]-T[1];return C*C+O*O}function S(T){return Math.hypot(T[0],T[1])}function _(T){var E=T[0],C=T[1];return E*E+C*C}$t.len=S,$t.sub=u,$t.mul=l,$t.div=f,$t.dist=y,$t.sqrDist=b,$t.sqrLen=_;var w,A=(w=a(),function(T,E,C,O,k,U){var V,N;for(E||(E=2),C||(C=0),N=O?Math.min(O*E+C,T.length):T.length,V=C;V<N;V+=E)w[0]=T[V],w[1]=T[V+1],k(w,w,U),T[V]=w[0],T[V+1]=w[1];return T});return $t.forEach=A,$t}function hi(){if(rr)return q;function o(T){return o=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(E){return typeof E}:function(E){return E&&typeof Symbol=="function"&&E.constructor===Symbol&&E!==Symbol.prototype?"symbol":typeof E},o(T)}rr=1,Object.defineProperty(q,"__esModule",{value:!0}),q.vec4=q.vec3=q.vec2=q.quat2=q.quat=q.mat4=q.mat3=q.mat2d=q.mat2=q.glMatrix=void 0;var e=A(ne());q.glMatrix=e;var r=A(ye());q.mat2=r;var a=A(vt());q.mat2d=a;var u=A(ht());q.mat3=u;var l=A(Et());q.mat4=l;var f=A(yr());q.quat=f;var y=A(Gr());q.quat2=y;var b=A(vi());q.vec2=b;var S=A(yt());q.vec3=S;var _=A(Ir());function w(T){if(typeof WeakMap!="function")return null;var E=new WeakMap,C=new WeakMap;return(w=function(O){return O?C:E})(T)}function A(T,E){if(T&&T.__esModule)return T;if(T===null||o(T)!=="object"&&typeof T!="function")return{default:T};var C=w(E);if(C&&C.has(T))return C.get(T);var O={},k=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var U in T)if(U!=="default"&&Object.prototype.hasOwnProperty.call(T,U)){var V=k?Object.getOwnPropertyDescriptor(T,U):null;V&&(V.get||V.set)?Object.defineProperty(O,U,V):O[U]=T[U]}return O.default=T,C&&C.set(T,O),O}return q.vec4=_,q}var pn,Pt,er,Kt,te=hi(),mn=function(){if(Pt)return pn;function o(e,r,a,u){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(u-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=a,this.p2y=u}return Pt=1,pn=o,o.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,r){if(r===void 0&&(r=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,u=0;u<8;u++){var l=this.sampleCurveX(a)-e;if(Math.abs(l)<r)return a;var f=this.sampleCurveDerivativeX(a);if(Math.abs(f)<1e-6)break;a-=l/f}var y=0,b=1;for(a=e,u=0;u<20&&(l=this.sampleCurveX(a),!(Math.abs(l-e)<r));u++)e>l?y=a:b=a,a=.5*(b-y)+y;return a},solve:function(e,r){return this.sampleCurveY(this.solveCurveX(e,r))}},pn}(),ke=G(mn);function Ve(){if(Kt)return er;function o(e,r){this.x=e,this.y=r}return Kt=1,er=o,o.prototype={clone:function(){return new o(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,r){return this.clone()._rotateAround(e,r)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var r=e.x-this.x,a=e.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,r){return Math.atan2(this.x*r-this.y*e,this.x*e+this.y*r)},_matMult:function(e){var r=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var r=Math.cos(e),a=Math.sin(e),u=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=u,this},_rotateAround:function(e,r){var a=Math.cos(e),u=Math.sin(e),l=r.y+u*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-u*(this.y-r.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(e){return e instanceof o?e:Array.isArray(e)?new o(e[0],e[1]):e},er}var Ae=G(Ve());function xt(o,e){if(Array.isArray(o)){if(!Array.isArray(e)||o.length!==e.length)return!1;for(let r=0;r<o.length;r++)if(!xt(o[r],e[r]))return!1;return!0}if(typeof o=="object"&&o!==null&&e!==null){if(typeof e!="object"||Object.keys(o).length!==Object.keys(e).length)return!1;for(const r in o)if(!xt(o[r],e[r]))return!1;return!0}return o===e}const Vt=Math.PI/180,zt=180/Math.PI;function Rt(o){return o*Vt}function jt(o){return o*zt}const Yt=[[0,0],[1,0],[1,1],[0,1]];function Gt(o){if(o<=0)return 0;if(o>=1)return 1;const e=o*o,r=e*o;return 4*(o<.5?r:3*(o-e)+r-.75)}function Cr(o,e,r,a){const u=new ke(o,e,r,a);return function(l){return u.solve(l)}}const lr=Cr(.25,.1,.25,1);function Ye(o,e,r){return Math.min(r,Math.max(e,o))}function Jt(o,e,r){return(r=Ye((r-o)/(e-o),0,1))*r*(3-2*r)}function jr(o,e,r){const a=r-e,u=((o-e)%a+a)%a+e;return u===e?r:u}function _n(o,e,r){if(!o.length)return r(null,[]);let a=o.length;const u=new Array(o.length);let l=null;o.forEach((f,y)=>{e(f,(b,S)=>{b&&(l=b),u[y]=S,--a==0&&r(l,u)})})}function Vr(o,...e){for(const r of e)for(const a in r)o[a]=r[a];return o}let xi=1;function ri(){return xi++}function Ki(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function ki(o,e){o.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function ys(o,e,r){const a={};for(const u in o)a[u]=e.call(this,o[u],u,o);return a}function vo(o,e,r){const a={};for(const u in o)e.call(this,o[u],u,o)&&(a[u]=o[u]);return a}function Kn(o){return Array.isArray(o)?o.map(Kn):typeof o=="object"&&o?ys(o,Kn):o}const Fi={};function Pr(o){Fi[o]||(typeof console<"u"&&console.warn(o),Fi[o]=!0)}function xo(o,e,r){return(r.y-o.y)*(e.x-o.x)>(e.y-o.y)*(r.x-o.x)}function vl(o){let e=0;for(let r,a,u=0,l=o.length,f=l-1;u<l;f=u++)r=o[u],a=o[f],e+=(a.x-r.x)*(r.y+a.y);return e}function vs([o,e,r]){const a=Rt(e+90),u=Rt(r);return{x:o*Math.cos(a)*Math.sin(u),y:o*Math.sin(a)*Math.sin(u),z:o*Math.cos(u),azimuthal:e,polar:r}}function Va(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Ua(o){const e={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,a,u,l)=>{const f=u||l;return e[a]=!f||f.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let Sc=null;function xl(o,e){return[o[4*e],o[4*e+1],o[4*e+2],o[4*e+3]]}function Bu(o,e,r,a){for(;e<r;){const u=e+r>>1;o[u]<a?e=u+1:r=u}return e}function Nu(o,e,r,a){for(;e<r;){const u=e+r>>1;o[u]<=a?e=u+1:r=u}return e}function Ec(o){return o>0?1/(1.001-o):1+o}function Xe(o){return o>0?1-1/(1.001-o):-o}const Y={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Y.API_URL)return null;try{const o=new URL(Y.API_URL);return o.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":o.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function re(o){return Y.API_URL_REGEX.test(o)}function de(o){return Y.API_SPRITE_REGEX.test(o)}let Te,be,Pe,Ge,Re,He;function Ke(){return Te==null&&(Te=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Te}const We={now:()=>Ge!==void 0?Ge:performance.now(),setNow(o){Ge=o},restoreNow(){Ge=void 0},frame(o){const e=requestAnimationFrame(o);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(o,e=0){const{width:r,height:a}=o;Re||(Re=document.createElement("canvas"));const u=Re.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(r>Re.width||a>Re.height)&&(Re.width=r,Re.height=a),u.clearRect(-e,-e,r+2*e,a+2*e),u.drawImage(o,0,0,r,a),u.getImageData(-e,-e,r+2*e,a+2*e)},resolveURL:o=>(be||(be=document.createElement("a")),be.href=o,be.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Pe==null&&(Pe=window.matchMedia("(prefers-reduced-motion: reduce)")),Pe.matches)},hasCanvasFingerprintNoise(){if(He!==void 0)return He;if(!Ke())return He=!1,!1;const o=new OffscreenCanvas(85,1),e=o.getContext("2d",{willReadFrequently:!0});let r=0;for(let u=0;u<o.width;++u)e.fillStyle=`rgba(${r++},${r++},${r++}, 255)`,e.fillRect(u,0,1,1);const a=e.getImageData(0,0,o.width,o.height);r=0;for(let u=0;u<a.data.length;++u)if(u%4!=3&&r++!==a.data[u])return He=!0,!0;return He=!1,!1}};function mt(o,e){const r=o.indexOf("?");if(r<0)return`${o}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(o.slice(r));for(const u in e)a.set(u,e[u]);return`${o.slice(0,r)}?${a.toString()}`}function Nt(o,e={persistentParams:[]}){const r=o.indexOf("?");if(r<0)return o;const a=new URLSearchParams,u=new URLSearchParams(o.slice(r));for(const f of e.persistentParams){const y=u.get(f);y&&a.set(f,y)}const l=a.toString();return`${o.slice(0,r)}${l.length>0?`?${l}`:""}`}const Ut="mapbox-tiles";let xr=500,Tr=50;const Er=["language","worldview","jobid"];let Ar,xn;function Bn(){try{return caches}catch{}}function Or(){const o=Bn();o&&Ar==null&&(Ar=o.open(Ut))}let ln=1/0;const on={supported:!1,testSupport:function(o){!bi&&Yn&&(Si?Bi(o):an=o)}};let an,Yn,bi=!1,Si=!1;const Fo=typeof self<"u"?self:{};function Bi(o){const e=o.createTexture();o.bindTexture(o.TEXTURE_2D,e);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Yn),o.isContextLost())return;on.supported=!0}catch{}o.deleteTexture(e),bi=!0}Fo.document&&(Yn=Fo.document.createElement("img"),Yn.onload=function(){an&&Bi(an),an=null,Si=!0},Yn.onerror=function(){bi=!0,an=null},Yn.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const pi={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(pi);class Ni extends Error{constructor(e,r,a){r===401&&re(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const fa=Va()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,xs=function(o,e){if(!(/^file:/.test(r=o.url)||/^file:/.test(fa())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,u){const l=new AbortController,f=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:fa(),referrerPolicy:a.referrerPolicy,signal:l.signal});let y=!1,b=!1;const S=(_=f.url).indexOf("sku=")>0&&re(_);var _;a.type==="json"&&f.headers.set("Accept","application/json");const w=(T,E,C)=>{if(b)return;if(T&&T.message!=="SecurityError"&&Pr(T.toString()),E&&C)return A(E);const O=Date.now();fetch(f).then(k=>{if(k.ok){const U=S?k.clone():null;return A(k,U,O)}return u(new Ni(k.statusText,k.status,a.url))}).catch(k=>{k.name!=="AbortError"&&u(new Error(`${k.message} ${a.url}`))})},A=(T,E,C)=>{(a.type==="arrayBuffer"?T.arrayBuffer():a.type==="json"?T.json():T.text()).then(O=>{b||(E&&C&&function(k,U,V){if(Or(),Ar==null)return;const N=Ua(U.headers.get("Cache-Control")||"");if(N["no-store"])return;const $={status:U.status,statusText:U.statusText,headers:new Headers};U.headers.forEach((ae,ie)=>$.headers.set(ie,ae)),N["max-age"]&&$.headers.set("Expires",new Date(V+1e3*N["max-age"]).toUTCString());const W=$.headers.get("Expires");if(!W||new Date(W).getTime()-V<42e4)return;let K=Nt(k.url,{persistentParams:Er});if(U.status===206){const ae=k.headers.get("Range");if(!ae)return;$.status=200,K=mt(K,{range:ae})}(function(ae,ie){if(xn===void 0)try{new Response(new ReadableStream),xn=!0}catch{xn=!1}xn?ie(ae.body):ae.blob().then(ie)})(U,ae=>{const ie=new Response((se=U.status)!==200&&se!==404&&[101,103,204,205,304].includes(se)?null:ae,$);var se;Or(),Ar!=null&&Ar.then(ve=>ve.put(K,ie)).catch(ve=>Pr(ve.message))})}(f,E,C),y=!0,u(null,O,T.headers.get("Cache-Control"),T.headers.get("Expires")))}).catch(O=>{b||u(new Error(O.message))})};return S?function(T,E){if(Or(),Ar==null)return E(null);Ar.then(C=>{let O=Nt(T.url,{persistentParams:Er});const k=T.headers.get("Range");k&&(O=mt(O,{range:k})),C.match(O).then(U=>{const V=function(N){if(!N)return!1;const $=new Date(N.headers.get("Expires")||0),W=Ua(N.headers.get("Cache-Control")||"");return $>Date.now()&&!W["no-cache"]}(U);C.delete(O),V&&C.put(O,U.clone()),E(null,U,V)}).catch(E)}).catch(E)}(f,w):w(null,null),{cancel:()=>{b=!0,y||l.abort()}}}(o,e);if(Va()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,e,void 0,!0)}var r;return function(a,u){const l=new XMLHttpRequest;l.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(l.responseType="arraybuffer");for(const f in a.headers)l.setRequestHeader(f,a.headers[f]);return a.type==="json"&&(l.responseType="text",l.setRequestHeader("Accept","application/json")),l.withCredentials=a.credentials==="include",l.onerror=()=>{u(new Error(l.statusText))},l.onload=()=>{if((l.status>=200&&l.status<300||l.status===0)&&l.response!==null){let f=l.response;if(a.type==="json")try{f=JSON.parse(l.response)}catch(y){return u(y)}u(null,f,l.getResponseHeader("Cache-Control"),l.getResponseHeader("Expires"))}else u(new Ni(l.statusText,l.status,a.url))},l.send(a.body),{cancel:()=>l.abort()}}(o,e)},ja=function(o,e){return xs(Vr(o,{type:"arrayBuffer"}),e)};function Ld(o){const e=document.createElement("a");return e.href=o,e.protocol===location.protocol&&e.host===location.host}const Od="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Ac,Mc;Ac=[],Mc=0;const kd=function(o,e){if(on.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Mc>=Y.MAX_PARALLEL_IMAGE_REQUESTS){const l={requestParameters:o,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Ac.push(l),l}Mc++;let r=!1;const a=()=>{if(!r)for(r=!0,Mc--;Ac.length&&Mc<Y.MAX_PARALLEL_IMAGE_REQUESTS;){const l=Ac.shift(),{requestParameters:f,callback:y,cancelled:b}=l;b||(l.cancel=kd(f,y).cancel)}},u=ja(o,(l,f,y,b)=>{a(),l?e(l):f&&(self.createImageBitmap?function(S,_){const w=new Blob([new Uint8Array(S)],{type:"image/png"});createImageBitmap(w).then(A=>{_(null,A)}).catch(A=>{_(new Error(`Could not load image because of ${A.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(S,_)=>e(S,_,y,b)):function(S,_){const w=new Image;w.onload=()=>{_(null,w),URL.revokeObjectURL(w.src),w.onload=null,requestAnimationFrame(()=>{w.src=Od})},w.onerror=()=>_(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const A=new Blob([new Uint8Array(S)],{type:"image/png"});w.src=S.byteLength?URL.createObjectURL(A):Od}(f,(S,_)=>e(S,_,y,b)))});return{cancel:()=>{u.cancel(),a()}}};var Cm,Fd,Bd,Hi={exports:{}},Ys={exports:{}},Bo={exports:{}},bo=function(){if(Bd)return Hi.exports;Bd=1;var o=(Cm||(Cm=1,Ys.exports=function(r,a){var u,l,f,y,b,S,_,w;for(l=r.length-(u=3&r.length),f=a,b=3432918353,S=461845907,w=0;w<l;)_=255&r.charCodeAt(w)|(255&r.charCodeAt(++w))<<8|(255&r.charCodeAt(++w))<<16|(255&r.charCodeAt(++w))<<24,++w,f=27492+(65535&(y=5*(65535&(f=(f^=_=(65535&(_=(_=(65535&_)*b+(((_>>>16)*b&65535)<<16)&4294967295)<<15|_>>>17))*S+(((_>>>16)*S&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(_=0,u){case 3:_^=(255&r.charCodeAt(w+2))<<16;case 2:_^=(255&r.charCodeAt(w+1))<<8;case 1:f^=_=(65535&(_=(_=(65535&(_^=255&r.charCodeAt(w)))*b+(((_>>>16)*b&65535)<<16)&4294967295)<<15|_>>>17))*S+(((_>>>16)*S&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),Ys.exports),e=(Fd||(Fd=1,Bo.exports=function(r,a){for(var u,l=r.length,f=a^l,y=0;l>=4;)u=1540483477*(65535&(u=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(u>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),l-=4,++y;switch(l){case 3:f^=(255&r.charCodeAt(y+2))<<16;case 2:f^=(255&r.charCodeAt(y+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(y)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Bo.exports);return Hi.exports=o,Hi.exports.murmur3=o,Hi.exports.murmur2=e,Hi.exports}(),Js=G(bo);class wo{constructor(e,...r){Vr(this,r[0]||{}),this.type=e}}class Vu extends wo{constructor(e,r={}){super("error",Vr({error:e},r))}}function Nd(o,e,r){r[o]&&r[o].indexOf(e)!==-1||(r[o]=r[o]||[],r[o].push(e))}function pa(o,e,r){if(r&&r[o]){const a=r[o].indexOf(e);a!==-1&&r[o].splice(a,1)}}class ma{on(e,r){return this._listeners=this._listeners||{},Nd(e,r,this._listeners),this}off(e,r){return pa(e,r,this._listeners),pa(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Nd(e,r,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,r){const a=typeof e=="string"?new wo(e,r):e,u=a.type;if(this.listens(u)){a.target=this;const l=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of l)b.call(this,a);const f=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of f)pa(u,b,this._oneTimeListeners),b.call(this,a);const y=this._eventedParent;y&&(Vr(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(a))}else a instanceof Vu&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}class bs{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new bs(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[r,a]=e.split("");return new bs({name:r,iconsetId:a})}static isEqual(e,r){return e.name===r.name&&e.iconsetId===r.iconsetId}toString(){return bs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Pm,ws={},Vd=function(){if(Pm)return ws;Pm=1;var o={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(l){return(l=Math.round(l))<0?0:l>255?255:l}function r(l){return e(l[l.length-1]==="%"?parseFloat(l)/100*255:parseInt(l))}function a(l){return(f=l[l.length-1]==="%"?parseFloat(l)/100:parseFloat(l))<0?0:f>1?1:f;var f}function u(l,f,y){return y<0?y+=1:y>1&&(y-=1),6*y<1?l+(f-l)*y*6:2*y<1?f:3*y<2?l+(f-l)*(2/3-y)*6:l}try{ws.parseCSSColor=function(l){var f,y=l.replace(/ /g,"").toLowerCase();if(y in o)return o[y].slice();if(y[0]==="#")return y.length===4?(f=parseInt(y.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:y.length===7&&(f=parseInt(y.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var b=y.indexOf("("),S=y.indexOf(")");if(b!==-1&&S+1===y.length){var _=y.substr(0,b),w=y.substr(b+1,S-(b+1)).split(","),A=1;switch(_){case"rgba":if(w.length!==4)return null;A=a(w.pop());case"rgb":return w.length!==3?null:[r(w[0]),r(w[1]),r(w[2]),A];case"hsla":if(w.length!==4)return null;A=a(w.pop());case"hsl":if(w.length!==3)return null;var T=(parseFloat(w[0])%360+360)%360/360,E=a(w[1]),C=a(w[2]),O=C<=.5?C*(E+1):C+E-C*E,k=2*C-O;return[e(255*u(k,O,T+1/3)),e(255*u(k,O,T)),e(255*u(k,O,T-1/3)),A];default:return null}}return null}}catch{}return ws}();class tn{constructor(e,r,a,u=1){this.r=e,this.g=r,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof tn)return e;if(typeof e!="string")return;const r=Vd.parseCSSColor(e);return r?new tn(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toStringPremultipliedAlpha(){const[e,r,a,u]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(a)},${u})`}toString(){const[e,r,a,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*r)},${Math.round(255*a)},${u})`}toRenderColor(e){const{r,g:a,b:u,a:l}=this;return new Ic(e,r,a,u,l)}clone(){return new tn(this.r,this.g,this.b,this.a)}}class Ic{constructor(e,r,a,u,l){if(e){const f=e.image.height,y=f*f;r=l===0?0:r/l*(f-1),a=l===0?0:a/l*(f-1),u=l===0?0:u/l*(f-1);const b=Math.floor(r),S=Math.floor(a),_=Math.floor(u),w=Math.ceil(r),A=Math.ceil(a),T=Math.ceil(u),E=r-b,C=a-S,O=u-_,k=e.image.data,U=4*(b+S*y+_*f),V=4*(b+S*y+T*f),N=4*(b+A*y+_*f),$=4*(b+A*y+T*f),W=4*(w+S*y+_*f),K=4*(w+S*y+T*f),ae=4*(w+A*y+_*f),ie=4*(w+A*y+T*f);if(U<0||ie>=k.length)throw new Error("out of range");this.r=or(or(or(k[U],k[V],O),or(k[N],k[$],O),C),or(or(k[W],k[K],O),or(k[ae],k[ie],O),C),E)/255*l,this.g=or(or(or(k[U+1],k[V+1],O),or(k[N+1],k[$+1],O),C),or(or(k[W+1],k[K+1],O),or(k[ae+1],k[ie+1],O),C),E)/255*l,this.b=or(or(or(k[U+2],k[V+2],O),or(k[N+2],k[$+2],O),C),or(or(k[W+2],k[K+2],O),or(k[ae+2],k[ie+2],O),C),E)/255*l,this.a=l}else this.r=r,this.g=a,this.b=u,this.a=l}toArray(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*r/u,255*a/u,u]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:e,g:r,b:a,a:u}=this,l=Math.min(Math.max(e/u,0),1),f=Math.min(Math.max(r/u,0),1),y=Math.min(Math.max(a/u,0),1),b=Math.min(l,f,y),S=Math.max(l,f,y),_=(b+S)/2;if(b===S)return[0,0,100*_,u];const w=S-b,A=_>.5?w/(2-S-b):w/(S+b);let T=0;return S===l?T=(f-y)/w+(f<y?6:0):S===f?T=(y-l)/w+2:S===y&&(T=(l-f)/w+4),T*=60,[Math.min(Math.max(T,0),360),Math.min(Math.max(100*A,0),100),Math.min(Math.max(100*_,0),100),u]}toArray01(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[e/u,r/u,a/u,u]}toArray01Scaled(e){const{r,g:a,b:u,a:l}=this;return l===0?[0,0,0]:[r/l*e,a/l*e,u/l*e]}toArray01PremultipliedAlpha(){const{r:e,g:r,b:a,a:u}=this;return[e,r,a,u]}toArray01Linear(){const{r:e,g:r,b:a,a:u}=this;return u===0?[0,0,0,0]:[Math.pow(e/u,2.2),Math.pow(r/u,2.2),Math.pow(a/u,2.2),u]}}function or(o,e,r){return o*(1-r)+e*r}function Rm(o,e,r){return o.map((a,u)=>or(a,e[u],r))}function Ud(o){return o*o*o*o*o}tn.black=new tn(0,0,0,1),tn.white=new tn(1,1,1,1),tn.transparent=new tn(0,0,0,0),tn.red=new tn(1,0,0,1),tn.blue=new tn(0,0,1,1);var qr=Object.freeze({__proto__:null,array:Rm,color:function(o,e,r){return new tn(or(o.r,e.r,r),or(o.g,e.g,r),or(o.b,e.b,r),or(o.a,e.a,r))},easeIn:Ud,number:or});function Uu(o,...e){for(const r of e)for(const a in r)o[a]=r[a];return o}class Ns extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class jd{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[a,u]of r)this.bindings[a]=u}concat(e){return new jd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const bl={kind:"null"},qt={kind:"number"},rn={kind:"string"},Hr={kind:"boolean"},ns={kind:"color"},$a={kind:"object"},$r={kind:"value"},ju={kind:"collator"},No={kind:"formatted"},Ga={kind:"resolvedImage"};function Pi(o,e){return{kind:"array",itemType:o,N:e}}function Tn(o){if(o.kind==="array"){const e=Tn(o.itemType);return typeof o.N=="number"?`array<${e}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${e}>`}return o.kind}const Dm=[bl,qt,rn,Hr,ns,No,$a,Pi($r),Ga];function Cc(o,e){if(e.kind==="error")return null;if(o.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Cc(o.itemType,e.itemType))&&(typeof o.N!="number"||o.N===e.N))return null}else{if(o.kind===e.kind)return null;if(o.kind==="value"){for(const r of Dm)if(!Cc(r,e))return null}}return`Expected ${Tn(o)} but found ${Tn(e)} instead.`}function $u(o,e){return e.some(r=>r.kind===o.kind)}function wl(o,e){return e.some(r=>r==="null"?o===null:r==="array"?Array.isArray(o):r==="object"?o&&!Array.isArray(o)&&typeof o=="object":r===typeof o)}class Gu{constructor(e,r,a){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pc{constructor(e,r,a,u,l){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=a,this.fontStack=u,this.textColor=l}}class Vi{constructor(e){this.sections=e}static fromString(e){return new Vi([new Pc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Vi?e:Vi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){const u=r.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(r.text);const a={};r.fontStack&&(a["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(a["font-scale"]=r.scale),r.textColor&&(a["text-color"]=["rgba"].concat(r.textColor.toRenderColor(null).toArray())),e.push(a)}return e}}class To{constructor(e,r={}){if(this.id=bs.from(e),this.options=Object.assign({},r),r.transform){const{a,b:u,c:l,d:f,e:y,f:b}=r.transform;this.options.transform=new DOMMatrix([a,u,l,f,y,b])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:r,c:a,d:u,e:l,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:r,c:a,d:u,e:l,f}})}static parse(e){let r,a,u,l;try{({name:r,iconsetId:a,params:u,transform:l}=JSON.parse(e)||{})}catch{return null}if(!r)return null;const{a:f,b:y,c:b,d:S,e:_,f:w}=l||{};return new To({name:r,iconsetId:a},{params:u,transform:new DOMMatrix([f,y,b,S,_,w])})}scaleSelf(e){return this.options.transform.scaleSelf(e),this}}class Ei{constructor(e,r,a,u,l=!1){this.primaryId=bs.from(e),this.primaryOptions=r,a&&(this.secondaryId=bs.from(a)),this.secondaryOptions=u,this.available=l}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new To(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new To(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Ei.build({name:e}):e}static build(e,r,a,u){return!e||typeof e=="object"&&!("name"in e)?null:new Ei(e,a,r,u)}}function qa(o,e,r,a){return typeof o=="number"&&o>=0&&o<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof r=="number"&&r>=0&&r<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[o,e,r,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[o,e,r,a]:[o,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ha(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof tn||o instanceof Gu||o instanceof Vi||o instanceof Ei)return!0;if(Array.isArray(o)){for(const e of o)if(!Ha(e))return!1;return!0}if(typeof o=="object"){for(const e in o)if(!Ha(o[e]))return!1;return!0}return!1}function Ln(o){if(o===null)return bl;if(typeof o=="string")return rn;if(typeof o=="boolean")return Hr;if(typeof o=="number")return qt;if(o instanceof tn)return ns;if(o instanceof Gu)return ju;if(o instanceof Vi)return No;if(o instanceof Ei)return Ga;if(Array.isArray(o)){const e=o.length;let r;for(const a of o){const u=Ln(a);if(r){if(r===u)continue;r=$r;break}r=u}return Pi(r||$r,e)}return $a}function Qs(o){const e=typeof o;return o===null?"":e==="string"||e==="number"||e==="boolean"?String(o):o instanceof tn?o.toStringPremultipliedAlpha():o instanceof Vi||o instanceof Ei?o.toString():JSON.stringify(o)}class eo{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(e.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ha(e[1]))return r.error("invalid value");const a=e[1];let u=Ln(a);const l=r.expectedType;return u.kind!=="array"||u.N!==0||!l||l.kind!=="array"||typeof l.N=="number"&&l.N!==0||(u=l),new eo(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof tn?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Vi?this.value.serialize():this.value}}class ai{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Rc={string:rn,number:qt,boolean:Hr,object:$a};class Vs{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let a,u=1;const l=e[0];if(l==="array"){let y,b;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in Rc)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=Rc[S],u++}else y=$r;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}a=Pi(y,b)}else a=Rc[l];const f=[];for(;u<e.length;u++){const y=r.parse(e[u],u,$r);if(!y)return null;f.push(y)}return new Vs(a,f)}evaluate(e){for(let r=0;r<this.args.length;r++){const a=this.args[r].evaluate(e);if(!Cc(this.type,Ln(a)))return a;if(r===this.args.length-1)throw new ai(`The expression ${JSON.stringify(this.args[r].serialize())} evaluated to ${Tn(Ln(a))} but was expected to be of type ${Tn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){r.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&r.push(u)}}return r.concat(this.args.map(a=>a.serialize()))}}class Vo{constructor(e){this.type=No,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return r.error("First argument must be an image or text section.");const u=[];let l=!1;for(let f=1;f<=e.length-1;++f){const y=e[f];if(l&&typeof y=="object"&&!Array.isArray(y)){l=!1;let b=null;if(y["font-scale"]&&(b=r.parseObjectValue(y["font-scale"],f,"font-scale",qt),!b))return null;let S=null;if(y["text-font"]&&(S=r.parseObjectValue(y["text-font"],f,"text-font",Pi(rn)),!S))return null;let _=null;if(y["text-color"]&&(_=r.parseObjectValue(y["text-color"],f,"text-color",ns),!_))return null;const w=u[u.length-1];w.scale=b,w.font=S,w.textColor=_}else{const b=r.parse(e[f],f,$r);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");l=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new Vo(u)}evaluate(e){return new Vi(this.sections.map(r=>{const a=r.content.evaluate(e);return Ln(a)===Ga?new Pc("",a,null,null,null):new Pc(Qs(a),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const a={};r.scale&&(a["font-scale"]=r.scale.serialize()),r.font&&(a["text-font"]=r.font.serialize()),r.textColor&&(a["text-color"]=r.textColor.serialize()),e.push(a)}return e}}class Tl{constructor(e,r,a,u){this._imageWarnHistory={},this.type=Ga,this.namePrimary=e,this.nameSecondary=r,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,r){if(e.length<2)return r.error("Expected two or more arguments.");let a=1;const u=[];function l(){if(a<e.length){const y=r.parse(e[a],a++,rn);return y?(u.push({image:y,options:{}}),!0):(r.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(a<e.length){const b=e[a];if((y=b)===null||typeof y!="object"||Array.isArray(y))return!0;const S=b.params,_=b.iconset,w=r.concat(a);if(!S&&!_)return a++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return w.error('Image options "params" should be an object'),!1;const A={},T=w.concat(void 0,"params");for(const E in S){if(!E)return T.error("Image parameter name should be non-empty"),!1;const C=T.concat(void 0,E).parse(S[E],void 0,ns,void 0,{typeAnnotation:"coerce"});if(!C)return!1;A[E]=C}u[u.length-1].options.params=A}if(_){if(typeof _!="object"||_.constructor!==Object)return w.error('Image options "iconset" should be an object'),!1;if(!_.id)return w.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=_}return a++,!0}var y;return!0}for(let y=0;y<2;y++)if(!l()||!f())return;return new Tl(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,r){const a={};if(r){for(const u in r)if(r[u])try{a[u]=r[u].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const r={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=Ei.build(r,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const l=u.getPrimary().id;if(u.available=e.availableImages.some(f=>bs.isEqual(f,l)),u.available){const f=u.getSecondary()?u.getSecondary().id:null;f&&(u.available=e.availableImages.some(y=>bs.isEqual(y,f)))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const r in this.paramsPrimary)this.paramsPrimary[r]&&e(this.paramsPrimary[r]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const r in this.paramsSecondary)this.paramsSecondary[r]&&e(this.paramsSecondary[r])}outputDefined(){return!1}serializeOptions(e,r){const a={};if(r&&(a.iconset={id:r}),e){a.params={};for(const u in e)e[u]&&(a.params[u]=e[u].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const r=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);r&&e.push(r)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const r=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);r&&e.push(r)}return e}}function Wa(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}const Vy={"to-boolean":Hr,"to-color":ns,"to-number":qt,"to-string":rn};class Uo{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const a=e[0],u=[];let l=bl;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(r.expectedType){if(r.expectedType.kind!=="array")return r.error(`Expected ${r.expectedType.kind} but found array.`);l=Pi(r.expectedType.itemType,f)}else{if(!(f>0&&Ha(e[1][0])))return null;l=Pi(Ln(e[1][0]),f)}for(let y=0;y<f;y++){const b=e[1][y];let S;if(Wa(b)==="array")S=r.parse(b,void 0,l.itemType);else{const _=Wa(b);if(_!==l.itemType.kind)return r.error(`Expected ${l.itemType.kind} but found ${_}.`);S=r.registry.literal.parse(["literal",b===void 0?null:b],r)}if(!S)return null;u.push(S)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return r.error("Expected one argument.");l=Vy[a];for(let f=1;f<e.length;f++){const y=r.parse(e[f],f,$r);if(!y)return null;u.push(y)}}return new Uo(l,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let r,a;for(const u of this.args){if(r=u.evaluate(e),a=null,r instanceof tn)return r;if(typeof r=="string"){const l=e.parseColor(r);if(l)return l}else if(Array.isArray(r)&&(a=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:qa(r[0],r[1],r[2],r[3]),!a))return new tn(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ai(a||`Could not parse color from value '${typeof r=="string"?r:String(JSON.stringify(r))}'`)}if(this.type.kind==="number"){let r=null;for(const a of this.args){if(r=a.evaluate(e),r===null)return 0;const u=Number(r);if(!isNaN(u))return u}throw new ai(`Could not convert ${JSON.stringify(r)} to number.`)}return this.type.kind==="formatted"?Vi.fromString(Qs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Ei.build(Qs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(r=>r.evaluate(e)):Qs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Vo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Tl(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const zm=["Unknown","Point","LineString","Polygon"];class Dc{constructor(e,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=r}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?zm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-e[0])+this.featureDistanceData.bearing[1]*(u*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=tn.parse(e)),r}getConfig(e){return this.options?this.options.get(e):null}}class is{constructor(e,r,a,u,l){this.name=e,this.type=r,this._evaluate=a,this.args=u,this._overloadIndex=l}evaluate(e){if(!this._evaluate){const r=is.definitions[this.name];this._evaluate=Array.isArray(r)?r[2]:r.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const a=e[0],u=is.definitions[a];if(!u)return r.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const l=Array.isArray(u)?u[0]:u.type,f=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,y=[];let b=null,S=-1;for(const[_,w]of f){if(Array.isArray(_)&&_.length!==e.length-1)continue;y.push(_),S++,b=new Yd(r.registry,r.path,null,r.scope,void 0,r._scope,r.options);const A=[];let T=!1;for(let E=1;E<e.length;E++){const C=e[E],O=Array.isArray(_)?_[E-1]:_.type,k=b.parse(C,1+A.length,O);if(!k){T=!0;break}A.push(k)}if(!T)if(Array.isArray(_)&&_.length!==A.length)b.error(`Expected ${_.length} arguments, but found ${A.length} instead.`);else{for(let E=0;E<A.length;E++){const C=Array.isArray(_)?_[E]:_.type,O=A[E];b.concat(E+1).checkSubtype(C,O.type)}if(b.errors.length===0)return new is(a,l,w,A,S)}}if(y.length===1)r.errors.push(...b.errors);else{const _=(y.length?y:f.map(([A])=>A)).map(qu).join(" | "),w=[];for(let A=1;A<e.length;A++){const T=r.parse(e[A],1+w.length);if(!T)return null;w.push(Tn(T.type))}r.error(`Expected arguments of type ${_}, but found (${w.join(", ")}) instead.`)}return null}static register(e,r){is.definitions=r;for(const a in r)e[a]=is}}function qu(o){return Array.isArray(o)?`(${o.map(Tn).join(", ")})`:`(${Tn(o.type)}...)`}class Hu{constructor(e,r,a){this.type=ju,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(e.length!==2)return r.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return r.error("Collator options argument must be an object.");const u=a["case-sensitive"]===void 0?r.parse(!1,1,Hr):r.parseObjectValue(a["case-sensitive"],1,"case-sensitive",Hr);if(!u)return null;const l=a["diacritic-sensitive"]===void 0?r.parse(!1,1,Hr):r.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",Hr);if(!l)return null;let f=null;return a.locale&&(f=r.parseObjectValue(a.locale,1,"locale",rn),!f)?null:new Hu(u,l,f)}evaluate(e){return new Gu(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Lm(o,e,r=0,a=o.length-1,u=Uy){for(;a>r;){if(a-r>600){const b=a-r+1,S=e-r+1,_=Math.log(b),w=.5*Math.exp(2*_/3),A=.5*Math.sqrt(_*w*(b-w)/b)*(S-b/2<0?-1:1);Lm(o,e,Math.max(r,Math.floor(e-S*w/b+A)),Math.min(a,Math.floor(e+(b-S)*w/b+A)),u)}const l=o[e];let f=r,y=a;for(zc(o,r,e),u(o[a],l)>0&&zc(o,r,a);f<y;){for(zc(o,f,y),f++,y--;u(o[f],l)<0;)f++;for(;u(o[y],l)>0;)y--}u(o[r],l)===0?zc(o,r,y):(y++,zc(o,y,a)),y<=e&&(r=y+1),e<=y&&(a=y-1)}}function zc(o,e,r){const a=o[e];o[e]=o[r],o[r]=a}function Uy(o,e){return o<e?-1:o>e?1:0}function jy(o){let e=0;for(let r,a,u=0,l=o.length,f=l-1;u<l;f=u++)r=o[u],a=o[f],e+=(a.x-r.x)*(r.y+a.y);return e}function Lc(o,e){o[0]=Math.min(o[0],e[0]),o[1]=Math.min(o[1],e[1]),o[2]=Math.max(o[2],e[0]),o[3]=Math.max(o[3],e[1])}function Oc(o,e){return!(o[0]<=e[0]||o[2]>=e[2]||o[1]<=e[1]||o[3]>=e[3])}function Om(o,e,r){const a=o[0]-e[0],u=o[1]-e[1],l=o[0]-r[0],f=o[1]-r[1];return a*f-l*u==0&&a*l<=0&&u*f<=0}function to(o,e,r=!1){let a=!1;for(let y=0,b=e.length;y<b;y++){const S=e[y];for(let _=0,w=S.length,A=w-1;_<w;A=_++){const T=S[A],E=S[_];if(Om(o,T,E))return r;(l=T)[1]>(u=o)[1]!=(f=E)[1]>u[1]&&u[0]<(f[0]-l[0])*(u[1]-l[1])/(f[1]-l[1])+l[0]&&(a=!a)}}var u,l,f;return a}function km(o,e,r,a){const u=a[0]-r[0],l=a[1]-r[1],f=(o[0]-r[0])*l-u*(o[1]-r[1]),y=(e[0]-r[0])*l-u*(e[1]-r[1]);return f>0&&y<0||f<0&&y>0}function Wu(o,e,r,a){return(u=[a[0]-r[0],a[1]-r[1]])[0]*(l=[e[0]-o[0],e[1]-o[1]])[1]-u[1]*l[0]!=0&&!(!km(o,e,r,a)||!km(r,a,o,e));var u,l}const So=8192;function $y(o,e){const r=(180+o[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(r*u*So),Math.round(a*u*So)]}function Gy(o,e){for(let r=0;r<e.length;r++)if(to(o,e[r]))return!0;return!1}function qy(o,e,r){for(const a of r)for(let u=0,l=a.length,f=l-1;u<l;f=u++)if(Wu(o,e,a[f],a[u]))return!0;return!1}function Fm(o,e){for(let r=0;r<o.length;++r)if(!to(o[r],e))return!1;for(let r=0;r<o.length-1;++r)if(qy(o[r],o[r+1],e))return!1;return!0}function Sl(o,e){for(let r=0;r<e.length;r++)if(Fm(o,e[r]))return!0;return!1}function Rr(o,e,r){const a=[];for(let u=0;u<o.length;u++){const l=[];for(let f=0;f<o[u].length;f++){const y=$y(o[u][f],r);Lc(e,y),l.push(y)}a.push(l)}return a}function Xt(o,e,r){const a=[];for(let u=0;u<o.length;u++){const l=Rr(o[u],e,r);a.push(l)}return a}function Zu(o,e,r,a){if(o[0]<r[0]||o[0]>r[2]){const u=.5*a;let l=o[0]-r[0]>u?-a:r[0]-o[0]>u?a:0;l===0&&(l=o[0]-r[2]>u?-a:r[2]-o[0]>u?a:0),o[0]+=l}Lc(e,o)}function br(o,e,r,a){const u=Math.pow(2,a.z)*So,l=[a.x*So,a.y*So],f=[];if(!o)return f;for(const y of o)for(const b of y){const S=[b.x+l[0],b.y+l[1]];Zu(S,e,r,u),f.push(S)}return f}function Xu(o,e,r,a){const u=Math.pow(2,a.z)*So,l=[a.x*So,a.y*So],f=[];if(!o)return f;for(const b of o){const S=[];for(const _ of b){const w=[_.x+l[0],_.y+l[1]];Lc(e,w),S.push(w)}f.push(S)}if(e[2]-e[0]<=u/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of f)for(const S of b)Zu(S,e,r,u)}var y;return f}class jo{constructor(e,r){this.type=Hr,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ha(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const l=a.features[u].geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new jo(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new jo(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new jo(a,a)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(a.type==="Polygon"){const y=Rr(a.coordinates,l,f),b=br(r.geometry(),u,l,f);if(!Oc(u,l))return!1;for(const S of b)if(!to(S,y))return!1}if(a.type==="MultiPolygon"){const y=Xt(a.coordinates,l,f),b=br(r.geometry(),u,l,f);if(!Oc(u,l))return!1;for(const S of b)if(!Gy(S,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(r,a){const u=[1/0,1/0,-1/0,-1/0],l=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(!f)return!1;if(a.type==="Polygon"){const y=Rr(a.coordinates,l,f),b=Xu(r.geometry(),u,l,f);if(!Oc(u,l))return!1;for(const S of b)if(!Fm(S,y))return!1}if(a.type==="MultiPolygon"){const y=Xt(a.coordinates,l,f),b=Xu(r.geometry(),u,l,f);if(!Oc(u,l))return!1;for(const S of b)if(!Sl(S,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const dr={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},$d=1/298.257223563,Ku=$d*(2-$d),El=Math.PI/180;class Al{static fromTile(e,r,a){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,r)),l=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/El;return new Al(l,a)}static get units(){return dr}constructor(e,r){if(e===void 0)throw new Error("No latitude given.");if(r&&!dr[r])throw new Error(`Unknown unit ${r}. Use one of: ${Object.keys(dr).join(", ")}`);const a=6378.137*El*(r?dr[r]:1),u=Math.cos(e*El),l=1/(1-Ku*(1-u*u)),f=Math.sqrt(l);this.kx=a*f*u,this.ky=a*f*l*(1-Ku)}distance(e,r){const a=ss(e[0]-r[0])*this.kx,u=(e[1]-r[1])*this.ky;return Math.sqrt(a*a+u*u)}bearing(e,r){const a=ss(r[0]-e[0])*this.kx;return Math.atan2(a,(r[1]-e[1])*this.ky)/El}destination(e,r,a){const u=a*El;return this.offset(e,Math.sin(u)*r,Math.cos(u)*r)}offset(e,r,a){return[e[0]+r/this.kx,e[1]+a/this.ky]}lineDistance(e){let r=0;for(let a=0;a<e.length-1;a++)r+=this.distance(e[a],e[a+1]);return r}area(e){let r=0;for(let a=0;a<e.length;a++){const u=e[a];for(let l=0,f=u.length,y=f-1;l<f;y=l++)r+=ss(u[l][0]-u[y][0])*(u[l][1]+u[y][1])*(a?-1:1)}return Math.abs(r)/2*this.kx*this.ky}along(e,r){let a=0;if(r<=0)return e[0];for(let u=0;u<e.length-1;u++){const l=e[u],f=e[u+1],y=this.distance(l,f);if(a+=y,a>r)return Ri(l,f,(r-(a-y))/y)}return e[e.length-1]}pointToSegmentDistance(e,r,a){let[u,l]=r,f=ss(a[0]-u)*this.kx,y=(a[1]-l)*this.ky;if(f!==0||y!==0){const b=(ss(e[0]-u)*this.kx*f+(e[1]-l)*this.ky*y)/(f*f+y*y);b>1?(u=a[0],l=a[1]):b>0&&(u+=f/this.kx*b,l+=y/this.ky*b)}return f=ss(e[0]-u)*this.kx,y=(e[1]-l)*this.ky,Math.sqrt(f*f+y*y)}pointOnLine(e,r){let a=1/0,u=e[0][0],l=e[0][1],f=0,y=0;for(let b=0;b<e.length-1;b++){let S=e[b][0],_=e[b][1],w=ss(e[b+1][0]-S)*this.kx,A=(e[b+1][1]-_)*this.ky,T=0;w===0&&A===0||(T=(ss(r[0]-S)*this.kx*w+(r[1]-_)*this.ky*A)/(w*w+A*A),T>1?(S=e[b+1][0],_=e[b+1][1]):T>0&&(S+=w/this.kx*T,_+=A/this.ky*T)),w=ss(r[0]-S)*this.kx,A=(r[1]-_)*this.ky;const E=w*w+A*A;E<a&&(a=E,u=S,l=_,f=b,y=T)}return{point:[u,l],index:f,t:Math.max(0,Math.min(1,y))}}lineSlice(e,r,a){let u=this.pointOnLine(a,e),l=this.pointOnLine(a,r);if(u.index>l.index||u.index===l.index&&u.t>l.t){const S=u;u=l,l=S}const f=[u.point],y=u.index+1,b=l.index;!kc(a[y],f[0])&&y<=b&&f.push(a[y]);for(let S=y+1;S<=b;S++)f.push(a[S]);return kc(a[b],l.point)||f.push(l.point),f}lineSliceAlong(e,r,a){let u=0;const l=[];for(let f=0;f<a.length-1;f++){const y=a[f],b=a[f+1],S=this.distance(y,b);if(u+=S,u>e&&l.length===0&&l.push(Ri(y,b,(e-(u-S))/S)),u>=r)return l.push(Ri(y,b,(r-(u-S))/S)),l;u>e&&l.push(b)}return l}bufferPoint(e,r){const a=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-a,e[0]+u,e[1]+a]}bufferBBox(e,r){const a=r/this.ky,u=r/this.kx;return[e[0]-u,e[1]-a,e[2]+u,e[3]+a]}insideBBox(e,r){return ss(e[0]-r[0])>=0&&ss(e[0]-r[2])<=0&&e[1]>=r[1]&&e[1]<=r[3]}}function kc(o,e){return o[0]===e[0]&&o[1]===e[1]}function Ri(o,e,r){const a=ss(e[0]-o[0]);return[o[0]+a*r,o[1]+(e[1]-o[1])*r]}function ss(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}class $o{constructor(e=[],r=(a,u)=>a<u?-1:a>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:a}=this,u=r[e];for(;e>0;){const l=e-1>>1,f=r[l];if(a(u,f)>=0)break;r[e]=f,e=l}r[e]=u}_down(e){const{data:r,compare:a}=this,u=this.length>>1,l=r[e];for(;e<u;){let f=1+(e<<1);const y=f+1;if(y<this.length&&a(r[y],r[f])<0&&(f=y),a(r[f],l)>=0)break;r[e]=r[f],e=f}r[e]=l}}var Ct=8192;function _a(o,e){return e.dist-o.dist}const Di=100,Gd=50;function Bm(o){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==o.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==o[r])return!1;return!0}function Yu(o){return o[1]-o[0]+1}function Us(o,e){const r=o[1]>=o[0]&&o[1]<e;return r||console.warn("Distance Expression: Index is out of range"),r}function Ju(o,e){if(o[0]>o[1])return[null,null];const r=Yu(o);if(e){if(r===2)return[o,null];const a=Math.floor(r/2);return[[o[0],o[0]+a],[o[0]+a,o[1]]]}{if(r===1)return[o,null];const a=Math.floor(r/2)-1;return[[o[0],o[0]+a],[o[0]+a+1,o[1]]]}}function Go(o,e){const r=[1/0,1/0,-1/0,-1/0];if(!Us(e,o.length))return r;for(let a=e[0];a<=e[1];++a)Lc(r,o[a]);return r}function Qu(o){const e=[1/0,1/0,-1/0,-1/0];for(let r=0;r<o.length;++r)for(let a=0;a<o[r].length;++a)Lc(e,o[r][a]);return e}function Ml(o,e,r){if(Bm(o)||Bm(e))return NaN;let a=0,u=0;return o[2]<e[0]&&(a=e[0]-o[2]),o[0]>e[2]&&(a=o[0]-e[2]),o[1]>e[3]&&(u=o[1]-e[3]),o[3]<e[1]&&(u=e[1]-o[3]),r.distance([0,0],[a,u])}function Hy(o){return 360*o-180}function Wy(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function eh(o,e){const r=Math.pow(2,e.z),a=(o.y/Ct+e.y)/r;return[Hy((o.x/Ct+e.x)/r),Wy(a)]}function Zy(o,e){const r=[];for(let a=0;a<o.length;++a)r.push(eh(o[a],e));return r}function Nm(o,e,r){const a=r.pointOnLine(e,o).point;return r.distance(o,a)}function qd(o,e,r,a,u){const l=r.slice(a[0],a[1]+1);let f=1/0;for(let y=e[0];y<=e[1];++y)if((f=Math.min(f,Nm(o[y],l,u)))===0)return 0;return f}function Hd(o,e,r,a,u){const l=Math.min(u.pointToSegmentDistance(o,r,a),u.pointToSegmentDistance(e,r,a)),f=Math.min(u.pointToSegmentDistance(r,o,e),u.pointToSegmentDistance(a,o,e));return Math.min(l,f)}function Za(o,e,r,a,u){if(!Us(e,o.length)||!Us(a,r.length))return NaN;let l=1/0;for(let f=e[0];f<e[1];++f)for(let y=a[0];y<a[1];++y){if(Wu(o[f],o[f+1],r[y],r[y+1]))return 0;l=Math.min(l,Hd(o[f],o[f+1],r[y],r[y+1],u))}return l}function Xy(o,e,r,a,u){if(!Us(e,o.length)||!Us(a,r.length))return NaN;let l=1/0;for(let f=e[0];f<=e[1];++f)for(let y=a[0];y<=a[1];++y)if((l=Math.min(l,u.distance(o[f],r[y])))===0)return l;return l}function Ky(o,e,r){if(to(o,e,!0))return 0;let a=1/0;for(const u of e){const l=u.length;if(l<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[l-1]&&(a=Math.min(a,r.pointToSegmentDistance(o,u[l-1],u[0])))===0||(a=Math.min(a,Nm(o,u,r)))===0)return a}return a}function Wd(o,e,r,a){if(!Us(e,o.length))return NaN;for(let l=e[0];l<=e[1];++l)if(to(o[l],r,!0))return 0;let u=1/0;for(let l=e[0];l<e[1];++l)for(const f of r)for(let y=0,b=f.length,S=b-1;y<b;S=y++){if(Wu(o[l],o[l+1],f[S],f[y]))return 0;u=Math.min(u,Hd(o[l],o[l+1],f[S],f[y],a))}return u}function Zd(o,e){for(const r of o)for(let a=0;a<=r.length-1;++a)if(to(r[a],e,!0))return!0;return!1}function Vm(o,e,r,a=1/0){const u=Qu(o),l=Qu(e);if(a!==1/0&&Ml(u,l,r)>=a)return a;if(Oc(u,l)){if(Zd(o,e))return 0}else if(Zd(e,o))return 0;let f=a;for(const y of o)for(let b=0,S=y.length,_=S-1;b<S;_=b++)for(const w of e)for(let A=0,T=w.length,E=T-1;A<T;E=A++){if(Wu(y[_],y[b],w[E],w[A]))return 0;f=Math.min(f,Hd(y[_],y[b],w[E],w[A],r))}return f}function os(o,e,r,a,u,l,f){if(l===null||f===null)return;const y=Ml(Go(a,l),Go(u,f),r);y<e&&o.push({dist:y,range1:l,range2:f})}function Um(o,e,r,a,u=1/0){let l=Math.min(a.distance(o[0],r[0][0]),u);if(l===0)return l;const f=new $o([{dist:0,range1:[0,o.length-1],range2:[0,0]}],_a),y=e?Gd:Di,b=Qu(r);for(;f.length;){const S=f.pop();if(S.dist>=l)continue;const _=S.range1;if(Yu(_)<=y){if(!Us(_,o.length))return NaN;if(e){const w=Wd(o,_,r,a);if((l=Math.min(l,w))===0)return l}else for(let w=_[0];w<=_[1];++w){const A=Ky(o[w],r,a);if((l=Math.min(l,A))===0)return l}}else{const w=Ju(_,e);if(w[0]!==null){const A=Ml(Go(o,w[0]),b,a);A<l&&f.push({dist:A,range1:w[0],range2:[0,0]})}if(w[1]!==null){const A=Ml(Go(o,w[1]),b,a);A<l&&f.push({dist:A,range1:w[1],range2:[0,0]})}}}return l}function Xd(o,e,r,a,u,l=1/0){let f=Math.min(l,u.distance(o[0],r[0]));if(f===0)return f;const y=new $o([{dist:0,range1:[0,o.length-1],range2:[0,r.length-1]}],_a),b=e?Gd:Di,S=a?Gd:Di;for(;y.length;){const _=y.pop();if(_.dist>=f)continue;const w=_.range1,A=_.range2;if(Yu(w)<=b&&Yu(A)<=S){if(!Us(w,o.length)||!Us(A,r.length))return NaN;if(e&&a?f=Math.min(f,Za(o,w,r,A,u)):e||a?e&&!a?f=Math.min(f,qd(r,A,o,w,u)):!e&&a&&(f=Math.min(f,qd(o,w,r,A,u))):f=Math.min(f,Xy(o,w,r,A,u)),f===0)return f}else{const T=Ju(w,e),E=Ju(A,a);os(y,f,u,o,r,T[0],E[0]),os(y,f,u,o,r,T[0],E[1]),os(y,f,u,o,r,T[1],E[0]),os(y,f,u,o,r,T[1],E[1])}}return f}function th(o,e,r,a,u=1/0){let l=u;const f=Go(o,[0,o.length-1]);for(const y of r)if(!(l!==1/0&&Ml(f,Go(y,[0,y.length-1]),a)>=l)&&(l=Math.min(l,Xd(o,e,y,!0,a,l)),l===0))return l;return l}function Fc(o,e,r,a,u=1/0){let l=u;const f=Go(o,[0,o.length-1]);for(const y of r){if(l!==1/0&&Ml(f,Qu(y),a)>=l)continue;const b=Um(o,e,y,a,l);if(isNaN(b))return b;if((l=Math.min(l,b))===0)return l}return l}function rh(o){return o==="Point"||o==="MultiPoint"||o==="LineString"||o==="MultiLineString"||o==="Polygon"||o==="MultiPolygon"}class ga{constructor(e,r){this.type=qt,this.geojson=e,this.geometries=r}static parse(e,r){if(e.length!==2)return r.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ha(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let u=0;u<a.features.length;++u)if(rh(a.features[u].geometry.type))return new ga(a,a.features[u].geometry)}else if(a.type==="Feature"){if(rh(a.geometry.type))return new ga(a,a.geometry)}else if(rh(a.type))return new ga(a,a)}return r.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const r=e.geometry(),a=e.canonicalID();if(r!=null&&a!=null){if(e.geometryType()==="Point")return function(u,l,f){const y=[];for(const S of u)for(const _ of S)y.push(eh(_,l));const b=new Al(y[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?Xd(y,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",b):f.type==="MultiLineString"?th(y,!1,f.coordinates,b):f.type==="Polygon"||f.type==="MultiPolygon"?Fc(y,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,b):null}(r,a,this.geometries);if(e.geometryType()==="LineString")return function(u,l,f){const y=[];for(const S of u){const _=[];for(const w of S)_.push(eh(w,l));y.push(_)}const b=new Al(y[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return th(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y,b);if(f.type==="MultiLineString"){let S=1/0;for(let _=0;_<f.coordinates.length;_++){const w=th(f.coordinates[_],!0,y,b,S);if(isNaN(w))return w;if((S=Math.min(S,w))===0)return S}return S}if(f.type==="Polygon"||f.type==="MultiPolygon"){let S=1/0;for(let _=0;_<y.length;_++){const w=Fc(y[_],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,b,S);if(isNaN(w))return w;if((S=Math.min(S,w))===0)return S}return S}return null}(r,a,this.geometries);if(e.geometryType()==="Polygon")return function(u,l,f){const y=[];for(const S of function(_,w){const A=_.length;if(A<=1)return[_];const T=[];let E,C;for(let O=0;O<A;O++){const k=jy(_[O]);k!==0&&(_[O].area=Math.abs(k),C===void 0&&(C=k<0),C===k<0?(E&&T.push(E),E=[_[O]]):E.push(_[O]))}return E&&T.push(E),T}(u)){const _=[];for(let w=0;w<S.length;++w)_.push(Zy(S[w],l));y.push(_)}const b=new Al(y[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return Fc(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",y,b);if(f.type==="MultiLineString"){let S=1/0;for(let _=0;_<f.coordinates.length;_++){const w=Fc(f.coordinates[_],!0,y,b,S);if(isNaN(w))return w;if((S=Math.min(S,w))===0)return S}return S}return f.type==="Polygon"||f.type==="MultiPolygon"?function(S,_,w){let A=1/0;for(const T of S)for(const E of _){const C=Vm(T,E,w,A);if(isNaN(C))return C;if((A=Math.min(A,C))===0)return A}return A}(f.type==="Polygon"?[f.coordinates]:f.coordinates,y,b):null}(r,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function nh(o,e){switch(o){case"string":return Qs(e);case"number":return+e;case"boolean":return!!e;case"color":return tn.parse(e);case"formatted":return Vi.fromString(Qs(e));case"resolvedImage":return Ei.build(Qs(e))}return e}function Kd(o,e,r,a){return a!==void 0&&(o=a*Math.round(o/a)),e!==void 0&&o<e&&(o=e),r!==void 0&&o>r&&(o=r),o}class Xa{constructor(e,r,a){this.type=e,this.key=r,this.scope=a}static parse(e,r){let a=r.expectedType;if(a==null&&(a=$r),e.length<2||e.length>3)return r.error("Invalid number of arguments for 'config' expression.");const u=r.parse(e[1],1);if(!(u instanceof eo))return r.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const l=r.parse(e[2],2);return l instanceof eo?new Xa(a,Qs(u.value),Qs(l.value)):r.error("Scope of 'config' expression must be a string literal.")}return new Xa(a,Qs(u.value))}evaluate(e){const r=[this.key,this.scope,e.scope].filter(Boolean).join(""),a=e.getConfig(r);if(!a)return null;const{type:u,value:l,values:f,minValue:y,maxValue:b,stepValue:S}=a,_=a.default.evaluate(e);let w=_;if(l){const A=e.scope;e.scope=(A||"").split("").slice(1).join(""),w=l.evaluate(e),e.scope=A}return u&&(w=nh(u,w)),w===void 0||y===void 0&&b===void 0&&S===void 0||(typeof w=="number"?w=Kd(w,y,b,S):Array.isArray(w)&&(w=w.map(A=>typeof A=="number"?Kd(A,y,b,S):A))),l!==void 0&&w!==void 0&&f&&!f.includes(w)&&(w=_,u&&(w=nh(u,w))),(u&&u!==this.type||w!==void 0&&Ln(w)!==this.type)&&(w=nh(this.type.kind,w)),w}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}function Il(o){if(o instanceof is&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof jo||o instanceof ga)return!1;let e=!0;return o.eachChild(r=>{e&&!Il(r)&&(e=!1)}),e}function Bc(o){if(o instanceof is&&o.name==="feature-state")return!1;let e=!0;return o.eachChild(r=>{e&&!Bc(r)&&(e=!1)}),e}function Ka(o){if(o instanceof Xa)return new Set([o.key]);let e=new Set;return o.eachChild(r=>{e=new Set([...e,...Ka(r)])}),e}function qo(o,e){if(o instanceof is&&e.indexOf(o.name)>=0)return!1;let r=!0;return o.eachChild(a=>{r&&!qo(a,e)&&(r=!1)}),r}class Ya{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(e.length!==2||typeof e[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const a=e[1];return r.scope.has(a)?new Ya(a,r.scope.get(a)):r.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ih{constructor(e,r=[],a,u=new jd,l=[],f,y){this.registry=e,this.path=r,this.key=r.map(b=>typeof b=="string"?`['${b}']`:`[${b}]`).join(""),this.scope=u,this.errors=l,this.expectedType=a,this._scope=f,this.options=y}parse(e,r,a,u,l={}){return r||a?this.concat(r,null,a,u)._parse(e,l):this._parse(e,l)}parseObjectValue(e,r,a,u,l,f={}){return this.concat(r,a,u,l)._parse(e,f)}_parse(e,r){function a(u,l,f){return f==="assert"?new Vs(l,[u]):f==="coerce"?new Uo(l,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let l=u.parse(e,this);if(!l)return null;if(this.expectedType){const f=this.expectedType,y=l.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||y.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(f,y))return null}else l=a(l,f,r.typeAnnotation||"coerce");else l=a(l,f,r.typeAnnotation||"assert")}if(!(l instanceof eo)&&l.type.kind!=="resolvedImage"&&sh(l)){const f=new Dc(this._scope,this.options);try{l=new eo(l.type,l.evaluate(f))}catch(y){return this.error(y.message),null}}return l}return Uo.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,a,u){let l=typeof e=="number"?this.path.concat(e):this.path;l=typeof r=="string"?l.concat(r):l;const f=u?this.scope.concat(u):this.scope;return new ih(this.registry,l,a||null,f,this.errors,this._scope,this.options)}error(e,...r){const a=`${this.key}${r.map(u=>`[${u}]`).join("")}`;this.errors.push(new Ns(a,e))}checkSubtype(e,r){const a=Cc(e,r);return a&&this.error(a),a}}var Yd=ih;function sh(o){if(o instanceof Ya)return sh(o.boundExpression);if(o instanceof is&&o.name==="error"||o instanceof Hu||o instanceof jo||o instanceof ga||o instanceof Xa)return!1;const e=o instanceof Uo||o instanceof Vs;let r=!0;return o.eachChild(a=>{r=e?r&&sh(a):r&&a instanceof eo}),!!r&&Il(o)&&qo(o,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ho(o,e){const r=o.length-1;let a,u,l=0,f=r,y=0;for(;l<=f;)if(y=Math.floor((l+f)/2),a=o[y],u=o[y+1],a<=e){if(y===r||e<u)return y;l=y+1}else{if(!(a>e))throw new ai("Input is not a number.");f=y-1}return 0}class kr{constructor(e,r,a){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[u,l]of a)this.labels.push(u),this.outputs.push(l)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const a=r.parse(e[1],1,qt);if(!a)return null;const u=[];let l=null;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);for(let f=1;f<e.length;f+=2){const y=f===1?-1/0:e[f],b=e[f+1],S=f,_=f+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(u.length&&u[u.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const w=r.parse(b,_,l);if(!w)return null;l=l||w.type,u.push([y,w])}return new kr(l,a,u)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const l=r.length;return u>=r[l-1]?a[l-1].evaluate(e):a[Ho(r,u)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}const jm=.95047,$m=1.08883,Gm=4/29,Ja=6/29,qm=3*Ja*Ja,Cn=Ja*Ja*Ja,Yy=Math.PI/180,Jy=180/Math.PI;function Jd(o){return o>Cn?Math.pow(o,1/3):o/qm+Gm}function Qd(o){return o>Ja?o*o*o:qm*(o-Gm)}function ef(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function tf(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Hm(o){const e=tf(o.r),r=tf(o.g),a=tf(o.b),u=Jd((.4124564*e+.3575761*r+.1804375*a)/jm),l=Jd((.2126729*e+.7151522*r+.072175*a)/1);return{l:116*l-16,a:500*(u-l),b:200*(l-Jd((.0193339*e+.119192*r+.9503041*a)/$m)),alpha:o.a}}function Wm(o){let e=(o.l+16)/116,r=isNaN(o.a)?e:e+o.a/500,a=isNaN(o.b)?e:e-o.b/200;return e=1*Qd(e),r=jm*Qd(r),a=$m*Qd(a),new tn(ef(3.2404542*r-1.5371385*e-.4985314*a),ef(-.969266*r+1.8760108*e+.041556*a),ef(.0556434*r-.2040259*e+1.0572252*a),o.alpha)}function Qy(o,e,r){const a=e-o;return o+r*(a>180||a<-180?a-360*Math.round(a/360):a)}const Nc={forward:Hm,reverse:Wm,interpolate:function(o,e,r){return{l:or(o.l,e.l,r),a:or(o.a,e.a,r),b:or(o.b,e.b,r),alpha:or(o.alpha,e.alpha,r)}}},Vc={forward:function(o){const{l:e,a:r,b:a}=Hm(o),u=Math.atan2(a,r)*Jy;return{h:u<0?u+360:u,c:Math.sqrt(r*r+a*a),l:e,alpha:o.a}},reverse:function(o){const e=o.h*Yy,r=o.c;return Wm({l:o.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:o.alpha})},interpolate:function(o,e,r){return{h:Qy(o.h,e.h,r),c:or(o.c,e.c,r),l:or(o.l,e.l,r),alpha:or(o.alpha,e.alpha,r)}}};var Zm=Object.freeze({__proto__:null,hcl:Vc,lab:Nc});class Ts{constructor(e,r,a,u,l){this.type=e,this.operator=r,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[f,y]of l)this.labels.push(f),this.outputs.push(y)}static interpolationFactor(e,r,a,u){let l=0;if(e.name==="exponential")l=rf(r,e.base,a,u);else if(e.name==="linear")l=rf(r,1,a,u);else if(e.name==="cubic-bezier"){const f=e.controlPoints;l=new ke(f[0],f[1],f[2],f[3]).solve(rf(r,1,a,u))}return l}static parse(e,r){let[a,u,l,...f]=e;if(!Array.isArray(u)||u.length===0)return r.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const S=u[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:S}}else{if(u[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const S=u.slice(1);if(S.length!==4||S.some(_=>typeof _!="number"||_<0||_>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(l=r.parse(l,2,qt),!l)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=ns:r.expectedType&&r.expectedType.kind!=="value"&&(b=r.expectedType);for(let S=0;S<f.length;S+=2){const _=f[S],w=f[S+1],A=S+3,T=S+4;if(typeof _!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(y.length&&y[y.length-1][0]>=_)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const E=r.parse(w,T,b);if(!E)return null;b=b||E.type,y.push([_,E])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Ts(b,a,u,l,y):r.error(`Type ${Tn(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,a=this.outputs;if(r.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=r[0])return a[0].evaluate(e);const l=r.length;if(u>=r[l-1])return a[l-1].evaluate(e);const f=Ho(r,u),y=Ts.interpolationFactor(this.interpolation,u,r[f],r[f+1]),b=a[f].evaluate(e),S=a[f+1].evaluate(e);return this.operator==="interpolate"?qr[this.type.kind.toLowerCase()](b,S,y):this.operator==="interpolate-hcl"?Vc.reverse(Vc.interpolate(Vc.forward(b),Vc.forward(S),y)):Nc.reverse(Nc.interpolate(Nc.forward(b),Nc.forward(S),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const r=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)r.push(this.labels[a],this.outputs[a].serialize());return r}}function rf(o,e,r,a){const u=a-r,l=o-r;return u===0?0:e===1?l/u:(Math.pow(e,l)-1)/(Math.pow(e,u)-1)}class oh{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let a=null;const u=r.expectedType;u&&u.kind!=="value"&&(a=u);const l=[];for(const y of e.slice(1)){const b=r.parse(y,1+l.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,l.push(b)}const f=u&&l.some(y=>Cc(u,y.type));return new oh(f?$r:a,l)}evaluate(e){let r,a=null,u=0;for(const l of this.args){if(u++,a=l.evaluate(e),a&&a instanceof Ei&&!a.available&&(r||(r=a),a=null,u===this.args.length))return r;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class ah{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let l=1;l<e.length-1;l+=2){const f=e[l];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,l);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",l);const y=r.parse(e[l+1],l+1);if(!y)return null;a.push([f,y])}const u=r.parse(e[e.length-1],e.length-1,r.expectedType,a);return u?new ah(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,a]of this.bindings)e.push(r,a.serialize());return e.push(this.result.serialize()),e}}class nf{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,qt),u=r.parse(e[2],2,Pi(r.expectedType||$r));return a&&u?new nf(u.type.itemType,a,u):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new ai(`Array index out of bounds: ${r} < 0.`);if(r>=a.length)throw new ai(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r!==Math.floor(r))throw new ai(`Array index must be an integer, but found ${r} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return a[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class sf{constructor(e,r,a){this.type=e,this.index=r,this.input=a}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,qt),u=r.parse(e[2],2,Pi(r.expectedType||$r));return a&&u?new sf(u.type.itemType,a,u):null}evaluate(e){const r=this.index.evaluate(e),a=this.input.evaluate(e);if(r<0)throw new ai(`Array index out of bounds: ${r} < 0.`);if(r>a.length-1)throw new ai(`Array index out of bounds: ${r} > ${a.length-1}.`);if(r===Math.floor(r))return a[r];const u=Math.floor(r),l=Math.ceil(r),f=a[u],y=a[l];if(typeof f!="number"||typeof y!="number")throw new ai(`Cannot interpolate between non-number values at index ${r}.`);const b=r-u;return f*(1-b)+y*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class of{constructor(e,r){this.type=Hr,this.needle=e,this.haystack=r}static parse(e,r){if(e.length!==3)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,$r),u=r.parse(e[2],2,$r);return a&&u?$u(a.type,[Hr,rn,qt,bl,$r])?new of(a,u):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tn(a.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!wl(r,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${Tn(Ln(r))} instead.`);if(!wl(a,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${Tn(Ln(a))} instead.`);return a.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class lh{constructor(e,r,a){this.type=qt,this.needle=e,this.haystack=r,this.fromIndex=a}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,$r),u=r.parse(e[2],2,$r);if(!a||!u)return null;if(!$u(a.type,[Hr,rn,qt,bl,$r]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Tn(a.type)} instead`);if(e.length===4){const l=r.parse(e[3],3,qt);return l?new lh(a,u,l):null}return new lh(a,u)}evaluate(e){const r=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!wl(r,["boolean","string","number","null"]))throw new ai(`Expected first argument to be of type boolean, string, number or null, but found ${Tn(Ln(r))} instead.`);if(!wl(a,["string","array"]))throw new ai(`Expected second argument to be of type array or string, but found ${Tn(Ln(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(r,u)}return a.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class af{constructor(e,r,a,u,l,f){this.inputType=e,this.type=r,this.input=a,this.cases=u,this.outputs=l,this.otherwise=f}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let a,u;r.expectedType&&r.expectedType.kind!=="value"&&(u=r.expectedType);const l={},f=[];for(let S=2;S<e.length-1;S+=2){let _=e[S];const w=e[S+1];Array.isArray(_)||(_=[_]);const A=r.concat(S);if(_.length===0)return A.error("Expected at least one branch label.");for(const E of _){if(typeof E!="number"&&typeof E!="string")return A.error("Branch labels must be numbers or strings.");if(typeof E=="number"&&Math.abs(E)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof E=="number"&&Math.floor(E)!==E)return A.error("Numeric branch labels must be integer values.");if(a){if(A.checkSubtype(a,Ln(E)))return null}else a=Ln(E);if(l[String(E)]!==void 0)return A.error("Branch labels must be unique.");l[String(E)]=f.length}const T=r.parse(w,S,u);if(!T)return null;u=u||T.type,f.push(T)}const y=r.parse(e[1],1,$r);if(!y)return null;const b=r.parse(e[e.length-1],e.length-1,u);return b?y.type.kind!=="value"&&r.concat(1).checkSubtype(a,y.type)?null:new af(a,u,y,l,f,b):null}evaluate(e){const r=this.input.evaluate(e);return(Ln(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),a=[],u={};for(const f of r){const y=u[this.cases[f]];y===void 0?(u[this.cases[f]]=a.length,a.push([this.cases[f],[f]])):a[y][1].push(f)}const l=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,y]of a)e.push(y.length===1?l(y[0]):y.map(l)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class lf{constructor(e,r,a){this.type=e,this.branches=r,this.otherwise=a}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let a;r.expectedType&&r.expectedType.kind!=="value"&&(a=r.expectedType);const u=[];for(let f=1;f<e.length-1;f+=2){const y=r.parse(e[f],f,Hr);if(!y)return null;const b=r.parse(e[f+1],f+1,a);if(!b)return null;u.push([y,b]),a=a||b.type}const l=r.parse(e[e.length-1],e.length-1,a);return l?new lf(a,u,l):null}evaluate(e){for(const[r,a]of this.branches)if(r.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,a]of this.branches)e(r),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class ch{constructor(e,r,a,u){this.type=e,this.input=r,this.beginIndex=a,this.endIndex=u}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=r.parse(e[1],1,$r),u=r.parse(e[2],2,qt);if(!a||!u)return null;if(!$u(a.type,[Pi($r),rn,$r]))return r.error(`Expected first argument to be of type array or string, but found ${Tn(a.type)} instead`);if(e.length===4){const l=r.parse(e[3],3,qt);return l?new ch(a.type,a,u,l):null}return new ch(a.type,a,u)}evaluate(e){const r=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!wl(r,["string","array"]))throw new ai(`Expected first argument to be of type array or string, but found ${Tn(Ln(r))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return r.slice(a,u)}return r.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Xm(o,e){return o==="=="||o==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Km(o,e,r,a){return a.compare(e,r)===0}function Cl(o,e,r){const a=o!=="=="&&o!=="!=";return class bI{constructor(l,f,y){this.type=Hr,this.lhs=l,this.rhs=f,this.collator=y,this.hasUntypedArgument=l.type.kind==="value"||f.type.kind==="value"}static parse(l,f){if(l.length!==3&&l.length!==4)return f.error("Expected two or three arguments.");const y=l[0];let b=f.parse(l[1],1,$r);if(!b)return null;if(!Xm(y,b.type))return f.concat(1).error(`"${y}" comparisons are not supported for type '${Tn(b.type)}'.`);let S=f.parse(l[2],2,$r);if(!S)return null;if(!Xm(y,S.type))return f.concat(2).error(`"${y}" comparisons are not supported for type '${Tn(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error(`Cannot compare types '${Tn(b.type)}' and '${Tn(S.type)}'.`);a&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new Vs(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new Vs(b.type,[S])));let _=null;if(l.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(_=f.parse(l[3],3,ju),!_)return null}return new bI(b,S,_)}evaluate(l){const f=this.lhs.evaluate(l),y=this.rhs.evaluate(l);if(a&&this.hasUntypedArgument){const b=Ln(f),S=Ln(y);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new ai(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=Ln(f),S=Ln(y);if(b.kind!=="string"||S.kind!=="string")return e(l,f,y)}return this.collator?r(l,f,y,this.collator.evaluate(l)):e(l,f,y)}eachChild(l){l(this.lhs),l(this.rhs),this.collator&&l(this.collator)}outputDefined(){return!0}serialize(){const l=[o];return this.eachChild(f=>{l.push(f.serialize())}),l}}}const ev=Cl("==",function(o,e,r){return e===r},Km),tv=Cl("!=",function(o,e,r){return e!==r},function(o,e,r,a){return!Km(0,e,r,a)}),rv=Cl("<",function(o,e,r){return e<r},function(o,e,r,a){return a.compare(e,r)<0}),nv=Cl(">",function(o,e,r){return e>r},function(o,e,r,a){return a.compare(e,r)>0}),iv=Cl("<=",function(o,e,r){return e<=r},function(o,e,r,a){return a.compare(e,r)<=0}),cf=Cl(">=",function(o,e,r){return e>=r},function(o,e,r,a){return a.compare(e,r)>=0});class uf{constructor(e,r,a,u,l,f){this.type=rn,this.number=e,this.locale=r,this.currency=a,this.unit=u,this.minFractionDigits=l,this.maxFractionDigits=f}static parse(e,r){if(e.length!==3)return r.error("Expected two arguments.");const a=r.parse(e[1],1,qt);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return r.error("NumberFormat options argument must be an object.");let l=null;if(u.locale&&(l=r.parseObjectValue(u.locale,2,"locale",rn),!l))return null;let f=null;if(u.currency&&(f=r.parseObjectValue(u.currency,2,"currency",rn),!f))return null;let y=null;if(u.unit&&(y=r.parseObjectValue(u.unit,2,"unit",rn),!y))return null;let b=null;if(u["min-fraction-digits"]&&(b=r.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",qt),!b))return null;let S=null;return u["max-fraction-digits"]&&(S=r.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",qt),!S)?null:new uf(a,l,f,y,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class uh{constructor(e){this.type=qt,this.input=e}static parse(e,r){if(e.length!==2)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=r.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Tn(a.type)} instead.`):new uh(a):null}evaluate(e){const r=this.input.evaluate(e);if(typeof r=="string"||Array.isArray(r))return r.length;throw new ai(`Expected value to be of type string or array, but found ${Tn(Ln(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}function Ym(o){return function(){o=1831565813+(o|=0)|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Pl={"==":ev,"!=":tv,">":nv,"<":rv,">=":cf,"<=":iv,array:Vs,at:nf,"at-interpolated":sf,boolean:Vs,case:lf,coalesce:oh,collator:Hu,format:Vo,image:Tl,in:of,"index-of":lh,interpolate:Ts,"interpolate-hcl":Ts,"interpolate-lab":Ts,length:uh,let:ah,literal:eo,match:af,number:Vs,"number-format":uf,object:Vs,slice:ch,step:kr,string:Vs,"to-boolean":Uo,"to-color":Uo,"to-number":Uo,"to-string":Uo,var:Ya,within:jo,distance:ga,config:Xa};function Jm(o,[e,r,a,u]){e=e.evaluate(o),r=r.evaluate(o),a=a.evaluate(o);const l=u?u.evaluate(o):1,f=qa(e,r,a,l);if(f)throw new ai(f);return new tn(e/255*l,r/255*l,a/255*l,l)}function hf(o,[e,r,a,u]){e=e.evaluate(o),r=r.evaluate(o),a=a.evaluate(o);const l=u?u.evaluate(o):1,f=function(S,_,w,A){return typeof S=="number"&&S>=0&&S<=360?typeof _=="number"&&_>=0&&_<=100&&typeof w=="number"&&w>=0&&w<=100?A===void 0||typeof A=="number"&&A>=0&&A<=1?null:`Invalid hsla value [${[S,_,w,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof A=="number"?[S,_,w,A]:[S,_,w]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof A=="number"?[S,_,w,A]:[S,_,w]).join(", ")}]: 'h' must be between 0 and 360.`}(e,r,a,l);if(f)throw new ai(f);const y=`hsla(${e}, ${r}%, ${a}%, ${l})`,b=tn.parse(y);if(!b)throw new ai(`Failed to parse HSLA color: ${y}`);return b}function df(o,e){return o in e}function ya(o,e){const r=e[o];return r===void 0?null:r}function va(o){return{type:o}}function ff(o){return{result:"success",value:o}}function xa(o){return{result:"error",value:o}}function Uc(o,e){return!!o&&!!o.parameters&&o.parameters.indexOf(e)>-1}function Rl(o){return o["property-type"]==="data-driven"}function Qm(o){return Uc(o.expression,"measure-light")}function e_(o){return Uc(o.expression,"zoom")}function hh(o){return!!o.expression&&o.expression.interpolated}function dh(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function sv(o){return o}function t_(o,e){const r=e.type==="color",a=o.stops&&typeof o.stops[0][0]=="object",u=a||!(a||o.property!==void 0),l=o.type||(hh(e)?"exponential":"interval");if(r&&((o=Uu({},o)).stops&&(o.stops=o.stops.map(S=>[S[0],tn.parse(S[1])])),o.default=tn.parse(o.default?o.default:e.default)),o.colorSpace&&o.colorSpace!=="rgb"&&!Zm[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let f,y,b;if(l==="exponential")f=$c;else if(l==="interval")f=n_;else if(l==="categorical"){f=r_,y=Object.create(null);for(const S of o.stops)y[S[0]]=S[1];b=typeof o.stops[0][0]}else{if(l!=="identity")throw new Error(`Unknown function type "${l}"`);f=ov}if(a){const S={},_=[];for(let T=0;T<o.stops.length;T++){const E=o.stops[T],C=E[0].zoom;S[C]===void 0&&(S[C]={zoom:C,type:o.type,property:o.property,default:o.default,stops:[]},_.push(C)),S[C].stops.push([E[0].value,E[1]])}const w=[];for(const T of _)w.push([S[T].zoom,t_(S[T],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:Ts.interpolationFactor.bind(void 0,A),zoomStops:w.map(T=>T[0]),evaluate:({zoom:T},E)=>$c({stops:w,base:o.base},e,T).evaluate(T,E)}}if(u){const S=l==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Ts.interpolationFactor.bind(void 0,S),zoomStops:o.stops.map(_=>_[0]),evaluate:({zoom:_})=>f(o,e,_,y,b)}}return{kind:"source",evaluate(S,_){const w=_&&_.properties?_.properties[o.property]:void 0;return w===void 0?jc(o.default,e.default):f(o,e,w,y,b)}}}function jc(o,e,r){return o!==void 0?o:e!==void 0?e:r!==void 0?r:void 0}function r_(o,e,r,a,u){return jc(typeof r===u?a[r]:void 0,o.default,e.default)}function n_(o,e,r){if(Wa(r)!=="number")return jc(o.default,e.default);const a=o.stops.length;if(a===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[a-1][0])return o.stops[a-1][1];const u=Ho(o.stops.map(l=>l[0]),r);return o.stops[u][1]}function $c(o,e,r){const a=o.base!==void 0?o.base:1;if(Wa(r)!=="number")return jc(o.default,e.default);const u=o.stops.length;if(u===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[u-1][0])return o.stops[u-1][1];const l=Ho(o.stops.map(_=>_[0]),r),f=function(_,w,A,T){const E=T-A,C=_-A;return E===0?0:w===1?C/E:(Math.pow(w,C)-1)/(Math.pow(w,E)-1)}(r,a,o.stops[l][0],o.stops[l+1][0]),y=o.stops[l][1],b=o.stops[l+1][1];let S=qr[e.type]||sv;if(o.colorSpace&&o.colorSpace!=="rgb"){const _=Zm[o.colorSpace];S=(w,A)=>_.reverse(_.interpolate(_.forward(w),_.forward(A),f))}return typeof y.evaluate=="function"?{evaluate(..._){const w=y.evaluate.apply(void 0,_),A=b.evaluate.apply(void 0,_);if(w!==void 0&&A!==void 0)return S(w,A,f)}}:S(y,b,f)}function ov(o,e,r){return e.type==="color"?r=tn.parse(r):e.type==="formatted"?r=Vi.fromString(r.toString()):e.type==="resolvedImage"?r=Ei.build(r.toString()):Wa(r)===e.type||e.type==="enum"&&e.values[r]||(r=void 0),jc(r,o.default,e.default)}is.register(Pl,{error:[{kind:"error"},[rn],(o,[e])=>{throw new ai(e.evaluate(o))}],typeof:[rn,[$r],(o,[e])=>Tn(Ln(e.evaluate(o)))],"to-rgba":[Pi(qt,4),[ns],(o,[e])=>e.evaluate(o).toRenderColor(null).toArray()],"to-hsla":[Pi(qt,4),[ns],(o,[e])=>e.evaluate(o).toRenderColor(null).toHslaArray()],rgb:[ns,[qt,qt,qt],Jm],rgba:[ns,[qt,qt,qt,qt],Jm],hsl:[ns,[qt,qt,qt],hf],hsla:[ns,[qt,qt,qt,qt],hf],has:{type:Hr,overloads:[[[rn],(o,[e])=>df(e.evaluate(o),o.properties())],[[rn,$a],(o,[e,r])=>df(e.evaluate(o),r.evaluate(o))]]},get:{type:$r,overloads:[[[rn],(o,[e])=>ya(e.evaluate(o),o.properties())],[[rn,$a],(o,[e,r])=>ya(e.evaluate(o),r.evaluate(o))]]},"feature-state":[$r,[rn],(o,[e])=>ya(e.evaluate(o),o.featureState||{})],properties:[$a,[],o=>o.properties()],"geometry-type":[rn,[],o=>o.geometryType()],id:[$r,[],o=>o.id()],zoom:[qt,[],o=>o.globals.zoom],pitch:[qt,[],o=>o.globals.pitch||0],"distance-from-center":[qt,[],o=>o.distanceFromCenter()],"measure-light":[qt,[rn],(o,[e])=>o.measureLight(e.evaluate(o))],"heatmap-density":[qt,[],o=>o.globals.heatmapDensity||0],"line-progress":[qt,[],o=>o.globals.lineProgress||0],"raster-value":[qt,[],o=>o.globals.rasterValue||0],"raster-particle-speed":[qt,[],o=>o.globals.rasterParticleSpeed||0],"sky-radial-progress":[qt,[],o=>o.globals.skyRadialProgress||0],accumulated:[$r,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[qt,va(qt),(o,e)=>{let r=0;for(const a of e)r+=a.evaluate(o);return r}],"*":[qt,va(qt),(o,e)=>{let r=1;for(const a of e)r*=a.evaluate(o);return r}],"-":{type:qt,overloads:[[[qt,qt],(o,[e,r])=>e.evaluate(o)-r.evaluate(o)],[[qt],(o,[e])=>-e.evaluate(o)]]},"/":[qt,[qt,qt],(o,[e,r])=>e.evaluate(o)/r.evaluate(o)],"%":[qt,[qt,qt],(o,[e,r])=>e.evaluate(o)%r.evaluate(o)],ln2:[qt,[],()=>Math.LN2],pi:[qt,[],()=>Math.PI],e:[qt,[],()=>Math.E],"^":[qt,[qt,qt],(o,[e,r])=>Math.pow(e.evaluate(o),r.evaluate(o))],sqrt:[qt,[qt],(o,[e])=>Math.sqrt(e.evaluate(o))],log10:[qt,[qt],(o,[e])=>Math.log(e.evaluate(o))/Math.LN10],ln:[qt,[qt],(o,[e])=>Math.log(e.evaluate(o))],log2:[qt,[qt],(o,[e])=>Math.log(e.evaluate(o))/Math.LN2],sin:[qt,[qt],(o,[e])=>Math.sin(e.evaluate(o))],cos:[qt,[qt],(o,[e])=>Math.cos(e.evaluate(o))],tan:[qt,[qt],(o,[e])=>Math.tan(e.evaluate(o))],asin:[qt,[qt],(o,[e])=>Math.asin(e.evaluate(o))],acos:[qt,[qt],(o,[e])=>Math.acos(e.evaluate(o))],atan:[qt,[qt],(o,[e])=>Math.atan(e.evaluate(o))],min:[qt,va(qt),(o,e)=>Math.min(...e.map(r=>r.evaluate(o)))],max:[qt,va(qt),(o,e)=>Math.max(...e.map(r=>r.evaluate(o)))],abs:[qt,[qt],(o,[e])=>Math.abs(e.evaluate(o))],round:[qt,[qt],(o,[e])=>{const r=e.evaluate(o);return r<0?-Math.round(-r):Math.round(r)}],floor:[qt,[qt],(o,[e])=>Math.floor(e.evaluate(o))],ceil:[qt,[qt],(o,[e])=>Math.ceil(e.evaluate(o))],"filter-==":[Hr,[rn,$r],(o,[e,r])=>o.properties()[e.value]===r.value],"filter-id-==":[Hr,[$r],(o,[e])=>o.id()===e.value],"filter-type-==":[Hr,[rn],(o,[e])=>o.geometryType()===e.value],"filter-<":[Hr,[rn,$r],(o,[e,r])=>{const a=o.properties()[e.value],u=r.value;return typeof a==typeof u&&a<u}],"filter-id-<":[Hr,[$r],(o,[e])=>{const r=o.id(),a=e.value;return typeof r==typeof a&&r<a}],"filter->":[Hr,[rn,$r],(o,[e,r])=>{const a=o.properties()[e.value],u=r.value;return typeof a==typeof u&&a>u}],"filter-id->":[Hr,[$r],(o,[e])=>{const r=o.id(),a=e.value;return typeof r==typeof a&&r>a}],"filter-<=":[Hr,[rn,$r],(o,[e,r])=>{const a=o.properties()[e.value],u=r.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[Hr,[$r],(o,[e])=>{const r=o.id(),a=e.value;return typeof r==typeof a&&r<=a}],"filter->=":[Hr,[rn,$r],(o,[e,r])=>{const a=o.properties()[e.value],u=r.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[Hr,[$r],(o,[e])=>{const r=o.id(),a=e.value;return typeof r==typeof a&&r>=a}],"filter-has":[Hr,[$r],(o,[e])=>e.value in o.properties()],"filter-has-id":[Hr,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Hr,[Pi(rn)],(o,[e])=>e.value.indexOf(o.geometryType())>=0],"filter-id-in":[Hr,[Pi($r)],(o,[e])=>e.value.indexOf(o.id())>=0],"filter-in-small":[Hr,[rn,Pi($r)],(o,[e,r])=>r.value.indexOf(o.properties()[e.value])>=0],"filter-in-large":[Hr,[rn,Pi($r)],(o,[e,r])=>function(a,u,l,f){for(;l<=f;){const y=l+f>>1;if(u[y]===a)return!0;u[y]>a?f=y-1:l=y+1}return!1}(o.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Hr,overloads:[[[Hr,Hr],(o,[e,r])=>e.evaluate(o)&&r.evaluate(o)],[va(Hr),(o,e)=>{for(const r of e)if(!r.evaluate(o))return!1;return!0}]]},any:{type:Hr,overloads:[[[Hr,Hr],(o,[e,r])=>e.evaluate(o)||r.evaluate(o)],[va(Hr),(o,e)=>{for(const r of e)if(r.evaluate(o))return!0;return!1}]]},"!":[Hr,[Hr],(o,[e])=>!e.evaluate(o)],"is-supported-script":[Hr,[rn],(o,[e])=>{const r=o.globals&&o.globals.isSupportedScript;return!r||r(e.evaluate(o))}],upcase:[rn,[rn],(o,[e])=>e.evaluate(o).toUpperCase()],downcase:[rn,[rn],(o,[e])=>e.evaluate(o).toLowerCase()],concat:[rn,va($r),(o,e)=>e.map(r=>Qs(r.evaluate(o))).join("")],"resolved-locale":[rn,[ju],(o,[e])=>e.evaluate(o).resolvedLocale()],random:[qt,[qt,qt,$r],(o,e)=>{const[r,a,u]=e.map(f=>f.evaluate(o));if(r>a||r===a)return r;let l;if(typeof u=="string")l=function(f){let y=0;if(f.length===0)return y;for(let b=0;b<f.length;b++)y=(y<<5)-y+f.charCodeAt(b),y|=0;return y}(u);else{if(typeof u!="number")throw new ai(`Invalid seed input: ${u}`);l=u}return r+Ym(l)()*(a-r)}]});class fh{constructor(e,r,a,u){this.expression=e,this._warningHistory={},this._evaluator=new Dc(a,u),this._defaultValue=r?function(l){return l.type==="color"&&(dh(l.default)||Array.isArray(l.default))?new tn(0,0,0,0):l.type==="color"?tn.parse(l.default)||null:l.default===void 0?null:l.default}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this.configDependencies=Ka(e)}evaluateWithoutErrorHandling(e,r,a,u,l,f,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,a,u,l,f,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=l||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new ai(`Expected value to be one of ${Object.keys(this._enumValues).map(_=>JSON.stringify(_)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function pf(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Pl}function Dl(o,e,r,a){const u=new Yd(Pl,[],e?function(f){const y={color:ns,string:rn,number:qt,enum:rn,boolean:Hr,formatted:No,resolvedImage:Ga};return f.type==="array"?Pi(y[f.value]||$r,f.length):y[f.type]}(e):void 0,void 0,void 0,r,a),l=u.parse(o,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?ff(new fh(l,e,r,a)):xa(u.errors)}class ph{constructor(e,r,a,u){this.kind=e,this._styleExpression=r,this.isLightConstant=a,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!Bc(r.expression),this.configDependencies=Ka(r.expression)}evaluateWithoutErrorHandling(e,r,a,u,l,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,l,f)}evaluate(e,r,a,u,l,f){return this._styleExpression.evaluate(e,r,a,u,l,f)}}class zl{constructor(e,r,a,u,l,f){this.kind=e,this.zoomStops=a,this._styleExpression=r,this.isStateDependent=e!=="camera"&&!Bc(r.expression),this.isLightConstant=l,this.isLineProgressConstant=f,this.configDependencies=Ka(r.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,r,a,u,l,f){return this._styleExpression.evaluateWithoutErrorHandling(e,r,a,u,l,f)}evaluate(e,r,a,u,l,f){return this._styleExpression.evaluate(e,r,a,u,l,f)}interpolationFactor(e,r,a){return this.interpolationType?Ts.interpolationFactor(this.interpolationType,e,r,a):0}}function i_(o,e,r,a){if((o=Dl(o,e,r,a)).result==="error")return o;const u=o.value.expression,l=Il(u);if(!l&&!Rl(e))return xa([new Ns("","data expressions not supported")]);const f=qo(u,["zoom","pitch","distance-from-center"]);if(!f&&!e_(e))return xa([new Ns("","zoom expressions not supported")]);const y=qo(u,["measure-light"]);if(!y&&!Qm(e))return xa([new Ns("","measure-light expression not supported")]);const b=qo(u,["line-progress"]);if(!b&&!function(w){return Uc(w.expression,"line-progress")}(e))return xa([new Ns("","line-progress expression not supported")]);const S=e.expression&&e.expression.relaxZoomRestriction,_=Ll(u);return _||f||S?_ instanceof Ns?xa([_]):_ instanceof Ts&&!hh(e)?xa([new Ns("",'"interpolate" expressions cannot be used with this property')]):ff(_?new zl(l&&b?"camera":"composite",o.value,_.labels,_ instanceof Ts?_.interpolation:void 0,y,b):new ph(l&&b?"constant":"source",o.value,y,b)):xa([new Ns("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class mh{constructor(e,r){this._parameters=e,this._specification=r,Uu(this,t_(this._parameters,this._specification))}static deserialize(e){return new mh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ll(o){let e=null;if(o instanceof ah)e=Ll(o.result);else if(o instanceof oh){for(const r of o.args)if(e=Ll(r),e)break}else(o instanceof kr||o instanceof Ts)&&o.input instanceof is&&o.input.name==="zoom"&&(e=o);return e instanceof Ns||o.eachChild(r=>{const a=Ll(r);a instanceof Ns?e=a:e&&a&&e!==a&&(e=new Ns("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var mf,_f,av=function(){if(_f)return mf;_f=1,mf=e;var o=3;function e(r,a,u){var l=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var f=new Int32Array(this.arrayBuffer);r=f[0],this.d=(a=f[1])+2*(u=f[2]);for(var y=0;y<this.d*this.d;y++){var b=f[o+y],S=f[o+y+1];l.push(b===S?null:f.subarray(b,S))}var _=f[o+l.length+1];this.keys=f.subarray(f[o+l.length],_),this.bboxes=f.subarray(_),this.insert=this._insertReadonly}else{this.d=a+2*u;for(var w=0;w<this.d*this.d;w++)l.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=r,this.padding=u,this.scale=a/r,this.uid=0;var A=u/a*r;this.min=-A,this.max=r+A}return e.prototype.insert=function(r,a,u,l,f){this._forEachCell(a,u,l,f,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(l),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(r,a,u,l,f,y){this.cells[f].push(y)},e.prototype.query=function(r,a,u,l,f){var y=this.min,b=this.max;if(r<=y&&a<=y&&b<=u&&b<=l&&!f)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(r,a,u,l,this._queryCell,S,{},f),S},e.prototype._queryCell=function(r,a,u,l,f,y,b,S){var _=this.cells[f];if(_!==null)for(var w=this.keys,A=this.bboxes,T=0;T<_.length;T++){var E=_[T];if(b[E]===void 0){var C=4*E;(S?S(A[C+0],A[C+1],A[C+2],A[C+3]):r<=A[C+2]&&a<=A[C+3]&&u>=A[C+0]&&l>=A[C+1])?(b[E]=!0,y.push(w[E])):b[E]=!1}}},e.prototype._forEachCell=function(r,a,u,l,f,y,b,S){for(var _=this._convertToCellCoord(r),w=this._convertToCellCoord(a),A=this._convertToCellCoord(u),T=this._convertToCellCoord(l),E=_;E<=A;E++)for(var C=w;C<=T;C++){var O=this.d*C+E;if((!S||S(this._convertFromCellCoord(E),this._convertFromCellCoord(C),this._convertFromCellCoord(E+1),this._convertFromCellCoord(C+1)))&&f.call(this,r,a,u,l,O,y,b,S))return}},e.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},e.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,a=o+this.cells.length+1+1,u=0,l=0;l<this.cells.length;l++)u+=this.cells[l].length;var f=new Int32Array(a+u+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var y=a,b=0;b<r.length;b++){var S=r[b];f[o+b]=y,f.set(S,y),y+=S.length}return f[o+r.length]=y,f.set(this.keys,y),f[o+r.length+1]=y+=this.keys.length,f.set(this.bboxes,y),y+=this.bboxes.length,f.buffer},mf}(),Ol=G(av);const Gc={};function Ft(o,e,r={}){Object.defineProperty(o,"_classRegistryKey",{value:e,writable:!1}),Gc[e]={klass:o,omit:r.omit||[]}}Ft(Object,"Object"),Ol.serialize=function(o,e){const r=o.toArrayBuffer();return e&&e.add(r),{buffer:r}},Ol.deserialize=function(o){return new Ol(o.buffer)},Object.defineProperty(Ol,"name",{value:"Grid"}),Ft(Ol,"Grid"),typeof DOMMatrix<"u"&&Ft(DOMMatrix,"DOMMatrix"),Ft(tn,"Color"),Ft(Error,"Error"),Ft(Vi,"Formatted"),Ft(Pc,"FormattedSection"),Ft(Ni,"AJAXError"),Ft(Ei,"ResolvedImage"),Ft(mh,"StylePropertyFunction"),Ft(fh,"StyleExpression",{omit:["_evaluator"]}),Ft(bs,"ImageId"),Ft(To,"ImageVariant"),Ft(zl,"ZoomDependentExpression"),Ft(ph,"ZoomConstantExpression"),Ft(is,"CompoundExpression",{omit:["_evaluate"]});for(const o in Pl)Gc[Pl[o]._classRegistryKey]||Ft(Pl[o],`Expression${o}`);function gf(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function s_(o){return self.ImageBitmap&&o instanceof ImageBitmap}function Ss(o,e){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(gf(o)||s_(o))return e&&e.add(o),o;if(ArrayBuffer.isView(o))return e&&e.add(o.buffer),o;if(o instanceof ImageData)return e&&e.add(o.data.buffer),o;if(Array.isArray(o)){const r=[];for(const a of o)r.push(Ss(a,e));return r}if(o instanceof Map){const r={$name:"Map",entries:[]};for(const[a,u]of o.entries())r.entries.push(Ss(a),Ss(u));return r}if(o instanceof Set){const r={$name:"Set"};let a=0;for(const u of o.values())r[++a]=Ss(u);return r}if(o instanceof DOMMatrix){const r={$name:"DOMMatrix"},a=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const u of a)r[u]=o[u];return r}if(typeof o=="bigint")return{$name:"BigInt",value:o.toString()};if(typeof o=="object"){const r=o.constructor,a=r._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${r.name}".`);const u=r.serialize?r.serialize(o,e):{};if(!r.serialize){for(const l in o)o.hasOwnProperty(l)&&(Gc[a].omit.indexOf(l)>=0||(u[l]=Ss(o[l],e)));o instanceof Error&&(u.message=o.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof o)}function ba(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||gf(o)||s_(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(ba);if(typeof o=="object"){const e=o.$name||"Object";if(e==="Map"){const u=o.entries||[],l=new Map;for(let f=0;f<u.length;f+=2)l.set(ba(u[f]),ba(u[f+1]));return l}if(e==="Set"){const u=new Set;for(const l of Object.keys(o))l!=="$name"&&u.add(ba(o[l]));return u}if(e==="DOMMatrix"){let u;return u=o.is2D?[o.a,o.b,o.c,o.d,o.e,o.f]:[o.m11,o.m12,o.m13,o.m14,o.m21,o.m22,o.m23,o.m24,o.m31,o.m32,o.m33,o.m34,o.m41,o.m42,o.m43,o.m44],new DOMMatrix(u)}if(e==="BigInt")return BigInt(o.value);const{klass:r}=Gc[e];if(!r)throw new Error(`Can't deserialize unregistered class "${e}".`);if(r.deserialize)return r.deserialize(o);const a=Object.create(r.prototype);for(const u of Object.keys(o))u!=="$name"&&(a[u]=ba(o[u]));return a}throw new Error("can't deserialize object of type "+typeof o)}const Qt={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519,Osage:o=>o>=66736&&o<=66815,"CJK Unified Ideographs Extension B":o=>o>=131072&&o<=173791};function yf(o){for(const e of o)if(_h(e.charCodeAt(0)))return!0;return!1}function o_(o){for(const e of o)if(!a_(e.charCodeAt(0)))return!1;return!0}function a_(o){return!(Qt.Arabic(o)||Qt["Arabic Supplement"](o)||Qt["Arabic Extended-A"](o)||Qt["Arabic Presentation Forms-A"](o)||Qt["Arabic Presentation Forms-B"](o))}function _h(o){return!(o!==746&&o!==747&&(o<4352||!(Qt["Bopomofo Extended"](o)||Qt.Bopomofo(o)||Qt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Qt["CJK Compatibility Ideographs"](o)||Qt["CJK Compatibility"](o)||Qt["CJK Radicals Supplement"](o)||Qt["CJK Strokes"](o)||!(!Qt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Qt["CJK Unified Ideographs Extension A"](o)||Qt["CJK Unified Ideographs"](o)||Qt["Enclosed CJK Letters and Months"](o)||Qt["Hangul Compatibility Jamo"](o)||Qt["Hangul Jamo Extended-A"](o)||Qt["Hangul Jamo Extended-B"](o)||Qt["Hangul Jamo"](o)||Qt["Hangul Syllables"](o)||Qt.Hiragana(o)||Qt["Ideographic Description Characters"](o)||Qt.Kanbun(o)||Qt["Kangxi Radicals"](o)||Qt["Katakana Phonetic Extensions"](o)||Qt.Katakana(o)&&o!==12540||!(!Qt["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Qt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Qt["Unified Canadian Aboriginal Syllabics"](o)||Qt["Unified Canadian Aboriginal Syllabics Extended"](o)||Qt["Vertical Forms"](o)||Qt["Yijing Hexagram Symbols"](o)||Qt["Yi Syllables"](o)||Qt["Yi Radicals"](o))))}function vf(o){return!(_h(o)||function(e){return!!(Qt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Qt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Qt["Letterlike Symbols"](e)||Qt["Number Forms"](e)||Qt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Qt["Control Pictures"](e)&&e!==9251||Qt["Optical Character Recognition"](e)||Qt["Enclosed Alphanumerics"](e)||Qt["Geometric Shapes"](e)||Qt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Qt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Qt["CJK Symbols and Punctuation"](e)||Qt.Katakana(e)||Qt["Private Use Area"](e)||Qt["CJK Compatibility Forms"](e)||Qt["Small Form Variants"](e)||Qt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(o))}function xf(o){return Qt.Arabic(o)||Qt["Arabic Supplement"](o)||Qt["Arabic Extended-A"](o)||Qt["Arabic Presentation Forms-A"](o)||Qt["Arabic Presentation Forms-B"](o)}function gh(o){return o>=1424&&o<=2303||Qt["Arabic Presentation Forms-A"](o)||Qt["Arabic Presentation Forms-B"](o)}function l_(o,e){return!(!e&&gh(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Qt.Khmer(o))}function lv(o){for(const e of o)if(gh(e.charCodeAt(0)))return!0;return!1}const Eo="deferred",bf="loading",wf="loaded";let yh=null,as="unavailable",ro=null;const Tf=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(as="error"),yh&&yh(o)};function kl(){vh.fire(new wo("pluginStateChange",{pluginStatus:as,pluginURL:ro}))}const vh=new ma,Sf=function(){return as},c_=function(){if(as!==Eo||!ro)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");as=bf,kl(),ro&&ja({url:ro},o=>{o?Tf(o):(as=wf,kl())})},ls={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>as===wf||ls.applyArabicShaping!=null,isLoading:()=>as===bf,setState(o){as=o.pluginStatus,ro=o.pluginURL},isParsed:()=>ls.applyArabicShaping!=null&&ls.processBidirectionalText!=null&&ls.processStyledBidirectionalText!=null,getPluginURL:()=>ro};class gn{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch,this.brightness=r.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(r,a){for(const u of r)if(!l_(u.charCodeAt(0),a))return!1;return!0}(e,ls.isLoaded())}}class xh{constructor(e,r,a,u){this.property=e,this.value=r,this.expression=function(l,f,y,b){if(dh(l))return new mh(l,f);if(pf(l)||Array.isArray(l)&&l.length>0){const S=i_(l,f,y,b);if(S.result==="error")throw new Error(S.value.map(_=>`${_.key}: ${_.message}`).join(", "));return S.value}{let S=l;return typeof l=="string"&&f.type==="color"&&(S=tn.parse(l)),{kind:"constant",configDependencies:new Set,evaluate:()=>S}}}(r===void 0?e.specification.default:r,e.specification,a,u)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,r,a){return this.property.possiblyEvaluate(this,e,r,a)}}class bh{constructor(e,r,a){this.property=e,this.value=new xh(e,void 0,r,a)}transitioned(e,r){return new qc(this.property,this.value,r,Vr({},e.transition,this.transition),e.now)}untransitioned(){return new qc(this.property,this.value,null,{},0)}}class wh{constructor(e,r,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=r,this._options=a,this.configDependencies=new Set}getValue(e){return Kn(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new bh(this._values[e].property,this._scope,this._options)),this._values[e].value=new xh(this._values[e].property,r===null?void 0:Kn(r),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,r){r&&(this._options=r);const a=this._properties.properties;if(e)for(const u in e){const l=e[u];if(u.endsWith("-transition")){const f=u.slice(0,-11);a[f]&&this.setTransition(f,l)}else a.hasOwnProperty(u)&&this.setValue(u,l)}}getTransition(e){return Kn(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new bh(this._values[e].property)),this._values[e].transition=Kn(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a);const u=this.getTransition(r);u!==void 0&&(e[`${r}-transition`]=u)}return e}transitioned(e,r){const a=new Qa(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,r._values[u]);return a}untransitioned(){const e=new Qa(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class qc{constructor(e,r,a,u,l){const f=u.delay||0,y=u.duration||0;l=l||0,this.property=e,this.value=r,this.begin=l+f,this.end=this.begin+y,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,r,a){const u=e.now||0,l=this.value.possiblyEvaluate(e,r,a),f=this.prior;if(f){if(u>this.end)return this.prior=null,l;if(this.value.isDataDriven())return this.prior=null,l;if(u<this.begin)return f.possiblyEvaluate(e,r,a);{const y=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,r,a),l,Gt(y))}}return l}}class Qa{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,a){const u=new Bl(this._properties);for(const l of Object.keys(this._values))u._values[l]=this._values[l].possiblyEvaluate(e,r,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class cv{constructor(e,r,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=r,this._options=a,this.configDependencies=new Set}getValue(e){return Kn(this._values[e].value)}setValue(e,r){this._values[e]=new xh(this._values[e].property,r===null?void 0:Kn(r),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const r of Object.keys(this._values)){const a=this.getValue(r);a!==void 0&&(e[r]=a)}return e}possiblyEvaluate(e,r,a){const u=new Bl(this._properties);for(const l of Object.keys(this._values))u._values[l]=this._values[l].possiblyEvaluate(e,r,a);return u}}class Fl{constructor(e,r,a){this.property=e,this.value=r,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,r,a,u){return this.property.evaluate(this.value,this.parameters,e,r,a,u)}}class Bl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class bt{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,a){const u=qr[this.specification.type];return u?u(e,r,a):e}}class kt{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,a,u){return new Fl(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(r,null,{},a,u)}:e.expression,r)}interpolate(e,r,a){if(e.value.kind!=="constant"||r.value.kind!=="constant")return e;if(e.value.value===void 0||r.value.value===void 0)return new Fl(this,{kind:"constant",value:void 0},e.parameters);const u=qr[this.specification.type];return u?new Fl(this,{kind:"constant",value:u(e.value.value,r.value.value,a)},e.parameters):e}evaluate(e,r,a,u,l,f){return e.kind==="constant"?e.value:e.evaluate(r,a,u,l,f)}}class el{constructor(e){this.specification=e}possiblyEvaluate(e,r,a,u){return!!e.expression.evaluate(r,null,{},a,u)}interpolate(){return!1}}class Nn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const r=new gn(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const l=this.defaultPropertyValues[a]=new xh(u,void 0),f=this.defaultTransitionablePropertyValues[a]=new bh(u);this.defaultTransitioningPropertyValues[a]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=l.possiblyEvaluate(r)}}}Ft(kt,"DataDrivenProperty"),Ft(bt,"DataConstantProperty"),Ft(el,"ColorRampProperty");var Ue=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"iconsets":{"experimental":true,"type":"iconsets"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"experimental":true,"type":"*"},"selectors":{"experimental":true,"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"experimental":true,"type":"string","required":true},"properties":{"experimental":true,"type":"selectorProperty","required":false},"featureNamespace":{"experimental":true,"type":"string","required":false},"_uniqueFeatureID":{"experimental":true,"type":"boolean","private":true,"required":false}},"selectorProperty":{"experimental":true,"*":{"experimental":true,"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"required":true,"type":"enum","values":{"sprite":1}},"url":{"required":true,"type":"string"}},"iconset_source":{"type":{"required":true,"type":"enum","values":{"source":1}},"source":{"required":true,"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","experimental":true,"private":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","experimental":true,"private":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","transition":true,"experimental":true,"private":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"*"}}}');function u_(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Th(o){if(Array.isArray(o))return o.map(Th);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const e={};for(const r in o)e[r]=Th(o[r]);return e}return u_(o)}function Ef(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const e of o.slice(1))if(!Ef(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Af(o,e="",r=null,a="fill"){if(o==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ef(o)||(o=Wo(o));const u=o;let l=!0;try{l=function(_){if(!Nl(_))return _;let w=Th(_);return d_(w),w=h_(w),w}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let f=null,y=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){y=Ue[`filter_${a}`];const _=Dl(l,y,e,r);if(_.result==="error")throw new Error(_.value.map(w=>`${w.key}: ${w.message}`).join(", "));f=(w,A,T)=>_.value.evaluate(w,A,{},T)}let b=null,S=null;if(l!==u){const _=Dl(u,y,e,r);if(_.result==="error")throw new Error(_.value.map(w=>`${w.key}: ${w.message}`).join(", "));b=(w,A,T,E,C)=>_.value.evaluate(w,A,{},T,void 0,void 0,E,C),S=!Il(_.value.expression)}return{filter:f,dynamicFilter:b||void 0,needGeometry:f_(l),needFeature:!!S}}function h_(o){if(!Array.isArray(o))return o;const e=function(r){if(uv.has(r[0])){for(let a=1;a<r.length;a++)if(Nl(r[a]))return!0}return r}(o);return e===!0?e:e.map(r=>h_(r))}function d_(o){let e=!1;const r=[];if(o[0]==="case"){for(let a=1;a<o.length-1;a+=2)e=e||Nl(o[a]),r.push(o[a+1]);r.push(o[o.length-1])}else if(o[0]==="match"){e=e||Nl(o[1]);for(let a=2;a<o.length-1;a+=2)r.push(o[a+1]);r.push(o[o.length-1])}else if(o[0]==="step"){e=e||Nl(o[1]);for(let a=1;a<o.length-1;a+=2)r.push(o[a+1])}e&&(o.length=0,o.push("any",...r));for(let a=1;a<o.length;a++)d_(o[a])}function Nl(o){if(!Array.isArray(o))return!1;if((e=o[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let r=1;r<o.length;r++)if(Nl(o[r]))return!0;return!1}const uv=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function hv(o,e){return o<e?-1:o>e?1:0}function f_(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let e=1;e<o.length;e++)if(f_(o[e]))return!0;return!1}function Wo(o){if(!o)return!0;const e=o[0];return o.length<=1?e!=="any":e==="=="?Sh(o[1],o[2],"=="):e==="!="?Eh(Sh(o[1],o[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Sh(o[1],o[2],e):e==="any"?(r=o.slice(1),["any"].concat(r.map(Wo))):e==="all"?["all"].concat(o.slice(1).map(Wo)):e==="none"?["all"].concat(o.slice(1).map(Wo).map(Eh)):e==="in"?Mf(o[1],o.slice(2)):e==="!in"?Eh(Mf(o[1],o.slice(2))):e==="has"?Hc(o[1]):e!=="!has"||Eh(Hc(o[1]));var r}function Sh(o,e,r){switch(o){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,o,e]}}function Mf(o,e){if(e.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",o,["literal",e.sort(hv)]]:["filter-in-small",o,["literal",e]]}}function Hc(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Eh(o){return["!",o]}const Ah="";function Es(o,e){return e?`${o}${Ah}${e}`:o}const If="-transition",Vl=new Set(["fill","line","background","hillshade","raster"]);class Yi extends ma{constructor(e,r,a,u,l){if(super(),this.id=e.id,this.fqid=Es(this.id,a),this.type=e.type,this.scope=a,this.lut=u,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=Dl(this.filter,Ue[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),r.layout&&(this._unevaluatedLayout=new cv(r.layout,this.scope,l),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),r.paint){this._transitionablePaint=new wh(r.paint,this.scope,l);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Bl(r.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Vl.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r){if(this.type==="custom"&&e==="visibility")return void(this.visibility=r);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(If)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r){const a=this._transitionablePaint,u=a._properties.properties;if(e.endsWith(If)){const w=e.slice(0,-11);return u[w]&&a.setTransition(w,r||void 0),!1}if(!u[e])return!1;const l=a._values[e],f=l.value.isDataDriven(),y=l.value;a.setValue(e,r),this.configDependencies=new Set([...this.configDependencies,...a.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const b=a._values[e].value,S=b.isDataDriven(),_=e.endsWith("pattern")||e==="line-dasharray";return S||f||_||this._handleOverridablePaintPropertyUpdate(e,y,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,r,a){return null}_handleOverridablePaintPropertyUpdate(e,r,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){return vo({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,r)=>!(e===void 0||r==="layout"&&!Object.keys(e).length||r==="paint"&&!Object.keys(e).length))}is3D(e){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof Fl&&Rl(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Af(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,r,a,u,l,f,y,b,S){}}const dv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Wc{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class bn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Zr(o,e=1){let r=0,a=0;return{members:o.map(u=>{const l=dv[u.type].BYTES_PER_ELEMENT,f=r=Cf(r,Math.max(e,l)),y=u.components||1;return a=Math.max(a,l),r+=l*y,{name:u.name,type:u.type,components:y,offset:f}}),size:Cf(r,Math.max(a,e)),alignment:e}}function Cf(o,e){return Math.ceil(o/e)*e}class Ao extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.int16[u+0]=r,this.int16[u+1]=a,e}}Ao.prototype.bytesPerElement=4,Ft(Ao,"StructArrayLayout2i4");class tl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const l=3*e;return this.int16[l+0]=r,this.int16[l+1]=a,this.int16[l+2]=u,e}}tl.prototype.bytesPerElement=6,Ft(tl,"StructArrayLayout3i6");class rl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a,u)}emplace(e,r,a,u,l){const f=4*e;return this.int16[f+0]=r,this.int16[f+1]=a,this.int16[f+2]=u,this.int16[f+3]=l,e}}rl.prototype.bytesPerElement=8,Ft(rl,"StructArrayLayout4i8");class wa extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}wa.prototype.bytesPerElement=4,Ft(wa,"StructArrayLayout1f4");class Pf extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const l=4*e,f=2*e;return this.int16[l+0]=r,this.int16[l+1]=a,this.float32[f+1]=u,e}}Pf.prototype.bytesPerElement=8,Ft(Pf,"StructArrayLayout2i1f8");class js extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const l=4*e;return this.int16[l+0]=r,this.int16[l+1]=a,this.int16[l+2]=u,e}}js.prototype.bytesPerElement=8,Ft(js,"StructArrayLayout3i8");class Rf extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u,l)}emplace(e,r,a,u,l,f){const y=5*e;return this.int16[y+0]=r,this.int16[y+1]=a,this.int16[y+2]=u,this.int16[y+3]=l,this.int16[y+4]=f,e}}Rf.prototype.bytesPerElement=10,Ft(Rf,"StructArrayLayout5i10");class Mh extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,l,f,y)}emplace(e,r,a,u,l,f,y,b){const S=6*e,_=12*e,w=3*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.uint8[_+4]=u,this.uint8[_+5]=l,this.uint8[_+6]=f,this.uint8[_+7]=y,this.float32[w+2]=b,e}}Mh.prototype.bytesPerElement=12,Ft(Mh,"StructArrayLayout2i4ub1f12");class Mo extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const l=3*e;return this.float32[l+0]=r,this.float32[l+1]=a,this.float32[l+2]=u,e}}Mo.prototype.bytesPerElement=12,Ft(Mo,"StructArrayLayout3f12");class Ta extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u,l)}emplace(e,r,a,u,l,f){const y=6*e,b=3*e;return this.uint16[y+0]=r,this.uint16[y+1]=a,this.uint16[y+2]=u,this.uint16[y+3]=l,this.float32[b+2]=f,e}}Ta.prototype.bytesPerElement=12,Ft(Ta,"StructArrayLayout4ui1f12");class Ih extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a,u)}emplace(e,r,a,u,l){const f=4*e;return this.uint16[f+0]=r,this.uint16[f+1]=a,this.uint16[f+2]=u,this.uint16[f+3]=l,e}}Ih.prototype.bytesPerElement=8,Ft(Ih,"StructArrayLayout4ui8");class Ch extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,l,f)}emplace(e,r,a,u,l,f,y){const b=6*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+3]=l,this.int16[b+4]=f,this.int16[b+5]=y,e}}Ch.prototype.bytesPerElement=12,Ft(Ch,"StructArrayLayout6i12");class Df extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y,b,S,_,w,A){const T=this.length;return this.resize(T+1),this.emplace(T,e,r,a,u,l,f,y,b,S,_,w,A)}emplace(e,r,a,u,l,f,y,b,S,_,w,A,T){const E=12*e;return this.int16[E+0]=r,this.int16[E+1]=a,this.int16[E+2]=u,this.int16[E+3]=l,this.uint16[E+4]=f,this.uint16[E+5]=y,this.uint16[E+6]=b,this.uint16[E+7]=S,this.int16[E+8]=_,this.int16[E+9]=w,this.int16[E+10]=A,this.int16[E+11]=T,e}}Df.prototype.bytesPerElement=24,Ft(Df,"StructArrayLayout4i4ui4i24");class zf extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,l,f)}emplace(e,r,a,u,l,f,y){const b=10*e,S=5*e;return this.int16[b+0]=r,this.int16[b+1]=a,this.int16[b+2]=u,this.float32[S+2]=l,this.float32[S+3]=f,this.float32[S+4]=y,e}}zf.prototype.bytesPerElement=20,Ft(zf,"StructArrayLayout3i3f20");class nl extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a,u)}emplace(e,r,a,u,l){const f=4*e;return this.float32[f+0]=r,this.float32[f+1]=a,this.float32[f+2]=u,this.float32[f+3]=l,e}}nl.prototype.bytesPerElement=16,Ft(nl,"StructArrayLayout4f16");class Lf extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Lf.prototype.bytesPerElement=4,Ft(Lf,"StructArrayLayout1ul4");class Sa extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.uint16[u+0]=r,this.uint16[u+1]=a,e}}Sa.prototype.bytesPerElement=4,Ft(Sa,"StructArrayLayout2ui4");class Ph extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y,b,S,_,w,A,T){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,a,u,l,f,y,b,S,_,w,A,T)}emplace(e,r,a,u,l,f,y,b,S,_,w,A,T,E){const C=20*e,O=10*e;return this.int16[C+0]=r,this.int16[C+1]=a,this.int16[C+2]=u,this.int16[C+3]=l,this.int16[C+4]=f,this.float32[O+3]=y,this.float32[O+4]=b,this.float32[O+5]=S,this.float32[O+6]=_,this.int16[C+14]=w,this.uint32[O+8]=A,this.uint16[C+18]=T,this.uint16[C+19]=E,e}}Ph.prototype.bytesPerElement=40,Ft(Ph,"StructArrayLayout5i4f1i1ul2ui40");class Rh extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,l,f,y)}emplace(e,r,a,u,l,f,y,b){const S=8*e;return this.int16[S+0]=r,this.int16[S+1]=a,this.int16[S+2]=u,this.int16[S+4]=l,this.int16[S+5]=f,this.int16[S+6]=y,this.int16[S+7]=b,e}}Rh.prototype.bytesPerElement=16,Ft(Rh,"StructArrayLayout3i2i2i16");class Of extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u,l)}emplace(e,r,a,u,l,f){const y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=u,this.int16[b+6]=l,this.int16[b+7]=f,e}}Of.prototype.bytesPerElement=16,Ft(Of,"StructArrayLayout2f1f2i16");class kf extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f){const y=this.length;return this.resize(y+1),this.emplace(y,e,r,a,u,l,f)}emplace(e,r,a,u,l,f,y){const b=20*e,S=5*e;return this.uint8[b+0]=r,this.uint8[b+1]=a,this.float32[S+1]=u,this.float32[S+2]=l,this.float32[S+3]=f,this.float32[S+4]=y,e}}kf.prototype.bytesPerElement=20,Ft(kf,"StructArrayLayout2ub4f20");class wi extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,r,a)}emplace(e,r,a,u){const l=3*e;return this.uint16[l+0]=r,this.uint16[l+1]=a,this.uint16[l+2]=u,e}}wi.prototype.bytesPerElement=6,Ft(wi,"StructArrayLayout3ui6");class Dh extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O,k,U,V,N,$){const W=this.length;return this.resize(W+1),this.emplace(W,e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O,k,U,V,N,$)}emplace(e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O,k,U,V,N,$,W){const K=30*e,ae=15*e,ie=60*e;return this.int16[K+0]=r,this.int16[K+1]=a,this.int16[K+2]=u,this.float32[ae+2]=l,this.float32[ae+3]=f,this.uint16[K+8]=y,this.uint16[K+9]=b,this.uint32[ae+5]=S,this.uint32[ae+6]=_,this.uint32[ae+7]=w,this.uint16[K+16]=A,this.uint16[K+17]=T,this.uint16[K+18]=E,this.float32[ae+10]=C,this.float32[ae+11]=O,this.uint8[ie+48]=k,this.uint8[ie+49]=U,this.uint8[ie+50]=V,this.uint32[ae+13]=N,this.int16[K+28]=$,this.uint8[ie+58]=W,e}}Dh.prototype.bytesPerElement=60,Ft(Dh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Io extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O,k,U,V,N,$,W,K,ae,ie,se,ve,le,xe,Me,Se,Ce,Ie){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O,k,U,V,N,$,W,K,ae,ie,se,ve,le,xe,Me,Se,Ce,Ie)}emplace(e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O,k,U,V,N,$,W,K,ae,ie,se,ve,le,xe,Me,Se,Ce,Ie,Fe){const ze=20*e,Ne=40*e,it=80*e;return this.float32[ze+0]=r,this.float32[ze+1]=a,this.int16[Ne+4]=u,this.int16[Ne+5]=l,this.int16[Ne+6]=f,this.int16[Ne+7]=y,this.int16[Ne+8]=b,this.int16[Ne+9]=S,this.int16[Ne+10]=_,this.int16[Ne+11]=w,this.int16[Ne+12]=A,this.uint16[Ne+13]=T,this.uint16[Ne+14]=E,this.uint16[Ne+15]=C,this.uint16[Ne+16]=O,this.uint16[Ne+17]=k,this.uint16[Ne+18]=U,this.uint16[Ne+19]=V,this.uint16[Ne+20]=N,this.uint16[Ne+21]=$,this.uint16[Ne+22]=W,this.uint16[Ne+23]=K,this.uint16[Ne+24]=ae,this.uint16[Ne+25]=ie,this.uint16[Ne+26]=se,this.uint16[Ne+27]=ve,this.uint32[ze+14]=le,this.float32[ze+15]=xe,this.float32[ze+16]=Me,this.float32[ze+17]=Se,this.float32[ze+18]=Ce,this.uint8[it+76]=Ie,this.uint16[Ne+39]=Fe,e}}Io.prototype.bytesPerElement=80,Ft(Io,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Ea extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,r,a,u,l)}emplace(e,r,a,u,l,f){const y=5*e;return this.float32[y+0]=r,this.float32[y+1]=a,this.float32[y+2]=u,this.float32[y+3]=l,this.float32[y+4]=f,e}}Ea.prototype.bytesPerElement=20,Ft(Ea,"StructArrayLayout5f20");class Ff extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,l,f,y)}emplace(e,r,a,u,l,f,y,b){const S=7*e;return this.float32[S+0]=r,this.float32[S+1]=a,this.float32[S+2]=u,this.float32[S+3]=l,this.float32[S+4]=f,this.float32[S+5]=y,this.float32[S+6]=b,e}}Ff.prototype.bytesPerElement=28,Ft(Ff,"StructArrayLayout7f28");class Bf extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y,b,S,_,w){const A=this.length;return this.resize(A+1),this.emplace(A,e,r,a,u,l,f,y,b,S,_,w)}emplace(e,r,a,u,l,f,y,b,S,_,w,A){const T=11*e;return this.float32[T+0]=r,this.float32[T+1]=a,this.float32[T+2]=u,this.float32[T+3]=l,this.float32[T+4]=f,this.float32[T+5]=y,this.float32[T+6]=b,this.float32[T+7]=S,this.float32[T+8]=_,this.float32[T+9]=w,this.float32[T+10]=A,e}}Bf.prototype.bytesPerElement=44,Ft(Bf,"StructArrayLayout11f44");class Nf extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y,b,S){const _=this.length;return this.resize(_+1),this.emplace(_,e,r,a,u,l,f,y,b,S)}emplace(e,r,a,u,l,f,y,b,S,_){const w=9*e;return this.float32[w+0]=r,this.float32[w+1]=a,this.float32[w+2]=u,this.float32[w+3]=l,this.float32[w+4]=f,this.float32[w+5]=y,this.float32[w+6]=b,this.float32[w+7]=S,this.float32[w+8]=_,e}}Nf.prototype.bytesPerElement=36,Ft(Nf,"StructArrayLayout9f36");class Aa extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const a=this.length;return this.resize(a+1),this.emplace(a,e,r)}emplace(e,r,a){const u=2*e;return this.float32[u+0]=r,this.float32[u+1]=a,e}}Aa.prototype.bytesPerElement=8,Ft(Aa,"StructArrayLayout2f8");class zh extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,a,u){const l=this.length;return this.resize(l+1),this.emplace(l,e,r,a,u)}emplace(e,r,a,u,l){const f=6*e;return this.uint32[3*e+0]=r,this.uint16[f+2]=a,this.uint16[f+3]=u,this.uint16[f+4]=l,e}}zh.prototype.bytesPerElement=12,Ft(zh,"StructArrayLayout1ul3ui12");class Lh extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Lh.prototype.bytesPerElement=2,Ft(Lh,"StructArrayLayout1ui2");class Vf extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O){const k=this.length;return this.resize(k+1),this.emplace(k,e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O)}emplace(e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O,k){const U=16*e;return this.float32[U+0]=r,this.float32[U+1]=a,this.float32[U+2]=u,this.float32[U+3]=l,this.float32[U+4]=f,this.float32[U+5]=y,this.float32[U+6]=b,this.float32[U+7]=S,this.float32[U+8]=_,this.float32[U+9]=w,this.float32[U+10]=A,this.float32[U+11]=T,this.float32[U+12]=E,this.float32[U+13]=C,this.float32[U+14]=O,this.float32[U+15]=k,e}}Vf.prototype.bytesPerElement=64,Ft(Vf,"StructArrayLayout16f64");class Zc extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,a,u,l,f,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,a,u,l,f,y)}emplace(e,r,a,u,l,f,y,b){const S=10*e,_=5*e;return this.uint16[S+0]=r,this.uint16[S+1]=a,this.uint16[S+2]=u,this.uint16[S+3]=l,this.float32[_+2]=f,this.float32[_+3]=y,this.float32[_+4]=b,e}}Zc.prototype.bytesPerElement=20,Ft(Zc,"StructArrayLayout4ui3f20");class Uf extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.int16[1*e+0]=r,e}}Uf.prototype.bytesPerElement=2,Ft(Uf,"StructArrayLayout1i2");class Oh extends bn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint8[1*e+0]=r,e}}Oh.prototype.bytesPerElement=1,Ft(Oh,"StructArrayLayout1ub1");class Xc extends Wc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Xc.prototype.size=40;class p_ extends Ph{get(e){return new Xc(this,e)}}Ft(p_,"CollisionBoxArray");class m_ extends Wc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}m_.prototype.size=60;class __ extends Dh{get(e){return new m_(this,e)}}Ft(__,"PlacedSymbolArray");class g_ extends Wc{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}g_.prototype.size=80;class y_ extends Io{get(e){return new g_(this,e)}}Ft(y_,"SymbolInstanceArray");class Kc extends wa{getoffsetX(e){return this.float32[1*e+0]}}Ft(Kc,"GlyphOffsetArray");class Yc extends Ao{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ft(Yc,"SymbolLineVertexArray");class cs extends Wc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}cs.prototype.size=12;class Jc extends zh{get(e){return new cs(this,e)}}Ft(Jc,"FeatureIndexArray");class v_ extends Sa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ft(v_,"FillExtrusionCentroidArray");class x_ extends Wc{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}x_.prototype.size=6;class b_ extends tl{get(e){return new x_(this,e)}}Ft(b_,"FillExtrusionWallArray");const fv=Zr([{name:"a_pos",components:2,type:"Int16"}],4),jf=Zr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Vn{constructor(e=[]){this.segments=e}_prepareSegment(e,r,a,u){let l=this.segments[this.segments.length-1];return e>Vn.MAX_VERTEX_ARRAY_LENGTH&&Pr(`Max vertices per segment is ${Vn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!l||l.vertexLength+e>Vn.MAX_VERTEX_ARRAY_LENGTH||l.sortKey!==u)&&(l={vertexOffset:r,primitiveOffset:a,vertexLength:0,primitiveLength:0},u!==void 0&&(l.sortKey=u),this.segments.push(l)),l}prepareSegment(e,r,a,u){return this._prepareSegment(e,r.length,a.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,a,u){return new Vn([{vertexOffset:e,primitiveOffset:r,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function kh(o,e){return 256*(o=Ye(Math.floor(o),0,255))+Ye(Math.floor(e),0,255)}Vn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ft(Vn,"SegmentVector");const pv=Zr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),mv=Zr([{name:"a_dash",components:4,type:"Uint16"}]);class Ul{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,r,a,u){this.ids.push(Fh(e)),this.positions.push(r,a,u)}eachPosition(e,r){const a=Fh(e);let u=0,l=this.ids.length-1;for(;u<l;){const f=u+l>>1;this.ids[f]>=a?l=f:u=f+1}for(;this.ids[u]===a;)r(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,r){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return $f(a,u,0,a.length-1),r&&(r.add(a.buffer),r.add(u.buffer)),{ids:a,positions:u}}static deserialize(e){const r=new Ul;let a;r.ids=e.ids,r.positions=e.positions;for(const u of r.ids)u!==a&&r.uniqueIds.push(u),a=u;return r.indexed=!0,r}}function Fh(o){const e=+o;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Js(String(o))}function $f(o,e,r,a){for(;r<a;){const u=o[r+a>>1];let l=r-1,f=a+1;for(;;){do l++;while(o[l]<u);do f--;while(o[f]>u);if(l>=f)break;Qc(o,l,f),Qc(e,3*l,3*f),Qc(e,3*l+1,3*f+1),Qc(e,3*l+2,3*f+2)}f-r<a-f?($f(o,e,r,f),r=f+1):($f(o,e,f+1,a),a=f)}}function Qc(o,e,r){const a=o[e];o[e]=o[r],o[r]=a}Ft(Ul,"FeaturePositionMap");class Co{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,r){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,r),this.initialized=!0),!!this.location}set(e,r,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Bh extends Co{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Jn extends Co{constructor(e){super(e),this.current=0}set(e,r,a){this.fetchUniformLocation(e,r)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class As extends Co{constructor(e){super(e),this.current=[0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Nh extends Co{constructor(e){super(e),this.current=[0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Vh extends Co{constructor(e){super(e),this.current=[0,0,0,0]}set(e,r,a){this.fetchUniformLocation(e,r)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class Gf extends Co{constructor(e){super(e),this.current=tn.transparent.toRenderColor(null)}set(e,r,a){this.fetchUniformLocation(e,r)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const _v=new Float32Array(16);class il extends Co{constructor(e){super(e),this.current=_v}set(e,r,a){if(this.fetchUniformLocation(e,r)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const gv=new Float32Array(9),yv=new Float32Array(4);class qf extends Co{constructor(e){super(e),this.current=yv}set(e,r,a){if(this.fetchUniformLocation(e,r)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Hf(o){return[kh(255*o.r,255*o.g),kh(255*o.b,255*o.a)]}class jl{constructor(e,r,a,u){this.value=e,this.uniformNames=r.map(l=>`u_${l}`),this.type=a,this.context=u}setUniform(e,r,a,u,l){const f=u.constantOr(this.value);r.set(e,l,f instanceof tn?f.toRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,r){return this.type==="color"?new Gf(e):new Jn(e)}}class $l{constructor(e,r){this.uniformNames=r.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,r,a,u,l){const f=l==="u_pattern"||l==="u_dash"?this.pattern:l==="u_pixel_ratio"?this.pixelRatio:null;f&&r.set(e,l,f)}getBinding(e,r){return r==="u_pattern"||r==="u_dash"?new Vh(e):new Jn(e)}}class Zo{constructor(e,r,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=r.map(l=>({name:`a_${l}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,r,a,u,l,f,y){const b=this.paintVertexArray.length,S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new gn(0,{brightness:f}),r,{},l,u,y):this.expression.kind==="constant"&&this.expression.value,_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:f}),r,{},l,u,y):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(b,e,S,_?null:this.context.lut)}updatePaintArray(e,r,a,u,l,f,y){const b=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:y},a,u,void 0,l):this.expression.kind==="constant"&&this.expression.value,S=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:y}),a,u,void 0,l):this.lutExpression.value)==="none";this._setPaintValue(e,r,b,S?null:this.context.lut)}_setPaintValue(e,r,a,u){if(this.type==="color"){const l=Hf(a.toRenderColor(u));for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,l[0],l[1])}else{for(let l=e;l<r;l++)this.paintVertexArray.emplace(l,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class no{constructor(e,r,a,u,l,f){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=u,this.context=l,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,r,a,u,l,f,y){const b=this.expression.evaluate(new gn(this.context.zoom,{brightness:f}),r,{},l,u,y),S=this.expression.evaluate(new gn(this.context.zoom+1,{brightness:f}),r,{},l,u,y),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:f}),r,{},l,u,y):this.lutExpression.value)==="none",w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,b,S,_?null:this.context.lut)}updatePaintArray(e,r,a,u,l,f,y){const b=this.expression.evaluate({zoom:this.context.zoom,brightness:y},a,u,void 0,l),S=this.expression.evaluate({zoom:this.context.zoom+1,brightness:y},a,u,void 0,l),_=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:y}),a,u,void 0,l):this.lutExpression.value)==="none";this._setPaintValue(e,r,b,S,_?null:this.context.lut)}_setPaintValue(e,r,a,u,l){if(this.type==="color"){const f=Hf(a.toRenderColor(l)),y=Hf(a.toRenderColor(l));for(let b=e;b<r;b++)this.paintVertexArray.emplace(b,f[0],f[1],y[0],y[1])}else{for(let f=e;f<r;f++)this.paintVertexArray.emplace(f,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r,a,u,l){const f=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=Ye(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);r.set(e,l,y)}getBinding(e,r){return new Jn(e)}}class Ma{constructor(e,r,a,u,l){this.expression=e,this.layerId=l,this.paintVertexAttributes=(a==="array"?mv:pv).members;for(let f=0;f<r.length;++f);this.paintVertexArray=new u}populatePaintArray(e,r,a,u){const l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,r.patterns&&r.patterns[this.layerId],a)}updatePaintArray(e,r,a,u,l,f,y){this._setPaintValues(e,r,a.patterns&&a.patterns[this.layerId],f)}_setPaintValues(e,r,a,u){if(!u||!a)return;const l=u[a];if(!l)return;const{tl:f,br:y,pixelRatio:b}=l;for(let S=e;S<r;S++)this.paintVertexArray.emplace(S,f[0],f[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class sl{constructor(e,r,a=()=>!0){this.binders={},this._buffers=[],this.context=r;const u=[];for(const l in e.paint._values){const f=e.paint.get(l);if(l.endsWith("-use-theme")||!a(l)||!(f instanceof Fl&&Rl(f.property.specification)))continue;const y=xv(l,e.type),b=f.value,S=f.property.specification.type,_=!!f.property.useIntegerZoom,w=l==="line-dasharray"||l.endsWith("pattern"),A=e.paint.get(`${l}-use-theme`),T=l==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||A&&A.value.kind!=="constant";if(b.kind!=="constant"||T)if(b.kind==="source"||T||w){const E=w_(l,S,"source");this.binders[l]=w?new Ma(b,y,S,E,e.id):new Zo(b,y,S,E),u.push(`/a_${l}`)}else{const E=w_(l,S,"composite");this.binders[l]=new no(b,y,S,_,r,E),u.push(`/z_${l}`)}else this.binders[l]=w?new $l(b.value,y):new jl(b.value,y,S,r),u.push(`/u_${l}`);A&&(this.binders[l].lutExpression=A.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof Zo||r instanceof no?r.maxValue:0}populatePaintArrays(e,r,a,u,l,f,y){for(const b in this.binders){const S=this.binders[b];S.context=this.context,(S instanceof Zo||S instanceof no||S instanceof Ma)&&S.populatePaintArray(e,r,a,u,l,f,y)}}setConstantPatternPositions(e){for(const r in this.binders){const a=this.binders[r];a instanceof $l&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,r,a,u,l,f,y,b,S){let _=!1;const w=Object.keys(e),A=w.length!==0&&!b,T=A?w:r.uniqueIds;this.context.lut=l.lut;for(const E in this.binders){const C=this.binders[E];if(C.context=this.context,(C instanceof Zo||C instanceof no||C instanceof Ma)&&C.expression&&C.expression.kind&&C.expression.kind!=="constant"&&(C.expression.isStateDependent===!0||C.expression.isLightConstant===!1)){const O=l.paint.get(E);C.expression=O.value;for(const k of T){const U=e[k.toString()];r.eachPosition(k,(V,N,$)=>{const W=u.feature(V);C.updatePaintArray(N,$,W,U,f,y,S)})}if(!A)for(const k of a.uniqueIds){const U=e[k.toString()];a.eachPosition(k,(V,N,$)=>{const W=u.feature(V);C.updatePaintArray(N,$,W,U,f,y,S)})}_=!0}}return _}defines(){const e=[];for(const r in this.binders){const a=this.binders[r];(a instanceof jl||a instanceof $l)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof Zo||a instanceof no||a instanceof Ma)for(let u=0;u<a.paintVertexAttributes.length;u++)e.push(a.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const a=this.binders[r];if(a instanceof jl||a instanceof $l||a instanceof no)for(const u of a.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const r=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof jl||u instanceof $l||u instanceof no)for(const l of u.uniformNames)r.push({name:l,property:a,binding:u.getBinding(e,l)})}return r}setUniforms(e,r,a,u,l){for(const{name:f,property:y,binding:b}of a)this.binders[y].setUniform(e,b,l,u.get(y),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const r=this.binders[e];(r instanceof Zo||r instanceof no||r instanceof Ma)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}}upload(e){for(const r in this.binders){const a=this.binders[r];(a instanceof Zo||a instanceof no||a instanceof Ma)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof Zo||r instanceof no||r instanceof Ma)&&r.destroy()}}}class Ia{constructor(e,r,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new sl(u,r,a);this.needsUpload=!1,this._featureMap=new Ul,this._featureMapWithoutIds=new Ul,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,r,a,u,l,f,y,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,r,u,l,f,y,b);r.id!==void 0?this._featureMap.add(r.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,a,u,l,f,y){for(const b of a)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,r,b,u,l,f,y||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const vv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function xv(o,e){return vv[o]||[o.replace(`${e}-`,"").replace(/-/g,"_")]}const Uh={"line-pattern":{source:Ta,composite:Ta},"fill-pattern":{source:Ta,composite:Ta},"fill-extrusion-pattern":{source:Ta,composite:Ta},"line-dasharray":{source:Ih,composite:Ih}},bv={color:{source:Aa,composite:nl},number:{source:wa,composite:Aa}};function w_(o,e,r){const a=Uh[o];return a&&a[r]||bv[e][r]}Ft(jl,"ConstantBinder"),Ft($l,"PatternConstantBinder"),Ft(Zo,"SourceExpressionBinder"),Ft(Ma,"PatternCompositeBinder"),Ft(no,"CompositeExpressionBinder"),Ft(sl,"ProgramConfiguration",{omit:["_buffers"]}),Ft(Ia,"ProgramConfigurationSet");const Ai=Ct/Math.PI/2,Wf=5,Zf=6,wv=16383,ol=64,Xf=[ol,32,16],Ms=-Ai,$s=Ai;function Gl(o,e,r,a=Ai){return r=Rt(r),[o*Math.sin(r)*a,-e*a,o*Math.cos(r)*a]}function Ca(o,e,r){return Gl(Math.cos(Rt(o)),Math.sin(Rt(o)),e,r)}const ql=63710088e-1,Kf=2*Math.PI*ql;class Xr{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Xr(jr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,a=this.lat*r,u=e.lat*r,l=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*r);return ql*Math.acos(Math.min(l,1))}toBounds(e=0){const r=360*e/40075017,a=r/Math.cos(Math.PI/180*this.lat);return new Pa({lng:this.lng-a,lat:this.lat-r},{lng:this.lng+a,lat:this.lat+r})}toEcef(e){return Ca(this.lat,this.lng,Ai+e*Ai/ql)}static convert(e){if(e instanceof Xr)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Xr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Xr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Pa{constructor(e,r){if(e)if(r)this.setSouthWest(e).setNorthEast(r);else if(e.length===4){const a=e;this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]])}else{const a=e;this.setSouthWest(a[0]).setNorthEast(a[1])}}setNorthEast(e){return this._ne=e instanceof Xr?new Xr(e.lng,e.lat):Xr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Xr?new Xr(e.lng,e.lat):Xr.convert(e),this}extend(e){const r=this._sw,a=this._ne;let u,l;if(e instanceof Xr)u=e,l=e;else{if(!(e instanceof Pa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Pa.convert(e)):this.extend(Xr.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Xr.convert(e)):this;if(u=e._sw,l=e._ne,!u||!l)return this}return r||a?(r.lng=Math.min(u.lng,r.lng),r.lat=Math.min(u.lat,r.lat),a.lng=Math.max(l.lng,a.lng),a.lat=Math.max(l.lat,a.lat)):(this._sw=new Xr(u.lng,u.lat),this._ne=new Xr(l.lng,l.lat)),this}getCenter(){return new Xr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Xr(this.getWest(),this.getNorth())}getSouthEast(){return new Xr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:a}=Xr.convert(e);let u=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){if(e)return e instanceof Pa?e:new Pa(e)}}const Tv=0,T_=25.5;function eu(o){return Kf*Math.cos(o*Math.PI/180)}function Is(o){return(180+o)/360}function io(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Wi(o,e){return o/eu(e)}function us(o){return 360*o-180}function Mi(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Yf(o,e){return o*eu(Mi(e))}const Ji=85.051129;function Jf(o){return Math.cos(Rt(Ye(o,-85.051129,Ji)))}function Hl(o,e){const r=Ye(e,Tv,T_),a=Math.pow(2,r);return Jf(o)*Kf/(512*a)}function d(o){return 1/Math.cos(o*Math.PI/180)}function t(o,e=0){const r=Math.exp(Math.PI*(1-(o.y+e/Ct)/(1<<o.z)*2));return 80150034*r/(r*r+1)/Ct/(1<<o.z)}class s{constructor(e,r,a=0){this.x=+e,this.y=+r,this.z=+a}static fromLngLat(e,r=0){const a=Xr.convert(e);return new s(Is(a.lng),io(a.lat),Wi(r,a.lat))}toLngLat(){return new Xr(us(this.x),Mi(this.y))}toAltitude(){return Yf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Kf*d(Mi(this.y))}}function h(o,e,r,a,u,l,f,y,b){const S=(e+a)/2,_=(r+u)/2,w=new Ae(S,_);y(w),function(A,T,E,C,O,k){const U=E-O,V=C-k;return Math.abs((C-T)*U-(E-A)*V)/Math.hypot(U,V)}(w.x,w.y,l.x,l.y,f.x,f.y)>=b?(h(o,e,r,S,_,l,w,y,b),h(o,S,_,a,u,w,f,y,b)):o.push(f)}function m(o,e,r){let a=o[0],u=a.x,l=a.y;e(a);const f=[a];for(let y=1;y<o.length;y++){const b=o[y],{x:S,y:_}=b;e(b),h(f,u,l,S,_,a,b,e,r),u=S,l=_,a=b}return f}function g(o,e,r,a){if(a(e,r)){const u=e.add(r)._mult(.5);g(o,e,u,a),g(o,u,r,a)}else o.push(r)}function x(o,e){let r=o[0];const a=[r];for(let u=1;u<o.length;u++){const l=o[u];g(a,r,l,e),r=l}return a}const M=Math.pow(2,14)-1,P=-M-1;function z(o,e){const r=Math.round(o.x*e),a=Math.round(o.y*e);return o.x=Ye(r,P,M),o.y=Ye(a,P,M),(r<o.x||r>o.x+1||a<o.y||a>o.y+1)&&Pr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function L(o,e,r){const a=o.loadGeometry(),u=o.extent,l=Ct/u;if(e&&r&&r.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:y,x:b,y:S,projection:_}=r,w=A=>{const T=us((e.x+A.x/u)/f),E=Mi((e.y+A.y/u)/f),C=_.project(T,E);A.x=(C.x*y-b)*u,A.y=(C.y*y-S)*u};for(let A=0;A<a.length;A++)if(o.type!==1)a[A]=m(a[A],w,1);else{const T=[];for(const E of a[A])E.x<0||E.x>=u||E.y<0||E.y>=u||(w(E),T.push(E));a[A]=T}}for(const f of a)for(const y of f)z(y,l);return a}function F(o,e){return{type:o.type,id:o.id,properties:o.properties,geometry:e?L(o):[]}}function B(o,e,r,a,u){o.emplaceBack(2*e+(a+1)/2,2*r+(u+1)/2)}function j(o,e,r){o.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Z{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ao,this.indexArray=new wi,this.segments=new Vn,this.programConfigurations=new Ia(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}updateFootprints(e,r){}populate(e,r,a,u){const l=this.layers[0],f=[];let y=null;l.type==="circle"&&(y=l.layout.get("circle-sort-key"));for(const{feature:S,id:_,index:w,sourceLayerIndex:A}of e){const T=this.layers[0]._featureFilter.needGeometry,E=F(S,T);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),E,a))continue;const C=y?y.evaluate(E,{},a):void 0,O={id:_,properties:S.properties,type:S.type,sourceLayerIndex:A,index:w,geometry:T?E.geometry:L(S,a,u),patterns:{},sortKey:C};f.push(O)}y&&f.sort((S,_)=>S.sortKey-_.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Ch,b=u.projection);for(const S of f){const{geometry:_,index:w,sourceLayerIndex:A}=S,T=e[w].feature;this.addFeature(S,_,w,r.availableImages,a,b,r.brightness),r.featureIndex.insert(T,_,w,A,this.index)}}update(e,r,a,u,l,f,y){this.programConfigurations.updatePaintArrays(e,r,l,a,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,jf.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,r,a,u,l,f,y){for(const b of r)for(const S of b){const _=S.x,w=S.y;if(_<0||_>=Ct||w<0||w>=Ct)continue;if(f){const E=f.projectTilePoint(_,w,l),C=f.upVector(l,_,w),O=this.globeExtVertexArray;j(O,E,C),j(O,E,C),j(O,E,C),j(O,E,C)}const A=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),T=A.vertexLength;B(this.layoutVertexArray,_,w,-1,-1),B(this.layoutVertexArray,_,w,1,-1),B(this.layoutVertexArray,_,w,1,1),B(this.layoutVertexArray,_,w,-1,1),this.indexArray.emplaceBack(T,T+1,T+2),this.indexArray.emplaceBack(T,T+2,T+3),A.vertexLength+=4,A.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,l,y)}}function H(o,e){for(let r=0;r<o.length;r++)if(pe(e,o[r]))return!0;for(let r=0;r<e.length;r++)if(pe(o,e[r]))return!0;return!!ue(o,e)}function J(o,e,r){return!!pe(o,e)||!!ge(e,o,r)}function Q(o,e){if(o.length===1)return _e(e,o[0]);for(let r=0;r<e.length;r++){const a=e[r];for(let u=0;u<a.length;u++)if(pe(o,a[u]))return!0}for(let r=0;r<o.length;r++)if(_e(e,o[r]))return!0;for(let r=0;r<e.length;r++)if(ue(o,e[r]))return!0;return!1}function oe(o,e,r){if(o.length>1){if(ue(o,e))return!0;for(let a=0;a<e.length;a++)if(ge(e[a],o,r))return!0}for(let a=0;a<o.length;a++)if(ge(o[a],e,r))return!0;return!1}function ue(o,e){if(o.length===0||e.length===0)return!1;for(let r=0;r<o.length-1;r++){const a=o[r],u=o[r+1];for(let l=0;l<e.length-1;l++)if(ce(a,u,e[l],e[l+1]))return!0}return!1}function ce(o,e,r,a){return xo(o,r,a)!==xo(e,r,a)&&xo(o,e,r)!==xo(o,e,a)}function ge(o,e,r){const a=r*r;if(e.length===1)return o.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(fe(o,e[u-1],e[u])<a)return!0;return!1}function fe(o,e,r){const a=e.distSqr(r);if(a===0)return o.distSqr(e);const u=((o.x-e.x)*(r.x-e.x)+(o.y-e.y)*(r.y-e.y))/a;return o.distSqr(u<0?e:u>1?r:r.sub(e)._mult(u)._add(e))}function _e(o,e){let r,a,u,l=!1;for(let f=0;f<o.length;f++){r=o[f];for(let y=0,b=r.length-1;y<r.length;b=y++)a=r[y],u=r[b],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(l=!l)}return l}function pe(o,e){let r=!1;for(let a=0,u=o.length-1;a<o.length;u=a++){const l=o[a],f=o[u];l.y>e.y!=f.y>e.y&&e.x<(f.x-l.x)*(e.y-l.y)/(f.y-l.y)+l.x&&(r=!r)}return r}function we(o,e,r,a,u){for(const f of o)if(e<=f.x&&r<=f.y&&a>=f.x&&u>=f.y)return!0;const l=[new Ae(e,r),new Ae(e,u),new Ae(a,u),new Ae(a,r)];if(o.length>2){for(const f of l)if(pe(o,f))return!0}for(let f=0;f<o.length-1;f++)if(Ee(o[f],o[f+1],l))return!0;return!1}function Ee(o,e,r){const a=r[0],u=r[2];if(o.x<a.x&&e.x<a.x||o.x>u.x&&e.x>u.x||o.y<a.y&&e.y<a.y||o.y>u.y&&e.y>u.y)return!1;const l=xo(o,e,r[0]);return l!==xo(o,e,r[1])||l!==xo(o,e,r[2])||l!==xo(o,e,r[3])}function qe(o,e,r,a,u,l){let f=e.y-o.y,y=o.x-e.x;if(l=l||0){const b=f*f+y*y;if(b===0)return!0;const S=Math.sqrt(b);f/=S,y/=S}return!((r.x-o.x)*f+(r.y-o.y)*y-l<0||(a.x-o.x)*f+(a.y-o.y)*y-l<0||(u.x-o.x)*f+(u.y-o.y)*y-l<0)}function Be(o,e,r,a,u,l,f){return!(qe(o,e,a,u,l,f)||qe(e,r,a,u,l,f)||qe(r,o,a,u,l,f)||qe(a,u,o,e,r,f)||qe(u,l,o,e,r,f)||qe(l,a,o,e,r,f))}function et(o,e,r){const a=e.paint.get(o).value;return a.kind==="constant"?a.value:r.programConfigurations.get(e.id).getMaxValue(o)}function rt(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function _t(o,e,r,a,u){if(!e[0]&&!e[1])return o;const l=Ae.convert(e)._mult(u);r==="viewport"&&l._rotate(-a);const f=[];for(let y=0;y<o.length;y++)f.push(o[y].sub(l));return f}function Oe(o,e,r,a){const u=Ae.convert(o)._mult(a);return e==="viewport"&&u._rotate(-r),u}let Qe,De;Ft(Z,"CircleBucket",{omit:["layers"]});var Je,Ze={exports:{}},st=(Je||(Je=1,function(o,e){(function(r){function a(l,f,y){var b=u(256*l,256*(f=Math.pow(2,y)-f-1),y),S=u(256*(l+1),256*(f+1),y);return b[0]+","+b[1]+","+S[0]+","+S[1]}function u(l,f,y){var b=2*Math.PI*6378137/256/Math.pow(2,y);return[l*b-2*Math.PI*6378137/2,f*b-2*Math.PI*6378137/2]}r.getURL=function(l,f,y,b,S,_){return _=_||{},l+"?"+["bbox="+a(y,b,S),"format="+(_.format||"image/png"),"service="+(_.service||"WMS"),"version="+(_.version||"1.1.1"),"request="+(_.request||"GetMap"),"srs="+(_.srs||"EPSG:3857"),"width="+(_.width||256),"height="+(_.height||256),"layers="+f].join("&")},r.getTileBBox=a,r.getMercCoords=u,Object.defineProperty(r,"__esModule",{value:!0})})(e)}(0,Ze.exports)),Ze.exports);class $e{constructor(e,r,a){this.z=e,this.x=r,this.y=a,this.key=Mt(0,e,e,r,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const a=st.getTileBBox(this.x,this.y,this.z),u=function(l,f,y){let b,S="";for(let _=l;_>0;_--)b=1<<_-1,S+=(f&b?1:0)+(y&b?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(r==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class lt{constructor(e,r){this.wrap=e,this.canonical=r,this.key=Mt(e,r.z,r.z,r.x,r.y)}}class wt{constructor(e,r,a,u,l){this.overscaledZ=e,this.wrap=r,this.canonical=new $e(a,+u,+l),this.key=r===0&&e===a?this.canonical.key:Mt(r,e,a,u,l)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new wt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new wt(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return Mt(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Mt(this.wrap*+r,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new wt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new wt(r,this.wrap,r,a,u),new wt(r,this.wrap,r,a+1,u),new wt(r,this.wrap,r,a,u+1),new wt(r,this.wrap,r,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new wt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new wt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new lt(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Mt(o,e,r,a,u){const l=1<<Math.min(r,22);let f=l*(u%l)+a%l;return o&&r<22&&(f+=l*l*((o<0?-2*o-1:2*o)%(1<<2*(22-r)))),16*(32*f+r)+(e-r)}const Lt=[o=>{let e=o.canonical.x-1,r=o.wrap;return e<0&&(e=(1<<o.canonical.z)-1,r--),new wt(o.overscaledZ,r,o.canonical.z,e,o.canonical.y)},o=>{let e=o.canonical.x+1,r=o.wrap;return e===1<<o.canonical.z&&(e=0,r++),new wt(o.overscaledZ,r,o.canonical.z,e,o.canonical.y)},o=>new wt(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,(o.canonical.y===0?1<<o.canonical.z:o.canonical.y)-1),o=>new wt(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y===(1<<o.canonical.z)-1?0:o.canonical.y+1)];Ft($e,"CanonicalTileID"),Ft(wt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Wt=Zr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:fr}=Wt,nr=Zr([{name:"a_pos_3",components:3,type:"Int16"}]);var pr=Zr([{name:"a_pos",type:"Int16",components:2}]);class ur{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const u=te.vec2.dot(r,this.dir);if(Math.abs(u)<1e-6)return!1;const l=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1])/u;return a[0]=this.pos[0]+this.dir[0]*l,a[1]=this.pos[1]+this.dir[1]*l,!0}}class Br{constructor(e,r){this.pos=e,this.dir=r}intersectsPlane(e,r,a){const u=te.vec3.dot(r,this.dir);if(Math.abs(u)<1e-6)return!1;const l=((e[0]-this.pos[0])*r[0]+(e[1]-this.pos[1])*r[1]+(e[2]-this.pos[2])*r[2])/u;return a[0]=this.pos[0]+this.dir[0]*l,a[1]=this.pos[1]+this.dir[1]*l,a[2]=this.pos[2]+this.dir[2]*l,!0}closestPointOnSphere(e,r,a){if(te.vec3.equals(this.pos,e)||r===0)return a[0]=a[1]=a[2]=0,!1;const[u,l,f]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],S=this.pos[2]-e[2],_=u*u+l*l+f*f,w=2*(y*u+b*l+S*f),A=w*w-4*_*(y*y+b*b+S*S-r*r);if(A<0){const T=Math.max(-w/2,0),E=y+u*T,C=b+l*T,O=S+f*T,k=Math.hypot(E,C,O);return a[0]=E*r/k,a[1]=C*r/k,a[2]=O*r/k,!1}{const T=(-w-Math.sqrt(A))/(2*_);if(T<0){const E=Math.hypot(y,b,S);return a[0]=y*r/E,a[1]=b*r/E,a[2]=S*r/E,!1}return a[0]=y+u*T,a[1]=b+l*T,a[2]=S+f*T,!0}}}class nn{constructor(e,r,a,u,l){this.TL=e,this.TR=r,this.BR=a,this.BL=u,this.horizon=l}static fromInvProjectionMatrix(e,r,a){const u=[-1,1,1],l=[1,1,1],f=[1,-1,1],y=[-1,-1,1],b=te.vec3.transformMat4(u,u,e),S=te.vec3.transformMat4(l,l,e),_=te.vec3.transformMat4(f,f,e),w=te.vec3.transformMat4(y,y,e);return new nn(b,S,_,w,r/a)}}function hn(o,e,r){let a=1/0,u=-1/0;const l=[];for(const f of o){te.vec3.sub(l,f,e);const y=te.vec3.dot(l,r);a=Math.min(a,y),u=Math.max(u,y)}return[a,u]}function Dr(o,e){let r=!0;for(let a=0;a<o.planes.length;a++){const u=o.planes[a];let l=0;for(let f=0;f<e.length;f++)l+=te.vec3.dot(u,e[f])+u[3]>=0;if(l===0)return 0;l!==e.length&&(r=!1)}return r?2:1}function Pn(o,e){for(const r of o.projections){const a=hn(e,o.points[0],r.axis);if(r.projection[1]<a[0]||r.projection[0]>a[1])return 0}return 1}function wr(o,e){let r=0;const a=[0,0,0,0];for(let u=0;u<o.length;u++)a[0]=o[u][0],a[1]=o[u][1],a[2]=o[u][2],a[3]=1,te.vec4.dot(a,e)>=0&&r++;return r}class _r{constructor(e,r){this.points=e||new Array(8).fill([0,0,0]),this.planes=r||new Array(6).fill([0,0,0,0]),this.bounds=sr.fromPoints(this.points),this.projections=[],this.frustumEdges=[te.vec3.sub([],this.points[2],this.points[3]),te.vec3.sub([],this.points[0],this.points[3]),te.vec3.sub([],this.points[4],this.points[0]),te.vec3.sub([],this.points[5],this.points[1]),te.vec3.sub([],this.points[6],this.points[2]),te.vec3.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const u=[0,-a[2],a[1]],l=[a[2],0,-a[0]];this.projections.push({axis:u,projection:hn(this.points,this.points[0],u)}),this.projections.push({axis:l,projection:hn(this.points,this.points[0],l)})}}static fromInvProjectionMatrix(e,r,a,u){const l=Math.pow(2,a),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const _=te.vec4.transformMat4([],S,e),w=1/_[3]/r*l;return te.vec4.mul(_,_,[w,w,u?1/_[3]:w,w])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const _=te.vec3.sub([],f[S[0]],f[S[1]]),w=te.vec3.sub([],f[S[2]],f[S[1]]),A=te.vec3.normalize([],te.vec3.cross([],_,w)),T=-te.vec3.dot(A,f[S[1]]);return A.concat(T)}),b=[];for(let S=0;S<f.length;S++)b.push([f[S][0],f[S][1],f[S][2]]);return new _r(b,y)}intersectsPrecise(e,r,a){for(let u=0;u<r.length;u++)if(!wr(e,r[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!wr(e,this.planes[u]))return 0;for(const u of a)for(const l of this.frustumEdges){const f=te.vec3.cross([],u,l),y=te.vec3.length(f);if(y===0)continue;te.vec3.scale(f,f,1/y);const b=hn(this.points,this.points[0],f),S=hn(e,this.points[0],f);if(b[0]>S[1]||S[0]>b[1])return 0}return 1}containsPoint(e){for(const r of this.planes){const a=r[3];if(te.vec3.dot([r[0],r[1],r[2]],e)+a<0)return!1}return!0}}class sr{static fromPoints(e){const r=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of e)te.vec3.min(r,r,u),te.vec3.max(a,a,u);return new sr(r,a)}static fromTileIdAndHeight(e,r,a){const u=1<<e.canonical.z,l=e.canonical.x,f=e.canonical.y;return new sr([l/u,f/u,r],[(l+1)/u,(f+1)/u,a])}static applyTransform(e,r){const a=e.getCorners();for(let u=0;u<a.length;++u)te.vec3.transformMat4(a[u],a[u],r);return sr.fromPoints(a)}static applyTransformFast(e,r){const a=[r[12],r[13],r[14]],u=[...a];for(let l=0;l<3;l++)for(let f=0;f<3;f++){const y=r[4*f+l],b=y*e.min[f],S=y*e.max[f];a[l]+=Math.min(b,S),u[l]+=Math.max(b,S)}return new sr(a,u)}static projectAabbCorners(e,r){const a=e.getCorners();for(let u=0;u<a.length;++u)te.vec3.transformMat4(a[u],a[u],r);return a}constructor(e,r){this.min=e,this.max=r,this.center=te.vec3.scale([],te.vec3.add([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],a=te.vec3.clone(this.min),u=te.vec3.clone(this.max);for(let l=0;l<r.length;l++)a[l]=r[l]?this.min[l]:this.center[l],u[l]=r[l]?this.center[l]:this.max[l];return u[2]=this.max[2],new sr(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Dr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Dr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,r){return r||this.intersects(e)?Pn(e,this.getCorners()):0}intersectsPreciseFlat(e,r){return r||this.intersectsFlat(e)?Pn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let r=0;r<3;++r)if(this.min[r]>e.max[r]||e.min[r]>this.max[r])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e.min[r]),this.max[r]=Math.max(this.max[r],e.max[r])}encapsulatePoint(e){for(let r=0;r<3;r++)this.min[r]=Math.min(this.min[r],e[r]),this.max[r]=Math.max(this.max[r],e[r])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}function Kr(o){return o*Ai/ql}Ft(sr,"Aabb");const Yr=[new sr([Ms,Ms,Ms],[$s,$s,$s]),new sr([Ms,Ms,Ms],[0,0,$s]),new sr([0,Ms,Ms],[$s,0,$s]),new sr([Ms,0,Ms],[0,$s,$s]),new sr([0,0,Ms],[$s,$s,$s])];function $n(o,e,r,a=!0){const u=te.vec3.scale([],o._camera.position,o.worldSize),l=[e,r,1,1];te.vec4.transformMat4(l,l,o.pixelMatrixInverse),te.vec4.scale(l,l,1/l[3]);const f=te.vec3.sub([],l,u),y=te.vec3.normalize([],f),b=o.globeMatrix,S=[b[12],b[13],b[14]],_=te.vec3.sub([],S,u),w=te.vec3.length(_),A=te.vec3.normalize([],_),T=o.worldSize/(2*Math.PI),E=te.vec3.dot(A,y),C=Math.asin(T/w);if(C<Math.acos(E)){if(!a)return null;const ve=[],le=[];te.vec3.scale(ve,y,w/E),te.vec3.normalize(le,te.vec3.sub(le,ve,_)),te.vec3.normalize(y,te.vec3.add(y,_,te.vec3.scale(y,le,Math.tan(C)*w)))}const O=[];new Br(u,y).closestPointOnSphere(S,T,O);const k=te.vec3.normalize([],xl(b,0)),U=te.vec3.normalize([],xl(b,1)),V=te.vec3.normalize([],xl(b,2)),N=te.vec3.dot(k,O),$=te.vec3.dot(U,O),W=te.vec3.dot(V,O),K=jt(Math.asin(-$/T));let ae=jt(Math.atan2(N,W));ae=o.center.lng+function(ve,le){const xe=(le-ve+180)%360-180;return xe<-180?xe+360:xe}(o.center.lng,ae);const ie=Is(ae),se=Ye(io(K),0,1);return new s(ie,se)}class di{constructor(e,r,a){this.a=te.vec3.sub([],e,a),this.b=te.vec3.sub([],r,a),this.center=a;const u=te.vec3.normalize([],this.a),l=te.vec3.normalize([],this.b);this.angle=Math.acos(te.vec3.dot(u,l))}}function Qi(o,e){if(o.angle===0)return null;let r;return r=o.a[e]===0?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[e]/o.a[e]/Math.sin(o.angle)-1/Math.tan(o.angle)),r<0||r>1?null:function(a,u,l,f){const y=Math.sin(l);return a*(Math.sin((1-f)*l)/y)+u*(Math.sin(f*l)/y)}(o.a[e],o.b[e],o.angle,Ye(r,0,1))+o.center[e]}function fi(o){if(o.z<=1)return Yr[o.z+2*o.y+o.x];const e=sn(Sn(o));return sr.fromPoints(e)}function Ti(o,e,r){return te.vec3.scale(o,o,1-r),te.vec3.scaleAndAdd(o,o,e,r)}function Ui(o,e,r){for(const a of o)te.vec3.transformMat4(a,a,e),te.vec3.scale(a,a,r)}function Jr(o,e,r,a){const u=e/o.worldSize,l=o.globeMatrix;if(r.z<=1){const ie=fi(r).getCorners();return Ui(ie,l,u),sr.fromPoints(ie)}const f=Sn(r,a),y=sn(f,Ai+Kr(o._tileCoverLift));Ui(y,l,u);const b=Number.MAX_VALUE,S=[-b,-b,-b],_=[b,b,b];if(f.contains(o.center)){for(const ve of y)te.vec3.min(_,_,ve),te.vec3.max(S,S,ve);S[2]=0;const ie=o.point,se=[ie.x*u,ie.y*u,0];return te.vec3.min(_,_,se),te.vec3.max(S,S,se),new sr(_,S)}if(o._tileCoverLift>0){for(const ie of y)te.vec3.min(_,_,ie),te.vec3.max(S,S,ie);return new sr(_,S)}const w=[l[12]*u,l[13]*u,l[14]*u],A=f.getCenter(),T=Ye(o.center.lat,-85.051129,Ji),E=Ye(A.lat,-85.051129,Ji),C=Is(o.center.lng),O=io(T);let k=C-Is(A.lng);const U=O-io(E);k>.5?k-=1:k<-.5&&(k+=1);let V=0;if(Math.abs(k)>Math.abs(U))V=k>=0?1:3;else{V=U>=0?0:2;const ie=[l[4]*u,l[5]*u,l[6]*u],se=-Math.sin(Rt(U>=0?f.getSouth():f.getNorth()))*Ai;te.vec3.scaleAndAdd(w,w,ie,se)}const N=y[V],$=y[(V+1)%4],W=new di(N,$,w),K=[Qi(W,0)||N[0],Qi(W,1)||N[1],Qi(W,2)||N[2]],ae=zi(o.zoom);if(ae>0){const ie=function({x:ve,y:le,z:xe},Me,Se,Ce,Ie){const Fe=1/(1<<xe);let ze=ve*Fe,Ne=ze+Fe,it=le*Fe,nt=it+Fe,Bt=0;const ft=(ze+Ne)/2-Ce;return ft>.5?Bt=-1:ft<-.5&&(Bt=1),ze=((ze+Bt)*Me-(Ce*=Me))*Se+Ce,Ne=((Ne+Bt)*Me-Ce)*Se+Ce,it=(it*Me-(Ie*=Me))*Se+Ie,nt=(nt*Me-Ie)*Se+Ie,[[ze,nt,0],[Ne,nt,0],[Ne,it,0],[ze,it,0]]}(r,e,o._pixelsPerMercatorPixel,C,O);for(let ve=0;ve<y.length;ve++)Ti(y[ve],ie[ve],ae);const se=te.vec3.add([],ie[V],ie[(V+1)%4]);te.vec3.scale(se,se,.5),Ti(K,se,ae)}for(const ie of y)te.vec3.min(_,_,ie),te.vec3.max(S,S,ie);return _[2]=Math.min(N[2],$[2]),te.vec3.min(_,_,K),te.vec3.max(S,S,K),new sr(_,S)}function Sn({x:o,y:e,z:r},a=!1){const u=1/(1<<r),l=new Xr(us(o*u),e===(1<<r)-1&&a?-90:Mi((e+1)*u)),f=new Xr(us((o+1)*u),e===0&&a?90:Mi(e*u));return new Pa(l,f)}function sn(o,e=Ai){const r=Rt(o.getNorth()),a=Rt(o.getSouth()),u=Math.cos(r),l=Math.cos(a),f=Math.sin(r),y=Math.sin(a),b=o.getWest(),S=o.getEast();return[Gl(l,y,b,e),Gl(l,y,S,e),Gl(u,f,S,e),Gl(u,f,b,e)]}function dn(o,e,r,a){const u=1<<r.z,l=(o/Ct+r.x)/u;return Ca(Mi((e/Ct+r.y)/u),us(l),a)}function mi({min:o,max:e}){return wv/Math.max(e[0]-o[0],e[1]-o[1],e[2]-o[2])}const On=new Float64Array(16);function li(o){const e=mi(o),r=te.mat4.fromScaling(On,[e,e,e]);return te.mat4.translate(r,r,te.vec3.negate([],o.min))}function Po(o){const e=te.mat4.fromTranslation(On,o.min),r=1/mi(o);return te.mat4.scale(e,e,[r,r,r])}function es(o){const e=Ct/(2*Math.PI);return o/(2*Math.PI)/e}function Gs(o,e){return Ct/(512*Math.pow(2,o))*mi(fi(e))}function Xo(o,e,r,a,u){const l=es(r),f=[o,e,-r/(2*Math.PI)],y=te.mat4.identity(new Float64Array(16));return te.mat4.translate(y,y,f),te.mat4.scale(y,y,[l,l,l]),te.mat4.rotateX(y,y,Rt(-u)),te.mat4.rotateY(y,y,Rt(-a)),y}function zi(o){return Jt(Wf,Zf,o)}function Cs(o,e){const r=Ca(e.lat,e.lng),a=function(l){const f=Ca(l._center.lat,l._center.lng),y=te.vec3.fromValues(0,1,0);let b=te.vec3.cross([],y,f);const S=te.mat4.fromRotation([],-l.angle,f);b=te.vec3.transformMat4(b,b,S),te.mat4.fromRotation(S,-l._pitch,b);const _=te.vec3.normalize([],f);return te.vec3.scale(_,_,Kr(l.cameraToCenterDistance/l.pixelsPerMeter)),te.vec3.transformMat4(_,_,S),te.vec3.add([],f,_)}(o),u=te.vec3.subtract([],a,r);return te.vec3.angle(u,r)}function Ro(o,e){return Cs(o,e)>Math.PI/2*1.01}const so=Rt(85),Ko=Math.cos(so),Qf=Math.sin(so),tu=te.mat4.create(),jh=o=>{const e=[];return o.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),o.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function $h(o,e,r,a,u,l,f,y,b){if(l&&o.queryGeometry.isAboveHorizon)return!1;l&&(b*=o.pixelToTileUnitsFactor);const S=o.tileID.canonical,_=r.projection.upVectorScale(S,r.center.lat,r.worldSize).metersToTile;for(const w of e)for(const A of w){const T=A.add(y),E=u&&r.elevation?r.elevation.exaggeration()*u.getElevationAt(T.x,T.y,!0):0,C=r.projection.projectTilePoint(T.x,T.y,S);if(E>0){const V=r.projection.upVector(S,T.x,T.y);C.x+=V[0]*_*E,C.y+=V[1]*_*E,C.z+=V[2]*_*E}const O=l?T:WC(C.x,C.y,C.z,a),k=l?o.tilespaceRays.map(V=>XC(V,E)):o.queryGeometry.screenGeometry,U=te.vec4.transformMat4([],[C.x,C.y,C.z,1],a);if(!f&&l?b*=U[3]/r.cameraToCenterDistance:f&&!l&&(b*=r.cameraToCenterDistance/U[3]),l){const V=Mi((A.y/Ct+S.y)/(1<<S.z));b/=r.projection.pixelsPerMeter(V,1)/Wi(1,V)}if(J(k,O,b))return!0}return!1}function WC(o,e,r,a){const u=te.vec4.transformMat4([],[o,e,r,1],a);return new Ae(u[0]/u[3],u[1]/u[3])}const J1=te.vec3.fromValues(0,0,0),ZC=te.vec3.fromValues(0,0,1);function XC(o,e){const r=te.vec3.create();return J1[2]=e,o.intersectsPlane(J1,ZC,r),new Ae(r[0],r[1])}class Q1 extends Z{}let eb,tb,rb,nb;function ib(o,{width:e,height:r},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*r*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*r*a);return o.width=e,o.height=r,o.data=u,o}function sb(o,e,r){const{width:a,height:u}=e;a===o.width&&u===o.height||(Sv(o,e,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,a),height:Math.min(o.height,u)},r,null),o.width=a,o.height=u,o.data=e.data)}function Sv(o,e,r,a,u,l,f,y){if(u.width===0||u.height===0)return e;if(u.width>o.width||u.height>o.height||r.x>o.width-u.width||r.y>o.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const b=o.data,S=e.data,_=l===4&&y;for(let w=0;w<u.height;w++){const A=((r.y+w)*o.width+r.x)*l,T=((a.y+w)*e.width+a.x)*l;if(_)for(let E=0;E<u.width;E++){const C=A+E*l+3,O=T+E*l;S[O+0]=255,S[O+1]=255,S[O+2]=255,S[O+3]=b[C]}else if(f)for(let E=0;E<u.width;E++){const C=A+E*l,O=T+E*l,k=b[C+3],U=new tn(b[C+0]/255*k,b[C+1]/255*k,b[C+2]/255*k,k).toRenderColor(f).toArray();S[O+0]=U[0],S[O+1]=U[1],S[O+2]=U[2],S[O+3]=U[3]}else for(let E=0;E<u.width*l;E++)S[T+E]=b[A+E]}return e}Ft(Q1,"HeatmapBucket",{omit:["layers"]});class Wl{constructor(e,r){ib(this,e,1,r)}resize(e){sb(this,new Wl(e),1)}clone(){return new Wl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,l){Sv(e,r,a,u,l,1,null)}}class Li{constructor(e,r){ib(this,e,4,r)}resize(e){sb(this,new Li(e),4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Li({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,a,u,l,f,y){Sv(e,r,a,u,l,4,f,y)}}class ob{constructor(e,r){this.width=e.width,this.height=e.height,this.data=r instanceof Uint8Array?new Float32Array(r.buffer):r}}function ep(o){const e={},r=o.resolution||256,a=o.clips?o.clips.length:1,u=o.image||new Li({width:r,height:a}),l=(f,y,b)=>{e[o.evaluationKey]=b;const S=o.expression.evaluate(e);S&&(u.data[f+y+0]=Math.floor(255*S.r/S.a),u.data[f+y+1]=Math.floor(255*S.g/S.a),u.data[f+y+2]=Math.floor(255*S.b/S.a),u.data[f+y+3]=Math.floor(255*S.a))};if(o.clips)for(let f=0,y=0;f<a;++f,y+=4*r)for(let b=0,S=0;b<r;b++,S+=4){const _=b/(r-1),{start:w,end:A}=o.clips[f];l(y,S,w*(1-_)+A*_)}else for(let f=0,y=0;f<r;f++,y+=4)l(0,y,f/(r-1));return u}Ft(Wl,"AlphaImage"),Ft(Li,"RGBAImage");const KC=Zr([{name:"a_pos",components:2,type:"Int16"}],4),YC=Zr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),JC=Zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),QC=Zr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function tp(o,e,r=2){const a=e&&e.length,u=a?e[0]*r:o.length;let l=ab(o,0,u,r,!0);const f=[];if(!l||l.next===l.prev)return f;let y,b,S;if(a&&(l=function(_,w,A,T){const E=[];for(let C=0,O=w.length;C<O;C++){const k=ab(_,w[C]*T,C<O-1?w[C+1]*T:_.length,T,!1);k===k.next&&(k.steiner=!0),E.push(a3(k))}E.sort(i3);for(let C=0;C<E.length;C++)A=s3(E[C],A);return A}(o,e,l,r)),o.length>80*r){y=1/0,b=1/0;let _=-1/0,w=-1/0;for(let A=r;A<u;A+=r){const T=o[A],E=o[A+1];T<y&&(y=T),E<b&&(b=E),T>_&&(_=T),E>w&&(w=E)}S=Math.max(_-y,w-b),S=S!==0?32767/S:0}return rp(l,f,r,y,b,S,0),f}function ab(o,e,r,a,u){let l;if(u===function(f,y,b,S){let _=0;for(let w=y,A=b-S;w<b;w+=S)_+=(f[A]-f[w])*(f[w+1]+f[A+1]),A=w;return _}(o,e,r,a)>0)for(let f=e;f<r;f+=a)l=ub(f/a|0,o[f],o[f+1],l);else for(let f=r-a;f>=e;f-=a)l=ub(f/a|0,o[f],o[f+1],l);return l&&S_(l,l.next)&&(ip(l),l=l.next),l}function ru(o,e){if(!o)return o;e||(e=o);let r,a=o;do if(r=!1,a.steiner||!S_(a,a.next)&&_i(a.prev,a,a.next)!==0)a=a.next;else{if(ip(a),a=e=a.prev,a===a.next)break;r=!0}while(r||a!==e);return e}function rp(o,e,r,a,u,l,f){if(!o)return;!f&&l&&function(b,S,_,w){let A=b;do A.z===0&&(A.z=Ev(A.x,A.y,S,_,w)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==b);A.prevZ.nextZ=null,A.prevZ=null,function(T){let E,C=1;do{let O,k=T;T=null;let U=null;for(E=0;k;){E++;let V=k,N=0;for(let W=0;W<C&&(N++,V=V.nextZ,V);W++);let $=C;for(;N>0||$>0&&V;)N!==0&&($===0||!V||k.z<=V.z)?(O=k,k=k.nextZ,N--):(O=V,V=V.nextZ,$--),U?U.nextZ=O:T=O,O.prevZ=U,U=O;k=V}U.nextZ=null,C*=2}while(E>1)}(A)}(o,a,u,l);let y=o;for(;o.prev!==o.next;){const b=o.prev,S=o.next;if(l?t3(o,a,u,l):e3(o))e.push(b.i,o.i,S.i),ip(o),o=S.next,y=S.next;else if((o=S)===y){f?f===1?rp(o=r3(ru(o),e),e,r,a,u,l,2):f===2&&n3(o,e,r,a,u,l):rp(ru(o),e,r,a,u,l,1);break}}}function e3(o){const e=o.prev,r=o,a=o.next;if(_i(e,r,a)>=0)return!1;const u=e.x,l=r.x,f=a.x,y=e.y,b=r.y,S=a.y,_=u<l?u<f?u:f:l<f?l:f,w=y<b?y<S?y:S:b<S?b:S,A=u>l?u>f?u:f:l>f?l:f,T=y>b?y>S?y:S:b>S?b:S;let E=a.next;for(;E!==e;){if(E.x>=_&&E.x<=A&&E.y>=w&&E.y<=T&&Gh(u,y,l,b,f,S,E.x,E.y)&&_i(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function t3(o,e,r,a){const u=o.prev,l=o,f=o.next;if(_i(u,l,f)>=0)return!1;const y=u.x,b=l.x,S=f.x,_=u.y,w=l.y,A=f.y,T=y<b?y<S?y:S:b<S?b:S,E=_<w?_<A?_:A:w<A?w:A,C=y>b?y>S?y:S:b>S?b:S,O=_>w?_>A?_:A:w>A?w:A,k=Ev(T,E,e,r,a),U=Ev(C,O,e,r,a);let V=o.prevZ,N=o.nextZ;for(;V&&V.z>=k&&N&&N.z<=U;){if(V.x>=T&&V.x<=C&&V.y>=E&&V.y<=O&&V!==u&&V!==f&&Gh(y,_,b,w,S,A,V.x,V.y)&&_i(V.prev,V,V.next)>=0||(V=V.prevZ,N.x>=T&&N.x<=C&&N.y>=E&&N.y<=O&&N!==u&&N!==f&&Gh(y,_,b,w,S,A,N.x,N.y)&&_i(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;V&&V.z>=k;){if(V.x>=T&&V.x<=C&&V.y>=E&&V.y<=O&&V!==u&&V!==f&&Gh(y,_,b,w,S,A,V.x,V.y)&&_i(V.prev,V,V.next)>=0)return!1;V=V.prevZ}for(;N&&N.z<=U;){if(N.x>=T&&N.x<=C&&N.y>=E&&N.y<=O&&N!==u&&N!==f&&Gh(y,_,b,w,S,A,N.x,N.y)&&_i(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function r3(o,e){let r=o;do{const a=r.prev,u=r.next.next;!S_(a,u)&&lb(a,r,r.next,u)&&np(a,u)&&np(u,a)&&(e.push(a.i,r.i,u.i),ip(r),ip(r.next),r=o=u),r=r.next}while(r!==o);return ru(r)}function n3(o,e,r,a,u,l){let f=o;do{let y=f.next.next;for(;y!==f.prev;){if(f.i!==y.i&&l3(f,y)){let b=cb(f,y);return f=ru(f,f.next),b=ru(b,b.next),rp(f,e,r,a,u,l,0),void rp(b,e,r,a,u,l,0)}y=y.next}f=f.next}while(f!==o)}function i3(o,e){return o.x-e.x}function s3(o,e){const r=function(u,l){let f=l;const y=u.x,b=u.y;let S,_=-1/0;do{if(b<=f.y&&b>=f.next.y&&f.next.y!==f.y){const C=f.x+(b-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(C<=y&&C>_&&(_=C,S=f.x<f.next.x?f:f.next,C===y))return S}f=f.next}while(f!==l);if(!S)return null;const w=S,A=S.x,T=S.y;let E=1/0;f=S;do{if(y>=f.x&&f.x>=A&&y!==f.x&&Gh(b<T?y:_,b,A,T,b<T?_:y,b,f.x,f.y)){const C=Math.abs(b-f.y)/(y-f.x);np(f,u)&&(C<E||C===E&&(f.x>S.x||f.x===S.x&&o3(S,f)))&&(S=f,E=C)}f=f.next}while(f!==w);return S}(o,e);if(!r)return e;const a=cb(r,o);return ru(a,a.next),ru(r,r.next)}function o3(o,e){return _i(o.prev,o,e.prev)<0&&_i(e.next,o,o.next)<0}function Ev(o,e,r,a,u){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-r)*u|0)|o<<8))|o<<4))|o<<2))|o<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function a3(o){let e=o,r=o;do(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next;while(e!==o);return r}function Gh(o,e,r,a,u,l,f,y){return(u-f)*(e-y)>=(o-f)*(l-y)&&(o-f)*(a-y)>=(r-f)*(e-y)&&(r-f)*(l-y)>=(u-f)*(a-y)}function l3(o,e){return o.next.i!==e.i&&o.prev.i!==e.i&&!function(r,a){let u=r;do{if(u.i!==r.i&&u.next.i!==r.i&&u.i!==a.i&&u.next.i!==a.i&&lb(u,u.next,r,a))return!0;u=u.next}while(u!==r);return!1}(o,e)&&(np(o,e)&&np(e,o)&&function(r,a){let u=r,l=!1;const f=(r.x+a.x)/2,y=(r.y+a.y)/2;do u.y>y!=u.next.y>y&&u.next.y!==u.y&&f<(u.next.x-u.x)*(y-u.y)/(u.next.y-u.y)+u.x&&(l=!l),u=u.next;while(u!==r);return l}(o,e)&&(_i(o.prev,o,e.prev)||_i(o,e.prev,e))||S_(o,e)&&_i(o.prev,o,o.next)>0&&_i(e.prev,e,e.next)>0)}function _i(o,e,r){return(e.y-o.y)*(r.x-e.x)-(e.x-o.x)*(r.y-e.y)}function S_(o,e){return o.x===e.x&&o.y===e.y}function lb(o,e,r,a){const u=A_(_i(o,e,r)),l=A_(_i(o,e,a)),f=A_(_i(r,a,o)),y=A_(_i(r,a,e));return u!==l&&f!==y||!(u!==0||!E_(o,r,e))||!(l!==0||!E_(o,a,e))||!(f!==0||!E_(r,o,a))||!(y!==0||!E_(r,e,a))}function E_(o,e,r){return e.x<=Math.max(o.x,r.x)&&e.x>=Math.min(o.x,r.x)&&e.y<=Math.max(o.y,r.y)&&e.y>=Math.min(o.y,r.y)}function A_(o){return o>0?1:o<0?-1:0}function np(o,e){return _i(o.prev,o,o.next)<0?_i(o,e,o.next)>=0&&_i(o,o.prev,e)>=0:_i(o,e,o.prev)<0||_i(o,o.next,e)<0}function cb(o,e){const r=Av(o.i,o.x,o.y),a=Av(e.i,e.x,e.y),u=o.next,l=e.prev;return o.next=e,e.prev=o,r.next=u,u.prev=r,a.next=r,r.prev=a,l.next=a,a.prev=l,a}function ub(o,e,r,a){const u=Av(o,e,r);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function ip(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Av(o,e,r){return{i:o,x:e,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function M_(o,e){const r=o.length;if(r<=1)return[o];const a=[];let u,l;for(let f=0;f<r;f++){const y=vl(o[f]);y!==0&&(o[f].area=Math.abs(y),l===void 0&&(l=y<0),l===y<0?(u&&a.push(u),u=[o[f]]):u.push(o[f]))}if(u&&a.push(u),e>1)for(let f=0;f<a.length;f++)a[f].length<=e||(Lm(a[f],e,1,a[f].length-1,c3),a[f]=a[f].slice(0,e));return a}function c3(o,e){return e.area-o.area}function hb(o,e,r=1){if(!o)return null;const a=typeof o=="string"?Ei.from(o).getPrimary():o.getPrimary(),u=a.id.toString();return e.has(u)||e.set(u,[]),a.scaleSelf(r),e.get(u).push(a),a.toString()}function Mv(o,e,r,a){const u=a.patternDependencies;let l=!1;for(const f of e){const y=f.paint.get(`${o}-pattern`);y.isConstant()||(l=!0),hb(y.constantOr(null),u,r)&&(l=!0)}return l}function Iv(o,e,r,a,u,l){const f=l.patternDependencies;for(const y of e){const b=y.paint.get(`${o}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:a},r,{},l.availableImages);S=S&&S.name?S.name:S;const _=hb(S,f,u);_&&(r.patterns[y.id]=_)}}return r}var Cv,db,Pv,fb,Rv,pb,mb,I_={};function _b(){if(db)return Cv;db=1;var o=Ve();function e(u,l,f,y,b){this.properties={},this.extent=f,this.type=0,this._pbf=u,this._geometry=-1,this._keys=y,this._values=b,u.readFields(r,this,l)}function r(u,l,f){u==1?l.id=f.readVarint():u==2?function(y,b){for(var S=y.readVarint()+y.pos;y.pos<S;){var _=b._keys[y.readVarint()],w=b._values[y.readVarint()];b.properties[_]=w}}(f,l):u==3?l.type=f.readVarint():u==4&&(l._geometry=f.pos)}function a(u){for(var l,f,y=0,b=0,S=u.length,_=S-1;b<S;_=b++)y+=((f=u[_]).x-(l=u[b]).x)*(l.y+f.y);return y}return Cv=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var l,f=u.readVarint()+u.pos,y=1,b=0,S=0,_=0,w=[];u.pos<f;){if(b<=0){var A=u.readVarint();y=7&A,b=A>>3}if(b--,y===1||y===2)S+=u.readSVarint(),_+=u.readSVarint(),y===1&&(l&&w.push(l),l=[]),l.push(new o(S,_));else{if(y!==7)throw new Error("unknown command "+y);l&&l.push(l[0].clone())}}return l&&w.push(l),w},e.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var l=u.readVarint()+u.pos,f=1,y=0,b=0,S=0,_=1/0,w=-1/0,A=1/0,T=-1/0;u.pos<l;){if(y<=0){var E=u.readVarint();f=7&E,y=E>>3}if(y--,f===1||f===2)(b+=u.readSVarint())<_&&(_=b),b>w&&(w=b),(S+=u.readSVarint())<A&&(A=S),S>T&&(T=S);else if(f!==7)throw new Error("unknown command "+f)}return[_,A,w,T]},e.prototype.toGeoJSON=function(u,l,f){var y,b,S=this.extent*Math.pow(2,f),_=this.extent*u,w=this.extent*l,A=this.loadGeometry(),T=e.types[this.type];function E(k){for(var U=0;U<k.length;U++){var V=k[U];k[U]=[360*(V.x+_)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+w)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var C=[];for(y=0;y<A.length;y++)C[y]=A[y][0];E(A=C);break;case 2:for(y=0;y<A.length;y++)E(A[y]);break;case 3:for(A=function(k){var U=k.length;if(U<=1)return[k];for(var V,N,$=[],W=0;W<U;W++){var K=a(k[W]);K!==0&&(N===void 0&&(N=K<0),N===K<0?(V&&$.push(V),V=[k[W]]):V.push(k[W]))}return V&&$.push(V),$}(A),y=0;y<A.length;y++)for(b=0;b<A[y].length;b++)E(A[y][b])}A.length===1?A=A[0]:T="Multi"+T;var O={type:"Feature",geometry:{type:T,coordinates:A},properties:this.properties};return"id"in this&&(O.id=this.id),O},Cv}function gb(){if(fb)return Pv;fb=1;var o=_b();function e(a,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(r,this,u),this.length=this._features.length}function r(a,u,l){a===15?u.version=l.readVarint():a===1?u.name=l.readString():a===5?u.extent=l.readVarint():a===2?u._features.push(l.pos):a===3?u._keys.push(l.readString()):a===4&&u._values.push(function(f){for(var y=null,b=f.readVarint()+f.pos;f.pos<b;){var S=f.readVarint()>>3;y=S===1?f.readString():S===2?f.readFloat():S===3?f.readDouble():S===4?f.readVarint64():S===5?f.readVarint():S===6?f.readSVarint():S===7?f.readBoolean():null}return y}(l))}return Pv=e,e.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var u=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,u,this.extent,this._keys,this._values)},Pv}function yb(){return mb||(mb=1,I_.VectorTile=function(){if(pb)return Rv;pb=1;var o=gb();function e(r,a,u){if(r===3){var l=new o(u,u.readVarint()+u.pos);l.length&&(a[l.name]=l)}}return Rv=function(r,a){this.layers=r.readFields(e,{},a)},Rv}(),I_.VectorTileFeature=_b(),I_.VectorTileLayer=gb()),I_}var Zl=yb();const nu="3d_elevation_id",vb="level";class u3{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,r){return this._valid&&e(r(this._geometry)),this}require(e,r,a){return this.get(e,!0,r,a)}optional(e,r,a){return this.get(e,!1,r,a)}success(){return this._valid}get(e,r,a,u){const l=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&l!==void 0?a(u?u(l):l):r&&(this._valid=!1),this}}class xb{constructor(e,r){this.featureFunc=e,this.vertexFunc=r}parseFeature(e,r,a){return this.featureFunc(e,r,a)}parseVertex(e,r,a){return this.vertexFunc(e,r,a)}}const h3=new xb((o,e,r)=>o.reset(e).require(nu,a=>{r.id=a}).optional("fixed_height_relative",a=>{r.constantHeight=a},al.decodeRelativeHeight).geometry(a=>{r.bounds=a},al.computeBounds).success(),(o,e,r)=>o.reset(e).require(nu,a=>{r.id=a}).require("elevation_idx",a=>{r.idx=a}).require("extent",a=>{r.extent=a}).require("height_relative",a=>{r.height=a},al.decodeRelativeHeight).geometry(a=>{r.position=a},al.getPoint).success()),d3=new xb((o,e,r)=>o.reset(e).require(nu,a=>{r.id=a}).optional("fixed_height",a=>{r.constantHeight=a},al.decodeMetricHeight).geometry(a=>{r.bounds=a},al.computeBounds).success(),(o,e,r)=>o.reset(e).require(nu,a=>{r.id=a}).require("elevation_idx",a=>{r.idx=a}).require("extent",a=>{r.extent=a}).require("height",a=>{r.height=a},al.decodeMetricHeight).geometry(a=>{r.position=a},al.getPoint).success());class al{static computeBounds(e){const r=new Ae(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new Ae(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of e[0])r.x>u.x&&(r.x=u.x),r.y>u.y&&(r.y=u.y),a.x<u.x&&(a.x=u.x),a.y<u.y&&(a.y=u.y);return{min:r,max:a}}static getPoint(e){return te.vec2.fromValues(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const r=[],a=[],u=e.length,l=new u3;for(let y=0;y<u;y++){const b=e.feature(y),S=b.properties.hasOwnProperty("version")?String(b.properties.version):void 0,_=(f=S)?f==="1.0.1"?d3:void 0:h3;if(_===void 0){Pr(`Unknown elevation feature version number ${S||"(unknown)"}`);continue}const w=b.properties.hasOwnProperty("type")?b.properties.type:void 0;if(w){if(Zl.VectorTileFeature.types[b.type]==="Point"&&w==="curve_point"){const A={};_.parseVertex(l,b,A)&&r.push(A)}else if(Zl.VectorTileFeature.types[b.type]==="Polygon"&&w==="curve_meta"){const A={};_.parseFeature(l,b,A)&&a.push(A)}}}var f;return{vertices:r,features:a}}}class Dv{constructor(e,r,a,u,l,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:a,max:a},this.safeArea=r,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=l,this.edges=this.edges.filter(y=>y.a<this.vertices.length&&y.b<this.vertices.length&&!te.vec2.exactEquals(this.vertices[y.a].position,this.vertices[y.b].position)),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const y of this.vertices)this.vertexProps.push({dir:te.vec2.fromValues(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,y.height),this.heightRange.max=Math.max(this.heightRange.max,y.height);for(const y of this.edges){const b=this.vertices[y.a].position,S=this.vertices[y.b].position,_=te.vec2.subtract(te.vec2.create(),S,b),w=te.vec2.length(_),A=te.vec2.scale(te.vec2.create(),_,1/w);this.edgeProps.push({vec:_,dir:A,len:w});const T=this.vertexProps[y.a].dir,E=this.vertexProps[y.b].dir;te.vec2.add(T,T,A),te.vec2.add(E,E,A)}for(const y of this.vertexProps)y.dir[0]===0&&y.dir[1]===0||te.vec2.normalize(y.dir,y.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const r=this.getClosestEdge(e);if(r==null)return 0;const[a,u]=r;return((l,f,y)=>(1-y)*l+y*f)(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,u)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let r=0,a=Number.POSITIVE_INFINITY,u=0;const l=te.vec2.fromValues(e.x,e.y);for(let f=0;f<this.edges.length;f++){const y=this.edges[f],b=this.edgeProps[f].dir,S=new ur(l,this.edgeProps[f].dir),_=this.vertices[y.a].position,w=this.vertices[y.b].position,A=te.vec2.create(),T=te.vec2.create(),E=S.intersectsPlane(_,this.vertexProps[y.a].dir,A),C=S.intersectsPlane(w,this.vertexProps[y.b].dir,T);if(!E||!C)continue;const O=te.vec2.subtract(te.vec2.create(),T,A),k=te.vec2.subtract(te.vec2.create(),l,A),U=te.vec2.dot(O,O),V=U>0?te.vec2.dot(k,O)/U:0,N=Ye(V,0,1),$=Math.abs((V-N)*this.edgeProps[f].len),W=te.vec2.subtract(te.vec2.create(),l,_),K=$+Math.abs(te.vec2.dot(W,te.vec2.fromValues(b[1],-b[0])));K<a&&(r=f,a=K,u=N)}return[r,u]}tessellate(e){for(let r=this.edges.length-1;r>=0;--r){const a=this.edges[r].a,u=this.edges[r].b,{position:l,height:f,extent:y}=this.vertices[a],{position:b,height:S,extent:_}=this.vertices[u],w=this.vertexProps[a].dir,A=this.vertexProps[u].dir,T=te.vec3.fromValues(l[0]/e,l[1]/e,f),E=te.vec3.fromValues(b[0]/e,b[1]/e,S),C=te.vec3.fromValues(w[1],-w[0],0);te.vec3.scale(C,C,y);const O=te.vec3.fromValues(A[1],-A[0],0);if(te.vec3.scale(O,O,_),this.distSqLines(te.vec3.fromValues(T[0]+.5*C[0],T[1]+.5*C[1],T[2]+.5*C[2]),te.vec3.fromValues(E[0]-.5*O[0],E[1]-.5*O[1],E[2]-.5*O[2]),te.vec3.fromValues(T[0]-.5*C[0],T[1]-.5*C[1],T[2]-.5*C[2]),te.vec3.fromValues(E[0]+.5*O[0],E[1]+.5*O[1],E[2]+.5*O[2]))<=.05*.05)continue;const k=this.vertices.length,U=te.vec2.add(te.vec2.create(),l,b);this.vertices.push({position:te.vec2.scale(U,U,.5),height:.5*(f+S),extent:.5*(y+_)});const V=te.vec2.add(te.vec2.create(),w,A);this.vertexProps.push({dir:te.vec2.normalize(V,V)}),this.edges.splice(r,1),this.edgeProps.splice(r,1),this.edges.push({a,b:k}),this.edges.push({a:k,b:u});const N=te.vec2.subtract(te.vec2.create(),this.vertices[k].position,l),$=te.vec2.length(N),W={vec:N,dir:te.vec2.scale(te.vec2.create(),N,1/$),len:$};this.edgeProps.push(W),this.edgeProps.push(W)}}distSqLines(e,r,a,u){const l=te.vec3.subtract(te.vec3.create(),r,e),f=te.vec3.subtract(te.vec3.create(),u,a),y=te.vec3.subtract(te.vec3.create(),e,a),b=te.vec3.dot(l,l),S=te.vec3.dot(l,f),_=te.vec3.dot(l,y),w=te.vec3.dot(f,f),A=te.vec3.dot(f,y),T=b*w-S*S;if(T===0){const U=te.vec3.dot(y,f)/te.vec3.dot(f,f),V=te.vec3.lerp(te.vec3.create(),a,u,U);return te.vec3.squaredDistance(V,e)}const E=(S*A-_*w)/T,C=(b*A-S*_)/T,O=te.vec3.lerp(te.vec3.create(),e,r,E),k=te.vec3.lerp(te.vec3.create(),a,u,C);return te.vec3.squaredDistance(O,k)}}class f3{constructor(e,r){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(r)||(this.zScale=Math.pow(2,r.z-e.z),this.xOffset=(e.x*this.zScale-r.x)*Ct,this.yOffset=(e.y*this.zScale-r.y)*Ct)}constantElevation(e,r){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,r)}pointElevation(e,r,a){const u=this.constantElevation(r,a);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(r.pointElevation(e),a))}computeBiasedHeight(e,r){return r<=0?e:e+r*Jt(0,r,e>=0?e:Math.abs(.5*e))}}Ft(Dv,"ElevationFeature");class bb{constructor(){this.polygons=new Map}add(e,...r){this.polygons.has(e)?this.polygons.get(e).push(...r):this.polygons.set(e,r)}merge(e){for(const[r,a]of e.polygons)this.add(r,...a)}}class iu{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new iu;let r=[];for(const S of e)r.push(...S.portals);if(r.length===0)return new iu;const a=(S,_)=>S<=0&&_<=0||S>=Ct&&_>=Ct;for(const S of r){const _=S.va,w=S.vb;(a(_.x,w.x)||a(_.y,w.y))&&(S.type="border")}const u=r.filter(S=>S.type!=="unevaluated"),l=r.filter(S=>S.type==="unevaluated");if(l.length===0)return new iu;l.sort((S,_)=>S.hash===_.hash?S.isTunnel===_.isTunnel?0:S.isTunnel?-1:1:S.hash<_.hash?1:-1),r=u.concat(l);let f=u.length,y=f,b=f;do if(y++,y===r.length||r[f].hash!==r[y].hash){if(y-f==2){b<f&&(r[b]=r[f],r[f]=null);const S=r[b],_=r[y-1];S.type=S.isTunnel!==_.isTunnel?"tunnel":"polygon",S.connection={a:S.connection.a,b:_.connection.a},b++}f=y}while(f!==r.length);return r.splice(b),r.sort((S,_)=>S.hash<_.hash?1:-1),{portals:r}}}Ft(iu,"ElevationPortalGraph"),Ft(bb,"ElevationPolygons");class p3{constructor(e,r,a){this.outPositions=e,this.outNormals=r,this.outIndices=a,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,r,a){let u=e[2];a!=null&&(u*=a);const l=this.getVec3Bits(e)<<96n|this.getVec3Bits(r),f=this.vertexLookup.get(l);if(f!=null)return f;const y=this.outPositions.length;this.vertexLookup.set(l,y);const b=Math.trunc(16384*r[0]),S=Math.trunc(16384*r[1]),_=Math.trunc(16384*r[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(b,S,_),y}addVertices(e,r,...a){const u=[];for(const l of a){const f=this.addVertex(l,e,r);u.push(f)}return u}addTriangles(e,r,a){if(r&&a){const u=a.length===1,l=te.vec3.fromValues(0,0,0);for(let f=0;f<e.length;f+=3){const y=r[e[f+0]],b=r[e[f+1]],S=r[e[f+2]],_=u?a[0]:a[e[f+1]],w=u?a[0]:a[e[f+2]],A=this.addVertex(te.vec3.fromValues(y.x,y.y,u?a[0]:a[e[f+0]]),l),T=this.addVertex(te.vec3.fromValues(b.x,b.y,_),l),E=this.addVertex(te.vec3.fromValues(S.x,S.y,w),l);this.outIndices.emplaceBack(A,T,E)}}else for(let u=0;u<e.length;u+=3)this.outIndices.emplaceBack(e[u+0],e[u+1],e[u+2])}addQuad(e,r){const a=this.addVertices(r,void 0,...e.map(b=>te.vec3.fromValues(b.coord.x,b.coord.y,b.height))),[u,l,f,y]=a;this.addTriangles([u,l,f,f,y,u])}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Yo{constructor(e){this.unevaluatedPortals=new iu,this.portalPolygons=new bb,this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Pf,this.vertexNormals=new js,this.indexArray=new wi,this.tileToMeters=t(e)}addVertices(e,r){const a=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(r[u]);return a}addTriangles(e,r,a){const u=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const l of e)u.push(l+r)}addRenderableRing(e,r,a,u,l){const f=[new Ae(l.min.x,l.min.y),new Ae(l.max.x,l.min.y),new Ae(l.max.x,l.max.y),new Ae(l.min.x,l.max.y)];for(let y=0;y<a-1;y++){const b=r+y,S=b+1,_=this.unevalVertices[b],w=this.unevalVertices[S];if(!(_.x>=l.min.x&&_.x<=l.max.x&&_.y>=l.min.y&&_.y<=l.max.y||w.x>=l.min.x&&w.x<=l.max.x&&w.y>=l.min.y&&w.y<=l.max.y||Ee(_,w,f))||this.isOnBorder(_.x,w.x)||this.isOnBorder(_.y,w.y))continue;const A=Yo.computeEdgeHash(this.unevalVertices[b],this.unevalVertices[S]);let T,E=this.vertexHashLookup.get(Yo.computePosHash(_));E!=null?T=E.next:(E=this.vertexHashLookup.get(Yo.computePosHash(w)),T=E!=null?E.prev:A),this.unevalEdges.push({polygonIdx:e,a:b,b:S,hash:A,portalHash:T,isTunnel:u,type:"unevaluated"})}}addPortalCandidates(e,r,a,u,l){if(r.length===0)return;this.portalPolygons.add(e,{geometry:r,zLevel:l});const f=r[0];this.vertexHashLookup.clear();let y=Yo.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let b=0;b<f.length-1;b++){const S=f[b+0],_=f[b+1],w=te.vec2.fromValues(_.x-S.x,_.y-S.y),A=te.vec2.length(w);if(A===0)continue;let T="unevaluated";const E=u.pointElevation(S),C=u.pointElevation(_);Math.abs(E)<.01&&Math.abs(C)<.01?T="entrance":(this.isOnBorder(S.x,_.x)||this.isOnBorder(S.y,_.y))&&(T="border");const O=Yo.computeEdgeHash(S,_);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:S,vb:_,vab:w,length:A,hash:O,isTunnel:a,type:T});const k=Yo.computePosHash(S);this.vertexHashLookup.set(k,{prev:y,next:O}),y=O}}construct(e){if(this.unevalVertices.length===0)return;const r=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=w=>{w.primitiveLength=this.indexArray.length-w.primitiveOffset},u=new p3(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const l=r(),f=r(),y=r(),b=(w,A)=>{w.sort((E,C)=>E.type===A&&C.type!==A?-1:E.type!==A&&C.type===A?1:0);const T=w.findIndex(E=>E.type!==A);return T>=0?T:w.length};let S=0;this.unevalEdges.length>0&&(S=b(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters));const _=r();if(this.unevalEdges.length>0){const w=this.unevalEdges.splice(S),A=b(w,"tunnel")+S;this.unevalEdges.push(...w),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:A})}a(y),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(_),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(f),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(l),this.maskSegments=Vn.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.depthSegments=Vn.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableSegments=Vn.simpleSegment(0,y.primitiveOffset,0,y.primitiveLength),this.shadowCasterSegments=Vn.simpleSegment(0,l.primitiveOffset,0,l.primitiveLength)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,JC.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,QC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableSegments.destroy(),this.shadowCasterSegments.destroy())}computeVertexConnections(e,r,a,u){const l=new Map;for(let f=a;f<u;f++){const y=r[f],b=y.a,S=y.b;l.has(b)||l.set(b,{}),l.has(S)||l.set(S,{});const _=l.get(b),w=l.get(S);e[S]>0&&(_.to=S),e[b]>0&&(w.from=b)}return l}constructBridgeStructures(e,r,a,u,l,f){const y=this.computeVertexConnections(a,u,l.min,l.max),b=1/f,S=.5*b,_=A=>te.vec3.fromValues(r[A].x,r[A].y,a[A]*b),w=A=>{const T=y.get(A),E=T.from,C=T.to;if(!E||!C)return;const O=_(E),k=_(A),U=_(C),V=te.vec3.fromValues(0,0,0);if(!te.vec3.exactEquals(O,k)){const $=te.vec3.sub(te.vec3.create(),k,O);te.vec3.add(V,V,te.vec3.normalize($,$))}if(!te.vec3.exactEquals(U,k)){const $=te.vec3.sub(te.vec3.create(),U,k);te.vec3.add(V,V,te.vec3.normalize($,$))}const N=te.vec3.len(V);return N>0?te.vec3.scale(V,V,1/N):void 0};for(let A=l.min;A<l.max;A++){const T=u[A],E=this.prepareEdgePoints(r,a,T,(at,tr)=>at>=tr);if(E==null)continue;const C=E[0],O=E[1],k=te.vec3.fromValues(C.coord.x,C.coord.y,b*C.height),U=te.vec3.fromValues(O.coord.x,O.coord.y,b*O.height);if(te.vec3.exactEquals(k,U))continue;const V=te.vec3.sub(te.vec3.create(),U,k);te.vec3.normalize(V,V);const N=at=>te.vec3.normalize(at,at),$=w(T.a)||V,W=w(T.b)||V,K=N(te.vec3.fromValues($[1],-$[0],0)),ae=N(te.vec3.fromValues(W[1],-W[0],0)),ie=N(te.vec3.cross(te.vec3.create(),K,$)),se=N(te.vec3.cross(te.vec3.create(),ae,W)),ve=te.vec3.create(),le=[te.vec3.add(te.vec3.create(),k,te.vec3.scale(ve,te.vec3.sub(ve,K,ie),S)),te.vec3.add(te.vec3.create(),k,te.vec3.scale(ve,te.vec3.add(ve,K,ie),S)),te.vec3.add(te.vec3.create(),k,te.vec3.scale(ve,ie,S)),k],xe=[te.vec3.add(te.vec3.create(),U,te.vec3.scale(ve,te.vec3.sub(ve,ae,se),S)),te.vec3.add(te.vec3.create(),U,te.vec3.scale(ve,te.vec3.add(ve,ae,se),S)),te.vec3.add(te.vec3.create(),U,te.vec3.scale(ve,se,S)),U],[Me,Se]=e.addVertices(K,f,le[0],le[1]),[Ce,Ie]=e.addVertices(ae,f,xe[0],xe[1]);e.addTriangles([Me,Se,Ce,Se,Ie,Ce]);const[Fe,ze]=e.addVertices(ie,f,le[1],le[2]),[Ne,it]=e.addVertices(se,f,xe[1],xe[2]);e.addTriangles([Fe,ze,Ne,ze,it,Ne]);const[nt,Bt]=e.addVertices(te.vec3.negate(K,K),f,le[2],le[3]),[ft,Tt]=e.addVertices(te.vec3.negate(ae,ae),f,xe[2],xe[3]);e.addTriangles([nt,Bt,ft,Bt,Tt,ft])}}constructTunnelStructures(e,r,a,u,l,f){const y=b=>te.vec3.normalize(b,b);for(let b=l.min;b<l.max;b++){const S=this.prepareEdgePoints(r,a,u[b],(T,E)=>T<=E);if(S==null)continue;const[_,w]=S,A=y(te.vec3.fromValues(w.coord.y-_.coord.y,-(w.coord.x-_.coord.x),0));e.addQuad([_,w,{coord:w.coord,height:u[b].isTunnel?-.1:0},{coord:_.coord,height:u[b].isTunnel?-.1:0}],A)}for(let b=f.min;b<f.max;b++){const S=u[b],_=r[S.a],w=r[S.b],A=y(te.vec3.fromValues(w.y-_.y,-(w.x-_.x),0));e.addQuad([{coord:w,height:0},{coord:_,height:0},{coord:_,height:a[S.a]+4},{coord:w,height:a[S.b]+4}],A),e.addQuad([{coord:_,height:0},{coord:w,height:0},{coord:w,height:a[S.b]+4},{coord:_,height:a[S.a]+4}],A)}}prepareEdgePoints(e,r,a,u){const l=e[a.a],f=e[a.b];let y=r[a.a],b=r[a.b];if(!(y!==0&&u(y,0)||b!==0&&u(b,0)))return;const S=l.clone(),_=f.clone();if(u(y,0)){if(!u(b,0)){const w=b/(b-y);_.x=or(_.x,S.x,w),_.y=or(_.y,S.y,w),b=or(b,y,w)}}else{const w=y/(y-b);S.x=or(S.x,_.x,w),S.y=or(S.y,_.y,w),y=or(y,b,w)}return[{coord:S,height:y},{coord:_,height:b}]}prepareEdges(e,r){if(r.length===0)return;r.sort((y,b)=>y.hash===b.hash?b.polygonIdx-y.polygonIdx:b.hash>y.hash?1:-1);let a=0,u=0,l=0,f=r[a].polygonIdx;do u++,(u===r.length||r[a].hash!==r[u].hash)&&((u-a==1||r[u-1].polygonIdx!==f)&&(l<a&&(r[l]=r[a],r[a]=null),r[l].type="none",l++),a=u,a!==r.length&&(f=r[a].polygonIdx));while(a!==r.length);if(r.splice(l),r.length!==0&&e.length!==0){r.sort((S,_)=>S.hash<_.hash?1:-1);let y=0,b=0;for(;y!==r.length&&b!==e.length;){const S=r[y],_=e[b];S.portalHash>_.hash?y++:_.hash>S.portalHash?b++:(S.type=_.type,y++)}}}isOnBorder(e,r){return e<=0&&r<=0||e>=Ct&&r>=Ct}static computeEdgeHash(e,r){return(e.y===r.y&&e.x>r.x||e.y>r.y)&&([e,r]=[r,e]),BigInt(Yo.computePosHash(e))<<32n|BigInt(Yo.computePosHash(r))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}class zv{constructor(e,r){this.layoutVertexArray=new Ao,this.indexArray=new wi,this.lineIndexArray=new Sa,this.triangleSegments=new Vn,this.lineSegments=new Vn,this.programConfigurations=new Ia(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,r&&(this.elevatedLayoutVertexArray=new wa)}update(e,r,a,u,l,f,y){this.programConfigurations.updatePaintArrays(e,r,l,a,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,KC.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,YC.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,r,a,u,l,f){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,a,u,l,f)}}class Lv{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.bufferData=new zv(e,!1),this.elevationBufferData=new zv(e,!0),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference")}updateFootprints(e,r){}populate(e,r,a,u){this.hasPattern=Mv("fill",this.layers,this.pixelRatio,r);const l=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:y,id:b,index:S,sourceLayerIndex:_}of e){const w=this.layers[0]._featureFilter.needGeometry,A=F(y,w);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),A,a))continue;const T=l?l.evaluate(A,{},a,r.availableImages):void 0,E={id:b,properties:y.properties,type:y.type,sourceLayerIndex:_,index:S,geometry:w?A.geometry:L(y,a,u),patterns:{},sortKey:T};f.push(E)}l&&f.sort((y,b)=>y.sortKey-b.sortKey);for(const y of f){const{geometry:b,index:S,sourceLayerIndex:_}=y;if(this.hasPattern){const w=Iv("fill",this.layers,y,this.zoom,this.pixelRatio,r);this.patternFeatures.push(w)}else this.addFeature(y,b,S,a,{},r.availableImages,r.brightness,r.elevationFeatures);r.featureIndex.insert(e[S].feature,b,S,_,this.index)}}update(e,r,a,u,l,f,y){this.bufferData.update(e,r,a,u,l,f,y),this.elevationBufferData.update(e,r,a,u,l,f,y)}addFeatures(e,r,a,u,l,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,r,a,u,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,r,a,u,l,f=[],y,b){const S=M_(r,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,S,u,a,b):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(e,a,l,f,u,y),this.elevationBufferData.populatePaintArrays(e,a,l,f,u,y)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e){this.elevatedStructures&&this.elevatedStructures.construct(e)}addElevatedRoadFeature(e,r,a,u,l){const f=new Array,y=this.getElevationFeature(e,l);if(y){f.push({polygons:r,elevationFeature:y,elevationTileID:a});for(const b of f)if(b.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Yo(b.elevationTileID));const _=b.elevationFeature.isTunnel();let w=0;e.properties.hasOwnProperty(vb)&&(w=+e.properties[vb]);for(const A of b.polygons)this.elevatedStructures.addPortalCandidates(b.elevationFeature.id,A,_,b.elevationFeature,w)}const S=new f3(a,b.elevationTileID);this.addElevatedGeometry(b.polygons,S,b.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u)}}else this.addGeometry(r,this.bufferData)}addElevatedGeometry(e,r,a,u,l){const f={elevation:a,elevationSampler:r,bias:u,index:l},[y,b]=this.addGeometry(e,this.elevationBufferData,f);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:y,max:b}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,y),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,b))}addGeometry(e,r,a){let u=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,f=null;a&&(f=a.elevationSampler.constantElevation(a.elevation,a.bias),f!=null&&(u=f,l=f));const y=(b,S,_)=>{if(a!=null)if(S.push(b),f!=null)r.elevatedLayoutVertexArray.emplaceBack(f),_.push(f);else{const w=a.elevationSampler.pointElevation(b,a.elevation,a.bias);r.elevatedLayoutVertexArray.emplaceBack(w),_.push(w),u=Math.min(u,w),l=Math.max(l,w)}};for(const b of e){let S=0;for(const V of b)S+=V.length;const _=r.triangleSegments.prepareSegment(S,r.layoutVertexArray,r.indexArray),w=_.vertexLength,A=[],T=[],E=[],C=[],O=[],k=r.layoutVertexArray.length;for(const V of b){if(V.length===0)continue;V!==b[0]&&T.push(A.length/2);const N=r.lineSegments.prepareSegment(V.length,r.layoutVertexArray,r.lineIndexArray),$=N.vertexLength;a&&O.push(r.layoutVertexArray.length-k),y(V[0],E,C),r.layoutVertexArray.emplaceBack(V[0].x,V[0].y),r.lineIndexArray.emplaceBack($+V.length-1,$),A.push(V[0].x),A.push(V[0].y);for(let W=1;W<V.length;W++)y(V[W],E,C),r.layoutVertexArray.emplaceBack(V[W].x,V[W].y),r.lineIndexArray.emplaceBack($+W-1,$+W),A.push(V[W].x),A.push(V[W].y);N.vertexLength+=V.length,N.primitiveLength+=V.length}const U=tp(A,T);for(let V=0;V<U.length;V+=3)r.indexArray.emplaceBack(w+U[V],w+U[V+1],w+U[V+2]);if(a&&this.elevationMode==="hd-road-base"){const V=a.elevation.isTunnel(),N=a.elevation.safeArea,$=this.elevatedStructures.addVertices(E,C);this.elevatedStructures.addTriangles(U,$,V);const W=O.length;if(W>0){for(let K=0;K<W-1;K++)this.elevatedStructures.addRenderableRing(a.index,O[K]+$,O[K+1]-O[K],V,N);this.elevatedStructures.addRenderableRing(a.index,O[W-1]+$,E.length-O[W-1],V,N)}}_.vertexLength+=S,_.primitiveLength+=U.length/3}return[u,l]}getElevationFeature(e,r){if(!r)return;const a=+e.properties[nu];return a!=null?r.find(u=>u.id===a):void 0}}let wb,Tb,Sb,Eb;Ft(Lv,"FillBucket",{omit:["layers","patternFeatures"]}),Ft(zv,"FillBufferData"),Ft(Yo,"ElevatedStructures");class Ov{constructor(e,r,a,u){if(this.triangleCount=r.length/3,this.min=new Ae(0,0),this.max=new Ae(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[l,f]=[e[0].clone(),e[0].clone()];for(let w=1;w<e.length;++w){const A=e[w];l.x=Math.min(l.x,A.x),l.y=Math.min(l.y,A.y),f.x=Math.max(f.x,A.x),f.y=Math.max(f.y,A.y)}if(u){const w=Math.ceil(Math.max(f.x-l.x,f.y-l.y)/u);a=Math.max(a,w)}if(a===0)return;this.min=l,this.max=f;const y=this.max.sub(this.min);y.x=Math.max(y.x,1),y.y=Math.max(y.y,1);const b=Math.max(y.x,y.y)/a;this.cellsX=Math.max(1,Math.ceil(y.x/b)),this.cellsY=Math.max(1,Math.ceil(y.y/b)),this.xScale=1/b,this.yScale=1/b;const S=[];for(let w=0;w<this.triangleCount;w++){const A=e[r[3*w+0]].sub(this.min),T=e[r[3*w+1]].sub(this.min),E=e[r[3*w+2]].sub(this.min),C=Ra(Math.floor(Math.min(A.x,T.x,E.x)),this.xScale,this.cellsX),O=Ra(Math.floor(Math.max(A.x,T.x,E.x)),this.xScale,this.cellsX),k=Ra(Math.floor(Math.min(A.y,T.y,E.y)),this.yScale,this.cellsY),U=Ra(Math.floor(Math.max(A.y,T.y,E.y)),this.yScale,this.cellsY),V=new Ae(0,0),N=new Ae(0,0),$=new Ae(0,0),W=new Ae(0,0);for(let K=k;K<=U;++K){V.y=N.y=K*b,$.y=W.y=(K+1)*b;for(let ae=C;ae<=O;++ae)V.x=$.x=ae*b,N.x=W.x=(ae+1)*b,(Be(A,T,E,V,N,W)||Be(A,T,E,V,W,$))&&S.push({cellIdx:K*this.cellsX+ae,triIdx:w})}}if(S.length===0)return;S.sort((w,A)=>w.cellIdx-A.cellIdx||w.triIdx-A.triIdx);let _=0;for(;_<S.length;){const w=S[_].cellIdx,A={start:this.payload.length,len:0};for(;_<S.length&&S[_].cellIdx===w;)++A.len,this.payload.push(S[_++].triIdx);this.cells[w]=A}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,r){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=Ra(e.x-this.min.x,this.xScale,this.cellsX),u=Ra(e.y-this.min.y,this.yScale,this.cellsY),l=this.cells[u*this.cellsX+a];if(l){this._lazyInitLookup();for(let f=0;f<l.len;f++){const y=this.payload[l.start+f],b=Math.floor(y/8),S=1<<y%8;if(!(this.lookup[b]&S)&&(this.lookup[b]|=S,r.push(y),r.length===this.triangleCount))return}}}query(e,r,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>r.x||e.y>this.max.y||this.min.y>r.y)return;this._lazyInitLookup();const u=Ra(e.x-this.min.x,this.xScale,this.cellsX),l=Ra(r.x-this.min.x,this.xScale,this.cellsX),f=Ra(e.y-this.min.y,this.yScale,this.cellsY),y=Ra(r.y-this.min.y,this.yScale,this.cellsY);for(let b=f;b<=y;b++)for(let S=u;S<=l;S++){const _=this.cells[b*this.cellsX+S];if(_)for(let w=0;w<_.len;w++){const A=this.payload[_.start+w],T=Math.floor(A/8),E=1<<A%8;if(!(this.lookup[T]&E)&&(this.lookup[T]|=E,a.push(A),a.length===this.triangleCount))return}}}}function Ra(o,e,r){return Math.max(0,Math.min(r-1,Math.floor(o*e)))}Ft(Ov,"TriangleGridIndex");class Ab{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.footprints=[]}updateFootprints(e,r){for(const a of this.footprints)r.push({footprint:a,id:e})}populate(e,r,a,u){const l=[];for(const{feature:f,id:y,index:b,sourceLayerIndex:S}of e){const _=this.layers[0]._featureFilter.needGeometry,w=F(f,_);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),w,a))continue;const A={id:y,properties:f.properties,type:f.type,sourceLayerIndex:S,index:b,geometry:_?w.geometry:L(f,a,u),patterns:{}};l.push(A)}for(const f of l){const{geometry:y,index:b,sourceLayerIndex:S}=f;this.addFeature(f,y,b,a,{},r.availableImages,r.brightness),r.featureIndex.insert(e[b].feature,y,b,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,r,a,u,l,f,y){}destroy(){}addFeature(e,r,a,u,l,f=[],y){for(const b of M_(r,2)){const S=[],_=[],w=[],A=new Ae(1/0,1/0),T=new Ae(-1/0,-1/0);for(const O of b)if(O.length!==0){O!==b[0]&&w.push(_.length/2);for(let k=0;k<O.length;k++)_.push(O[k].x),_.push(O[k].y),S.push(O[k]),A.x=Math.min(A.x,O[k].x),A.y=Math.min(A.y,O[k].y),T.x=Math.max(T.x,O[k].x),T.y=Math.max(T.y,O[k].y)}const E=tp(_,w),C=new Ov(S,E,8,256);this.footprints.push({vertices:S,indices:E,grid:C,min:A,max:T})}}}Ft(Ab,"ClipBucket",{omit:["layers"]});const m3=Zr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),_3=Zr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),g3=Zr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),y3=Zr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),v3=Zr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),x3=Zr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:b3}=m3;class su extends Ae{constructor(e,r,a){super(e,r),this.z=a}}class Mb extends su{constructor(e,r,a,u){super(e,r,a),this.w=u}}function C_(o,e,r,a){const u=[],l=a===0?(f,y,b,S,_,w)=>{f.push(new Ae(w,b+(w-y)/(S-y)*(_-b)))}:(f,y,b,S,_,w)=>{f.push(new Ae(y+(w-b)/(_-b)*(S-y),w))};for(const f of o){const y=[];for(const b of f){if(b.length<=2)continue;const S=[];for(let A=0;A<b.length-1;A++){const T=b[A].x,E=b[A].y,C=b[A+1].x,O=b[A+1].y,k=a===0?T:E,U=a===0?C:O;k<e?U>e&&l(S,T,E,C,O,e):k>r?U<r&&l(S,T,E,C,O,r):S.push(b[A]),U<e&&k>=e&&l(S,T,E,C,O,e),U>r&&k<=r&&l(S,T,E,C,O,r)}let _=b[b.length-1];const w=a===0?_.x:_.y;w>=e&&w<=r&&S.push(_),S.length&&(_=S[S.length-1],S[0].x===_.x&&S[0].y===_.y||S.push(S[0]),y.push(S))}y.length&&u.push(y)}return u}function Ib(o,e,r,a){const u=r==="x"?"y":"x",l=(a-o[r])/(e[r]-o[r]);o[u]=o[u]+(e[u]-o[u])*l,o[r]=a,o.hasOwnProperty("z")&&(o.z=or(o.z,e.z,l)),o.hasOwnProperty("w")&&(o.w=or(o.w,e.w,l))}function Cb(o,e,r,a){const u=r,l=a;for(const f of["x","y"]){let y=o,b=e;y[f]>=b[f]&&(y=e,b=o),y[f]<u&&b[f]>u&&Ib(y,b,f,u),y[f]<l&&b[f]>l&&Ib(b,y,f,l)}}const P_=Number.MAX_SAFE_INTEGER;function Pb(o,e,r,a){return o.order<e||o.order===P_||!(o.clipMask&r)||function(u,l){return l.length!==0&&l.find(f=>f===u)===void 0}(a,o.clipScope)}function R_(o,e){return o.x-e.x||o.y-e.y}function Rb(o,e){return R_(o.min,e.min)===0&&R_(o.max,e.max)===0}function kv(o,e){return!(o.min.x>e.max.x||o.max.x<e.min.x||o.min.y>e.max.y||o.max.y<e.min.y)}function Fv(o,e){if(o.length!==e.length)return!1;for(let r=0;r<o.length;r++)if(o[r].sourceId!==e[r].sourceId||!Rb(o[r],e[r])||o[r].order!==e[r].order||o[r].clipMask!==e[r].clipMask||!xt(o[r].clipScope,e[r].clipScope))return!1;return!0}function Db(o,e,r){const a=1/Ct,u=1/(1<<r.canonical.z),l=(e.x*a+r.canonical.x)*u+r.wrap,f=(e.y*a+r.canonical.y)*u;return{min:new Ae((o.x*a+r.canonical.x)*u+r.wrap,(o.y*a+r.canonical.y)*u),max:new Ae(l,f)}}function w3(o,e,r){const a=1<<r.canonical.z,u=((e.x-r.wrap)*a-r.canonical.x)*Ct,l=(e.y*a-r.canonical.y)*Ct;return{min:new Ae(((o.x-r.wrap)*a-r.canonical.x)*Ct,(o.y*a-r.canonical.y)*Ct),max:new Ae(u,l)}}function zb(o,e,r,a,u,l,f){const y=o.indices,b=o.vertices,S=[];for(let _=a;_<a+u;_+=3){const w=e[r[_+0]+l],A=e[r[_+1]+l],T=e[r[_+2]+l],E=Math.min(w.x,A.x,T.x),C=Math.max(w.x,A.x,T.x),O=Math.min(w.y,A.y,T.y),k=Math.max(w.y,A.y,T.y);S.length=0,o.grid.query(new Ae(E,O),new Ae(C,k),S);for(let U=0;U<S.length;U++){const V=S[U];if(Be(b[y[3*V+0]],b[y[3*V+1]],b[y[3*V+2]],w,A,T,f))return!0}}return!1}function Lb(o,e,r,a){if(!o||!r)return!1;let u=o.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(r.vertices.length<o.vertices.length)return Lb(r,a,o,e);const l=e.canonical,f=a.canonical,y=Math.pow(2,f.z-l.z);u=o.vertices.map(b=>new Ae((b.x+l.x*Ct)*y-f.x*Ct,(b.y+l.y*Ct)*y-f.y*Ct))}return zb(r,u,o.indices,0,o.indices.length,0,0)}function Ob(o,e,r,a){const u=Math.pow(2,a.z-r.z);return new Ae((o+r.x*Ct)*u-a.x*Ct,(e+r.y*Ct)*u-a.y*Ct)}function kb(o,e){const r=[];e.grid.queryPoint(o,r);const a=e.indices,u=e.vertices;for(let l=0;l<r.length;l++){const f=r[l];if(pe([u[a[3*f+0]],u[a[3*f+1]],u[a[3*f+2]]],o))return!0}return!1}const Bv=[new Ae(0,0),new Ae(Ct,0),new Ae(Ct,Ct),new Ae(0,Ct)];function Fb(o,e){const r=[];let a=[];if(!e||o.length<2)return[o];if(o.length===2)return Ee(o[0],o[1],Bv)?[o]:[];for(let u=0;u<o.length+2;u++){const l=o[u%o.length],f=o[(u+1)%o.length],y=Ee(u===0?o[o.length-1]:o[(u-1)%o.length],l,Bv),b=Ee(l,f,Bv),S=y||b;S&&a.push(l),S&&b||a.length>0&&(a.length>1&&r.push(a),a=[])}return a.length>1&&r.push(a),r}const Nv=Zl.VectorTileFeature.types,T3=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],S3=["fill-extrusion-flood-light-ground-radius"],E3=Math.pow(2,13),A3=Math.pow(2,15)-1,Bb=new Ae(0,1),Xl=2147483648;function sp(o,e,r,a,u,l,f,y){o.emplaceBack((e<<1)+f,(r<<1)+l,(Math.floor(a*E3)<<1)+u,Math.round(y))}function op(o,e,r){o.emplaceBack(e.x*Ct,e.y*Ct,r?1:0)}function D_(o,e,r,a,u,l){o.emplaceBack(e.x,e.y,(r.x<<1)+a,(r.y<<1)+u,l)}function ap(o,e,r){o.emplaceBack(e.x,e.y,e.z,r[0]*16384,r[1]*16384,r[2]*16384)}class Nb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class Vb{constructor(){this.centroidXY=new Ae(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ae(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ae(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ae(this.max.x-this.min.x,this.max.y-this.min.y)}}class Ub{constructor(){this.acc=new Ae(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,r){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=r.x,e.min.y=e.max.y=r.y)}appendEdge(e,r,a){this.accCount++,this.acc._add(r);let u=!!this.borders;r.x<e.min.x?(e.min.x=r.x,u=!0):r.x>e.max.x&&(e.max.x=r.x,u=!0),r.y<e.min.y?(e.min.y=r.y,u=!0):r.y>e.max.y&&(e.max.y=r.y,u=!0),((r.x===0||r.x===Ct)&&r.x===a.x)!=((r.y===0||r.y===Ct)&&r.y===a.y)&&this.processBorderOverlap(r,a),u&&this.checkBorderIntersection(r,a)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,or(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Ct!=e.x>Ct&&this.addBorderIntersection(1,or(r.y,e.y,(Ct-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,or(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Ct!=e.y>Ct&&this.addBorderIntersection(3,or(r.x,e.x,(Ct-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];r<a[0]&&(a[0]=r),r>a[1]&&(a[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,r.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,r.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new Ae(0,0):new Ae(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0):0}}function jb(o,e){const r=o.add(e)._unit(),a=Ye(o.x*r.x+o.y*r.y,-1,1);var u,l,f;return f=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(f)))/4*A3*((u=o).x*(l=e).y-u.y*l.x<0?-1:1)}const M3=[o=>o.x<0,o=>o.x>Ct,o=>o.y<0,o=>o.y>Ct];function I3(o,e,r,a){const u=[4];if(a===0)return u;r._mult(a);const l=o.sub(r),f=e.sub(r),y=[o,e,l,f];for(let b=0;b<4;b++)for(const S of y)if(M3[b](S)){u.push(b);break}return u}class $b{constructor(e){this.vertexArray=new Rf,this.indexArray=new wi,this.programConfigurations=new Ia(e.layers,{zoom:e.zoom,lut:e.lut},r=>S3.includes(r)),this._segments=new Vn,this.hiddenByLandmarkVertexArray=new Oh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Vn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,r,a,u=!1){const l=e.length;if(l>2){let f=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*l,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let b;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const S=e[0],_=e[1];b=jb(S.sub(e[l-1])._perp()._unit(),_.sub(S)._perp()._unit())}for(let S=0;S<l;S++){const _=S===l-1?0:S+1,w=e[S],A=e[_],T=e[_===l-1?0:_+1],E=A.sub(w)._perp()._unit(),C=jb(E,T.sub(A)._perp()._unit()),O=b,k=C;if(Vv(w,A,r)||u&&Hb(w,r)&&Hb(A,r)){b=C;continue}const U=y.vertexLength;D_(this.vertexArray,w,A,1,1,O),D_(this.vertexArray,w,A,1,0,O),D_(this.vertexArray,w,A,0,1,k),D_(this.vertexArray,w,A,0,0,k),y.vertexLength+=4;const V=I3(w,A,E,a);for(const N of V)this._segmentToGroundQuads[f].push({id:U,region:N}),this._segmentToRegionTriCounts[f][N]+=2,y.primitiveLength+=2;b=C}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),r=e.length;for(let a=0;a<r;a++)this._segmentToGroundQuads[a].sort((u,l)=>u.region-l.region);for(let a=0;a<r;a++){const u=this._segmentToGroundQuads[a],l=e[a],f=this._segmentToRegionTriCounts[a];f.reduce((b,S)=>b+S,0);let y=0;for(let b=0;b<=4;b++){const S=f[b];if(S!==0){let _=this.regionSegments[b];_||(_=this.regionSegments[b]=new Vn);const w={vertexOffset:l.vertexOffset,primitiveOffset:l.primitiveOffset+y,vertexLength:l.vertexLength,primitiveLength:S};_.get().push(w)}y+=S}for(let b=0;b<u.length;b++){const S=u[b].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,r,a,u,l,f){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,r,a,u,l,f)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,_3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,r,a,u,l,f,y){this.hasData()&&this.programConfigurations.updatePaintArrays(e,r,a,u,l,f,y)}updateHiddenByLandmark(e){if(!this.hasData())return;const r=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&Xl?1:0;for(let u=e.groundVertexArrayOffset;u<r;++u)this.hiddenByLandmarkVertexArray.emplace(u,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,v3.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const r=this.regionSegments[e];r&&r.destroy()}}}}class z_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new wi,this.footprintVertices=new Ao,this.footprintSegments=[],this.layoutVertexArray=new rl,this.centroidVertexArray=new v_,this.wallVertexArray=new b_,this.indexArray=new wi,this.programConfigurations=new Ia(e.layers,{zoom:e.zoom,lut:e.lut},r=>T3.includes(r)),this.segments=new Vn,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.groundEffect=new $b(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(e,r){}populate(e,r,a,u){this.features=[],this.hasPattern=Mv("fill-extrusion",this.layers,this.pixelRatio,r),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=t(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:l,id:f,index:y,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,_=F(l,S);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),_,a))continue;const w={id:f,sourceLayerIndex:b,index:y,geometry:S?_.geometry:L(l,a,u),properties:l.properties,type:l.type,patterns:{}},A=this.layoutVertexArray.length,T=Nv[w.type]==="Polygon";if(this.hasPattern)this.features.push(Iv("fill-extrusion",this.layers,w,this.zoom,this.pixelRatio,r));else if(this.wallMode)for(const E of w.geometry)for(const C of Fb(E,T))this.addFeature(w,[C],y,a,{},r.availableImages,u,r.brightness);else this.addFeature(w,w.geometry,y,a,{},r.availableImages,u,r.brightness);r.featureIndex.insert(l,w.geometry,y,b,this.index,A)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,r,a,u,l,f){for(const y of this.features){const b=Nv[y.type]==="Polygon",{geometry:S}=y;if(this.wallMode)for(const _ of S)for(const w of Fb(_,b))this.addFeature(y,[w],y.index,r,a,u,l,f);else this.addFeature(y,S,y.index,r,a,u,l,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,r,a,u,l,f,y){this.programConfigurations.updatePaintArrays(e,r,l,a,u,f,y),this.groundEffect.update(e,r,l,a,u,f,y)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,b3),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,y3.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,x3.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,g3.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,a,u,l,f,y,b){const S=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,_=[new Ae(0,0),new Ae(Ct,Ct)],w=y.projection,A=w.name==="globe",T=this.wallMode||Nv[e.type]==="Polygon",E=new Ub;E.centroidDataIndex=this.centroidData.length;const C=new Vb,O=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},u)<=0,k=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},u);let U;if(C.height=k,C.vertexArrayOffset=this.layoutVertexArray.length,C.groundVertexArrayOffset=this.groundEffect.vertexArray.length,A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ch),this.wallMode){if(A)return void Pr("Non zero fill-extrusion-line-width is not yet supported on globe.");if(r.length!==1)return;U=function(se){const ve=se[0].x===se[se.length-1].x&&se[0].y===se[se.length-1].y;(function(Tt){let at=0;const tr=Tt.length;for(let Ot=0;Ot<tr;Ot++)at+=(Tt[(Ot+1)%tr].x-Tt[Ot].x)*(Tt[(Ot+1)%tr].y+Tt[Ot].y);return at>=0})(se)||(se=se.reverse());const xe={geometry:[],joinNormals:[],indices:[]},Me=[],Se=[],Ce=[];let Ie=se.length;for(;Ie>=2&&se[Ie-1].equals(se[Ie-2]);)Ie--;if(Ie<(ve?3:2))return xe;let Fe,ze,Ne,it,nt,Bt=0;for(;Bt<Ie-1&&se[Bt].equals(se[Bt+1]);)Bt++;ve&&(Fe=se[Ie-2],nt=se[Bt].sub(Fe)._unit()._perp());for(let Tt=Bt;Tt<Ie;Tt++){if(Ne=Tt===Ie-1?ve?se[Bt+1]:void 0:se[Tt+1],Ne&&se[Tt].equals(Ne))continue;nt&&(it=nt),Fe&&(ze=Fe),Fe=se[Tt],nt=Ne?Ne.sub(Fe)._unit()._perp():it,it=it||nt;let at=it.add(nt);at.x===0&&at.y===0||at._unit();const tr=at.x*nt.x+at.y*nt.y,Ot=tr!==0?1/tr:1/0,Ht=it.x*nt.y-it.y*nt.x>0;let hr="miter";const Mr=2;hr==="miter"&&Ot>Mr&&(hr="bevel"),hr==="bevel"&&(Ot>100&&(hr="flipbevel"),Ot<Mr&&(hr="miter"));const gr=(Lr,Sr,Fr,Wr)=>{const yn=new Ae(Lr.x,Lr.y),mr=new Ae(Lr.x,Lr.y);yn.x+=Sr.x*Wr,yn.y+=Sr.y*Wr,mr.x-=Sr.x*Math.max(Fr,1),mr.y-=Sr.y*Math.max(Fr,1),Ce.push(Sr),Me.push(yn),Se.push(mr)};if(hr==="miter")at._mult(Ot),gr(Fe,at,0,0);else if(hr==="flipbevel")at=nt.mult(-1),gr(Fe,at,0,0),gr(Fe,at.mult(-1),0,0);else{const Lr=-Math.sqrt(Ot*Ot-1),Sr=Ht?Lr:0,Fr=Ht?0:Lr;ze&&gr(Fe,it,Sr,Fr),Ne&&gr(Fe,nt,Sr,Fr)}}xe.geometry=[...Me,...Se.reverse(),Me[0]],xe.joinNormals=[...Ce,...Ce.reverse(),Ce[Ce.length-1]];const ft=xe.geometry.length-1;for(let Tt=0;Tt<ft/2;Tt++)if(Tt+1<ft/2){let at=Tt,tr=Tt+1,Ot=ft-1-Tt,Ht=ft-2-Tt;at=at===0?ft-1:at-1,tr=tr===0?ft-1:tr-1,Ot=Ot===0?ft-1:Ot-1,Ht=Ht===0?ft-1:Ht-1,xe.indices.push(Ot),xe.indices.push(tr),xe.indices.push(at),xe.indices.push(Ot),xe.indices.push(Ht),xe.indices.push(tr)}return xe}(r[0]),r=[U.geometry]}const V=(se,ve)=>se<(ve.length-1)/2||se===ve.length-1,N=this.wallMode?[r]:M_(r,500);for(let se=N.length-1;se>=0;se--){const ve=N[se];(ve.length===0||($=ve[0]).every(le=>le.x<=0)||$.every(le=>le.x>=Ct)||$.every(le=>le.y<=0)||$.every(le=>le.y>=Ct))&&N.splice(se,1)}var $;let W;if(A)W=Kb(N,_,u);else{W=[];for(const se of N)W.push({polygon:se,bounds:_})}const K=T?this.edgeRadius:0,ae=K>0&&this.zoom<17,ie=(se,ve)=>{if(se.length===0)return!1;const le=se[se.length-1];return ve.x===le.x&&ve.y===le.y};for(const{polygon:se,bounds:ve}of W){let le=0,xe=0;for(const Ie of se)T&&!Ie[0].equals(Ie[Ie.length-1])&&Ie.push(Ie[0]),xe+=T?Ie.length-1:Ie.length;const Me=this.segments.prepareSegment((T?5:4)*xe,this.layoutVertexArray,this.indexArray);C.footprintSegIdx<0&&(C.footprintSegIdx=this.footprintSegments.length),C.polygonSegIdx<0&&(C.polygonSegIdx=this.polygonSegments.length);const Se={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ce=new Nb;if(Ce.vertexOffset=this.footprintVertices.length,Ce.indexOffset=3*this.footprintIndices.length,Ce.ringIndices=[],T){const Ie=[],Fe=[];le=Me.vertexLength;for(let Ne=0;Ne<se.length;Ne++){const it=se[Ne];it.length&&Ne!==0&&Fe.push(Ie.length/2);const nt=[];let Bt,ft;Bt=it[1].sub(it[0])._perp()._unit(),Ce.ringIndices.push(it.length-1);for(let Tt=1;Tt<it.length;Tt++){const at=it[Tt],tr=it[Tt===it.length-1?1:Tt+1],Ot=at.clone();if(K){ft=tr.sub(at)._perp()._unit();const Ht=Bt.add(ft)._unit(),hr=K*Math.min(4,1/(Bt.x*Ht.x+Bt.y*Ht.y));Ot.x+=hr*Ht.x,Ot.y+=hr*Ht.y,Ot.x=Math.round(Ot.x),Ot.y=Math.round(Ot.y),Bt=ft}if(!O||K!==0&&!ae||ie(nt,Ot)||nt.push(Ot),sp(this.layoutVertexArray,Ot.x,Ot.y,0,0,1,1,0),this.wallMode){const Ht=V(Tt,it);op(this.wallVertexArray,U.joinNormals[Tt],!Ht)}Me.vertexLength++,this.footprintVertices.emplaceBack(at.x,at.y),Ie.push(at.x,at.y),A&&ap(this.layoutVertexExtArray,w.projectTilePoint(Ot.x,Ot.y,u),w.upVector(u,Ot.x,Ot.y))}O&&(K===0||ae)&&(nt.length!==0&&ie(nt,nt[0])&&nt.pop(),this.groundEffect.addData(nt,ve,S))}const ze=this.wallMode?U.indices:tp(Ie,Fe);for(let Ne=0;Ne<ze.length;Ne+=3)this.footprintIndices.emplaceBack(Ce.vertexOffset+ze[Ne+0],Ce.vertexOffset+ze[Ne+1],Ce.vertexOffset+ze[Ne+2]),this.indexArray.emplaceBack(le+ze[Ne],le+ze[Ne+2],le+ze[Ne+1]),Me.primitiveLength++;Ce.indexCount+=ze.length,Ce.vertexCount+=this.footprintVertices.length-Ce.vertexOffset}for(let Ie=0;Ie<se.length;Ie++){const Fe=se[Ie];E.startRing(C,Fe[0]);let ze=Fe.length>4&&Wb(Fe[Fe.length-2],Fe[0],Fe[1]),Ne=K?C3(Fe[Fe.length-2],Fe[0],Fe[1],K):0;const it=[];let nt,Bt,ft;Bt=Fe[1].sub(Fe[0])._perp()._unit();let Tt=!0;for(let at=1,tr=0;at<Fe.length;at++){let Ot=Fe[at-1],Ht=Fe[at];const hr=Fe[at===Fe.length-1?1:at+1];if(E.appendEdge(C,Ht,Ot),Vv(Ht,Ot,ve)){K&&(Bt=hr.sub(Ht)._perp()._unit(),Tt=!Tt);continue}const Mr=Ht.sub(Ot)._perp(),gr=Mr.x/(Math.abs(Mr.x)+Math.abs(Mr.y)),Lr=Mr.y>0?1:0,Sr=Ot.dist(Ht);if(tr+Sr>32768&&(tr=0),K){ft=hr.sub(Ht)._perp()._unit();let mr=qb(Ot,Ht,hr,Gb(Bt,ft),K);isNaN(mr)&&(mr=0);const Ur=Ht.sub(Ot)._unit();Ot=Ot.add(Ur.mult(Ne))._round(),Ht=Ht.add(Ur.mult(-mr))._round(),Ne=mr,Bt=ft,O&&this.zoom>=17&&(ie(it,Ot)||it.push(Ot),ie(it,Ht)||it.push(Ht))}const Fr=Me.vertexLength,Wr=Fe.length>4&&Wb(Ot,Ht,hr);let yn=Zb(tr,ze,Tt);if(sp(this.layoutVertexArray,Ot.x,Ot.y,gr,Lr,0,0,yn),sp(this.layoutVertexArray,Ot.x,Ot.y,gr,Lr,0,1,yn),this.wallMode){const mr=V(at-1,Fe),Ur=U.joinNormals[at-1];op(this.wallVertexArray,Ur,mr),op(this.wallVertexArray,Ur,mr)}if(tr+=Sr,yn=Zb(tr,Wr,!Tt),ze=Wr,sp(this.layoutVertexArray,Ht.x,Ht.y,gr,Lr,0,0,yn),sp(this.layoutVertexArray,Ht.x,Ht.y,gr,Lr,0,1,yn),this.wallMode){const mr=V(at,Fe),Ur=U.joinNormals[at];op(this.wallVertexArray,Ur,mr),op(this.wallVertexArray,Ur,mr)}if(Me.vertexLength+=4,this.indexArray.emplaceBack(Fr+0,Fr+1,Fr+2),this.indexArray.emplaceBack(Fr+1,Fr+3,Fr+2),Me.primitiveLength+=2,K){const mr=le+(at===1?Fe.length-2:at-2),Ur=at===1?le:mr+1;if(this.indexArray.emplaceBack(Fr+1,mr,Fr+3),this.indexArray.emplaceBack(mr,Ur,Fr+3),Me.primitiveLength+=2,nt===void 0&&(nt=Fr),!Vv(hr,Fe[at],ve)){const En=at===Fe.length-1?nt:Me.vertexLength;this.indexArray.emplaceBack(Fr+2,Fr+3,En),this.indexArray.emplaceBack(Fr+3,En+1,En),this.indexArray.emplaceBack(Fr+3,Ur,En+1),Me.primitiveLength+=3}Tt=!Tt}if(A){const mr=this.layoutVertexExtArray,Ur=w.projectTilePoint(Ot.x,Ot.y,u),En=w.projectTilePoint(Ht.x,Ht.y,u),kn=w.upVector(u,Ot.x,Ot.y),Gn=w.upVector(u,Ht.x,Ht.y);ap(mr,Ur,kn),ap(mr,Ur,kn),ap(mr,En,Gn),ap(mr,En,Gn)}}T&&(le+=Fe.length-1),O&&K&&this.zoom>=17&&(it.length!==0&&ie(it,it[0])&&it.pop(),this.groundEffect.addData(it,ve,S,K>0))}this.footprintSegments.push(Ce),Se.triangleCount=this.indexArray.length-Se.triangleArrayOffset,this.polygonSegments.push(Se),++C.footprintSegLen,++C.polygonSegLen}if(C.vertexCount=this.layoutVertexArray.length-C.vertexArrayOffset,C.groundVertexCount=this.groundEffect.vertexArray.length-C.groundVertexArrayOffset,C.vertexCount!==0){if(C.centroidXY=E.borders?Bb:this.encodeCentroid(E,C),this.centroidData.push(C),E.borders){this.featuresOnBorder.push(E);const se=this.featuresOnBorder.length-1;for(let ve=0;ve<E.borders.length;ve++)E.borders[ve][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[ve].push(se)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,l,f,u,b),this.groundEffect.addPaintPropertiesData(e,a,l,f,u,b),this.maxHeight=Math.max(this.maxHeight,k)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((r,a)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],S=+(b.min.y+b.max.y>Ct),_=2*S+(+(b.min.x+b.max.x>Ct)^S);for(let w=0;w<b.polygonSegLen;w++){const A=b.polygonSegIdx+w;e.push({centroidIdx:y,subtile:_,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}const r=new wi;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let a=0,u=0,l=0;for(const y of e){if(y.triangleSegmentIdx!==a)break;l++}const f=e.length;for(;u!==e.length;){a=e[u].triangleSegmentIdx;let y=0,b=u,S=u;for(let _=b;_<l&&e[_].subtile===y;_++)S++;for(;b!==l;){const _=e[b];y=_.subtile;const w=this.centroidData[_.centroidIdx].min.clone(),A=this.centroidData[_.centroidIdx].max.clone(),T={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:r.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let E=b;E<S;E++){const C=e[E],O=this.polygonSegments[C.polygonSegmentIdx],k=this.centroidData[C.centroidIdx].min,U=this.centroidData[C.centroidIdx].max,V=this.indexArray.uint16;for(let N=O.triangleArrayOffset;N<O.triangleArrayOffset+O.triangleCount;N++)r.emplaceBack(V[3*N],V[3*N+1],V[3*N+2]);T.primitiveLength+=O.triangleCount,w.x=Math.min(w.x,k.x),w.y=Math.min(w.y,k.y),A.x=Math.max(A.x,U.x),A.y=Math.max(A.y,U.y)}T.primitiveLength>0&&this.triangleSubSegments.push({segment:T,min:w,max:A}),b=S;for(let E=b;E<l&&e[E].subtile===e[b].subtile;E++)S++}u=l;for(let _=u;_<f&&e[_].triangleSegmentIdx===e[u].triangleSegmentIdx;_++)l++}r._trim(),this.indexArray=r}getVisibleSegments(e,r,a){const u=new Vn;if(this.wallMode){for(const C of this.triangleSubSegments)u.segments.push(C.segment);return u}let l=0,f=0;const y=1<<e.canonical.z;if(r){const C=r.getMinMaxForTile(e);C&&(l=C.min,f=C.max)}f+=this.maxHeight;const b=e.toUnwrapped();let S;const _=[b.canonical.x/y+b.wrap,b.canonical.y/y],w=[(b.canonical.x+1)/y+b.wrap,(b.canonical.y+1)/y],A=(C,O,k)=>[C[0]*(1-k[0])+O[0]*k[0],C[1]*(1-k[1])+O[1]*k[1]],T=[],E=[];for(const C of this.triangleSubSegments){T[0]=C.min.x/Ct,T[1]=C.min.y/Ct,E[0]=C.max.x/Ct,E[1]=C.max.y/Ct;const O=A(_,w,T),k=A(_,w,E);if(new sr([O[0],O[1],l],[k[0],k[1],f]).intersectsPrecise(a)===0){S&&(u.segments.push(S),S=void 0);continue}const U=C.segment;S&&S.vertexOffset!==U.vertexOffset&&(u.segments.push(S),S=void 0),S?(S.vertexLength+=U.vertexLength,S.primitiveLength+=U.primitiveLength):S={vertexOffset:U.vertexOffset,primitiveLength:U.primitiveLength,vertexLength:U.vertexLength,primitiveOffset:U.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&u.segments.push(S),u}encodeCentroid(e,r){const a=e.centroid(),u=r.span(),l=Math.min(7,Math.round(u.x*this.tileToMeter/10)),f=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Ae(Ye(a.x,1,Ct-1)<<3|l,Ye(a.y,1,Ct-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Ae(0,0);const r=e.borders,a=Number.MAX_VALUE;if(r[0][0]!==a||r[1][0]!==a){const u=r[0][0]!==a?0:1;return new Ae(6|(r[0][0]!==a?0:65528),(r[u][0]+r[u][1])/2<<3|6)}{const u=r[2][0]!==a?2:3;return new Ae((r[u][0]+r[u][1])/2<<3|6,6|(r[2][0]!==a?0:65528))}}showCentroid(e){const r=this.centroidData[e.centroidDataIndex];r.flags&=Xl,r.centroidXY.x=0,r.centroidXY.y=0,this.writeCentroidToBuffer(r)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const r=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,u=e.flags&Xl?Bb:e.centroidXY,l=this.centroidVertexArray.geta_centroid_pos0(r);if(this.centroidVertexArray.geta_centroid_pos1(r)!==u.y||l!==u.x){for(let f=r;f<a;++f)this.centroidVertexArray.emplace(f,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,r,a){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const u=r.getReplacementRegionsForTile(e.toUnwrapped());if(Fv(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const l=[];for(const f of this.activeReplacements){if(f.order<a)continue;const y=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const b of this.centroidData)if(!(b.flags&Xl||f.min.x>b.max.x||b.min.x>f.max.x||f.min.y>b.max.y||b.min.y>f.max.y))for(let S=0;S<b.footprintSegLen;S++){const _=this.footprintSegments[b.footprintSegIdx+S];if(l.length=0,P3(this.footprintVertices,_.vertexOffset,_.vertexCount,f.footprintTileId.canonical,e.canonical,l),zb(f.footprint,l,this.footprintIndices.uint16,_.indexOffset,_.indexCount,-_.vertexOffset,-y)){b.flags|=Xl;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,r,a){let u=!1;for(let l=0;l<a.footprintSegLen;l++){const f=this.footprintSegments[a.footprintSegIdx+l];let y=0;for(const b of f.ringIndices){for(let S=y,_=b+y-1;S<b+y;_=S++){const w=this.footprintVertices.int16[2*(S+f.vertexOffset)+0],A=this.footprintVertices.int16[2*(S+f.vertexOffset)+1],T=this.footprintVertices.int16[2*(_+f.vertexOffset)+1];A>r!=T>r&&e<(this.footprintVertices.int16[2*(_+f.vertexOffset)+0]-w)*(r-A)/(T-A)+w&&(u=!u)}y=b}}return u}getHeightAtTileCoord(e,r){let a=Number.NEGATIVE_INFINITY,u=!0;const l=4*(e+Ct)*Ct+(r+Ct);if(this.partLookup.hasOwnProperty(l)){const f=this.partLookup[l];return f?{height:f.height,hidden:!!(f.flags&Xl)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||r>f.max.y||f.min.y>r||this.footprintContainsPoint(e,r,f)&&f&&f.height>a&&(a=f.height,this.partLookup[l]=f,u=!!(f.flags&Xl));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.partLookup[l]=void 0}}function Gb(o,e){const r=o.add(e)._unit();return o.x*r.x+o.y*r.y}function C3(o,e,r,a){const u=e.sub(o)._perp()._unit(),l=r.sub(e)._perp()._unit();return qb(o,e,r,Gb(u,l),a)}function qb(o,e,r,a,u){const l=Math.sqrt(1-a*a);return Math.min(o.dist(e)/3,e.dist(r)/3,u*l/a)}function Vv(o,e,r){return o.x<r[0].x&&e.x<r[0].x||o.x>r[1].x&&e.x>r[1].x||o.y<r[0].y&&e.y<r[0].y||o.y>r[1].y&&e.y>r[1].y}function Hb(o,e){return o.x<e[0].x||o.x>e[1].x||o.y<e[0].y||o.y>e[1].y}function Wb(o,e,r){if(o.x<0||o.x>=Ct||e.x<0||e.x>=Ct||r.x<0||r.x>=Ct)return!1;const a=r.sub(e),u=a.perp(),l=o.sub(e);return(a.x*l.x+a.y*l.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(l.x*l.x+l.y*l.y))>-.866&&u.x*l.x+u.y*l.y<0}function Zb(o,e,r){const a=e?2|o:-3&o;return r?1|a:-2&a}function Xb(){const o=Math.PI/32,e=Math.tan(o),r=ql;return r*Math.sqrt(1+2*e*e)-r}function Kb(o,e,r){const a=1<<r.z,u=us(r.x/a),l=us((r.x+1)/a),f=Mi(r.y/a),y=Mi((r.y+1)/a);return function(b,S,_,w,A=0,T){const E=[];if(!b.length||!_||!w)return E;const C=(W,K)=>{for(const ae of W)E.push({polygon:ae,bounds:K})},O=Math.ceil(Math.log2(_)),k=Math.ceil(Math.log2(w)),U=O-k,V=[];for(let W=0;W<Math.abs(U);W++)V.push(U>0?0:1);for(let W=0;W<Math.min(O,k);W++)V.push(0),V.push(1);let N=b;if(N=C_(N,S[0].y-A,S[1].y+A,1),N=C_(N,S[0].x-A,S[1].x+A,0),!N.length)return E;const $=[];for(V.length?$.push({polygons:N,bounds:S,depth:0}):C(N,S);$.length;){const W=$.pop(),K=W.depth,ae=V[K],ie=W.bounds[0],se=W.bounds[1],ve=ae===0?ie.x:ie.y,le=ae===0?se.x:se.y,xe=T?T(ae,ve,le):.5*(ve+le),Me=C_(W.polygons,ve-A,xe+A,ae),Se=C_(W.polygons,xe-A,le+A,ae);if(Me.length){const Ce=[ie,new Ae(ae===0?xe:se.x,ae===1?xe:se.y)];V.length>K+1?$.push({polygons:Me,bounds:Ce,depth:K+1}):C(Me,Ce)}if(Se.length){const Ce=[new Ae(ae===0?xe:ie.x,ae===1?xe:ie.y),se];V.length>K+1?$.push({polygons:Se,bounds:Ce,depth:K+1}):C(Se,Ce)}}return E}(o,e,Math.ceil((l-u)/11.25),Math.ceil((f-y)/11.25),1,(b,S,_)=>{if(b===0)return .5*(S+_);{const w=Mi((r.y+S/Ct)/a);return(io(.5*(Mi((r.y+_/Ct)/a)+w))*a-r.y)*Ct}})}function P3(o,e,r,a,u,l){const f=Math.pow(2,a.z-u.z);for(let y=0;y<r;y++){let b=o.int16[2*(y+e)+0],S=o.int16[2*(y+e)+1];b=(b+u.x*Ct)*f-a.x*Ct,S=(S+u.y*Ct)*f-a.y*Ct,l.push(new Ae(b,S))}}let Yb,Jb;function lp(o,e){return o.x*e.x+o.y*e.y}function Qb(o,e){if(o.length===1){let r=0;const a=e[r++];let u;for(;!u||a.equals(u);)if(u=e[r++],!u)return 1/0;for(;r<e.length;r++){const l=e[r],f=o[0],y=u.sub(a),b=l.sub(a),S=f.sub(a),_=lp(y,y),w=lp(y,b),A=lp(b,b),T=lp(S,y),E=lp(S,b),C=_*A-w*w,O=(A*T-w*E)/C,k=(_*E-w*T)/C,U=a.z*(1-O-k)+u.z*O+l.z*k;if(isFinite(U))return U}return 1/0}{let r=1/0;for(const a of e)r=Math.min(r,a.z);return r}}function ew(o,e,r,a,u,l,f,y){const b=f*u.getElevationAt(o,e,!0,!0),S=l[0]!==0,_=S?l[1]===0?f*(l[0]/7-450):f*function(w,A,T){const E=Math.floor(A[0]/8),C=Math.floor(A[1]/8),O=10*(A[0]-8*E),k=10*(A[1]-8*C),U=w.getElevationAt(E,C,!0,!0),V=w.getMeterToDEM(T),N=Math.floor(.5*(O*V-1)),$=Math.floor(.5*(k*V-1)),W=w.tileCoordToPixel(E,C),K=2*N+1,ae=2*$+1,ie=function(Se,Ce,Ie,Fe,ze){return[Se.getElevationAtPixel(Ce,Ie,!0),Se.getElevationAtPixel(Ce+ze,Ie,!0),Se.getElevationAtPixel(Ce,Ie+ze,!0),Se.getElevationAtPixel(Ce+Fe,Ie+ze,!0)]}(w,W.x-N,W.y-$,K,ae),se=Math.abs(ie[0]-ie[1]),ve=Math.abs(ie[2]-ie[3]),le=Math.abs(ie[0]-ie[2])+Math.abs(ie[1]-ie[3]),xe=Math.min(.25,.5*V*(se+ve)/K),Me=Math.min(.25,.5*V*le/ae);return U+Math.max(xe*O,Me*k)}(u,l,y):b;return{base:b+(r===0?-1:r),top:S?Math.max(_+a,b+r+2):b+a}}Ft(z_,"FillExtrusionBucket",{omit:["layers","features"]}),Ft(Vb,"PartData"),Ft(Nb,"FootprintSegment"),Ft(Ub,"BorderCentroidData"),Ft($b,"GroundEffect");const R3=Zr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),D3=Zr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:z3}=R3,L3=Zr([{name:"a_packed",components:3,type:"Float32"}]),{members:O3}=L3,k3=Zr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:F3}=k3;class tw{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Wl({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const a=this.getKey(e,r);return this.positions[a]}trim(){const e=this.width,r=this.height=Ki(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,a){const u=[];let l=e.length%2==1?-e[e.length-1]*a:0,f=e[0]*a,y=!0;u.push({left:l,right:f,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let S=1;S<e.length;S++){y=!y;const _=e[S];l=b*a,b+=_,f=b*a,u.push({left:l,right:f,isDash:y,zeroLength:_===0})}return u}addRoundDash(e,r,a){const u=r/2;for(let l=-a;l<=a;l++){const f=this.width*(this.nextRow+a+l);let y=0,b=e[y];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++y]);const _=Math.abs(S-b.left),w=Math.abs(S-b.right),A=Math.min(_,w);let T;const E=l/a*(u+1);if(b.isDash){const C=u-Math.abs(E);T=Math.sqrt(A*A+C*C)}else T=u-Math.sqrt(A*A+E*E);this.image.data[f+S]=Math.max(0,Math.min(255,T+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const S=e[b],_=e[b+1];S.zeroLength?e.splice(b,1):_&&_.isDash===S.isDash&&(_.left=S.left,e.splice(b,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const l=this.width*this.nextRow;let f=0,y=e[f];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++f]);const S=Math.abs(b-y.left),_=Math.abs(b-y.right),w=Math.min(S,_);this.image.data[l+b]=Math.max(0,Math.min(255,(y.isDash?w:-w)+r+128))}}addDash(e,r){const a=this.getKey(e,r);if(this.positions[a])return this.positions[a];const u=r==="round",l=u?7:0,f=2*l+1;if(this.nextRow+f>this.height)return Pr("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let _=0;_<e.length;_++)e[_]<0&&(Pr("Negative value is found in line dasharray, replacing values with 0"),e[_]=0),y+=e[_];if(y!==0){const _=this.width/y,w=this.getDashRanges(e,this.width,_);u?this.addRoundDash(w,_,l):this.addRegularDash(w,r==="square"?.5*_:0)}const b=this.nextRow+l;this.nextRow+=f;const S={tl:[b,l],br:[y,0]};return this.positions[a]=S,S}}Ft(tw,"LineAtlas");const B3=Zl.VectorTileFeature.types,N3=Math.cos(Math.PI/180*37.5),V3=Math.cos(Math.PI/180*5);class Uv{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new Mh,this.layoutVertexArray2=new Mo,this.patternVertexArray=new Mo,this.indexArray=new wi,this.programConfigurations=new Ia(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Vn,this.maxLineLength=0,this.zOffsetVertexArray=new Mo,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Ct/64}updateFootprints(e,r){}populate(e,r,a,u){this.hasPattern=Mv("line",this.layers,this.pixelRatio,r);const l=this.layers[0].layout.get("line-sort-key");this.tileToMeter=t(a);const f=this.layers[0].layout.get("line-z-offset"),y=f.isConstant()&&!f.constantOr(0),b=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset=b==="sea"||b==="ground"||!y&&b==="none",this.hasZOffset&&b==="none"&&Pr(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&S!==void 0;const _=[];for(const{feature:E,id:C,index:O,sourceLayerIndex:k}of e){const U=this.layers[0]._featureFilter.needGeometry,V=F(E,U);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),V,a))continue;const N=l?l.evaluate(V,{},a):void 0,$={id:C,properties:E.properties,type:E.type,sourceLayerIndex:k,index:O,geometry:U?V.geometry:L(E,a,u),patterns:{},sortKey:N};_.push($)}l&&_.sort((E,C)=>E.sortKey-C.sortKey);const{lineAtlas:w,featureIndex:A}=r,T=this.addConstantDashes(w);for(const E of _){const{geometry:C,index:O,sourceLayerIndex:k}=E;if(T&&this.addFeatureDashes(E,w),this.hasPattern){const U=Iv("line",this.layers,E,this.zoom,this.pixelRatio,r);this.patternFeatures.push(U)}else this.addFeature(E,C,O,a,w.positions,r.availableImages,r.brightness);A.insert(e[O].feature,C,O,k,this.index)}}addConstantDashes(e){let r=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,l=a.layout.get("line-cap").value;if(u.kind!=="constant"||l.kind!=="constant")r=!0;else{const f=l.value,y=u.value;if(!y)continue;e.addDash(y,f)}}return r}addFeatureDashes(e,r){const a=this.zoom;for(const u of this.layers){const l=u.paint.get("line-dasharray").value,f=u.layout.get("line-cap").value;if(l.kind==="constant"&&f.kind==="constant")continue;let y,b;if(l.kind==="constant"){if(y=l.value,!y)continue}else y=l.evaluate({zoom:a},e);b=f.kind==="constant"?f.value:f.evaluate({zoom:a},e),r.addDash(y,b),e.patterns[u.id]=r.getKey(y,b)}}update(e,r,a,u,l,f,y){this.programConfigurations.updatePaintArrays(e,r,l,a,u,f,y)}addFeatures(e,r,a,u,l,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,r,a,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,O3)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,F3)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,D3.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,z3),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,a,u,l,f,y){const b=this.layers[0].layout,S=b.get("line-join").evaluate(e,{}),_=b.get("line-cap").evaluate(e,{}),w=b.get("line-miter-limit"),A=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=b.get("line-z-offset").value;const T=this.layers[0].paint.get("line-width").value;T.kind!=="constant"&&T.isLineProgressConstant===!1&&(this.variableWidthValue=T);for(const E of r)this.addLine(E,e,u,S,_,w,A);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,l,f,u,y)}addLine(e,r,a,u,l,f,y){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const b=u==="none";if(this.patternJoinNone=this.hasPattern&&b,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let V=0;V<e.length-1;V++)this.totalDistance+=e[V].dist(e[V+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=B3[r.type]==="Polygon";let _=e.length;for(;_>=2&&e[_-1].equals(e[_-2]);)_--;let w=0;for(;w<_-1&&e[w].equals(e[w+1]);)w++;if(_<(S?3:2))return;u==="bevel"&&(f=1.05);const A=this.segments.prepareSegment(10*_,this.layoutVertexArray,this.indexArray);let T,E,C,O,k,U;this.e1=this.e2=-1,S&&(T=e[_-2],k=e[w].sub(T)._unit()._perp());for(let V=w;V<_;V++){if(C=V===_-1?S?e[w+1]:void 0:e[V+1],C&&e[V].equals(C))continue;k&&(O=k),T&&(E=T),T=e[V],U=this.evaluateLineProgressFeatures(E?E.dist(T):0),k=C?C.sub(T)._unit()._perp():O,O=O||k;const N=E&&C;let $=N?u:S||b?"butt":l;const W=O.x*k.x+O.y*k.y;if(b){const Me=function(Se){if(Se.patternJoinNone){const Ce=Se.segmentPoints.length/2,Ie=Se.lineSoFar-Se.segmentStart;for(let Fe=0;Fe<Ce;++Fe){const ze=Se.segmentPoints[2*Fe+1],Ne=Math.round(Se.segmentPoints[2*Fe])+.5+.25*ze;Se.patternVertexArray.emplaceBack(Ne,Ie,Se.segmentStart),Se.patternVertexArray.emplaceBack(Ne,Ie,Se.segmentStart)}Se.segmentPoints.length=0}Se.e1=Se.e2=-1};if(N&&W<V3){this.updateDistance(E,T),this.addCurrentVertex(T,O,1,1,A,U),Me(this),this.addCurrentVertex(T,k,-1,-1,A,U);continue}if(E){if(!C){this.updateDistance(E,T),this.addCurrentVertex(T,O,1,1,A,U),Me(this);continue}$="miter"}}let K=O.add(k);K.x===0&&K.y===0||K._unit();const ae=K.x*k.x+K.y*k.y,ie=ae!==0?1/ae:1/0,se=2*Math.sqrt(2-2*ae),ve=ae<N3&&E&&C,le=O.x*k.y-O.y*k.x>0,xe=this.overscaling<=16?15*Ct/(512*this.overscaling):0;if(N&&$==="round"){if(ie<y)$="miter";else if(ie<=2){const Me=jv(T,-10,Ct+10);$=this.hasZOffset&&(Me||this.hasCrossSlope)?"miter":"fakeround"}}if($==="miter"&&ie>f&&($="bevel"),$==="bevel"&&(ie>2&&($="flipbevel"),ie<f&&($="miter")),E&&!($==="miter"&&ve)&&this.updateDistance(E,T),$==="miter")if(ve){const Me=T.dist(E);if(Me>2*xe){const Ce=T.sub(T.sub(E)._mult(xe/Me)._round());this.updateDistance(E,Ce),this.addCurrentVertex(Ce,O,0,0,A,U),E=Ce}this.updateDistance(E,T),K._mult(ie),this.addCurrentVertex(T,K,0,0,A,U);const Se=T.dist(C);if(Se>2*xe){const Ce=T.add(C.sub(T)._mult(xe/Se)._round());this.updateDistance(T,Ce),this.addCurrentVertex(Ce,k,0,0,A,U),T=Ce}}else K._mult(ie),this.addCurrentVertex(T,K,0,0,A,U);else if($==="flipbevel"){if(ie>100)K=k.mult(-1);else{const Me=ie*O.add(k).mag()/O.sub(k).mag();K._perp()._mult(Me*(le?-1:1))}this.addCurrentVertex(T,K,0,0,A,U),this.addCurrentVertex(T,K.mult(-1),0,0,A,U)}else if($==="bevel"||$==="fakeround"){U!=null&&E&&this.addCurrentVertex(T,O,-1,-1,A,U);const Me=T.dist(E)<=2*xe&&$!=="bevel",Se=K.mult(le?1:-1);Se._mult(ie);const Ce=k.mult(le?-1:1),Ie=O.mult(le?-1:1),Fe=this.evaluateLineProgressFeatures(this.distance);if(U==null&&(this.addHalfVertex(T,Se.x,Se.y,!1,!le,0,A,Fe),Me||this.addHalfVertex(T,Se.x+2*Ie.x,Se.y+2*Ie.y,!1,le,0,A,Fe)),$==="fakeround"){const ze=Math.round(180*se/Math.PI/20);this.addHalfVertex(T,Ie.x,Ie.y,!1,le,0,A,Fe);for(let Ne=0;Ne<ze;Ne++){let it=Ne/ze;if(it!==.5){const Bt=it-.5;it+=it*Bt*(it-1)*((1.0904+W*(W*(3.55645-1.43519*W)-3.2452))*Bt*Bt+(.848013+W*(.215638*W-1.06021)))}const nt=Ce.sub(Ie)._mult(it)._add(Ie)._unit();this.addHalfVertex(T,nt.x,nt.y,!1,le,0,A,Fe)}this.addHalfVertex(T,Ce.x,Ce.y,!1,le,0,A,Fe)}Me||U!=null||this.addHalfVertex(T,Se.x+2*Ce.x,Se.y+2*Ce.y,!1,le,0,A,Fe),U!=null&&C&&this.addCurrentVertex(T,k,1,1,A,U)}else $==="butt"?this.addCurrentVertex(T,K,0,0,A,U):$==="square"?(E||this.addCurrentVertex(T,K,-1,-1,A,U),this.addCurrentVertex(T,K,0,0,A,U),E&&this.addCurrentVertex(T,K,1,1,A,U)):$==="round"&&(E&&(this.addCurrentVertex(T,O,0,0,A,U),this.addCurrentVertex(T,O,1,1,A,U,!0)),C&&(this.addCurrentVertex(T,k,-1,-1,A,U,!0),this.addCurrentVertex(T,k,0,0,A,U)))}}addVerticesTo(e,r,a,u,l,f,y,b,S,_){const w=(r.w-e.w)/this.tessellationStep|0;let A=0;const T=this.scaledDistance;if(w>1){this.lineSoFar=e.w;const C=(r.x-e.x)/w,O=(r.y-e.y)/w,k=(r.z-e.z)/w,U=(r.w-e.w)/w;for(let V=1;V<w;++V){e.x+=C,e.y+=O,e.z+=k,this.lineSoFar+=U,A+=U;const N=this.evaluateLineProgressFeatures(this.prevDistance+A);this.scaledDistance=(this.prevDistance+A)/this.totalDistance,this.addHalfVertex(e,a,u,_,!1,y,S,N),this.addHalfVertex(e,l,f,_,!0,-b,S,N)}}this.lineSoFar=r.w,this.scaledDistance=T;const E=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(r,a,u,_,!1,y,S,E),this.addHalfVertex(r,l,f,_,!0,-b,S,E)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Pr(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let r=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(r=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:r}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:r}:{zOffset:0,variableWidth:r}}addCurrentVertex(e,r,a,u,l,f,y=!1){const b=r.x+r.y*a,S=r.y-r.x*a,_=r.y*u-r.x,w=-r.y-r.x*u;if(f!=null){const A=this.hasZOffset,T=-10,E=Ct+10,C=f.zOffset,O=new Mb(e.x,e.y,C,this.lineSoFar),k=!!A&&jv(e,T,E),U=this.lineSoFar,V=this.distance;if(this.currentVertex)if(k){const N=this.currentVertexIsOutside,$=this.currentVertex,W=new Mb(e.x,e.y,C,this.lineSoFar);if(Cb($,W,T,E),!jv(W,T,E)){if(N){this.e1=this.e2=-1,this.distance-=$.dist(O),this.lineSoFar=$.w;const K=this.evaluateLineProgressFeatures($.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($,b,S,y,!1,a,l,K),this.addHalfVertex($,_,w,y,!0,-u,l,K),this.prevDistance=this.distance}this.distance=this.prevDistance+$.dist(W),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo($,W,b,S,_,w,a,u,l,y),this.distance=V,this.scaledDistance=this.distance/this.totalDistance}}else{const N=this.currentVertex;if(this.currentVertexIsOutside){Cb(N,O,T,E),this.e1=this.e2=-1,this.distance-=N.dist(O),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=N.w;const $=this.evaluateLineProgressFeatures(N.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(N,b,S,y,!1,a,l,$),this.addHalfVertex(N,_,w,y,!0,-u,l,$),this.prevDistance=this.distance,this.distance=V,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(N,O,b,S,_,w,a,u,l,y)}else k||(this.addHalfVertex(e,b,S,y,!1,a,l,f),this.addHalfVertex(e,_,w,y,!0,-u,l,f));this.currentVertex=O,this.currentVertexIsOutside=k,this.lineSoFar=U}else this.addHalfVertex(e,b,S,y,!1,a,l,f),this.addHalfVertex(e,_,w,y,!0,-u,l,f)}addHalfVertex({x:e,y:r},a,u,l,f,y,b,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,y)),this.layoutVertexArray.emplaceBack((e<<1)+(l?1:0),(r<<1)+(f?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const w=or(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,w)}const _=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,_),b.primitiveLength++),f?this.e2=_:this.e1=_,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,r){this.prevDistance=this.distance,this.distance+=e.dist(r),this.updateScaledDistance()}}function jv(o,e,r){return o.x<e||o.x>r||o.y<e||o.y>r}let rw,nw;function iw(o,e,r){return e*(Ct/(o.tileSize*Math.pow(2,r-o.tileID.overscaledZ)))}Ft(Uv,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const sw=(o,e,r)=>(1-r)*o+r*e;function ow(o,e){return 1/iw(o,1,e.tileZoom)}function aw(o,e,r,a){return o.translatePosMatrix(a||e.tileID.projMatrix,e,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const lw=o=>{const e=[];cw(o)&&e.push("RENDER_LINE_DASH"),o.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const r=o.paint.get("line-trim-offset");r[0]===0&&r[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),o.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=o.layout.get("line-join").constantOr("miter")==="none",u=!!o.paint.get("line-pattern").constantOr(1);return a&&u&&e.push("LINE_JOIN_NONE"),e};function cw(o){const e=o.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let $v;const uw=()=>$v||($v={layout:rw||(rw=new Nn({"line-cap":new kt(Ue.layout_line["line-cap"]),"line-join":new kt(Ue.layout_line["line-join"]),"line-miter-limit":new bt(Ue.layout_line["line-miter-limit"]),"line-round-limit":new bt(Ue.layout_line["line-round-limit"]),"line-sort-key":new kt(Ue.layout_line["line-sort-key"]),"line-z-offset":new kt(Ue.layout_line["line-z-offset"]),"line-elevation-reference":new bt(Ue.layout_line["line-elevation-reference"]),"line-cross-slope":new bt(Ue.layout_line["line-cross-slope"]),visibility:new bt(Ue.layout_line.visibility),"line-width-unit":new bt(Ue.layout_line["line-width-unit"])})),paint:nw||(nw=new Nn({"line-opacity":new kt(Ue.paint_line["line-opacity"]),"line-color":new kt(Ue.paint_line["line-color"]),"line-translate":new bt(Ue.paint_line["line-translate"]),"line-translate-anchor":new bt(Ue.paint_line["line-translate-anchor"]),"line-width":new kt(Ue.paint_line["line-width"]),"line-gap-width":new kt(Ue.paint_line["line-gap-width"]),"line-offset":new kt(Ue.paint_line["line-offset"]),"line-blur":new kt(Ue.paint_line["line-blur"]),"line-dasharray":new kt(Ue.paint_line["line-dasharray"]),"line-pattern":new kt(Ue.paint_line["line-pattern"]),"line-gradient":new el(Ue.paint_line["line-gradient"]),"line-trim-offset":new bt(Ue.paint_line["line-trim-offset"]),"line-trim-fade-range":new bt(Ue.paint_line["line-trim-fade-range"]),"line-trim-color":new bt(Ue.paint_line["line-trim-color"]),"line-emissive-strength":new bt(Ue.paint_line["line-emissive-strength"]),"line-border-width":new kt(Ue.paint_line["line-border-width"]),"line-border-color":new kt(Ue.paint_line["line-border-color"]),"line-occlusion-opacity":new bt(Ue.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},$v);class U3 extends kt{possiblyEvaluate(e,r){return r=new gn(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,transition:r.transition}),super.possiblyEvaluate(e,r)}evaluate(e,r,a,u){return r=Vr({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(e,r,a,u)}}let cp;function hw(o,e){return e>0?e+2*o:o}const j3=Zr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),$3=Zr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),G3=Zr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Zr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const q3=Zr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),H3=Zr([{name:"a_texb",components:2,type:"Uint16"}]),W3=Zr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),Z3=Zr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Zr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const dw=Zr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),X3=Zr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Zr([{name:"triangle",components:3,type:"Uint16"}]),Zr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Zr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Zr([{type:"Float32",name:"offsetX"}]),Zr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Oi=24;const Jo=128;function fw(o,e,r,a,u){if(o.kind==="camera")return o.maxSize;if(o.kind==="composite"){const l=e.possiblyEvaluate(new gn(o.maxZoom),r).evaluate(u,{},r),f=e.possiblyEvaluate(new gn(o.minZoom),r).evaluate(u,{},r);return Math.max(l,f)}return e.possiblyEvaluate(new gn(a)).evaluate(u,{},r)}function Gv(o,e){const{expression:r}=e;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new gn(o+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=r;let l=0;for(;l<a.length&&a[l]<=o;)l++;l=Math.max(0,l-1);let f=l;for(;f<a.length&&a[f]<o+1;)f++;f=Math.min(a.length-1,f);const y=a[l],b=a[f];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new gn(y)),maxSize:r.evaluate(new gn(b)),interpolationType:u}}}function L_(o,{uSize:e,uSizeT:r},{lowerSize:a,upperSize:u}){return o.kind==="source"?a/Jo:o.kind==="composite"?or(a/Jo,u/Jo,r):e}function qh(o,e,r=1){let a=0,u=0;if(o.kind==="constant")u=o.layoutSize*r;else if(o.kind!=="source"){const{interpolationType:l,minZoom:f,maxZoom:y}=o,b=l?Ye(Ts.interpolationFactor(l,e,f,y),0,1):0;o.kind==="camera"?u=or(o.minSize,o.maxSize,b)*r:a=b*r}return{uSizeT:a,uSize:u}}var K3=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Jo,evaluateSizeForFeature:L_,evaluateSizeForZoom:qh,getRasterizedIconSize:fw,getSizeData:Gv});function Y3(o,e,r){return o.sections.forEach(a=>{a.text=function(u,l,f){const y=l.layout.get("text-transform").evaluate(f,{});return y==="uppercase"?u=u.toLocaleUpperCase():y==="lowercase"&&(u=u.toLocaleLowerCase()),ls.applyArabicShaping&&(u=ls.applyArabicShaping(u)),u}(a.text,e,r)}),o}const up={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function J3(o){return o==="︶"||o==="﹈"||o==="︸"||o==="﹄"||o==="﹂"||o==="︾"||o==="︼"||o==="︺"||o==="︘"||o==="﹀"||o==="︐"||o==="︓"||o==="︔"||o==="｀"||o==="￣"||o==="︑"||o==="︒"}function Q3(o){return o==="︵"||o==="﹇"||o==="︷"||o==="﹃"||o==="﹁"||o==="︽"||o==="︻"||o==="︹"||o==="︗"||o==="︿"}var pw,qv,mw,Hv={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function eP(){return pw||(pw=1,Hv.read=function(o,e,r,a,u){var l,f,y=8*u-a-1,b=(1<<y)-1,S=b>>1,_=-7,w=r?u-1:0,A=r?-1:1,T=o[e+w];for(w+=A,l=T&(1<<-_)-1,T>>=-_,_+=y;_>0;l=256*l+o[e+w],w+=A,_-=8);for(f=l&(1<<-_)-1,l>>=-_,_+=a;_>0;f=256*f+o[e+w],w+=A,_-=8);if(l===0)l=1-S;else{if(l===b)return f?NaN:1/0*(T?-1:1);f+=Math.pow(2,a),l-=S}return(T?-1:1)*f*Math.pow(2,l-a)},Hv.write=function(o,e,r,a,u,l){var f,y,b,S=8*l-u-1,_=(1<<S)-1,w=_>>1,A=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,T=a?0:l-1,E=a?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,f=_):(f=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-f))<1&&(f--,b*=2),(e+=f+w>=1?A/b:A*Math.pow(2,1-w))*b>=2&&(f++,b/=2),f+w>=_?(y=0,f=_):f+w>=1?(y=(e*b-1)*Math.pow(2,u),f+=w):(y=e*Math.pow(2,w-1)*Math.pow(2,u),f=0));u>=8;o[r+T]=255&y,T+=E,y/=256,u-=8);for(f=f<<u|y,S+=u;S>0;o[r+T]=255&f,T+=E,f/=256,S-=8);o[r+T-E]|=128*C}),Hv}function _w(){if(mw)return qv;mw=1,qv=e;var o=eP();function e(N){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(N)?N:new Uint8Array(N||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var r=4294967296,a=1/r,u=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function l(N){return N.type===e.Bytes?N.readVarint()+N.pos:N.pos+1}function f(N,$,W){return W?4294967296*$+(N>>>0):4294967296*($>>>0)+(N>>>0)}function y(N,$,W){var K=$<=16383?1:$<=2097151?2:$<=268435455?3:Math.floor(Math.log($)/(7*Math.LN2));W.realloc(K);for(var ae=W.pos-1;ae>=N;ae--)W.buf[ae+K]=W.buf[ae]}function b(N,$){for(var W=0;W<N.length;W++)$.writeVarint(N[W])}function S(N,$){for(var W=0;W<N.length;W++)$.writeSVarint(N[W])}function _(N,$){for(var W=0;W<N.length;W++)$.writeFloat(N[W])}function w(N,$){for(var W=0;W<N.length;W++)$.writeDouble(N[W])}function A(N,$){for(var W=0;W<N.length;W++)$.writeBoolean(N[W])}function T(N,$){for(var W=0;W<N.length;W++)$.writeFixed32(N[W])}function E(N,$){for(var W=0;W<N.length;W++)$.writeSFixed32(N[W])}function C(N,$){for(var W=0;W<N.length;W++)$.writeFixed64(N[W])}function O(N,$){for(var W=0;W<N.length;W++)$.writeSFixed64(N[W])}function k(N,$){return(N[$]|N[$+1]<<8|N[$+2]<<16)+16777216*N[$+3]}function U(N,$,W){N[W]=$,N[W+1]=$>>>8,N[W+2]=$>>>16,N[W+3]=$>>>24}function V(N,$){return(N[$]|N[$+1]<<8|N[$+2]<<16)+(N[$+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(N,$,W){for(W=W||this.length;this.pos<W;){var K=this.readVarint(),ae=K>>3,ie=this.pos;this.type=7&K,N(ae,$,this),this.pos===ie&&this.skip(K)}return $},readMessage:function(N,$){return this.readFields(N,$,this.readVarint()+this.pos)},readFixed32:function(){var N=k(this.buf,this.pos);return this.pos+=4,N},readSFixed32:function(){var N=V(this.buf,this.pos);return this.pos+=4,N},readFixed64:function(){var N=k(this.buf,this.pos)+k(this.buf,this.pos+4)*r;return this.pos+=8,N},readSFixed64:function(){var N=k(this.buf,this.pos)+V(this.buf,this.pos+4)*r;return this.pos+=8,N},readFloat:function(){var N=o.read(this.buf,this.pos,!0,23,4);return this.pos+=4,N},readDouble:function(){var N=o.read(this.buf,this.pos,!0,52,8);return this.pos+=8,N},readVarint:function(N){var $,W,K=this.buf;return $=127&(W=K[this.pos++]),W<128?$:($|=(127&(W=K[this.pos++]))<<7,W<128?$:($|=(127&(W=K[this.pos++]))<<14,W<128?$:($|=(127&(W=K[this.pos++]))<<21,W<128?$:function(ae,ie,se){var ve,le,xe=se.buf;if(ve=(112&(le=xe[se.pos++]))>>4,le<128||(ve|=(127&(le=xe[se.pos++]))<<3,le<128)||(ve|=(127&(le=xe[se.pos++]))<<10,le<128)||(ve|=(127&(le=xe[se.pos++]))<<17,le<128)||(ve|=(127&(le=xe[se.pos++]))<<24,le<128)||(ve|=(1&(le=xe[se.pos++]))<<31,le<128))return f(ae,ve,ie);throw new Error("Expected varint not more than 10 bytes")}($|=(15&(W=K[this.pos]))<<28,N,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var N=this.readVarint();return N%2==1?(N+1)/-2:N/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var N=this.readVarint()+this.pos,$=this.pos;return this.pos=N,N-$>=12&&u?function(W,K,ae){return u.decode(W.subarray(K,ae))}(this.buf,$,N):function(W,K,ae){for(var ie="",se=K;se<ae;){var ve,le,xe,Me=W[se],Se=null,Ce=Me>239?4:Me>223?3:Me>191?2:1;if(se+Ce>ae)break;Ce===1?Me<128&&(Se=Me):Ce===2?(192&(ve=W[se+1]))==128&&(Se=(31&Me)<<6|63&ve)<=127&&(Se=null):Ce===3?(le=W[se+2],(192&(ve=W[se+1]))==128&&(192&le)==128&&((Se=(15&Me)<<12|(63&ve)<<6|63&le)<=2047||Se>=55296&&Se<=57343)&&(Se=null)):Ce===4&&(le=W[se+2],xe=W[se+3],(192&(ve=W[se+1]))==128&&(192&le)==128&&(192&xe)==128&&((Se=(15&Me)<<18|(63&ve)<<12|(63&le)<<6|63&xe)<=65535||Se>=1114112)&&(Se=null)),Se===null?(Se=65533,Ce=1):Se>65535&&(Se-=65536,ie+=String.fromCharCode(Se>>>10&1023|55296),Se=56320|1023&Se),ie+=String.fromCharCode(Se),se+=Ce}return ie}(this.buf,$,N)},readBytes:function(){var N=this.readVarint()+this.pos,$=this.buf.subarray(this.pos,N);return this.pos=N,$},readPackedVarint:function(N,$){if(this.type!==e.Bytes)return N.push(this.readVarint($));var W=l(this);for(N=N||[];this.pos<W;)N.push(this.readVarint($));return N},readPackedSVarint:function(N){if(this.type!==e.Bytes)return N.push(this.readSVarint());var $=l(this);for(N=N||[];this.pos<$;)N.push(this.readSVarint());return N},readPackedBoolean:function(N){if(this.type!==e.Bytes)return N.push(this.readBoolean());var $=l(this);for(N=N||[];this.pos<$;)N.push(this.readBoolean());return N},readPackedFloat:function(N){if(this.type!==e.Bytes)return N.push(this.readFloat());var $=l(this);for(N=N||[];this.pos<$;)N.push(this.readFloat());return N},readPackedDouble:function(N){if(this.type!==e.Bytes)return N.push(this.readDouble());var $=l(this);for(N=N||[];this.pos<$;)N.push(this.readDouble());return N},readPackedFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed32());var $=l(this);for(N=N||[];this.pos<$;)N.push(this.readFixed32());return N},readPackedSFixed32:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed32());var $=l(this);for(N=N||[];this.pos<$;)N.push(this.readSFixed32());return N},readPackedFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readFixed64());var $=l(this);for(N=N||[];this.pos<$;)N.push(this.readFixed64());return N},readPackedSFixed64:function(N){if(this.type!==e.Bytes)return N.push(this.readSFixed64());var $=l(this);for(N=N||[];this.pos<$;)N.push(this.readSFixed64());return N},skip:function(N){var $=7&N;if($===e.Varint)for(;this.buf[this.pos++]>127;);else if($===e.Bytes)this.pos=this.readVarint()+this.pos;else if($===e.Fixed32)this.pos+=4;else{if($!==e.Fixed64)throw new Error("Unimplemented type: "+$);this.pos+=8}},writeTag:function(N,$){this.writeVarint(N<<3|$)},realloc:function(N){for(var $=this.length||16;$<this.pos+N;)$*=2;if($!==this.length){var W=new Uint8Array($);W.set(this.buf),this.buf=W,this.length=$}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(N){this.realloc(4),U(this.buf,N,this.pos),this.pos+=4},writeSFixed32:function(N){this.realloc(4),U(this.buf,N,this.pos),this.pos+=4},writeFixed64:function(N){this.realloc(8),U(this.buf,-1&N,this.pos),U(this.buf,Math.floor(N*a),this.pos+4),this.pos+=8},writeSFixed64:function(N){this.realloc(8),U(this.buf,-1&N,this.pos),U(this.buf,Math.floor(N*a),this.pos+4),this.pos+=8},writeVarint:function(N){(N=+N||0)>268435455||N<0?function($,W){var K,ae;if($>=0?(K=$%4294967296|0,ae=$/4294967296|0):(ae=~(-$/4294967296),4294967295^(K=~(-$%4294967296))?K=K+1|0:(K=0,ae=ae+1|0)),$>=18446744073709552e3||$<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");W.realloc(10),function(ie,se,ve){ve.buf[ve.pos++]=127&ie|128,ie>>>=7,ve.buf[ve.pos++]=127&ie|128,ie>>>=7,ve.buf[ve.pos++]=127&ie|128,ie>>>=7,ve.buf[ve.pos++]=127&ie|128,ve.buf[ve.pos]=127&(ie>>>=7)}(K,0,W),function(ie,se){var ve=(7&ie)<<4;se.buf[se.pos++]|=ve|((ie>>>=3)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie|((ie>>>=7)?128:0),ie&&(se.buf[se.pos++]=127&ie)))))}(ae,W)}(N,this):(this.realloc(4),this.buf[this.pos++]=127&N|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=127&(N>>>=7)|(N>127?128:0),N<=127||(this.buf[this.pos++]=N>>>7&127))))},writeSVarint:function(N){this.writeVarint(N<0?2*-N-1:2*N)},writeBoolean:function(N){this.writeVarint(!!N)},writeString:function(N){N=String(N),this.realloc(4*N.length),this.pos++;var $=this.pos;this.pos=function(K,ae,ie){for(var se,ve,le=0;le<ae.length;le++){if((se=ae.charCodeAt(le))>55295&&se<57344){if(!ve){se>56319||le+1===ae.length?(K[ie++]=239,K[ie++]=191,K[ie++]=189):ve=se;continue}if(se<56320){K[ie++]=239,K[ie++]=191,K[ie++]=189,ve=se;continue}se=ve-55296<<10|se-56320|65536,ve=null}else ve&&(K[ie++]=239,K[ie++]=191,K[ie++]=189,ve=null);se<128?K[ie++]=se:(se<2048?K[ie++]=se>>6|192:(se<65536?K[ie++]=se>>12|224:(K[ie++]=se>>18|240,K[ie++]=se>>12&63|128),K[ie++]=se>>6&63|128),K[ie++]=63&se|128)}return ie}(this.buf,N,this.pos);var W=this.pos-$;W>=128&&y($,W,this),this.pos=$-1,this.writeVarint(W),this.pos+=W},writeFloat:function(N){this.realloc(4),o.write(this.buf,N,this.pos,!0,23,4),this.pos+=4},writeDouble:function(N){this.realloc(8),o.write(this.buf,N,this.pos,!0,52,8),this.pos+=8},writeBytes:function(N){var $=N.length;this.writeVarint($),this.realloc($);for(var W=0;W<$;W++)this.buf[this.pos++]=N[W]},writeRawMessage:function(N,$){this.pos++;var W=this.pos;N($,this);var K=this.pos-W;K>=128&&y(W,K,this),this.pos=W-1,this.writeVarint(K),this.pos+=K},writeMessage:function(N,$,W){this.writeTag(N,e.Bytes),this.writeRawMessage($,W)},writePackedVarint:function(N,$){$.length&&this.writeMessage(N,b,$)},writePackedSVarint:function(N,$){$.length&&this.writeMessage(N,S,$)},writePackedBoolean:function(N,$){$.length&&this.writeMessage(N,A,$)},writePackedFloat:function(N,$){$.length&&this.writeMessage(N,_,$)},writePackedDouble:function(N,$){$.length&&this.writeMessage(N,w,$)},writePackedFixed32:function(N,$){$.length&&this.writeMessage(N,T,$)},writePackedSFixed32:function(N,$){$.length&&this.writeMessage(N,E,$)},writePackedFixed64:function(N,$){$.length&&this.writeMessage(N,C,$)},writePackedSFixed64:function(N,$){$.length&&this.writeMessage(N,O,$)},writeBytesField:function(N,$){this.writeTag(N,e.Bytes),this.writeBytes($)},writeFixed32Field:function(N,$){this.writeTag(N,e.Fixed32),this.writeFixed32($)},writeSFixed32Field:function(N,$){this.writeTag(N,e.Fixed32),this.writeSFixed32($)},writeFixed64Field:function(N,$){this.writeTag(N,e.Fixed64),this.writeFixed64($)},writeSFixed64Field:function(N,$){this.writeTag(N,e.Fixed64),this.writeSFixed64($)},writeVarintField:function(N,$){this.writeTag(N,e.Varint),this.writeVarint($)},writeSVarintField:function(N,$){this.writeTag(N,e.Varint),this.writeSVarint($)},writeStringField:function(N,$){this.writeTag(N,e.Bytes),this.writeString($)},writeFloatField:function(N,$){this.writeTag(N,e.Fixed32),this.writeFloat($)},writeDoubleField:function(N,$){this.writeTag(N,e.Fixed64),this.writeDouble($)},writeBooleanField:function(N,$){this.writeVarintField(N,!!$)}},qv}var O_=G(_w());const Wv=3;function tP(o,e,r){e.glyphs=[],o===1&&r.readMessage(rP,e)}function rP(o,e,r){if(o===3){const{id:a,bitmap:u,width:l,height:f,left:y,top:b,advance:S}=r.readMessage(nP,{});e.glyphs.push({id:a,bitmap:new Wl({width:l+2*Wv,height:f+2*Wv},u),metrics:{width:l,height:f,left:y,top:b,advance:S}})}else o===4?e.ascender=r.readSVarint():o===5&&(e.descender=r.readSVarint())}function nP(o,e,r){o===1?e.id=r.readVarint():o===2?e.bitmap=r.readBytes():o===3?e.width=r.readVarint():o===4?e.height=r.readVarint():o===5?e.left=r.readSVarint():o===6?e.top=r.readSVarint():o===7&&(e.advance=r.readVarint())}const iP=Wv,Ps={horizontal:1,vertical:2,horizontalOnly:3};class hp{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,r){const a=new hp;return a.scale=e||1,a.fontStack=r,a}static forImage(e){const r=new hp;return r.image=e,r}}class Hh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r,a){const u=new Hh;for(let l=0;l<e.sections.length;l++){const f=e.sections[l];f.image?u.addImageSection(f,a):u.addTextSection(f,r)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(r,a){let u="";for(let l=0;l<r.length;l++){const f=r.charCodeAt(l+1)||null,y=r.charCodeAt(l-1)||null;u+=!a&&(f&&vf(f)&&!up[r[l+1]]||y&&vf(y)&&!up[r[l-1]])||!up[r[l]]?r[l]:up[r[l]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&k_[this.text.charCodeAt(a)];a++)e++;let r=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&k_[this.text.charCodeAt(a)];a--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const a=new Hh;return a.text=this.text.substring(e,r),a.sectionIndex=this.sectionIndex.slice(e,r),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(hp.forText(e.scale,e.fontStack||r));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e,r){const a=e.image?e.image.getPrimary():null;if(!a)return void Pr("Can't add FormattedSection with an empty image.");a.scaleSelf(r);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(hp.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Pr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zv(o,e,r,a,u,l,f,y,b,S,_,w,A,T,E,C=1){const O=Hh.fromFeature(o,u,C);w===Ps.vertical&&O.verticalizePunctuation(A);let k=[];const U=function(K,ae,ie,se,ve,le){if(!K)return[];const xe=[],Me=function(Fe,ze,Ne,it,nt,Bt){let ft=0;for(let Tt=0;Tt<Fe.length();Tt++){const at=Fe.getSection(Tt);ft+=gw(Fe.getCodePoint(Tt),at,it,nt,ze,Bt)}return ft/Math.max(1,Math.ceil(ft/Ne))}(K,ae,ie,se,ve,le),Se=K.text.indexOf("​")>=0;let Ce=0;for(let Fe=0;Fe<K.length();Fe++){const ze=K.getSection(Fe),Ne=K.getCodePoint(Fe);if(k_[Ne]||(Ce+=gw(Ne,ze,se,ve,ae,le)),Fe<K.length()-1){const it=!((Ie=Ne)<11904||!(Qt["Bopomofo Extended"](Ie)||Qt.Bopomofo(Ie)||Qt["CJK Compatibility Forms"](Ie)||Qt["CJK Compatibility Ideographs"](Ie)||Qt["CJK Compatibility"](Ie)||Qt["CJK Radicals Supplement"](Ie)||Qt["CJK Strokes"](Ie)||Qt["CJK Symbols and Punctuation"](Ie)||Qt["CJK Unified Ideographs Extension A"](Ie)||Qt["CJK Unified Ideographs"](Ie)||Qt["Enclosed CJK Letters and Months"](Ie)||Qt["Halfwidth and Fullwidth Forms"](Ie)||Qt.Hiragana(Ie)||Qt["Ideographic Description Characters"](Ie)||Qt["Kangxi Radicals"](Ie)||Qt["Katakana Phonetic Extensions"](Ie)||Qt.Katakana(Ie)||Qt["Vertical Forms"](Ie)||Qt["Yi Radicals"](Ie)||Qt["Yi Syllables"](Ie)));(sP[Ne]||it||ze.image)&&xe.push(vw(Fe+1,Ce,Me,xe,oP(Ne,K.getCodePoint(Fe+1),it&&Se),!1))}}var Ie;return xw(vw(K.length(),Ce,Me,xe,0,!0))}(O,S,l,e,a,T),{processBidirectionalText:V,processStyledBidirectionalText:N}=ls;if(V&&O.sections.length===1){const K=V(O.toString(),U);for(const ae of K){const ie=new Hh;ie.text=ae,ie.sections=O.sections;for(let se=0;se<ae.length;se++)ie.sectionIndex.push(0);k.push(ie)}}else if(N){const K=N(O.text,O.sectionIndex,U);for(const ae of K){const ie=new Hh;ie.text=ae[0],ie.sectionIndex=ae[1],ie.sections=O.sections,k.push(ie)}}else k=function(K,ae){const ie=[],se=K.text;let ve=0;for(const le of ae)ie.push(K.substring(ve,le)),ve=le;return ve<se.length&&ie.push(K.substring(ve,se.length)),ie}(O,U);const $=[],W={positionedLines:$,text:O.toString(),top:_[1],bottom:_[1],left:_[0],right:_[0],writingMode:w,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(K,ae,ie,se,ve,le,xe,Me,Se,Ce,Ie,Fe){let ze=0,Ne=0,it=0;const nt=Me==="right"?1:Me==="left"?0:.5;let Bt=!1;for(const Ht of ve){const hr=Ht.getSections();for(const Mr of hr){if(Mr.image)continue;const gr=ae[Mr.fontStack];if(gr&&(Bt=gr.ascender!==void 0&&gr.descender!==void 0,!Bt))break}if(!Bt)break}let ft=0;for(const Ht of ve){Ht.trim();const hr=Ht.getMaxScale(),Mr=(hr-1)*Oi,gr={positionedGlyphs:[],lineOffset:0};K.positionedLines[ft]=gr;const Lr=gr.positionedGlyphs;let Sr=0;if(!Ht.length()){Ne+=le,++ft;continue}let Fr=0,Wr=0;for(let mr=0;mr<Ht.length();mr++){const Ur=Ht.getSection(mr),En=Ht.getSectionIndex(mr),kn=Ht.getCodePoint(mr);let Gn=Ur.scale,Wn=null,fn=null,gi=null,ts=Oi,ii=0;Se===Ps.vertical&&((Tt=kn)===12312||Tt===12313||Tt===12316||Tt===12540||Tt===12448)&&(Se=Ps.horizontal);const ui=!(Se===Ps.horizontal||!Ie&&!_h(kn)||Ie&&(k_[kn]||xf(kn)));if(Ur.image){const ji=se.get(Ur.image.toString());if(!ji)continue;gi=Ur.image,K.iconsInText=K.iconsInText||!0,fn=ji.paddedRect;const Ii=ji.displaySize;Gn=Gn*Oi/Fe,Wn={width:Ii[0],height:Ii[1],left:0,top:-3,advance:ui?Ii[1]:Ii[0],localGlyph:!1},ii=Bt?-Wn.height*Gn:hr*Oi-17-Ii[1]*Gn,ts=Wn.advance;const ao=(ui?Ii[0]:Ii[1])*Gn-Oi*hr;ao>0&&ao>Sr&&(Sr=ao)}else{const ji=ie[Ur.fontStack];if(!ji)continue;ji[kn]&&(fn=ji[kn]);const Ii=ae[Ur.fontStack];if(!Ii)continue;const ao=Ii.glyphs[kn];if(!ao)continue;if(Wn=ao.metrics,ts=kn!==8203?Oi:0,Bt){const ec=Ii.ascender!==void 0?Math.abs(Ii.ascender):0,zo=Ii.descender!==void 0?Math.abs(Ii.descender):0,na=(ec+zo)*Gn;Fr<na&&(Fr=na,Wr=(ec-zo)/2*Gn),ii=-ec*Gn}else ii=(hr-Gn)*Oi-17}ui?(K.verticalizable=!0,Lr.push({glyph:kn,image:gi,x:ze,y:Ne+ii,vertical:ui,scale:Gn,localGlyph:Wn.localGlyph,fontStack:Ur.fontStack,sectionIndex:En,metrics:Wn,rect:fn}),ze+=ts*Gn+Ce):(Lr.push({glyph:kn,image:gi,x:ze,y:Ne+ii,vertical:ui,scale:Gn,localGlyph:Wn.localGlyph,fontStack:Ur.fontStack,sectionIndex:En,metrics:Wn,rect:fn}),ze+=Wn.advance*Gn+Ce)}Lr.length!==0&&(it=Math.max(ze-Ce,it),Bt?bw(Lr,nt,Sr,Wr,le*hr/2):bw(Lr,nt,Sr,0,le/2)),ze=0;const yn=le*hr+Sr;gr.lineOffset=Math.max(Sr,Mr),Ne+=yn,++ft}var Tt;const at=Ne,{horizontalAlign:tr,verticalAlign:Ot}=Xv(xe);(function(Ht,hr,Mr,gr,Lr,Sr){const Fr=(hr-Mr)*Lr,Wr=-Sr*gr;for(const yn of Ht)for(const mr of yn.positionedGlyphs)mr.x+=Fr,mr.y+=Wr})(K.positionedLines,nt,tr,Ot,it,at),K.top+=-Ot*at,K.bottom=K.top+at,K.left+=-tr*it,K.right=K.left+it,K.hasBaseline=Bt}(W,e,r,a,k,f,y,b,w,S,A,E),!function(K){for(const ae of K)if(ae.positionedGlyphs.length!==0)return!1;return!0}($))return W}const k_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},sP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function gw(o,e,r,a,u,l){if(e.image){const f=a.get(e.image.toString());return f?f.displaySize[0]*e.scale*Oi/l+u:0}{const f=r[e.fontStack],y=f&&f.glyphs[o];return y?y.metrics.advance*e.scale+u:0}}function yw(o,e,r,a){const u=Math.pow(o-e,2);return a?o<e?u/2:2*u:u+Math.abs(r)*r}function oP(o,e,r){let a=0;return o===10&&(a-=1e4),r&&(a+=150),o!==40&&o!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function vw(o,e,r,a,u,l){let f=null,y=yw(e,r,u,l);for(const b of a){const S=yw(e-b.x,r,u,l)+b.badness;S<=y&&(f=b,y=S)}return{index:o,x:e,priorBreak:f,badness:y}}function xw(o){return o?xw(o.priorBreak).concat(o.index):[]}function Xv(o){let e=.5,r=.5;switch(o){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function bw(o,e,r,a,u){if(!(e||r||a||u))return;const l=o.length-1,f=o[l],y=(f.x+f.metrics.advance*f.scale)*e;for(let b=0;b<=l;b++)o[b].x-=y,o[b].y+=r+a+u}function aP(o,e,r,a){const{horizontalAlign:u,verticalAlign:l}=Xv(a),f=r[0]-o.displaySize[0]*u,y=r[1]-o.displaySize[1]*l;return{imagePrimary:o,imageSecondary:e,top:y,bottom:y+o.displaySize[1],left:f,right:f+o.displaySize[0]}}function ww(o,e,r,a,u,l){const f=o.imagePrimary;let y;if(f.content){const O=f.content,k=f.pixelRatio||1;y=[O[0]/k,O[1]/k,f.displaySize[0]-O[2]/k,f.displaySize[1]-O[3]/k]}const b=e.left*l,S=e.right*l;let _,w,A,T;r==="width"||r==="both"?(T=u[0]+b-a[3],w=u[0]+S+a[1]):(T=u[0]+(b+S-f.displaySize[0])/2,w=T+f.displaySize[0]);const E=e.top*l,C=e.bottom*l;return r==="height"||r==="both"?(_=u[1]+E-a[0],A=u[1]+C+a[2]):(_=u[1]+(E+C-f.displaySize[1])/2,A=_+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:_,right:w,bottom:A,left:T,collisionPadding:y}}class ll extends Ae{constructor(e,r,a,u,l){super(e,r),this.angle=u,this.z=a,l!==void 0&&(this.segment=l)}clone(){return new ll(this.x,this.y,this.z,this.angle,this.segment)}}function Tw(o,e,r,a,u){if(e.segment===void 0)return!0;let l=e,f=e.segment+1,y=0;for(;y>-r/2;){if(f--,f<0)return!1;y-=o[f].dist(l),l=o[f]}y+=o[f].dist(o[f+1]),f++;const b=[];let S=0;for(;y<r/2;){const _=o[f],w=o[f+1];if(!w)return!1;let A=o[f-1].angleTo(_)-_.angleTo(w);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:A}),S+=A;y-b[0].distance>a;)S-=b.shift().angleDelta;if(S>u)return!1;f++,y+=_.dist(w)}return!0}function Sw(o){let e=0;for(let r=0;r<o.length-1;r++)e+=o[r].dist(o[r+1]);return e}function Ew(o,e,r){return o?.6*e*r:0}function Aw(o,e){return Math.max(o?o.right-o.left:0,e?e.right-e.left:0)}function lP(o,e,r,a,u,l){const f=Ew(r,u,l),y=Aw(r,a)*l;let b=0;const S=Sw(o)/2;for(let _=0;_<o.length-1;_++){const w=o[_],A=o[_+1],T=w.dist(A);if(b+T>S){const E=(S-b)/T,C=or(w.x,A.x,E),O=or(w.y,A.y,E),k=new ll(C,O,0,A.angleTo(w),_);return!f||Tw(o,k,y,f,e)?k:void 0}b+=T}}function cP(o,e,r,a,u,l,f,y,b){const S=Ew(a,l,f),_=Aw(a,u),w=_*f,A=o[0].x===0||o[0].x===b||o[0].y===0||o[0].y===b;return e-w<e/4&&(e=w+e/4),Mw(o,A?e/2*y%e:(_/2+2*l)*f*y%e,e,S,r,w,A,!1,b)}function Mw(o,e,r,a,u,l,f,y,b){const S=l/2,_=Sw(o);let w=0,A=e-r,T=[];for(let E=0;E<o.length-1;E++){const C=o[E],O=o[E+1],k=C.dist(O),U=O.angleTo(C);for(;A+r<w+k;){A+=r;const V=(A-w)/k,N=or(C.x,O.x,V),$=or(C.y,O.y,V);if(N>=0&&N<b&&$>=0&&$<b&&A-S>=0&&A+S<=_){const W=new ll(N,$,0,U,E);a&&!Tw(o,W,l,a,u)||T.push(W)}}w+=k}return y||T.length||f||(T=Mw(o,w/2,r,a,u,l,f,!0,b)),T}function Iw(o,e,r,a,u){const l=[];for(let f=0;f<o.length;f++){const y=o[f];let b;for(let S=0;S<y.length-1;S++){let _=y[S],w=y[S+1];_.x<e&&w.x<e||(_.x<e?_=new Ae(e,_.y+(e-_.x)/(w.x-_.x)*(w.y-_.y))._round():w.x<e&&(w=new Ae(e,_.y+(e-_.x)/(w.x-_.x)*(w.y-_.y))._round()),_.y<r&&w.y<r||(_.y<r?_=new Ae(_.x+(r-_.y)/(w.y-_.y)*(w.x-_.x),r)._round():w.y<r&&(w=new Ae(_.x+(r-_.y)/(w.y-_.y)*(w.x-_.x),r)._round()),_.x>=a&&w.x>=a||(_.x>=a?_=new Ae(a,_.y+(a-_.x)/(w.x-_.x)*(w.y-_.y))._round():w.x>=a&&(w=new Ae(a,_.y+(a-_.x)/(w.x-_.x)*(w.y-_.y))._round()),_.y>=u&&w.y>=u||(_.y>=u?_=new Ae(_.x+(u-_.y)/(w.y-_.y)*(w.x-_.x),u)._round():w.y>=u&&(w=new Ae(_.x+(u-_.y)/(w.y-_.y)*(w.x-_.x),u)._round()),b&&_.equals(b[b.length-1])||(b=[_],l.push(b)),b.push(w)))))}}return l}function Cw(o){let e=0,r=0;for(const f of o)e+=f.w*f.h,r=Math.max(r,f.w);o.sort((f,y)=>y.h-f.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let u=0,l=0;for(const f of o)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(f.w>b.w||f.h>b.h)){if(f.x=b.x,f.y=b.y,l=Math.max(l,f.y+f.h),u=Math.max(u,f.x+f.w),f.w===b.w&&f.h===b.h){const S=a.pop();y<a.length&&(a[y]=S)}else f.h===b.h?(b.x+=f.w,b.w-=f.w):f.w===b.w?(b.y+=f.h,b.h-=f.h):(a.push({x:b.x+f.w,y:b.y,w:b.w-f.w,h:f.h}),b.y+=f.h,b.h-=f.h);break}}return{w:u,h:l,fill:e/(u*l)||0}}Ft(ll,"Anchor");const Wh=1;class dp{static getImagePositionScale(e,r,a){if(r&&e&&e.options&&e.options.transform){const u=e.options.transform;return{x:u.a,y:u.d}}return{x:a,y:a}}constructor(e,r,a,u){this.paddedRect=e;const{pixelRatio:l,version:f,stretchX:y,stretchY:b,content:S,sdf:_,usvg:w}=r;this.pixelRatio=l,this.stretchX=y,this.stretchY=b,this.content=S,this.version=f,this.padding=a,this.sdf=_,this.scale=dp.getImagePositionScale(u,w,l)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Pw(o,e,r){const a=To.parse(o),u=function(l,f,y=[1,1]){return{x:0,y:0,w:(l.data?l.data.width:l.width*y[0])+2*f,h:(l.data?l.data.height:l.height*y[1])+2*f}}(e,r,[a.options.transform.a,a.options.transform.d]);return{bin:u,imagePosition:new dp(u,e,r,a),imageVariant:a}}class Rw{constructor(e,r,a){const u=new Map,l=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,u,Wh,f),this.addImages(r,l,2,f);const{w:y,h:b}=Cw(f),S=new Li({width:y||1,height:b||1});for(const[_,w]of e.entries()){const A=u.get(_).paddedRect;Li.copy(w.data,S,{x:0,y:0},{x:A.x+Wh,y:A.y+Wh},w.data,a,w.sdf)}for(const[_,w]of r.entries()){const A=l.get(_),T=A.paddedRect;let E=A.padding;const C=T.x+E,O=T.y+E,k=w.data.width,U=w.data.height;E=E>1?E-1:E,Li.copy(w.data,S,{x:0,y:0},{x:C,y:O},w.data,a),Li.copy(w.data,S,{x:0,y:U-E},{x:C,y:O-E},{width:k,height:E},a),Li.copy(w.data,S,{x:0,y:0},{x:C,y:O+U},{width:k,height:E},a),Li.copy(w.data,S,{x:k-E,y:0},{x:C-E,y:O},{width:E,height:U},a),Li.copy(w.data,S,{x:0,y:0},{x:C+k,y:O},{width:E,height:U},a),Li.copy(w.data,S,{x:k-E,y:U-E},{x:C-E,y:O-E},{width:E,height:E},a),Li.copy(w.data,S,{x:0,y:U-E},{x:C+k,y:O-E},{width:E,height:E},a),Li.copy(w.data,S,{x:0,y:0},{x:C+k,y:O+U},{width:E,height:E},a),Li.copy(w.data,S,{x:k-E,y:0},{x:C-E,y:O+U},{width:E,height:E},a)}this.lut=a,this.image=S,this.iconPositions=u,this.patternPositions=l}addImages(e,r,a,u){for(const[l,f]of e.entries()){const{bin:y,imagePosition:b,imageVariant:S}=Pw(l,f,a);r.set(l,b),u.push(y),f.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const u of e.getUpdatedImages(a)){for(const l of this.iconPositions.keys()){const f=To.parse(l);if(bs.isEqual(f.id,u)){const y=e.getImage(u,a);this.patchUpdatedImage(this.iconPositions.get(l),y,r)}}for(const l of this.patternPositions.keys()){const f=To.parse(l);if(bs.isEqual(f.id,u)){const y=e.getImage(u,a);this.patchUpdatedImage(this.patternPositions.get(l),y,r)}}}}patchUpdatedImage(e,r,a){if(!e||!r||e.version===r.version)return;e.version=r.version;const[u,l]=e.tl,f=e.sdf;if(this.lut||f){const y={width:r.data.width,height:r.data.height},b=new Li(y);Li.copy(r.data,b,{x:0,y:0},{x:0,y:0},y,this.lut,f),a.update(b,{position:{x:u,y:l}})}else a.update(r.data,{position:{x:u,y:l}})}}Ft(dp,"ImagePosition"),Ft(Rw,"ImageAtlas");const F_=1e20;function Dw(o,e,r,a,u,l,f,y,b){for(let S=e;S<e+a;S++)zw(o,r*l+S,l,u,f,y,b);for(let S=r;S<r+u;S++)zw(o,S*l+e,1,a,f,y,b)}function zw(o,e,r,a,u,l,f){l[0]=0,f[0]=-1e20,f[1]=F_,u[0]=o[e];for(let y=1,b=0,S=0;y<a;y++){u[y]=o[e+y*r];const _=y*y;do{const w=l[b];S=(u[y]-u[w]+_-w*w)/(y-w)/2}while(S<=f[b]&&--b>-1);b++,l[b]=y,f[b]=S,f[b+1]=F_}for(let y=0,b=0;y<a;y++){for(;f[b+1]<y;)b++;const S=l[b],_=y-S;o[e+y*r]=u[S]+_*_}}const Qo=2,Kv={none:0,ideographs:1,all:2};class Zh{constructor(e,r,a){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,r){this.urls[r]=e}getGlyphs(e,r,a){const u=[],l=this.urls[r]||Y.GLYPHS_URL;for(const f in e)for(const y of e[f])u.push({stack:f,id:y});_n(u,({stack:f,id:y},b)=>{let S=this.entries[f];S||(S=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let _=S.glyphs[y];if(_!==void 0)return void b(null,{stack:f,id:y,glyph:_});if(_=this._tinySDF(S,f,y),_)return S.glyphs[y]=_,void b(null,{stack:f,id:y,glyph:_});const w=Math.floor(y/256);if(256*w>65535)return Pr("glyphs > 65535 not supported"),void b(null,{stack:f,id:y,glyph:_});if(S.ranges[w])return void b(null,{stack:f,id:y,glyph:_});let A=S.requests[w];A||(A=S.requests[w]=[],Zh.loadGlyphRange(f,w,l,this.requestManager,(T,E)=>{if(E){S.ascender=E.ascender,S.descender=E.descender;for(const C in E.glyphs)this._doesCharSupportLocalGlyph(+C)||(S.glyphs[+C]=E.glyphs[+C]);S.ranges[w]=!0}for(const C of A)C(T,E);delete S.requests[w]})),A.push((T,E)=>{T?b(T):E&&b(null,{stack:f,id:y,glyph:E.glyphs[y]||null})})},(f,y)=>{if(f)a(f);else if(y){const b={};for(const{stack:S,id:_,glyph:w}of y)b[S]===void 0&&(b[S]={}),b[S].glyphs===void 0&&(b[S].glyphs={}),b[S].glyphs[_]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},b[S].ascender=this.entries[S].ascender,b[S].descender=this.entries[S].descender;a(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Kv.none&&(this.localGlyphMode===Kv.all?!!this.localFontFamily:!!this.localFontFamily&&(Qt["CJK Unified Ideographs"](e)||Qt["Hangul Syllables"](e)||Qt.Hiragana(e)||Qt.Katakana(e)||Qt["CJK Symbols and Punctuation"](e)||Qt["CJK Unified Ideographs Extension A"](e)||Qt["CJK Unified Ideographs Extension B"](e)||Qt.Osage(e)))}_tinySDF(e,r,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let l=e.tinySDF;if(!l){let C="400";/bold/i.test(r)?C="900":/medium/i.test(r)?C="500":/light/i.test(r)&&(C="200"),l=e.tinySDF=new Zh.TinySDF({fontFamily:u,fontWeight:C,fontSize:24*Qo,buffer:3*Qo,radius:8*Qo}),l.fontWeight=C}if(this.localGlyphs[l.fontWeight][a])return this.localGlyphs[l.fontWeight][a];const f=String.fromCodePoint(a),{data:y,width:b,height:S,glyphWidth:_,glyphHeight:w,glyphLeft:A,glyphTop:T,glyphAdvance:E}=l.draw(f);return this.localGlyphs[l.fontWeight][a]={id:a,bitmap:new Wl({width:b,height:S},y),metrics:{width:_/Qo,height:w/Qo,left:A/Qo,top:T/Qo-27,advance:E/Qo,localGlyph:!0}}}}Zh.loadGlyphRange=function(o,e,r,a,u){const l=256*e,f=l+255,y=a.transformRequest(a.normalizeGlyphsURL(r).replace("{fontstack}",o).replace("{range}",`${l}-${f}`),pi.Glyphs);ja(y,(b,S)=>{if(b)u(b);else if(S){const _={},w=function(A){return new O_(A).readFields(tP,{})}(S);for(const A of w.glyphs)_[A.id]=A;u(null,{glyphs:_,ascender:w.ascender,descender:w.descender})}})},Zh.TinySDF=class{constructor({fontSize:o=24,buffer:e=3,radius:r=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:l="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=r;const y=this.size=o+4*e,b=this._createCanvas(y),S=this.ctx=b.getContext("2d",{willReadFrequently:!0});S.font=`${f} ${l} ${o}px ${u}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(o){const e=document.createElement("canvas");return e.width=e.height=o,e}draw(o){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:l}=this.ctx.measureText(o),f=Math.ceil(r),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-u))),b=Math.min(this.size-this.buffer,f+Math.ceil(a)),S=y+2*this.buffer,_=b+2*this.buffer,w=Math.max(S*_,0),A=new Uint8ClampedArray(w),T={data:A,width:S,height:_,glyphWidth:y,glyphHeight:b,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return T;const{ctx:E,buffer:C,gridInner:O,gridOuter:k}=this;E.clearRect(C,C,y,b),E.fillText(o,C,C+f);const U=E.getImageData(C,C,y,b);k.fill(F_,0,w),O.fill(0,0,w);for(let V=0;V<b;V++)for(let N=0;N<y;N++){const $=U.data[4*(V*y+N)+3]/255;if($===0)continue;const W=(V+C)*S+N+C;if($===1)k[W]=0,O[W]=F_;else{const K=.5-$;k[W]=K>0?K*K:0,O[W]=K<0?K*K:0}}Dw(k,0,0,S,_,S,this.f,this.v,this.z),Dw(O,C,C,y,b,S,this.f,this.v,this.z);for(let V=0;V<w;V++){const N=Math.sqrt(k[V])-Math.sqrt(O[V]);A[V]=Math.round(255-255*(N/this.radius+this.cutoff))}return T}};const ou=Wh;function Lw(o,e){return o+e[1]-e[0]}function Ow(o,e,r,a,u=1){const l=[],f=o.imagePrimary,y=f.pixelRatio,b=f.paddedRect.w-2*ou,S=f.paddedRect.h-2*ou,_=(o.right-o.left)*u,w=(o.bottom-o.top)*u,A=f.stretchX||[[0,b]],T=f.stretchY||[[0,S]],E=A.reduce(Lw,0),C=T.reduce(Lw,0),O=b-E,k=S-C;let U=0,V=E,N=0,$=C,W=0,K=O,ae=0,ie=k;if(f.content&&a){const ve=f.content;U=B_(A,0,ve[0]),N=B_(T,0,ve[1]),V=B_(A,ve[0],ve[2]),$=B_(T,ve[1],ve[3]),W=ve[0]-U,ae=ve[1]-N,K=ve[2]-ve[0]-V,ie=ve[3]-ve[1]-$}const se=(ve,le,xe,Me)=>{const Se=N_(ve.stretch-U,V,_,o.left*u),Ce=V_(ve.fixed-W,K,ve.stretch,E),Ie=N_(le.stretch-N,$,w,o.top*u),Fe=V_(le.fixed-ae,ie,le.stretch,C),ze=N_(xe.stretch-U,V,_,o.left*u),Ne=V_(xe.fixed-W,K,xe.stretch,E),it=N_(Me.stretch-N,$,w,o.top*u),nt=V_(Me.fixed-ae,ie,Me.stretch,C),Bt=new Ae(Se,Ie),ft=new Ae(ze,Ie),Tt=new Ae(ze,it),at=new Ae(Se,it),tr=new Ae(Ce/y,Fe/y),Ot=new Ae(Ne/y,nt/y),Ht=e*Math.PI/180;if(Ht){const Fr=Math.sin(Ht),Wr=Math.cos(Ht),yn=[Wr,-Fr,Fr,Wr];Bt._matMult(yn),ft._matMult(yn),at._matMult(yn),Tt._matMult(yn)}const hr=ve.stretch+ve.fixed,Mr=xe.stretch+xe.fixed,gr=le.stretch+le.fixed,Lr=Me.stretch+Me.fixed,Sr=o.imageSecondary;return{tl:Bt,tr:ft,bl:at,br:Tt,texPrimary:{x:f.paddedRect.x+ou+hr,y:f.paddedRect.y+ou+gr,w:Mr-hr,h:Lr-gr},texSecondary:Sr?{x:Sr.paddedRect.x+ou+hr,y:Sr.paddedRect.y+ou+gr,w:Mr-hr,h:Lr-gr}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:tr,pixelOffsetBR:Ot,minFontScaleX:K/y/_,minFontScaleY:ie/y/w,isSDF:r}};if(a&&(f.stretchX||f.stretchY)){const ve=kw(A,O,E),le=kw(T,k,C);for(let xe=0;xe<ve.length-1;xe++){const Me=ve[xe],Se=ve[xe+1];for(let Ce=0;Ce<le.length-1;Ce++)l.push(se(Me,le[Ce],Se,le[Ce+1]))}}else l.push(se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return l}function B_(o,e,r){let a=0;for(const u of o)a+=Math.max(e,Math.min(r,u[1]))-Math.max(e,Math.min(r,u[0]));return a}function kw(o,e,r){const a=[{fixed:-1,stretch:0}];for(const[u,l]of o){const f=a[a.length-1];a.push({fixed:u-f.stretch,stretch:f.stretch}),a.push({fixed:u-f.stretch,stretch:f.stretch+(l-u)})}return a.push({fixed:e+ou,stretch:r}),a}function N_(o,e,r,a){return o/e*r+a}function V_(o,e,r,a){return o-e*r/a}function uP(o,e,r,a){const u=e+o.positionedLines[a].lineOffset;return a===0?r+u/2:r+(u+(e+o.positionedLines[a-1].lineOffset))/2}function hP(o,e=1,r=!1){let a=1/0,u=1/0,l=-1/0,f=-1/0;const y=o[0];for(let T=0;T<y.length;T++){const E=y[T];(!T||E.x<a)&&(a=E.x),(!T||E.y<u)&&(u=E.y),(!T||E.x>l)&&(l=E.x),(!T||E.y>f)&&(f=E.y)}const b=Math.min(l-a,f-u);let S=b/2;const _=new $o([],dP);if(b===0)return new Ae(a,u);for(let T=a;T<l;T+=b)for(let E=u;E<f;E+=b)_.push(new Xh(T+S,E+S,S,o));let w=function(T){let E=0,C=0,O=0;const k=T[0];for(let U=0,V=k.length,N=V-1;U<V;N=U++){const $=k[U],W=k[N],K=$.x*W.y-W.x*$.y;C+=($.x+W.x)*K,O+=($.y+W.y)*K,E+=3*K}return new Xh(C/E,O/E,0,T)}(o),A=_.length;for(;_.length;){const T=_.pop();(T.d>w.d||!w.d)&&(w=T,r&&console.log("found best %d after %d probes",Math.round(1e4*T.d)/1e4,A)),T.max-w.d<=e||(S=T.h/2,_.push(new Xh(T.p.x-S,T.p.y-S,S,o)),_.push(new Xh(T.p.x+S,T.p.y-S,S,o)),_.push(new Xh(T.p.x-S,T.p.y+S,S,o)),_.push(new Xh(T.p.x+S,T.p.y+S,S,o)),A+=4)}return r&&(console.log(`num probes: ${A}`),console.log(`best distance: ${w.d}`)),w.p}function dP(o,e){return e.max-o.max}class Xh{constructor(e,r,a,u){this.p=new Ae(e,r),this.h=a,this.d=function(l,f){let y=!1,b=1/0;for(let S=0;S<f.length;S++){const _=f[S];for(let w=0,A=_.length,T=A-1;w<A;T=w++){const E=_[w],C=_[T];E.y>l.y!=C.y>l.y&&l.x<(C.x-E.x)*(l.y-E.y)/(C.y-E.y)+E.x&&(y=!y),b=Math.min(b,fe(l,E,C))}}return(y?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const Yv=Number.POSITIVE_INFINITY,fP=Math.sqrt(2);function Fw(o,[e,r]){let a=0,u=0;if(r===Yv){e<0&&(e=0);const l=e/fP;switch(o){case"top-right":case"top-left":u=l-7;break;case"bottom-right":case"bottom-left":u=7-l;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(o){case"top-right":case"bottom-right":a=-l;break;case"top-left":case"bottom-left":a=l;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),r=Math.abs(r),o){case"top-right":case"top-left":case"top":u=r-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-r}switch(o){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function Bw(o,e,r,a,u,l,f,y){if(!o)return;const b=fw(e,r,a,u,l);return o.scaleSelf(b*y*f)}function Nw(o,e,r,a,u,l,f,y){return{iconPrimary:Bw(o.getPrimary(),e,r,a,u,l,f,y),iconSecondary:Bw(o.getSecondary(),e,r,a,u,l,f,y)}}function Vw(o,e,r,a){if(!o)return;const u=e.get(r.toString());if(o.imagePrimary=u,a){const l=e.get(a.toString());o.imageSecondary=l}}function pP(o,e){for(const r in o.horizontal)Uw(o.horizontal[r],e);Uw(o.vertical,e)}function Uw(o,e){if(o){for(const r of o.positionedLines)for(const a of r.positionedGlyphs)if(a.image!==null){const u=a.image.toString();a.rect=e.get(u).paddedRect}}}function Jv(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mP(o,e,r,a,u,l,f,y,b){const S=Qv(l.horizontal)||l.vertical,_=r.get("icon-text-fit-padding").evaluate(a,{},u);let w,A=e;return e&&b!=="none"&&(o.allowVerticalPlacement&&l.vertical&&(w=ww(e,l.vertical,b,_,y,f)),S&&(A=ww(e,S,b,_,y,f))),{defaultShapedIcon:A,verticallyShapedIcon:w}}function _P(o,e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O,k,U,V){let N=f.textMaxSize.evaluate(e,{},A);N===void 0?N=y*f.textScaleFactor:N*=f.textScaleFactor;const $=o.layers[0].layout,W=Qv(r.horizontal)||r.vertical,K=T.name==="globe",ae=Oi,ie=o.tilePixelRatio*N/ae,se=(Ce=o.overscaling,o.zoom>18&&Ce>2&&(Ce>>=1),Math.max(Ct/(512*Ce),1)*$.get("symbol-spacing")),ve=$.get("text-padding")*o.tilePixelRatio,le=$.get("icon-padding")*o.tilePixelRatio,xe=Rt($.get("text-max-angle")),Me=$.get("icon-rotation-alignment")==="map"&&V!=="point",Se=se/2;var Ce;o.hasAnyIconTextFit===!1&&O!=="none"&&(o.hasAnyIconTextFit=!0);const Ie=e.properties?+e.properties[nu]:null,Fe=Ie&&o.elevationFeatureIdToIndex?o.elevationFeatureIdToIndex.get(Ie):65535,ze=(Ne,it,nt)=>{if(it.x<0||it.x>=Ct||it.y<0||it.y>=Ct)return;let Bt=null;if(K){const{x:ft,y:Tt,z:at}=T.projectTilePoint(it.x,it.y,nt);Bt={anchor:new ll(ft,Tt,at,0,void 0),up:T.upVector(nt,it.x,it.y)}}(function(ft,Tt,at,tr,Ot,Ht,hr,Mr,gr,Lr,Sr,Fr,Wr,yn,mr,Ur,En,kn,Gn,Wn,fn,gi,ts,ii,ui,ji,Ii,ao,ec){const zo=ft.addToLineVertexArray(Tt,tr);let na,tc,rc,hu,TT,ST,ET,AT=0,MT=0,IT=0,CT=0,D0=-1,z0=-1;const Da={};let PT=Js("");const du=at?at.anchor:Tt,L0=ao!=="none";let O0=0,k0=0;if(gr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[O0,k0]=gr.layout.get("text-offset").evaluate(fn,{},ui).map(lo=>lo*Oi):(O0=gr.layout.get("text-radial-offset").evaluate(fn,{},ui)*Oi,k0=Yv),ft.allowVerticalPlacement&&Ot.vertical){const lo=Ot.vertical;if(mr)ST=e0(lo),Mr&&(ET=e0(Mr));else{const Rs=gr.layout.get("text-rotate").evaluate(fn,{},ui)+90;rc=U_(Lr,du,Tt,Sr,Fr,Wr,lo,yn,Rs,Ur),Mr&&(hu=U_(Lr,du,Tt,Sr,Fr,Wr,Mr,kn,Rs))}}if(Ht){const lo=ft.iconSizeData,Rs=gr.layout.get("icon-rotate").evaluate(fn,{},ui),Rp=Ow(Ht,Rs,ts,L0,gi.iconScaleFactor),B0=Mr?Ow(Mr,Rs,ts,L0,gi.iconScaleFactor):void 0;tc=U_(Lr,du,Tt,Sr,Fr,Wr,Ht,kn,Rs,null),AT=4*Rp.length;let fu=null;lo.kind==="source"?(fu=[Jo*gr.layout.get("icon-size").evaluate(fn,{},ui)*gi.iconScaleFactor],fu[0]>Kl&&Pr(`${ft.layerIds[0]}: Value for "icon-size" is >= ${fp}. Reduce your "icon-size".`)):lo.kind==="composite"&&(fu=[Jo*gi.compositeIconSizes[0].evaluate(fn,{},ui)*gi.iconScaleFactor,Jo*gi.compositeIconSizes[1].evaluate(fn,{},ui)*gi.iconScaleFactor],(fu[0]>Kl||fu[1]>Kl)&&Pr(`${ft.layerIds[0]}: Value for "icon-size" is >= ${fp}. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,Rp,fu,Wn,Gn,fn,!1,at,Tt,zo.lineStartIndex,zo.lineLength,-1,ii,ui,ji,Ii),D0=ft.icon.placedSymbolArray.length-1,B0&&(MT=4*B0.length,ft.addSymbols(ft.icon,B0,fu,Wn,Gn,fn,Ps.vertical,at,Tt,zo.lineStartIndex,zo.lineLength,-1,ii,ui,ji,Ii),z0=ft.icon.placedSymbolArray.length-1)}for(const lo in Ot.horizontal){const Rs=Ot.horizontal[lo];na||(PT=Js(Rs.text),mr?TT=e0(Rs):na=U_(Lr,du,Tt,Sr,Fr,Wr,Rs,yn,gr.layout.get("text-rotate").evaluate(fn,{},ui),Ur));const Rp=Rs.positionedLines.length===1;if(IT+=jw(ft,at,Tt,Rs,hr,gr,mr,fn,Ur,zo,Ot.vertical?Ps.horizontal:Ps.horizontalOnly,Rp?Object.keys(Ot.horizontal):[lo],Da,D0,gi,ii,ui,ji),Rp)break}Ot.vertical&&(CT+=jw(ft,at,Tt,Ot.vertical,hr,gr,mr,fn,Ur,zo,Ps.vertical,["vertical"],Da,z0,gi,ii,ui,ji));let nc=-1;const F0=(lo,Rs)=>lo?Math.max(lo,Rs):Rs;nc=F0(TT,nc),nc=F0(ST,nc),nc=F0(ET,nc);const ZR=nc>-1?1:0;ft.glyphOffsetArray.length>=65535&&Pr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),fn.sortKey!==void 0&&ft.addToSortKeyRanges(ft.symbolInstances.length,fn.sortKey),ft.symbolInstances.emplaceBack(Tt.x,Tt.y,du.x,du.y,du.z,Da.right>=0?Da.right:-1,Da.center>=0?Da.center:-1,Da.left>=0?Da.left:-1,Da.vertical>=0?Da.vertical:-1,D0,z0,PT,na!==void 0?na:ft.collisionBoxArray.length,na!==void 0?na+1:ft.collisionBoxArray.length,rc!==void 0?rc:ft.collisionBoxArray.length,rc!==void 0?rc+1:ft.collisionBoxArray.length,tc!==void 0?tc:ft.collisionBoxArray.length,tc!==void 0?tc+1:ft.collisionBoxArray.length,hu||ft.collisionBoxArray.length,hu?hu+1:ft.collisionBoxArray.length,Sr,IT,CT,AT,MT,ZR,0,O0,k0,nc,0,L0?1:0,ec)})(o,it,Bt,Ne,r,a,l,u,o.layers[0],o.collisionBoxArray,e.index,e.sourceLayerIndex,o.index,ve,U,S,0,le,Me,k,e,f,_,w,A,E,C,O,Fe)};if(V==="line")for(const Ne of Iw(e.geometry,0,0,Ct,Ct)){const it=cP(Ne,se,xe,r.vertical||W,a,ae,ie,o.overscaling,Ct);for(const nt of it)W&&gP(o,W.text,Se,nt)||ze(Ne,nt,A)}else if(V==="line-center"){for(const Ne of e.geometry)if(Ne.length>1){const it=lP(Ne,xe,r.vertical||W,a,ae,ie);it&&ze(Ne,it,A)}}else if(e.type==="Polygon")for(const Ne of M_(e.geometry,0)){const it=hP(Ne,16);ze(Ne[0],new ll(it.x,it.y,0,0,void 0),A)}else if(e.type==="LineString")for(const Ne of e.geometry)ze(Ne,new ll(Ne[0].x,Ne[0].y,0,0,void 0),A);else if(e.type==="Point")for(const Ne of e.geometry)for(const it of Ne)ze([it],new ll(it.x,it.y,0,0,void 0),A)}const fp=255,Kl=fp*Jo;function jw(o,e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O,k){const U=function($,W,K,ae,ie,se,ve,le){const xe=[];if(W.positionedLines.length===0)return xe;const Me=ae.layout.get("text-rotate").evaluate(se,{})*Math.PI/180,Se=function(Ne){const it=Ne[0],nt=Ne[1],Bt=it*nt;return Bt>0?[it,-nt]:Bt<0?[-it,nt]:it===0?[nt,it]:[nt,-it]}(K);let Ce=Math.abs(W.top-W.bottom);for(const Ne of W.positionedLines)Ce-=Ne.lineOffset;const Ie=W.positionedLines.length,Fe=Ce/Ie;let ze=W.top-K[1];for(let Ne=0;Ne<Ie;++Ne){const it=W.positionedLines[Ne];ze=uP(W,Fe,ze,Ne);for(const nt of it.positionedGlyphs){if(!nt.rect)continue;const Bt=nt.rect||{};let ft=iP+1,Tt=!0,at=1,tr=0;if(nt.image){const fn=ve.get(nt.image.toString());if(!fn)continue;if(fn.sdf){Pr("SDF images are not supported in formatted text and will be ignored.");continue}Tt=!1,at=fn.pixelRatio,ft=Wh/at}const Ot=(ie||le)&&nt.vertical,Ht=nt.metrics.advance*nt.scale/2,hr=nt.metrics,Mr=nt.rect;if(Mr===null)continue;le&&W.verticalizable&&(tr=nt.image?Ht-nt.metrics.width*nt.scale/2:0);const gr=ie?[nt.x+Ht,nt.y]:[0,0];let Lr=[0,0],Sr=[0,0],Fr=!1;ie||(Ot?(Sr=[nt.x+Ht+Se[0],nt.y+Se[1]-tr],Fr=!0):Lr=[nt.x+Ht+K[0],nt.y+K[1]-tr]);const Wr=Mr.w*nt.scale/(at*(nt.localGlyph?Qo:1)),yn=Mr.h*nt.scale/(at*(nt.localGlyph?Qo:1));let mr,Ur,En,kn;if(Ot){const fn=nt.y-ze,gi=new Ae(-Ht,Ht-fn),ts=-Math.PI/2,ii=new Ae(...Sr);mr=new Ae(-Ht+Lr[0],Lr[1]),mr._rotateAround(ts,gi)._add(ii),mr.x+=-fn+Ht,mr.y-=(hr.left-ft)*nt.scale;const ui=nt.image?hr.advance*nt.scale:Oi*nt.scale,ji=String.fromCodePoint(nt.glyph);J3(ji)?mr.x+=(1-ft)*nt.scale:Q3(ji)?mr.x+=ui-hr.height*nt.scale+(-ft-1)*nt.scale:mr.x+=nt.image||hr.width+2*ft===Mr.w&&hr.height+2*ft===Mr.h?(ui-yn)/2:(ui-(hr.height+2*ft)*nt.scale)/2,Ur=new Ae(mr.x,mr.y-Wr),En=new Ae(mr.x+yn,mr.y),kn=new Ae(mr.x+yn,mr.y-Wr)}else{const fn=(hr.left-ft)*nt.scale-Ht+Lr[0],gi=(-hr.top-ft)*nt.scale+Lr[1],ts=fn+Wr,ii=gi+yn;mr=new Ae(fn,gi),Ur=new Ae(ts,gi),En=new Ae(fn,ii),kn=new Ae(ts,ii)}if(Me){let fn;fn=ie?new Ae(0,0):Fr?new Ae(Se[0],Se[1]):new Ae(K[0],K[1]),mr._rotateAround(Me,fn),Ur._rotateAround(Me,fn),En._rotateAround(Me,fn),kn._rotateAround(Me,fn)}const Gn=new Ae(0,0),Wn=new Ae(0,0);xe.push({tl:mr,tr:Ur,bl:En,br:kn,texPrimary:Bt,texSecondary:void 0,writingMode:W.writingMode,glyphOffset:gr,sectionIndex:nt.sectionIndex,isSDF:Tt,pixelOffsetTL:Gn,pixelOffsetBR:Wn,minFontScaleX:0,minFontScaleY:0})}}return xe}(0,a,b,l,f,y,u,o.allowVerticalPlacement),V=o.textSizeData;let N=null;V.kind==="source"?(N=[Jo*l.layout.get("text-size").evaluate(y,{},O)*E.textScaleFactor],N[0]>Kl&&Pr(`${o.layerIds[0]}: Value for "text-size" is >= ${fp}. Reduce your "text-size".`)):V.kind==="composite"&&(N=[Jo*E.compositeTextSizes[0].evaluate(y,{},O)*E.textScaleFactor,Jo*E.compositeTextSizes[1].evaluate(y,{},O)*E.textScaleFactor],(N[0]>Kl||N[1]>Kl)&&Pr(`${o.layerIds[0]}: Value for "text-size" is >= ${fp}. Reduce your "text-size".`)),o.addSymbols(o.text,U,N,b,f,y,_,e,r,S.lineStartIndex,S.lineLength,T,C,O,k,!1);for(const $ of w)A[$]=o.text.placedSymbolArray.length-1;return 4*U.length}function Qv(o){for(const e in o)return o[e];return null}function U_(o,e,r,a,u,l,f,y,b,S){let _=f.top,w=f.bottom,A=f.left,T=f.right;const E=f.collisionPadding;if(E&&(A-=E[0],_-=E[1],T+=E[2],w+=E[3]),b){const C=new Ae(A,_),O=new Ae(T,_),k=new Ae(A,w),U=new Ae(T,w),V=Rt(b);let N=new Ae(0,0);S&&(N=new Ae(S[0],S[1])),C._rotateAround(V,N),O._rotateAround(V,N),k._rotateAround(V,N),U._rotateAround(V,N),A=Math.min(C.x,O.x,k.x,U.x),T=Math.max(C.x,O.x,k.x,U.x),_=Math.min(C.y,O.y,k.y,U.y),w=Math.max(C.y,O.y,k.y,U.y)}return o.emplaceBack(e.x,e.y,e.z,r.x,r.y,A,_,T,w,y,a,u,l),o.length-1}function e0(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const e=o.bottom-o.top;return e>0?Math.max(10,e):null}function gP(o,e,r,a){const u=o.compareText;if(e in u){const l=u[e];for(let f=l.length-1;f>=0;f--)if(a.dist(l[f])<r)return!0}else u[e]=[];return u[e].push(a),!1}function $w(o,e){const r=o.fovAboveCenter,a=o.elevation?o.elevation.getMinElevationBelowMSL()*e:0,u=(o._camera.position[2]*o.worldSize-a)/Math.cos(o._pitch),l=Math.sin(r)*u/Math.sin(Math.max(Math.PI/2-o._pitch-r,.01));let f=Math.sin(o._pitch)*l+u;const y=u*(1/o._horizonShift);if(!o.elevation||o.elevation.exaggeration()===0){let b=Math.max(o.zoom-17,0);o.isOrthographic&&(b/=10),f*=1+b}return Math.min(1.01*f,y)}function pp(o,e){if(!e.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:e};const r=Math.pow(2,-o.z),a=o.x*r,u=(o.x+1)*r,l=o.y*r,f=(o.y+1)*r,y=us(a),b=us(u),S=Mi(l),_=Mi(f),w=e.project(y,S),A=e.project(b,S),T=e.project(b,_),E=e.project(y,_);let C=Math.min(w.x,A.x,T.x,E.x),O=Math.min(w.y,A.y,T.y,E.y),k=Math.max(w.x,A.x,T.x,E.x),U=Math.max(w.y,A.y,T.y,E.y);const V=r/16;function N(W,K,ae,ie,se,ve){const le=(ae+se)/2,xe=(ie+ve)/2,Me=e.project(us(le),Mi(xe)),Se=Math.max(0,C-Me.x,O-Me.y,Me.x-k,Me.y-U);C=Math.min(C,Me.x),k=Math.max(k,Me.x),O=Math.min(O,Me.y),U=Math.max(U,Me.y),Se>V&&(N(W,Me,ae,ie,le,xe),N(Me,K,le,xe,se,ve))}N(w,A,a,l,u,l),N(A,T,u,l,u,f),N(T,E,u,f,a,f),N(E,w,a,f,a,l),C-=V,O-=V,k+=V,U+=V;const $=1/Math.max(k-C,U-O);return{scale:$,x:C*$,y:O*$,x2:k*$,y2:U*$,projection:e}}function Gw(o,{x:e,y:r},a=0){return new Ae(((e-a)*o.scale-o.x)*Ct,(r*o.scale-o.y)*Ct)}const yP=te.mat4.identity(new Float32Array(16));class Yl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,r){return{x:0,y:0,z:0}}unproject(e,r){return new Xr(0,0)}projectTilePoint(e,r,a){return{x:e,y:r,z:0}}locationPoint(e,r,a,u=!0){return e._coordinatePoint(e.locationCoordinate(r,a),u)}pixelsPerMeter(e,r){return Wi(1,e)*r}pixelSpaceConversion(e,r,a){return 1}farthestPixelDistance(e){return $w(e,e.pixelsPerMeter)}pointCoordinate(e,r,a,u){const l=e.horizonLineFromTop(!1),f=new Ae(r,Math.max(l,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,u))}pointCoordinate3D(e,r,a){const u=new Ae(r,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const l=this.pointCoordinate(e,u.x,u.y,0);return[l.x,l.y,l.z]}}isPointAboveHorizon(e,r){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,r.x,r.y);const a=e.horizonLineFromTop();return r.y<a}createInversionMatrix(e,r){return yP}createTileMatrix(e,r,a){let u,l,f;const y=a.canonical,b=te.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=pp(y,this);u=1,l=S.x+a.wrap*S.scale,f=S.y,te.mat4.scale(b,b,[u/S.scale,u/S.scale,e.pixelsPerMeter/r])}else u=r/e.zoomScale(y.z),l=(y.x+Math.pow(2,y.z)*a.wrap)*u,f=y.y*u;return te.mat4.translate(b,b,[l,f,0]),te.mat4.scale(b,b,[u/Ct,u/Ct,1]),b}upVector(e,r,a){return[0,0,1]}upVectorScale(e,r,a){return{metersToTile:1}}}class vP extends Yl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[r,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Rt(r));this.n=(u+Math.sin(Rt(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,r){const{n:a,c:u,r0:l}=this,f=Rt(e-this.center[0]),y=Rt(r),b=Math.sqrt(u-2*a*Math.sin(y))/a;return{x:b*Math.sin(f*a),y:b*Math.cos(f*a)-l,z:0}}unproject(e,r){const{n:a,c:u,r0:l}=this,f=l+r;let y=Math.atan2(e,Math.abs(f))*Math.sign(f);f*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(f));const b=Rt(this.center[0])*a;y=jr(y,-Math.PI-b,Math.PI-b);const S=Ye(jt(y/a)+this.center[0],-180,180),_=Math.asin(Ye((u-(e*e+f*f)*a*a)/(2*a),-1,1)),w=Ye(jt(_),-85.051129,Ji);return new Xr(S,w)}}const mp=1.340264,_p=-.081106,gp=893e-6,yp=.003796,j_=Math.sqrt(3)/2;class xP extends Yl{project(e,r){r=r/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(j_*Math.sin(r)),u=a*a,l=u*u*u;return{x:.5*(e*Math.cos(a)/(j_*(mp+3*_p*u+l*(7*gp+9*yp*u)))/Math.PI+.5),y:1-.5*(a*(mp+_p*u+l*(gp+yp*u))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=a*a,l=u*u*u;for(let _,w,A,T=0;T<12&&(w=a*(mp+_p*u+l*(gp+yp*u))-r,A=mp+3*_p*u+l*(7*gp+9*yp*u),_=w/A,a=Ye(a-_,-Math.PI/3,Math.PI/3),u=a*a,l=u*u*u,!(Math.abs(_)<1e-12));++T);const f=j_*e*(mp+3*_p*u+l*(7*gp+9*yp*u))/Math.cos(a),y=Math.asin(Math.sin(a)/j_),b=Ye(180*f/Math.PI,-180,180),S=Ye(180*y/Math.PI,-85.051129,Ji);return new Xr(b,S)}}class bP extends Yl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){return{x:.5+e/360,y:.5-r/360,z:0}}unproject(e,r){const a=360*(e-.5),u=Ye(360*(.5-r),-85.051129,Ji);return new Xr(a,u)}}const Kh=Math.PI/2;function $_(o){return Math.tan((Kh+o)/2)}class wP extends Yl{constructor(e){super(e),this.center=e.center||[0,30];const[r,a]=this.parallels=e.parallels||[30,30];let u=Rt(r),l=Rt(a);this.southernCenter=u+l<0,this.southernCenter&&(u=-u,l=-l);const f=Math.cos(u),y=$_(u);this.n=u===l?Math.sin(u):Math.log(f/Math.cos(l))/Math.log($_(l)/y),this.f=f*Math.pow($_(u),this.n)/this.n}project(e,r){r=Rt(r),this.southernCenter&&(r=-r),e=Rt(e-this.center[0]);const a=1e-6,{n:u,f:l}=this;l>0?r<-Kh+a&&(r=-Kh+a):r>Kh-a&&(r=Kh-a);const f=l/Math.pow($_(r),u);let y=f*Math.sin(u*e),b=l-f*Math.cos(u*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,r){e=(2*e-.5)*Math.PI,this.southernCenter&&(r=1-r),r=(2*(1-r)-.5)*Math.PI;const{n:a,f:u}=this,l=u-r,f=Math.sign(l),y=Math.sign(a)*Math.sqrt(e*e+l*l);let b=Math.atan2(e,Math.abs(l))*f;l*a<0&&(b-=Math.PI*Math.sign(e)*f);const S=Ye(jt(b/a)+this.center[0],-180,180),_=Ye(jt(2*Math.atan(Math.pow(u/y,1/a))-Kh),-85.051129,Ji);return new Xr(S,this.southernCenter?-_:_)}}class qw extends Yl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,r){return{x:Is(e),y:io(r),z:0}}unproject(e,r){const a=us(e),u=Mi(r);return new Xr(a,u)}}const Hw=Rt(Ji);class TP extends Yl{project(e,r){const a=(r=Rt(r))*r,u=a*a;return{x:.5*((e=Rt(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(r*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,r){e=(2*e-.5)*Math.PI;let a=r=(2*(1-r)-1)*Math.PI,u=25,l=0,f=a*a;do{f=a*a;const S=f*f;l=(a*(1.007226+f*(.015085+S*(.028874*f-.044475-.005916*S)))-r)/(1.007226+f*(.045255+S*(.259866*f-.311325-.005916*11*S))),a=Ye(a-l,-Hw,Hw)}while(Math.abs(l)>1e-6&&--u>0);f=a*a;const y=Ye(jt(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),b=jt(a);return new Xr(y,b)}}const Ww=Rt(Ji);class SP extends Yl{project(e,r){r=Rt(r),e=Rt(e);const a=Math.cos(r),u=2/Math.PI,l=Math.acos(a*Math.cos(e/2)),f=Math.sin(l)/l,y=.5*(e*u+2*a*Math.sin(e/2)/f)||0,b=.5*(r+Math.sin(r)/f)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,r){let a=e=(2*e-.5)*Math.PI,u=r=(2*(1-r)-1)*Math.PI,l=25;const f=1e-6;let y=0,b=0;do{const S=Math.cos(u),_=Math.sin(u),w=2*_*S,A=_*_,T=S*S,E=Math.cos(a/2),C=Math.sin(a/2),O=2*E*C,k=C*C,U=1-T*E*E,V=U?1/U:0,N=U?Math.acos(S*E)*Math.sqrt(1/U):0,$=.5*(2*N*S*C+2*a/Math.PI)-e,W=.5*(N*_+u)-r,K=.5*V*(T*k+N*S*E*A)+1/Math.PI,ae=V*(O*w/4-N*_*C),ie=.125*V*(w*C-N*_*T*O),se=.5*V*(A*E+N*k*S)+.5,ve=ae*ie-se*K;y=(W*ae-$*se)/ve,b=($*ie-W*K)/ve,a=Ye(a-y,-Math.PI,Math.PI),u=Ye(u-b,-Ww,Ww)}while((Math.abs(y)>f||Math.abs(b)>f)&&--l>0);return new Xr(jt(a),jt(u))}}class Zw extends Yl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Rt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,r){const{scale:a,cosPhi:u}=this;return{x:Rt(e)*u*a+.5,y:-Math.sin(Rt(r))/u*a+.5,z:0}}unproject(e,r){const{scale:a,cosPhi:u}=this,l=-(r-.5)/a,f=Ye(jt((e-.5)/a)/u,-180,180),y=Math.asin(Ye(l*u,-1,1)),b=Ye(jt(y),-85.051129,Ji);return new Xr(f,b)}}class EP extends qw{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,r,a){const u=dn(e,r,a),l=li(fi(a));return te.vec3.transformMat4(u,u,l),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,r,a){const u=Ca(r.lat,r.lng),l=te.vec3.normalize([],u),f=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(r),e._centerAltitude):e._centerAltitude,y=Wi(1,0)*Ct*f;te.vec3.scaleAndAdd(u,u,l,y);const b=te.mat4.identity(new Float64Array(16));return te.mat4.multiply(b,e.pixelMatrix,e.globeMatrix),te.vec3.transformMat4(u,u,b),new Ae(u[0],u[1])}pixelsPerMeter(e,r){return Wi(1,0)*r}pixelSpaceConversion(e,r,a){const u=Wi(1,e)*r,l=or(Wi(1,45)*r,u,a);return this.pixelsPerMeter(e,r)/l}createTileMatrix(e,r,a){const u=Po(fi(a.canonical));return te.mat4.multiply(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,r){const{center:a}=e,u=li(fi(r));return te.mat4.rotateY(u,u,Rt(a.lng)),te.mat4.rotateX(u,u,Rt(a.lat)),te.mat4.scale(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,r,a,u){return $n(e,r,a,!0)||new s(0,0)}pointCoordinate3D(e,r,a){const u=this.pointCoordinate(e,r,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,r){return!$n(e,r.x,r.y,!1)}farthestPixelDistance(e){const r=function(u,l){const f=u.cameraToCenterDistance,y=u._centerAltitude*l,b=u._camera,S=u._camera.forward(),_=te.vec3.add([],te.vec3.scale([],S,-f),[0,0,y]),w=u.worldSize/(2*Math.PI),A=[0,0,-w],T=u.width/u.height,E=Math.tan(u.fovAboveCenter),C=te.vec3.scale([],b.up(),E),O=te.vec3.scale([],b.right(),E*T),k=te.vec3.normalize([],te.vec3.add([],te.vec3.add([],S,C),O)),U=[];let V;if(new Br(_,k).closestPointOnSphere(A,w,U)){const N=te.vec3.add([],U,A),$=te.vec3.sub([],N,_);V=Math.cos(u.fovAboveCenter)*te.vec3.length($)}else{const N=te.vec3.sub([],_,A),$=te.vec3.sub([],A,_);te.vec3.normalize($,$);const W=te.vec3.length(N)-w;V=Math.sqrt(W*(W+2*w));const K=Math.acos(V/(w+W))-Math.acos(te.vec3.dot(S,$));V*=Math.cos(K)}return 1.01*V}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=zi(e.zoom);if(a>0){const u=$w(e,Wi(1,e.center.lat)*e.worldSize),l=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return or(r,u+l*(1-Math.cos(f)),Math.pow(a,10))}return r}upVector(e,r,a){return dn(r,a,e,1)}upVectorScale(e){return{metersToTile:Kr(mi(fi(e)))}}}function Xw(o){const e=o.parallels,r=!!e&&Math.abs(e[0]+e[1])<.01;switch(o.name){case"mercator":return new qw(o);case"equirectangular":return new bP(o);case"naturalEarth":return new TP(o);case"equalEarth":return new xP(o);case"winkelTripel":return new SP(o);case"albers":return r?new Zw(o):new vP(o);case"lambertConformalConic":return r?new Zw(o):new wP(o);case"globe":return new EP(o)}throw new Error(`Invalid projection name: ${o.name}`)}const AP=Zl.VectorTileFeature.types,MP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function G_(o,e,r,a,u,l,f,y,b,S,_,w,A){const T=y?Math.min(Kl,Math.round(y[0])):0,E=y?Math.min(Kl,Math.round(y[1])):0;o.emplaceBack(e,r,Math.round(32*a),Math.round(32*u),l,f,(T<<1)+(b?1:0),E,16*S,16*_,256*w,256*A)}function q_(o,e,r){o.emplaceBack(e,r)}function H_(o,e,r,a,u,l,f){o.emplaceBack(e,r,a,u,l,f)}function W_(o,e,r,a,u){o.emplaceBack(e,r,a,u),o.emplaceBack(e,r,a,u),o.emplaceBack(e,r,a,u),o.emplaceBack(e,r,a,u)}function IP(o){for(const e of o.sections)if(lv(e.text))return!0;return!1}class t0{constructor(e){this.layoutVertexArray=new Df,this.indexArray=new wi,this.programConfigurations=e,this.segments=new Vn,this.dynamicLayoutVertexArray=new nl,this.opacityVertexArray=new Lf,this.placedSymbolArray=new __,this.iconTransitioningVertexArray=new Sa,this.globeExtVertexArray=new zf,this.zOffsetVertexArray=new wa}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,r,a,u,l){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,j3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,G3.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,MP,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,H3.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$3.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||l)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,q3.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ft(t0,"SymbolBuffers");class r0{constructor(e,r,a){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new a,this.segments=new Vn,this.collisionVertexArray=new kf,this.collisionVertexArrayExt=new nl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,W3.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Z3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ft(r0,"CollisionBuffers");class Z_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=te.mat4.identity([]),this.placementViewportMatrix=te.mat4.identity([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Gv(this.zoom,r["text-size"]),this.iconSizeData=Gv(this.zoom,r["icon-size"]);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),l=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=l!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(l==="viewport-y"||l==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(f=>Ps[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new t0(new Ia(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new t0(new Ia(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Kc,this.lineVertexArray=new Yc,this.symbolInstances=new y_}calculateGlyphDependencies(e,r,a,u,l){for(const f of e){const y=f.codePointAt(0);if(y===void 0)break;if(r[y]=!0,u&&l&&y<=65535){const b=up[f];b&&(r[b.charCodeAt(0)]=!0)}}}updateFootprints(e,r){}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const a=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Fv(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}populate(e,r,a,u){const l=this.layers[0],f=l.layout,y=this.projection.name==="globe",b=f.get("text-font"),S=f.get("text-field"),_=f.get("icon-image"),[w,A]=f.get("icon-size-scale-range"),T=Ye(r.scaleFactor||1,w,A),E=(S.value.kind!=="constant"||S.value.value instanceof Vi&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),C=_.value.kind!=="constant"||!!_.value.value||Object.keys(_.parameters).length>0,O=f.get("symbol-sort-key");if(this.features=[],!E&&!C)return;const k=r.iconDependencies,U=r.glyphDependencies,V=r.availableImages,N=new gn(this.zoom);for(const{feature:$,id:W,index:K,sourceLayerIndex:ae}of e){const ie=l._featureFilter.needGeometry,se=F($,ie);if(!l._featureFilter.filter(N,se,a))continue;if(ie||(se.geometry=L($,a,u)),y&&$.type!==1&&a.z<=5){const Se=se.geometry,Ce=.98078528056,Ie=(Fe,ze)=>{const Ne=dn(Fe.x,Fe.y,a,1),it=dn(ze.x,ze.y,a,1);return te.vec3.dot(Ne,it)<Ce};for(let Fe=0;Fe<Se.length;Fe++)Se[Fe]=x(Se[Fe],Ie)}let ve,le;if(E){const Se=l.getValueAndResolveTokens("text-field",se,a,V),Ce=Vi.factory(Se);IP(Ce)&&(this.hasRTLText=!0),(!this.hasRTLText||Sf()==="unavailable"||this.hasRTLText&&ls.isParsed())&&(ve=Y3(Ce,l,se))}if(C){const Se=l.getValueAndResolveTokens("icon-image",se,a,V);le=Se instanceof Ei?Se:Ei.build(Se)}if(!ve&&!le)continue;const xe=this.sortFeaturesByKey?O.evaluate(se,{},a):void 0,Me={id:W,text:ve,icon:le,index:K,sourceLayerIndex:ae,geometry:se.geometry,properties:$.properties,type:AP[$.type],sortKey:xe};if(this.features.push(Me),le){const Se=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Ce,iconSecondary:Ie}=Nw(le,this.iconSizeData,Se["icon-size"],a,this.zoom,Me,this.pixelRatio,T),Fe=Ce.id.toString();if(k.has(Fe)?k.get(Fe).push(Ce):k.set(Fe,[Ce]),Ie){const ze=Ie.id.toString();k.has(ze)?k.get(ze).push(Ie):k.set(ze,[Ie])}}if(ve){const Se=b.evaluate(se,{},a).join(","),Ce=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ps.vertical)>=0;for(const Ie of ve.sections)if(Ie.image){const Fe=Ie.image.getPrimary().scaleSelf(this.pixelRatio),ze=Fe.id.toString(),Ne=k.get(ze)||[];Ne.push(Fe),k.set(ze,Ne)}else{const Fe=yf(ve.toString()),ze=Ie.fontStack||Se,Ne=U[ze]=U[ze]||{};this.calculateGlyphDependencies(Ie.text,Ne,Ce,this.allowVerticalPlacement,Fe)}}}if(f.get("symbol-placement")==="line"&&(this.features=function($){const W={},K={},ae=[];let ie=0;function se(Me){ae.push($[Me]),ie++}function ve(Me,Se,Ce){const Ie=K[Me];return delete K[Me],K[Se]=Ie,ae[Ie].geometry[0].pop(),ae[Ie].geometry[0]=ae[Ie].geometry[0].concat(Ce[0]),Ie}function le(Me,Se,Ce){const Ie=W[Se];return delete W[Se],W[Me]=Ie,ae[Ie].geometry[0].shift(),ae[Ie].geometry[0]=Ce[0].concat(ae[Ie].geometry[0]),Ie}function xe(Me,Se,Ce){const Ie=Ce?Se[0][Se[0].length-1]:Se[0][0];return`${Me}:${Ie.x}:${Ie.y}`}for(let Me=0;Me<$.length;Me++){const Se=$[Me],Ce=Se.geometry,Ie=Se.text?Se.text.toString():null;if(!Ie){se(Me);continue}const Fe=xe(Ie,Ce),ze=xe(Ie,Ce,!0);if(Fe in K&&ze in W&&K[Fe]!==W[ze]){const Ne=le(Fe,ze,Ce),it=ve(Fe,ze,ae[Ne].geometry);delete W[Fe],delete K[ze],K[xe(Ie,ae[it].geometry,!0)]=it,ae[Ne].geometry=null}else Fe in K?ve(Fe,ze,Ce):ze in W?le(Fe,ze,Ce):(se(Me),W[Fe]=ie-1,K[ze]=ie-1)}return ae.filter(Me=>Me.geometry)}(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",r.elevationFeatures){!this.elevationFeatures&&r.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const $ of r.elevationFeatures)this.elevationFeatureIdToIndex.set($.id,this.elevationFeatures.length),this.elevationFeatures.push($)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(($,W)=>$.sortKey-W.sortKey)}update(e,r,a,u,l,f,y){this.text.programConfigurations.updatePaintArrays(e,r,l,a,u,f,y),this.icon.programConfigurations.updatePaintArrays(e,r,l,a,u,f,y)}updateRoadElevation(){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let e=!1;for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);if(a.elevationFeatureIndex===65535)continue;const u=this.elevationFeatures[a.elevationFeatureIndex];if(u){const l=.05+u.pointElevation(new Ae(a.tileAnchorX,a.tileAnchorY));a.zOffset!==l&&(e=!0,a.zOffset=l)}}e&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(l,f,y)=>{a+=f,a>l.length&&l.resize(a);for(let b=-f;b<0;b++)l.emplace(b+a,y)},r=(l,f,y)=>{u+=f,u>l.length&&l.resize(u);for(let b=-f;b<0;b++)l.emplace(b+u,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,u=0;for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:S}=f,_=f.zOffset,w=S>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,_),e(this.text.zOffsetVertexArray,b,_)),w){const{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:T}=f;A>=0&&r(this.icon.zOffsetVertexArray,S,_),T>=0&&r(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,_)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Xw(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:l}of r)this.lineVertexArray.emplaceBack(u,l);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,r,a,u,l,f,y,b,S,_,w,A,T,E,C,O){const k=e.indexArray,U=e.layoutVertexArray,V=e.globeExtVertexArray,N=e.segments.prepareSegment(4*r.length,U,k,this.canOverlap?f.sortKey:void 0),$=this.glyphOffsetArray.length,W=N.vertexLength,K=this.allowVerticalPlacement&&y===Ps.vertical?Math.PI/2:0,ae=f.text&&f.text.sections;for(let se=0;se<r.length;se++){const{tl:ve,tr:le,bl:xe,br:Me,texPrimary:Se,texSecondary:Ce,pixelOffsetTL:Ie,pixelOffsetBR:Fe,minFontScaleX:ze,minFontScaleY:Ne,glyphOffset:it,isSDF:nt,sectionIndex:Bt}=r[se],ft=N.vertexLength,Tt=it[1];if(G_(U,S.x,S.y,ve.x,Tt+ve.y,Se.x,Se.y,a,nt,Ie.x,Ie.y,ze,Ne),G_(U,S.x,S.y,le.x,Tt+le.y,Se.x+Se.w,Se.y,a,nt,Fe.x,Ie.y,ze,Ne),G_(U,S.x,S.y,xe.x,Tt+xe.y,Se.x,Se.y+Se.h,a,nt,Ie.x,Fe.y,ze,Ne),G_(U,S.x,S.y,Me.x,Tt+Me.y,Se.x+Se.w,Se.y+Se.h,a,nt,Fe.x,Fe.y,ze,Ne),b){const{x:at,y:tr,z:Ot}=b.anchor,[Ht,hr,Mr]=b.up;H_(V,at,tr,Ot,Ht,hr,Mr),H_(V,at,tr,Ot,Ht,hr,Mr),H_(V,at,tr,Ot,Ht,hr,Mr),H_(V,at,tr,Ot,Ht,hr,Mr),W_(e.dynamicLayoutVertexArray,at,tr,Ot,K)}else W_(e.dynamicLayoutVertexArray,S.x,S.y,S.z,K);if(O){const at=Ce||Se;q_(e.iconTransitioningVertexArray,at.x,at.y),q_(e.iconTransitioningVertexArray,at.x+at.w,at.y),q_(e.iconTransitioningVertexArray,at.x,at.y+at.h),q_(e.iconTransitioningVertexArray,at.x+at.w,at.y+at.h)}k.emplaceBack(ft,ft+1,ft+2),k.emplaceBack(ft+1,ft+2,ft+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(it[0]),se!==r.length-1&&Bt===r[se+1].sectionIndex||e.programConfigurations.populatePaintArrays(U.length,f,f.index,{},T,E,C,ae&&ae[Bt])}const ie=b?b.anchor:S;e.placedSymbolArray.emplaceBack(ie.x,ie.y,ie.z,S.x,S.y,$,this.glyphOffsetArray.length-$,W,_,w,S.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],y,0,!1,0,A,0)}_commitLayoutVertex(e,r,a,u,l,f,y){e.emplaceBack(r,a,u,l,f,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,a,u,l,f,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),S=b.vertexLength,_=y.tileAnchorX,w=y.tileAnchorY;for(let T=0;T<4;T++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,r,e.padding,y.zOffset),this._commitLayoutVertex(a.layoutVertexArray,u,l,f,_,w,new Ae(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,l,f,_,w,new Ae(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,l,f,_,w,new Ae(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,l,f,_,w,new Ae(e.x1,e.y2)),b.vertexLength+=4;const A=a.indexArray;A.emplaceBack(S,S+1),A.emplaceBack(S+1,S+2),A.emplaceBack(S+2,S+3),A.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,a,u,l,f){for(let y=u;y<l;y++){const b=a.get(y),S=this.getSymbolInstanceTextSize(e,f,r,y);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,r,a,u,l,f){for(let y=u;y<l;y++){const b=a.get(y),S=this.getSymbolInstanceIconSize(e,r,f.placedIconSymbolIndex);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new r0(Rh,dw.members,Sa),this.iconCollisionBox=new r0(Rh,dw.members,Sa);const u=qh(this.iconSizeData,e),l=qh(this.textSizeData,e,a);for(let f=0;f<this.symbolInstances.length;f++){const y=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(l,e,r,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(l,e,r,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,e,r,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(u,e,r,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,r,a,u){const l=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:u),f=L_(this.textSizeData,e,l)/Oi;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,r,a){const u=this.icon.placedSymbolArray.get(a),l=L_(this.iconSizeData,e,u);return this.tilePixelRatio*l}_commitDebugCollisionVertexUpdate(e,r,a,u){e.emplaceBack(r,-a,-a,u),e.emplaceBack(r,a,-a,u),e.emplaceBack(r,a,a,u),e.emplaceBack(r,-a,a,u)}_updateTextDebugCollisionBoxes(e,r,a,u,l,f,y){for(let b=u;b<l;b++){const S=a.get(b),_=this.getSymbolInstanceTextSize(e,f,r,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,_,S.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,r,a,u,l,f,y){for(let b=u;b<l;b++){const S=a.get(b),_=this.getSymbolInstanceIconSize(e,r,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,_,S.padding,f.zOffset)}}updateCollisionDebugBuffers(e,r,a,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=qh(this.iconSizeData,e,u),f=qh(this.textSizeData,e,a);for(let y=0;y<this.symbolInstances.length;y++){const b=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(f,e,r,b.textBoxStartIndex,b.textBoxEndIndex,b,a),this._updateTextDebugCollisionBoxes(f,e,r,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,a),this._updateIconDebugCollisionBoxes(l,e,r,b.iconBoxStartIndex,b.iconBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(l,e,r,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,a,u,l,f,y,b,S){const _={};if(r<a){const{x1:w,y1:A,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(r);_.textBox={x1:w,y1:A,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.textFeatureIndex=$}if(u<l){const{x1:w,y1:A,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(u);_.verticalTextBox={x1:w,y1:A,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.verticalTextFeatureIndex=$}if(f<y){const{x1:w,y1:A,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(f);_.iconBox={x1:w,y1:A,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.iconFeatureIndex=$}if(b<S){const{x1:w,y1:A,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N,featureIndex:$}=e.get(b);_.verticalIconBox={x1:w,y1:A,x2:T,y2:E,padding:C,projectedAnchorX:O,projectedAnchorY:k,projectedAnchorZ:U,tileAnchorX:V,tileAnchorY:N},_.verticalIconFeatureIndex=$}return _}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,r){const a=e.placedSymbolArray.get(r),u=a.vertexStartIndex+4*a.numGlyphs;for(let l=a.vertexStartIndex;l<u;l+=4)e.indexArray.emplaceBack(l,l+1,l+2),e.indexArray.emplaceBack(l+1,l+2,l+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(e),a=Math.cos(e),u=[],l=[],f=[];for(let y=0;y<this.symbolInstances.length;++y){f.push(y);const b=this.symbolInstances.get(y);u.push(0|Math.round(r*b.tileAnchorX+a*b.tileAnchorY)),l.push(b.featureIndex)}return f.sort((y,b)=>u[y]-u[b]||l[b]-l[y]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,r)=>this.symbolInstances.get(r).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,r){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===r?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const a=this.symbolInstances.get(r);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:l,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:S}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),l>=0&&l!==u&&this.addIndicesForPlacedSymbol(this.text,l),f>=0&&f!==l&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Kw,Yw,n0;Ft(Z_,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Z_.addDynamicAttributes=W_;class Jw{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:bl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ft(Jw,"FormatSectionOverride",{omit:["defaultValue"]});const i0=()=>n0||(n0={layout:Kw||(Kw=new Nn({"symbol-placement":new bt(Ue.layout_symbol["symbol-placement"]),"symbol-spacing":new bt(Ue.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bt(Ue.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new kt(Ue.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bt(Ue.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new bt(Ue.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new bt(Ue.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new bt(Ue.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bt(Ue.layout_symbol["icon-ignore-placement"]),"icon-optional":new bt(Ue.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bt(Ue.layout_symbol["icon-rotation-alignment"]),"icon-size":new kt(Ue.layout_symbol["icon-size"]),"icon-size-scale-range":new bt(Ue.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new kt(Ue.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new kt(Ue.layout_symbol["icon-text-fit-padding"]),"icon-image":new kt(Ue.layout_symbol["icon-image"]),"icon-rotate":new kt(Ue.layout_symbol["icon-rotate"]),"icon-padding":new bt(Ue.layout_symbol["icon-padding"]),"icon-keep-upright":new bt(Ue.layout_symbol["icon-keep-upright"]),"icon-offset":new kt(Ue.layout_symbol["icon-offset"]),"icon-anchor":new kt(Ue.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bt(Ue.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bt(Ue.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bt(Ue.layout_symbol["text-rotation-alignment"]),"text-field":new kt(Ue.layout_symbol["text-field"]),"text-font":new kt(Ue.layout_symbol["text-font"]),"text-size":new kt(Ue.layout_symbol["text-size"]),"text-size-scale-range":new bt(Ue.layout_symbol["text-size-scale-range"]),"text-max-width":new kt(Ue.layout_symbol["text-max-width"]),"text-line-height":new kt(Ue.layout_symbol["text-line-height"]),"text-letter-spacing":new kt(Ue.layout_symbol["text-letter-spacing"]),"text-justify":new kt(Ue.layout_symbol["text-justify"]),"text-radial-offset":new kt(Ue.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bt(Ue.layout_symbol["text-variable-anchor"]),"text-anchor":new kt(Ue.layout_symbol["text-anchor"]),"text-max-angle":new bt(Ue.layout_symbol["text-max-angle"]),"text-writing-mode":new bt(Ue.layout_symbol["text-writing-mode"]),"text-rotate":new kt(Ue.layout_symbol["text-rotate"]),"text-padding":new bt(Ue.layout_symbol["text-padding"]),"text-keep-upright":new bt(Ue.layout_symbol["text-keep-upright"]),"text-transform":new kt(Ue.layout_symbol["text-transform"]),"text-offset":new kt(Ue.layout_symbol["text-offset"]),"text-allow-overlap":new bt(Ue.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bt(Ue.layout_symbol["text-ignore-placement"]),"text-optional":new bt(Ue.layout_symbol["text-optional"]),visibility:new bt(Ue.layout_symbol.visibility)})),paint:Yw||(Yw=new Nn({"icon-opacity":new kt(Ue.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new kt(Ue.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new kt(Ue.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new kt(Ue.paint_symbol["text-emissive-strength"]),"icon-color":new kt(Ue.paint_symbol["icon-color"]),"icon-halo-color":new kt(Ue.paint_symbol["icon-halo-color"]),"icon-halo-width":new kt(Ue.paint_symbol["icon-halo-width"]),"icon-halo-blur":new kt(Ue.paint_symbol["icon-halo-blur"]),"icon-translate":new bt(Ue.paint_symbol["icon-translate"]),"icon-translate-anchor":new bt(Ue.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new kt(Ue.paint_symbol["icon-image-cross-fade"]),"text-opacity":new kt(Ue.paint_symbol["text-opacity"]),"text-occlusion-opacity":new kt(Ue.paint_symbol["text-occlusion-opacity"]),"text-color":new kt(Ue.paint_symbol["text-color"],{runtimeType:ns,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new kt(Ue.paint_symbol["text-halo-color"]),"text-halo-width":new kt(Ue.paint_symbol["text-halo-width"]),"text-halo-blur":new kt(Ue.paint_symbol["text-halo-blur"]),"text-translate":new bt(Ue.paint_symbol["text-translate"]),"text-translate-anchor":new bt(Ue.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new bt(Ue.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new bt(Ue.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new bt(Ue.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new bt(Ue.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new kt(Ue.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},n0);class X_ extends Yi{constructor(e,r,a,u){super(e,i0(),r,a,u),this._colorAdjustmentMatrix=te.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,r){super.recalculate(e,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const l of a)u.indexOf(l)<0&&u.push(l);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,r,a,u){return this._saturation===e&&this._contrast===r&&this._brightnessMin===a&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(l,f,y,b){l=Xe(l),f=Ec(f);const S=te.mat4.create(),_=l/3,w=1-2*_,A=[w,_,_,0,_,w,_,0,_,_,w,0,0,0,0,1],T=.5-.5*f,E=b-y;return te.mat4.multiply(S,[E,0,0,0,0,E,0,0,0,0,E,0,y,y,y,1],[f,0,0,0,0,f,0,0,0,0,f,0,T,T,T,1]),te.mat4.multiply(S,S,A),S}(e,r,a,u),this._saturation=e,this._contrast=r,this._brightnessMin=a,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,r,a,u){const l=this.layout.get(e).evaluate(r,{},a,u),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||pf(f.value)||!l?l:function(y,b){return b.replace(/{([^{}]+)}/g,(S,_)=>_ in y?String(y[_]):"")}(r.properties,l)}createBucket(e){return new Z_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of i0().paint.overridableProperties){if(!X_.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),a=new Jw(r),u=new fh(a,r.property.specification,this.scope,this.options);let l=null;l=r.value.kind==="constant"||r.value.kind==="source"?new ph("source",u):new zl("composite",u,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new Fl(r.property,l,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,a){return!(!this.layout||r.isDataDriven()||a.isDataDriven())&&X_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const a=e.get("text-field"),u=i0().paint.properties[r];let l=!1;const f=y=>{for(const b of y)if(u.overrides&&u.overrides.hasOverride(b))return void(l=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Vi)f(a.value.value.sections);else if(a.value.kind==="source"){const y=S=>{l||(S instanceof eo&&Ln(S.value)===No?f(S.value.sections):S instanceof Vo?f(S.sections):S.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return l}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,r,a){return{config:new sl(this,{zoom:r,lut:a}),overrideFog:!1}}}let Qw,e2,t2,r2;var s0=Zr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function o0(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function a0(o){switch(o){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class l0{constructor(e,r,a,u){this.context=e,this.format=a,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(r,{premultiply:u&&u.premultiply})}update(e,r){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:l}=this,{gl:f}=l,{x:y,y:b}=r&&r.position?r.position:{x:0,y:0},S=y+a,_=b+u;!this.size||this.size[0]===S&&this.size[1]===_||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!r||r.premultiply!==!1));const w=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&S>0&&_>0){const A=this.useMipmap?Math.floor(Math.log2(Math.max(S,_)))+1:1;f.texStorage2D(f.TEXTURE_2D,A,this.format,S,_),this.size=[S,_]}if(this.size)if(w)f.texSubImage2D(f.TEXTURE_2D,0,y,b,o0(this.format),a0(this.format),e);else{const A=e.data;A&&f.texSubImage2D(f.TEXTURE_2D,0,y,b,a,u,o0(this.format),a0(this.format),A)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,r,a=!1){const{context:u}=this,{gl:l}=u;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,r),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrapS=r)}bindExtraParam(e,r,a,u){const{context:l}=this,{gl:f}=l;f.bindTexture(f.TEXTURE_2D,this.texture),r!==this.magFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,r),this.magFilter=r),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),this.wrapS=a),u!==this.wrapT&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,u),this.wrapT=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class K_{constructor(e,r){this.context=e,this.texture=r}bind(e,r){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),r!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,r),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,r),this.wrapS=r)}}function Y_(o,e,r,a,u,l,f,y){const b=[o,e,1,r,a,1,u,l,1],S=[f,y,1],_=te.mat3.adjoint([],b),[w,A,T]=te.vec3.transformMat3(S,S,_);return te.mat3.multiply(b,b,[w,0,0,0,A,0,0,0,T])}function n2(o,e,r,a,u,l,f,y){const b=function(S,_,w,A,T,E,C,O){const k=Y_(0,0,1,0,1,1,0,1),U=Y_(S,_,w,A,T,E,C,O),V=te.mat3.adjoint([],k);return te.mat3.multiply(U,U,V)}(o,e,r,a,u,l,f,y);return[b[2]/b[8]/Ct,b[5]/b[8]/Ct]}function J_(o){return[o[0],Math.min(Math.max(o[1],-85.051129),Ji)]}class i2 extends ma{constructor(e,r,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=r.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=r,this._dirty=!1}load(e,r){if(this._loaded=r||!1,this.fire(new wo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=kd(this.map._requestManager.transformRequest(this.url,pi.Image),(a,u)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Vu(a)):u&&(this.image=u instanceof HTMLImageElement?We.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new K_(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new wo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof K_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let r=e[0][1],a=e[0][1];for(const l of e)l[1]>a&&(a=l[1]),l[1]<r&&(r=l[1]);const u=(a+r)/2;if(u>Ji?this.onNorthPole=!0:u<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const l=e.map(s.fromLngLat);this.tileID=function(f){let y=1/0,b=1/0,S=-1/0,_=-1/0;for(const C of f)y=Math.min(y,C.x),b=Math.min(b,C.y),S=Math.max(S,C.x),_=Math.max(_,C.y);const w=Math.max(S-y,_-b),A=Math.max(0,Math.floor(-Math.log(w)/Math.LN2)),T=Math.pow(2,A);let E=Math.floor((y+S)/2*T);return E>1&&(E-=1),new $e(A,E,Math.floor((b+_)/2*T))}(l),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new wo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const k in this.tiles){const U=this.tiles[k];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const r=pp(new $e(0,0,0),this.map.transform.projection),a=[r.projection.project(this.coordinates[0][0],this.coordinates[0][1]),r.projection.project(this.coordinates[1][0],this.coordinates[1][1]),r.projection.project(this.coordinates[2][0],this.coordinates[2][1]),r.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(k){const U=k[1].x-k[0].x,V=k[1].y-k[0].y,N=k[2].x-k[1].x,$=k[2].y-k[1].y,W=k[3].x-k[2].x,K=k[3].y-k[2].y,ae=k[0].x-k[3].x,ie=k[0].y-k[3].y,se=U*$-N*V,ve=N*K-W*$,le=W*ie-ae*K,xe=ae*V-U*ie;return se>0&&ve>0&&le>0&&xe>0||se<0&&ve<0&&le<0&&xe<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=pp(this.tileID,this.map.transform.projection),[l,f,y,b]=this.coordinates.map(k=>{const U=u.projection.project(k[0],k[1]);return Gw(u,U)._round()});this.perspectiveTransform=n2(l.x,l.y,f.x,f.y,y.x,y.y,b.x,b.y);const S=this._boundsArray=new rl;S.emplaceBack(l.x,l.y,0,0),S.emplaceBack(f.x,f.y,Ct,0),S.emplaceBack(b.x,b.y,0,Ct),S.emplaceBack(y.x,y.y,Ct,Ct),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,s0.members),this.boundsSegments=Vn.simpleSegment(0,0,4,2);const _=[],w=[J_((A=this.coordinates)[0]),J_(A[1]),J_(A[2]),J_(A[3])];var A;const[T,E,C,O]=function(k){let U=k[0][0],V=U,N=k[0][1],$=N;for(let W=1;W<k.length;W++)k[W][0]<U?U=k[W][0]:k[W][0]>V&&(V=k[W][0]),k[W][1]<N?N=k[W][1]:k[W][1]>$&&($=k[W][1]);return[U,N,V-U,$-N]}(w);{const k=new rl,[U,V,N,$]=function(Ie){let Fe=Ie[0].x,ze=Fe,Ne=Ie[0].y,it=Ne;for(let nt=1;nt<Ie.length;nt++)Ie[nt].x<Fe?Fe=Ie[nt].x:Ie[nt].x>ze&&(ze=Ie[nt].x),Ie[nt].y<Ne?Ne=Ie[nt].y:Ie[nt].y>it&&(it=Ie[nt].y);return[Fe,Ne,ze-Fe,it-Ne]}(a),W=Ie=>[(Ie.x-U)/N,(Ie.y-V)/$],[K,ae,ie,se]=a.map(W),ve=function(Ie,Fe,ze,Ne,it,nt,Bt,ft){const Tt=Y_(0,0,1,0,1,1,0,1),at=Y_(Ie,Fe,ze,Ne,it,nt,Bt,ft),tr=te.mat3.adjoint([],at);return te.mat3.multiply(Tt,Tt,tr)}(K[0],K[1],ae[0],ae[1],ie[0],ie[1],se[0],se[1]);this.elevatedGlobePerspectiveTransform=n2(K[0],K[1],ae[0],ae[1],ie[0],ie[1],se[0],se[1]);const le=(Ie,Fe)=>{_.push(Ie.lng);const ze=Math.round((Ie.lng-T)/C*Ct),Ne=Math.round((Ie.lat-E)/O*Ct),it=W(Fe),nt=te.vec3.transformMat3([],[it[0],it[1],1],ve),Bt=Math.round(nt[0]/nt[2]*Ct),ft=Math.round(nt[1]/nt[2]*Ct);k.emplaceBack(ze,Ne,Bt,ft)},xe=a[3].x-a[0].x,Me=a[3].y-a[0].y,Se=a[2].x-a[1].x,Ce=a[2].y-a[1].y;for(let Ie=0;Ie<65;Ie++){const Fe=Ie/64,ze=[a[0].x+Fe*xe,a[0].y+Fe*Me],Ne=[a[1].x+Fe*Se,a[1].y+Fe*Ce],it=Ne[0]-ze[0],nt=Ne[1]-ze[1];for(let Bt=0;Bt<65;Bt++){const ft=Bt/64,Tt={x:ze[0]+it*ft,y:ze[1]+nt*ft};le(r.projection.unproject(Tt.x,Tt.y),Tt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(k,s0.members)}{this.maxLongitudeTriangleSize=0;let k=[],U=new wi;const V=(N,$,W)=>{U.emplaceBack(N,$,W);const K=_[N],ae=_[$],ie=_[W],se=Math.min(Math.min(K,ae),ie),ve=Math.max(Math.max(K,ae),ie)-se;ve>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=ve),k.push(se+ve/2)};for(let N=0;N<64;N++)for(let $=0;$<64;$++){const W=65*N+$,K=W+1,ae=W+65,ie=ae+1;V(W,ae,K),V(K,ae,ie)}[k,U]=function(N,$){const W=Array.from({length:N.length},(ie,se)=>se);W.sort((ie,se)=>N[ie]-N[se]);const K=[],ae=new wi;for(let ie=0;ie<W.length;ie++){const se=W[ie];K.push(N[se]);const ve=3*se,le=ve+1;ae.emplaceBack($.uint16[ve],$.uint16[le],$.uint16[le+1])}return[K,ae]}(k,U),this.elevatedGlobeTrianglesCenterLongitudes=k,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(U)}this.elevatedGlobeSegments=Vn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,C/Ct,0,O/Ct,0,0,E,T,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const r=this.map.painter.context,a=r.gl;!this._dirty||this.texture instanceof K_||(this.texture?this.texture.update(this.image):(this.texture=new l0(r,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(r)}loadTile(e,r){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},r(null)):(e.state="errored",r(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const r=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!r)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let u=(l=e+180)+360*Math.round((a[0]-l)/360);var l;const f=new Vn,y=(w,A)=>{f.segments.push({vertexOffset:0,primitiveOffset:w,vertexLength:r.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-u)<=b){const w=Nu(a,0,a.length,u+b);return w===a.length||y(w,Bu(a,w+1,a.length,u+360-b)-w),f}u<a[0]&&(u+=360);const S=Bu(a,0,a.length,u-b);if(S===a.length)return y(0,a.length),f;y(0,S-0);const _=Nu(a,S+1,a.length,u+b);return _!==a.length&&y(_,a.length-_),f}}const CP=(Math.pow(256,2)-1)/16907520;class s2 extends Yi{constructor(e,r,a,u){super(e,{layout:t2||(t2=new Nn({visibility:new bt(Ue.layout_raster.visibility)})),paint:r2||(r2=new Nn({"raster-opacity":new bt(Ue.paint_raster["raster-opacity"]),"raster-color":new el(Ue.paint_raster["raster-color"]),"raster-color-mix":new bt(Ue.paint_raster["raster-color-mix"]),"raster-color-range":new bt(Ue.paint_raster["raster-color-range"]),"raster-hue-rotate":new bt(Ue.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bt(Ue.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bt(Ue.paint_raster["raster-brightness-max"]),"raster-saturation":new bt(Ue.paint_raster["raster-saturation"]),"raster-contrast":new bt(Ue.paint_raster["raster-contrast"]),"raster-resampling":new bt(Ue.paint_raster["raster-resampling"]),"raster-fade-duration":new bt(Ue.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new bt(Ue.paint_raster["raster-emissive-strength"]),"raster-array-band":new bt(Ue.paint_raster["raster-array-band"]),"raster-elevation":new bt(Ue.paint_raster["raster-elevation"]),"raster-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof i2&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const r=this._transitionablePaint._values["raster-color"].value.expression,[a,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(u)||a===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=ep({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[a,u])}}let o2,a2,l2,c2,u2;class h2 extends Yi{constructor(e,r,a,u){super(e,{layout:o2||(o2=new Nn({visibility:new bt(Ue["layout_raster-particle"].visibility)})),paint:a2||(a2=new Nn({"raster-particle-array-band":new bt(Ue["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new bt(Ue["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new el(Ue["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new bt(Ue["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new bt(Ue["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new bt(Ue["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new bt(Ue["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new bt(Ue["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},r,a,u),this._updateColorRamp(),this.lastInvalidatedAt=We.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,r=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=ep({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:r}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=We.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class PP extends Yi{constructor(e,r){super(e,{},r,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function c0(o,e,r){const a=[0,0,1],u=te.quat.identity([]);return te.quat.rotateY(u,u,r?-Rt(o)+Math.PI:Rt(o)),te.quat.rotateX(u,u,-Rt(e)),te.vec3.transformQuat(a,a,u),te.vec3.normalize(a,a)}function d2(o,e){const r=Q_(o.projection,o.zoom,o.width,o.height),a=function(l,f,y,b,S){const _=new Xr(y.lng-180*Jl,y.lat),w=new Xr(y.lng+180*Jl,y.lat),A=l.project(_.lng,_.lat),T=l.project(w.lng,w.lat),E=-Math.atan2(T.y-A.y,T.x-A.x),C=s.fromLngLat(y);C.y=Ye(C.y,-1+Jl,1-Jl);const O=C.toLngLat(),k=l.project(O.lng,O.lat),U=s.fromLngLat(O);U.x+=Jl;const V=U.toLngLat(),N=l.project(V.lng,V.lat),$=p2(N.x-k.x,N.y-k.y,E),W=s.fromLngLat(O);W.y+=Jl;const K=W.toLngLat(),ae=l.project(K.lng,K.lat),ie=p2(ae.x-k.x,ae.y-k.y,E),se=Math.abs($.x)/Math.abs(ie.y),ve=te.mat4.identity([]);te.mat4.rotateZ(ve,ve,-E*(1-(S?0:b)));const le=te.mat4.identity([]);return te.mat4.scale(le,le,[1,1-(1-se)*b,1]),le[4]=-ie.x/ie.y*b,te.mat4.rotateZ(le,le,E),te.mat4.multiply(le,ve,le),le}(o.projection,0,o.center,r,e),u=f2(o);return te.mat4.scale(a,a,[u,u,1]),a}function f2(o){const e=o.projection,r=Q_(o.projection,o.zoom,o.width,o.height),a=u0(e,o.center),u=u0(e,Xr.convert(e.center));return Math.pow(2,a*r+(1-r)*u)}function Q_(o,e,r,a,u=1/0){const l=o.range;if(!l)return 0;const f=Math.min(u,Math.max(r,a)),y=Math.log(f/1024)/Math.LN2;return Jt(l[0]+y,l[1]+y,e)}const Jl=1/4e4;function u0(o,e){const r=Ye(e.lat,-85.051129,Ji),a=new Xr(e.lng-180*Jl,r),u=new Xr(e.lng+180*Jl,r),l=o.project(a.lng,r),f=o.project(u.lng,r),y=s.fromLngLat(a),b=s.fromLngLat(u),S=f.x-l.x,_=f.y-l.y,w=b.x-y.x,A=b.y-y.y,T=Math.sqrt((w*w+A*A)/(S*S+_*_));return Math.log(T)/Math.LN2}function p2(o,e,r){const a=Math.cos(r),u=Math.sin(r);return{x:o*a-e*u,y:o*u+e*a}}function m2(o,e,r){te.mat4.identity(o),te.mat4.rotateZ(o,o,Rt(e[2])),te.mat4.rotateX(o,o,Rt(e[0])),te.mat4.rotateY(o,o,Rt(e[1])),te.mat4.scale(o,o,r),te.mat4.multiply(o,o,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function eg(o,e,r,a,u,l,f,y){const b=[r[0]-e[0],r[1]-e[1],0],S=[a[0]-e[0],a[1]-e[1],0];if(te.vec3.length(b)<1e-12||te.vec3.length(S)<1e-12)return te.quat.identity(o);const _=te.vec3.cross([],b,S);te.vec3.normalize(_,_),te.vec3.subtract(S,a,e),b[2]=(l-u)*y,S[2]=(f-u)*y;const w=b;return te.vec3.cross(w,b,S),te.vec3.normalize(w,w),te.quat.rotationTo(o,_,w)}function h0(o,e,r=!1){const a=zi(e.zoom),u=function(l,f,y){const b=f.worldSize,S=[l[12],l[13],l[14]],_=Mi(S[1]/b),w=us(S[0]/b),A=te.mat4.identity([]),T=Wi(1,_)*b,E=Wi(1,0)*b*Hl(_,f.zoom),C=1/es(b);let O=E*C;if(y){const N=Q_(f.projection,f.zoom,f.width,f.height,1024);O=C*f.projection.pixelSpaceConversion(f.center.lat,b,N)}const k=Ca(_,w);te.vec3.add(k,k,te.vec3.scale([],te.vec3.normalize([],k),T*O*S[2]));const U=function(N){const $=[N[0],N[1],N[2]];let W=[0,1,0];const K=te.vec3.cross([],W,$);return te.vec3.cross(W,$,K),te.vec3.squaredLength(W)===0&&(W=[0,1,0],te.vec3.cross(K,$,W)),te.vec3.normalize(K,K),te.vec3.normalize(W,W),te.vec3.normalize($,$),[K[0],K[1],K[2],0,W[0],W[1],W[2],0,$[0],$[1],$[2],0,N[0],N[1],N[2],1]}(k);te.mat4.scale(A,A,[O,O,O*T]),te.mat4.translate(A,A,[-S[0],-S[1],-S[2]]);const V=te.mat4.multiply([],f.globeMatrix,U);return te.mat4.multiply(V,V,A),te.mat4.multiply(V,V,l),V}(o,e,r);if(a>0){const l=function(f,y){const b=y.worldSize,S=Wi(1,0)*b*Hl(y.center.lat,y.zoom)/es(b),_=Wi(1,y.center.lat)*b,w=te.mat4.identity([]);return te.mat4.rotateY(w,w,Rt(y.center.lng)),te.mat4.rotateX(w,w,Rt(y.center.lat)),te.mat4.translate(w,w,[0,0,Ai]),te.mat4.scale(w,w,[S,S,S*_]),te.mat4.translate(w,w,[y.point.x-.5*b,y.point.y-.5*b,0]),te.mat4.multiply(w,w,f),te.mat4.multiply(w,y.globeMatrix,w)}(o,e);return function(f,y,b){const S=(E,C,O)=>{const k=te.vec3.length(E),U=te.vec3.length(C),V=Ti(E,C,O);return te.vec3.scale(V,V,1/te.vec3.length(V)*or(k,U,O))},_=S([f[0],f[1],f[2]],[y[0],y[1],y[2]],b),w=S([f[4],f[5],f[6]],[y[4],y[5],y[6]],b),A=S([f[8],f[9],f[10]],[y[8],y[9],y[10]],b),T=Ti([f[12],f[13],f[14]],[y[12],y[13],y[14]],b);return[_[0],_[1],_[2],0,w[0],w[1],w[2],0,A[0],A[1],A[2],0,T[0],T[1],T[2],1]}(u,l,a)}return u}function _2(o,e,r,a){const u=sr.projectAabbCorners(a,r);let l=Number.MAX_VALUE,f=-1;for(let S=0;S<u.length;++S){const _=u[S];_[0]=(.5*_[0]+.5)*e.width,_[1]=(.5-.5*_[1])*e.height,_[2]<l&&(f=S,l=_[2])}const y=S=>new Ae(u[S][0],u[S][1]);let b;switch(f){case 0:case 6:b=[y(1),y(5),y(4),y(7),y(3),y(2),y(1)];break;case 1:case 7:b=[y(0),y(4),y(5),y(6),y(2),y(3),y(0)];break;case 3:case 5:b=[y(1),y(0),y(4),y(7),y(6),y(2),y(1)];break;default:b=[y(1),y(5),y(6),y(7),y(3),y(0),y(1)]}if(H(o,b))return l}const RP=Zr([{name:"a_pos_3f",components:3,type:"Float32"}]),DP=Zr([{name:"a_color_3f",components:3,type:"Float32"}]),zP=Zr([{name:"a_color_4f",components:4,type:"Float32"}]),LP=Zr([{name:"a_uv_2f",components:2,type:"Float32"}]),OP=Zr([{name:"a_normal_3f",components:3,type:"Float32"}]),kP=Zr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),FP=Zr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),g2={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class tg{constructor(e,r,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),r!=null&&r.__line__&&(this.line=r.__line__)}}function y2(o,e){const r=o.indexOf("://")===-1;try{return new URL(o,r&&e?"http://example.com":void 0),!0}catch{return!1}}class v2{constructor(e,r){this.feature=e,this.instancedDataOffset=r,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class x2{constructor(){this.instancedDataArray=new Vf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class d0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(e,r){}populate(e,r,a,u){this.tileToMeter=t(a);const l=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:y,index:b,sourceLayerIndex:S}of e){const _=y??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),w=F(f,l);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom),w,a))continue;const A={id:_,sourceLayerIndex:S,index:b,geometry:l?w.geometry:L(f,a,u),properties:f.properties,type:f.type,patterns:{}},T=this.addFeature(A,A.geometry,w);T&&r.featureIndex.insert(f,A.geometry,b,S,this.index,this.instancesPerModel[T].instancedDataArray.length,Ct/32)}this.lookup=null}update(e,r,a,u){for(const l in this.instancesPerModel){const f=this.instancesPerModel[l];for(const y in e)f.idToFeaturesIndex.hasOwnProperty(y)&&(this.evaluate(f.features[f.idToFeaturesIndex[y]],e[y],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const r in this.instancesPerModel){const a=this.instancesPerModel[r];for(const u of a.features){const l=this.layers[0],f=u.feature,y=this.canonical,b=l.paint.get("model-rotation").evaluate(f,{},y),S=l.paint.get("model-scale").evaluate(f,{},y),_=l.paint.get("model-translation").evaluate(f,{},y);te.vec3.exactEquals(u.rotation,b)&&te.vec3.exactEquals(u.scale,S)&&te.vec3.exactEquals(u.translation,_)||(this.evaluate(u,u.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,r,a,u){if(r.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=r.updateTime;const l=r.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Fv(this.activeReplacements,l))return!1;this.activeReplacements=l;let f=!1;for(const y in this.instancesPerModel){const b=this.instancesPerModel[y],S=b.instancedDataArray;for(const _ of b.features){const w=_.instancedDataOffset,A=_.instancedDataCount;for(let T=0;T<A;T++){const E=16*(T+w);let C=S.float32[E+0];const O=C>Ct;C=O?C-Ct:C;const k=Math.floor(C),U=S.float32[E+1];let V=!1;for(const N of this.activeReplacements)if(!Pb(N,a,g2.Model,u)&&!(N.min.x>k||k>N.max.x||N.min.y>U||U>N.max.y)&&(V=kb(Ob(k,U,e.canonical,N.footprintTileId.canonical),N.footprint),V))break;S.float32[E]=V?C+Ct:C,f=f||V!==O}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const r in this.instancesPerModel){const a=this.instancesPerModel[r];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,kP.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const r in this.instancesPerModel){const a=this.instancesPerModel[r];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris)for(const r of this.modelUris)e.removeModel(r,"")}addFeature(e,r,a){const u=this.layers[0],l=u.layout.get("model-id").evaluate(a,{},this.canonical);if(!l)return Pr(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),l;y2(l,!1)&&(this.modelUris.includes(l)||this.modelUris.push(l)),this.instancesPerModel[l]||(this.instancesPerModel[l]=new x2);const f=this.instancesPerModel[l],y=f.instancedDataArray,b=new v2(a,y.length);for(const S of r)for(const _ of S){if(_.x<0||_.x>=Ct||_.y<0||_.y>=Ct)continue;const w=(this.lookupDim-1)/Ct,A=this.lookupDim*(_.y*w|0)+_.x*w|0;if(this.lookup){if(this.lookup[A]!==0)continue;this.lookup[A]=1}this.instanceCount++;const T=y.length;y.resize(T+1),f.instancesEvaluatedElevation.push(0),y.float32[16*T]=_.x,y.float32[16*T+1]=_.y}return b.instancedDataCount=f.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(b),this.evaluate(b,{},f,!1)),l}getModelUris(){return this.modelUris}evaluate(e,r,a,u){const l=this.layers[0],f=e.feature,y=this.canonical,b=e.rotation=l.paint.get("model-rotation").evaluate(f,r,y),S=e.scale=l.paint.get("model-scale").evaluate(f,r,y),_=e.translation=l.paint.get("model-translation").evaluate(f,r,y),w=l.paint.get("model-color").evaluate(f,r,y);w.a=l.paint.get("model-color-mix-intensity").evaluate(f,r,y);const A=[];this.maxVerticalOffset<_[2]&&(this.maxVerticalOffset=_[2]),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),m2(A,b,S);const T=Math.round(100*w.a)+w.b/1.05;for(let E=0;E<e.instancedDataCount;++E){const C=e.instancedDataOffset+E,O=16*C,k=a.instancedDataArray.float32;let U=0;u&&(U=k[O+6]-a.instancesEvaluatedElevation[C]);const V=0|k[O+1];k[O]=(0|k[O])+w.r/1.05,k[O+1]=V+w.g/1.05,k[O+2]=T,k[O+3]=1/(y.z>10?this.tileToMeter:t(y,V)),k[O+4]=_[0],k[O+5]=_[1],k[O+6]=_[2]+U,k[O+7]=A[0],k[O+8]=A[1],k[O+9]=A[2],k[O+10]=A[4],k[O+11]=A[5],k[O+12]=A[6],k[O+13]=A[8],k[O+14]=A[9],k[O+15]=A[10],a.instancesEvaluatedElevation[C]=_[2]}}}let b2,w2;Ft(d0,"ModelBucket",{omit:["layers"]}),Ft(x2,"PerModelAttributes"),Ft(v2,"ModelFeature");const au=64,Yh={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function T2(o,e,r,a,u,l,f,y,b,S=!1){const _=r.zoom,w=r.project(a),A=Hl(a.lat,_),T=1/A;te.mat4.identity(o),te.mat4.translate(o,o,[w.x+f[0]*T,w.y+f[1]*T,f[2]]);let E=1,C=1;const O=r.worldSize;if(S){if(r.projection.name==="mercator"){let N=0;r.elevation&&(N=r.elevation.getAtPointOrZero(new s(w.x/O,w.y/O),0));const $=te.vec4.transformMat4([],[w.x,w.y,N,1],r.projMatrix)[3]/r.cameraToCenterDistance;E=$,C=$*Hl(r.center.lat,_)}else if(r.projection.name==="globe"){const N=h0(o,r),$=te.mat4.multiply([],r.projMatrix,N),W=[0,0,0,1];te.vec4.transformMat4(W,W,$);const K=W[3]/r.cameraToCenterDistance,ae=zi(_),ie=r.projection.pixelsPerMeter(a.lat,O)*Hl(a.lat,_),se=r.projection.pixelsPerMeter(r.center.lat,O)*Hl(r.center.lat,_);E=K/or(ie,Jf(r.center.lat),ae),C=K*A/ie,E*=se,C*=se}}else E=T;te.mat4.scale(o,o,[E,E,C]);const k=[...o],U=e.orientation,V=[];if(m2(V,[U[0]+u[0],U[1]+u[1],U[2]+u[2]],l),te.mat4.multiply(o,k,V),y&&r.elevation){let N=0;const $=[];if(b&&r.elevation){N=function(ae,ie,se,ve,le){const xe=ie.elevation;if(!xe)return 0;const Me=sr.projectAabbCorners(se,ve),Se=Wi(1,le.lat)*ie.worldSize,Ce=function(tr,Ot){const Ht=[0,0,1],hr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Mr of hr){const gr=tr[Mr.corners[0]],Lr=tr[Mr.corners[1]],Sr=tr[Mr.corners[2]],Fr=[Lr[0]-gr[0],Lr[1]-gr[1],Ot*(Lr[2]-gr[2])],Wr=te.vec3.cross(Fr,Fr,[Sr[0]-gr[0],Sr[1]-gr[1],Ot*(Sr[2]-gr[2])]);te.vec3.normalize(Wr,Wr),Mr.dotProductWithUp=te.vec3.dot(Wr,Ht)}return hr.sort((Mr,gr)=>Mr.dotProductWithUp-gr.dotProductWithUp),hr[0].corners}(Me,Se),Ie=Me[Ce[0]],Fe=Me[Ce[1]],ze=Me[Ce[2]],Ne=Me[Ce[3]],it=xe.getAtPointOrZero(new s(Ie[0]/ie.worldSize,Ie[1]/ie.worldSize),0),nt=xe.getAtPointOrZero(new s(Fe[0]/ie.worldSize,Fe[1]/ie.worldSize),0),Bt=xe.getAtPointOrZero(new s(ze[0]/ie.worldSize,ze[1]/ie.worldSize),0),ft=xe.getAtPointOrZero(new s(Ne[0]/ie.worldSize,Ne[1]/ie.worldSize),0),Tt=(it+ft)/2,at=(nt+Bt)/2;return Tt>at?nt<Bt?eg(ae,Fe,Ne,Ie,nt,ft,it,Se):eg(ae,ze,Ie,Ne,Bt,it,ft,Se):it<ft?eg(ae,Ie,Fe,ze,it,nt,Bt,Se):eg(ae,Ne,ze,Fe,ft,Bt,nt,Se),Math.max(Tt,at)}($,r,e.aabb,o,a);const W=te.mat4.fromQuat([],$),K=te.mat4.multiply([],W,V);te.mat4.multiply(o,k,K)}else N=r.elevation.getAtPointOrZero(new s(w.x/O,w.y/O),0);N!==0&&(o[14]+=N)}}function vp(o,e,r=!1){o.uploaded||(o.gfxTexture=new l0(e,o.image,r?e.gl.R8:e.gl.RGBA8,{useMipmap:o.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),o.uploaded=!0,o.image=null)}function BP(o,e,r){o.indexBuffer=e.createIndexBuffer(o.indexArray,!1,!0),o.vertexBuffer=e.createVertexBuffer(o.vertexArray,RP.members,!1,!0),o.normalArray&&(o.normalBuffer=e.createVertexBuffer(o.normalArray,OP.members,!1,!0)),o.texcoordArray&&(o.texcoordBuffer=e.createVertexBuffer(o.texcoordArray,LP.members,!1,!0)),o.colorArray&&(o.colorBuffer=e.createVertexBuffer(o.colorArray,(o.colorArray.bytesPerElement===12?DP:zP).members,!1,!0)),o.featureArray&&(o.pbrBuffer=e.createVertexBuffer(o.featureArray,FP.members,!0)),o.segments=Vn.simpleSegment(0,0,o.vertexArray.length,o.indexArray.length);const a=o.material;a.pbrMetallicRoughness.baseColorTexture&&vp(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&vp(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&vp(a.normalTexture,e),a.occlusionTexture&&vp(a.occlusionTexture,e,r),a.emissionTexture&&vp(a.emissionTexture,e)}function f0(o,e,r){if(o.meshes)for(const a of o.meshes)BP(a,e,r);if(o.children)for(const a of o.children)f0(a,e,r)}function rg(o){if(o.meshes)for(const e of o.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(o.children)for(const e of o.children)rg(e)}function p0(o){if(o.meshes)for(const r of o.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((e=r.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(o.children)for(const r of o.children)p0(r)}class Jh{constructor(e,r,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=a}static create(e,r,a){const u=a||e.findDEMTileFor(r);if(!u||!u.dem)return;const l=u.dem,f=u.tileID,y=1<<r.canonical.z-f.canonical.z;return new Jh(u,l.dim/Ct/y,[(r.canonical.x/y-f.canonical.x)*l.dim,(r.canonical.y/y-f.canonical.y)*l.dim])}tileCoordToPixel(e,r){const a=r*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),l=Math.floor(a);return new Ae(u,l)}getElevationAt(e,r,a,u){const l=e*this._scale+this._offset[0],f=r*this._scale+this._offset[1],y=Math.floor(l),b=Math.floor(f),S=this._dem;return u=!!u,a?or(or(S.get(y,b,u),S.get(y,b+1,u),f-b),or(S.get(y+1,b,u),S.get(y+1,b+1,u),f-b),l-y):S.get(y,b,u)}getElevationAtPixel(e,r,a){return this._dem.get(e,r,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Wi(1,e)*this._dem.stride}}const m0=new Float32Array(262144),lu=new Uint8Array(262144);function S2(o){let e=0;if(o.meshes)for(const r of o.meshes)e=Math.max(e,r.aabb.max[2]);if(o.children)for(const r of o.children)e=Math.max(e,S2(r));return e}function E2(o,e,r){if(o.meshes)for(const a of o.meshes){if(a.aabb.min[0]===1/0)continue;const u=sr.applyTransform(a.aabb,o.matrix);r.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(o.children)for(const a of o.children)E2(a,e,r)}const A2=["","wall","door","roof","window","lamp","logo"];class M2{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:S2(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new sr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const r=new sr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=sr.applyTransformFast(a.aabb,this.node.matrix),r.encapsulate(a.transformedAabb)),e++;this.aabb=r}return this.aabb}}class ng{constructor(e,r,a,u,l,f,y){this.id=a,this.layers=e,this.layerIds=this.layers.map(b=>b.fqid),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.modelTraits|=Yh.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=Yh.HasMapboxMeshFeatures),l&&(this.modelTraits|=Yh.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const b of r)this.nodesInfo.push(new M2(b)),E2(b,y.featureIndexArray.length,y.grid),y.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,y.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,r){for(const a of this.getNodesInfo()){const u=a.node;u.footprint&&r.push({footprint:u.footprint,id:e})}}update(e){const r=Object.keys(e).length!==0;if(r&&!this.stateDependentLayers.length)return;const a=r?this.stateDependentLayers:this.layers;if(!xt(e,this.states))for(const u of a)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const r=this.getNodesInfo();for(const a of r){const u=a.node;this.uploaded?this.updatePbrBuffer(u):f0(u,e,!0)}for(const a of r)rg(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let r=!1;if(!e.meshes)return r;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),r=!0);return r}needsReEvaluation(e,r,a){const u=e.transform.projectionOptions,l=e.style.getBrightness(),f=this.brightness!==l;if(!this.uploaded||this.dirty||u.name!==this.projection.name||xp(a.paint.get("model-color").value,f)||xp(a.paint.get("model-color-mix-intensity").value,f)||xp(a.paint.get("model-roughness").value,f)||xp(a.paint.get("model-emissive-strength").value,f)||xp(a.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=u,this.brightness=l;const y=this.getNodesInfo();for(const b of y)b.state=null;return!0}return!1}evaluateScale(e,r){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),u=this.id.canonical;for(const l of a){const f=l.feature;l.evaluatedScale=r.paint.get("model-scale").evaluate(f,{},u)}}evaluate(e,r){const a=this.getNodesInfo();for(const u of a){if(!u.node.meshes)continue;const l=u.feature,f=r&&r[l.id];if(xt(f,u.state))continue;u.state=structuredClone(f);const y=u.node.meshes&&u.node.meshes[0].featureData,b=u.evaluatedColor[2],S=u.evaluatedRMEA[2],_=this.id.canonical;if(u.hasTranslucentParts=!1,y){for(let w=0;w<A2.length;w++){const A=A2[w];A.length&&(l.properties.part=A);const T=e.paint.get("model-color").evaluate(l,f,_).toRenderColor(null),E=e.paint.get("model-color-mix-intensity").evaluate(l,f,_);u.evaluatedColor[w]=[T.r,T.g,T.b,E],u.evaluatedRMEA[w][0]=e.paint.get("model-roughness").evaluate(l,f,_),u.evaluatedRMEA[w][2]=e.paint.get("model-emissive-strength").evaluate(l,f,_),u.evaluatedRMEA[w][3]=T.a,u.emissionHeightBasedParams[w]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,f,_),!u.hasTranslucentParts&&T.a<1&&(u.hasTranslucentParts=!0)}delete l.properties.part,VP(u,b!==u.evaluatedColor[2]||S!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,f,_);u.evaluatedScale=e.paint.get("model-scale").evaluate(l,f,_),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,r,a,u){const l=e.findDEMTileFor(a);if(l&&(l.tileID.canonical!==this.terrainTile||r!==this.terrainExaggeration)){if(l.dem&&l.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=l.tileID.overscaledZ;const f=Jh.create(e,a,l);if(!f)return;this.modelTraits&Yh.HasMapboxMeshFeatures&&this.updateDEM(e,f,a,u);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const S=b.footprint.vertices;let _=f.getElevationAt(S[0].x,S[0].y,!0,!0);for(let w=1;w<S.length;w++)_=Math.min(_,f.getElevationAt(S[w].x,S[w].y,!0,!0));b.elevation=_}}this.terrainTile=l.tileID.canonical,this.terrainExaggeration=r}}updateDEM(e,r,a,u){let l=r._dem._modifiedForSources[u];if(l===void 0&&(r._dem._modifiedForSources[u]=[],l=r._dem._modifiedForSources[u]),l.includes(a.canonical))return;const f=r._dem.dim;l.push(a.canonical);let y=!1;for(const b of this.getNodesInfo()){const S=b.node;if(!S.footprint||!S.footprint.grid)continue;const _=S.footprint.grid,w=r.tileCoordToPixel(_.min.x,_.min.y),A=r.tileCoordToPixel(_.max.x,_.max.y),T=Math.min(Math.min(f-A.y,w.x),Math.min(w.y,f-A.x));if(T<0)continue;const E=Ye(T,2,5);let C=Math.max(0,w.x-E),O=Math.max(0,w.y-E),k=Math.min(A.x+E,f-1),U=Math.min(A.y+E,f-1);for(let W=O;W<=U;++W)for(let K=C;K<=k;++K)lu[W*f+K]=255;let V=0,N=0;for(let W=0;W<_.cellsY;++W)for(let K=0;K<_.cellsX;++K){if(!_.cells[W*_.cellsX+K])continue;const ae=r.tileCoordToPixel(_.min.x+K/_.xScale,_.min.y+W/_.yScale),ie=r.tileCoordToPixel(_.min.x+(K+1)/_.xScale,_.min.y+(W+1)/_.yScale);for(let se=ae.y;se<=Math.min(ie.y+1,f-1);++se)for(let ve=ae.x;ve<=Math.min(ie.x+1,f-1);++ve)lu[se*f+ve]===255&&(lu[se*f+ve]=0,V+=r.getElevationAtPixel(ve,se),N++)}const $=V/N;C=Math.max(1,w.x-E),O=Math.max(1,w.y-E),k=Math.min(A.x+E,f-2),U=Math.min(A.y+E,f-2),y=!0;for(let W=O;W<=U;++W)for(let K=C;K<=k;++K)lu[W*f+K]===0&&(m0[W*f+K]=r._dem.set(K,W,$));for(let W=1;W<E;++W){C=Math.max(1,w.x-W),O=Math.max(1,w.y-W),k=Math.min(A.x+W,f-2),U=Math.min(A.y+W,f-2);for(let K=O;K<=U;++K)for(let ae=C;ae<=k;++ae){const ie=K*f+ae;if(lu[ie]===255){let se=0,ve=0,le=-1,xe=-1;for(let Me=-1;Me<=1;++Me)for(let Se=-1;Se<=1;++Se){const Ce=(K+Me)*f+ae+Se;if(lu[Ce]>=W)continue;const Ie=m0[Ce],Fe=Math.abs(Ie);Fe>ve&&(se=Ie,ve=Fe,le=Se,xe=Me)}if(ve>.1){const Me=1-(W+.5*Math.abs(le*xe))/E;let Se=r._dem.get(ae,K)+se*Me;const Ce=r._dem.get(ae+le,K+xe),Ie=r._dem.get(ae-le,K-xe,!0);(Se-Ce)*(Se-Ie)>0&&(Se=(Ce+Ie)/2),m0[ie]=r._dem.set(ae,K,Se),lu[ie]=W}}}}}y&&(r._demTile.needsDEMTextureUpload=!0,r._dem._timestamp=We.now())}setFilter(e){this.filter=e?Af(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new gn(this.id.overscaledZ),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const r of e)rg(r.node),p0(r.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,r){if(r.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=r.updateTime;const a=r.getReplacementRegionsForTile(e.toUnwrapped()),u=this.getNodesInfo();for(let l=0;l<this.nodesInfo.length;l++){const f=u[l].node;u[l].hiddenByReplacement=!!f.footprint&&!a.find(y=>y.footprint===f.footprint)}}getHeightAtTileCoord(e,r){const a=this.getNodesInfo(),u=[],l=[0,0,0],f=te.mat4.identity([]);for(let y=0;y<this.nodesInfo.length;y++){const b=a[y],S=b.node.meshes[0],_=S.transformedAabb;if(e<_.min[0]||r<_.min[1]||e>_.max[0]||r>_.max[1])continue;if(b.node.hidden===!0)return{height:1/0,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};te.mat4.invert(f,b.node.matrix),l[0]=e,l[1]=r,te.vec3.transformMat4(l,l,f);const w=(l[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*au|0,A=Math.min(63,(l[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*au|0)*au+Math.min(63,w),T=S.heightmap[A];if(!(T<0&&b.node.footprint))return b.hiddenByReplacement?void 0:{height:T,maxHeight:b.feature.properties.height,hidden:!1,verticalScale:b.evaluatedScale[2]};if(b.node.footprint.grid.query(new Ae(e,r),new Ae(e,r),u),u.length>0)return{height:void 0,maxHeight:b.feature.properties.height,hidden:b.hiddenByReplacement,verticalScale:b.evaluatedScale[2]}}}}function xp(o,e){return!o.isLightConstant&&e}function NP(o,e,r,a,u,l,f,y){let b=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,_=240&e|(240&e)>>4;r[3]>0&&(b=or(b,255*r[0],r[3]),S=or(S,255*r[1],r[3]),_=or(_,255*r[2],r[3]));const w=b<<8|S,A=_<<8|Math.floor(255*a[3]),T=function(W){const K=Ye(W,0,2);return Math.min(Math.round(.5*K*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],E=Ye(u[0],0,1),C=Ye(u[1],0,1),O=Ye(u[2],0,1),k=Ye(u[3],0,1);let U,V,N,$;if(E!==C&&f!==l&&C!==E){const W=f-l;V=1/(W*(C-E)),N=-(l+W*E)/(W*(C-E));const K=Ye(u[4],-1,1);$=Math.pow(10,K),U=255*O<<8|255*k}else U=65535,V=0,N=1,$=1;if(o.emplaceBack(w,A,T,U,V,N,$),y){const W=y.length;y.clear();for(let K=0;K<W;K++)y.emplaceBack(w,A,T,U,V,N,$)}}function VP(o,e,r){const a=o.node;let u=0;const l=r&Yh.HasMeshoptCompression;for(const f of a.meshes){if(a.lights&&a.lightMeshIndex===u||!f.featureData)continue;f.featureArray=new Zc,f.featureArray.reserve(f.featureData.length);let y=e;for(const b of f.featureData){const S=l?65535&b:b>>16&65535,_=l?b>>16&65535:65535&b,w=(15&_)<8?15&_:0,A=o.evaluatedRMEA[w],T=o.evaluatedColor[w],E=o.emissionHeightBasedParams[w];let C;if(y&&w===2&&a.lights&&(C=new Zc,C.resize(10*a.lights.length)),NP(f.featureArray,S,T,A,E,f.aabb.min[2],f.aabb.max[2],C),C&&y){y=!1;const O=a.meshes[a.lightMeshIndex];O.featureArray=C,O.featureArray._trim()}}f.featureArray._trim(),u++}}function I2(o,e,r,a){const u=1<<o.z;e.lat=Mi((a/Ct+o.y)/u),e.lng=us((r/Ct+o.x)/u)}Ft(ng,"Tiled3dModelBucket",{omit:["layers"]}),Ft(M2,"Tiled3dModelFeature");const UP={circle:class extends Yi{constructor(o,e,r,a){super(o,{layout:Qe||(Qe=new Nn({"circle-sort-key":new kt(Ue.layout_circle["circle-sort-key"]),"circle-elevation-reference":new bt(Ue.layout_circle["circle-elevation-reference"]),visibility:new bt(Ue.layout_circle.visibility)})),paint:De||(De=new Nn({"circle-radius":new kt(Ue.paint_circle["circle-radius"]),"circle-color":new kt(Ue.paint_circle["circle-color"]),"circle-blur":new kt(Ue.paint_circle["circle-blur"]),"circle-opacity":new kt(Ue.paint_circle["circle-opacity"]),"circle-translate":new bt(Ue.paint_circle["circle-translate"]),"circle-translate-anchor":new bt(Ue.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bt(Ue.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bt(Ue.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new kt(Ue.paint_circle["circle-stroke-width"]),"circle-stroke-color":new kt(Ue.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new kt(Ue.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new bt(Ue.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}createBucket(o){return new Z(o)}queryRadius(o){const e=o;return et("circle-radius",this,e)+et("circle-stroke-width",this,e)+rt(this.paint.get("circle-translate"))}queryIntersectsFeature(o,e,r,a,u,l,f,y){const b=Oe(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),l.angle,o.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return $h(o,a,l,f,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(o,e,r){const a=jh(this);return{config:new sl(this,{zoom:e,lut:r}),defines:a,overrideFog:!1}}},heatmap:class extends Yi{createBucket(o){return new Q1(o)}constructor(o,e,r,a){super(o,{layout:eb||(eb=new Nn({visibility:new bt(Ue.layout_heatmap.visibility)})),paint:tb||(tb=new Nn({"heatmap-radius":new kt(Ue.paint_heatmap["heatmap-radius"]),"heatmap-weight":new kt(Ue.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bt(Ue.paint_heatmap["heatmap-intensity"]),"heatmap-color":new el(Ue.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bt(Ue.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ep({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return et("heatmap-radius",this,o)}queryIntersectsFeature(o,e,r,a,u,l,f,y){const b=this.paint.get("heatmap-radius").evaluate(e,r);return $h(o,a,l,f,y,!0,!0,new Ae(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(o,e,r){return o==="heatmap"?{config:new sl(this,{zoom:e,lut:r}),overrideFog:!1}:{}}},hillshade:class extends Yi{constructor(o,e,r,a){super(o,{layout:rb||(rb=new Nn({visibility:new bt(Ue.layout_hillshade.visibility)})),paint:nb||(nb=new Nn({"hillshade-illumination-direction":new bt(Ue.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bt(Ue.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bt(Ue.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bt(Ue.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bt(Ue.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bt(Ue.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new bt(Ue.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(o,e,r){return{overrideFog:!1}}},fill:class extends Yi{constructor(o,e,r,a){super(o,{layout:wb||(wb=new Nn({"fill-sort-key":new kt(Ue.layout_fill["fill-sort-key"]),visibility:new bt(Ue.layout_fill.visibility),"fill-elevation-reference":new bt(Ue.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new kt(Ue.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Tb||(Tb=new Nn({"fill-antialias":new bt(Ue.paint_fill["fill-antialias"]),"fill-opacity":new kt(Ue.paint_fill["fill-opacity"]),"fill-color":new kt(Ue.paint_fill["fill-color"]),"fill-outline-color":new kt(Ue.paint_fill["fill-outline-color"]),"fill-translate":new bt(Ue.paint_fill["fill-translate"]),"fill-translate-anchor":new bt(Ue.paint_fill["fill-translate-anchor"]),"fill-pattern":new kt(Ue.paint_fill["fill-pattern"]),"fill-emissive-strength":new bt(Ue.paint_fill["fill-emissive-strength"]),"fill-z-offset":new kt(Ue.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new kt(Ue.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new kt(Ue.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}getProgramIds(){const o=this.paint.get("fill-pattern"),e=o&&o.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(o,e,r){return{config:new sl(this,{zoom:e,lut:r}),overrideFog:!1}}recalculate(o,e){super.recalculate(o,e);const r=this.paint._values["fill-outline-color"];r.value.kind==="constant"&&r.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new Lv(o)}queryRadius(){return rt(this.paint.get("fill-translate"))}queryIntersectsFeature(o,e,r,a,u,l){return!o.queryGeometry.isAboveHorizon&&Q(_t(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),l.angle,o.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(o){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return o!=null?e&&!o:e}},"fill-extrusion":class extends Yi{constructor(o,e,r,a){super(o,{layout:Yb||(Yb=new Nn({visibility:new bt(Ue["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new bt(Ue["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Jb||(Jb=new Nn({"fill-extrusion-opacity":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new kt(Ue["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new bt(Ue["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new z_(o)}queryRadius(){return rt(this.paint.get("fill-extrusion-translate"))}is3D(o){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(o,e,r,a,u,l,f,y,b){const S=Oe(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),l.angle,o.pixelToTileUnitsFactor),_=this.paint.get("fill-extrusion-height").evaluate(e,r),w=this.paint.get("fill-extrusion-base").evaluate(e,r),A=[0,0],T=y&&l.elevation,E=l.elevation?l.elevation.exaggeration():1,C=o.tile.getBucket(this);if(T&&C instanceof z_){const N=C.centroidVertexArray,$=b+1;$<N.length&&(A[0]=N.geta_centroid_pos0($),A[1]=N.geta_centroid_pos1($))}if(A[0]===0&&A[1]===1)return!1;l.projection.name==="globe"&&(a=Kb([a],[new Ae(0,0),new Ae(Ct,Ct)],o.tileID.canonical).map(N=>N.polygon).flat());const O=T?y:null,[k,U]=function(N,$,W,K,ae,ie,se,ve,le,xe,Me){return N.projection.name==="globe"?function(Se,Ce,Ie,Fe,ze,Ne,it,nt,Bt,ft,Tt){const at=[],tr=[],Ot=Se.projection.upVectorScale(Tt,Se.center.lat,Se.worldSize).metersToTile,Ht=[0,0,0,1],hr=[0,0,0,1],Mr=(Lr,Sr,Fr,Wr)=>{Lr[0]=Sr,Lr[1]=Fr,Lr[2]=Wr,Lr[3]=1},gr=Xb();Ie>0&&(Ie+=gr),Fe+=gr;for(const Lr of Ce){const Sr=[],Fr=[];for(const Wr of Lr){const yn=Wr.x+ze.x,mr=Wr.y+ze.y,Ur=Se.projection.projectTilePoint(yn,mr,Tt),En=Se.projection.upVector(Tt,Wr.x,Wr.y);let kn=Ie,Gn=Fe;if(it){const Wn=ew(yn,mr,Ie,Fe,it,nt,Bt,ft);kn+=Wn.base,Gn+=Wn.top}Ie!==0?Mr(Ht,Ur.x+En[0]*Ot*kn,Ur.y+En[1]*Ot*kn,Ur.z+En[2]*Ot*kn):Mr(Ht,Ur.x,Ur.y,Ur.z),Mr(hr,Ur.x+En[0]*Ot*Gn,Ur.y+En[1]*Ot*Gn,Ur.z+En[2]*Ot*Gn),te.vec3.transformMat4(Ht,Ht,Ne),te.vec3.transformMat4(hr,hr,Ne),Sr.push(new su(Ht[0],Ht[1],Ht[2])),Fr.push(new su(hr[0],hr[1],hr[2]))}at.push(Sr),tr.push(Fr)}return[at,tr]}(N,$,W,K,ae,ie,se,ve,le,xe,Me):se?function(Se,Ce,Ie,Fe,ze,Ne,it,nt,Bt){const ft=[],Tt=[],at=[0,0,0,1];for(const tr of Se){const Ot=[],Ht=[];for(const hr of tr){const Mr=hr.x+Fe.x,gr=hr.y+Fe.y,Lr=ew(Mr,gr,Ce,Ie,Ne,it,nt,Bt);at[0]=Mr,at[1]=gr,at[2]=Lr.base,at[3]=1,te.vec4.transformMat4(at,at,ze),at[3]=Math.max(at[3],1e-5);const Sr=new su(at[0]/at[3],at[1]/at[3],at[2]/at[3]);at[0]=Mr,at[1]=gr,at[2]=Lr.top,at[3]=1,te.vec4.transformMat4(at,at,ze),at[3]=Math.max(at[3],1e-5);const Fr=new su(at[0]/at[3],at[1]/at[3],at[2]/at[3]);Ot.push(Sr),Ht.push(Fr)}ft.push(Ot),Tt.push(Ht)}return[ft,Tt]}($,W,K,ae,ie,se,ve,le,xe):function(Se,Ce,Ie,Fe,ze){const Ne=[],it=[],nt=ze[8]*Ce,Bt=ze[9]*Ce,ft=ze[10]*Ce,Tt=ze[11]*Ce,at=ze[8]*Ie,tr=ze[9]*Ie,Ot=ze[10]*Ie,Ht=ze[11]*Ie;for(const hr of Se){const Mr=[],gr=[];for(const Lr of hr){const Sr=Lr.x+Fe.x,Fr=Lr.y+Fe.y,Wr=ze[0]*Sr+ze[4]*Fr+ze[12],yn=ze[1]*Sr+ze[5]*Fr+ze[13],mr=ze[2]*Sr+ze[6]*Fr+ze[14],Ur=ze[3]*Sr+ze[7]*Fr+ze[15],En=Wr+nt,kn=yn+Bt,Gn=mr+ft,Wn=Math.max(Ur+Tt,1e-5),fn=Wr+at,gi=yn+tr,ts=mr+Ot,ii=Math.max(Ur+Ht,1e-5);Mr.push(new su(En/Wn,kn/Wn,Gn/Wn)),gr.push(new su(fn/ii,gi/ii,ts/ii))}Ne.push(Mr),it.push(gr)}return[Ne,it]}($,W,K,ae,ie)}(l,a,w,_,S,f,O,A,E,l.center.lat,o.tileID.canonical),V=o.queryGeometry;return function(N,$,W){let K=1/0;Q(W,$)&&(K=Qb(W,$[0]));for(let ae=0;ae<$.length;ae++){const ie=$[ae],se=N[ae];for(let ve=0;ve<ie.length-1;ve++){const le=ie[ve],xe=[le,ie[ve+1],se[ve+1],se[ve],le];H(W,xe)&&(K=Math.min(K,Qb(W,xe)))}}return K!==1/0&&K}(k,U,V.isPointQuery()?V.screenBounds:V.screenGeometry)}},line:class extends Yi{constructor(o,e,r,a){const u=uw();super(o,u,e,r,a),u.layout&&(this.layout=new Bl(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof kr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(o,e){super.recalculate(o,e),this.paint._values["line-floorwidth"]=(()=>{if(cp)return cp;const r=uw();return cp=new U3(r.paint.properties["line-width"].specification),cp.useIntegerZoom=!0,cp})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new Uv(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(o,e,r){const a=lw(this);return{config:new sl(this,{zoom:e,lut:r}),defines:a,overrideFog:!1}}queryRadius(o){const e=o,r=hw(et("line-width",this,e),et("line-gap-width",this,e)),a=et("line-offset",this,e);return r/2+Math.abs(a)+rt(this.paint.get("line-translate"))}queryIntersectsFeature(o,e,r,a,u,l){if(o.queryGeometry.isAboveHorizon)return!1;const f=_t(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),l.angle,o.pixelToTileUnitsFactor),y=o.pixelToTileUnitsFactor/2*hw(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(a=function(S,_){const w=[],A=new Ae(0,0);for(let T=0;T<S.length;T++){const E=S[T],C=[];for(let O=0;O<E.length;O++){const k=E[O],U=E[O+1],V=O===0?A:k.sub(E[O-1])._unit()._perp(),N=O===E.length-1?A:U.sub(k)._unit()._perp(),$=V._add(N)._unit();$._mult(1/($.x*N.x+$.y*N.y)),C.push($._mult(_)._add(k))}w.push(C)}return w}(a,b*o.pixelToTileUnitsFactor)),function(S,_,w){for(let A=0;A<_.length;A++){const T=_[A];if(S.length>=3){for(let E=0;E<T.length;E++)if(pe(S,T[E]))return!0}if(oe(S,T,w))return!0}return!1}(f,a,y)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(o){return!this.hasElevatedBuckets}},symbol:X_,background:class extends Yi{constructor(o,e,r,a){super(o,{layout:Qw||(Qw=new Nn({visibility:new bt(Ue.layout_background.visibility)})),paint:e2||(e2=new Nn({"background-pitch-alignment":new bt(Ue.paint_background["background-pitch-alignment"]),"background-color":new bt(Ue.paint_background["background-color"]),"background-pattern":new bt(Ue.paint_background["background-pattern"]),"background-opacity":new bt(Ue.paint_background["background-opacity"]),"background-emissive-strength":new bt(Ue.paint_background["background-emissive-strength"]),"background-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(o,e,r){return{overrideFog:!1}}is3D(o){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:s2,"raster-particle":h2,sky:class extends Yi{constructor(o,e,r,a){super(o,{layout:l2||(l2=new Nn({visibility:new bt(Ue.layout_sky.visibility)})),paint:c2||(c2=new Nn({"sky-type":new bt(Ue.paint_sky["sky-type"]),"sky-atmosphere-sun":new bt(Ue.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new bt(Ue.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new bt(Ue.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new bt(Ue.paint_sky["sky-gradient-radius"]),"sky-gradient":new el(Ue.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new bt(Ue.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new bt(Ue.paint_sky["sky-atmosphere-color"]),"sky-opacity":new bt(Ue.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="sky-gradient"?this._updateColorRamp():o!=="sky-atmosphere-sun"&&o!=="sky-atmosphere-halo-color"&&o!=="sky-atmosphere-color"&&o!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ep({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(o,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,l=o.style.light,f=l.properties.get("position");return u&&l.properties.get("anchor")==="viewport"&&Pr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?c0(f.azimuthal,90-f.polar,e):c0(a[0],90-a[1],e)}const r=this.paint.get("sky-gradient-center");return c0(r[0],90-r[1],e)}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return o==="atmosphere"?["skyboxCapture","skybox"]:o==="gradient"?["skyboxGradient"]:null}},slot:class extends Yi{constructor(o,e,r,a){super(o,{paint:u2||(u2=new Nn({}))},e,null)}},model:class extends Yi{constructor(o,e,r,a){super(o,{layout:b2||(b2=new Nn({visibility:new bt(Ue.layout_model.visibility),"model-id":new kt(Ue.layout_model["model-id"])})),paint:w2||(w2=new Nn({"model-opacity":new kt(Ue.paint_model["model-opacity"]),"model-rotation":new kt(Ue.paint_model["model-rotation"]),"model-scale":new kt(Ue.paint_model["model-scale"]),"model-translation":new kt(Ue.paint_model["model-translation"]),"model-color":new kt(Ue.paint_model["model-color"]),"model-color-mix-intensity":new kt(Ue.paint_model["model-color-mix-intensity"]),"model-type":new bt(Ue.paint_model["model-type"]),"model-cast-shadows":new bt(Ue.paint_model["model-cast-shadows"]),"model-receive-shadows":new bt(Ue.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new bt(Ue.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new kt(Ue.paint_model["model-emissive-strength"]),"model-roughness":new kt(Ue.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new kt(Ue.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new bt(Ue.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new bt(Ue.paint_model["model-front-cutoff"]),"model-color-use-theme":new kt({type:"string",default:"default","property-type":"data-driven"})}))},e,r,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(o){return new d0(o)}getProgramIds(){return["model"]}is3D(o){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(o){return o instanceof ng?Ct-1:0}queryIntersectsFeature(o,e,r,a,u,l){if(!this.modelManager)return!1;const f=this.modelManager,y=o.tile.getBucket(this);if(!(y&&y instanceof d0))return!1;for(const b in y.instancesPerModel){const S=y.instancesPerModel[b],_=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(S.idToFeaturesIndex.hasOwnProperty(_)){const w=S.features[S.idToFeaturesIndex[_]],A=f.getModel(b,this.scope);if(!A)return!1;let T=te.mat4.create();const E=new Xr(0,0),C=y.canonical;let O=Number.MAX_VALUE;for(let k=0;k<w.instancedDataCount;++k){const U=16*(w.instancedDataOffset+k),V=S.instancedDataArray.float32,N=[V[U+4],V[U+5],V[U+6]];I2(C,E,V[U],0|V[U+1]),T2(T,A,l,E,w.rotation,w.scale,N,!1,!1,!1),l.projection.name==="globe"&&(T=h0(T,l));const $=te.mat4.multiply([],l.projMatrix,T),W=o.queryGeometry,K=_2(W.isPointQuery()?W.screenBounds:W.screenGeometry,l,$,A.aabb);K!=null&&(O=Math.min(K,O))}return O!==Number.MAX_VALUE&&O}}return!1}_handleOverridablePaintPropertyUpdate(o,e,r){return!(!this.layout||e.isDataDriven()||r.isDataDriven()||o!=="model-color"&&o!=="model-color-mix-intensity"&&o!=="model-rotation"&&o!=="model-scale"&&o!=="model-translation"&&o!=="model-emissive-strength")}_isPropertyZoomDependent(o){const e=this._transitionablePaint._values[o];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof zl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Yi{constructor(o,e,r,a){super(o,{layout:Sb||(Sb=new Nn({"clip-layer-types":new bt(Ue.layout_clip["clip-layer-types"]),"clip-layer-scope":new bt(Ue.layout_clip["clip-layer-scope"])})),paint:Eb||(Eb=new Nn({}))},e,r,a)}recalculate(o,e){super.recalculate(o,e)}createBucket(o){return new Ab(o)}is3D(o){return!0}}};class jP{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class $P{constructor(){this.tasks={},this.taskQueue=[],ki(["process"],this),this.invoker=new jP(this.process),this.nextId=0}add(e,r){const a=this.nextId++,u=function({type:l,isSymbolTile:f,zoom:y}){return y=y||0,l==="message"?0:l!=="maybePrepare"||f?l!=="parseTile"||f?l==="parseTile"&&f?300-y:l==="maybePrepare"&&f?400-y:500:200-y:100-y}(r);if(u===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:r,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let u=0;u<this.taskQueue.length;u++){const l=this.tasks[this.taskQueue[u]];l.priority<r&&(r=l.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class C2{constructor(e,r,a){this.target=e,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},ki(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new $P}send(e,r,a,u,l=!1,f){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=f,this.callbacks[y]=a);const b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!a,targetMapId:u,mustQueue:l,sourceMapId:this.mapId,data:Ss(r,b)},b),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const r=e.data;if(!r)return;const a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(r.mustQueue||Va()){const u=this.callbacks[a],l=this.scheduler.add(()=>this.processTask(a,r),u&&u.metadata||{type:"message"});l&&(this.cancelCallbacks[a]=l)}else this.processTask(a,r)}processTask(e,r){if(delete this.cancelCallbacks[e],r.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(r.error?a(ba(r.error)):a(null,ba(r.data)))}else{const a=new Set,u=r.hasCallback?(f,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?Ss(f):null,data:Ss(y,a)},a)}:()=>{},l=ba(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,l,u);else if(this.parent.getWorkerSource){const f=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,f[0],l.source,l.scope)[f[1]](l,u)}else u(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var bp={workerUrl:"",workerClass:null,workerParams:void 0};const _0="mapboxgl_preloaded_worker_pool";class cu{constructor(){this.active={}}acquire(e,r=cu.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<r;)this.workers.push(bp.workerClass!=null?new bp.workerClass:new self.Worker(bp.workerUrl,bp.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(r=>{r.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_0]}numActive(){return Object.keys(this.active).length}}cu.workerCount=2;class Qh{constructor(e,r,a="Worker",u=cu.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ri();const l=this.workerPool.acquire(this.id,u);for(let f=0;f<l.length;f++){const y=new Qh.Actor(l[f],r,this.id);y.name=`${a} ${f}`,this.actors.push(y)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,r,a){_n(this.actors,(u,l)=>{u.send(e,r,l)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let wp,g0;function ig(){return wp||(wp=new cu),wp}Qh.Actor=C2;const y0=new tn(0,0,0);var v0=(o=>(o[o.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",o[o.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",o[o.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",o))(v0||{}),sg=(o=>(o[o.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",o[o.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",o[o.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",o[o.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",o))(sg||{}),Tp=(o=>(o[o.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",o[o.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",o[o.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",o[o.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",o[o.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",o))(Tp||{}),P2=(o=>(o[o.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",o[o.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",o[o.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",o))(P2||{}),ed=(o=>(o[o.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",o[o.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",o[o.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",o[o.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",o[o.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",o[o.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",o))(ed||{}),R2=(o=>(o[o.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",o[o.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",o[o.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",o))(R2||{});function GP(o,e,r){o===1&&e.icons.push(function(a,u){return function(l){if(l.usvg_tree.height||(l.usvg_tree.height=l.usvg_tree.width),!l.metadata)return l;const{metadata:f}=l;if(f.content_area){const{content_area:y}=f;y.top==null&&(y.top=y.left),y.width==null&&(y.width=l.usvg_tree.width),y.height==null&&(y.height=y.width)}return f.stretch_x&&f.stretch_x.length&&D2(f,"x"),f.stretch_y&&f.stretch_y.length&&D2(f,"y"),l}(a.readFields(qP,{name:void 0},u))}(r,r.readVarint()+r.pos))}function D2(o,e){const r=[],a=o[`stretch_${e}`];let u=null;for(let l=0;l<a.length;l++)u===null?u=r.length===0?a[0]:r[r.length-1][1]+a[l]:(r.push([u,u+a[l]]),u=null);o[`stretch_${e}_areas`]=r}function qP(o,e,r){o===1?e.name=r.readString():o===2?e.metadata=function(a,u){return a.readFields(HP,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)}(r,r.readVarint()+r.pos):o===3&&(e.usvg_tree=function(a,u){return a.readFields(XP,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)}(r,r.readVarint()+r.pos),e.data="usvg_tree")}function HP(o,e,r){o===1?e.stretch_x=r.readPackedVarint():o===2?e.stretch_y=r.readPackedVarint():o===3?e.content_area=function(a,u){return a.readFields(WP,{left:0},u)}(r,r.readVarint()+r.pos):o===4&&e.variables.push(function(a,u){return a.readFields(ZP,{name:void 0},u)}(r,r.readVarint()+r.pos))}function WP(o,e,r){o===1?e.left=r.readVarint():o===2?e.width=r.readVarint():o===3?e.top=r.readVarint():o===4&&(e.height=r.readVarint())}function ZP(o,e,r){o===1?e.name=r.readString():o===2&&(e.rgb_color=lg(r.readVarint()),e.value="rgb_color")}function XP(o,e,r){o===1?e.width=e.height=r.readVarint():o===2?e.height=r.readVarint():o===3?e.children.push(og(r,r.readVarint()+r.pos)):o===4?e.linear_gradients.push(function(a,u){return a.readFields(rR,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)}(r,r.readVarint()+r.pos)):o===5?e.radial_gradients.push(function(a,u){return a.readFields(iR,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)}(r,r.readVarint()+r.pos)):o===7?e.clip_paths.push(function(a,u){return a.readFields(sR,{children:[]},u)}(r,r.readVarint()+r.pos)):o===8&&e.masks.push(function(a,u){const l=a.readFields(oR,{left:0,width:20,mask_type:1,children:[]},u);return l.height==null&&(l.height=l.width),l.top==null&&(l.top=l.left),l}(r,r.readVarint()+r.pos))}function og(o,e){return o.readFields(KP,{},e)}function KP(o,e,r){o===1?(e.group=function(a,u){return a.readFields(YP,{opacity:255,children:[]},u)}(r,r.readVarint()+r.pos),e.node="group"):o===2&&(e.path=function(a,u){return a.readFields(QP,{paint_order:1,commands:[],step:1,diffs:[],rule:1},u)}(r,r.readVarint()+r.pos),e.node="path")}function YP(o,e,r){o===1?e.transform=ag(r,r.readVarint()+r.pos):o===2?e.opacity=r.readVarint():o===5?e.clip_path_idx=r.readVarint():o===6?e.mask_idx=r.readVarint():o===7&&e.children.push(og(r,r.readVarint()+r.pos))}function ag(o,e){return o.readFields(JP,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function JP(o,e,r){o===1?e.sx=r.readFloat():o===2?e.ky=r.readFloat():o===3?e.kx=r.readFloat():o===4?e.sy=r.readFloat():o===5?e.tx=r.readFloat():o===6&&(e.ty=r.readFloat())}function QP(o,e,r){o===1?e.fill=function(a,u){return a.readFields(eR,{rgb_color:y0,paint:"rgb_color",opacity:255},u)}(r,r.readVarint()+r.pos):o===2?e.stroke=function(a,u){return a.readFields(tR,{rgb_color:y0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)}(r,r.readVarint()+r.pos):o===3?e.paint_order=r.readVarint():o===5?r.readPackedVarint(e.commands):o===6?e.step=r.readFloat():o===7?r.readPackedSVarint(e.diffs):o===8&&(e.rule=r.readVarint())}function eR(o,e,r){o===1?(e.rgb_color=lg(r.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):o===5&&(e.opacity=r.readVarint())}function lg(o){return new tn((o>>16&255)/255,(o>>8&255)/255,(255&o)/255,1)}function tR(o,e,r){o===1?(e.rgb_color=lg(r.readVarint()),e.paint="rgb_color"):o===2?(e.linear_gradient_idx=r.readVarint(),e.paint="linear_gradient_idx"):o===3?(e.radial_gradient_idx=r.readVarint(),e.paint="radial_gradient_idx"):o===5?r.readPackedFloat(e.dasharray):o===6?e.dashoffset=r.readFloat():o===7?e.miterlimit=r.readFloat():o===8?e.opacity=r.readVarint():o===9?e.width=r.readFloat():o===10?e.linecap=r.readVarint():o===11&&(e.linejoin=r.readVarint())}function rR(o,e,r){o===1?e.transform=ag(r,r.readVarint()+r.pos):o===2?e.spread_method=r.readVarint():o===3?e.stops.push(z2(r,r.readVarint()+r.pos)):o===4?e.x1=r.readFloat():o===5?e.y1=r.readFloat():o===6?e.x2=r.readFloat():o===7&&(e.y2=r.readFloat())}function z2(o,e){return o.readFields(nR,{offset:0,opacity:255,rgb_color:y0},e)}function nR(o,e,r){o===1?e.offset=r.readFloat():o===2?e.opacity=r.readVarint():o===3&&(e.rgb_color=lg(r.readVarint()))}function iR(o,e,r){o===1?e.transform=ag(r,r.readVarint()+r.pos):o===2?e.spread_method=r.readVarint():o===3?e.stops.push(z2(r,r.readVarint()+r.pos)):o===4?e.cx=r.readFloat():o===5?e.cy=r.readFloat():o===6?e.r=r.readFloat():o===7?e.fx=r.readFloat():o===8?e.fy=r.readFloat():o===9&&(e.fr=r.readFloat())}function sR(o,e,r){o===1?e.transform=ag(r,r.readVarint()+r.pos):o===2?e.clip_path_idx=r.readVarint():o===3&&e.children.push(og(r,r.readVarint()+r.pos))}function oR(o,e,r){o===1?e.left=e.top=r.readFloat():o===2?e.width=e.height=r.readFloat():o===3?e.top=r.readFloat():o===4?e.height=r.readFloat():o===5?e.mask_type=r.readVarint():o===6?e.mask_idx=r.readVarint():o===7&&e.children.push(og(r,r.readVarint()+r.pos))}class aR{static calculate(e={},r=[]){const a=new Map,u=new Map;if(Object.keys(e).length===0)return a;r.forEach(l=>{u.set(l.name,l.rgb_color||new tn(0,0,0))});for(const[l,f]of Object.entries(e))u.has(l)?a.set(u.get(l).toStringPremultipliedAlpha(),f):console.warn(`Ignoring unknown image variable "${l}"`);return a}}function td(o,e=255,r){const a=e/255,u=o.toStringPremultipliedAlpha(),l=r.has(u)?r.get(u).clone():o.clone();return l.a*=a,l.toString()}function Sp(o,e){if(!Ke()){const r=document.createElement("canvas");return r.width=o,r.height=e,r}return new OffscreenCanvas(o,e)}function lR(o,e){const r=aR.calculate(e.params,o.metadata?o.metadata.variables:[]),a=o.usvg_tree,u=a.width,l=a.height,f=e.transform?e.transform:new DOMMatrix,y=Math.max(1,Math.round(u*f.a)),b=Math.max(1,Math.round(l*f.d)),S=new DOMMatrix([y/u,0,0,b/l,0,0]),_=Sp(y,b).getContext("2d");return x0(_,S,a,a,r),_.getImageData(0,0,y,b)}function x0(o,e,r,a,u){for(const l of a.children)L2(o,e,r,l,u)}function L2(o,e,r,a,u){a.group?(o.save(),function(l,f,y,b,S){const _=b.mask_idx!=null?y.masks[b.mask_idx]:null,w=b.clip_path_idx!=null?y.clip_paths[b.clip_path_idx]:null;if(b.transform&&(f=cg(b.transform).preMultiplySelf(f)),!function(E,C,O){return E.opacity!==255||C||O}(b,w!=null,_!=null))return void x0(l,f,y,b,S);const A=Sp(l.canvas.width,l.canvas.height),T=A.getContext("2d");x0(T,f,y,b,S),w&&U2(T,f,y,w),_&&j2(T,f,y,_,S),l.globalAlpha=b.opacity/255,l.drawImage(A,0,0)}(o,e,r,a.group,u),o.restore()):a.path&&(o.save(),function(l,f,y,b,S){const _=$2(b);l.setTransform(f),b.paint_order===P2.PAINT_ORDER_FILL_AND_STROKE?(O2(l,y,b,_,S),F2(l,y,b,_,S)):(F2(l,y,b,_,S),O2(l,y,b,_,S))}(o,e,r,a.path,u),o.restore())}function O2(o,e,r,a,u){const l=r.fill;if(!l)return;const f=l.opacity/255;switch(l.paint){case"rgb_color":o.fillStyle=td(l.rgb_color,l.opacity,u);break;case"linear_gradient_idx":o.fillStyle=B2(o,e.linear_gradients[l.linear_gradient_idx],f,u);break;case"radial_gradient_idx":o.fillStyle=N2(o,e.radial_gradients[l.radial_gradient_idx],f,u)}o.fill(a,k2(r))}function k2(o){return o.rule===v0.PATH_RULE_NON_ZERO?"nonzero":o.rule===v0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function F2(o,e,r,a,u){const l=r.stroke;if(!l)return;o.lineWidth=l.width,o.miterLimit=l.miterlimit,o.setLineDash(l.dasharray),o.lineDashOffset=l.dashoffset;const f=l.opacity/255;switch(l.paint){case"rgb_color":o.strokeStyle=td(l.rgb_color,l.opacity,u);break;case"linear_gradient_idx":o.strokeStyle=B2(o,e.linear_gradients[l.linear_gradient_idx],f,u);break;case"radial_gradient_idx":o.strokeStyle=N2(o,e.radial_gradients[l.radial_gradient_idx],f,u)}switch(l.linejoin){case Tp.LINE_JOIN_MITER_CLIP:case Tp.LINE_JOIN_MITER:o.lineJoin="miter";break;case Tp.LINE_JOIN_ROUND:o.lineJoin="round";break;case Tp.LINE_JOIN_BEVEL:o.lineJoin="bevel"}switch(l.linecap){case sg.LINE_CAP_BUTT:o.lineCap="butt";break;case sg.LINE_CAP_ROUND:o.lineCap="round";break;case sg.LINE_CAP_SQUARE:o.lineCap="square"}o.stroke(a)}function B2(o,e,r,a){if(e.stops.length===1){const A=e.stops[0];return td(A.rgb_color,A.opacity*r,a)}const u=cg(e.transform),{x1:l,y1:f,x2:y,y2:b}=e,S=u.transformPoint(new DOMPoint(l,f)),_=u.transformPoint(new DOMPoint(y,b)),w=o.createLinearGradient(S.x,S.y,_.x,_.y);for(const A of e.stops)w.addColorStop(A.offset,td(A.rgb_color,A.opacity*r,a));return w}function N2(o,e,r,a){if(e.stops.length===1){const A=e.stops[0];return td(A.rgb_color,A.opacity*r,a)}const u=cg(e.transform),{fx:l,fy:f,cx:y,cy:b}=e,S=u.transformPoint(new DOMPoint(l,f)),_=u.transformPoint(new DOMPoint(y,b)),w=o.createRadialGradient(S.x,S.y,0,_.x,_.y,e.r*((u.a+u.d)/2));for(const A of e.stops)w.addColorStop(A.offset,td(A.rgb_color,A.opacity*r,a));return w}function V2(o,e,r,a){const u=a.transform?cg(a.transform).preMultiplySelf(e):e,l=Sp(o.canvas.width,o.canvas.height),f=l.getContext("2d");for(const b of a.children)if(b.group)V2(f,u,r,b.group);else if(b.path){const S=b.path,_=new Path2D;_.addPath($2(S),u),f.fill(_,k2(S))}const y=a.clip_path_idx!=null?r.clip_paths[a.clip_path_idx]:null;y&&U2(f,u,r,y),o.globalCompositeOperation="source-over",o.drawImage(l,0,0)}function U2(o,e,r,a){const u=Sp(o.canvas.width,o.canvas.height);V2(u.getContext("2d"),e,r,a),o.globalCompositeOperation="destination-in",o.drawImage(u,0,0)}function j2(o,e,r,a,u){if(a.children.length===0)return;const l=a.mask_idx!=null?r.masks[a.mask_idx]:null;l&&j2(o,e,r,l,u);const f=o.canvas.width,y=o.canvas.height,b=Sp(f,y),S=b.getContext("2d"),_=a.width,w=a.height,A=a.left,T=a.top,E=new Path2D,C=new Path2D;C.rect(A,T,_,w),E.addPath(C,e),S.clip(E);for(const U of a.children)L2(S,e,r,U,u);const O=S.getImageData(0,0,f,y),k=O.data;if(a.mask_type===R2.MASK_TYPE_LUMINANCE)for(let U=0;U<k.length;U+=4)k[U+3]=k[U+3]/255*(.2126*k[U]+.7152*k[U+1]+.0722*k[U+2]);S.putImageData(O,0,0),o.globalCompositeOperation="destination-in",o.drawImage(b,0,0)}function cg(o){return o?new DOMMatrix([o.sx,o.ky,o.kx,o.sy,o.tx,o.ty]):new DOMMatrix}function $2(o){const e=new Path2D,r=o.step;let a=o.diffs[0]*r,u=o.diffs[1]*r;e.moveTo(a,u);for(let l=0,f=2;l<o.commands.length;l++)switch(o.commands[l]){case ed.PATH_COMMAND_MOVE:a+=o.diffs[f++]*r,u+=o.diffs[f++]*r,e.moveTo(a,u);break;case ed.PATH_COMMAND_LINE:a+=o.diffs[f++]*r,u+=o.diffs[f++]*r,e.lineTo(a,u);break;case ed.PATH_COMMAND_QUAD:{const y=a+o.diffs[f++]*r,b=u+o.diffs[f++]*r;a=y+o.diffs[f++]*r,u=b+o.diffs[f++]*r,e.quadraticCurveTo(y,b,a,u);break}case ed.PATH_COMMAND_CUBIC:{const y=a+o.diffs[f++]*r,b=u+o.diffs[f++]*r,S=y+o.diffs[f++]*r,_=b+o.diffs[f++]*r;a=S+o.diffs[f++]*r,u=_+o.diffs[f++]*r,e.bezierCurveTo(y,b,S,_,a,u);break}case ed.PATH_COMMAND_CLOSE:e.closePath()}return e}class ug{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const r=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,r),r}put(e,r){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,r)}delete(e){this.cache.delete(e)}}Ft(ug,"LRUCache");class b0{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Li(e,e.data)}getFromCache(e,r,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new ug(150)),this.cacheMap.get(a).get(Es(e.toString(),r))}setInCache(e,r,a,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new ug(150));const l=this.cacheDependenciesMap.get(u),f=Es(e.id.toString(),a);l.get(f)||l.set(f,new Set);const y=this.cacheMap.get(u),b=e.toString();l.get(f).add(b),y.put(Es(e.toString(),a),r)}removeImagesFromCacheByIds(e,r,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const u=this.cacheMap.get(a),l=this.cacheDependenciesMap.get(a);for(const f of e){const y=Es(f.toString(),r);if(l.has(y)){for(const b of l.get(y))u.delete(b);l.delete(y)}}}rasterize(e,r,a,u,l=lR){const f=this.getFromCache(e,a,u);if(f)return f.clone();const y=l(r.icon,e.options),b=b0._getImage(y);return this.setInCache(e,b,a,u),b.clone()}}class G2{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const a=this.toIdx(e,r);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function q2(o,e,r,a){let u=0,l=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(a[f])<1e-15){if(r[f]<o[f]||r[f]>e[f])return null}else{const y=1/a[f];let b=(o[f]-r[f])*y,S=(e[f]-r[f])*y;if(b>S){const _=b;b=S,S=_}if(b>u&&(u=b),S<l&&(l=S),u>l)return null}return u}function H2(o,e,r,a,u,l,f,y,b,S,_){const w=a-o,A=u-e,T=l-r,E=f-o,C=y-e,O=b-r,k=_[1]*O-_[2]*C,U=_[2]*E-_[0]*O,V=_[0]*C-_[1]*E,N=w*k+A*U+T*V;if(Math.abs(N)<1e-15)return null;const $=1/N,W=S[0]-o,K=S[1]-e,ae=S[2]-r,ie=(W*k+K*U+ae*V)*$;if(ie<0||ie>1)return null;const se=K*T-ae*A,ve=ae*w-W*T,le=W*A-K*w,xe=(_[0]*se+_[1]*ve+_[2]*le)*$;return xe<0||ie+xe>1?null:(E*se+C*ve+O*le)*$}function W2(o,e,r){return(o-e)/(r-e)}function Z2(o,e,r,a,u,l,f,y,b){const S=1<<r,_=l-a,w=f-u,A=(o+1)/S*_+a,T=(e+0)/S*w+u,E=(e+1)/S*w+u;y[0]=(o+0)/S*_+a,y[1]=T,b[0]=A,b[1]=E}class X2{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(l){const f=Math.ceil(Math.log2(l.dim/8)),y=[];let b=Math.ceil(Math.pow(2,f));const S=1/b,_=(T,E,C,O,k)=>{const U=O?1:0,V=(T+1)*C-U,N=E*C,$=(E+1)*C-U;k[0]=T*C,k[1]=N,k[2]=V,k[3]=$};let w=new G2(b);const A=[];for(let T=0;T<b*b;T++){_(T%b,Math.floor(T/b),S,!1,A);const E=Ql(A[0],A[1],l),C=Ql(A[2],A[1],l),O=Ql(A[2],A[3],l),k=Ql(A[0],A[3],l);w.minimums.push(Math.min(E,C,O,k)),w.maximums.push(Math.max(E,C,O,k)),w.leaves.push(1)}for(y.push(w),b/=2;b>=1;b/=2){const T=y[y.length-1];w=new G2(b);for(let E=0;E<b*b;E++){_(E%b,Math.floor(E/b),2,!0,A);const C=T.getElevation(A[0],A[1]),O=T.getElevation(A[2],A[1]),k=T.getElevation(A[2],A[3]),U=T.getElevation(A[0],A[3]),V=T.isLeaf(A[0],A[1]),N=T.isLeaf(A[2],A[1]),$=T.isLeaf(A[2],A[3]),W=T.isLeaf(A[0],A[3]),K=Math.min(C.min,O.min,k.min,U.min),ae=Math.max(C.max,O.max,k.max,U.max),ie=V&&N&&$&&W;w.maximums.push(ae),w.minimums.push(K),w.leaves.push(ae-K<=5&&ie?1:0)}y.push(w)}return y}(this.dem),a=r.length-1,u=r[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(r,0,0,a,0)}raycastRoot(e,r,a,u,l,f,y=1){return q2([e,r,-100],[a,u,this.maximums[0]*y],l,f)}raycast(e,r,a,u,l,f,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,a,u,l,f,y);if(b==null)return null;const S=[],_=[],w=[],A=[],T=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;T.length>0;){const{idx:E,t:C,nodex:O,nodey:k,depth:U}=T.pop();if(this.leaves[E]){Z2(O,k,U,e,r,a,u,w,A);const N=1<<U,$=(O+0)/N,W=(O+1)/N,K=(k+0)/N,ae=(k+1)/N,ie=Ql($,K,this.dem)*y,se=Ql(W,K,this.dem)*y,ve=Ql(W,ae,this.dem)*y,le=Ql($,ae,this.dem)*y,xe=H2(w[0],w[1],ie,A[0],w[1],se,A[0],A[1],ve,l,f),Me=H2(A[0],A[1],ve,w[0],A[1],le,w[0],w[1],ie,l,f),Se=Math.min(xe!==null?xe:Number.MAX_VALUE,Me!==null?Me:Number.MAX_VALUE);if(Se!==Number.MAX_VALUE)return Se;{const Ce=te.vec3.scaleAndAdd([],l,f,C);if(K2(ie,se,le,ve,W2(Ce[0],w[0],A[0]),W2(Ce[1],w[1],A[1]))>=Ce[2])return C}continue}let V=0;for(let N=0;N<this._siblingOffset.length;N++){Z2((O<<1)+this._siblingOffset[N][0],(k<<1)+this._siblingOffset[N][1],U+1,e,r,a,u,w,A),w[2]=-100,A[2]=this.maximums[this.childOffsets[E]+N]*y;const $=q2(w,A,l,f);if($!=null){const W=$;S[N]=W;let K=!1;for(let ae=0;ae<V&&!K;ae++)W>=S[_[ae]]&&(_.splice(ae,0,N),K=!0);K||(_[V]=N),V++}}for(let N=0;N<V;N++){const $=_[N];T.push({idx:this.childOffsets[E]+$,t:S[$],nodex:(O<<1)+this._siblingOffset[$][0],nodey:(k<<1)+this._siblingOffset[$][1],depth:U+1})}}return null}_addNode(e,r,a){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,a,u,l){if(e[u].isLeaf(r,a)===1)return;this.childOffsets[l]||(this.childOffsets[l]=this.nodeCount);const f=u-1,y=e[f];let b=0,S=0;for(let _=0;_<this._siblingOffset.length;_++){const w=2*r+this._siblingOffset[_][0],A=2*a+this._siblingOffset[_][1],T=y.getElevation(w,A),E=y.isLeaf(w,A),C=this._addNode(T.min,T.max,E);E&&(b|=1<<_),S||(S=C)}for(let _=0;_<this._siblingOffset.length;_++)b&1<<_||this._construct(e,2*r+this._siblingOffset[_][0],2*a+this._siblingOffset[_][1],f,S+_)}}function K2(o,e,r,a,u,l){return or(or(o,r,l),or(e,a,l),u)}function Ql(o,e,r){const a=r.dim,u=Ye(o*a-.5,0,a-1),l=Ye(e*a-.5,0,a-1),f=Math.floor(u),y=Math.floor(l),b=Math.min(f+1,a-1),S=Math.min(y+1,a-1);return K2(r.get(f,y),r.get(b,y),r.get(f,S),r.get(b,S),u-f,l-y)}const cR={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function uR(o,e,r){return(256*o*256+256*e+r)/10-1e4}function hR(o,e,r){return 256*o+e+r/256-32768}class hg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,a,u=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Pr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const l=this.dim=r.height-2,f=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.floatView=new Float32Array(r.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<l;b++)f[this._idx(-1,b)]=f[this._idx(0,b)],f[this._idx(l,b)]=f[this._idx(l-1,b)],f[this._idx(b,-1)]=f[this._idx(b,0)],f[this._idx(b,l)]=f[this._idx(b,l-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(l,-1)]=f[this._idx(l-1,0)],f[this._idx(-1,l)]=f[this._idx(0,l-1)],f[this._idx(l,l)]=f[this._idx(l-1,l-1)]}const y=a==="terrarium"?hR:uR;for(let b=0;b<f.length;++b){const S=4*b;this.floatView[b]=y(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=We.now()}_buildQuadTree(){this._tree=new X2(this)}get(e,r,a=!1){a&&(e=Ye(e,-1,this.dim),r=Ye(r,-1,this.dim));const u=this._idx(e,r);return this.floatView[u]}set(e,r,a){const u=this._idx(e,r),l=this.floatView[u];return this.floatView[u]=a,a-l}static getUnpackVector(e){return cR[e]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}static pack(e,r){const a=[0,0,0,0],u=hg.getUnpackVector(r);let l=Math.floor((e+u[3])/u[2]);return a[2]=l%256,l=Math.floor(l/256),a[1]=l%256,l=Math.floor(l/256),a[0]=l,a}getPixels(){return new ob({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,r,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=r*this.dim,l=r*this.dim+this.dim,f=a*this.dim,y=a*this.dim+this.dim;switch(r){case-1:u=l-1;break;case 1:l=u+1}switch(a){case-1:f=y-1;break;case 1:y=f+1}const b=-r*this.dim,S=-a*this.dim;for(let _=f;_<y;_++)for(let w=u;w<l;w++){const A=4*this._idx(w,_),T=4*this._idx(w+b,_+S);this.pixels[A+0]=e.pixels[T+0],this.pixels[A+1]=e.pixels[T+1],this.pixels[A+2]=e.pixels[T+2],this.pixels[A+3]=e.pixels[T+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function dR(o,e,r){o===1?e.headerLength=r.readFixed32():o===2?e.x=r.readVarint():o===3?e.y=r.readVarint():o===4?e.z=r.readVarint():o===5&&e.layers.push(function(a,u){return a.readFields(gR,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)}(r,r.readVarint()+r.pos))}function fR(o,e,r){o===1?(e.delta_filter=function(a,u){return a.readFields(pR,{blockSize:0},u)}(r,r.readVarint()+r.pos),e.filter="delta_filter"):o===2?(r.readVarint(),e.filter="zigzag_filter"):o===3?(r.readVarint(),e.filter="bitshuffle_filter"):o===4&&(r.readVarint(),e.filter="byteshuffle_filter")}function pR(o,e,r){o===1&&(e.blockSize=r.readVarint())}function mR(o,e,r){o===1?(r.readVarint(),e.codec="gzip_data"):o===2?(r.readVarint(),e.codec="jpeg_image"):o===3?(r.readVarint(),e.codec="webp_image"):o===4&&(r.readVarint(),e.codec="png_image")}function _R(o,e,r){let a=0,u=0;o===1?e.firstByte=r.readFixed64():o===2?e.lastByte=r.readFixed64():o===3?e.filters.push(function(l,f){return l.readFields(fR,{},f)}(r,r.readVarint()+r.pos)):o===4?e.codec=function(l,f){return l.readFields(mR,{},f)}(r,r.readVarint()+r.pos):o===5?u=r.readFloat():o===6?a=r.readFloat():o===7?e.bands.push(r.readString()):o===8?e.offset=r.readDouble():o===9&&(e.scale=r.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=a)}function gR(o,e,r){o===1?e.version=r.readVarint():o===2?e.name=r.readString():o===3?e.units=r.readString():o===4?e.tileSize=r.readVarint():o===5?e.buffer=r.readVarint():o===6?e.pixelFormat=r.readVarint():o===7&&e.dataIndex.push(function(a,u){return a.readFields(_R,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(r,r.readVarint()+r.pos))}function yR(o,e,r){if(o===2)(function(a,u,l){a.readFields(vR,l,u)})(r,r.readVarint()+r.pos,e);else if(o===3)throw new Error("Not implemented")}function vR(o,e,r){if(o===1){let a=0;const u=r.readVarint()+r.pos;for(;r.pos<u;)e[a++]=r.readVarint()}}function xR(o,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let r=e[3];for(let a=2;a>=1;a--){const u=a===1?1:0,l=a===2?1:0;for(let f=0;f<e[0];f++){const y=e[1]*f;for(let b=u;b<e[1];b++){const S=e[2]*(b+y);for(let _=l;_<e[2];_++){const w=e[3]*(_+S);for(let A=0;A<e[3];A++){const T=w+A;o[T]+=o[T-r]}}}}r*=e[a]}return o}function bR(o){for(let e=0,r=o.length;e<r;e++)o[e]=o[e]>>>1^-(1&o[e]);return o}function wR(o,e){switch(e){case"uint32":return o;case"uint16":for(let r=0;r<o.length;r+=2){const a=o[r],u=o[r+1];o[r]=(240&a)>>4|(61440&a)>>8|(240&u)<<4|61440&u,o[r+1]=15&a|(3840&a)>>4|(15&u)<<8|(3840&u)<<4}return o;case"uint8":for(let r=0;r<o.length;r+=4){const a=o[r],u=o[r+1],l=o[r+2],f=o[r+3];o[r+0]=(192&a)>>6|(192&u)>>4|(192&l)>>2|192&f,o[r+1]=(48&a)>>4|(48&u)>>2|48&l|(48&f)<<2,o[r+2]=(12&a)>>2|12&u|(12&l)<<2|(12&f)<<4,o[r+3]=3&a|(3&u)<<2|(3&l)<<4|(3&f)<<6}return o;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ft(hg,"DEMData"),Ft(X2,"DemMinMaxQuadTree",{omit:["dem"]});var oo=Uint8Array,Ep=Uint16Array,TR=Int32Array,Y2=new oo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),J2=new oo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),SR=new oo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Q2=function(o,e){for(var r=new Ep(31),a=0;a<31;++a)r[a]=e+=1<<o[a-1];var u=new TR(r[30]);for(a=1;a<30;++a)for(var l=r[a];l<r[a+1];++l)u[l]=l-r[a]<<5|a;return{b:r,r:u}},eT=Q2(Y2,2),tT=eT.b,ER=eT.r;tT[28]=258,ER[258]=28;for(var AR=Q2(J2,0).b,rT=new Ep(32768),ci=0;ci<32768;++ci){var rd=(43690&ci)>>1|(21845&ci)<<1;rT[ci]=((65280&(rd=(61680&(rd=(52428&rd)>>2|(13107&rd)<<2))>>4|(3855&rd)<<4))>>8|(255&rd)<<8)>>1}var Ap=function(o,e,r){for(var a=o.length,u=0,l=new Ep(e);u<a;++u)o[u]&&++l[o[u]-1];var f,y=new Ep(e);for(u=1;u<e;++u)y[u]=y[u-1]+l[u-1]<<1;f=new Ep(1<<e);var b=15-e;for(u=0;u<a;++u)if(o[u])for(var S=u<<4|o[u],_=e-o[u],w=y[o[u]-1]++<<_,A=w|(1<<_)-1;w<=A;++w)f[rT[w]>>b]=S;return f},Mp=new oo(288);for(ci=0;ci<144;++ci)Mp[ci]=8;for(ci=144;ci<256;++ci)Mp[ci]=9;for(ci=256;ci<280;++ci)Mp[ci]=7;for(ci=280;ci<288;++ci)Mp[ci]=8;var nT=new oo(32);for(ci=0;ci<32;++ci)nT[ci]=5;var MR=Ap(Mp,9),IR=Ap(nT,5),w0=function(o){for(var e=o[0],r=1;r<o.length;++r)o[r]>e&&(e=o[r]);return e},ea=function(o,e,r){var a=e/8|0;return(o[a]|o[a+1]<<8)>>(7&e)&r},T0=function(o,e){var r=e/8|0;return(o[r]|o[r+1]<<8|o[r+2]<<16)>>(7&e)},CR=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ta=function(o,e,r){var a=new Error(e||CR[o]);if(a.code=o,Error.captureStackTrace&&Error.captureStackTrace(a,ta),!r)throw a;return a},PR=new oo(0),RR=typeof TextDecoder<"u"&&new TextDecoder;try{RR.decode(PR,{stream:!0})}catch{}const DR={gzip_data:"gzip"};class Do extends Error{constructor(e){super(e),this.name="MRTError"}}const zR={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},iT={uint32:1,uint16:2,uint8:4},LR={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let S0;class dg{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const r=this.layers[e];if(!r)throw new Do(`Layer '${e}' not found`);return r}getHeaderLength(e){const r=new Uint8Array(e),a=new DataView(e);if(r[0]!==13)throw new Do("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const r=new Uint8Array(e),a=this.getHeaderLength(e);if(r.length<a)throw new Do(`Expected header with length >= ${a} but got buffer of length ${r.length}`);const u=function(l,f){return l.readFields(dR,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new S0(r.subarray(0,a)));if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Do(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const l of u.layers)this.layers[l.name]=new sT(l,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const r=[],a=this.getLayer(e.layerName);for(let u of e.blockIndices){const l=a.dataIndex[u],f=l.firstByte-e.firstByte,y=l.lastByte-e.firstByte;if(a._blocksInProgress.has(u))continue;const b={layerName:a.name,firstByte:f,lastByte:y,pixelFormat:a.pixelFormat,blockIndex:u,blockShape:[l.bands.length].concat(a.bandShape),buffer:a.buffer,codec:l.codec.codec,filters:l.filters.map(S=>S.filter)};a._blocksInProgress.add(u),r.push(b)}return new oT(r,()=>{r.forEach(u=>a._blocksInProgress.delete(u.blockIndex))},(u,l)=>{if(r.forEach(f=>a._blocksInProgress.delete(f.blockIndex)),u)throw u;l.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class sT{constructor({version:e,name:r,units:a,tileSize:u,pixelFormat:l,buffer:f,dataIndex:y},b){if(this.version=e,this.version!==1)throw new Do(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=r,this.units=a,this.tileSize=u,this.buffer=f,this.pixelFormat=zR[l],this.dataIndex=y,this.bandShape=[u+2*f,u+2*f,iT[this.pixelFormat]],this._decodedBlocks=new ug(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return iT[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const r=e.blockIndex.toString();this._decodedBlocks.get(r)||this._decodedBlocks.put(r,e.data)}getBlockForBand(e){let r=0;switch(typeof e){case"string":for(const[a,u]of this.dataIndex.entries()){for(const[l,f]of u.bands.entries())if(f===e)return{bandIndex:r+l,blockIndex:a,blockBandIndex:l};r+=u.bands.length}break;case"number":for(const[a,u]of this.dataIndex.entries()){if(e>=r&&e<r+u.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-r};r+=u.bands.length}break;default:throw new Do(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new Do(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let r=1/0,a=-1/0;const u=[],l=new Set;for(const f of e){const{blockIndex:y}=this.getBlockForBand(f);if(y<0)throw new Do(`Invalid band: ${JSON.stringify(f)}`);const b=this.dataIndex[y];u.includes(y)||u.push(y),l.add(y),r=Math.min(r,b.firstByte),a=Math.max(a,b.lastByte)}if(l.size>this.cacheSize)throw new Do(`Number of blocks to decode (${l.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:r,lastByte:a,blockIndices:u}}hasBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0}hasDataForBand(e){const{blockIndex:r}=this.getBlockForBand(e);return r>=0&&!!this._decodedBlocks.get(r.toString())}getBandView(e){const{blockIndex:r,blockBandIndex:a}=this.getBlockForBand(e),u=this._decodedBlocks.get(r.toString());if(!u)throw new Do(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const l=this.dataIndex[r],f=this.bandShape.reduce((S,_)=>S*_,1),y=a*f,b=u.subarray(y,y+f);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:l.offset,scale:l.scale}}}dg.setPbf=function(o){S0=o};class oT{constructor(e,r,a){this.tasks=e,this._onCancel=r,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,r){this._finalized||(this._onComplete(e,r),this._finalized=!0)}}dg.performDecoding=function(o,e){const r=new Uint8Array(o);return Promise.all(e.tasks.map(a=>{const{layerName:u,firstByte:l,lastByte:f,pixelFormat:y,blockShape:b,blockIndex:S,filters:_,codec:w}=a,A=r.subarray(l,f+1),T=new Uint32Array(b[0]*b[1]*b[2]);let E;if(w!=="gzip_data")throw new Do(`Unhandled codec: ${w}`);return E=function(C,O){if(!globalThis.DecompressionStream&&O==="gzip_data")return Promise.resolve(((N=function(K){K[0]==31&&K[1]==139&&K[2]==8||ta(6,"invalid gzip data");var ae=K[3],ie=10;4&ae&&(ie+=2+(K[10]|K[11]<<8));for(var se=(ae>>3&1)+(ae>>4&1);se>0;se-=!K[ie++]);return ie+(2&ae)}(V=C))+8>V.length&&ta(6,"invalid gzip data"),function(K,ae,ie,se){var ve=K.length;if(!ve||ae.f&&!ae.l)return ie||new oo(0);var le=!ie,xe=le||ae.i!=2,Me=ae.i;le&&(ie=new oo(3*ve));var Se,Ce,Ie=function(tc){var rc=ie.length;if(tc>rc){var hu=new oo(Math.max(2*rc,tc));hu.set(ie),ie=hu}},Fe=ae.f||0,ze=ae.p||0,Ne=ae.b||0,it=ae.l,nt=ae.d,Bt=ae.m,ft=ae.n,Tt=8*ve;do{if(!it){Fe=ea(K,ze,1);var at=ea(K,ze+1,3);if(ze+=3,!at){var tr=K[(mr=4+((ze+7)/8|0))-4]|K[mr-3]<<8,Ot=mr+tr;if(Ot>ve){Me&&ta(0);break}xe&&Ie(Ne+tr),ie.set(K.subarray(mr,Ot),Ne),ae.b=Ne+=tr,ae.p=ze=8*Ot,ae.f=Fe;continue}if(at==1)it=MR,nt=IR,Bt=9,ft=5;else if(at==2){var Ht=ea(K,ze,31)+257,hr=ea(K,ze+10,15)+4,Mr=Ht+ea(K,ze+5,31)+1;ze+=14;for(var gr=new oo(Mr),Lr=new oo(19),Sr=0;Sr<hr;++Sr)Lr[SR[Sr]]=ea(K,ze+3*Sr,7);ze+=3*hr;var Fr=w0(Lr),Wr=(1<<Fr)-1,yn=Ap(Lr,Fr);for(Sr=0;Sr<Mr;){var mr,Ur=yn[ea(K,ze,Wr)];if(ze+=15&Ur,(mr=Ur>>4)<16)gr[Sr++]=mr;else{var En=0,kn=0;for(mr==16?(kn=3+ea(K,ze,3),ze+=2,En=gr[Sr-1]):mr==17?(kn=3+ea(K,ze,7),ze+=3):mr==18&&(kn=11+ea(K,ze,127),ze+=7);kn--;)gr[Sr++]=En}}var Gn=gr.subarray(0,Ht),Wn=gr.subarray(Ht);Bt=w0(Gn),ft=w0(Wn),it=Ap(Gn,Bt),nt=Ap(Wn,ft)}else ta(1);if(ze>Tt){Me&&ta(0);break}}xe&&Ie(Ne+131072);for(var fn=(1<<Bt)-1,gi=(1<<ft)-1,ts=ze;;ts=ze){var ii=(En=it[T0(K,ze)&fn])>>4;if((ze+=15&En)>Tt){Me&&ta(0);break}if(En||ta(2),ii<256)ie[Ne++]=ii;else{if(ii==256){ts=ze,it=null;break}var ui=ii-254;ii>264&&(ui=ea(K,ze,(1<<(ao=Y2[Sr=ii-257]))-1)+tT[Sr],ze+=ao);var ji=nt[T0(K,ze)&gi],Ii=ji>>4;if(ji||ta(3),ze+=15&ji,Wn=AR[Ii],Ii>3){var ao=J2[Ii];Wn+=T0(K,ze)&(1<<ao)-1,ze+=ao}if(ze>Tt){Me&&ta(0);break}xe&&Ie(Ne+131072);var ec=Ne+ui;if(Ne<Wn){var zo=0-Wn,na=Math.min(Wn,ec);for(zo+Ne<0&&ta(3);Ne<na;++Ne)ie[Ne]=(void 0)[zo+Ne]}for(;Ne<ec;++Ne)ie[Ne]=ie[Ne-Wn]}}ae.l=it,ae.p=ts,ae.b=Ne,ae.f=Fe,it&&(Fe=1,ae.m=Bt,ae.d=nt,ae.n=ft)}while(!Fe);return Ne!=ie.length&&le?(Se=ie,((Ce=Ne)==null||Ce>Se.length)&&(Ce=Se.length),new oo(Se.subarray(0,Ce))):ie.subarray(0,Ne)}(V.subarray(N,-8),{i:2},new oo(((k=V)[(U=k.length)-4]|k[U-3]<<8|k[U-2]<<16|k[U-1]<<24)>>>0))));var k,U,V,N;const $=DR[O];if(!$)throw new Error(`Unhandled codec: ${O}`);const W=new globalThis.DecompressionStream($);return new Response(new Blob([C]).stream().pipeThrough(W)).arrayBuffer().then(K=>new Uint8Array(K))}(A,w).then(C=>(function(O,k){O.readFields(yR,k)}(new S0(C),T),new LR[y](T.buffer))),E.then(C=>{for(let O=_.length-1;O>=0;O--)switch(_[O]){case"delta_filter":xR(C,b);break;case"zigzag_filter":bR(C);break;case"bitshuffle_filter":wR(C,y);break;default:throw new Do(`Unhandled filter "${_[O]}"`)}return{layerName:u,blockIndex:S,data:C}}).catch(C=>{throw C})}))},Ft(oT,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ft(dg,"MapboxRasterTile"),Ft(sT,"MapboxRasterLayer",{omit:["_blocksInProgress"]});let Ip,E0,ra,nd,A0,id=null;function aT(){return Va()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:E0||Y.DRACO_URL}function lT(){if(Va()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(nd)return nd;const o=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return nd=WebAssembly.validate(o)?Y.MESHOPT_SIMD_URL:Y.MESHOPT_URL,nd}const fg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},OR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Cp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function cT(o,e,r){const a=r.json.bufferViews.length,u=r.buffers.length;e.bufferView=a,r.json.bufferViews[a]={buffer:u,byteLength:o.byteLength},r.buffers[u]=o}const M0="KHR_draco_mesh_compression";function kR(o,e){const r=o.extensions&&o.extensions[M0];if(!r)return;const a=new ra.Decoder,u=fT(e,r.bufferView),l=new ra.Mesh;if(!a.DecodeArrayToMesh(u,u.byteLength,l))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[o.indices],y=fg[f.componentType],b=f.count*y.BYTES_PER_ELEMENT,S=ra._malloc(b);y===Uint16Array?a.GetTrianglesUInt16Array(l,b,S):a.GetTrianglesUInt32Array(l,b,S),cT(ra.memory.buffer.slice(S,S+b),f,e),ra._free(S);for(const _ of Object.keys(r.attributes)){const w=a.GetAttributeByUniqueId(l,r.attributes[_]),A=e.json.accessors[o.attributes[_]],T=OR[A.componentType],E=A.count*Cp[A.type]*fg[A.componentType].BYTES_PER_ELEMENT,C=ra._malloc(E);a.GetAttributeDataArrayForAllPoints(l,w,ra[T],E,C),cT(ra.memory.buffer.slice(C,C+E),A,e),ra._free(C)}a.destroy(),l.destroy(),delete o.extensions[M0]}const pg="EXT_meshopt_compression";function FR(o,e){if(!o.extensions||!o.extensions[pg])return;const r=o.extensions[pg],a=new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),u=new Uint8Array(r.count*r.byteStride);A0.decodeGltfBuffer(u,r.count,r.byteStride,a,r.mode,r.filter),o.buffer=e.buffers.length,o.byteOffset=0,e.buffers[o.buffer]=u.buffer,delete o.extensions[pg]}const uT=1179937895,hT=new TextDecoder("utf8");function dT(o,e){return new URL(o,e).href}function BR(o,e,r,a){return fetch(dT(o.uri,a)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[r]=u})}function fT(o,e){const r=o.json.bufferViews[e];return new Uint8Array(o.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function NR(o,e,r,a){if(o.uri){const u=dT(o.uri,a);return fetch(u).then(l=>l.blob()).then(l=>createImageBitmap(l)).then(l=>{e.images[r]=l})}if(o.bufferView!==void 0){const u=fT(e,o.bufferView),l=new Blob([u],{type:o.mimeType});return createImageBitmap(l).then(f=>{e.images[r]=f})}}function pT(o,e=0,r){const a={json:null,images:[],buffers:[]};if(new Uint32Array(o,e,1)[0]===uT){const _=new Uint32Array(o,e);let w=2;const A=(_[w++]>>2)-3,T=_[w++]>>2;if(w++,a.json=JSON.parse(hT.decode(_.subarray(w,w+T))),w+=T,w<A){const E=_[w++];w++;const C=e+(w<<2);a.buffers[0]=o.slice(C,C+E)}}else a.json=JSON.parse(hT.decode(new Uint8Array(o,e)));const{buffers:u,images:l,meshes:f,extensionsUsed:y,bufferViews:b}=a.json;let S=Promise.resolve();if(u){const _=[];for(let w=0;w<u.length;w++){const A=u[w];A.uri?_.push(BR(A,a,w,r)):a.buffers[w]||(a.buffers[w]=null)}S=Promise.all(_)}return S.then(()=>{const _=[],w=y&&y.includes(M0),A=y&&y.includes(pg);if(w&&_.push(function(){if(!ra)return Ip??(Ip=function(T){let E,C=null;function O(){E=new Uint8Array(C.buffer)}function k(){throw new Error("Unexpected Draco error.")}const U={a:{a:k,d:function(V,N,$){return E.copyWithin(V,N,N+$)},c:function(V){const N=E.length,$=Math.max(V>>>0,Math.ceil(1.2*N)),W=Math.ceil(($-N)/65536);try{return C.grow(W),O(),!0}catch{return!1}},b:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(T,U):T.then(V=>V.arrayBuffer()).then(V=>WebAssembly.instantiate(V,U))).then(V=>{const{Rb:N,Qb:$,P:W,T:K,X:ae,Ja:ie,La:se,Qa:ve,Va:le,Wa:xe,eb:Me,jb:Se,f:Ce,e:Ie,yb:Fe,zb:ze,Ab:Ne,Bb:it,Db:nt,Gb:Bt}=V.instance.exports;C=Ie;const ft=(()=>{let Tt=0,at=0,tr=0,Ot=0;return Ht=>{tr&&(N(Ot),N(Tt),at+=tr,tr=Tt=0),Tt||(at+=128,Tt=$(at));const hr=Ht.length+7&-8;let Mr=Tt;hr>=at&&(tr=hr,Mr=Ot=$(hr));for(let gr=0;gr<Ht.length;gr++)E[Mr+gr]=Ht[gr];return Mr}})();return O(),Ce(),{memory:Ie,_free:N,_malloc:$,Mesh:class{constructor(){this.ptr=W()}destroy(){K(this.ptr)}},Decoder:class{constructor(){this.ptr=ie()}destroy(){Se(this.ptr)}DecodeArrayToMesh(Tt,at,tr){const Ot=ft(Tt),Ht=se(this.ptr,Ot,at,tr.ptr);return!!ae(Ht)}GetAttributeByUniqueId(Tt,at){return{ptr:ve(this.ptr,Tt.ptr,at)}}GetTrianglesUInt16Array(Tt,at,tr){le(this.ptr,Tt.ptr,at,tr)}GetTrianglesUInt32Array(Tt,at,tr){xe(this.ptr,Tt.ptr,at,tr)}GetAttributeDataArrayForAllPoints(Tt,at,tr,Ot,Ht){Me(this.ptr,Tt.ptr,at.ptr,tr,Ot,Ht)}},DT_INT8:Fe(),DT_UINT8:ze(),DT_INT16:Ne(),DT_UINT16:it(),DT_UINT32:nt(),DT_FLOAT32:Bt()}})}(fetch(aT())),Ip.then(T=>{ra=T,Ip=void 0}))}()),A&&_.push(function(){if(A0)return;const T=function(E){let C;const O=WebAssembly.instantiateStreaming(E,{}).then(V=>{C=V.instance,C.exports.__wasm_call_ctors()}),k={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},U={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:O,supported:!0,decodeGltfBuffer(V,N,$,W,K,ae){(function(ie,se,ve,le,xe,Me,Se){const Ce=ie.exports.sbrk,Ie=le+3&-4,Fe=Ce(Ie*xe),ze=Ce(Me.length),Ne=new Uint8Array(ie.exports.memory.buffer);Ne.set(Me,ze);const it=se(Fe,le,xe,ze,Me.length);if(it===0&&Se&&Se(Fe,Ie,xe),ve.set(Ne.subarray(Fe,Fe+le*xe)),Ce(Fe-Ce(0)),it!==0)throw new Error(`Malformed buffer data: ${it}`)})(C,C.exports[U[K]],V,N,$,W,C.exports[k[ae]])}}}(fetch(lT()));return T.ready.then(()=>{A0=T})}()),l)for(let T=0;T<l.length;T++)_.push(NR(l[T],a,T,r));return(_.length?Promise.all(_):Promise.resolve()).then(()=>{if(w&&f)for(const{primitives:T}of f)for(const E of T)kR(E,a);if(A&&f&&b)for(const T of b)FR(T,a);return a})})}function uu(o,e){const r=o.json.bufferViews[e.bufferView],a=fg[e.componentType];return new a(o.buffers[r.buffer],(e.byteOffset||0)+(r.byteOffset||0),e.count*(r.byteStride&&r.byteStride!==Cp[e.type]*a.BYTES_PER_ELEMENT?r.byteStride/a.BYTES_PER_ELEMENT:Cp[e.type]))}function I0(o,e,r,a){const u=fg[e.componentType],l=function(_){switch(_){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),f=o.json.bufferViews[e.bufferView],y=f.byteStride?f.byteStride/u.BYTES_PER_ELEMENT:Cp[e.type],b=r.float32,S=b.length/r.capacity;for(let _=0,w=0;_<e.count*y;_+=y,w+=S)for(let A=0;A<S;A++)b[w+A]=a[_+A]*l;r._trim()}function VR(o,e,r){const a=o.indices,u=o.attributes,l={};l.indexArray=new wi;const f=e.json.accessors[a],y=f.count/3;l.indexArray.reserve(y);const b=uu(e,f);for(let A=0;A<y;A++)l.indexArray.emplaceBack(b[3*A],b[3*A+1],b[3*A+2]);l.indexArray._trim(),l.vertexArray=new Mo;const S=e.json.accessors[u.POSITION];l.vertexArray.reserve(S.count);const _=uu(e,S);for(let A=0;A<S.count;A++)l.vertexArray.emplaceBack(_[3*A],_[3*A+1],_[3*A+2]);if(l.vertexArray._trim(),l.aabb=new sr(S.min,S.max),l.centroid=function(A,T){const E=[0,0,0],C=A.length;if(C>0){for(let O=0;O<C;O++){const k=3*A[O];E[0]+=T[k],E[1]+=T[k+1],E[2]+=T[k+2]}E[0]/=C,E[1]/=C,E[2]/=C}return E}(b,_),u.COLOR_0!==void 0){const A=e.json.accessors[u.COLOR_0],T=Cp[A.type],E=uu(e,A);l.colorArray=T===3?new Mo:new nl,l.colorArray.resize(A.count),I0(e,A,l.colorArray,E)}if(u.NORMAL!==void 0){l.normalArray=new Mo;const A=e.json.accessors[u.NORMAL];l.normalArray.resize(A.count);const T=uu(e,A);I0(e,A,l.normalArray,T)}if(u.TEXCOORD_0!==void 0&&r.length>0){l.texcoordArray=new Aa;const A=e.json.accessors[u.TEXCOORD_0];l.texcoordArray.resize(A.count);const T=uu(e,A);I0(e,A,l.texcoordArray,T)}if(u._FEATURE_ID_RGBA4444!==void 0){const A=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(l.featureData=uu(e,A))}u._FEATURE_RGBA4444!==void 0&&(l.featureData=new Uint32Array(uu(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const w=o.material;return l.material=function(A,T){const{emissiveFactor:E=[0,0,0],alphaMode:C="OPAQUE",alphaCutoff:O=.5,normalTexture:k,occlusionTexture:U,emissiveTexture:V,doubleSided:N}=A,{baseColorFactor:$=[1,1,1,1],metallicFactor:W=1,roughnessFactor:K=1,baseColorTexture:ae,metallicRoughnessTexture:ie}=A.pbrMetallicRoughness||{},se=U?T[U.index]:void 0;if(U&&U.extensions&&U.extensions.KHR_texture_transform&&se){const ve=U.extensions.KHR_texture_transform;se.offsetScale=[ve.offset[0],ve.offset[1],ve.scale[0],ve.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new tn(...$),metallicFactor:W,roughnessFactor:K,baseColorTexture:ae?T[ae.index]:void 0,metallicRoughnessTexture:ie?T[ie.index]:void 0},doubleSided:N,emissiveFactor:E,alphaMode:C,alphaCutoff:O,normalTexture:k?T[k.index]:void 0,occlusionTexture:se,emissionTexture:V?T[V.index]:void 0,defined:A.defined===void 0}}(w!==void 0?e.json.materials[w]:{defined:!1},r),l}function mT(o,e,r){const{matrix:a,rotation:u,translation:l,scale:f,mesh:y,extras:b,children:S}=o,_={};if(_.matrix=a||te.mat4.fromRotationTranslationScale([],u||[0,0,0,1],l||[0,0,0],f||[1,1,1]),y!==void 0){_.meshes=r[y];const w=_.anchor=[0,0];for(const A of _.meshes){const{min:T,max:E}=A.aabb;w[0]+=T[0]+E[0],w[1]+=T[1]+E[1]}w[0]=Math.floor(w[0]/_.meshes.length/2),w[1]=Math.floor(w[1]/_.meshes.length/2)}if(b&&(b.id&&(_.id=b.id),b.lights&&(_.lights=function(w){if(!w.length)return[];const A=function(k){const U=atob(k),V=new Uint8Array(U.length);for(let N=0;N<U.length;N++)V[N]=U.codePointAt(N);return V}(w),T=[],E=A.length/24,C=new Uint16Array(A.buffer),O=new Float32Array(A.buffer);for(let k=0;k<E;k++){const U=C[2*k*6]/30,V=C[2*k*6+1]/30,N=C[2*k*6+10]/100,$=O[6*k+1],W=O[6*k+2],K=O[6*k+3],ae=O[6*k+4],ie=K-$,se=ae-W,ve=Math.hypot(ie,se);T.push({pos:[$+.5*ie,W+.5*se,V],normal:[se/ve,-ie/ve,0],width:ve,height:U,depth:N,points:[$,W,K,ae]})}return T}(b.lights))),S){const w=[];for(const A of S)w.push(mT(e.json.nodes[A],e,r));_.children=w}return _}function UR(o){if(o.vertices.length===0||o.indices.length===0)return null;const e=new Ov(o.vertices,o.indices,8,256),[r,a]=[e.min.clone(),e.max.clone()];return{vertices:o.vertices,indices:o.indices,grid:e,min:r,max:a}}function jR(o){if(!o.extras||!o.extras.ground)return null;const e=o.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const r=e[0];if(!r||!Array.isArray(r)||r.length===0)return null;const a=[];for(const f of r){if(!Array.isArray(f)||f.length!==2)continue;const y=f[0],b=f[1];typeof y=="number"&&typeof b=="number"&&a.push(new Ae(y,b))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let u=0;for(let f=0;f<a.length;f++){const y=a[f],b=a[(f+1)%a.length],S=a[(f+2)%a.length];u+=(y.x-b.x)*(S.y-b.y)-(S.x-b.x)*(y.y-b.y)}u>0&&a.reverse();const l=tp(a.flatMap(f=>[f.x,f.y]),[]);return l.length===0?null:{vertices:a,indices:l}}function $R(o,e){const r=[],a=[];let u=0;const l=[];for(const f of o){u=r.length;const y=f.vertexArray.float32,b=f.indexArray.uint16;for(let S=0;S<f.vertexArray.length;S++)l[0]=y[3*S+0],l[1]=y[3*S+1],l[2]=y[3*S+2],te.vec3.transformMat4(l,l,e),r.push(new Ae(l[0],l[1]));for(let S=0;S<3*f.indexArray.length;S++)a.push(b[S]+u)}if(a.length%3!=0)return null;for(let f=0;f<a.length;f+=3){const y=r[a[f+0]],b=r[a[f+1]],S=r[a[f+2]];(y.x-b.x)*(S.y-b.y)-(S.x-b.x)*(y.y-b.y)>0&&([a[f+1],a[f+2]]=[a[f+2],a[f+1]])}return{vertices:r,indices:a}}function _T(o){const e=function(b,S){const _=[],w=WebGL2RenderingContext;if(b.json.textures)for(const A of b.json.textures){const T={magFilter:w.LINEAR,minFilter:w.NEAREST,wrapS:w.REPEAT,wrapT:w.REPEAT};A.sampler!==void 0&&Object.assign(T,b.json.samplers[A.sampler]),_.push({image:S[A.source],sampler:T,uploaded:!1})}return _}(o,o.images),r=function(b,S){const _=[];for(const w of b.json.meshes){const A=[];for(const T of w.primitives)A.push(VR(T,b,S));_.push(A)}return _}(o,e),{scenes:a,scene:u,nodes:l}=o.json,f=a?a[u||0].nodes:l,y=[];for(const b of f)y.push(mT(l[b],o,r));return function(b,S,_){const w={},A=new Set;for(let T=0;T<b.length;T++){const E=_[S[T]];if(!E.extras)continue;const C=E.extras["mapbox:footprint:version"],O=E.extras["mapbox:footprint:id"];(C||O)&&A.add(T),C==="1.0.0"&&O&&(w[O]=T)}for(let T=0;T<b.length;T++){if(A.has(T))continue;const E=b[T],C=_[S[T]];if(!C.extras)continue;let O=null;E.id in w&&(O=$R(b[w[E.id]].meshes,E.matrix)),O||(O=jR(C)),O&&(E.footprint=UR(O))}if(A.size>0){const T=Array.from(A.values()).sort((E,C)=>E-C);for(let E=T.length-1;E>=0;E--)b.splice(T[E],1)}}(y,f,o.json.nodes),y}function GR(o){o.heightmap=new Float32Array(4096),o.heightmap.fill(-1);const e=o.vertexArray.float32,r=o.aabb.min[0]-1,a=o.aabb.min[1]-1,u=au/(o.aabb.max[0]-r+2),l=au/(o.aabb.max[1]-a+2);for(let f=0;f<e.length;f+=3){const y=e[f+2],b=(e[f+0]-r)*u|0,S=(e[f+1]-a)*l|0;y>o.heightmap[S*au+b]&&(o.heightmap[S*au+b]=y)}}function qR(o,e){const r={};r.indexArray=new wi,r.indexArray.reserve(4*o.length),r.vertexArray=new Mo,r.vertexArray.reserve(10*o.length),r.colorArray=new nl,r.vertexArray.reserve(10*o.length);let a=0;for(const f of o){const y=Math.min(10,Math.max(4,1.3*f.height))*e,b=[-f.normal[1],f.normal[0],0],S=Math.min(.29,.1*f.width/f.depth),_=f.width-2*f.depth*e*(S+.01),w=te.vec3.scaleAndAdd([],f.pos,b,_/2),A=te.vec3.scaleAndAdd([],f.pos,b,-_/2),T=[w[0],w[1],w[2]+f.height],E=[A[0],A[1],A[2]+f.height],C=te.vec3.scaleAndAdd([],f.normal,b,S);te.vec3.scale(C,C,y);const O=te.vec3.scaleAndAdd([],f.normal,b,-S);te.vec3.scale(O,O,y),te.vec3.add(C,w,C),te.vec3.add(O,A,O),w[2]+=.1,A[2]+=.1,r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]),r.vertexArray.emplaceBack(w[0],w[1],w[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(T[0],T[1],T[2]),r.vertexArray.emplaceBack(E[0],E[1],E[2]),r.vertexArray.emplaceBack(w[0],w[1],w[2]),r.vertexArray.emplaceBack(A[0],A[1],A[2]),r.vertexArray.emplaceBack(C[0],C[1],C[2]),r.vertexArray.emplaceBack(O[0],O[1],O[2]);const k=_/y/2;r.colorArray.emplaceBack(-k-S,-1,k,.8),r.colorArray.emplaceBack(k+S,-1,k,.8),r.colorArray.emplaceBack(-k,0,k,1.3),r.colorArray.emplaceBack(k,0,k,1.3),r.colorArray.emplaceBack(k+S,-.8,k,.7),r.colorArray.emplaceBack(k+S,-.8,k,.7),r.colorArray.emplaceBack(0,0,k,1.3),r.colorArray.emplaceBack(0,0,k,1.3),r.colorArray.emplaceBack(k+S,-1.2,k,.8),r.colorArray.emplaceBack(k+S,-1.2,k,.8),r.indexArray.emplaceBack(6+a,4+a,8+a),r.indexArray.emplaceBack(7+a,9+a,5+a),r.indexArray.emplaceBack(0+a,1+a,2+a),r.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const u={defined:!0,emissiveFactor:[0,0,0]},l={};return l.baseColorFactor=tn.white,u.pbrMetallicRoughness=l,r.material=u,r.aabb=new sr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}class gT{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const a=e[r];this._stringToNumber[a]=r,this._numberToString[r]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const HR=["id","tile","layer","source","sourceLayer","state"];class sd{constructor(e,r,a,u,l){this.type="Feature",this._vectorTileFeature=e,this._z=r,this._x=a,this._y=u,this.properties=e.properties,this.id=l}clone(){const e=new sd(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const r of HR)this[r]!==void 0&&(e[r]=this[r]);return e}}class yT{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ol(Ct,16,0),this.featureIndexArray=new Jc,this.promoteId=r,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,r,a,u,l,f=0,y=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,l,f);const S=this.grid;for(let _=0;_<r.length;_++){const w=r[_],A=[1/0,1/0,-1/0,-1/0];for(let T=0;T<w.length;T++){const E=w[T];A[0]=Math.min(A[0],E.x),A[1]=Math.min(A[1],E.y),A[2]=Math.max(A[2],E.x),A[3]=Math.max(A[3],E.y)}y!==0&&(A[0]-=y,A[1]-=y,A[2]+=y,A[3]+=y),A[0]<Ct&&A[1]<Ct&&A[2]>=0&&A[3]>=0&&S.insert(b,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Zl.VectorTile(new O_(this.rawTileData)).layers,this.sourceLayerCoder=new gT(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r){const{tilespaceGeometry:a,transform:u,tileTransform:l,pixelPosMatrix:f,availableImages:y}=r;this.loadVTLayers(),this.serializedLayersCache.clear();const b=a.bufferedTilespaceBounds,S=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(T,E,C,O)=>we(a.bufferedTilespaceGeometry,T,E,C,O));S.sort(WR);let _=null;u.elevation&&S.length>0&&(_=Jh.create(u.elevation,this.tileID));const w={};let A;for(let T=0;T<S.length;T++){const E=S[T];if(E===A)continue;A=E;const C=this.featureIndexArray.get(E);let O=null;this.is3DTile?this.loadMatchingModelFeature(w,C,e,a,u):this.loadMatchingFeature(w,C,e,y,(k,U,V,N=0)=>(O||(O=L(k,this.tileID.canonical,l)),U.queryIntersectsFeature(a,k,V,O,this.z,u,f,_,N)))}return w}loadMatchingFeature(e,r,a,u,l){const{featureIndex:f,bucketIndex:y,sourceLayerIndex:b,layoutVertexArrayOffset:S}=r,_=this.bucketLayerIDs[y],w=a.layers,A=Object.keys(w);if(A.length&&!function(k,U){for(let V=0;V<k.length;V++)if(U.indexOf(k[V])>=0)return!0;return!1}(A,_))return;const T=a.sourceCache,E=this.sourceLayerCoder.decode(b),C=this.vtLayers[E].feature(f),O=this.getId(C,E);for(let k=0;k<_.length;k++){const U=_[k];if(!w[U])continue;const{styleLayer:V,targets:N}=w[U];let $={};O!==void 0&&($=T.getFeatureState(V.sourceLayer,O));const W=!l||l(C,V,$,S);if(!W)continue;const K=new sd(C,this.z,this.x,this.y,O);K.tile=this.tileID.canonical,K.state=$;let ae=this.serializedLayersCache.get(U);ae||(ae=V.serialize(),ae.id=U,this.serializedLayersCache.set(U,ae)),K.source=ae.source,K.sourceLayer=ae["source-layer"],K.layer=Vr({},ae),K.layer.paint=vT(ae.paint,V.paint,C,$,u),K.layer.layout=vT(ae.layout,V.layout,C,$,u);let ie=!1;for(const se of N){this.updateFeatureProperties(K,se);const{filter:ve}=se;if(ve){if(C.properties=K.properties,ve.needGeometry){const le=F(C,!0);if(!ve.filter(new gn(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!ve.filter(new gn(this.tileID.overscaledZ),C))continue}ie=!0,se.targetId&&this.addFeatureVariant(K,se)}ie&&this.appendToResult(e,U,f,K,W)}}loadMatchingModelFeature(e,r,a,u,l){const f=this.bucketLayerIDs[0][0],y=a.layers;if(!y[f])return;const{styleLayer:b,targets:S}=y[f];if(b.type!=="model")return;const _=u.tile,w=r.featureIndex,A=_.getBucket(b);if(!(A&&A instanceof ng))return;const T=function(ae,ie,se,ve){const le=ae.getNodesInfo()[ie];if(le.hiddenByReplacement||!le.node.meshes)return;let xe=Number.MAX_VALUE;const Me=le.node,Se=se.tile,Ce=ve.calculatePosMatrix(Se.tileID.toUnwrapped(),ve.worldSize),Ie=le.evaluatedScale;let Fe=0;ve.elevation&&Me.elevation&&(Fe=Me.elevation*ve.elevation.exaggeration()),te.mat4.translate(Ce,Ce,[(Me.anchor?Me.anchor[0]:0)*(Ie[0]-1),(Me.anchor?Me.anchor[1]:0)*(Ie[1]-1),Fe]),te.mat4.scale(Ce,Ce,Ie);const ze=se.queryGeometry,Ne=ze.isPointQuery()?ze.screenBounds:ze.screenGeometry,it=function(Bt){const ft=te.mat4.multiply([],Ce,Bt.matrix);te.mat4.multiply(ft,ve.expandedFarZProjMatrix,ft);for(let Tt=0;Tt<Bt.meshes.length;++Tt){const at=Bt.meshes[Tt];if(Tt===Bt.lightMeshIndex)continue;const tr=_2(Ne,ve,ft,at.aabb);tr!=null&&(xe=Math.min(tr,xe))}if(Bt.children)for(const Tt of Bt.children)it(Tt)};if(it(Me),xe===Number.MAX_VALUE)return;const nt=new Xr(0,0);return I2(Se.tileID.canonical,nt,le.node.anchor[0],le.node.anchor[1]),{intersectionZ:xe,position:nt,feature:le.feature}}(A,w,u,l);if(!T)return;const{z:E,x:C,y:O}=_.tileID.canonical,{feature:k,intersectionZ:U,position:V}=T;let N={};k.id!==void 0&&(N=a.sourceCache.getFeatureState(b.sourceLayer,k.id));const $=new sd({},E,C,O,k.id);$.tile=this.tileID.canonical,$.state=N,$.properties=k.properties,$.geometry={type:"Point",coordinates:[V.lng,V.lat]};let W=this.serializedLayersCache.get(f);W||(W=b.serialize(),W.id=f,this.serializedLayersCache.set(f,W)),$.source=W.source,$.sourceLayer=W["source-layer"],$.layer=Vr({},W);let K=!1;for(const ae of S){this.updateFeatureProperties($,ae);const{filter:ie}=ae;if(ie){if(k.properties=$.properties,ie.needGeometry){if(!ie.filter(new gn(this.tileID.overscaledZ),k,this.tileID.canonical))continue}else if(!ie.filter(new gn(this.tileID.overscaledZ),k))continue}K=!0,ae.targetId&&this.addFeatureVariant($,ae)}K&&this.appendToResult(e,f,w,$,U)}updateFeatureProperties(e,r,a){if(r.properties){const u={};for(const l in r.properties){const f=r.properties[l].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);f!=null&&(u[l]=f)}e.properties=u}}addFeatureVariant(e,r,a){const u={target:r.target,namespace:r.namespace,uniqueFeatureID:r.uniqueFeatureID};r.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[r.targetId]=e.variants[r.targetId]||[],e.variants[r.targetId].push(u)}appendToResult(e,r,a,u,l){let f=e[r];f===void 0&&(f=e[r]=[]),f.push({featureIndex:a,feature:u,intersectionZ:l})}lookupSymbolFeatures(e,r,a,u,l){const f={};this.loadVTLayers();for(const y of e)this.loadMatchingFeature(f,{bucketIndex:r,sourceLayerIndex:a,featureIndex:y,layoutVertexArrayOffset:0},u,l);return f}loadFeature(e){const{featureIndex:r,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),l=this.vtFeatures[u];if(l[r])return l[r];const f=this.vtLayers[u].feature(r);return l[r]=f,f}hasLayer(e){for(const r of this.bucketLayerIDs)for(const a of r)if(e===a)return!0;return!1}getId(e,r){let a=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[r];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const l=Dl(u);if(l.result!=="success"){const f=l.value.map(y=>`${y.key}: ${y.message}`).join(", ");return void Pr(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=l.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Dc),a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[u];typeof a=="boolean"&&(a=Number(a))}return a}}function vT(o,e,r,a,u){return ys(o,(l,f)=>{const y=e instanceof Bl?e.get(f):null;return y&&y.evaluate?y.evaluate(r,a,u):y})}function WR(o,e){return e-o}Ft(yT,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const xT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class C0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,a]=new Uint8Array(e,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const l=xT[15&a];if(!l)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new C0(y,f,l,e)}constructor(e,r=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const l=xT.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(l<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+l]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=e)}add(e,r){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=r,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return P0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,r,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:f,nodeSize:y}=this,b=[0,l.length-1,0],S=[];for(;b.length;){const _=b.pop()||0,w=b.pop()||0,A=b.pop()||0;if(w-A<=y){for(let O=A;O<=w;O++){const k=f[2*O],U=f[2*O+1];k>=e&&k<=a&&U>=r&&U<=u&&S.push(l[O])}continue}const T=A+w>>1,E=f[2*T],C=f[2*T+1];E>=e&&E<=a&&C>=r&&C<=u&&S.push(l[T]),(_===0?e<=E:r<=C)&&(b.push(A),b.push(T-1),b.push(1-_)),(_===0?a>=E:u>=C)&&(b.push(T+1),b.push(w),b.push(1-_))}return S}within(e,r,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:l,nodeSize:f}=this,y=[0,u.length-1,0],b=[],S=a*a;for(;y.length;){const _=y.pop()||0,w=y.pop()||0,A=y.pop()||0;if(w-A<=f){for(let O=A;O<=w;O++)wT(l[2*O],l[2*O+1],e,r)<=S&&b.push(u[O]);continue}const T=A+w>>1,E=l[2*T],C=l[2*T+1];wT(E,C,e,r)<=S&&b.push(u[T]),(_===0?e-a<=E:r-a<=C)&&(y.push(A),y.push(T-1),y.push(1-_)),(_===0?e+a>=E:r+a>=C)&&(y.push(T+1),y.push(w),y.push(1-_))}return b}}function P0(o,e,r,a,u,l){if(u-a<=r)return;const f=a+u>>1;bT(o,e,f,a,u,l),P0(o,e,r,a,f-1,1-l),P0(o,e,r,f+1,u,1-l)}function bT(o,e,r,a,u,l){for(;u>a;){if(u-a>600){const S=u-a+1,_=r-a+1,w=Math.log(S),A=.5*Math.exp(2*w/3),T=.5*Math.sqrt(w*A*(S-A)/S)*(_-S/2<0?-1:1);bT(o,e,r,Math.max(a,Math.floor(r-_*A/S+T)),Math.min(u,Math.floor(r+(S-_)*A/S+T)),l)}const f=e[2*r+l];let y=a,b=u;for(Pp(o,e,a,r),e[2*u+l]>f&&Pp(o,e,a,u);y<b;){for(Pp(o,e,y,b),y++,b--;e[2*y+l]<f;)y++;for(;e[2*b+l]>f;)b--}e[2*a+l]===f?Pp(o,e,a,b):(b++,Pp(o,e,b,u)),b<=r&&(a=b+1),r<=b&&(u=b-1)}}function Pp(o,e,r,a){R0(o,r,a),R0(e,2*r,2*a),R0(e,2*r+1,2*a+1)}function R0(o,e,r){const a=o[e];o[e]=o[r],o[r]=a}function wT(o,e,r,a){const u=o-r,l=e-a;return u*u+l*l}i.$=is,i.A=wo,i.B=To,i.C=Es,i.D=Qh,i.E=ma,i.F=2,i.G=dp,i.H=Cw,i.I=bs,i.J=class extends tg{},i.K=Wa,i.L=Uu,i.M=u_,i.N=hh,i.O=Rl,i.P=Ae,i.Q=e_,i.R=pi,i.S=pf,i.T=l0,i.U=Th,i.V=tg,i.W=i_,i.X=Dl,i.Y=Bc,i.Z=qo,i._=Il,i.a=function(o){return Y.API_CDN_URL_REGEX.test(o)},i.a$=F,i.a0=Vd,i.a1=Ef,i.a2=dh,i.a3=Qm,i.a4=function(o){const e=o.value;let r=[];if(!e)return r;const a=Wa(e);return a!=="string"?(r=r.concat([new tg(o.key,e,`string expected, "${a}" found`)]),r):(y2(e,!0)||(r=r.concat([new tg(o.key,e,`invalid url "${e}"`)])),r)},i.a5=Ue,i.a6=wh,i.a7=Nn,i.a8=bt,i.a9=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return vs(o.expression.evaluate(e))}interpolate(o,e,r){return{x:or(o.x,e.x,r),y:or(o.y,e.y,r),z:or(o.z,e.z,r),azimuthal:or(o.azimuthal,e.azimuthal,r),polar:or(o.polar,e.polar,r)}}},i.aA=function(o,e){const r={};for(let a=0;a<e.length;a++){const u=e[a];u in o&&(r[u]=o[u])}return r},i.aB=Pa,i.aC=io,i.aD=class{constructor(o){this.entries={},this.scheduler=o}request(o,e,r,a){const u=this.entries[o]=this.entries[o]||{callbacks:[]};if(u.result){const[l,f]=u.result;return this.scheduler?this.scheduler.add(()=>{a(l,f)},e):a(l,f),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=r((l,f)=>{u.result=[l,f];for(const y of u.callbacks)this.scheduler?this.scheduler.add(()=>{y(l,f)},e):y(l,f);setTimeout(()=>delete this.entries[o],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(l=>l!==a),u.callbacks.length||(u.cancel(),delete this.entries[o]))}}},i.aE=function(o,e,r){const a=JSON.stringify(o.request);return o.data&&(this.deduped.entries[a]={result:[null,o.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},u=>{const l=ja(o.request,(f,y,b,S)=>{f?u(f):y&&u(null,{vectorTile:r?void 0:new Zl.VectorTile(new O_(y)),rawData:y,cacheControl:b,expires:S})});return()=>{l.cancel(),u()}},e)},i.aF=function(o){ln++,ln>Tr&&(o.getActor().send("enforceCacheSizeLimit",xr),ln=0)},i.aG=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},i.aH=wt,i.aI=s2,i.aJ=h2,i.aK=i2,i.aL=function(o,e){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let a=0;a<o.length;a++){const u=document.createElement("source");Ld(o[a])||(r.crossOrigin="Anonymous"),u.src=o[a],r.appendChild(u)}return{cancel:()=>{}}},i.aM=K_,i.aN=function(o){return fetch(o).then(e=>e.arrayBuffer()).then(e=>pT(e,0,o))},i.aO=_T,i.aP=class{constructor(o,e,r,a){this.id=o,this.position=e!=null?new Xr(e[0],e[1]):new Xr(0,0),this.orientation=r??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new sr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(o,e){if(te.mat4.multiply(o.matrix,e,o.matrix),o.meshes)for(const r of o.meshes){const a=sr.applyTransformFast(r.aabb,o.matrix);this.aabb.encapsulate(a)}if(o.children)for(const r of o.children)this._applyTransformations(r,o.matrix)}computeBoundsAndApplyParent(){const o=te.mat4.identity([]);for(const e of this.nodes)this._applyTransformations(e,o)}computeModelMatrix(o,e,r,a,u,l,f=!1){T2(this.matrix,this,o.transform,this.position,e,r,a,u,l,f)}upload(o){if(!this.uploaded){for(const e of this.nodes)f0(e,o);for(const e of this.nodes)rg(e);this.uploaded=!0}}destroy(){for(const o of this.nodes)p0(o)}},i.aQ=ki,i.aR=pp,i.aS=us,i.aT=Mi,i.aU=rl,i.aV=wi,i.aW=ri,i.aX=p_,i.aY=Z_,i.aZ=function(){ls.isLoading()||ls.isLoaded()||Sf()!=="deferred"||c_()},i.a_=Af,i.aa=gn,i.ab=zl,i.ac=s,i.ad=te,i.ae=Jt,i.af=Bl,i.ag=zi,i.ah=or,i.ai=Ct,i.aj=Rm,i.ak=Rt,i.al=tn,i.am=class{constructor(o){this.specification=o}possiblyEvaluate(o,e){return function([r,a]){const u=vs([1,r,a]);return{x:u.x,y:u.y,z:u.z}}(o.expression.evaluate(e))}interpolate(o,e,r){return{x:or(o.x,e.x,r),y:or(o.y,e.y,r),z:or(o.z,e.z,r)}}},i.an=function(o,e,r=0,a=!0){const u=new Ae(r,r),l=o.sub(u),f=e.add(u),y=[l,new Ae(f.x,l.y),f,new Ae(l.x,f.y)];return a&&y.push(l.clone()),y},i.ao=function(o,e){const r=[];for(let a=0;a<o.length;a++){const u=jr(a-1,-1,o.length-1),l=jr(a+1,-1,o.length-1),f=o[a],y=o[l],b=o[u].sub(f).unit(),S=y.sub(f).unit(),_=S.angleWithSep(b.x,b.y),w=b.add(S).unit().mult(-1*e/Math.sin(_/2));r.push(f.add(w))}return r},i.ap=Gw,i.aq=we,i.ar=function(o,e,r=0){return te.vec3.fromValues(((e.x-r)*o.scale-o.x)*Ct,(e.y*o.scale-o.y)*Ct,Yf(e.z,e.y))},i.as=Br,i.at=iw,i.au=function(o){let e=1/0,r=1/0,a=-1/0,u=-1/0;for(const l of o)e=Math.min(e,l.x),r=Math.min(r,l.y),a=Math.max(a,l.x),u=Math.max(u,l.y);return{min:new Ae(e,r),max:new Ae(a,u)}},i.av=Is,i.aw=pe,i.ax=m,i.ay=Ye,i.az=Ai,i.b=function(o){return Y.API_FONTS_REGEX.test(o)},i.b$=Q_,i.b0=sd,i.b1=Ua,i.b2=Uv,i.b3=Lv,i.b4=L,i.b5=Ao,i.b6=Lh,i.b7=pr,i.b8=Vn,i.b9=tp,i.bA=kb,i.bB=Jv,i.bC=Fw,i.bD=Xv,i.bE=C0,i.bF=jr,i.bG=xl,i.bH=Wi,i.bI=function(o,e,r){o[4*e+0]=r[0],o[4*e+1]=r[1],o[4*e+2]=r[2],o[4*e+3]=r[3]},i.bJ=il,i.bK=As,i.bL=Nh,i.bM=Jn,i.bN=Bh,i.bO=Xr,i.bP=Xw,i.bQ=lt,i.bR=_r,i.bS=f2,i.bT=$e,i.bU=Jr,i.bV=function(o,e,r,a,u,l,f,y,b){if(b.name==="globe")return Jr(o,e,new $e(r,a,u),!1);const S=pp({z:r,x:a,y:u},b);return new sr([(l+S.x/S.scale)*e,e*(S.y/S.scale),f],[(l+S.x2/S.scale)*e,e*(S.y2/S.scale),y])},i.bW=function(o,e,r){let a=0;for(let u=0;u<2;++u)o[u]>0&&(a+=(o[u]-0)*(o[u]-0)),e[u]<0&&(a+=(0-e[u])*(0-e[u]));return a},i.bX=Ji,i.bY=Zf,i.bZ=function(o){const e=te.mat4.identity(new Float64Array(16));te.mat4.multiply(e,o.pixelMatrix,o.globeMatrix);const r=[0,Ms,0],a=[0,$s,0];return te.vec3.transformMat4(r,r,e),te.vec3.transformMat4(a,a,e),[r[0]>0&&r[0]<=o.width&&r[1]>0&&r[1]<=o.height&&!Ro(o,new Xr(o.center.lat,90)),a[0]>0&&a[0]<=o.width&&a[1]>0&&a[1]<=o.height&&!Ro(o,new Xr(o.center.lat,-90))]},i.b_=function(o,e){const{scale:r}=o.tileTransform,a=r*Ct/(o.tileSize*Math.pow(2,e.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return te.mat2.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},i.ba=s0,i.bb=function(o,e){const r=zi(e.zoom);if(r===0)return fi(o);const a=Sn(o),u=sn(a),l=Is(a.getWest())*e.worldSize,f=Is(a.getEast())*e.worldSize,y=io(a.getNorth())*e.worldSize,b=io(a.getSouth())*e.worldSize,S=[l,y,0],_=[f,y,0],w=[l,b,0],A=[f,b,0],T=te.mat4.invert([],e.globeMatrix);return te.vec3.transformMat4(S,S,T),te.vec3.transformMat4(_,_,T),te.vec3.transformMat4(w,w,T),te.vec3.transformMat4(A,A,T),u[0]=Ti(u[0],w,r),u[1]=Ti(u[1],A,r),u[2]=Ti(u[2],_,r),u[3]=Ti(u[3],S,r),sr.fromPoints(u)},i.bc=li,i.bd=dn,i.be=Ti,i.bf=tl,i.bg=nr,i.bh=dg,i.bi=O_,i.bj=ja,i.bk=function(o,e){const r=[];for(const a in o)a in e||r.push(a);return r},i.bl=_n,i.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],i.bn=xt,i.bo=function(o,e){const{x:r,y:a}=o.point,u=Xo(r,a,o.worldSize/o._pixelsPerMercatorPixel,0,0);return te.mat4.multiply(u,u,Po(fi(e)))},i.bp=qh,i.bq=Ps,i.br=L_,i.bs=function(o,e,r,a,u){const l=5*e+2;o.float32[l+0]=r,o.float32[l+1]=a,o.float32[l+2]=u},i.bt=W_,i.bu=Iw,i.bv=H,i.bw=Oi,i.bx=Pb,i.by=g2,i.bz=Ob,i.c=de,i.c$=lw,i.c0=d2,i.c1=function(o){const e=d2(o,!0);return te.mat2.invert([],[e[0],e[1],e[4],e[5]])},i.c2=nn,i.c3=function(o){const{x:e,y:r}=o.point,{lng:a,lat:u}=o._center;return Xo(e,r,o.worldSize,a,u)},i.c4=jt,i.c5=Mt,i.c6=Wf,i.c7=function(o){const e=Math.round((o+45+360)%360/90)%4;return Yt[e]},i.c8=45,i.c9=Ud,i.cA=Gf,i.cB=class extends Co{constructor(o){super(o),this.current=gv}set(o,e,r){if(this.fetchUniformLocation(o,e)){for(let a=0;a<9;a++)if(r[a]!==this.current[a]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}}},i.cC=Gt,i.cD=function(o,e,r){const a=zi(r.zoom),u=o.style.map._antialias,l=o.terrain&&o.terrain.exaggeration()>0;return a===0&&!u&&!l},i.cE=function(o){const e=o.pixelsPerMeter,r=e/Wi(1,o.center.lat),a=te.mat4.identity(new Float64Array(16));return te.mat4.translate(a,a,[o.point.x,o.point.y,0]),te.mat4.scale(a,a,[r,r,e]),Float32Array.from(a)},i.cF=Sn,i.cG=function(o){const e=Ji-5;o=Ye(o,-80.051129,e)/e*90;const r=Math.pow(Math.abs(Math.sin(Rt(o))),3);return Math.round(r*(Xf.length-1))},i.cH=function(o,e,r,a){const u=e.getNorth(),l=e.getSouth(),f=e.getWest(),y=e.getEast(),b=1<<o.z,S=y-f,_=u-l,w=S/ol,A=-_/Xf[r],T=[0,w,0,A,0,0,u,f,0];if(o.z>0){const E=180/a;te.mat3.multiply(T,T,[E/S+1,0,0,0,E/_+1,0,-.5*E/w,.5*E/A,1])}return T[2]=b,T[5]=o.x,T[8]=o.y,T},i.cI=fi,i.cJ=function(o,e,r){const a=te.mat4.identity(new Float64Array(16)),u=(e/(1<<o)-.5)*Math.PI*2;return te.mat4.rotateY(a,r.globeMatrix,u),Float32Array.from(a)},i.cK=class{isDataAvailableAtPoint(o){const e=this._source();if(this.isUsingMockSource()||!e||o.y<0||o.y>1)return!1;const r=e.getSource().maxzoom,a=1<<r,u=Math.floor(o.x),l=Math.floor((o.x-u)*a),f=Math.floor(o.y*a),y=this.findDEMTileFor(new wt(r,u,r,l,f));return!(!y||!y.dem)}getAtPointOrZero(o,e=0){return this.getAtPoint(o,e)||0}getAtPoint(o,e,r=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||o.y<0||o.y>1)return e;const u=a.getSource().maxzoom,l=1<<u,f=Math.floor(o.x),y=o.x-f,b=new wt(u,f,u,Math.floor(y*l),Math.floor(o.y*l)),S=this.findDEMTileFor(b);if(!S||!S.dem)return e;const _=S.dem,w=1<<S.tileID.canonical.z,A=(y*w-S.tileID.canonical.x)*_.dim,T=(o.y*w-S.tileID.canonical.y)*_.dim,E=Math.floor(A),C=Math.floor(T);return(r?this.exaggeration():1)*or(or(_.get(E,C),_.get(E,C+1),T-C),or(_.get(E+1,C),_.get(E+1,C+1),T-C),A-E)}getAtTileOffset(o,e,r){const a=1<<o.canonical.z;return this.getAtPointOrZero(new s(o.wrap+(o.canonical.x+e/Ct)/a,(o.canonical.y+r/Ct)/a))}getAtTileOffsetFunc(o,e,r,a){return u=>{const l=this.getAtTileOffset(o,u.x,u.y),f=a.upVector(o.canonical,u.x,u.y),y=a.upVectorScale(o.canonical,e,r).metersToTile;return te.vec3.scale(f,f,l*y),f}}getForTilePoints(o,e,r,a){if(this.isUsingMockSource())return!1;const u=Jh.create(this,o,a);return!!u&&(e.forEach(l=>{l[2]=this.exaggeration()*u.getElevationAt(l[0],l[1],r)}),!0)}getMinMaxForTile(o){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(o);if(!e||!e.dem)return null;const r=e.dem.tree,a=e.tileID,u=1<<o.canonical.z-a.canonical.z;let l=o.canonical.x/u-a.canonical.x,f=o.canonical.y/u-a.canonical.y,y=0;for(let b=0;b<o.canonical.z-a.canonical.z&&!r.leaves[y];b++){l*=2,f*=2;const S=2*Math.floor(f)+Math.floor(l);y=r.childOffsets[y]+S,l%=1,f%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const o=this.visibleDemTiles;if(o.length===0)return null;let e=!1,r=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const u of o){const l=this.getMinMaxForTile(u.tileID);l&&(r=Math.min(r,l.min),a=Math.max(a,l.max),e=!0)}return e?{min:r,max:a}:null}},i.cL=ob,i.cM=Kr,i.cN=function(o,e){return[Math.pow(o[0],2.2)*e,Math.pow(o[1],2.2)*e,Math.pow(o[2],2.2)*e]},i.cO=Gs,i.cP=Xe,i.cQ=Ec,i.cR=256,i.cS=function(o,e){const r=[0,0,0],a=li(fi(e.canonical));return te.vec3.transformMat4(r,r,a),te.vec3.transformMat4(r,r,o),r},i.cT=o=>({u_camera_to_center_distance:new Jn(o),u_extrude_scale:new qf(o),u_device_pixel_ratio:new Jn(o),u_matrix:new il(o),u_inv_rot_matrix:new il(o),u_merc_center:new As(o),u_tile_id:new Nh(o),u_zoom_transition:new Jn(o),u_up_dir:new Nh(o),u_emissive_strength:new Jn(o)}),i.cU=o=>({u_matrix:new il(o),u_pixels_to_tile_units:new qf(o),u_device_pixel_ratio:new Jn(o),u_width_scale:new Jn(o),u_floor_width_scale:new Jn(o),u_units_to_pixels:new As(o),u_dash_image:new Bh(o),u_gradient_image:new Bh(o),u_image_height:new Jn(o),u_texsize:new As(o),u_tile_units_to_pixels:new Jn(o),u_alpha_discard_threshold:new Jn(o),u_trim_offset:new As(o),u_trim_fade_range:new As(o),u_trim_color:new Vh(o),u_emissive_strength:new Jn(o),u_zbias_factor:new Jn(o),u_tile_to_meter:new Jn(o)}),i.cV=o=>({u_matrix:new il(o),u_texsize:new As(o),u_pixels_to_tile_units:new qf(o),u_device_pixel_ratio:new Jn(o),u_width_scale:new Jn(o),u_floor_width_scale:new Jn(o),u_image:new Bh(o),u_units_to_pixels:new As(o),u_tile_units_to_pixels:new Jn(o),u_alpha_discard_threshold:new Jn(o),u_trim_offset:new As(o),u_trim_fade_range:new As(o),u_trim_color:new Vh(o),u_emissive_strength:new Jn(o),u_zbias_factor:new Jn(o),u_tile_to_meter:new Jn(o)}),i.cW=Of,i.cX=X3,i.cY=K3,i.cZ=jh,i.c_=(o,e,r,a,u,l)=>{const f=o.transform,y=f.projection.name==="globe";let b;if(l.paint.get("circle-pitch-alignment")==="map")if(y){const _=Gs(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;b=Float32Array.from([_,0,0,_])}else b=f.calculatePixelsToTileUnitsMatrix(r);else b=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:o.transform.getCameraToCenterDistance(f.projection),u_matrix:o.translatePosMatrix(e.projMatrix,r,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_device_pixel_ratio:We.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:tu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:l.paint.get("circle-emissive-strength")};if(y){S.u_inv_rot_matrix=a,S.u_merc_center=u,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=zi(f.zoom);const _=u[0]*Ct,w=u[1]*Ct;S.u_up_dir=f.projection.upVector(new $e(0,0,0),_,w)}return S},i.ca=eu,i.cb=Vh,i.cc=function(o,e,r){const a=Math.sqrt(o*o+e*e+r*r),u=a>0?Math.acos(r/a)*zt:0;let l=o!==0||e!==0?Math.atan2(-e,-o)*zt+90:0;return l<0&&(l+=360),[a,l,u]},i.cd=t,i.ce=sr,i.cf=vs,i.cg=function(o){return[Math.pow(o[0],1/2.2),Math.pow(o[1],1/2.2),Math.pow(o[2],1/2.2)]},i.ch=function(o,e){return o.readFields(GP,{icons:[]},e)},i.ci=function(o){return o({pluginStatus:as,pluginURL:ro}),vh.on("pluginStateChange",o),o},i.cj=ig,i.ck=Zh,i.cl=Kv,i.cm=fa,i.cn=Tf,i.co=Nt,i.cp=Js,i.cq=Kn,i.cr=function(o){const e=o.indexOf(Ah);return e>=0?o.slice(0,e):o},i.cs=function(o){return o.indexOf(Ah)>=0},i.ct=function(o){const e=o.indexOf(Ah);return e>=0?o.slice(e+1):""},i.cu=function(o){const e=[],r=o.id;return r===void 0&&e.push({message:`layers.${r}: missing required property "id"`}),o.render===void 0&&e.push({message:`layers.${r}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},i.cv=function(o,e,r,a){return o.type==="custom"?new PP(o,e):new UP[o.type](o,e,r,a)},i.cw=vo,i.cx=class extends sd{constructor(o,e){super(o._vectorTileFeature,o._z,o._x,o._y,o.id),o.state&&(this.state=Object.assign({},o.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=o.source,this.sourceLayer=o.sourceLayer,this.layer=o.layer)}toJSON(){const o=super.toJSON();return o.target=this.target,o.namespace=this.namespace,o}},i.cy=vh,i.cz=xs,i.d=function(o){return Y.API_TILEJSON_REGEX.test(o)},i.d$=gT,i.d0=Ei,i.d1=(o,e,r,a,u,l,f,y)=>{const b=o.transform,S=b.pitch<15?sw(.07,.7,Ye((14-b.zoom)/5,0,1)):.07,_=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:aw(o,e,r,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:l,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:ow(e,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(_?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:S,u_tile_to_meter:t(e.tileID.canonical,0)}},i.d2=(o,e,r,a,u,l,f,y,b)=>{const S=o.transform,_=S.calculatePixelsToTileUnitsMatrix(e),w=r.paint.get("line-trim-color-use-theme").constantOr("default")==="none",A=S.pitch<15?sw(.07,.7,Ye((14-S.zoom)/5,0,1)):.07;return{u_matrix:aw(o,e,r,a),u_pixels_to_tile_units:_,u_device_pixel_ratio:l,u_width_scale:f,u_floor_width_scale:y,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:cw(r)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ow(e,o.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toRenderColor(w?null:r.lut).toArray01(),u_emissive_strength:r.paint.get("line-emissive-strength"),u_zbias_factor:A,u_tile_to_meter:t(e.tileID.canonical,0)}},i.d3=Ki,i.d4=ep,i.d5=Yf,i.d6=Xb,i.d7=Lt,i.d8=z_,i.d9=Xl,i.dA=P_,i.dB=Cr,i.dC=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},i.dD=lr,i.dE=d,i.dF=Ca,i.dG=function([o,e,r]){const a=Math.hypot(o,e,r),u=Math.atan2(o,r),l=.5*Math.PI-Math.acos(-e/a);return new Xr(jt(u),jt(l))},i.dH=u0,i.dI=function(o){const e=o.navigator?o.navigator.userAgent:null;return!!function(r){if(Sc==null){const a=r.navigator?r.navigator.userAgent:null;Sc=!!r.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Sc}(o)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},i.dJ=function(o,e){xr=o,Tr=e},i.dK=Ro,i.dL=Cs,i.dM=function(o){const e=[0,0,0],r=te.mat4.identity(new Float64Array(16));return te.mat4.multiply(r,o.pixelMatrix,o.globeMatrix),te.vec3.transformMat4(e,e,r),new Ae(e[0],e[1])},i.dN=function(o,e,r=!1){if(as===Eo||as===bf||as===wf)throw new Error("setRTLTextPlugin cannot be called multiple times.");ro=We.resolveURL(o),as=Eo,yh=e,kl(),r||c_()},i.dO=Sf,i.dP=function(){ig().acquire(_0)},i.dQ=function(){const o=wp;o&&(o.isPreloaded()&&o.numActive()===1?(o.release(_0),wp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},i.dR=cu,i.dS=function(o){const e=Bn();if(!e)return;const r=e.delete(Ut);o&&r.catch(o).then(()=>o())},i.dT=bp,i.dU=aT,i.dV=function(o){E0=We.resolveURL(o),id||(id=new Qh(ig(),new ma)),id.broadcast("setDracoUrl",E0)},i.dW=lT,i.dX=function(o){nd=We.resolveURL(o),id||(id=new Qh(ig(),new ma)),id.broadcast("setMeshoptUrl",nd)},i.dY=Ft,i.dZ=Wl,i.d_=Qo,i.da=450,i.db=7,i.dc=CP,i.dd=Zr,i.de=Uf,i.df=256,i.dg=Po,i.dh=Mo,i.di=Ea,i.dj=Ff,i.dk=function(o,e,r,a,u){return Ye((o-e)/(r-e)*(u-a)+a,a,u)},i.dl=Ym,i.dm=Hl,i.dn=class{constructor(o,e,r,a){this.context=o,this.format=a,this.size=r,this.texture=o.gl.createTexture();const[u,l,f]=this.size,{gl:y}=o;y.bindTexture(y.TEXTURE_3D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(!1),y.texImage3D(y.TEXTURE_3D,0,this.format,u,l,f,0,o0(this.format),a0(this.format),e.data)}bind(o,e){const{context:r}=this,{gl:a}=r;a.bindTexture(a.TEXTURE_3D,this.texture),o!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,o),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,o),this.minFilter=o),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}},i.dp=h0,i.dq=[1,1,1],i.dr=Jh,i.ds=Yh,i.dt=Sa,i.du=Aa,i.dv=ql,i.dw=Nf,i.dx=Bf,i.dy=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ae(1/0,1/0),max:new Ae(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(o,e=!1){const r=Db(new Ae(0,0),new Ae(Ct,Ct),o),a=[];if(e&&!kv(r,this._globalClipBounds))return a;for(const u of this._activeRegions){if(u.hiddenByOverlap||!kv(r,u))continue;const l=w3(u.min,u.max,o);a.push({min:l.min,max:l.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return a}setSources(o){this._setSources(o.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const r=[];for(const a of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(a).buckets[e.layer];u&&u.updateFootprints(a.toUnwrapped(),r)}return r},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(o){const e=o.getFootprints();if(e.length===0)return;const r=o.getOrder(),a=o.getClipMask(),u=o.getClipScope();for(const l of e){if(!l.footprint)continue;const f=Db(l.footprint.min,l.footprint.max,l.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:l.id,footprint:l.footprint,order:r,clipMask:a,clipScope:u})}this._sourceIds.push(o.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,r)=>e.priority-r.priority||R_(e.min,r.min)||R_(e.max,r.max)||e.order-r.order||e.clipMask-r.clipMask||function(a,u){const l=(f,y)=>f+y;return a.length-u.length||a.reduce(l,"").localeCompare(u.reduce(l,""))}(e.clipScope,r.clipScope));let o=this._activeRegions.length!==this._prevRegions.length;if(!o){let e=0;for(;!o&&e!==this._activeRegions.length;){const r=this._activeRegions[e],a=this._prevRegions[e];o=r.priority!==a.priority||!Rb(r,a)||r.order!==a.order||r.clipMask!==a.clipMask||!xt(r.clipScope,a.clipScope),++e}}if(o){++this._updateTime;for(const r of this._activeRegions)r.order!==P_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,r.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,r.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,r.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,r.max.y));const e=r=>{const a=this._activeRegions;if(r>=a.length)return r;const u=a[r].priority;for(;r<a.length&&a[r].priority===u;)++r;return r};if(this._sourceIds.length>1){let r=0,a=e(r);for(;r!==a;){let u=r;const l=r;for(;u!==a;){const f=this._activeRegions[u];f.hiddenByOverlap=!1;for(let y=0;y<l;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&f.order===P_&&kv(f,b)&&(f.hiddenByOverlap=Lb(f.footprint,f.tileId,b.footprint,b.tileId),f.hiddenByOverlap))break}++u}r=a,a=e(r)}}}}_setSources(o){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=o.length-1;e>=0;e--)this._addSource(o[e]);this._computeReplacement()}},i.dz=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.withSkirts.destroy(),o.withoutSkirts.destroy()}_fillGridMeshWithLods(o,e){const r=new Ao,a=new wi,u=[],l=o+1+2,f=e[0]+1,y=e[0]+1+(1+e.length),b=(S,_,w)=>{let A=S===l-1?S-2:S===0?S:S-1;return A+=w?24575:0,[A,_]};for(let S=0;S<l;++S)r.emplaceBack(...b(S,0,!0));for(let S=0;S<f;++S)for(let _=0;_<l;++_)r.emplaceBack(...b(_,S,(_===0||_===l-1)&&!0));for(let S=0;S<e.length;++S){const _=e[S];for(let w=0;w<l;++w)r.emplaceBack(...b(w,_,!0))}for(let S=0;S<e.length;++S){const _=a.length,w=e[S]+1+2,A=new wi;for(let C=0;C<w-1;C++){const O=C===w-2,k=O?l*(y-e.length+S-C):l;for(let U=0;U<l-1;U++){const V=C*l+U;C===0||O||U===0||U===l-2?(A.emplaceBack(V+1,V,V+k),A.emplaceBack(V+k,V+k+1,V+1)):(a.emplaceBack(V+1,V,V+k),a.emplaceBack(V+k,V+k+1,V+1))}}const T=Vn.simpleSegment(0,_,r.length,a.length-_);for(let C=0;C<A.uint16.length;C+=3)a.emplaceBack(A.uint16[C],A.uint16[C+1],A.uint16[C+2]);const E=Vn.simpleSegment(0,_,r.length,a.length-_);u.push({withoutSkirts:T,withSkirts:E})}return{vertices:r,indices:a,segments:u}}_createGrid(o){const e=this._fillGridMeshWithLods(ol,Xf);this._gridSegments=e.segments,this._gridBuffer=o.createVertexBuffer(e.vertices,pr.members),this._gridIndexBuffer=o.createIndexBuffer(e.indices,!0)}_createPoles(o){const e=new wi;for(let f=0;f<=ol;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=o.createIndexBuffer(e,!0);const r=new Ea,a=new Ea,u=new Ea,l=new Ea;this._poleSegments=[];for(let f=0,y=0;f<Wf;f++){const b=360/(1<<f);r.emplaceBack(0,-Ai,0,.5,0),a.emplaceBack(0,-Ai,0,.5,1),u.emplaceBack(0,-Ai,0,.5,.5),l.emplaceBack(0,-Ai,0,.5,.5);for(let S=0;S<=ol;S++){let _=S/ol,w=0;const A=or(0,b,_),[T,E,C]=Gl(Ko,Qf,A,Ai);r.emplaceBack(T,E,C,_,w),a.emplaceBack(T,E,C,_,1-w);const O=Rt(A);_=.5+.5*Math.sin(O),w=.5+.5*Math.cos(O),u.emplaceBack(T,E,C,_,w),l.emplaceBack(T,E,C,_,1-w)}this._poleSegments.push(Vn.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(r,fr,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(a,fr,!1),this._texturedPoleNorthVertexBuffer=o.createVertexBuffer(u,fr,!1),this._texturedPoleSouthVertexBuffer=o.createVertexBuffer(l,fr,!1)}getGridBuffers(o,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[o].withSkirts:this._gridSegments[o].withoutSkirts]}getPoleBuffers(o,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}},i.e=Y,i.e0=yT,i.e1=tw,i.e2=nu,i.e3="hd_road_elevation",i.e4=class{static parseFrom(o,e){const r=al.parse(o);if(!r)return[];let{vertices:a,features:u}=r;const l=1/t(e);u.sort((S,_)=>S.id-_.id),a.sort((S,_)=>S.id-_.id||S.idx-_.idx),a=a.filter((S,_,w)=>_===w.findIndex(A=>A.id===S.id&&A.idx===S.idx));const f=new Array;let y=0;const b=a.length;for(const S of u){if(S.constantHeight){f.push(new Dv(S.id,S.bounds,S.constantHeight));continue}for(;y!==b&&a[y].id<S.id;)y++;if(y===b||a[y].id!==S.id)continue;const _=new Array,w=new Array,A=y;for(;y!==b&&a[y].id===S.id;){const T=a[y];if(_.push({position:T.position,height:T.height,extent:T.extent}),y!==A&&a[y-1].idx===T.idx-1){const E=y-A;w.push({a:E-1,b:E})}y++}f.push(new Dv(S.id,S.bounds,void 0,_,w,l))}return f}},i.e5=ys,i.e6=iu,i.e7=Pw,i.e8=Wh,i.e9=function(o,e,r,a,u,l,f,y=1,b){o.createArrays(),o.tilePixelRatio=Ct/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const S=o.layers[0].layout,_=o.layers[0]._unevaluatedLayout._values,w={};w.scaleFactor=y,w.textSizeScaleRange=S.get("text-size-scale-range"),w.iconSizeScaleRange=S.get("icon-size-scale-range");const[A,T]=w.textSizeScaleRange,[E,C]=w.iconSizeScaleRange;w.textScaleFactor=Ye(w.scaleFactor,A,T),w.iconScaleFactor=Ye(w.scaleFactor,E,C);const O=_["text-size"],k=_["icon-size"];if(o.textSizeData.kind==="composite"){const{minZoom:K,maxZoom:ae}=o.textSizeData;w.compositeTextSizes=[O.possiblyEvaluate(new gn(K),l),O.possiblyEvaluate(new gn(ae),l)]}if(o.iconSizeData.kind==="composite"){const{minZoom:K,maxZoom:ae}=o.iconSizeData;w.compositeIconSizes=[k.possiblyEvaluate(new gn(K),l),k.possiblyEvaluate(new gn(ae),l)]}w.layoutTextSize=O.possiblyEvaluate(new gn(f+1),l),w.layoutIconSize=k.possiblyEvaluate(new gn(f+1),l),w.textMaxSize=O.possiblyEvaluate(new gn(18),l);const U=S.get("symbol-placement"),V=S.get("text-rotation-alignment")==="map"&&U!=="point",N=S.get("text-size");let $=!1;const W=[];for(const K of o.features){const ae=S.get("text-font").evaluate(K,{},l).join(","),ie=N.evaluate(K,{},l)*w.textScaleFactor,se=w.layoutTextSize.evaluate(K,{},l)*w.textScaleFactor,ve=w.layoutIconSize.evaluate(K,{},l)*w.iconScaleFactor,le={horizontal:{},vertical:void 0},xe=K.text;let Me,Se=[0,0];if(xe){const at=xe.toString(),tr=S.get("text-letter-spacing").evaluate(K,{},l)*Oi,Ot=S.get("text-line-height").evaluate(K,{},l)*Oi,Ht=o_(at)?tr:0,hr=S.get("text-anchor").evaluate(K,{},l),Mr=S.get("text-variable-anchor");if(!Mr){const Wr=S.get("text-radial-offset").evaluate(K,{},l);Se=Wr?Fw(hr,[Wr*Oi,Yv]):S.get("text-offset").evaluate(K,{},l).map(yn=>yn*Oi)}let gr=V?"center":S.get("text-justify").evaluate(K,{},l);const Lr=U==="point",Sr=Lr?S.get("text-max-width").evaluate(K,{},l)*Oi:1/0,Fr=Wr=>{o.allowVerticalPlacement&&yf(at)&&(le.vertical=Zv(xe,e,r,u,ae,Sr,Ot,hr,Wr,Ht,Se,Ps.vertical,!0,se,ie,b))};if(!V&&Mr){const Wr=gr==="auto"?Mr.map(mr=>Jv(mr)):[gr];let yn=!1;for(let mr=0;mr<Wr.length;mr++){const Ur=Wr[mr];if(!le.horizontal[Ur])if(yn)le.horizontal[Ur]=le.horizontal[0];else{const En=Zv(xe,e,r,u,ae,Sr,Ot,"center",Ur,Ht,Se,Ps.horizontal,!1,se,ie,b);En&&(le.horizontal[Ur]=En,yn=En.positionedLines.length===1)}}Fr("left")}else{if(gr==="auto"&&(gr=Jv(hr)),Lr||S.get("text-writing-mode").indexOf("horizontal")>=0||!yf(at)){const Wr=Zv(xe,e,r,u,ae,Sr,Ot,hr,gr,Ht,Se,Ps.horizontal,!1,se,ie,b);Wr&&(le.horizontal[gr]=Wr)}Fr(Lr?"left":gr)}}let Ce,Ie,Fe,ze,Ne,it=!1;if(K.icon&&K.icon.hasPrimary()){const at=Nw(K.icon,o.iconSizeData,_["icon-size"],l,o.zoom,K,b,w.iconScaleFactor);Ce=at.iconPrimary,Ie=at.iconSecondary;const tr=Ce.toString(),Ot=a.get(tr);Ot&&(Fe=S.get("icon-offset").evaluate(K,{},l),ze=S.get("icon-anchor").evaluate(K,{},l),Ne=S.get("icon-text-fit").evaluate(K,{},l),Me=aP(u.get(tr),Ie?u.get(Ie.toString()):void 0,Fe,ze),it=Ot.sdf,o.sdfIcons===void 0?o.sdfIcons=Ot.sdf:o.sdfIcons!==Ot.sdf&&Pr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ot.pixelRatio!==o.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}$=$||!(!K.icon||!K.icon.hasSecondary());const nt=Qv(le.horizontal)||le.vertical;o.iconsInText||(o.iconsInText=!!nt&&nt.iconsInText);const Bt=se*w.textScaleFactor/Oi,{defaultShapedIcon:ft,verticallyShapedIcon:Tt}=mP(o,Me,S,K,l,le,Bt,Fe,Ne);Me=ft,W.push({feature:K,shapedTextOrientations:le,shapedText:nt,shapedIcon:Me,iconPrimary:Ce,iconSecondary:Ie,iconOffset:Fe,iconAnchor:ze,verticallyShapedIcon:Tt,layoutTextSize:se,layoutIconSize:ve,textOffset:Se,isSDFIcon:it,iconTextFit:Ne})}return{featureData:W,sizes:w,hasAnySecondaryIcon:$,textAlongLine:V,symbolPlacement:U}},i.ea=Rw,i.eb=function(o,e,r,a,u,l,f,y,b,S){const{featureData:_,hasAnySecondaryIcon:w,sizes:A,textAlongLine:T,symbolPlacement:E}=e;for(const C of _){const{shapedIcon:O,verticallyShapedIcon:k,feature:U,shapedTextOrientations:V,shapedText:N,layoutTextSize:$,textOffset:W,isSDFIcon:K,iconPrimary:ae,iconSecondary:ie,iconTextFit:se,iconOffset:ve}=C;Vw(O,S.iconPositions,ae,ie),Vw(k,S.iconPositions,ae,ie),pP(V,S.iconPositions),(N||O)&&_P(o,U,V,O,k,b,A,$,0,W,K,a,u,f,y,w,se,ve,T,E)}r&&o.generateCollisionDebugBuffers(l,o.collisionBoxArray,A.textScaleFactor)},i.ec=Zl,i.ed=hg,i.ee=Ve,i.ef=yb,i.eg=_w,i.eh=G,i.ei=function(o){let e=0;if(new Uint32Array(o,0,1)[0]!==uT){const r=new Uint32Array(o,0,7),[,,a,u,l,f]=r;e=r.byteLength+u+l+f+l,(a!==o.byteLength||e>=o.byteLength)&&Pr("Invalid b3dm header information.")}return pT(o,e)},i.ej=function(o,e){const r=_T(o);for(const a of r){for(const u of a.meshes)GR(u);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(qR(a.lights,e)))}return r},i.ek=ng,i.el=C2,i.em=ls,i.en=function(o){Or(),Ar!=null&&Ar.then(e=>{e.keys().then(r=>{for(let a=0;a<r.length-o;a++)e.delete(r[a])})})},i.f=function(o){return o.indexOf("mapbox:")===0},i.g=function(o,e){return xs(Vr(o,{method:"GET"}),e)},i.h=re,i.i=function(o){return Y.API_STYLE_REGEX.test(o)&&!de(o)},i.j=function(o){return decodeURIComponent(atob(o).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},i.k=function(o){return btoa(encodeURIComponent(o).replace(/%([0-9A-F]{2})/g,(e,r)=>String.fromCharCode(+("0x"+r))))},i.l=Vr,i.m=on,i.n=function(o,e){return xs(Vr(o,{type:"json"}),e)},i.o=kd,i.p=function(o,e){return xs(Vr(o,{method:"POST"}),e)},i.q=We,i.r=Li,i.s=function(o){try{const e=self[o];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},i.t=Ke,i.u=function(){return function o(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()},i.v=function(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)},i.w=Pr,i.x=function(){return g0||(g0=new cu),g0},i.y=b0,i.z=Vu}),R(["./shared"],function(i){function G(Xe){const Y=Xe?Xe.url.toString():void 0;return Y?performance.getEntriesByName(Y):[]}function X(Xe){if(typeof Xe=="number"||typeof Xe=="boolean"||typeof Xe=="string"||Xe==null)return JSON.stringify(Xe);if(Array.isArray(Xe)){let re="[";for(const de of Xe)re+=`${X(de)},`;return`${re}]`}let Y="{";for(const re of Object.keys(Xe).sort())Y+=`${re}:${X(Xe[re])},`;return`${Y}}`}function q(Xe){let Y="";for(const re of i.bm)(Xe.type!=="model"||re!=="minzoom"&&re!=="maxzoom")&&(Y+=`/${X(Xe[re])}`);return Y}class ee{constructor(Y){this.keyCache={},this._layers={},this._layerConfigs={},Y&&this.replace(Y)}replace(Y,re){this._layerConfigs={},this._layers={},this.update(Y,[],re)}update(Y,re,de){this._options=de;for(const be of Y)this._layerConfigs[be.id]=be,(this._layers[be.id]=i.cv(be,this.scope,null,this._options)).compileFilter(de),this.keyCache[be.id]&&delete this.keyCache[be.id];for(const be of re)delete this.keyCache[be],delete this._layerConfigs[be],delete this._layers[be];this.familiesBySource={};const Te=function(be,Pe){const Ge={};for(let He=0;He<be.length;He++){const Ke=be[He];let We=Pe&&Pe[Ke.id];!We&&(We=q(Ke),Ke.type==="line"&&Ke.paint)&&function Nt(Ut){return typeof Ut=="string"&&Ut==="line-progress"||(Array.isArray(Ut)?Ut.some(Nt):!(!Ut||typeof Ut!="object")&&Object.values(Ut).some(Nt))}(Ke.paint["line-width"])&&(We+=`/${X(Ke.paint["line-width"])}`),Pe&&(Pe[Ke.id]=We);let mt=Ge[We];mt||(mt=Ge[We]=[]),mt.push(Ke)}const Re=[];for(const He in Ge)Re.push(Ge[He]);return Re}(Object.values(this._layerConfigs),this.keyCache);for(const be of Te){const Pe=be.map(mt=>this._layers[mt.id]),Ge=Pe[0];if(Ge.visibility==="none")continue;const Re=Ge.source||"";let He=this.familiesBySource[Re];He||(He=this.familiesBySource[Re]={});const Ke=Ge.sourceLayer||"_geojsonTileLayer";let We=He[Ke];We||(We=He[Ke]=[]),We.push(Pe)}}}const ne=1*i.d_;class me{constructor(Y){const re={},de=[];for(const Ge in Y){const Re=Y[Ge],He=re[Ge]={};for(const Ke in Re.glyphs){const We=Re.glyphs[+Ke];if(!We||We.bitmap.width===0||We.bitmap.height===0)continue;const mt=We.metrics.localGlyph?ne:1,Nt={x:0,y:0,w:We.bitmap.width+2*mt,h:We.bitmap.height+2*mt};de.push(Nt),He[Ke]=Nt}}const{w:Te,h:be}=i.H(de),Pe=new i.dZ({width:Te||1,height:be||1});for(const Ge in Y){const Re=Y[Ge];for(const He in Re.glyphs){const Ke=Re.glyphs[+He];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const We=re[Ge][He],mt=Ke.metrics.localGlyph?ne:1;i.dZ.copy(Ke.bitmap,Pe,{x:0,y:0},{x:We.x+mt,y:We.y+mt},Ke.bitmap)}}this.image=Pe,this.positions=re}}i.dY(me,"GlyphAtlas");class he{constructor(Y){this.tileID=new i.aH(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.lut=Y.lut,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.scope=Y.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Y.showCollisionBoxes,this.collectResourceTiming=!!Y.request&&Y.request.collectResourceTiming,this.promoteId=Y.promoteId,this.isSymbolTile=Y.isSymbolTile,this.tileTransform=i.aR(Y.tileID.canonical,Y.projection),this.projection=Y.projection,this.worldview=Y.worldview,this.localizableLayerIds=Y.localizableLayerIds,this.brightness=Y.brightness,this.extraShadowCaster=!!Y.extraShadowCaster,this.tessellationStep=Y.tessellationStep,this.scaleFactor=Y.scaleFactor}parse(Y,re,de,Te,be){this.status="parsing",this.data=Y,this.collisionBoxArray=new i.aX;const Pe=new i.d$(Object.keys(Y.layers).sort()),Ge=new i.e0(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const Re={},He=new i.e1(256,256),Ke={featureIndex:Ge,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:He,availableImages:de,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},We=re.familiesBySource[this.source];for(const Or in We){const ln=Y.layers[Or];if(!ln)continue;let on=!1,an=!1,Yn=!1;for(const Bi of We[Or])Bi[0].type==="symbol"?on=!0:an=!0,Bi[0].is3D()&&Bi[0].type!=="model"&&(Yn=!0);if(this.extraShadowCaster&&!Yn||this.isSymbolTile===!0&&!on||this.isSymbolTile===!1&&!an)continue;ln.version===1&&i.w(`Vector tile source "${this.source}" layer "${Or}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bi=Pe.encode(Or),Si=[];let Fo=!1;for(let Bi=0,pi=0;Bi<ln.length;Bi++){const Ni=ln.feature(Bi),fa=Ge.getId(Ni,Or);if(this.localizableLayerIds&&this.localizableLayerIds.has(Or)){const xs=Ni.properties?Ni.properties.worldview:null;if(this.worldview&&typeof xs=="string")if(xs==="all")Ni.properties.$localized=!0;else{if(!xs.split(",").includes(this.worldview))continue;Ni.properties.$localized=!0,Ni.properties.worldview=this.worldview}}!Fo&&Ni.properties&&Ni.properties.hasOwnProperty(i.e2)&&(Fo=!0),Si.push({feature:Ni,id:fa,index:pi,sourceLayerIndex:bi}),pi++}Fo&&!Ke.elevationFeatures&&Y.layers.hasOwnProperty(i.e3)&&(Ke.elevationFeatures=i.e4.parseFrom(Y.layers[i.e3],this.canonical));for(const Bi of We[Or]){const pi=Bi[0];(!this.extraShadowCaster||pi.is3D()&&pi.type!=="model")&&(this.isSymbolTile!==void 0&&pi.type==="symbol"!==this.isSymbolTile||pi.minzoom&&this.zoom<Math.floor(pi.minzoom)||pi.maxzoom&&this.zoom>=pi.maxzoom||pi.visibility!=="none"&&(ye(Bi,this.zoom,Ke.brightness,de),(Re[pi.id]=pi.createBucket({index:Ge.bucketLayerIDs.length,layers:Bi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bi,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(Si,Ke,this.tileID.canonical,this.tileTransform),Ge.bucketLayerIDs.push(Bi.map(Ni=>i.C(Ni.id,Ni.scope)))))}}let mt,Nt,Ut,xr,Tr,Er;He.trim();const Ar={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},xn=()=>{if(mt)return this.status="done",be(mt);if(this.extraShadowCaster)this.status="done",be(null,{buckets:Object.values(Re).filter(Or=>!Or.isEmpty()),featureIndex:Ge,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ke.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Nt&&Ut&&xr){const Or=new me(Nt),ln=new Map;for(const[Yn,bi]of Ut.entries()){const{imagePosition:Si}=i.e7(Yn,bi,i.e8);ln.set(Yn,Si)}const on={};for(const Yn in Re){const bi=Re[Yn];bi instanceof i.aY&&(ye(bi.layers,this.zoom,Ke.brightness,de),on[Yn]=i.e9(bi,Nt,Or.positions,Ut,ln,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio))}const an={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Te,Ut,Tr,()=>{an.iconsPending=!1,Bn(on,Or,an)}),this.rasterizeIfNeeded(Te,xr,Er,()=>{an.patternsPending=!1,Bn(on,Or,an)})}},Bn=(Or,ln,on,an)=>{if(on.iconsPending||on.patternsPending)return;const Yn=new i.ea(Ut,xr,this.lut);for(const bi in Re){const Si=Re[bi];if(bi in Or)i.eb(Si,Or[bi],this.showCollisionBoxes,de,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Ut,Yn);else if(Si.hasPattern&&(Si instanceof i.b2||Si instanceof i.b3||Si instanceof i.d8)){ye(Si.layers,this.zoom,Ke.brightness,de);const Fo=Object.fromEntries(Yn.patternPositions);Si.addFeatures(Ke,this.tileID.canonical,Fo,de,this.tileTransform,this.brightness)}}this.status="done",be(null,{buckets:Object.values(Re).filter(bi=>!bi.isEmpty()),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ln.image,lineAtlas:He,imageAtlas:Yn,brightness:Ke.brightness})};if(!this.extraShadowCaster){const Or=i.e5(Ke.glyphDependencies,an=>Object.keys(an).map(Number));Object.keys(Or).length?Te.send("getGlyphs",{uid:this.uid,stacks:Or,scope:this.scope},(an,Yn)=>{mt||(mt=an,Nt=Yn,xn())},void 0,!1,Ar):Nt={};const ln=Array.from(Ke.iconDependencies.keys()).map(an=>i.I.parse(an));ln.length?Te.send("getImages",{images:ln,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(an,Yn)=>{mt||(mt=an,Ut=new Map,Tr=this.updateImageMapAndGetImageTaskQueue(Ut,Yn,Ke.iconDependencies),xn())},void 0,!1,Ar):(Ut=new Map,Tr=new Map);const on=Array.from(Ke.patternDependencies.keys()).map(an=>i.I.parse(an));on.length?Te.send("getImages",{images:on,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(an,Yn)=>{mt||(mt=an,xr=new Map,Er=this.updateImageMapAndGetImageTaskQueue(xr,Yn,Ke.patternDependencies),xn())},void 0,!1,Ar):(xr=new Map,Er=new Map)}if(Ke.elevationFeatures&&Ke.elevationFeatures.length>0){const Or=[];for(const on of Object.values(Re))if(on instanceof i.b3){const an=on.getUnevaluatedPortalGraph();an&&Or.push(an)}const ln=i.e6.evaluate(Or);for(const on of Object.values(Re))on instanceof i.b3&&on.setEvaluatedPortalGraph(ln)}xn()}rasterizeIfNeeded(Y,re,de,Te){Array.from(re.values()).some(be=>be.usvg)?this.rasterize(Y,re,de,Te):Te()}updateImageMapAndGetImageTaskQueue(Y,re,de){const Te=new Map;for(const be of re.keys()){const Pe=de.get(be)||[];for(const Ge of Pe){const Re=Ge.toString(),He=re.get(Ge.id.toString());He.usvg?Te.has(Re)||(Te.set(Re,Ge),Y.set(Re,Object.assign({},He))):Y.set(Re,He)}}return Te}rasterize(Y,re,de,Te){this.rasterizeTask=Y.send("rasterizeImages",{scope:this.scope,tasks:de},(be,Pe)=>{if(!be)for(const[Ge,Re]of Pe.entries()){const He=Object.assign(re.get(Ge),{data:Re});re.set(Ge,He)}Te()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ye(Xe,Y,re,de){const Te=new i.aa(Y,{brightness:re});for(const be of Xe)be.recalculate(Te,de)}class Le extends i.E{constructor(Y,re,de,Te,be,Pe){super(),this.actor=Y,this.layerIndex=re,this.availableImages=de,this.loadVectorData=be||i.aE,this.loading={},this.loaded={},this.deduped=new i.aD(Y.scheduler),this.isSpriteLoaded=Te,this.scheduler=Y.scheduler,this.brightness=Pe}loadTile(Y,re){const de=Y.uid,Te=Y&&Y.request,be=Te&&Te.collectResourceTiming,Pe=this.loading[de]=new he(Y);Pe.abort=this.loadVectorData(Y,(Ge,Re)=>{const He=!this.loading[de];if(delete this.loading[de],Pe.cancelRasterize(),He||Ge||!Re)return Pe.status="done",He||(this.loaded[de]=Pe),re(Ge);const Ke=Re.rawData,We={};Re.expires&&(We.expires=Re.expires),Re.cacheControl&&(We.cacheControl=Re.cacheControl),Pe.vectorTile=Re.vectorTile||new i.ec.VectorTile(new i.bi(Ke));const mt=()=>{Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor,(Nt,Ut)=>{if(Nt||!Ut)return re(Nt);const xr={};if(be){const Tr=G(Te);Tr.length>0&&(xr.resourceTiming=JSON.parse(JSON.stringify(Tr)))}re(null,i.l({rawTileData:Ke.slice(0)},Ut,We,xr))})};this.isSpriteLoaded?mt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(mt,{type:"parseTile",isSymbolTile:Y.isSymbolTile,zoom:Y.tileZoom}):mt()}),this.loaded=this.loaded||{},this.loaded[de]=Pe})}reloadTile(Y,re){const de=this.loaded,Te=Y.uid;if(de&&de[Te]){const be=de[Te];be.scaleFactor=Y.scaleFactor,be.showCollisionBoxes=Y.showCollisionBoxes,be.projection=Y.projection,be.brightness=Y.brightness,be.tileTransform=i.aR(Y.tileID.canonical,Y.projection),be.extraShadowCaster=Y.extraShadowCaster,be.lut=Y.lut;const Pe=(Ge,Re)=>{const He=be.reloadCallback;He&&(delete be.reloadCallback,be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,He)),re(Ge,Re)};be.status==="parsing"?be.reloadCallback=Pe:be.status==="done"&&(be.vectorTile?be.parse(be.vectorTile,this.layerIndex,this.availableImages,this.actor,Pe):Pe())}else re(null,void 0)}abortTile(Y,re){const de=Y.uid,Te=this.loading[de];Te&&(Te.abort&&Te.abort(),delete this.loading[de]),re()}removeTile(Y,re){const de=this.loaded,Te=Y.uid;de&&de[Te]&&delete de[Te],re()}}class je{loadTile(Y,re){const{uid:de,encoding:Te,rawImageData:be,padding:Pe}=Y,Ge=ImageBitmap&&be instanceof ImageBitmap?this.getImageData(be,Pe):be;re(null,new i.ed(de,Ge,Te,Pe<1))}reloadTile(Y,re){re(null,null)}abortTile(Y,re){re()}removeTile(Y,re){re()}getImageData(Y,re){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const de=this.offscreenCanvasContext.getImageData(-re,-re,Y.width+2*re,Y.height+2*re);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}i.bh.setPbf(i.bi);class vt{constructor(Y){this._mrt=new i.bh(Y.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Y.uid,this.tileID=Y.tileID,this.source=Y.source}parse(Y,re){const de=this._mrt;this.status="parsing",this._entireBuffer=Y;try{de.parseHeader(Y),this._isHeaderLoaded=!0;const Te=[];for(const be in de.layers){const Pe=de.getLayer(be),Ge=Pe.getDataRange(Pe.getBandList()),Re=de.createDecodingTask(Ge),He=Y.slice(Ge.firstByte,Ge.lastByte+1),Ke=i.bh.performDecoding(He,Re).then(We=>Re.complete(null,We)).catch(We=>Re.complete(We,null));Te.push(Ke)}Promise.allSettled(Te).then(()=>re(null,de))}catch(Te){re(Te)}}}class Dt{constructor(Y){this.actor=Y,this.loading={},this.loaded={}}loadTile(Y,re){const de=Y.uid,Te=Y.request,be=this.loading[de]=new vt(Y),{cancel:Pe}=i.bj(Te,(Ge,Re,He,Ke)=>{const We=!this.loading[de];if(delete this.loading[de],We||Ge||!Re)return be.status="done",We||(this.loaded[de]=be),re(Ge);be.parse(Re,(mt,Nt)=>{if(mt||!Nt)return re(mt);re(null,Nt,He,Ke)}),this.loaded[de]=be});be.abort=Pe}reloadTile(Y,re){re(null,void 0)}abortTile(Y,re){const de=Y.uid,Te=this.loading[de];Te&&(Te.abort&&Te.abort(),delete this.loading[de]),re()}removeTile(Y,re){const de=Y.uid;this.loaded[de]&&delete this.loaded[de],re()}decodeRasterArray({task:Y,buffer:re},de){i.bh.performDecoding(re,Y).then(Te=>de(null,Te)).catch(Te=>de(Te))}}const ut=i.ec.VectorTileFeature.prototype.toGeoJSON;class ht{constructor(Y){this._feature=Y,this.extent=i.ai,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(this._feature.type===1){const Y=[];for(const re of this._feature.geometry)Y.push([new i.P(re[0],re[1])]);return Y}{const Y=[];for(const re of this._feature.geometry){const de=[];for(const Te of re)de.push(new i.P(Te[0],Te[1]));Y.push(de)}return Y}}toGeoJSON(Y,re,de){return ut.call(this,Y,re,de)}}class St{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=i.ai,this.length=Y.length,this._features=Y}feature(Y){return new ht(this._features[Y])}}const tt=64/4096,Et=128;class pt{constructor(){this.features=new Map}clear(){this.features.clear()}load(Y=[],re){for(const de of Y){const Te=de.id;if(Te==null)continue;let be=this.features.get(Te);be&&this.updateCache(be,re),de.geometry?(be=gt(de),this.updateCache(be,re),this.features.set(Te,be)):this.features.delete(Te),this.updateCache(be,re)}}updateCache(Y,re){for(const{canonical:de,uid:Te}of Object.values(re)){const{z:be,x:Pe,y:Ge}=de;ot(Y,Math.pow(2,be),Pe,Ge)&&delete re[Te]}}getTile(Y,re,de){const Te=Math.pow(2,Y),be=[];for(const Pe of this.features.values())ot(Pe,Te,re,de)&&be.push(Zt(Pe,Te,re,de));return{features:be}}getFeatures(){return[...this.features.values()]}}function ot({minX:Xe,minY:Y,maxX:re,maxY:de},Te,be,Pe){return Xe<(be+1+tt)/Te&&Y<(Pe+1+tt)/Te&&re>(be-tt)/Te&&de>(Pe-tt)/Te}function gt(Xe){const{id:Y,geometry:re,properties:de}=Xe;if(!re)return;if(re.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Te,coordinates:be}=re,Pe={id:Y,type:1,geometry:[],tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ge=Pe.geometry;if(Te==="Point")yt(be,Ge,Pe);else if(Te==="MultiPoint")for(const Re of be)yt(Re,Ge,Pe);else if(Te==="LineString")Pe.type=2,ir(be,Ge,Pe);else if(Te==="MultiLineString")Pe.type=2,zr(be,Ge,Pe);else if(Te==="Polygon")Pe.type=3,zr(be,Ge,Pe,!0);else{if(Te!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Pe.type=3;for(const Re of be)zr(Re,Ge,Pe,!0)}return Pe}function yt([Xe,Y],re,de){const Te=i.av(Xe);let be=i.aC(Y);be=be<0?0:be>1?1:be,re.push(Te,be),de.minX=Math.min(de.minX,Te),de.minY=Math.min(de.minY,be),de.maxX=Math.max(de.maxX,Te),de.maxY=Math.max(de.maxY,be)}function ir(Xe,Y,re,de=!1,Te=!1){const be=[];for(const Pe of Xe)yt(Pe,be,re);Y.push(be),de&&function(Pe,Ge){let Re=0;for(let He=0,Ke=Pe.length,We=Ke-2;He<Ke;We=He,He+=2)Re+=(Pe[He]-Pe[We])*(Pe[He+1]+Pe[We+1]);if(Re>0===Ge)for(let He=0,Ke=Pe.length;He<Ke/2;He+=2){const We=Pe[He],mt=Pe[He+1];Pe[He]=Pe[Ke-2-He],Pe[He+1]=Pe[Ke-1-He],Pe[Ke-2-He]=We,Pe[Ke-1-He]=mt}}(be,Te)}function zr(Xe,Y,re,de=!1){for(let Te=0;Te<Xe.length;Te++)ir(Xe[Te],Y,re,de,Te===0)}function Zt(Xe,Y,re,de){const{id:Te,type:be,geometry:Pe,tags:Ge}=Xe,Re=[];if(be===1)(function(He,Ke,We,mt,Nt){for(let Ut=0;Ut<He.length;Ut+=2){const xr=Math.round(i.ai*(He[Ut+0]*Ke-We)),Tr=Math.round(i.ai*(He[Ut+1]*Ke-mt));Nt.push([xr,Tr])}})(Pe,Y,re,de,Re);else for(const He of Pe)Ir(He,Y,re,de,Re);return{id:Te,type:be,geometry:Re,tags:Ge}}function Ir(Xe,Y,re,de,Te){const Pe=i.ai+Et;let Ge;for(let Re=0;Re<Xe.length-2;Re+=2){let He=Math.round(i.ai*(Xe[Re+0]*Y-re)),Ke=Math.round(i.ai*(Xe[Re+1]*Y-de)),We=Math.round(i.ai*(Xe[Re+2]*Y-re)),mt=Math.round(i.ai*(Xe[Re+3]*Y-de));const Nt=We-He,Ut=mt-Ke;He<-128&&We<-128||(He<-128?(Ke+=Math.round(Ut*((-128-He)/Nt)),He=-128):We<-128&&(mt=Ke+Math.round(Ut*((-128-He)/Nt)),We=-128),Ke<-128&&mt<-128||(Ke<-128?(He+=Math.round(Nt*((-128-Ke)/Ut)),Ke=-128):mt<-128&&(We=He+Math.round(Nt*((-128-Ke)/Ut)),mt=-128),He>=Pe&&We>=Pe||(He>=Pe?(Ke+=Math.round(Ut*((Pe-He)/Nt)),He=Pe):We>=Pe&&(mt=Ke+Math.round(Ut*((Pe-He)/Nt)),We=Pe),Ke>=Pe&&mt>=Pe||(Ke>=Pe?(He+=Math.round(Nt*((Pe-Ke)/Ut)),Ke=Pe):mt>=Pe&&(We=He+Math.round(Nt*((Pe-Ke)/Ut)),mt=Pe),Ge&&He===Ge[Ge.length-1][0]&&Ke===Ge[Ge.length-1][1]||(Ge=[[He,Ke]],Te.push(Ge)),Ge.push([We,mt])))))}}var yr,Nr,ar,Gr={exports:{}},cr=function(){if(ar)return Gr.exports;ar=1;var Xe=i.eg(),Y=function(){if(Nr)return yr;Nr=1;var Ke=i.ee(),We=i.ef().VectorTileFeature;function mt(Ut,xr){this.options=xr||{},this.features=Ut,this.length=Ut.length}function Nt(Ut,xr){this.id=typeof Ut.id=="number"?Ut.id:void 0,this.type=Ut.type,this.rawGeometry=Ut.type===1?[Ut.geometry]:Ut.geometry,this.properties=Ut.tags,this.extent=xr||4096}return yr=mt,mt.prototype.feature=function(Ut){return new Nt(this.features[Ut],this.options.extent)},Nt.prototype.loadGeometry=function(){var Ut=this.rawGeometry;this.geometry=[];for(var xr=0;xr<Ut.length;xr++){for(var Tr=Ut[xr],Er=[],Ar=0;Ar<Tr.length;Ar++)Er.push(new Ke(Tr[Ar][0],Tr[Ar][1]));this.geometry.push(Er)}return this.geometry},Nt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ut=this.geometry,xr=1/0,Tr=-1/0,Er=1/0,Ar=-1/0,xn=0;xn<Ut.length;xn++)for(var Bn=Ut[xn],Or=0;Or<Bn.length;Or++){var ln=Bn[Or];xr=Math.min(xr,ln.x),Tr=Math.max(Tr,ln.x),Er=Math.min(Er,ln.y),Ar=Math.max(Ar,ln.y)}return[xr,Er,Tr,Ar]},Nt.prototype.toGeoJSON=We.prototype.toGeoJSON,yr}();function re(Ke){var We=new Xe;return function(mt,Nt){for(var Ut in mt.layers)Nt.writeMessage(3,de,mt.layers[Ut])}(Ke,We),We.finish()}function de(Ke,We){var mt;We.writeVarintField(15,Ke.version||1),We.writeStringField(1,Ke.name||""),We.writeVarintField(5,Ke.extent||4096);var Nt={keys:[],values:[],keycache:{},valuecache:{}};for(mt=0;mt<Ke.length;mt++)Nt.feature=Ke.feature(mt),We.writeMessage(2,Te,Nt);var Ut=Nt.keys;for(mt=0;mt<Ut.length;mt++)We.writeStringField(3,Ut[mt]);var xr=Nt.values;for(mt=0;mt<xr.length;mt++)We.writeMessage(4,He,xr[mt])}function Te(Ke,We){var mt=Ke.feature;mt.id!==void 0&&We.writeVarintField(1,mt.id),We.writeMessage(2,be,Ke),We.writeVarintField(3,mt.type),We.writeMessage(4,Re,mt)}function be(Ke,We){var mt=Ke.feature,Nt=Ke.keys,Ut=Ke.values,xr=Ke.keycache,Tr=Ke.valuecache;for(var Er in mt.properties){var Ar=mt.properties[Er],xn=xr[Er];if(Ar!==null){xn===void 0&&(Nt.push(Er),xr[Er]=xn=Nt.length-1),We.writeVarint(xn);var Bn=typeof Ar;Bn!=="string"&&Bn!=="boolean"&&Bn!=="number"&&(Ar=JSON.stringify(Ar));var Or=Bn+":"+Ar,ln=Tr[Or];ln===void 0&&(Ut.push(Ar),Tr[Or]=ln=Ut.length-1),We.writeVarint(ln)}}}function Pe(Ke,We){return(We<<3)+(7&Ke)}function Ge(Ke){return Ke<<1^Ke>>31}function Re(Ke,We){for(var mt=Ke.loadGeometry(),Nt=Ke.type,Ut=0,xr=0,Tr=mt.length,Er=0;Er<Tr;Er++){var Ar=mt[Er],xn=1;Nt===1&&(xn=Ar.length),We.writeVarint(Pe(1,xn));for(var Bn=Nt===3?Ar.length-1:Ar.length,Or=0;Or<Bn;Or++){Or===1&&Nt!==1&&We.writeVarint(Pe(2,Bn-1));var ln=Ar[Or].x-Ut,on=Ar[Or].y-xr;We.writeVarint(Ge(ln)),We.writeVarint(Ge(on)),Ut+=ln,xr+=on}Nt===3&&We.writeVarint(Pe(7,1))}}function He(Ke,We){var mt=typeof Ke;mt==="string"?We.writeStringField(1,Ke):mt==="boolean"?We.writeBooleanField(7,Ke):mt==="number"&&(Ke%1!=0?We.writeDoubleField(3,Ke):Ke<0?We.writeSVarintField(6,Ke):We.writeVarintField(5,Ke))}return Gr.exports=re,Gr.exports.fromVectorTileJs=re,Gr.exports.fromGeojsonVt=function(Ke,We){We=We||{};var mt={};for(var Nt in Ke)mt[Nt]=new Y(Ke[Nt].features,We),mt[Nt].name=Nt,mt[Nt].version=We.version,mt[Nt].extent=We.extent;return re({layers:mt})},Gr.exports.GeoJSONWrapper=Y,Gr.exports}(),rr=i.eh(cr);const $t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Xe=>Xe},vi=Math.fround||(hi=new Float32Array(1),Xe=>(hi[0]=+Xe,hi[0]));var hi;const pn=3,Pt=5,er=6;class Kt{constructor(Y){this.options=Object.assign(Object.create($t),Y),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Y){const{log:re,minZoom:de,maxZoom:Te}=this.options;re&&console.time("total time");const be=`prepare ${Y.length} points`;re&&console.time(be),this.points=Y;const Pe=[];for(let Re=0;Re<Y.length;Re++){const He=Y[Re];if(!He.geometry)continue;const[Ke,We]=He.geometry.coordinates,mt=vi(ke(Ke)),Nt=vi(Ve(We));Pe.push(mt,Nt,1/0,Re,-1,1),this.options.reduce&&Pe.push(0)}let Ge=this.trees[Te+1]=this._createTree(Pe);re&&console.timeEnd(be);for(let Re=Te;Re>=de;Re--){const He=+Date.now();Ge=this.trees[Re]=this._createTree(this._cluster(Ge,Re)),re&&console.log("z%d: %d clusters in %dms",Re,Ge.numItems,+Date.now()-He)}return re&&console.timeEnd("total time"),this}getClusters(Y,re){let de=((Y[0]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,Y[1]));let be=Y[2]===180?180:((Y[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)de=-180,be=180;else if(de>be){const We=this.getClusters([de,Te,180,Pe],re),mt=this.getClusters([-180,Te,be,Pe],re);return We.concat(mt)}const Ge=this.trees[this._limitZoom(re)],Re=Ge.range(ke(de),Ve(Pe),ke(be),Ve(Te)),He=Ge.data,Ke=[];for(const We of Re){const mt=this.stride*We;Ke.push(He[mt+Pt]>1?te(He,mt,this.clusterProps):this.points[He[mt+pn]])}return Ke}getChildren(Y){const re=this._getOriginId(Y),de=this._getOriginZoom(Y),Te="No cluster with the specified id.",be=this.trees[de];if(!be)throw new Error(Te);const Pe=be.data;if(re*this.stride>=Pe.length)throw new Error(Te);const Ge=this.options.radius/(this.options.extent*Math.pow(2,de-1)),Re=be.within(Pe[re*this.stride],Pe[re*this.stride+1],Ge),He=[];for(const Ke of Re){const We=Ke*this.stride;Pe[We+4]===Y&&He.push(Pe[We+Pt]>1?te(Pe,We,this.clusterProps):this.points[Pe[We+pn]])}if(He.length===0)throw new Error(Te);return He}getLeaves(Y,re,de){const Te=[];return this._appendLeaves(Te,Y,re=re||10,de=de||0,0),Te}getTile(Y,re,de){const Te=this.trees[this._limitZoom(Y)],be=Math.pow(2,Y),{extent:Pe,radius:Ge}=this.options,Re=Ge/Pe,He=(de-Re)/be,Ke=(de+1+Re)/be,We={features:[]};return this._addTileFeatures(Te.range((re-Re)/be,He,(re+1+Re)/be,Ke),Te.data,re,de,be,We),re===0&&this._addTileFeatures(Te.range(1-Re/be,He,1,Ke),Te.data,be,de,be,We),re===be-1&&this._addTileFeatures(Te.range(0,He,Re/be,Ke),Te.data,-1,de,be,We),We.features.length?We:null}getClusterExpansionZoom(Y){let re=this._getOriginZoom(Y)-1;for(;re<=this.options.maxZoom;){const de=this.getChildren(Y);if(re++,de.length!==1)break;Y=de[0].properties.cluster_id}return re}_appendLeaves(Y,re,de,Te,be){const Pe=this.getChildren(re);for(const Ge of Pe){const Re=Ge.properties;if(Re&&Re.cluster?be+Re.point_count<=Te?be+=Re.point_count:be=this._appendLeaves(Y,Re.cluster_id,de,Te,be):be<Te?be++:Y.push(Ge),Y.length===de)break}return be}_createTree(Y){const re=new i.bE(Y.length/this.stride|0,this.options.nodeSize,Float32Array);for(let de=0;de<Y.length;de+=this.stride)re.add(Y[de],Y[de+1]);return re.finish(),re.data=Y,re}_addTileFeatures(Y,re,de,Te,be,Pe){for(const Ge of Y){const Re=Ge*this.stride,He=re[Re+Pt]>1;let Ke,We,mt;if(He)Ke=mn(re,Re,this.clusterProps),We=re[Re],mt=re[Re+1];else{const xr=this.points[re[Re+pn]];Ke=xr.properties;const[Tr,Er]=xr.geometry.coordinates;We=ke(Tr),mt=Ve(Er)}const Nt={type:1,geometry:[[Math.round(this.options.extent*(We*be-de)),Math.round(this.options.extent*(mt*be-Te))]],tags:Ke};let Ut;Ut=He||this.options.generateId?re[Re+pn]:this.points[re[Re+pn]].id,Ut!==void 0&&(Nt.id=Ut),Pe.features.push(Nt)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,re){const{radius:de,extent:Te,reduce:be,minPoints:Pe}=this.options,Ge=de/(Te*Math.pow(2,re)),Re=Y.data,He=[],Ke=this.stride;for(let We=0;We<Re.length;We+=Ke){if(Re[We+2]<=re)continue;Re[We+2]=re;const mt=Re[We],Nt=Re[We+1],Ut=Y.within(Re[We],Re[We+1],Ge),xr=Re[We+Pt];let Tr=xr;for(const Er of Ut){const Ar=Er*Ke;Re[Ar+2]>re&&(Tr+=Re[Ar+Pt])}if(Tr>xr&&Tr>=Pe){let Er,Ar=mt*xr,xn=Nt*xr,Bn=-1;const Or=(We/Ke<<5)+(re+1)+this.points.length;for(const ln of Ut){const on=ln*Ke;if(Re[on+2]<=re)continue;Re[on+2]=re;const an=Re[on+Pt];Ar+=Re[on]*an,xn+=Re[on+1]*an,Re[on+4]=Or,be&&(Er||(Er=this._map(Re,We,!0),Bn=this.clusterProps.length,this.clusterProps.push(Er)),be(Er,this._map(Re,on)))}Re[We+4]=Or,He.push(Ar/Tr,xn/Tr,1/0,Or,-1,Tr),be&&He.push(Bn)}else{for(let Er=0;Er<Ke;Er++)He.push(Re[We+Er]);if(Tr>1)for(const Er of Ut){const Ar=Er*Ke;if(!(Re[Ar+2]<=re)){Re[Ar+2]=re;for(let xn=0;xn<Ke;xn++)He.push(Re[Ar+xn])}}}}return He}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,re,de){if(Y[re+Pt]>1){const Pe=this.clusterProps[Y[re+er]];return de?Object.assign({},Pe):Pe}const Te=this.points[Y[re+pn]].properties,be=this.options.map(Te);return de&&be===Te?Object.assign({},be):be}}function te(Xe,Y,re){return{type:"Feature",id:Xe[Y+pn],properties:mn(Xe,Y,re),geometry:{type:"Point",coordinates:[(de=Xe[Y],360*(de-.5)),Ae(Xe[Y+1])]}};var de}function mn(Xe,Y,re){const de=Xe[Y+Pt],Te=de>=1e4?`${Math.round(de/1e3)}k`:de>=1e3?Math.round(de/100)/10+"k":de,be=Xe[Y+er],Pe=be===-1?{}:Object.assign({},re[be]);return Object.assign(Pe,{cluster:!0,cluster_id:Xe[Y+pn],point_count:de,point_count_abbreviated:Te})}function ke(Xe){return Xe/360+.5}function Ve(Xe){const Y=Math.sin(Xe*Math.PI/180),re=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return re<0?0:re>1?1:re}function Ae(Xe){const Y=(180-360*Xe)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function xt(Xe,Y,re,de){let Te=de;const be=Y+(re-Y>>1);let Pe,Ge=re-Y;const Re=Xe[Y],He=Xe[Y+1],Ke=Xe[re],We=Xe[re+1];for(let mt=Y+3;mt<re;mt+=3){const Nt=Vt(Xe[mt],Xe[mt+1],Re,He,Ke,We);if(Nt>Te)Pe=mt,Te=Nt;else if(Nt===Te){const Ut=Math.abs(mt-be);Ut<Ge&&(Pe=mt,Ge=Ut)}}Te>de&&(Pe-Y>3&&xt(Xe,Y,Pe,de),Xe[Pe+2]=Te,re-Pe>3&&xt(Xe,Pe,re,de))}function Vt(Xe,Y,re,de,Te,be){let Pe=Te-re,Ge=be-de;if(Pe!==0||Ge!==0){const Re=((Xe-re)*Pe+(Y-de)*Ge)/(Pe*Pe+Ge*Ge);Re>1?(re=Te,de=be):Re>0&&(re+=Pe*Re,de+=Ge*Re)}return Pe=Xe-re,Ge=Y-de,Pe*Pe+Ge*Ge}function zt(Xe,Y,re,de){const Te={id:Xe??null,type:Y,geometry:re,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Y==="Point"||Y==="MultiPoint"||Y==="LineString")Rt(Te,re);else if(Y==="Polygon")Rt(Te,re[0]);else if(Y==="MultiLineString")for(const be of re)Rt(Te,be);else if(Y==="MultiPolygon")for(const be of re)Rt(Te,be[0]);return Te}function Rt(Xe,Y){for(let re=0;re<Y.length;re+=3)Xe.minX=Math.min(Xe.minX,Y[re]),Xe.minY=Math.min(Xe.minY,Y[re+1]),Xe.maxX=Math.max(Xe.maxX,Y[re]),Xe.maxY=Math.max(Xe.maxY,Y[re+1])}function jt(Xe,Y,re,de){if(!Y.geometry)return;const Te=Y.geometry.coordinates;if(Te&&Te.length===0)return;const be=Y.geometry.type,Pe=Math.pow(re.tolerance/((1<<re.maxZoom)*re.extent),2);let Ge=[],Re=Y.id;if(re.promoteId?Re=Y.properties[re.promoteId]:re.generateId&&(Re=de||0),be==="Point")Yt(Te,Ge);else if(be==="MultiPoint")for(const He of Te)Yt(He,Ge);else if(be==="LineString")Gt(Te,Ge,Pe,!1);else if(be==="MultiLineString"){if(re.lineMetrics){for(const He of Te)Ge=[],Gt(He,Ge,Pe,!1),Xe.push(zt(Re,"LineString",Ge,Y.properties));return}Cr(Te,Ge,Pe,!1)}else if(be==="Polygon")Cr(Te,Ge,Pe,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(const He of Y.geometry.geometries)jt(Xe,{id:Re,geometry:He,properties:Y.properties},re,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of Te){const Ke=[];Cr(He,Ke,Pe,!0),Ge.push(Ke)}}Xe.push(zt(Re,be,Ge,Y.properties))}function Yt(Xe,Y){Y.push(lr(Xe[0]),Ye(Xe[1]),0)}function Gt(Xe,Y,re,de){let Te,be,Pe=0;for(let Re=0;Re<Xe.length;Re++){const He=lr(Xe[Re][0]),Ke=Ye(Xe[Re][1]);Y.push(He,Ke,0),Re>0&&(Pe+=de?(Te*Ke-He*be)/2:Math.sqrt(Math.pow(He-Te,2)+Math.pow(Ke-be,2))),Te=He,be=Ke}const Ge=Y.length-3;Y[2]=1,xt(Y,0,Ge,re),Y[Ge+2]=1,Y.size=Math.abs(Pe),Y.start=0,Y.end=Y.size}function Cr(Xe,Y,re,de){for(let Te=0;Te<Xe.length;Te++){const be=[];Gt(Xe[Te],be,re,de),Y.push(be)}}function lr(Xe){return Xe/360+.5}function Ye(Xe){const Y=Math.sin(Xe*Math.PI/180),re=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return re<0?0:re>1?1:re}function Jt(Xe,Y,re,de,Te,be,Pe,Ge){if(de/=Y,be>=(re/=Y)&&Pe<de)return Xe;if(Pe<re||be>=de)return null;const Re=[];for(const He of Xe){const Ke=He.geometry;let We=He.type;const mt=Te===0?He.minX:He.minY,Nt=Te===0?He.maxX:He.maxY;if(mt>=re&&Nt<de){Re.push(He);continue}if(Nt<re||mt>=de)continue;let Ut=[];if(We==="Point"||We==="MultiPoint")jr(Ke,Ut,re,de,Te);else if(We==="LineString")_n(Ke,Ut,re,de,Te,!1,Ge.lineMetrics);else if(We==="MultiLineString")xi(Ke,Ut,re,de,Te,!1);else if(We==="Polygon")xi(Ke,Ut,re,de,Te,!0);else if(We==="MultiPolygon")for(const xr of Ke){const Tr=[];xi(xr,Tr,re,de,Te,!0),Tr.length&&Ut.push(Tr)}if(Ut.length){if(Ge.lineMetrics&&We==="LineString"){for(const xr of Ut)Re.push(zt(He.id,We,xr,He.tags));continue}We!=="LineString"&&We!=="MultiLineString"||(Ut.length===1?(We="LineString",Ut=Ut[0]):We="MultiLineString"),We!=="Point"&&We!=="MultiPoint"||(We=Ut.length===3?"Point":"MultiPoint"),Re.push(zt(He.id,We,Ut,He.tags))}}return Re.length?Re:null}function jr(Xe,Y,re,de,Te){for(let be=0;be<Xe.length;be+=3){const Pe=Xe[be+Te];Pe>=re&&Pe<=de&&ri(Y,Xe[be],Xe[be+1],Xe[be+2])}}function _n(Xe,Y,re,de,Te,be,Pe){let Ge=Vr(Xe);const Re=Te===0?Ki:ki;let He,Ke,We=Xe.start;for(let Tr=0;Tr<Xe.length-3;Tr+=3){const Er=Xe[Tr],Ar=Xe[Tr+1],xn=Xe[Tr+2],Bn=Xe[Tr+3],Or=Xe[Tr+4],ln=Te===0?Er:Ar,on=Te===0?Bn:Or;let an=!1;Pe&&(He=Math.sqrt(Math.pow(Er-Bn,2)+Math.pow(Ar-Or,2))),ln<re?on>re&&(Ke=Re(Ge,Er,Ar,Bn,Or,re),Pe&&(Ge.start=We+He*Ke)):ln>de?on<de&&(Ke=Re(Ge,Er,Ar,Bn,Or,de),Pe&&(Ge.start=We+He*Ke)):ri(Ge,Er,Ar,xn),on<re&&ln>=re&&(Ke=Re(Ge,Er,Ar,Bn,Or,re),an=!0),on>de&&ln<=de&&(Ke=Re(Ge,Er,Ar,Bn,Or,de),an=!0),!be&&an&&(Pe&&(Ge.end=We+He*Ke),Y.push(Ge),Ge=Vr(Xe)),Pe&&(We+=He)}let mt=Xe.length-3;const Nt=Xe[mt],Ut=Xe[mt+1],xr=Te===0?Nt:Ut;xr>=re&&xr<=de&&ri(Ge,Nt,Ut,Xe[mt+2]),mt=Ge.length-3,be&&mt>=3&&(Ge[mt]!==Ge[0]||Ge[mt+1]!==Ge[1])&&ri(Ge,Ge[0],Ge[1],Ge[2]),Ge.length&&Y.push(Ge)}function Vr(Xe){const Y=[];return Y.size=Xe.size,Y.start=Xe.start,Y.end=Xe.end,Y}function xi(Xe,Y,re,de,Te,be){for(const Pe of Xe)_n(Pe,Y,re,de,Te,be,!1)}function ri(Xe,Y,re,de){Xe.push(Y,re,de)}function Ki(Xe,Y,re,de,Te,be){const Pe=(be-Y)/(de-Y);return ri(Xe,be,re+(Te-re)*Pe,1),Pe}function ki(Xe,Y,re,de,Te,be){const Pe=(be-re)/(Te-re);return ri(Xe,Y+(de-Y)*Pe,be,1),Pe}function ys(Xe,Y){const re=[];for(let de=0;de<Xe.length;de++){const Te=Xe[de],be=Te.type;let Pe;if(be==="Point"||be==="MultiPoint"||be==="LineString")Pe=vo(Te.geometry,Y);else if(be==="MultiLineString"||be==="Polygon"){Pe=[];for(const Ge of Te.geometry)Pe.push(vo(Ge,Y))}else if(be==="MultiPolygon"){Pe=[];for(const Ge of Te.geometry){const Re=[];for(const He of Ge)Re.push(vo(He,Y));Pe.push(Re)}}re.push(zt(Te.id,be,Pe,Te.tags))}return re}function vo(Xe,Y){const re=[];re.size=Xe.size,Xe.start!==void 0&&(re.start=Xe.start,re.end=Xe.end);for(let de=0;de<Xe.length;de+=3)re.push(Xe[de]+Y,Xe[de+1],Xe[de+2]);return re}function Kn(Xe,Y){if(Xe.transformed)return Xe;const re=1<<Xe.z,de=Xe.x,Te=Xe.y;for(const be of Xe.features){const Pe=be.geometry,Ge=be.type;if(be.geometry=[],Ge===1)for(let Re=0;Re<Pe.length;Re+=2)be.geometry.push(Fi(Pe[Re],Pe[Re+1],Y,re,de,Te));else for(let Re=0;Re<Pe.length;Re++){const He=[];for(let Ke=0;Ke<Pe[Re].length;Ke+=2)He.push(Fi(Pe[Re][Ke],Pe[Re][Ke+1],Y,re,de,Te));be.geometry.push(He)}}return Xe.transformed=!0,Xe}function Fi(Xe,Y,re,de,Te,be){return[Math.round(re*(Xe*de-Te)),Math.round(re*(Y*de-be))]}function Pr(Xe,Y,re,de,Te){const be=Y===Te.maxZoom?0:Te.tolerance/((1<<Y)*Te.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:Xe.length,source:null,x:re,y:de,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ge of Xe)xo(Pe,Ge,be,Te);return Pe}function xo(Xe,Y,re,de){const Te=Y.geometry,be=Y.type,Pe=[];if(Xe.minX=Math.min(Xe.minX,Y.minX),Xe.minY=Math.min(Xe.minY,Y.minY),Xe.maxX=Math.max(Xe.maxX,Y.maxX),Xe.maxY=Math.max(Xe.maxY,Y.maxY),be==="Point"||be==="MultiPoint")for(let Ge=0;Ge<Te.length;Ge+=3)Pe.push(Te[Ge],Te[Ge+1]),Xe.numPoints++,Xe.numSimplified++;else if(be==="LineString")vl(Pe,Te,Xe,re,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(let Ge=0;Ge<Te.length;Ge++)vl(Pe,Te[Ge],Xe,re,be==="Polygon",Ge===0);else if(be==="MultiPolygon")for(let Ge=0;Ge<Te.length;Ge++){const Re=Te[Ge];for(let He=0;He<Re.length;He++)vl(Pe,Re[He],Xe,re,!0,He===0)}if(Pe.length){let Ge=Y.tags||null;if(be==="LineString"&&de.lineMetrics){Ge={};for(const He in Y.tags)Ge[He]=Y.tags[He];Ge.mapbox_clip_start=Te.start/Te.size,Ge.mapbox_clip_end=Te.end/Te.size}const Re={geometry:Pe,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:Ge};Y.id!==null&&(Re.id=Y.id),Xe.features.push(Re)}}function vl(Xe,Y,re,de,Te,be){const Pe=de*de;if(de>0&&Y.size<(Te?Pe:de))return void(re.numPoints+=Y.length/3);const Ge=[];for(let Re=0;Re<Y.length;Re+=3)(de===0||Y[Re+2]>Pe)&&(re.numSimplified++,Ge.push(Y[Re],Y[Re+1])),re.numPoints++;Te&&function(Re,He){let Ke=0;for(let We=0,mt=Re.length,Nt=mt-2;We<mt;Nt=We,We+=2)Ke+=(Re[We]-Re[Nt])*(Re[We+1]+Re[Nt+1]);if(Ke>0===He)for(let We=0,mt=Re.length;We<mt/2;We+=2){const Nt=Re[We],Ut=Re[We+1];Re[We]=Re[mt-2-We],Re[We+1]=Re[mt-1-We],Re[mt-2-We]=Nt,Re[mt-1-We]=Ut}}(Ge,be),Xe.push(Ge)}const vs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Va{constructor(Y,re){const de=(re=this.options=function(be,Pe){for(const Ge in Pe)be[Ge]=Pe[Ge];return be}(Object.create(vs),re)).debug;if(de&&console.time("preprocess data"),re.maxZoom<0||re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(re.promoteId&&re.generateId)throw new Error("promoteId and generateId cannot be used together.");let Te=function(be,Pe){const Ge=[];if(be.type==="FeatureCollection")for(let Re=0;Re<be.features.length;Re++)jt(Ge,be.features[Re],Pe,Re);else jt(Ge,be.type==="Feature"?be:{geometry:be},Pe);return Ge}(Y,re);this.tiles={},this.tileCoords=[],de&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",re.indexMaxZoom,re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Te=function(be,Pe){const Ge=Pe.buffer/Pe.extent;let Re=be;const He=Jt(be,1,-1-Ge,Ge,0,-1,2,Pe),Ke=Jt(be,1,1-Ge,2+Ge,0,-1,2,Pe);return(He||Ke)&&(Re=Jt(be,1,-Ge,1+Ge,0,-1,2,Pe)||[],He&&(Re=ys(He,1).concat(Re)),Ke&&(Re=Re.concat(ys(Ke,-1)))),Re}(Te,re),Te.length&&this.splitTile(Te,0,0,0),de&&(Te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Y,re,de,Te,be,Pe,Ge){const Re=[Y,re,de,Te],He=this.options,Ke=He.debug;for(;Re.length;){Te=Re.pop(),de=Re.pop(),re=Re.pop(),Y=Re.pop();const We=1<<re,mt=Ua(re,de,Te);let Nt=this.tiles[mt];if(!Nt&&(Ke>1&&console.time("creation"),Nt=this.tiles[mt]=Pr(Y,re,de,Te,He),this.tileCoords.push({z:re,x:de,y:Te}),Ke)){Ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",re,de,Te,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));const an=`z${re}`;this.stats[an]=(this.stats[an]||0)+1,this.total++}if(Nt.source=Y,be==null){if(re===He.indexMaxZoom||Nt.numPoints<=He.indexMaxPoints)continue}else{if(re===He.maxZoom||re===be)continue;if(be!=null){const an=be-re;if(de!==Pe>>an||Te!==Ge>>an)continue}}if(Nt.source=null,Y.length===0)continue;Ke>1&&console.time("clipping");const Ut=.5*He.buffer/He.extent,xr=.5-Ut,Tr=.5+Ut,Er=1+Ut;let Ar=null,xn=null,Bn=null,Or=null,ln=Jt(Y,We,de-Ut,de+Tr,0,Nt.minX,Nt.maxX,He),on=Jt(Y,We,de+xr,de+Er,0,Nt.minX,Nt.maxX,He);Y=null,ln&&(Ar=Jt(ln,We,Te-Ut,Te+Tr,1,Nt.minY,Nt.maxY,He),xn=Jt(ln,We,Te+xr,Te+Er,1,Nt.minY,Nt.maxY,He),ln=null),on&&(Bn=Jt(on,We,Te-Ut,Te+Tr,1,Nt.minY,Nt.maxY,He),Or=Jt(on,We,Te+xr,Te+Er,1,Nt.minY,Nt.maxY,He),on=null),Ke>1&&console.timeEnd("clipping"),Re.push(Ar||[],re+1,2*de,2*Te),Re.push(xn||[],re+1,2*de,2*Te+1),Re.push(Bn||[],re+1,2*de+1,2*Te),Re.push(Or||[],re+1,2*de+1,2*Te+1)}}getTile(Y,re,de){Y=+Y,re=+re,de=+de;const Te=this.options,{extent:be,debug:Pe}=Te;if(Y<0||Y>24)return null;const Ge=1<<Y,Re=Ua(Y,re=re+Ge&Ge-1,de);if(this.tiles[Re])return Kn(this.tiles[Re],be);Pe>1&&console.log("drilling down to z%d-%d-%d",Y,re,de);let He,Ke=Y,We=re,mt=de;for(;!He&&Ke>0;)Ke--,We>>=1,mt>>=1,He=this.tiles[Ua(Ke,We,mt)];return He&&He.source?(Pe>1&&(console.log("found parent tile z%d-%d-%d",Ke,We,mt),console.time("drilling down")),this.splitTile(He.source,Ke,We,mt,Y,re,de),Pe>1&&console.timeEnd("drilling down"),this.tiles[Re]?Kn(this.tiles[Re],be):null):null}}function Ua(Xe,Y,re){return 32*((1<<Xe)*re+Y)+Xe}function Sc(Xe,Y){const re=Xe.tileID.canonical;if(!this._geoJSONIndex)return void Y(null,null);const de=this._geoJSONIndex.getTile(re.z,re.x,re.y);if(!de)return void Y(null,null);const Te=new St(de.features);let be=rr(Te);be.byteOffset===0&&be.byteLength===be.buffer.byteLength||(be=new Uint8Array(be)),Y(null,{vectorTile:Te,rawData:be.buffer})}class xl extends Le{constructor(Y,re,de,Te,be,Pe){super(Y,re,de,Te,Sc,Pe),be&&(this.loadGeoJSON=be),this._dynamicIndex=new pt}loadData(Y,re){const de=Y&&Y.request,Te=de&&de.collectResourceTiming;this.loadGeoJSON(Y,(be,Pe)=>{if(be||!Pe)return re(be);if(typeof Pe!="object")return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{try{if(Y.filter){const Re=i.X(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Re.result==="error")throw new Error(Re.value.map(He=>`${He.key}: ${He.message}`).join(", "));Pe.features=Pe.features.filter(He=>Re.value.evaluate({zoom:0},He))}Y.dynamic?(Pe.type==="Feature"&&(Pe={type:"FeatureCollection",features:[Pe]}),Y.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Pe.features,this.loaded),Y.cluster&&(Pe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Y.cluster?new Kt(function({superclusterOptions:Re,clusterProperties:He}){if(!He||!Re)return Re;const Ke={},We={},mt={accumulated:null,zoom:0},Nt={properties:null},Ut=Object.keys(He);for(const xr of Ut){const[Tr,Er]=He[xr],Ar=i.X(Er),xn=i.X(typeof Tr=="string"?[Tr,["accumulated"],["get",xr]]:Tr);Ke[xr]=Ar.value,We[xr]=xn.value}return Re.map=xr=>{Nt.properties=xr;const Tr={};for(const Er of Ut)Tr[Er]=Ke[Er].evaluate(mt,Nt);return Tr},Re.reduce=(xr,Tr)=>{Nt.properties=Tr;for(const Er of Ut)mt.accumulated=xr[Er],xr[Er]=We[Er].evaluate(mt,Nt)},Re}(Y)).load(Pe.features):Y.dynamic?this._dynamicIndex:function(Re,He){return new Va(Re,He)}(Pe,Y.geojsonVtOptions)}catch(Re){return re(Re)}const Ge={};if(Te){const Re=G(de);Re&&(Ge.resourceTiming={},Ge.resourceTiming[Y.source]=JSON.parse(JSON.stringify(Re)))}re(null,Ge)}})}reloadTile(Y,re){const de=this.loaded;return de&&de[Y.uid]?Y.partial?re(null,void 0):super.reloadTile(Y,re):this.loadTile(Y,re)}loadGeoJSON(Y,re){if(Y.request)i.n(Y.request,re);else{if(typeof Y.data!="string")return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return re(null,JSON.parse(Y.data))}catch{return re(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,re){try{re(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(de){re(de)}}getClusterChildren(Y,re){try{re(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(de){re(de)}}getClusterLeaves(Y,re){try{re(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(de){re(de)}}}class Bu{constructor(Y,re){this.tileID=new i.aH(Y.tileID.overscaledZ,Y.tileID.wrap,Y.tileID.canonical.z,Y.tileID.canonical.x,Y.tileID.canonical.y),this.tileZoom=Y.tileZoom,this.uid=Y.uid,this.zoom=Y.zoom,this.canonical=Y.tileID.canonical,this.pixelRatio=Y.pixelRatio,this.tileSize=Y.tileSize,this.source=Y.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Y.projection,this.brightness=re}parse(Y,re,de,Te){this.status="parsing";const be=new i.aH(de.tileID.overscaledZ,de.tileID.wrap,de.tileID.canonical.z,de.tileID.canonical.x,de.tileID.canonical.y),Pe=[],Ge=re.familiesBySource[de.source],Re=new i.e0(be,de.promoteId);return Re.bucketLayerIDs=[],Re.is3DTile=!0,i.ei(Y).then(He=>{if(!He)return Te(new Error("Could not parse tile"));const Ke=i.ej(He,1/i.cd(de.tileID.canonical)),We=He.json.extensionsUsed&&He.json.extensionsUsed.includes("MAPBOX_mesh_features")||He.json.asset.extras&&He.json.asset.extras.MAPBOX_mesh_features,mt=He.json.extensionsUsed&&He.json.extensionsUsed.includes("EXT_meshopt_compression"),Nt=new i.aa(this.zoom,{brightness:this.brightness});for(const Ut in Ge)for(const xr of Ge[Ut]){const Tr=xr[0];Re.bucketLayerIDs.push(xr.map(Ar=>i.C(Ar.id,Ar.scope))),Tr.recalculate(Nt,[]);const Er=new i.ek(xr,Ke,be,We,mt,this.brightness,Re);We||(Er.needsUpload=!0),Pe.push(Er),Er.evaluate(Tr)}this.status="done",Te(null,{buckets:Pe,featureIndex:Re,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(He=>Te(new Error(He.message)))}}class Nu{constructor(Y,re,de,Te,be,Pe){this.actor=Y,this.layerIndex=re,this.availableImages=de,this.brightness=Pe,this.loading={},this.loaded={}}loadTile(Y,re){const de=Y.uid,Te=this.loading[de]=new Bu(Y,this.brightness);i.bj(Y.request,(be,Pe)=>{const Ge=!this.loading[de];return delete this.loading[de],Ge||be?(Te.status="done",Ge||(this.loaded[de]=Te),re(be)):Pe&&Pe.byteLength!==0?void Te.parse(Pe,this.layerIndex,Y,(Re,He)=>{Te.status="done",this.loaded=this.loaded||{},this.loaded[de]=Te,Re||!He?re(Re):re(null,He)}):(Te.status="done",this.loaded[de]=Te,re())})}reloadTile(Y,re){const de=this.loaded,Te=Y.uid;if(de&&de[Te]){const be=de[Te];be.projection=Y.projection,be.brightness=Y.brightness;const Pe=(Ge,Re)=>{be.reloadCallback&&(delete be.reloadCallback,this.loadTile(Y,re)),re(Ge,Re)};be.status==="parsing"?be.reloadCallback=Pe:be.status==="done"&&this.loadTile(Y,re)}}abortTile(Y,re){const de=Y.uid;this.loading[de]&&delete this.loading[de],re()}removeTile(Y,re){const de=this.loaded,Te=Y.uid;de&&de[Te]&&delete de[Te],re()}}class Ec{constructor(Y){this.self=Y,this.actor=new i.el(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new i.y,this.projections={},this.defaultProjection=i.bP({name:"mercator"}),this.workerSourceTypes={vector:Le,geojson:xl,"raster-dem":je,"raster-array":Dt,"batched-model":Nu},this.workerSources={},this.self.registerWorkerSource=(re,de)=>{if(this.workerSourceTypes[re])throw new Error(`Worker source with name "${re}" already registered.`);this.workerSourceTypes[re]=de},this.self.registerRTLTextPlugin=re=>{if(i.em.isParsed())throw new Error("RTL text plugin already registered.");i.em.applyArabicShaping=re.applyArabicShaping,i.em.processBidirectionalText=re.processBidirectionalText,i.em.processStyledBidirectionalText=re.processStyledBidirectionalText}}clearCaches(Y,re,de){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],de()}checkIfReady(Y,re,de){de()}setReferrer(Y,re){this.referrer=re}spriteLoaded(Y,{scope:re,isLoaded:de}){if(this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),this.isSpriteLoaded[Y][re]=de,this.workerSources[Y]&&this.workerSources[Y][re])for(const Te in this.workerSources[Y][re]){const be=this.workerSources[Y][re][Te];for(const Pe in be){const Ge=be[Pe];Ge instanceof Le&&(Ge.isSpriteLoaded=de,Ge.fire(new i.A("isSpriteLoaded")))}}}setImages(Y,{scope:re,images:de},Te){if(this.availableImages[Y]||(this.availableImages[Y]={}),this.availableImages[Y][re]=de,this.workerSources[Y]&&this.workerSources[Y][re]){for(const be in this.workerSources[Y][re]){const Pe=this.workerSources[Y][re][be];for(const Ge in Pe)Pe[Ge].availableImages=de}Te()}else Te()}setProjection(Y,re){this.projections[Y]=i.bP(re)}setBrightness(Y,re,de){this.brightness=re,de()}setLayers(Y,re,de){this.getLayerIndex(Y,re.scope).replace(re.layers,re.options),de()}updateLayers(Y,re,de){this.getLayerIndex(Y,re.scope).update(re.layers,re.removedIds,re.options),de()}loadTile(Y,re,de){re.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,re.type,re.source,re.scope).loadTile(re,de)}decodeRasterArray(Y,re,de){this.getWorkerSource(Y,re.type,re.source,re.scope).decodeRasterArray(re,de)}reloadTile(Y,re,de){re.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,re.type,re.source,re.scope).reloadTile(re,de)}abortTile(Y,re,de){this.getWorkerSource(Y,re.type,re.source,re.scope).abortTile(re,de)}removeTile(Y,re,de){this.getWorkerSource(Y,re.type,re.source,re.scope).removeTile(re,de)}removeSource(Y,re,de){if(!(this.workerSources[Y]&&this.workerSources[Y][re.scope]&&this.workerSources[Y][re.scope][re.type]&&this.workerSources[Y][re.scope][re.type][re.source]))return;const Te=this.workerSources[Y][re.scope][re.type][re.source];delete this.workerSources[Y][re.scope][re.type][re.source],Te.removeSource!==void 0?Te.removeSource(re,de):de()}loadWorkerSource(Y,re,de){try{this.self.importScripts(re.url),de()}catch(Te){de(Te.toString())}}syncRTLPluginState(Y,re,de){try{i.em.setState(re);const Te=i.em.getPluginURL();if(i.em.isLoaded()&&!i.em.isParsed()&&Te!=null){this.self.importScripts(Te);const be=i.em.isParsed();de(be?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Te}`),be)}}catch(Te){de(Te.toString())}}setDracoUrl(Y,re){this.dracoUrl=re}getAvailableImages(Y,re){this.availableImages[Y]||(this.availableImages[Y]={});let de=this.availableImages[Y][re];return de||(de=[]),de}getLayerIndex(Y,re){this.layerIndexes[Y]||(this.layerIndexes[Y]={});let de=this.layerIndexes[Y][re];return de||(de=this.layerIndexes[Y][re]=new ee,de.scope=re),de}getWorkerSource(Y,re,de,Te){const be=this.workerSources;return be[Y]||(be[Y]={}),be[Y][Te]||(be[Y][Te]={}),be[Y][Te][re]||(be[Y][Te][re]={}),this.isSpriteLoaded[Y]||(this.isSpriteLoaded[Y]={}),be[Y][Te][re][de]||(be[Y][Te][re][de]=new this.workerSourceTypes[re]({send:(Pe,Ge,Re,He,Ke,We)=>{this.actor.send(Pe,Ge,Re,Y,Ke,We)},scheduler:this.actor.scheduler},this.getLayerIndex(Y,Te),this.getAvailableImages(Y,Te),this.isSpriteLoaded[Y][Te],void 0,this.brightness)),be[Y][Te][re][de]}rasterizeImages(Y,re,de){const Te=new Map;for(const[be,{image:Pe,imageVariant:Ge}]of re.tasks.entries()){const Re=this.imageRasterizer.rasterize(Ge,Pe,re.scope,Y);Te.set(be,Re)}de(void 0,Te)}removeRasterizedImages(Y,re,de){this.imageRasterizer.removeImagesFromCacheByIds(re.imageIds,re.scope,Y),de()}enforceCacheSizeLimit(Y,re){i.en(re)}getWorkerPerformanceMetrics(Y,re,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ec(self)),Ec}),R(["./shared"],function(i){var G="3.11.0";const X={create:"create",load:"load",fullLoad:"fullLoad"},q={mark(d){performance.mark(d)},measure(d,t,s){performance.measure(d,t,s)}};function ee(d){const t=d.name.split("?")[0];return i.a(t)&&t.includes("mapbox-gl.js")?"javascript":i.a(t)&&t.includes("mapbox-gl.css")?"css":i.b(t)?"fontRange":i.c(t)?"sprite":i.i(t)?"style":i.d(t)?"tilejson":"other"}var ne,me={},he=function(){if(ne)return me;function d(h){return!t(h)}function t(h){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,x,M=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(M);try{x=new Worker(P),g=!0}catch{g=!1}return x&&x.terminate(),URL.revokeObjectURL(P),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var x=g.getContext("2d");if(!x)return!1;var M=x.getImageData(0,0,1,1);return M&&M.width===g.width}()?(s[m=h&&h.failIfMajorPerformanceCaveat]===void 0&&(s[m]=function(g){var x,M=function(P){var z=document.createElement("canvas"),L=Object.create(d.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=P,z.getContext("webgl2",L)}(g);if(!M)return!1;try{x=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!x||M.isContextLost())&&(M.shaderSource(x,"void main() {}"),M.compileShader(x),M.getShaderParameter(x,M.COMPILE_STATUS)===!0)}(m)),s[m]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var m}ne=1,me.supported=d,me.notSupportedReason=t;var s={};return d.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},me}();function ye(d,t,s){const h=document.createElement(d);return t!=null&&(h.className=t),s&&s.appendChild(h),h}function Le(d,t,s){const h=document.createElementNS("http://www.w3.org/2000/svg",d);for(const m of Object.keys(t))h.setAttributeNS(null,m,String(t[m]));return s&&s.appendChild(h),h}const je=typeof document<"u"?document.documentElement&&document.documentElement.style:null,vt=je&&je.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Dt;function ut(){je&&vt&&(Dt=je[vt],je[vt]="none")}function ht(){je&&vt&&(je[vt]=Dt)}function St(d){d.preventDefault(),d.stopPropagation(),window.removeEventListener("click",St,!0)}function tt(){window.addEventListener("click",St,!0),window.setTimeout(()=>{window.removeEventListener("click",St,!0)},0)}function Et(d,t){const s=d.getBoundingClientRect();return gt(d,s,t)}function pt(d,t){const s=d.getBoundingClientRect(),h=[];for(let m=0;m<t.length;m++)h.push(gt(d,s,t[m]));return h}function ot(d){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&d.button===2&&d.ctrlKey?0:d.button}function gt(d,t,s){const h=d.offsetWidth===t.width?1:d.offsetWidth/t.width;return new i.P((s.clientX-t.left)*h,(s.clientY-t.top)*h)}const yt="01",ir="NO_ACCESS_TOKEN";class zr{constructor(t,s,h){this._transformRequestFn=t,this._customAccessToken=s,this._silenceAuthErrors=!!h,this._createSkuToken()}_createSkuToken(){const t=function(){let s="";for(let h=0;h<10;h++)s+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",yt,s].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeStyleURL(t,s){if(!i.f(t))return t;const h=Ir(t);return h.params.push(`sdk=js-${G}`),h.path=`/styles/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeGlyphsURL(t,s){if(!i.f(t))return t;const h=Ir(t);return h.path=`/fonts/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeModelURL(t,s){if(!i.f(t))return t;const h=Ir(t);return h.path=`/models/v1${h.path}`,this._makeAPIURL(h,this._customAccessToken||s)}normalizeSourceURL(t,s,h,m){if(!i.f(t))return t;const g=Ir(t);return g.path=`/v4/${g.authority}.json`,g.params.push("secure"),h&&g.params.push(`language=${h}`),m&&g.params.push(`worldview=${m}`),this._makeAPIURL(g,this._customAccessToken||s)}normalizeIconsetURL(t,s){const h=Ir(t);return i.f(t)?(h.path=`/styles/v1${h.path}/iconset.pbf`,this._makeAPIURL(h,this._customAccessToken||s)):yr(h)}normalizeSpriteURL(t,s,h,m){const g=Ir(t);return i.f(t)?(g.path=`/styles/v1${g.path}/sprite${s}${h}`,this._makeAPIURL(g,this._customAccessToken||m)):(g.path+=`${s}${h}`,yr(g))}normalizeTileURL(t,s,h){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!i.f(t))return t;const m=Ir(t);m.path=m.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${s||h&&m.authority!=="raster"&&h===512?"@2x":""}${i.m.supported?".webp":"$1"}`),m.authority==="raster"?m.path=`/${i.e.RASTER_URL_PREFIX}${m.path}`:m.authority==="rasterarrays"?m.path=`/${i.e.RASTERARRAYS_URL_PREFIX}${m.path}`:m.authority==="3dtiles"?m.path=`/${i.e.TILES3D_URL_PREFIX}${m.path}`:(m.path=m.path.replace(/^.+\/v4\//,"/"),m.path=`/${i.e.TILE_URL_VERSION}${m.path}`);const g=this._customAccessToken||function(x){for(const M of x){const P=M.match(/^access_token=(.*)$/);if(P)return P[1]}return null}(m.params)||i.e.ACCESS_TOKEN;return i.e.REQUIRE_ACCESS_TOKEN&&g&&this._skuToken&&m.params.push(`sku=${this._skuToken}`),this._makeAPIURL(m,g)}canonicalizeTileURL(t,s){const h=Ir(t);if(!h.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!h.path.match(/\.[\w]+$/))return t;let m="mapbox://";h.path.match(/^\/raster\/v1\//)?m+=`raster/${h.path.replace(`/${i.e.RASTER_URL_PREFIX}/`,"")}`:h.path.match(/^\/rasterarrays\/v1\//)?m+=`rasterarrays/${h.path.replace(`/${i.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:m+=`tiles/${h.path.replace(`/${i.e.TILE_URL_VERSION}/`,"")}`;let g=h.params;return s&&(g=g.filter(x=>!x.match(/^access_token=/))),g.length&&(m+=`?${g.join("&")}`),m}canonicalizeTileset(t,s){const h=!!s&&i.f(s),m=[];for(const g of t.tiles||[])i.h(g)?m.push(this.canonicalizeTileURL(g,h)):m.push(g);return m}_makeAPIURL(t,s){const h="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",m=Ir(i.e.API_URL);if(t.protocol=m.protocol,t.authority=m.authority,t.protocol==="http"){const g=t.params.indexOf("secure");g>=0&&t.params.splice(g,1)}if(m.path!=="/"&&(t.path=`${m.path}${t.path}`),!i.e.REQUIRE_ACCESS_TOKEN)return yr(t);if(s=s||i.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!s)throw new Error(`An API access token is required to use Mapbox GL. ${h}`);if(s[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${h}`)}return t.params=t.params.filter(g=>g.indexOf("access_token")===-1),t.params.push(`access_token=${s||""}`),yr(t)}}const Zt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ir(d){const t=d.match(Zt);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function yr(d){const t=d.params.length?`?${d.params.join("&")}`:"";return`${d.protocol}://${d.authority}${d.path}${t}`}const Nr="mapbox.eventData";function ar(d){if(!d)return null;const t=d.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(i.j(t[1]))}catch{return null}}class Gr{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const s=ar(i.e.ACCESS_TOKEN);let h="";return h=s&&s.u?i.k(s.u):i.e.ACCESS_TOKEN||"",t?`${Nr}.${t}:${h}`:`${Nr}:${h}`}fetchEventData(){const t=i.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid");if(t)try{const m=localStorage.getItem(s);m&&(this.eventData=JSON.parse(m));const g=localStorage.getItem(h);g&&(this.anonId=g)}catch{i.w("Unable to read from LocalStorage")}}saveEventData(){const t=i.s("localStorage"),s=this.getStorageKey(),h=this.getStorageKey("uuid"),m=this.anonId;if(t&&m)try{localStorage.setItem(h,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(s,JSON.stringify(this.eventData))}catch{i.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,s,h,m){if(!i.e.EVENTS_URL)return;const g=Ir(i.e.EVENTS_URL);g.params.push(`access_token=${m||i.e.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(t).toISOString()},M=s?i.l(x,s):x,P={url:yr(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=i.p(P,z=>{this.pendingRequest=null,h(z),this.saveEventData(),this.processRequests(m)})}queueRequest(t,s){this.queue.push(t),this.processRequests(s)}}const cr=new class extends Gr{constructor(d){super("appUserTurnstile"),this._customAccessToken=d}postTurnstileEvent(d,t){i.e.EVENTS_URL&&i.e.ACCESS_TOKEN&&Array.isArray(d)&&d.some(s=>i.f(s)||i.h(s))&&this.queueRequest(Date.now(),t)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=ar(i.e.ACCESS_TOKEN),s=t?t.u:i.e.ACCESS_TOKEN;let h=s!==this.eventData.tokenU;i.v(this.anonId)||(this.anonId=i.u(),h=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),x=new Date(m),M=(m-this.eventData.lastSuccess)/864e5;h=h||M>=1||M<-1||g.getDate()!==x.getDate()}else h=!0;h?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:yt,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=m,this.eventData.tokenU=s)},d):this.processRequests()}},rr=cr.postTurnstileEvent.bind(cr),$t=new class extends Gr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(d,t,s,h){this.skuToken=t,this.errorCb=h,i.e.EVENTS_URL&&(s||i.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},s):this.errorCb(new Error(ir)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),i.v(this.anonId)||(this.anonId=i.u()),this.postEvent(s,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:yt,skuToken:this.skuToken,userId:this.anonId},h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},d))}remove(){this.errorCb=null}},vi=$t.postMapLoadEvent.bind($t),hi=new class extends Gr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(d){let t=this.mapInstanceIdMap.get(d);return t||(t=i.u(),this.mapInstanceIdMap.set(d,t)),t}getEventId(d){const t=this.eventIdPerMapInstanceMap.get(d)||0;return this.eventIdPerMapInstanceMap.set(d,t+1),t}postStyleLoadEvent(d,t){const{map:s,style:h,importedStyles:m}=t;if(!i.e.EVENTS_URL||!d&&!i.e.ACCESS_TOKEN)return;const g=this.getMapInstanceId(s),x={mapInstanceId:g,eventId:this.getEventId(g),style:h};m.length&&(x.importedStyles=m),this.queueRequest({timestamp:Date.now(),payload:x},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:s}=this.queue.shift();this.postEvent(t,s,()=>{},d)}},pn=hi.postStyleLoadEvent.bind(hi),Pt=new class extends Gr{constructor(){super("gljs.performance")}postPerformanceEvent(d,t){i.e.EVENTS_URL&&(d||i.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},d)}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:s}=this.queue.shift(),h=function(m){const g=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),M=function(j){const Z={};if(j){for(const H in j)if(H!=="other")for(const J of j[H]){const Q=`${H}ResolveRangeMin`,oe=`${H}ResolveRangeMax`,ue=`${H}RequestCount`,ce=`${H}RequestCachedCount`;Z[Q]=Math.min(Z[Q]||1/0,J.startTime),Z[oe]=Math.max(Z[oe]||-1/0,J.responseEnd);const ge=fe=>{Z[fe]===void 0&&(Z[fe]=0),++Z[fe]};J.transferSize!==void 0&&J.transferSize===0&&ge(ce),ge(ue)}}return Z}(function(j,Z){const H={};if(j)for(const J of j){const Q=Z(J);H[Q]===void 0&&(H[Q]=[]),H[Q].push(J)}return H}(g,ee)),P=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=z?z.effectiveType:void 0,F={counters:[],metadata:[],attributes:[]},B=(j,Z,H)=>{H!=null&&j.push({name:Z,value:H.toString()})};for(const j in M)B(F.counters,j,M[j]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(B(F.counters,"interactionRangeMin",m.interactionRange[0]),B(F.counters,"interactionRangeMax",m.interactionRange[1])),x)for(const j of Object.keys(X)){const Z=X[j],H=x.find(J=>J.name===Z);H&&B(F.counters,Z,H.startTime)}return B(F.counters,"visibilityHidden",m.visibilityHidden),B(F.attributes,"style",function(j){if(j)for(const Z of j){const H=Z.name.split("?")[0];if(i.i(H)){const J=H.split("/").slice(-2);if(J.length===2)return`mapbox://styles/${J[0]}/${J[1]}`}}}(g)),B(F.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),B(F.attributes,"fogEnabled",m.fogEnabled?"true":"false"),B(F.attributes,"projection",m.projection),B(F.attributes,"zoom",m.zoom),B(F.metadata,"devicePixelRatio",P),B(F.metadata,"connectionEffectiveType",L),B(F.metadata,"navigatorUserAgent",navigator.userAgent),B(F.metadata,"screenWidth",window.screen.width),B(F.metadata,"screenHeight",window.screen.height),B(F.metadata,"windowWidth",window.innerWidth),B(F.metadata,"windowHeight",window.innerHeight),B(F.metadata,"mapWidth",m.width/P),B(F.metadata,"mapHeight",m.height/P),B(F.metadata,"webglRenderer",m.renderer),B(F.metadata,"webglVendor",m.vendor),B(F.metadata,"sdkVersion",G),B(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(s);for(const m of h.metadata);for(const m of h.counters);for(const m of h.attributes);this.postEvent(t,h,()=>{},d)}},er=Pt.postPerformanceEvent.bind(Pt),Kt=new class extends Gr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(d,t,s,h){if(!i.e.API_URL||!i.e.SESSION_PATH)return;const m=Ir(i.e.API_URL+i.e.SESSION_PATH);m.params.push(`sku=${t||""}`),m.params.push(`access_token=${h||i.e.ACCESS_TOKEN||""}`);const g={url:yr(m),headers:{"Content-Type":"text/plain"}};this.pendingRequest=i.g(g,x=>{this.pendingRequest=null,s(x),this.saveEventData(),this.processRequests(h)})}getSessionAPI(d,t,s,h){this.skuToken=t,this.errorCb=h,i.e.SESSION_PATH&&i.e.API_URL&&(s||i.e.ACCESS_TOKEN?this.queueRequest({id:d,timestamp:Date.now()},s):this.errorCb(new Error(ir)))}processRequests(d){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:s}=this.queue.shift();t&&this.success[t]||this.getSession(s,this.skuToken,h=>{h?this.errorCb(h):t&&(this.success[t]=!0)},d)}remove(){this.errorCb=null}},te=Kt.getSessionAPI.bind(Kt),mn=new Set;class ke{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,s){this._updatedSourceCaches[t]=s,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const s=t.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(t.id),this.setDirty()}removeLayer(t){const s=t.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][t.id]=t,this._updatedLayers[s].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const s in this._updatedLayers)t[s]=t[s]||{},t[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)t[s]=t[s]||{},t[s].removedIds=Object.keys(this._removedLayers[s]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(t){this._updatedImages.add(i.I.toString(t)),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function Ve(d){const{userImage:t}=d;return!!(t&&t.render&&t.render())&&(d.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ae extends i.E{constructor(t){super(),this._images={},this._iconsets={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.patternsInFlight=new Set,this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=t,t!=="raster"&&i.t()&&(this.imageRasterizerDispatcher=new i.D(i.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new i.y),this._imageRasterizer}createScope(t){this._images[t]={},this._iconsets[t]={},this.loaded[t]=!1,this.updatedImages[t]=new Set,this.patterns[t]={},this.callbackDispatchedThisFrame[t]=new Set,this.atlasImage[t]=new i.r({width:1,height:1})}createIconset(t,s){this._iconsets[t][s]={}}isLoaded(){for(const t in this.loaded)if(!this.loaded[t])return!1;return!0}setLoaded(t,s){if(this.loaded[s]!==t&&(this.loaded[s]=t,t)){for(const{ids:h,callback:m}of this.requestors)this._notify(h,s,m);this.requestors=[]}}hasImage(t,s){return!!this.getImage(t,s)}getImage(t,s){return(t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s])[t.name]}addImage(t,s,h){const m=t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s];this._validate(t,h)&&(m[t.name]=h)}_validate(t,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new i.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new i.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new i.z(new Error(`Image "${t.name}" has invalid "content" value`))),h=!1),h}_validateStretch(t,s){if(!t)return!0;let h=0;for(const m of t){if(m[0]<h||m[1]<m[0]||s<m[1])return!1;h=m[1]}return!0}_validateContent(t,s){return t?t.length!==4||!s.usvg&&(t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,s,h){const m=t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s];h.version=m[t.name].version+1,m[t.name]=h,this.updatedImages[s].add(t),this.removeFromImageRasterizerCache(t,s)}clearUpdatedImages(t){this.updatedImages[t].clear()}removeFromImageRasterizerCache(t,s){if(this.spriteFormat!=="raster")if(i.t()){const h={imageIds:[t],scope:s};this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",h)}else this.imageRasterizer.removeImagesFromCacheByIds([t],s)}removeImage(t,s){const h=t.iconsetId?this._iconsets[s][t.iconsetId]:this._images[s],m=h[t.name];delete h[t.name],delete this.patterns[s][t.name],this.removeFromImageRasterizerCache(t,s),m.userImage&&m.userImage.onRemove&&m.userImage.onRemove()}listImages(t){const s=[];for(const h of Object.keys(this._images[t]))s.push(new i.I(h));for(const h in this._iconsets[t])for(const m of Object.keys(this._iconsets[t][h]))s.push(new i.I({name:m,iconsetId:h}));return s}getImages(t,s,h){let m=!0;const g=!!this.loaded[s];if(!g)for(const x of t)(x.iconsetId?this._iconsets[s][x.iconsetId]:this._images[s])[x.name]||(m=!1);g||m?this._notify(t,s,h):this.requestors.push({ids:t,scope:s,callback:h})}rasterizeImages({scope:t,tasks:s},h){const m=new Map;for(const[g,x]of s.entries()){const M=this.getImage(x.id,t);M&&m.set(g,{image:M,imageVariant:x})}this._rasterizeImages(t,m,h)}_rasterizeImages(t,s,h){if(i.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{tasks:s,scope:t},h);else{const m=new Map;for(const[g,{image:x,imageVariant:M}]of s.entries())m.set(g,this.imageRasterizer.rasterize(M,x,t,0));h(void 0,m)}}getUpdatedImages(t){return this.updatedImages[t]||new Set}_notify(t,s,h){const m=new Map;for(const g of t){g.iconsetId&&(this._iconsets[s][g.iconsetId]=this._iconsets[s][g.iconsetId]||{});const x=(g.iconsetId?this._iconsets[s][g.iconsetId]:this._images[s])[g.name];if(!x){if(g.iconsetId)continue;i.w(`Image "${g.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`),this.fire(new i.A("styleimagemissing",{id:g.name}));continue}const M={data:x.usvg?null:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,usvg:x.usvg,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)};x.usvg&&Object.assign(M,{width:x.icon.usvg_tree.width,height:x.icon.usvg_tree.height}),m.set(i.I.toString(g),M)}h(null,m)}getPixelSize(t){const{width:s,height:h}=this.atlasImage[t];return{width:s,height:h}}getPattern(t,s,h){const m=this.patterns[s][t.name],g=this.getImage(t,s);if(!g)return null;if(m){if(m.position.version===g.version)return m.position;m.position.version=g.version}else{if(g.usvg&&!g.data){const x=this.getPatternInFlightId(t.toString(),s);if(this.patternsInFlight.has(x))return null;this.patternsInFlight.add(x);const M=new i.B(t).scaleSelf(i.q.devicePixelRatio),P=new Map([[M.toString(),{image:g,imageVariant:M}]]);return this._rasterizeImages(s,P,(z,L)=>this.storePatternImage(M,s,g,h,L)),null}this.storePattern(t,s,g)}return this._updatePatternAtlas(s,h),this.patterns[s][t.name].position}getPatternInFlightId(t,s){return i.C(t,s)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,s,h,m,g){const x=t.toString(),M=g?g.get(x):void 0;M&&(h.data=M,this.storePattern(t.id,s,h),this._updatePatternAtlas(s,m),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),s)))}storePattern(t,s,h){const m={w:h.data.width+2*i.F,h:h.data.height+2*i.F,x:0,y:0},g=new i.G(m,h,i.F);this.patterns[s][t.name]={bin:m,position:g}}bind(t,s){const h=t.gl;let m=this.atlasTexture[s];m?this.dirty&&(m.update(this.atlasImage[s]),this.dirty=!1):(m=new i.T(t,this.atlasImage[s],h.RGBA8),this.atlasTexture[s]=m),m.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(t,s){const h=[];for(const M in this.patterns[t])h.push(this.patterns[t][M].bin);const{w:m,h:g}=i.H(h),x=this.atlasImage[t];x.resize({width:m||1,height:g||1});for(const M in this.patterns[t]){const{bin:P,position:z}=this.patterns[t][M];let L=z.padding;const F=P.x+L,B=P.y+L,j=this._images[t][M].data,Z=j.width,H=j.height;L=L>1?L-1:L,i.r.copy(j,x,{x:0,y:0},{x:F,y:B},{width:Z,height:H},s),i.r.copy(j,x,{x:0,y:H-L},{x:F,y:B-L},{width:Z,height:L},s),i.r.copy(j,x,{x:0,y:0},{x:F,y:B+H},{width:Z,height:L},s),i.r.copy(j,x,{x:Z-L,y:0},{x:F-L,y:B},{width:L,height:H},s),i.r.copy(j,x,{x:0,y:0},{x:F+Z,y:B},{width:L,height:H},s),i.r.copy(j,x,{x:Z-L,y:H-L},{x:F-L,y:B-L},{width:L,height:L},s),i.r.copy(j,x,{x:0,y:H-L},{x:F+Z,y:B-L},{width:L,height:L},s),i.r.copy(j,x,{x:0,y:0},{x:F+Z,y:B+H},{width:L,height:L},s),i.r.copy(j,x,{x:Z-L,y:0},{x:F-L,y:B+H},{width:L,height:L},s)}this.dirty=!0}beginFrame(){for(const t in this._images)this.callbackDispatchedThisFrame[t]=new Set}dispatchRenderCallbacks(t,s){for(const h of t){if(this.callbackDispatchedThisFrame[s].has(h.toString()))continue;this.callbackDispatchedThisFrame[s].add(h.toString());const m=(h.iconsetId?this._iconsets[s][h.iconsetId]:this._images[s])[h.name];Ve(m)&&this.updateImage(h,s,m)}}}function xt(d){const t=d.key,s=d.value,h=d.valueSpec||{},m=d.objectElementValidators||{},g=d.style,x=d.styleSpec;let M=[];const P=i.K(s);if(P!=="object")return[new i.V(t,s,`object expected, ${P} found`)];for(const z in s){const L=z.split(".")[0];let F;m[L]?F=m[L]:h[L]?F=Pr:m["*"]?F=m["*"]:h["*"]&&(F=Pr),F?M=M.concat(F({key:(t&&`${t}.`)+z,value:s[z],valueSpec:h[L]||h["*"],style:g,styleSpec:x,object:s,objectKey:z},s)):M.push(new i.J(t,s[z],`unknown property "${z}"`))}for(const z in h)m[z]||h[z].required&&h[z].default===void 0&&s[z]===void 0&&M.push(new i.V(t,s,`missing required property "${z}"`));return M}function Vt(d){const t=d.value,s=d.valueSpec,h=d.style,m=d.styleSpec,g=d.key,x=d.arrayElementValidator||Pr;if(i.K(t)!=="array")return[new i.V(g,t,`array expected, ${i.K(t)} found`)];if(s.length&&t.length!==s.length)return[new i.V(g,t,`array length ${s.length} expected, length ${t.length} found`)];if(s["min-length"]&&t.length<s["min-length"])return[new i.V(g,t,`array length at least ${s["min-length"]} expected, length ${t.length} found`)];let M={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};m.$version<7&&(M.function=s.function),i.K(s.value)==="object"&&(M=s.value);let P=[];for(let z=0;z<t.length;z++)P=P.concat(x({array:t,arrayIndex:z,value:t[z],valueSpec:M,style:h,styleSpec:m,key:`${g}[${z}]`},!0));return P}function zt(d){const t=d.key,s=d.value,h=d.valueSpec;let m=i.K(s);if(m==="number"&&s!=s&&(m="NaN"),m!=="number")return[new i.V(t,s,`number expected, ${m} found`)];if("minimum"in h){let g=h.minimum;if(i.K(h.minimum)==="array"&&(g=h.minimum[d.arrayIndex]),s<g)return[new i.V(t,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in h){let g=h.maximum;if(i.K(h.maximum)==="array"&&(g=h.maximum[d.arrayIndex]),s>g)return[new i.V(t,s,`${s} is greater than the maximum value ${g}`)]}return[]}function Rt(d){const t=d.valueSpec,s=i.M(d.value.type);let h,m,g,x={};const M=s!=="categorical"&&d.value.property===void 0,P=!M,z=i.K(d.value.stops)==="array"&&i.K(d.value.stops[0])==="array"&&i.K(d.value.stops[0][0])==="object",L=xt({key:d.key,value:d.value,valueSpec:d.styleSpec.function,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{stops:function(j){if(s==="identity")return[new i.V(j.key,j.value,'identity function may not have a "stops" property')];let Z=[];const H=j.value;return Z=Z.concat(Vt({key:j.key,value:H,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:F})),i.K(H)==="array"&&H.length===0&&Z.push(new i.V(j.key,H,"array must have at least one stop")),Z},default:function(j){return Pr({key:j.key,value:j.value,valueSpec:t,style:j.style,styleSpec:j.styleSpec})}}});return s==="identity"&&M&&L.push(new i.V(d.key,d.value,'missing required property "property"')),s==="identity"||d.value.stops||L.push(new i.V(d.key,d.value,'missing required property "stops"')),s==="exponential"&&d.valueSpec.expression&&!i.N(d.valueSpec)&&L.push(new i.V(d.key,d.value,"exponential functions not supported")),d.styleSpec.$version>=8&&(P&&!i.O(d.valueSpec)?L.push(new i.V(d.key,d.value,"property functions not supported")):M&&!i.Q(d.valueSpec)&&L.push(new i.V(d.key,d.value,"zoom functions not supported"))),s!=="categorical"&&!z||d.value.property!==void 0||L.push(new i.V(d.key,d.value,'"property" property is required')),L;function F(j){let Z=[];const H=j.value,J=j.key;if(i.K(H)!=="array")return[new i.V(J,H,`array expected, ${i.K(H)} found`)];if(H.length!==2)return[new i.V(J,H,`array length 2 expected, length ${H.length} found`)];if(z){if(i.K(H[0])!=="object")return[new i.V(J,H,`object expected, ${i.K(H[0])} found`)];if(H[0].zoom===void 0)return[new i.V(J,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new i.V(J,H,"object stop key must have value")];const Q=i.M(H[0].zoom);if(typeof Q!="number")return[new i.V(J,H[0].zoom,"stop zoom values must be numbers")];if(g&&g>Q)return[new i.V(J,H[0].zoom,"stop zoom values must appear in ascending order")];Q!==g&&(g=Q,m=void 0,x={}),Z=Z.concat(xt({key:`${J}[0]`,value:H[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:zt,value:B}}))}else Z=Z.concat(B({key:`${J}[0]`,value:H[0],style:j.style,styleSpec:j.styleSpec},H));return i.S(i.U(H[1]))?Z.concat([new i.V(`${J}[1]`,H[1],"expressions are not allowed in function stops.")]):Z.concat(Pr({key:`${J}[1]`,value:H[1],valueSpec:t,style:j.style,styleSpec:j.styleSpec}))}function B(j,Z){const H=i.K(j.value),J=i.M(j.value),Q=j.value!==null?j.value:Z;if(h){if(H!==h)return[new i.V(j.key,Q,`${H} stop domain type must match previous stop domain type ${h}`)]}else h=H;if(H!=="number"&&H!=="string"&&H!=="boolean"&&typeof J!="number"&&typeof J!="string"&&typeof J!="boolean")return[new i.V(j.key,Q,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&s!=="categorical"){let oe=`number expected, ${H} found`;return i.O(t)&&s===void 0&&(oe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new i.V(j.key,Q,oe)]}return s!=="categorical"||H!=="number"||typeof J=="number"&&isFinite(J)&&Math.floor(J)===J?s!=="categorical"&&H==="number"&&typeof J=="number"&&typeof m=="number"&&m!==void 0&&J<m?[new i.V(j.key,Q,"stop domain values must appear in ascending order")]:(m=J,s==="categorical"&&J in x?[new i.V(j.key,Q,"stop domain values must be unique")]:(x[J]=!0,[])):[new i.V(j.key,Q,`integer expected, found ${String(J)}`)]}}function jt(d){const t=(d.expressionContext==="property"?i.W:i.X)(i.U(d.value),d.valueSpec);if(t.result==="error")return t.value.map(h=>new i.V(`${d.key}${h.key}`,d.value,h.message));const s=t.value.expression||t.value._styleExpression.expression;if(d.expressionContext==="property"&&d.propertyKey==="text-font"&&!s.outputDefined())return[new i.V(d.key,d.value,`Invalid data expression for "${d.propertyKey}". Output values must be contained as literals within the expression.`)];if(d.expressionContext==="property"&&d.propertyType==="layout"&&!i.Y(s))return[new i.V(d.key,d.value,'"feature-state" data expressions are not supported with layout properties.')];if(d.expressionContext==="filter")return Yt(s,d);if(d.expressionContext&&d.expressionContext.indexOf("cluster")===0){if(!i.Z(s,["zoom","feature-state"]))return[new i.V(d.key,d.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(d.expressionContext==="cluster-initial"&&!i._(s))return[new i.V(d.key,d.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yt(d,t){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const m of t.valueSpec.expression.parameters)s.delete(m);if(s.size===0)return[];const h=[];return d instanceof i.$&&s.has(d.name)?[new i.V(t.key,t.value,`["${d.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(d.eachChild(m=>{h.push(...Yt(m,t))}),h)}function Gt(d){const t=d.key,s=d.value,h=d.valueSpec,m=[];return Array.isArray(h.values)?h.values.indexOf(i.M(s))===-1&&m.push(new i.V(t,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(i.M(s))===-1&&m.push(new i.V(t,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),m}function Cr(d){return i.a1(i.U(d.value))?jt(i.L({},d,{expressionContext:"filter",valueSpec:d.styleSpec[`filter_${d.layerType||"fill"}`]})):lr(d)}function lr(d){const t=d.value,s=d.key;if(i.K(t)!=="array")return[new i.V(s,t,`array expected, ${i.K(t)} found`)];const h=d.styleSpec;let m,g=[];if(t.length<1)return[new i.V(s,t,"filter array must have at least 1 element")];switch(g=g.concat(Gt({key:`${s}[0]`,value:t[0],valueSpec:h.filter_operator,style:d.style,styleSpec:d.styleSpec})),i.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&i.M(t[1])==="$type"&&g.push(new i.V(s,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new i.V(s,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(m=i.K(t[1]),m!=="string"&&g.push(new i.V(`${s}[1]`,t[1],`string expected, ${m} found`)));for(let x=2;x<t.length;x++)m=i.K(t[x]),i.M(t[1])==="$type"?g=g.concat(Gt({key:`${s}[${x}]`,value:t[x],valueSpec:h.geometry_type,style:d.style,styleSpec:d.styleSpec})):m!=="string"&&m!=="number"&&m!=="boolean"&&g.push(new i.V(`${s}[${x}]`,t[x],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)g=g.concat(lr({key:`${s}[${x}]`,value:t[x],style:d.style,styleSpec:d.styleSpec}));break;case"has":case"!has":m=i.K(t[1]),t.length!==2?g.push(new i.V(s,t,`filter array for "${t[0]}" operator must have 2 elements`)):m!=="string"&&g.push(new i.V(`${s}[1]`,t[1],`string expected, ${m} found`))}return g}function Ye(d,t){const s=d.key,h=d.style,m=d.layer,g=d.styleSpec,x=d.value,M=d.objectKey,P=g[`${t}_${d.layerType}`];if(!P)return[];const z=M.match(/^(.*)-use-theme$/);if(t==="paint"&&z&&P[z[1]])return i.S(x)?[].concat(Pr({key:d.key,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:M})):Pr({key:s,value:x,valueSpec:{type:"string"},style:h,styleSpec:g});const L=M.match(/^(.*)-transition$/);if(t==="paint"&&L&&P[L[1]]&&P[L[1]].transition)return Pr({key:s,value:x,valueSpec:g.transition,style:h,styleSpec:g});const F=d.valueSpec||P[M];if(!F)return[new i.J(s,x,`unknown property "${M}"`)];let B;if(i.K(x)==="string"&&i.O(F)&&!F.tokens&&(B=/^{([^}]+)}$/.exec(x))){const Z=`\`{ "type": "identity", "property": ${B?JSON.stringify(B[1]):'"_"'} }\``;return[new i.V(s,x,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${Z}.`)]}const j=[];if(d.layerType==="symbol")M!=="text-field"||!h||h.glyphs||h.imports||j.push(new i.V(s,x,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&i.a2(i.U(x))&&i.M(x.type)==="identity"&&j.push(new i.V(s,x,'"text-font" does not support identity functions'));else if(d.layerType==="model"&&t==="paint"&&m&&m.layout&&m.layout.hasOwnProperty("model-id")&&i.O(F)&&(i.a3(F)||i.Q(F))){const Z=i.W(i.U(x),F),H=Z.value.expression||Z.value._styleExpression.expression;H&&!i.Z(H,["measure-light"])&&(M==="model-emissive-strength"&&i._(H)&&i.Y(H)||j.push(new i.V(s,x,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return j.concat(Pr({key:d.key,value:x,valueSpec:F,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:M}))}function Jt(d){return Ye(d,"paint")}function jr(d){return Ye(d,"layout")}function _n(d){let t=[];const s=d.value,h=d.key,m=d.style,g=d.styleSpec;s.type||s.ref||t.push(new i.V(h,s,'either "type" or "ref" is required'));let x=i.M(s.type);const M=i.M(s.ref);if(s.id){const P=i.M(s.id);for(let z=0;z<d.arrayIndex;z++){const L=m.layers[z];i.M(L.id)===P&&t.push(new i.V(h,s.id,`duplicate layer id "${s.id}", previously used at line ${L.id.__line__}`))}}if("ref"in s){let P;["type","source","source-layer","filter","layout"].forEach(z=>{z in s&&t.push(new i.V(h,s[z],`"${z}" is prohibited for ref layers`))}),m.layers.forEach(z=>{i.M(z.id)===M&&(P=z)}),P?P.ref?t.push(new i.V(h,s.ref,"ref cannot reference another ref layer")):x=i.M(P.type):typeof M=="string"&&t.push(new i.V(h,s.ref,`ref layer "${M}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(s.source){const P=m.sources&&m.sources[s.source],z=P&&i.M(P.type);P?z==="vector"&&x==="raster"?t.push(new i.V(h,s.source,`layer "${s.id}" requires a raster source`)):z==="raster"&&x!=="raster"?t.push(new i.V(h,s.source,`layer "${s.id}" requires a vector source`)):z!=="vector"||s["source-layer"]?z==="raster-dem"&&x!=="hillshade"?t.push(new i.V(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||z==="geojson"&&P.lineMetrics?x==="raster-particle"&&z!=="raster-array"&&t.push(new i.V(h,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):t.push(new i.V(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new i.V(h,s.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new i.V(h,s,`layer "${s.id}" must specify a "source-layer"`)):t.push(new i.V(h,s.source,`source "${s.source}" not found`))}else t.push(new i.V(h,s,'missing required property "source"'));return t=t.concat(xt({key:h,value:s,valueSpec:g.layer,style:d.style,styleSpec:d.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Pr({key:`${h}.type`,value:s.type,valueSpec:g.layer.type,style:d.style,styleSpec:d.styleSpec,object:s,objectKey:"type"}),filter:P=>Cr(i.L({layerType:x},P)),layout:P=>xt({layer:s,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":z=>jr(i.L({layerType:x},z))}}),paint:P=>xt({layer:s,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":z=>Jt(i.L({layerType:x,layer:s},z))}})}})),t}function Vr(d){const t=d.value,s=d.key,h=i.K(t);return h!=="string"?[new i.V(s,t,`string expected, ${h} found`)]:[]}const xi={promoteId:function d({key:t,value:s}){if(i.K(s)==="string")return Vr({key:t,value:s});if(Array.isArray(s)){const h=[],m=i.U(s),g=i.X(m);return g.result==="error"&&g.value.forEach(x=>{h.push(new i.V(`${t}${x.key}`,null,`${x.message}`))}),i.Z(g.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||h.push(new i.V(`${t}`,null,"promoteId expression should be only feature dependent")),h}{const h=[];for(const m in s)h.push(...d({key:`${t}.${m}`,value:s[m]}));return h}}};function ri(d){const t=d.value,s=d.key,h=d.styleSpec,m=d.style;if(!t.type)return[new i.V(s,t,'"type" is required')];const g=i.M(t.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(g)&&(t.url||t.tiles||x.push(new i.J(s,t,'Either "url" or "tiles" is required.'))),g){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(xt({key:s,value:t,valueSpec:h[`source_${g.replace("-","_")}`],style:d.style,styleSpec:h,objectElementValidators:xi})),x;case"geojson":if(x=xt({key:s,value:t,valueSpec:h.source_geojson,style:m,styleSpec:h,objectElementValidators:xi}),t.cluster)for(const M in t.clusterProperties){const[P,z]=t.clusterProperties[M],L=typeof P=="string"?[P,["accumulated"],["get",M]]:P;x.push(...jt({key:`${s}.${M}.map`,value:z,expressionContext:"cluster-map"})),x.push(...jt({key:`${s}.${M}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return x;case"video":return xt({key:s,value:t,valueSpec:h.source_video,style:m,styleSpec:h});case"image":return xt({key:s,value:t,valueSpec:h.source_image,style:m,styleSpec:h});case"canvas":return[new i.V(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Gt({key:`${s}.type`,value:t.type,valueSpec:{values:Ki(h)}})}}function Ki(d){return d.source.reduce((t,s)=>{const h=d[s];return h.type.type==="enum"&&(t=t.concat(Object.keys(h.type.values))),t},[])}function ki(d){const t=d.value,s=d.styleSpec,h=s.light,m=d.style;let g=[];const x=i.K(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new i.V("light",t,`object expected, ${x} found`)]),g;for(const M in t){const P=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);g=g.concat(z&&h[z[1]]?Pr({key:M,value:t[M],valueSpec:{type:"string"},style:m,styleSpec:s}):P&&h[P[1]]&&h[P[1]].transition?Pr({key:M,value:t[M],valueSpec:s.transition,style:m,styleSpec:s}):h[M]?Pr({key:M,value:t[M],valueSpec:h[M],style:m,styleSpec:s}):[new i.V(M,t[M],`unknown property "${M}"`)])}return g}function ys(d){const t=d.value;let s=[];if(!t)return s;const h=i.K(t);if(h!=="object")return s=s.concat([new i.V("light-3d",t,`object expected, ${h} found`)]),s;const m=d.styleSpec,g=m["light-3d"],x=d.key,M=d.style,P=d.style.lights;for(const F of["type","id"])if(!(F in t))return s=s.concat([new i.V("light-3d",t,`missing property ${F} on light`)]),s;if(t.type&&P)for(let F=0;F<d.arrayIndex;F++){const B=i.M(t.type),j=P[F];i.M(j.type)===B&&s.push(new i.V(x,t.id,`duplicate light type "${t.type}", previously defined at line ${j.id.__line__}`))}const z=`properties_light_${t.type}`;if(!(z in m))return s=s.concat([new i.V("light-3d",t,`Invalid light type ${t.type}`)]),s;const L=m[z];for(const F in t)if(F==="properties"){const B=t[F],j=i.K(B);if(j!=="object")return s=s.concat([new i.V("properties",B,`object expected, ${j} found`)]),s;for(const Z in B)s=s.concat(L[Z]?Pr({key:Z,value:B[Z],valueSpec:L[Z],style:M,styleSpec:m}):[new i.J(d.key,B[Z],`unknown property "${Z}"`)])}else{const B=F.match(/^(.*)-transition$/),j=F.match(/^(.*)-use-theme$/);s=s.concat(j&&g[j[1]]?Pr({key:F,value:t[F],valueSpec:{type:"string"},style:M,styleSpec:m}):B&&g[B[1]]&&g[B[1]].transition?Pr({key:F,value:t[F],valueSpec:m.transition,style:M,styleSpec:m}):g[F]?Pr({key:F,value:t[F],valueSpec:g[F],style:M,styleSpec:m}):[new i.J(F,t[F],`unknown property "${F}"`)])}return s}function vo(d){const t=d.value,s=d.key,h=d.style,m=d.styleSpec,g=m.terrain;let x=[];const M=i.K(t);if(t===void 0||M==="null")return x;if(M!=="object")return x=x.concat([new i.V("terrain",t,`object expected, ${M} found`)]),x;for(const P in t){const z=P.match(/^(.*)-transition$/),L=P.match(/^(.*)-use-theme$/);x=x.concat(L&&g[L[1]]?Pr({key:P,value:t[P],valueSpec:{type:"string"},style:h,styleSpec:m}):z&&g[z[1]]&&g[z[1]].transition?Pr({key:P,value:t[P],valueSpec:m.transition,style:h,styleSpec:m}):g[P]?Pr({key:P,value:t[P],valueSpec:g[P],style:h,styleSpec:m}):[new i.J(P,t[P],`unknown property "${P}"`)])}if(t.source){const P=h.sources&&h.sources[t.source],z=P&&i.M(P.type);P?z!=="raster-dem"&&x.push(new i.V(s,t.source,`terrain cannot be used with a source of type ${String(z)}, it only be used with a "raster-dem" source type`)):x.push(new i.V(s,t.source,`source "${t.source}" not found`))}else x.push(new i.V(s,t,'terrain is missing required property "source"'));return x}function Kn(d){const t=d.value,s=d.style,h=d.styleSpec,m=h.fog;let g=[];const x=i.K(t);if(t===void 0)return g;if(x!=="object")return g=g.concat([new i.V("fog",t,`object expected, ${x} found`)]),g;for(const M in t){const P=M.match(/^(.*)-transition$/),z=M.match(/^(.*)-use-theme$/);g=g.concat(z&&m[z[1]]?Pr({key:M,value:t[M],valueSpec:{type:"string"},style:s,styleSpec:h}):P&&m[P[1]]&&m[P[1]].transition?Pr({key:M,value:t[M],valueSpec:h.transition,style:s,styleSpec:h}):m[M]?Pr({key:M,value:t[M],valueSpec:m[M],style:s,styleSpec:h}):[new i.J(M,t[M],`unknown property "${M}"`)])}return g}const Fi={"*":()=>[],array:Vt,boolean:function(d){const t=d.value,s=d.key,h=i.K(t);return h!=="boolean"?[new i.V(s,t,`boolean expected, ${h} found`)]:[]},number:zt,color:function(d){const t=d.key,s=d.value,h=i.K(s);return h!=="string"?[new i.V(t,s,`color expected, ${h} found`)]:i.a0.parseCSSColor(s)===null?[new i.V(t,s,`color expected, "${s}" found`)]:[]},enum:Gt,filter:Cr,function:Rt,layer:_n,object:xt,source:ri,model:i.a4,light:ki,"light-3d":ys,terrain:vo,fog:Kn,string:Vr,formatted:function(d){return Vr(d).length===0?[]:jt(d)},resolvedImage:function(d){return Vr(d).length===0?[]:jt(d)},projection:function(d){const t=d.value,s=d.styleSpec,h=s.projection,m=d.style;let g=[];const x=i.K(t);if(x==="object")for(const M in t)g=g.concat(Pr({key:M,value:t[M],valueSpec:h[M],style:m,styleSpec:s}));else x!=="string"&&(g=g.concat([new i.V("projection",t,`object or string expected, ${x} found`)]));return g},import:function(d){const{value:t,styleSpec:s}=d,{data:h,...m}=t;Object.defineProperty(m,"__line__",{value:t.__line__,enumerable:!1});let g=xt(i.L({},d,{value:m,valueSpec:s.import}));return i.M(m.id)===""&&g.push(new i.V(`${d.key}.id`,m,"import id can't be an empty string")),h&&(g=g.concat(vl(h,s,{key:`${d.key}.data`}))),g},iconset:function(d){const t=d.value,s=d.key,h=d.styleSpec,m=d.style;if(!t.type)return[new i.V(s,t,'"type" is required')];const g=i.M(t.type);let x=[];if(x=x.concat(xt({key:s,value:t,valueSpec:h[`iconset_${g}`],style:m,styleSpec:h})),g==="source"&&t.source){const M=m.sources&&m.sources[t.source],P=M&&i.M(M.type);M?P!=="raster-array"&&x.push(new i.V(s,t.source,`iconset cannot be used with a source of type ${String(P)}, it only be used with a "raster-array" source type`)):x.push(new i.V(s,t.source,`source "${t.source}" not found`))}return x}};function Pr(d,t=!1){const s=d.value,h=d.valueSpec,m=d.styleSpec;if(h.expression&&i.a2(i.M(s)))return Rt(d);if(h.expression&&i.S(i.U(s)))return jt(d);if(h.type&&Fi[h.type]){const g=Fi[h.type](d);return t===!0&&g.length>0&&i.K(d.value)==="array"?jt(d):g}return xt(i.L({},d,{valueSpec:h.type?m[h.type]:h}))}function xo(d){const t=d.value,s=d.key,h=Vr(d);return h.length||(t.indexOf("{fontstack}")===-1&&h.push(new i.V(s,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&h.push(new i.V(s,t,'"glyphs" url must include a "{range}" token'))),h}function vl(d,t=i.a5,s={}){return Pr({key:s.key||"",value:d,valueSpec:t.$root,styleSpec:t,style:d,objectElementValidators:{glyphs:xo,"*":()=>[]}})}function vs(d,t=i.a5){return be(vl(d,t))}const Va=d=>be(ri(d)),Ua=d=>be(ki(d)),Sc=d=>be(ys(d)),xl=d=>be(vo(d)),Bu=d=>be(Kn(d)),Nu=d=>be(function(t){const s=t.value,h=t.style,m=t.styleSpec,g=m.snow;let x=[];const M=i.K(s);if(s===void 0)return x;if(M!=="object")return x=x.concat([new i.V("snow",s,`object expected, ${M} found`)]),x;for(const P in s){const z=P.match(/^(.*)-transition$/);x=x.concat(z&&g[z[1]]&&g[z[1]].transition?Pr({key:P,value:s[P],valueSpec:m.transition,style:h,styleSpec:m}):g[P]?Pr({key:P,value:s[P],valueSpec:g[P],style:h,styleSpec:m}):[new i.J(P,s[P],`unknown property "${P}"`)])}return x}(d)),Ec=d=>be(function(t){const s=t.value,h=t.style,m=t.styleSpec,g=m.rain;let x=[];const M=i.K(s);if(s===void 0)return x;if(M!=="object")return x=x.concat([new i.V("rain",s,`object expected, ${M} found`)]),x;for(const P in s){const z=P.match(/^(.*)-transition$/);x=x.concat(z&&g[z[1]]&&g[z[1]].transition?Pr({key:P,value:s[P],valueSpec:m.transition,style:h,styleSpec:m}):g[P]?Pr({key:P,value:s[P],valueSpec:g[P],style:h,styleSpec:m}):[new i.J(P,s[P],`unknown property "${P}"`)])}return x}(d)),Xe=d=>be(_n(d)),Y=d=>be(Cr(d)),re=d=>be(Jt(d)),de=d=>be(jr(d)),Te=d=>be(i.a4(d));function be(d){return d.slice().sort((t,s)=>t.line&&s.line?t.line-s.line:0)}function Pe(d,t){let s=!1;if(t&&t.length)for(const h of t)h instanceof i.J?i.w(h.message):(d.fire(new i.z(new Error(h.message))),s=!0);return s}let Ge;class Re extends i.E{constructor(t,s="flat"){super(),this._transitionable=new i.a6(Ge||(Ge=new i.a7({anchor:new i.a8(i.a5.light.anchor),position:new i.a9(i.a5.light.position),color:new i.a8(i.a5.light.color),intensity:new i.a8(i.a5.light.intensity)}))),this.setLight(t,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s,h={}){this._validate(Ua,t,h)||(this._transitionable.setTransitionOrValue(t),this.id=s)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Pe(this,t.call(vs,i.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let He=class extends i.E{constructor(d,t,s,h){super(),this.scope=s,this._transitionable=new i.a6(new i.a7({source:new i.a8(i.a5.terrain.source),exaggeration:new i.a8(i.a5.terrain.exaggeration)}),s,h),this._transitionable.setTransitionOrValue(d,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t}get(){return this._transitionable.serialize()}set(d,t){this._transitionable.setTransitionOrValue(d,t)}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}getExaggeration(d){return this._transitioning.possiblyEvaluate(new i.aa(d)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const d=this._transitionable._values.exaggeration;if(!d)return null;const t=d.value.expression;if(!t)return null;let s=-1,h=-1,m=1;for(const g of t.zoomStops)m=t.evaluate(new i.aa(g)),m>.01?(s=g,h=-1):h=g;return m<.01&&s>0&&h>s?[s,h]:null}isZoomDependent(){const d=this._transitionable._values.exaggeration;return d!=null&&d.value!=null&&d.value.expression!=null&&d.value.expression instanceof i.ab}};const Ke=45,We=65,mt=.05;function Nt(d,t,s,h){const m=i.ae(Ke,We,s),[g,x]=Ut(d,h);let M=1-Math.min(1,Math.exp((t-g)/(x-g)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*m*d.alpha}function Ut(d,t){const s=.5/Math.tan(.5*t);return[d.range[0]+s,d.range[1]+s]}function xr(d,t,s,h,m){const g=i.ad.vec3.transformMat4([],[t,s,h],m.mercatorFogMatrix);return Nt(d,i.ad.vec3.length(g),m.pitch,m._fov)}function Tr(d,t,s,h,m,g,x){const M=[[s,h,0],[m,h,0],[m,g,0],[s,g,0]];let P=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const L of M){const F=i.ad.vec3.transformMat4([],L,t),B=i.ad.vec3.length(F);P=Math.min(P,B),z=Math.max(z,B)}return[Nt(d,P,x.pitch,x._fov),Nt(d,z,x.pitch,x._fov)]}class Er extends i.E{constructor(t,s,h,m){super();const g=new i.a7({range:new i.a8(i.a5.fog.range),color:new i.a8(i.a5.fog.color),"color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new i.a8(i.a5.fog["high-color"]),"high-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new i.a8(i.a5.fog["space-color"]),"space-color-use-theme":new i.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new i.a8(i.a5.fog["horizon-blend"]),"star-intensity":new i.a8(i.a5.fog["star-intensity"]),"vertical-range":new i.a8(i.a5.fog["vertical-range"])});this._transitionable=new i.a6(g,h,new Map(m)),this.set(t,m),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new i.af(g),this.scope=h}get state(){const t=this._transform,s=t.projection.name==="globe",h=i.ag(t.zoom),m=this.properties.get("range"),g=[.5,3];return{range:s?[i.ah(g[0],m[0],h),i.ah(g[1],m[1],h)]:m,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,s,h={}){if(this._validate(Bu,t,h))return;const m=i.l({},t);for(const g of Object.keys(i.a5.fog))m[g]===void 0&&(m[g]=i.a5.fog[g].default);this._options=m,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:i.ae(Ke,We,t))*s.a}getOpacityAtLatLng(t,s){return this._transform.projection.supportsFog?function(h,m,g){const x=i.ac.fromLngLat(m),M=g.elevation?g.elevation.getAtPointOrZero(x):0;return xr(h,x.x,x.y,M,g)}(this.state,t,s):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Tr(this.state,s,0,0,i.ai,i.ai,this._transform)}getOpacityForBounds(t,s,h,m,g){return this._transform.projection.supportsFog?Tr(this.state,t,s,h,m,g,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ut(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const h of s){const m=t.points[h];let g;if(m[2]>=0)g=m;else{const x=t.points[h-4];g=i.aj(x,m,x[2]/(x[2]-m[2]))}if(xr(this.state,g[0],g[1],0,this._transform)>=mt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,h){return(!h||h.validate!==!1)&&Pe(this,t.call(vs,i.l({value:s,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}}let Ar,xn,Bn,Or,ln=class extends i.E{constructor(d,t,s,h){super();const m=Ar||(Ar=new i.a7({density:new i.a8(i.a5.snow.density),intensity:new i.a8(i.a5.snow.intensity),color:new i.a8(i.a5.snow.color),opacity:new i.a8(i.a5.snow.opacity),vignette:new i.a8(i.a5.snow.vignette),"vignette-color":new i.a8(i.a5.snow["vignette-color"]),"center-thinning":new i.a8(i.a5.snow["center-thinning"]),direction:new i.a8(i.a5.snow.direction),"flake-size":new i.a8(i.a5.snow["flake-size"])}));this._transitionable=new i.a6(m,s,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(m),this.scope=s}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=i.ak(s[0]),m=-Math.max(i.ak(s[1]),.01),g=[Math.cos(h)*Math.cos(m),Math.sin(h)*Math.cos(m),Math.sin(m)],x=this.properties.get("vignette"),M=this.properties.get("vignette-color");return M.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(t.r,t.g,t.b,t.a*d),direction:g,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(d,t,s={}){if(this._validate(Nu,d,s))return;const h=i.l({},d);for(const m of Object.keys(i.a5.snow))h[m]===void 0&&(h[m]=i.a5.snow[m].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,s){return(!s||s.validate!==!1)&&Pe(this,d.call(vs,i.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}},on=class extends i.E{constructor(d,t,s,h){super();const m=xn||(xn=new i.a7({density:new i.a8(i.a5.rain.density),intensity:new i.a8(i.a5.rain.intensity),color:new i.a8(i.a5.rain.color),opacity:new i.a8(i.a5.rain.opacity),vignette:new i.a8(i.a5.rain.vignette),"vignette-color":new i.a8(i.a5.rain["vignette-color"]),"center-thinning":new i.a8(i.a5.rain["center-thinning"]),direction:new i.a8(i.a5.rain.direction),"droplet-size":new i.a8(i.a5.rain["droplet-size"]),"distortion-strength":new i.a8(i.a5.rain["distortion-strength"])}));this._transitionable=new i.a6(m,s,new Map(h)),this.set(d,h),this._transitioning=this._transitionable.untransitioned(),this.properties=new i.af(m),this.scope=s}get state(){const d=this.properties.get("opacity"),t=this.properties.get("color"),s=this.properties.get("direction"),h=i.ak(s[0]),m=-Math.max(i.ak(s[1]),.01),g=[Math.cos(h)*Math.cos(m),Math.sin(h)*Math.cos(m),Math.sin(m)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new i.al(t.r,t.g,t.b,t.a*d),direction:g,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(d,t,s={}){if(this._validate(Ec,d,s))return;const h=i.l({},d);for(const m of Object.keys(i.a5.rain))h[m]===void 0&&(h[m]=i.a5.rain[m].default);this._options=h,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(d){this._transitionable.setTransitionOrValue(this._options,new Map(d))}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}_validate(d,t,s){return(!s||s.validate!==!1)&&Pe(this,d.call(vs,i.l({value:t,style:{glyphs:!0,sprite:!0},styleSpec:i.a5})))}};class an extends i.E{constructor(t,s,h,m){super(),this.scope=h,this._options=t,this.properties=new i.af(s),this._transitionable=new i.a6(s,h,new Map(m)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,s){this._options=t,this._transitionable.setTransitionOrValue(t.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Yn{constructor(t,s,h,m){this.screenBounds=t,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,m)}static createFromScreenPoints(t,s){let h,m;if(t instanceof i.P||typeof t[0]=="number"){const g=i.P.convert(t);h=[g],m=s.isPointAboveHorizon(g)}else{const g=i.P.convert(t[0]),x=i.P.convert(t[1]);h=[g,x],m=i.an(g,x).every(M=>s.isPointAboveHorizon(M))}return new Yn(h,s.getCameraPoint(),m,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return i.an(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],m=i.an(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?m.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?m[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(m[3]=this.cameraPoint)),i.ao(m,t)}bufferedCameraGeometryGlobe(t){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new i.P(1,1)):this.screenBounds[1],m=i.an(s,h,t),g=this.cameraPoint.clone();switch(3*((g.y>s.y)+(g.y>h.y))+((g.x>s.x)+(g.x>h.x))){case 0:m[0]=g,m[4]=g.clone();break;case 1:m.splice(1,0,g);break;case 2:m[1]=g;break;case 3:m.splice(4,0,g);break;case 5:m.splice(2,0,g);break;case 6:m[3]=g;break;case 7:m.splice(3,0,g);break;case 8:m[2]=g}return m}containsTile(t,s,h,m=0){const g=t.queryPadding/s._pixelsPerMercatorPixel+1,x=h?this._bufferedCameraMercator(g,s):this._bufferedScreenMercator(g,s);let M=t.tileID.wrap+(x.unwrapped?m:0);const P=x.polygon.map(J=>i.ap(t.tileTransform,J,M));if(!i.aq(P,0,0,i.ai,i.ai))return;M=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?m:0);const z=this.screenGeometryMercator.polygon.map(J=>i.ar(t.tileTransform,J,M)),L=z.map(J=>new i.P(J[0],J[1])),F=s.getFreeCameraOptions().position||new i.ac(0,0,0),B=i.ar(t.tileTransform,F,M),j=z.map(J=>{const Q=i.ad.vec3.sub(J,J,B);return i.ad.vec3.normalize(Q,Q),new i.as(B,Q)}),Z=i.at(t,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:j,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(H=i.au(P),H.min.x=i.ay(H.min.x,0,i.ai),H.min.y=i.ay(H.min.y,0,i.ai),H.max.x=i.ay(H.max.x,0,i.ai),H.max.y=i.ay(H.max.y,0,i.ai),H),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Z};var H}_bufferedScreenMercator(t,s){const h=Fo(t);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),s):{polygon:this.bufferedScreenGeometry(t).map(g=>s.pointCoordinate3D(g)),unwrapped:!0},this._screenRaycastCache[h]=m,m}}_bufferedCameraMercator(t,s){const h=Fo(t);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let m;return m=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),s):{polygon:this.bufferedCameraGeometry(t).map(g=>s.pointCoordinate3D(g)),unwrapped:!0},this._cameraRaycastCache[h]=m,m}}_projectAndResample(t,s){const h=function(g,x){const M=i.ad.mat4.multiply([],x.pixelMatrix,x.globeMatrix),P=[0,-i.az,0,1],z=[0,i.az,0,1],L=[0,0,0,1];i.ad.vec4.transformMat4(P,P,M),i.ad.vec4.transformMat4(z,z,M),i.ad.vec4.transformMat4(L,L,M);const F=new i.P(P[0]/P[3],P[1]/P[3]),B=new i.P(z[0]/z[3],z[1]/z[3]),j=i.aw(g,F)&&P[3]<L[3],Z=i.aw(g,B)&&z[3]<L[3];if(!j&&!Z)return null;const H=function(_e,pe,we){for(let Ee=1;Ee<_e.length;Ee++){const qe=Si(pe.pointCoordinate3D(_e[Ee-1]).x),Be=Si(pe.pointCoordinate3D(_e[Ee]).x);if(we<0){if(qe<Be)return{idx:Ee,t:-qe/(Be-1-qe)}}else if(Be<qe)return{idx:Ee,t:(1-qe)/(Be+1-qe)}}return null}(g,x,j?-1:1);if(!H)return null;const{idx:J,t:Q}=H;let oe=J>1?bi(g.slice(0,J),x):[],ue=J<g.length?bi(g.slice(J),x):[];oe=oe.map(_e=>new i.P(Si(_e.x),_e.y)),ue=ue.map(_e=>new i.P(Si(_e.x),_e.y));const ce=[...oe];ce.length===0&&ce.push(ue[ue.length-1]);const ge=i.ah(ce[ce.length-1].y,(ue.length===0?oe[0]:ue[0]).y,Q);let fe;return fe=j?[new i.P(0,ge),new i.P(0,0),new i.P(1,0),new i.P(1,ge)]:[new i.P(1,ge),new i.P(1,1),new i.P(0,1),new i.P(0,ge)],ce.push(...fe),ue.length===0?ce.push(oe[0]):ce.push(...ue),{polygon:ce.map(_e=>new i.ac(_e.x,_e.y)),unwrapped:!1}}(t,s);if(h)return h;const m=function(g,x){let M=!1,P=-1/0,z=0;for(let F=0;F<g.length-1;F++)g[F].x>P&&(P=g[F].x,z=F);for(let F=0;F<g.length-1;F++){const B=(z+F)%(g.length-1),j=g[B],Z=g[B+1];Math.abs(j.x-Z.x)>.5&&(j.x<Z.x?(j.x+=1,B===0&&(g[g.length-1].x+=1)):(Z.x+=1,B+1===g.length-1&&(g[0].x+=1)),M=!0)}const L=i.av(x.center.lng);return M&&L<Math.abs(L-1)&&g.forEach(F=>{F.x-=1}),{polygon:g,unwrapped:M}}(bi(t,s).map(g=>new i.P(Si(g.x),g.y)),s);return{polygon:m.polygon.map(g=>new i.ac(g.x,g.y)),unwrapped:m.unwrapped}}}function bi(d,t){return i.ax(d,s=>{const h=t.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function Si(d){return d<0?1+d%1:d%1}function Fo(d){return 100*d|0}function Bi(d,t,s,h,m){const g=function(M,P){if(M)return m(M);if(P){if(d.url&&P.tiles&&d.tiles&&delete d.tiles,P.variants){if(!Array.isArray(P.variants))return m(new Error("variants must be an array"));for(const L of P.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return m(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return m(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){P=i.l(P,L);break}}}const z=i.aA(i.l({},P,d),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=t.canonicalizeTileset(z,d.url),m(null,z)}},x=function(M,P,z){if(!M)return null;if(!P&&!z)return M;z=z||M.worldview_default;const L=Object.values(M.language||{});if(L.length===0)return null;const F=Object.values(M.worldview||{});if(F.length===0)return null;const B=L.every(Z=>Z===P),j=F.every(Z=>Z===z);return B&&j?M:P in(M.language_options||{})||z in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null}(d.data,s,h);return x?i.q.frame(()=>g(null,x)):d.url?i.n(t.transformRequest(t.normalizeSourceURL(d.url,null,s,h),i.R.Source),g):i.q.frame(()=>{const{data:M,...P}=d;g(null,P)})}class pi{constructor(t,s,h){this.bounds=i.aB.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),h=Math.floor(i.av(this.bounds.getWest())*s),m=Math.floor(i.aC(this.bounds.getNorth())*s),g=Math.ceil(i.av(this.bounds.getEast())*s),x=Math.ceil(i.aC(this.bounds.getSouth())*s);return t.x>=h&&t.x<g&&t.y>=m&&t.y<x}}class Ni extends i.E{constructor(t,s,h,m){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,i.l(this,i.aA(s,["url","scheme","tileSize","promoteId"])),this._options=i.l({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m),this._tileWorkers={},this._deduped=new i.aD}load(t){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map.getWorldview();this._tileJSONRequest=Bi(this._options,this.map._requestManager,s,h,(m,g)=>{if(this._tileJSONRequest=null,this._loaded=!0,m)s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new i.z(m));else if(g){if(i.l(this,g),this.hasWorldviews=!!g.worldview_options,g.worldview_default&&(this.worldviewDefault=g.worldview_default),g.vector_layers){this.vectorLayers=g.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const x of g.vector_layers)this.vectorLayerIds.push(x.id),g.worldview&&g.worldview[x.source]&&this.localizableLayerIds.add(x.id)}g.bounds&&(this.tileBounds=new pi(g.bounds,this.minzoom,this.maxzoom)),rr(g.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(m)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}loadTile(t,s){const h=t.tileID.canonical.url(this.tiles,this.scheme),m=this.map._requestManager.normalizeTileURL(h),g=this.map._requestManager.transformRequest(m,i.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,M=x?{image:x.image.clone()}:null,P={request:g,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:M,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&i.f(h)&&(P.worldview=this.map.getWorldview()||this.worldviewDefault,P.localizableLayerIds=this.localizableLayerIds),P.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",P,z.bind(this));else if(t.actor=this._tileWorkers[m]=this._tileWorkers[m]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",P,z.bind(this),void 0,!0);else{const L=i.aE.call({deduped:this._deduped},P,(F,B)=>{F||!B?z.call(this,F):(P.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},t.actor&&t.actor.send("loadTile",P,z.bind(this),void 0,!0))},!0);t.request={cancel:L}}function z(L,F){return delete t.request,t.aborted?s(null):L&&L.status!==404?s(L):(F&&F.resourceTiming&&(t.resourceTiming=F.resourceTiming),this.map._refreshExpiredTiles&&F&&t.setExpiryData(F),t.loadVectorData(F,this.map.painter),i.aF(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class fa extends i.E{constructor(t,s,h,m){super(),this.id=t,this.dispatcher=h,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=i.l({type:"raster"},s),i.l(this,i.aA(s,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._tileJSONRequest=Bi(this._options,this.map._requestManager,null,null,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new i.z(s)):h&&(i.l(this,h),h.raster_layers&&(this.rasterLayers=h.raster_layers,this.rasterLayerIds=this.rasterLayers.map(m=>m.id)),h.bounds&&(this.tileBounds=new pi(h.bounds,this.minzoom,this.maxzoom)),rr(h.tiles),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(s)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return i.l({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const h=i.q.devicePixelRatio>=2,m=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);t.request=i.o(this.map._requestManager.transformRequest(m,i.R.Tile),(g,x,M,P)=>(delete t.request,t.aborted?(t.state="unloaded",s(null)):g?(t.state="errored",s(g)):x?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:M,expires:P}),t.setTexture(x,this.map.painter),t.state="loaded",i.aF(this.dispatcher),void s(null)):s(null)))}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s&&s()}unloadTile(t,s){t.texture&&t.texture instanceof i.T?(t.destroy(!0),t.texture&&t.texture instanceof i.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),s&&s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xs extends fa{constructor(t,s,h,m){super(t,s,h,m),this.type="raster-array",this.maxzoom=22,this.partial=!0,this.iconsets={},this._options=i.l({type:"raster-array"},s)}triggerRepaint(t){const s=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);s&&s.enabled&&h&&s._clearRenderCacheForTile(h.id,t.tileID),this.map.triggerRepaint()}loadTile(t,s){const h=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),m=this.map._requestManager.transformRequest(h,i.R.Tile),g={request:m,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=m,t.actor||(t.actor=this.dispatcher.getActor());const x=(M,P,z,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",s(null);if(M)return M.name==="AbortError"?void 0:(t.state="errored",s(M));if(this.map._refreshExpiredTiles&&P&&t.setExpiryData({cacheControl:z,expires:L}),this.partial)t.state="empty";else{if(!P)return s(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=P;const F=new Map;for(const B in t._mrt.layers){const j=t.getLayer(B);if(j)for(const Z of j.getBandList()){const{bytes:H,tileSize:J,buffer:Q}=j.getBandView(Z),oe=J+2*Q,ue={data:new i.r({width:oe,height:oe},H),pixelRatio:2,sdf:!1,usvg:!1,version:0};F.set(`${B}/${Z}`,ue)}}for(const B in this.iconsets)this.iconsets[B].addIcons(F)}s(null)};t.request=this.partial?t.fetchHeader(void 0,x.bind(this)):t.actor.send("loadTile",g,x.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,s){const h=t.texture;h&&h instanceof i.T?(t.destroy(!0),this.map.painter.saveTileTexture(h)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,s,h){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(s,h,(m,g)=>{if(m)return t.state="errored",this.fire(new i.z(m)),void this.triggerRepaint(t);g&&(t._isHeaderLoaded=!0,t.setTexture(g,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:g})=>g===t),h=s&&s.fields,m=h&&h.bands&&h.bands;return m?m[0]:0}getTextureDescriptor(t,s,h){if(!t)return;const m=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!m)return;let g=null;s instanceof i.aI?g=s.paint.get("raster-array-band"):s instanceof i.aJ&&(g=s.paint.get("raster-particle-array-band"));const x=g||this.getInitialBand(m);if(x!=null)if(t.textureDescriptor){if(!t.updateNeeded(m,x)||h)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,m,x)}addIconset(t,s){this.iconsets[t]=s,this.partial=!1}}const ja={vector:Ni,raster:fa,"raster-dem":class extends fa{constructor(d,t,s,h){super(d,t,s,h),this.type="raster-dem",this.maxzoom=22,this._options=i.l({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(d,t){const s=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(m,g){m&&(d.state="errored",t(m)),g&&(d.dem=g,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",t(null))}d.request=i.o(this.map._requestManager.transformRequest(s,i.R.Tile),(function(m,g,x,M){if(delete d.request,d.aborted)d.state="unloaded",t(null);else if(m)d.state="errored",t(m);else if(g){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:x,expires:M});const P=ImageBitmap&&g instanceof ImageBitmap&&i.t(),z=1-(g.width-i.aG(g.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const L=P?g:i.q.getImageData(g,z),F={uid:d.uid,tileID:d.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:z};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadTile",F,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const t=d.canonical,s=Math.pow(2,t.z),h=(t.x-1+s)%s,m=t.x===0?d.wrap-1:d.wrap,g=(t.x+1+s)%s,x=t.x+1===s?d.wrap+1:d.wrap,M={};return M[new i.aH(d.overscaledZ,m,t.z,h,t.y).key]={backfilled:!1},M[new i.aH(d.overscaledZ,x,t.z,g,t.y).key]={backfilled:!1},t.y>0&&(M[new i.aH(d.overscaledZ,m,t.z,h,t.y-1).key]={backfilled:!1},M[new i.aH(d.overscaledZ,d.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},M[new i.aH(d.overscaledZ,x,t.z,g,t.y-1).key]={backfilled:!1}),t.y+1<s&&(M[new i.aH(d.overscaledZ,m,t.z,h,t.y+1).key]={backfilled:!1},M[new i.aH(d.overscaledZ,d.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},M[new i.aH(d.overscaledZ,x,t.z,g,t.y+1).key]={backfilled:!1}),M}},"raster-array":xs,geojson:class extends i.E{constructor(d,t,s,h){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=t.data,this._options=i.l({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const m=i.ai/this.tileSize;this.workerOptions=i.l({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*m,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*m,extent:i.ai,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:i.ai,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*m,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}updateData(d){if(!this._options.dynamic)return this.fire(new i.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof d!="string"&&(d.type==="Feature"&&(d={type:"FeatureCollection",features:[d]}),d.type!=="FeatureCollection"))return this.fire(new i.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof d!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const s of this._data.features)t.set(s.id,s);for(const s of d.features)t.set(s.id,s);this._data.features=[...t.values()]}else this._data=d;return this._updateWorkerData(!0),this}getClusterExpansionZoom(d,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterChildren(d,t){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id,scope:this.scope},t),this}getClusterLeaves(d,t,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:d,limit:t,offset:s},h),this}_updateWorkerData(d=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new i.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=i.l({append:d},this.workerOptions);t.scope=this.scope;const s=this._data;typeof s=="string"?(t.request=this.map._requestManager.transformRequest(i.q.resolveURL(s),i.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(h,m)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new i.z(h));else{const g={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&m&&m.resourceTiming&&m.resourceTiming[this.id]&&(g.resourceTiming=m.resourceTiming[this.id]),d&&(this._partialReload=!0),this.fire(new i.A("data",g)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(d),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const d=i.C(this.id,this.scope);this.map.style.clearSource(d),this._updateWorkerData()}loadTile(d,t){const s=d.actor?"reloadTile":"loadTile";d.actor=this.actor;const h=this.map.style?this.map.style.getLut(this.scope):null,m=h?{image:h.image.clone()}:null,g=this._partialReload,x={type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:m,scope:this.scope,pixelRatio:i.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:g};d.request=this.actor.send(s,x,(M,P)=>g&&!P?(d.state="loaded",t(null)):(delete d.request,d.destroy(),d.aborted?t(null):M?t(M):(d.loadVectorData(P,this.map.painter,s==="reloadTile"),t(null))),void 0,s==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d,t){this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id,scope:this.scope}),d.destroy()}onRemove(d){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return i.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends i.aK{constructor(d,t,s,h){super(d,t,s,h),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const t of d.urls)this.urls.push(this.map._requestManager.transformRequest(t,i.R.Source).url);i.aL(this.urls,(t,s)=>{this._loaded=!0,t?this.fire(new i.z(t)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const t=this.video.seekable;d<t.start(0)||d>t.end(0)?this.fire(new i.z(new i.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,t=d.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new i.T(d,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:i.aK,model:class extends i.E{constructor(d,t,s,h){super(),this.id=d,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const d=[];for(const t in this._options.models){const s=this._options.models[t],h=i.aN(this.map._requestManager.transformRequest(s.uri,i.R.Model).url).then(m=>{if(!m)return;const g=i.aO(m),x=new i.aP(t,s.position,s.orientation,g);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(m=>{this.fire(new i.z(new Error(`Could not load model ${t} from ${s.uri}: ${m.message}`)))});d.push(h)}return Promise.allSettled(d).then(()=>{this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this.fire(new i.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(d){this.map=d,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(d,t){}serialize(){return{type:"model"}}},"batched-model":class extends i.E{constructor(d,t,s,h){super(),this.type="batched-model",this.id=d,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(d){this.map=d,this.load()}reload(){this.cancelTileJSONRequest();const d=i.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(d))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(d){this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map.getWorldview();this._tileJSONRequest=Bi(this._options,this.map._requestManager,t,s,(h,m)=>{this._tileJSONRequest=null,this._loaded=!0,h?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new i.z(h))):m&&(i.l(this,m),m.bounds&&(this.tileBounds=new pi(m.bounds,this.minzoom,this.maxzoom)),rr(m.tiles,this.map._requestManager._customAccessToken),this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))),d&&d(h)})}hasTransition(){return!1}hasTile(d){return!this.tileBounds||this.tileBounds.contains(d.canonical)}loaded(){return this._loaded}loadTile(d,t){const s=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,i.R.Tile),data:void 0,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,tileSize:this.tileSize*d.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:d.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:i.q.devicePixelRatio,promoteId:this.promoteId};if(d.actor&&d.state!=="expired")if(d.state==="loading")d.reloadCallback=t;else{if(d.buckets){const g=Object.values(d.buckets);for(const x of g)x.dirty=!0;return void(d.state="loaded")}d.request=d.actor.send("reloadTile",h,m.bind(this))}else d.actor=this.dispatcher.getActor(),d.request=d.actor.send("loadTile",h,m.bind(this),void 0,!0);function m(g,x){return d.aborted?t(null):g&&g.status!==404?t(g):(this.map._refreshExpiredTiles&&x&&d.setExpiryData(x),d.loadModelData(x,this.map.painter),d.state="loaded",void t(null))}}serialize(){return i.l({},this._options)}},canvas:class extends i.aK{constructor(d,t,s,h){super(d,t,s,h),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(g=>typeof g!="number"))||this.fire(new i.z(new i.V(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new i.z(new i.V(`sources.${d}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new i.z(new i.V(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new i.z(new i.V(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new i.z(new i.V(`sources.${d}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new i.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(d){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!d&&!this._playing||this.texture instanceof i.aM||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new i.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends i.E{constructor(d,t,s,h){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=t,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new i.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new i.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new pi(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),i.l(this,i.aA(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return i.aA(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new i.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this.map=d,this._loaded=!1,this.fire(new i.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:t,y:s,z:h}=d.canonical;return this._implementation.hasTile({x:t,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,t){const{x:s,y:h,z:m}=d.tileID.canonical,g=new AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:s,y:h,z:m},{signal:g.signal})).then((function(x){return delete d.request,d.aborted?(d.state="unloaded",t(null)):x===void 0?(d.state="errored",t(null)):x===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",t(null)):function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement}(x)?(this.loadTileData(d,x),d.state="loaded",void t(null)):(d.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.name!=="AbortError"&&(d.state="errored",t(x))}),d.request.cancel=()=>g.abort()}loadTileData(d,t){d.setTexture(t,this.map.painter)}unloadTile(d,t){if(d.texture&&d.texture instanceof i.T?(d.destroy(!0),d.texture&&d.texture instanceof i.T&&this.map.painter.saveTileTexture(d.texture)):d.destroy(),this._implementation.unloadTile){const{x:s,y:h,z:m}=d.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:m})}t&&t()}abortTile(d,t){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){const d=i.C(this.id,this.scope);this.map.style.clearSource(d)}_update(){this.fire(new i.A("data",{dataType:"source",sourceDataType:"content"}))}}},Ld=function(d,t,s,h){const m=new ja[t.type](d,t,s,h);if(m.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${m.id}`);return i.aQ(["load","abort","unload","serialize","prepare"],m),m};function Od(d,t,s=""){return`${s}:${t.id||""}:${t.layer.id}:${function(h){if("layerId"in h)return`layer:${h.layerId}`;{const{featuresetId:m,importId:g}=h;return`featureset:${m}${g?`:import:${g}`:""}`}}(d.target)}`}function Ac(d,t,s,h=""){if(d.uniqueFeatureID){const m=Od(d,t,h);if(s.has(m))return!0;s.add(m)}return!1}function Mc(d,t,s,h,m=!1){const g=t.sourceCache.transform,x=t.sourceCache.tilesIn(d,t.has3DLayers,m);x.sort(Fd);const M=[];for(const P of x){const z=P.tile.queryRenderedFeatures(t,P,s,h,g,m);Object.keys(z).length&&M.push({wrappedTileID:P.tile.tileID.wrapped().key,queryResults:z})}return M.length===0?{}:function(P){const z={},L={};for(const F of P){const B=F.queryResults,j=F.wrappedTileID,Z=L[j]=L[j]||{};for(const H in B){const J=B[H],Q=Z[H]=Z[H]||{},oe=z[H]=z[H]||[];for(const ue of J)Q[ue.featureIndex]||(Q[ue.featureIndex]=!0,oe.push(ue))}}return z}(M)}function kd(d,t,s,h,m){const g={},x=h.queryRenderedSymbols(d),M=[];for(const P of Object.keys(x).map(Number))M.push(m[P]);M.sort(Fd);for(const P of M){const z=P.featureIndex.lookupSymbolFeatures(x[P.bucketInstanceId],P.bucketIndex,P.sourceLayerIndex,t,s);for(const L in z){const F=g[L]=g[L]||[],B=z[L];B.sort((j,Z)=>{const H=P.featureSortOrder;if(H){const J=H.indexOf(j.featureIndex);return H.indexOf(Z.featureIndex)-J}return Z.featureIndex-j.featureIndex});for(const j of B)F.push(j)}}return g}function Cm(d,t){const s=d.getRenderableIds().map(g=>d.getTileByID(g)),h=[],m={};for(let g=0;g<s.length;g++){const x=s[g],M=x.tileID.canonical.key;m[M]||(m[M]=!0,x.querySourceFeatures(h,t))}return h}function Fd(d,t){const s=d.tileID,h=t.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}function Bd(d,t){const s={};if(!t)return s;for(const h of d){const m=h.layerIds.map(g=>t.getLayer(g)).filter(Boolean);if(m.length!==0){h.layers=m,h.stateDependentLayerIds&&(h.stateDependentLayers=h.stateDependentLayerIds.map(g=>m.filter(x=>x.id===g)[0]));for(const g of m)s[g.fqid]=h}}return s}const Hi=32,Ys=33,Bo=new Uint16Array(8184);for(let d=0;d<2046;d++){let t=d+2,s=0,h=0,m=0,g=0,x=0,M=0;for(1&t?m=g=x=Hi:s=h=M=Hi;(t>>=1)>1;){const z=s+m>>1,L=h+g>>1;1&t?(m=s,g=h,s=x,h=M):(s=m,h=g,m=x,g=M),x=z,M=L}const P=4*d;Bo[P+0]=s,Bo[P+1]=h,Bo[P+2]=m,Bo[P+3]=g}const bo=new Uint16Array(2178),Js=new Uint8Array(1089),wo=new Uint16Array(1089);function Vu(d){return d===0?-.03125:d===32?.03125:0}const Nd={type:2,extent:i.ai,loadGeometry:()=>[[new i.P(0,0),new i.P(i.ai+1,0),new i.P(i.ai+1,i.ai+1),new i.P(0,i.ai+1),new i.P(0,0)]]};class pa{constructor(t,s,h,m,g){this.tileID=t,this.uid=i.aW(),this.uses=0,this.tileSize=s,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,m&&m.style&&(this._lastUpdatedBrightness=m.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(t){const s=t+this.timeAdded;s<i.q.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=i.aR(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,s,h){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Bd(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const g=this.buckets[m];if(g instanceof i.aY){if(this.hasSymbolBuckets=!0,!h)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const g=this.buckets[m];if(g instanceof i.aY&&g.hasRTLText){this.hasRTLText=!0,i.aZ();break}}this.queryPadding=0;for(const m in this.buckets){const g=this.buckets[m],x=s.style.getOwnLayer(m);if(!x)continue;const M=x.queryRadius(g);this.queryPadding=Math.max(this.queryPadding,M)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new i.aX}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,s,h){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Bd(t.buckets,s.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(t)}const s=t.gl,h=this.imageAtlas;h&&!h.uploaded&&(this.imageAtlasTexture=new i.T(t,h.image,s.RGBA8,{useMipmap:!!h.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new i.T(t,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new i.T(t,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(t,s,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,h),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const m=s.style.getBrightness();(this._lastUpdatedBrightness||m)&&(this._lastUpdatedBrightness&&m&&Math.abs(this._lastUpdatedBrightness-m)<.001||(this.updateBuckets(s,this._lastUpdatedBrightness!==m),this._lastUpdatedBrightness=m))}queryRenderedFeatures(t,s,h,m,g,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const M=function(P,z){const L=i.ad.mat4.fromScaling([],[.5*P.width,.5*-P.height,1]);return i.ad.mat4.translate(L,L,[1,-1,0]),i.ad.mat4.multiply(L,L,P.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(L)}(g,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:s,pixelPosMatrix:M,transform:m,availableImages:h,tileTransform:this.tileTransform})}querySourceFeatures(t,s){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const m=h.loadVTLayers(),g=s?s.sourceLayer:"",x=m._geojsonTileLayer||m[g];if(!x)return;const M=i.a_(s&&s.filter),{z:P,x:z,y:L}=this.tileID.canonical,F={z:P,x:z,y:L};for(let B=0;B<x.length;B++){const j=x.feature(B);if(M.needGeometry){const J=i.a$(j,!0);if(!M.filter(new i.aa(this.tileID.overscaledZ),J,this.tileID.canonical))continue}else if(!M.filter(new i.aa(this.tileID.overscaledZ),j))continue;const Z=h.getId(j,g),H=new i.b0(j,P,z,L,Z);H.tile=F,t.push(H)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const h=i.b1(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let m=!1;if(this.expirationTime>h)m=!1;else if(s)if(this.expirationTime<s)m=!0;else{const g=this.expirationTime-s;g?this.expirationTime=h+Math.max(g,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,s){if(!this.latestFeatureIndex||!t.style)return;const h=this.latestFeatureIndex.loadVTLayers(),m=t.style.listImages(),g=t.style.getBrightness();for(const x in this.buckets){if(!t.style.hasLayer(x))continue;const M=this.buckets[x],P=M.layers[0],z=P.sourceLayer||"_geojsonTileLayer",L=h[z],F=t.style.getLayerSourceCache(P);let B={};F&&(B=F._state.getState(z,void 0));const j=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Z=Object.keys(B).length>0&&!s;Z&&!M.stateDependentLayers.length&&!s||M.update(B,L,m,j,Z?M.stateDependentLayers:M.layers,s,g),(M instanceof i.b2||M instanceof i.b3)&&t._terrain&&t._terrain.enabled&&F&&M.uploadPending()&&t._terrain._clearRenderCacheForTile(F.id,this.tileID);const H=t&&t.style&&t.style.getOwnLayer(x);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(M)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<i.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=i.q.now()+t}setTexture(t,s){const h=s.context,m=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t):(this.texture=new i.T(h,t,m.RGBA8,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE))}setDependencies(t,s){const h={};for(const m of s)h[m]=!0;this.dependencies[t]=h}hasDependency(t,s){for(const h of t){const m=this.dependencies[h];if(m){for(const g of s)if(m[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const h=i.b4(Nd,this.tileID.canonical,this.tileTransform)[0],m=new i.b5,g=new i.b6;for(let x=0;x<h.length;x++){const{x:M,y:P}=h[x];m.emplaceBack(M,P),g.emplaceBack(x)}g.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(g),this._tileDebugBuffer=t.createVertexBuffer(m,i.b7.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,m.length,g.length)}_makeTileBoundsBuffers(t,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const h=i.b4(Nd,this.tileID.canonical,this.tileTransform)[0];let m,g;if(this.isRaster){const x=function(M,P){const z=i.aR(M,P),L=Math.pow(2,M.z);for(let J=0;J<Ys;J++)for(let Q=0;Q<Ys;Q++){const oe=i.aS((M.x+(Q+Vu(Q))/Hi)/L),ue=i.aT((M.y+(J+Vu(J))/Hi)/L),ce=P.project(oe,ue),ge=J*Ys+Q;bo[2*ge+0]=Math.round((ce.x*z.scale-z.x)*i.ai),bo[2*ge+1]=Math.round((ce.y*z.scale-z.y)*i.ai)}Js.fill(0),wo.fill(0);for(let J=2045;J>=0;J--){const Q=4*J,oe=Bo[Q+0],ue=Bo[Q+1],ce=Bo[Q+2],ge=Bo[Q+3],fe=oe+ce>>1,_e=ue+ge>>1,pe=fe+_e-ue,we=_e+oe-fe,Ee=ue*Ys+oe,qe=ge*Ys+ce,Be=_e*Ys+fe,et=Math.hypot((bo[2*Ee+0]+bo[2*qe+0])/2-bo[2*Be+0],(bo[2*Ee+1]+bo[2*qe+1])/2-bo[2*Be+1])>=16;Js[Be]=Js[Be]||(et?1:0),J<1022&&(Js[Be]=Js[Be]||Js[(ue+we>>1)*Ys+(oe+pe>>1)]||Js[(ge+we>>1)*Ys+(ce+pe>>1)])}const F=new i.aU,B=new i.aV;let j=0;function Z(J,Q){const oe=Q*Ys+J;return wo[oe]===0&&(F.emplaceBack(bo[2*oe+0],bo[2*oe+1],J*i.ai/Hi,Q*i.ai/Hi),wo[oe]=++j),wo[oe]-1}function H(J,Q,oe,ue,ce,ge){const fe=J+oe>>1,_e=Q+ue>>1;if(Math.abs(J-ce)+Math.abs(Q-ge)>1&&Js[_e*Ys+fe])H(ce,ge,J,Q,fe,_e),H(oe,ue,ce,ge,fe,_e);else{const pe=Z(J,Q),we=Z(oe,ue),Ee=Z(ce,ge);B.emplaceBack(pe,we,Ee)}}return H(0,0,Hi,Hi,Hi,0),H(Hi,Hi,0,0,0,Hi),{vertices:F,indices:B}}(this.tileID.canonical,s);m=x.vertices,g=x.indices}else{m=new i.aU,g=new i.aV;for(const{x:M,y:P}of h)m.emplaceBack(M,P,0,0);const x=i.b9(m.int16,void 0,4);for(let M=0;M<x.length;M+=3)g.emplaceBack(x[M],x[M+1],x[M+2])}this._tileBoundsBuffer=t.createVertexBuffer(m,i.ba.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(g),this._tileBoundsSegments=i.b8.simpleSegment(0,0,m.length,g.length)}_makeGlobeTileDebugBuffers(t,s){const h=s.projection;if(!h||h.name!=="globe"||s.freezeTileCoverage)return;const m=this.tileID.canonical,g=i.bb(m,s),x=i.bc(g),M=i.ag(s.zoom);let P;M>0&&(P=i.ad.mat4.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,m,s,x,P,M),this._makeGlobeTileDebugTextBuffer(t,m,s,x,P,M)}_globePoint(t,s,h,m,g,x,M){let P=i.bd(t,s,h);if(x){const z=1<<h.z,L=i.av(m.center.lng),F=i.aC(m.center.lat),B=(h.x+.5)/z-L;let j=0;B>.5?j=-1:B<-.5&&(j=1);let Z=(t/i.ai+h.x)/z+j,H=(s/i.ai+h.y)/z;Z=(Z-L)*m._pixelsPerMercatorPixel+L,H=(H-F)*m._pixelsPerMercatorPixel+F;const J=[Z*m.worldSize,H*m.worldSize,0];i.ad.vec3.transformMat4(J,J,x),P=i.be(P,J,M)}return i.ad.vec3.transformMat4(P,P,g)}_makeGlobeTileDebugBorderBuffer(t,s,h,m,g,x){const M=new i.b5,P=new i.b6,z=new i.bf,L=(B,j,Z,H,J)=>{const Q=(Z-B)/(J-1),oe=(H-j)/(J-1),ue=M.length;for(let ce=0;ce<J;ce++){const ge=B+ce*Q,fe=j+ce*oe;M.emplaceBack(ge,fe);const _e=this._globePoint(ge,fe,s,h,m,g,x);z.emplaceBack(_e[0],_e[1],_e[2]),P.emplaceBack(ue+ce)}},F=i.ai;L(0,0,F,0,16),L(F,0,F,F,16),L(F,F,0,F,16),L(0,F,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(P),this._tileDebugBuffer=t.createVertexBuffer(M,i.b7.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(z,i.bg.members),this._tileDebugSegments=i.b8.simpleSegment(0,0,M.length,P.length)}_makeGlobeTileDebugTextBuffer(t,s,h,m,g,x){const M=i.ai/4,P=new i.b5,z=new i.aV,L=new i.bf,F=25;z.reserve(32),P.reserve(F),L.reserve(F);const B=(j,Z)=>F*j+Z;for(let j=0;j<F;j++){const Z=j*M;for(let H=0;H<F;H++){const J=H*M;P.emplaceBack(J,Z);const Q=this._globePoint(J,Z,s,h,m,g,x);L.emplaceBack(Q[0],Q[1],Q[2])}}for(let j=0;j<4;j++)for(let Z=0;Z<4;Z++){const H=B(j,Z),J=B(j,Z+1),Q=B(j+1,Z),oe=B(j+1,Z+1);z.emplaceBack(H,J,Q),z.emplaceBack(Q,J,oe)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(z),this._tileDebugTextBuffer=t.createVertexBuffer(P,i.b7.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(L,i.bg.members),this._tileDebugTextSegments=i.b8.simpleSegment(0,0,F,32)}destroy(t=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof i.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}i.bh.setPbf(i.bi);class ma extends pa{constructor(t,s,h,m,g){super(t,s,h,m,g),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,s){const h=s.context,m=h.gl;this.texture=this.texture||s.getTileTexture(t.width),this.texture&&this.texture instanceof i.T?this.texture.update(t,{premultiply:!1}):this.texture=new i.T(h,t,m.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,s){const h=this._mrt=new i.bh(30),m=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=i.bj(m,(g,x,M,P)=>{if(g)s(g);else try{const z=h.getHeaderLength(x);if(z>t)return void(this.request=this.fetchHeader(z,s));h.parseHeader(x),this._isHeaderLoaded=!0;let L=0;for(const F of Object.values(h.layers))L=Math.max(L,F.dataIndex[F.dataIndex.length-1].lastByte);x.byteLength>=L&&(this.entireBuffer=x),s(null,this.entireBuffer||x,M,P)}catch(z){s(z)}}),this.request}fetchBand(t,s,h){const m=this._mrt;if(!this._isHeaderLoaded||!m)return void h(new Error("Tile header is not ready"));const g=this.actor;if(!g)return void h(new Error("Can't fetch tile band without an actor"));let x;const M=(F,B)=>{x.complete(F,B),F?h(F):(this.updateTextureDescriptor(t,s),h(null,this.textureDescriptor&&this.textureDescriptor.img))},P=(F,B)=>{if(F)return h(F);const j=g.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:B,task:x},M,void 0,!0);this._workQueue.push(()=>{j&&j.cancel(),x.cancel()})},z=m.getLayer(t);if(!z)return void h(new Error(`Unknown sourceLayer "${t}"`));if(z.hasDataForBand(s))return this.updateTextureDescriptor(t,s),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);const L=z.getDataRange([s]);if(x=m.createDecodingTask(L),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)P(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{const F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),B=i.bj(F,P);this._fetchQueue.push(()=>{B.cancel(),x.cancel()})}else h(null)}updateNeeded(t,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,s){if(!this._mrt)return;const h=this._mrt.getLayer(t);if(!h||!h.hasBand(s)||!h.hasDataForBand(s))return;const{bytes:m,tileSize:g,buffer:x,offset:M,scale:P}=h.getBandView(s),z=g+2*x,L=new i.r({width:z,height:z},m),F=this.texture;F&&F instanceof i.T&&F.update(L,{premultiply:!1}),this.textureDescriptor={layer:t,band:s,img:L,buffer:x,offset:M,tileSize:g,format:h.pixelFormat,mix:[P,256*P,65536*P,16777216*P]}}}class bs{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,h){const m=t.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const g={value:s,timeout:void 0};if(h!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},h)),this.data[m].push(g),this.order.push(m),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const h=t.wrapped().key,m=s===void 0?0:this.data[h].indexOf(s),g=this.data[h][m];return this.data[h].splice(m,1),g.timeout&&clearTimeout(g.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(g.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const h in this.data)for(const m of this.data[h])t(m.value)||s.push(m);for(const h of s)this.remove(h.value.tileID,h)}}class Pm{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,h){const m=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][m]=this.stateChanges[t][m]||{},i.l(this.stateChanges[t][m],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==m&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][m]===null){this.deletedStates[t][m]={};for(const g in this.state[t][m])h[g]||(this.deletedStates[t][m][g]=null)}else for(const g in h)this.deletedStates[t]&&this.deletedStates[t][m]&&this.deletedStates[t][m][g]===null&&delete this.deletedStates[t][m][g]}removeFeatureState(t,s,h){if(this.deletedStates[t]===null)return;const m=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&s!==void 0)this.deletedStates[t][m]!==null&&(this.deletedStates[t][m]=this.deletedStates[t][m]||{},this.deletedStates[t][m][h]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][m])for(h in this.deletedStates[t][m]={},this.stateChanges[t][m])this.deletedStates[t][m][h]=null;else this.deletedStates[t][m]=null;else this.deletedStates[t]=null}getState(t,s){const h=this.state[t]||{},m=this.stateChanges[t]||{},g=this.deletedStates[t];if(g===null)return{};if(s!==void 0){const M=String(s),P=i.l({},h[M],m[M]);if(g){const z=g[s];if(z===null)return{};for(const L in z)delete P[L]}return P}const x=i.l({},h,m);if(g)for(const M in g)delete x[M];return x}initializeTileState(t,s){t.refreshFeatureState(s)}coalesceChanges(t,s){const h={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const g={};for(const x in this.stateChanges[m])this.state[m][x]||(this.state[m][x]={}),i.l(this.state[m][x],this.stateChanges[m][x]),g[x]=this.state[m][x];h[m]=g}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const g={};if(this.deletedStates[m]===null)for(const x in this.state[m])g[x]={},this.state[m][x]={};else for(const x in this.deletedStates[m]){if(this.deletedStates[m][x]===null)this.state[m][x]={};else if(this.state[m][x])for(const M of Object.keys(this.deletedStates[m][x]))delete this.state[m][x][M];g[x]=this.state[m][x]}h[m]=h[m]||{},i.l(h[m],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const m in t)t[m].refreshFeatureState(s)}}class ws extends i.E{constructor(t,s,h){super(),this.id=t,this._onlySymbols=h,s.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new bs(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Pm,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,s){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const h=this._tiles[s];h.upload(t),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Vd).map(t=>t.key)}getRenderableIds(t,s){const h=[];for(const m in this._tiles)this._isIdRenderable(+m,t,s)&&h.push(this._tiles[m]);return t?h.sort((m,g)=>{const x=m.tileID,M=g.tileID,P=new i.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),z=new i.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-M.overscaledZ||z.y-P.y||z.x-P.x}).map(m=>m.tileID.key):h.map(m=>m.tileID).sort(Vd).map(m=>m.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s,h){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())&&(h||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,s){const h=this._tiles[t];h&&(h.state!=="loading"&&(h.state=s),this._loadTile(h,this._tileLoaded.bind(this,h,t,s)))}_tileLoaded(t,s,h,m){if(m)if(t.state="errored",m.status!==404)this._source.fire(new i.z(m,{tile:t}));else{if(this._source.fire(new i.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=i.q.now(),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new i.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const s=this.getRenderableIds();for(let m=0;m<s.length;m++){const g=s[m];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);h(t,x),h(x,t)}}function h(m,g){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let x=g.tileID.canonical.x-m.tileID.canonical.x;const M=g.tileID.canonical.y-m.tileID.canonical.y,P=Math.pow(2,m.tileID.canonical.z),z=g.tileID.key;x===0&&M===0||Math.abs(M)>1||(Math.abs(x)>1&&(Math.abs(x+P)===1?x+=P:Math.abs(x-P)===1&&(x-=P)),g.dem&&m.dem&&(m.dem.backfillBorder(g.dem,x,M),m.neighboringTiles&&m.neighboringTiles[z]&&(m.neighboringTiles[z].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,h,m){for(const g in this._tiles){let x=this._tiles[g];if(m[g]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>h)continue;let M=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const z=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[z.key],x&&x.hasData()&&(M=z)}let P=M;for(;P.overscaledZ>s;)if(P=P.scaledTo(P.overscaledZ-1),t[P.key]){m[M.key]=M;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const h=this._loadedParentTiles[t.key];return h&&h.tileID.overscaledZ>=s?h:null}for(let h=t.overscaledZ-1;h>=s;h--){const m=t.scaledTo(h),g=this._getLoadedTile(m);if(g)return g}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,s){s=s||this._source.tileSize;const h=Math.ceil(t.width/s)+1,m=Math.ceil(t.height/s)+1,g=Math.floor(h*m*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(M)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const h={};for(const m in this._tiles){const g=this._tiles[m];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),h[g.tileID.key]=g}this._tiles=h;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(t,s,h,m){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;this.updateCacheSize(t,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const g=this._source.type==="batched-model";let x,M=this._source.maxzoom;const P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){const F=P.attenuationRange()[0],B=Math.floor(F)-Math.log2(P.getDemUpscale());M>B&&(M=B)}if(this.used||this.usedForTerrain){if(this._source.tileID)x=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(F=>new i.aH(F.canonical.z,F.wrap,F.canonical.z,F.canonical.x,F.canonical.y));else if(this.tileCoverLift!==0){const F=t.clone();F.tileCoverLift=this.tileCoverLift,x=F.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.minzoom<=1&&t.projection.name==="globe"&&(x.push(new i.aH(1,0,1,0,0)),x.push(new i.aH(1,0,1,1,0)),x.push(new i.aH(1,0,1,0,1)),x.push(new i.aH(1,0,1,1,1)))}else if(x=t.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:M,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:g}),this._source.hasTile){const F=this._source.hasTile.bind(this._source);x=x.filter(B=>F(B))}}else x=[];if(x.length>0&&this.castsShadows&&m&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!tn(this._source.type)){const F=t.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),B=Math.min(F,this._source.maxzoom);if(g){const j=t.extendTileCover(x,B);for(const Z of j)x.push(Z)}else{const j=t.extendTileCover(x,B,m);for(const Z of j)this._shadowCasterTiles[Z.key]=!0,x.push(Z)}}const z=this._updateRetainedTiles(x);if(tn(this._source.type)&&x.length!==0){const F={},B={},j=Object.keys(z);for(const H of j){const J=z[H],Q=this._tiles[H];if(!Q||Q.fadeEndTime&&Q.fadeEndTime<=i.q.now())continue;const oe=this.findLoadedParent(J,Math.max(J.overscaledZ-ws.maxOverzooming,this._source.minzoom));oe&&(this._addTile(oe.tileID),F[oe.tileID.key]=oe.tileID),B[H]=J}const Z=x[x.length-1].overscaledZ;for(const H in this._tiles){const J=this._tiles[H];if(z[H]||!J.hasData())continue;let Q=J.tileID;for(;Q.overscaledZ>Z;){Q=Q.scaledTo(Q.overscaledZ-1);const oe=this._tiles[Q.key];if(oe&&oe.hasData()&&B[Q.key]){z[H]=J.tileID;break}}}for(const H in F)z[H]||(this._coveredTiles[H]=!0,z[H]=F[H])}for(const F in z)this._tiles[F].clearFadeHold();const L=i.bk(this._tiles,z);for(const F of L){const B=this._tiles[F];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+F)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const s={};if(t.length===0)return s;const h={},m=t.reduce((z,L)=>Math.min(z,L.overscaledZ),1/0),g=t[0].overscaledZ,x=Math.max(g-ws.maxOverzooming,this._source.minzoom),M=Math.max(g+ws.maxUnderzooming,this._source.minzoom),P={};for(const z of t){const L=this._addTile(z);s[z.key]=z,L.hasData()||m<this._source.maxzoom&&(P[z.key]=z)}this._retainLoadedChildren(P,m,M,s);for(const z of t){let L=this._tiles[z.key];if(L.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const B=z.children(this._source.maxzoom)[0],j=this.getTile(B);if(j&&j.hasData()){s[B.key]=B;continue}}else{const B=z.children(this._source.maxzoom);if(s[B[0].key]&&s[B[1].key]&&s[B[2].key]&&s[B[3].key])continue}let F=L.wasRequested();for(let B=z.overscaledZ-1;B>=x;--B){const j=z.scaledTo(B);if(h[j.key]||(h[j.key]=!0,L=this.getTile(j),!L&&F&&(L=this._addTile(j)),L&&(s[j.key]=j,F=L.wasRequested(),L.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let h,m=this._tiles[t].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){h=this._loadedParentTiles[m.key];break}s.push(m.key);const g=m.scaledTo(m.overscaledZ-1);if(h=this._getLoadedTile(g),h)break;m=g}for(const g of s)this._loadedParentTiles[g]=h}}_addTile(t){let s=this._tiles[t.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const h=!!s;if(!h){const m=this.map?this.map.painter:null,g=this._source.tileSize*t.overscaleFactor();s=this._source.type==="raster-array"?new ma(t,g,this.transform.tileZoom,m,this._isRaster):new pa(t,g,this.transform.tileZoom,m,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))}return s?(s.uses++,this._tiles[t.key]=s,h||this._source.fire(new i.A("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const h=s.getExpiryTimeout();h&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},h))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,s,h){const m=[],g=this.transform;if(!g)return m;const x=g.projection.name==="globe",M=i.av(g.center.lng);for(const P in this._tiles){const z=this._tiles[P];if(h&&z.clearQueryDebugViz(),z.holdingForFade())continue;let L;if(x){const F=z.tileID.canonical;if(F.z===0){const B=[Math.abs(i.ay(M,...Ic(F,-1))-M),Math.abs(i.ay(M,...Ic(F,1))-M)];L=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(i.ay(M,...Ic(F,-1))-M),Math.abs(i.ay(M,...Ic(F,0))-M),Math.abs(i.ay(M,...Ic(F,1))-M)];L=[B.indexOf(Math.min(...B))-1]}}else L=[0];for(const F of L){const B=t.containsTile(z,g,s,F);B&&m.push(B)}}return m}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,s){const h=this.getRenderableIds(t,s).map(g=>this._tiles[g].tileID),m=this.transform.projection.name==="globe";for(const g of h)g.projMatrix=this.transform.calculateProjMatrix(g.toUnwrapped()),g.expandedProjMatrix=m?this.transform.calculateProjMatrix(g.toUnwrapped(),!1,!0):g.projMatrix;return h}sortCoordinatesByDistance(t){const s=t.slice(),h=this.transform._camera.position,m=this.transform._camera.forward(),g={};for(const x of s){const M=1/(1<<x.canonical.z);g[x.key]=((x.canonical.x+.5)*M+x.wrap-h[0])*m[0]+((x.canonical.y+.5)*M-h[1])*m[1]-h[2]*m[2]}return s.sort((x,M)=>g[x.key]-g[M.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(tn(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=i.q.now())return!0}return!1}setFeatureState(t,s,h){this._state.updateState(t=t||"_geojsonTileLayer",s,h)}removeFeatureState(t,s,h){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,h)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,h){const m=this._tiles[t];m&&m.setDependencies(s,h)}reloadTilesForDependencies(t,s){for(const h in this._tiles)this._tiles[h].hasDependency(t,s)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(t,s))}_preloadTiles(t,s){if(!this._sourceLoaded){const P=()=>{this._sourceLoaded&&(this._source.off("data",P),this._preloadTiles(t,s))};return void this._source.on("data",P)}const h=new Map,m=Array.isArray(t)?t:[t],g=this.map.painter.terrain,x=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const P of m){const z=P.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of z)h.set(L.key,L);this.usedForTerrain&&P.updateElevation(!1)}const M=Array.from(h.values());i.bl(M,(P,z)=>{const L=new pa(P,this._source.tileSize*P.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,F=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),z(F,L)})},s)}}function Vd(d,t){const s=Math.abs(2*d.wrap)-+(d.wrap<0),h=Math.abs(2*t.wrap)-+(t.wrap<0);return d.overscaledZ-t.overscaledZ||h-s||t.canonical.y-d.canonical.y||t.canonical.x-d.canonical.x}function tn(d){return d==="raster"||d==="image"||d==="video"||d==="custom"}function Ic(d,t){const s=1<<d.z;return[d.x/s+t,(d.x+1)/s+t]}ws.maxOverzooming=10,ws.maxUnderzooming=3;class or{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,s=!1;for(const h in this.style._mergedLayers){const m=this.style._mergedLayers[h];if(m.type==="fill-extrusion")this.layers.push({layer:m,visible:t,visibilityChanged:s});else if(m.type==="model"){const g=this.style.getLayerSource(m);g&&g.type==="batched-model"&&this.layers.push({layer:m,visible:t,visibilityChanged:s})}}}onNewFrame(t){this.layersGotHidden=!1;for(const s of this.layers){const h=s.layer;let m=!1;h.type==="fill-extrusion"?m=!h.isHidden(t)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="model"&&(m=!h.isHidden(t)&&h.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!m&&s.visible,s.visible=m}}updateZOffset(t,s){this.currentBuildingBuckets=[];for(const m of this.layers){const g=m.layer,x=this.style.getLayerSourceCache(g);let M=1;g.type==="fill-extrusion"&&(M=m.visible?g.paint.get("fill-extrusion-vertical-scale"):0);let P=x?x.getTile(s):null;if(!P&&x&&s.canonical.z>x.getSource().minzoom){let z=s.scaledTo(Math.min(x.getSource().maxzoom,s.overscaledZ-1));for(;z.overscaledZ>=x.getSource().minzoom&&(P=x.getTile(z),!P&&z.overscaledZ!==0);)z=z.scaledTo(z.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:P?P.getBucket(g):null,tileID:P?P.tileID:s,verticalScale:M})}t.hasAnyZOffset=!1;let h=!1;for(let m=0;m<t.symbolInstances.length;m++){const g=t.symbolInstances.get(m),x=g.zOffset,M=this._getHeightAtTileOffset(s,g.tileAnchorX,g.tileAnchorY);g.zOffset=M!==Number.NEGATIVE_INFINITY?M:x,h||x===g.zOffset||(h=!0),t.hasAnyZOffset||g.zOffset===0||(t.hasAnyZOffset=!0)}h&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,s,h,m){let g=s,x=h;if(t.canonical.z!==m.canonical.z){const M=m.canonical,P=1/(1<<t.canonical.z-M.z);g=(s+t.canonical.x*i.ai)*P-M.x*i.ai|0,x=(h+t.canonical.y*i.ai)*P-M.y*i.ai|0}return{tileX:g,tileY:x}}_getHeightAtTileOffset(t,s,h){let m,g;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;const{bucket:M,tileID:P,verticalScale:z}=this.currentBuildingBuckets[x];if(!M)continue;const{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(t,s,h,P),B=M.getHeightAtTileCoord(L,F);B&&B.height!==void 0&&(B.hidden?m=B.height:g=Math.max(B.height*z,g||0))}if(g!==void 0)return g;for(let x=0;x<this.layers.length;++x){const M=this.layers[x];if(M.layer.type!=="model"||!M.visible)continue;const{bucket:P,tileID:z}=this.currentBuildingBuckets[x];if(!P)continue;const{tileX:L,tileY:F}=this._mapCoordToOverlappingTile(t,s,h,z),B=P.getHeightAtTileCoord(L,F);if(B&&!B.hidden)return B.height===void 0&&m!==void 0?Math.min(B.maxHeight,m)*B.verticalScale:B.height?B.height*B.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Rm(d,t){const s={};for(const h in d)h!=="ref"&&(s[h]=d[h]);return i.bm.forEach(h=>{h in t&&(s[h]=t[h])}),s}function Ud(d){d=d.slice();const t=Object.create(null);for(let s=0;s<d.length;s++)t[d[s].id]=d[s];for(let s=0;s<d.length;s++)"ref"in d[s]&&(d[s]=Rm(d[s],t[d[s].ref]));return d}const qr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Uu(d,t,s){s.push({command:qr.addSource,args:[d,t[d]]})}function Ns(d,t,s){t.push({command:qr.removeSource,args:[d]}),s[d]=!0}function jd(d,t,s,h){Ns(d,s,h),Uu(d,t,s)}function bl(d,t,s){let h;for(h in d[s])if(d[s].hasOwnProperty(h)&&h!=="data"&&!i.bn(d[s][h],t[s][h]))return!1;for(h in t[s])if(t[s].hasOwnProperty(h)&&h!=="data"&&!i.bn(d[s][h],t[s][h]))return!1;return!0}function qt(d,t,s,h,m,g){let x;for(x in t=t||{},d=d||{})d.hasOwnProperty(x)&&(i.bn(d[x],t[x])||s.push({command:g,args:[h,x,t[x],m]}));for(x in t)t.hasOwnProperty(x)&&!d.hasOwnProperty(x)&&(i.bn(d[x],t[x])||s.push({command:g,args:[h,x,t[x],m]}))}function rn(d){return d.id}function Hr(d,t){return d[t.id]=t,d}class ns{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=i.ay(t,0,1);let s=1,h=this._distances[s];const m=t*this.paddedLength+this.padding;for(;h<m&&s<this._distances.length;)h=this._distances[++s];const g=s-1,x=this._distances[g],M=h-x,P=M>0?(m-x)/M:0;return this.points[g].mult(1-P).add(this.points[s].mult(P))}}class $a{constructor(t,s,h){const m=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(s/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)m.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,h,m,g){this._forEachCell(s,h,m,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(g)}insertCircle(t,s,h,m){this._forEachCell(s-m,h-m,s+m,h+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(h),this.circles.push(m)}_insertBoxCell(t,s,h,m,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,s,h,m,g,x){this.circleCells[g].push(x)}_query(t,s,h,m,g,x){if(h<0||t>this.width||m<0||s>this.height)return!g&&[];const M=[];if(t<=0&&s<=0&&this.width<=h&&this.height<=m){if(g)return!0;for(let P=0;P<this.boxKeys.length;P++)M.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],L=this.circles[3*P+1],F=this.circles[3*P+2];M.push({key:this.circleKeys[P],x1:z-F,y1:L-F,x2:z+F,y2:L+F})}return x?M.filter(x):M}return this._forEachCell(t,s,h,m,this._queryCell,M,{hitTest:g,seenUids:{box:{},circle:{}}},x),g?M.length>0:M}_queryCircle(t,s,h,m,g){const x=t-h,M=t+h,P=s-h,z=s+h;if(M<0||x>this.width||z<0||P>this.height)return!m&&[];const L=[];return this._forEachCell(x,P,M,z,this._queryCellCircle,L,{hitTest:m,circle:{x:t,y:s,radius:h},seenUids:{box:{},circle:{}}},g),m?L.length>0:L}query(t,s,h,m,g){return this._query(t,s,h,m,!1,g)}hitTest(t,s,h,m,g){return this._query(t,s,h,m,!0,g)}hitTestCircle(t,s,h,m){return this._queryCircle(t,s,h,!0,m)}_queryCell(t,s,h,m,g,x,M,P){const z=M.seenUids,L=this.boxCells[g];if(L!==null){const B=this.bboxes;for(const j of L)if(!z.box[j]){z.box[j]=!0;const Z=4*j;if(t<=B[Z+2]&&s<=B[Z+3]&&h>=B[Z+0]&&m>=B[Z+1]&&(!P||P(this.boxKeys[j]))){if(M.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[j],x1:B[Z],y1:B[Z+1],x2:B[Z+2],y2:B[Z+3]})}}}const F=this.circleCells[g];if(F!==null){const B=this.circles;for(const j of F)if(!z.circle[j]){z.circle[j]=!0;const Z=3*j;if(this._circleAndRectCollide(B[Z],B[Z+1],B[Z+2],t,s,h,m)&&(!P||P(this.circleKeys[j]))){if(M.hitTest)return x.push(!0),!0;{const H=B[Z],J=B[Z+1],Q=B[Z+2];x.push({key:this.circleKeys[j],x1:H-Q,y1:J-Q,x2:H+Q,y2:J+Q})}}}}}_queryCellCircle(t,s,h,m,g,x,M,P){const z=M.circle,L=M.seenUids,F=this.boxCells[g];if(F!==null){const j=this.bboxes;for(const Z of F)if(!L.box[Z]){L.box[Z]=!0;const H=4*Z;if(this._circleAndRectCollide(z.x,z.y,z.radius,j[H+0],j[H+1],j[H+2],j[H+3])&&(!P||P(this.boxKeys[Z])))return x.push(!0),!0}}const B=this.circleCells[g];if(B!==null){const j=this.circles;for(const Z of B)if(!L.circle[Z]){L.circle[Z]=!0;const H=3*Z;if(this._circlesCollide(j[H],j[H+1],j[H+2],z.x,z.y,z.radius)&&(!P||P(this.circleKeys[Z])))return x.push(!0),!0}}}_forEachCell(t,s,h,m,g,x,M,P){const z=this._convertToXCellCoord(t),L=this._convertToYCellCoord(s),F=this._convertToXCellCoord(h),B=this._convertToYCellCoord(m);for(let j=z;j<=F;j++)for(let Z=L;Z<=B;Z++)if(g.call(this,t,s,h,m,this.xCellCount*Z+j,x,M,P))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,h,m,g,x){const M=m-t,P=g-s,z=h+x;return z*z>M*M+P*P}_circleAndRectCollide(t,s,h,m,g,x,M){const P=(x-m)/2,z=Math.abs(t-(m+P));if(z>P+h)return!1;const L=(M-g)/2,F=Math.abs(s-(g+L));if(F>L+h)return!1;if(z<=P||F<=L)return!0;const B=z-P,j=F-L;return B*B+j*j<=h*h}}const $r={unknown:0,flipRequired:1,flipNotRequired:2},ju=Math.tan(85*Math.PI/180);function No(d,t,s,h,m,g,x){const M=i.ad.mat4.create();if(s)if(g.name==="globe"){const P=i.bo(m,t);i.ad.mat4.multiply(M,M,P)}else{const P=i.ad.mat2.invert([],x);M[0]=P[0],M[1]=P[1],M[4]=P[2],M[5]=P[3],h||i.ad.mat4.rotateZ(M,M,m.angle)}else i.ad.mat4.multiply(M,m.labelPlaneMatrix,d);return M}function Ga(d,t,s,h,m,g,x){const M=No(d,t,s,h,m,g,x);return g.name==="globe"&&s||(M[2]=M[6]=M[10]=M[14]=0),M}function Pi(d,t,s,h,m,g,x){if(s){if(g.name==="globe"){const M=No(d,t,s,h,m,g,x);return i.ad.mat4.invert(M,M),i.ad.mat4.multiply(M,d,M),M}{const M=i.ad.mat4.clone(d),P=i.ad.mat4.identity([]);return P[0]=x[0],P[1]=x[1],P[4]=x[2],P[5]=x[3],i.ad.mat4.multiply(M,M,P),h||i.ad.mat4.rotateZ(M,M,-m.angle),M}}return m.glCoordMatrix}function Tn(d,t,s,h){const m=[d,t,s,1];s?i.ad.vec4.transformMat4(m,m,h):Ha(m,m,h);const g=m[3];return m[0]/=g,m[1]/=g,m[2]/=g,m}function Dm(d,t){return Math.min(.5+d/t*.5,1.5)}function Cc(d,t){const s=d[0]/d[3],h=d[1]/d[3];return s>=-t[0]&&s<=t[0]&&h>=-t[1]&&h<=t[1]}function $u(d,t,s,h,m,g,x,M,P,z){const L=s.transform,F=h?d.textSizeData:d.iconSizeData,B=i.bp(F,s.transform.zoom),j=L.projection.name==="globe",Z=[256/s.width*2+1,256/s.height*2+1],H=h?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;H.clear();let J=null;j&&(J=h?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const Q=d.lineVertexArray,oe=h?d.text.placedSymbolArray:d.icon.placedSymbolArray,ue=s.transform.width/s.transform.height;let ce,ge=!1;for(let fe=0;fe<oe.length;fe++){const _e=oe.get(fe),{numGlyphs:pe,writingMode:we}=_e;if(we!==i.bq.vertical||ge||ce===i.bq.horizontal||(ge=!0),ce=we,(_e.hidden||we===i.bq.vertical)&&!ge){qa(pe,H);continue}ge=!1;const Ee=new i.P(_e.tileAnchorX,_e.tileAnchorY);let{x:qe,y:Be,z:et}=L.projection.projectTilePoint(Ee.x,Ee.y,z.canonical);if(P){const[Mt,Lt,Wt]=P(Ee);qe+=Mt,Be+=Lt,et+=Wt}const rt=[qe,Be,et,1];if(i.ad.vec4.transformMat4(rt,rt,t),!Cc(rt,Z)){qa(pe,H);continue}const _t=rt[3],Oe=Dm(s.transform.getCameraToCenterDistance(L.projection),_t),Qe=i.br(F,B,_e),De=x?Qe/Oe:Qe*Oe,Je=Tn(qe,Be,et,m);if(Je[3]<=0){qa(pe,H);continue}let Ze={};const st=i.ak(d.layers[0].layout.get("text-max-angle")),$e=Math.cos(st),lt=x?null:P,wt=Pc(_e,De,!1,M,t,m,g,d.glyphOffsetArray,Q,H,J,Je,Ee,Ze,ue,lt,L.projection,z,x,$e);ge=wt.useVertical,lt&&wt.needsFlipping&&(Ze={}),(wt.notEnoughRoom||ge||wt.needsFlipping&&Pc(_e,De,!0,M,t,m,g,d.glyphOffsetArray,Q,H,J,Je,Ee,Ze,ue,lt,L.projection,z,x,$e).notEnoughRoom)&&qa(pe,H)}h?(d.text.dynamicLayoutVertexBuffer.updateData(H),J&&d.text.globeExtVertexBuffer&&d.text.globeExtVertexBuffer.updateData(J)):(d.icon.dynamicLayoutVertexBuffer.updateData(H),J&&d.icon.globeExtVertexBuffer&&d.icon.globeExtVertexBuffer.updateData(J))}function wl(d,t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H,J){const{lineStartIndex:Q,glyphStartIndex:oe,segment:ue}=M,ce=oe+M.numGlyphs,ge=Q+M.lineLength,fe=t.getoffsetX(oe),_e=t.getoffsetX(ce-1),pe=Ei(d*fe,s,h,m,g,x,ue,Q,ge,P,z,L,F,B,!0,j,Z,H,J);if(!pe)return null;const we=Ei(d*_e,s,h,m,g,x,ue,Q,ge,P,z,L,F,B,!0,j,Z,H,J);return we?{first:pe,last:we}:null}function Gu(d,t,s,h){return d===i.bq.horizontal&&Math.abs(h)>Math.abs(s)?{useVertical:!0}:d===i.bq.vertical?h>0?{needsFlipping:!0}:null:t!==$r.unknown&&function(m,g){return m===0||Math.abs(g/m)>ju}(s,h)?t===$r.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Pc(d,t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H,J,Q,oe,ue){const ce=t/24,ge=d.lineOffsetX*ce,fe=d.lineOffsetY*ce,{lineStartIndex:_e,glyphStartIndex:pe,numGlyphs:we,segment:Ee,writingMode:qe,flipState:Be}=d,et=_e+d.lineLength,rt=_t=>{if(L){const[Je,Ze,st]=_t.up,$e=z.length;i.bs(L,$e+0,Je,Ze,st),i.bs(L,$e+1,Je,Ze,st),i.bs(L,$e+2,Je,Ze,st),i.bs(L,$e+3,Je,Ze,st)}const[Oe,Qe,De]=_t.point;i.bt(z,Oe,Qe,De,_t.angle)};if(we>1){const _t=wl(ce,M,ge,fe,s,F,B,d,P,g,j,H,!1,J,Q,oe,ue);if(!_t)return{notEnoughRoom:!0};if(h&&!s){let[Oe,Qe,De]=_t.first.point,[Je,Ze,st]=_t.last.point;[Oe,Qe]=Tn(Oe,Qe,De,x),[Je,Ze]=Tn(Je,Ze,st,x);const $e=Gu(qe,Be,(Je-Oe)*Z,Ze-Qe);if(d.flipState=$e&&$e.needsFlipping?$r.flipRequired:$r.flipNotRequired,$e)return $e}rt(_t.first);for(let Oe=pe+1;Oe<pe+we-1;Oe++){const Qe=Ei(ce*M.getoffsetX(Oe),ge,fe,s,F,B,Ee,_e,et,P,g,j,H,!1,!1,J,Q,oe,ue);if(!Qe)return z.length-=4*(Oe-pe),{notEnoughRoom:!0};rt(Qe)}rt(_t.last)}else{if(h&&!s){const Oe=Tn(B.x,B.y,0,m),Qe=_e+Ee+1,De=new i.P(P.getx(Qe),P.gety(Qe)),Je=Tn(De.x,De.y,0,m),Ze=Je[3]>0?Je:To(B,De,Oe,1,m,void 0,J,Q.canonical),st=Gu(qe,Be,(Ze[0]-Oe[0])*Z,Ze[1]-Oe[1]);if(d.flipState=st&&st.needsFlipping?$r.flipRequired:$r.flipNotRequired,st)return st}const _t=Ei(ce*M.getoffsetX(pe),ge,fe,s,F,B,Ee,_e,et,P,g,j,H,!1,!1,J,Q,oe,ue);if(!_t)return{notEnoughRoom:!0};rt(_t)}return{}}function Vi(d,t,s,h,m){const{x:g,y:x,z:M}=h.projectTilePoint(d.x,d.y,t);if(!m)return Tn(g,x,M,s);const[P,z,L]=m(d);return Tn(g+P,x+z,M+L,s)}function To(d,t,s,h,m,g,x,M){const P=Vi(d.sub(t)._unit()._add(d),M,m,x,g);return i.ad.vec3.sub(P,s,P),i.ad.vec3.normalize(P,P),i.ad.vec3.scaleAndAdd(P,s,P,h)}function Ei(d,t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H,J,Q,oe){const ue=h?d-t:d+t;let ce=ue>0?1:-1,ge=0;h&&(ce*=-1,ge=Math.PI),ce<0&&(ge+=Math.PI);let fe=M+x+(ce>0?0:1)|0,_e=m,pe=m,we=0,Ee=0;const qe=Math.abs(ue),Be=[],et=[];let rt=g,_t=rt,Oe=i.ad.vec3.zero([]);const Qe=()=>To(_t,rt,pe,qe-we+1,L,B,H,J.canonical);for(;we+Ee<=qe;){if(fe+=ce,fe<M||fe>=P)return null;if(pe=_e,_t=rt,Be.push(pe),j&&et.push(_t),rt=new i.P(z.getx(fe),z.gety(fe)),_e=F[fe],!_e){const Wt=Vi(rt,J.canonical,L,H,B);_e=Wt[3]>0?F[fe]=Wt:Qe()}we+=Ee;const Mt=i.ad.vec3.sub([],_e,pe),Lt=i.ad.vec3.distance(pe,_e);if(s&&Lt>0&&Ee>0&&i.ad.vec3.dot(Oe,Mt)/(Ee*Lt)<oe)return null;Ee=Lt,Oe=Mt}Z&&B&&(F[fe]&&(_e=Qe(),Ee=i.ad.vec3.distance(pe,_e),Oe=i.ad.vec3.sub([],_e,pe)),F[fe]=_e);const De=(qe-we)/Ee,Je=rt.sub(_t)._mult(De)._add(_t),Ze=i.ad.vec3.scaleAndAdd([],pe,Oe,De);let st=[0,0,1],$e=Oe[0],lt=Oe[1];if(Q&&(st=H.upVector(J.canonical,Je.x,Je.y),st[0]!==0||st[1]!==0||st[2]!==1)){const Mt=[st[2],0,-st[0]],Lt=i.ad.vec3.cross([],st,Mt);i.ad.vec3.normalize(Mt,Mt),i.ad.vec3.normalize(Lt,Lt),$e=i.ad.vec3.dot(Oe,Mt),lt=i.ad.vec3.dot(Oe,Lt)}if(s){const Mt=i.ad.vec3.cross([],st,Oe);i.ad.vec3.normalize(Mt,Mt),i.ad.vec3.scaleAndAdd(Ze,Ze,Mt,s*ce)}const wt=ge+Math.atan2(lt,$e);return Be.push(Ze),j&&et.push(Je),{point:Ze,angle:wt,path:Be,tilePath:et,up:st}}function qa(d,t){const s=t.length,h=s+4*d;t.resize(h),t.float32.fill(-1/0,4*s,4*h)}function Ha(d,t,s){const h=t[0],m=t[1];return d[0]=s[0]*h+s[4]*m+s[12],d[1]=s[1]*h+s[5]*m+s[13],d[3]=s[3]*h+s[7]*m+s[15],d}const Ln=100;class Qs{constructor(t,s,h=new $a(t.width+200,t.height+200,25),m=new $a(t.width+200,t.height+200,25)){this.transform=t,this.grid=h,this.ignoredGrid=m,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ln,this.screenBottomBoundary=t.height+Ln,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=s}placeCollisionBox(t,s,h,m,g,x,M,P){let z=h.projectedAnchorX,L=h.projectedAnchorY,F=h.projectedAnchorZ;const B=h.elevation,j=h.tileID,Z=t.getProjection();if(B&&j){const[fe,_e,pe]=Z.upVector(j.canonical,h.tileAnchorX,h.tileAnchorY),we=Z.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=fe*B*we,L+=_e*B*we,F+=pe*B*we}const H=this.projectAndGetPerspectiveRatio(M,z,L,F,h.tileID,Z.name==="globe"||!!B||this.transform.pitch>0,Z),J=x*H.perspectiveRatio,Q=(h.x1*s+m.x-h.padding)*J+H.point.x,oe=(h.y1*s+m.y-h.padding)*J+H.point.y,ue=(h.x2*s+m.x+h.padding)*J+H.point.x,ce=(h.y2*s+m.y+h.padding)*J+H.point.y,ge=H.perspectiveRatio<=.55||H.occluded;return!this.isInsideGrid(Q,oe,ue,ce)||!g&&this.grid.hitTest(Q,oe,ue,ce,P)||ge?{box:[],offscreen:!1,occluded:H.occluded}:{box:[Q,oe,ue,ce],offscreen:this.isOffscreen(Q,oe,ue,ce),occluded:!1}}placeCollisionCircles(t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H){const J=[],Q=this.transform.elevation,oe=t.getProjection(),ue=Q?Q.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,oe):null,ce=new i.P(h.tileAnchorX,h.tileAnchorY);let{x:ge,y:fe,z:_e}=oe.projectTilePoint(ce.x,ce.y,H.canonical);if(ue){const[st,$e,lt]=ue(ce);ge+=st,fe+=$e,_e+=lt}const pe=oe.name==="globe",we=this.projectAndGetPerspectiveRatio(M,ge,fe,_e,H,pe||!!Q||this.transform.pitch>0,oe),{perspectiveRatio:Ee}=we,qe=(F?x/Ee:x*Ee)/i.bw,Be=Tn(ge,fe,_e,P),et=h.lineOffsetX*qe,rt=h.lineOffsetY*qe,_t=i.ak(t.layers[0].layout.get("text-max-angle")),Oe=Math.cos(_t),Qe=we.signedDistanceFromCamera>0?wl(qe,g,et,rt,!1,Be,ce,h,m,P,{},Q&&!F?ue:null,F&&!!Q,oe,H,F,Oe):null;let De=!1,Je=!1,Ze=!0;if(Qe&&!we.occluded){const st=.5*j*Ee+Z,$e=new i.P(-100,-100),lt=new i.P(this.screenRightBoundary,this.screenBottomBoundary),wt=new ns,{first:Mt,last:Lt}=Qe,Wt=Mt.path.length;let fr=[];for(let ur=Wt-1;ur>=1;ur--)fr.push(Mt.path[ur]);for(let ur=1;ur<Lt.path.length;ur++)fr.push(Lt.path[ur]);const nr=2.5*st;z&&(fr=fr.map(([ur,Br,nn],hn)=>(ue&&!pe&&(nn=ue(hn<Wt-1?Mt.tilePath[Wt-1-hn]:Lt.tilePath[hn-Wt+2])[2]),Tn(ur,Br,nn,z))),fr.some(ur=>ur[3]<=0)&&(fr=[]));let pr=[];if(fr.length>0){let ur=1/0,Br=-1/0,nn=1/0,hn=-1/0;for(const Dr of fr)ur=Math.min(ur,Dr[0]),nn=Math.min(nn,Dr[1]),Br=Math.max(Br,Dr[0]),hn=Math.max(hn,Dr[1]);Br>=$e.x&&ur<=lt.x&&hn>=$e.y&&nn<=lt.y&&(pr=[fr.map(Dr=>new i.P(Dr[0],Dr[1]))],(ur<$e.x||Br>lt.x||nn<$e.y||hn>lt.y)&&(pr=i.bu(pr,$e.x,$e.y,lt.x,lt.y)))}for(const ur of pr){wt.reset(ur,.25*st);let Br=0;Br=wt.length<=.5*st?1:Math.ceil(wt.paddedLength/nr)+1;for(let nn=0;nn<Br;nn++){const hn=nn/Math.max(Br-1,1),Dr=wt.lerp(hn),Pn=Dr.x+Ln,wr=Dr.y+Ln;J.push(Pn,wr,st,0);const _r=Pn-st,sr=wr-st,Kr=Pn+st,Yr=wr+st;if(Ze=Ze&&this.isOffscreen(_r,sr,Kr,Yr),Je=Je||this.isInsideGrid(_r,sr,Kr,Yr),!s&&this.grid.hitTestCircle(Pn,wr,st,B)&&(De=!0,!L))return{circles:[],offscreen:!1,collisionDetected:De,occluded:!1}}}}return{circles:!L&&De||!Je?[]:J,offscreen:Ze,collisionDetected:De,occluded:we.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,m=1/0,g=-1/0,x=-1/0;for(const L of t){const F=new i.P(L.x+Ln,L.y+Ln);h=Math.min(h,F.x),m=Math.min(m,F.y),g=Math.max(g,F.x),x=Math.max(x,F.y),s.push(F)}const M=this.grid.query(h,m,g,x).concat(this.ignoredGrid.query(h,m,g,x)),P={},z={};for(const L of M){const F=L.key;if(P[F.bucketInstanceId]===void 0&&(P[F.bucketInstanceId]={}),P[F.bucketInstanceId][F.featureIndex])continue;const B=[new i.P(L.x1,L.y1),new i.P(L.x2,L.y1),new i.P(L.x2,L.y2),new i.P(L.x1,L.y2)];i.bv(s,B)&&(P[F.bucketInstanceId][F.featureIndex]=!0,z[F.bucketInstanceId]===void 0&&(z[F.bucketInstanceId]=[]),z[F.bucketInstanceId].push(F.featureIndex))}return z}insertCollisionBox(t,s,h,m,g){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:g},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,h,m,g){const x=s?this.ignoredGrid:this.grid,M={bucketInstanceId:h,featureIndex:m,collisionGroupID:g};for(let P=0;P<t.length;P+=4)x.insertCircle(M,t[P],t[P+1],t[P+2])}projectAndGetPerspectiveRatio(t,s,h,m,g,x,M){const P=[s,h,m,1];let z=!1;m||this.transform.pitch>0?(i.ad.vec4.transformMat4(P,P,t),this.fogState&&g&&M.name!=="globe"&&(z=function(B,j,Z,H,J,Q){const oe=Q.calculateFogTileMatrix(J),ue=[j,Z,H];return i.ad.vec3.transformMat4(ue,ue,oe),Nt(B,i.ad.vec3.length(ue),Q.pitch,Q._fov)}(this.fogState,s,h,m,g.toUnwrapped(),this.transform)>.9)):Ha(P,P,t);const L=P[3];return{point:new i.P((P[0]/L+1)/2*this.transform.width+Ln,(-P[1]/L+1)/2*this.transform.height+Ln),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/L*.5,1.5),signedDistanceFromCamera:L,occluded:x&&P[2]>L||z}}isOffscreen(t,s,h,m){return h<Ln||t>=this.screenRightBoundary||m<Ln||s>this.screenBottomBoundary}isInsideGrid(t,s,h,m){return h>=0&&t<this.gridRightBoundary&&m>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=i.ad.mat4.identity([]);return i.ad.mat4.translate(t,t,[-100,-100,0]),t}}function eo(d,t,s){const h=t.createTileMatrix(d,d.worldSize,s.toUnwrapped());return i.ad.mat4.multiply(new Float32Array(16),d.projMatrix,h)}function ai(d,t,s){if(t.projection.name===s.projection.name)return d.projMatrix;const h=s.clone();return h.setProjection(t.projection),eo(h,t.getProjection(),d)}function Rc(d,t,s){return t.name===s.projection.name?d.projMatrix:eo(s,t,d)}class Vs{constructor(t,s,h,m){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):m&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Vo{constructor(t,s,h,m,g,x=!1){this.text=new Vs(t?t.text:null,s,h,g),this.icon=new Vs(t?t.icon:null,s,m,g),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Tl{constructor(t,s,h,m=!1){this.text=t,this.icon=s,this.skipFade=h,this.clipped=m}}class Wa{constructor(){this.invProjMatrix=i.ad.mat4.create(),this.viewportMatrix=i.ad.mat4.create(),this.circles=[]}}class Vy{constructor(t,s,h,m,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=m,this.tileID=g}}class Uo{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[t]}}function zm(d,t,s,h,m){const{horizontalAlign:g,verticalAlign:x}=i.bD(d),M=-(g-.5)*t,P=-(x-.5)*s,z=i.bC(d,h);return new i.P(M+z[0]*m,P+z[1]*m)}function Dc(d,t,s,h,m){const g=new i.P(d,t);return s&&g._rotate(h?m:-m),g}class is{constructor(t,s,h,m,g,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Qs(this.transform,g),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new Uo(h),this.collisionCircleArrays={},this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,h,m,g=1){const x=h.getBucket(s),M=h.latestFeatureIndex;if(!x||!M||s.fqid!==x.layerIds[0])return;const P=x.layers[0].layout,z=x.layers[0].paint,L=h.collisionBoxArray,F=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),B=h.tileSize/i.ai,j=h.tileID.toUnwrapped();this.transform.setProjection(x.projection);const Z=(H=h.tileID,J=x.getProjection(),Q=this.transform,J.name===this.projection?Q.calculateProjMatrix(H.toUnwrapped()):eo(Q,J,H));var H,J,Q;const oe=P.get("text-pitch-alignment")==="map",ue=P.get("text-rotation-alignment")==="map";s.compileFilter(s.options);const ce=s.dynamicFilter(),ge=s.dynamicFilterNeedsFeature(),fe=this.transform.calculatePixelsToTileUnitsMatrix(h),_e=Ga(Z,h.tileID.canonical,oe,ue,this.transform,x.getProjection(),fe);let pe=null;if(oe){const Qe=Pi(Z,h.tileID.canonical,oe,ue,this.transform,x.getProjection(),fe);pe=i.ad.mat4.multiply([],this.transform.labelPlaneMatrix,Qe)}let we=null;ce&&h.latestFeatureIndex&&(we={unwrappedTileID:j,dynamicFilter:ce,dynamicFilterNeedsFeature:ge}),this.retainedQueryData[x.bucketInstanceId]=new Vy(x.bucketInstanceId,M,x.sourceLayerIndex,x.index,h.tileID);const[Ee,qe]=x.layers[0].layout.get("text-size-scale-range"),Be=i.ay(g,Ee,qe),[et,rt]=P.get("icon-size-scale-range"),_t=i.ay(g,et,rt),Oe={bucket:x,layout:P,paint:z,posMatrix:Z,textLabelPlaneMatrix:_e,labelToScreenMatrix:pe,clippingData:we,scale:F,textPixelRatio:B,holdingForFade:h.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:i.bp(x.textSizeData,this.transform.zoom,Be),partiallyEvaluatedIconSize:i.bp(x.iconSizeData,this.transform.zoom,_t),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:h.latestFeatureIndex};if(m)for(const Qe of x.sortKeyRanges){const{sortKey:De,symbolInstanceStart:Je,symbolInstanceEnd:Ze}=Qe;t.push({sortKey:De,symbolInstanceStart:Je,symbolInstanceEnd:Ze,parameters:Oe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Oe})}attemptAnchorPlacement(t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H,J,Q,oe){const{textOffset0:ue,textOffset1:ce,crossTileID:ge}=B,fe=[ue,ce],_e=zm(t,h,m,fe,g),pe=this.collisionIndex.placeCollisionBox(Z,g,s,Dc(_e.x,_e.y,x,M,this.transform.angle),F,P,z,L.predicate);if(J){const we=Z.getSymbolInstanceIconSize(oe,this.transform.zoom,B.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Z,we,J,Dc(_e.x,_e.y,x,M,this.transform.angle),F,P,z,L.predicate).box.length===0)return}if(pe.box.length>0){let we;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge]&&this.prevPlacement.placements[ge]&&this.prevPlacement.placements[ge].text&&(we=this.prevPlacement.variableOffsets[ge].anchor),this.variableOffsets[ge]={textOffset:fe,width:h,height:m,anchor:t,textScale:g,prevAnchor:we},this.markUsedJustification(Z,t,B,H),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,H,B),this.placedOrientations[ge]=H),{shift:_e,placedGlyphBoxes:pe}}}placeLayerBucketPart(t,s,h,m,g=1){const{bucket:x,layout:M,paint:P,posMatrix:z,textLabelPlaneMatrix:L,labelToScreenMatrix:F,clippingData:B,textPixelRatio:j,holdingForFade:Z,collisionBoxArray:H,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:Q,collisionGroup:oe,latestFeatureIndex:ue}=t.parameters,ce=M.get("text-optional"),ge=M.get("icon-optional"),fe=M.get("text-allow-overlap"),_e=M.get("icon-allow-overlap"),pe=M.get("text-rotation-alignment")==="map",we=M.get("text-pitch-alignment")==="map",Ee=P.get("symbol-z-offset"),qe=M.get("symbol-elevation-reference")==="sea",[Be,et]=M.get("text-size-scale-range"),[rt,_t]=M.get("icon-size-scale-range"),Oe=i.ay(g,Be,et),Qe=i.ay(g,rt,_t);this.transform.setProjection(x.projection);let De=fe&&(_e||!x.hasIconData()||ge),Je=_e&&(fe||!x.hasTextData()||ce);const Ze=!Ee.isConstant();!x.collisionArrays&&H&&x.deserializeCollisionBoxes(H),h&&m&&x.updateCollisionDebugBuffers(this.transform.zoom,H,Oe,Qe);const st=($e,lt,wt)=>{const{crossTileID:Mt,numVerticalGlyphVertices:Lt}=$e;let Wt=null;if(B&&B.dynamicFilterNeedsFeature||Ze){const Jr=this.retainedQueryData[x.bucketInstanceId];Wt=ue.loadFeature({featureIndex:$e.featureIndex,bucketIndex:Jr.bucketIndex,sourceLayerIndex:Jr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(B&&!(0,B.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Wt,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new i.P($e.tileAnchorX,$e.tileAnchorY),this.transform.calculateDistanceTileData(B.unwrappedTileID)))return this.placements[Mt]=new Tl(!1,!1,!1,!0),void s.add(Mt);const fr=Ee.evaluate(Wt,{});if(s.has(Mt))return;if(Z)return void(this.placements[Mt]=new Tl(!1,!1,!1));let nr=!1,pr=!1,ur=!0,Br=!1,nn=!1,hn=null,Dr={box:null,offscreen:null,occluded:null},Pn={box:null},wr=null,_r=null,sr=null,Kr=0,Yr=0,$n=0;wt.textFeatureIndex?Kr=wt.textFeatureIndex:$e.useRuntimeCollisionCircles&&(Kr=$e.featureIndex),wt.verticalTextFeatureIndex&&(Yr=wt.verticalTextFeatureIndex);const di=Jr=>{Jr.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const Sn=this.transform.elevation;Jr.elevation=qe?fr:fr+(Sn?Sn.getAtTileOffset(Jr.tileID,Jr.tileAnchorX,Jr.tileAnchorY):0),Jr.elevation+=$e.zOffset},Qi=wt.textBox;if(Qi){di(Qi);const Jr=sn=>{let dn=i.bq.horizontal;if(x.allowVerticalPlacement&&!sn&&this.prevPlacement){const mi=this.prevPlacement.placedOrientations[Mt];mi&&(this.placedOrientations[Mt]=mi,dn=mi,this.markUsedOrientation(x,dn,$e))}return dn},Sn=(sn,dn)=>{if(x.allowVerticalPlacement&&Lt>0&&wt.verticalTextBox){for(const mi of x.writingModes)if(mi===i.bq.vertical?(Dr=dn(),Pn=Dr):Dr=sn(),Dr&&Dr.box&&Dr.box.length)break}else Dr=sn()};if(M.get("text-variable-anchor")){let sn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Mt]){const On=this.prevPlacement.variableOffsets[Mt];sn.indexOf(On.anchor)>0&&(sn=sn.filter(li=>li!==On.anchor),sn.unshift(On.anchor))}const dn=(On,li,Po)=>{const es=x.getSymbolInstanceTextSize(J,$e,this.transform.zoom,lt),Gs=(On.x2-On.x1)*es+2*On.padding,Xo=(On.y2-On.y1)*es+2*On.padding,zi=$e.hasIconTextFit&&!_e?li:null;zi&&di(zi);let Cs={box:[],offscreen:!1,occluded:!1};const Ro=fe?2*sn.length:sn.length;for(let so=0;so<Ro;++so){const Ko=this.attemptAnchorPlacement(sn[so%sn.length],On,Gs,Xo,es,pe,we,j,z,oe,so>=sn.length,$e,lt,x,Po,zi,J,Q);if(Ko&&(Cs=Ko.placedGlyphBoxes,Cs&&Cs.box&&Cs.box.length)){nr=!0,hn=Ko.shift;break}}return Cs};Sn(()=>dn(Qi,wt.iconBox,i.bq.horizontal),()=>{const On=wt.verticalTextBox;return On&&di(On),x.allowVerticalPlacement&&!(Dr&&Dr.box&&Dr.box.length)&&Lt>0&&On?dn(On,wt.verticalIconBox,i.bq.vertical):{box:null,offscreen:null,occluded:null}}),Dr&&(nr=Dr.box,ur=Dr.offscreen,Br=Dr.occluded);const mi=Jr(!(!Dr||!Dr.box));if(!nr&&this.prevPlacement){const On=this.prevPlacement.variableOffsets[Mt];On&&(this.variableOffsets[Mt]=On,this.markUsedJustification(x,On.anchor,$e,mi))}}else{const sn=(dn,mi)=>{const On=x.getSymbolInstanceTextSize(J,$e,this.transform.zoom,lt,g),li=this.collisionIndex.placeCollisionBox(x,On,dn,new i.P(0,0),fe,j,z,oe.predicate);return li&&li.box&&li.box.length&&(this.markUsedOrientation(x,mi,$e),this.placedOrientations[Mt]=mi),li};Sn(()=>sn(Qi,i.bq.horizontal),()=>{const dn=wt.verticalTextBox;return x.allowVerticalPlacement&&Lt>0&&dn?(di(dn),sn(dn,i.bq.vertical)):{box:null,offscreen:null,occluded:null}}),Jr(!!(Dr&&Dr.box&&Dr.box.length))}}if(wr=Dr,nr=wr&&wr.box&&wr.box.length>0,ur=wr&&wr.offscreen,Br=wr&&wr.occluded,$e.useRuntimeCollisionCircles){const Jr=x.text.placedSymbolArray.get($e.centerJustifiedTextSymbolIndex>=0?$e.centerJustifiedTextSymbolIndex:$e.verticalPlacedTextSymbolIndex),Sn=i.br(x.textSizeData,J,Jr),sn=M.get("text-padding");_r=this.collisionIndex.placeCollisionCircles(x,fe,Jr,x.lineVertexArray,x.glyphOffsetArray,Sn,z,L,F,h,we,oe.predicate,$e.collisionCircleDiameter*Sn/i.bw,sn,this.retainedQueryData[x.bucketInstanceId].tileID),nr=fe||_r.circles.length>0&&!_r.collisionDetected,ur=ur&&_r.offscreen,Br=_r.occluded}if(wt.iconFeatureIndex&&($n=wt.iconFeatureIndex),wt.iconBox){const Jr=Sn=>{di(Sn);const sn=$e.hasIconTextFit&&hn?Dc(hn.x,hn.y,pe,we,this.transform.angle):new i.P(0,0),dn=x.getSymbolInstanceIconSize(Q,this.transform.zoom,$e.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,dn,Sn,sn,_e,j,z,oe.predicate)};Pn&&Pn.box&&Pn.box.length&&wt.verticalIconBox?(sr=Jr(wt.verticalIconBox),pr=sr.box.length>0):(sr=Jr(wt.iconBox),pr=sr.box.length>0),ur=ur&&sr.offscreen,nn=sr.occluded}const fi=ce||$e.numHorizontalGlyphVertices===0&&Lt===0,Ti=ge||$e.numIconVertices===0;if(fi||Ti?Ti?fi||(pr=pr&&nr):nr=pr&&nr:pr=nr=pr&&nr,nr&&wr&&wr.box&&this.collisionIndex.insertCollisionBox(wr.box,M.get("text-ignore-placement"),x.bucketInstanceId,Pn&&Pn.box&&Yr?Yr:Kr,oe.ID),pr&&sr&&this.collisionIndex.insertCollisionBox(sr.box,M.get("icon-ignore-placement"),x.bucketInstanceId,$n,oe.ID),_r&&(nr&&this.collisionIndex.insertCollisionCircles(_r.circles,M.get("text-ignore-placement"),x.bucketInstanceId,Kr,oe.ID),h)){const Jr=x.bucketInstanceId;let Sn=this.collisionCircleArrays[Jr];Sn===void 0&&(Sn=this.collisionCircleArrays[Jr]=new Wa);for(let sn=0;sn<_r.circles.length;sn+=4)Sn.circles.push(_r.circles[sn+0]),Sn.circles.push(_r.circles[sn+1]),Sn.circles.push(_r.circles[sn+2]),Sn.circles.push(_r.collisionDetected?1:0)}const Ui=x.projection.name!=="globe";De=De&&(Ui||!Br),Je=Je&&(Ui||!nn),this.placements[Mt]=new Tl(nr||De,pr||Je,ur||x.justReloaded),s.add(Mt)};if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,this.retainedQueryData[x.bucketInstanceId].tileID),x.elevationType==="road"&&x.updateRoadElevation(),x.updateZOffset(),x.sortFeaturesByY){const $e=x.getSortedSymbolIndexes(this.transform.angle);for(let lt=$e.length-1;lt>=0;--lt){const wt=$e[lt];st(x.symbolInstances.get(wt),wt,x.collisionArrays[wt])}x.hasAnyZOffset&&i.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const $e=x.getSortedIndexesByZOffset();for(let lt=0;lt<$e.length;++lt){const wt=$e[lt];st(x.symbolInstances.get(wt),wt,x.collisionArrays[wt])}}else for(let $e=t.symbolInstanceStart;$e<t.symbolInstanceEnd;$e++)st(x.symbolInstances.get($e),$e,x.collisionArrays[$e]);if(h&&x.bucketInstanceId in this.collisionCircleArrays){const $e=this.collisionCircleArrays[x.bucketInstanceId];i.ad.mat4.invert($e.invProjMatrix,z),$e.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,s,h,m){const{leftJustifiedTextSymbolIndex:g,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:P,crossTileID:z}=h,L=i.bB(s),F=m===i.bq.vertical?P:L==="left"?g:L==="center"?x:L==="right"?M:-1;g>=0&&(t.text.placedSymbolArray.get(g).crossTileID=F>=0&&g!==F?0:z),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=F>=0&&x!==F?0:z),M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=F>=0&&M!==F?0:z),P>=0&&(t.text.placedSymbolArray.get(P).crossTileID=F>=0&&P!==F?0:z)}markUsedOrientation(t,s,h){const m=s===i.bq.horizontal||s===i.bq.horizontalOnly?s:0,g=s===i.bq.vertical?s:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:z}=h,L=t.text.placedSymbolArray;x>=0&&(L.get(x).placedOrientation=m),M>=0&&(L.get(M).placedOrientation=m),P>=0&&(L.get(P).placedOrientation=m),z>=0&&(L.get(z).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const m=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},x=s?s.variableOffsets:{},M=s?s.placedOrientations:{};for(const P in this.placements){const z=this.placements[P],L=g[P];L?(this.opacities[P]=new Vo(L,m,z.text,z.icon,null,z.clipped),h=h||z.text!==L.text.placed||z.icon!==L.icon.placed):(this.opacities[P]=new Vo(null,m,z.text,z.icon,z.skipFade,z.clipped),h=h||z.text||z.icon)}for(const P in g){const z=g[P];if(!this.opacities[P]){const L=new Vo(z,m,!1,!1);L.isHidden()||(this.opacities[P]=L,h=h||z.text.placed||z.icon.placed)}}for(const P in x)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=x[P]);for(const P in M)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=M[P]);h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s,h,m){const g=new Set;for(const x of s){const M=x.getBucket(t);M&&x.latestFeatureIndex&&t.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,g,x,x.collisionBoxArray,h,m,x.tileID,t.scope),M.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(M,x.tileID),M.elevationType==="road"&&M.updateRoadElevation(),M.updateZOffset())}}updateBucketOpacities(t,s,h,m,g,x,M,P){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const z=t.layers[0].layout,L=t.layers[0].paint,F=!!t.layers[0].dynamicFilter(),B=new Vo(null,0,!1,!1,!0),j=z.get("text-allow-overlap"),Z=z.get("icon-allow-overlap"),H=z.get("text-variable-anchor"),J=z.get("text-rotation-alignment")==="map",Q=z.get("text-pitch-alignment")==="map",oe=L.get("symbol-z-offset"),ue=z.get("symbol-elevation-reference")==="sea",ce=!oe.isConstant(),ge=new Vo(null,0,j&&(Z||!t.hasIconData()||z.get("icon-optional")),Z&&(j||!t.hasTextData()||z.get("text-optional")),!0);!t.collisionArrays&&m&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(m);const fe=(pe,we,Ee)=>{for(let qe=0;qe<we/4;qe++)pe.opacityVertexArray.emplaceBack(Ee)};let _e=0;x&&t.updateReplacement(M,x);for(let pe=0;pe<t.symbolInstances.length;pe++){const we=t.symbolInstances.get(pe),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:qe,crossTileID:Be,numIconVertices:et,tileAnchorX:rt,tileAnchorY:_t}=we;let Oe=null;const Qe=this.retainedQueryData[t.bucketInstanceId];ce&&we&&Qe&&(Oe=h.latestFeatureIndex.loadFeature({featureIndex:we.featureIndex,bucketIndex:Qe.bucketIndex,sourceLayerIndex:Qe.sourceLayerIndex,layoutVertexArrayOffset:0}));const De=oe.evaluate(Oe,{}),Je=s.has(Be);let Ze=this.opacities[Be];Je?Ze=B:Ze||(Ze=ge,this.opacities[Be]=Ze),s.add(Be);const st=Ee>0||qe>0,$e=et>0,lt=this.placedOrientations[Be],wt=lt===i.bq.vertical,Mt=lt===i.bq.horizontal||lt===i.bq.horizontalOnly;!st&&!$e||Ze.isHidden()||_e++;let Lt=!1;if((st||$e)&&x)for(const Wt of t.activeReplacements){if(i.bx(Wt,g,i.by.Symbol,P)||Wt.min.x>rt||rt>Wt.max.x||Wt.min.y>_t||_t>Wt.max.y)continue;const fr=i.bz(rt,_t,M.canonical,Wt.footprintTileId.canonical);if(Lt=i.bA(fr,Wt.footprint),Lt)break}if(st){const Wt=Lt?to:Om(Ze.text);fe(t.text,Ee,wt?to:Wt),fe(t.text,qe,Mt?to:Wt);const fr=Ze.text.isHidden(),{leftJustifiedTextSymbolIndex:nr,centerJustifiedTextSymbolIndex:pr,rightJustifiedTextSymbolIndex:ur,verticalPlacedTextSymbolIndex:Br}=we,nn=t.text.placedSymbolArray,hn=fr||wt?1:0;nr>=0&&(nn.get(nr).hidden=hn),pr>=0&&(nn.get(pr).hidden=hn),ur>=0&&(nn.get(ur).hidden=hn),Br>=0&&(nn.get(Br).hidden=fr||Mt?1:0);const Dr=this.variableOffsets[Be];Dr&&this.markUsedJustification(t,Dr.anchor,we,lt);const Pn=this.placedOrientations[Be];Pn&&(this.markUsedJustification(t,"left",we,Pn),this.markUsedOrientation(t,Pn,we))}if($e){const Wt=Lt?to:Om(Ze.icon),{placedIconSymbolIndex:fr,verticalPlacedIconSymbolIndex:nr}=we,pr=t.icon.placedSymbolArray,ur=Ze.icon.isHidden()?1:0;fr>=0&&(fe(t.icon,et,wt?to:Wt),pr.get(fr).hidden=ur),nr>=0&&(fe(t.icon,we.numVerticalIconVertices,Mt?to:Wt),pr.get(nr).hidden=ur)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Wt=t.collisionArrays[pe];if(Wt){let fr=new i.P(0,0),nr=!0;if(Wt.textBox||Wt.verticalTextBox){if(H){const ur=this.variableOffsets[Be];ur?(fr=zm(ur.anchor,ur.width,ur.height,ur.textOffset,ur.textScale),J&&fr._rotate(Q?this.transform.angle:-this.transform.angle)):nr=!1}F&&(nr=!Ze.clipped),Wt.textBox&&qu(t.textCollisionBox.collisionVertexArray,Ze.text.placed,!nr||wt,De,ue,fr.x,fr.y),Wt.verticalTextBox&&qu(t.textCollisionBox.collisionVertexArray,Ze.text.placed,!nr||Mt,De,ue,fr.x,fr.y)}const pr=nr&&!!(!Mt&&Wt.verticalIconBox);Wt.iconBox&&qu(t.iconCollisionBox.collisionVertexArray,Ze.icon.placed,pr,De,ue,we.hasIconTextFit?fr.x:0,we.hasIconTextFit?fr.y:0),Wt.verticalIconBox&&qu(t.iconCollisionBox.collisionVertexArray,Ze.icon.placed,!pr,De,ue,we.hasIconTextFit?fr.x:0,we.hasIconTextFit?fr.y:0)}}}if(t.fullyClipped=_e===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const pe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=pe.invProjMatrix,t.placementViewportMatrix=pe.viewportMatrix,t.collisionCircleArray=pe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function qu(d,t,s,h,m,g,x){d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0),d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0),d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0),d.emplaceBack(t?1:0,s?1:0,g||0,x||0,h,m?1:0)}const Hu=Math.pow(2,25),Lm=Math.pow(2,24),zc=Math.pow(2,17),Uy=Math.pow(2,16),jy=Math.pow(2,9),Lc=Math.pow(2,8),Oc=Math.pow(2,1);function Om(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const t=d.placed?1:0,s=Math.floor(127*d.opacity);return s*Hu+t*Lm+s*zc+t*Uy+s*jy+t*Lc+s*Oc+t}const to=0;class km{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,s,h,m,g,x){const M=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(M,m,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((P,z)=>P.sortKey-z.sortKey));this._currentPartIndex<M.length;){const P=M[this._currentPartIndex];if(s.placeLayerBucketPart(P,this._seenCrossTileIDs,h,P.symbolInstanceStart===0,x),this._currentPartIndex++,g())return!0}return!1}}class Wu{constructor(t,s,h,m,g,x,M,P,z){this.placement=new is(t,g,x,M,P,z),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(t,s,h,m,g){const x=i.q.now(),M=()=>{const P=i.q.now()-x;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=s[t[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=z)&&(!P.maxzoom||P.maxzoom>z)){const L=P,F=L.layout.get("symbol-z-elevate"),B=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,j=L.layout.get("symbol-z-order"),Z=j==="viewport-y"||j==="auto"&&!(j!=="viewport-y"&&B),H=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),J=Z&&H,Q=this._inProgressLayer=this._inProgressLayer||new km(L),oe=i.C(P.source,P.scope);if(Q.continuePlacement(F||J?m[oe]:h[oe],this.placement,this._showCollisionBoxes,P,M,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const So=512/i.ai/2;class $y{constructor(t,s,h){this.tileID=t,this.bucketInstanceId=h,this.index=new i.bE(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const m=t.canonical.x*i.ai,g=t.canonical.y*i.ai;for(let x=0;x<s.length;x++){const{key:M,crossTileID:P,tileAnchorX:z,tileAnchorY:L}=s.get(x),F=Math.floor((m+z)*So),B=Math.floor((g+L)*So);this.index.add(F,B),this.keys.push(M),this.crossTileIDs.push(P)}this.index.finish()}findMatches(t,s,h){const m=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),g=So/Math.pow(2,s.canonical.z-this.tileID.canonical.z),x=s.canonical.x*i.ai,M=s.canonical.y*i.ai;for(let P=0;P<t.length;P++){const z=t.get(P);if(z.crossTileID)continue;const{key:L,tileAnchorX:F,tileAnchorY:B}=z,j=Math.floor((x+F)*g),Z=Math.floor((M+B)*g),H=this.index.range(j-m,Z-m,j+m,Z+m);for(const J of H){const Q=this.crossTileIDs[J];if(this.keys[J]===L&&!h.has(Q)){h.add(Q),z.crossTileID=Q;break}}}}}class Gy{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qy{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const h in this.indexes){const m=this.indexes[h],g={};for(const x in m){const M=m[x];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+s),g[M.tileID.key]=M}this.indexes[h]=g}this.lng=t}addBucket(t,s,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const m=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const M in x){const P=x[M];P.tileID.isChildOf(t)&&P.findMatches(s.symbolInstances,t,m)}else{const M=x[t.scaledTo(Number(g)).key];M&&M.findMatches(s.symbolInstances,t,m)}}for(let g=0;g<s.symbolInstances.length;g++){const x=s.symbolInstances.get(g);x.crossTileID||(x.crossTileID=h.generate(),m.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new $y(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const h of s.crossTileIDs)this.usedCrossTileIDs[t].delete(h)}removeStaleBuckets(t){let s=!1;for(const h in this.indexes){const m=this.indexes[h];for(const g in m)t[m[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,m[g]),delete m[g],s=!0)}return s}}class Fm{constructor(){this.layerIndexes={},this.crossTileIDs=new Gy,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,h,m){let g=this.layerIndexes[t.fqid];g===void 0&&(g=this.layerIndexes[t.fqid]=new qy);let x=!1;const M={};m.name!=="globe"&&g.handleWrapJump(h);for(const P of s){const z=P.getBucket(t);z&&t.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(P.tileID,z,this.crossTileIDs)&&(x=!0),M[z.bucketInstanceId]=!0)}return g.removeStaleBuckets(M)&&(x=!0),x}pruneUnusedLayers(t){const s={};t.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}const Sl=771;class Rr{constructor(t,s,h,m){this.blendFunction=t,this.blendColor=s,this.mask=h,this.blendEquation=m}}Rr.Replace=[1,0,1,0],Rr.disabled=new Rr(Rr.Replace,i.al.transparent,[!1,!1,!1,!1]),Rr.unblended=new Rr(Rr.Replace,i.al.transparent,[!0,!0,!0,!0]),Rr.alphaBlended=new Rr([1,Sl,1,Sl],i.al.transparent,[!0,!0,!0,!0]),Rr.alphaBlendedNonPremultiplied=new Rr([770,Sl,770,Sl],i.al.transparent,[!0,!0,!0,!0]),Rr.multiply=new Rr([774,0,774,0],i.al.transparent,[!0,!0,!0,!0]);class Xt{constructor(t,s,h){this.func=t,this.mask=s,this.range=h}}Xt.ReadOnly=!1,Xt.ReadWrite=!0,Xt.disabled=new Xt(519,Xt.ReadOnly,[0,1]);const Zu=7680;class br{constructor(t,s,h,m,g,x){this.test=t,this.ref=s,this.mask=h,this.fail=m,this.depthFail=g,this.pass=x}}br.disabled=new br({func:519,mask:0},0,0,Zu,Zu,Zu);const Xu=1029,jo=2305;class dr{constructor(t,s,h){this.enable=t,this.mode=s,this.frontFace=h}}function $d(d,t){const s=i.bG(d,3);i.ad.mat4.fromQuat(d,t),i.bI(d,3,s)}function Ku(d,t){const s=i.ad.quat.identity([]);return i.ad.quat.rotateZ(s,s,-t),i.ad.quat.rotateX(s,s,-d),s}function El(d,t){const s=[d[0],d[1],0],h=[t[0],t[1],0];if(i.ad.vec3.length(s)>=1e-15){const x=i.ad.vec3.normalize([],s);i.ad.vec3.scale(h,x,i.ad.vec3.dot(h,x)),t[0]=h[0],t[1]=h[1]}const m=i.ad.vec3.cross([],t,d);if(i.ad.vec3.len(m)<1e-15)return null;const g=Math.atan2(-m[1],m[0]);return Ku(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),g)}dr.disabled=new dr(!1,Xu,jo),dr.backCCW=new dr(!0,Xu,jo),dr.backCW=new dr(!0,Xu,2304),dr.frontCW=new dr(!0,1028,2304),dr.frontCCW=new dr(!0,1028,jo);class Al{constructor(t,s){this.position=t,this.orientation=s}get position(){return this._position}set position(t){if(t){const s=t instanceof i.ac?t:new i.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(s.x=i.bF(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(t,s){if(this.orientation=null,!this.position)return;const h=this.position,m=this._elevation?this._elevation.getAtPointOrZero(i.ac.fromLngLat(t)):0,g=i.ac.fromLngLat(t,m),x=[g.x-h.x,g.y-h.y,g.z-h.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=El(x,s)}setPitchBearing(t,s){this.orientation=Ku(i.ak(t),i.ak(-s))}}class kc{constructor(t,s){this._transform=i.ad.mat4.identity([]),this.orientation=s,this.position=t}get mercatorPosition(){const t=this.position;return new i.ac(t[0],t[1],t[2])}get position(){const t=i.bG(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var s;t&&i.bI(this._transform,3,[(s=t)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||i.ad.quat.identity([]),t&&$d(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,s){this._orientation=Ku(t,s),$d(this._transform,this._orientation)}forward(){const t=i.bG(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=i.bG(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=i.bG(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,s){const h=new Float64Array(16);return i.ad.mat4.invert(h,this.getWorldToCamera(t,s)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,s,h){const m=this.position;i.ad.vec3.scale(m,m,-t);const g=new Float64Array(16);return i.ad.mat4.fromScaling(g,[h,h,h]),i.ad.mat4.translate(g,g,m),g[10]*=s,g}getWorldToCamera(t,s){const h=new Float64Array(16),m=new Float64Array(4),g=this.position;return i.ad.quat.conjugate(m,this._orientation),i.ad.vec3.scale(g,g,-t),i.ad.mat4.fromQuat(h,m),i.ad.mat4.translate(h,h,g),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(t,s,h,m){const g=new Float64Array(16);return i.ad.mat4.perspective(g,t,s,h,m),g}getCameraToClipOrthographic(t,s,h,m,g,x){const M=new Float64Array(16);return i.ad.mat4.ortho(M,t,s,h,m,g,x),M}getDistanceToElevation(t,s=!1){const h=t===0?0:i.bH(t,s?i.aT(this.position[1]):this.position[1]),m=this.forward();return(h-this.position[2])/m[2]}clone(){return new kc([...this.position],[...this.orientation])}}const Ri={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class ss{constructor(t=0,s=0,h=0,m=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=h,this.right=m}interpolate(t,s,h){return s.top!=null&&t.top!=null&&(this.top=i.ah(t.top,s.top,h)),s.bottom!=null&&t.bottom!=null&&(this.bottom=i.ah(t.bottom,s.bottom,h)),s.left!=null&&t.left!=null&&(this.left=i.ah(t.left,s.left,h)),s.right!=null&&t.right!=null&&(this.right=i.ah(t.right,s.right,h)),this}getCenter(t,s){const h=i.ay((this.left+t-this.right)/2,0,t),m=i.ay((this.top+s-this.bottom)/2,0,s);return new i.P(h,m)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ss(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const $o=15;class Ct{constructor(t,s,h,m,g,x,M){this.tileSize=512,this._renderWorldCopies=g===void 0||g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=h??0,this._maxPitch=m??60,this.setProjection(x),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new i.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ss,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new kc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Ct(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<$o}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,s=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(t||h)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return i.aA(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=i.bP(this.projectionOptions);const h=this.getProjection(),m=!i.bn(s,h);return m&&this._calcMatrices(),this.mercatorFromTransition=!1,m}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=i.bP({name:"mercator"});const s=t!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return i.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new i.P(this.width,this.height)}get bearing(){return i.bF(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const s=-t*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=i.ad.mat2.create(),i.ad.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=i.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=i.ak(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let m=0,g=0;for(let x=0;x<s.length;x++){const M=new i.P(s[x][0]*this.width,h+s[x][1]*(this.height-h)),P=t.pointCoordinate(M);if(!P)continue;const z=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);m+=P[3]*z,g+=z}return g===0?NaN:m/g}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,m=this._mercatorZfromZoom(t),g=this._mercatorZfromZoom(this._maxZoom),x=Math.max(m-h,g);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let h;h=t.z<this._camera.position[2]?[s.x,s.y,s.z]:[t.x,t.y,t.z];const m=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,h));return i.ay(this._zoomFromMercatorZ(m),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let s=!1;if(t.orientation&&!i.ad.quat.exactEquals(t.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(t.orientation)),t.position){const h=[t.position.x,t.position.y,t.position.z];i.ad.vec3.exactEquals(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,s=new Al;return s.position=new i.ac(t[0],t[1],t[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(t){if(!i.ad.quat.length(t))return!1;i.ad.quat.normalize(t,t);const s=i.ad.vec3.transformQuat([],[0,0,-1],t),h=i.ad.vec3.transformQuat([],[0,-1,0],t);if(h[2]<0)return!1;const m=El(s,h);return!!m&&(this._camera.orientation=m,!0)}_setCameraPosition(t){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,m=this.cameraToCenterDistance;t[2]=i.ay(t[2],m/h,m/s),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,h){this._unmodified=!1,this._edgeInsets.interpolate(t,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new i.bQ(0,t)];if(this.renderWorldCopies){const h=this.pointCoordinate(new i.P(0,0)),m=this.pointCoordinate(new i.P(this.width,0)),g=this.pointCoordinate(new i.P(this.width,this.height)),x=this.pointCoordinate(new i.P(0,this.height)),M=Math.floor(Math.min(h.x,m.x,g.x,x.x)),P=Math.floor(Math.max(h.x,m.x,g.x,x.x)),z=1;for(let L=M-z;L<=P+z;L++)L!==0&&s.push(new i.bQ(L,t))}return s}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,s,h){let m=[];const g=h!==void 0,x=!g;if(x&&this.zoom<s||g&&h[0]===0&&h[1]===0)return m;const M=new Set,P=(L,F,B,j,Z)=>{const H=i.c5(F,L,B,j,Z);M.has(H)||(m.push(new i.aH(L,F,B,j,Z)),M.add(H))};for(let L=0;L<t.length;L++){const F=t[L];if(x&&F.canonical.z!==s)continue;const B=F.canonical,j=F.overscaledZ,Z=F.wrap,H=1<<B.z,J=B.x+1<H,Q=B.x>0,oe=B.y+1<H,ue=B.y>0,ce=F.wrap-(Q?0:1),ge=F.wrap+(J?0:1),fe=Q?B.x-1:H-1,_e=J?B.x+1:0;if(g)h[0]<0?(P(j,ge,B.z,_e,B.y),h[1]<0&&oe&&(P(j,Z,B.z,B.x,B.y+1),P(j,ge,B.z,_e,B.y+1)),h[1]>0&&ue&&(P(j,Z,B.z,B.x,B.y-1),P(j,ge,B.z,_e,B.y-1))):h[0]>0?(P(j,ce,B.z,fe,B.y),h[1]<0&&oe&&(P(j,Z,B.z,B.x,B.y+1),P(j,ce,B.z,fe,B.y+1)),h[1]>0&&ue&&(P(j,Z,B.z,B.x,B.y-1),P(j,ce,B.z,fe,B.y-1))):h[1]<0&&oe?P(j,Z,B.z,B.x,B.y+1):ue&&P(j,Z,B.z,B.x,B.y-1);else{const pe=F.visibleQuadrants;1&pe&&(P(j,ce,B.z,fe,B.y),ue&&(P(j,Z,B.z,B.x,B.y-1),P(j,ce,B.z,fe,B.y-1))),2&pe&&(P(j,ge,B.z,_e,B.y),ue&&(P(j,Z,B.z,B.x,B.y-1),P(j,ge,B.z,_e,B.y-1))),4&pe&&(P(j,ce,B.z,fe,B.y),oe&&(P(j,Z,B.z,B.x,B.y+1),P(j,ce,B.z,fe,B.y+1))),8&pe&&(P(j,ge,B.z,_e,B.y),oe&&(P(j,Z,B.z,B.x,B.y+1),P(j,ge,B.z,_e,B.y+1)))}}const z=[];for(const L of m)m.some(F=>L.isChildOf(F))||z.push(L);if(m=z.filter(L=>!t.some(F=>!!(L.overscaledZ<s&&F.isChildOf(L))||L.equals(F)||L.isChildOf(F))),x){const L=1<<s,F=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[L*F.x,L*F.y],j=4,Z=j*j;m=m.filter(H=>{const J=H.canonical.x+.5-B[0],Q=H.canonical.y+.5-B[1];return J*J+Q*Q<Z})}return m}coveringTiles(t){let s=this.coveringZoomLevel(t);const h=s,m=this.elevation&&this.elevation.exaggeration(),g=m&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&s<t.minzoom)return[];t.maxzoom!==void 0&&s>t.maxzoom&&(s=t.maxzoom);const M=this.locationCoordinate(this.center),P=this.center.lat,z=1<<s,L=[z*M.x,z*M.y,0],F=this.projection.name==="globe",B=!F,j=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,B),Z=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),H=z*i.bH(1,this.center.lat),J=this._camera.position[2]/i.bH(1,this.center.lat),Q=[z*Z.x,z*Z.y,J*(B?1:H)],oe=F||m,ue=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ce=this.isLODDisabled(!0)?s:0;let ge;if(this._elevation&&t.isTerrainDEM)ge=1e4*this._elevation.exaggeration();else if(this._elevation){const De=this._elevation.getMinMaxForVisibleTiles();ge=De?De.max:this._centerAltitude}else ge=this._centerAltitude;const fe=t.isTerrainDEM?-ge:this._elevation?this._elevation.getMinElevationBelowMSL():0,_e=this.projection.isReprojectedInTileSpace?i.bS(this):1,pe=De=>{const Ze=new i.ac(De.x+25e-6,De.y,De.z),st=new i.ac(De.x,De.y+25e-6,De.z),$e=De.toLngLat(),lt=Ze.toLngLat(),wt=st.toLngLat(),Mt=this.locationCoordinate($e),Lt=this.locationCoordinate(lt),Wt=this.locationCoordinate(wt),fr=Math.hypot(Lt.x-Mt.x,Lt.y-Mt.y),nr=Math.hypot(Wt.x-Mt.x,Wt.y-Mt.y);return Math.sqrt(fr*nr)*_e/25e-6},we=De=>{const Je=ge,Ze=fe;return{aabb:i.bV(this,z,0,0,0,De,Ze,Je,this.projection),zoom:0,x:0,y:0,minZ:Ze,maxZ:Je,wrap:De,fullyVisible:!1}},Ee=[];let qe=[];const Be=s,et=t.reparseOverscaled?h:s,rt=(J-this._centerAltitude)*H,_t=De=>{if(!this._elevation||!De.tileID||!x)return;const Je=this._elevation.getMinMaxForTile(De.tileID),Ze=De.aabb;Je?(Ze.min[2]=Je.min,Ze.max[2]=Je.max,Ze.center[2]=(Ze.min[2]+Ze.max[2])/2):(De.shouldSplit=Qe(De),De.shouldSplit||(Ze.min[2]=Ze.max[2]=Ze.center[2]=this._centerAltitude))},Oe=(De,Je)=>{if(.707*Je<De)return 1;const Ze=Je/De;return Ze/(1.4144271570014144+(Math.pow(1.1,Ze-1.4144271570014144+1)-1)/(1.1-1)-1)},Qe=De=>{if(De.zoom<ce)return!0;if(De.zoom===Be)return!1;if(De.shouldSplit!=null)return De.shouldSplit;const Je=De.aabb.distanceX(Q),Ze=De.aabb.distanceY(Q);let st=rt,$e=1;if(F){st=De.aabb.distanceZ(Q);const nr=Math.pow(2,De.zoom),pr=i.aT((De.y+1)/nr),ur=i.aT(De.y/nr),Br=Math.min(Math.max(P,pr),ur),nn=i.ca(Br)/i.ca(P);if($e=Br===P?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,nn/this._mercatorScaleRatio),this.zoom<=i.c6&&De.zoom===Be-1&&nn>=.9)return!0}else if(g&&(st=De.aabb.distanceZ(Q)*H),this.projection.isReprojectedInTileSpace&&h<=5){const nr=Math.pow(2,De.zoom),pr=pe(new i.ac((De.x+.5)/nr,(De.y+.5)/nr));$e=pr>.85?1:pr}if(!x){const nr=Math.sqrt(Je*Je+Ze*Ze+st*st);let pr=(1<<Be-De.zoom)*ue*$e;return pr*=Oe(Math.max(st,rt),nr),nr<pr}let lt=Number.MAX_VALUE,wt=0;const Mt=De.aabb.getCorners(),Lt=[];for(const nr of Mt){i.ad.vec3.sub(Lt,nr,Q),F||(g?Lt[2]*=H:Lt[2]=rt);const pr=i.ad.vec3.dot(Lt,this._camera.forward());pr<lt&&(lt=pr,wt=Math.abs(Lt[2]))}let Wt=(1<<Be-De.zoom)*ue*$e;if(Wt*=Oe(Math.max(wt,rt),lt),lt<Wt)return!0;const fr=De.aabb.closestPoint(L);return fr[0]===L[0]&&fr[1]===L[1]};if(this.renderWorldCopies)for(let De=1;De<=3;De++)Ee.push(we(-De)),Ee.push(we(De));for(Ee.push(we(0));Ee.length>0;){const De=Ee.pop(),Je=De.x,Ze=De.y;let st=De.fullyVisible;const $e=()=>this.projection.name==="globe"&&(De.y===0||De.y===(1<<De.zoom)-1);if(!st){let lt=oe?De.aabb.intersects(j):De.aabb.intersectsFlat(j);if(lt===0&&$e()){const wt=new i.bT(De.zoom,Je,Ze);lt=i.bU(this,z,wt,!0).intersects(j)}if(lt===0)continue;st=lt===2}if(De.zoom!==Be&&Qe(De))for(let lt=0;lt<4;lt++){const wt=(Je<<1)+lt%2,Mt=(Ze<<1)+(lt>>1),Lt={aabb:x?De.aabb.quadrant(lt):i.bV(this,z,De.zoom+1,wt,Mt,De.wrap,De.minZ,De.maxZ,this.projection),zoom:De.zoom+1,x:wt,y:Mt,wrap:De.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:De.minZ,maxZ:De.maxZ};g&&!F&&(Lt.tileID=new i.aH(De.zoom+1===Be?et:De.zoom+1,De.wrap,De.zoom+1,wt,Mt),_t(Lt)),Ee.push(Lt)}else{const lt=De.zoom===Be?et:De.zoom;if(t.minzoom&&t.minzoom>lt)continue;let wt=0;if(!st){let fr=oe?De.aabb.intersectsPrecise(j):De.aabb.intersectsPreciseFlat(j);if(fr===0&&$e()){const nr=new i.bT(De.zoom,Je,Ze);fr=i.bU(this,z,nr,!0).intersectsPrecise(j)}if(fr===0)continue;if(t.calculateQuadrantVisibility)if(j.containsPoint(De.aabb.center))wt=15;else for(let nr=0;nr<4;nr++)De.aabb.quadrant(nr).intersects(j)!==0&&(wt|=1<<nr)}const Mt=L[0]-(.5+Je+(De.wrap<<De.zoom))*(1<<s-De.zoom),Lt=L[1]-.5-Ze,Wt=De.tileID?De.tileID:new i.aH(lt,De.wrap,De.zoom,Je,Ze);t.calculateQuadrantVisibility&&(Wt.visibleQuadrants=wt),qe.push({tileID:Wt,distanceSq:Mt*Mt+Lt*Lt})}}if(this.fogCullDistSq){const De=this.fogCullDistSq,Je=this.horizonLineFromTop();qe=qe.filter(Ze=>{const st=[0,0,0,1],$e=[i.ai,i.ai,0,1],lt=this.calculateFogTileMatrix(Ze.tileID.toUnwrapped());i.ad.vec4.transformMat4(st,st,lt),i.ad.vec4.transformMat4($e,$e,lt);const wt=i.ad.vec4.min([],st,$e),Mt=i.ad.vec4.max([],st,$e),Lt=i.bW(wt,Mt);if(Lt===0)return!0;let Wt=!1;const fr=this._elevation;if(fr&&Lt>De&&Je!==0){const nr=this.calculateProjMatrix(Ze.tileID.toUnwrapped());let pr;t.isTerrainDEM||(pr=fr.getMinMaxForTile(Ze.tileID)),pr||(pr={min:fe,max:ge});const ur=i.c7(this.rotation),Br=[ur[0]*i.ai,ur[1]*i.ai,pr.max];i.ad.vec3.transformMat4(Br,Br,nr),Wt=(1-Br[1])*this.height*.5<Je}return Lt<De||Wt})}return qe.sort((De,Je)=>De.distanceSq-Je.distanceSq).map(De=>De.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=i.ay(t.lat,-i.bX,i.bX),h=this.projection.project(t.lng,s);return new i.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/i.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,s){let h,m;const g=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;h=(s.x-g.x)/M,m=(s.y-g.y)/M}else{const M=this.pointCoordinate(s),P=this.pointCoordinate(g);h=M.x-P.x,m=M.y-P.y}const x=this.locationCoordinate(t);this.setLocation(new i.ac(x.x-h,x.y-m))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,s){return this.projection.locationPoint(this,t,s)}locationPoint3D(t,s){return this.projection.locationPoint(this,t,s,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,s){return this.coordinateLocation(this.pointCoordinate3D(t,s))}locationCoordinate(t,s){const h=s?i.bH(s,t.lat):void 0,m=this.projection.project(t.lng,t.lat);return new i.ac(m.x,m.y,h)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,s){const h=s??this._centerAltitude,m=[t.x,t.y,0,1],g=[t.x,t.y,1,1];i.ad.vec4.transformMat4(m,m,this.pixelMatrixInverse),i.ad.vec4.transformMat4(g,g,this.pixelMatrixInverse);const x=g[3];i.ad.vec4.scale(m,m,1/m[3]),i.ad.vec4.scale(g,g,1/x);const M=m[2],P=g[2];return{p0:m,p1:g,t:M===P?0:(h-M)/(P-M)}}screenPointToMercatorRay(t){const s=[t.x,t.y,0,1],h=[t.x,t.y,1,1];return i.ad.vec4.transformMat4(s,s,this.pixelMatrixInverse),i.ad.vec4.transformMat4(h,h,this.pixelMatrixInverse),i.ad.vec4.scale(s,s,1/s[3]),i.ad.vec4.scale(h,h,1/h[3]),s[2]=i.bH(s[2],this._center.lat)*this.worldSize,h[2]=i.bH(h[2],this._center.lat)*this.worldSize,i.ad.vec4.scale(s,s,1/this.worldSize),i.ad.vec4.scale(h,h,1/this.worldSize),new i.as([s[0],s[1],s[2]],i.ad.vec3.normalize([],i.ad.vec3.sub([],h,s)))}rayIntersectionCoordinate(t){const{p0:s,p1:h,t:m}=t,g=i.bH(s[2],this._center.lat),x=i.bH(h[2],this._center.lat);return new i.ac(i.ah(s[0],h[0],m)/this.worldSize,i.ah(s[1],h[1],m)/this.worldSize,i.ah(g,x,m))}pointCoordinate(t,s=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,s)}pointCoordinate3D(t,s){if(!this.elevation)return this.pointCoordinate(t,s);let h=this.projection.pointCoordinate3D(this,t.x,t.y);if(h)return new i.ac(h[0],h[1],h[2]);let m=0,g=this.horizonLineFromTop();if(t.y>g)return this.pointCoordinate(t,s);const x=.02*g,M=t.clone();for(let P=0;P<10&&g-m>x;P++){M.y=i.ah(m,g,.66);const z=this.projection.pointCoordinate3D(this,M.x,M.y);z?(g=M.y,h=z):m=M.y}return h?new i.ac(h[0],h[1],h[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=i.bY)return!this.isPointAboveHorizon(t);const s=this.pointCoordinate(t);return s.y>=0&&s.y<=1}_coordinatePoint(t,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,m=[t.x*this.worldSize,t.y*this.worldSize,h+t.toAltitude(),1];return i.ad.vec4.transformMat4(m,m,this.pixelMatrix),m[3]>0?new i.P(m[0]/m[3],m[1]/m[3]):new i.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:s}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,m=this.width-this._edgeInsets.right,g=this.pointLocation3D(new i.P(s,t)),x=this.pointLocation3D(new i.P(m,t)),M=this.pointLocation3D(new i.P(m,h)),P=this.pointLocation3D(new i.P(s,h));let z=Math.min(g.lng,x.lng,M.lng,P.lng),L=Math.max(g.lng,x.lng,M.lng,P.lng),F=Math.min(g.lat,x.lat,M.lat,P.lat),B=Math.max(g.lat,x.lat,M.lat,P.lat);const j=Math.pow(2,-this.zoom)/16*270,Z=this.projection.name==="globe"?1:4,H=(J,Q,oe,ue,ce)=>{const ge=(J+oe)/2,fe=(Q+ue)/2,_e=new i.P(ge,fe),{lng:pe,lat:we}=this.pointLocation3D(_e),Ee=Math.max(0,z-pe,F-we,pe-L,we-B);z=Math.min(z,pe),L=Math.max(L,pe),F=Math.min(F,we),B=Math.max(B,we),(ce<Z||Ee>j)&&(H(J,Q,ge,fe,ce+1),H(ge,fe,oe,ue,ce+1))};if(H(s,t,m,t,1),H(m,t,m,h,1),H(m,h,s,h,1),H(s,h,s,t,1),this.projection.name==="globe"){const[J,Q]=i.bZ(this);J?(B=90,L=180,z=-180):Q&&(F=-90,L=180,z=-180)}return new i.aB(new i.bO(z,F),new i.bO(L,B))}_getBoundsRectangular(t,s){const{top:h,left:m}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,M=new i.P(m,h),P=new i.P(x,h),z=new i.P(x,g),L=new i.P(m,g);let F=this.pointCoordinate(M,t),B=this.pointCoordinate(P,t);const j=this.pointCoordinate(z,s),Z=this.pointCoordinate(L,s),H=(J,Q)=>(Q.y-J.y)/(Q.x-J.x);return F.y>1&&B.y>=0?F=new i.ac((1-Z.y)/H(Z,F)+Z.x,1):F.y<0&&B.y<=1&&(F=new i.ac(-Z.y/H(Z,F)+Z.x,0)),B.y>1&&F.y>=0?B=new i.ac((1-j.y)/H(j,B)+j.x,1):B.y<0&&F.y<=1&&(B=new i.ac(-j.y/H(j,B)+j.x,0)),new i.aB().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=t.visibleDemTiles.reduce((h,m)=>{if(m.dem){const g=m.dem.tree;h.min=Math.min(h.min,g.minimums[0]),h.max=Math.max(h.max,g.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*t.exaggeration(),s.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return t?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-i.bX,this.maxLat=i.bX,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=i.av(this.minLng)*this.tileSize,this.worldMaxX=i.av(this.maxLng)*this.tileSize,this.worldMinY=i.aC(this.maxLat)*this.tileSize,this.worldMaxY=i.aC(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,s){return this.projection.createTileMatrix(this,s,t)}calculateDistanceTileData(t){const s=t.key,h=this._distanceTileDataCache;if(h[s])return h[s];const m=t.canonical,g=1/this.height,x=this.cameraWorldSize,M=x/this.zoomScale(m.z),P=(m.x+Math.pow(2,m.z)*t.wrap)*M,z=m.y*M,L=this.point;L.x*=x/this.worldSize,L.y*=x/this.worldSize;const F=this.angle,B=Math.sin(-F),j=-Math.cos(-F);return h[s]={bearing:[B,j],center:[(L.x-P)*g,(L.y-z)*g],scale:M/i.ai*g},h[s]}calculateFogTileMatrix(t){const s=t.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const m=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return i.ad.mat4.multiply(m,this.worldToFogMatrix,m),h[s]=new Float32Array(m),h[s]}calculateProjMatrix(t,s=!1,h=!1){const m=t.key;let g;if(g=h?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,g[m])return g[m];const x=this.calculatePosMatrix(t,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,i.ad.mat4.multiply(x,M,x),g[m]=new Float32Array(x),g[m]}calculatePixelsToTileUnitsMatrix(t){const s=t.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const m=i.b_(t,this);return h[s]=m,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,s=i.ad.mat4.fromScaling([],[t,t,t]);return i.ad.mat4.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const s=i.bH(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),m=this._camera.forward(),g=i.bH(1,this._center.lat);h[2]/=g,m[2]/=g,i.ad.vec3.normalize(m,m);const x=t.raycast(h,m,t.exaggeration());if(x){const M=i.ad.vec3.scaleAndAdd([],h,m,x),P=new i.ac(M[0],M[1],i.bH(M[2],i.aT(M[1]))),z=(P.z+i.ad.vec3.length([P.x-h[0],P.y-h[1],P.z-h[2]*g]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const s=this._elevation,h=i.bH(1,this._center.lat)*this.worldSize,m=this._computeCameraPosition(h),g=s.getAtPointOrZero(new i.ac(...m)),x=this.pixelsPerMeter/this.worldSize*g,M=this._minimumHeightOverTerrain(),P=m[2]-x;if(P<=M)if(P<0||t){const z=this.locationCoordinate(this._center,this._centerAltitude),L=[m[0],m[1],z.z-m[2]],F=i.ad.vec3.length(L);L[2]-=(M-P)/this._pixelsPerMercatorPixel;const B=i.ad.vec3.length(L);if(B===0)return;i.ad.vec3.scale(L,L,F/B*this._pixelsPerMercatorPixel),this._camera.position=[m[0],m[1],z.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const B=this.center;return B.lat=i.ay(B.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(B.lng=i.ay(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:m}=this.point;let g=0,x=h,M=m;const P=this.width/2,z=this.height/2,L=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(m-z<L&&(M=L+z),m+z>F&&(M=F-z),F-L<this.height&&(g=Math.max(g,this.height/(F-L)),M=(F+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,Z=this.worldSize/2-(B+j)/2;x=(h+Z+this.worldSize)%this.worldSize-Z,x-P<B&&(x=B+P),x+P>j&&(x=j-P),j-B<this.width&&(g=Math.max(g,this.width/(j-B)),x=(j+B)/2)}x===h&&M===m||this._allowWorldUnderZoom||(this.center=this.unproject(new i.P(x,M))),g&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(g)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=i.bH(1,this.center.lat)/i.bH(1,i.c8));const m=i.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,m),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const g=this.projection.zAxisUnit==="meters"?h:1,x=this._camera.getWorldToCamera(this.worldSize,g);let M;const P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(P[8]=2*-t.x/this.width,P[9]=2*t.y/this.height,this.isOrthographic){let we=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ee=we*this.aspect,qe=-Ee,Be=-we;Ee-=t.x,qe-=t.x,we+=t.y,Be+=t.y,M=this._camera.getCameraToClipOrthographic(qe,Ee,Be,we,this._nearZ,this._farZ),((et,rt,_t,Oe)=>{for(let Qe=0;Qe<16;Qe++)et[Qe]=i.ah(rt[Qe],_t[Qe],Oe)})(M,M,P,i.c9(this.pitch>=$o?1:this.pitch/$o))}else M=P;const z=i.ad.mat4.mul([],P,x);let L=i.ad.mat4.mul([],M,x);if(this.projection.isReprojectedInTileSpace){const we=this.locationCoordinate(this.center),Ee=i.ad.mat4.identity([]);i.ad.mat4.translate(Ee,Ee,[we.x*this.worldSize,we.y*this.worldSize,0]),i.ad.mat4.multiply(Ee,Ee,i.c0(this)),i.ad.mat4.translate(Ee,Ee,[-we.x*this.worldSize,-we.y*this.worldSize,0]),i.ad.mat4.multiply(L,L,Ee),i.ad.mat4.multiply(z,z,Ee),this.inverseAdjustmentMatrix=i.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=i.ad.mat4.scale([],L,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=L,this.invProjMatrix=i.ad.mat4.invert(new Float64Array(16),this.projMatrix),s){const we=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);we[8]=2*-t.x/this.width,we[9]=2*t.y/this.height,this.expandedFarZProjMatrix=i.ad.mat4.mul([],we,x)}else this.expandedFarZProjMatrix=this.projMatrix;const F=i.ad.mat4.invert([],M);this.frustumCorners=i.c2.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const B=new Float32Array(16);i.ad.mat4.identity(B),i.ad.mat4.scale(B,B,[1,-1,1]),i.ad.mat4.rotateX(B,B,this._pitch),i.ad.mat4.rotateZ(B,B,this.angle);const j=i.ad.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=i.ad.mat4.clone(j);const Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-t.x/this.width,j[9]=2*(t.y+Z)/this.height,this.skyboxMatrix=i.ad.mat4.multiply(B,j,B);const H=this.point,J=H.x,Q=H.y,oe=this.width%2/2,ue=this.height%2/2,ce=Math.cos(this.angle),ge=Math.sin(this.angle),fe=J-Math.round(J)+ce*oe+ge*ue,_e=Q-Math.round(Q)+ce*ue+ge*oe,pe=new Float64Array(L);if(i.ad.mat4.translate(pe,pe,[fe>.5?fe-1:fe,_e>.5?_e-1:_e,0]),this.alignedProjMatrix=pe,L=i.ad.mat4.create(),i.ad.mat4.scale(L,L,[this.width/2,-this.height/2,1]),i.ad.mat4.translate(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=i.ad.mat4.create(),i.ad.mat4.scale(L,L,[1,-1,1]),i.ad.mat4.translate(L,L,[-1,-1,0]),i.ad.mat4.scale(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=i.ad.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},L=i.ad.mat4.invert(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=i.c3(this);const we=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=i.ad.vec3.transformMat4(we,we,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,h=this._camera.position,m=1/this.height/this._pixelsPerMercatorPixel,g=[t,t,s];i.ad.vec3.scale(g,g,m),i.ad.vec3.scale(h,h,-1),i.ad.vec3.multiply(h,h,g);const x=i.ad.mat4.create();i.ad.mat4.translate(x,x,h),i.ad.mat4.scale(x,x,g),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,s,m)}_computeCameraPosition(t){const s=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),m=this.point,g=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-t/this.worldSize*this._centerAltitude;return[m.x/this.worldSize-h[0]*g,m.y/this.worldSize-h[1]*g,t/this.worldSize*this._centerAltitude-h[2]*g]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],m=t[2];let g=1;this.projection.wrap&&(this.center=this.center.wrap()),m>0&&(g=Math.min((s-h)/m,1)),this._camera.position=i.ad.vec3.scaleAndAdd([],this._camera.position,t,g),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:m}=this._camera.getPitchBearing(),g=i.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(i.ak(this._maxPitch)),M=Math.max((t[2]-g)/Math.cos(h),x),P=this._zoomFromMercatorZ(M);i.ad.vec3.scaleAndAdd(t,t,s,M),this._pitch=i.ay(h,i.ak(this.minPitch),i.ak(this.maxPitch)),this.angle=i.bF(m,-Math.PI,Math.PI),this._setZoom(i.ay(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new i.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}zoomFromMercatorZAdjusted(t){let s=0,h=i.bY,m=0,g=1/0;for(;h-s>1e-6&&h>s;){const x=s+.5*(h-s),M=this.tileSize*Math.pow(2,x),P=this.getCameraToCenterDistance(this.projection,x,M),z=this.scaleZoom(P/(t*this.tileSize)),L=Math.abs(x-z);L<g&&(g=L,m=x),x<z?s=x:h=x}return m}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(i.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,s){const h=Math.min(t.x,s.x),m=Math.max(t.x,s.x),g=Math.min(t.y,s.y),x=Math.max(t.y,s.y);if(g<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new i.P(h,g),new i.P(m,x),new i.P(h,x),new i.P(m,g)],P=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const L of M){const F=this.pointRayIntersection(L);if(F.t<0)return!0;const B=this.rayIntersectionCoordinate(F);if(B.x<P||B.y<0||B.x>z||B.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+i.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new i.P(0,0),new i.P(this.width,this.height))}zoomDeltaToMovement(t,s){const h=i.ad.vec3.length(i.ad.vec3.sub([],this._camera.position,t)),m=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(m)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([s,h,m],g){const x=[s,h,m,1];i.ad.vec4.transformMat4(x,x,g);const M=x[3]=Math.max(x[3],1e-6);return x[0]/=M,x[1]/=M,x[2]/=M,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new i.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new i.P(0,t))}}getCameraToCenterDistance(t,s=this.zoom,h=this.worldSize){const m=i.b$(t,s,this.width,this.height,1024),g=t.pixelSpaceConversion(this.center.lat,h,m);let x=.5/Math.tan(.5*this._fov)*this.height*g;return this.isOrthographic&&(x=i.ah(1,x,i.c9(this.pitch>=$o?1:this.pitch/$o))),x}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&i.ad.mat4.multiply(t,t,this.globeMatrix),t}getFrustum(t){return i.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const _a=(d,t)=>{if(t>0&&d.terrain&&i.w("Cutoff is currently disabled on terrain"),t<=0||d.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=d.transform,h=Math.max(Math.abs(s._zoom-(d.minCutoffZoom-1)),1),m=s.isLODDisabled(!1)?i.ae(60,45,s.pitch):i.ae(30,15,s.pitch),g=s._farZ-s._nearZ,x=t*s.height,M=((1-(P=m))*s.cameraToCenterDistance+P*(s._farZ+x))*h;var P;return{shouldRenderCutoff:m<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(M-s._nearZ)/g,(M-x-s._nearZ)/g]}}},Di={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Gd{constructor(t,s){this.aabb=t,this.lastCascade=s}}class Bm{add(t,s){const h=this.receivers[t.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],s.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],s.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],s.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],s.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],s.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],s.max[2])):this.receivers[t.key]=new Gd(s,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,s,h){const m=i.ce.fromPoints(t.points);let g=0;for(const x in this.receivers){const M=this.receivers[x];if(!M||!m.intersectsAabb(M.aabb))continue;M.aabb.min=m.closestPoint(M.aabb.min),M.aabb.max=m.closestPoint(M.aabb.max);const P=M.aabb.getCorners();for(let z=0;z<h.length;z++){let L=!0;for(const F of P){const B=[F[0]*s,F[1]*s,F[2]];if(i.ad.vec3.transformMat4(B,B,h[z].matrix),B[0]<-1||B[0]>1||B[1]<-1||B[1]>1){L=!1;break}}if(M.lastCascade=z,g=Math.max(g,z),L)break}}return g+1}}class Yu{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Bm,this._depthMode=new Xt(t.context.gl.LEQUAL,Xt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Di,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Di,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Di,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,s){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const m=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||m<=0||(this._shadowLayerCount=h.style.order.reduce((Z,H)=>{const J=h.style._mergedLayers[H];return Z+(J.hasShadowPass()&&!J.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const g=h.context,x=Di.shadowMapResolution,M=Di.shadowMapResolution;if(this._cascades.length===0||Di.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Z=0;Z<Di.cascadeCount;++Z){const H=h._shadowMapDebug,J=g.gl,Q=g.createFramebuffer(x,M,H,"texture"),oe=new i.T(g,{width:x,height:M,data:null},J.DEPTH_COMPONENT16);if(Q.depthAttachment.set(oe.texture),H){const ue=new i.T(g,{width:x,height:M,data:null},J.RGBA8);Q.colorAttachment.set(ue.texture)}this._cascades.push({framebuffer:Q,texture:oe,matrix:[],far:0,boundingSphereRadius:0,frustum:new i.bR,scale:0})}}this.shadowDirection=Ju(s);let P=0;if(t.elevation){const Z=t.elevation,H=[1e4,-1e4];Z.visibleDemTiles.filter(J=>J.dem).forEach(J=>{const Q=J.dem.tree;H[0]=Math.min(H[0],Q.minimums[0]),H[1]=Math.max(H[1],Q.maximums[0])}),H[0]!==1e4&&(P=(H[1]-H[0])*Z.exaggeration())}const z=1.5*t.cameraToCenterDistance,L=3*z,F=new Float64Array(16);for(let Z=0;Z<this._cascades.length;++Z){const H=this._cascades[Z];let J=t.height/50,Q=1;Di.cascadeCount===1?Q=L:Z===0?Q=z:(J=z,Q=L);const[oe,ue]=Qu(t,this.shadowDirection,J,Q,Di.shadowMapResolution,P);H.scale=t.scale,H.matrix=oe,H.boundingSphereRadius=ue,i.ad.mat4.invert(F,H.matrix),H.frustum=i.bR.fromInvProjectionMatrix(F,1,0,!0),H.far=Q}const B=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[B].far,this._cascades[B].far],this._uniformValues.u_shadow_intensity=m,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Di.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Di.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ri.ShadowMap0,this._uniformValues.u_shadowmap_1=Ri.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const j=h.transform.elevation;for(const Z of this._groundShadowTiles){let H={min:0,max:0};if(j){const J=j.getMinMaxForTile(Z);J&&(H=J)}this.addShadowReceiver(Z.toUnwrapped(),H.min,H.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,s){if(!this.enabled)return;const h=this.painter,m=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),m.viewport.set([0,0,Di.shadowMapResolution,Di.shadowMapResolution]);for(let g=0;g<this._numCascadesToRender;++g){h.currentShadowCascade=g,m.bindFramebuffer.set(this._cascades[g].framebuffer.framebuffer),m.clear({color:i.al.white,depth:1});for(const x of t.order){const M=t._mergedLayers[x];if(!M.hasShadowPass()||M.isHidden(h.transform.zoom))continue;const P=t.getLayerSourceCache(M),z=P?s[P.id]:void 0;(M.type==="model"||z&&z.length)&&h.renderLayer(h,P,M,z)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,s=t.style,h=t.context,m=s.directionalLight,g=s.ambientLight;if(!m||!g)return;const x=[],M=_a(t,t.longestCutoffRange);M.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&x.push("NORMAL_OFFSET");const P=Go(s,m,g),z=new Xt(h.gl.LEQUAL,Xt.ReadOnly,t.depthRangeFor3D);for(const L of this._groundShadowTiles){const F=L.toUnwrapped(),B=t.isTileAffectedByFog(L),j=t.getOrCreateProgram("groundShadow",{defines:x,overrideFog:B});this.setupShadows(F,j),t.uploadCommonUniforms(h,j,F,null,M);const Z={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:P};j.draw(t,h.gl.TRIANGLES,z,br.disabled,Rr.multiply,dr.disabled,Z,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Rr.unblended:Rr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const s=this.painter.transform,h=s.calculatePosMatrix(t,s.worldSize);return i.ad.mat4.multiply(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(t){return i.ad.mat4.multiply(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,s,h,m=0){if(!this.enabled)return;const g=this.painter.transform,x=this.painter.context,M=x.gl,P=this._uniformValues,z=new Float64Array(16),L=g.calculatePosMatrix(t,g.worldSize);for(let F=0;F<this._cascades.length;F++)i.ad.mat4.multiply(z,this._cascades[F].matrix,L),P[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(z),x.activeTexture.set(M.TEXTURE0+Ri.ShadowMap0+F),this._cascades[F].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=!!h,this.useNormalOffset){const F=i.cd(t.canonical),B=2/g.tileSize*i.ai/Di.shadowMapResolution,j=B*this._cascades[0].boundingSphereRadius,Z=B*this._cascades[this._cascades.length-1].boundingSphereRadius,H=(h==="vector-tile"?1:3)/Math.pow(2,m-t.canonical.z-(1-g.zoom+Math.floor(g.zoom)));P.u_shadow_normal_offset=[F,j*H,Z*H],P.u_shadow_bias=[6e-5,.0012,.012]}else P.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(x,P)}setupShadowsFromMatrix(t,s,h=!1){if(!this.enabled)return;const m=this.painter.context,g=m.gl,x=this._uniformValues,M=new Float64Array(16);for(let P=0;P<Di.cascadeCount;P++)i.ad.mat4.multiply(M,this._cascades[P].matrix,t),x[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),m.activeTexture.set(g.TEXTURE0+Ri.ShadowMap0+P),this._cascades[P].texture.bind(g.NEAREST,g.CLAMP_TO_EDGE);if(this.useNormalOffset=h,h){const P=Di.normalOffset;x.u_shadow_normal_offset=[1,P,P],x.u_shadow_bias=[6e-5,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(m,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,s,h,m){if(m[2]>=0)return{};const g=function(P,z,L){const F=L/(1<<P.canonical.z);return new i.ce([P.canonical.x*F+P.wrap*L,P.canonical.y*F+P.wrap*L,0],[(P.canonical.x+1)*F+P.wrap*L,(P.canonical.y+1)*F+P.wrap*L,z])}(t,s,h).getCorners(),x=s/-m[2];m[0]<0?(i.ad.vec3.add(g[0],g[0],[m[0]*x,0,0]),i.ad.vec3.add(g[3],g[3],[m[0]*x,0,0])):m[0]>0&&(i.ad.vec3.add(g[1],g[1],[m[0]*x,0,0]),i.ad.vec3.add(g[2],g[2],[m[0]*x,0,0])),m[1]<0?(i.ad.vec3.add(g[0],g[0],[0,m[1]*x,0]),i.ad.vec3.add(g[1],g[1],[0,m[1]*x,0])):m[1]>0&&(i.ad.vec3.add(g[2],g[2],[0,m[1]*x,0]),i.ad.vec3.add(g[3],g[3],[0,m[1]*x,0]));const M={};return M.vertices=g,M.planes=[Us(g[1],g[0],g[4]),Us(g[2],g[1],g[5]),Us(g[3],g[2],g[6]),Us(g[0],g[3],g[7])],M}addShadowReceiver(t,s,h){this._receivers.add(t,i.ce.fromTileIdAndHeight(t,s,h))}getMaxCascadeForTile(t){const s=this._receivers.get(t);return s&&s.lastCascade?s.lastCascade:0}}function Us(d,t,s){const h=i.ad.vec3.sub([],s,t),m=i.ad.vec3.sub([],d,t),g=i.ad.vec3.cross([],h,m),x=i.ad.vec3.length(g);return x===0?[0,0,1,0]:(i.ad.vec3.scale(g,g,1/x),[g[0],g[1],g[2],-i.ad.vec3.dot(g,t)])}function Ju(d){const t=d.properties.get("direction"),s=i.cc(t.x,t.y,t.z);s[2]=i.ay(s[2],0,75);const h=i.cf([s[0],s[1],s[2]]);return i.ad.vec3.fromValues(h.x,h.y,h.z)}function Go(d,t,s){const h=t.properties.get("color-use-theme")==="none",m=t.properties.get("color"),g=t.properties.get("intensity"),x=t.properties.get("direction"),M=[x.x,x.y,x.z],P=s.properties.get("color-use-theme")==="none",z=s.properties.get("color"),L=s.properties.get("intensity"),F=Math.max(i.ad.vec3.dot([0,0,1],M),0),B=[0,0,0];i.ad.vec3.scale(B,z.toRenderColor(P?null:d.getLut(t.scope)).toArray01Linear().slice(0,3),L);const j=[0,0,0];return i.ad.vec3.scale(j,m.toRenderColor(h?null:d.getLut(s.scope)).toArray01Linear().slice(0,3),F*g),i.cg([B[0]>0?B[0]/(B[0]+j[0]):0,B[1]>0?B[1]/(B[1]+j[1]):0,B[2]>0?B[2]/(B[2]+j[2]):0])}function Qu(d,t,s,h,m,g){const x=d.zoom,M=d.scale,P=d.worldSize,z=1/P,L=d.aspect,F=Math.sqrt(1+L*L)*Math.tan(.5*d.fovX),B=F*F,j=h-s,Z=h+s;let H,J;B>j/Z?(H=h,J=h*F):(H=.5*Z*(1+B),J=.5*Math.sqrt(j*j+2*(h*h+s*s)*B+Z*Z*B*B));const Q=d.projection.pixelsPerMeter(d.center.lat,P),oe=d._camera.getCameraToWorldMercator(),ue=[0,0,-H*z];i.ad.vec3.transformMat4(ue,ue,oe);let ce=J*z;const ge=d._edgeInsets;if(!(ge.left===0&&ge.top===0&&ge.right===0&&ge.bottom===0||ge.left===ge.right&&ge.top===ge.bottom)){const st=d._camera.getWorldToCamera(d.worldSize,d.projection.zAxisUnit==="meters"?Q:1),$e=d._camera.getCameraToClipPerspective(d._fov,d.width/d.height,s,h);$e[8]=2*-d.centerOffset.x/d.width,$e[9]=2*d.centerOffset.y/d.height;const lt=new Float64Array(16);i.ad.mat4.mul(lt,$e,st);const wt=new Float64Array(16);i.ad.mat4.invert(wt,lt);const Mt=i.bR.fromInvProjectionMatrix(wt,P,x,!0);for(const Lt of Mt.points){const Wt=((fe=Lt)[0]/=M,fe[1]/=M,fe[2]=i.bH(fe[2],d._center.lat),fe);ce=Math.max(ce,i.ad.vec3.len(i.ad.vec3.subtract([],ue,Wt)))}}var fe;ce*=m/(m-1);const _e=Math.acos(t[2]),pe=Math.atan2(-t[0],-t[1]),we=new kc;we.position=ue,we.setPitchBearing(_e,pe);const Ee=we.getWorldToCamera(P,Q),qe=ce*P,Be=Math.min(d._mercatorZfromZoom(17)*P*-2,-2*qe),et=we.getCameraToClipOrthographic(-qe,qe,-qe,qe,Be,(qe+g*Q)/t[2]),rt=new Float64Array(16);i.ad.mat4.multiply(rt,et,Ee);const _t=i.ad.vec3.fromValues(Math.floor(1e6*ue[0])/1e6*P,Math.floor(1e6*ue[1])/1e6*P,0),Oe=.5*m,Qe=[0,0,0];i.ad.vec3.transformMat4(Qe,_t,rt),i.ad.vec3.scale(Qe,Qe,Oe);const De=[Math.floor(Qe[0]),Math.floor(Qe[1]),Math.floor(Qe[2])],Je=[0,0,0];i.ad.vec3.sub(Je,Qe,De),i.ad.vec3.scale(Je,Je,-1/Oe);const Ze=new Float64Array(16);return i.ad.mat4.identity(Ze),i.ad.mat4.translate(Ze,Ze,Je),i.ad.mat4.multiply(rt,Ze,rt),[rt,qe]}class Ml extends i.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.numModelsLoading={}}loadModel(t,s){return i.aN(this.requestManager.transformRequest(s,i.R.Model).url).then(h=>{if(!h)return;const m=i.aO(h),g=new i.aP(t,void 0,void 0,m);return g.computeBoundsAndApplyParent(),g}).catch(h=>{if(h&&h.status===404)return null;this.fire(new i.z(new Error(`Could not load model ${t} from ${s}: ${h.message}`)))})}load(t,s,h={keepNumReferences:!1}){this.models[s]||(this.models[s]={});const m=Object.keys(t);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+m.length;const g=[];for(const x of m)g.push(this.loadModel(x,t[x]));Promise.allSettled(g).then(x=>{for(let M=0;M<x.length;M++){const{status:P,value:z}=x[M];if(P==="fulfilled"&&z){const L=this.models[s][m[M]];this.models[s][m[M]]={model:z,numReferences:h.keepNumReferences&&L?L.numReferences:1}}}this.numModelsLoading[s]-=m.length,this.fire(new i.A("data",{dataType:"style"}))}).catch(x=>{this.fire(new i.z(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,s){return!!this.getModel(t,s)}getModel(t,s){return this.models[s]||(this.models[s]={}),this.models[s][t]?this.models[s][t].model:void 0}addModel(t,s,h){this.models[h]||(this.models[h]={}),this.modelUris[h]||(this.modelUris[h]={}),this.hasModel(t,h)&&this.models[h][t].numReferences++,this.modelUris[h][t]=this.requestManager.normalizeModelURL(s),this.load({[t]:this.modelUris[h][t]},h)}addModels(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h=this.modelUris[s];for(const m in t)this.models[s][m]={},h[m]=this.requestManager.normalizeModelURL(t[m]);this.load(h,s,{keepNumReferences:!0})}reloadModels(t){this.load(this.modelUris[t],t)}addModelsFromBucket(t,s){this.models[s]||(this.models[s]={}),this.modelUris[s]||(this.modelUris[s]={});const h={};for(const m of t)this.hasModel(m,s)?this.models[s][m].numReferences++:(this.modelUris[s][m]=this.requestManager.normalizeModelURL(m),h[m]=this.modelUris[s][m]);this.load(h,s)}removeModel(t,s){if(this.models[s]&&this.models[s][t]&&(this.models[s][t].numReferences--,this.models[s][t].numReferences===0)){const h=this.models[s][t].model;delete this.models[s][t],delete this.modelUris[s][t],h.destroy()}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,s){this.models[s]||(this.models[s]={});for(const h in this.models[s])this.models[s][h].model&&this.models[s][h].model.upload(t.context)}}const Hy=new i.a7({data:new i.a8(i.a5.colorTheme.data)}),Wy={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function eh(d){return d=d||{},Object.assign(d,Wy)}class Zy extends i.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},i.aQ(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new i.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(t){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(x,M){const[P,z]=x,{center:L,radius:F}=M,[B,j]=L,Z=Math.abs(P-B);return Math.sqrt((Z>180?360-Z:Z)**2+(z-j)**2)<=F}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new i.A("floorplangone")));const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=new i.P(this._map.transform.width/2,this._map.transform.height/2),m=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],g=this._map.queryRenderedFeatures(t?m:h,s);g.length>0&&(this._selectedFloorplan&&g[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=g[0],this._floorplanSelected(!1)))}_floorplanSelected(t){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(g){const[[x,M],[P,z]]=g,L=(P-x+360)%360,F=L>180?360-L:L;return{center:[(x+F/2+360)%360,(M+z)/2],radius:Math.sqrt(F**2+(z-M)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const s=this._floorplanStates[this._indoorData.id].selectedBuilding,h=this._floorplanStates[this._indoorData.id].selectedLevel;let m;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const g of this._indoorData.levels)g.id===this._selectedLevel.id&&(m=g.id);if(this.fire(new i.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:m})),s){const g=this._indoorData.buildings.find(x=>x.id===s);this._buildingSelected(g,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(h){const g=this._indoorData.levels.find(x=>x.id===h);this._updateLevels(g,t)}else t&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(t,s){s&&t&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const h=this._indoorData.levels.filter(m=>t.levels.includes(m.id));this.fire(new i.A("buildingselected",{buildingId:t.id,levels:h}))}_levelSelected(t){if(t==="overview")this._updateLevels(void 0,!0);else{const s=this._indoorData.levels.find(h=>h.id===t);this._updateLevels(s,!0)}this.fire(new i.A("levelselected",{levelId:t==="overview"?void 0:t}))}_updateLevels(t,s){if(!t)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(s&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function h(z){const L=z.indexOf("/floor/");if(L===-1)return z;const F=L+7,B=z.indexOf("/",F);return B===-1?z.slice(F):z.slice(F,B)}this._selectedLevel=t,this._floorplanStates[this._indoorData.id].selectedLevel=t?t.id:void 0;const m=[],g={},x={},M={},P={};for(const z of this._indoorData.levels)if(m.push(z.id),g[z.id]=z.height,x[z.id]=z.base,t){if(this.mergeFloors){const L=h(t.id),F=h(z.id);M[z.id]=F===L?"true":"false"}else M[z.id]=z.id===t.id?"true":"false";P[z.id]=z.base<t.base?"true":"false"}else P[z.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",m]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",g]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",x]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",M]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",P]),t&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!t.isUnderground),s&&t.extent)){const z=this._map.cameraForBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),L=this._map.getZoom(),F=z.zoom?Math.abs(L-z.zoom):0;this._map.fitBounds(t.extent,F>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:L})}}selectFloorplan(t){const s={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},h=[new i.P(0,0),new i.P(this._map.transform.width,this._map.transform.height)],m=this._map.queryRenderedFeatures(h,s);if(m.length>0){for(const g of m)if(JSON.parse(g.properties["indoor-data"]).floorplanIDs.includes(t)){this._selectedFloorplan=g,this._floorplanSelected(!0);break}}}selectBuilding(t){const s=this._indoorData.buildings.find(h=>h.id===t);this._buildingSelected(s,!0)}selectLevel(t){this._levelSelected(t)}}function Nm(d){if(!d.metadata||!d.metadata.content_area)return;const t=i.q.devicePixelRatio,{left:s,top:h,width:m,height:g}=d.metadata.content_area,x=s*t,M=h*t;return[x,M,x+m*t,M+g*t]}function qd(d){if(d)return d.map(([t,s])=>[t*i.q.devicePixelRatio,s*i.q.devicePixelRatio])}class Hd{constructor(t,s){this.id=t,this.style=s}addIcons(t){const s=new Map;for(const[h,m]of t.entries()){const g=i.I.from({name:h,iconsetId:this.id});s.set(g,m)}this.style.addImages(s)}}const Za=(d,t)=>Pe(d,t&&t.filter(s=>s.identifier!=="source.canvas")),Xy=i.aA(qr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),Ky=i.aA(qr,["setCenter","setZoom","setBearing","setPitch"]),Wd=new Set(["background","sky","slot","custom"]),Zd={version:8,layers:[],sources:{}},Vm={duration:300,delay:0};class os extends i.E{constructor(t,s={}){super(),this.map=t,this.scope=s.scope||"",this.globalId=null,this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=i.l({},Vm),this._buildingIndex=new or(this),this.crossTileSymbolIndex=new Fm,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new ke,this.dispatcher=s.dispatcher?s.dispatcher:new i.D(i.cj(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Ae(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new i.ck(t._requestManager,s.localFontFamily?i.cl.all:s.localIdeographFontFamily?i.cl.ideographs:i.cl.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new Ml(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:s.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=s.initialConfig,this.dispatcher.broadcast("setReferrer",i.cm());const h=this;this._rtlTextPluginCallback=os.registerForPluginStateChange(m=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(g,x)=>{if(i.cn(g),x&&x.every(M=>M))for(const M in h._sourceCaches){const P=h._sourceCaches[M],z=P.getSource().type;z!=="vector"&&z!=="geojson"||P.reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.getOwnSource(m.sourceId);if(g&&g.vectorLayerIds)for(const x in this._layers){const M=this._layers[x];M.source===g.id&&this._validateLayer(M)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(i.f(t))return t;const s=i.co(t);if(!s.startsWith("http"))try{return new URL(s,location.href).toString()}catch{return s}return s}return`json://${i.cp(JSON.stringify(t))}`}_diffStyle(t,s,h){this.globalId=this._getGlobalId(t);const m=(g,x)=>{try{x(null,this.setState(g,h))}catch(M){x(M,!1)}};if(typeof t=="string"){const g=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(g,i.R.Style);i.n(x,(M,P)=>{M?this.fire(new i.z(M)):P&&m(P,s)})}else typeof t=="object"&&m(t,s)}loadURL(t,s={}){this.fire(new i.A("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!i.f(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,s.accessToken),this.resolvedImports.add(t);const m=this.importsCache.get(t);if(m)return this._load(m,h);const g=this.map._requestManager.transformRequest(t,i.R.Style);this._request=i.n(g,(x,M)=>{if(this._request=null,x)this.fire(new i.z(x));else if(M)return this.importsCache.set(t,M),this._load(M,h)})}loadJSON(t,s={}){this.fire(new i.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=i.q.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new i.A("dataloading",{dataType:"style"})),this._load(Zd,!1)}_loadImports(t,s,h){if(this.importDepth>=4)return i.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const m=[];for(const g of t){const x=this._createFragmentStyle(g),M=new Promise(L=>{x.once("style.import.load",L),x.once("error",L)}).then(()=>this.mergeAll());if(m.push(M),this.resolvedImports.has(g.url)){x.loadEmpty();continue}const P=g.data||this.importsCache.get(g.url);P?(x.loadJSON(P,{validate:s}),this._isInternalStyle(P)&&(x.globalId=null)):g.url?x.loadURL(g.url,{validate:s}):x.loadEmpty();const z={style:x,id:g.id,config:g.config};if(h){const L=this.fragments.findIndex(({id:F})=>F===h);this.fragments=this.fragments.slice(0,L).concat(z).concat(this.fragments.slice(L))}else this.fragments.push(z)}return Promise.allSettled(m)}getImportGlobalIds(t=this,s=new Set){for(const h of t.fragments)h.style.globalId&&s.add(h.style.globalId),this.getImportGlobalIds(h.style,s);return[...s.values()]}_createFragmentStyle(t){const s=this.scope?i.C(t.id,this.scope):t.id;let h;const m=this._initialConfig&&this._initialConfig[s];(t.config||m)&&(h=i.l({},t.config,m));const g=new os(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:h,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,s){const h=t.indoor?eh(t.schema):t.schema;if(this._isInternalStyle(t)){const x=i.l({},Zd,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(x,s)}if(this.updateConfig(this._config,h),s&&Za(this,vs(t)))return;this._loaded=!0,this.stylesheet=i.cq(t);const m=()=>{for(const z in t.sources)this.addSource(z,t.sources[z],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const z in t.iconsets)this.addIconset(z,t.iconsets[z]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const x=Ud(this.stylesheet.layers);if(this._order=x.map(z=>z.id),this.stylesheet.light&&i.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const z=this.stylesheet.lights[0];this.light=new Re(z.properties,z.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Re(this.stylesheet.light)),this._layers={};for(const z of x){const L=i.cv(z,this.scope,this._styleColorTheme.lut,this.options);L.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const F=this.getOwnLayerSourceCache(L),B=!!this.directionalLight&&this.directionalLight.shadowsEnabled();F&&L.canCastShadows()&&B&&(F.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const M=this.stylesheet.terrain;M&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(M,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new i.A("data",{dataType:"style"}));const P=this.isRootStyle();t.imports?this._loadImports(t.imports,s).then(()=>{this._reloadImports(),this.fire(new i.A(P?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new i.A(P?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const x=this._evaluateColorThemeData(g);this._loadColorTheme(x).then(()=>{m()}).catch(M=>{i.w(`Couldn't load color theme from the stylesheet: ${M}`),m()})}else this._styleColorTheme.lut=null,m()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,s,h,m,g,x,M,P,z,L;const F={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(B=>{if(B.stylesheet){if(B.light!=null&&(t=B.light),B.stylesheet.lights)for(const j of B.stylesheet.lights)j.type==="ambient"&&B.ambientLight!=null&&(s=B.ambientLight),j.type==="directional"&&B.directionalLight!=null&&(h=B.directionalLight);m=this._prioritizeTerrain(m,B.terrain,B.stylesheet.terrain),B.stylesheet.fog&&B.fog!=null&&(g=B.fog),B.stylesheet.snow&&B.snow!=null&&(x=B.snow),B.stylesheet.rain&&B.rain!=null&&(M=B.rain),B.stylesheet.camera!=null&&(L=B.stylesheet.camera),B.stylesheet.projection!=null&&(P=B.stylesheet.projection),B.stylesheet.transition!=null&&(z=B.stylesheet.transition),F[B.scope]=B._styleColorTheme}}),this.light=t,this.ambientLight=s,this.directionalLight=h,this.fog=g,this.snow=x,this.rain=M,this._styleColorThemeForScope=F,m===null?delete this.terrain:this.terrain=m,this.camera=L||{"camera-projection":"perspective"},this.projection=P||{name:"mercator"},this.transition=i.l({},Vm,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const s=h=>{for(const m of h.fragments)s(m.style);t(h)};s(this)}_prioritizeTerrain(t,s,h){const m=t&&t.drapeRenderMode===0;return h===null?s&&s.drapeRenderMode===0?s:m?t:null:s!=null&&(!t||m||s&&s.drapeRenderMode===1)?s:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{t=this._prioritizeTerrain(t,s.terrain,s.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(t=s.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},s={},h={};this.forEachFragmentStyle(m=>{for(const g in m._sourceCaches){const x=i.C(g,m.scope);t[x]=m._sourceCaches[g]}for(const g in m._otherSourceCaches){const x=i.C(g,m.scope);s[x]=m._otherSourceCaches[g]}for(const g in m._symbolSourceCaches){const x=i.C(g,m.scope);h[x]=m._symbolSourceCaches[g]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=h}mergeLayers(){const t={},s=[],h={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(g=>{for(const x of g._order){const M=g._layers[x];if(M.type==="slot"){const P=i.cr(x);if(t[P])continue;t[P]=[]}M.slot&&t[M.slot]?t[M.slot].push(M):s.push(M)}}),this._mergedOrder=[];const m=(g=[])=>{for(const x of g)if(x.type==="slot"){const M=i.cr(x.id);t[M]&&m(t[M]),this._mergedSlots.push(M)}else{const M=i.C(x.id,x.scope);this._mergedOrder.push(M),h[M]=x,x.is3D(!!this.terrain)&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0),x.type==="clip"&&(this._clipLayerPresent=!0)}};m(s),this._mergedOrder.sort((g,x)=>{const M=h[g],P=h[x];return M.hasInitialOcclusionOpacityProperties?P.is3D(!!this.terrain)?1:0:M.is3D(!!this.terrain)&&P.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=i.l({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(s,h,m){const g=i.l({},h);for(const M of Object.keys(i.a5.colorTheme))g[M]===void 0&&(g[M]=i.a5.colorTheme[M].default);const x=new i.a6(Hy,s,new Map(m));return x.setTransitionOrValue(g,m),x.untransitioned().possiblyEvaluate(new i.aa(0))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const s=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((h,m)=>{const g="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void h();let x=t;x.startsWith(g)||(x=g+x);const M=i.I.from("mapbox-reserved-lut"),P=new Image;P.src=x,P.onerror=()=>{this._styleColorTheme.lutLoading=!1,m(new Error("Failed to load image data"))},P.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==s)return void h();this._styleColorTheme.lutLoading=!1;const{width:z,height:L,data:F}=i.q.getImageData(P);if(L>32)return void m(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==L*L)return void m(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new i.r({width:z,height:L},F),pixelRatio:1,sdf:!1,usvg:!1,version:0});const B=this.imageManager.getImage(M,this.scope);B?(this._styleColorTheme.lut={image:B.data,data:t},h()):m(new Error("Missing LUT image."))}})}getLut(t){const s=this._styleColorThemeForScope[t];return s?s.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(s,h,m){let g,x,M;const P=i.q.devicePixelRatio>1?"@2x":"";let z=i.n(h.transformRequest(h.normalizeSpriteURL(s,P,".json"),i.R.SpriteJSON),(B,j)=>{z=null,M||(M=B,g=j,F())}),L=i.o(h.transformRequest(h.normalizeSpriteURL(s,P,".png"),i.R.SpriteImage),(B,j)=>{L=null,M||(M=B,x=j,F())});function F(){if(M)m(M);else if(g&&x){const B=i.q.getImageData(x),j={};for(const Z in g){const{width:H,height:J,x:Q,y:oe,sdf:ue,pixelRatio:ce,stretchX:ge,stretchY:fe,content:_e}=g[Z],pe=new i.r({width:H,height:J});i.r.copy(B,pe,{x:Q,y:oe},{x:0,y:0},{width:H,height:J},null),j[Z]={data:pe,pixelRatio:ce,sdf:ue,stretchX:ge,stretchY:fe,content:_e,usvg:!1}}m(null,j)}}return{cancel(){z&&(z.cancel(),z=null),L&&(L.cancel(),L=null)}}}(t,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new i.z(s));else if(h){const m=new Map;for(const g in h)m.set(i.I.from(g),h[g]);this.addImages(m)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))})}addIconset(t,s){if(s.type==="sprite")return void this._loadSprite(s.url);const h=this.getOwnSource(s.source);if(!h)return void this.fire(new i.z(new Error(`Source "${s.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));if(h.type!=="raster-array")return void this.fire(new i.z(new Error(`Source "${s.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));this.imageManager.createIconset(this.scope,t);const m=new Hd(t,this);h.addIconset(t,m)}_loadIconset(t){if(!i.f(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const s=this.map._spriteFormat==="auto";var h,m;this._spriteRequest=(m=(g,x)=>{if(this._spriteRequest=null,g)s?this._loadSprite(t):this.fire(new i.z(g));else if(x){const M=new Map;for(const P in x)M.set(i.I.from(P),x[P]);this.addImages(M)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new i.A("data",{dataType:"style"}))},i.bj((h=this.map._requestManager).transformRequest(h.normalizeIconsetURL(t),i.R.Iconset),(g,x)=>{if(g)return void m(g);const M={},P=i.ch(new i.bi(x));for(const z of P.icons){const L={version:1,pixelRatio:i.q.devicePixelRatio,content:Nm(z),stretchX:z.metadata?qd(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?qd(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};M[z.name]=L}m(null,M)}))}_validateLayer(t){const s=this.getOwnSource(t.source);if(!s)return;const h=t.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new i.z(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,s)=>{const h=this.fragments[s];return h&&h.style&&(t.data=h.style.serialize()),t})}_serializeSources(){const t={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();t[h.id]||(t[h.id]=h.serialize())}return t}_serializeLayers(t){const s=[];for(const h of t){const m=this._layers[h];m&&m.type!=="custom"&&s.push(m.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const s=this.getOwnLayer(t);if(s)return s;this.fire(new i.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const s=this.getOwnSource(t);if(s)return s;this.fire(new i.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,s){const h=this.map.painter;if(h)for(let m=t.minzoom||0;m<(t.maxzoom||25.5);m++){const g=t.getProgramIds();if(g)for(const x of g){const M=t.getDefaultProgramParams(x,s.zoom,this._styleColorTheme.lut);M&&(h.style=this,this.fog&&(h._fogVisible=!0,M.overrideFog=!0,h.getOrCreateProgram(x,M)),h._fogVisible=!1,M.overrideFog=!1,h.getOrCreateProgram(x,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,h.getOrCreateProgram(x,M)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const s=this.calculateLightsBrightness();t.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const h=this._changes.isDirty();let m=!1;if(this._changes.isDirty()){const x=this._changes.getLayerUpdatesByScope();for(const M in x){const{updatedIds:P,removedIds:z}=x[M];(P||z)&&(this._updateWorkerLayers(M,P,z),m=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const g={};for(const x in this._mergedSourceCaches){const M=this._mergedSourceCaches[x];g[x]=M.used,M.used=!1,M.tileCoverLift=0}for(const x of this._mergedOrder){const M=this._mergedLayers[x];if(M.recalculate(t,this._availableImages),!M.isHidden(t.zoom)){const P=this.getLayerSourceCache(M);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,M.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(M,t)}):this.precompilePrograms(M,t))}for(const x in this._mergedSourceCaches){const M=this._mergedSourceCaches[x];if(!M)continue;const P=M._source;P.type==="raster-array"&&P.iconsets&&(M.used=!0)}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&m&&this.mergeLayers();for(const x in g){const M=this._mergedSourceCaches[x];g[x]!==M.used&&M.getSource().fire(new i.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),h&&this.fire(new i.A("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=this._changes.getUpdatedImages();if(t.length){for(const s in this._mergedSourceCaches)this._mergedSourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changes.resetUpdatedImages()}}_updateWorkerLayers(t,s,h){const m=this.getFragmentStyle(t);m&&this.dispatcher.broadcast("updateLayers",{layers:s?m._serializeLayers(s):[],scope:t,removedIds:h||[],options:m.options})}setState(t,s){if(this._checkLoaded(),Za(this,vs(t)))return!1;(t=i.cq(t)).layers=Ud(t.layers);const h=function(x,M){if(!x)return[{command:qr.setStyle,args:[M]}];let P=[];try{if(!i.bn(x.version,M.version))return[{command:qr.setStyle,args:[M]}];if(i.bn(x.center,M.center)||P.push({command:qr.setCenter,args:[M.center]}),i.bn(x.zoom,M.zoom)||P.push({command:qr.setZoom,args:[M.zoom]}),i.bn(x.bearing,M.bearing)||P.push({command:qr.setBearing,args:[M.bearing]}),i.bn(x.pitch,M.pitch)||P.push({command:qr.setPitch,args:[M.pitch]}),i.bn(x.sprite,M.sprite)||P.push({command:qr.setSprite,args:[M.sprite]}),i.bn(x.glyphs,M.glyphs)||P.push({command:qr.setGlyphs,args:[M.glyphs]}),i.bn(x.imports,M.imports)||function(j=[],Z=[],H){Z=Z||[];const J=(j=j||[]).map(rn),Q=Z.map(rn),oe=j.reduce(Hr,{}),ue=Z.reduce(Hr,{}),ce=J.slice();let ge,fe,_e,pe;for(ge=0,fe=0;ge<J.length;ge++)_e=J[ge],ue.hasOwnProperty(_e)?fe++:(H.push({command:qr.removeImport,args:[_e]}),ce.splice(ce.indexOf(_e,fe),1));for(ge=0,fe=0;ge<Q.length;ge++)_e=Q[Q.length-1-ge],ce[ce.length-1-ge]!==_e&&(oe.hasOwnProperty(_e)?(H.push({command:qr.removeImport,args:[_e]}),ce.splice(ce.lastIndexOf(_e,ce.length-fe),1)):fe++,pe=ce[ce.length-ge],H.push({command:qr.addImport,args:[ue[_e],pe]}),ce.splice(ce.length-ge,0,_e));for(const we of Z){const Ee=oe[we.id];Ee&&!i.bn(Ee,we)&&H.push({command:qr.updateImport,args:[we.id,we]})}}(x.imports,M.imports,P),i.bn(x.transition,M.transition)||P.push({command:qr.setTransition,args:[M.transition]}),i.bn(x.light,M.light)||P.push({command:qr.setLight,args:[M.light]}),i.bn(x.fog,M.fog)||P.push({command:qr.setFog,args:[M.fog]}),i.bn(x.snow,M.snow)||P.push({command:qr.setSnow,args:[M.snow]}),i.bn(x.rain,M.rain)||P.push({command:qr.setRain,args:[M.rain]}),i.bn(x.projection,M.projection)||P.push({command:qr.setProjection,args:[M.projection]}),i.bn(x.lights,M.lights)||P.push({command:qr.setLights,args:[M.lights]}),i.bn(x.camera,M.camera)||P.push({command:qr.setCamera,args:[M.camera]}),!i.bn(x["color-theme"],M["color-theme"]))return[{command:qr.setStyle,args:[M]}];const z={},L=[];(function(j,Z,H,J){let Q;for(Q in Z=Z||{},j=j||{})j.hasOwnProperty(Q)&&(Z.hasOwnProperty(Q)||Ns(Q,H,J));for(Q in Z){if(!Z.hasOwnProperty(Q))continue;const oe=Z[Q];j.hasOwnProperty(Q)?i.bn(j[Q],oe)||(j[Q].type==="geojson"&&oe.type==="geojson"&&bl(j,Z,Q)?H.push({command:qr.setGeoJSONSourceData,args:[Q,oe.data]}):jd(Q,Z,H,J)):Uu(Q,Z,H)}})(x.sources,M.sources,L,z);const F=[];x.layers&&x.layers.forEach(j=>{j.source&&z[j.source]?P.push({command:qr.removeLayer,args:[j.id]}):F.push(j)});let B=x.terrain;B&&z[B.source]&&(P.push({command:qr.setTerrain,args:[void 0]}),B=void 0),P=P.concat(L),i.bn(B,M.terrain)||P.push({command:qr.setTerrain,args:[M.terrain]}),function(j,Z,H){Z=Z||[];const J=(j=j||[]).map(rn),Q=Z.map(rn),oe=j.reduce(Hr,{}),ue=Z.reduce(Hr,{}),ce=J.slice(),ge=Object.create(null);let fe,_e,pe,we,Ee,qe,Be;for(fe=0,_e=0;fe<J.length;fe++)pe=J[fe],ue.hasOwnProperty(pe)?_e++:(H.push({command:qr.removeLayer,args:[pe]}),ce.splice(ce.indexOf(pe,_e),1));for(fe=0,_e=0;fe<Q.length;fe++)pe=Q[Q.length-1-fe],ce[ce.length-1-fe]!==pe&&(oe.hasOwnProperty(pe)?(H.push({command:qr.removeLayer,args:[pe]}),ce.splice(ce.lastIndexOf(pe,ce.length-_e),1)):_e++,qe=ce[ce.length-fe],H.push({command:qr.addLayer,args:[ue[pe],qe]}),ce.splice(ce.length-fe,0,pe),ge[pe]=!0);for(fe=0;fe<Q.length;fe++)if(pe=Q[fe],we=oe[pe],Ee=ue[pe],!ge[pe]&&!i.bn(we,Ee))if(i.bn(we.source,Ee.source)&&i.bn(we["source-layer"],Ee["source-layer"])&&i.bn(we.type,Ee.type)){for(Be in qt(we.layout,Ee.layout,H,pe,null,qr.setLayoutProperty),qt(we.paint,Ee.paint,H,pe,null,qr.setPaintProperty),i.bn(we.slot,Ee.slot)||H.push({command:qr.setSlot,args:[pe,Ee.slot]}),i.bn(we.filter,Ee.filter)||H.push({command:qr.setFilter,args:[pe,Ee.filter]}),i.bn(we.minzoom,Ee.minzoom)&&i.bn(we.maxzoom,Ee.maxzoom)||H.push({command:qr.setLayerZoomRange,args:[pe,Ee.minzoom,Ee.maxzoom]}),we)we.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?qt(we[Be],Ee[Be],H,pe,Be.slice(6),qr.setPaintProperty):i.bn(we[Be],Ee[Be])||H.push({command:qr.setLayerProperty,args:[pe,Be,Ee[Be]]}));for(Be in Ee)Ee.hasOwnProperty(Be)&&!we.hasOwnProperty(Be)&&Be!=="layout"&&Be!=="paint"&&Be!=="filter"&&Be!=="metadata"&&Be!=="minzoom"&&Be!=="maxzoom"&&Be!=="slot"&&(Be.indexOf("paint.")===0?qt(we[Be],Ee[Be],H,pe,Be.slice(6),qr.setPaintProperty):i.bn(we[Be],Ee[Be])||H.push({command:qr.setLayerProperty,args:[pe,Be,Ee[Be]]}))}else H.push({command:qr.removeLayer,args:[pe]}),qe=ce[ce.lastIndexOf(pe)+1],H.push({command:qr.addLayer,args:[Ee,qe]})}(F,M.layers,P)}catch(z){console.warn("Unable to compute style diff:",z),P=[{command:qr.setStyle,args:[M]}]}return P}(this.serialize(),t).filter(x=>!(x.command in Ky));if(h.length===0)return!1;const m=h.filter(x=>!(x.command in Xy));if(m.length>0)throw new Error(`Unimplemented: ${m.map(x=>x.command).join(", ")}.`);const g=[];return h.forEach(x=>{g.push(this[x.command].apply(this,x.args))}),s&&Promise.all(g).then(s),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}addImages(t){for(const[s,h]of t.entries()){if(this.getImage(s)&&!s.iconsetId)return this.fire(new i.z(new Error(`An image with the name "${s.name}" already exists.`)));this.imageManager.addImage(s,this.scope,h),this._changes.updateImage(s)}return this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this}addImage(t,s){return this.getImage(t)&&!t.iconsetId?this.fire(new i.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,s),this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this)}updateImage(t,s,h=!1){this.imageManager.updateImage(t,this.scope,s),h&&(this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t),this._updateWorkerImages(),this.fire(new i.A("data",{dataType:"style"})),this):this.fire(new i.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(t,s,h={}){return this._checkLoaded(),this._validate(Te,`models.${t}`,s,null,h)||(this.modelManager.addModel(t,s,this.scope),this._changes.setDirty()),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this):this.fire(new i.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,s,h={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(Va,`sources.${t}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const m=Ld(t,s,this.dispatcher,this);m.scope=this.scope,m.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(m.id),source:m.serialize(),sourceId:m.id}));const g=x=>{const M=(x?"symbol:":"other:")+m.id,P=i.C(M,this.scope),z=this._sourceCaches[M]=new ws(P,m,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[m.id]=z,z.onAdd(this.map)};g(!1),s.type!=="vector"&&s.type!=="geojson"||g(!0),m.onAdd&&m.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const s=this.getOwnSource(t);if(!s)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===t)return this.fire(new i.z(new Error(`Source "${t}" cannot be removed while layer "${m}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new i.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));const h=this.getOwnSourceCaches(t);for(const m of h){const g=i.cr(m.id);delete this._sourceCaches[g],this._changes.discardSourceCacheUpdate(m.id),m.fire(new i.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:m.getSource().id})),m.setEventedParent(null),m.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,s){this._checkLoaded(),this.getOwnSource(t).setData(s),this._changes.setDirty()}getOwnSource(t){const s=this.getOwnSourceCache(t);return s&&s.getSource()}getOwnSources(){const t=[];for(const s in this._otherSourceCaches){const h=this.getOwnSourceCache(s);h&&t.push(h.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const s in t){const h=t[s]._tiles;for(const m in h){const g=h[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const m of t){if(this._validate(Sc,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){const g=this.ambientLight;g.set(m),g.updateTransitions(s)}else this.ambientLight=new an(m,Bn||(Bn=new i.a7({color:new i.a8(i.a5.properties_light_ambient.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const g=this.directionalLight;g.set(m),g.updateTransitions(s)}else this.directionalLight=new an(m,Or||(Or=new i.a7({direction:new i.am(i.a5.properties_light_directional.direction),color:new i.a8(i.a5.properties_light_directional.color),"color-use-theme":new i.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new i.a8(i.a5.properties_light_directional.intensity),"cast-shadows":new i.a8(i.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new i.a8(i.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new i.a8(i.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const h=new i.aa(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,s=this.ambientLight;if(!t||!s)return;const h=B=>.2126*(B[0]<=.03928?B[0]/12.92:Math.pow((B[0]+.055)/1.055,2.4))+.7152*(B[1]<=.03928?B[1]/12.92:Math.pow((B[1]+.055)/1.055,2.4))+.0722*(B[2]<=.03928?B[2]/12.92:Math.pow((B[2]+.055)/1.055,2.4)),m=t.properties.get("color").toRenderColor(null).toArray01(),g=t.properties.get("intensity"),x=t.properties.get("direction"),M=1-i.cc(x.x,x.y,x.z)[2]/90,P=h(m)*g*M,z=s.properties.get("color").toRenderColor(null).toArray01(),L=s.properties.get("intensity"),F=h(z)*L;return Number(((P+F)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(!t)return this;if(i.cs(t)){const s=i.ct(t),h=this.fragments.find(({id:g})=>g===s);if(!h)throw new Error(`Style import '${t}' not found`);const m=i.cr(t);return h.style.getFragmentStyle(m)}{const s=this.fragments.find(({id:h})=>h===t);return s?s.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const s={},h=(m,g="")=>`${m}::${g}`;this._featuresetSelectors={};for(const m in t){const g=this._featuresetSelectors[m]=[];for(const x of t[m].selectors){if(x.featureNamespace){const P=this.getOwnLayer(x.layer);if(!P){i.w(`Layer is undefined for selector: ${x.layer}`);continue}const z=h(P.source,P.sourceLayer);if(z in s&&s[z]!==x.featureNamespace){i.w(`"featureNamespace ${x.featureNamespace} of featureset ${m}'s selector is not associated to the same source, skip this selector`);continue}s[z]=x.featureNamespace}let M;if(x.properties)for(const P in x.properties){const z=i.X(x.properties[P]);z.result==="success"&&(M=M||{},M[P]=z.value)}g.push({layerId:x.layer,namespace:x.featureNamespace,properties:M,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const s=this.getFragmentStyle(t);if(!s||!s.stylesheet.featuresets)return[];const h=[];for(const m in s.stylesheet.featuresets)h.push({featuresetId:m,importId:s.scope?s.scope:void 0});return h}getFeaturesetLayers(t,s){const h=this.getFragmentStyle(s),m=h.stylesheet.featuresets;if(!m||!m[t])return this.fire(new i.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const g=[];for(const x of m[t].selectors){const M=h.getOwnLayer(x.layer);M&&g.push(M)}return g}getConfigProperty(t,s){const h=this.getFragmentStyle(t);if(!h)return null;const m=i.C(s,h.scope),g=h.options.get(m),x=g?g.value||g.default:null;return x?x.serialize():null}setConfigProperty(t,s,h){const m=this.getFragmentStyle(t);if(!m)return;const g=m.stylesheet.indoor?eh(m.stylesheet.schema):m.stylesheet.schema;if(!g||!g[s])return;const x=i.X(h);if(x.result!=="success")return void Za(this,x.value);const M=x.value.expression,P=i.C(s,m.scope),z=m.options.get(P);if(!z)return;let L;const{minValue:F,maxValue:B,stepValue:j,type:Z,values:H}=g[s],J=i.X(g[s].default);J.result==="success"&&(L=J.value.expression),L?(this.options.set(P,Object.assign({},z,{value:M,default:L,minValue:F,maxValue:B,stepValue:j,type:Z,values:H})),this.updateConfigDependencies(s)):this.fire(new i.z(new Error(`No schema defined for the config option "${s}" in the "${t}" fragment.`)))}getConfig(t){const s=this.getFragmentStyle(t);if(!s)return null;const h=s.stylesheet.schema;if(!h)return null;const m={};for(const g in h){const x=i.C(g,s.scope),M=s.options.get(x),P=M?M.value||M.default:null;m[g]=P?P.serialize():null}return m}setConfig(t,s){const h=this.getFragmentStyle(t);h&&(h.updateConfig(s,h.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const s=this.getFragmentStyle(t);return s?s.stylesheet.schema:null}setSchema(t,s){const h=this.getFragmentStyle(t);h&&(h.stylesheet.schema=s,h.updateConfig(h._config,s),this.updateConfigDependencies())}updateConfig(t,s){if(this._config=t,t||s)if(s)for(const h in s){let m,g;const x=i.X(s[h].default);if(x.result==="success"&&(m=x.value.expression),t&&t[h]!==void 0){const B=i.X(t[h]);B.result==="success"&&(g=B.value.expression)}const{minValue:M,maxValue:P,stepValue:z,type:L,values:F}=s[h];if(m){const B=i.C(h,this.scope);this.options.set(B,{default:m,value:g,minValue:M,maxValue:P,stepValue:z,type:L,values:F})}else this.fire(new i.z(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new i.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const s of this._configDependentLayers){const h=this.getLayer(s);if(h){if(t&&!h.configDependencies.has(t))continue;h.possiblyEvaluateVisibility(),this._updateLayer(h)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(s=>{const h=s._styleColorTheme.colorThemeOverride?s._styleColorTheme.colorThemeOverride:s._styleColorTheme.colorTheme;if(h){const m=s._evaluateColorThemeData(h);(!s._styleColorTheme.lut&&m!==""||s._styleColorTheme.lut&&m!==s._styleColorTheme.lut.data)&&s.setColorTheme(h)}}),this._changes.setDirty()}addLayer(t,s,h={}){this._checkLoaded();const m=t.id;if(this._layers[m])return void this.fire(new i.z(new Error(`Layer with id "${m}" already exists on this map`)));let g;if(t.type==="custom"){if(Za(this,i.cu(t)))return;g=i.cv(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(m,t.source),t=i.cq(t),t=i.l(t,{source:m})),this._validate(Xe,`layers.${m}`,t,{arrayIndex:-1},h))return;g=i.cv(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(g),g.setEventedParent(this,{layer:{id:m}})}g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid);let x=this._order.length;if(s){const L=this._order.indexOf(s);if(L===-1)return void this.fire(new i.z(new Error(`Layer with id "${s}" does not exist on this map.`)));g.slot===this._layers[s].slot?x=L:i.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,m),this._layerOrderChanged=!0,this._layers[m]=g;const M=this.getOwnLayerSourceCache(g),P=!!this.directionalLight&&this.directionalLight.shadowsEnabled();M&&g.canCastShadows()&&P&&(M.castsShadows=!0);const z=this._changes.getRemovedLayer(g);if(z&&g.source&&M&&g.type!=="custom"){this._changes.discardLayerRemoval(g);const L=i.C(g.source,g.scope);z.type!==g.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),M.pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map),g.scope=this.scope,this.mergeLayers()}moveLayer(t,s){this._checkLoaded();const h=this._checkLayer(t);if(!h||t===s)return;const m=this._order.indexOf(t);this._order.splice(m,1);let g=this._order.length;if(s){const x=this._order.indexOf(s);if(x===-1)return void this.fire(new i.z(new Error(`Layer with id "${s}" does not exist on this map.`)));h.slot===this._layers[s].slot?g=x:i.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(g,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const s=this._checkLayer(t);if(!s)return;s.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const m=this.getOwnLayerSourceCache(s);if(m&&m.castsShadows){let g=!1;for(const x in this._layers)if(this._layers[x].source===s.source&&this._layers[x].canCastShadows()){g=!0;break}m.castsShadows=g}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const s in this._layers)if(this._layers[s].type===t)return!0;return!1}setLayerZoomRange(t,s,h){this._checkLoaded();const m=this._checkLayer(t);m&&(m.minzoom===s&&m.maxzoom===h||(s!=null&&(m.minzoom=s),h!=null&&(m.maxzoom=h),this._updateLayer(m)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,s){this._checkLoaded();const h=this._checkLayer(t);h&&h.slot!==s&&(h.slot=s,this._updateLayer(h))}setFilter(t,s,h={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!i.bn(m.filter,s))return s==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(Y,`layers.${m.id}.filter`,s,{layerType:m.type},h)||(m.filter=i.cq(s),this._updateLayer(m)))}getFilter(t){const s=this._checkLayer(t);if(s)return i.cq(s.filter)}setLayoutProperty(t,s,h,m={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!i.bn(g.getLayoutProperty(s),h)){if(h!=null&&(!m||m.validate!==!1)&&Za(g,de.call(vs,{key:`layers.${t}.layout.${s}`,layerType:g.type,objectKey:s,value:h,styleSpec:i.a5,style:{glyphs:!0,sprite:!0}})))return;g.setLayoutProperty(s,h),g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),this._updateLayer(g)}}getLayoutProperty(t,s){const h=this._checkLayer(t);if(h)return h.getLayoutProperty(s)}setPaintProperty(t,s,h,m={}){this._checkLoaded();const g=this._checkLayer(t);if(!g||i.bn(g.getPaintProperty(s),h)||h!=null&&(!m||m.validate!==!1)&&Za(g,re.call(vs,{key:`layers.${t}.paint.${s}`,layerType:g.type,objectKey:s,value:h,styleSpec:i.a5})))return;const x=g.setPaintProperty(s,h);g.configDependencies.size!==0&&this._configDependentLayers.add(g.fqid),x&&this._updateLayer(g),this._changes.updatePaintProperties(g)}getPaintProperty(t,s){const h=this._checkLayer(t);if(h)return h.getPaintProperty(s)}setFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:P,importId:z}=t.target,L=this.getFragmentStyle(z),F=L.getFeaturesetLayers(P);for(const{source:B,sourceLayer:j}of F)L.setFeatureState({id:t.id,source:B,sourceLayer:j},s)}else if("layerId"in t.target){const{layerId:P}=t.target,z=this.getLayer(P);this.setFeatureState({id:t.id,source:z.source,sourceLayer:z.sourceLayer},s)}return}const h=t.source,m=t.sourceLayer,g=this._checkSource(h);if(!g)return;const x=g.type;if(x==="geojson"&&m)return void this.fire(new i.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!m)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(h);for(const P of M)P.setFeatureState(m,t.id,s)}removeFeatureState(t,s){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:P,importId:z}=t.target,L=this.getFragmentStyle(z),F=L.getFeaturesetLayers(P);for(const{source:B,sourceLayer:j}of F)L.removeFeatureState({id:t.id,source:B,sourceLayer:j},s)}else if("layerId"in t.target){const{layerId:P}=t.target,z=this.getLayer(P);this.removeFeatureState({id:t.id,source:z.source,sourceLayer:z.sourceLayer},s)}return}const h=t.source,m=this._checkSource(h);if(!m)return;const g=m.type,x=g==="vector"?t.sourceLayer:void 0;if(g==="vector"&&!x)return void this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new i.z(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(h);for(const P of M)P.removeFeatureState(x,t.id,s)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let g;if("featuresetId"in t.target){const{featuresetId:x,importId:M}=t.target,P=this.getFragmentStyle(M),z=P.getFeaturesetLayers(x);for(const{source:L,sourceLayer:F}of z){const B=P.getFeatureState({id:t.id,source:L,sourceLayer:F});if(B&&!g)g=B;else if(!i.bn(g,B))return void this.fire(new i.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:x}=t.target,M=this.getLayer(x);g=this.getFeatureState({id:t.id,source:M.source,sourceLayer:M.sourceLayer})}return g}const s=t.source,h=t.sourceLayer,m=this._checkSource(s);if(m){if(m.type!=="vector"||h)return t.id===void 0&&this.fire(new i.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(h,t.id);this.fire(new i.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=i.l({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return i.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),s=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return i.cw({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateFilteredLayers(t){for(const s of Object.values(this._mergedLayers))t(s)&&this._updateLayer(s)}_updateLayer(t){this._changes.updateLayer(t);const s=this.getLayerSourceCache(t),h=i.C(t.source,t.scope),m=this._changes.getUpdatedSourceCaches();t.source&&!m[h]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),s.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const s=M=>this._mergedLayers[M].is3D(!!this.terrain),h=this.order,m={},g=[];for(let M=h.length-1;M>=0;M--){const P=h[M];if(s(P)){m[P]=M;for(const z of t){const L=z[P];if(L)for(const F of L)g.push(F)}}}g.sort((M,P)=>P.intersectionZ-M.intersectionZ);const x=[];for(let M=h.length-1;M>=0;M--){const P=h[M];if(s(P))for(let z=g.length-1;z>=0;z--){const L=g[z].feature;if(L.layer&&m[L.layer.id]<M)break;x.push(L),g.pop()}else for(const z of t){const L=z[P];if(L)for(const F of L)x.push(F.feature)}}return x}queryRenderedFeatures(t,s,h){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(Y,"queryRenderedFeatures.filter",s.filter,null,s),m=i.a_(s.filter));const g={},x=L=>{if(Wd.has(L.type))return;const F=this.getOwnLayerSourceCache(L),B=g[F.id]=g[F.id]||{sourceCache:F,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(B.has3DLayers=!0),B.layers[L.fqid]=B.layers[L.fqid]||{styleLayer:L,targets:[]},B.layers[L.fqid].targets.push({filter:m})};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new i.z(new Error("parameters.layers must be an Array."))),[];for(const L of s.layers){const F=this._layers[L];if(!F)return this.fire(new i.z(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];x(F)}}else for(const L in this._layers)x(this._layers[L]);const M=this._queryRenderedFeatures(t,g,h),P=this._flattenAndSortRenderedFeatures(M),z=[];for(const L of P)i.ct(L.layer.id)===this.scope&&z.push(L);return z}queryRenderedFeatureset(t,s,h){let m;s&&!Array.isArray(s)&&s.filter&&(this._validate(Y,"queryRenderedFeatures.filter",s.filter,null,s),m=i.a_(s.filter));const g="mock",x=[];if(s&&s.target)x.push(Object.assign({},s,{targetId:g,filter:m}));else{const L=this.getFeaturesetDescriptors();for(const F of L)x.push({targetId:g,filter:m,target:F});for(const{style:F}of this.fragments){const B=F.getFeaturesetDescriptors();for(const j of B)x.push({targetId:g,filter:m,target:j})}}const M=this.queryRenderedTargets(t,x,h),P=[],z=new Set;for(const L of M)for(const F of L.variants[g])Ac(F,L,z)||P.push(new i.cx(L,F));return P}queryRenderedTargets(t,s,h){const m={},g=(M,P,z,L)=>{const F=m[P.id]=m[P.id]||{sourceCache:P,layers:{},has3DLayers:!1};if(F.layers[M.fqid]=F.layers[M.fqid]||{styleLayer:M,targets:[]},M.is3D(!!this.terrain)&&(F.has3DLayers=!0),!L)return z.uniqueFeatureID=!1,void F.layers[M.fqid].targets.push(z);F.layers[M.fqid].targets.push(Object.assign({},z,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const M of s)if("featuresetId"in M.target){const{featuresetId:P,importId:z}=M.target,L=this.getFragmentStyle(z);if(!L||!L._featuresetSelectors)continue;const F=L._featuresetSelectors[P];if(!F){this.fire(new i.z(new Error(`The featureset '${P}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const B of F){const j=L.getOwnLayer(B.layerId);j&&!Wd.has(j.type)&&g(j,L.getOwnLayerSourceCache(j),M,B)}}else if("layerId"in M.target){const{layerId:P}=M.target,z=this.getLayer(P);if(!z||Wd.has(z.type))continue;g(z,this.getLayerSourceCache(z),M)}const x=this._queryRenderedFeatures(t,m,h);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(t,s,h){const m=[],g=!!this.map._showQueryGeometry,x=Yn.createFromScreenPoints(t,h);for(const M in s){const P=Mc(x,s[M],this._availableImages,h,g);Object.keys(P).length&&m.push(P)}if(this.placement)for(const M in s){if(!s[M].sourceCache._onlySymbols)continue;const P=kd(x.screenGeometry,s[M],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(P).length&&m.push(P)}return m}querySourceFeatures(t,s){const h=s&&s.filter;h&&this._validate(Y,"querySourceFeatures.filter",h,null,s);let m=[];const g=this.getOwnSourceCaches(t);for(const x of g)m=m.concat(Cm(x,s));return m}addSourceType(t,s,h){return os.getSourceType(t)?h(new Error(`A source type called "${t}" already exists.`)):(os.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,s,h={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const M in t)if(!i.bn(t[M],m[M])){g=!0;break}if(!g)return;const x=this._getTransitionParameters();this.light.setLight(t,s,h),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=i.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&i.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,s=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),s===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let h=t;const m=t.source==null;if(s===1){if(this.disableElevatedTerrain)return;if(typeof h.source=="object"){const M="terrain-dem-src";this.addSource(M,h.source),h=i.cq(h),h=i.l(h,{source:M})}const g=i.l({},h),x={};if(this.terrain&&m){g.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(x.style=M.serialize())}if(this._validate(xl,"terrain",g,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!m||this.terrain&&s!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,s),this.fire(new i.A("data",{dataType:"style"}))}else{const g=this.terrain,x=g.get();for(const M of Object.keys(i.a5.terrain))!h.hasOwnProperty(M)&&i.a5.terrain[M].default&&(h[M]=i.a5.terrain[M].default);for(const M in t)if(!i.bn(t[M],x[M])){g.set(t,this.options),this.stylesheet.terrain=t;const P=this._getTransitionParameters({duration:0});g.updateTransitions(P),this.fire(new i.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const s=this.fog=new Er(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createSnow(t){const s=this.snow=new ln(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_createRain(t){const s=this.rain=new on(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const s=this.snow;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.snow=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const s=this.rain;if(!i.bn(s.get(),t)){s.set(t,this.options),this.stylesheet.rain=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const m in this._layers)this._layers[m].lut=this._styleColorTheme.lut;for(const m in this._sourceCaches)this._sourceCaches[m].clearTiles()},s=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!s)return this._styleColorTheme.lut=null,void t();const h=this._evaluateColorThemeData(s);this._loadColorTheme(h).then(()=>{this.fire(new i.A("colorthemeset")),t()}).catch(m=>{i.w(`Couldn't set color theme: ${m}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&i.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,s){const h=this.getFragmentStyle(t);h&&(h._styleColorTheme.colorThemeOverride=s,h._reloadColorTheme())}_getTransitionParameters(t){return{now:i.q.now(),transition:i.l(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],s=[];for(const h of this._mergedOrder)this.isLayerDraped(this._mergedLayers[h])?t.push(h):s.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...s)}_createTerrain(t,s){const h=this.terrain=new He(t,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const m=this._getTransitionParameters({duration:0});h.updateTransitions(m)}_force3DLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const s=this._layers[t];s.type==="symbol"&&this._updateLayer(s)}}_validate(t,s,h,m,g={}){if(g&&g.validate===!1)return!1;const x=i.l({},this.serialize());return Za(this,t.call(vs,i.l({key:s,style:x,value:h,styleSpec:i.a5},m)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),i.cy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(t){const s=this.getSourceCaches(t);for(const h of s)h.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const s=this.getSourceCaches(t);for(const h of s)h.resume(),h.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let s;this.directionalLight&&(s=Ju(this.directionalLight));for(const h in this._mergedSourceCaches)this._mergedSourceCaches[h].update(t,void 0,void 0,s)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const s=this._sourceCaches[t];s.resume(),s.reload()}}_updatePlacement(t,s,h,m,g,x,M=!1){let P=!1,z=!1;const L={},F={};for(const B of this._mergedOrder){const j=this._mergedLayers[B];if(j.type!=="symbol")continue;const Z=i.C(j.source,j.scope);let H=L[Z];if(!H){const Q=this.getLayerSourceCache(j);if(!Q)continue;const oe=Q.getRenderableIds(!0).map(ue=>Q.getTileByID(ue));F[Z]=oe.slice(),H=L[Z]=oe.sort((ue,ce)=>ce.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(ce.tileID)?-1:1))}const J=this.crossTileSymbolIndex.addLayer(j,H,s.center.lng,s.projection);P=P||J}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged||m===0,this._layerOrderChanged&&this.fire(new i.A("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(i.q.now(),s.zoom))&&(this.pauseablePlacement=new Wu(s,this._mergedOrder,M,h,m,g,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,F,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(i.q.now()),z=!0),P&&this.pauseablePlacement.placement.setStale()),z||P){this._buildingIndex.onNewFrame(s.zoom);for(let B=0;B<this._mergedOrder.length;B++){const j=this._mergedLayers[this._mergedOrder[B]];if(j.type!=="symbol")continue;const Z=this.isLayerClipped(j);this.placement.updateLayerOpacities(j,L[i.C(j.source,j.scope)],B,Z?x:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(i.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,s){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:g})=>g===t.id)!==-1)return void this.fire(new i.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!s)return h.push(t),this._loadImports([t],!0);const m=h.findIndex(({id:g})=>g===s);return m===-1&&this.fire(new i.z(new Error(`Import with id "${s}" does not exist on this map.`))),this.stylesheet.imports=h.slice(0,m).concat(t).concat(h.slice(m)),this._loadImports([t],!0,s)}updateImport(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],m=this.getImportIndex(t);return m===-1?this:typeof s=="string"?(this.setImportUrl(t,s),this):(s.url&&s.url!==h[m].url&&this.setImportUrl(t,s.url),i.bn(s.config,h[m].config)||this.setImportConfig(t,s.config,s.data.schema),i.bn(s.data,h[m].data)||this.setImportData(t,s.data),this)}moveImport(t,s){this._checkLoaded();let h=this.stylesheet.imports||[];const m=this.getImportIndex(t);if(m===-1)return this;const g=this.getImportIndex(s);if(g===-1)return this;const x=h[m],M=this.fragments[m];return h=h.filter(({id:P})=>P!==t),this.fragments=this.fragments.filter(({id:P})=>P!==t),this.stylesheet.imports=h.slice(0,g).concat(x).concat(h.slice(g)),this.fragments=this.fragments.slice(0,g).concat(M).concat(this.fragments.slice(g)),this.mergeLayers(),this}setImportUrl(t,s){this._checkLoaded();const h=this.stylesheet.imports||[],m=this.getImportIndex(t);if(m===-1)return this;h[m].url=s;const g=this.fragments[m];return g.style=this._createFragmentStyle(h[m]),g.style.on("style.import.load",()=>this.mergeAll()),g.style.loadURL(s),this}setImportData(t,s){this._checkLoaded();const h=this.getImportIndex(t),m=this.stylesheet.imports||[];return h===-1?this:s?(this.fragments[h].style.setState(s),this._reloadImports(),this):(delete m[h].data,this.setImportUrl(t,m[h].url))}setImportConfig(t,s,h){this._checkLoaded();const m=this.getImportIndex(t),g=this.stylesheet.imports||[];if(m===-1)return this;s?g[m].config=s:delete g[m].config;const x=this.fragments[m];h&&x.style.stylesheet&&(x.style.stylesheet.schema=h);const M=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=s,x.style.updateConfig(s,M),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const s=this.stylesheet.imports||[],h=this.getImportIndex(t);h!==-1&&(s.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports())}getImportIndex(t){const s=(this.stylesheet.imports||[]).findIndex(h=>h.id===t);return s===-1&&this.fire(new i.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),s}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const s in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[s];h&&t.push(h.getSource())}return t}getSource(t,s){const h=this.getSourceCache(t,s);return h&&h.getSource()}getLayerSource(t){const s=this.getLayerSourceCache(t);return s&&s.getSource()}getSourceCache(t,s){const h=i.C(t,s);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(t){const s=i.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const s=[];return this._mergedOtherSourceCaches[t]&&s.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&s.push(this._mergedSymbolSourceCaches[t]),s}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const s in t){const h=t[s];h==="reload"?this.reloadSource(s):h==="clear"&&this.clearSource(s)}}updateLayers(t){const s=this._changes.getUpdatedPaintProperties();for(const h of s){const m=this.getLayer(h);m&&m.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,s,h){this.imageManager.getImages(s.images,s.scope,h),this._updateTilesForChangedImages();const m=x=>{if(x){const M=s.images.map(P=>i.I.toString(P));x.setDependencies(s.tileID.key,s.type,M)}},g=i.C(s.source,s.scope);m(this._mergedOtherSourceCaches[g]),m(this._mergedSymbolSourceCaches[g])}rasterizeImages(t,s,h){this.imageManager.rasterizeImages(s,h)}getGlyphs(t,s,h){this.glyphManager.getGlyphs(s.stacks,s.scope,h)}getResource(t,s,h){return i.cz(s,h)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const s=[];return this._otherSourceCaches[t]&&s.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&s.push(this._symbolSourceCaches[t]),s}_isSourceCacheLoaded(t){const s=this.getOwnSourceCaches(t);return s.length===0?(this.fire(new i.z(new Error(`There is no source with ID '${t}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,s){if(!this._clipLayerPresent&&t.type!=="fill-extrusion")return!1;const h=t.type==="fill-extrusion"&&t.sourceLayer==="building";if(t.is3D(!!this.terrain)){if(h||s&&s.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}os.getSourceType=function(d){return ja[d]},os.setSourceType=function(d,t){ja[d]=t},os.registerForPluginStateChange=i.ci;var Um=`
#define EPSILON 0.0000001\r
#define PI 3.141592653589793\r
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {\r
float near=cutoff_params.x;\r
float far=cutoff_params.y;\r
float cutoffStart=cutoff_params.z;\r
float cutoffEnd=cutoff_params.w;\r
float linearDepth=(depth-near)/(far-near);\r
return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);\r
}\r
#endif`,Xd=`
out vec4 glFragColor;\r
highp float unpack_depth(highp vec4 rgba_depth)\r
{\r
const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r
return dot(rgba_depth,bit_shift)*2.0-1.0;\r
}highp vec4 pack_depth(highp float ndc_z) {\r
highp float depth=ndc_z*0.5+0.5;\r
const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);\r
const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);\r
highp vec4 res=fract(depth*bit_shift);\r
res-=res.xxyz*bit_mask;\r
return res;\r
}\r
#ifdef INDICATOR_CUTOUT\r
uniform vec3 u_indicator_cutout_centers;\r
uniform vec4 u_indicator_cutout_params;\r
#endif\r
vec4 applyCutout(vec4 color,float height) {\r
#ifdef INDICATOR_CUTOUT\r
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));\r
float holeRadius=max(u_indicator_cutout_params.y,0.0);\r
float holeAspectRatio=u_indicator_cutout_params.z;\r
float fadeStart=u_indicator_cutout_params.w;\r
float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));\r
return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\r
#else\r
return color;\r
#endif\r
}\r
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\\r
glFragColor=vec4(0.7,0.0,0.0,0.7); \\\r
gl_FragDepth=gl_FragCoord.z-0.0001;
#else\r
#define HANDLE_WIREFRAME_DEBUG\r
#endif\r
#ifdef RENDER_CUTOFF\r
uniform highp vec4 u_cutoff_params;\r
in float v_cutoff_opacity;\r
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {\r
highp vec2 size=vec2(textureSize(image,0));\r
highp vec2 dx=dFdx(lod_coord.xy*size);\r
highp vec2 dy=dFdy(lod_coord.xy*size);\r
highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));\r
highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);\r
}\r
vec4 applyLUT(highp sampler3D lut,vec4 col) {\r
vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;\r
return vec4(texture(lut,uvw).rgb,col.a);\r
}\r
vec3 applyLUT(highp sampler3D lut,vec3 col) {\r
return applyLUT(lut,vec4(col,1.0)).rgb;\r
}`,th=`
#define EXTENT 8192.0\r
#define RAD_TO_DEG 180.0/PI\r
#define DEG_TO_RAD PI/180.0\r
#define GLOBE_RADIUS EXTENT/PI/2.0\r
float wrap(float n,float min,float max) {\r
float d=max-min;\r
float w=mod(mod(n-min,d)+d,d)+min;\r
return (w==min) ? max : w;\r
}\r
#ifdef PROJECTION_GLOBE_VIEW\r
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\r
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;\r
vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;\r
mercator-=mercator_center;\r
mercator.x=wrap(mercator.x,-0.5,0.5);\r
vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);\r
mercator_tile=matrix*mercator_tile;\r
return mercator_tile.xyz;\r
#else\r
return vec3(0.0);\r
#endif\r
}\r
vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\r
return mix(globe,mercator,t);\r
}\r
mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {\r
vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));\r
vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));\r
vec3 yAxis=normalize(cross(normal,xAxis));\r
return mat3(xAxis,yAxis,normal);\r
}\r
#endif
vec2 unpack_float(const float packedValue) {\r
int packedIntValue=int(packedValue);\r
int v0=packedIntValue/256;\r
return vec2(v0,packedIntValue-v0*256);\r
}\r
vec2 unpack_opacity(const float packedOpacity) {\r
int intOpacity=int(packedOpacity)/2;\r
return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));\r
}vec4 decode_color(const vec2 encodedColor) {\r
return vec4(\r
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\r
);\r
}float unpack_mix_vec2(const vec2 packedValue,const float t) {\r
return mix(packedValue[0],packedValue[1],t);\r
}vec4 unpack_mix_color(const vec4 packedColors,const float t) {\r
vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));\r
vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));\r
return mix(minColor,maxColor,t);\r
}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {\r
vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);\r
return (units_to_pixels*pos+offset)/pattern_size;\r
}\r
vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {\r
return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);\r
}\r
float mercatorXfromLng(float lng) {\r
return (180.0+lng)/360.0;\r
}\r
float mercatorYfromLat(float lat) {\r
return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;\r
}\r
vec3 latLngToECEF(vec2 latLng) {\r
latLng=DEG_TO_RAD*latLng;\r
float cosLat=cos(latLng[0]);\r
float sinLat=sin(latLng[0]);\r
float cosLng=cos(latLng[1]);\r
float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;\r
float sy=-sinLat*GLOBE_RADIUS;\r
float sz=cosLat*cosLng*GLOBE_RADIUS;\r
return vec3(sx,sy,sz);\r
}\r
#ifdef RENDER_CUTOFF\r
uniform vec4 u_cutoff_params;\r
out float v_cutoff_opacity;\r
#endif\r
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;\r
vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\r
{\r
float skirt=float(posWithComposedSkirt.x >=skirtOffset);\r
vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);\r
return vec3(pos,skirt);\r
}`,Fc=`in highp vec3 a_pos_3f;\r
uniform lowp mat4 u_matrix;\r
out highp vec3 v_uv;\r
void main() {\r
const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);\r
v_uv=half_neg_pi_around_x*a_pos_3f;\r
vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;\r
}`,rh=`
#define ELEVATION_SCALE 7.0\r
#define ELEVATION_OFFSET 450.0\r
#ifdef PROJECTION_GLOBE_VIEW\r
uniform vec3 u_tile_tl_up;\r
uniform vec3 u_tile_tr_up;\r
uniform vec3 u_tile_br_up;\r
uniform vec3 u_tile_bl_up;\r
uniform float u_tile_up_scale;\r
vec3 elevationVector(vec2 pos) {\r
vec2 uv=pos/EXTENT;\r
vec3 up=normalize(mix(\r
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));\r
return up*u_tile_up_scale;\r
}\r
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\r
#endif
#ifdef TERRAIN\r
uniform highp sampler2D u_dem;\r
uniform highp sampler2D u_dem_prev;\r
uniform vec2 u_dem_tl;\r
uniform vec2 u_dem_tl_prev;\r
uniform float u_dem_scale;\r
uniform float u_dem_scale_prev;\r
uniform float u_dem_size;uniform float u_dem_lerp;\r
uniform float u_exaggeration;\r
uniform float u_meter_to_dem;\r
uniform mat4 u_label_plane_matrix_inv;\r
vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {\r
vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;\r
vec2 f=fract(pos);\r
return vec4((pos-f+0.5)/(dem_size+2.0),f);\r
}\r
float currentElevation(vec2 apos) {\r
#ifdef TERRAIN_DEM_FLOAT_FORMAT\r
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);\r
return u_exaggeration*texture(u_dem,pos).r;\r
#else
float dd=1.0/(u_dem_size+2.0);\r
vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);\r
vec2 pos=r.xy;\r
vec2 f=r.zw;\r
float tl=texture(u_dem,pos).r;\r
float tr=texture(u_dem,pos+vec2(dd,0)).r;\r
float bl=texture(u_dem,pos+vec2(0,dd)).r;\r
float br=texture(u_dem,pos+vec2(dd,dd)).r;\r
return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\r
#endif
}\r
float prevElevation(vec2 apos) {\r
#ifdef TERRAIN_DEM_FLOAT_FORMAT\r
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);\r
return u_exaggeration*texture(u_dem_prev,pos).r;\r
#else
float dd=1.0/(u_dem_size+2.0);\r
vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);\r
vec2 pos=r.xy;\r
vec2 f=r.zw;\r
float tl=texture(u_dem_prev,pos).r;\r
float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;\r
float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;\r
float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;\r
return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\r
#endif
}\r
#ifdef TERRAIN_VERTEX_MORPHING\r
float elevation(vec2 apos) {\r
#ifdef ZERO_EXAGGERATION\r
return 0.0;\r
#endif
float nextElevation=currentElevation(apos);\r
float prevElevation=prevElevation(apos);\r
return mix(prevElevation,nextElevation,u_dem_lerp);\r
}\r
#else
float elevation(vec2 apos) {\r
#ifdef ZERO_EXAGGERATION\r
return 0.0;\r
#endif
return currentElevation(apos);\r
}\r
#endif
vec4 fourSample(vec2 pos,vec2 off) {\r
float tl=texture(u_dem,pos).r;\r
float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;\r
float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;\r
float br=texture(u_dem,pos+off).r;\r
return vec4(tl,tr,bl,br);\r
}\r
float flatElevation(vec2 pack) {\r
vec2 apos=floor(pack/8.0);\r
vec2 span=10.0*(pack-apos*8.0);\r
vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;\r
float size=u_dem_size+2.0;\r
float dd=1.0/size;\r
vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;\r
vec2 f=fract(pos);\r
pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));\r
float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);\r
vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));\r
vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));\r
vec4 diff=abs(h.xzxy-h.ywzw);\r
vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));\r
vec2 fix=slope*span;\r
float base=z+max(fix.x,fix.y);\r
return u_exaggeration*base;\r
}\r
float elevationFromUint16(float word) {\r
return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);\r
}
#else
float elevation(vec2 pos) { return 0.0; }\r
#endif\r
#ifdef DEPTH_OCCLUSION\r
uniform highp sampler2D u_depth;\r
uniform highp vec2 u_depth_size_inv;\r
uniform highp vec2 u_depth_range_unpack;\r
uniform highp float u_occluder_half_size;\r
uniform highp float u_occlusion_depth_offset;\r
#ifdef DEPTH_D24\r
float unpack_depth(float depth) {\r
return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;\r
}\r
vec4 unpack_depth4(vec4 depth) {\r
return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);\r
}\r
#else
highp float unpack_depth_rgba(vec4 rgba_depth)\r
{\r
const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r
return dot(rgba_depth,bit_shift)*2.0-1.0;\r
}\r
#endif
bool isOccluded(vec4 frag) {\r
vec3 coord=frag.xyz/frag.w;\r
#ifdef DEPTH_D24\r
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\r
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\r
#endif
return coord.z+u_occlusion_depth_offset > depth;\r
}\r
highp vec4 getCornerDepths(vec2 coord) {\r
highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);\r
highp vec2 uv=0.5*coord.xy+0.5;\r
#ifdef DEPTH_D24\r
highp vec4 depth=vec4(\r
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\r
);\r
depth=unpack_depth4(depth);\r
#else
highp vec4 depth=vec4(\r
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\r
);\r
#endif
return depth;\r
}highp float occlusionFadeMultiSample(vec4 frag) {\r
highp vec3 coord=frag.xyz/frag.w;\r
highp vec2 uv=0.5*coord.xy+0.5;\r
int NX=3;\r
int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;\r
highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);\r
highp float res=0.0;\r
for (int y=0; y < NY;++y) {\r
for (int x=0; x < NX;++x) {\r
#ifdef DEPTH_D24\r
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\r
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\r
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);\r
}\r
}\r
res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);\r
return res;\r
}highp float occlusionFade(vec4 frag) {\r
highp vec3 coord=frag.xyz/frag.w;\r
highp vec4 depth=getCornerDepths(coord.xy);\r
return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));\r
}\r
#else
bool isOccluded(vec4 frag) { return false; }\r
highp float occlusionFade(vec4 frag) { return 1.0; }\r
highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\r
#endif//DEPTH_OCCLUSION`,ga=`#ifdef FOG\r
uniform mediump vec4 u_fog_color;\r
uniform mediump vec2 u_fog_range;\r
uniform mediump float u_fog_horizon_blend;\r
uniform mediump mat4 u_fog_matrix;\r
out vec3 v_fog_pos;\r
float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);\r
}float fog_horizon_blending(vec3 camera_dir) {\r
float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);\r
}float fog_opacity(float t) {\r
const float decay=6.0;\r
float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);\r
}\r
vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;\r
}\r
vec3 fog_position(vec2 pos) {\r
return fog_position(vec3(pos,0.0));\r
}\r
float fog(vec3 pos) {\r
float depth=length(pos);\r
float opacity=fog_opacity(fog_range(depth));\r
return opacity*fog_horizon_blending(pos/depth);\r
}\r
#endif`,nh=`#ifdef FOG\r
uniform mediump vec4 u_fog_color;\r
uniform mediump vec2 u_fog_range;\r
uniform mediump float u_fog_horizon_blend;\r
uniform mediump vec2 u_fog_vertical_limit;\r
uniform mediump float u_fog_temporal_offset;\r
in vec3 v_fog_pos;\r
uniform highp vec3 u_frustum_tl;\r
uniform highp vec3 u_frustum_tr;\r
uniform highp vec3 u_frustum_br;\r
uniform highp vec3 u_frustum_bl;\r
uniform highp vec3 u_globe_pos;\r
uniform highp float u_globe_radius;\r
uniform highp vec2 u_viewport;\r
uniform float u_globe_transition;\r
uniform int u_is_globe;\r
float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);\r
}float fog_horizon_blending(vec3 camera_dir) {\r
float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);\r
}float fog_opacity(float t) {\r
const float decay=6.0;\r
float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);\r
}\r
float globe_glow_progress() {\r
highp vec2 uv=gl_FragCoord.xy/u_viewport;\r
highp vec3 ray_dir=mix(\r
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);\r
highp vec3 dir=normalize(ray_dir);\r
highp vec3 closest_point=dot(u_globe_pos,dir)*dir;\r
highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;\r
return sdf+PI*0.5;\r
}float fog_opacity(vec3 pos) {\r
float depth=length(pos);\r
return fog_opacity(fog_range(depth));\r
}\r
vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {\r
float depth=length(pos);\r
float opacity;\r
if (u_is_globe==1) {\r
float glow_progress=globe_glow_progress();\r
float t=mix(glow_progress,depth,u_globe_transition);\r
opacity=fog_opacity(fog_range(t));\r
} else {\r
opacity=fog_opacity(fog_range(depth));\r
opacity*=fog_horizon_blending(pos/depth);\r
}\r
return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));\r
}\r
vec3 fog_apply(vec3 color,vec3 pos) {\r
return fog_apply(color,pos,1.0);\r
}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {\r
float alpha=EPSILON+color.a;\r
color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;\r
return color;\r
}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {\r
float horizon_blend=fog_horizon_blending(normalize(camera_ray));\r
return mix(sky_color,u_fog_color.rgb,horizon_blend);\r
}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {\r
float alpha=EPSILON+color.a;\r
color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;\r
return color;\r
}\r
vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {\r
float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));\r
return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));\r
}\r
vec3 fog_dither(vec3 color) {\r
return color;\r
}\r
vec4 fog_dither(vec4 color) {\r
return vec4(fog_dither(color.rgb),color.a);\r
}\r
#endif`,Kd=`#ifdef RASTER_ARRAY\r
uniform highp sampler2D u_image0;\r
uniform sampler2D u_image1;\r
const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {\r
texCoord=texCoord*texResolution-0.5;\r
fxy=fract(texCoord);\r
texCoord-=fxy;\r
return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);\r
}\r
vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);\r
vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);\r
vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);\r
vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);\r
return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);\r
}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec2 fxy;\r
ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);\r
return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\r
);\r
}\r
vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec2 fxy;\r
ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);\r
return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\r
);\r
}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);\r
return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);\r
}\r
vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {\r
vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);\r
return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);\r
}\r
#endif`,Xa=`#ifdef RASTER_ARRAY\r
uniform sampler2D u_velocity;\r
uniform mediump vec2 u_velocity_res;\r
uniform mediump float u_max_speed;\r
const vec4 NO_DATA=vec4(1);\r
const vec2 INVALID_VELOCITY=vec2(-1);\r
uniform highp vec2 u_uv_offset;\r
uniform highp float u_data_offset;\r
uniform highp vec2 u_data_scale;\r
ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {\r
texCoord=texCoord*texResolution-0.5;\r
fxy=fract(texCoord);\r
texCoord-=fxy;\r
return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);\r
}\r
highp vec2 lookup_velocity(highp vec2 uv) {\r
uv=u_uv_offset.x+u_uv_offset.y*uv;\r
highp vec2 fxy;\r
ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);\r
highp vec4 tl=texelFetch(u_velocity,c.yz,0);\r
highp vec4 tr=texelFetch(u_velocity,c.xz,0);\r
highp vec4 bl=texelFetch(u_velocity,c.yw,0);\r
highp vec4 br=texelFetch(u_velocity,c.xw,0);\r
if (tl==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
if (tr==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
if (bl==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
if (br==NO_DATA) {\r
return INVALID_VELOCITY;\r
}\r
highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);\r
highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));\r
velocity.y=-velocity.y;\r
velocity/=max(u_max_speed,length(velocity));\r
return velocity;\r
}\r
#endif\r
uniform highp float u_particle_pos_scale;\r
uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {\r
highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;\r
highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));\r
return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);\r
}\r
highp vec2 unpack_pos_from_rgba(highp vec4 v) {\r
v=floor(v*255.0+0.5)/255.0;\r
highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));\r
return u_particle_pos_scale*p-u_particle_pos_offset;\r
}`,Il=`#ifdef RENDER_SHADOWS\r
uniform mediump vec3 u_shadow_direction;\r
uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {\r
float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);\r
float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;\r
return n*dotScale;\r
}\r
vec3 shadow_normal_offset_model(vec3 normal) {\r
vec3 transformed_normal=vec3(-normal.xy,normal.z);\r
float NDotL=dot(normalize(transformed_normal),u_shadow_direction);\r
float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;\r
return normal*dotScale;\r
}\r
float shadow_normal_offset_multiplier0() {\r
return u_shadow_normal_offset[1];\r
}\r
float shadow_normal_offset_multiplier1() {\r
return u_shadow_normal_offset[2];\r
}\r
#endif//RENDER_SHADOWS`,Bc=`#ifdef RENDER_SHADOWS\r
#ifdef DEPTH_TEXTURE\r
uniform highp sampler2D u_shadowmap_0;\r
uniform highp sampler2D u_shadowmap_1;\r
#else\r
uniform sampler2D u_shadowmap_0;\r
uniform sampler2D u_shadowmap_1;\r
#endif\r
uniform float u_shadow_intensity;\r
uniform float u_shadow_map_resolution;\r
uniform float u_shadow_texel_size;\r
uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;\r
uniform mediump vec3 u_shadow_direction;\r
uniform highp vec3 u_shadow_bias;\r
highp float shadow_sample_1(highp vec2 uv,highp float compare) {\r
highp float shadow_depth;\r
#ifdef DEPTH_TEXTURE\r
shadow_depth=texture(u_shadowmap_1,uv).r;\r
#else\r
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;\r
#endif\r
return step(shadow_depth,compare);\r
}\r
highp float shadow_sample_0(highp vec2 uv,highp float compare) {\r
highp float shadow_depth;\r
#ifdef DEPTH_TEXTURE\r
shadow_depth=texture(u_shadowmap_0,uv).r;\r
#else\r
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;\r
#endif\r
return step(shadow_depth,compare);\r
}\r
float shadow_occlusion_1(highp vec4 pos,highp float bias) {\r
highp vec2 uv=pos.xy;\r
return shadow_sample_1(uv,pos.z-bias);\r
}\r
float shadow_occlusion_0(highp vec4 pos,highp float bias) {\r
highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER\r
highp vec2 uv=pos.xy;\r
highp vec4 samples=textureGather(u_shadowmap_0,uv,0);\r
lowp vec4 stepSamples=step(samples,vec4(compare0));\r
#else\r
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);\r
highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);\r
highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);\r
highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);\r
lowp vec4 stepSamples=vec4(\r
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)\r
);\r
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));\r
lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);\r
return clamp(mix(lerpx.x,lerpx.y,f.y),0.0,1.0);\r
}\r
float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {\r
#ifdef SHADOWS_SINGLE_CASCADE\r
light_view_pos0.xyz/=light_view_pos0.w;\r
vec2 abs_bounds=abs(light_view_pos0.xy);\r
if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {\r
return 0.0;\r
}\r
light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;\r
return shadow_occlusion_0(light_view_pos0,bias);\r
#else
light_view_pos0.xyz/=light_view_pos0.w;\r
light_view_pos1.xyz/=light_view_pos1.w;\r
vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);\r
vec4 abs_bounds=abs(uv);\r
if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {\r
light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;\r
return shadow_occlusion_0(light_view_pos0,bias);\r
}\r
if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {\r
return 0.0;\r
}\r
light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;\r
float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\r
#endif
}\r
highp float calculate_shadow_bias(float NDotL) {\r
#ifdef NORMAL_OFFSET\r
return 0.5*u_shadow_bias.x;\r
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\r
#endif\r
}\r
float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float NDotL=dot(N,u_shadow_direction);\r
float bias=calculate_shadow_bias(NDotL);\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r
}\r
float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {\r
float NDotL=dot(N,u_shadow_direction);\r
float bias=calculate_shadow_bias(NDotL);\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;\r
return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r
}\r
float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float NDotL=dot(N,u_shadow_direction);\r
float bias=0.0;\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));\r
}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\r
{\r
highp vec2 biasUV=vec2(\r
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);\r
biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));\r
return biasUV;\r
}\r
float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;\r
highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);\r
highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);\r
highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);\r
highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return 1.0-(u_shadow_intensity*occlusion);\r
}\r
float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float bias=0.0;\r
float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
return 1.0-(u_shadow_intensity*occlusion);\r
}\r
float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {\r
float bias=calculate_shadow_bias(ndotl);\r
return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);\r
}\r
#endif`;const Ka=[];Ho(Um,Ka),Ho(th,Ka),Ho(Xd,Ka);const qo={"_prelude_fog.vertex.glsl":ga,"_prelude_terrain.vertex.glsl":rh,"_prelude_shadow.vertex.glsl":Il,"_prelude_fog.fragment.glsl":nh,"_prelude_shadow.fragment.glsl":Bc,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;\r
uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;\r
uniform mediump vec3 u_ground_radiance;\r
float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;\r
float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));\r
float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;\r
float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);\r
return vertical_factor*ambient_directional_factor;\r
}vec3 linearProduct(vec3 srgbIn,vec3 k) {\r
return srgbIn*pow(k,vec3(1./2.2));\r
}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);\r
vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;\r
vec3 directional_contrib=u_lighting_directional_color*dir_factor;\r
return linearProduct(color,ambient_contrib+directional_contrib);\r
}\r
vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {\r
return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);\r
}vec3 apply_lighting(vec3 color,vec3 normal) {\r
float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);\r
return apply_lighting(color.rgb,normal,dir_factor);\r
}\r
vec4 apply_lighting(vec4 color,vec3 normal) {\r
float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);\r
return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);\r
}\r
vec3 apply_lighting_ground(vec3 color) {\r
return color*u_ground_radiance;\r
}\r
vec4 apply_lighting_ground(vec4 color) {\r
return vec4(apply_lighting_ground(color.rgb),color.a);\r
}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);\r
}\r
vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {\r
return mix(apply_lighting_ground(color),color,emissive_strength);\r
}\r
vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);\r
float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);\r
return mix(fully_occluded_color,flood_light_color,occlusion_ramp);\r
}\r
vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {\r
vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);\r
return mix(fully_occluded_color,unlit_color,1.0-occlusion);\r
}\r
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Kd,"_prelude_raster_particle.glsl":Xa},Ya={};kr("",rh),kr(nh,ga),kr(Bc,Il),kr(Kd,""),kr(Xa,"");const ih=kr(Xd,th),Yd=Um;var sh={background:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform vec4 u_color;\r
uniform float u_opacity;\r
#ifdef LIGHTING_3D_MODE\r
in vec4 v_color;\r
#endif\r
void main() {\r
vec4 out_color;\r
#ifdef LIGHTING_3D_MODE\r
out_color=v_color;\r
#else\r
out_color=u_color;\r
#endif\r
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*u_opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_lighting.glsl"\r
in vec2 a_pos;\r
uniform mat4 u_matrix;\r
#ifdef LIGHTING_3D_MODE\r
uniform mediump vec4 u_color;\r
out vec4 v_color;\r
uniform float u_emissive_strength;\r
#endif\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
#ifdef LIGHTING_3D_MODE\r
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),backgroundPattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform vec2 u_pattern_tl;\r
uniform vec2 u_pattern_br;\r
uniform vec2 u_texsize;\r
uniform float u_opacity;\r
uniform float u_emissive_strength;\r
uniform sampler2D u_image;\r
in highp vec2 v_pos;\r
void main() {\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);\r
vec4 out_color=textureLodCustom(u_image,pos,v_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*u_opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_pattern_size;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform vec2 u_pattern_units_to_pixels;\r
in vec2 a_pos;\r
out highp vec2 v_pos;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),circle:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
in vec3 v_data;\r
in float v_visibility;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define mediump float radius\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp vec4 stroke_color\r
#pragma mapbox: define mediump float stroke_width\r
#pragma mapbox: define lowp float stroke_opacity\r
uniform float u_emissive_strength;\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize mediump float radius\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp vec4 stroke_color\r
#pragma mapbox: initialize mediump float stroke_width\r
#pragma mapbox: initialize lowp float stroke_opacity\r
vec2 extrude=v_data.xy;\r
float blur_positive=blur < 0.0 ? 0.0 : 1.0;\r
lowp float antialiasblur=v_data.z;\r
float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);\r
float antialiased_blur=-max(abs(blur),antialiasblur);\r
float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);\r
float opacity_t=blur_positive==1.0 ? \r
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \r
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;\r
float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\r
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\r
);\r
vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
out_color=fog_apply_premultiplied(out_color,v_fog_pos);\r
#endif\r
glFragColor=out_color*(v_visibility*opacity_t);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
#define NUM_VISIBILITY_RINGS 2\r
#define INV_SQRT2 0.70710678\r
#define ELEVATION_BIAS 0.0001\r
#define NUM_SAMPLES_PER_RING 16\r
uniform mat4 u_matrix;\r
uniform mat2 u_extrude_scale;\r
uniform lowp float u_device_pixel_ratio;\r
uniform highp float u_camera_to_center_distance;\r
in vec2 a_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
#endif\r
#ifdef ELEVATED_ROADS\r
in float a_circle_z_offset;\r
#endif\r
out vec3 v_data;\r
out float v_visibility;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define mediump float radius\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp vec4 stroke_color\r
#pragma mapbox: define mediump float stroke_width\r
#pragma mapbox: define lowp float stroke_opacity\r
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {\r
return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;\r
}\r
float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {\r
vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);\r
vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);\r
vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);\r
vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);\r
float h1=elevation(c1)+ELEVATION_BIAS;\r
float h2=elevation(c2)+ELEVATION_BIAS;\r
float h3=elevation(c3)+ELEVATION_BIAS;\r
float h4=elevation(c4)+ELEVATION_BIAS;\r
return max(h4,max(h3,max(h1,h2)));\r
}\r
float circle_elevation(vec2 pos) {\r
#if defined(TERRAIN)\r
return elevation(pos)+ELEVATION_BIAS;\r
#else\r
return 0.0;\r
#endif\r
}\r
vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {\r
vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\r
#ifdef PITCH_WITH_MAP\r
#ifdef PROJECTION_GLOBE_VIEW\r
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\r
#else\r
return u_matrix*( world_center+vec4(sample_offset,0,0) );\r
#endif\r
#else\r
return projected_center+vec4(sample_offset,0,0);\r
#endif\r
}\r
float get_sample_step() {\r
#ifdef PITCH_WITH_MAP\r
return 2.0*PI/float(NUM_SAMPLES_PER_RING);\r
#else
return PI/float(NUM_SAMPLES_PER_RING);\r
#endif\r
}\r
void main(void) {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize mediump float radius\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp vec4 stroke_color\r
#pragma mapbox: initialize mediump float stroke_width\r
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\r
vec4 world_center;\r
mat3 surface_vectors;\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;\r
surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);\r
vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];\r
vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);\r
vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;\r
vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;\r
vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
world_center=vec4(pos,1);\r
#else \r
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);\r
world_center=vec4(circle_center,height,1);\r
#endif\r
#ifdef ELEVATED_ROADS\r
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;\r
#endif\r
vec4 projected_center=u_matrix*world_center;\r
float view_scale=0.0;\r
#ifdef PITCH_WITH_MAP\r
#ifdef SCALE_WITH_MAP\r
view_scale=1.0;\r
#else
view_scale=projected_center.w/u_camera_to_center_distance;\r
#endif\r
#else\r
#ifdef SCALE_WITH_MAP\r
view_scale=u_camera_to_center_distance;\r
#else\r
view_scale=projected_center.w;\r
#endif\r
#endif\r
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);\r
float visibility=0.0;\r
#ifdef TERRAIN\r
float step=get_sample_step();\r
vec4 occlusion_world_center;\r
vec4 occlusion_projected_center;\r
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);\r
occlusion_world_center=vec4(circle_center,cantilevered_height,1);\r
occlusion_projected_center=u_matrix*occlusion_world_center;\r
#else\r
occlusion_world_center=world_center;\r
occlusion_projected_center=projected_center;\r
#endif\r
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {\r
float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);\r
for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {\r
vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;\r
vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);\r
visibility+=float(!isOccluded(frag_pos));\r
}\r
}\r
visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\r
#else\r
visibility=1.0;\r
#endif
#ifdef PROJECTION_GLOBE_VIEW\r
visibility=1.0;\r
#endif\r
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);\r
v_data=vec3(extrude.x,extrude.y,antialiasblur);\r
#ifdef FOG\r
v_fog_pos=fog_position(world_center.xyz);\r
#endif\r
}`),clippingMask:kr(`void main() {\r
glFragColor=vec4(1.0);\r
}`,`in vec2 a_pos;\r
uniform mat4 u_matrix;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
}`),heatmap:kr(`#include "_prelude_fog.fragment.glsl"\r
uniform highp float u_intensity;\r
in vec2 v_extrude;\r
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327\r
void main() {\r
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);\r
float val=weight*u_intensity*GAUSS_COEF*exp(d);\r
glFragColor=vec4(val,1.0,1.0,1.0);\r
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\r
}\r
#endif\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform float u_extrude_scale;\r
uniform float u_opacity;\r
uniform float u_intensity;\r
in vec2 a_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
#endif\r
out vec2 v_extrude;\r
#pragma mapbox: define highp float weight\r
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327\r
void main(void) {\r
#pragma mapbox: initialize highp float weight\r
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\r
vec3 pos;\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;\r
mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);\r
vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];\r
vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);\r
vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;\r
vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;\r
pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
#else\r
pos=vec3(tilePos+extrude,elevation(tilePos));\r
#endif\r
gl_Position=u_matrix*vec4(pos,1);\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
}`),heatmapTexture:kr(`uniform sampler2D u_image;\r
uniform sampler2D u_color_ramp;\r
uniform float u_opacity;\r
in vec2 v_pos;\r
void main() {\r
float t=texture(u_image,v_pos).r;\r
vec4 color=texture(u_color_ramp,vec2(t,0.5));\r
glFragColor=color*u_opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(0.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`in vec2 a_pos;\r
out vec2 v_pos;\r
void main() {\r
gl_Position=vec4(a_pos,0,1);\r
v_pos=a_pos*0.5+0.5;\r
}`),collisionBox:kr(`in float v_placed;\r
in float v_notUsed;\r
void main() {\r
vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;\r
glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in vec3 a_pos;\r
in vec2 a_anchor_pos;\r
in vec2 a_extrude;\r
in vec2 a_placed;\r
in vec2 a_shift;\r
in vec2 a_elevation_from_sea;\r
in float a_size_scale;\r
in vec2 a_padding;\r
in float a_auto_z_offset;\r
uniform mat4 u_matrix;\r
uniform vec2 u_extrude_scale;\r
uniform float u_camera_to_center_distance;\r
out float v_placed;\r
out float v_notUsed;\r
void main() {\r
float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;\r
float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));\r
vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);\r
highp float camera_to_anchor_distance=projectedPoint.w;\r
highp float collision_perspective_ratio=clamp(\r
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);\r
gl_Position=projectedPoint;\r
gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;\r
v_placed=a_placed.x;\r
v_notUsed=a_placed.y;\r
}`),collisionCircle:kr(`in float v_radius;\r
in vec2 v_extrude;\r
in float v_perspective_ratio;\r
in float v_collision;\r
void main() {\r
float alpha=0.5*min(v_perspective_ratio,1.0);\r
float stroke_radius=0.9*max(v_perspective_ratio,1.0);\r
float distance_to_center=length(v_extrude);\r
float distance_to_edge=abs(distance_to_center-v_radius);\r
float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);\r
vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);\r
glFragColor=color*alpha*opacity_t;\r
}`,`in vec2 a_pos_2f;\r
in float a_radius;\r
in vec2 a_flags;\r
uniform mat4 u_matrix;\r
uniform mat4 u_inv_matrix;\r
uniform vec2 u_viewport_size;\r
uniform float u_camera_to_center_distance;\r
out float v_radius;\r
out vec2 v_extrude;\r
out float v_perspective_ratio;\r
out float v_collision;\r
vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);\r
vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);\r
rayStart.xyz/=rayStart.w;\r
rayEnd.xyz  /=rayEnd.w;\r
highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);\r
return mix(rayStart.xyz,rayEnd.xyz,t);\r
}\r
void main() {\r
vec2 quadCenterPos=a_pos_2f;\r
float radius=a_radius;\r
float collision=a_flags.x;\r
float vertexIdx=a_flags.y;\r
vec2 quadVertexOffset=vec2(\r
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));\r
vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);\r
vec4 clipPos=u_matrix*vec4(tilePos,1.0);\r
highp float camera_to_anchor_distance=clipPos.w;\r
highp float collision_perspective_ratio=clamp(\r
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;\r
v_radius=radius;\r
v_extrude=quadVertexExtent*padding_factor;\r
v_perspective_ratio=collision_perspective_ratio;\r
v_collision=collision;\r
gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);\r
}`),debug:kr(`uniform highp vec4 u_color;\r
uniform sampler2D u_overlay;\r
in vec2 v_uv;\r
void main() {\r
vec4 overlay_color=texture(u_overlay,v_uv);\r
glFragColor=mix(u_color,overlay_color,overlay_color.a);\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in vec2 a_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;\r
#endif\r
out vec2 v_uv;\r
uniform mat4 u_matrix;\r
uniform float u_overlay_scale;\r
void main() {float h=elevation(a_pos);\r
v_uv=a_pos/8192.0;\r
#ifdef PROJECTION_GLOBE_VIEW\r
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\r
#else\r
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\r
#endif\r
}`),elevatedStructuresDepth:kr(`void main() {\r
#ifndef DEPTH_TEXTURE\r
glFragColor=vec4(0.);\r
#endif\r
}`,`in vec2 a_pos;\r
in float a_height;\r
uniform mat4 u_matrix;\r
uniform float u_depth_bias;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,a_height,1);\r
gl_Position.z=gl_Position.z+u_depth_bias;\r
}`),elevatedStructuresDepthReconstruct:kr(`#ifdef DEPTH_RECONSTRUCTION\r
in float v_height;\r
#endif\r
void main() {\r
#ifdef DEPTH_RECONSTRUCTION\r
if (v_height >=0.0)\r
discard;\r
#endif\r
glFragColor=vec4(1.0,0.0,0.0,1.0);\r
}`,`in vec2 a_pos;\r
in float a_height;\r
uniform mat4 u_matrix;\r
uniform vec3 u_camera_pos;\r
uniform highp float u_depth_bias;\r
uniform lowp float u_height_scale;\r
uniform lowp float u_reset_depth;\r
#ifdef DEPTH_RECONSTRUCTION\r
out float v_height;\r
#endif\r
void main() {\r
vec3 vpos=vec3(a_pos,a_height*u_height_scale);\r
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {\r
vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));\r
}\r
v_height=a_height;\r
#endif\r
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;\r
}`),elevatedStructures:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
in vec3 v_normal;\r
in float v_height;\r
#ifdef RENDER_SHADOWS\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in float v_depth;\r
#endif\r
void main() {\r
vec3 color=vec3(241.0/255.0,236.0/255.0,225.0/255.0);\r
#ifdef LIGHTING_3D_MODE\r
vec3 normal=normalize(v_normal);\r
#ifdef RENDER_SHADOWS\r
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\r
#else
color=apply_lighting(color,normal);\r
#endif
if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);\r
float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);\r
color=color*(1.0-pow(occlusion,2.0)*0.3);\r
}\r
#endif
#ifdef FOG\r
color=fog_apply(color,v_fog_pos);\r
#endif\r
vec4 out_color=vec4(color,1.0);\r
#ifdef INDICATOR_CUTOUT\r
out_color=applyCutout(out_color,v_height);\r
#endif\r
glFragColor=out_color;\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec2 a_pos;\r
in float a_height;\r
in vec3 a_pos_normal_3;\r
uniform mat4 u_matrix;\r
out vec3 v_normal;\r
out float v_height;\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out float v_depth;\r
#endif\r
void main() {\r
v_normal=a_pos_normal_3/16384.0;\r
v_height=a_height;\r
vec3 pos=vec3(a_pos,a_height);\r
gl_Position=u_matrix*vec4(pos,1);\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=pos;\r
vec3 shd_pos1=pos;\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(v_normal);\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fill:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float opacity\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float opacity\r
vec4 out_color=color;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
out_color*=opacity;\r
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {\r
out_color=applyCutout(out_color,v_z_offset);\r
}\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif\r
uniform mat4 u_matrix;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp float z_offset\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=z_offset;\r
#endif\r
}`),fillOutline:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
in highp vec2 v_pos;\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
#pragma mapbox: define highp vec4 outline_color\r
#pragma mapbox: define lowp float opacity\r
void main() {\r
#pragma mapbox: initialize highp vec4 outline_color\r
#pragma mapbox: initialize lowp float opacity\r
float dist=length(v_pos-gl_FragCoord.xy);\r
float alpha=1.0-smoothstep(0.0,1.0,dist);\r
vec4 out_color=outline_color;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*(alpha*opacity);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
uniform mat4 u_matrix;\r
uniform vec2 u_world;\r
out highp vec2 v_pos;\r
#pragma mapbox: define highp vec4 outline_color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize highp vec4 outline_color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize highp float z_offset\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fillOutlinePattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform vec2 u_texsize;\r
uniform sampler2D u_image;\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
in highp vec2 v_pos;\r
in highp vec2 v_pos_world;\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r
highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);\r
float alpha=1.0-smoothstep(0.0,1.0,dist);\r
vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*(alpha*opacity);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_world;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform float u_tile_units_to_pixels;\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
out highp vec2 v_pos;\r
out highp vec2 v_pos_world;\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
#pragma mapbox: define lowp float pixel_ratio\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize lowp float pixel_ratio\r
#pragma mapbox: initialize highp float z_offset\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\r
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fillPattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform vec2 u_texsize;\r
uniform sampler2D u_image;\r
in highp vec2 v_pos;\r
uniform float u_emissive_strength;\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r
highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);\r
vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
glFragColor=out_color*opacity;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform float u_tile_units_to_pixels;\r
in vec2 a_pos;\r
#ifdef ELEVATED_ROADS\r
in float a_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
out highp vec2 v_pos;\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp vec4 pattern\r
#pragma mapbox: define lowp float pixel_ratio\r
#pragma mapbox: define highp float z_offset\r
void main() {\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize lowp float pixel_ratio\r
#pragma mapbox: initialize highp float z_offset\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
#ifdef ELEVATED_ROADS\r
z_offset+=a_road_z_offset;\r
#endif\r
float hidden=float(opacity==0.0);\r
gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\r
v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=vec3(a_pos,z_offset);\r
vec3 shd_pos1=vec3(a_pos,z_offset);\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),fillExtrusion:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
in vec4 v_color;\r
in vec4 v_flat;\r
#ifdef RENDER_SHADOWS\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
#endif\r
uniform lowp float u_opacity;\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
in vec2 v_ao;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r
in vec4 v_roof_color;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
in highp vec3 v_normal;\r
#endif\r
uniform vec3 u_flood_light_color;\r
uniform highp float u_vertical_scale;\r
uniform float u_flood_light_intensity;\r
uniform vec3 u_ground_shadow_factor;\r
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\r
in float v_flood_radius;\r
in float v_has_floodlight;\r
#endif\r
in float v_height;\r
#pragma mapbox: define highp float emissive_strength\r
void main() {\r
#pragma mapbox: initialize highp float emissive_strength\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
vec3 normal=normalize(v_normal);\r
#endif\r
float z;\r
vec4 color=v_color;\r
#ifdef ZERO_ROOF_RADIUS\r
z=float(normal.z > 0.00001);\r
#ifdef LIGHTING_3D_MODE\r
normal=mix(normal,vec3(0.0,0.0,1.0),z);\r
#else
color=mix(v_color,v_roof_color,z);\r
#endif
#endif
float h=max(0.0,v_height);\r
float ao_shade=1.0;\r
#ifdef FAUX_AO\r
float intensity=u_ao[0];\r
float h_floors=h/(u_ao[1]*u_vertical_scale);\r
float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);\r
ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\r
#ifdef ZERO_ROOF_RADIUS\r
concave*=(1.0-z);\r
#endif\r
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);\r
ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\r
#ifdef LIGHTING_3D_MODE\r
#ifdef FLOOD_LIGHT\r
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;\r
#endif
#else
color.rgb*=ao_shade;\r
#endif
#endif
#ifdef LIGHTING_3D_MODE\r
float flood_radiance=0.0;\r
#ifdef FLOOD_LIGHT\r
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\r
#endif
#ifdef RENDER_SHADOWS\r
#ifdef FLOOD_LIGHT\r
float ndotl_unclamped=dot(normal,u_shadow_direction);\r
float ndotl=max(0.0,ndotl_unclamped);\r
float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);\r
vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);\r
color.rgb=mix(litColor,floodLitColor,flood_radiance);\r
#else
float shadowed_lighting_factor;\r
#ifdef RENDER_CUTOFF\r
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);\r
if (v_cutoff_opacity==0.0) {\r
discard;\r
}\r
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\r
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\r
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);\r
#ifdef FLOOD_LIGHT\r
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\r
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);\r
color*=u_opacity;\r
#endif
#ifdef FOG\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
color=applyCutout(color,h);\r
#endif\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform mat4 u_matrix;\r
uniform vec3 u_lightcolor;\r
uniform lowp vec3 u_lightpos;\r
uniform lowp float u_lightintensity;\r
uniform float u_vertical_gradient;\r
uniform lowp float u_opacity;\r
uniform float u_edge_radius;\r
uniform float u_width_scale;\r
in vec4 a_pos_normal_ed;\r
in vec2 a_centroid_pos;\r
#ifdef RENDER_WALL_MODE\r
in vec3 a_join_normal_inside;\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
uniform float u_height_lift;\r
#endif\r
#ifdef TERRAIN\r
uniform int u_height_type;\r
uniform int u_base_type;\r
#endif\r
uniform highp float u_vertical_scale;\r
out vec4 v_color;\r
out vec4 v_flat;\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r
out vec4 v_roof_color;\r
#endif\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
out highp vec3 v_normal;\r
#endif\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
out vec2 v_ao;\r
#endif\r
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\r
out float v_flood_radius;\r
out float v_has_floodlight;\r
#endif\r
out float v_height;vec3 linearTosRGB(vec3 color) {\r
return pow(color,vec3(1./2.2));\r
}\r
vec3 sRGBToLinear(vec3 srgbIn) {\r
return pow(srgbIn,vec3(2.2));\r
}\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define highp float flood_light_wall_radius\r
#pragma mapbox: define highp float line_width\r
#pragma mapbox: define highp float emissive_strength\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize highp float flood_light_wall_radius\r
#pragma mapbox: initialize highp float line_width\r
#pragma mapbox: initialize highp float emissive_strength\r
base*=u_vertical_scale;\r
height*=u_vertical_scale;\r
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;\r
vec3 top_up_ny=top_up_ny_start.xyz;\r
float x_normal=pos_nx.z/8192.0;\r
vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\r
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\r
v_normal=normal;\r
#endif\r
base=max(0.0,base);\r
float attr_height=height;\r
height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);\r
float t=top_up_ny.x;\r
vec2 centroid_pos=vec2(0.0);\r
#if defined(HAS_CENTROID) || defined(TERRAIN)\r
centroid_pos=a_centroid_pos;\r
#endif\r
float ele=0.0;\r
float h=0.0;\r
float c_ele=0.0;\r
vec3 pos;\r
#ifdef TERRAIN\r
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;\r
bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;\r
ele=elevation(pos_nx.xy);\r
c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;\r
float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;\r
float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);\r
h=t > 0.0 ? max(h_base,h_height) : h_base;\r
pos=vec3(pos_nx.xy,h);\r
#else\r
h=t > 0.0 ? height : base;\r
pos=vec3(pos_nx.xy,h);\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;\r
h+=lift;\r
vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));\r
vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;\r
pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
#endif\r
float cutoff=1.0;\r
vec3 scaled_pos=pos;\r
#ifdef RENDER_CUTOFF\r
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);\r
vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);\r
vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);\r
cutoff=cutoff_opacity(u_cutoff_params,ground.z);\r
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {\r
vec3 g=floor(ground_pos);\r
vec3 mod_=centroid_random-g*8.0;\r
float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));\r
if (cutoff < 0.8-seed) {\r
cutoff=0.0;\r
}\r
}\r
float cutoff_scale=cutoff;\r
v_cutoff_opacity=cutoff;\r
scaled_pos.z=mix(c_ele,h,cutoff_scale);\r
#endif\r
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\r
#ifdef RENDER_WALL_MODE\r
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);\r
scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;\r
scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\r
#endif\r
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);\r
h=h-ele;\r
v_height=h;\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos0=pos;\r
vec3 shd_pos1=pos;\r
#ifdef NORMAL_OFFSET\r
vec3 offset=shadow_normal_offset(normal);\r
shd_pos0+=offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
#endif\r
float NdotL=0.0;\r
float colorvalue=0.0;\r
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);\r
color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {\r
float r=0.84;\r
r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\r
(1.0-u_vertical_gradient)+
(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));\r
}\r
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;\r
float start=top_up_ny_start.w;\r
float y_ground=1.0-clamp(t+base,0.0,1.0);\r
float top_height=height;\r
#ifdef TERRAIN\r
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;\r
y_ground+=y_ground*5.0/max(3.0,top_height);\r
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);\r
NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW\r
top_height+=u_height_lift;\r
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\r
#endif
#ifdef LIGHTING_3D_MODE\r
#ifdef FLOOD_LIGHT\r
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);\r
v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);\r
v_flood_radius=flood_light_wall_radius*u_vertical_scale;\r
#endif
v_color=vec4(color.rgb,1.0);\r
float ndotl=calculate_NdotL(normal);\r
v_flat.rgb=sRGBToLinear(color.rgb);\r
v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);\r
v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\r
#else
v_color=vec4(0.0,0.0,0.0,1.0);\r
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r
v_color*=u_opacity;\r
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\r
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);\r
roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);\r
v_roof_color=vec4(0.0,0.0,0.0,1.0);\r
v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r
v_roof_color*=u_opacity;\r
#endif
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
}`),fillExtrusionDepth:kr(`in highp float v_depth;\r
void main() {\r
#ifndef DEPTH_TEXTURE\r
glFragColor=pack_depth(v_depth);\r
#endif\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform float u_edge_radius;\r
uniform float u_width_scale;\r
uniform float u_vertical_scale;\r
#ifdef TERRAIN\r
uniform int u_height_type;\r
uniform int u_base_type;\r
#endif\r
in vec4 a_pos_normal_ed;\r
in vec2 a_centroid_pos;\r
#ifdef RENDER_WALL_MODE\r
in vec3 a_join_normal_inside;\r
#endif\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define highp float line_width\r
#pragma mapbox: define highp vec4 color\r
out highp float v_depth;\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize highp float line_width\r
#pragma mapbox: initialize highp vec4 color\r
base*=u_vertical_scale;\r
height*=u_vertical_scale;\r
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;\r
base=max(0.0,base);\r
height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);\r
float t=top_up_ny.x;\r
vec2 centroid_pos=vec2(0.0);\r
#if defined(HAS_CENTROID) || defined(TERRAIN)\r
centroid_pos=a_centroid_pos;\r
#endif\r
vec3 pos;\r
#ifdef TERRAIN\r
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;\r
bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;\r
float ele=elevation(pos_nx.xy);\r
float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;\r
float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;\r
float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);\r
float h=t > 0.0 ? max(h_base,h_height) : h_base;\r
pos=vec3(pos_nx.xy,h);\r
#else\r
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\r
#endif\r
#ifdef RENDER_WALL_MODE\r
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);\r
pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;\r
pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\r
#endif\r
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));\r
gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\r
v_depth=gl_Position.z/gl_Position.w;\r
}`),fillExtrusionPattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform vec2 u_texsize;\r
uniform sampler2D u_image;\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
in vec3 v_ao;\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
in vec3 v_normal;\r
#endif\r
in highp vec2 v_pos;\r
in vec4 v_lighting;\r
uniform lowp float u_opacity;\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define highp float pixel_ratio\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize highp float pixel_ratio\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
highp vec2 imagecoord=mod(v_pos,1.0);\r
highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);\r
highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);\r
vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\r
#else\r
out_color=out_color*v_lighting;\r
#endif\r
#ifdef FAUX_AO\r
float intensity=u_ao[0];\r
float h=max(0.0,v_ao.z);\r
float h_floors=h/u_ao[1];\r
float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);\r
float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\r
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);\r
shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\r
out_color.rgb=out_color.rgb*shade;\r
#endif\r
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform mat4 u_matrix;\r
uniform vec2 u_pixel_coord_upper;\r
uniform vec2 u_pixel_coord_lower;\r
uniform float u_height_factor;\r
uniform float u_tile_units_to_pixels;\r
uniform float u_vertical_gradient;\r
uniform lowp float u_opacity;\r
uniform float u_width_scale;\r
uniform vec3 u_lightcolor;\r
uniform lowp vec3 u_lightpos;\r
uniform lowp float u_lightintensity;\r
in vec4 a_pos_normal_ed;\r
in vec2 a_centroid_pos;\r
#ifdef RENDER_WALL_MODE\r
in vec3 a_join_normal_inside;\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_tile_id;\r
uniform float u_zoom_transition;\r
uniform vec3 u_up_dir;\r
uniform float u_height_lift;\r
#endif\r
#ifdef TERRAIN\r
uniform int u_height_type;\r
uniform int u_base_type;\r
#endif\r
out highp vec2 v_pos;\r
out vec4 v_lighting;\r
#ifdef FAUX_AO\r
uniform lowp vec2 u_ao;\r
out vec3 v_ao;\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
out vec3 v_normal;\r
#endif\r
#pragma mapbox: define highp float base\r
#pragma mapbox: define highp float height\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define highp float pixel_ratio\r
#pragma mapbox: define highp float line_width\r
void main() {\r
#pragma mapbox: initialize highp float base\r
#pragma mapbox: initialize highp float height\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize highp float pixel_ratio\r
#pragma mapbox: initialize highp float line_width\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;\r
mediump vec3 top_up_ny=top_up_ny_start.xyz;\r
float x_normal=pos_nx.z/8192.0;\r
vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\r
float edgedistance=a_pos_normal_ed.w;\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
base=max(0.0,base);\r
height=max(0.0,height);\r
float t=top_up_ny.x;\r
float z=t > 0.0 ? height : base;\r
vec2 centroid_pos=vec2(0.0);\r
#if defined(HAS_CENTROID) || defined(TERRAIN)\r
centroid_pos=a_centroid_pos;\r
#endif\r
float ele=0.0;\r
float h=z;\r
vec3 p;\r
float c_ele;\r
#ifdef TERRAIN\r
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;\r
bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;\r
ele=elevation(pos_nx.xy);\r
c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;\r
float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;\r
float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);\r
h=t > 0.0 ? max(h_base,h_height) : h_base;\r
p=vec3(pos_nx.xy,h);\r
#else\r
p=vec3(pos_nx.xy,z);\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;\r
h+=lift;\r
vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));\r
vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));\r
vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;\r
p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\r
#endif\r
#ifdef RENDER_WALL_MODE\r
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);\r
p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;\r
p.xy-=a_join_normal_inside.z*wall_offset*0.5;\r
#endif\r
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));\r
gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);\r
vec2 pos=normal.z==1.0\r
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);\r
v_lighting=vec4(0.0,0.0,0.0,1.0);\r
float NdotL=0.0;\r
#ifdef LIGHTING_3D_MODE\r
NdotL=calculate_NdotL(normal);\r
#else\r
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);\r
NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\r
#endif\r
if (normal.y !=0.0) {\r
float r=0.84;\r
#ifndef LIGHTING_3D_MODE\r
r=mix(0.7,0.98,1.0-u_lightintensity);\r
#endif
NdotL*=(\r
(1.0-u_vertical_gradient)+
(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));\r
}\r
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;\r
float start=top_up_ny_start.w;\r
float y_ground=1.0-clamp(t+base,0.0,1.0);\r
float top_height=height;\r
#ifdef TERRAIN\r
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;\r
y_ground+=y_ground*5.0/max(3.0,top_height);\r
#endif\r
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);\r
NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW\r
top_height+=u_height_lift;\r
#endif\r
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
v_normal=normal;\r
#else\r
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\r
v_lighting*=u_opacity;\r
#endif \r
#ifdef FOG\r
v_fog_pos=fog_position(p);\r
#endif\r
}`),groundShadow:kr(`#include "_prelude_shadow.fragment.glsl"\r
precision highp float;\r
uniform vec3 u_ground_shadow_factor;\r
in vec4 v_pos_light_view_0;\r
in vec4 v_pos_light_view_1;\r
#ifdef FOG\r
in float v_fog_opacity;\r
#endif\r
void main() {\r
float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\r
vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#ifdef RENDER_CUTOFF\r
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\r
#endif\r
#ifdef FOG\r
shadow=mix(shadow,vec3(1.0),v_fog_opacity);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\r
#endif\r
glFragColor=vec4(shadow,1.0);\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
in vec2 a_pos;\r
out vec4 v_pos_light_view_0;\r
out vec4 v_pos_light_view_1;\r
#ifdef FOG\r
out float v_fog_opacity;\r
#endif\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0.0,1.0);\r
v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);\r
v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
v_fog_opacity=fog(v_fog_pos);\r
#endif\r
}`),fillExtrusionGroundEffect:kr(`uniform highp float u_ao_pass;\r
uniform highp float u_opacity;\r
uniform highp float u_flood_light_intensity;\r
uniform highp vec3 u_flood_light_color;\r
uniform highp float u_attenuation;\r
uniform sampler2D u_fb;\r
uniform float u_fb_size;\r
#ifdef SDF_SUBPASS\r
in highp vec2 v_pos;\r
in highp vec4 v_line_segment;\r
in highp float v_flood_light_radius_tile;\r
in highp vec2 v_ao;\r
float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {\r
highp vec2 ba=b-a;\r
highp vec2 pa=p-a;\r
highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);\r
return length(pa-r*ba);\r
}\r
#ifdef FOG\r
in highp float v_fog;\r
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS\r
vec4 color=vec4(1.0);\r
#ifdef CLEAR_FROM_TEXTURE\r
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\r
#endif
glFragColor=color;\r
#else
#ifdef SDF_SUBPASS\r
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);\r
highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);\r
d/=effect_radius;\r
d=min(d,1.0);\r
d=1.0-pow(1.0-d,u_attenuation);\r
highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);\r
highp float fog=1.0;\r
#ifdef FOG\r
fog=v_fog;\r
#endif
#ifdef RENDER_CUTOFF\r
fog*=v_cutoff_opacity;\r
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\r
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\r
#ifdef OVERDRAW_INSPECTOR\r
color=vec4(1.0);\r
#endif\r
glFragColor=color;\r
#endif
HANDLE_WIREFRAME_DEBUG;\r
#endif
}`,`#include "_prelude_fog.vertex.glsl"\r
in highp vec4 a_pos_end;\r
in highp float a_angular_offset_factor;\r
in highp float a_hidden_by_landmark;\r
#ifdef SDF_SUBPASS\r
out highp vec2 v_pos;\r
out highp vec4 v_line_segment;\r
out highp float v_flood_light_radius_tile;\r
out highp vec2 v_ao;\r
#ifdef FOG\r
out highp float v_fog;\r
#endif\r
#endif\r
uniform highp float u_flood_light_intensity;\r
uniform highp mat4 u_matrix;\r
uniform highp float u_ao_pass;\r
uniform highp float u_meter_to_tile;\r
uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;\r
uniform highp vec2 u_ao;\r
#pragma mapbox: define highp float flood_light_ground_radius\r
const float TANGENT_CUTOFF=4.0;\r
const float NORM=32767.0;\r
void main() {\r
#pragma mapbox: initialize highp float flood_light_ground_radius\r
vec2 p=a_pos_end.xy;\r
vec2 q=floor(a_pos_end.zw*0.5);\r
vec2 start_bottom=a_pos_end.zw-q*2.0;\r
float fl_ground_radius=flood_light_ground_radius;\r
fl_ground_radius=abs(flood_light_ground_radius);\r
float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;\r
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;\r
vec2 v=normalize(q-p);\r
float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;\r
float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;\r
float angular_offset=direction*angular_offset_factor*effect_radius;\r
float top=1.0-start_bottom.y;\r
float side=(0.5-start_bottom.x)*2.0;\r
vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);\r
vec2 perp=vec2(v.y,-v.x);\r
vec2 extrusion_perp=direction*perp*effect_radius*top;\r
vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);\r
pos.xy+=extrusion_parallel+extrusion_perp;\r
#ifdef SDF_SUBPASS\r
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;\r
v_flood_light_radius_tile=flood_radius_tile;\r
v_ao=vec2(u_ao.x,ao_radius);\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
v_fog=1.0-fog(v_fog_pos);\r
#endif\r
#endif\r
float hidden_by_landmark=0.0;\r
#ifdef HAS_CENTROID\r
hidden_by_landmark=a_hidden_by_landmark;\r
#endif\r
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);\r
float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);\r
hidden+=hidden_by_landmark;\r
gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\r
#ifdef RENDER_CUTOFF\r
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\r
#endif\r
}`),hillshadePrepare:kr(`precision highp float;\r
uniform sampler2D u_image;\r
in vec2 v_pos;\r
uniform vec2 u_dimension;\r
uniform float u_zoom;\r
float getElevation(vec2 coord) {\r
return texture(u_image,coord).r/4.0;\r
}\r
void main() {\r
vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));\r
float b=getElevation(v_pos+vec2(0,-epsilon.y));\r
float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));\r
float d=getElevation(v_pos+vec2(-epsilon.x,0));\r
float e=getElevation(v_pos+vec2(epsilon.x,0));\r
float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));\r
float g=getElevation(v_pos+vec2(0,epsilon.y));\r
float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;\r
float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;\r
vec2 deriv=vec2(\r
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\r
)/pow(2.0,exaggeration+(19.2562-u_zoom));\r
glFragColor=clamp(vec4(\r
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\r
}`,`uniform mat4 u_matrix;\r
uniform vec2 u_dimension;\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
out vec2 v_pos;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
highp vec2 epsilon=1.0/u_dimension;\r
float scale=(u_dimension.x-2.0)/u_dimension.x;\r
v_pos=(a_texture_pos/8192.0)*scale+epsilon;\r
}`),hillshade:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform sampler2D u_image;\r
in vec2 v_pos;\r
uniform vec2 u_latrange;\r
uniform vec2 u_light;\r
uniform vec4 u_shadow;\r
uniform vec4 u_highlight;\r
uniform vec4 u_accent;\r
uniform float u_emissive_strength;\r
void main() {\r
vec4 pixel=texture(u_image,v_pos);\r
vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);\r
float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);\r
float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;\r
float maxValue=0.5*PI;\r
float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);\r
float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);\r
vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);\r
glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\r
#ifdef LIGHTING_3D_MODE\r
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\r
#endif\r
#ifdef FOG\r
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\r
#endif\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
out vec2 v_pos;\r
void main() {\r
gl_Position=u_matrix*vec4(a_pos,0,1);\r
v_pos=a_texture_pos/8192.0;\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif\r
}`),line:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform lowp float u_device_pixel_ratio;\r
uniform highp float u_width_scale;\r
uniform highp float u_floor_width_scale;\r
uniform float u_alpha_discard_threshold;\r
uniform highp vec2 u_trim_offset;\r
uniform highp vec2 u_trim_fade_range;\r
uniform lowp vec4 u_trim_color;\r
in vec2 v_width2;\r
in vec2 v_normal;\r
in float v_gamma_scale;\r
in highp vec3 v_uv;\r
#ifdef ELEVATED_ROADS\r
in highp float v_road_z_offset;\r
#endif\r
#ifdef RENDER_LINE_DASH\r
uniform sampler2D u_dash_image;\r
in vec2 v_tex;\r
#endif\r
#ifdef RENDER_LINE_GRADIENT\r
uniform sampler2D u_gradient_image;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;\r
}\r
uniform float u_emissive_strength;\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float floorwidth\r
#pragma mapbox: define lowp vec4 dash\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp float border_width\r
#pragma mapbox: define lowp vec4 border_color\r
float linearstep(float edge0,float edge1,float x) {\r
return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);\r
}\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float floorwidth\r
#pragma mapbox: initialize lowp vec4 dash\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize lowp float border_width\r
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r
float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r
#ifdef RENDER_LINE_DASH\r
float sdfdist=texture(u_dash_image,v_tex).r;\r
float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;\r
float scaled_floorwidth=(floorwidth*u_floor_width_scale);\r
alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\r
#endif\r
highp vec4 out_color;\r
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);\r
#else\r
out_color=color;\r
#endif\r
float trim_alpha=1.0;\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
highp float trim_start=u_trim_offset[0];\r
highp float trim_end=u_trim_offset[1];\r
highp float line_progress=v_uv[2];if (trim_end > trim_start) {\r
highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));\r
highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));\r
highp float transition_factor=min(start_transition,end_transition);\r
out_color=mix(out_color,u_trim_color,transition_factor);\r
trim_alpha=1.0-transition_factor;\r
}\r
#endif\r
if (u_alpha_discard_threshold !=0.0) {\r
if (alpha < u_alpha_discard_threshold) {\r
discard;\r
}\r
}\r
#ifdef RENDER_LINE_BORDER\r
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);\r
float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);\r
if (alpha2 < 1.) {\r
float smoothAlpha=smoothstep(0.6,1.0,alpha2);\r
if (border_color.a==0.0) {\r
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;\r
if (out_color.a > 0.25 && Y < 0.25) {\r
vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;\r
out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));\r
} else {\r
out_color.rgb*=(0.6 +0.4*smoothAlpha);\r
}\r
} else {\r
out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);\r
}\r
}\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
#ifdef ELEVATED_ROADS\r
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\r
#else\r
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#endif
#ifdef FOG\r
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\r
#endif\r
out_color*=(alpha*opacity);\r
#ifdef INDICATOR_CUTOUT\r
out_color=applyCutout(out_color,v_z_offset);\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016\r
in vec2 a_pos_normal;\r
in vec4 a_data;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\r
in vec3 a_z_offset_width;\r
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\r
in highp vec3 a_packed;\r
#endif\r
#ifdef RENDER_LINE_DASH\r
in float a_linesofar;\r
#endif\r
uniform mat4 u_matrix;\r
uniform mat2 u_pixels_to_tile_units;\r
uniform vec2 u_units_to_pixels;\r
uniform lowp float u_device_pixel_ratio;\r
uniform float u_width_scale;\r
uniform highp float u_floor_width_scale;\r
#ifdef ELEVATED\r
uniform lowp float u_zbias_factor;\r
uniform lowp float u_tile_to_meter;\r
float sample_elevation(vec2 apos) {\r
#ifdef ELEVATION_REFERENCE_SEA\r
return 0.0;\r
#else\r
return elevation(apos);\r
#endif\r
}\r
#endif\r
out vec2 v_normal;\r
out vec2 v_width2;\r
out float v_gamma_scale;\r
out highp vec3 v_uv;\r
#ifdef ELEVATED_ROADS\r
out highp float v_road_z_offset;\r
#endif\r
#ifdef RENDER_LINE_DASH\r
uniform vec2 u_texsize;\r
uniform float u_tile_units_to_pixels;\r
out vec2 v_tex;\r
#endif\r
#ifdef RENDER_LINE_GRADIENT\r
uniform float u_image_height;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
#pragma mapbox: define highp vec4 color\r
#pragma mapbox: define lowp float floorwidth\r
#pragma mapbox: define lowp vec4 dash\r
#pragma mapbox: define lowp float blur\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define mediump float gapwidth\r
#pragma mapbox: define lowp float offset\r
#pragma mapbox: define mediump float width\r
#pragma mapbox: define lowp float border_width\r
#pragma mapbox: define lowp vec4 border_color\r
void main() {\r
#pragma mapbox: initialize highp vec4 color\r
#pragma mapbox: initialize lowp float floorwidth\r
#pragma mapbox: initialize lowp vec4 dash\r
#pragma mapbox: initialize lowp float blur\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize mediump float gapwidth\r
#pragma mapbox: initialize lowp float offset\r
#pragma mapbox: initialize mediump float width\r
#pragma mapbox: initialize lowp float border_width\r
#pragma mapbox: initialize lowp vec4 border_color\r
float a_z_offset;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS)\r
a_z_offset=a_z_offset_width.x;\r
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r
vec2 a_extrude=a_data.xy-128.0;\r
float a_direction=mod(a_data.z,4.0)-1.0;\r
vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;\r
normal.y=normal.y*2.0-1.0;\r
v_normal=normal;gapwidth=gapwidth/2.0;\r
float halfwidth;\r
#ifdef VARIABLE_LINE_WIDTH\r
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);\r
halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;\r
#else\r
halfwidth=(u_width_scale*width)/2.0;\r
#endif\r
offset=-1.0*offset*u_width_scale;\r
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r
float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;\r
mediump float t=1.0-abs(u);\r
mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);\r
float hidden=float(opacity==0.0);\r
vec2 extrude=dist*u_pixels_to_tile_units;\r
vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);\r
vec2 projected_extrude_xy=projected_extrude.xy;\r
#ifdef ELEVATED_ROADS\r
v_road_z_offset=a_z_offset;\r
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\r
#else\r
#ifdef ELEVATED\r
vec2 offsetTile=offset2*u_pixels_to_tile_units;\r
vec2 offset_pos=pos+offsetTile;\r
float ele=0.0;\r
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);\r
float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;\r
ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\r
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,max(ele1,ele2));\r
ele=ele_max+a_z_offset;\r
#else
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,0.5*(ele1+ele2));\r
ele=ele_max-ele0+ele1+a_z_offset;\r
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;\r
float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);\r
float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);\r
gl_Position.z-=(gl_Position.w*zbias);\r
gl_Position=mix(gl_Position,AWAY,hidden);\r
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\r
#endif
#endif
#ifdef ELEVATED_ROADS\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);\r
vec3 shd_pos0=shd_pos;\r
vec3 shd_pos1=shd_pos;\r
#ifdef NORMAL_OFFSET\r
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#endif\r
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);\r
float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),0.001);\r
v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\r
#else\r
v_gamma_scale=1.0;\r
#endif\r
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\r
highp float a_uv_x=a_packed[0];\r
float a_split_index=a_packed[1];\r
highp float line_progress=a_packed[2];\r
#ifdef RENDER_LINE_GRADIENT\r
highp float texel_height=1.0/u_image_height;\r
highp float half_texel_height=0.5*texel_height;\r
v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\r
#else\r
v_uv=vec3(a_uv_x,0.0,line_progress);\r
#endif\r
#endif\r
#ifdef RENDER_LINE_DASH\r
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;\r
float height=dash.y;\r
v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\r
#endif\r
v_width2=vec2(outset,inset);\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=a_z_offset;\r
#endif\r
}`),linePattern:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
uniform highp float u_device_pixel_ratio;\r
uniform highp float u_width_scale;\r
uniform highp float u_alpha_discard_threshold;\r
uniform highp vec2 u_texsize;\r
uniform highp float u_tile_units_to_pixels;\r
uniform highp vec2 u_trim_offset;\r
uniform highp vec2 u_trim_fade_range;\r
uniform lowp vec4 u_trim_color;\r
uniform sampler2D u_image;\r
in vec2 v_normal;\r
in vec2 v_width2;\r
in highp float v_linesofar;\r
in float v_gamma_scale;\r
in float v_width;\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
in highp vec3 v_uv;\r
#endif\r
#ifdef ELEVATED_ROADS\r
in highp float v_road_z_offset;\r
#endif\r
#ifdef LINE_JOIN_NONE\r
in vec2 v_pattern_data;
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform vec3 u_ground_shadow_factor;\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in highp float v_depth;\r
#endif\r
uniform float u_emissive_strength;\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define mediump float pixel_ratio\r
#pragma mapbox: define mediump float blur\r
#pragma mapbox: define mediump float opacity\r
void main() {\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize mediump float pixel_ratio\r
#pragma mapbox: initialize mediump float blur\r
#pragma mapbox: initialize mediump float opacity\r
vec2 pattern_tl=pattern.xy;\r
vec2 pattern_br=pattern.zw;\r
vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\r
highp float pattern_size=display_size.x/u_tile_units_to_pixels;\r
float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;\r
float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\r
highp float pattern_x=v_linesofar/pattern_size*aspect;\r
highp float x=mod(pattern_x,1.0);\r
highp float y=0.5*v_normal.y+0.5;\r
vec2 texel_size=1.0/u_texsize;\r
highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));\r
highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));\r
vec4 color=textureLodCustom(u_image,pos,lod_pos);\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
highp float trim_start=u_trim_offset[0];\r
highp float trim_end=u_trim_offset[1];\r
highp float line_progress=v_uv[2];if (trim_end > trim_start) {\r
highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));\r
highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));\r
highp float transition_factor=min(start_transition,end_transition);\r
color=mix(color,color.a*u_trim_color,transition_factor);\r
}\r
#endif\r
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;\r
highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;\r
highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;\r
visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;\r
if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {\r
color=vec4(0.0);\r
}\r
#endif\r
#ifdef LIGHTING_3D_MODE\r
color=apply_lighting_with_emission_ground(color,u_emissive_strength);\r
#ifdef RENDER_SHADOWS\r
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\r
#ifdef ELEVATED_ROADS\r
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\r
#else\r
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\r
#endif
#endif
#endif\r
#ifdef FOG\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r
#endif\r
color*=(alpha*opacity);\r
if (u_alpha_discard_threshold !=0.0) {\r
if (color.a < u_alpha_discard_threshold) {\r
discard;\r
}\r
}\r
#ifdef INDICATOR_CUTOUT\r
color=applyCutout(color,v_z_offset);\r
#endif\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016\r
in vec2 a_pos_normal;\r
in vec4 a_data;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS)\r
in vec3 a_z_offset_width;\r
#endif
#ifdef RENDER_LINE_TRIM_OFFSET\r
in highp vec3 a_packed;\r
#endif\r
in highp float a_linesofar;\r
#ifdef LINE_JOIN_NONE\r
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif\r
uniform mat4 u_matrix;\r
uniform float u_tile_units_to_pixels;\r
uniform vec2 u_units_to_pixels;\r
uniform mat2 u_pixels_to_tile_units;\r
uniform float u_device_pixel_ratio;\r
uniform float u_width_scale;\r
uniform float u_floor_width_scale;\r
#ifdef ELEVATED\r
uniform lowp float u_zbias_factor;\r
uniform lowp float u_tile_to_meter;\r
float sample_elevation(vec2 apos) {\r
#ifdef ELEVATION_REFERENCE_SEA\r
return 0.0;\r
#else\r
return elevation(apos);\r
#endif\r
}\r
#endif\r
out vec2 v_normal;\r
out vec2 v_width2;\r
out highp float v_linesofar;\r
out float v_gamma_scale;\r
out float v_width;\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
out highp vec3 v_uv;\r
#endif\r
#ifdef ELEVATED_ROADS\r
out highp float v_road_z_offset;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out highp float v_depth;\r
#endif\r
#pragma mapbox: define mediump float blur\r
#pragma mapbox: define mediump float opacity\r
#pragma mapbox: define mediump float offset\r
#pragma mapbox: define mediump float gapwidth\r
#pragma mapbox: define mediump float width\r
#pragma mapbox: define mediump float floorwidth\r
#pragma mapbox: define mediump vec4 pattern\r
#pragma mapbox: define mediump float pixel_ratio\r
void main() {\r
#pragma mapbox: initialize mediump float blur\r
#pragma mapbox: initialize mediump float opacity\r
#pragma mapbox: initialize mediump float offset\r
#pragma mapbox: initialize mediump float gapwidth\r
#pragma mapbox: initialize mediump float width\r
#pragma mapbox: initialize mediump float floorwidth\r
#pragma mapbox: initialize mediump vec4 pattern\r
#pragma mapbox: initialize mediump float pixel_ratio\r
float a_z_offset;\r
#if defined(ELEVATED) || defined(ELEVATED_ROADS)\r
a_z_offset=a_z_offset_width.x;\r
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;\r
vec2 a_extrude=a_data.xy-128.0;\r
float a_direction=mod(a_data.z,4.0)-1.0;\r
vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;\r
normal.y=normal.y*2.0-1.0;\r
v_normal=normal;gapwidth=gapwidth/2.0;\r
float halfwidth=(u_width_scale*width)/2.0;\r
offset=-1.0*offset*u_width_scale;\r
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);\r
float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;\r
float t=1.0-abs(u);\r
vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);\r
float hidden=float(opacity==0.0);\r
vec2 extrude=dist*u_pixels_to_tile_units;\r
vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);\r
vec2 projected_extrude_xy=projected_extrude.xy;\r
#ifdef ELEVATED_ROADS\r
v_road_z_offset=a_z_offset;\r
gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\r
#else\r
#ifdef ELEVATED\r
vec2 offsetTile=offset2*u_pixels_to_tile_units;\r
vec2 offset_pos=pos+offsetTile;\r
float ele=0.0;\r
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);\r
float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;\r
ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\r
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,max(ele1,ele2));\r
ele=ele_max+a_z_offset;\r
#else
float ele0=sample_elevation(offset_pos);\r
float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));\r
float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));\r
float ele_max=max(ele0,0.5*(ele1+ele2));\r
ele=ele_max-ele0+ele1+a_z_offset;\r
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;\r
float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);\r
float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);\r
gl_Position.z-=(gl_Position.w*zbias);\r
gl_Position=mix(gl_Position,AWAY,hidden);\r
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\r
#endif
#endif
#ifdef ELEVATED_ROADS\r
#ifdef RENDER_SHADOWS\r
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);\r
vec3 shd_pos0=shd_pos;\r
vec3 shd_pos1=shd_pos;\r
#ifdef NORMAL_OFFSET\r
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));\r
shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();\r
shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\r
#endif\r
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);\r
v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\r
v_depth=gl_Position.w;\r
#endif\r
#endif\r
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);\r
float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);\r
v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\r
#else\r
v_gamma_scale=1.0;\r
#endif\r
#ifdef RENDER_LINE_TRIM_OFFSET\r
highp float a_uv_x=a_packed[0];\r
highp float line_progress=a_packed[2];\r
v_uv=vec3(a_uv_x,0.0,line_progress);\r
#endif\r
v_linesofar=a_linesofar;\r
v_width2=vec2(outset,inset);\r
v_width=(floorwidth*u_floor_width_scale);\r
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;\r
mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;\r
mediump float pixel_ratio_inverse=1.0/pixel_ratio;\r
mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;\r
highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;\r
float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;\r
v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;\r
v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(pos);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=a_z_offset;\r
#endif\r
}`),raster:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
#include "_prelude_raster_array.glsl"\r
uniform float u_fade_t;\r
uniform float u_opacity;\r
uniform highp float u_raster_elevation;\r
uniform highp float u_zoom_transition;\r
in vec2 v_pos0;\r
in vec2 v_pos1;\r
in float v_depth;\r
#ifdef PROJECTION_GLOBE_VIEW\r
in float v_split_fade;\r
#endif\r
uniform float u_brightness_low;\r
uniform float u_brightness_high;\r
uniform float u_saturation_factor;\r
uniform float u_contrast_factor;\r
uniform vec3 u_spin_weights;\r
uniform float u_emissive_strength;\r
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;\r
uniform sampler2D u_image1;\r
#endif\r
#ifdef RASTER_COLOR\r
uniform sampler2D u_color_ramp;\r
uniform highp vec4 u_colorization_mix;\r
uniform highp float u_colorization_offset;\r
uniform vec2 u_texture_res;\r
#endif\r
void main() {\r
vec4 color0,color1,color;\r
vec2 value;\r
#ifdef RASTER_COLOR\r
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR\r
value=mix(\r
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\r
);\r
#else\r
value=mix(\r
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\r
);\r
#endif
if (value.y > 0.0) value.x/=value.y;\r
#else\r
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);\r
value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\r
#endif\r
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;\r
color.a*=value.y;\r
#else
color0=texture(u_image0,v_pos0);\r
color1=texture(u_image1,v_pos1);\r
if (color0.a > 0.0) color0.rgb/=color0.a;\r
if (color1.a > 0.0) color1.rgb/=color1.a;\r
color=mix(color0,color1,u_fade_t);\r
#endif\r
color.a*=u_opacity;\r
#ifdef GLOBE_POLES\r
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\r
#endif\r
vec3 rgb=color.rgb;rgb=vec3(\r
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;\r
rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);\r
vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);\r
vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\r
#endif\r
#ifdef FOG\r
highp float fog_limit_high_meters=1000000.0;\r
highp float fog_limit_low_meters=600000.0;\r
float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);\r
out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\r
#endif\r
glFragColor=vec4(out_color*color.a,color.a);\r
#ifdef PROJECTION_GLOBE_VIEW\r
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\r
#endif\r
#ifdef RENDER_CUTOFF\r
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\r
#endif\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform mat4 u_normalize_matrix;\r
uniform mat4 u_globe_matrix;\r
uniform mat4 u_merc_matrix;\r
uniform mat3 u_grid_matrix;\r
uniform vec2 u_tl_parent;\r
uniform float u_scale_parent;\r
uniform vec2 u_perspective_transform;\r
uniform vec2 u_texture_offset;\r
uniform float u_raster_elevation;\r
uniform float u_zoom_transition;\r
uniform vec2 u_merc_center;\r
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\r
#ifdef GLOBE_POLES\r
in vec3 a_globe_pos;\r
in vec2 a_uv;\r
#else\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
#endif\r
out vec2 v_pos0;\r
out vec2 v_pos1;\r
out float v_depth;\r
#ifdef PROJECTION_GLOBE_VIEW\r
out float v_split_fade;\r
#endif\r
void main() {\r
vec2 uv;\r
#ifdef GLOBE_POLES\r
vec3 globe_pos=a_globe_pos;\r
globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;\r
gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);\r
uv=a_uv;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\r
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\r
#ifdef PROJECTION_GLOBE_VIEW\r
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);\r
vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);\r
vec3 globe_pos=latLngToECEF(latLng.xy);\r
globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;\r
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
vec4 merc_world_pos=vec4(0.0);\r
float mercatorY=mercatorYfromLat(latLng[0]);\r
float mercatorX=mercatorXfromLng(latLng[1]);    \r
v_split_fade=0.0;\r
if (u_zoom_transition > 0.0) {\r
vec2 merc_pos=vec2(mercatorX,mercatorY);\r
merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);\r
merc_world_pos.xy-=u_merc_center;\r
merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);\r
merc_world_pos=u_merc_matrix*merc_world_pos;\r
float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);\r
float dist_from_poles=(abs(mercatorY-0.5)*2.0);\r
float range=0.1;\r
v_split_fade=abs(opposite_merc_center-mercatorX);\r
v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);\r
v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));\r
}\r
float tiles=u_grid_matrix[0][2];\r
if (tiles > 0.0) {\r
float idx=u_grid_matrix[1][2];\r
float idy=u_grid_matrix[2][2];\r
float uvY=mercatorY*tiles-idy;\r
float uvX=mercatorX*tiles-idx;\r
uv=vec2(uvX,uvY);\r
}\r
vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);\r
gl_Position=u_matrix*interpolated_pos;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\r
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif
#endif
#endif
v_pos0=uv;\r
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;\r
v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\r
#ifdef RENDER_CUTOFF\r
v_depth=gl_Position.z;\r
#endif\r
}`),rasterParticle:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform float u_fade_t;\r
uniform float u_opacity;\r
uniform highp float u_raster_elevation;\r
in vec2 v_pos0;\r
in vec2 v_pos1;\r
uniform sampler2D u_image0;\r
uniform sampler2D u_image1;\r
void main() {\r
vec4 color0,color1,color;color0=texture(u_image0,v_pos0);\r
color1=texture(u_image1,v_pos1);\r
if (color0.a > 0.0) color0.rgb/=color0.a;\r
if (color1.a > 0.0) color1.rgb/=color1.a;\r
color=mix(color0,color1,u_fade_t);\r
color.a*=u_opacity;\r
vec3 out_color=color.rgb;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;\r
#endif\r
#ifdef FOG\r
highp float fog_limit_high_meters=1000000.0;\r
highp float fog_limit_low_meters=600000.0;\r
float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);\r
out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\r
#endif\r
glFragColor=vec4(out_color*color.a,color.a);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform mat4 u_normalize_matrix;\r
uniform mat4 u_globe_matrix;\r
uniform mat4 u_merc_matrix;\r
uniform mat3 u_grid_matrix;\r
uniform vec2 u_tl_parent;\r
uniform float u_scale_parent;\r
uniform float u_raster_elevation;\r
uniform float u_zoom_transition;\r
uniform vec2 u_merc_center;\r
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\r
in vec2 a_pos;\r
in vec2 a_texture_pos;\r
out vec2 v_pos0;\r
out vec2 v_pos1;\r
void main() {\r
float w=1.0;\r
vec2 uv;\r
#ifdef PROJECTION_GLOBE_VIEW\r
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);\r
vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);\r
float mercatorY=mercatorYfromLat(latLng[0]);\r
float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];\r
float idx=u_grid_matrix[1][2];\r
float idy=u_grid_matrix[2][2];\r
float uvX=mercatorX*tiles-idx;\r
float uvY=mercatorY*tiles-idy;\r
uv=vec2(uvX,uvY);\r
vec3 globe_pos=latLngToECEF(latLng.xy);\r
globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;\r
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
vec4 merc_world_pos=vec4(0.0);\r
if (u_zoom_transition > 0.0) {\r
vec2 merc_pos=vec2(mercatorX,mercatorY);\r
merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);\r
merc_world_pos.xy-=u_merc_center;\r
merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);\r
merc_world_pos=u_merc_matrix*merc_world_pos;\r
}\r
vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);\r
gl_Position=u_matrix*interpolated_pos;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\r
#endif
#else
uv=a_texture_pos/8192.0;\r
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\r
#ifdef FOG\r
v_fog_pos=fog_position(a_pos);\r
#endif
#endif
v_pos0=uv;\r
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\r
}`),rasterParticleDraw:kr(`uniform sampler2D u_color_ramp;\r
in float v_particle_speed;\r
void main() {\r
glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));\r
}`,`#include "_prelude_raster_particle.glsl"\r
in float a_index;\r
uniform sampler2D u_particle_texture;\r
uniform float u_particle_texture_side_len;\r
uniform vec2 u_tile_offset;\r
out float v_particle_speed;\r
void main() {\r
ivec2 pixel_coord=ivec2(\r
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);\r
vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);\r
vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;\r
vec2 tex_coord=fract(pos);\r
vec2 velocity=lookup_velocity(tex_coord);\r
if (velocity==INVALID_VELOCITY) {\r
gl_Position=AWAY;\r
v_particle_speed=0.0;\r
} else {\r
gl_Position=vec4(2.0*pos-1.0,0,1);\r
v_particle_speed=length(velocity);\r
}\r
gl_PointSize=1.0;\r
}`),rasterParticleTexture:kr(`uniform sampler2D u_texture;\r
uniform float u_opacity;\r
in vec2 v_tex_pos;\r
void main() {\r
vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);\r
}`,`in vec2 a_pos;\r
out vec2 v_tex_pos;\r
void main() {\r
vec2 uv=0.5*a_pos+vec2(0.5);\r
v_tex_pos=uv;\r
gl_Position=vec4(a_pos,0.0,1.0);\r
}`),rasterParticleUpdate:kr(`#include "_prelude_raster_particle.glsl"\r
uniform sampler2D u_particle_texture;\r
uniform mediump float u_particle_texture_side_len;\r
uniform mediump float u_speed_factor;\r
uniform highp float u_reset_rate;\r
uniform highp float u_rand_seed;\r
in highp vec2 v_tex_coord;\r
vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {\r
return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));\r
}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);\r
highp float rand(const highp vec2 co) {\r
highp float t=dot(rand_constants.xy,co);\r
return fract(sin(t)*(rand_constants.z+t));\r
}\r
void main() {\r
ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);\r
highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);\r
highp vec2 pos=unpack_pos_from_rgba(pixel);\r
highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));\r
highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;\r
pos=pos+dp;\r
highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;\r
highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\r
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*
linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\r
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;\r
highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));\r
highp vec2 next_pos=mix(pos,random_pos,drop);\r
glFragColor=pack_pos_to_rgba(next_pos);\r
}`,`in vec2 a_pos;\r
out vec2 v_tex_coord;\r
void main() {\r
v_tex_coord=0.5*(a_pos+vec2(1.0));\r
gl_Position=vec4(a_pos,0.0,1.0);\r
}`),symbol:kr(`#include "_prelude_lighting.glsl"\r
#define SDF_PX 8.0\r
#define SDF 1.0\r
#define ICON 0.0\r
uniform sampler2D u_texture;\r
uniform sampler2D u_texture_icon;\r
uniform highp float u_gamma_scale;\r
uniform lowp float u_device_pixel_ratio;\r
uniform bool u_is_text;\r
uniform bool u_is_halo;\r
uniform lowp float u_scale_factor;\r
#ifdef ICON_TRANSITION\r
uniform float u_icon_transition;\r
#endif\r
#ifdef COLOR_ADJUSTMENT\r
uniform mat4 u_color_adj_mat;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
in highp float v_z_offset;\r
#endif\r
in vec2 v_tex_a;\r
#ifdef ICON_TRANSITION\r
in vec2 v_tex_b;\r
#endif\r
in float v_draw_halo;\r
in vec3 v_gamma_scale_size_fade_opacity;\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
in float is_sdf;\r
in vec2 v_tex_a_icon;\r
#endif\r
#pragma mapbox: define highp vec4 fill_color\r
#pragma mapbox: define highp vec4 halo_color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp float halo_width\r
#pragma mapbox: define lowp float halo_blur\r
#pragma mapbox: define lowp float emissive_strength\r
void main() {\r
#pragma mapbox: initialize highp vec4 fill_color\r
#pragma mapbox: initialize highp vec4 halo_color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize lowp float halo_width\r
#pragma mapbox: initialize lowp float halo_blur\r
#pragma mapbox: initialize lowp float emissive_strength\r
vec4 out_color;\r
float fade_opacity=v_gamma_scale_size_fade_opacity[2];\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
if (is_sdf==ICON) {\r
vec2 tex_icon=v_tex_a_icon;\r
lowp float alpha=opacity*fade_opacity;\r
glFragColor=texture(u_texture_icon,tex_icon)*alpha;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
return;\r
}\r
#endif\r
#ifdef RENDER_SDF\r
float EDGE_GAMMA=0.105/u_device_pixel_ratio;\r
float gamma_scale=v_gamma_scale_size_fade_opacity.x;\r
float size=v_gamma_scale_size_fade_opacity.y;\r
float fontScale=u_is_text ? size/24.0 : size;\r
out_color=fill_color;\r
highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);\r
lowp float buff=(256.0-64.0)/256.0;\r
bool draw_halo=v_draw_halo > 0.0;\r
if (draw_halo) {\r
out_color=halo_color;\r
gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);\r
buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;\r
}\r
lowp float dist=texture(u_texture,v_tex_a).r;\r
highp float gamma_scaled=gamma*gamma_scale;\r
highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);\r
out_color*=alpha;\r
#else
#ifdef ICON_TRANSITION\r
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);\r
vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;\r
out_color=(a+b);\r
#else\r
out_color=texture(u_texture,v_tex_a);\r
#endif\r
#ifdef COLOR_ADJUSTMENT\r
out_color=u_color_adj_mat*out_color;\r
#endif\r
#endif\r
out_color*=opacity*fade_opacity;\r
#ifdef LIGHTING_3D_MODE\r
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out_color=applyCutout(out_color,v_z_offset);\r
#endif\r
glFragColor=out_color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in vec4 a_pos_offset;\r
in vec4 a_tex_size;\r
in vec4 a_pixeloffset;\r
in vec4 a_projected_pos;\r
in float a_fade_opacity;\r
#ifdef Z_OFFSET\r
in float a_auto_z_offset;\r
#endif\r
#ifdef PROJECTION_GLOBE_VIEW\r
in vec3 a_globe_anchor;\r
in vec3 a_globe_normal;\r
#endif\r
#ifdef ICON_TRANSITION\r
in vec2 a_texb;\r
#endif\r
#ifdef OCCLUSION_QUERIES\r
in float a_occlusion_query_opacity;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
out highp float v_z_offset;\r
#endif
uniform bool u_is_size_zoom_constant;\r
uniform bool u_is_size_feature_constant;\r
uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;\r
uniform mat4 u_label_plane_matrix;\r
uniform mat4 u_coord_matrix;\r
uniform bool u_is_text;\r
uniform bool u_elevation_from_sea;\r
uniform bool u_pitch_with_map;\r
uniform bool u_rotate_symbol;\r
uniform highp float u_aspect_ratio;\r
uniform highp float u_camera_to_center_distance;\r
uniform float u_fade_change;\r
uniform vec2 u_texsize;\r
uniform vec3 u_up_vector;\r
uniform vec2 u_texsize_icon;\r
uniform bool u_is_halo;\r
#ifdef PROJECTION_GLOBE_VIEW\r
uniform vec3 u_tile_id;\r
uniform mat4 u_inv_rot_matrix;\r
uniform vec2 u_merc_center;\r
uniform vec3 u_camera_forward;\r
uniform float u_zoom_transition;\r
uniform vec3 u_ecef_origin;\r
uniform mat4 u_tile_matrix;\r
#endif\r
out vec2 v_tex_a;\r
#ifdef ICON_TRANSITION\r
out vec2 v_tex_b;\r
#endif\r
out float v_draw_halo;\r
out vec3 v_gamma_scale_size_fade_opacity;\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
out float is_sdf;\r
out vec2 v_tex_a_icon;\r
#endif\r
#pragma mapbox: define highp vec4 fill_color\r
#pragma mapbox: define highp vec4 halo_color\r
#pragma mapbox: define lowp float opacity\r
#pragma mapbox: define lowp float halo_width\r
#pragma mapbox: define lowp float halo_blur\r
#pragma mapbox: define lowp float emissive_strength\r
#pragma mapbox: define lowp float occlusion_opacity\r
#pragma mapbox: define lowp float z_offset\r
void main() {\r
#pragma mapbox: initialize highp vec4 fill_color\r
#pragma mapbox: initialize highp vec4 halo_color\r
#pragma mapbox: initialize lowp float opacity\r
#pragma mapbox: initialize lowp float halo_width\r
#pragma mapbox: initialize lowp float halo_blur\r
#pragma mapbox: initialize lowp float emissive_strength\r
#pragma mapbox: initialize lowp float occlusion_opacity\r
#pragma mapbox: initialize lowp float z_offset\r
vec2 a_pos=a_pos_offset.xy;\r
vec2 a_offset=a_pos_offset.zw;\r
vec2 a_tex=a_tex_size.xy;\r
vec2 a_size=a_tex_size.zw;\r
float a_size_min=floor(a_size[0]*0.5);\r
vec2 a_pxoffset=a_pixeloffset.xy;\r
vec2 a_min_font_scale=a_pixeloffset.zw/256.0;\r
highp float segment_angle=-a_projected_pos[3];\r
float size;\r
if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r
size=mix(a_size_min,a_size[1],u_size_t)/128.0;\r
} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r
size=a_size_min/128.0;\r
} else {\r
size=u_size;\r
}\r
vec2 tile_anchor=a_pos;\r
float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\r
#ifdef Z_OFFSET\r
e+=a_auto_z_offset;\r
#endif\r
vec3 h=elevationVector(tile_anchor)*e;\r
float globe_occlusion_fade;\r
vec3 world_pos;\r
vec3 mercator_pos;\r
vec3 world_pos_globe;\r
#ifdef PROJECTION_GLOBE_VIEW\r
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);\r
world_pos_globe=a_globe_anchor+h;\r
world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);\r
vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);\r
vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\r
#else\r
world_pos=vec3(tile_anchor,0)+h;\r
globe_occlusion_fade=1.0;\r
#endif\r
vec4 projected_point=u_matrix*vec4(world_pos,1);\r
highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\r
camera_to_anchor_distance/u_camera_to_center_distance :\r
u_camera_to_center_distance/camera_to_anchor_distance;\r
highp float perspective_ratio=clamp(\r
0.5+0.5*distance_ratio,0.0,1.5);\r
size*=perspective_ratio;\r
float font_scale=u_is_text ? size/24.0 : size;\r
highp float symbol_rotation=0.0;\r
if (u_rotate_symbol) {vec4 offsetprojected_point;\r
vec2 a;\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);\r
offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\r
vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);\r
a=projected_point_globe.xy/projected_point_globe.w;\r
#else\r
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\r
a=projected_point.xy/projected_point.w;\r
#endif\r
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;\r
symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);\r
}\r
vec4 projected_pos;\r
#ifdef PROJECTION_GLOBE_VIEW\r
#ifdef PROJECTED_POS_ON_VIEWPORT\r
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\r
#else\r
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;\r
projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \r
#endif\r
#else\r
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\r
#endif\r
highp float angle_sin=sin(segment_angle+symbol_rotation);\r
highp float angle_cos=cos(segment_angle+symbol_rotation);\r
mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);\r
float z=0.0;\r
vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\r
#ifdef TERRAIN\r
#ifdef PITCH_WITH_MAP_TERRAIN\r
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);\r
z=elevation(tile_pos.xy);\r
#endif\r
#endif\r
#ifdef Z_OFFSET\r
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;\r
#else\r
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;\r
#endif
float occlusion_fade=globe_occlusion_fade;\r
vec2 fade_opacity=unpack_opacity(a_fade_opacity);\r
float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;\r
float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\r
#ifdef DEPTH_OCCLUSION\r
float depth_occlusion=occlusionFadeMultiSample(projected_point);\r
float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);\r
out_fade_opacity*=depth_occlusion_multplier;\r
#endif\r
#ifdef OCCLUSION_QUERIES\r
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);\r
out_fade_opacity*=occludedFadeMultiplier;\r
#endif\r
float alpha=opacity*out_fade_opacity;\r
float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);\r
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);\r
vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);\r
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);\r
#else\r
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);\r
#endif\r
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;\r
v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);\r
v_tex_a=a_tex/u_texsize;\r
#ifdef RENDER_TEXT_AND_SYMBOL\r
is_sdf=a_size[0]-2.0*a_size_min;\r
v_tex_a_icon=a_tex/u_texsize_icon;\r
#endif\r
#ifdef ICON_TRANSITION\r
v_tex_b=a_texb/u_texsize;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
v_z_offset=e;\r
#endif\r
}`),terrainRaster:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform sampler2D u_image0;\r
in vec2 v_pos0;\r
#ifdef FOG\r
in float v_fog_opacity;\r
#endif\r
#ifdef RENDER_SHADOWS\r
in vec4 v_pos_light_view_0;\r
in vec4 v_pos_light_view_1;\r
#endif\r
uniform vec3 u_ground_shadow_factor;\r
void main() {\r
vec4 image_color=texture(u_image0,v_pos0);\r
vec4 color;\r
#ifdef LIGHTING_3D_MODE\r
const vec3 normal=vec3(0.0,0.0,1.0);\r
#ifdef RENDER_SHADOWS\r
float cutoffOpacity=1.0;\r
#ifdef RENDER_CUTOFF\r
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\r
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);\r
vec3 emissive_base=image_color.rgb*image_color.a;\r
float ndotl=u_shadow_direction.z;\r
float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);\r
ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));\r
vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);\r
color.rgb=lit+emissive;\r
color.a=1.0;\r
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\r
color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\r
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;\r
color=apply_lighting(image_color,normal,lighting_factor);\r
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);\r
color.a=1.0;\r
#endif
#endif
#else
color=image_color;\r
#endif
#ifdef FOG\r
#ifdef ZERO_EXAGGERATION\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r
#else\r
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\r
#endif\r
#endif\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_matrix;\r
uniform float u_skirt_height;\r
in vec2 a_pos;\r
out vec2 v_pos0;\r
#ifdef FOG\r
out float v_fog_opacity;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out vec4 v_pos_light_view_0;\r
out vec4 v_pos_light_view_1;\r
out float v_depth;\r
#endif\r
void main() {\r
vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);\r
float skirt=decomposedPosAndSkirt.z;\r
vec2 decodedPos=decomposedPosAndSkirt.xy;\r
float elevation=elevation(decodedPos)-skirt*u_skirt_height;\r
v_pos0=decodedPos/8192.0;\r
gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\r
#ifdef FOG\r
#ifdef ZERO_EXAGGERATION\r
v_fog_pos=fog_position(decodedPos);\r
#else\r
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\r
#endif\r
#endif\r
#ifdef RENDER_SHADOWS\r
vec3 pos=vec3(decodedPos,elevation);\r
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);\r
v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\r
#endif\r
}`),terrainDepth:kr(`precision highp float;\r
in float v_depth;\r
void main() {\r
glFragColor=pack_depth(v_depth);\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_matrix;\r
in vec2 a_pos;\r
out float v_depth;\r
void main() {\r
float elevation=elevation(a_pos);\r
gl_Position=u_matrix*vec4(a_pos,elevation,1.0);\r
v_depth=gl_Position.z/gl_Position.w;\r
}`),skybox:kr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;\r
uniform lowp samplerCube u_cubemap;\r
uniform lowp float u_opacity;\r
uniform highp float u_temporal_offset;\r
uniform highp vec3 u_sun_direction;\r
float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {\r
highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;\r
const highp float smoothstep_delta=1e-5;\r
return smoothstep(\r
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);\r
}\r
float map(float value,float start,float end,float new_start,float new_end) {\r
return ((value-start)*(new_end-new_start))/(end-start)+new_start;\r
}\r
void main() {\r
vec3 uv=v_uv;const float y_bias=0.015;\r
uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);\r
vec3 sky_color=texture(u_cubemap,uv).rgb;\r
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\r
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);\r
glFragColor=vec4(sky_color*u_opacity,u_opacity);\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
}`,Fc),skyboxGradient:kr(`#include "_prelude_fog.fragment.glsl"\r
in highp vec3 v_uv;\r
uniform lowp sampler2D u_color_ramp;\r
uniform highp vec3 u_center_direction;\r
uniform lowp float u_radius;\r
uniform lowp float u_opacity;\r
uniform highp float u_temporal_offset;\r
void main() {\r
float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;\r
vec4 color=texture(u_color_ramp,vec2(progress,0.5));\r
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\r
#endif\r
color*=u_opacity;\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
}`,Fc),skyboxCapture:kr(`
in highp vec3 v_position;\r
uniform highp float u_sun_intensity;\r
uniform highp float u_luminance;\r
uniform lowp vec3 u_sun_direction;\r
uniform highp vec4 u_color_tint_r;\r
uniform highp vec4 u_color_tint_m;\r
precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)\r
#define MIE_G                   0.76\r
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10\r
#define DENSITY_STEPS           4\r
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {\r
float a=dot(dir,dir);\r
float b=2.0*dot(dir,orig);\r
float c=dot(orig,orig)-radius*radius;\r
float d=sqrt(b*b-4.0*a*c);\r
return (-b+d)/(2.0*a);\r
}\r
vec3 extinction(vec2 density) {\r
return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));\r
}\r
vec2 local_density(vec3 point) {\r
float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);\r
float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);\r
return vec2(exp_r,exp_m);\r
}\r
float phase_ray(float cos_angle) {\r
return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);\r
}\r
float phase_mie(float cos_angle) {\r
return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/
((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));\r
}\r
vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {\r
float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);\r
float step_len=ray_len/float(DENSITY_STEPS);\r
vec2 density_point_to_atmosphere=vec2(0.0);\r
for (int i=0; i < DENSITY_STEPS;++i) {\r
vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);\r
density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;\r
}\r
return density_point_to_atmosphere;\r
}\r
vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {\r
vec2 density_orig_to_point=vec2(0.0);\r
vec3 scatter_r=vec3(0.0);\r
vec3 scatter_m=vec3(0.0);\r
vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);\r
float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);\r
float step_len=ray_len/float(SAMPLE_STEPS);\r
for (int i=0; i < SAMPLE_STEPS;++i) {\r
vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;\r
density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;\r
vec3 extinction=extinction(density_orig_to_atmosphere);\r
scatter_r+=density.x*extinction;\r
scatter_m+=density.y*extinction;\r
}float cos_angle=dot(ray_dir,sun_direction);\r
float phase_r=phase_ray(cos_angle);\r
float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;\r
vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;\r
return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;\r
}\r
const float A=0.15;\r
const float B=0.50;\r
const float C=0.10;\r
const float D=0.20;\r
const float E=0.02;\r
const float F=0.30;\r
vec3 uncharted2_tonemap(vec3 x) {\r
return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;\r
}\r
void main() {\r
vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;\r
ray_direction.y+=y_bias;\r
vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;\r
glFragColor=vec4(color,1.0);\r
}`,`in highp vec3 a_pos_3f;\r
uniform mat3 u_matrix_3f;\r
out highp vec3 v_position;\r
float map(float value,float start,float end,float new_start,float new_end) {\r
return ((value-start)*(new_end-new_start))/(end-start)+new_start;\r
}\r
void main() {\r
vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);\r
v_position=pos.xyz;\r
v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);\r
gl_Position=vec4(a_pos_3f.xy,0.0,1.0);\r
}`),globeRaster:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform sampler2D u_image0;\r
uniform float u_far_z_cutoff;\r
in vec2 v_pos0;\r
#ifndef FOG\r
uniform highp vec3 u_frustum_tl;\r
uniform highp vec3 u_frustum_tr;\r
uniform highp vec3 u_frustum_br;\r
uniform highp vec3 u_frustum_bl;\r
uniform highp vec3 u_globe_pos;\r
uniform highp float u_globe_radius;\r
uniform vec2 u_viewport;\r
#endif\r
void main() {\r
vec4 color;\r
#ifdef CUSTOM_ANTIALIASING\r
highp vec2 uv=gl_FragCoord.xy/u_viewport;\r
highp vec3 ray_dir=mix(\r
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);\r
highp vec3 dir=normalize(ray_dir);\r
highp vec3 closest_point=dot(u_globe_pos,dir)*dir;\r
highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;\r
const float antialias_pixel=2.0;\r
highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);\r
highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);\r
vec4 raster=texture(u_image0,v_pos0);\r
#ifdef LIGHTING_3D_MODE\r
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r
raster=apply_lighting_with_emission_ground(raster,raster.a);\r
color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\r
#else
raster=apply_lighting_ground(raster);\r
color=vec4(raster.rgb*antialias,raster.a*antialias);\r
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);\r
#endif
#else
color=texture(u_image0,v_pos0);\r
#ifdef LIGHTING_3D_MODE\r
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\r
color=apply_lighting_with_emission_ground(color,color.a);\r
color.a=1.0;\r
#else
color=apply_lighting_ground(color);\r
#endif
#endif
#endif
#ifdef FOG\r
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\r
#endif\r
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);\r
glFragColor=color;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_terrain.vertex.glsl"\r
uniform mat4 u_proj_matrix;\r
uniform mat4 u_normalize_matrix;\r
uniform mat4 u_globe_matrix;\r
uniform mat4 u_merc_matrix;\r
uniform float u_zoom_transition;\r
uniform vec2 u_merc_center;\r
uniform mat3 u_grid_matrix;\r
uniform float u_skirt_height;\r
#ifdef GLOBE_POLES\r
in vec3 a_globe_pos;\r
in vec2 a_uv;\r
#else\r
in vec2 a_pos;
#endif\r
out vec2 v_pos0;\r
void main() {\r
#ifdef GLOBE_POLES\r
vec3 globe_pos=a_globe_pos;\r
vec2 uv=a_uv;\r
#else
float tiles=u_grid_matrix[0][2];\r
float idx=u_grid_matrix[1][2];\r
float idy=u_grid_matrix[2][2];\r
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);\r
vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);\r
float mercatorY=mercatorYfromLat(latLng[0]);\r
float uvY=mercatorY*tiles-idy;\r
float mercatorX=mercatorXfromLng(latLng[1]);\r
float uvX=mercatorX*tiles-idx;\r
vec3 globe_pos=latLngToECEF(latLng.xy);\r
vec2 merc_pos=vec2(mercatorX,mercatorY);\r
vec2 uv=vec2(uvX,uvY);\r
#endif\r
v_pos0=uv;\r
vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\r
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;\r
#else\r
vec3 up_vector=elevationVector(tile_pos);\r
#endif\r
float height=elevation(tile_pos);\r
globe_pos+=up_vector*height;\r
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\r
#endif\r
#ifdef GLOBE_POLES\r
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
#else\r
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);\r
vec4 merc_world_pos=vec4(0.0);\r
if (u_zoom_transition > 0.0) {\r
merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);\r
merc_world_pos.xy-=u_merc_center;\r
merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);\r
merc_world_pos=u_merc_matrix*merc_world_pos;\r
}\r
vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\r
#endif\r
gl_Position=u_proj_matrix*interpolated_pos;\r
#ifdef FOG\r
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\r
#endif\r
}`),globeAtmosphere:kr(`#include "_prelude_fog.fragment.glsl"\r
uniform float u_transition;\r
uniform highp float u_fadeout_range;\r
uniform highp float u_temporal_offset;\r
uniform vec4 u_color;\r
uniform vec4 u_high_color;\r
uniform vec4 u_space_color;\r
uniform float u_horizon_angle;\r
in highp vec3 v_ray_dir;\r
in highp vec3 v_horizon_dir;\r
void main() {\r
highp vec3 dir=normalize(v_ray_dir);\r
float globe_pos_dot_dir;\r
#ifdef PROJECTION_GLOBE_VIEW\r
globe_pos_dot_dir=dot(u_globe_pos,dir);\r
highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;\r
float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\r
#ifdef ALPHA_PASS\r
glFragColor=vec4(0,0,0,0);\r
return;\r
#else\r
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);\r
#else\r
glFragColor=vec4(0,0,0,1);\r
#endif\r
return;\r
#endif\r
}\r
#endif\r
highp vec3 horizon_dir=normalize(v_horizon_dir);\r
float horizon_angle_mercator=dir.y < horizon_dir.y ?\r
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);\r
float horizon_angle;\r
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;\r
highp float closest_point_to_center=length(closest_point-u_globe_pos);\r
highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\r
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);\r
horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\r
#else\r
horizon_angle=horizon_angle_mercator;\r
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);\r
float alpha_0=u_color.a;\r
float alpha_1=u_high_color.a;\r
float alpha_2=u_space_color.a;\r
vec3 color_stop_0=u_color.rgb;\r
vec3 color_stop_1=u_high_color.rgb;\r
vec3 color_stop_2=u_space_color.rgb;\r
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);\r
float a1=mix(a0,1.0,alpha_0);\r
float a2=mix(a0,a1,t);\r
float a =mix(alpha_2,a2,t);\r
glFragColor=vec4(1.0,1.0,1.0,a);\r
#else\r
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);\r
vec3 c1=mix(c0,color_stop_0,alpha_0);\r
vec3 c2=mix(c0,c1,t);\r
vec3 c=c2;glFragColor=vec4(c*t,t);\r
#endif\r
}`,`in vec3 a_pos;\r
in vec2 a_uv;uniform vec3 u_frustum_tl;\r
uniform vec3 u_frustum_tr;\r
uniform vec3 u_frustum_br;\r
uniform vec3 u_frustum_bl;\r
uniform float u_horizon;\r
out highp vec3 v_ray_dir;\r
out highp vec3 v_horizon_dir;\r
void main() {\r
v_ray_dir=mix(\r
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);\r
v_horizon_dir=mix(\r
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);\r
gl_Position=vec4(a_pos,1.0);\r
}`),model:kr(`#include "_prelude_fog.fragment.glsl"\r
#include "_prelude_shadow.fragment.glsl"\r
#include "_prelude_lighting.glsl"\r
uniform float u_opacity;\r
uniform vec3 u_lightcolor;\r
uniform vec3 u_lightpos;\r
uniform float u_lightintensity;\r
uniform vec4 u_baseColorFactor;\r
uniform vec4 u_emissiveFactor;\r
uniform float u_metallicFactor;\r
uniform float u_roughnessFactor;\r
uniform float u_emissive_strength;\r
in highp vec4 v_position_height;\r
in lowp vec4 v_color_mix;\r
#ifdef RENDER_SHADOWS\r
in highp vec4 v_pos_light_view_0;\r
in highp vec4 v_pos_light_view_1;\r
in float v_depth_shadows;\r
#endif\r
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;\r
#endif\r
#pragma mapbox: define-attribute highp vec3 normal_3f\r
#pragma mapbox: define-attribute highp vec3 color_3f\r
#pragma mapbox: define-attribute highp vec4 color_4f\r
#pragma mapbox: define-attribute highp vec2 uv_2f\r
#pragma mapbox: initialize-attribute highp vec3 normal_3f\r
#pragma mapbox: initialize-attribute highp vec3 color_3f\r
#pragma mapbox: initialize-attribute highp vec4 color_4f\r
#pragma mapbox: initialize-attribute highp vec2 uv_2f\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
in lowp vec4 v_roughness_metallic_emissive_alpha;\r
in mediump vec4 v_height_based_emission_params;\r
#endif\r
#ifdef HAS_TEXTURE_u_baseColorTexture\r
uniform sampler2D u_baseColorTexture;\r
uniform bool u_baseTextureIsAlpha;\r
uniform bool u_alphaMask;\r
uniform float u_alphaCutoff;\r
#endif\r
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\r
uniform sampler2D u_metallicRoughnessTexture;\r
#endif\r
#ifdef HAS_TEXTURE_u_occlusionTexture\r
uniform sampler2D u_occlusionTexture;\r
uniform float u_aoIntensity;\r
#endif\r
#ifdef HAS_TEXTURE_u_normalTexture\r
uniform sampler2D u_normalTexture;\r
#endif\r
#ifdef HAS_TEXTURE_u_emissionTexture\r
uniform sampler2D u_emissionTexture;\r
#endif\r
#ifdef APPLY_LUT_ON_GPU\r
uniform highp sampler3D u_lutTexture;\r
#endif\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
in highp float v_depth;\r
uniform highp sampler2D u_depthTexture;\r
uniform highp vec2 u_inv_depth_size;\r
uniform highp vec2 u_depth_range_unpack;\r
#ifdef DEPTH_D24\r
highp float unpack_depth(highp float depth) {\r
return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;\r
}\r
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)\r
{\r
const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);\r
return dot(rgba_depth,bit_shift)*2.0-1.0;\r
}\r
#endif\r
bool isOccluded() {\r
highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\r
#ifdef DEPTH_D24\r
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);\r
#else\r
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\r
#endif
return v_depth > depth+0.0005;\r
}\r
#endif\r
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {\r
return pow(color,vec3(1./2.2));\r
}\r
vec3 sRGBToLinear(vec3 srgbIn) {\r
return pow(srgbIn,vec3(2.2));\r
}\r
float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);\r
}\r
vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\r
{\r
#ifdef LIGHTING_3D_MODE\r
vec3 transformed_normal=vec3(-normal.xy,normal.z);\r
float lighting_factor;\r
#ifdef RENDER_SHADOWS\r
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\r
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\r
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);\r
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);\r
vec3 c=vec3(0.03,0.03,0.03);\r
float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);\r
directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);\r
vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));\r
return c3;\r
#endif
}\r
vec4 getBaseColor() {\r
vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f\r
albedo*=vec4(color_3f,1.0);\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
#else\r
#ifdef HAS_ATTRIBUTE_a_color_4f\r
albedo*=color_4f;\r
#endif\r
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\r
vec4 texColor=texture(u_baseColorTexture,uv_2f);\r
if(u_alphaMask) {\r
if (texColor.w < u_alphaCutoff) {\r
discard;\r
}\r
}\r
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {\r
texColor.rgb/=texColor.w;\r
}\r
texColor.w=1.0;\r
#endif\r
if(u_baseTextureIsAlpha) {\r
if (texColor.r < 0.5) {\r
discard;\r
}\r
} else {texColor.rgb=sRGBToLinear(texColor.rgb);\r
albedo*=texColor;\r
}\r
#endif\r
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\r
#ifdef APPLY_LUT_ON_GPU\r
color=applyLUT(u_lutTexture,color);\r
#endif\r
return color;\r
}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\r
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));\r
highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));\r
highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));\r
highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );\r
highp vec3 dp1perp=cross( N,dp1 );\r
highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;\r
highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);\r
highp float lengthB=dot(B,B);\r
highp float maxLength=max(lengthT,lengthB);\r
highp float invmax=inversesqrt( maxLength );\r
highp mat3 res=mat3( T*invmax,B*invmax,N );\r
return res;\r
#else\r
return mat3(1.0);\r
#endif\r
}\r
highp vec3 getNormal(){\r
highp vec3 n;\r
#ifdef HAS_ATTRIBUTE_a_normal_3f\r
n=normalize(normal_3f);\r
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));\r
highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;\r
#endif\r
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;\r
nMap=normalize(2.0*nMap-vec3(1.0));\r
highp vec3 v=normalize(-v_position_height.xyz);\r
highp mat3 TBN=cotangentFrame(n,v,uv_2f);\r
n=normalize(TBN*nMap);\r
#endif\r
return n;\r
}\r
struct Material {\r
float perceptualRoughness;\r
float alphaRoughness;\r
float metallic;\r
vec3 f90;\r
vec4 baseColor;\r
vec3 diffuseColor;\r
vec3 specularColor;\r
highp vec3 normal;\r
};\r
Material getPBRMaterial() {\r
Material mat;\r
mat.baseColor=getBaseColor();\r
mat.perceptualRoughness=u_roughnessFactor;\r
mat.metallic=u_metallicFactor;\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;\r
mat.metallic=v_roughness_metallic_emissive_alpha.y;\r
mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\r
#endif\r
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \r
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);\r
mat.perceptualRoughness*=mrSample.g;\r
mat.metallic*=mrSample.b;\r
#endif\r
const float c_minRoughness=0.04;\r
mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);\r
mat.metallic=saturate(mat.metallic);\r
mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);\r
mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);\r
mat.diffuseColor*=1.0-mat.metallic;\r
mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);\r
highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);\r
mat.f90=vec3(reflectance90);\r
mat.normal=getNormal();\r
return mat;\r
}float V_GGX(float NdotL,float NdotV,float roughness)\r
{\r
float a2=roughness*roughness;\r
float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);\r
float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);\r
return 0.5/(GGXV+GGXL);\r
}float V_GGXFast(float NdotL,float NdotV,float roughness) {\r
float a=roughness;\r
float GGXV=NdotL*(NdotV*(1.0-a)+a);\r
float GGXL=NdotV*(NdotL*(1.0-a)+a);\r
return 0.5/(GGXV+GGXL);\r
}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\r
{\r
return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);\r
}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\r
{\r
float x=1.0-VdotH;\r
float x4=x*x*x*x;\r
return specularColor+(1.0-specularColor)*x4*x;\r
}float D_GGX(highp float NdotH,float alphaRoughness)\r
{\r
highp float a4=alphaRoughness*alphaRoughness;\r
highp float f=(NdotH*a4-NdotH)*NdotH+1.0;\r
return a4/(PI*f*f);\r
}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\r
{\r
float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;\r
return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));\r
}\r
vec3 diffuseLambertian(Material mat)\r
{\r
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;\r
#else\r
return mat.diffuseColor/PI;\r
#endif\r
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\r
{\r
vec4 c0=vec4(-1,-0.0275,-0.572,0.022);\r
vec4 c1=vec4(1,0.0425,1.04,-0.04);\r
highp vec4 r=roughness*c0+c1;\r
highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;\r
vec2 AB=vec2(-1.04,1.04)*a004+r.zw;\r
return specularColor*AB.x+AB.y;\r
}\r
vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\r
{\r
vec3 env_light=vec3(0.65,0.65,0.65);\r
#ifdef LIGHTING_3D_MODE\r
float ambient_factor=calculate_ambient_directional_factor(normal);\r
env_light=u_lighting_ambient_color*ambient_factor;\r
#endif\r
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);\r
vec3 indirectSpecular= envBRDF*env_light;\r
vec3 indirectDiffuse=mat.diffuseColor*env_light;\r
return indirectSpecular+indirectDiffuse;\r
}\r
vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\r
{\r
highp vec3 n=mat.normal;\r
highp vec3 v=normalize(-v_position_height.xyz);\r
highp vec3 l=normalize(lightPosition);\r
highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);\r
float NdotL=saturate(dot(n,l));\r
highp float NdotH=saturate(dot(n,h));\r
float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;\r
vec3 transformed_normal=vec3(-n.xy,n.z);\r
float lighting_factor;\r
#ifdef RENDER_SHADOWS\r
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\r
#else\r
lighting_factor=NdotL;\r
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;\r
vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);\r
vec3 color=(saturate(directLightColor)+indirectLightColor);\r
float intensityFactor=1.0;\r
#if !defined(LIGHTING_3D_MODE)\r
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\r
#endif
color*=intensityFactor;\r
return color;\r
}\r
void main() {\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
if (isOccluded()) {\r
discard;\r
}\r
#endif\r
vec3 lightDir=u_lightpos;\r
vec3 lightColor=u_lightcolor;\r
#ifdef LIGHTING_3D_MODE\r
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;\r
lightColor=u_lighting_directional_color;\r
#endif\r
vec4 finalColor;\r
#ifdef DIFFUSE_SHADED\r
vec3 N=getNormal();\r
vec3 baseColor=getBaseColor().rgb;\r
vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;\r
diffuse*=ao;\r
#endif\r
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\r
#else
Material mat=getPBRMaterial();\r
vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\r
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\r
#ifdef OCCLUSION_TEXTURE_TRANSFORM\r
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\r
#else\r
vec2 uv=uv_2f;\r
#endif\r
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;\r
color*=ao;\r
#endif
vec4 emissive=u_emissiveFactor;\r
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\r
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\r
#endif\r
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);\r
emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\r
#endif\r
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
float resEmission=v_roughness_metallic_emissive_alpha.z;\r
resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);\r
vec3 color_mix=v_color_mix.rgb;\r
#ifdef APPLY_LUT_ON_GPU\r
color_mix=applyLUT(u_lutTexture,color_mix);\r
#endif\r
color=mix(color,color_mix,min(1.0,resEmission));\r
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));\r
distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));\r
opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\r
#endif\r
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;\r
color=mix(color,unlitColor,u_emissive_strength);\r
color=linearTosRGB(color);\r
color*=opacity;\r
finalColor=vec4(color,opacity);\r
#endif
#ifdef FOG\r
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\r
#endif\r
#ifdef RENDER_CUTOFF\r
finalColor*=v_cutoff_opacity;\r
#endif\r
#ifdef INDICATOR_CUTOUT\r
finalColor=applyCutout(finalColor,v_position_height.w);\r
#endif\r
glFragColor=finalColor;\r
#ifdef OVERDRAW_INSPECTOR\r
glFragColor=vec4(1.0);\r
#endif\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`#include "_prelude_fog.vertex.glsl"\r
#include "_prelude_shadow.vertex.glsl"\r
in vec3 a_pos_3f;\r
#pragma mapbox: define-attribute highp vec3 normal_3f\r
#pragma mapbox: define-attribute highp vec2 uv_2f\r
#pragma mapbox: define-attribute highp vec3 color_3f\r
#pragma mapbox: define-attribute highp vec4 color_4f\r
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\r
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;\r
uniform mat4 u_node_matrix;\r
uniform mat4 u_lighting_matrix;\r
uniform vec3 u_camera_pos;\r
uniform vec4 u_color_mix;\r
#ifdef INSTANCED_ARRAYS\r
in vec4 a_normal_matrix0;\r
in vec4 a_normal_matrix1;\r
in vec4 a_normal_matrix2;\r
in vec4 a_normal_matrix3;\r
#else\r
uniform highp mat4 u_normal_matrix;\r
#endif\r
#ifdef RENDER_SHADOWS\r
uniform mat4 u_light_matrix_0;\r
uniform mat4 u_light_matrix_1;\r
out highp vec4 v_pos_light_view_0;\r
out highp vec4 v_pos_light_view_1;\r
out float v_depth_shadows;\r
#endif\r
out vec4 v_position_height;\r
out lowp vec4 v_color_mix;\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
out highp float v_depth;\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
out lowp vec4 v_roughness_metallic_emissive_alpha;\r
out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {\r
return pow(srgbIn,vec3(2.2));\r
}\r
void main() {\r
#pragma mapbox: initialize-attribute highp vec3 normal_3f\r
#pragma mapbox: initialize-attribute highp vec2 uv_2f\r
#pragma mapbox: initialize-attribute highp vec3 color_3f\r
#pragma mapbox: initialize-attribute highp vec4 color_4f\r
#pragma mapbox: initialize-attribute-custom highp vec4 pbr\r
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\r
highp mat4 normal_matrix;\r
#ifdef INSTANCED_ARRAYS\r
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\r
#else\r
normal_matrix=u_normal_matrix;\r
#endif\r
vec3 local_pos;\r
mat3 rs;\r
#ifdef MODEL_POSITION_ON_GPU\r
vec3 pos_color=normal_matrix[0].xyz;\r
vec4 translate=normal_matrix[1];\r
vec3 pos_a=floor(pos_color);\r
vec3 rgb=1.05*(pos_color-pos_a);\r
float hidden=float(pos_a.x > EXTENT);\r
float color_mix=pos_a.z/100.0;\r
v_color_mix=vec4(sRGBToLinear(rgb),color_mix);\r
float meter_to_tile=normal_matrix[0].w;\r
vec4 pos=vec4(pos_a.xy,translate.z,1.0);\r
rs[0].x=normal_matrix[1].w;\r
rs[0].yz=normal_matrix[2].xy;\r
rs[1].xy=normal_matrix[2].zw;\r
rs[1].z=normal_matrix[3].x;\r
rs[2].xyz=normal_matrix[3].yzw;\r
vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);\r
vec3 rotated_pos_node=rs*pos_node.xyz;\r
vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);\r
pos.xyz+=pos_model_tile;\r
local_pos=pos.xyz;\r
gl_Position=mix(u_matrix*pos,AWAY,hidden);\r
pos.z*=meter_to_tile;\r
v_position_height.xyz=pos.xyz-u_camera_pos;\r
#else\r
local_pos=a_pos_3f;\r
gl_Position=u_matrix*vec4(a_pos_3f,1);\r
v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));\r
v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\r
#endif\r
v_position_height.w=a_pos_3f.z;\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
vec4 albedo_c=decode_color(pbr.xy);\r
vec2 e_r_m=unpack_float(pbr.z);\r
vec2 r_m= unpack_float(e_r_m.y*16.0);\r
r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);\r
v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;\r
v_height_based_emission_params.x=heightBasedRelativeIntepolation;\r
v_height_based_emission_params.y=heightBasedEmissiveStrength.z;\r
vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;\r
v_height_based_emission_params.z=emissionMultiplierValues.x;\r
v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\r
#endif\r
#ifdef FOG\r
v_fog_pos=fog_position(local_pos);\r
#endif\r
#ifdef RENDER_CUTOFF\r
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\r
#endif\r
#ifdef TERRAIN_FRAGMENT_OCCLUSION\r
v_depth=gl_Position.z/gl_Position.w;\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_normal_3f\r
#ifdef MODEL_POSITION_ON_GPU\r
float x_squared_scale=dot(rs[0],rs[0]);\r
float y_squared_scale=dot(rs[1],rs[1]);\r
float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);\r
normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);\r
normal_3f=normalize(normal_3f);\r
#else\r
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));\r
#endif\r
#endif\r
#ifdef HAS_ATTRIBUTE_a_pbr\r
#ifdef HAS_ATTRIBUTE_a_color_4f\r
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\r
#endif\r
#endif\r
#ifdef RENDER_SHADOWS\r
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\r
#ifdef NORMAL_OFFSET\r
#ifdef HAS_ATTRIBUTE_a_normal_3f\r
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));\r
shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\r
#else\r
vec3 offset=shadow_normal_offset_model(normal_3f);\r
shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\r
#endif\r
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;\r
v_pos_light_view_1=u_light_matrix_1*shadow_pos;\r
v_depth_shadows=gl_Position.w;\r
#endif
}`),modelDepth:kr(`in highp float v_depth;\r
void main() {\r
#ifndef DEPTH_TEXTURE\r
glFragColor=pack_depth(v_depth);\r
#endif\r
}`,`in vec3 a_pos_3f;\r
uniform mat4 u_matrix;\r
out highp float v_depth;\r
#ifdef MODEL_POSITION_ON_GPU\r
#ifdef INSTANCED_ARRAYS\r
in vec4 a_normal_matrix0;\r
in vec4 a_normal_matrix1;\r
in vec4 a_normal_matrix2;\r
in vec4 a_normal_matrix3;\r
#else\r
uniform highp mat4 u_instance;\r
#endif\r
uniform highp mat4 u_node_matrix;\r
#endif\r
void main() {\r
#ifdef MODEL_POSITION_ON_GPU\r
highp mat4 instance;\r
#ifdef INSTANCED_ARRAYS\r
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\r
#else\r
instance=u_instance;\r
#endif\r
vec3 pos_color=instance[0].xyz;\r
vec4 translate=instance[1];\r
vec3 pos_a=floor(pos_color);\r
float hidden=float(pos_a.x > EXTENT);\r
float meter_to_tile=instance[0].w;\r
vec4 pos=vec4(pos_a.xy,translate.z,1.0);\r
mat3 rs;\r
rs[0].x=instance[1].w;\r
rs[0].yz=instance[2].xy;\r
rs[1].xy=instance[2].zw;\r
rs[1].z=instance[3].x;\r
rs[2].xyz=instance[3].yzw;\r
vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);\r
vec3 rotated_pos_node=rs*pos_node.xyz;\r
vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);\r
pos.xyz+=pos_model_tile;\r
gl_Position=mix(u_matrix*pos,AWAY,hidden);\r
#else\r
gl_Position=u_matrix*vec4(a_pos_3f,1);\r
#endif\r
v_depth=gl_Position.z/gl_Position.w;\r
}`),stars:kr(`in highp vec2 v_uv;\r
in mediump float v_intensity;float shapeCircle(in vec2 uv)\r
{float beginFade=0.6;float lengthFromCenter=length(v_uv);\r
return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);\r
}\r
void main() {\r
float alpha=shapeCircle(v_uv);\r
vec3 color=vec3(1.0,1.0,1.0);\r
alpha*=v_intensity;\r
glFragColor=vec4(color*alpha,alpha);\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;\r
uniform vec3 u_right;uniform float u_intensity_multiplier;\r
out highp vec2 v_uv;\r
out mediump float v_intensity;\r
void main() {\r
v_uv=a_uv;\r
v_intensity=a_fade_opacity*u_intensity_multiplier;\r
vec3 pos=a_pos_3f;\r
pos+=a_uv.x*u_right*a_size_scale;\r
pos+=a_uv.y*u_up*a_size_scale;\r
gl_Position=u_matrix*vec4(pos,1.0);\r
}`),snowParticle:kr(`in highp vec2 uv;\r
in highp float alphaMultiplier;\r
uniform vec4 u_particleColor;\r
uniform vec2 u_simpleShapeParameters;void main() {\r
float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);\r
float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));\r
alpha*=alphaMultiplier;\r
alpha*=u_particleColor.a;\r
vec3 color=u_particleColor.rgb*alpha;\r
glFragColor=vec4(color,alpha) ;\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`
in highp vec3 a_pos_3f;in highp vec2 a_uv;\r
in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;\r
uniform mat4 u_projection;\r
uniform vec3 u_cam_pos;\r
uniform vec2 u_screenSize;\r
uniform float u_time;\r
uniform float u_boxSize;\r
uniform float u_velocityConeAperture; \r
uniform float u_velocity;uniform vec3 u_direction;\r
uniform float u_horizontalOscillationRadius; \r
uniform float u_horizontalOscillationRate; \r
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;\r
uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;\r
out highp vec2 uv;\r
out highp float alphaMultiplier;\r
void main() {\r
vec3 pos=a_pos_3f;\r
float halfBoxSize=0.5*u_boxSize;\r
pos.xyz*=halfBoxSize;\r
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);\r
float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;\r
float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);\r
vec3 localZ=normalize(u_direction);\r
vec3 localX=normalize(cross(localZ,vec3(1,0,0)));\r
vec3 localY=normalize(cross(localZ,localX));vec3 direction;\r
direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
direction.z=cos(coneAnglePichRad);\r
direction=normalize(direction);\r
vec3 simPosLocal=vec3(0,0,0);\r
float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;\r
simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;\r
float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);\r
simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));\r
vec3 simPos=localX*simPosLocal.x+\r
localY*simPosLocal.y+
localZ*simPosLocal.z;\r
pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);\r
float clipZ=-u_cam_pos.z+pos.z;\r
vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;\r
alphaMultiplier=1.0;\r
vec4 posScreen=u_projection*posView;\r
posScreen/=posScreen.w;\r
posScreen.xy=vec2(0.5)+posScreen.xy*0.5;\r
posScreen.xy*=u_screenSize;\r
vec2 thinningCenterPos=u_thinningCenterPos.xy;\r
thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;\r
float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));\r
screenDist+=a_snowParticleData.x*u_thinningParticleOffset;\r
float scaleFactorMode=0.0;\r
float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;\r
if (screenDist < thinningShapeDist) {\r
float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);\r
thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);\r
if (a_snowParticleData.x < u_thinningAffectedRatio) {\r
scaleFactorMode=1.0-thinningFadeRatio;\r
alphaMultiplier=thinningFadeRatio;\r
}\r
}\r
vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);\r
posScreen1/=posScreen1.w;\r
vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);\r
posScreen2/=posScreen2.w;\r
posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;\r
posScreen1.xy*=u_screenSize;\r
posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;\r
posScreen2.xy*=u_screenSize;\r
float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;\r
float scaleFactor=1.0;\r
if (screenLength < screenEpsilon) {\r
scaleFactor=screenEpsilon/max(screenLength,0.01);\r
scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);\r
}float screenEpsilon2=15.0;\r
if (screenLength > screenEpsilon2) {\r
scaleFactor=screenEpsilon2/max(screenLength,0.01);\r
}\r
size*=scaleFactor;\r
vec2 right=size*vec2(1,0);\r
vec2 up=size*vec2(0,1);\r
posView.xy+=right*a_uv.x;\r
posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;\r
}`),rainParticle:kr(`in highp vec2 uv;\r
in highp float particleRandomValue;\r
uniform sampler2D u_texScreen;\r
uniform float u_distortionStrength;\r
uniform vec4 u_color;uniform vec2 u_thinningCenterPos;\r
uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;\r
uniform float u_thinningParticleOffset;\r
uniform float u_shapeDirectionalPower;\r
uniform float u_mode;void main() {\r
vec2 st=uv*0.5+vec2(0.5);\r
vec2 uvm=uv;\r
uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);\r
float shape=clamp(1.0-length(uvm),0.0,1.0);\r
float alpha=abs(shape)*u_color.a;\r
vec2 screenSize=vec2(textureSize(u_texScreen,0));\r
vec2 thinningCenterPos=u_thinningCenterPos.xy;\r
thinningCenterPos.y=screenSize.y-thinningCenterPos.y;\r
float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));\r
screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;\r
float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;\r
float thinningAlpha=1.0;\r
if (screenDist < thinningShapeDist) {\r
float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);\r
thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);\r
thinningAlpha*=thinningFadeRatio;\r
}\r
vec2 offsetXY=normalize(uvm)*abs(shape);\r
vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;\r
vec3 colorScreen=texture(u_texScreen,stScreen).rgb;\r
alpha*=thinningAlpha;\r
glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);\r
HANDLE_WIREFRAME_DEBUG;\r
}`,`
in highp vec3 a_pos_3f;in highp vec2 a_uv;\r
in highp vec4 a_rainParticleData;uniform mat4 u_modelview;\r
uniform mat4 u_projection;uniform vec3 u_cam_pos;\r
uniform float u_time;\r
uniform float u_boxSize;\r
uniform float u_velocityConeAperture; \r
uniform float u_velocity; \r
uniform vec2 u_rainDropletSize;\r
uniform vec3 u_rainDirection;\r
out highp vec2 uv;\r
out highp float particleRandomValue;\r
void main() {\r
vec3 pos=a_pos_3f;\r
float halfBoxSize=0.5*u_boxSize;\r
pos*=halfBoxSize; \r
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);\r
float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;\r
float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);\r
vec3 localX=normalize(cross(localZ,vec3(1,0,0)));\r
vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;\r
directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);\r
directionLocal.z=cos(coneAnglePichRad);\r
directionLocal=normalize(directionLocal);\r
vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;\r
float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;\r
vec3 simPosLocal=vec3(0,0,0);\r
simPosLocal+=directionLocal*velocityScale*u_time;\r
vec3 simPos=localX*simPosLocal.x+\r
localY*simPosLocal.y+
localZ*simPosLocal.z;\r
pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);\r
vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);\r
vec3 side=cross(directionView,normalize(posView.xyz));\r
posView.xyz+=side*a_uv.x*u_rainDropletSize.x;\r
posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;\r
particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;\r
}`),vignette:kr(`uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;\r
in vec2 st;\r
void main() {\r
float screenDist=length(st);\r
float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);\r
alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;\r
vec3 color=u_vignetteColor.rgb;\r
glFragColor=vec4(color*alpha,alpha) ;\r
}`,`in vec2 a_pos_2f;\r
out vec2 st;\r
void main() {\r
st=a_pos_2f;\r
gl_Position=vec4(a_pos_2f,0,1);\r
}`),occlusion:kr(`uniform vec4 u_color;\r
void main() {\r
glFragColor=u_color;\r
}`,`#include "_prelude_terrain.vertex.glsl"\r
in highp vec2 a_offset_xy;\r
uniform highp vec3 u_anchorPos;\r
uniform mat4 u_matrix;\r
uniform vec2 u_screenSizePx;\r
uniform vec2 u_occluderSizePx;\r
void main() {\r
vec3 world_pos=u_anchorPos;\r
#ifdef TERRAIN\r
float e=elevation(world_pos.xy);\r
world_pos.z+=e;\r
#endif\r
vec4 projected_point=u_matrix*vec4(world_pos,1.0);\r
projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;\r
gl_Position=projected_point;\r
}`)};function Ho(d,t){const s=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const m=h.split(" ");for(const g of m)t.includes(g)||t.push(g)}}function kr(d,t){const s=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let m=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);m&&(m=m.map(z=>{const L=z.split(" ");return L[L.length-1]}),m=[...new Set(m)]);const g={},x=[],M=[];if(d=d.replace(s,(z,L)=>(M.push(L),"")),(t=t.replace(s,(z,L)=>(x.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let P=[...Ka];Ho(d,P),Ho(t,P);for(const z of[...x,...M])qo[z]||console.error(`Undefined include: ${z}`),Ya[z]||(Ya[z]=[],Ho(qo[z],Ya[z])),P=[...P,...Ya[z]];return{fragmentSource:d=d.replace(h,(z,L,F,B,j)=>(g[j]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${F} ${B} ${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${F} ${B} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${B} ${j};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(h,(z,L,F,B,j)=>{const Z=B==="float"?"vec2":B,H=j.match(/color/)?"color":Z;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${F} ${B} a_${j};
#endif
`:g[j]?L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${Z} a_${j};
out ${F} ${B} ${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="initialize"?H==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${F} ${B} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${H}(a_${j}, u_${j}_t);
#else
    ${F} ${B} ${j} = u_${j};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${B} a_${j};
    out ${F} ${B} ${j};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${Z} a_${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="define-instanced"?H==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${F} ${B} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${Z} a_${j};
#else
uniform ${F} ${B} u_${j};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${F} ${B} ${j} = a_${j};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${B} ${j} = a_${j};
#else
    ${F} ${B} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${B} ${j} = unpack_mix_${H}(a_${j}, u_${j}_t);
#else
    ${F} ${B} ${j} = u_${j};
#endif
`}),staticAttributes:m,usedDefines:P,vertexIncludes:x,fragmentIncludes:M}}class jm{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,s,h,m,g,x,M,P){this.context=t;let z=this.boundPaintVertexBuffers.length!==m.length;for(let F=0;!z&&F<m.length;F++)this.boundPaintVertexBuffers[F]!==m[F]&&(z=!0);let L=this.boundDynamicVertexBuffers.length!==M.length;for(let F=0;!L&&F<M.length;F++)this.boundDynamicVertexBuffers[F]!==M[F]&&(L=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||z||L||this.boundIndexBuffer!==g||this.boundVertexOffset!==x)this.freshBind(s,h,m,g,x,M,P);else{t.bindVertexArrayOES.set(this.vao);for(const F of M)F&&(F.bind(),P&&F.instanceCount&&F.setVertexAttribDivisor(t.gl,s,P));g&&g.dynamicDraw&&g.bind()}}freshBind(t,s,h,m,g,x,M){const P=t.numAttributes,z=this.context,L=z.gl;this.vao&&this.destroy(),this.vao=z.gl.createVertexArray(),z.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=m,this.boundVertexOffset=g,this.boundDynamicVertexBuffers=x,s.enableAttributes(L,t),s.bind(),s.setVertexAttribPointers(L,t,g);for(const F of h)F.enableAttributes(L,t),F.bind(),F.setVertexAttribPointers(L,t,g);for(const F of x)F&&(F.enableAttributes(L,t),F.bind(),F.setVertexAttribPointers(L,t,g),M&&F.instanceCount&&F.setVertexAttribDivisor(L,t,M));m&&m.bind(),z.currentNumAttributes=P}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function $m(d,t){const s=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new i.ac(0,h/s).toLngLat().lat,new i.ac(0,(h+1)/s).toLngLat().lat]}function Gm(d,t,s,h,m,g,x){const M=d.context,P=M.gl,z=s.hillshadeFBO;if(!z)return;d.prepareDrawTile();const L=d.isTileAffectedByFog(t),F=d.getOrCreateProgram("hillshade",{overrideFog:L});M.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,z.colorAttachment.get());const B=((J,Q,oe,ue)=>{const ce=oe.paint.get("hillshade-shadow-color"),ge=oe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",fe=oe.paint.get("hillshade-highlight-color"),_e=oe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",pe=oe.paint.get("hillshade-accent-color"),we=oe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ee=oe.paint.get("hillshade-emissive-strength");let qe=i.ak(oe.paint.get("hillshade-illumination-direction"));if(oe.paint.get("hillshade-illumination-anchor")==="viewport")qe-=J.transform.angle;else if(J.style&&J.style.enable3dLights()&&J.style.directionalLight){const et=J.style.directionalLight.properties.get("direction"),rt=i.cc(et.x,et.y,et.z);qe=i.ak(rt[1])}const Be=!J.options.moving;return{u_matrix:ue||J.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),Be),u_image:0,u_latrange:$m(0,Q.tileID),u_light:[oe.paint.get("hillshade-exaggeration"),qe],u_shadow:ce.toRenderColor(ge?null:oe.lut),u_highlight:fe.toRenderColor(_e?null:oe.lut),u_emissive_strength:Ee,u_accent:pe.toRenderColor(we?null:oe.lut)}})(d,s,h,d.terrain?t.projMatrix:null);d.uploadCommonUniforms(M,F,t.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:Z,tileBoundsSegments:H}=d.getTileBoundsBuffers(s);F.draw(d,P.TRIANGLES,m,g,x,dr.disabled,B,h.id,j,Z,H)}function Ja(d,t,s){if(!t.needsDEMTextureUpload)return;const h=d.context,m=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||d.getTileTexture(s.stride);const g=s.getPixels();t.demTexture?t.demTexture.update(g,{premultiply:!1}):t.demTexture=new i.T(h,g,m.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function qm(d,t,s){const h=d.context,m=h.gl;if(!t.dem)return;const g=t.dem;if(h.activeTexture.set(m.TEXTURE1),Ja(d,t,g),!t.demTexture)return;t.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const x=g.dim;h.activeTexture.set(m.TEXTURE0);let M=t.hillshadeFBO;if(!M){const B=new i.T(h,{width:x,height:x,data:null},m.RGBA8);B.bind(m.LINEAR,m.CLAMP_TO_EDGE),M=t.hillshadeFBO=h.createFramebuffer(x,x,!0,"renderbuffer"),M.colorAttachment.set(B.texture)}h.bindFramebuffer.set(M.framebuffer),h.viewport.set([0,0,x,x]);const{tileBoundsBuffer:P,tileBoundsIndexBuffer:z,tileBoundsSegments:L}=d.getMercatorTileBoundsBuffers(),F=[];d.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),d.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(d,m.TRIANGLES,Xt.disabled,br.disabled,Rr.unblended,dr.disabled,((B,j)=>{const Z=j.stride,H=i.ad.mat4.create();return i.ad.mat4.ortho(H,0,i.ai,-i.ai,0,0,1),i.ad.mat4.translate(H,H,[0,-i.ai,0]),{u_matrix:H,u_image:1,u_dimension:[Z,Z],u_zoom:B.overscaledZ}})(t.tileID,g),s.id,P,z,L),t.needsHillshadePrepare=!1}class Cn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yy extends Cn{getDefault(){return i.al.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Jy extends Cn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Jd extends Cn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Qd extends Cn{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ef extends Cn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class tf extends Cn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Hm extends Cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Wm extends Cn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Qy extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Nc extends Cn{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Vc extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class Zm extends Cn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ts extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class rf extends Cn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class oh extends Cn{getDefault(){return i.al.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ah extends Cn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class nf extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class sf extends Cn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class of extends Cn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let lh=class extends Cn{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class af extends Cn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class lf extends Cn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ch extends Cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Xm extends Cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Km extends Cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Cl extends Cn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ev extends Cn{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class tv extends Cn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class rv extends Cn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class nv extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class iv extends Cn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class cf extends Cn{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class uf extends cf{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class uh extends cf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ym extends cf{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Pl extends uh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Jm=(d,t,s)=>({u_matrix:d,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:s}),hf=(d,t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:m,u_merc_center:g,u_image0:0,u_frustum_tl:x,u_frustum_tr:M,u_frustum_br:P,u_frustum_bl:z,u_globe_pos:L,u_globe_radius:F,u_viewport:B,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9),u_skirt_height:j,u_far_z_cutoff:Z});function df(d,t){return d!=null&&t!=null&&!(!d.hasData()||!t.hasData())&&d.demTexture!=null&&t.demTexture!=null&&d.tileID.key!==t.tileID.key}const ya=new class{constructor(){this.operations={}}newMorphing(d,t,s,h,m){if(d in this.operations){const g=this.operations[d];g.to.tileID.key!==s.tileID.key&&(g.queued=s)}else this.operations[d]={startTime:h,phase:0,duration:m,from:t,to:s,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const t=this.operations[d];return{from:t.from,to:t.to,phase:t.phase}}update(d){for(const t in this.operations){const s=this.operations[t];for(s.phase=(d-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,d)){delete this.operations[t];break}}}_nextOp(d,t){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=t,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},va={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ff(d,t,s){if(t===0)return 0;const h=t<1&&s===514?.25/t:1;return 6*Math.pow(1.5,22-d)*Math.max(t,1)*h}function xa(d,t){const s=1<<d.z;return!t&&(d.x===0||d.x===s-1)||d.y===0||d.y===s-1}const Uc=d=>({u_matrix:d});function Rl(d,t,s,h,m){if(m>0){const g=i.q.now(),x=(g-d.timeAdded)/m,M=t?(g-t.timeAdded)/m:-1,P=s.getSource(),z=h.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),F=L&&d.refreshedUponExpiration?1:i.ay(L?x:1-M,0,1);return d.refreshedUponExpiration&&x>=1&&(d.refreshedUponExpiration=!1),t?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Qm extends ws{constructor(t){const s={type:"raster-dem",maxzoom:t.transform.maxZoom},h=new i.D(i.cj(),null),m=Ld("mock-dem",s,h,t.style);super("mock-dem",m,!1),m.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,s){t.state="loaded",s(null)}}class e_ extends ws{constructor(t){const s=Ld("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new i.D(i.cj(),null),t.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,s,h){if(t.freezeTileCoverage)return;this.transform=t;const m=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((g,x)=>{if(g[x.key]="",!this._tiles[x.key]){const M=new pa(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom);M.state="loaded",this._tiles[x.key]=M}return g},{});for(const g in this._tiles)g in m||(this.freeFBO(g),this._tiles[g].unloadVectorData(),delete this._tiles[g])}freeFBO(t){const s=this.proxyCachedFBO[t];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class hh extends i.aH{constructor(t,s,h){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class dh extends i.cK{constructor(t,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,m,g]=function(P){const z=new i.b5,L=new i.aV,F=131;z.reserve(17161),L.reserve(33800);const B=i.ai/128,j=i.ai+B/2,Z=j+B;for(let J=-B;J<Z;J+=B)for(let Q=-B;Q<Z;Q+=B){const oe=Q<0||Q>j||J<0||J>j?24575:0,ue=i.ay(Math.round(Q),0,i.ai),ce=i.ay(Math.round(J),0,i.ai);z.emplaceBack(ue+oe,ce)}const H=(J,Q)=>{const oe=Q*F+J;L.emplaceBack(oe+1,oe,oe+F),L.emplaceBack(oe+F,oe+F+1,oe+1)};for(let J=1;J<129;J++)for(let Q=1;Q<129;Q++)H(Q,J);return[0,129].forEach(J=>{for(let Q=0;Q<130;Q++)H(Q,J),H(J,Q)}),[z,L,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(h,i.b7.members),this.gridIndexBuffer=x.createIndexBuffer(m),this.gridSegments=i.b8.simpleSegment(0,0,h.length,m.length),this.gridNoSkirtSegments=i.b8.simpleSegment(0,0,h.length,g),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new e_(s.map),this.orthoMatrix=i.ad.mat4.create(),i.ad.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,i.ai,0,i.ai,0,1);const M=x.gl;this._overlapStencilMode=new br({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qm(s.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,s,h){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const m=t.terrain.properties,g=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=i.q.now();const M=t.terrain&&t.terrain.scope,P=m.get("source"),z=g?this._mockSourceCache:t.getSourceCache(P,M);if(!z)return void i.w(`Couldn't find terrain source "${P}".`);if(this.sourceCache=z,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(s):m.get("exaggeration"),!s.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&i.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const F=this.getScaledDemTileSize();this.sourceCache.update(s,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),s.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const s=this._previousCameraAltitude,h=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=h;const m=s!=null?h-s:Number.MAX_VALUE;if(Math.abs(m)<2)return this._exaggeration;const g=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(g);let M=g-this._previousZoom;const P=this._previousUpdateTimestamp;let z=g;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(g-z)>.5&&(M=.5*(g-z+M)),M*m<0&&(z+=M)),this._evaluationZoom=z;const L=x.getExaggeration(z),F=L===x.getExaggeration(Math.max(0,z-.1));if(F&&Math.abs(L-this._exaggeration)<.01)return L;let B=Math.min(.1,.00375*(this._updateTimestamp-P));return(F||L<.1||Math.abs(M)<1e-4)&&(B=Math.min(.2,4*B)),i.ah(this._exaggeration,L,B)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(i.ac.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const m=this.proxyCoords=s.getIds().map(P=>{const z=s.getTileByID(P).tileID;return z.projMatrix=h.calculateProjMatrix(z.toUnwrapped()),z});(function(P,z){const L=z.transform.pointCoordinate(z.transform.getCameraPoint()),F=new i.P(L.x,L.y);P.sort((B,j)=>{if(j.overscaledZ-B.overscaledZ)return j.overscaledZ-B.overscaledZ;const Z=new i.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),H=new i.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),J=F.mult(1<<B.canonical.z);return J.x-=.5,J.y-=.5,J.distSqr(Z)-J.distSqr(H)})})(m,this.painter);const g=this.proxyToSource||{};this.proxyToSource={},m.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const P in x){const z=x[P];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,t[P],g),z.usedForTerrain))continue;const L=t[P];z.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[s.id]=m.map(P=>new hh(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(m),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(g),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const z=this.terrainTileForTile[P.key];if(!z)continue;const L=z.tileID.key;L in M||(this._visibleDemTiles.push(z),M[L]=L)}}_assignTerrainTiles(t){this._initializing||t.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const t=this.painter.context,s=t.gl;for(const h in this.terrainTileForTile){const m=this.terrainTileForTile[h],g=m.dem;!g||m.demTexture&&!m.needsDEMTextureUpload||(t.activeTexture.set(s.TEXTURE1),Ja(this.painter,m,g))}}_prepareDemTileUniforms(t,s,h,m){if(!s||s.demTexture==null)return!1;const g=t.tileID.canonical,x=Math.pow(2,s.tileID.canonical.z-g.z),M=m||"";return h[`u_dem_tl${M}`]=[g.x*x%1,g.y*x%1],h[`u_dem_scale${M}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const s=this._visibleDemTiles.reduce((h,m)=>{if(!m.dem)return h;const g=m.dem.tree.minimums[0];return g>0&&t++,h+g},0);return t?s/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,s=t.gl;t.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),m=new i.cL({width:1,height:1},new Float32Array([h]));this._emptyDEMTextureDirty=!1;let g=this._emptyDEMTexture;return g?g.update(m,{premultiply:!1}):g=this._emptyDEMTexture=new i.T(t,m,s.R32F,{premultiply:!1}),g}setupElevationDraw(t,s,h){const m=this.painter.context,g=m.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let M=null,P=null,z=1;if(h&&h.morphing&&this._useVertexMorphing){const j=h.morphing.srcDemTile,Z=h.morphing.dstDemTile;z=h.morphing.phase,j&&Z&&(this._prepareDemTileUniforms(t,j,x,"_prev")&&(P=j),this._prepareDemTileUniforms(t,Z,x)&&(M=Z))}const L=j=>j&&j.demTexture&&this.painter.linearFloatFilteringSupported()?g.LINEAR:g.NEAREST;let F=null;var B;if(this.enabled?P&&M?(F=M.demTexture,m.activeTexture.set(g.TEXTURE4),P.demTexture.bind(L(P),g.CLAMP_TO_EDGE),x.u_dem_lerp=z):(M=this.terrainTileForTile[t.tileID.key],F=this._prepareDemTileUniforms(t,M,x)?M.demTexture:this.emptyDEMTexture):F=this.emptyDEMTexture,m.activeTexture.set(g.TEXTURE2),F&&(x.u_dem_size=(B=F).size[0]===1?1:B.size[0]-2,F.bind(L(M),g.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(h&&h.useDepthForOcclusion,s,x),h&&h.useMeterToDem&&M){const j=(1<<M.tileID.canonical.z)*i.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=j}if(h&&h.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(m,x),this.painter.transform.projection.name==="globe"){const j=this.globeUniformValues(this.painter.transform,t.tileID.canonical,h&&h.useDenormalizedUpVectorScale);s.setGlobeUniformValues(m,j)}}globeUniformValues(t,s,h){const m=t.projection;return{u_tile_tl_up:m.upVector(s,0,0),u_tile_tr_up:m.upVector(s,i.ai,0),u_tile_br_up:m.upVector(s,i.ai,i.ai),u_tile_bl_up:m.upVector(s,0,i.ai),u_tile_up_scale:h?i.cM(1):m.upVectorScale(s,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const s=this.painter,h=this.painter.context;t.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(m,g,x,M,P){if(m.transform.projection.name==="globe")(function(z,L,F,B,j){const Z=z.context,H=Z.gl;let J,Q;const oe=z.transform,ue=i.cD(z,Z,oe),ce=(et,rt)=>{if(Q===rt)return;const _t=[va[rt],"PROJECTION_GLOBE_VIEW"];ue&&_t.push("CUSTOM_ANTIALIASING");const Oe=z.isTileAffectedByFog(et);J=z.getOrCreateProgram("globeRaster",{defines:_t,overrideFog:Oe}),Q=rt},ge=z.colorModeForRenderPass(),fe=new Xt(H.LEQUAL,Xt.ReadWrite,z.depthRangeFor3D);ya.update(j);const _e=i.cE(oe),pe=[i.av(oe.center.lng),i.aC(oe.center.lat)],we=z.globeSharedBuffers,Ee=[oe.width*i.q.devicePixelRatio,oe.height*i.q.devicePixelRatio],qe=Float32Array.from(oe.globeMatrix),Be={useDenormalizedUpVectorScale:!0};{const et=z.transform,rt=ff(et.zoom,L.exaggeration(),L.sourceCache._source.tileSize);Q=-1;const _t=H.TRIANGLES;for(const Oe of B){const Qe=F.getTile(Oe),De=br.disabled,Je=L.prevTerrainTileForTile[Oe.key],Ze=L.terrainTileForTile[Oe.key];df(Je,Ze)&&ya.newMorphing(Oe.key,Je,Ze,j,250),Z.activeTexture.set(H.TEXTURE0),Qe.texture&&Qe.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);const st=ya.getMorphValuesForProxy(Oe.key),$e=st?1:0;st&&i.L(Be,{morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:i.cC(st.phase)}});const lt=i.cF(Oe.canonical),wt=i.cG(lt.getCenter().lat),Mt=i.cH(Oe.canonical,lt,wt,et.worldSize/et._pixelsPerMercatorPixel),Lt=i.bc(i.cI(Oe.canonical)),Wt=hf(et.expandedFarZProjMatrix,qe,_e,Lt,i.ag(et.zoom),pe,et.frustumCorners.TL,et.frustumCorners.TR,et.frustumCorners.BR,et.frustumCorners.BL,et.globeCenterInViewSpace,et.globeRadius,Ee,rt,et._farZ,Mt);if(ce(Oe,$e),J&&(L.setupElevationDraw(Qe,J,Be),z.uploadCommonUniforms(Z,J,Oe.toUnwrapped()),we)){const[fr,nr,pr]=we.getGridBuffers(wt,rt!==0);J.draw(z,_t,fe,De,ge,dr.backCCW,Wt,"globe_raster",fr,nr,pr)}}}if(we&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const et=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&et.push("CUSTOM_ANTIALIASING"),J=z.getOrCreateProgram("globeRaster",{defines:et});for(const rt of B){const{x:_t,y:Oe,z:Qe}=rt.canonical,De=Oe===0,Je=Oe===(1<<Qe)-1,[Ze,st,$e,lt]=we.getPoleBuffers(Qe,!1);if(lt&&(De||Je)){const wt=F.getTile(rt);Z.activeTexture.set(H.TEXTURE0),wt.texture&&wt.texture.bind(H.LINEAR,H.CLAMP_TO_EDGE);let Mt=i.cJ(Qe,_t,oe);const Lt=i.bc(i.cI(rt.canonical)),Wt=(fr,nr)=>fr.draw(z,H.TRIANGLES,fe,br.disabled,ge,dr.disabled,hf(oe.expandedFarZProjMatrix,Mt,Mt,Lt,0,pe,oe.frustumCorners.TL,oe.frustumCorners.TR,oe.frustumCorners.BR,oe.frustumCorners.BL,oe.globeCenterInViewSpace,oe.globeRadius,Ee,0,oe._farZ),"globe_pole_raster",nr,$e,lt);L.setupElevationDraw(wt,J,Be),z.uploadCommonUniforms(Z,J,rt.toUnwrapped()),De&&z.renderDefaultNorthPole&&Wt(J,Ze),Je&&z.renderDefaultSouthPole&&(Mt=i.ad.mat4.scale(i.ad.mat4.create(),Mt,[1,-1,1]),Wt(J,st))}}}})(m,g,x,M,P);else{const z=m.context,L=z.gl;let F,B;const j=m.shadowRenderer,Z=_a(m,m.longestCutoffRange),H=ge=>{if(B===ge)return;const fe=[];fe.push(va[ge]),Z.shouldRenderCutoff&&fe.push("RENDER_CUTOFF"),j&&(fe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&fe.push("NORMAL_OFFSET")),F=m.getOrCreateProgram("terrainRaster",{defines:fe}),B=ge},J=m.colorModeForRenderPass(),Q=new Xt(L.LEQUAL,Xt.ReadWrite,m.depthRangeFor3D);ya.update(P);const oe=m.transform,ue=ff(oe.zoom,g.exaggeration(),g.sourceCache._source.tileSize);let ce=[0,0,0];if(j){const ge=m.style.directionalLight,fe=m.style.ambientLight;ge&&fe&&(ce=Go(m.style,ge,fe))}{B=-1;const ge=L.TRIANGLES,[fe,_e]=[g.gridIndexBuffer,g.gridSegments];for(const pe of M){const we=x.getTile(pe),Ee=br.disabled,qe=g.prevTerrainTileForTile[pe.key],Be=g.terrainTileForTile[pe.key];df(qe,Be)&&ya.newMorphing(pe.key,qe,Be,P,250),z.activeTexture.set(L.TEXTURE0),we.texture&&we.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const et=ya.getMorphValuesForProxy(pe.key),rt=et?1:0;let _t;et&&(_t={morphing:{srcDemTile:et.from,dstDemTile:et.to,phase:i.cC(et.phase)}});const Oe=Jm(pe.projMatrix,xa(pe.canonical,oe.renderWorldCopies)?ue/10:ue,ce);if(H(rt),!F)continue;g.setupElevationDraw(we,F,_t);const Qe=pe.toUnwrapped();j&&j.setupShadows(Qe,F),m.uploadCommonUniforms(z,F,Qe,null,Z),F.draw(m,ge,Q,Ee,J,dr.backCCW,Oe,"terrain_raster",g.gridBuffer,fe,_e)}}}}(s,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,m=this.proxySourceCache,g=this.proxiedCoords[m.id],x=this._drapedRenderBatches.shift(),M=s.style.order,P=[];let z=0;for(const L of g){const F=m.getTileByID(L.proxyTileKey),B=m.proxyCachedFBO[L.key]?m.proxyCachedFBO[L.key][t]:void 0,j=B!==void 0?m.renderCache[B]:this.pool[z++],Z=B!==void 0;if(F.texture=j.tex,Z&&!j.dirty){P.push(F.tileID);continue}let H;h.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(h.clear({color:i.al.transparent,stencil:0}),j.dirty=!1);for(let J=x.start;J<=x.end;++J){const Q=s.style._mergedLayers[M[J]];if(Q.isHidden(s.transform.zoom))continue;const oe=s.style.getLayerSourceCache(Q),ue=oe?this.proxyToSource[L.key][oe.id]:[L];if(!ue)continue;const ce=ue;h.viewport.set([0,0,j.fb.width,j.fb.height]),H!==(oe?oe.id:null)&&(this._setupStencil(j,ue,Q,oe),H=oe?oe.id:null),s.renderLayer(s,oe,Q,ce)}if(this._drapedRenderBatches.length===0)for(const J of this._pendingGroundEffectLayers){const Q=s.style._mergedLayers[M[J]];if(Q.isHidden(s.transform.zoom))continue;const oe=s.style.getLayerSourceCache(Q),ue=oe?this.proxyToSource[L.key][oe.id]:[L];if(!ue)continue;const ce=ue;h.viewport.set([0,0,j.fb.width,j.fb.height]),H!==(oe?oe.id:null)&&(this._setupStencil(j,ue,Q,oe),H=oe?oe.id:null),s.renderLayer(s,oe,Q,ce)}this.renderedToTile?(j.dirty=!0,P.push(F.tileID)):Z||--z,z===5&&(z=0,this.renderToBackBuffer(P))}return this.renderToBackBuffer(P),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){const s=t.order.length;let h=-1,m=s;for(let g=0;g<s;++g)this._style.isLayerDraped(t._mergedLayers[t.order[g]])?h=Math.max(h,g):m=Math.min(m,g);return m>h}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{t=Math.min(t,s.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,s,h){if(!this._visibleDemTiles)return null;const m=this._visibleDemTiles.filter(g=>g.dem).map(g=>{const x=g.tileID,M=1<<x.overscaledZ,{x:P,y:z}=x.canonical,L=P/M,F=(P+1)/M,B=z/M,j=(z+1)/M;return{minx:L,miny:B,maxx:F,maxy:j,t:g.dem.tree.raycastRoot(L,B,F,j,t,s,h),tile:g}});m.sort((g,x)=>(g.t!==null?g.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const g of m){if(g.t==null)return null;const x=g.tile.dem.tree.raycast(g.minx,g.miny,g.maxx,g.maxy,t,s,h);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,s=t.gl,h=this.drapeBufferSize;t.activeTexture.set(s.TEXTURE0);const m=new i.T(t,{width:h[0],height:h[1],data:null},s.RGBA8);m.bind(s.LINEAR,s.CLAMP_TO_EDGE);const g=t.createFramebuffer(h[0],h[1],!0,null);return g.colorAttachment.set(m.texture),g.depthAttachment=new Pl(t,g.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,g.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):g.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:g,tex:m,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const s=this._style._mergedLayers[t],h=s.isHidden(this.painter.transform.zoom);return s.type==="hillshade"||s.type==="custom"?!h&&s.shouldRedrape():!h&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const h of this._style.getSources())if(h instanceof Ni){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const m=this._style._mergedLayers[this._style.order[h]],g=this._style.getLayerSourceCache(m);if(g&&!s[g.id]&&!m.isHidden(this.painter.transform.zoom)&&m.type==="line"&&m.widthExpression()instanceof i.ab){s[g.id]=!0;for(const x of this.proxyCoords){const M=this.proxyToSource[x.key][g.id];if(M)for(const P of M)this._clearRenderCacheForTile(g.id,P)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof fa){t=!0;break}if(!t)return;const s={};for(let h=0;h<this._style.order.length;++h){const m=this._style._mergedLayers[this._style.order[h]],g=this._style.getLayerSourceCache(m);if(!g||s[g.id]||m.isHidden(this.painter.transform.zoom)||m.type!=="raster")continue;const x=m.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const P=this.proxyToSource[M.key][g.id];if(P)for(const z of P){const L=Rl(g.getTile(z),g.findLoadedParent(z,0),g,this.painter.transform,x);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(g.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,s=t.length;if(s===0)return;const h=[];this._pendingGroundEffectLayers=[];let m,g=0,x=this._style._mergedLayers[t[g]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++g<s;)x=this._style._mergedLayers[t[g]];for(;g<s;++g){const M=this._style._mergedLayers[t[g]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?m===void 0&&(m=g):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(g),m!==void 0&&(h.push({start:m,end:g-1}),m=void 0)))}if(m!==void 0&&h.push({start:m,end:g-1}),h.length!==0){const M=h[h.length-1];this._pendingGroundEffectLayers.every(P=>P>M.end)||i.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(t){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const x=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let M=0;M<x.length;++M){const P=Object.values(x[M]);s.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,m=this._tilesDirty;for(let x=h.length-1;x>=0;x--){const M=h[x];if(s.getTileByID(M.key),s.proxyCachedFBO[M.key]!==void 0){const P=t[M.key],z=this.proxyToSource[M.key];let L=0;for(const F in z){const B=z[F],j=P[F];if(!j||j.length!==B.length||B.some((Z,H)=>Z!==j[H]||m[F]&&m[F].hasOwnProperty(Z.key))){L=-1;break}++L}for(const F in s.proxyCachedFBO[M.key])s.renderCache[s.proxyCachedFBO[M.key][F]].dirty=L<0||L!==Object.values(P).length}}const g=[...this._drapedRenderBatches];g.sort((x,M)=>M.end-M.start-(x.end-x.start));for(const x of g)for(const M of h){if(s.proxyCachedFBO[M.key])continue;let P=s.renderCachePool.pop();P===void 0&&s.renderCache.length<50&&(P=s.renderCache.length,s.renderCache.push(this._createFBO())),P!==void 0&&(s.proxyCachedFBO[M.key]={},s.proxyCachedFBO[M.key][x.start]=P,s.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(t,s,h,m){if(!m||!this._sourceTilesOverlap[m.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const g=this.painter.context,x=g.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let M;if(h.isTileClipped())M=s.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(g.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):br.disabled}_renderTileClippingMasks(t,s){const h=this.painter,m=this.painter.context,g=m.gl;h._tileClippingMaskIDs={},m.setColorMode(Rr.disabled),m.setDepthMode(Xt.disabled);const x=h.getOrCreateProgram("clippingMask");for(const M of t){const P=h._tileClippingMaskIDs[M.key]=--s;x.draw(h,g.TRIANGLES,Xt.disabled,new br({func:g.ALWAYS,mask:0},P,255,g.KEEP,g.KEEP,g.REPLACE),Rr.disabled,dr.disabled,Uc(M.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(t){const s=this.painter.transform;if(t.x<0||t.x>s.width||t.y<0||t.y>s.height)return null;const h=[t.x,t.y,1,1];i.ad.vec4.transformMat4(h,h,s.pixelMatrixInverse),i.ad.vec4.scale(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const m=s._camera.position,g=i.bH(1,s.center.lat),x=[m[0],m[1],m[2]/g,0],M=i.ad.vec3.subtract([],h.slice(0,3),x);i.ad.vec3.normalize(M,M);const P=this.raycast(x,M,this._exaggeration);return P!==null&&P?(i.ad.vec3.scaleAndAdd(x,x,M,P),x[3]=x[2],x[2]*=g,x):null}_setupProxiedCoordsForOrtho(t,s,h){if(t.getSource()instanceof i.aK)return this._setupProxiedCoordsForImageSource(t,s,h);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords;for(let P=0;P<g.length;P++){const z=g[P],L=this._findTileCoveringTileID(z,t);if(L){const F=this._createProxiedId(z,L,h[z.key]&&h[z.key][t.id]);m.push(F),this.proxyToSource[z.key][t.id]=[F]}}let x=!1;const M=new Set;for(let P=0;P<s.length;P++){const z=t.getTile(s[P]);if(!z||!z.hasData())continue;const L=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==z.tileID.canonical.z){const F=this.proxyToSource[L.tileID.key][t.id],B=this._createProxiedId(L.tileID,z,h[L.tileID.key]&&h[L.tileID.key][t.id]);F?F.splice(F.length-1,0,B):this.proxyToSource[L.tileID.key][t.id]=[B];const j=this.proxyToSource[L.tileID.key][t.id];M.has(j)||M.add(j),m.push(B),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const P of M)P.sort((z,L)=>L.overscaledZ-z.overscaledZ)}_setupProxiedCoordsForImageSource(t,s,h){if(!t.getSource().loaded())return;const m=this.proxiedCoords[t.id]=[],g=this.proxyCoords,x=t.getSource(),M=x.tileID;if(!M)return;const P=new i.P(M.x,M.y)._div(1<<M.z),z=x.coordinates.map(i.ac.fromLngLat).reduce((F,B)=>(F.min.x=Math.min(F.min.x,B.x-P.x),F.min.y=Math.min(F.min.y,B.y-P.y),F.max.x=Math.max(F.max.x,B.x-P.x),F.max.y=Math.max(F.max.y,B.y-P.y),F),{min:new i.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new i.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(F,B)=>{const j=F.wrap+F.canonical.x/(1<<F.canonical.z),Z=F.canonical.y/(1<<F.canonical.z),H=i.ai/(1<<F.canonical.z),J=B.wrap+B.canonical.x/(1<<B.canonical.z),Q=B.canonical.y/(1<<B.canonical.z);return j+H<J+z.min.x||j>J+z.max.x||Z+H<Q+z.min.y||Z>Q+z.max.y};for(let F=0;F<g.length;F++){const B=g[F];for(let j=0;j<s.length;j++){const Z=t.getTile(s[j]);if(!Z||!Z.hasData()||L(B,Z.tileID))continue;const H=this._createProxiedId(B,Z,h[B.key]&&h[B.key][t.id]),J=this.proxyToSource[B.key][t.id];J?J.push(H):this.proxyToSource[B.key][t.id]=[H],m.push(H)}}}_createProxiedId(t,s,h){let m=this.orthoMatrix;if(h){const g=h.find(x=>x.key===s.tileID.key);if(g)return g}if(s.tileID.key!==t.key){const g=t.canonical.z-s.tileID.canonical.z;let x,M,P;m=i.ad.mat4.create();const z=s.tileID.wrap-t.wrap<<t.overscaledZ;g>0?(x=i.ai>>g,M=x*((s.tileID.canonical.x<<g)-t.canonical.x+z),P=x*((s.tileID.canonical.y<<g)-t.canonical.y)):(x=i.ai<<-g,M=i.ai*(s.tileID.canonical.x-(t.canonical.x+z<<-g)),P=i.ai*(s.tileID.canonical.y-(t.canonical.y<<-g))),i.ad.mat4.ortho(m,0,x,0,x,0,1),i.ad.mat4.translate(m,m,[M,P,0])}return new hh(s.tileID,t.key,m)}_findTileCoveringTileID(t,s){let h=s.getTile(t);if(h&&h.hasData())return h;const m=this._findCoveringTileCache[s.id],g=m[t.key];if(h=g?s.getTileByID(g):null,h&&h.hasData()||g===null)return h;let x=h?h.tileID:t,M=x.overscaledZ;const P=s.getSource().minzoom,z=[];if(!g){const F=s.getSource().maxzoom;if(t.canonical.z>=F){const B=t.canonical.z-F;s.getSource().reparseOverscaled?(M=Math.max(t.canonical.z+2,s.transform.tileZoom),x=new i.aH(M,t.wrap,F,t.canonical.x>>B,t.canonical.y>>B)):B!==0&&(M=F,x=new i.aH(M,t.wrap,F,t.canonical.x>>B,t.canonical.y>>B))}x.key!==t.key&&(z.push(x.key),h=s.getTile(x))}const L=F=>{z.forEach(B=>{m[B]=F}),z.length=0};for(M-=1;M>=P&&(!h||!h.hasData());M--){h&&L(h.tileID.key);const F=x.calculateScaledKey(M);if(h=s.getTileByID(F),h&&h.hasData())break;const B=m[F];if(B===null)break;B===void 0?z.push(F):h=s.getTileByID(B)}return L(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,s){let h=this._tilesDirty[t];h||(h=this._tilesDirty[t]={}),h[s.key]=!0}}function sv(d,t,s){const h=function(M,P,z){const L=i.ad.vec3.dot(P,M),F=i.ad.vec3.dot(z,[.2126,.7152,.0722]),B=(Z,H,J)=>(1-J)*Z+J*H,j=B(1-.3*Math.min(F,1),1,Math.min(L+1,1));return B(.92,1,Math.asin(i.ay(P[2],-1,1))/Math.PI+.5)*j}(d,[0,0,1],t),m=[0,0,0];i.ad.vec3.scale(m,s.slice(0,3),h);const g=[0,0,0];i.ad.vec3.scale(g,t.slice(0,3),d[2]);const x=[0,0,0];return i.ad.vec3.add(x,m,g),i.cg(x)}const t_=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],jc=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class r_{static cacheKey(t,s,h,m){let g=`${s}${m?m.cacheKey:""}`;for(const x of h)t.usedDefines.includes(x)&&(g+=`/${x}`);return g}constructor(t,s,h,m,g,x){const M=t.gl;this.program=M.createProgram(),this.configuration=m,this.name=s,this.fixedDefines=[...x];const P=m?m.getBinderAttributes():[],z=(h.staticAttributes||[]).concat(P);let L=m?m.defines():[];L=L.concat(x.map(J=>`#define ${J}`));const F=`#version 300 es
`;let B=F+L.concat("precision mediump float;",Yd,ih.fragmentSource).join(`
`);for(const J of h.fragmentIncludes)B+=`
${qo[J]}`;B+=`
${h.fragmentSource}`;let j=F+L.concat("precision highp float;",Yd,ih.vertexSource).join(`
`);for(const J of h.vertexIncludes)j+=`
${qo[J]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&h.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(j+=`
uniform int u_instanceID;
`),j+=`
${h.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(j=j.replaceAll("gl_InstanceID","u_instanceID"));const Z=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(Z,B),M.compileShader(Z),M.attachShader(this.program,Z);const H=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(H,j),M.compileShader(H),M.attachShader(this.program,H),this.attributes={},this.numAttributes=z.length;for(let J=0;J<this.numAttributes;J++)if(z[J]){const Q=z[J].startsWith("a_")?z[J]:`a_${z[J]}`;M.bindAttribLocation(this.program,J,Q),this.attributes[Q]=J}M.linkProgram(this.program),M.deleteShader(H),M.deleteShader(Z),this.fixedUniforms=g(t),this.binderUniforms=m?m.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(J=>({u_instanceID:new i.bN(J)}))(t)),(x.includes("TERRAIN")||s.indexOf("symbol")!==-1||s.indexOf("circle")!==-1)&&(this.terrainUniforms=(J=>({u_dem:new i.bN(J),u_dem_prev:new i.bN(J),u_dem_tl:new i.bK(J),u_dem_scale:new i.bM(J),u_dem_tl_prev:new i.bK(J),u_dem_scale_prev:new i.bM(J),u_dem_size:new i.bM(J),u_dem_lerp:new i.bM(J),u_exaggeration:new i.bM(J),u_depth:new i.bN(J),u_depth_size_inv:new i.bK(J),u_depth_range_unpack:new i.bK(J),u_occluder_half_size:new i.bM(J),u_occlusion_depth_offset:new i.bM(J),u_meter_to_dem:new i.bM(J),u_label_plane_matrix_inv:new i.bJ(J)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(J=>({u_tile_tl_up:new i.bL(J),u_tile_tr_up:new i.bL(J),u_tile_br_up:new i.bL(J),u_tile_bl_up:new i.bL(J),u_tile_up_scale:new i.bM(J)}))(t)),x.includes("FOG")&&(this.fogUniforms=(J=>({u_fog_matrix:new i.bJ(J),u_fog_range:new i.bK(J),u_fog_color:new i.cb(J),u_fog_horizon_blend:new i.bM(J),u_fog_vertical_limit:new i.bK(J),u_fog_temporal_offset:new i.bM(J),u_frustum_tl:new i.bL(J),u_frustum_tr:new i.bL(J),u_frustum_br:new i.bL(J),u_frustum_bl:new i.bL(J),u_globe_pos:new i.bL(J),u_globe_radius:new i.bM(J),u_globe_transition:new i.bM(J),u_is_globe:new i.bN(J),u_viewport:new i.bK(J)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(J=>({u_cutoff_params:new i.cb(J)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(J=>({u_lighting_ambient_color:new i.bL(J),u_lighting_directional_dir:new i.bL(J),u_lighting_directional_color:new i.bL(J),u_ground_radiance:new i.bL(J)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(J=>({u_light_matrix_0:new i.bJ(J),u_light_matrix_1:new i.bJ(J),u_fade_range:new i.bK(J),u_shadow_normal_offset:new i.bL(J),u_shadow_intensity:new i.bM(J),u_shadow_texel_size:new i.bM(J),u_shadow_map_resolution:new i.bM(J),u_shadow_direction:new i.bL(J),u_shadow_bias:new i.bL(J),u_shadowmap_0:new i.bN(J),u_shadowmap_1:new i.bN(J)}))(t))}}setTerrainUniformValues(t,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m]&&h[m].set(this.program,m,s[m])}}setGlobeUniformValues(t,s){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m]&&h[m].set(this.program,m,s[m])}}setFogUniformValues(t,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setCutoffUniformValues(t,s){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setLightsUniformValues(t,s){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}}setShadowUniformValues(t,s){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;t.program.set(this.program);for(const m in s)h[m].set(this.program,m,s[m])}_drawDebugWireframe(t,s,h,m,g,x,M,P,z,L){const F=t.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;const B=t.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||t._terrain&&t._terrain.renderingToTexture||!t_.includes(this.name))||!(!F.layers3D||!jc.includes(this.name))))return;const j=B.gl,Z=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,g,B);if(!Z)return;const H=[...this.fixedDefines];H.push("DEBUG_WIREFRAME");const J=t.getOrCreateProgram(this.name,{config:this.configuration,defines:H});B.program.set(J.program);const Q=(ce,ge,fe)=>{if(ge[ce]&&fe[ce])for(const _e in ge[ce])fe[ce][_e]&&fe[ce][_e].set(fe.program,_e,ge[ce][_e].current)};z&&z.setUniforms(J.program,B,J.binderUniforms,M,{zoom:P}),Q("fixedUniforms",this,J),Q("terrainUniforms",this,J),Q("globeUniforms",this,J),Q("fogUniforms",this,J),Q("lightsUniforms",this,J),Q("shadowUniforms",this,J),Z.bind(),B.setColorMode(new Rr([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],i.al.transparent,[!0,!0,!0,!1])),B.setDepthMode(new Xt(s.func===j.LESS?j.LEQUAL:s.func,Xt.ReadOnly,s.range)),B.setStencilMode(br.disabled);const oe=3*x.primitiveLength*2,ue=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=L||1;for(let ge=0;ge<ce;++ge)J.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ge),j.drawElements(j.LINES,oe,j.UNSIGNED_SHORT,ue)}else L&&L>1?j.drawElementsInstanced(j.LINES,oe,j.UNSIGNED_SHORT,ue,L):j.drawElements(j.LINES,oe,j.UNSIGNED_SHORT,ue);g.bind(),B.program.set(this.program),B.setDepthMode(s),B.setStencilMode(h),B.setColorMode(m)}checkUniforms(t,s,h){if(this.fixedDefines.includes(s)){for(const m of Object.keys(h))if(!h[m].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${m} not set but required by ${s} being defined`)}}draw(t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H,J){const Q=t.context,oe=Q.gl;if(this.failedToCreate)return;Q.program.set(this.program),Q.setDepthMode(h),Q.setStencilMode(m),Q.setColorMode(g),Q.setCullFace(x);for(const ge of Object.keys(this.fixedUniforms))this.fixedUniforms[ge].set(this.program,ge,M[ge]);Z&&Z.setUniforms(this.program,Q,this.binderUniforms,B,{zoom:j});const ue={[oe.POINTS]:1,[oe.LINES]:2,[oe.TRIANGLES]:3,[oe.LINE_STRIP]:1}[s];this.checkUniforms(P,"RENDER_SHADOWS",this.shadowUniforms);const ce=J&&J>0?1:void 0;for(const ge of F.get()){const fe=ge.vaos||(ge.vaos={});if((fe[P]||(fe[P]=new jm)).bind(Q,this,z,Z?Z.getPaintVertexBuffers():[],L,ge.vertexOffset,H||[],ce),this.forceManualRenderingForInstanceIDShaders){const _e=J||1;for(let pe=0;pe<_e;++pe)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",pe),L?oe.drawElements(s,ge.primitiveLength*ue,oe.UNSIGNED_SHORT,ge.primitiveOffset*ue*2):oe.drawArrays(s,ge.vertexOffset,ge.vertexLength)}else J&&J>1?oe.drawElementsInstanced(s,ge.primitiveLength*ue,oe.UNSIGNED_SHORT,ge.primitiveOffset*ue*2,J):L?oe.drawElements(s,ge.primitiveLength*ue,oe.UNSIGNED_SHORT,ge.primitiveOffset*ue*2):oe.drawArrays(s,ge.vertexOffset,ge.vertexLength);s===oe.TRIANGLES&&L&&this._drawDebugWireframe(t,h,m,g,L,ge,B,j,Z,J)}}}function n_(d,t){const s=Math.pow(2,t.tileID.overscaledZ),h=t.tileSize*Math.pow(2,d.transform.tileZoom)/s,m=h*(t.tileID.canonical.x+t.tileID.wrap*s),g=h*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/i.at(t,1,d.transform.tileZoom),u_pixel_coord_upper:[m>>16,g>>16],u_pixel_coord_lower:[65535&m,65535&g]}}const $c={terrain:0,flat:1},ov=i.ad.mat4.create(),fh=(d,t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H,J,Q)=>{const oe=t.style.light,ue=oe.properties.get("position"),ce=[ue.x,ue.y,ue.z],ge=i.ad.mat3.create();oe.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(ge,-t.transform.angle),i.ad.vec3.transformMat3(ce,ce,ge));const fe=oe.properties.get("color"),_e=t.transform,pe={u_matrix:d,u_lightpos:ce,u_lightintensity:oe.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ov,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:$c[z],u_base_type:$c[L],u_ao:m,u_edge_radius:g,u_width_scale:x,u_flood_light_color:Z,u_vertical_scale:H,u_flood_light_intensity:J,u_ground_shadow_factor:Q};return _e.projection.name==="globe"&&(pe.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],pe.u_zoom_transition=F,pe.u_inv_rot_matrix=j,pe.u_merc_center=B,pe.u_up_dir=_e.projection.upVector(new i.bT(0,0,0),B[0]*i.ai,B[1]*i.ai),pe.u_height_lift=P),pe},pf=(d,t,s,h,m,g)=>({u_matrix:d,u_edge_radius:t,u_width_scale:s,u_vertical_scale:h,u_height_type:$c[m],u_base_type:$c[g]}),Dl=(d,t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H,J)=>{const Q=fh(d,t,s,h,m,g,x,M,z,L,F,B,j,Z,H,J,1,[0,0,0]),oe={u_height_factor:-Math.pow(2,M.overscaledZ)/P.tileSize/8};return i.l(Q,n_(t,P),oe)},ph=(d,t)=>({u_matrix:d,u_emissive_strength:t}),zl=(d,t,s,h)=>i.l(ph(d,t),n_(s,h)),i_=(d,t,s)=>({u_matrix:d,u_world:s,u_emissive_strength:t}),mh=(d,t,s,h,m)=>i.l(zl(d,t,s,h),{u_world:m}),Ll=(d,t,s,h,m)=>({u_matrix:d,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:s,u_height_scale:h,u_reset_depth:m}),mf=(d,t,s,h)=>{const m=i.ai/s.tileSize;return{u_matrix:d,u_camera_to_center_distance:t.getCameraToCenterDistance(h),u_extrude_scale:[t.pixelsToGLUnits[0]/m,t.pixelsToGLUnits[1]/m]}},_f=(d,t,s=1)=>({u_matrix:d,u_color:t.toRenderColor(null),u_overlay:0,u_overlay_scale:s}),av=i.ad.mat4.create(),Ol=(d,t,s,h,m,g,x)=>{const M=d.transform,P=M.projection.name==="globe",z=P?i.cO(M.zoom,t.canonical)*M._pixelsPerMercatorPixel:i.at(s,1,g),L={u_matrix:t.projMatrix,u_extrude_scale:z,u_intensity:x,u_inv_rot_matrix:av,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){L.u_inv_rot_matrix=h,L.u_merc_center=m,L.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],L.u_zoom_transition=i.ag(M.zoom);const F=m[0]*i.ai,B=m[1]*i.ai;L.u_up_dir=M.projection.upVector(new i.bT(0,0,0),F,B)}return L};function Gc(d,[t,s,h,m],[g,x]){if(g===x)return[0,0,0,0];const M=255*(d-1)/(d*(x-g));return[t*M,s*M,h*M,m*M]}function Ft(d,t,[s,h]){return s===h?0:.5/d+(t-s)*(d-1)/(d*(h-s))}const gf=(d,t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H,J,Q,oe,ue,ce)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:z,u_fade_t:L.mix,u_opacity:L.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:i.cP(F.paint.get("raster-saturation")),u_contrast_factor:i.cQ(F.paint.get("raster-contrast")),u_spin_weights:s_(F.paint.get("raster-hue-rotate")),u_perspective_transform:B,u_raster_elevation:j,u_zoom_transition:x,u_merc_center:M,u_cutoff_params:P,u_colorization_mix:Gc(i.cR,H,Q),u_colorization_offset:Ft(i.cR,J,Q),u_color_ramp:Z,u_texture_offset:[ue/(oe+2*ue),oe/(oe+2*ue)],u_texture_res:[oe+2*ue,oe+2*ue],u_emissive_strength:ce});function s_(d){d*=Math.PI/180;const t=Math.sin(d),s=Math.cos(d);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Ss=.05,ba=(d,t,s,h,m,g,x,M,P,z,L,F)=>({u_matrix:d,u_normalize_matrix:t,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:m,u_tl_parent:g,u_scale_parent:z,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:F,u_zoom_transition:x,u_merc_center:M,u_cutoff_params:P}),Qt=(d,t,s,h,m,g,x,M,P,z)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_tile_offset:s,u_velocity:h,u_color_ramp:g,u_velocity_res:m,u_max_speed:x,u_uv_offset:M,u_data_scale:[255*P[0],255*P[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ss,Ss]}),yf=(d,t,s,h,m,g,x,M,P,z)=>({u_particle_texture:d,u_particle_texture_side_len:t,u_velocity:s,u_velocity_res:h,u_max_speed:m,u_speed_factor:g,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*P[0],255*P[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Ss,Ss]}),o_=i.ad.mat4.create(),a_=(d,t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H,J,Q,oe,ue,ce,ge)=>{const fe=m.transform,_e={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:fe.getCameraToCenterDistance(oe),u_rotate_symbol:+s,u_aspect_ratio:fe.width/fe.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:M,u_is_text:+z,u_elevation_from_sea:P?1:0,u_pitch_with_map:+h,u_texsize:L,u_texsize_icon:F,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:o_,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:o_,u_up_vector:[0,-1,0],u_color_adj_mat:ue,u_icon_transition:ce||0,u_gamma_scale:h?m.transform.getCameraToCenterDistance(oe)*Math.cos(m.terrain?0:m.transform._pitch):1,u_device_pixel_ratio:i.q.devicePixelRatio,u_is_halo:1,u_scale_factor:ge||1};return oe.name==="globe"&&(_e.u_tile_id=[j.canonical.x,j.canonical.y,1<<j.canonical.z],_e.u_zoom_transition=Z,_e.u_inv_rot_matrix=J,_e.u_merc_center=H,_e.u_camera_forward=fe._camera.forward(),_e.u_ecef_origin=i.cS(fe.globeMatrix,j.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(fe.globeMatrix),_e.u_up_vector=Q),_e},_h=(d,t,s,h)=>({u_matrix:d,u_emissive_strength:t,u_opacity:s,u_color:h}),vf=(d,t,s,h,m,g,x,M,P)=>i.l(function(z,L,F,B,j,Z){const{width:H,height:J}=B.imageManager.getPixelSize(L),Q=Math.pow(2,Z.tileID.overscaledZ),oe=Z.tileSize*Math.pow(2,B.transform.tileZoom)/Q,ue=oe*(Z.tileID.canonical.x+Z.tileID.wrap*Q),ce=oe*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[H,J],u_pattern_size:F.displaySize,u_pattern_units_to_pixels:j?[B.transform.width,-1*B.transform.height]:[1/i.at(Z,1,B.transform.tileZoom),1/i.at(Z,1,B.transform.tileZoom)],u_pixel_coord_upper:[ue>>16,ce>>16],u_pixel_coord_lower:[65535&ue,65535&ce]}}(0,g,x,h,M,P),{u_matrix:d,u_emissive_strength:t,u_opacity:s}),xf=new Float32Array(i.ad.mat4.identity([])),gh=(d,t,s,h,m,g,x,M,P,z,L,F,B,j=[0,0,0],Z)=>{const H=m.style.light,J=H.properties.get("position"),Q=[-J.x,-J.y,J.z],oe=i.ad.mat3.create();H.properties.get("anchor")==="viewport"&&(i.ad.mat3.fromRotation(oe,-m.transform.angle),i.ad.vec3.transformMat3(Q,Q,oe));const ue=L.alphaMode==="MASK",ce=H.properties.get("color").toRenderColor(null),ge=B.paint.get("model-ambient-occlusion-intensity"),fe=B.paint.get("model-color").constantOr(i.al.white).toRenderColor(null),_e=B.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:d,u_lighting_matrix:t,u_normal_matrix:s,u_node_matrix:h||xf,u_lightpos:Q,u_lightintensity:H.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:j,u_opacity:g,u_baseTextureIsAlpha:0,u_alphaMask:+ue,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:[x.r,x.g,x.b,x.a],u_emissiveFactor:[M[0],M[1],M[2],1],u_metallicFactor:P,u_roughnessFactor:z,u_baseColorTexture:Ri.BaseColor,u_metallicRoughnessTexture:Ri.MetallicRoughness,u_normalTexture:Ri.Normal,u_occlusionTexture:Ri.Occlusion,u_emissionTexture:Ri.Emission,u_lutTexture:Ri.LUT,u_color_mix:[fe.r,fe.g,fe.b,_e],u_aoIntensity:ge,u_emissive_strength:F,u_occlusionTextureTransform:Z||[0,0,0,0]}},l_=(d,t=xf,s=xf)=>({u_matrix:d,u_instance:t,u_node_matrix:s}),lv={fillExtrusion:d=>({u_matrix:new i.bJ(d),u_lightpos:new i.bL(d),u_lightintensity:new i.bM(d),u_lightcolor:new i.bL(d),u_vertical_gradient:new i.bM(d),u_opacity:new i.bM(d),u_edge_radius:new i.bM(d),u_width_scale:new i.bM(d),u_ao:new i.bK(d),u_height_type:new i.bN(d),u_base_type:new i.bN(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_up_dir:new i.bL(d),u_height_lift:new i.bM(d),u_flood_light_color:new i.bL(d),u_vertical_scale:new i.bM(d),u_flood_light_intensity:new i.bM(d),u_ground_shadow_factor:new i.bL(d)}),fillExtrusionDepth:d=>({u_matrix:new i.bJ(d),u_edge_radius:new i.bM(d),u_width_scale:new i.bM(d),u_vertical_scale:new i.bM(d),u_height_type:new i.bN(d),u_base_type:new i.bN(d)}),fillExtrusionPattern:d=>({u_matrix:new i.bJ(d),u_lightpos:new i.bL(d),u_lightintensity:new i.bM(d),u_lightcolor:new i.bL(d),u_vertical_gradient:new i.bM(d),u_height_factor:new i.bM(d),u_edge_radius:new i.bM(d),u_width_scale:new i.bM(d),u_ao:new i.bK(d),u_height_type:new i.bN(d),u_base_type:new i.bN(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_up_dir:new i.bL(d),u_height_lift:new i.bM(d),u_image:new i.bN(d),u_texsize:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_tile_units_to_pixels:new i.bM(d),u_opacity:new i.bM(d)}),fillExtrusionGroundEffect:d=>({u_matrix:new i.bJ(d),u_opacity:new i.bM(d),u_ao_pass:new i.bM(d),u_meter_to_tile:new i.bM(d),u_ao:new i.bK(d),u_flood_light_intensity:new i.bM(d),u_flood_light_color:new i.bL(d),u_attenuation:new i.bM(d),u_edge_radius:new i.bM(d),u_fb:new i.bN(d),u_fb_size:new i.bM(d),u_dynamic_offset:new i.bM(d)}),fill:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d)}),fillPattern:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_image:new i.bN(d),u_texsize:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_tile_units_to_pixels:new i.bM(d)}),fillOutline:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_world:new i.bK(d)}),fillOutlinePattern:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_world:new i.bK(d),u_image:new i.bN(d),u_texsize:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_tile_units_to_pixels:new i.bM(d)}),elevatedStructures:d=>({u_matrix:new i.bJ(d)}),elevatedStructuresDepthReconstruct:d=>({u_matrix:new i.bJ(d),u_camera_pos:new i.bL(d),u_depth_bias:new i.bM(d),u_height_scale:new i.bM(d),u_reset_depth:new i.bM(d)}),circle:i.cT,collisionBox:d=>({u_matrix:new i.bJ(d),u_camera_to_center_distance:new i.bM(d),u_extrude_scale:new i.bK(d)}),collisionCircle:d=>({u_matrix:new i.bJ(d),u_inv_matrix:new i.bJ(d),u_camera_to_center_distance:new i.bM(d),u_viewport_size:new i.bK(d)}),debug:d=>({u_color:new i.cA(d),u_matrix:new i.bJ(d),u_overlay:new i.bN(d),u_overlay_scale:new i.bM(d)}),clippingMask:d=>({u_matrix:new i.bJ(d)}),heatmap:d=>({u_extrude_scale:new i.bM(d),u_intensity:new i.bM(d),u_matrix:new i.bJ(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_up_dir:new i.bL(d)}),heatmapTexture:d=>({u_image:new i.bN(d),u_color_ramp:new i.bN(d),u_opacity:new i.bM(d)}),hillshade:d=>({u_matrix:new i.bJ(d),u_image:new i.bN(d),u_latrange:new i.bK(d),u_light:new i.bK(d),u_shadow:new i.cA(d),u_highlight:new i.cA(d),u_emissive_strength:new i.bM(d),u_accent:new i.cA(d)}),hillshadePrepare:d=>({u_matrix:new i.bJ(d),u_image:new i.bN(d),u_dimension:new i.bK(d),u_zoom:new i.bM(d)}),line:i.cU,linePattern:i.cV,raster:d=>({u_matrix:new i.bJ(d),u_normalize_matrix:new i.bJ(d),u_globe_matrix:new i.bJ(d),u_merc_matrix:new i.bJ(d),u_grid_matrix:new i.cB(d),u_tl_parent:new i.bK(d),u_scale_parent:new i.bM(d),u_fade_t:new i.bM(d),u_opacity:new i.bM(d),u_image0:new i.bN(d),u_image1:new i.bN(d),u_brightness_low:new i.bM(d),u_brightness_high:new i.bM(d),u_saturation_factor:new i.bM(d),u_contrast_factor:new i.bM(d),u_spin_weights:new i.bL(d),u_perspective_transform:new i.bK(d),u_raster_elevation:new i.bM(d),u_zoom_transition:new i.bM(d),u_merc_center:new i.bK(d),u_cutoff_params:new i.cb(d),u_colorization_mix:new i.cb(d),u_colorization_offset:new i.bM(d),u_color_ramp:new i.bN(d),u_texture_offset:new i.bK(d),u_texture_res:new i.bK(d),u_emissive_strength:new i.bM(d)}),rasterParticle:d=>({u_matrix:new i.bJ(d),u_normalize_matrix:new i.bJ(d),u_globe_matrix:new i.bJ(d),u_merc_matrix:new i.bJ(d),u_grid_matrix:new i.cB(d),u_tl_parent:new i.bK(d),u_scale_parent:new i.bM(d),u_fade_t:new i.bM(d),u_opacity:new i.bM(d),u_image0:new i.bN(d),u_image1:new i.bN(d),u_raster_elevation:new i.bM(d),u_zoom_transition:new i.bM(d),u_merc_center:new i.bK(d),u_cutoff_params:new i.cb(d)}),rasterParticleTexture:d=>({u_texture:new i.bN(d),u_opacity:new i.bM(d)}),rasterParticleDraw:d=>({u_particle_texture:new i.bN(d),u_particle_texture_side_len:new i.bM(d),u_tile_offset:new i.bK(d),u_velocity:new i.bN(d),u_color_ramp:new i.bN(d),u_velocity_res:new i.bK(d),u_max_speed:new i.bM(d),u_uv_offset:new i.bK(d),u_data_scale:new i.bK(d),u_data_offset:new i.bM(d),u_particle_pos_scale:new i.bM(d),u_particle_pos_offset:new i.bK(d)}),rasterParticleUpdate:d=>({u_particle_texture:new i.bN(d),u_particle_texture_side_len:new i.bM(d),u_velocity:new i.bN(d),u_velocity_res:new i.bK(d),u_max_speed:new i.bM(d),u_speed_factor:new i.bM(d),u_reset_rate:new i.bM(d),u_rand_seed:new i.bM(d),u_uv_offset:new i.bK(d),u_data_scale:new i.bK(d),u_data_offset:new i.bM(d),u_particle_pos_scale:new i.bM(d),u_particle_pos_offset:new i.bK(d)}),symbol:d=>({u_is_size_zoom_constant:new i.bN(d),u_is_size_feature_constant:new i.bN(d),u_size_t:new i.bM(d),u_size:new i.bM(d),u_camera_to_center_distance:new i.bM(d),u_rotate_symbol:new i.bN(d),u_aspect_ratio:new i.bM(d),u_fade_change:new i.bM(d),u_matrix:new i.bJ(d),u_label_plane_matrix:new i.bJ(d),u_coord_matrix:new i.bJ(d),u_is_text:new i.bN(d),u_elevation_from_sea:new i.bN(d),u_pitch_with_map:new i.bN(d),u_texsize:new i.bK(d),u_texsize_icon:new i.bK(d),u_texture:new i.bN(d),u_texture_icon:new i.bN(d),u_gamma_scale:new i.bM(d),u_device_pixel_ratio:new i.bM(d),u_tile_id:new i.bL(d),u_zoom_transition:new i.bM(d),u_inv_rot_matrix:new i.bJ(d),u_merc_center:new i.bK(d),u_camera_forward:new i.bL(d),u_tile_matrix:new i.bJ(d),u_up_vector:new i.bL(d),u_ecef_origin:new i.bL(d),u_is_halo:new i.bN(d),u_icon_transition:new i.bM(d),u_color_adj_mat:new i.bJ(d),u_scale_factor:new i.bM(d)}),background:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_opacity:new i.bM(d),u_color:new i.cA(d)}),backgroundPattern:d=>({u_matrix:new i.bJ(d),u_emissive_strength:new i.bM(d),u_opacity:new i.bM(d),u_image:new i.bN(d),u_pattern_tl:new i.bK(d),u_pattern_br:new i.bK(d),u_texsize:new i.bK(d),u_pattern_size:new i.bK(d),u_pixel_coord_upper:new i.bK(d),u_pixel_coord_lower:new i.bK(d),u_pattern_units_to_pixels:new i.bK(d)}),terrainRaster:d=>({u_matrix:new i.bJ(d),u_image0:new i.bN(d),u_skirt_height:new i.bM(d),u_ground_shadow_factor:new i.bL(d)}),skybox:d=>({u_matrix:new i.bJ(d),u_sun_direction:new i.bL(d),u_cubemap:new i.bN(d),u_opacity:new i.bM(d),u_temporal_offset:new i.bM(d)}),skyboxGradient:d=>({u_matrix:new i.bJ(d),u_color_ramp:new i.bN(d),u_center_direction:new i.bL(d),u_radius:new i.bM(d),u_opacity:new i.bM(d),u_temporal_offset:new i.bM(d)}),skyboxCapture:d=>({u_matrix_3f:new i.cB(d),u_sun_direction:new i.bL(d),u_sun_intensity:new i.bM(d),u_color_tint_r:new i.cb(d),u_color_tint_m:new i.cb(d),u_luminance:new i.bM(d)}),globeRaster:d=>({u_proj_matrix:new i.bJ(d),u_globe_matrix:new i.bJ(d),u_normalize_matrix:new i.bJ(d),u_merc_matrix:new i.bJ(d),u_zoom_transition:new i.bM(d),u_merc_center:new i.bK(d),u_image0:new i.bN(d),u_grid_matrix:new i.cB(d),u_skirt_height:new i.bM(d),u_far_z_cutoff:new i.bM(d),u_frustum_tl:new i.bL(d),u_frustum_tr:new i.bL(d),u_frustum_br:new i.bL(d),u_frustum_bl:new i.bL(d),u_globe_pos:new i.bL(d),u_globe_radius:new i.bM(d),u_viewport:new i.bK(d)}),globeAtmosphere:d=>({u_frustum_tl:new i.bL(d),u_frustum_tr:new i.bL(d),u_frustum_br:new i.bL(d),u_frustum_bl:new i.bL(d),u_horizon:new i.bM(d),u_transition:new i.bM(d),u_fadeout_range:new i.bM(d),u_color:new i.cb(d),u_high_color:new i.cb(d),u_space_color:new i.cb(d),u_temporal_offset:new i.bM(d),u_horizon_angle:new i.bM(d)}),model:d=>({u_matrix:new i.bJ(d),u_lighting_matrix:new i.bJ(d),u_normal_matrix:new i.bJ(d),u_node_matrix:new i.bJ(d),u_lightpos:new i.bL(d),u_lightintensity:new i.bM(d),u_lightcolor:new i.bL(d),u_camera_pos:new i.bL(d),u_opacity:new i.bM(d),u_baseColorFactor:new i.cb(d),u_emissiveFactor:new i.cb(d),u_metallicFactor:new i.bM(d),u_roughnessFactor:new i.bM(d),u_baseTextureIsAlpha:new i.bN(d),u_alphaMask:new i.bN(d),u_alphaCutoff:new i.bM(d),u_baseColorTexture:new i.bN(d),u_metallicRoughnessTexture:new i.bN(d),u_normalTexture:new i.bN(d),u_occlusionTexture:new i.bN(d),u_emissionTexture:new i.bN(d),u_lutTexture:new i.bN(d),u_color_mix:new i.cb(d),u_aoIntensity:new i.bM(d),u_emissive_strength:new i.bM(d),u_occlusionTextureTransform:new i.cb(d)}),modelDepth:d=>({u_matrix:new i.bJ(d),u_instance:new i.bJ(d),u_node_matrix:new i.bJ(d)}),groundShadow:d=>({u_matrix:new i.bJ(d),u_ground_shadow_factor:new i.bL(d)}),stars:d=>({u_matrix:new i.bJ(d),u_up:new i.bL(d),u_right:new i.bL(d),u_intensity_multiplier:new i.bM(d)}),snowParticle:d=>({u_modelview:new i.bJ(d),u_projection:new i.bJ(d),u_time:new i.bM(d),u_cam_pos:new i.bL(d),u_velocityConeAperture:new i.bM(d),u_velocity:new i.bM(d),u_horizontalOscillationRadius:new i.bM(d),u_horizontalOscillationRate:new i.bM(d),u_boxSize:new i.bM(d),u_billboardSize:new i.bM(d),u_simpleShapeParameters:new i.bK(d),u_screenSize:new i.bK(d),u_thinningCenterPos:new i.bK(d),u_thinningShape:new i.bL(d),u_thinningAffectedRatio:new i.bM(d),u_thinningParticleOffset:new i.bM(d),u_particleColor:new i.cb(d),u_direction:new i.bL(d)}),rainParticle:d=>({u_modelview:new i.bJ(d),u_projection:new i.bJ(d),u_time:new i.bM(d),u_cam_pos:new i.bL(d),u_texScreen:new i.bN(d),u_velocityConeAperture:new i.bM(d),u_velocity:new i.bM(d),u_boxSize:new i.bM(d),u_rainDropletSize:new i.bK(d),u_distortionStrength:new i.bM(d),u_rainDirection:new i.bL(d),u_color:new i.cb(d),u_screenSize:new i.bK(d),u_thinningCenterPos:new i.bK(d),u_thinningShape:new i.bL(d),u_thinningAffectedRatio:new i.bM(d),u_thinningParticleOffset:new i.bM(d),u_shapeDirectionalPower:new i.bM(d),u_shapeNormalPower:new i.bM(d),u_mode:new i.bM(d)}),vignette:d=>({u_vignetteShape:new i.bL(d),u_vignetteColor:new i.cb(d)}),occlusion:d=>({u_matrix:new i.bJ(d),u_anchorPos:new i.bL(d),u_screenSizePx:new i.bK(d),u_occluderSizePx:new i.bK(d),u_color:new i.cb(d)})};class Eo{constructor(t,s,h,m){this.id=Eo.uniqueIdxCounter,Eo.uniqueIdxCounter++,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||m||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Eo.uniqueIdxCounter,Eo.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Eo.uniqueIdxCounter=0;const bf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class wf{constructor(t,s,h,m,g,x){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=m,this.instanceCount=x,this.context=t;const M=t.gl;this.buffer=M.createBuffer(),t.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||g||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let h=0;h<this.attributes.length;h++){const m=s.attributes[this.attributes[h].name];m!==void 0&&t.enableVertexAttribArray(m)}}setVertexAttribPointers(t,s,h){for(let m=0;m<this.attributes.length;m++){const g=this.attributes[m],x=s.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[bf[g.type]],!1,this.itemSize,g.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(t,s,h){for(let m=0;m<this.attributes.length;m++){const g=s.attributes[this.attributes[m].name];g!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(g,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class yh{constructor(t,s,h,m,g){this.context=t,this.width=s,this.height=h;const x=this.framebuffer=t.gl.createFramebuffer();m&&(this.colorAttachment=new uf(t,x)),g&&(this.depthAttachmentType=g,this.depthAttachment=g==="renderbuffer"?new uh(t,x):new Ym(t,x))}destroy(){const t=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&t.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&t.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&t.deleteTexture(s)}t.deleteFramebuffer(this.framebuffer)}}class as{constructor(t,s){this.gl=t,this.clearColor=new Yy(this),this.clearDepth=new Jy(this),this.clearStencil=new Jd(this),this.colorMask=new Qd(this),this.depthMask=new ef(this),this.stencilMask=new tf(this),this.stencilFunc=new Hm(this),this.stencilOp=new Wm(this),this.stencilTest=new Qy(this),this.depthRange=new Nc(this),this.depthTest=new Vc(this),this.depthFunc=new Zm(this),this.blend=new Ts(this),this.blendFunc=new rf(this),this.blendColor=new oh(this),this.blendEquation=new ah(this),this.cullFace=new nf(this),this.cullFaceSide=new sf(this),this.frontFace=new of(this),this.program=new lh(this),this.activeTexture=new af(this),this.viewport=new lf(this),this.bindFramebuffer=new ch(this),this.bindRenderbuffer=new Xm(this),this.bindTexture=new Km(this),this.bindVertexBuffer=new Cl(this),this.bindElementBuffer=new ev(this),this.bindVertexArrayOES=new tv(this),this.pixelStoreUnpack=new rv(this),this.pixelStoreUnpackPremultiplyAlpha=new nv(this),this.pixelStoreUnpackFlipY=new iv(this),this.options=s?Object.assign({},s):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=s&&!!s.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s,h){return new Eo(this,t,s,h)}createVertexBuffer(t,s,h,m,g){return new wf(this,t,s,h,m,g)}createRenderbuffer(t,s,h){const m=this.gl,g=m.createRenderbuffer();return this.bindRenderbuffer.set(g),m.renderbufferStorage(m.RENDERBUFFER,t,s,h),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,h,m){return new yh(this,t,s,h,m)}clear({color:t,depth:s,stencil:h,colorMask:m}){const g=this.gl;let x=0;t&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set(m||[!0,!0,!0,!0])),s!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),g.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){i.bn(t.blendFunction,Rr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ro;function Tf(d,t,s,h,m,g,x){const M=d.context,P=M.gl,z=d.transform,L=d.getOrCreateProgram("collisionBox"),F=[];let B=0,j=0;for(let ce=0;ce<h.length;ce++){const ge=h[ce],fe=t.getTile(ge),_e=fe.getBucket(s);if(!_e)continue;const pe=ai(ge,_e,z);let we=pe;m[0]===0&&m[1]===0||(we=d.translatePosMatrix(pe,fe,m,g));const Ee=x?_e.textCollisionBox:_e.iconCollisionBox,qe=_e.collisionCircleArray;if(qe.length>0){const Be=i.ad.mat4.create(),et=we;i.ad.mat4.mul(Be,_e.placementInvProjMatrix,z.glCoordMatrix),i.ad.mat4.mul(Be,Be,_e.placementViewportMatrix),F.push({circleArray:qe,circleOffset:j,transform:et,invTransform:Be,projection:_e.getProjection()}),B+=qe.length/4,j=B}Ee&&(d.terrain&&d.terrain.setupElevationDraw(fe,L),L.draw(d,P.LINES,Xt.disabled,br.disabled,d.colorModeForRenderPass(),dr.disabled,mf(we,z,fe,_e.getProjection()),s.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,null,z.zoom,null,[Ee.collisionVertexBuffer,Ee.collisionVertexBufferExt]))}if(!x||!F.length)return;const Z=d.getOrCreateProgram("collisionCircle"),H=new i.cW;H.resize(4*B),H._trim();let J=0;for(const ce of F)for(let ge=0;ge<ce.circleArray.length/4;ge++){const fe=4*ge,_e=ce.circleArray[fe+0],pe=ce.circleArray[fe+1],we=ce.circleArray[fe+2],Ee=ce.circleArray[fe+3];H.emplace(J++,_e,pe,we,Ee,0),H.emplace(J++,_e,pe,we,Ee,1),H.emplace(J++,_e,pe,we,Ee,2),H.emplace(J++,_e,pe,we,Ee,3)}(!ro||ro.length<2*B)&&(ro=function(ce){const ge=2*ce,fe=new i.aV;fe.resize(ge),fe._trim();for(let _e=0;_e<ge;_e++){const pe=6*_e;fe.uint16[pe+0]=4*_e+0,fe.uint16[pe+1]=4*_e+1,fe.uint16[pe+2]=4*_e+2,fe.uint16[pe+3]=4*_e+2,fe.uint16[pe+4]=4*_e+3,fe.uint16[pe+5]=4*_e+0}return fe}(B));const Q=M.createIndexBuffer(ro,!0),oe=M.createVertexBuffer(H,i.cX.members,!0);for(const ce of F){const ge={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(ue=z).getCameraToCenterDistance(ce.projection),u_viewport_size:[ue.width,ue.height]};Z.draw(d,P.TRIANGLES,Xt.disabled,br.disabled,d.colorModeForRenderPass(),dr.disabled,ge,s.id,oe,Q,i.b8.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,z.zoom)}var ue;oe.destroy(),Q.destroy()}const kl=i.ad.mat4.create();function vh(d){const t=d._camera.getWorldToCamera(d.worldSize,1),s=i.ad.mat4.multiply([],t,d.globeMatrix);i.ad.mat4.invert(s,s);const h=[0,0,0],m=[0,1,0,0];return i.ad.vec4.transformMat4(m,m,s),h[0]=m[0],h[1]=m[1],h[2]=m[2],i.ad.vec3.normalize(h,h),h}function Sf({width:d,height:t,anchor:s,textOffset:h,textScale:m},g){const{horizontalAlign:x,verticalAlign:M}=i.bD(s),P=-(x-.5)*d,z=-(M-.5)*t,L=i.bC(s,h);return new i.P((P/m+L[0])*g,(z/m+L[1])*g)}function c_(d,t,s,h,m,g,x,M,P,z,L){const F=d.text.placedSymbolArray,B=d.text.dynamicLayoutVertexArray,j=d.icon.dynamicLayoutVertexArray,Z={},H=d.getProjection(),J=Rc(M,H,g),Q=g.elevation,oe=H.upVectorScale(M.canonical,g.center.lat,g.worldSize).metersToTile;B.clear();for(let ue=0;ue<F.length;ue++){const ce=F.get(ue),{tileAnchorX:ge,tileAnchorY:fe,numGlyphs:_e}=ce,pe=ce.hidden||!ce.crossTileID||d.allowVerticalPlacement&&!ce.placedOrientation?null:h[ce.crossTileID];if(pe){let we=0,Ee=0,qe=0;if(Q){const Ze=Q?Q.getAtTileOffset(M,ge,fe):0,[st,$e,lt]=H.upVector(M.canonical,ge,fe);we=Ze*st*oe,Ee=Ze*$e*oe,qe=Ze*lt*oe}let[Be,et,rt,_t]=Tn(ce.projectedAnchorX+we,ce.projectedAnchorY+Ee,ce.projectedAnchorZ+qe,s?J:x);const Oe=Dm(g.getCameraToCenterDistance(H),_t);let Qe=m.evaluateSizeForFeature(d.textSizeData,z,ce)*Oe/i.bw;s&&(Qe*=d.tilePixelRatio/P);const De=Sf(pe,Qe);s?({x:Be,y:et,z:rt}=H.projectTilePoint(ge+De.x,fe+De.y,M.canonical),[Be,et,rt]=Tn(Be+we,et+Ee,rt+qe,x)):(t&&De._rotate(-g.angle),Be+=De.x,et+=De.y,rt=0);const Je=d.allowVerticalPlacement&&ce.placedOrientation===i.bq.vertical?Math.PI/2:0;for(let Ze=0;Ze<_e;Ze++)i.bt(B,Be,et,rt,Je);L&&ce.associatedIconIndex>=0&&(Z[ce.associatedIconIndex]={x:Be,y:et,z:rt,angle:Je})}else qa(_e,B)}if(L){j.clear();const ue=d.icon.placedSymbolArray;for(let ce=0;ce<ue.length;ce++){const ge=ue.get(ce),{numGlyphs:fe}=ge,_e=Z[ce];if(ge.hidden||!_e)qa(fe,j);else{const{x:pe,y:we,z:Ee,angle:qe}=_e;for(let Be=0;Be<fe;Be++)i.bt(j,pe,we,Ee,qe)}}d.icon.dynamicLayoutVertexBuffer.updateData(j)}d.text.dynamicLayoutVertexBuffer.updateData(B)}function ls(d,t,s,h,m,g,x={}){const M=s.paint.get("icon-translate"),P=s.paint.get("text-translate"),z=s.paint.get("icon-translate-anchor"),L=s.paint.get("text-translate-anchor"),F=s.layout.get("icon-rotation-alignment"),B=s.layout.get("text-rotation-alignment"),j=s.layout.get("icon-pitch-alignment"),Z=s.layout.get("text-pitch-alignment"),H=s.layout.get("icon-keep-upright"),J=s.layout.get("text-keep-upright"),Q=s.paint.get("icon-color-saturation"),oe=s.paint.get("icon-color-contrast"),ue=s.paint.get("icon-color-brightness-min"),ce=s.paint.get("icon-color-brightness-max"),ge=s.layout.get("symbol-elevation-reference")==="sea",fe=d.context,_e=fe.gl,pe=d.transform,we=F==="map",Ee=B==="map",qe=j==="map",Be=Z==="map",et=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let rt=!1;const _t=d.depthModeForSublayer(0,Xt.ReadOnly),Oe=[i.av(pe.center.lng),i.aC(pe.center.lat)],Qe=s.layout.get("text-variable-anchor"),De=pe.projection.name==="globe",Je=[],Ze=[0,-1,0];for(const st of h){const $e=t.getTile(st),lt=$e.getBucket(s);if(!lt||lt.projection.name==="mercator"&&De||lt.fullyClipped)continue;const wt=lt.projection.name==="globe",Mt=wt?i.ag(pe.zoom):0,Lt=Rc(st,lt.getProjection(),pe),Wt=pe.calculatePixelsToTileUnitsMatrix($e),fr=Qe&&lt.hasTextData(),nr=lt.hasIconTextFit()&&fr&&lt.hasIconData(),pr=lt.getProjection().createInversionMatrix(pe,st.canonical),ur=Kr=>{pe.depthOcclusionForSymbolsAndCircles&&(s.hasInitialOcclusionOpacityProperties||d.terrain)&&(Kr.push("DEPTH_D24"),Kr.push("DEPTH_OCCLUSION"))},Br=()=>{const Kr=we&&s.layout.get("symbol-placement")!=="point",Yr=[];ur(Yr);const $n=Kr||nr,di=s.paint.get("icon-image-cross-fade").constantOr(0);d.terrainRenderModeElevated()&&qe&&Yr.push("PITCH_WITH_MAP_TERRAIN"),wt&&(Yr.push("PROJECTION_GLOBE_VIEW"),$n&&Yr.push("PROJECTED_POS_ON_VIEWPORT")),di>0&&Yr.push("ICON_TRANSITION"),lt.icon.zOffsetVertexBuffer&&Yr.push("Z_OFFSET"),Q===0&&oe===0&&ue===0&&ce===1||Yr.push("COLOR_ADJUSTMENT"),lt.sdfIcons&&Yr.push("RENDER_SDF");const Qi=lt.icon.programConfigurations.get(s.id),fi=d.getOrCreateProgram("symbol",{config:Qi,defines:Yr}),Ti=$e.imageAtlasTexture?$e.imageAtlasTexture.size:[0,0],Ui=lt.iconSizeData,Jr=i.bp(Ui,pe.zoom),Sn=qe||pe.pitch!==0,sn=No(Lt,$e.tileID.canonical,qe,we,pe,lt.getProjection(),Wt),dn=Pi(Lt,$e.tileID.canonical,qe,we,pe,lt.getProjection(),Wt),mi=d.translatePosMatrix(dn,$e,M,z,!0),On=d.translatePosMatrix(Lt,$e,M,z),li=$n?kl:sn,Po=we&&!qe&&!Kr;let es=Ze;!De&&!pe.mercatorFromTransition||we||(es=vh(pe));const Gs=wt?es:Ze,Xo=s.getColorAdjustmentMatrix(Q,oe,ue,ce),zi=a_(Ui.kind,Jr,Po,qe,d,On,li,mi,ge,!1,Ti,[0,0],!0,st,Mt,Oe,pr,Gs,lt.getProjection(),Xo,di),Cs=$e.imageAtlasTexture?$e.imageAtlasTexture:null,Ro=s.layout.get("icon-size").constantOr(0)!==1||lt.iconsNeedLinear,so=lt.sdfIcons||d.options.rotating||d.options.zooming||Ro||Sn?_e.LINEAR:_e.NEAREST,Ko=lt.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,Qf=d.terrain&&qe&&Kr?i.ad.mat4.invert(i.ad.mat4.create(),sn):kl;if(Kr&&lt.icon){const tu=pe.elevation,jh=tu?tu.getAtTileOffsetFunc(st,pe.center.lat,pe.worldSize,lt.getProjection()):null,$h=Ga(Lt,$e.tileID.canonical,qe,we,pe,lt.getProjection(),Wt);$u(lt,Lt,d,!1,$h,dn,qe,H,jh,st)}return{program:fi,buffers:lt.icon,uniformValues:zi,atlasTexture:Cs,atlasTextureIcon:null,atlasInterpolation:so,atlasInterpolationIcon:null,isSDF:lt.sdfIcons,hasHalo:Ko,tile:$e,labelPlaneMatrixInv:Qf}},nn=()=>{const Kr=Ee&&s.layout.get("symbol-placement")!=="point",Yr=[],$n=Kr||Qe||nr;d.terrainRenderModeElevated()&&Be&&Yr.push("PITCH_WITH_MAP_TERRAIN"),wt&&(Yr.push("PROJECTION_GLOBE_VIEW"),$n&&Yr.push("PROJECTED_POS_ON_VIEWPORT")),lt.text.zOffsetVertexBuffer&&Yr.push("Z_OFFSET"),lt.iconsInText&&Yr.push("RENDER_TEXT_AND_SYMBOL"),Yr.push("RENDER_SDF"),ur(Yr);const di=lt.text.programConfigurations.get(s.id),Qi=d.getOrCreateProgram("symbol",{config:di,defines:Yr});let fi,Ti=[0,0],Ui=null;const Jr=lt.textSizeData;lt.iconsInText&&(Ti=$e.imageAtlasTexture?$e.imageAtlasTexture.size:[0,0],Ui=$e.imageAtlasTexture?$e.imageAtlasTexture:null,fi=Be||pe.pitch!==0||d.options.rotating||d.options.zooming||Jr.kind==="composite"||Jr.kind==="camera"?_e.LINEAR:_e.NEAREST);const Sn=$e.glyphAtlasTexture?$e.glyphAtlasTexture.size:[0,0],sn=s.layout.get("text-size-scale-range"),dn=i.ay(d.scaleFactor,sn[0],sn[1]),mi=i.bp(Jr,pe.zoom,dn),On=No(Lt,$e.tileID.canonical,Be,Ee,pe,lt.getProjection(),Wt),li=Pi(Lt,$e.tileID.canonical,Be,Ee,pe,lt.getProjection(),Wt),Po=d.translatePosMatrix(li,$e,P,L,!0),es=d.translatePosMatrix(Lt,$e,P,L),Gs=$n?kl:On,Xo=Ee&&!Be&&!Kr;let zi=Ze;!De&&!pe.mercatorFromTransition||Ee||(zi=vh(pe));const Cs=a_(Jr.kind,mi,Xo,Be,d,es,Gs,Po,ge,!0,Sn,Ti,!0,st,Mt,Oe,pr,wt?zi:Ze,lt.getProjection(),null,null,dn),Ro=$e.glyphAtlasTexture?$e.glyphAtlasTexture:null,so=_e.LINEAR,Ko=s.paint.get("text-halo-width").constantOr(1)!==0,Qf=d.terrain&&Be&&Kr?i.ad.mat4.invert(i.ad.mat4.create(),On):kl;if(Kr&&lt.text){const tu=pe.elevation,jh=tu?tu.getAtTileOffsetFunc(st,pe.center.lat,pe.worldSize,lt.getProjection()):null,$h=Ga(Lt,$e.tileID.canonical,Be,Ee,pe,lt.getProjection(),Wt);$u(lt,Lt,d,!0,$h,li,Be,J,jh,st)}return{program:Qi,buffers:lt.text,uniformValues:Cs,atlasTexture:Ro,atlasTextureIcon:Ui,atlasInterpolation:so,atlasInterpolationIcon:fi,isSDF:!0,hasHalo:Ko,tile:$e,labelPlaneMatrixInv:Qf}},hn=lt.icon.segments.get().length,Dr=lt.text.segments.get().length,Pn=hn&&!x.onlyText?Br():null,wr=Dr&&!x.onlyIcons?nn():null,_r=s.paint.get("icon-opacity").constantOr(1),sr=s.paint.get("text-opacity").constantOr(1);if(et&&lt.canOverlap){rt=!0;const Kr=_r&&!x.onlyText?lt.icon.segments.get():[],Yr=sr&&!x.onlyIcons?lt.text.segments.get():[];for(const $n of Kr)Je.push({segments:new i.b8([$n]),sortKey:$n.sortKey,state:Pn});for(const $n of Yr)Je.push({segments:new i.b8([$n]),sortKey:$n.sortKey,state:wr})}else x.onlyText||Je.push({segments:_r?lt.icon.segments:new i.b8([]),sortKey:0,state:Pn}),x.onlyIcons||Je.push({segments:sr?lt.text.segments:new i.b8([]),sortKey:0,state:wr})}rt&&Je.sort((st,$e)=>st.sortKey-$e.sortKey);for(const st of Je){const $e=st.state;if($e)if(d.terrain?d.terrain.setupElevationDraw($e.tile,$e.program,{useDepthForOcclusion:pe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:$e.labelPlaneMatrixInv}):d.setupDepthForOcclusion(pe.depthOcclusionForSymbolsAndCircles,$e.program),fe.activeTexture.set(_e.TEXTURE0),$e.atlasTexture&&$e.atlasTexture.bind($e.atlasInterpolation,_e.CLAMP_TO_EDGE,!0),$e.atlasTextureIcon&&(fe.activeTexture.set(_e.TEXTURE1),$e.atlasTextureIcon&&$e.atlasTextureIcon.bind($e.atlasInterpolationIcon,_e.CLAMP_TO_EDGE,!0)),d.uploadCommonLightUniforms(d.context,$e.program),$e.hasHalo){const lt=$e.uniformValues;lt.u_is_halo=1,gn($e.buffers,st.segments,s,d,$e.program,_t,m,g,lt,2),lt.u_is_halo=0}else{if($e.isSDF){const lt=$e.uniformValues;$e.hasHalo&&(lt.u_is_halo=1,gn($e.buffers,st.segments,s,d,$e.program,_t,m,g,lt,1)),lt.u_is_halo=0}gn($e.buffers,st.segments,s,d,$e.program,_t,m,g,$e.uniformValues,1)}}}function gn(d,t,s,h,m,g,x,M,P,z){const L=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.iconTransitioningVertexBuffer,d.globeExtVertexBuffer,d.zOffsetVertexBuffer];m.draw(h,h.context.gl.TRIANGLES,g,x,M,dr.disabled,P,s.id,d.layoutVertexBuffer,d.indexBuffer,t,s.paint,h.transform.zoom,d.programConfigurations.get(s.id),L,z)}function xh(d,t){const s=1<<d.canonical.z,h=(t.x*s-d.canonical.x-d.wrap*s)*i.ai,m=(t.y*s-d.canonical.y)*i.ai,g=i.d5(t.z,t.y);return i.ad.vec3.fromValues(h,m,g)}function bh(d,t,s,h,m){if(!s.layout||s.layout.get("fill-elevation-reference")==="none")return;const g=d.context.gl,x=new Xt(d.context.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D),M=new Xt(d.context.gl.GREATER,Xt.ReadWrite,d.depthRangeFor3D),P=function(j){const Z=i.c4(j.pitch);let H=.01;return j.isOrthographic&&(H=i.ah(1e-4,H,i.c9(Z>=$o?1:Z/$o))),2*H}(d.transform),z=d.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",F=d.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),B=d.getOrCreateProgram(L);for(const j of h){const Z=t.getTile(j),H=Z.getBucket(s);if(!H)continue;const J=H.elevatedStructures;if(!J)continue;const Q=H.elevationBufferData.heightRange,oe=xh(j.toUnwrapped(),z),ue=d.translatePosMatrix(j.projMatrix,Z,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));let ce,ge,fe,_e;if(m==="initialize"){if(!Q||Q.min>=1||J.depthSegments.segments[0].primitiveLength===0)continue;ce=Ll(ue,oe,P,1,0),ge=x,fe=J.depthSegments,_e=F}else if(m==="reset"){if(!Q||Q.min>=0||J.maskSegments.segments[0].primitiveLength===0)continue;ce=Ll(ue,oe,0,0,1),ge=M,fe=J.maskSegments,_e=F}else if(m==="geometry"){if(J.depthSegments.segments[0].primitiveLength===0)continue;ce=Ll(ue,oe,P,1,0),ge=x,fe=J.depthSegments,_e=B}_e.draw(d,g.TRIANGLES,ge,br.disabled,Rr.disabled,dr.disabled,ce,s.id,J.vertexBuffer,J.indexBuffer,fe,s.paint,d.transform.zoom)}}function wh(d,t,s){const{painter:h,sourceCache:m,layer:g,coords:x,colorMode:M,elevationType:P,terrainEnabled:z,pass:L}=d,F=h.context.gl,B=g.paint.get("fill-pattern");let j=P;P!=="road"||t&&!z||(j="none");const Z=j==="road",H=new Xt(h.context.gl.LEQUAL,Xt.ReadWrite,h.depthRangeFor3D),J=B&&B.constantOr(1),Q=(oe,ue)=>{let ce,ge,fe,_e,pe;ue?(ge=J&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ce=F.LINES):(ge=J?"fillPattern":"fill",ce=F.TRIANGLES);for(const we of x){const Ee=m.getTile(we);if(J&&!Ee.patternsLoaded())continue;const qe=Ee.getBucket(g);if(!qe)continue;const Be=t?qe.elevationBufferData:qe.bufferData;if(Be.isEmpty())continue;h.prepareDrawTile();const et=Be.programConfigurations.get(g.id),rt=h.isTileAffectedByFog(we),_t=[],Oe=[];Z&&(_t.push("ELEVATED_ROADS"),Oe.push(Be.elevatedLayoutVertexBuffer));const Qe=h.getOrCreateProgram(ge,{config:et,overrideFog:rt,defines:_t});J&&(h.context.activeTexture.set(F.TEXTURE0),Ee.imageAtlasTexture&&Ee.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),et.updatePaintBuffers());const De=B.constantOr(null);if(De&&Ee.imageAtlas){const st=Ee.imageAtlas,$e=i.d0.from(De).getPrimary().scaleSelf(i.q.devicePixelRatio).toString(),lt=st.patternPositions.get($e);lt&&et.setConstantPatternPositions(lt)}const Je=h.translatePosMatrix(we.projMatrix,Ee,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor")),Ze=g.paint.get("fill-emissive-strength");if(ue){_e=Be.lineIndexBuffer,pe=Be.lineSegments;const st=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[F.drawingBufferWidth,F.drawingBufferHeight];fe=ge==="fillOutlinePattern"&&J?mh(Je,Ze,h,Ee,st):i_(Je,Ze,st)}else _e=Be.indexBuffer,pe=Be.triangleSegments,fe=J?zl(Je,Ze,h,Ee):ph(Je,Ze);h.uploadCommonUniforms(h.context,Qe,we.toUnwrapped()),Qe.draw(h,ce,j!=="none"?H:oe,s||h.stencilModeForClipping(we),M,dr.disabled,fe,g.id,Be.layoutVertexBuffer,_e,pe,g.paint,h.transform.zoom,et,Oe)}};h.renderPass===L&&Q(h.depthModeForSublayer(1,h.renderPass==="opaque"?Xt.ReadWrite:Xt.ReadOnly),!1),j==="none"&&h.renderPass==="translucent"&&g.paint.get("fill-antialias")&&Q(h.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,Xt.ReadOnly),!0)}function qc(d,t,s,h,m,g,x,M){s.resetLayerRenderingStats(d);const P=d.context,z=P.gl,L=d.transform,F=s.paint.get("fill-extrusion-pattern"),B=F.constantOr(1),j=s.paint.get("fill-extrusion-opacity"),Z=d.style.enable3dLights(),H=s.paint.get(Z&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),J=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),H],Q=s.layout.get("fill-extrusion-edge-radius"),oe=Q>0&&!s.paint.get("fill-extrusion-rounded-roof"),ue=oe?0:Q,ce=L.projection.name==="globe"?i.d6():0,ge=L.projection.name==="globe",fe=ge?i.ag(L.zoom):0,_e=[i.av(L.center.lng),i.aC(L.center.lat)],pe=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",we=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(pe?null:s.lut).toArray01().slice(0,3),Ee=s.paint.get("fill-extrusion-flood-light-intensity"),qe=s.paint.get("fill-extrusion-vertical-scale"),Be=s.paint.get("fill-extrusion-line-width").constantOr(1)!==0,et=s.paint.get("fill-extrusion-height-alignment"),rt=s.paint.get("fill-extrusion-base-alignment"),_t=_a(d,s.paint.get("fill-extrusion-cutoff-fade-range")),Oe=[];let Qe;ge&&Oe.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&Oe.push("FAUX_AO"),oe&&Oe.push("ZERO_ROOF_RADIUS"),M&&Oe.push("HAS_CENTROID"),Ee>0&&Oe.push("FLOOD_LIGHT"),_t.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),Be&&Oe.push("RENDER_WALL_MODE");const De=d.renderPass==="shadow",Je=d.shadowRenderer,Ze=De&&!!Je;d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!0);let st=[0,0,0];if(Je){const wt=d.style.directionalLight,Mt=d.style.ambientLight;wt&&Mt&&(st=Go(d.style,wt,Mt)),De||(Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Je.useNormalOffset&&Oe.push("NORMAL_OFFSET")),Qe=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const $e=Ze?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",lt=s.getLayerRenderingStats();for(const wt of h){const Mt=t.getTile(wt),Lt=Mt.getBucket(s);if(!Lt||Lt.projection.name!==L.projection.name)continue;let Wt=!1;Je&&(Wt=Je.getMaxCascadeForTile(wt.toUnwrapped())===0);const fr=d.isTileAffectedByFog(wt),nr=Lt.programConfigurations.get(s.id),pr=d.getOrCreateProgram($e,{config:nr,defines:Wt?Qe:Oe,overrideFog:fr});if(d.terrain&&d.terrain.setupElevationDraw(Mt,pr,{useMeterToDem:!0}),!Lt.centroidVertexBuffer){const wr=pr.attributes.a_centroid_pos;wr!==void 0&&z.vertexAttrib2f(wr,0,0)}!De&&Je&&Je.setupShadows(Mt.tileID.toUnwrapped(),pr,"vector-tile",Mt.tileID.overscaledZ),B&&(d.context.activeTexture.set(z.TEXTURE0),Mt.imageAtlasTexture&&Mt.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),nr.updatePaintBuffers());const ur=F.constantOr(null);if(ur&&Mt.imageAtlas){const wr=Mt.imageAtlas,_r=i.d0.from(ur).getPrimary().scaleSelf(i.q.devicePixelRatio),sr=wr.patternPositions.get(_r.toString());sr&&nr.setConstantPatternPositions(sr)}const Br=s.paint.get("fill-extrusion-vertical-gradient"),nn=1/Lt.tileToMeter;let hn;if(De&&Je){if(kt(Mt.tileID,Lt,d))continue;const wr=Je.calculateShadowPassMatrixFromTile(Mt.tileID.toUnwrapped());hn=pf(wr,ue,nn,qe,et,rt)}else{const wr=d.translatePosMatrix(wt.expandedProjMatrix,Mt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),_r=L.projection.createInversionMatrix(L,wt.canonical);hn=B?Dl(wr,d,Br,j,J,ue,nn,wt,Mt,ce,et,rt,fe,_e,_r,we,qe):fh(wr,d,Br,j,J,ue,nn,wt,ce,et,rt,fe,_e,_r,we,qe,Ee,st)}d.uploadCommonUniforms(P,pr,wt.toUnwrapped(),null,_t);let Dr=Lt.segments;if(L.projection.name==="mercator"&&!De&&(Dr=Lt.getVisibleSegments(Mt.tileID,d.terrain,d.transform.getFrustum(0)),!Dr.get().length))continue;if(lt)if(De)for(const wr of Dr.get())lt.numRenderedVerticesInShadowPass+=wr.primitiveLength;else for(const wr of Dr.get())lt.numRenderedVerticesInTransparentPass+=wr.primitiveLength;const Pn=[];(d.terrain||M)&&Pn.push(Lt.centroidVertexBuffer),ge&&Pn.push(Lt.layoutVertexExtBuffer),Be&&Pn.push(Lt.wallVertexBuffer),pr.draw(d,P.gl.TRIANGLES,m,g,x,dr.backCCW,hn,s.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Dr,s.paint,d.transform.zoom,nr,Pn)}d.shadowRenderer&&(d.shadowRenderer.useNormalOffset=!1)}function Qa(d,t,s,h,m,g,x,M,P,z,L,F,B,j,Z,H,J,Q,oe){const ue=d.context,ce=ue.gl,ge=d.transform,fe=d.transform.zoom,_e=[],pe=_a(d,s.paint.get("fill-extrusion-cutoff-fade-range"));z==="clear"?(_e.push("CLEAR_SUBPASS"),oe&&(_e.push("CLEAR_FROM_TEXTURE"),ue.activeTexture.set(ce.TEXTURE0),oe.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):z==="sdf"&&_e.push("SDF_SUBPASS"),J&&_e.push("HAS_CENTROID"),pe.shouldRenderCutoff&&_e.push("RENDER_CUTOFF");const we=s.layout.get("fill-extrusion-edge-radius"),Ee=(qe,Be,et,rt,_t)=>{const Oe=Be.programConfigurations.get(s.id),Qe=d.isTileAffectedByFog(qe),De=d.getOrCreateProgram("fillExtrusionGroundEffect",{config:Oe,defines:_e,overrideFog:Qe}),Je=((st,$e,lt,wt,Mt,Lt,Wt,fr,nr,pr,ur)=>({u_matrix:$e,u_opacity:lt,u_ao_pass:wt?1:0,u_meter_to_tile:Mt,u_ao:Lt,u_flood_light_intensity:Wt,u_flood_light_color:fr,u_attenuation:nr,u_edge_radius:pr,u_fb:0,u_fb_size:ur,u_dynamic_offset:1}))(0,rt,L,P,_t,[F,B*_t],j,Z,H,fe>=17?0:we*_t,oe?oe.size[0]:0),Ze=[];J&&Ze.push(Be.hiddenByLandmarkVertexBuffer),d.uploadCommonUniforms(ue,De,qe.toUnwrapped(),null,pe),De.draw(d,ue.gl.TRIANGLES,m,g,x,M,Je,s.id,Be.vertexBuffer,Be.indexBuffer,et,s.paint,fe,Oe,Ze)};for(const qe of h){const Be=t.getTile(qe),et=Be.getBucket(s);if(!et||et.projection.name!==ge.projection.name||!et.groundEffect||et.groundEffect&&!et.groundEffect.hasData())continue;const rt=et.groundEffect,_t=1/et.tileToMeter;{const Oe=d.translatePosMatrix(qe.projMatrix,Be,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Qe=rt.getDefaultSegment();Ee(qe,rt,Qe,Oe,_t)}if(Q)for(let Oe=0;Oe<4;Oe++){const Qe=i.d7[Oe](qe),De=t.getTile(Qe);if(!De)continue;const Je=De.getBucket(s);if(!Je||Je.projection.name!==ge.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const Ze=Je.groundEffect;let st,$e;Oe===0?(st=[-i.ai,0,0],$e=1):Oe===1?(st=[i.ai,0,0],$e=0):Oe===2?(st=[0,-i.ai,0],$e=3):(st=[0,i.ai,0],$e=2);const lt=Ze.regionSegments[$e];if(!lt)continue;const wt=new Float32Array(16);i.ad.mat4.translate(wt,qe.projMatrix,st),Ee(qe,Ze,lt,d.translatePosMatrix(wt,Be,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),_t)}}}function cv(d,t,s,h,m,g,x){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const M=g?g.findDEMTileFor(s):null;if(!(M&&M.dem||x))return;g&&M&&M.dem&&h.selfDEMTileTimestamp!==M.dem._timestamp&&(h.borderDoneWithNeighborZ=[-1,-1,-1,-1],h.selfDEMTileTimestamp=M.dem._timestamp);const P=Q=>new i.P(Math.ceil((Q+i.da)*i.db),0),z=Q=>{const oe=t.getSource().minzoom,ue=ge=>{const fe=t.getTileByID(ge);if(fe&&fe.hasData())return fe.getBucket(m)},ce=[0,-1,1];for(const ge of ce){if(Q.overscaledZ+ge<oe)continue;const fe=ue(Q.calculateScaledKey(Q.overscaledZ+ge));if(fe)return fe}},L=[0,0,0],F=(Q,oe)=>(L[0]=Math.min(Q.min.y,oe.min.y),L[1]=Math.max(Q.max.y,oe.max.y),L[2]=i.ai-oe.min.x>Q.max.x?oe.min.x-i.ai:Q.max.x,L),B=(Q,oe)=>(L[0]=Math.min(Q.min.x,oe.min.x),L[1]=Math.max(Q.max.x,oe.max.x),L[2]=i.ai-oe.min.y>Q.max.y?oe.min.y-i.ai:Q.max.y,L),j=[(Q,oe)=>F(Q,oe),(Q,oe)=>F(oe,Q),(Q,oe)=>B(Q,oe),(Q,oe)=>B(oe,Q)],Z=(Q,oe,ue,ce,ge,fe,_e)=>{if(!g)return 0;const pe=[[fe?ue:Q,fe?Q:ue,0],[fe?ue:oe,fe?oe:ue,0]],we=_e<0?i.ai+_e:_e,Ee=[fe?we:(Q+oe)/2,fe?(Q+oe)/2:we,0];return ue===0&&_e<0||ue!==0&&_e>0?g.getForTilePoints(ge,[Ee],!0,ce):pe.push(Ee),g.getForTilePoints(s,pe,!0,M),Math.max(pe[0][2],pe[1][2],Ee[2])/g.exaggeration()};for(let Q=0;Q<4;Q++){const oe=h.borderFeatureIndices[Q];if(oe.length===0)continue;const ue=i.d7[Q](s),ce=z(ue);if(!(ce&&ce instanceof i.d8))continue;const ge=g?g.findDEMTileFor(ue):null;if(!(ge&&ge.dem||x)||(g&&ge&&ge.dem&&h.borderDEMTileTimestamp[Q]!==ge.dem._timestamp&&(h.borderDoneWithNeighborZ[Q]=-1,h.borderDEMTileTimestamp[Q]=ge.dem._timestamp),h.borderDoneWithNeighborZ[Q]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const fe=(Q<2?1:5)-Q,_e=ce.borderDoneWithNeighborZ[fe]!==h.canonical.z,pe=ce.borderFeatureIndices[fe];let we=0;if(h.canonical.z!==ce.canonical.z){for(const Ee of oe)h.showCentroid(h.featuresOnBorder[Ee]);if(_e)for(const Ee of pe)ce.showCentroid(ce.featuresOnBorder[Ee]);h.borderDoneWithNeighborZ[Q]=ce.canonical.z,ce.borderDoneWithNeighborZ[fe]=h.canonical.z}for(const Ee of oe){const qe=h.featuresOnBorder[Ee],Be=h.centroidData[qe.centroidDataIndex],et=qe.borders[Q];let rt;for(;we<pe.length;){rt=ce.featuresOnBorder[pe[we]];const _t=rt.borders[fe];if(_t[1]>et[0]+3||_t[0]>et[0]-3)break;ce.showCentroid(rt),we++}if(rt&&we<pe.length){const _t=we;let Oe=0;for(;!(rt.borders[fe][0]>et[1]-3)&&(Oe++,++we!==pe.length);)rt=ce.featuresOnBorder[pe[we]];rt=ce.featuresOnBorder[pe[_t]];let Qe=!1;if(Oe>=1){const Ze=rt.borders[fe];Math.abs(et[0]-Ze[0])<3&&Math.abs(et[1]-Ze[1])<3&&(Oe=1,Qe=!0,we=_t+1)}else if(Oe===0){h.showCentroid(qe);continue}const De=ce.centroidData[rt.centroidDataIndex];x&&Qe&&(((H=Be).flags|(J=De).flags)&i.d9?(H.flags|=i.d9,J.flags|=i.d9):(H.flags&=~i.d9,J.flags&=~i.d9));const Je=qe.intersectsCount()>1||rt.intersectsCount()>1;if(Oe>1)we=_t,Be.centroidXY=De.centroidXY=new i.P(0,0);else if(ge&&ge.dem&&!Je){const Ze=j[Q](Be,De),st=Q%2?i.ai-1:0,$e=Z(Ze[0],Math.min(i.ai-1,Ze[1]),st,ge,ue,Q<2,Ze[2]);Be.centroidXY=De.centroidXY=P($e)}else Je?Be.centroidXY=De.centroidXY=new i.P(0,0):(Be.centroidXY=h.encodeBorderCentroid(qe),De.centroidXY=ce.encodeBorderCentroid(rt));h.writeCentroidToBuffer(Be),ce.writeCentroidToBuffer(De)}else h.showCentroid(qe)}h.borderDoneWithNeighborZ[Q]=ce.canonical.z,ce.borderDoneWithNeighborZ[fe]=h.canonical.z}var H,J;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(d)}const Fl=[1,0,0],Bl=[0,1,0],bt=[0,0,1];function kt(d,t,s){const h=s.transform,m=s.shadowRenderer;if(!m)return!0;const g=d.toUnwrapped(),x=h.tileSize*m._cascades[s.currentShadowCascade].scale;let M=t.maxHeight;if(h.elevation){const H=h.elevation.getMinMaxForTile(d);H&&(M+=H.max)}const P=[...m.shadowDirection];P[2]=-P[2];const z=m.computeSimplifiedTileShadowVolume(g,M,x,P);if(!z)return!1;const L=[Fl,Bl,bt,P,[P[0],0,P[2]],[0,P[1],P[2]]],F=h.projection.name==="globe",B=h.scaleZoom(x),j=i.bR.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,B,!F),Z=m.getCurrentCascadeFrustum();return j.intersectsPrecise(z.vertices,z.planes,L)===0||Z.intersectsPrecise(z.vertices,z.planes,L)===0}function el(d){return[d[0]*i.dc,d[1]*i.dc,d[2]*i.dc,0]}function Nn(d,t,s,h,m,g,x,M,P){const z=h.getSource(),L=s.globeSharedBuffers;if(!L)return;let F,B,j;if(t&&(F=h.getTile(t)),z instanceof i.aK?(B=z.texture,j=i.cJ(0,0,s.transform)):F&&t&&(B=F.texture,j=i.cJ(t.canonical.z,t.canonical.x,s.transform)),!B||!j)return;d||(j=i.ad.mat4.scale(i.ad.mat4.create(),j,[1,-1,1]));const Z=s.context,H=Z.gl,J=m.paint.get("raster-resampling")==="nearest"?H.NEAREST:H.LINEAR,Q=s.colorModeForDrapableLayerRenderPass(g),oe=x.defines;oe.push("GLOBE_POLES");const ue=new Xt(H.LEQUAL,Xt.ReadWrite,s.depthRangeFor3D),ce=Float32Array.from(s.transform.expandedFarZProjMatrix),ge=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),Z.activeTexture.set(H.TEXTURE0),B.bind(J,H.CLAMP_TO_EDGE),Z.activeTexture.set(H.TEXTURE1),B.bind(J,H.CLAMP_TO_EDGE),"useMipmap"in B&&Z.extTextureFilterAnisotropic&&s.transform.pitch>20&&H.texParameterf(H.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const[fe,_e,pe,we]=t?L.getPoleBuffers(t.canonical.z,!1):L.getPoleBuffers(0,!0),Ee=m.paint.get("raster-elevation");let qe;d?(qe=fe,s.renderDefaultNorthPole=Ee!==0):(qe=_e,s.renderDefaultSouthPole=Ee!==0);const Be=el(x.mix),et=((_t,Oe,Qe,De,Je,Ze,st,$e,lt,wt,Mt,Lt,Wt)=>gf(_t,Oe,Qe,new Float32Array(16),new Float32Array(9),[0,0],De,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ze,[0,0],$e,2,wt,Mt,Lt,1,0,Wt))(ce,ge,j,i.ag(s.transform.zoom),0,m,0,Ee,0,Be,x.offset,x.range,g),rt=s.getOrCreateProgram("raster",{defines:oe});s.uploadCommonUniforms(Z,rt,null),rt.draw(s,H.TRIANGLES,ue,P,Q,M,et,m.id,qe,pe,we)}function Ue(d){const t=d._nearZ,s=d.projection.farthestPixelDistance(d),h=s-t,m=.2*d.height,g=t+m;return[t,s,(g-m-t)/h,(g-t)/h]}function u_(d,t,s,h){if(d)return t instanceof xs&&d instanceof ma?t.getTextureDescriptor(d,s,!0):{texture:d.texture,mix:el(h.mix),offset:h.offset,buffer:0,tileSize:1}}var Th=i.dd([{name:"a_index",type:"Int16",components:1}]);class Ef{constructor(t,s,h,m){const g={width:h[0],height:h[1],data:null},x=t.gl;this.targetColorTexture=new i.T(t,g,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new i.T(t,g,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(s,m),this.lastInvalidatedAt=0}updateParticleTexture(t,s){if(this.particleTextureDimension===s.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const h=this.context.gl,m=s.width*s.height;this.particleTexture0=new i.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new i.T(this.context,s,h.RGBA8,{premultiply:!1,useMipmap:!1});const g=new i.de;g.reserve(m);for(let x=0;x<m;x++)g.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(g,Th.members,!0),this.particleSegment=i.b8.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=s.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=i.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Af(d,t,s){if(!d)return null;const h=t.getTextureDescriptor(d,s,!0);if(!h)return null;let{texture:m,mix:g,offset:x,tileSize:M,buffer:P,format:z}=h;if(!m||!z)return null;let L=!1;return z==="uint32"&&(L=!0,g[3]=0,g=Gc(i.df,g,[0,s.paint.get("raster-particle-max-speed")]),x=Ft(i.df,x,[0,s.paint.get("raster-particle-max-speed")])),{texture:m,textureOffset:[P/(M+2*P),M/(M+2*P)],tileSize:M,scalarData:L,scale:g,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function h_(d){const t=d._nearZ,s=d.projection.farthestPixelDistance(d),h=s-t,m=.2*d.height,g=t+m;return[t,s,(g-m-t)/h,(g-t)/h]}const d_=new i.al(1,0,0,1),Nl=new i.al(0,1,0,1),uv=new i.al(0,0,1,1),hv=new i.al(1,0,1,1),f_=new i.al(0,1,1,1);function Wo(d,t,s,h,m,g,x){const M=d.context,P=d.transform,z=M.gl,L=P.projection.name==="globe",F=L?["PROJECTION_GLOBE_VIEW"]:[];let B=i.ad.mat4.clone(s.projMatrix);if(L&&i.ag(P.zoom)>0){const Be=i.bb(s.canonical,P),et=i.dg(Be);B=i.ad.mat4.multiply(new Float32Array(16),P.globeMatrix,et),i.ad.mat4.multiply(B,P.projMatrix,B)}const j=i.ad.mat4.create();j[12]+=2*m/(i.q.devicePixelRatio*P.width),j[13]+=2*g/(i.q.devicePixelRatio*P.height),i.ad.mat4.multiply(B,j,B);const Z=d.getOrCreateProgram("debug",{defines:F}),H=t.getTileByID(s.key);d.terrain&&d.terrain.setupElevationDraw(H,Z);const J=Xt.disabled,Q=br.disabled,oe=d.colorModeForRenderPass(),ue="$debug";M.activeTexture.set(z.TEXTURE0),d.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),L?H._makeGlobeTileDebugBuffers(d.context,P):H._makeDebugTileBoundsBuffers(d.context,P.projection);const ce=H._tileDebugBuffer||d.debugBuffer,ge=H._tileDebugIndexBuffer||d.debugIndexBuffer,fe=H._tileDebugSegments||d.debugSegments;if(Z.draw(d,z.LINE_STRIP,J,Q,oe,dr.disabled,_f(B,h),ue,ce,ge,fe,null,null,null,[H._globeTileDebugBorderBuffer]),x){const Be=H.latestRawTileData,et=Math.floor((Be&&Be.byteLength||0)/1024);let rt=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(rt+=` => ${s.overscaledZ}`),rt+=` ${H.state}`,rt+=` ${et}kb`,function(_t,Oe){_t.initDebugOverlayCanvas();const Qe=_t.debugOverlayCanvas,De=_t.context.gl,Je=_t.debugOverlayCanvas.getContext("2d");Je.clearRect(0,0,Qe.width,Qe.height),Je.shadowColor="white",Je.shadowBlur=2,Je.lineWidth=1.5,Je.strokeStyle="white",Je.textBaseline="top",Je.font="bold 36px Open Sans, sans-serif",Je.fillText(Oe,5,5),Je.strokeText(Oe,5,5),_t.debugOverlayTexture.update(Qe),_t.debugOverlayTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE)}(d,rt)}const _e=t.getTile(s).tileSize,pe=512/Math.min(_e,512)*(s.overscaledZ/P.zoom)*.5,we=H._tileDebugTextBuffer||d.debugBuffer,Ee=H._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,qe=H._tileDebugTextSegments||d.debugSegments;Z.draw(d,z.TRIANGLES,J,Q,Rr.alphaBlended,dr.disabled,_f(B,i.al.transparent,pe),ue,we,Ee,qe,null,null,null,[H._globeTileDebugTextBuffer])}function Sh(d,t,s,h){Hc(d,0,t+s/2,d.transform.width,s,h)}function Mf(d,t,s,h){Hc(d,t-s/2,0,s,d.transform.height,h)}function Hc(d,t,s,h,m,g){const x=d.context,M=x.gl;M.enable(M.SCISSOR_TEST),M.scissor(t*i.q.devicePixelRatio,s*i.q.devicePixelRatio,h*i.q.devicePixelRatio,m*i.q.devicePixelRatio),x.clear({color:g}),M.disable(M.SCISSOR_TEST)}const Eh=i.dd([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ah}=Eh;function Es(d,t,s,h){d.emplaceBack(t,s,h)}class If{constructor(t){this.vertexArray=new i.dh,this.indices=new i.aV,Es(this.vertexArray,-1,-1,1),Es(this.vertexArray,1,-1,1),Es(this.vertexArray,-1,1,1),Es(this.vertexArray,1,1,1),Es(this.vertexArray,-1,-1,-1),Es(this.vertexArray,1,-1,-1),Es(this.vertexArray,-1,1,-1),Es(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Ah),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=i.b8.simpleSegment(0,0,36,12)}}function Vl(d,t,s,h,m,g){const x=d.context.gl,M=t.paint.get("sky-atmosphere-color"),P=t.paint.get("sky-atmosphere-halo-color"),z=t.paint.get("sky-atmosphere-sun-intensity"),L=((F,B,j,Z,H)=>({u_matrix_3f:F,u_sun_direction:B,u_sun_intensity:j,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[H.r,H.g,H.b,H.a],u_luminance:5e-5}))(i.ad.mat3.fromMat4(i.ad.mat3.create(),h),m,z,M,P);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+g,t.skyboxTexture,0),s.draw(d,x.TRIANGLES,Xt.disabled,br.disabled,Rr.unblended,dr.frontCW,L,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Yi=i.dd([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class dv{constructor(t){const s=new i.di;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new i.aV;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(s,Yi.members),this.indexBuffer=t.createIndexBuffer(h),this.segments=i.b8.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Wc=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class bn{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Zr{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Rr([1,Sl,1,Sl],i.al.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Rr([1,0,1,0],i.al.transparent,[!1,!1,!1,!0]),this.params=new bn,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const s=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new dv(s);const h=this.params.sizeRange,m=this.params.intensityRange,g=function(L){const F=i.dl(30),B=[];for(let j=0;j<L;++j){const Z=2*Math.PI*F(),H=Math.acos(1-2*F())-.5*Math.PI;B.push(i.ad.vec3.fromValues(Math.cos(H)*Math.cos(Z),Math.cos(H)*Math.sin(Z),Math.sin(H)))}return B}(this.params.starsCount),x=i.dl(300),M=new i.dj,P=new i.aV;let z=0;for(let L=0;L<g.length;++L){const F=i.ad.vec3.scale([],g[L],200),B=Math.max(0,1+.01*h*(1*x()-.5)),j=Math.max(0,1+.01*m*(1*x()-.5));M.emplaceBack(F[0],F[1],F[2],-1,-1,B,j),M.emplaceBack(F[0],F[1],F[2],1,-1,B,j),M.emplaceBack(F[0],F[1],F[2],1,1,B,j),M.emplaceBack(F[0],F[1],F[2],-1,1,B,j),P.emplaceBack(z+0,z+1,z+2),P.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=s.createVertexBuffer(M,Wc.members),this.starsIdx=s.createIndexBuffer(P),this.starsSegments=i.b8.simpleSegment(0,0,M.length,P.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,s){const h=t.context,m=h.gl,g=t.transform,x=new Xt(m.LEQUAL,Xt.ReadOnly,[0,1]),M=i.ag(g.zoom),P=t.style.getLut(s.scope),z=s.properties.get("color-use-theme")==="none",L=s.properties.get("color").toRenderColor(z?null:P).toArray01(),F=s.properties.get("high-color-use-theme")==="none",B=s.properties.get("high-color").toRenderColor(F?null:P).toArray01(),j=s.properties.get("space-color-use-theme")==="none",Z=s.properties.get("space-color").toRenderColor(j?null:P).toArray01PremultipliedAlpha(),H=5e-4,J=i.dk(s.properties.get("horizon-blend"),0,1,H,.25),Q=i.cD(t,h,g)&&J===H?g.worldSize/(2*Math.PI*1.025)-1:g.globeRadius,oe=t.frameCounter/1e3%1,ue=i.ad.vec3.length(g.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(ue,2)-Math.pow(Q,2)),ge=Math.acos(ce/ue),fe=_e=>{const pe=g.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];_e&&pe.push("ALPHA_PASS");const we=t.getOrCreateProgram("globeAtmosphere",{defines:pe}),Ee=((Be,et,rt,_t,Oe,Qe,De,Je,Ze,st,$e,lt)=>({u_frustum_tl:Be,u_frustum_tr:et,u_frustum_br:rt,u_frustum_bl:_t,u_horizon:Oe,u_transition:Qe,u_fadeout_range:De,u_color:Je,u_high_color:Ze,u_space_color:st,u_temporal_offset:$e,u_horizon_angle:lt}))(g.frustumCorners.TL,g.frustumCorners.TR,g.frustumCorners.BR,g.frustumCorners.BL,g.frustumCorners.horizon,M,J,L,B,Z,oe,ge);t.uploadCommonUniforms(h,we);const qe=this.atmosphereBuffer;qe&&we.draw(t,m.TRIANGLES,x,br.disabled,_e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,dr.backCW,Ee,_e?"atmosphere_glow_alpha":"atmosphere_glow",qe.vertexBuffer,qe.indexBuffer,qe.segments)};fe(!1),fe(!0)}drawStars(t,s){const h=i.ay(s.properties.get("star-intensity"),0,1);if(h===0)return;const m=t.context,g=m.gl,x=t.transform,M=t.getOrCreateProgram("stars"),P=i.ad.quat.identity([]);i.ad.quat.rotateX(P,P,-x._pitch),i.ad.quat.rotateZ(P,P,-x.angle),i.ad.quat.rotateX(P,P,i.ak(x._center.lat)),i.ad.quat.rotateY(P,P,-i.ak(x._center.lng));const z=i.ad.mat4.fromQuat(new Float32Array(16),P),L=i.ad.mat4.multiply([],x.starsProjMatrix,z),F=i.ad.mat3.fromMat4([],z),B=i.ad.mat3.invert([],F),j=[0,1,0];i.ad.vec3.transformMat3(j,j,B),i.ad.vec3.scale(j,j,this.params.sizeMultiplier);const Z=[1,0,0];i.ad.vec3.transformMat3(Z,Z,B),i.ad.vec3.scale(Z,Z,this.params.sizeMultiplier);const H=(J=j,Q=Z,oe=h,{u_matrix:Float32Array.from(L),u_up:J,u_right:Q,u_intensity_multiplier:oe});var J,Q,oe;t.uploadCommonUniforms(m,M),this.starsVx&&this.starsIdx&&M.draw(t,g.TRIANGLES,Xt.disabled,br.disabled,this.colorModeAlphaBlendedWriteRGB,dr.disabled,H,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Cf(d,t){const s=[...d],h=t.cameraWorldSizeForFog/t.worldSize,m=i.ad.mat4.identity([]);return i.ad.mat4.scale(m,m,[h,h,1]),i.ad.mat4.multiply(s,m,s),i.ad.mat4.multiply(s,t.worldToFogMatrix,s),s}function Ao(d,t,s,h,m){const g=s.material,x=h.context,{baseColorTexture:M,metallicRoughnessTexture:P}=g.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:L,emissionTexture:F}=g;function B(Z,H,J){if(Z&&(d.push(H),x.activeTexture.set(x.gl.TEXTURE0+J),Z.gfxTexture)){const{minFilter:Q,magFilter:oe,wrapS:ue,wrapT:ce}=Z.sampler;Z.gfxTexture.bindExtraParam(Q,oe,ue,ce)}}B(M,"HAS_TEXTURE_u_baseColorTexture",Ri.BaseColor),B(P,"HAS_TEXTURE_u_metallicRoughnessTexture",Ri.MetallicRoughness),B(z,"HAS_TEXTURE_u_normalTexture",Ri.Normal),B(L,"HAS_TEXTURE_u_occlusionTexture",Ri.Occlusion),B(F,"HAS_TEXTURE_u_emissionTexture",Ri.Emission),m&&(m.texture||(m.texture=new i.dn(h.context,m.image,[m.image.height,m.image.height,m.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+Ri.LUT),m.texture&&m.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),d.push("APPLY_LUT_ON_GPU")),s.texcoordBuffer&&(d.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(s.texcoordBuffer)),s.colorBuffer&&(d.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(s.colorBuffer)),s.normalBuffer&&(d.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(s.normalBuffer)),s.pbrBuffer&&(d.push("HAS_ATTRIBUTE_a_pbr"),d.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(s.pbrBuffer)),g.alphaMode!=="OPAQUE"&&g.alphaMode!=="MASK"||d.push("UNPREMULT_TEXTURE_IN_SHADER"),g.defined||d.push("DIFFUSE_SHADED");const j=h.shadowRenderer;j&&(d.push("RENDER_SHADOWS","DEPTH_TEXTURE"),j.useNormalOffset&&d.push("NORMAL_OFFSET"))}function tl(d,t,s,h,m,g){const x=s.paint.get("model-opacity").constantOr(1),M=t.context,P=new Xt(t.context.gl.LEQUAL,Xt.ReadWrite,t.depthRangeFor3D),z=t.transform,L=d.mesh,F=L.material,B=F.pbrMetallicRoughness,j=t.style.fog;let Z;Z=t.transform.projection.zAxisUnit==="pixels"?[...d.nodeModelMatrix]:i.ad.mat4.multiply([],h.zScaleMatrix,d.nodeModelMatrix),i.ad.mat4.multiply(Z,h.negCameraPosMatrix,Z);const H=i.ad.mat4.invert([],Z);i.ad.mat4.transpose(H,H);const J=s.paint.get("model-color-use-theme").constantOr("default")==="none",Q=s.paint.get("model-emissive-strength").constantOr(0),oe=gh(new Float32Array(d.worldViewProjection),new Float32Array(Z),new Float32Array(H),null,t,x,B.baseColorFactor.toRenderColor(null),F.emissiveFactor,B.metallicFactor,B.roughnessFactor,F,Q,s),ue={defines:[]},ce=[],ge=t.shadowRenderer;ge&&(ge.useNormalOffset=!1),Ao(ue.defines,ce,L,t,J?null:s.lut);let fe=null;if(j){const we=Cf(d.nodeModelMatrix,t.transform);if(fe=new Float32Array(we),z.projection.name!=="globe"){const Ee=L.aabb.min,qe=L.aabb.max,[Be,et]=j.getOpacityForBounds(we,Ee[0],Ee[1],qe[0],qe[1]);ue.overrideFog=Be>=mt||et>=mt}}const _e=_a(t,s.paint.get("model-cutoff-fade-range"));_e.shouldRenderCutoff&&ue.defines.push("RENDER_CUTOFF");const pe=t.getOrCreateProgram("model",ue);t.uploadCommonUniforms(M,pe,null,fe,_e),t.renderPass!=="shadow"&&ge&&ge.setupShadowsFromMatrix(d.nodeModelMatrix,pe),pe.draw(t,M.gl.TRIANGLES,P,m,g,L.material.doubleSided?dr.disabled:dr.backCCW,oe,s.id,L.vertexBuffer,L.indexBuffer,L.segments,s.paint,t.transform.zoom,void 0,ce)}function rl(d,t,s,h,m,g,x){let M;M=d.projection.name==="globe"?i.dp(s,d):[...s],i.ad.mat4.multiply(M,M,t.matrix);const P=i.ad.mat4.multiply([],h,M);if(t.meshes)for(const z of t.meshes){if(z.material.alphaMode!=="BLEND"){x.push({mesh:z,depth:0,modelIndex:m,worldViewProjection:P,nodeModelMatrix:M});continue}const L=i.ad.vec3.transformMat4([],z.centroid,P);!d.isOrthographic&&L[2]<=0||g.push({mesh:z,depth:L[2],modelIndex:m,worldViewProjection:P,nodeModelMatrix:M})}if(t.children)for(const z of t.children)rl(d,z,s,h,m,g,x)}function wa(d,t,s,h){const m=s.shadowRenderer;if(!m)return;const g=m.getShadowPassDepthMode(),x=m.getShadowPassColorMode(),M=m.calculateShadowPassMatrixFromMatrix(t),P=l_(M);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,g,br.disabled,x,dr.backCCW,P,h.id,d.vertexBuffer,d.indexBuffer,d.segments,h.paint,s.transform.zoom,void 0,void 0)}function Pf(d,t,s){const h=t.updateZoomBasedPaintProperties(),m=function(g,x,M){let P,z,L,F=g.terrain?g.terrain.exaggeration():0;if(g.terrain&&F>0){const B=g.terrain,j=B.findDEMTileFor(M);j&&j.dem?P=i.dr.create(B,M,j):F=0}if(F===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),F===x.validForExaggeration&&(F===0||P&&P._demTile&&P._demTile.tileID===x.validForDEMTile.id&&P._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const B in x.instancesPerModel){const j=x.instancesPerModel[B];for(let Z=0;Z<j.instancedDataArray.length;++Z){const H=(P?F*P.getElevationAt(0|j.instancedDataArray.float32[16*Z],0|j.instancedDataArray.float32[16*Z+1],!0,!0):0)+j.instancesEvaluatedElevation[Z];j.instancedDataArray.float32[16*Z+6]=H,z=z?Math.min(x.terrainElevationMin,H):H,L=L?Math.max(x.terrainElevationMax,H):H}}return x.terrainElevationMin=z||0,x.terrainElevationMax=L||0,x.validForExaggeration=F,x.validForDEMTile=P&&P._demTile?{id:P._demTile.tileID,timestamp:P._dem._timestamp}:{id:void 0,timestamp:0},!0}(d,t,s);(h||m)&&(t.uploaded=!1,t.upload(d.context))}const js={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new i.ce([0,0,0],[i.ai,i.ai,0])};function Rf(d,t){const s=1<<d.canonical.z,h=t.getFreeCameraOptions().position,m=t.elevation,g=d.canonical.x/s,x=(d.canonical.x+1)/s,M=d.canonical.y/s,P=(d.canonical.y+1)/s;let z=t._centerAltitude;if(m){const j=m.getMinMaxForTile(d);j&&j.max>z&&(z=j.max)}const L=i.ay(h.x,g,x)-h.x,F=i.ay(h.y,M,P)-h.y,B=i.bH(z,t.center.lat)-h.z;return t._zoomFromMercatorZ(Math.sqrt(L*L+F*F+B*B))}function Mh(d,t,s,h,m,g,x){const M=d.context,P=d.renderPass==="shadow",z=d.shadowRenderer,L=P&&z?z.getShadowPassDepthMode():new Xt(M.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D),F=d.isTileAffectedByFog(g);if(s.meshes)for(const B of s.meshes){const j=["MODEL_POSITION_ON_GPU"],Z=[];let H,J,Q;h.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");const oe=_a(d,t.paint.get("model-cutoff-fade-range"));if(oe.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),P&&z)H=d.getOrCreateProgram("modelDepth",{defines:j}),J=l_(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(s.matrix)),Q=z.getShadowPassColorMode();else{Ao(j,Z,B,d,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),H=d.getOrCreateProgram("model",{defines:j,overrideFog:F});const ce=B.material,ge=ce.pbrMetallicRoughness,fe=t.paint.get("model-opacity").constantOr(1),_e=t.paint.get("model-emissive-strength").constantOr(0);J=gh(g.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),null,d,fe,ge.baseColorFactor.toRenderColor(null),ce.emissiveFactor,ge.metallicFactor,ge.roughnessFactor,ce,_e,t,m),z&&(x.shadowUniformsInitialized?H.setShadowUniformValues(M,z.getShadowUniformValues()):(z.setupShadows(g.toUnwrapped(),H,"model-tile",g.overscaledZ),x.shadowUniformsInitialized=!0)),Q=oe.shouldRenderCutoff||fe<1||ce.alphaMode!=="OPAQUE"?Rr.alphaBlended:Rr.unblended}d.uploadCommonUniforms(M,H,g.toUnwrapped(),null,oe);const ue=B.material.doubleSided?dr.disabled:dr.backCCW;if(h.instancedDataArray.length>20)Z.push(h.instancedDataBuffer),H.draw(d,M.gl.TRIANGLES,L,br.disabled,Q,ue,J,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,d.transform.zoom,void 0,Z,h.instancedDataArray.length);else{const ce=P?"u_instance":"u_normal_matrix";for(let ge=0;ge<h.instancedDataArray.length;++ge)J[ce]=new Float32Array(h.instancedDataArray.arrayBuffer,64*ge,16),H.draw(d,M.gl.TRIANGLES,L,br.disabled,Q,ue,J,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,d.transform.zoom,void 0,Z)}}if(s.children)for(const B of s.children)Mh(d,t,B,h,m,g,x)}const Mo=[1,-1,1];function Ta(d,t,s,h){if(!s.modelManager)return!0;const m=s.modelManager;if(!s.shadowRenderer)return!0;const g=s.shadowRenderer,x=t.aabb;let M=!0,P=d.maxHeight;if(P===0){let L=0;for(const F in d.instancesPerModel){const B=m.getModel(F,h);B?L=Math.max(L,Math.max(Math.max(B.aabb.max[0],B.aabb.max[1]),B.aabb.max[2])):M=!1}P=d.maxScale*L*1.41+d.maxVerticalOffset,M&&(d.maxHeight=P)}x.max[2]=P,x.min[2]+=d.terrainElevationMin,x.max[2]+=d.terrainElevationMax,i.ad.vec3.transformMat4(x.min,x.min,t.tileMatrix),i.ad.vec3.transformMat4(x.max,x.max,t.tileMatrix);const z=x.intersects(g.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(d.isInsideFirstShadowMapFrustum=z===2),z===0}function Ih(d,t){const s=d.uniformValues.u_cutoff_params[0],h=d.uniformValues.u_cutoff_params[1],m=d.uniformValues.u_cutoff_params[2],g=d.uniformValues.u_cutoff_params[3];return h===s||g===m?1:i.ay(((t-s)/(h-s)-m)/(g-m),0,1)}function Ch(d,t,s,h){if(t.pitch<20)return 1;const m=t.getWorldToCameraMatrix();i.ad.mat4.multiply(m,m,d);const g=i.ad.vec4.fromValues(s.min[0],s.min[1],s.min[2],1);let x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),M=x,P=x;g[1]=s.max[1],x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),M=x[1]<M[1]?x:M,P=x[1]>P[1]?x:P,g[0]=s.max[0],x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),M=x[1]<M[1]?x:M,P=x[1]>P[1]?x:P,g[1]=s.min[1],x=i.ad.vec4.transformMat4(i.ad.vec4.create(),g,m),M=x[1]<M[1]?x:M,P=x[1]>P[1]?x:P;const z=i.ay(h[0],0,1),L=100*t.pixelsPerMeter*i.ay(h[1],0,1),F=i.ay(h[2],0,1),B=i.ad.vec4.lerp(i.ad.vec4.create(),M,P,z),j=Math.tan(.5*t.fovX),Z=-B[2]*j;if(L===0)return B[1]<-Math.abs(Z)?F:1;const H=(-Math.abs(Z)-B[1])/L,J=(oe,ue,ce)=>(1-ce)*oe+ce*ue,Q=i.ay(J(1,F,H),F,1);return J(1,Q,i.ay((t.pitch-20)/20,0,1))}class Df{}class zf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,s,h){{const F=this._storage.get(s.id);if(F)return F.lastUsedFrameIdx=t,F.buf}const m=h.gl,g=m.getBufferParameter(m.ELEMENT_ARRAY_BUFFER,m.BUFFER_SIZE),x=new ArrayBuffer(g),M=new Int16Array(x);m.getBufferSubData(m.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const P=new i.dt;for(let F=0;F<g/2;F+=3){const B=M[F],j=M[F+1],Z=M[F+2];P.emplaceBack(B,j),P.emplaceBack(j,Z),P.emplaceBack(Z,B)}const z=h.bindVertexArrayOES.current,L=new Df;return L.buf=new Eo(h,P),L.lastUsedFrameIdx=t,this._storage.set(s.id,L),h.bindVertexArrayOES.set(z),L.buf}update(t){for(const[s,h]of this._storage)t-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(s))}destroy(){for(const[t,s]of this._storage)s.buf.destroy(),this._storage.delete(t)}}class nl{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Lf=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Sa{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ph{constructor(t,s){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...s,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...s,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Rh=i.dd([{type:"Float32",name:"a_pos_2f",components:2}]);class Of{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,s){const h=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const x=new i.du,M=new i.aV;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),M.emplaceBack(0,1,2),M.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(x,Rh.members),this.vignetteIdx=t.context.createIndexBuffer(M)}const m=i.b8.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,h);const x={u_vignetteShape:(g={vignetteShape:[s.start,s.range,Math.pow(10,s.fadePower)],vignetteColor:[s.color.r,s.color.g,s.color.b,s.color.a*s.strength]}).vignetteShape,u_vignetteColor:g.vignetteColor};h.draw(t,t.context.gl.TRIANGLES,Xt.disabled,br.disabled,Rr.alphaBlended,dr.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,m)}var g}}class kf{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,s){const h=t.getFreeCameraOptions().position,m=h.toAltitude(),g=h.toLngLat(),x=i.ak(g.lng),M=i.ak(g.lat),P=t.pixelsPerMeter/s,z=x*i.dv,L=i.dv*Math.log(Math.tan(Math.PI/4+M/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const F=-this._offsetYPrev+L,B=-this._elevationPrev+m;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*P,this._accumulatedOffsetY+=F*P,this._accumulatedElevation+=B*P,this._offsetXPrev=z,this._offsetYPrev=L,this._elevationPrev=m}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function wi(d,t){return[-(d[0]-Math.floor(d[0]/t)*t),-(d[1]-Math.floor(d[1]/t)*t),-(d[2]-Math.floor(d[2]/t)*t)]}function Dh(d){const t=i.dl(1323123451230),s=[];for(let h=0;h<d;++h){const m=2*t()-1,g=2*t()-1,x=2*t()-1;s.push(i.ad.vec3.fromValues(m,g,x))}return s}function Io(d,t,s,h,m){const g=i.ay((m-s)/(h-s),0,1);return(1-g)*d+g*t}class Ea{constructor(t){this._movement=new kf,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Of,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,s){const h=t.transform;this._movement.update(h,this._ppmScaleFactor);const m=h.starsProjMatrix,g=i.ad.quat.identity([]);i.ad.quat.rotateX(g,g,i.ak(90)-h._pitch),i.ad.quat.rotateZ(g,g,-h.angle);const x=i.ad.mat4.fromQuat(new Float32Array(16),g),M=i.ad.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),P=i.ad.mat4.transpose([],M),z=i.ad.mat4.multiply([],P,x),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*s,this._prevTime=L,{projectionMatrix:m,modelviewMatrix:z}}}class Ff extends Ea{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ph(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=Dh(this.particlesCount),m=new i.dw,g=new i.aV;let x=0;const M=i.dl(1323123451230);for(let P=0;P<h.length;++P){const z=h[P],L=[2*M()-1,M(),M(),M()];m.emplaceBack(z[0],z[1],z[2],-1,-1,...L),m.emplaceBack(z[0],z[1],z[2],1,-1,...L),m.emplaceBack(z[0],z[1],z[2],1,1,...L),m.emplaceBack(z[0],z[1],z[2],-1,1,...L),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=s.createVertexBuffer(m,Lf.members),this.particlesIdx=s.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const s=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},h=t.transform.zoom;if(s.revealStart>h)return;const m=Io(0,1,s.revealStart,s.revealStart+s.revealRange,h);if(!this.particlesVx||!this.particlesIdx)return;const g=structuredClone(this._params);let x=[-g.direction.x,g.direction.y,-100];i.ad.vec3.normalize(x,x);const M=structuredClone(this._vignetteParams);M.strength*=m,g.overrideStyleParameters||(g.intensity=t.style.rain.state.density,g.timeFactor=t.style.rain.state.intensity,g.color=structuredClone(t.style.rain.state.color),x=structuredClone(t.style.rain.state.direction),g.screenThinning.intensity=t.style.rain.state.centerThinning,g.dropletSizeX=t.style.rain.state.dropletSize[0],g.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],g.distortionStrength=100*t.style.rain.state.distortionStrength,M.strength=1,M.color=structuredClone(t.style.rain.state.vignetteColor));const P=this.updateOnRender(t,g.timeFactor),z=t.context,L=z.gl,F=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new i.T(z,{width:t.width,height:t.height,data:null},L.RGBA8)),g.distortionStrength>0&&(z.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const B=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(z,B),z.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const j=[g.color.r,g.color.g,g.color.b,g.color.a],Z=(H,J)=>{const Q=wi(this._movement.getPosition(),H),oe=g.dropletSizeX,ue=g.dropletSizeX*g.dropletSizeYScale,ce=t.width/2,ge=t.height/2,fe=Io(0,g.screenThinning.start,0,1,g.screenThinning.intensity),_e=Io(.001,g.screenThinning.range,0,1,g.screenThinning.intensity),pe=Io(0,g.screenThinning.particleOffset,0,1,g.screenThinning.intensity),we=(Ee={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Q,velocityConeAperture:g.velocityConeAperture,velocity:g.velocity,boxSize:H,rainDropletSize:[oe,ue],distortionStrength:g.distortionStrength,rainDirection:x,color:j,screenSize:[F.width,F.height],thinningCenterPos:[ce,ge],thinningShape:[fe,_e,Math.pow(10,g.screenThinning.fadePower)],thinningAffectedRatio:g.screenThinning.affectedRatio,thinningParticleOffset:pe,shapeDirectionalPower:g.shapeDirPower,shapeNormalPower:g.shapeNormalPower,mode:J?0:1},{u_modelview:Float32Array.from(Ee.modelview),u_projection:Float32Array.from(Ee.projection),u_time:Ee.time,u_cam_pos:Ee.camPos,u_texScreen:0,u_velocityConeAperture:Ee.velocityConeAperture,u_velocity:Ee.velocity,u_boxSize:Ee.boxSize,u_rainDropletSize:Ee.rainDropletSize,u_distortionStrength:Ee.distortionStrength,u_rainDirection:Ee.rainDirection,u_color:Ee.color,u_screenSize:Ee.screenSize,u_thinningCenterPos:Ee.thinningCenterPos,u_thinningShape:Ee.thinningShape,u_thinningAffectedRatio:Ee.thinningAffectedRatio,u_thinningParticleOffset:Ee.thinningParticleOffset,u_shapeDirectionalPower:Ee.shapeDirectionalPower,u_shapeNormalPower:Ee.shapeNormalPower,u_mode:Ee.mode});var Ee;const qe=Math.round(g.intensity*this.particlesCount),Be=i.b8.simpleSegment(0,0,4*qe,2*qe);B.draw(t,L.TRIANGLES,Xt.disabled,br.disabled,Rr.alphaBlended,dr.disabled,we,"rain_particles",this.particlesVx,this.particlesIdx,Be)};g.distortionStrength>0&&Z(g.boxSize,!0),Z(g.boxSize,!1),this._vignette.draw(t,M)}}const Bf=i.dd([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Nf extends Ea{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ph(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const s=t.context;if(!this.particlesVx){const h=Dh(this.particlesCount),m=new i.dx,g=new i.aV;let x=0;const M=i.dl(1323123451230);for(let P=0;P<h.length;++P){const z=h[P],L=M(),F=M(),B=M(),j=[P/h.length,L,F,B],Z=[M(),M()];m.emplaceBack(z[0],z[1],z[2],-1,-1,...j,...Z),m.emplaceBack(z[0],z[1],z[2],1,-1,...j,...Z),m.emplaceBack(z[0],z[1],z[2],1,1,...j,...Z),m.emplaceBack(z[0],z[1],z[2],-1,1,...j,...Z),g.emplaceBack(x+0,x+1,x+2),g.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=s.createVertexBuffer(m,Bf.members),this.particlesIdx=s.createIndexBuffer(g)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const s=structuredClone(this._params);let h=[-s.direction.x,s.direction.y,-100];i.ad.vec3.normalize(h,h);const m=structuredClone(this._vignetteParams),g=s.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=t.transform.zoom;if(g.revealStart>x)return;const M=Io(0,1,g.revealStart,g.revealStart+g.revealRange,x);m.strength*=M,s.overrideStyleParameters||(s.intensity=t.style.snow.state.density,s.timeFactor=t.style.snow.state.intensity,s.color=structuredClone(t.style.snow.state.color),h=structuredClone(t.style.snow.state.direction),s.screenThinning.intensity=t.style.snow.state.centerThinning,s.billboardSize=2.79*t.style.snow.state.flakeSize,m.strength=1,m.color=structuredClone(t.style.snow.state.vignetteColor));const P=this.updateOnRender(t,s.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=t.context,L=z.gl,F=t.transform,B=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(z,B),((j,Z,H)=>{const J=wi(this._movement.getPosition(),j),Q=F.width/2,oe=F.height/2,ue=Io(0,H.screenThinning.start,0,1,H.screenThinning.intensity),ce=Io(.001,H.screenThinning.range,0,1,H.screenThinning.intensity),ge=Io(0,H.screenThinning.particleOffset,0,1,H.screenThinning.intensity),fe=(_e={modelview:P.modelviewMatrix,projection:P.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:J,velocityConeAperture:H.velocityConeAperture,velocity:H.velocity,horizontalOscillationRadius:H.horizontalOscillationRadius,horizontalOscillationRate:H.horizontalOscillationRate,boxSize:j,billboardSize:1*H.billboardSize,simpleShapeParameters:[H.shapeFadeStart,H.shapeFadePower],screenSize:[F.width,F.height],thinningCenterPos:[Q,oe],thinningShape:[ue,ce,Math.pow(10,H.screenThinning.fadePower)],thinningAffectedRatio:H.screenThinning.affectedRatio,thinningParticleOffset:ge,color:[H.color.r,H.color.g,H.color.b,H.color.a],direction:h},{u_modelview:Float32Array.from(_e.modelview),u_projection:Float32Array.from(_e.projection),u_time:_e.time,u_cam_pos:_e.camPos,u_velocityConeAperture:_e.velocityConeAperture,u_velocity:_e.velocity,u_horizontalOscillationRadius:_e.horizontalOscillationRadius,u_horizontalOscillationRate:_e.horizontalOscillationRate,u_boxSize:_e.boxSize,u_billboardSize:_e.billboardSize,u_simpleShapeParameters:_e.simpleShapeParameters,u_screenSize:_e.screenSize,u_thinningCenterPos:_e.thinningCenterPos,u_thinningShape:_e.thinningShape,u_thinningAffectedRatio:_e.thinningAffectedRatio,u_thinningParticleOffset:_e.thinningParticleOffset,u_particleColor:_e.color,u_direction:_e.direction});var _e;const pe=Math.round(H.intensity*this.particlesCount),we=i.b8.simpleSegment(0,0,4*pe,2*pe);this.particlesVx&&this.particlesIdx&&B.draw(t,L.TRIANGLES,Xt.disabled,br.disabled,Rr.alphaBlended,dr.disabled,fe,"snow_particles",this.particlesVx,this.particlesIdx,we)})(s.boxSize,0,s),this._vignette.draw(t,m)}}const Aa={symbol:function(d,t,s,h,m){if(d.renderPass!=="translucent")return;const g=br.disabled,x=d.colorModeForRenderPass(),M=s.layout.get("text-variable-anchor"),P=s.layout.get("text-size-scale-range"),z=i.ay(d.scaleFactor,P[0],P[1]);M&&function(B,j,Z,H,J,Q,oe,ue){const ce=j.transform,ge=J==="map",fe=Q==="map";for(const _e of B){const pe=H.getTile(_e),we=pe.getBucket(Z);if(!we||!we.text||!we.text.segments.get().length)continue;const Ee=i.bp(we.textSizeData,ce.zoom,ue),qe=Rc(_e,we.getProjection(),ce),Be=ce.calculatePixelsToTileUnitsMatrix(pe),et=No(qe,pe.tileID.canonical,fe,ge,ce,we.getProjection(),Be),rt=we.hasIconTextFit()&&we.hasIconData();if(Ee){const _t=Math.pow(2,ce.zoom-pe.tileID.overscaledZ);c_(we,ge,fe,oe,i.cY,ce,et,_e,_t,Ee,rt)}}}(h,d,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),m,z);const L=s.paint.get("icon-opacity").constantOr(1)!==0,F=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||F)?ls(d,t,s,h,g,x):(L&&ls(d,t,s,h,g,x,{onlyIcons:!0}),F&&ls(d,t,s,h,g,x,{onlyText:!0})),t.map.showCollisionBoxes&&(Tf(d,t,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Tf(d,t,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(d,t,s,h){if(d.renderPass!=="translucent")return;const m=s.paint.get("circle-opacity"),g=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),M=s.layout.get("circle-sort-key").constantOr(1)!==void 0,P=s.paint.get("circle-emissive-strength");if(m.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const z=d.context,L=z.gl,F=d.transform,B=d.depthModeForSublayer(0,Xt.ReadOnly),j=br.disabled,Z=d.colorModeForDrapableLayerRenderPass(P),H=F.projection.name==="globe",J=[i.av(F.center.lng),i.aC(F.center.lat)],Q=[];for(let ue=0;ue<h.length;ue++){const ce=h[ue],ge=t.getTile(ce),fe=ge.getBucket(s);if(!fe||fe.projection.name!==F.projection.name)continue;const _e=fe.programConfigurations.get(s.id),pe=i.cZ(s),we=d.isTileAffectedByFog(ce);H&&pe.push("PROJECTION_GLOBE_VIEW"),pe.push("DEPTH_D24"),d.terrain&&F.depthOcclusionForSymbolsAndCircles&&pe.push("DEPTH_OCCLUSION");const Ee=d.getOrCreateProgram("circle",{config:_e,defines:pe,overrideFog:we}),qe=fe.layoutVertexBuffer,Be=fe.globeExtVertexBuffer,et=fe.indexBuffer,rt=F.projection.createInversionMatrix(F,ce.canonical),_t={programConfiguration:_e,program:Ee,layoutVertexBuffer:qe,globeExtVertexBuffer:Be,indexBuffer:et,uniformValues:i.c_(d,ce,ge,rt,J,s),tile:ge};if(M){const Oe=fe.segments.get();for(const Qe of Oe)Q.push({segments:new i.b8([Qe]),sortKey:Qe.sortKey,state:_t})}else Q.push({segments:fe.segments,sortKey:0,state:_t})}M&&Q.sort((ue,ce)=>ue.sortKey-ce.sortKey);const oe={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(const ue of Q){const{programConfiguration:ce,program:ge,layoutVertexBuffer:fe,globeExtVertexBuffer:_e,indexBuffer:pe,uniformValues:we,tile:Ee}=ue.state,qe=ue.segments;d.terrain&&d.terrain.setupElevationDraw(Ee,ge,oe),d.uploadCommonUniforms(z,ge,Ee.tileID.toUnwrapped()),ge.draw(d,L.TRIANGLES,B,j,Z,dr.disabled,we,s.id,fe,pe,qe,s.paint,F.zoom,ce,[_e])}},heatmap:function(d,t,s,h){if(s.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const m=d.context,g=m.gl,x=br.disabled,M=new Rr([g.ONE,g.ONE,g.ONE,g.ONE],i.al.transparent,[!0,!0,!0,!0]);(function(j,Z,H,J){const Q=j.gl,oe=Z.width*J,ue=Z.height*J;j.activeTexture.set(Q.TEXTURE1),j.viewport.set([0,0,oe,ue]);let ce=H.heatmapFbo;if(!ce||ce&&(ce.width!==oe||ce.height!==ue)){ce&&ce.destroy();const ge=Q.createTexture();Q.bindTexture(Q.TEXTURE_2D,ge),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_S,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_WRAP_T,Q.CLAMP_TO_EDGE),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MIN_FILTER,Q.LINEAR),Q.texParameteri(Q.TEXTURE_2D,Q.TEXTURE_MAG_FILTER,Q.LINEAR),ce=H.heatmapFbo=j.createFramebuffer(oe,ue,!0,null),function(fe,_e,pe,we,Ee,qe){const Be=fe.gl;Be.texImage2D(Be.TEXTURE_2D,0,fe.extRenderToTextureHalfFloat?Be.RGBA16F:Be.RGBA,Ee,qe,0,Be.RGBA,fe.extRenderToTextureHalfFloat?Be.HALF_FLOAT:Be.UNSIGNED_BYTE,null),we.colorAttachment.set(pe)}(j,0,ge,ce,oe,ue)}else Q.bindTexture(Q.TEXTURE_2D,ce.colorAttachment.get()),j.bindFramebuffer.set(ce.framebuffer)})(m,d,s,d.transform.projection.name==="globe"?.5:.25),m.clear({color:i.al.transparent});const P=d.transform,z=P.projection.name==="globe",L=z?["PROJECTION_GLOBE_VIEW"]:[],F=z?dr.frontCCW:dr.disabled,B=[i.av(P.center.lng),i.aC(P.center.lat)];for(let j=0;j<h.length;j++){const Z=h[j];if(t.hasRenderableParent(Z))continue;const H=t.getTile(Z),J=H.getBucket(s);if(!J||J.projection.name!==P.projection.name)continue;const Q=d.isTileAffectedByFog(Z),oe=J.programConfigurations.get(s.id),ue=d.getOrCreateProgram("heatmap",{config:oe,defines:L,overrideFog:Q}),{zoom:ce}=d.transform;d.terrain&&d.terrain.setupElevationDraw(H,ue),d.uploadCommonUniforms(m,ue,Z.toUnwrapped());const ge=P.projection.createInversionMatrix(P,Z.canonical);ue.draw(d,g.TRIANGLES,Xt.disabled,x,M,F,Ol(d,Z,H,ge,B,ce,s.paint.get("heatmap-intensity")),s.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,s.paint,d.transform.zoom,oe,z?[J.globeExtVertexBuffer]:null)}m.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(m,g){const x=m.context,M=x.gl,P=g.heatmapFbo;if(!P)return;x.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get()),x.activeTexture.set(M.TEXTURE1);let z=g.colorRampTexture;z||(z=g.colorRampTexture=new i.T(x,g.colorRamp,M.RGBA8)),z.bind(M.LINEAR,M.CLAMP_TO_EDGE),m.getOrCreateProgram("heatmapTexture").draw(m,M.TRIANGLES,Xt.disabled,br.disabled,m.colorModeForRenderPass(),dr.disabled,((L,F,B,j)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,g),g.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,g.paint,m.transform.zoom)}(d,s))},line:function(d,t,s,h){if(d.renderPass!=="translucent")return;const m=s.paint.get("line-opacity"),g=s.paint.get("line-width");if(m.constantOr(1)===0||g.constantOr(1)===0)return;const x=s.paint.get("line-emissive-strength"),M=s.paint.get("line-occlusion-opacity"),P=s.layout.get("line-elevation-reference"),z=s.layout.get("line-width-unit")==="meters",L=P==="sea",F=d.context,B=F.gl;if(s.hasElevatedBuckets&&d.transform.projection.name==="globe")return;const j=s.layout.get("line-cross-slope"),Z=j!==void 0,H=j<1,J=d.colorModeForDrapableLayerRenderPass(x),Q=d.terrain&&d.terrain.renderingToTexture,oe=Q?1:i.q.devicePixelRatio,ue=s.paint.get("line-dasharray"),ce=ue.constantOr(1),ge=s.layout.get("line-cap"),fe=ue.constantOr(null),_e=ge.constantOr(null),pe=s.paint.get("line-pattern"),we=pe.constantOr(1),Ee=pe.constantOr(null),qe=s.paint.get("line-opacity").constantOr(1);let Be=!we&&qe!==1||d.depthOcclusion&&M>0&&M<1;const et=s.paint.get("line-gradient"),rt=we?"linePattern":"line",_t=i.c$(s);let Oe;if(Q&&d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(Be=!1),M!==0&&d.depthOcclusion){const De=s.paint._values["line-opacity"];De&&De.value&&De.value.kind==="constant"?Oe=De.value:i.w(`Occlusion opacity for layer ${s.id} is supported only when line-opacity isn't data-driven.`)}g.value.kind!=="constant"&&g.value.isLineProgressConstant===!1&&_t.push("VARIABLE_LINE_WIDTH");const Qe=(De,Je,Ze,st,$e,lt)=>{for(const wt of De){const Mt=t.getTile(wt);if(we&&!Mt.patternsLoaded())continue;const Lt=Mt.getBucket(s);if(!Lt||Lt.hasZOffset&&!$e||!Lt.hasZOffset&&$e)continue;d.prepareDrawTile();const Wt=Lt.programConfigurations.get(s.id),fr=d.isTileAffectedByFog(wt),nr=d.getOrCreateProgram(rt,{config:Wt,defines:Je,overrideFog:fr,overrideRtt:!$e&&void 0});if(Ee&&Mt.imageAtlas){const wr=i.d0.from(Ee).getPrimary().scaleSelf(oe).toString(),_r=Mt.imageAtlas.patternPositions.get(wr);_r&&Wt.setConstantPatternPositions(_r)}if(!we&&fe&&_e&&Mt.lineAtlas){const wr=Mt.lineAtlas.getDash(fe,_e);wr&&Wt.setConstantPatternPositions(wr)}let[pr,ur]=s.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&pr!==ur&&(pr===0&&(pr-=1),ur===1&&(ur+=1));const Br=Q?wt.projMatrix:null,nn=z?1/Lt.tileToMeter/i.at(Mt,1,d.transform.zoom):1,hn=z?1/Lt.tileToMeter/i.at(Mt,1,Math.floor(d.transform.zoom)):1,Dr=we?i.d1(d,Mt,s,Br,oe,nn,hn,[pr,ur]):i.d2(d,Mt,s,Br,Lt.lineClipsArray.length,oe,nn,hn,[pr,ur]);if(et){const wr=Lt.gradients[s.id];let _r=wr.texture;if(s.gradientVersion!==wr.version){let sr=256;if(s.stepInterpolant){const Kr=t.getSource().maxzoom,Yr=wt.canonical.z===Kr?Math.ceil(1<<d.transform.maxZoom-wt.canonical.z):1;sr=i.ay(i.d3(Lt.maxLineLength/i.ai*1024*Yr),256,F.maxTextureSize)}wr.gradient=i.d4({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:sr,image:wr.gradient||void 0,clips:Lt.lineClipsArray}),wr.texture?wr.texture.update(wr.gradient):wr.texture=new i.T(F,wr.gradient,B.RGBA8),wr.version=s.gradientVersion,_r=wr.texture}F.activeTexture.set(B.TEXTURE1),_r.bind(s.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}ce&&(F.activeTexture.set(B.TEXTURE0),Mt.lineAtlasTexture&&Mt.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),Wt.updatePaintBuffers()),we&&(F.activeTexture.set(B.TEXTURE0),Mt.imageAtlasTexture&&Mt.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Wt.updatePaintBuffers()),$e&&!L&&d.terrain.setupElevationDraw(Mt,nr),d.uploadCommonUniforms(F,nr,wt.toUnwrapped());const Pn=wr=>{Oe!=null&&(Oe.value=qe*M),nr.draw(d,B.TRIANGLES,Ze,wr,J,dr.disabled,Dr,s.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,s.paint,d.transform.zoom,Wt,[Lt.layoutVertexBuffer2,Lt.patternVertexBuffer,Lt.zOffsetVertexBuffer]),Oe!=null&&(Oe.value=qe)};if(Be&&!$e){const wr=d.stencilModeForClipping(wt).ref;wr===0&&Q&&F.clear({stencil:0});const _r={func:B.EQUAL,mask:255};Dr.u_alpha_discard_threshold=.8,Pn(new br(_r,wr,255,B.KEEP,B.KEEP,B.INVERT)),Dr.u_alpha_discard_threshold=0,Pn(new br(_r,wr,255,B.KEEP,B.KEEP,B.KEEP))}else Dr.u_alpha_discard_threshold=Be&&$e&&lt?.8:0,Pn($e?st:d.stencilModeForClipping(wt))}};if(s.hasNonElevatedBuckets){const De=!Q&&d.terrain;M!==0&&De?i.w(`Occlusion opacity for layer ${s.id} is supported on terrain only if the layer has line-z-offset enabled.`):De?i.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${s.id}.`):Qe(h,_t,d.depthModeForSublayer(0,Xt.ReadOnly),br.disabled,!1,!0)}if(s.hasElevatedBuckets){_t.push("ELEVATED"),Z&&_t.push(H?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&_t.push("ELEVATION_REFERENCE_SEA");const De=Be?d.stencilModeFor3D():br.disabled,Je=new Xt(d.depthOcclusion?B.GREATER:B.LEQUAL,Xt.ReadOnly,d.depthRangeFor3D);d.forceTerrainMode=!0,Qe(h,_t,Je,De,!0,!0),Be&&Qe(h,_t,Je,De,!0,!1),d.forceTerrainMode=!1}Be&&(d.resetStencilClippingMasks(),Q&&F.clear({stencil:0})),M===0||d.depthOcclusion||Q||d.layersWithOcclusionOpacity.push(d.currentLayer)},fill:function(d,t,s,h){const m=s.paint.get("fill-color"),g=s.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const x=s.paint.get("fill-emissive-strength"),M=d.colorModeForDrapableLayerRenderPass(x),P=s.paint.get("fill-pattern"),z=d.opaquePassEnabledForLayer()&&!P.constantOr(1)&&m.constantOr(i.al.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";let L="none";s.layout.get("fill-elevation-reference")!=="none"?L="road":s.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const F=!(!d.terrain||!d.terrain.enabled),B={painter:d,sourceCache:t,layer:s,coords:h,colorMode:M,elevationType:L,terrainEnabled:F,pass:z};if(L!=="offset"){if(wh(B,!1),L==="road"){const j=!F&&d.renderPass==="translucent";j&&bh(d,t,s,h,"geometry"),wh(B,!0,br.disabled),j&&function(Z){const{painter:H,sourceCache:J,layer:Q,coords:oe,colorMode:ue}=Z,ce=H.context.gl,ge=new Xt(H.context.gl.LEQUAL,Xt.ReadOnly,H.depthRangeFor3D);for(const fe of oe){const _e=J.getTile(fe),pe=_e.getBucket(Q);if(!pe)continue;const we=pe.elevatedStructures;if(!we||!we.renderableSegments||we.renderableSegments.segments[0].primitiveLength===0)continue;H.prepareDrawTile();const Ee=pe.bufferData.programConfigurations.get(Q.id),qe=H.isTileAffectedByFog(fe),Be=H.getOrCreateProgram("elevatedStructures",{config:Ee,overrideFog:qe,defines:["NORMAL_OFFSET"]}),et={u_matrix:H.translatePosMatrix(fe.projMatrix,_e,Q.paint.get("fill-translate"),Q.paint.get("fill-translate-anchor"))};H.uploadCommonUniforms(H.context,Be,fe.toUnwrapped()),Be.draw(H,ce.TRIANGLES,ge,br.disabled,ue,dr.backCCW,et,Q.id,we.vertexBuffer,we.indexBuffer,we.renderableSegments,Q.paint,H.transform.zoom,Ee,[we.vertexBufferNormal])}}(B)}}else wh(B,!1,d.stencilModeFor3D())},"fill-extrusion":function(d,t,s,h){const m=s.paint.get("fill-extrusion-opacity"),g=d.context,x=g.gl,M=d.terrain,P=M&&M.renderingToTexture;if(m===0)return;const z=d.conflationActive&&d.style.isLayerClipped(s,t.getSource()),L=d.style.order.indexOf(s.fqid);if(z&&function(F,B,j,Z,H){for(const J of Z){const Q=B.getTile(J).getBucket(j);Q&&(Q.updateReplacement(J,F.replacementSource,H),Q.uploadCentroid(F.context))}}(d,t,s,h,L),M||z)for(const F of h){const B=t.getTile(F).getBucket(s);B&&cv(d.context,t,F,B,s,M,z)}if(d.renderPass==="shadow"&&d.shadowRenderer){const F=d.shadowRenderer;if(M&&m<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof i.ab)return;const B=F.getShadowPassDepthMode(),j=F.getShadowPassColorMode();qc(d,t,s,h,B,br.disabled,j,z)}else if(d.renderPass==="translucent"){const F=!s.paint.get("fill-extrusion-pattern").constantOr(1),B=s.paint.get("fill-extrusion-color").constantOr(i.al.white);if(!P&&B.a!==0){const j=new Xt(d.context.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D);m===1&&F?qc(d,t,s,h,j,br.disabled,Rr.unblended,z):(qc(d,t,s,h,j,br.disabled,Rr.disabled,z),qc(d,t,s,h,j,d.stencilModeFor3D(),d.colorModeForRenderPass(),z),d.resetStencilClippingMasks())}if(d.style.enable3dLights()&&F&&(!M&&d.transform.projection.name!=="globe"||P)){const j=s.paint.get("fill-extrusion-opacity"),Z=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),J=s.paint.get("fill-extrusion-flood-light-intensity"),Q=s.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",oe=s.paint.get("fill-extrusion-flood-light-color").toRenderColor(Q?null:s.lut).toArray01().slice(0,3),ue=Z>0&&H>0,ce=J>0,ge=(_e,pe,we)=>(1-we)*_e+we*pe,fe=_e=>{const pe=d.depthModeForSublayer(1,Xt.ReadOnly,x.LEQUAL,!0),we=s.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ee=ge(.1,3,we),qe=d._showOverdrawInspector;if(!qe){const Be=new br({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),et=new Rr([x.ONE,x.ONE,x.ONE,x.ONE],i.al.transparent,[!1,!1,!1,!0],x.MIN);Qa(d,t,s,h,pe,Be,et,dr.disabled,_e,"sdf",j,Z,H,J,oe,Ee,z,!1)}{const Be=qe?br.disabled:new br({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),et=qe?d.colorModeForRenderPass():new Rr([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],i.al.transparent,[!0,!0,!0,!0]);Qa(d,t,s,h,pe,Be,et,dr.disabled,_e,"color",j,Z,H,J,oe,Ee,z,!1)}};if(P){const _e=(pe,we,Ee)=>{const qe=d.depthModeForSublayer(1,Xt.ReadOnly,x.LEQUAL,!1),Be=s.paint.get(pe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),et=ge(.1,3,Be);{const rt=new Rr([x.ONE,x.ONE,x.ONE,x.ONE],i.al.transparent,[!1,!1,!1,!0]);Qa(d,t,s,h,qe,br.disabled,rt,dr.disabled,pe,"clear",j,Z,H,J,oe,et,z,we)}{const rt=new br({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),_t=new Rr([x.ONE,x.ONE,x.ONE,x.ONE],i.al.transparent,[!1,!1,!1,!0],x.MIN);Qa(d,t,s,h,qe,rt,_t,dr.disabled,pe,"sdf",j,Z,H,J,oe,et,z,we)}{const rt=pe?x.ZERO:x.ONE_MINUS_DST_ALPHA,_t=new br({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Oe=new Rr([rt,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],i.al.transparent,[!0,!0,!0,!0]);Qa(d,t,s,h,qe,_t,Oe,dr.disabled,pe,"color",j,Z,H,J,oe,et,z,we)}{const rt=new Rr([x.ONE,x.ONE,x.ONE,pe?x.ZERO:x.ONE],i.al.transparent,[!1,!1,!1,!0],pe?x.FUNC_ADD:x.MAX);Qa(d,t,s,h,qe,br.disabled,rt,dr.disabled,pe,"clear",j,Z,H,J,oe,et,z,we,Ee)}};if(ue||ce){let pe;if(d.prepareDrawTile(),M){const we=M.drapeBufferSize[0],Ee=M.drapeBufferSize[1];pe=M.framebufferCopyTexture,pe&&(!pe||pe.size[0]===we&&pe.size[1]===Ee)||(pe&&pe.destroy(),pe=M.framebufferCopyTexture=new i.T(g,new i.r({width:we,height:Ee}),x.RGBA8)),pe.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,we,Ee)}ue&&_e(!0,!1,pe),ce&&_e(!1,!0,pe)}}else ue&&fe(!0),ce&&fe(!1),(ue||ce)&&d.resetStencilClippingMasks()}}},hillshade:function(d,t,s,h){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent"||d.style.disableElevatedTerrain)return;const m=d.context,g=d.terrain&&d.terrain.renderingToTexture,[x,M]=d.renderPass!=="translucent"||g?[{},h]:d.stencilConfigForOverlap(h);for(const P of M){const z=t.getTile(P);if(z.needsHillshadePrepare&&d.renderPass==="offscreen")qm(d,z,s);else if(d.renderPass==="translucent"){const L=d.depthModeForSublayer(0,Xt.ReadOnly),F=s.paint.get("hillshade-emissive-strength"),B=d.colorModeForDrapableLayerRenderPass(F),j=g&&d.terrain?d.terrain.stencilModeForRTTOverlap(P):x[P.overscaledZ];Gm(d,P,z,s,L,j,B)}}m.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,t,s,h,m,g){if(d.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const x=d.transform.projection.name==="globe",M=s.paint.get("raster-elevation")!==0,P=M&&x;if(d.renderElevatedRasterBackface&&!P)return;const z=d.context,L=z.gl,F=t.getSource(),B=function(fe,_e,pe,we){const Ee=_e.paint.get("raster-color"),qe=fe.type==="raster-array",Be=[],et=_e.paint.get("raster-resampling"),rt=_e.paint.get("raster-color-mix");let _t=_e.paint.get("raster-color-range");const Oe=[rt[0],rt[1],rt[2],0],Qe=rt[3];let De=et==="nearest"?we.NEAREST:we.LINEAR;if(qe&&(Be.push("RASTER_ARRAY"),Ee||Be.push("RASTER_COLOR"),et==="linear"&&Be.push("RASTER_ARRAY_LINEAR"),De=we.NEAREST,!_t&&fe.rasterLayers)){const Je=fe.rasterLayers.find(({id:Ze})=>Ze===_e.sourceLayer);Je&&Je.fields&&Je.fields.range&&(_t=Je.fields.range)}if(_t=_t||[0,1],Ee){Be.push("RASTER_COLOR"),pe.activeTexture.set(we.TEXTURE2),_e.updateColorRamp(_t);let Je=_e.colorRampTexture;Je||(Je=_e.colorRampTexture=new i.T(pe,_e.colorRamp,we.RGBA8)),Je.bind(we.LINEAR,we.CLAMP_TO_EDGE)}return{mix:Oe,range:_t,offset:Qe,defines:Be,resampling:De}}(F,s,z,L);if(F instanceof i.aK&&!h.length&&!x)return;const j=s.paint.get("raster-emissive-strength"),Z=d.colorModeForDrapableLayerRenderPass(j),H=d.terrain&&d.terrain.renderingToTexture,J=!d.options.moving,Q=s.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(F instanceof i.aK&&!h.length&&(F.onNorthPole||F.onSouthPole)){const fe=M?d.stencilModeFor3D():br.disabled;return void Nn(!!F.onNorthPole,null,d,t,s,j,B,dr.disabled,fe)}if(!h.length)return;const[oe,ue]=F instanceof i.aK||H?[{},h]:d.stencilConfigForOverlap(h),ce=ue[ue.length-1].overscaledZ;P&&B.defines.push("PROJECTION_GLOBE_VIEW"),M&&B.defines.push("RENDER_CUTOFF");const ge=(fe,_e,pe)=>{for(const we of fe){const Ee=we.toUnwrapped(),qe=t.getTile(we);if(H&&(!qe||!qe.hasData()))continue;z.activeTexture.set(L.TEXTURE0);const Be=u_(qe,F,s,B);if(!Be||!Be.texture)continue;const{texture:et,mix:rt,offset:_t,tileSize:Oe,buffer:Qe}=Be;let De,Je;H?(De=Xt.disabled,Je=we.projMatrix):M?(De=new Xt(L.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D),Je=x?Float32Array.from(d.transform.expandedFarZProjMatrix):d.transform.calculateProjMatrix(Ee,J)):(De=d.depthModeForSublayer(we.overscaledZ-ce,s.paint.get("raster-opacity")===1?Xt.ReadWrite:Xt.ReadOnly,L.LESS),Je=d.transform.calculateProjMatrix(Ee,J));const Ze=d.terrain&&H?d.terrain.stencilModeForRTTOverlap(we):oe[we.overscaledZ],st=g?0:s.paint.get("raster-fade-duration");qe.registerFadeDuration(st);const $e=t.findLoadedParent(we,0),lt=Rl(qe,$e,t,d.transform,st);let wt,Mt;d.terrain&&d.terrain.prepareDrawTile(),z.activeTexture.set(L.TEXTURE0),et.bind(Q,L.CLAMP_TO_EDGE),z.activeTexture.set(L.TEXTURE1),$e?($e.texture&&$e.texture.bind(Q,L.CLAMP_TO_EDGE),wt=Math.pow(2,$e.tileID.overscaledZ-qe.tileID.overscaledZ),Mt=[qe.tileID.canonical.x*wt%1,qe.tileID.canonical.y*wt%1]):et.bind(Q,L.CLAMP_TO_EDGE),"useMipmap"in et&&z.extTextureFilterAnisotropic&&d.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const Lt=d.transform;let Wt;const fr=M?Ue(Lt):[0,0,0,0];let nr,pr,ur,Br,nn,hn=0;if(P&&F instanceof i.aK&&F.coordinates.length>3)nr=Float32Array.from(i.bc(i.cI(new i.bT(0,0,0)))),pr=Float32Array.from(Lt.globeMatrix),ur=Float32Array.from(i.cE(Lt)),Br=[i.av(Lt.center.lng),i.aC(Lt.center.lat)],Wt=F.elevatedGlobePerspectiveTransform,nn=F.elevatedGlobeGridMatrix||new Float32Array(9);else if(P){const _r=i.cF(we.canonical);hn=i.cG(_r.getCenter().lat),nr=Float32Array.from(i.bc(i.cI(we.canonical))),pr=Float32Array.from(Lt.globeMatrix),ur=Float32Array.from(i.cE(Lt)),Br=[i.av(Lt.center.lng),i.aC(Lt.center.lat)],Wt=[0,0],nn=Float32Array.from(i.cH(we.canonical,_r,hn,Lt.worldSize/Lt._pixelsPerMercatorPixel))}else Wt=F instanceof i.aK?F.perspectiveTransform:[0,0],nr=new Float32Array(16),pr=new Float32Array(9),ur=new Float32Array(16),Br=[0,0],nn=new Float32Array(9);const Dr=gf(Je,nr,pr,ur,nn,Mt||[0,0],i.ag(d.transform.zoom),Br,fr,wt||1,lt,s,Wt,M?s.paint.get("raster-elevation"):0,2,rt,_t,B.range,Oe,Qe,j),Pn=d.isTileAffectedByFog(we),wr=d.getOrCreateProgram("raster",{defines:B.defines,overrideFog:Pn});if(d.uploadCommonUniforms(z,wr,Ee),F instanceof i.aK){const _r=F.elevatedGlobeVertexBuffer,sr=F.elevatedGlobeIndexBuffer;if(H||!x)F.boundsBuffer&&F.boundsSegments&&wr.draw(d,L.TRIANGLES,De,br.disabled,Z,dr.disabled,Dr,s.id,F.boundsBuffer,d.quadTriangleIndexBuffer,F.boundsSegments);else if(_r&&sr){const Kr=Lt.zoom<=i.c6?F.elevatedGlobeSegments:F.getSegmentsForLongitude(Lt.center.lng);Kr&&wr.draw(d,L.TRIANGLES,De,br.disabled,Z,_e,Dr,s.id,_r,sr,Kr)}}else if(P){De=new Xt(L.LEQUAL,Xt.ReadOnly,d.depthRangeFor3D);const _r=d.globeSharedBuffers;if(_r){const[sr,Kr,Yr]=_r.getGridBuffers(hn,!1);wr.draw(d,L.TRIANGLES,De,pe||Ze,d.colorModeForRenderPass(),_e,Dr,s.id,sr,Kr,Yr)}}else{const{tileBoundsBuffer:_r,tileBoundsIndexBuffer:sr,tileBoundsSegments:Kr}=d.getTileBoundsBuffers(qe);wr.draw(d,L.TRIANGLES,De,Ze,Z,dr.disabled,Dr,s.id,_r,sr,Kr)}}if(!(F instanceof i.aK)&&P)for(const we of fe){const Ee=we.canonical.y===(1<<we.canonical.z)-1;we.canonical.y===0&&Nn(!0,we,d,t,s,j,B,_e,pe||br.disabled),Ee&&Nn(!1,we,d,t,s,j,B,_e===dr.frontCW?dr.backCW:dr.frontCW,pe||br.disabled)}};P?ge(ue,d.renderElevatedRasterBackface?dr.backCW:dr.frontCW,d.stencilModeFor3D()):ge(ue,dr.disabled,void 0),d.resetStencilClippingMasks()},"raster-particle":function(d,t,s,h,m,g){d.renderPass==="offscreen"&&function(x,M,P,z){if(!z.length)return;const L=x.context,F=L.gl,B=M.getSource();if(!(B instanceof xs))return;const j=Math.ceil(Math.sqrt(P.paint.get("raster-particle-count")));let Z=P.particlePositionRGBAImage;if(!Z||Z.width!==j){const ue=function(ce){const ge=ce*ce,fe=new Uint8Array(4*ge),_e=function(we){return we|=0,we=Math.imul(2747636419^we,2654435769),we=Math.imul(we^we>>>16,2654435769),((we=Math.imul(we^we>>>16,2654435769))>>>0)/4294967296},pe=1/1.1;for(let we=0;we<ge;we++){const Ee=pe*(_e(2*we+0)+Ss),qe=pe*(_e(2*we+1)+Ss),Be=255*Ee%1,et=255*qe%1,rt=Be,_t=qe-et/255,Oe=et;fe[4*we+0]=255*(Ee-Be/255),fe[4*we+1]=255*rt,fe[4*we+2]=255*_t,fe[4*we+3]=255*Oe}return fe}(j);Z=P.particlePositionRGBAImage=new i.r({width:j,height:j},ue)}let H=P.particleFramebuffer;H?H.width!==j&&(H.destroy(),H=P.particleFramebuffer=L.createFramebuffer(j,j,!0,null)):H=P.particleFramebuffer=L.createFramebuffer(j,j,!0,null);const J=[];for(const ue of z){const ce=M.getTile(ue);if(!(ce instanceof ma))continue;const ge=Af(ce,B,P);if(!ge)continue;const fe=[ce.tileSize,ce.tileSize];let _e=P.tileFramebuffer;_e||(_e=P.tileFramebuffer=L.createFramebuffer(fe[0],fe[1],!0,null));let pe=ce.rasterParticleState;pe||(pe=ce.rasterParticleState=new Ef(L,ue,fe,Z));const we=pe.update(P.lastInvalidatedAt);pe.particleTextureDimension!==j&&pe.updateParticleTexture(ue,Z);const Ee=pe.targetColorTexture;pe.targetColorTexture=pe.backgroundColorTexture,pe.backgroundColorTexture=Ee;const qe=pe.particleTexture0;pe.particleTexture0=pe.particleTexture1,pe.particleTexture1=qe,J.push([ue,ge,pe,we])}if(J.length===0)return;const Q=i.q.now(),oe=P.previousDrawTimestamp?.001*(Q-P.previousDrawTimestamp):.0167;if(P.previousDrawTimestamp=Q,P.hasColorMap()){L.activeTexture.set(F.TEXTURE0+2);let ue=P.colorRampTexture;ue||(ue=P.colorRampTexture=new i.T(L,P.colorRamp,F.RGBA8)),ue.bind(F.LINEAR,F.CLAMP_TO_EDGE)}L.bindFramebuffer.set(P.tileFramebuffer.framebuffer),function(ue,ce,ge){const fe=ue.context,_e=fe.gl,pe=ce.tileFramebuffer;fe.activeTexture.set(_e.TEXTURE0);const we={u_texture:0,u_opacity:1.05*(qe=ce.paint.get("raster-particle-fade-opacity-factor"))/(qe+.05)},Ee=ue.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var qe;for(const Be of ge){const[,,et,rt]=Be;pe.colorAttachment.set(et.targetColorTexture.texture),fe.viewport.set([0,0,pe.width,pe.height]),fe.clear({color:i.al.transparent}),rt&&(et.backgroundColorTexture.bind(_e.NEAREST,_e.CLAMP_TO_EDGE),Ee.draw(ue,_e.TRIANGLES,Xt.disabled,br.disabled,Rr.alphaBlended,dr.disabled,we,ce.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments))}}(x,P,J),function(ue,ce,ge,fe){const _e=ue.context,pe=_e.gl,we=ge.tileFramebuffer,Ee=ue.transform.projection.name==="globe",qe=ge.paint.get("raster-particle-max-speed");for(const Be of fe){const[et,rt,_t]=Be;_e.activeTexture.set(pe.TEXTURE0+0),rt.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),we.colorAttachment.set(_t.targetColorTexture.texture);const Oe=ue.getOrCreateProgram("rasterParticleDraw",{defines:rt.defines,overrideFog:!1});_e.activeTexture.set(pe.TEXTURE0+1);const Qe=rt.scalarData?[]:[0,1,2,3].map(Ze=>i.d7[Ze](et));Qe.push(et);const De=et.canonical.x,Je=et.canonical.y;for(const Ze of Qe){const st=ce.getTile(Ee?Ze.wrapped():Ze);if(!st)continue;const $e=st.rasterParticleState;if(!$e)continue;const lt=Ze.canonical.x+(1<<Ze.canonical.z)*(Ze.wrap-et.wrap),wt=Ze.canonical.y;$e.particleTexture0.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);const Mt=Qt(1,$e.particleTexture0.size[0],[lt-De,wt-Je],0,rt.texture.size,2,qe,rt.textureOffset,rt.scale,rt.offset);Oe.draw(ue,pe.POINTS,Xt.disabled,br.disabled,Rr.alphaBlended,dr.disabled,Mt,ge.id,$e.particleIndexBuffer,void 0,$e.particleSegment)}}}(x,M,P,J),L.bindFramebuffer.set(P.particleFramebuffer.framebuffer),function(ue,ce,ge,fe){const _e=ue.context,pe=_e.gl,we=ce.paint.get("raster-particle-max-speed"),Ee=fe*ce.paint.get("raster-particle-speed-factor")*.15,qe=function(et){return Math.pow(et,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),Be=ce.particleFramebuffer;_e.viewport.set([0,0,Be.width,Be.height]);for(const et of ge){const[,rt,_t]=et;_e.activeTexture.set(pe.TEXTURE0+0),rt.texture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE),_e.activeTexture.set(pe.TEXTURE0+1);const Oe=_t.particleTexture0;Oe.bind(pe.NEAREST,pe.CLAMP_TO_EDGE);const Qe=yf(1,Oe.size[0],0,rt.texture.size,we,Ee,qe,rt.textureOffset,rt.scale,rt.offset);Be.colorAttachment.set(_t.particleTexture1.texture),_e.clear({color:i.al.transparent}),ue.getOrCreateProgram("rasterParticleUpdate",{defines:rt.defines}).draw(ue,pe.TRIANGLES,Xt.disabled,br.disabled,Rr.unblended,dr.disabled,Qe,ce.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments)}}(x,P,J,oe)}(d,t,s,h),d.renderPass==="translucent"&&(function(x,M,P,z,L){const F=x.context,B=F.gl,j=M.getSource().tileSize,Z=5*(1-i.ae(i.bY,i.bY+1,x.transform.zoom))*j+P.paint.get("raster-particle-elevation"),H=!x.options.moving,J=x.transform.projection.name==="globe";if(!z.length)return;const[Q,oe]=x.stencilConfigForOverlap(z),ue=[];J&&ue.push("PROJECTION_GLOBE_VIEW");const ce=x.stencilModeFor3D();for(const ge of oe){const fe=ge.toUnwrapped(),_e=M.getTile(ge);if(!_e.rasterParticleState)continue;const pe=_e.rasterParticleState,we=100;_e.registerFadeDuration(we);const Ee=M.findLoadedParent(ge,0),qe=Rl(_e,Ee,M,x.transform,we);let Be,et;x.terrain&&x.terrain.prepareDrawTile(),F.activeTexture.set(B.TEXTURE0),pe.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),F.activeTexture.set(B.TEXTURE1),Ee&&Ee.rasterParticleState?(Ee.rasterParticleState.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Be=Math.pow(2,Ee.tileID.overscaledZ-_e.tileID.overscaledZ),et=[_e.tileID.canonical.x*Be%1,_e.tileID.canonical.y*Be%1]):pe.targetColorTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE);const rt=J?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(fe,H),_t=x.transform,Oe=h_(_t),Qe=i.cF(ge.canonical),De=i.cG(Qe.getCenter().lat);let Je,Ze,st,$e,lt;J?(Je=Float32Array.from(i.bc(i.cI(ge.canonical))),Ze=Float32Array.from(_t.globeMatrix),st=Float32Array.from(i.cE(_t)),$e=[i.av(_t.center.lng),i.aC(_t.center.lat)],lt=Float32Array.from(i.cH(ge.canonical,Qe,De,_t.worldSize/_t._pixelsPerMercatorPixel))):(Je=new Float32Array(16),Ze=new Float32Array(9),st=new Float32Array(16),$e=[0,0],lt=new Float32Array(9));const wt=ba(rt,Je,Ze,st,lt,et||[0,0],i.ag(x.transform.zoom),$e,Oe,Be||1,qe,Z),Mt=x.isTileAffectedByFog(ge),Lt=x.getOrCreateProgram("rasterParticle",{defines:ue,overrideFog:Mt});if(x.uploadCommonUniforms(F,Lt,fe),J){const Wt=new Xt(B.LEQUAL,Xt.ReadOnly,x.depthRangeFor3D),fr=0,nr=x.globeSharedBuffers;if(nr){const[pr,ur,Br]=nr.getGridBuffers(De,fr!==0);Lt.draw(x,B.TRIANGLES,Wt,ce,Rr.alphaBlended,x.renderElevatedRasterBackface?dr.frontCCW:dr.backCCW,wt,P.id,pr,ur,Br)}}else{const Wt=x.depthModeForSublayer(0,Xt.ReadOnly),fr=Q[ge.overscaledZ],{tileBoundsBuffer:nr,tileBoundsIndexBuffer:pr,tileBoundsSegments:ur}=x.getTileBoundsBuffers(_e);Lt.draw(x,B.TRIANGLES,Wt,fr,Rr.alphaBlended,dr.disabled,wt,P.id,nr,pr,ur)}}x.resetStencilClippingMasks()}(d,t,s,h),d.style.map.triggerRepaint())},background:function(d,t,s,h){const m=s.paint.get("background-color"),g=s.paint.get("background-color-use-theme").constantOr("default")==="none",x=s.paint.get("background-opacity"),M=s.paint.get("background-emissive-strength"),P=s.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const z=d.context,L=z.gl,F=d.transform,B=F.tileSize,j=s.paint.get("background-pattern");let Z;if(j!==void 0&&(j===null||(Z=d.imageManager.getPattern(i.I.from(j.toString()),s.scope,d.style.getLut(s.scope)),!Z)))return;const H=!j&&m.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==H)return;const J=br.disabled,Q=d.depthModeForSublayer(0,H==="opaque"?Xt.ReadWrite:Xt.ReadOnly),oe=d.colorModeForDrapableLayerRenderPass(M),ue=j?"backgroundPattern":"background";let ce,ge=h;if(ge||(ce=d.getBackgroundTiles(),ge=Object.values(ce).map(fe=>fe.tileID)),j&&(z.activeTexture.set(L.TEXTURE0),d.imageManager.bind(d.context,s.scope)),P){const fe=d.getOrCreateProgram(ue,{overrideFog:!1,overrideRtt:!0}),_e=new Float32Array(i.ad.mat4.identity([])),pe=new i.aH(0,0,0,0,0),we=j?vf(_e,M,x,d,0,s.scope,Z,P,{tileID:pe,tileSize:B}):_h(_e,M,x,m.toRenderColor(g?null:s.lut));fe.draw(d,L.TRIANGLES,Q,J,oe,dr.disabled,we,s.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments)}else for(const fe of ge){const _e=d.isTileAffectedByFog(fe),pe=d.getOrCreateProgram(ue,{overrideFog:_e}),we=fe.toUnwrapped(),Ee=h?fe.projMatrix:d.transform.calculateProjMatrix(we);d.prepareDrawTile();const qe=t?t.getTile(fe):ce?ce[fe.key]:new pa(fe,B,F.zoom,d),Be=j?vf(Ee,M,x,d,0,s.scope,Z,P,{tileID:fe,tileSize:B}):_h(Ee,M,x,m.toRenderColor(g?null:s.lut));d.uploadCommonUniforms(z,pe,we);const{tileBoundsBuffer:et,tileBoundsIndexBuffer:rt,tileBoundsSegments:_t}=d.getTileBoundsBuffers(qe);pe.draw(d,L.TRIANGLES,Q,J,oe,dr.disabled,Be,s.id,et,rt,_t)}},sky:function(d,t,s){const h=d._atmosphere?i.ag(d.transform.zoom):1,m=s.paint.get("sky-opacity")*h;if(m===0)return;const g=d.context,x=s.paint.get("sky-type"),M=new Xt(g.gl.LEQUAL,Xt.ReadOnly,[0,1]),P=d.frameCounter/1e3%1;x==="atmosphere"?d.renderPass==="offscreen"?s.needsSkyboxCapture(d)&&(function(z,L,F,B){const j=z.context,Z=j.gl;let H=L.skyboxFbo;if(!H){H=L.skyboxFbo=j.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new If(j),L.skyboxTexture=j.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,L.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let ue=0;ue<6;++ue)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(H.framebuffer),j.viewport.set([0,0,32,32]);const J=L.getCenter(z,!0),Q=z.getOrCreateProgram("skyboxCapture"),oe=new Float64Array(16);i.ad.mat4.identity(oe),i.ad.mat4.rotateY(oe,oe,.5*-Math.PI),Vl(z,L,Q,oe,J,0),i.ad.mat4.identity(oe),i.ad.mat4.rotateY(oe,oe,.5*Math.PI),Vl(z,L,Q,oe,J,1),i.ad.mat4.identity(oe),i.ad.mat4.rotateX(oe,oe,.5*-Math.PI),Vl(z,L,Q,oe,J,2),i.ad.mat4.identity(oe),i.ad.mat4.rotateX(oe,oe,.5*Math.PI),Vl(z,L,Q,oe,J,3),i.ad.mat4.identity(oe),Vl(z,L,Q,oe,J,4),i.ad.mat4.identity(oe),i.ad.mat4.rotateY(oe,oe,Math.PI),Vl(z,L,Q,oe,J,5),j.viewport.set([0,0,z.width,z.height])}(d,s),s.markSkyboxValid(d)):d.renderPass==="sky"&&function(z,L,F,B,j){const Z=z.context,H=Z.gl,J=z.transform,Q=z.getOrCreateProgram("skybox");Z.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_CUBE_MAP,L.skyboxTexture);const oe=((ue,ce,ge,fe,_e)=>({u_matrix:ue,u_sun_direction:ce,u_cubemap:0,u_opacity:fe,u_temporal_offset:_e}))(J.skyboxMatrix,L.getCenter(z,!1),0,B,j);z.uploadCommonUniforms(Z,Q),Q.draw(z,H.TRIANGLES,F,br.disabled,z.colorModeForRenderPass(),dr.backCW,oe,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,s,M,m,P):x==="gradient"&&d.renderPass==="sky"&&function(z,L,F,B,j){const Z=z.context,H=Z.gl,J=z.transform,Q=z.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new If(Z)),Z.activeTexture.set(H.TEXTURE0);let oe=L.colorRampTexture;oe||(oe=L.colorRampTexture=new i.T(Z,L.colorRamp,H.RGBA8)),oe.bind(H.LINEAR,H.CLAMP_TO_EDGE);const ue=((ce,ge,fe,_e,pe)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:ge,u_radius:i.ak(fe),u_opacity:_e,u_temporal_offset:pe}))(J.skyboxMatrix,L.getCenter(z,!1),L.paint.get("sky-gradient-radius"),B,j);z.uploadCommonUniforms(Z,Q),Q.draw(z,H.TRIANGLES,F,br.disabled,z.colorModeForRenderPass(),dr.backCW,ue,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(d,s,M,m,P)},debug:function(d,t,s,h,m,g){for(let x=0;x<s.length;x++)if(m){const z=new i.al(h.r*.8,h.g*.8,h.b*.8,1);Wo(d,t,s[x],h,-1,-1,g),Wo(d,t,s[x],h,-1,1,g),Wo(d,t,s[x],h,1,1,g),Wo(d,t,s[x],h,1,-1,g),Wo(d,t,s[x],z,0,0,g)}else Wo(d,t,s[x],h,0,0,g)},custom:function(d,t,s,h){const m=d.context,g=s.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&s.isDraped(t)){if(d.renderPass==="offscreen"){const x=g.prerender;if(x){if(d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const M=d.transform.pointMerc;x.call(g,m.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.ag(d.transform.zoom),[M.x,M.y],d.transform.pixelsPerMeterRatio)}else x.call(g,m.gl,d.transform.customLayerMatrix());m.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const M=g.renderToTile;if(M){const P=h[0].canonical,z=new i.ac(P.x+h[0].wrap*(1<<P.z),P.y,P.z);m.setDepthMode(Xt.disabled),m.setStencilMode(br.disabled),m.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),M.call(g,m.gl,z),m.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),m.setColorMode(d.colorModeForRenderPass()),m.setStencilMode(br.disabled);const x=g.renderingMode==="3d"?new Xt(d.context.gl.LEQUAL,Xt.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,Xt.ReadOnly);if(m.setDepthMode(x),d.transform.projection.name==="globe"){const M=d.transform.pointMerc;g.render(m.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),i.ag(d.transform.zoom),[M.x,M.y],d.transform.pixelsPerMeterRatio)}else g.render(m.gl,d.transform.customLayerMatrix());m.setDirty(),d.setBaseState(),m.bindFramebuffer.set(null)}}else i.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(d,t,s,h){if(d.renderPass==="opaque")return;const m=s.paint.get("model-opacity").constantOr(1);if(m===0)return;const g=s.paint.get("model-cast-shadows");if(d.renderPass==="shadow"&&(!g||d.terrain&&m<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof i.ab))return;const x=d.shadowRenderer,M=s.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,M||(x.enabled=!1));const P=()=>{x&&(x.useNormalOffset=!0,M||(x.enabled=!0))},z=t.getSource();if(d.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return function(Q,oe,ue,ce,ge){const fe=Q.transform;if(fe.projection.name!=="mercator")return void i.w(`Drawing 3D models for ${fe.projection.name} projection is not yet implemented`);const _e=fe.getFreeCameraOptions().position;if(!Q.modelManager)return;const pe=Q.modelManager;ue.modelManager=pe;const we=Q.shadowRenderer;if(!ue._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ee=ue._unevaluatedLayout._values["model-id"],qe=Object.assign({},ue.layout.get("model-id").parameters),Be=Q.style.order.indexOf(ue.fqid);for(const et of ce){const rt=oe.getTile(et).getBucket(ue);if(!rt||rt.projection.name!==fe.projection.name)continue;const _t=rt.getModelUris();_t&&!rt.modelsRequested&&(pe.addModelsFromBucket(_t,ge),rt.modelsRequested=!0);const Oe=Rf(et,fe);qe.zoom=Oe;const Qe=Ee.possiblyEvaluate(qe);if(Pf(Q,rt,et),js.shadowUniformsInitialized=!1,js.useSingleShadowCascade=!!we&&we.getMaxCascadeForTile(et.toUnwrapped())===0,Q.renderPass==="shadow"&&we){if(Q.currentShadowCascade===1&&rt.isInsideFirstShadowMapFrustum)continue;const Ze=fe.calculatePosMatrix(et.toUnwrapped(),fe.worldSize);if(js.tileMatrix.set(Ze),js.shadowTileMatrix=Float32Array.from(we.calculateShadowPassMatrixFromMatrix(Ze)),js.aabb.min.fill(0),js.aabb.max[0]=js.aabb.max[1]=i.ai,js.aabb.max[2]=0,Ta(rt,js,Q,ue.scope))continue}const De=1<<et.canonical.z,Je=[((_e.x-et.wrap)*De-et.canonical.x)*i.ai,(_e.y*De-et.canonical.y)*i.ai,_e.z*De*i.ai];Q.conflationActive&&Object.keys(rt.instancesPerModel).length>0&&Q.style.isLayerClipped(ue,oe.getSource())&&rt.updateReplacement(et,Q.replacementSource,Be,ge)&&(rt.uploaded=!1,rt.upload(Q.context));for(let Ze in rt.instancesPerModel){const st=rt.instancesPerModel[Ze];st.features.length>0&&(Ze=Qe.evaluate(st.features[0].feature,{}));const $e=pe.getModel(Ze,ge);if($e&&$e.uploaded)for(const lt of $e.nodes)Mh(Q,ue,lt,st,Je,et,js)}}}(d,t,s,h,z.type==="vector"?s.scope:""),void P();if(!z.loaded())return;if(z.type==="batched-model")return function(Q,oe,ue,ce){ue.resetLayerRenderingStats(Q);const ge=Q.context,fe=Q.transform,_e=Q.style.fog,pe=Q.shadowRenderer;if(fe.projection.name!=="mercator")return void i.w(`Drawing 3D landmark models for ${fe.projection.name} projection is not yet implemented`);const we=Q.transform.getFreeCameraOptions().position,Ee=i.ad.vec3.scale([],[we.x,we.y,we.z],Q.transform.worldSize),qe=i.ad.vec3.negate([],Ee),Be=i.ad.mat4.identity([]),et=i.dm(fe.center.lat,fe.zoom),rt=i.ad.mat4.fromScaling([],[1,1,1/et]);i.ad.mat4.translate(Be,Be,qe);const _t=ue.paint.get("model-opacity").constantOr(1),Oe=new Xt(ge.gl.LEQUAL,Xt.ReadWrite,Q.depthRangeFor3D),Qe=new Xt(ge.gl.LEQUAL,Xt.ReadOnly,Q.depthRangeFor3D),De=new i.ce([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Je=Q.renderPass==="shadow",Ze=Je&&pe?pe.getCurrentCascadeFrustum():fe.getFrustum(fe.scaleZoom(fe.worldSize)),st=ue.paint.get("model-front-cutoff"),$e=st[2]<1,lt=_a(Q,ue.paint.get("model-cutoff-fade-range")),wt=ue.getLayerRenderingStats();(function(Mt,Lt,Wt,fr){const nr=Mt.terrain?Mt.terrain.exaggeration():0,pr=Mt.transform.zoom;for(const ur of fr){const Br=Lt.getTile(ur).getBucket(Wt);Br&&(Br.setFilter(Wt.filter),Mt.conflationActive&&Br.updateReplacement(ur,Mt.replacementSource),Br.evaluateScale(Mt,Wt),Mt.terrain&&nr>0&&Br.elevationUpdate(Mt.terrain,nr,ur,Wt.source),Br.needsReEvaluation(Mt,pr,Wt)&&Br.evaluate(Wt))}})(Q,oe,ue,ce),function(){let Mt,Lt,Wt;$e?(Mt=ce.length-1,Lt=-1,Wt=-1):(Mt=0,Lt=ce.length,Wt=1);const fr=new Float64Array(16),nr=i.ad.vec3.create(),pr=new i.P(0,0);for(let ur=Mt;ur!==Lt;ur+=Wt){const Br=ce[ur],nn=oe.getTile(Br).getBucket(ue);if(!nn||!nn.uploaded)continue;let hn=!1;pe&&(hn=pe.getMaxCascadeForTile(Br.toUnwrapped())===0);const Dr=fe.calculatePosMatrix(Br.toUnwrapped(),fe.worldSize),Pn=nn.modelTraits;!Je&&$e&&(i.ad.mat4.invert(fr,Dr),i.ad.vec3.transformMat4(nr,Ee,fr),pr.x=nr[0],pr.y=nr[1]);const wr=[];nn.setFilter(ue.filter);for(const _r of nn.getNodesInfo()){if(_r.hiddenByReplacement||!_r.node.meshes)continue;const sr=_r.node;let Kr=0;Q.terrain&&sr.elevation&&(Kr=sr.elevation*Q.terrain.exaggeration());const Yr=(()=>{const dn=_r.aabb;return De.min=[...dn.min],De.max=[...dn.max],De.min[2]+=Kr,De.max[2]+=Kr,i.ad.vec3.transformMat4(De.min,De.min,Dr),i.ad.vec3.transformMat4(De.max,De.max,Dr),De})(),$n=_r.evaluatedScale;if($n[0]<=1&&$n[1]<=1&&$n[2]<=1&&Yr.intersects(Ze)===0)continue;if(!Je&&$e){const dn=.16666666666666666;_r.cameraCollisionOpacity=Ee[0]>Yr.min[0]&&Ee[0]<Yr.max[0]&&Ee[1]>Yr.min[1]&&Ee[1]<Yr.max[1]&&Ee[2]*et<Yr.max[2]&&sr.footprint&&i.bA(pr,sr.footprint)?Math.max(_r.cameraCollisionOpacity-dn,0):Math.min(1,_r.cameraCollisionOpacity+dn)}const di=[...Dr],Qi=sr.anchor?sr.anchor[0]:0,fi=sr.anchor?sr.anchor[1]:0;i.ad.mat4.translate(di,di,[Qi*($n[0]-1),fi*($n[1]-1),Kr]),i.ad.vec3.exactEquals($n,i.dq)||i.ad.mat4.scale(di,di,$n);const Ti=i.ad.mat4.multiply([],di,sr.matrix),Ui=i.ad.mat4.multiply([],fe.expandedFarZProjMatrix,Ti),Jr=i.ad.mat4.multiply([],fe.expandedFarZProjMatrix,di),Sn=i.ad.vec4.transformMat4([],[Qi,fi,Kr,1],Ui)[2];sr.hidden=!1;let sn=_t;Je||($e&&(sn*=_r.cameraCollisionOpacity,sn*=Ch(di,fe,_r.aabb,st)),sn*=Ih(lt,Sn)),sn!==0?wr.push({nodeInfo:_r,depth:Sn,opacity:sn,wvpForNode:Ui,wvpForTile:Jr,nodeModelMatrix:Ti,tileModelMatrix:di}):sr.hidden=!0}Je||wr.sort((_r,sr)=>!$e||_r.opacity===1&&sr.opacity===1?_r.depth<sr.depth?-1:1:_r.opacity===1?-1:sr.opacity===1?1:_r.depth>sr.depth?-1:1);for(const _r of wr){const sr=_r.nodeInfo,Kr=sr.node;let Yr=i.ad.mat4.multiply([],rt,_r.tileModelMatrix);i.ad.mat4.multiply(Yr,Be,Yr);const $n=i.ad.mat4.invert([],Yr);i.ad.mat4.transpose($n,$n),i.ad.mat4.scale($n,$n,Mo),Yr=i.ad.mat4.multiply(Yr,Yr,Kr.matrix);const di=Q.renderPass==="light-beam",Qi=ue.paint.get("model-color-use-theme").constantOr("default")==="none",fi=Pn&i.ds.HasMapboxMeshFeatures,Ti=fi?0:sr.evaluatedRMEA[0][2];for(let Ui=0;Ui<Kr.meshes.length;++Ui){const Jr=Kr.meshes[Ui],Sn=Ui===Kr.lightMeshIndex;let sn=_r.wvpForNode;if(Sn){if(!di&&!Q.terrain&&Q.shadowRenderer){Q.currentLayer<Q.firstLightBeamLayer&&(Q.firstLightBeamLayer=Q.currentLayer);continue}sn=_r.wvpForTile}else if(di)continue;const dn={defines:[]},mi=[];if(!Je&&pe&&(pe.useNormalOffset=!!Jr.normalBuffer),Ao(dn.defines,mi,Jr,Q,Qi?null:ue.lut),fi||dn.defines.push("DIFFUSE_SHADED"),hn&&dn.defines.push("SHADOWS_SINGLE_CASCADE"),wt&&(Je?wt.numRenderedVerticesInShadowPass+=Jr.vertexArray.length:wt.numRenderedVerticesInTransparentPass+=Jr.vertexArray.length),Je){wa(Jr,_r.nodeModelMatrix,Q,ue);continue}let On=null;if(_e){const zi=Cf(_r.nodeModelMatrix,Q.transform);if(On=new Float32Array(zi),fe.projection.name!=="globe"){const Cs=Jr.aabb.min,Ro=Jr.aabb.max,[so,Ko]=_e.getOpacityForBounds(zi,Cs[0],Cs[1],Ro[0],Ro[1]);dn.overrideFog=so>=mt||Ko>=mt}}const li=Jr.material;let Po;li.occlusionTexture&&li.occlusionTexture.offsetScale&&(Po=li.occlusionTexture.offsetScale,dn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const es=Q.getOrCreateProgram("model",dn);!Je&&pe&&pe.setupShadowsFromMatrix(_r.tileModelMatrix,es,pe.useNormalOffset),Q.uploadCommonUniforms(ge,es,null,On);const Gs=li.pbrMetallicRoughness;Gs.metallicFactor=.9,Gs.roughnessFactor=.5;const Xo=gh(new Float32Array(sn),new Float32Array(Yr),new Float32Array($n),new Float32Array(Kr.matrix),Q,_r.opacity,Gs.baseColorFactor.toRenderColor(null),li.emissiveFactor,Gs.metallicFactor,Gs.roughnessFactor,li,Ti,ue,[0,0,0],Po);!Sn&&(sr.hasTranslucentParts||_r.opacity<1)&&es.draw(Q,ge.gl.TRIANGLES,Oe,br.disabled,Rr.disabled,dr.backCCW,Xo,ue.id,Jr.vertexBuffer,Jr.indexBuffer,Jr.segments,ue.paint,Q.transform.zoom,void 0,mi),es.draw(Q,ge.gl.TRIANGLES,Sn?Qe:Oe,br.disabled,Sn||_r.opacity<1||sr.hasTranslucentParts?Rr.alphaBlended:Rr.unblended,dr.backCCW,Xo,ue.id,Jr.vertexBuffer,Jr.indexBuffer,Jr.segments,ue.paint,Q.transform.zoom,void 0,mi)}}}}()}(d,t,s,h),void P();if(z.type!=="model")return;const L=z.getModels(),F=[],B=d.transform.getFreeCameraOptions().position,j=i.ad.vec3.scale([],[B.x,B.y,B.z],d.transform.worldSize);i.ad.vec3.negate(j,j);const Z=[],H=[];let J=0;for(const Q of L){const oe=s.paint.get("model-rotation").constantOr(null),ue=s.paint.get("model-scale").constantOr(null),ce=s.paint.get("model-translation").constantOr(null);Q.computeModelMatrix(d,oe,ue,ce,!0,!0,!1);const ge=i.ad.mat4.identity([]),fe=i.dm(Q.position.lat,d.transform.zoom),_e=i.ad.mat4.fromScaling([],[1,1,1/fe]);i.ad.mat4.translate(ge,ge,j),F.push({zScaleMatrix:_e,negCameraPosMatrix:ge});for(const pe of Q.nodes)rl(d.transform,pe,Q.matrix,d.transform.expandedFarZProjMatrix,J,Z,H);J++}if(Z.sort((Q,oe)=>oe.depth-Q.depth),d.renderPass!=="shadow"){if(m===1)for(const Q of H)tl(Q,d,s,F[Q.modelIndex],br.disabled,d.colorModeForRenderPass());else{for(const Q of H)tl(Q,d,s,F[Q.modelIndex],br.disabled,Rr.disabled);for(const Q of H)tl(Q,d,s,F[Q.modelIndex],d.stencilModeFor3D(),d.colorModeForRenderPass());d.resetStencilClippingMasks()}for(const Q of Z)tl(Q,d,s,F[Q.modelIndex],br.disabled,d.colorModeForRenderPass());P()}else{for(const Q of H)wa(Q.mesh,Q.nodeModelMatrix,d,s);for(const Q of Z)wa(Q.mesh,Q.nodeModelMatrix,d,s);P()}}},zh={line:function(d,t,s){if(d.hasElevatedBuckets=!1,d.hasNonElevatedBuckets=!1,d._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||d._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const h=t.getVisibleCoordinates();for(const m of h){const g=t.getTile(m).getBucket(d);if(g&&(g.hasZOffset?d.hasElevatedBuckets=!0:d.hasNonElevatedBuckets=!0,d.hasElevatedBuckets&&d.hasNonElevatedBuckets))break}}}else d.hasNonElevatedBuckets=!0},model:function(d,t,s){const h=t.getSource();if(!h.loaded())return;if(h.type==="vector"||h.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,h.type==="vector"?d.scope:""));if(h.type==="batched-model"||h.type!=="model")return;const m=h.getModels();for(const g of m)g.upload(s.context)},raster:function(d,t,s){const h=t.getSource();if(!(h instanceof xs&&h.loaded()))return;const m=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!m)return;const g=d.paint.get("raster-array-band")||h.getInitialBand(m);if(g==null)return;const x=t.getIds().map(M=>t.getTileByID(M));for(const M of x)M.updateNeeded(m,g)&&h.prepareTile(M,m,g)},"raster-particle":function(d,t,s){const h=t.getSource();if(!(h instanceof xs&&h.loaded()))return;const m=d.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!m)return;const g=d.paint.get("raster-particle-array-band")||h.getInitialBand(m);if(g==null)return;const x=t.getIds().map(M=>t.getTileByID(M));for(const M of x)M.updateNeeded(m,g)&&h.prepareTile(M,m,g)}},Lh={fill:bh};class Vf{constructor(t,s,h,m,g){this.context=new as(t,s),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=g,this._timeStamp=i.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const x=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const P of x)this._debugParams.enabledLayers[P]=!0;g.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),g.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),g.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),g.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),g.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const P of x)g.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],P);this.occlusionParams=new nl(g),this.setup(),this.numSublayers=ws.maxUnderzooming+ws.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new i.dy,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Yu(this),this._wireframeDebugCache=new zf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const M=new i.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new i.T(this.context,M,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=m}updateTerrain(t,s){const h=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new dh(this,t));const m=this._terrain;this.transform.elevation=h?m:null,m.update(t,this.transform,s),this.transform.elevation&&!m.enabled&&(this.transform.elevation=null)}_updateFog(t){const s=t.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,m]=s.getFovAdjustedRange(this.transform._fov);if(h>m)return void(this.transform.fogCullDistSq=null);const g=h+.78*(m-h);this.transform.fogCullDistSq=g*g}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new dh(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,s){if(this.width=t*i.q.devicePixelRatio,this.height=s*i.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const t=this.context,s=new i.b5;s.emplaceBack(0,0),s.emplaceBack(i.ai,0),s.emplaceBack(0,i.ai),s.emplaceBack(i.ai,i.ai),this.tileExtentBuffer=t.createVertexBuffer(s,i.b7.members),this.tileExtentSegments=i.b8.simpleSegment(0,0,4,2);const h=new i.b5;h.emplaceBack(0,0),h.emplaceBack(i.ai,0),h.emplaceBack(0,i.ai),h.emplaceBack(i.ai,i.ai),this.debugBuffer=t.createVertexBuffer(h,i.b7.members),this.debugSegments=i.b8.simpleSegment(0,0,4,5);const m=new i.b5;m.emplaceBack(-1,-1),m.emplaceBack(1,-1),m.emplaceBack(-1,1),m.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(m,i.b7.members),this.viewportSegments=i.b8.simpleSegment(0,0,4,2);const g=new i.aU;g.emplaceBack(0,0,0,0),g.emplaceBack(i.ai,0,i.ai,0),g.emplaceBack(0,i.ai,0,i.ai),g.emplaceBack(i.ai,i.ai,i.ai,i.ai),this.mercatorBoundsBuffer=t.createVertexBuffer(g,i.ba.members),this.mercatorBoundsSegments=i.b8.simpleSegment(0,0,4,2);const x=new i.aV;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const M=new i.b6;for(const z of[0,1,3,2,0])M.emplaceBack(z);this.debugIndexBuffer=t.createIndexBuffer(M),this.emptyTexture=new i.T(t,new i.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=i.ad.mat4.create();const P=this.context.gl;this.stencilClearMode=new br({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Xt.disabled,this.stencilClearMode,Rr.disabled,dr.disabled,Uc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,s,h){if(!s||this.currentStencilSource===s.id||!t.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const P of h)if(this._tileClippingMaskIDs[P.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=s.id;const m=this.context,g=m.gl;this.nextStencilID+h.length>256&&this.clearStencil(),m.setColorMode(Rr.disabled),m.setDepthMode(Xt.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of h){const P=s.getTile(M),z=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:F,tileBoundsSegments:B}=this.getTileBoundsBuffers(P);x.draw(this,g.TRIANGLES,Xt.disabled,new br({func:g.ALWAYS,mask:0},z,255,g.KEEP,g.KEEP,g.REPLACE),Rr.disabled,dr.disabled,Uc(M.projMatrix),"$clipping",L,F,B)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new br({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const s=this.context.gl;return new br({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,h=t.sort((x,M)=>M.overscaledZ-x.overscaledZ),m=h[h.length-1].overscaledZ,g=h[0].overscaledZ-m+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let M=0;M<g;M++)x[M+m]=new br({func:s.GEQUAL,mask:255},M+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[x,h]}return[{[m]:br.disabled},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Rr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new i.al(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Rr.unblended:Rr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Rr([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new i.al(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,s,h,m=!1){if(this.depthOcclusion)return new Xt(this.context.gl.GREATER,Xt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!m)return Xt.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Xt(h||this.context.gl.LEQUAL,s,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,s=Math.ceil(this.width),h=Math.ceil(this.height),m=this.context.bindFramebuffer.get(),g=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===s&&this.depthFBO.height===h||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),s!==0&&h!==0&&(this.depthFBO=new yh(this.context,s,h,!1,"texture"),this.depthTexture=new i.T(this.context,{width:s,height:h,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(m),t.bindTexture(t.TEXTURE_2D,g),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,s,h,0,0,s,h,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,s)=>t+s/this._fpsHistory.length,0))}render(t,s){const h=i.q.now();this._dt=h-this._timeStamp,this._timeStamp=h,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=s;const m=this.style._mergedLayers,g=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(g).filter(Oe=>{const Qe=m[Oe];return!(Qe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Qe.type]});let M=x(),P=!1,z=!1;for(const Oe of M){const Qe=m[Oe];Qe.type==="circle"&&(P=!0),Qe.type==="symbol"&&(Qe.hasInitialOcclusionOpacityProperties?z=!0:P=!0)}let L=M.map(Oe=>m[Oe]);const F=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(i.q.now()),this.imageManager.beginFrame();let B=0,j=!1;for(const Oe in F){const Qe=F[Oe];Qe.used&&(Qe.prepare(this.context),Qe.getSource().usedInConflation&&++B)}let Z=!1;for(const Oe of L)Oe.isHidden(this.transform.zoom)||(Oe.type==="clip"&&(Z=!0),this.prepareLayer(Oe));const H={},J={},Q={},oe={},ue={};for(const Oe in F){const Qe=F[Oe];H[Oe]=Qe.getVisibleCoordinates(),J[Oe]=H[Oe].slice().reverse(),Q[Oe]=Qe.getVisibleCoordinates(!0).reverse(),oe[Oe]=Qe.getShadowCasterCoordinates(),ue[Oe]=Qe.sortCoordinatesByDistance(H[Oe])}const ce=Oe=>{const Qe=this.style.getLayerSourceCache(Oe);return Qe&&Qe.used?Qe.getSource():null};if(B||Z||this._clippingActiveLastFrame){const Oe=[],Qe=[];let De=0;for(const Je of L)this.isSourceForClippingOrConflation(Je,ce(Je))&&(Oe.push(Je),Qe.push(De)),De++;if(Oe&&(Z||Oe.length>1)||this._clippingActiveLastFrame){Z=!1;const Je=[];for(let Ze=0;Ze<Oe.length;Ze++){const st=Oe[Ze],$e=Qe[Ze],lt=this.style.getLayerSourceCache(st);if(!lt||!lt.used||!lt.getSource().usedInConflation&&st.type!=="clip")continue;let wt=i.dA,Mt=i.by.None;const Lt=[];let Wt=!0;if(st.type==="clip"){wt=$e;for(const fr of st.layout.get("clip-layer-types"))Mt|=fr==="model"?i.by.Model:fr==="symbol"?i.by.Symbol:i.by.FillExtrusion;for(const fr of st.layout.get("clip-layer-scope"))Lt.push(fr);st.isHidden(this.transform.zoom)?Wt=!1:Z=!0}Wt&&Je.push({layer:st.fqid,cache:lt,order:wt,clipMask:Mt,clipScope:Lt})}this.replacementSource.setSources(Je),j=!0}}this._clippingActiveLastFrame=Z,j||this.replacementSource.clear(),this.conflationActive=j,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Oe=0;Oe<L.length;Oe++){const Qe=L[Oe],De=Qe.cutoffRange();if(this.longestCutoffRange=Math.max(De,this.longestCutoffRange),De>0){const Je=ce(Qe);Je&&(this.minCutoffZoom=Math.max(Je.minzoom,this.minCutoffZoom)),Qe.minzoom&&(this.minCutoffZoom=Math.max(Qe.minzoom,this.minCutoffZoom))}Qe.is3D(g)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Oe),this._lastOcclusionLayer=Oe)}const ge=this.style&&this.style.fog;ge?(this._fogVisible=ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Q),this.opaquePassCutoff=0,M=x(),L=M.map(Oe=>m[Oe]));const fe=this._shadowRenderer;if(fe){fe.updateShadowParameters(this.transform,this.style.directionalLight);for(const Oe in F)for(const Qe of H[Oe]){let De={min:0,max:0};this.terrain&&(De=this.terrain.getMinMaxForTile(Qe)||De),fe.addShadowReceiver(Qe.toUnwrapped(),De.min,De.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new i.dz(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Zr(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const _e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),pe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(_e&&!this._snow&&(this._snow=new Nf(this)),!_e&&this._snow&&(this._snow.destroy(),delete this._snow),pe&&!this._rain&&(this._rain=new Ff(this)),!pe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!mn.has(this.context.gl))return;this.renderPass="offscreen";for(const Oe of L){const Qe=t.getLayerSourceCache(Oe);if(!Oe.hasOffscreenPass()||Oe.isHidden(this.transform.zoom))continue;const De=Qe?J[Qe.id]:void 0;(Oe.type==="custom"||Oe.type==="raster"||Oe.type==="raster-particle"||Oe.isSky()||De&&De.length)&&this.renderLayer(this,Qe,Oe,De)}this.depthRangeFor3D=[0,1-(L.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,oe)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const we=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ee=(()=>{if(s.showOverdrawInspector)return i.al.black;const Oe=this.style.fog;if(Oe&&this.transform.projection.supportsFog){const Qe=this.style.getLut(Oe.scope);if(!we){const De=Oe.properties.get("color-use-theme")==="none",Je=Oe.properties.get("color").toRenderColor(De?null:Qe).toArray01();return new i.al(...Je)}if(we){const De=Oe.properties.get("space-color-use-theme")==="none",Je=Oe.properties.get("space-color").toRenderColor(De?null:Qe).toArray01();return new i.al(...Je)}}return i.al.transparent})();if(this.context.clear({color:Ee,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const Oe=L[this.currentLayer],Qe=t.getLayerSourceCache(Oe);if(Oe.isSky())continue;const De=Qe?(Oe.is3D(g)?ue:J)[Qe.id]:void 0;this._renderTileClippingMasks(Oe,Qe,De),this.renderLayer(this,Qe,Oe,De)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&we&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||i.ag(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const Oe=L[this.currentLayer],Qe=t.getLayerSourceCache(Oe);Oe.isSky()&&this.renderLayer(this,Qe,Oe,Qe?J[Qe.id]:void 0)}function qe(Oe,Qe){let De;return Qe&&(De=(Oe.type==="symbol"?Q:Oe.is3D(g)?ue:J)[Qe.id]),De}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<M.length;){const Oe=L[this.currentLayer];if(Oe.type==="raster"||Oe.type==="raster-particle"){const Qe=t.getLayerSourceCache(Oe);this.renderLayer(this,Qe,Oe,qe(Oe,Qe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Be=0;fe&&(Be=fe.getShadowCastingLayerCount());let et=!1,rt=-1;for(let Oe=0;Oe<M.length;++Oe){const Qe=L[Oe];Qe.isHidden(this.transform.zoom)||Qe.is3D(g)&&(rt=Oe)}z&&rt===-1&&(P=!0);let _t=!1;for(;this.currentLayer<M.length;){const Oe=L[this.currentLayer],Qe=t.getLayerSourceCache(Oe);if(Oe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Oe)){if(Oe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!_t&&Oe.is3D(g)&&!g){const De=this.currentLayer,Je=Ze=>{for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const st=L[this.currentLayer];if(Lh[st.type]){const $e=this.style.getLayerSourceCache(st);Lh[st.type](this,$e,st,qe(st,$e),Ze)}}};Je("initialize"),Je("reset"),this.currentLayer=De,_t=!0}if(P&&!et&&this.terrain&&!this.transform.isOrthographic&&(et=!0,this.blitDepth()),z&&rt!==-1&&this.currentLayer===rt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Oe,Qe,Qe?H[Qe.id]:void 0),this.renderLayer(this,Qe,Oe,qe(Oe,Qe)),!this.terrain&&fe&&Be>0&&Oe.hasShadowPass()&&--Be==0&&(fe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const De=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=De;this.currentLayer++){const Je=L[this.currentLayer];if(!Je.hasLightBeamPass())continue;const Ze=t.getLayerSourceCache(Je);this.renderLayer(this,Ze,Je,Ze?J[Ze.id]:void 0)}this.currentLayer=De,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const De=this.currentLayer;this.depthOcclusion=!0;for(const Je of this.layersWithOcclusionOpacity){this.currentLayer=Je;const Ze=L[this.currentLayer],st=t.getLayerSourceCache(Ze),$e=st?J[st.id]:void 0;this.terrain||this._renderTileClippingMasks(Ze,st,st?H[st.id]:void 0),this.renderLayer(this,st,Ze,$e)}this.depthOcclusion=!1,this.currentLayer=De,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Oe=null;L.forEach(Qe=>{const De=t.getLayerSourceCache(Qe);De&&!Qe.isHidden(this.transform.zoom)&&De.getVisibleCoordinates().length&&(!Oe||Oe.getSource().maxzoom<De.getSource().maxzoom)&&(Oe=De)}),Oe&&this.options.showTileBoundaries&&Aa.debug(this,Oe,Oe.getVisibleCoordinates(),i.al.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Aa.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new i.al(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Oe){const Qe=Oe.transform.padding;Sh(Oe,Oe.transform.height-(Qe.top||0),3,d_),Sh(Oe,Qe.bottom||0,3,Nl),Mf(Oe,Qe.left||0,3,uv),Mf(Oe,Oe.transform.width-(Qe.right||0),3,hv);const De=Oe.transform.centerPoint;(function(Je,Ze,st,$e){Hc(Je,Ze-1,st-10,2,20,$e),Hc(Je,Ze-10,st-1,20,2,$e)})(Oe,De.x,Oe.transform.height-De.y,f_)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),j||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:s}=this.transform.projection,h=!s||!s.includes(t.type);if(zh[t.type]&&(h||this.terrain&&t.type==="custom")){const m=this.style.getLayerSourceCache(t);zh[t.type](t,m,this)}this.gpuTimingEnd()}renderLayer(t,s,h,m){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||m&&m.length)&&(this.id=h.id,this.gpuTimingStart(h),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(h.type)&&(!t.terrain||h.type!=="custom")||h.type==="clip"||Aa[h.type](t,s,h,m,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,h=this.context.gl;let m=this.gpuTimers[t.id];m||(m=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:h.createQuery()}),m.calls++,h.beginQuery(s.TIME_ELAPSED_EXT,m.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,s=this.context.gl,h=s.createQuery();this.deferredRenderGpuTimeQueries.push(h),s.beginQuery(t.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const s={};for(const h in t){const m=t[h],g=this.context.extTimerQuery,x=g.getQueryParameter(m.query,this.context.gl.QUERY_RESULT)/1e6;g.deleteQueryEXT(m.query),s[h]=x}return s}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.gl;let h=0;for(const m of t)h+=s.getQueryParameter(m,s.QUERY_RESULT)/1e6,s.deleteQuery(m);return h}translatePosMatrix(t,s,h,m,g){if(!h[0]&&!h[1])return t;const x=g?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(x){const z=Math.sin(x),L=Math.cos(x);h=[h[0]*L-h[1]*z,h[0]*z+h[1]*L]}const M=[g?h[0]:i.at(s,h[0],this.transform.zoom),g?h[1]:i.at(s,h[1],this.transform.zoom),0],P=new Float32Array(16);return i.ad.mat4.translate(P,t,M),P}saveTileTexture(t){const s=t.size[0],h=this._tileTextures[s];h?h.push(t):this._tileTextures[s]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,s,h){const m=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,g=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(g.push("LIGHTING_3D_MODE"),g.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):m||g.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||g.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(g.push("TERRAIN"),this.linearFloatFilteringSupported()&&g.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&g.push("GLOBE"),!this._fogVisible||m||s!==void 0&&!s||g.push("FOG","FOG_DITHERING"),m&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}getOrCreateProgram(t,s){this.cache=this.cache||{};const h=s&&s.defines||[],m=s&&s.config,g=this.currentGlobalDefines(t,s&&s.overrideFog,s&&s.overrideRtt).concat(h),x=r_.cacheKey(sh[t],t,g,m);return this.cache[x]||(this.cache[x]=new r_(this.context,t,sh[t],m,lv[t],g)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new i.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,s){if(this.style.enable3dLights()){const h=this.style.directionalLight,m=this.style.ambientLight;if(h&&m){const g=((x,M,P)=>{const z=x.properties.get("direction"),L=x.properties.get("color-use-theme")==="none",F=x.properties.get("color").toRenderColor(L?null:P.getLut(x.scope)).toArray01(),B=x.properties.get("intensity"),j=M.properties.get("color-use-theme")==="none",Z=M.properties.get("color").toRenderColor(j?null:P.getLut(M.scope)).toArray01(),H=M.properties.get("intensity"),J=[z.x,z.y,z.z],Q=i.cN(Z,H),oe=i.cN(F,B);return{u_lighting_ambient_color:Q,u_lighting_directional_dir:J,u_lighting_directional_color:oe,u_ground_radiance:sv(J,oe,Q)}})(h,m,this.style);s.setLightsUniformValues(t,g)}}}uploadCommonUniforms(t,s,h,m,g){if(this.uploadCommonLightUniforms(t,s),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const M=x.getOpacity(this.transform.pitch),P=((z,L,F,B,j,Z,H,J,Q,oe,ue,ce)=>{const ge=z.transform,fe=L.properties.get("color-use-theme")==="none",_e=L.properties.get("color").toRenderColor(fe?null:z.style.getLut(L.scope)).toArray01();_e[3]=B;const pe=z.frameCounter/1e3%1,[we,Ee]=L.properties.get("vertical-range");return{u_fog_matrix:F?ge.calculateFogTileMatrix(F):ce||z.identityMat,u_fog_range:L.getFovAdjustedRange(ge._fov),u_fog_color:_e,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(we,Ee),Ee],u_fog_temporal_offset:pe,u_frustum_tl:j,u_frustum_tr:Z,u_frustum_br:H,u_frustum_bl:J,u_globe_pos:Q,u_globe_radius:oe,u_viewport:ue,u_globe_transition:i.ag(ge.zoom),u_is_globe:+(ge.projection.name==="globe")}})(this,x,h,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*i.q.devicePixelRatio,this.transform.height*i.q.devicePixelRatio],m);s.setFogUniformValues(t,P)}g&&s.setCutoffUniformValues(t,g.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const m of h)s[m.key]=t[m.key]||new pa(m,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,s){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!s||s.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[t.key];return s||(this._cachedTileFogOpacities[t.key]=s=this.style.fog.getOpacityForTile(t)),s[0]>=mt||s[1]>=mt}setupDepthForOcclusion(t,s,h){const m=this.context,g=m.gl,x=!!h;var M;h||(h={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),m.activeTexture.set(g.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),h.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],h.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],h.u_occluder_half_size=.5*this.occlusionParams.occluderSize,h.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE),m.activeTexture.set(g.TEXTURE0),x||s.setTerrainUniformValues(m,h)}}function Zc(d,t){let s=!1,h=null;const m=()=>{h=null,s&&(d(),h=setTimeout(m,t),s=!1)};return()=>(s=!0,h||m(),h)}class Uf{constructor(t){this._hashName=t&&encodeURIComponent(t),i.aQ(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Zc(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const s=Oh(t);if(this._hashName){const h=this._hashName;let m=!1;const g=location.hash.slice(1).split("&").map(x=>{const M=x.split("=")[0];return M===h?(m=!0,`${M}=${s}`):x}).filter(x=>x);return m||g.push(`${h}=${s}`),`#${g.join("&")}`}return`#${s}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(s[3]||0):t.getBearing();return t.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Oh(d,t){const s=d.getCenter(),h=Math.round(100*d.getZoom())/100,m=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,m),x=Math.round(s.lng*g)/g,M=Math.round(s.lat*g)/g,P=d.getBearing(),z=d.getPitch();let L=t?`/${x}/${M}/${h}`:`${h}/${M}/${x}`;return(P||z)&&(L+="/"+Math.round(10*P)/10),z&&(L+=`/${Math.round(z)}`),L}const Xc={linearity:.3,easing:i.dB(0,0,.3,1)},p_=i.l({deceleration:2500,maxSpeed:1400},Xc),m_=i.l({deceleration:20,maxSpeed:1400},Xc),__=i.l({deceleration:1e3,maxSpeed:360},Xc),g_=i.l({deceleration:1e3,maxSpeed:90},Xc);class y_{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:i.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=i.q.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new i.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(s.pan.mag()){const g=Yc(s.pan.mag(),h,i.l({},p_,t||{}));m.offset=s.pan.mult(g.amount/s.pan.mag()),m.center=this._map.transform.center,Kc(m,g)}if(s.zoom){const g=Yc(s.zoom,h,m_);m.zoom=this._map.transform.zoom+g.amount,Kc(m,g)}if(s.bearing){const g=Yc(s.bearing,h,__);m.bearing=this._map.transform.bearing+i.ay(g.amount,-179,179),Kc(m,g)}if(s.pitch){const g=Yc(s.pitch,h,g_);m.pitch=this._map.transform.pitch+g.amount,Kc(m,g)}if(m.zoom||m.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;m.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),m.noMoveStart=!0,m}}function Kc(d,t){(!d.duration||d.duration<t.duration)&&(d.duration=t.duration,d.easing=t.easing)}function Yc(d,t,s){const{maxSpeed:h,linearity:m,deceleration:g}=s,x=i.ay(d*m/(t/1e3),-h,h),M=Math.abs(x)/(g*m);return{easing:s.easing,duration:1e3*M,amount:x*(M/2)}}class cs extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h,m={}){const g=Et(s.getCanvasContainer(),h),x=s.unproject(g);super(t,i.l({point:g,lngLat:x,originalEvent:h},m)),this._defaultPrevented=!1,this.target=s}}class Jc extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s,h){const m=t==="touchend"?h.changedTouches:h.touches,g=pt(s.getCanvasContainer(),m),x=g.map(P=>s.unproject(P)),M=g.reduce((P,z,L,F)=>P.add(z.div(F.length)),new i.P(0,0));super(t,{points:g,point:M,lngLats:x,lngLat:s.unproject(M),originalEvent:h}),this._defaultPrevented=!1}}class v_ extends i.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,s){super("wheel",{originalEvent:s}),this._defaultPrevented=!1}}class x_{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new v_(this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new cs(t.type,this._map,t))}mouseup(t){this._map.fire(new cs(t.type,this._map,t))}preclick(t){const s=i.l({},t);s.type="preclick",this._map.fire(new cs(s.type,this._map,s))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(t),this._map.fire(new cs(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new cs(t.type,this._map,t))}mouseover(t){this._map.fire(new cs(t.type,this._map,t))}mouseout(t){this._map.fire(new cs(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Jc(t.type,this._map,t))}touchmove(t){this._map.fire(new Jc(t.type,this._map,t))}touchend(t){this._map.fire(new Jc(t.type,this._map,t))}touchcancel(t){this._map.fire(new Jc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class b_{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new cs(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new cs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new cs(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fv{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(ut(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const h=s,m=this._startPos,g=this._lastPos;if(!m||!g||g.equals(h)||!this._box&&h.dist(m)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=ye("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const x=Math.min(m.x,h.x),M=Math.max(m.x,h.x),P=Math.min(m.y,h.y),z=Math.max(m.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${P}px)`,this._box.style.width=M-x+"px",this._box.style.height=z-P+"px")})}mouseupWindow(t,s){if(!this._active)return;const h=this._startPos,m=s;if(h&&t.button===0){if(this.reset(),tt(),h.x!==m.x||h.y!==m.y)return this._map.fire(new i.A("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(h,m,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ht(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new i.A(t,{originalEvent:s}))}}function jf(d,t){const s={};for(let h=0;h<d.length;h++)s[d[h].identifier]=t[h];return s}class Vn{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=function(m){const g=new i.P(0,0);for(const x of m)g._add(x);return g.div(m.length)}(s),this.touches=jf(h,s)))}touchmove(t,s,h){if(this.aborted||!this.centroid)return;const m=jf(h,s);for(const g in this.touches){const x=m[g];(!x||x.dist(this.touches[g])>30)&&(this.aborted=!0)}}touchend(t,s,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class kh{constructor(t){this.singleTap=new Vn(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,s,h){this.singleTap.touchstart(t,s,h)}touchmove(t,s,h){this.singleTap.touchmove(t,s,h)}touchend(t,s,h){const m=this.singleTap.touchend(t,s,h);if(m){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(m)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class pv{constructor(){this._zoomIn=new kh({numTouches:1,numTaps:2}),this._zoomOut=new kh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,h){this._zoomIn.touchstart(t,s,h),this._zoomOut.touchstart(t,s,h)}touchmove(t,s,h){this._zoomIn.touchmove(t,s,h),this._zoomOut.touchmove(t,s,h)}touchend(t,s,h){const m=this._zoomIn.touchend(t,s,h),g=this._zoomOut.touchend(t,s,h);return m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(m)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const mv={0:1,2:2},Ul={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Fh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const h=ot(t);this._correctButton(t,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(t,s){const h=this._lastPoint;if(h){if(t.preventDefault(),this._eventButton!=null&&function(m,g){const x=mv[g];return m.buttons===void 0||(m.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(t){this._lastPoint&&ot(t)===this._eventButton&&(this._moved&&tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $f extends Fh{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Qc extends Fh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Ul[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=.8*(s.x-t.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Co extends Fh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Ul[t.pitchRotateKey]:void 0}_correctButton(t,s){return this._pitchRotateKey?s===0&&t[this._pitchRotateKey]:s===0&&t.ctrlKey||s===2}_move(t,s){const h=-.5*(s.y-t.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Bh{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),i.aQ(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new i.P(0,0)}touchstart(t,s,h){return this._calculateTransform(t,s,h)}touchmove(t,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!i.dC())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,s,h)}}touchend(t,s,h){this._calculateTransform(t,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,h){h.length>0&&(this._active=!0);const m=jf(h,s),g=new i.P(0,0),x=new i.P(0,0);let M=0;for(const z in m){const L=m[z],F=this._touches[z];F&&(g._add(L),x._add(L.sub(F)),M++,m[z]=L)}if(this._touches=m,M<this._minTouches||!x.mag())return;const P=x.div(M);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(M),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Jn{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,s,h){return{}}touchstart(t,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,h){const m=this._firstTwoTouches;if(!m)return;t.preventDefault();const[g,x]=m,M=As(h,s,g),P=As(h,s,x);if(!M||!P)return;const z=this._aroundCenter?null:M.add(P).div(2);return this._move([M,P],z,t)}touchend(t,s,h){if(!this._firstTwoTouches)return;const[m,g]=this._firstTwoTouches,x=As(h,s,m),M=As(h,s,g);x&&M||(this._active&&tt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function As(d,t,s){for(let h=0;h<d.length;h++)if(d[h].identifier===s)return t[h]}function Nh(d,t){return Math.log(d/t)/Math.LN2}class Vh extends Jn{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Nh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nh(this._distance,h),pinchAround:s}}}function Gf(d,t){return 180*d.angleWith(t)/Math.PI}class _v extends Jn{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const h=this._vector;if(this._vector=t[0].sub(t[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Gf(this._vector,h),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const m=Gf(t,h);return Math.abs(m)<s}}function il(d){return Math.abs(d.y)>Math.abs(d.x)}class gv extends Jn{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,il(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,h){const m=this._lastPoints;if(!m)return;const g=t[0].sub(m[0]),x=t[1].sub(m[1]);return this._map._cooperativeGestures&&!i.dC()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(g,x,h.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5})}gestureBeginsVertically(t,s,h){if(this._valid!==void 0)return this._valid;const m=t.mag()>=2,g=s.mag()>=2;if(!m&&!g)return;if(!m||!g)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return il(t)&&il(s)&&x}}const yv={panStep:100,bearingStep:15,pitchStep:10};class qf{constructor(){const t=yv;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,h=0,m=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?m=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?m=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,m=0),{cameraAnimation:M=>{const P=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Hf,zoom:s?Math.round(P)+s*(t.shiftKey?2:1):P,bearing:M.getBearing()+h*this._bearingStep,pitch:M.getPitch()+m*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:M.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hf(d){return d*(2-d)}const jl=4.000244140625,$l=1/450;class Zo{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=$l,i.aQ(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||i.dC()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=i.q.now(),m=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%jl==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=s,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(m*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=Et(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>jl?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&L!==0&&(L=1/L);const F=s(),B=Math.pow(2,F),j=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(j*L))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),m=this._startZoom,g=this._easing;let x,M=!1;if(this._type==="wheel"&&m&&g){const z=Math.min((i.q.now()-this._lastWheelEventTime)/200,1),L=g(z);x=i.ah(m,h,L),z<1?this._frameId||(this._frameId=!0):M=!0}else x=h,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let P=x-s();return P*this._lastDelta<0&&(P=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:P,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=i.dD;if(this._prevEase){const h=this._prevEase,m=(i.q.now()-h.start)/h.duration,g=h.easing(m+.01)-h.easing(m),x=.27/Math.sqrt(g*g+1e-4)*.01,M=Math.sqrt(.0729-x*x);s=i.dB(x,M,.25,1)}return this._prevEase={start:i.q.now(),duration:t,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ye("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class no{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ma{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,s){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(t.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sl{constructor(){this._tap=new kh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,s,h){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(t,s,h))}touchmove(t,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const m=s[0],g=m.y-this._swipePoint.y;return this._swipePoint=m,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,h)}touchend(t,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(t,s,h)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ia{constructor(t,s,h){this._el=t,this._mousePan=s,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class vv{constructor(t,s,h){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xv{constructor(t,s,h,m){this._el=t,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Uh=d=>d.zoom||d.drag||d.pitch||d.rotate;class bv extends i.A{}class w_{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,s){const h=i.ad.vec3.sub([],s,t);this.radius=i.ad.vec3.length(h[2]<0?i.ad.vec3.div([],h,this.constants):[h[0],h[1],0])}projectRay(t){i.ad.vec3.div(t,t,this.constants),i.ad.vec3.normalize(t,t),i.ad.vec3.mul(t,t,this.constants);const s=i.ad.vec3.scale([],t,this.radius);if(s[2]>0){const h=i.ad.vec3.scale([],[0,0,1],i.ad.vec3.dot(s,[0,0,1])),m=i.ad.vec3.scale([],i.ad.vec3.normalize([],[s[0],s[1],0]),this.radius),g=i.ad.vec3.add([],s,i.ad.vec3.scale([],i.ad.vec3.sub([],i.ad.vec3.add([],m,h),s),2));s[0]=g[0],s[1]=g[1]}return s}}function Ai(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Wf{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new y_(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new w_,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),i.aQ(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,g,x]of this._listeners){const M=m===document?this.handleWindowEvent:this.handleEvent;m.addEventListener(g,M,x)}}destroy(){for(const[t,s,h]of this._listeners){const m=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(s,m,h)}}_addDefaultHandlers(t){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new x_(s,t));const m=s.boxZoom=new fv(s,t);this._add("boxZoom",m);const g=new pv,x=new Ma;s.doubleClickZoom=new no(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const M=new sl;this._add("tapDragZoom",M);const P=s.touchPitch=new gv(s);this._add("touchPitch",P);const z=new Qc(t),L=new Co(t);s.dragRotate=new vv(t,z,L),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const F=new $f(t),B=new Bh(s,t);s.dragPan=new Ia(h,F,B),this._add("mousePan",F),this._add("touchPan",B,["touchZoom","touchRotate"]);const j=new _v,Z=new Vh;s.touchZoomRotate=new xv(h,Z,j,M),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new b_(s));const H=s.scrollZoom=new Zo(s,this);this._add("scrollZoom",H,["mousePan"]);const J=s.keyboard=new qf;this._add("keyboard",J);for(const Q of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Q]&&s[Q].enable(t[Q])}_add(t,s,h){this._handlers.push({handlerName:t,handler:s,allowed:h}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Uh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,s,h){for(const m in t)if(m!==h&&(!s||s.indexOf(m)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const h of t)this._el.contains(h.target)&&s.push(h);return s}handleEvent(t,s){this._updatingCamera=!0;const h=t.type==="renderFrame",m=h?void 0:t,g={needsRenderFrame:!1},x={},M={},P=t.touches?this._getMapTouches(t.touches):void 0,z=P?pt(this._el,P):h?void 0:Et(this._el,t);for(const{handlerName:B,handler:j,allowed:Z}of this._handlers){if(!j.isEnabled())continue;let H;this._blockedByActive(M,Z,B)?j.reset():j[s||t.type]&&(H=j[s||t.type](t,z,P),this.mergeHandlerResult(g,x,H,B,m),H&&H.needsRenderFrame&&this._triggerRenderFrame()),(H||j.isActive())&&(M[B]=j)}const L={};for(const B in this._previousActiveHandlers)M[B]||(L[B]=m);this._previousActiveHandlers=M,(Object.keys(L).length||Ai(g))&&(this._changes.push([g,x,L]),this._triggerRenderFrame()),(Object.keys(M).length||Ai(g))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:F}=g;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(t,s,h,m,g){if(!h)return;i.l(t,h);const x={handlerName:m,originalEvent:h.originalEvent||g};h.zoomDelta!==void 0&&(s.zoom=x),h.panDelta!==void 0&&(s.drag=x),h.pitchDelta!==void 0&&(s.pitch=x),h.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},h={};for(const[m,g,x]of this._changes)m.panDelta&&(t.panDelta=(t.panDelta||new i.P(0,0))._add(m.panDelta)),m.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(t.around=m.around),m.aroundCoord!==void 0&&(t.aroundCoord=m.aroundCoord),m.pinchAround!==void 0&&(t.pinchAround=m.pinchAround),m.noInertia&&(t.noInertia=m.noInertia),i.l(s,g),i.l(h,x);this._updateMapTransform(t,s,h),this._changes=[]}_updateMapTransform(t,s,h){const m=this._map,g=m.transform,x=oe=>[oe.x,oe.y,oe.z];if((oe=>{const ue=this._eventsInProgress.drag;return ue&&!this._handlersById[ue.handlerName].isActive()})()&&!Ai(t)){const oe=g.zoom;g.cameraElevationReference="sea",this._originalZoom!=null&&g._orthographicProjectionAtLowPitch&&g.projection.name!=="globe"&&g.pitch===0?(g.cameraElevationReference="ground",g.zoom=this._originalZoom):(g.recenterOnTerrain(),g.cameraElevationReference="ground"),oe!==g.zoom&&this._map._update(!0)}if(g._isCameraConstrained&&m._stop(!0),!Ai(t))return void this._fireEvents(s,h,!0);let{panDelta:M,zoomDelta:P,bearingDelta:z,pitchDelta:L,around:F,aroundCoord:B,pinchAround:j}=t;g._isCameraConstrained&&(P>0&&(P=0),g._isCameraConstrained=!1),j!==void 0&&(F=j),(P||(oe=>s[oe]&&!this._eventsInProgress[oe])("drag"))&&F&&(this._dragOrigin=x(g.pointCoordinate3D(F)),this._originalZoom=g.zoom,this._trackingEllipsoid.setup(g._camera.position,this._dragOrigin)),g.cameraElevationReference="sea",m._stop(!0),F=F||m.transform.centerPoint,z&&(g.bearing+=z),L&&(g.pitch+=L),g._updateCameraState();const Z=[0,0,0];if(M)if(g.projection.name==="mercator"){const oe=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(F).dir),ue=this._trackingEllipsoid.projectRay(g.screenPointToMercatorRay(F.sub(M)).dir);Z[0]=ue[0]-oe[0],Z[1]=ue[1]-oe[1]}else{const oe=g.pointCoordinate(F);if(g.projection.name==="globe"){M=M.rotate(-g.angle);const ue=g._pixelsPerMercatorPixel/g.worldSize;Z[0]=-M.x*i.dE(i.aT(oe.y))*ue,Z[1]=-M.y*i.dE(g.center.lat)*ue}else{const ue=g.pointCoordinate(F.sub(M));oe&&ue&&(Z[0]=ue.x-oe.x,Z[1]=ue.y-oe.y)}}const H=g.zoom,J=[0,0,0];if(P){const oe=x(B||g.pointCoordinate3D(F)),ue={dir:i.ad.vec3.normalize([],i.ad.vec3.sub([],oe,g._camera.position))};if(ue.dir[2]<0){const ce=g.zoomDeltaToMovement(oe,P);i.ad.vec3.scale(J,ue.dir,ce)}}const Q=i.ad.vec3.add(Z,Z,J);g._translateCameraConstrained(Q),P&&Math.abs(g.zoom-H)>1e-4&&g.recenterOnTerrain(),g.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,h,!0)}_fireEvents(t,s,h){const m=Uh(this._eventsInProgress),g=Uh(t),x={};for(const L in t){const{originalEvent:F}=t[L];this._eventsInProgress[L]||(x[`${L}start`]=F),this._eventsInProgress[L]=t[L]}!m&&g&&this._fireEvent("movestart",g.originalEvent);for(const L in x)this._fireEvent(L,x[L]);g&&this._fireEvent("move",g.originalEvent);for(const L in t){const{originalEvent:F}=t[L];this._fireEvent(L,F)}const M={};let P;for(const L in this._eventsInProgress){const{handlerName:F,originalEvent:B}=this._eventsInProgress[L];this._handlersById[F].isActive()||(delete this._eventsInProgress[L],P=s[F]||B,M[`${L}end`]=P)}for(const L in M)this._fireEvent(L,M[L]);const z=Uh(this._eventsInProgress);if(h&&(m||g)&&!z){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=B=>B!==0&&-this._bearingSnap<B&&B<this._bearingSnap;L?(F(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:P})):(this._map.fire(new i.A("moveend",{originalEvent:P})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new i.A(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new bv("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Zf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class wv extends i.E{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,i.aQ(["_renderFrameCallback"],this)}getCenter(){return new i.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,h){return t=i.P.convert(t).mult(-1),this.panTo(this.transform.center,i.l({offset:t},s),h)}panTo(t,s,h){return this.easeTo(i.l({center:t},s),h)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,h){return this.easeTo(i.l({zoom:t},s),h)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,h){return this.easeTo(i.l({bearing:t},s),h)}resetNorth(t,s){return this.rotateTo(0,i.l({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(i.l({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=i.aB.convert(t);const h=s&&s.bearing||0,m=s&&s.pitch||0,g=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,g,x,h,m,s)}_extendPadding(t){const s={top:0,right:0,bottom:0,left:0};return t==null?i.l({},s,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:i.l({},s,t)}_extendCameraOptions(t){return(t=i.l({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,s){const h=s.max[0]-s.min[0],m=s.max[1]-s.min[1];return h/m>t.aspect?h/(2*Math.tan(.5*t.fovX)*t.aspect):m/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,s,h,m,g,x){const M=t.clone(),P=this._extendCameraOptions(x);M.bearing=m,M.pitch=g;const z=i.bO.convert(s),L=i.bO.convert(h),F=.5*(z.lat+L.lat),B=.5*(z.lng+L.lng),j=i.dF(F,B),Z=i.ad.vec3.normalize([],j),H=i.ad.vec3.normalize([],i.ad.vec3.cross([],Z,[0,1,0])),J=i.ad.vec3.cross([],H,Z),Q=[H[0],H[1],H[2],0,J[0],J[1],J[2],0,Z[0],Z[1],Z[2],0,0,0,0,1],oe=[j,i.dF(z.lat,z.lng),i.dF(L.lat,z.lng),i.dF(L.lat,L.lng),i.dF(z.lat,L.lng),i.dF(F,z.lng),i.dF(F,L.lng),i.dF(z.lat,B),i.dF(L.lat,B)];let ue=i.ce.fromPoints(oe.map(Ze=>[i.ad.vec3.dot(H,Ze),i.ad.vec3.dot(J,Ze),i.ad.vec3.dot(Z,Ze)]));const ce=i.ad.vec3.transformMat4([],ue.center,Q);i.ad.vec3.squaredLength(ce)===0&&i.ad.vec3.set(ce,0,0,1),i.ad.vec3.normalize(ce,ce),i.ad.vec3.scale(ce,ce,i.az),M.center=i.dG(ce);const ge=M.getWorldToCameraMatrix(),fe=i.ad.mat4.invert(new Float64Array(16),ge);ue=i.ce.applyTransform(ue,i.ad.mat4.multiply([],ge,Q));const _e=this._extendAABB(ue,M,P,m);if(!_e)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=_e,i.ad.vec3.transformMat4(ce,ce,ge);const pe=.5*(ue.max[2]-ue.min[2]),we=this._minimumAABBFrustumDistance(M,ue),Ee=i.ad.vec3.scale([],[0,0,1],pe),qe=i.ad.vec3.add(Ee,ce,Ee),Be=we+(M.pitch===0?0:i.ad.vec3.distance(ce,qe)),et=M.globeCenterInViewSpace,rt=i.ad.vec3.sub([],ce,[et[0],et[1],et[2]]);i.ad.vec3.normalize(rt,rt),i.ad.vec3.scale(rt,rt,Be);const _t=i.ad.vec3.add([],ce,rt);i.ad.vec3.transformMat4(_t,_t,fe);const Oe=i.dv/i.az,Qe=i.ad.vec3.length(_t),De=i.bH(Math.max(Qe*Oe-i.dv,Number.EPSILON),0),Je=Math.min(M.zoomFromMercatorZAdjusted(De),P.maxZoom);return Je>.5*(i.c6+i.bY)?(M.setProjection({name:"mercator"}),M.zoom=Je,this._cameraForBounds(M,s,h,m,g,x)):{center:M.center,zoom:Je,bearing:m,pitch:g}}_extendAABB(t,s,h,m){const g=.5*((h.padding.left||0)+(h.padding.right||0)),x=.5*((h.padding.top||0)+(h.padding.bottom||0)),M=x,P=g,z=g,L=x,F=s.width-(P+z),B=s.height-(M+L),j=i.ad.vec3.sub([],t.max,t.min),Z=Math.min(F/j[0],B/j[1]),H=Math.min(s.scaleZoom(s.scale*Z),h.maxZoom);if(isNaN(H))return null;const J=s.scale/s.zoomScale(H),Q=new i.ce([t.min[0]-P*J,t.min[1]-L*J,t.min[2]],[t.max[0]+z*J,t.max[1]+M*J,t.max[2]]),oe=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new i.P(h.offset.x,h.offset.y):i.P.convert(h.offset)).rotate(-i.ak(m));return Q.center[0]-=oe.x*J,Q.center[1]+=oe.y*J,Q}queryTerrainElevation(t,s){const h=this.transform.elevation;return h?(s=i.l({},{exaggerated:!0},s),h.getAtPoint(i.ac.fromLngLat(t),null,s.exaggerated)):null}_cameraForBounds(t,s,h,m,g,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,s,h,m,g,x);const M=t.clone(),P=this._extendCameraOptions(x);M.bearing=m,M.pitch=g;const z=i.bO.convert(s),L=i.bO.convert(h),F=new i.bO(z.lng,L.lat),B=new i.bO(L.lng,z.lat),j=M.project(z),Z=M.project(L),H=this.queryTerrainElevation(z),J=this.queryTerrainElevation(L),Q=this.queryTerrainElevation(F),oe=this.queryTerrainElevation(B),ue=[[j.x,j.y,Math.min(H||0,J||0,Q||0,oe||0)],[Z.x,Z.y,Math.max(H||0,J||0,Q||0,oe||0)]];let ce=i.ce.fromPoints(ue);const ge=M.getWorldToCameraMatrix(),fe=i.ad.mat4.invert(new Float64Array(16),ge);ce=i.ce.applyTransform(ce,ge);const _e=this._extendAABB(ce,M,P,m);if(!_e)return void i.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=_e;const pe=.5*i.ad.vec3.sub([],ce.max,ce.min)[2],we=this._minimumAABBFrustumDistance(M,ce),Ee=[0,0,1,0];i.ad.vec4.transformMat4(Ee,Ee,ge),i.ad.vec4.normalize(Ee,Ee);const qe=i.ad.vec3.scale([],Ee,we+pe),Be=i.ad.vec3.add([],ce.center,qe);i.ad.vec3.transformMat4(ce.center,ce.center,fe),i.ad.vec3.transformMat4(Be,Be,fe);const et=M.unproject(new i.P(ce.center[0],ce.center[1])),rt=i.dH(M.projection,et),_t=Math.pow(2,rt),Oe=Math.min(M._zoomFromMercatorZ(Be[2]*M.pixelsPerMeter*_t/M.worldSize),P.maxZoom);return M.mercatorFromTransition&&Oe<.5*(i.c6+i.bY)?(M.setProjection({name:"globe"}),M.zoom=Oe,this._cameraForBounds(M,s,h,m,g,x)):{center:et,zoom:Oe,bearing:m,pitch:g}}fitBounds(t,s,h){const m=this.cameraForBounds(t,s);return this._fitInternal(m,s,h)}fitScreenCoordinates(t,s,h,m,g){const x=i.P.convert(t),M=i.P.convert(s),P=new i.P(Math.min(x.x,M.x),Math.min(x.y,M.y)),z=new i.P(Math.max(x.x,M.x),Math.max(x.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,M))return this;const L=this.transform.pointLocation3D(P),F=this.transform.pointLocation3D(z),B=this.transform.pointLocation3D(new i.P(P.x,z.y)),j=this.transform.pointLocation3D(new i.P(z.x,P.y)),Z=[Math.min(L.lng,F.lng,B.lng,j.lng),Math.min(L.lat,F.lat,B.lat,j.lat)],H=[Math.max(L.lng,F.lng,B.lng,j.lng),Math.max(L.lat,F.lat,B.lat,j.lat)],J=m&&m.pitch?m.pitch:this.getPitch(),Q=this._cameraForBounds(this.transform,Z,H,h,J,m);return this._fitInternal(Q,m,g)}_fitInternal(t,s,h){return t?(s=i.l(t,s)).linear?this.easeTo(s,h):this.flyTo(s,h):this}jumpTo(t,s){this.stop();const h=t.preloadOnly?this.transform.clone():this.transform;let m=!1,g=!1,x=!1;"zoom"in t&&h.zoom!==+t.zoom&&(m=!0,h.zoom=+t.zoom),t.center!==void 0&&(h.center=i.bO.convert(t.center)),"bearing"in t&&h.bearing!==+t.bearing&&(g=!0,h.bearing=+t.bearing),"pitch"in t&&h.pitch!==+t.pitch&&(x=!0,h.pitch=+t.pitch);const M=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!h.isPaddingEqual(M))if(t.retainPadding===!1){const P=h.clone();P.padding=M,h.setLocationAtPoint(h.center,P.centerPoint)}else h.padding=M;return t.preloadOnly?(this._preloadTiles(h),this):(this.fire(new i.A("movestart",s)).fire(new i.A("move",s)),m&&this.fire(new i.A("zoomstart",s)).fire(new i.A("zoom",s)).fire(new i.A("zoomend",s)),g&&this.fire(new i.A("rotatestart",s)).fire(new i.A("rotate",s)).fire(new i.A("rotateend",s)),x&&this.fire(new i.A("pitchstart",s)).fire(new i.A("pitch",s)).fire(new i.A("pitchend",s)),this.fire(new i.A("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||i.w(Zf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return i.w(Zf),this;this.stop();const m=h.zoom,g=h.pitch,x=h.bearing;h.setFreeCameraOptions(t);const M=m!==h.zoom,P=g!==h.pitch,z=x!==h.bearing;return this.fire(new i.A("movestart",s)).fire(new i.A("move",s)),M&&this.fire(new i.A("zoomstart",s)).fire(new i.A("zoom",s)).fire(new i.A("zoomend",s)),z&&this.fire(new i.A("rotatestart",s)).fire(new i.A("rotate",s)).fire(new i.A("rotateend",s)),P&&this.fire(new i.A("pitchstart",s)).fire(new i.A("pitch",s)).fire(new i.A("pitchend",s)),this.fire(new i.A("moveend",s)),this}easeTo(t,s){this._stop(!1,t.easeId),((t=i.l({offset:[0,0],duration:500,easing:i.dD},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const h=this.transform,m=this.getZoom(),g=this.getBearing(),x=this.getPitch(),M=this.getPadding(),P="zoom"in t?+t.zoom:m,z="bearing"in t?this._normalizeBearing(t.bearing,g):g,L="pitch"in t?+t.pitch:x,F=this._extendPadding(t.padding),B=i.P.convert(t.offset);let j,Z,H;if(h.projection.name==="globe"){const Ee=i.ac.fromLngLat(h.center),qe=B.rotate(-h.angle);Ee.x+=qe.x/h.worldSize,Ee.y+=qe.y/h.worldSize;const Be=Ee.toLngLat(),et=i.bO.convert(t.center||Be);this._normalizeCenter(et),j=h.centerPoint.add(qe),Z=new i.P(Ee.x,Ee.y).mult(h.worldSize),H=new i.P(i.av(et.lng),i.aC(et.lat)).mult(h.worldSize).sub(Z)}else{j=h.centerPoint.add(B);const Ee=h.pointLocation(j),qe=i.bO.convert(t.center||Ee);this._normalizeCenter(qe),Z=h.project(Ee),H=h.project(qe).sub(Z)}const J=h.zoomScale(P-m);let Q,oe;t.around&&(Q=i.bO.convert(t.around),oe=h.locationPoint(Q));const ue=this._zooming||P!==m,ce=this._rotating||g!==z,ge=this._pitching||L!==x,fe=!h.isPaddingEqual(F),_e=t.retainPadding===!1?h.clone():h,pe=Ee=>qe=>{if(ue&&(Ee.zoom=i.ah(m,P,qe)),ce&&(Ee.bearing=i.ah(g,z,qe)),ge&&(Ee.pitch=i.ah(x,L,qe)),fe&&(_e.interpolatePadding(M,F,qe),j=_e.centerPoint.add(B)),Q)Ee.setLocationAtPoint(Q,oe);else{const Be=Ee.zoomScale(Ee.zoom-m),et=P>m?Math.min(2,J):Math.max(.5,J),rt=Math.pow(et,1-qe),_t=Ee.unproject(Z.add(H.mult(qe*rt)).mult(Be));Ee.setLocationAtPoint(Ee.renderWorldCopies?_t.wrap():_t,j)}return t.preloadOnly||this._fireMoveEvents(s),Ee};if(t.preloadOnly){const Ee=this._emulate(pe,t.duration,h);return this._preloadTiles(Ee),this}const we={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ue,this._rotating=ce,this._pitching=ge,this._padding=fe,this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,we),this._ease(pe(h),Ee=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(s,Ee)},t),this}_prepareEase(t,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||h.moving||this.fire(new i.A("movestart",t)),this._zooming&&!h.zooming&&this.fire(new i.A("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new i.A("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new i.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new i.A("move",t)),this._zooming&&this.fire(new i.A("zoom",t)),this._rotating&&this.fire(new i.A("rotate",t)),this._pitching&&this.fire(new i.A("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,m=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,h&&this.fire(new i.A("zoomend",t)),m&&this.fire(new i.A("rotateend",t)),g&&this.fire(new i.A("pitchend",t)),this.fire(new i.A("moveend",t))}flyTo(t,s){if(this._prefersReducedMotion(t)){const Ze=i.aA(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ze,s)}this.stop(),t=i.l({offset:[0,0],speed:1.2,curve:1.42,easing:i.dD},t);const h=this.transform,m=this.getZoom(),g=this.getBearing(),x=this.getPitch(),M=this.getPadding(),P="zoom"in t?i.ay(+t.zoom,h.minZoom,h.maxZoom):m,z="bearing"in t?this._normalizeBearing(t.bearing,g):g,L="pitch"in t?+t.pitch:x,F=this._extendPadding(t.padding),B=h.zoomScale(P-m),j=i.P.convert(t.offset);let Z=h.centerPoint.add(j);const H=h.pointLocation(Z),J=i.bO.convert(t.center||H);this._normalizeCenter(J);const Q=h.project(H),oe=h.project(J).sub(Q);let ue=t.curve;const ce=Math.max(h.width,h.height),ge=ce/B,fe=oe.mag();if("minZoom"in t){const Ze=i.ay(Math.min(t.minZoom,m,P),h.minZoom,h.maxZoom),st=ce/h.zoomScale(Ze-m);ue=Math.sqrt(st/fe*2)}const _e=ue*ue;function pe(Ze){const st=(ge*ge-ce*ce+(Ze?-1:1)*_e*_e*fe*fe)/(2*(Ze?ge:ce)*_e*fe);return Math.log(Math.sqrt(st*st+1)-st)}function we(Ze){return(Math.exp(Ze)-Math.exp(-Ze))/2}function Ee(Ze){return(Math.exp(Ze)+Math.exp(-Ze))/2}const qe=pe(0);let Be=function(Ze){return Ee(qe)/Ee(qe+ue*Ze)},et=function(Ze){return ce*((Ee(qe)*(we(st=qe+ue*Ze)/Ee(st))-we(qe))/_e)/fe;var st},rt=(pe(1)-qe)/ue;if(Math.abs(fe)<1e-6||!isFinite(rt)){if(Math.abs(ce-ge)<1e-6)return this.easeTo(t,s);const Ze=ge<ce?-1:1;rt=Math.abs(Math.log(ge/ce))/ue,et=function(){return 0},Be=function(st){return Math.exp(Ze*ue*st)}}t.duration="duration"in t?+t.duration:1e3*rt/("screenSpeed"in t?+t.screenSpeed/ue:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const _t=g!==z,Oe=L!==x,Qe=!h.isPaddingEqual(F),De=t.retainPadding===!1?h.clone():h,Je=Ze=>st=>{const $e=st*rt,lt=1/Be($e);Ze.zoom=st===1?P:m+Ze.scaleZoom(lt),_t&&(Ze.bearing=i.ah(g,z,st)),Oe&&(Ze.pitch=i.ah(x,L,st)),Qe&&(De.interpolatePadding(M,F,st),Z=De.centerPoint.add(j));const wt=st===1?J:Ze.unproject(Q.add(oe.mult(et($e))).mult(lt));return Ze.setLocationAtPoint(Ze.renderWorldCopies?wt.wrap():wt,Z),Ze._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(s),Ze};if(t.preloadOnly){const Ze=this._emulate(Je,t.duration,h);return this._preloadTiles(Ze),this}return this._zooming=!0,this._rotating=_t,this._pitching=Oe,this._padding=Qe,this._prepareEase(s,!1),this._ease(Je(h),()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!t){const h=this.handlers;h&&h.stop(!1)}return this}_ease(t,s,h){h.animate===!1||h.duration===0?(t(1),s()):(this._easeStart=i.q.now(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((i.q.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=i.bF(t,-180,180);const h=Math.abs(t-s);return Math.abs(t-360-s)<h&&(t-=360),Math.abs(t+360-s)<h&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const h=t.lng-s.center.lng;t.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&i.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,s,h){const m=Math.ceil(15*s/1e3),g=[],x=t(h.clone());for(let M=0;M<=m;M++){const P=x(M/m);g.push(P.clone())}return g}_preloadTiles(t,s){}}class ol{constructor(t={}){this.options=t,i.aQ(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const s=this.options&&this.options.compact,h=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ye("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",h);const m=ye("span","mapboxgl-ctrl-icon",this._compactButton);return m.setAttribute("aria-hidden","true"),m.setAttribute("title",h),this._innerContainer=ye("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||i.e.ACCESS_TOKEN}];if(t){const h=s.reduce((m,g,x)=>(g.value&&(m+=`${g.key}=${g.value}${x<s.length-1?"&":""}`),m),"?");t.href=`${i.e.FEEDBACK_URL}/${h}#${Oh(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const s=this._map.style._mergedSourceCaches;for(const m in s){const g=s[m];if(g.used){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((m,g)=>m.length-g.length),t=t.filter((m,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(m)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xf{constructor(){i.aQ(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=ye("div","mapboxgl-ctrl");const s=ye("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const s in t){const h=t[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Ms{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const m of h)if(m.id===t)return void(m.cancelled=!0)}run(t=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class $s{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const s=i.cC((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,s,h){this._start=this.getValue(s),this._end=t,this._startTime=s,this._endTime=s+h}}const Gl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ca extends i.A{constructor(t,s,h,m){const{point:g,lngLat:x,originalEvent:M,target:P}=t;super(t.type,{point:g,lngLat:x,originalEvent:M,target:P}),this.preventDefault=()=>{t.preventDefault()},this.id=s,this.interaction=h,this.feature=m}}class ql{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,s){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const h=s.filter;let m=s.type;h&&this.filters.set(t,i.a_(h)),m==="mouseover"&&(m="mouseenter"),m==="mouseout"&&(m="mouseleave");const g=this.interactionsByType.get(m)||new Map;m==="mouseenter"||m==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,s)):g.size===0&&this.map.on(m,this.handleType),g.size===0&&this.interactionsByType.set(m,g),g.set(t,s),this.typeById.set(t,m)}get(t){const s=this.typeById.get(t);if(!s)return;const h=this.interactionsByType.get(s);return h?h.get(t):void 0}remove(t){const s=this.typeById.get(t);if(!s)return;this.typeById.delete(t),this.filters.delete(t);const h=this.interactionsByType.get(s);h&&(h.delete(t),s==="mouseenter"||s==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):h.size===0&&this.map.off(s,this.handleType))}queryTargets(t,s){const h=[];for(const[m,g]of s)g.target&&h.push({targetId:m,target:g.target,filter:this.filters.get(m)});return this.map.style.queryRenderedTargets(t,h,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const s=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());s.length&&(t.type="mouseenter",this.handleType(t,s));const h=new Map;for(const[m,{feature:g}]of this.prevHoveredFeatures)this.hoveredFeatures.has(m)||h.set(g.id,g);h.size&&(t.type="mouseleave",this.handleType(t,Array.from(h.values())))}handleOut(t){const s=Array.from(this.hoveredFeatures.values()).map(({feature:h})=>h);s.length&&(t.type="mouseleave",this.handleType(t,s)),this.hoveredFeatures.clear()}handleType(t,s){const h=Array.from(this.interactionsByType.get(t.type)).reverse(),m=!!s;s=s||this.queryTargets(t.point,h);const g=t.type==="mouseenter";let x=!1;const M=new Set;for(const P of s){for(const[z,L]of h){if(!L.target)continue;const F=P.variants?P.variants[z]:null;if(F){for(const B of F){if(Ac(B,P,M,z))continue;const j=new i.cx(P,B),Z=Od(B,P,z);m&&(j.state=this.map.getFeatureState(j));const H=g?this.prevHoveredFeatures.get(Z):null,J=new Ca(t,z,L,j),Q=H?H.stop:L.handler(J);if(g&&this.hoveredFeatures.set(Z,{feature:P,stop:Q}),Q!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(const[P,z]of h){const{handler:L,target:F}=z;if(!F&&L(new Ca(t,P,z,null))!==!1)break}}}function Kf(d,t){if(Array.isArray(d)&&Array.isArray(t)){const s=new Set(d),h=new Set(t);return s.size===h.size&&d.every(m=>h.has(m))}return i.bn(d,t)}const Xr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Pa={showCompass:!0,showZoom:!0,visualizePitch:!1};class Tv{constructor(t,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Qc({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,h&&(this.mousePitch=new Co({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),i.aQ(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),ut()}move(t,s){const h=this.map,m=this.mouseRotate.mousemoveWindow(t,s),g=m&&m.bearingDelta;if(g&&h.setBearing(h.getBearing()+g),this.mousePitch){const x=this.mousePitch.mousemoveWindow(t,s),M=x&&x.pitchDelta;M&&h.setPitch(h.getPitch()+M)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ht(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(i.l({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Et(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Et(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=pt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=pt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function T_(d,t,s){if(d=new i.bO(d.lng,d.lat),t){const h=new i.bO(d.lng-360,d.lat),m=new i.bO(d.lng+360,d.lat),g=360*Math.ceil(Math.abs(d.lng-s.center.lng)/360),x=s.locationPoint3D(d).distSqr(t),M=t.x<0||t.y<0||t.x>s.width||t.y>s.height;s.locationPoint3D(h).distSqr(t)<x&&(M||Math.abs(h.lng-s.center.lng)<g)?d=h:s.locationPoint3D(m).distSqr(t)<x&&(M||Math.abs(m.lng-s.center.lng)<g)&&(d=m)}for(;Math.abs(d.lng-s.center.lng)>180;){const h=s.locationPoint3D(d);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;d.lng>s.center.lng?d.lng-=360:d.lng+=360}return d}const eu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Is={anchor:"center",color:"#3FB1CE",scale:1,draggable:!1,clickTolerance:0,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class io extends i.E{constructor(t,s){super(),(t instanceof HTMLElement||s)&&(t=i.l({element:t},s)),i.aQ(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),t=i.l({},Is,t),this._anchor=t.anchor,this._color=t.color,this._scale=t.scale,this._draggable=t.draggable,this._clickTolerance=t.clickTolerance,this._rotation=t.rotation,this._rotationAlignment=t.rotationAlignment,this._pitchAlignment=t.pitchAlignment,this._occludedOpacity=t.occludedOpacity,this._altitude=t.altitude,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=i.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=i.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",g=>{g.preventDefault()}),this._element.addEventListener("mousedown",g=>{g.preventDefault()});const h=this._element.classList;for(const g in eu)h.remove(`mapboxgl-marker-anchor-${g}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`);const m=t&&t.className?t.className.trim().split(/\s+/):[];h.add(...m),this._popup=null}_createDefaultMarker(){const t=ye("div"),s=Le("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const h=Le("radialGradient",{id:"shadowGradient"},Le("defs",{},s));Le("stop",{offset:"10%","stop-opacity":.4},h),Le("stop",{offset:"100%","stop-opacity":.05},h),Le("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},s)}return Le("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},s),Le("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},s),Le("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},s),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=i.bO.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Is.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const s=t.code,h=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,s=this._pos;if(!t||!s)return!1;const h=t.unproject(s,this._altitude),m=t.getFreeCameraOptions();if(!m.position)return!1;const g=m.position.toLngLat();return g.distanceTo(h)<.9*g.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const s=this._pos;if(!s||s.x<0||s.x>t.transform.width||s.y<0||s.y>t.transform.height)return void this._clearFadeTimer();const h=t.unproject(s,this._altitude);let m;t._showingGlobe()&&i.dK(t.transform,this._lngLat)?m=0:(m=1-t._queryFogOpacity(h),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(m*=this._occludedOpacity)),this._element.style.opacity=`${m}`,this._element.style.pointerEvents=m>0?"auto":"none",this._popup&&this._popup._setOpacity(m),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${eu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${s.x}px,${s.y}px)
        `}_calculateXYTransform(){const t=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!t||h!=="map")return"";if(!s._showingGlobe()){const P=s.getPitch();return P?`rotateX(${P}deg)`:""}const m=i.c4(i.dL(s.transform,this._lngLat)),g=t.sub(i.dM(s.transform)),x=Math.abs(g.x)+Math.abs(g.y);if(x===0)return"";const M=m/x;return`rotateX(${-g.y*M}deg) rotateY(${g.x*M}deg)`}_calculateZTransform(){const t=this._pos,s=this._map;if(!s||!t)return"";let h=0;const m=this.getRotationAlignment();if(m==="map")if(s._showingGlobe()){const g=s.project(new i.bO(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=s.project(new i.bO(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(g);h=i.c4(Math.atan2(x.y,x.x))-90}else h=-s.getBearing();else if(m==="horizon"){const g=i.ae(4,6,s.getZoom()),x=i.dM(s.transform);x.y+=g*s.transform.height;const M=t.sub(x),P=i.c4(Math.atan2(M.y,M.x));h=(P>90?P-270:P+90)*(1-g)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=T_(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=i.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const s=this._map;if(!s)return;const h=this._pointerdownPos,m=this._positionDelta;if(h&&m){if(!this._isDragging){const g=this._clickTolerance||s._clickTolerance;if(t.point.dist(h)<g)return;this._isDragging=!0}this._pos=t.point.sub(m),this._lngLat=s.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new i.A("dragstart"))),this.fire(new i.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new i.A("dragend")),this._state="inactive"}_addDragHandler(t){const s=this._map,h=this._pos;s&&h&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(h),this._pointerdownPos=t.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const s=this._map;return s&&(t?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Is.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Is.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Is.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Is.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Wi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},us={maxWidth:100,unit:"metric"},Mi={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Yf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ji=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Jf(d=new i.P(0,0),t="bottom"){if(typeof d=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(t){case"top":return new i.P(0,d);case"top-left":return new i.P(s,s);case"top-right":return new i.P(-s,s);case"bottom":return new i.P(0,-d);case"bottom-left":return new i.P(s,-s);case"bottom-right":return new i.P(-s,-s);case"left":return new i.P(d,0);case"right":return new i.P(-d,0)}return new i.P(0,0)}return d instanceof i.P||Array.isArray(d)?i.P.convert(d):i.P.convert(d[t]||[0,0])}return{version:G,supported:he.supported,setRTLTextPlugin:i.dN,getRTLTextPluginStatus:i.dO,Map:class extends wv{constructor(d){q.mark(X.create);const t=d;if((d=i.l({},Xr,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&i.dI(window)&&(d.antialias=!1,i.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ct(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies,null,null),d),this._repaint=!!d.repaint,this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Ms,this._domRenderTaskQueue=new Ms,this._controls=[],this._markers=[],this._popups=[],this._mapId=i.aW(),this._locale=i.l({},Gl,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._tessellationStep=d.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=d.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new $s(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=d.scaleFactor,this._requestManager=new zr(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,this._contextCreateOptions=d.contextCreateOptions?Object.assign({},d.contextCreateOptions):{},typeof d.container=="string"){const s=document.getElementById(d.container);if(!s)throw new Error(`Container '${d.container.toString()}' not found.`);this._container=s}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&i.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),this._spriteFormat=d.spriteFormat,i.aQ(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Sa),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Wf(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,(d.style||!d.testMode)&&this.setStyle(d.style||i.e.DEFAULT_STYLE,{config:d.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this.indoor=new Zy(this),d.hash&&(this._hash=new Uf(typeof d.hash=="string"&&d.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch});const s=d.bounds;s&&(this.resize(),this.fitBounds(s,i.l({},d.fitBoundsOptions,{duration:0})))}this.resize(),d.attributionControl&&this.addControl(new ol({customAttribution:d.customAttribution})),this._logoControl=new Xf,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new i.A(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new i.A(`${s.dataType}dataloading`,s))}),this._interactions=new ql(this)}_getMapId(){return this._mapId}addControl(d,t){if(t===void 0&&(t=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new i.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=d.onAdd(this);this._controls.push(d);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new i.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(d);return t>-1&&this._controls.splice(t,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new i.A("movestart",d)).fire(new i.A("move",d)),this.fire(new i.A("resize",d)),t&&this.fire(new i.A("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(i.aB.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new i.A("zoomstart")).fire(new i.A("zoom")).fire(new i.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new i.A("pitchstart")).fire(new i.A("pitch")).fire(new i.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(d){return this._scaleFactor=d,this.painter.scaleFactor=d,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(t=>t==="auto"?navigator.language:t):d}setLanguage(d){const t=this._parseLanguage(d);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,t=d.projection.name;let s;t==="globe"&&d.zoom>=i.bY?(d.setMercatorFromTransition(),s=!0):t==="mercator"&&d.zoom<i.bY&&(d.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,t){return this._updateProjection(d||t||{name:"mercator"})}_updateProjection(d){let t;return t=d.name==="globe"&&this.transform.zoom>=i.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(d,t){return this.transform.locationPoint3D(i.bO.convert(d),t)}unproject(d,t){return this.transform.pointLocation3D(i.P.convert(d),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,t,s){const h=m=>{let g=[];if(Array.isArray(t)){const x=t.filter(M=>this.getLayer(M));g=x.length?this.queryRenderedFeatures(m,{layers:x}):[]}else g=this.queryRenderedFeatures(m,{target:t});return g};if(d==="mouseenter"||d==="mouseover"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:x=>{const M=h(x.point);M.length?m||(m=!0,s.call(this,new cs(d,this,x.originalEvent,{features:M}))):m=!1},mouseout:()=>{m=!1}}}}if(d==="mouseleave"||d==="mouseout"){let m=!1;return{listener:s,targets:t,delegates:{mousemove:M=>{h(M.point).length?m=!0:m&&(m=!1,s.call(this,new cs(d,this,M.originalEvent)))},mouseout:M=>{m&&(m=!1,s.call(this,new cs(d,this,M.originalEvent)))}}}}{const m=g=>{const x=h(g.point);x.length&&(g.features=x,s.call(this,g),delete g.features)};return{listener:s,targets:t,delegates:{[d]:m}}}}on(d,t,s){if(typeof t=="function"||s===void 0)return super.on(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(d,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(h);for(const m in h.delegates)this.on(m,h.delegates[m]);return this}once(d,t,s){if(typeof t=="function"||s===void 0)return super.once(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._createDelegatedListener(d,t,s);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(d,t,s){if(typeof t=="function"||s===void 0)return super.off(d,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const h=this._delegatedListeners?this._delegatedListeners[d]:void 0;return h&&(m=>{for(let g=0;g<m.length;g++){const x=m[g];if(x.listener===s&&Kf(x.targets,t)){for(const M in x.delegates)this.off(M,x.delegates[M]);return m.splice(g,1),this}}})(h),this}queryRenderedFeatures(d,t){if(!this.style)return[];if(d===void 0||d instanceof i.P||Array.isArray(d)||t!==void 0||(t=d,d=void 0),d=d||[[0,0],[this.transform.width,this.transform.height]],!t){const g=this.style.queryRenderedFeatures(d,void 0,this.transform),x=this.style.queryRenderedFeatureset(d,void 0,this.transform);return g.concat(x)}let s=!0;if(t.target&&(s=this._isTargetValid(t.target),s&&!t.layers))return this.style.queryRenderedFeatureset(d,t,this.transform);let h=!0;if(t.layers&&Array.isArray(t.layers)){for(const g of t.layers)if(!this._isValidId(g)){h=!1;break}if(h&&!t.target)return this.style.queryRenderedFeatures(d,t,this.transform)}let m=[];return h&&(m=m.concat(this.style.queryRenderedFeatures(d,t,this.transform))),s&&(m=m.concat(this.style.queryRenderedFeatureset(d,t,this.transform))),m}querySourceFeatures(d,t){return!d||typeof d=="string"&&!this._isValidId(d)?[]:this.style.querySourceFeatures(d,t)}isPointOnSurface(d){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&i.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(i.P.convert(d))}addInteraction(d,t){return this._interactions.add(d,t),this}removeInteraction(d){return this._interactions.remove(d),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this}setStyle(d,t){return t=i.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&d&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(d,(s,h)=>{s?(i.w(`Unable to perform style diff: ${String(s.message||s.error||s)}. Rebuilding the style from scratch.`),this._updateStyle(d,t)):h&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(d,t))}_getUIString(d){const t=this._locale[d];if(t==null)throw new Error(`Missing UI string '${d}'`);return t}_updateStyle(d,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d){const s=i.l({},t);t&&t.config&&(s.initialConfig=t.config,delete s.config),this.style=new os(this,s).load(d),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new os(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(i.w("There is no style added to the map."),!1)}_isValidId(d){return d==null?(this.fire(new i.z(new Error("IDs can't be empty."))),!1):!i.cs(d)||(this.fire(new i.z(new Error(`IDs can't contain special symbols: "${d}".`))),!1)}_isTargetValid(d){return"featuresetId"in d?this._isValidId("importId"in d?d.importId:d.featuresetId):"layerId"in d&&this._isValidId(d.layerId)}_areTargetsValid(d){if(Array.isArray(d)){for(const t of d)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(d)}addSource(d,t){return this._isValidId(d)?(this._lazyInitEmptyStyle(),this.style.addSource(d,t),this._update(!0)):this}isSourceLoaded(d){return!!this._isValidId(d)&&!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(d,t,s){this._lazyInitEmptyStyle(),this.style.addSourceType(d,t,s)}removeSource(d){return this._isValidId(d)?(this.style.removeSource(d),this._updateTerrain(),this._update(!0)):this}getSource(d){return this._isValidId(d)?this.style.getOwnSource(d):null}addImage(d,t,{pixelRatio:s=1,sdf:h=!1,stretchX:m,stretchY:g,content:x}={}){this._lazyInitEmptyStyle();const M=i.I.from(d);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:P,height:z,data:L}=i.q.getImageData(t);this.style.addImage(M,{data:new i.r({width:P,height:z},L),pixelRatio:s,stretchX:m,stretchY:g,content:x,sdf:h,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new i.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:P,height:z}=t,L=t;this.style.addImage(M,{data:new i.r({width:P,height:z},new Uint8Array(L.data)),pixelRatio:s,stretchX:m,stretchY:g,content:x,sdf:h,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,d)}}updateImage(d,t){this._lazyInitEmptyStyle();const s=i.I.from(d),h=this.style.getImage(s);if(!h)return void this.fire(new i.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?i.q.getImageData(t):t,{width:g,height:x,data:M}=m;if(g===void 0||x===void 0)return void this.fire(new i.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==(h.usvg?h.icon.usvg_tree.width:h.data.width)||x!==(h.usvg?h.icon.usvg_tree.height:h.data.height))return void this.fire(new i.z(new Error(`The width and height of the updated image (${g}, ${x})
                must be that same as the previous version of the image
                (${h.data.width}, ${h.data.height})`)));const P=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let z=!1;h.usvg?(h.data=new i.r({width:g,height:x},new Uint8Array(M)),h.usvg=!1,h.icon=void 0,z=!0):h.data.replace(M,P),this.style.updateImage(s,h,z)}hasImage(d){return d?!!this.style&&!!this.style.getImage(i.I.from(d)):(this.fire(new i.z(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(i.I.from(d))}loadImage(d,t){i.o(this._requestManager.transformRequest(d,i.R.Image),(s,h)=>{t(s,h instanceof HTMLImageElement?i.q.getImageData(h):h)})}listImages(){return this.style.listImages().map(d=>d.name)}addModel(d,t){this._lazyInitEmptyStyle(),this.style.addModel(d,t)}hasModel(d){return d?this.style.hasModel(d):(this.fire(new i.z(new Error("Missing required model id"))),!1)}removeModel(d){this.style.removeModel(d)}listModels(){return this.style.listModels()}addLayer(d,t){return this._isValidId(d.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(d,t),this._update(!0)):this}getSlot(d){const t=this.getLayer(d);return t&&t.slot||null}setSlot(d,t){return this.style.setSlot(d,t),this.style.mergeLayers(),this._update(!0)}addImport(d,t){return this.style.addImport(d,t),this}updateImport(d,t){return typeof t!="string"&&t.id!==d?(this.removeImport(d),this.addImport(t)):(this.style.updateImport(d,t),this._update(!0))}removeImport(d){return this.style.removeImport(d),this}moveImport(d,t){return this.style.moveImport(d,t),this._update(!0)}moveLayer(d,t){return this._isValidId(d)?(this.style.moveLayer(d,t),this._update(!0)):this}removeLayer(d){return this._isValidId(d)?(this.style.removeLayer(d),this._update(!0)):this}getLayer(d){if(!this._isValidId(d))return null;const t=this.style.getOwnLayer(d);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(d,t,s){return this._isValidId(d)?(this.style.setLayerZoomRange(d,t,s),this._update(!0)):this}setFilter(d,t,s={}){return this._isValidId(d)?(this.style.setFilter(d,t,s),this._update(!0)):this}getFilter(d){return this._isValidId(d)?this.style.getFilter(d):null}setPaintProperty(d,t,s,h={}){return this._isValidId(d)?(this.style.setPaintProperty(d,t,s,h),this._update(!0)):this}getPaintProperty(d,t){return this._isValidId(d)?this.style.getPaintProperty(d,t):null}setLayoutProperty(d,t,s,h={}){return this._isValidId(d)?(this.style.setLayoutProperty(d,t,s,h),this._update(!0)):this}getLayoutProperty(d,t){return this._isValidId(d)?this.style.getLayoutProperty(d,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(d){return this.style.setGlyphsUrl(d),this._update(!0)}getSchema(d){return this.style.getSchema(d)}setSchema(d,t){return this.style.setSchema(d,t),this._update(!0)}getConfig(d){return this.style.getConfig(d)}setConfig(d,t){return this.style.setConfig(d,t),this._update(!0)}getConfigProperty(d,t){return this.style.getConfigProperty(d,t)}setConfigProperty(d,t,s){return this.style.setConfigProperty(d,t,s),this._update(!0)}getFeaturesetDescriptors(d){return this.style.getFeaturesetDescriptors(d)}setLights(d){if(this._lazyInitEmptyStyle(),d&&d.length===1&&d[0].type==="flat"){const t=d[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(d),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const d=this.style.getLights()||[];return d.length===0&&d.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),d}setLight(d,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:d}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(d){return this._lazyInitEmptyStyle(),this.style.setSnow(d),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(d){return this._lazyInitEmptyStyle(),this.style.setRain(d),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(d){return this._lazyInitEmptyStyle(),this.style.setColorTheme(d),this._update(!0)}setImportColorTheme(d,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(d,t),this._update(!0)}setCamera(d){return this.style.setCamera(d),this._triggerCameraUpdate(d)}_triggerCameraUpdate(d){return this._update(this.transform.setOrthographicProjectionAtLowPitch(d["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(i.bO.convert(d),this.transform):0}setFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.setFeatureState(d,t),this._update())}removeFeatureState(d,t){return d.source&&!this._isValidId(d.source)?this:(this.style.removeFeatureState(d,t),this._update())}getFeatureState(d){return d.source&&!this._isValidId(d.source)?null:this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let s,h,m,g=this._container;for(;g&&(!h||!m);){const x=window.getComputedStyle(g).transform;x&&x!=="none"&&(s=x.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(m=s[3])),g=g.parentElement}this._containerWidth=h?Math.abs(d/h):d,this._containerHeight=m?Math.abs(t/m):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&i.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=ye("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=ye("div","mapboxgl-canvas-container",d);this._canvas=ye("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=ye("div","mapboxgl-control-container",d),h=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(m=>{h[m]=ye("div",`mapboxgl-ctrl-${m}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,t){const s=i.q.devicePixelRatio||1;this._canvas.width=s*Math.ceil(d),this._canvas.height=s*Math.ceil(t),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${t}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const t=this._markers.indexOf(d);t!==-1&&this._markers.splice(t,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const t=this._popups.indexOf(d);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const d=i.l({},he.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",d);t?(function(s,h){mn.add(s)}(t),this.painter=new Vf(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),i.m.testSupport(t)):this.fire(new i.z(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new i.A("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style.reloadModels(),this.style.clearSources(),this._update(),this.fire(new i.A("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let t;this.fire(new i.A("renderstart")),++this._frameId;const s=this.painter.context.extTimerQuery,h=i.q.now(),m=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=m.createQuery(),m.beginQuery(s.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const g=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,L=this.transform.pitch,F=i.q.now(),B=new i.aa(z,{now:F,fadeDuration:g,pitch:L,transition:this.style.transition});this.style.update(B)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(h),this.style.updateSources(this.transform),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(h);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,g,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:g,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new i.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,q.mark(X.load),this.fire(new i.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const z=i.q.now()-h;m.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const L=m.getQueryParameter(t,m.QUERY_RESULT)/1e6;m.deleteQuery(t),this.fire(new i.A("gpu-timing-frame",{cpuTime:z,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(z);this.fire(new i.A("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(z);this.fire(new i.A("gpu-timing-deferred-render",{gpuTime:L}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(P||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(x=this._updateAverageElevation(h,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new i.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new i.A("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,q.mark(X.fullLoad),this._performanceMetricsCollection&&er(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const t of this._markers)d&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!d||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(d,t=!1){const s=m=>(this.transform.averageElevation=m,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(t||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const m=this.transform.averageElevation;let g=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(g)?g=0:this._averageElevationLastSampledAt=d;const x=Math.abs(m-g);if(x>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(g),s(g);this._averageElevation.easeTo(g,d,300)}else if(x>1e-4)return this._averageElevation.jumpTo(g),s(g)}return!!this._averageElevation.isEasing(d)&&s(this._averageElevation.getValue(d))}_authenticate(){te(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{}),vi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&pn(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function m(g){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,g,0);const x=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,x),x}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(m(d),t.canvasCopies.map(m),t.timeStamps)}_canvasPixelComparison(d,t,s){let h=s[1]-s[0];const m=d.length/4;for(let g=0;g<t.length;g++){const x=t[g];let M=0;for(let P=0;P<x.length;P+=4)x[P]===d[P]&&x[P+1]===d[P+1]&&x[P+2]===d[P+2]&&x[P+3]===d[P+3]&&(M+=1);h+=(s[g+2]-s[g+1])*(1-M/m)}return h}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),mn.delete(this.painter.context.gl),Kt.remove(),$t.remove(),this._removed=!0,this.fire(new i.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=i.q.frame(t=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(t)}))}_preloadTiles(d){const t=this.style?this.style.getSourceCaches():[];return i.bl(t,(s,h)=>s._preloadTiles(d,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(d){this._showParseStatus!==d&&(this._showParseStatus=d,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(d){this._showLayers2DWireframe!==d&&(this._showLayers2DWireframe=d,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(d){this._showLayers3DWireframe!==d&&(this._showLayers3DWireframe=d,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,this._tp.refreshUI(),d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,this._tp.refreshUI(),d&&this._update())}_setCacheLimits(d,t){i.dJ(d,t)}get version(){return G}},NavigationControl:class{constructor(d={}){this.options=i.l({},Pa,d),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(i.aQ(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),ye("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),ye("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(i.aQ(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:t}):s.resetNorth({},{originalEvent:t}))}),this._compassIcon=ye("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const t=d.getZoom(),s=t===d.getMaxZoom(),h=t===d.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Tv(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,t){const s=ye("button",d,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(d,t){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${t}`);d.setAttribute("aria-label",s),d.firstElementChild&&d.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends i.E{constructor(d={}){super();const t=navigator.geolocation;this.options=i.l({geolocation:t},Wi,d),i.aQ(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Zc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const t=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,d(s)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>t(s.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(d){const t=this._map.getMaxBounds(),s=d.coords;return!!t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new i.A("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("geolocate",d)),this._finish()}}_updateCamera(d){const t=new i.bO(d.coords.longitude,d.coords.latitude),s=d.coords.accuracy,h=this._map.getBearing(),m=i.l({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),m,{geolocateSource:!0})}_updateMarker(d){if(d){const t=new i.bO(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,t=i.bH(1,d._center.lat)*d.worldSize,s=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new i.A("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=ye("button","mapboxgl-ctrl-geolocate",this._container),ye("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){i.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ye("div","mapboxgl-user-location"),this._dotElement.appendChild(ye("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ye("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new io({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ye("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new io({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new i.A("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return i.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new i.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new i.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new i.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ol,ScaleControl:class{constructor(d={}){this.options=i.l({},us,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),i.aQ(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,t=this._map,s=t._containerHeight/2,h=t._containerWidth/2-d/2,m=t.unproject([h,s]),g=t.unproject([h+d,s]),x=m.distanceTo(g);if(this.options.unit==="imperial"){const M=3.2808*x;M>5280?this._setScale(d,M/5280,"mile"):this._setScale(d,M,"foot")}else this.options.unit==="nautical"?this._setScale(d,x/1852,"nautical-mile"):x>=1e3?this._setScale(d,x/1e3,"kilometer"):this._setScale(d,x,"meter")}_setScale(d,t,s){this._map._requestDomTask(()=>{const h=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let M=g/x;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(P){const z=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*z)/z}(M),x*M}(t),m=h/t;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(h):`${h}&nbsp;${Mi[s]}`,this._container.style.width=d*m+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=ye("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d={}){this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:i.w("Full screen control 'container' must be a DOM element.")),i.aQ(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=ye("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",i.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=ye("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ye("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends i.E{constructor(d){super(),this.options=i.l(Object.create(Yf),d),this._altitude=this.options.altitude,i.aQ(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new i.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new i.A("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=i.bO.convert(d),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(d){return this._altitude=d,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const t=document.createDocumentFragment(),s=document.createElement("body");let h;for(s.innerHTML=d;h=s.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=ye("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(d),this.options.closeButton){const s=this._closeButton=ye("button","mapboxgl-popup-close-button",t);s.type="button",s.setAttribute("aria-label","Close popup"),s.innerHTML='<span aria-hidden="true">&#215;</span>',s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let t;return this._classList.delete(d)?t=!1:(this._classList.add(d),t=!0),this._updateClassList(),t}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const t=this._map,s=this._container,h=this._pos;if(!t||!s||!h)return"bottom";const m=s.offsetWidth,g=s.offsetHeight,x=h.x<m/2,M=h.x>t.transform.width-m/2;if(h.y+d<g)return x?"top-left":M?"top-right":"top";if(h.y>t.transform.height-g){if(x)return"bottom-left";if(M)return"bottom-right"}return x?"left":M?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),d.className=t.join(" ")}_update(d){const t=this._map,s=this._content;if(!t||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=ye("div","mapboxgl-popup",t.getContainer()),this._tip=ye("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=T_(this._lngLat,this._pos,t.transform)),!this._trackPointer||d){const m=this._pos=this._trackPointer&&d instanceof i.P?d:t.project(this._lngLat,this._altitude),g=Jf(this.options.offset),x=this._anchor=this._getAnchor(g.y),M=Jf(this.options.offset,x),P=m.add(M).round();t._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${eu[x]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&t._showingGlobe()){const m=i.dK(t.transform,this._lngLat)?0:1;this._setOpacity(m)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(Ji);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:io,Style:os,LngLat:i.bO,LngLatBounds:i.aB,Point:i.P,MercatorCoordinate:i.ac,FreeCameraOptions:Al,Evented:i.E,config:i.e,prewarm:i.dP,clearPrewarmedResources:i.dQ,get accessToken(){return i.e.ACCESS_TOKEN},set accessToken(d){i.e.ACCESS_TOKEN=d},get baseApiUrl(){return i.e.API_URL},set baseApiUrl(d){i.e.API_URL=d},get workerCount(){return i.dR.workerCount},set workerCount(d){i.dR.workerCount=d},get maxParallelImageRequests(){return i.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){i.e.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){i.dS(d)},get workerUrl(){return i.dT.workerUrl},set workerUrl(d){i.dT.workerUrl=d},get workerClass(){return i.dT.workerClass},set workerClass(d){i.dT.workerClass=d},get workerParams(){return i.dT.workerParams},set workerParams(d){i.dT.workerParams=d},get dracoUrl(){return i.dU()},set dracoUrl(d){i.dV(d)},get meshoptUrl(){return i.dW()},set meshoptUrl(d){i.dX(d)},setNow:i.q.setNow,restoreNow:i.q.restoreNow}});var D=I;return D})}(Dg)),Dg.exports}var B5=F5();const l8=M5(B5);function wI(n,c){return function(){return n.apply(c,arguments)}}const{toString:N5}=Object.prototype,{getPrototypeOf:k1}=Object,Ty=(n=>c=>{const p=N5.call(c);return n[p]||(n[p]=p.slice(8,-1).toLowerCase())})(Object.create(null)),da=n=>(n=n.toLowerCase(),c=>Ty(c)===n),Sy=n=>c=>typeof c===n,{isArray:Cd}=Array,cm=Sy("undefined");function V5(n){return n!==null&&!cm(n)&&n.constructor!==null&&!cm(n.constructor)&&_o(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const TI=da("ArrayBuffer");function U5(n){let c;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?c=ArrayBuffer.isView(n):c=n&&n.buffer&&TI(n.buffer),c}const j5=Sy("string"),_o=Sy("function"),SI=Sy("number"),Ey=n=>n!==null&&typeof n=="object",$5=n=>n===!0||n===!1,zg=n=>{if(Ty(n)!=="object")return!1;const c=k1(n);return(c===null||c===Object.prototype||Object.getPrototypeOf(c)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},G5=da("Date"),q5=da("File"),H5=da("Blob"),W5=da("FileList"),Z5=n=>Ey(n)&&_o(n.pipe),X5=n=>{let c;return n&&(typeof FormData=="function"&&n instanceof FormData||_o(n.append)&&((c=Ty(n))==="formdata"||c==="object"&&_o(n.toString)&&n.toString()==="[object FormData]"))},K5=da("URLSearchParams"),[Y5,J5,Q5,eB]=["ReadableStream","Request","Response","Headers"].map(da),tB=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Tm(n,c,{allOwnKeys:p=!1}={}){if(n===null||typeof n>"u")return;let v,I;if(typeof n!="object"&&(n=[n]),Cd(n))for(v=0,I=n.length;v<I;v++)c.call(null,n[v],v,n);else{const R=p?Object.getOwnPropertyNames(n):Object.keys(n),D=R.length;let i;for(v=0;v<D;v++)i=R[v],c.call(null,n[i],i,n)}}function EI(n,c){c=c.toLowerCase();const p=Object.keys(n);let v=p.length,I;for(;v-- >0;)if(I=p[v],c===I.toLowerCase())return I;return null}const Tu=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,AI=n=>!cm(n)&&n!==Tu;function Lx(){const{caseless:n}=AI(this)&&this||{},c={},p=(v,I)=>{const R=n&&EI(c,I)||I;zg(c[R])&&zg(v)?c[R]=Lx(c[R],v):zg(v)?c[R]=Lx({},v):Cd(v)?c[R]=v.slice():c[R]=v};for(let v=0,I=arguments.length;v<I;v++)arguments[v]&&Tm(arguments[v],p);return c}const rB=(n,c,p,{allOwnKeys:v}={})=>(Tm(c,(I,R)=>{p&&_o(I)?n[R]=wI(I,p):n[R]=I},{allOwnKeys:v}),n),nB=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),iB=(n,c,p,v)=>{n.prototype=Object.create(c.prototype,v),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:c.prototype}),p&&Object.assign(n.prototype,p)},sB=(n,c,p,v)=>{let I,R,D;const i={};if(c=c||{},n==null)return c;do{for(I=Object.getOwnPropertyNames(n),R=I.length;R-- >0;)D=I[R],(!v||v(D,n,c))&&!i[D]&&(c[D]=n[D],i[D]=!0);n=p!==!1&&k1(n)}while(n&&(!p||p(n,c))&&n!==Object.prototype);return c},oB=(n,c,p)=>{n=String(n),(p===void 0||p>n.length)&&(p=n.length),p-=c.length;const v=n.indexOf(c,p);return v!==-1&&v===p},aB=n=>{if(!n)return null;if(Cd(n))return n;let c=n.length;if(!SI(c))return null;const p=new Array(c);for(;c-- >0;)p[c]=n[c];return p},lB=(n=>c=>n&&c instanceof n)(typeof Uint8Array<"u"&&k1(Uint8Array)),cB=(n,c)=>{const v=(n&&n[Symbol.iterator]).call(n);let I;for(;(I=v.next())&&!I.done;){const R=I.value;c.call(n,R[0],R[1])}},uB=(n,c)=>{let p;const v=[];for(;(p=n.exec(c))!==null;)v.push(p);return v},hB=da("HTMLFormElement"),dB=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(p,v,I){return v.toUpperCase()+I}),sE=(({hasOwnProperty:n})=>(c,p)=>n.call(c,p))(Object.prototype),fB=da("RegExp"),MI=(n,c)=>{const p=Object.getOwnPropertyDescriptors(n),v={};Tm(p,(I,R)=>{let D;(D=c(I,R,n))!==!1&&(v[R]=D||I)}),Object.defineProperties(n,v)},pB=n=>{MI(n,(c,p)=>{if(_o(n)&&["arguments","caller","callee"].indexOf(p)!==-1)return!1;const v=n[p];if(_o(v)){if(c.enumerable=!1,"writable"in c){c.writable=!1;return}c.set||(c.set=()=>{throw Error("Can not rewrite read-only method '"+p+"'")})}})},mB=(n,c)=>{const p={},v=I=>{I.forEach(R=>{p[R]=!0})};return Cd(n)?v(n):v(String(n).split(c)),p},_B=()=>{},gB=(n,c)=>n!=null&&Number.isFinite(n=+n)?n:c;function yB(n){return!!(n&&_o(n.append)&&n[Symbol.toStringTag]==="FormData"&&n[Symbol.iterator])}const vB=n=>{const c=new Array(10),p=(v,I)=>{if(Ey(v)){if(c.indexOf(v)>=0)return;if(!("toJSON"in v)){c[I]=v;const R=Cd(v)?[]:{};return Tm(v,(D,i)=>{const G=p(D,I+1);!cm(G)&&(R[i]=G)}),c[I]=void 0,R}}return v};return p(n,0)},xB=da("AsyncFunction"),bB=n=>n&&(Ey(n)||_o(n))&&_o(n.then)&&_o(n.catch),II=((n,c)=>n?setImmediate:c?((p,v)=>(Tu.addEventListener("message",({source:I,data:R})=>{I===Tu&&R===p&&v.length&&v.shift()()},!1),I=>{v.push(I),Tu.postMessage(p,"*")}))(`axios@${Math.random()}`,[]):p=>setTimeout(p))(typeof setImmediate=="function",_o(Tu.postMessage)),wB=typeof queueMicrotask<"u"?queueMicrotask.bind(Tu):typeof process<"u"&&process.nextTick||II,It={isArray:Cd,isArrayBuffer:TI,isBuffer:V5,isFormData:X5,isArrayBufferView:U5,isString:j5,isNumber:SI,isBoolean:$5,isObject:Ey,isPlainObject:zg,isReadableStream:Y5,isRequest:J5,isResponse:Q5,isHeaders:eB,isUndefined:cm,isDate:G5,isFile:q5,isBlob:H5,isRegExp:fB,isFunction:_o,isStream:Z5,isURLSearchParams:K5,isTypedArray:lB,isFileList:W5,forEach:Tm,merge:Lx,extend:rB,trim:tB,stripBOM:nB,inherits:iB,toFlatObject:sB,kindOf:Ty,kindOfTest:da,endsWith:oB,toArray:aB,forEachEntry:cB,matchAll:uB,isHTMLForm:hB,hasOwnProperty:sE,hasOwnProp:sE,reduceDescriptors:MI,freezeMethods:pB,toObjectSet:mB,toCamelCase:dB,noop:_B,toFiniteNumber:gB,findKey:EI,global:Tu,isContextDefined:AI,isSpecCompliantForm:yB,toJSONObject:vB,isAsyncFn:xB,isThenable:bB,setImmediate:II,asap:wB};function cn(n,c,p,v,I){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",c&&(this.code=c),p&&(this.config=p),v&&(this.request=v),I&&(this.response=I,this.status=I.status?I.status:null)}It.inherits(cn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:It.toJSONObject(this.config),code:this.code,status:this.status}}});const CI=cn.prototype,PI={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{PI[n]={value:n}});Object.defineProperties(cn,PI);Object.defineProperty(CI,"isAxiosError",{value:!0});cn.from=(n,c,p,v,I,R)=>{const D=Object.create(CI);return It.toFlatObject(n,D,function(G){return G!==Error.prototype},i=>i!=="isAxiosError"),cn.call(D,n.message,c,p,v,I),D.cause=n,D.name=n.name,R&&Object.assign(D,R),D};const TB=null;function Ox(n){return It.isPlainObject(n)||It.isArray(n)}function RI(n){return It.endsWith(n,"[]")?n.slice(0,-2):n}function oE(n,c,p){return n?n.concat(c).map(function(I,R){return I=RI(I),!p&&R?"["+I+"]":I}).join(p?".":""):c}function SB(n){return It.isArray(n)&&!n.some(Ox)}const EB=It.toFlatObject(It,{},null,function(c){return/^is[A-Z]/.test(c)});function Ay(n,c,p){if(!It.isObject(n))throw new TypeError("target must be an object");c=c||new FormData,p=It.toFlatObject(p,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ye,Le){return!It.isUndefined(Le[ye])});const v=p.metaTokens,I=p.visitor||q,R=p.dots,D=p.indexes,G=(p.Blob||typeof Blob<"u"&&Blob)&&It.isSpecCompliantForm(c);if(!It.isFunction(I))throw new TypeError("visitor must be a function");function X(he){if(he===null)return"";if(It.isDate(he))return he.toISOString();if(!G&&It.isBlob(he))throw new cn("Blob is not supported. Use a Buffer instead.");return It.isArrayBuffer(he)||It.isTypedArray(he)?G&&typeof Blob=="function"?new Blob([he]):Buffer.from(he):he}function q(he,ye,Le){let je=he;if(he&&!Le&&typeof he=="object"){if(It.endsWith(ye,"{}"))ye=v?ye:ye.slice(0,-2),he=JSON.stringify(he);else if(It.isArray(he)&&SB(he)||(It.isFileList(he)||It.endsWith(ye,"[]"))&&(je=It.toArray(he)))return ye=RI(ye),je.forEach(function(Dt,ut){!(It.isUndefined(Dt)||Dt===null)&&c.append(D===!0?oE([ye],ut,R):D===null?ye:ye+"[]",X(Dt))}),!1}return Ox(he)?!0:(c.append(oE(Le,ye,R),X(he)),!1)}const ee=[],ne=Object.assign(EB,{defaultVisitor:q,convertValue:X,isVisitable:Ox});function me(he,ye){if(!It.isUndefined(he)){if(ee.indexOf(he)!==-1)throw Error("Circular reference detected in "+ye.join("."));ee.push(he),It.forEach(he,function(je,vt){(!(It.isUndefined(je)||je===null)&&I.call(c,je,It.isString(vt)?vt.trim():vt,ye,ne))===!0&&me(je,ye?ye.concat(vt):[vt])}),ee.pop()}}if(!It.isObject(n))throw new TypeError("data must be an object");return me(n),c}function aE(n){const c={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(v){return c[v]})}function F1(n,c){this._pairs=[],n&&Ay(n,this,c)}const DI=F1.prototype;DI.append=function(c,p){this._pairs.push([c,p])};DI.toString=function(c){const p=c?function(v){return c.call(this,v,aE)}:aE;return this._pairs.map(function(I){return p(I[0])+"="+p(I[1])},"").join("&")};function AB(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function zI(n,c,p){if(!c)return n;const v=p&&p.encode||AB;It.isFunction(p)&&(p={serialize:p});const I=p&&p.serialize;let R;if(I?R=I(c,p):R=It.isURLSearchParams(c)?c.toString():new F1(c,p).toString(v),R){const D=n.indexOf("#");D!==-1&&(n=n.slice(0,D)),n+=(n.indexOf("?")===-1?"?":"&")+R}return n}class lE{constructor(){this.handlers=[]}use(c,p,v){return this.handlers.push({fulfilled:c,rejected:p,synchronous:v?v.synchronous:!1,runWhen:v?v.runWhen:null}),this.handlers.length-1}eject(c){this.handlers[c]&&(this.handlers[c]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(c){It.forEach(this.handlers,function(v){v!==null&&c(v)})}}const LI={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},MB=typeof URLSearchParams<"u"?URLSearchParams:F1,IB=typeof FormData<"u"?FormData:null,CB=typeof Blob<"u"?Blob:null,PB={isBrowser:!0,classes:{URLSearchParams:MB,FormData:IB,Blob:CB},protocols:["http","https","file","blob","url","data"]},B1=typeof window<"u"&&typeof document<"u",kx=typeof navigator=="object"&&navigator||void 0,RB=B1&&(!kx||["ReactNative","NativeScript","NS"].indexOf(kx.product)<0),DB=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",zB=B1&&window.location.href||"http://localhost",LB=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:B1,hasStandardBrowserEnv:RB,hasStandardBrowserWebWorkerEnv:DB,navigator:kx,origin:zB},Symbol.toStringTag,{value:"Module"})),fs={...LB,...PB};function OB(n,c){return Ay(n,new fs.classes.URLSearchParams,Object.assign({visitor:function(p,v,I,R){return fs.isNode&&It.isBuffer(p)?(this.append(v,p.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},c))}function kB(n){return It.matchAll(/\w+|\[(\w*)]/g,n).map(c=>c[0]==="[]"?"":c[1]||c[0])}function FB(n){const c={},p=Object.keys(n);let v;const I=p.length;let R;for(v=0;v<I;v++)R=p[v],c[R]=n[R];return c}function OI(n){function c(p,v,I,R){let D=p[R++];if(D==="__proto__")return!0;const i=Number.isFinite(+D),G=R>=p.length;return D=!D&&It.isArray(I)?I.length:D,G?(It.hasOwnProp(I,D)?I[D]=[I[D],v]:I[D]=v,!i):((!I[D]||!It.isObject(I[D]))&&(I[D]=[]),c(p,v,I[D],R)&&It.isArray(I[D])&&(I[D]=FB(I[D])),!i)}if(It.isFormData(n)&&It.isFunction(n.entries)){const p={};return It.forEachEntry(n,(v,I)=>{c(kB(v),I,p,0)}),p}return null}function BB(n,c,p){if(It.isString(n))try{return(c||JSON.parse)(n),It.trim(n)}catch(v){if(v.name!=="SyntaxError")throw v}return(p||JSON.stringify)(n)}const Sm={transitional:LI,adapter:["xhr","http","fetch"],transformRequest:[function(c,p){const v=p.getContentType()||"",I=v.indexOf("application/json")>-1,R=It.isObject(c);if(R&&It.isHTMLForm(c)&&(c=new FormData(c)),It.isFormData(c))return I?JSON.stringify(OI(c)):c;if(It.isArrayBuffer(c)||It.isBuffer(c)||It.isStream(c)||It.isFile(c)||It.isBlob(c)||It.isReadableStream(c))return c;if(It.isArrayBufferView(c))return c.buffer;if(It.isURLSearchParams(c))return p.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),c.toString();let i;if(R){if(v.indexOf("application/x-www-form-urlencoded")>-1)return OB(c,this.formSerializer).toString();if((i=It.isFileList(c))||v.indexOf("multipart/form-data")>-1){const G=this.env&&this.env.FormData;return Ay(i?{"files[]":c}:c,G&&new G,this.formSerializer)}}return R||I?(p.setContentType("application/json",!1),BB(c)):c}],transformResponse:[function(c){const p=this.transitional||Sm.transitional,v=p&&p.forcedJSONParsing,I=this.responseType==="json";if(It.isResponse(c)||It.isReadableStream(c))return c;if(c&&It.isString(c)&&(v&&!this.responseType||I)){const D=!(p&&p.silentJSONParsing)&&I;try{return JSON.parse(c)}catch(i){if(D)throw i.name==="SyntaxError"?cn.from(i,cn.ERR_BAD_RESPONSE,this,null,this.response):i}}return c}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:fs.classes.FormData,Blob:fs.classes.Blob},validateStatus:function(c){return c>=200&&c<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};It.forEach(["delete","get","head","post","put","patch"],n=>{Sm.headers[n]={}});const NB=It.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),VB=n=>{const c={};let p,v,I;return n&&n.split(`
`).forEach(function(D){I=D.indexOf(":"),p=D.substring(0,I).trim().toLowerCase(),v=D.substring(I+1).trim(),!(!p||c[p]&&NB[p])&&(p==="set-cookie"?c[p]?c[p].push(v):c[p]=[v]:c[p]=c[p]?c[p]+", "+v:v)}),c},cE=Symbol("internals");function Fp(n){return n&&String(n).trim().toLowerCase()}function Lg(n){return n===!1||n==null?n:It.isArray(n)?n.map(Lg):String(n)}function UB(n){const c=Object.create(null),p=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let v;for(;v=p.exec(n);)c[v[1]]=v[2];return c}const jB=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function lx(n,c,p,v,I){if(It.isFunction(v))return v.call(this,c,p);if(I&&(c=p),!!It.isString(c)){if(It.isString(v))return c.indexOf(v)!==-1;if(It.isRegExp(v))return v.test(c)}}function $B(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(c,p,v)=>p.toUpperCase()+v)}function GB(n,c){const p=It.toCamelCase(" "+c);["get","set","has"].forEach(v=>{Object.defineProperty(n,v+p,{value:function(I,R,D){return this[v].call(this,c,I,R,D)},configurable:!0})})}let Xs=class{constructor(c){c&&this.set(c)}set(c,p,v){const I=this;function R(i,G,X){const q=Fp(G);if(!q)throw new Error("header name must be a non-empty string");const ee=It.findKey(I,q);(!ee||I[ee]===void 0||X===!0||X===void 0&&I[ee]!==!1)&&(I[ee||G]=Lg(i))}const D=(i,G)=>It.forEach(i,(X,q)=>R(X,q,G));if(It.isPlainObject(c)||c instanceof this.constructor)D(c,p);else if(It.isString(c)&&(c=c.trim())&&!jB(c))D(VB(c),p);else if(It.isHeaders(c))for(const[i,G]of c.entries())R(G,i,v);else c!=null&&R(p,c,v);return this}get(c,p){if(c=Fp(c),c){const v=It.findKey(this,c);if(v){const I=this[v];if(!p)return I;if(p===!0)return UB(I);if(It.isFunction(p))return p.call(this,I,v);if(It.isRegExp(p))return p.exec(I);throw new TypeError("parser must be boolean|regexp|function")}}}has(c,p){if(c=Fp(c),c){const v=It.findKey(this,c);return!!(v&&this[v]!==void 0&&(!p||lx(this,this[v],v,p)))}return!1}delete(c,p){const v=this;let I=!1;function R(D){if(D=Fp(D),D){const i=It.findKey(v,D);i&&(!p||lx(v,v[i],i,p))&&(delete v[i],I=!0)}}return It.isArray(c)?c.forEach(R):R(c),I}clear(c){const p=Object.keys(this);let v=p.length,I=!1;for(;v--;){const R=p[v];(!c||lx(this,this[R],R,c,!0))&&(delete this[R],I=!0)}return I}normalize(c){const p=this,v={};return It.forEach(this,(I,R)=>{const D=It.findKey(v,R);if(D){p[D]=Lg(I),delete p[R];return}const i=c?$B(R):String(R).trim();i!==R&&delete p[R],p[i]=Lg(I),v[i]=!0}),this}concat(...c){return this.constructor.concat(this,...c)}toJSON(c){const p=Object.create(null);return It.forEach(this,(v,I)=>{v!=null&&v!==!1&&(p[I]=c&&It.isArray(v)?v.join(", "):v)}),p}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([c,p])=>c+": "+p).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(c){return c instanceof this?c:new this(c)}static concat(c,...p){const v=new this(c);return p.forEach(I=>v.set(I)),v}static accessor(c){const v=(this[cE]=this[cE]={accessors:{}}).accessors,I=this.prototype;function R(D){const i=Fp(D);v[i]||(GB(I,D),v[i]=!0)}return It.isArray(c)?c.forEach(R):R(c),this}};Xs.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);It.reduceDescriptors(Xs.prototype,({value:n},c)=>{let p=c[0].toUpperCase()+c.slice(1);return{get:()=>n,set(v){this[p]=v}}});It.freezeMethods(Xs);function cx(n,c){const p=this||Sm,v=c||p,I=Xs.from(v.headers);let R=v.data;return It.forEach(n,function(i){R=i.call(p,R,I.normalize(),c?c.status:void 0)}),I.normalize(),R}function kI(n){return!!(n&&n.__CANCEL__)}function Pd(n,c,p){cn.call(this,n??"canceled",cn.ERR_CANCELED,c,p),this.name="CanceledError"}It.inherits(Pd,cn,{__CANCEL__:!0});function FI(n,c,p){const v=p.config.validateStatus;!p.status||!v||v(p.status)?n(p):c(new cn("Request failed with status code "+p.status,[cn.ERR_BAD_REQUEST,cn.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p))}function qB(n){const c=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return c&&c[1]||""}function HB(n,c){n=n||10;const p=new Array(n),v=new Array(n);let I=0,R=0,D;return c=c!==void 0?c:1e3,function(G){const X=Date.now(),q=v[R];D||(D=X),p[I]=G,v[I]=X;let ee=R,ne=0;for(;ee!==I;)ne+=p[ee++],ee=ee%n;if(I=(I+1)%n,I===R&&(R=(R+1)%n),X-D<c)return;const me=q&&X-q;return me?Math.round(ne*1e3/me):void 0}}function WB(n,c){let p=0,v=1e3/c,I,R;const D=(X,q=Date.now())=>{p=q,I=null,R&&(clearTimeout(R),R=null),n.apply(null,X)};return[(...X)=>{const q=Date.now(),ee=q-p;ee>=v?D(X,q):(I=X,R||(R=setTimeout(()=>{R=null,D(I)},v-ee)))},()=>I&&D(I)]}const Xg=(n,c,p=3)=>{let v=0;const I=HB(50,250);return WB(R=>{const D=R.loaded,i=R.lengthComputable?R.total:void 0,G=D-v,X=I(G),q=D<=i;v=D;const ee={loaded:D,total:i,progress:i?D/i:void 0,bytes:G,rate:X||void 0,estimated:X&&i&&q?(i-D)/X:void 0,event:R,lengthComputable:i!=null,[c?"download":"upload"]:!0};n(ee)},p)},uE=(n,c)=>{const p=n!=null;return[v=>c[0]({lengthComputable:p,total:n,loaded:v}),c[1]]},hE=n=>(...c)=>It.asap(()=>n(...c)),ZB=fs.hasStandardBrowserEnv?((n,c)=>p=>(p=new URL(p,fs.origin),n.protocol===p.protocol&&n.host===p.host&&(c||n.port===p.port)))(new URL(fs.origin),fs.navigator&&/(msie|trident)/i.test(fs.navigator.userAgent)):()=>!0,XB=fs.hasStandardBrowserEnv?{write(n,c,p,v,I,R){const D=[n+"="+encodeURIComponent(c)];It.isNumber(p)&&D.push("expires="+new Date(p).toGMTString()),It.isString(v)&&D.push("path="+v),It.isString(I)&&D.push("domain="+I),R===!0&&D.push("secure"),document.cookie=D.join("; ")},read(n){const c=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return c?decodeURIComponent(c[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function KB(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function YB(n,c){return c?n.replace(/\/?\/$/,"")+"/"+c.replace(/^\/+/,""):n}function BI(n,c,p){let v=!KB(c);return n&&(v||p==!1)?YB(n,c):c}const dE=n=>n instanceof Xs?{...n}:n;function Lu(n,c){c=c||{};const p={};function v(X,q,ee,ne){return It.isPlainObject(X)&&It.isPlainObject(q)?It.merge.call({caseless:ne},X,q):It.isPlainObject(q)?It.merge({},q):It.isArray(q)?q.slice():q}function I(X,q,ee,ne){if(It.isUndefined(q)){if(!It.isUndefined(X))return v(void 0,X,ee,ne)}else return v(X,q,ee,ne)}function R(X,q){if(!It.isUndefined(q))return v(void 0,q)}function D(X,q){if(It.isUndefined(q)){if(!It.isUndefined(X))return v(void 0,X)}else return v(void 0,q)}function i(X,q,ee){if(ee in c)return v(X,q);if(ee in n)return v(void 0,X)}const G={url:R,method:R,data:R,baseURL:D,transformRequest:D,transformResponse:D,paramsSerializer:D,timeout:D,timeoutMessage:D,withCredentials:D,withXSRFToken:D,adapter:D,responseType:D,xsrfCookieName:D,xsrfHeaderName:D,onUploadProgress:D,onDownloadProgress:D,decompress:D,maxContentLength:D,maxBodyLength:D,beforeRedirect:D,transport:D,httpAgent:D,httpsAgent:D,cancelToken:D,socketPath:D,responseEncoding:D,validateStatus:i,headers:(X,q,ee)=>I(dE(X),dE(q),ee,!0)};return It.forEach(Object.keys(Object.assign({},n,c)),function(q){const ee=G[q]||I,ne=ee(n[q],c[q],q);It.isUndefined(ne)&&ee!==i||(p[q]=ne)}),p}const NI=n=>{const c=Lu({},n);let{data:p,withXSRFToken:v,xsrfHeaderName:I,xsrfCookieName:R,headers:D,auth:i}=c;c.headers=D=Xs.from(D),c.url=zI(BI(c.baseURL,c.url,c.allowAbsoluteUrls),n.params,n.paramsSerializer),i&&D.set("Authorization","Basic "+btoa((i.username||"")+":"+(i.password?unescape(encodeURIComponent(i.password)):"")));let G;if(It.isFormData(p)){if(fs.hasStandardBrowserEnv||fs.hasStandardBrowserWebWorkerEnv)D.setContentType(void 0);else if((G=D.getContentType())!==!1){const[X,...q]=G?G.split(";").map(ee=>ee.trim()).filter(Boolean):[];D.setContentType([X||"multipart/form-data",...q].join("; "))}}if(fs.hasStandardBrowserEnv&&(v&&It.isFunction(v)&&(v=v(c)),v||v!==!1&&ZB(c.url))){const X=I&&R&&XB.read(R);X&&D.set(I,X)}return c},JB=typeof XMLHttpRequest<"u",QB=JB&&function(n){return new Promise(function(p,v){const I=NI(n);let R=I.data;const D=Xs.from(I.headers).normalize();let{responseType:i,onUploadProgress:G,onDownloadProgress:X}=I,q,ee,ne,me,he;function ye(){me&&me(),he&&he(),I.cancelToken&&I.cancelToken.unsubscribe(q),I.signal&&I.signal.removeEventListener("abort",q)}let Le=new XMLHttpRequest;Le.open(I.method.toUpperCase(),I.url,!0),Le.timeout=I.timeout;function je(){if(!Le)return;const Dt=Xs.from("getAllResponseHeaders"in Le&&Le.getAllResponseHeaders()),ht={data:!i||i==="text"||i==="json"?Le.responseText:Le.response,status:Le.status,statusText:Le.statusText,headers:Dt,config:n,request:Le};FI(function(tt){p(tt),ye()},function(tt){v(tt),ye()},ht),Le=null}"onloadend"in Le?Le.onloadend=je:Le.onreadystatechange=function(){!Le||Le.readyState!==4||Le.status===0&&!(Le.responseURL&&Le.responseURL.indexOf("file:")===0)||setTimeout(je)},Le.onabort=function(){Le&&(v(new cn("Request aborted",cn.ECONNABORTED,n,Le)),Le=null)},Le.onerror=function(){v(new cn("Network Error",cn.ERR_NETWORK,n,Le)),Le=null},Le.ontimeout=function(){let ut=I.timeout?"timeout of "+I.timeout+"ms exceeded":"timeout exceeded";const ht=I.transitional||LI;I.timeoutErrorMessage&&(ut=I.timeoutErrorMessage),v(new cn(ut,ht.clarifyTimeoutError?cn.ETIMEDOUT:cn.ECONNABORTED,n,Le)),Le=null},R===void 0&&D.setContentType(null),"setRequestHeader"in Le&&It.forEach(D.toJSON(),function(ut,ht){Le.setRequestHeader(ht,ut)}),It.isUndefined(I.withCredentials)||(Le.withCredentials=!!I.withCredentials),i&&i!=="json"&&(Le.responseType=I.responseType),X&&([ne,he]=Xg(X,!0),Le.addEventListener("progress",ne)),G&&Le.upload&&([ee,me]=Xg(G),Le.upload.addEventListener("progress",ee),Le.upload.addEventListener("loadend",me)),(I.cancelToken||I.signal)&&(q=Dt=>{Le&&(v(!Dt||Dt.type?new Pd(null,n,Le):Dt),Le.abort(),Le=null)},I.cancelToken&&I.cancelToken.subscribe(q),I.signal&&(I.signal.aborted?q():I.signal.addEventListener("abort",q)));const vt=qB(I.url);if(vt&&fs.protocols.indexOf(vt)===-1){v(new cn("Unsupported protocol "+vt+":",cn.ERR_BAD_REQUEST,n));return}Le.send(R||null)})},eN=(n,c)=>{const{length:p}=n=n?n.filter(Boolean):[];if(c||p){let v=new AbortController,I;const R=function(X){if(!I){I=!0,i();const q=X instanceof Error?X:this.reason;v.abort(q instanceof cn?q:new Pd(q instanceof Error?q.message:q))}};let D=c&&setTimeout(()=>{D=null,R(new cn(`timeout ${c} of ms exceeded`,cn.ETIMEDOUT))},c);const i=()=>{n&&(D&&clearTimeout(D),D=null,n.forEach(X=>{X.unsubscribe?X.unsubscribe(R):X.removeEventListener("abort",R)}),n=null)};n.forEach(X=>X.addEventListener("abort",R));const{signal:G}=v;return G.unsubscribe=()=>It.asap(i),G}},tN=function*(n,c){let p=n.byteLength;if(p<c){yield n;return}let v=0,I;for(;v<p;)I=v+c,yield n.slice(v,I),v=I},rN=async function*(n,c){for await(const p of nN(n))yield*tN(p,c)},nN=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const c=n.getReader();try{for(;;){const{done:p,value:v}=await c.read();if(p)break;yield v}}finally{await c.cancel()}},fE=(n,c,p,v)=>{const I=rN(n,c);let R=0,D,i=G=>{D||(D=!0,v&&v(G))};return new ReadableStream({async pull(G){try{const{done:X,value:q}=await I.next();if(X){i(),G.close();return}let ee=q.byteLength;if(p){let ne=R+=ee;p(ne)}G.enqueue(new Uint8Array(q))}catch(X){throw i(X),X}},cancel(G){return i(G),I.return()}},{highWaterMark:2})},My=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",VI=My&&typeof ReadableStream=="function",iN=My&&(typeof TextEncoder=="function"?(n=>c=>n.encode(c))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),UI=(n,...c)=>{try{return!!n(...c)}catch{return!1}},sN=VI&&UI(()=>{let n=!1;const c=new Request(fs.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!c}),pE=64*1024,Fx=VI&&UI(()=>It.isReadableStream(new Response("").body)),Kg={stream:Fx&&(n=>n.body)};My&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(c=>{!Kg[c]&&(Kg[c]=It.isFunction(n[c])?p=>p[c]():(p,v)=>{throw new cn(`Response type '${c}' is not supported`,cn.ERR_NOT_SUPPORT,v)})})})(new Response);const oN=async n=>{if(n==null)return 0;if(It.isBlob(n))return n.size;if(It.isSpecCompliantForm(n))return(await new Request(fs.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(It.isArrayBufferView(n)||It.isArrayBuffer(n))return n.byteLength;if(It.isURLSearchParams(n)&&(n=n+""),It.isString(n))return(await iN(n)).byteLength},aN=async(n,c)=>{const p=It.toFiniteNumber(n.getContentLength());return p??oN(c)},lN=My&&(async n=>{let{url:c,method:p,data:v,signal:I,cancelToken:R,timeout:D,onDownloadProgress:i,onUploadProgress:G,responseType:X,headers:q,withCredentials:ee="same-origin",fetchOptions:ne}=NI(n);X=X?(X+"").toLowerCase():"text";let me=eN([I,R&&R.toAbortSignal()],D),he;const ye=me&&me.unsubscribe&&(()=>{me.unsubscribe()});let Le;try{if(G&&sN&&p!=="get"&&p!=="head"&&(Le=await aN(q,v))!==0){let ht=new Request(c,{method:"POST",body:v,duplex:"half"}),St;if(It.isFormData(v)&&(St=ht.headers.get("content-type"))&&q.setContentType(St),ht.body){const[tt,Et]=uE(Le,Xg(hE(G)));v=fE(ht.body,pE,tt,Et)}}It.isString(ee)||(ee=ee?"include":"omit");const je="credentials"in Request.prototype;he=new Request(c,{...ne,signal:me,method:p.toUpperCase(),headers:q.normalize().toJSON(),body:v,duplex:"half",credentials:je?ee:void 0});let vt=await fetch(he);const Dt=Fx&&(X==="stream"||X==="response");if(Fx&&(i||Dt&&ye)){const ht={};["status","statusText","headers"].forEach(pt=>{ht[pt]=vt[pt]});const St=It.toFiniteNumber(vt.headers.get("content-length")),[tt,Et]=i&&uE(St,Xg(hE(i),!0))||[];vt=new Response(fE(vt.body,pE,tt,()=>{Et&&Et(),ye&&ye()}),ht)}X=X||"text";let ut=await Kg[It.findKey(Kg,X)||"text"](vt,n);return!Dt&&ye&&ye(),await new Promise((ht,St)=>{FI(ht,St,{data:ut,headers:Xs.from(vt.headers),status:vt.status,statusText:vt.statusText,config:n,request:he})})}catch(je){throw ye&&ye(),je&&je.name==="TypeError"&&/fetch/i.test(je.message)?Object.assign(new cn("Network Error",cn.ERR_NETWORK,n,he),{cause:je.cause||je}):cn.from(je,je&&je.code,n,he)}}),Bx={http:TB,xhr:QB,fetch:lN};It.forEach(Bx,(n,c)=>{if(n){try{Object.defineProperty(n,"name",{value:c})}catch{}Object.defineProperty(n,"adapterName",{value:c})}});const mE=n=>`- ${n}`,cN=n=>It.isFunction(n)||n===null||n===!1,jI={getAdapter:n=>{n=It.isArray(n)?n:[n];const{length:c}=n;let p,v;const I={};for(let R=0;R<c;R++){p=n[R];let D;if(v=p,!cN(p)&&(v=Bx[(D=String(p)).toLowerCase()],v===void 0))throw new cn(`Unknown adapter '${D}'`);if(v)break;I[D||"#"+R]=v}if(!v){const R=Object.entries(I).map(([i,G])=>`adapter ${i} `+(G===!1?"is not supported by the environment":"is not available in the build"));let D=c?R.length>1?`since :
`+R.map(mE).join(`
`):" "+mE(R[0]):"as no adapter specified";throw new cn("There is no suitable adapter to dispatch the request "+D,"ERR_NOT_SUPPORT")}return v},adapters:Bx};function ux(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Pd(null,n)}function _E(n){return ux(n),n.headers=Xs.from(n.headers),n.data=cx.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),jI.getAdapter(n.adapter||Sm.adapter)(n).then(function(v){return ux(n),v.data=cx.call(n,n.transformResponse,v),v.headers=Xs.from(v.headers),v},function(v){return kI(v)||(ux(n),v&&v.response&&(v.response.data=cx.call(n,n.transformResponse,v.response),v.response.headers=Xs.from(v.response.headers))),Promise.reject(v)})}const $I="1.8.4",Iy={};["object","boolean","number","function","string","symbol"].forEach((n,c)=>{Iy[n]=function(v){return typeof v===n||"a"+(c<1?"n ":" ")+n}});const gE={};Iy.transitional=function(c,p,v){function I(R,D){return"[Axios v"+$I+"] Transitional option '"+R+"'"+D+(v?". "+v:"")}return(R,D,i)=>{if(c===!1)throw new cn(I(D," has been removed"+(p?" in "+p:"")),cn.ERR_DEPRECATED);return p&&!gE[D]&&(gE[D]=!0,console.warn(I(D," has been deprecated since v"+p+" and will be removed in the near future"))),c?c(R,D,i):!0}};Iy.spelling=function(c){return(p,v)=>(console.warn(`${v} is likely a misspelling of ${c}`),!0)};function uN(n,c,p){if(typeof n!="object")throw new cn("options must be an object",cn.ERR_BAD_OPTION_VALUE);const v=Object.keys(n);let I=v.length;for(;I-- >0;){const R=v[I],D=c[R];if(D){const i=n[R],G=i===void 0||D(i,R,n);if(G!==!0)throw new cn("option "+R+" must be "+G,cn.ERR_BAD_OPTION_VALUE);continue}if(p!==!0)throw new cn("Unknown option "+R,cn.ERR_BAD_OPTION)}}const Og={assertOptions:uN,validators:Iy},La=Og.validators;let Mu=class{constructor(c){this.defaults=c,this.interceptors={request:new lE,response:new lE}}async request(c,p){try{return await this._request(c,p)}catch(v){if(v instanceof Error){let I={};Error.captureStackTrace?Error.captureStackTrace(I):I=new Error;const R=I.stack?I.stack.replace(/^.+\n/,""):"";try{v.stack?R&&!String(v.stack).endsWith(R.replace(/^.+\n.+\n/,""))&&(v.stack+=`
`+R):v.stack=R}catch{}}throw v}}_request(c,p){typeof c=="string"?(p=p||{},p.url=c):p=c||{},p=Lu(this.defaults,p);const{transitional:v,paramsSerializer:I,headers:R}=p;v!==void 0&&Og.assertOptions(v,{silentJSONParsing:La.transitional(La.boolean),forcedJSONParsing:La.transitional(La.boolean),clarifyTimeoutError:La.transitional(La.boolean)},!1),I!=null&&(It.isFunction(I)?p.paramsSerializer={serialize:I}:Og.assertOptions(I,{encode:La.function,serialize:La.function},!0)),p.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?p.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:p.allowAbsoluteUrls=!0),Og.assertOptions(p,{baseUrl:La.spelling("baseURL"),withXsrfToken:La.spelling("withXSRFToken")},!0),p.method=(p.method||this.defaults.method||"get").toLowerCase();let D=R&&It.merge(R.common,R[p.method]);R&&It.forEach(["delete","get","head","post","put","patch","common"],he=>{delete R[he]}),p.headers=Xs.concat(D,R);const i=[];let G=!0;this.interceptors.request.forEach(function(ye){typeof ye.runWhen=="function"&&ye.runWhen(p)===!1||(G=G&&ye.synchronous,i.unshift(ye.fulfilled,ye.rejected))});const X=[];this.interceptors.response.forEach(function(ye){X.push(ye.fulfilled,ye.rejected)});let q,ee=0,ne;if(!G){const he=[_E.bind(this),void 0];for(he.unshift.apply(he,i),he.push.apply(he,X),ne=he.length,q=Promise.resolve(p);ee<ne;)q=q.then(he[ee++],he[ee++]);return q}ne=i.length;let me=p;for(ee=0;ee<ne;){const he=i[ee++],ye=i[ee++];try{me=he(me)}catch(Le){ye.call(this,Le);break}}try{q=_E.call(this,me)}catch(he){return Promise.reject(he)}for(ee=0,ne=X.length;ee<ne;)q=q.then(X[ee++],X[ee++]);return q}getUri(c){c=Lu(this.defaults,c);const p=BI(c.baseURL,c.url,c.allowAbsoluteUrls);return zI(p,c.params,c.paramsSerializer)}};It.forEach(["delete","get","head","options"],function(c){Mu.prototype[c]=function(p,v){return this.request(Lu(v||{},{method:c,url:p,data:(v||{}).data}))}});It.forEach(["post","put","patch"],function(c){function p(v){return function(R,D,i){return this.request(Lu(i||{},{method:c,headers:v?{"Content-Type":"multipart/form-data"}:{},url:R,data:D}))}}Mu.prototype[c]=p(),Mu.prototype[c+"Form"]=p(!0)});let hN=class GI{constructor(c){if(typeof c!="function")throw new TypeError("executor must be a function.");let p;this.promise=new Promise(function(R){p=R});const v=this;this.promise.then(I=>{if(!v._listeners)return;let R=v._listeners.length;for(;R-- >0;)v._listeners[R](I);v._listeners=null}),this.promise.then=I=>{let R;const D=new Promise(i=>{v.subscribe(i),R=i}).then(I);return D.cancel=function(){v.unsubscribe(R)},D},c(function(R,D,i){v.reason||(v.reason=new Pd(R,D,i),p(v.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(c){if(this.reason){c(this.reason);return}this._listeners?this._listeners.push(c):this._listeners=[c]}unsubscribe(c){if(!this._listeners)return;const p=this._listeners.indexOf(c);p!==-1&&this._listeners.splice(p,1)}toAbortSignal(){const c=new AbortController,p=v=>{c.abort(v)};return this.subscribe(p),c.signal.unsubscribe=()=>this.unsubscribe(p),c.signal}static source(){let c;return{token:new GI(function(I){c=I}),cancel:c}}};function dN(n){return function(p){return n.apply(null,p)}}function fN(n){return It.isObject(n)&&n.isAxiosError===!0}const Nx={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Nx).forEach(([n,c])=>{Nx[c]=n});function qI(n){const c=new Mu(n),p=wI(Mu.prototype.request,c);return It.extend(p,Mu.prototype,c,{allOwnKeys:!0}),It.extend(p,c,null,{allOwnKeys:!0}),p.create=function(I){return qI(Lu(n,I))},p}const Ci=qI(Sm);Ci.Axios=Mu;Ci.CanceledError=Pd;Ci.CancelToken=hN;Ci.isCancel=kI;Ci.VERSION=$I;Ci.toFormData=Ay;Ci.AxiosError=cn;Ci.Cancel=Ci.CanceledError;Ci.all=function(c){return Promise.all(c)};Ci.spread=dN;Ci.isAxiosError=fN;Ci.mergeConfig=Lu;Ci.AxiosHeaders=Xs;Ci.formToJSON=n=>OI(It.isHTMLForm(n)?new FormData(n):n);Ci.getAdapter=jI.getAdapter;Ci.HttpStatusCode=Nx;Ci.default=Ci;const{Axios:h8,AxiosError:d8,CanceledError:f8,isCancel:p8,CancelToken:m8,VERSION:_8,all:g8,Cancel:y8,isAxiosError:v8,spread:x8,toFormData:b8,AxiosHeaders:w8,HttpStatusCode:T8,formToJSON:S8,getAdapter:E8,mergeConfig:A8}=Ci,pN=kM("GameMap",{state:()=>({isinit:!1,marks:[],unshowMarks:[],pointsIds:[],showName:!1,loading:!0}),getters:{fillterMarks(n){return n.marks.filter(c=>!n.unshowMarks.includes(c.id))}},actions:{async getMarksData(){const{data:n}=await Ci.get("/data/points.json");return this.marks=n,this.marks}}}),ms=typeof window<"u",N1=ms&&"IntersectionObserver"in window,mN=ms&&("ontouchstart"in window||window.navigator.maxTouchPoints>0);function yE(n,c,p){_N(n,c),c.set(n,p)}function _N(n,c){if(c.has(n))throw new TypeError("Cannot initialize the same private elements twice on an object")}function gN(n,c,p){return n.set(HI(n,c),p),p}function yu(n,c){return n.get(HI(n,c))}function HI(n,c,p){if(typeof n=="function"?n===c:n.has(c))return arguments.length<3?c:p;throw new TypeError("Private element is not present on this object")}function yN(n,c,p){const v=c.length-1;if(v<0)return n===void 0?p:n;for(let I=0;I<v;I++){if(n==null)return p;n=n[c[I]]}return n==null||n[c[v]]===void 0?p:n[c[v]]}function Cy(n,c){if(n===c)return!0;if(n instanceof Date&&c instanceof Date&&n.getTime()!==c.getTime()||n!==Object(n)||c!==Object(c))return!1;const p=Object.keys(n);return p.length!==Object.keys(c).length?!1:p.every(v=>Cy(n[v],c[v]))}function vE(n,c,p){return n==null||!c||typeof c!="string"?p:n[c]!==void 0?n[c]:(c=c.replace(/\[(\w+)\]/g,".$1"),c=c.replace(/^\./,""),yN(n,c.split("."),p))}function WI(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Array.from({length:n},(p,v)=>c+v)}function oi(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"px";if(n==null||n==="")return;const p=Number(n);return isNaN(p)?String(n):isFinite(p)?`${p}${c}`:void 0}function vN(n){return n!==null&&typeof n=="object"&&!Array.isArray(n)}function xE(n){let c;return n!==null&&typeof n=="object"&&((c=Object.getPrototypeOf(n))===Object.prototype||c===null)}function ZI(n){if(n&&"$el"in n){const c=n.$el;return(c==null?void 0:c.nodeType)===Node.TEXT_NODE?c.nextElementSibling:c}return n}const bE=Object.freeze({enter:13,tab:9,delete:46,esc:27,space:32,up:38,down:40,left:37,right:39,end:35,home:36,del:46,backspace:8,insert:45,pageup:33,pagedown:34,shift:16});function hx(n,c){return c.every(p=>n.hasOwnProperty(p))}function xN(n,c){const p={};for(const v of c)Object.hasOwn(n,v)&&(p[v]=n[v]);return p}function bN(n){return n==null?[]:Array.isArray(n)?n:[n]}function Yg(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.max(c,Math.min(p,n))}function wE(n,c){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0";return n+p.repeat(Math.max(0,c-n.length))}function TE(n,c){return(arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0").repeat(Math.max(0,c-n.length))+n}function wN(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const p=[];let v=0;for(;v<n.length;)p.push(n.substr(v,c)),v+=c;return p}function _s(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=arguments.length>2?arguments[2]:void 0;const v={};for(const I in n)v[I]=n[I];for(const I in c){const R=n[I],D=c[I];if(xE(R)&&xE(D)){v[I]=_s(R,D,p);continue}if(p&&Array.isArray(R)&&Array.isArray(D)){v[I]=p(R,D);continue}v[I]=D}return v}function XI(n){return n.map(c=>c.type===ti?XI(c.children):c).flat()}function Iu(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";if(Iu.cache.has(n))return Iu.cache.get(n);const c=n.replace(/[^a-z]/gi,"-").replace(/\B([A-Z])/g,"-$1").toLowerCase();return Iu.cache.set(n,c),c}Iu.cache=new Map;function pd(n,c){if(!c||typeof c!="object")return[];if(Array.isArray(c))return c.map(p=>pd(n,p)).flat(1);if(c.suspense)return pd(n,c.ssContent);if(Array.isArray(c.children))return c.children.map(p=>pd(n,p)).flat(1);if(c.component){if(Object.getOwnPropertySymbols(c.component.provides).includes(n))return[c.component];if(c.component.subTree)return pd(n,c.component.subTree).flat(1)}return[]}var wg=new WeakMap,ld=new WeakMap;class TN{constructor(c){yE(this,wg,[]),yE(this,ld,0),this.size=c}push(c){yu(wg,this)[yu(ld,this)]=c,gN(ld,this,(yu(ld,this)+1)%this.size)}values(){return yu(wg,this).slice(yu(ld,this)).concat(yu(wg,this).slice(0,yu(ld,this)))}}function KI(n){const c=Zi({}),p=ct(n);return Ad(()=>{for(const v in p.value)c[v]=p.value[v]},{flush:"sync"}),uy(c)}function Vx(n,c){return n.includes(c)}const SE=()=>[Function,Array];function EE(n,c){return c="on"+xc(c),!!(n[c]||n[`${c}Once`]||n[`${c}Capture`]||n[`${c}OnceCapture`]||n[`${c}CaptureOnce`])}function SN(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const p=["button","[href]",'input:not([type="hidden"])',"select","textarea","[tabindex]"].map(v=>`${v}${c?':not([tabindex="-1"])':""}:not([disabled])`).join(", ");return[...n.querySelectorAll(p)]}function EN(n,c){if(!ms||n===0)return c(),()=>{};const p=window.setTimeout(c,n);return()=>window.clearTimeout(p)}function AN(){const n=Fn(),c=p=>{n.value=p};return Object.defineProperty(c,"value",{enumerable:!0,get:()=>n.value,set:p=>n.value=p}),Object.defineProperty(c,"el",{enumerable:!0,get:()=>ZI(n.value)}),c}function Bs(n,c){const p=ha();if(!p)throw new Error(`[Vuetify] ${n} must be called from inside a setup function`);return p}function Tc(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"composables";const c=Bs(n).type;return Iu((c==null?void 0:c.aliasName)||(c==null?void 0:c.name))}let YI=0,kg=new WeakMap;function Py(){const n=Bs("getUid");if(kg.has(n))return kg.get(n);{const c=YI++;return kg.set(n,c),c}}Py.reset=()=>{YI=0,kg=new WeakMap};function MN(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Bs("injectSelf");const{provides:p}=c;if(p&&n in p)return p[n]}const Ed=Symbol.for("vuetify:defaults");function IN(n){return In(n)}function V1(){const n=Hn(Ed);if(!n)throw new Error("[Vuetify] Could not find defaults instance");return n}function Ry(n,c){const p=V1(),v=In(n),I=ct(()=>{if(At(c==null?void 0:c.disabled))return p.value;const D=At(c==null?void 0:c.scoped),i=At(c==null?void 0:c.reset),G=At(c==null?void 0:c.root);if(v.value==null&&!(D||i||G))return p.value;let X=_s(v.value,{prev:p.value});if(D)return X;if(i||G){const q=Number(i||1/0);for(let ee=0;ee<=q&&!(!X||!("prev"in X));ee++)X=X.prev;return X&&typeof G=="string"&&G in X&&(X=_s(_s(X,{prev:X}),X[G])),X}return X.prev?_s(X.prev,X):X});return ko(Ed,I),I}function CN(n,c){var p,v;return typeof((p=n.props)==null?void 0:p[c])<"u"||typeof((v=n.props)==null?void 0:v[Iu(c)])<"u"}function PN(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},c=arguments.length>1?arguments[1]:void 0,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:V1();const v=Bs("useDefaults");if(c=c??v.type.name??v.type.__name,!c)throw new Error("[Vuetify] Could not determine component name");const I=ct(()=>{var G;return(G=p.value)==null?void 0:G[n._as??c]}),R=new Proxy(n,{get(G,X){var ee,ne,me,he,ye,Le,je;const q=Reflect.get(G,X);return X==="class"||X==="style"?[(ee=I.value)==null?void 0:ee[X],q].filter(vt=>vt!=null):typeof X=="string"&&!CN(v.vnode,X)?((ne=I.value)==null?void 0:ne[X])!==void 0?(me=I.value)==null?void 0:me[X]:((ye=(he=p.value)==null?void 0:he.global)==null?void 0:ye[X])!==void 0?(je=(Le=p.value)==null?void 0:Le.global)==null?void 0:je[X]:q:q}}),D=Fn();Ad(()=>{if(I.value){const G=Object.entries(I.value).filter(X=>{let[q]=X;return q.startsWith(q[0].toUpperCase())});D.value=G.length?Object.fromEntries(G):void 0}else D.value=void 0});function i(){const G=MN(Ed,v);ko(Ed,ct(()=>D.value?_s((G==null?void 0:G.value)??{},D.value):G==null?void 0:G.value))}return{props:R,provideSubDefaults:i}}const RN=["top","bottom"],DN=["start","end","left","right"];function zN(n,c){let[p,v]=n.split(" ");return v||(v=Vx(RN,p)?"start":Vx(DN,p)?"top":"center"),{side:Ux(p,c),align:Ux(v,c)}}function Ux(n,c){return n==="start"?c?"right":"left":n==="end"?c?"left":"right":n}const cd=2.4,AE=.2126729,ME=.7151522,IE=.072175,LN=.55,ON=.58,kN=.57,FN=.62,Tg=.03,CE=1.45,BN=5e-4,NN=1.25,VN=1.25,UN=.078,PE=12.82051282051282,Sg=.06,jN=.001;function RE(n,c){const p=(n.r/255)**cd,v=(n.g/255)**cd,I=(n.b/255)**cd,R=(c.r/255)**cd,D=(c.g/255)**cd,i=(c.b/255)**cd;let G=p*AE+v*ME+I*IE,X=R*AE+D*ME+i*IE;if(G<=Tg&&(G+=(Tg-G)**CE),X<=Tg&&(X+=(Tg-X)**CE),Math.abs(X-G)<BN)return 0;let q;if(X>G){const ee=(X**LN-G**ON)*NN;q=ee<jN?0:ee<UN?ee-ee*PE*Sg:ee-Sg}else{const ee=(X**FN-G**kN)*VN;q=ee>-.001?0:ee>-.078?ee-ee*PE*Sg:ee+Sg}return q*100}const Jg=.20689655172413793,$N=n=>n>Jg**3?Math.cbrt(n):n/(3*Jg**2)+4/29,GN=n=>n>Jg?n**3:3*Jg**2*(n-4/29);function JI(n){const c=$N,p=c(n[1]);return[116*p-16,500*(c(n[0]/.95047)-p),200*(p-c(n[2]/1.08883))]}function QI(n){const c=GN,p=(n[0]+16)/116;return[c(p+n[1]/500)*.95047,c(p),c(p-n[2]/200)*1.08883]}const qN=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],HN=n=>n<=.0031308?n*12.92:1.055*n**(1/2.4)-.055,WN=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],ZN=n=>n<=.04045?n/12.92:((n+.055)/1.055)**2.4;function eC(n){const c=Array(3),p=HN,v=qN;for(let I=0;I<3;++I)c[I]=Math.round(Yg(p(v[I][0]*n[0]+v[I][1]*n[1]+v[I][2]*n[2]))*255);return{r:c[0],g:c[1],b:c[2]}}function U1(n){let{r:c,g:p,b:v}=n;const I=[0,0,0],R=ZN,D=WN;c=R(c/255),p=R(p/255),v=R(v/255);for(let i=0;i<3;++i)I[i]=D[i][0]*c+D[i][1]*p+D[i][2]*v;return I}function jx(n){return!!n&&/^(#|var\(--|(rgb|hsl)a?\()/.test(n)}function XN(n){return jx(n)&&!/^((rgb|hsl)a?\()?var\(--/.test(n)}const DE=/^(?<fn>(?:rgb|hsl)a?)\((?<values>.+)\)/,KN={rgb:(n,c,p,v)=>({r:n,g:c,b:p,a:v}),rgba:(n,c,p,v)=>({r:n,g:c,b:p,a:v}),hsl:(n,c,p,v)=>zE({h:n,s:c,l:p,a:v}),hsla:(n,c,p,v)=>zE({h:n,s:c,l:p,a:v}),hsv:(n,c,p,v)=>um({h:n,s:c,v:p,a:v}),hsva:(n,c,p,v)=>um({h:n,s:c,v:p,a:v})};function Ba(n){if(typeof n=="number")return{r:(n&16711680)>>16,g:(n&65280)>>8,b:n&255};if(typeof n=="string"&&DE.test(n)){const{groups:c}=n.match(DE),{fn:p,values:v}=c,I=v.split(/,\s*/).map(R=>R.endsWith("%")&&["hsl","hsla","hsv","hsva"].includes(p)?parseFloat(R)/100:parseFloat(R));return KN[p](...I)}else if(typeof n=="string"){let c=n.startsWith("#")?n.slice(1):n;return[3,4].includes(c.length)?c=c.split("").map(p=>p+p).join(""):[6,8].includes(c.length),JN(c)}else if(typeof n=="object"){if(hx(n,["r","g","b"]))return n;if(hx(n,["h","s","l"]))return um(tC(n));if(hx(n,["h","s","v"]))return um(n)}throw new TypeError(`Invalid color: ${n==null?n:String(n)||n.constructor.name}
Expected #hex, #hexa, rgb(), rgba(), hsl(), hsla(), object or number`)}function um(n){const{h:c,s:p,v,a:I}=n,R=i=>{const G=(i+c/60)%6;return v-v*p*Math.max(Math.min(G,4-G,1),0)},D=[R(5),R(3),R(1)].map(i=>Math.round(i*255));return{r:D[0],g:D[1],b:D[2],a:I}}function zE(n){return um(tC(n))}function tC(n){const{h:c,s:p,l:v,a:I}=n,R=v+p*Math.min(v,1-v),D=R===0?0:2-2*v/R;return{h:c,s:D,v:R,a:I}}function Eg(n){const c=Math.round(n).toString(16);return("00".substr(0,2-c.length)+c).toUpperCase()}function YN(n){let{r:c,g:p,b:v,a:I}=n;return`#${[Eg(c),Eg(p),Eg(v),I!==void 0?Eg(Math.round(I*255)):""].join("")}`}function JN(n){n=QN(n);let[c,p,v,I]=wN(n,2).map(R=>parseInt(R,16));return I=I===void 0?I:I/255,{r:c,g:p,b:v,a:I}}function QN(n){return n.startsWith("#")&&(n=n.slice(1)),n=n.replace(/([^0-9a-f])/gi,"F"),(n.length===3||n.length===4)&&(n=n.split("").map(c=>c+c).join("")),n.length!==6&&(n=wE(wE(n,6),8,"F")),n}function e6(n,c){const p=JI(U1(n));return p[0]=p[0]+c*10,eC(QI(p))}function t6(n,c){const p=JI(U1(n));return p[0]=p[0]-c*10,eC(QI(p))}function r6(n){const c=Ba(n);return U1(c)[1]}function rC(n){const c=Math.abs(RE(Ba(0),Ba(n)));return Math.abs(RE(Ba(16777215),Ba(n)))>Math.min(c,50)?"#fff":"#000"}function un(n,c){return p=>Object.keys(n).reduce((v,I)=>{const D=typeof n[I]=="object"&&n[I]!=null&&!Array.isArray(n[I])?n[I]:{type:n[I]};return p&&I in p?v[I]={...D,default:p[I]}:v[I]=D,c&&!v[I].source&&(v[I].source=c),v},{})}const qi=un({class:[String,Array,Object],style:{type:[String,Array,Object],default:null}},"component");function Em(n){if(n._setup=n._setup??n.setup,!n.name)return n;if(n._setup){n.props=un(n.props??{},n.name)();const c=Object.keys(n.props).filter(p=>p!=="class"&&p!=="style");n.filterProps=function(v){return xN(v,c)},n.props._as=String,n.setup=function(v,I){const R=V1();if(!R.value)return n._setup(v,I);const{props:D,provideSubDefaults:i}=PN(v,v._as??n.name,R),G=n._setup(D,I);return i(),G}}return n}function yi(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return c=>(n?Em:ei)(c)}function n6(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"div",p=arguments.length>2?arguments[2]:void 0;return yi()({name:p??xc(Fs(n.replace(/__/g,"-"))),props:{tag:{type:String,default:c},...qi()},setup(v,I){let{slots:R}=I;return()=>{var D;return yl(v.tag,{class:[n,v.class],style:v.style},(D=R.default)==null?void 0:D.call(R))}}})}function gs(n){const c=Bs("useRender");c.render=n}const i6=un({defaults:Object,disabled:Boolean,reset:[Number,String],root:[Boolean,String],scoped:Boolean},"VDefaultsProvider"),ml=yi(!1)({name:"VDefaultsProvider",props:i6(),setup(n,c){let{slots:p}=c;const{defaults:v,disabled:I,reset:R,root:D,scoped:i}=uy(n);return Ry(v,{reset:R,root:D,scoped:i,disabled:I}),()=>{var G;return(G=p.default)==null?void 0:G.call(p)}}});function j1(n){return KI(()=>{const c=[],p={};if(n.value.background)if(jx(n.value.background)){if(p.backgroundColor=n.value.background,!n.value.text&&XN(n.value.background)){const v=Ba(n.value.background);if(v.a==null||v.a===1){const I=rC(v);p.color=I,p.caretColor=I}}}else c.push(`bg-${n.value.background}`);return n.value.text&&(jx(n.value.text)?(p.color=n.value.text,p.caretColor=n.value.text):c.push(`text-${n.value.text}`)),{colorClasses:c,colorStyles:p}})}function nC(n,c){const p=ct(()=>({text:Qn(n)?n.value:c?n[c]:null})),{colorClasses:v,colorStyles:I}=j1(p);return{textColorClasses:v,textColorStyles:I}}function xd(n,c){const p=ct(()=>({background:Qn(n)?n.value:c?n[c]:null})),{colorClasses:v,colorStyles:I}=j1(p);return{backgroundColorClasses:v,backgroundColorStyles:I}}const s6={collapse:"mdi-chevron-up",complete:"mdi-check",cancel:"mdi-close-circle",close:"mdi-close",delete:"mdi-close-circle",clear:"mdi-close-circle",success:"mdi-check-circle",info:"mdi-information",warning:"mdi-alert-circle",error:"mdi-close-circle",prev:"mdi-chevron-left",next:"mdi-chevron-right",checkboxOn:"mdi-checkbox-marked",checkboxOff:"mdi-checkbox-blank-outline",checkboxIndeterminate:"mdi-minus-box",delimiter:"mdi-circle",sortAsc:"mdi-arrow-up",sortDesc:"mdi-arrow-down",expand:"mdi-chevron-down",menu:"mdi-menu",subgroup:"mdi-menu-down",dropdown:"mdi-menu-down",radioOn:"mdi-radiobox-marked",radioOff:"mdi-radiobox-blank",edit:"mdi-pencil",ratingEmpty:"mdi-star-outline",ratingFull:"mdi-star",ratingHalf:"mdi-star-half-full",loading:"mdi-cached",first:"mdi-page-first",last:"mdi-page-last",unfold:"mdi-unfold-more-horizontal",file:"mdi-paperclip",plus:"mdi-plus",minus:"mdi-minus",calendar:"mdi-calendar",treeviewCollapse:"mdi-menu-down",treeviewExpand:"mdi-menu-right",eyeDropper:"mdi-eyedropper",upload:"mdi-cloud-upload"},o6={component:n=>yl(sC,{...n,class:"mdi"})},po=[String,Function,Object,Array],$x=Symbol.for("vuetify:icons"),Dy=un({icon:{type:po},tag:{type:String,required:!0}},"icon"),LE=yi()({name:"VComponentIcon",props:Dy(),setup(n,c){let{slots:p}=c;return()=>{const v=n.icon;return dt(n.tag,null,{default:()=>{var I;return[n.icon?dt(v,null,null):(I=p.default)==null?void 0:I.call(p)]}})}}}),iC=Em({name:"VSvgIcon",inheritAttrs:!1,props:Dy(),setup(n,c){let{attrs:p}=c;return()=>dt(n.tag,Ks(p,{style:null}),{default:()=>[dt("svg",{class:"v-icon__svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true"},[Array.isArray(n.icon)?n.icon.map(v=>Array.isArray(v)?dt("path",{d:v[0],"fill-opacity":v[1]},null):dt("path",{d:v},null)):dt("path",{d:n.icon},null)])]})}});Em({name:"VLigatureIcon",props:Dy(),setup(n){return()=>dt(n.tag,null,{default:()=>[n.icon]})}});const sC=Em({name:"VClassIcon",props:Dy(),setup(n){return()=>dt(n.tag,{class:n.icon},null)}});function a6(){return{svg:{component:iC},class:{component:sC}}}function l6(n){const c=a6(),p=(n==null?void 0:n.defaultSet)??"mdi";return p==="mdi"&&!c.mdi&&(c.mdi=o6),_s({defaultSet:p,sets:c,aliases:{...s6,vuetify:["M8.2241 14.2009L12 21L22 3H14.4459L8.2241 14.2009Z",["M7.26303 12.4733L7.00113 12L2 3H12.5261C12.5261 3 12.5261 3 12.5261 3L7.26303 12.4733Z",.6]],"vuetify-outline":"svg:M7.26 12.47 12.53 3H2L7.26 12.47ZM14.45 3 8.22 14.2 12 21 22 3H14.45ZM18.6 5 12 16.88 10.51 14.2 15.62 5ZM7.26 8.35 5.4 5H9.13L7.26 8.35Z","vuetify-play":["m6.376 13.184-4.11-7.192C1.505 4.66 2.467 3 4.003 3h8.532l-.953 1.576-.006.01-.396.677c-.429.732-.214 1.507.194 2.015.404.503 1.092.878 1.869.806a3.72 3.72 0 0 1 1.005.022c.276.053.434.143.523.237.138.146.38.635-.25 2.09-.893 1.63-1.553 1.722-1.847 1.677-.213-.033-.468-.158-.756-.406a4.95 4.95 0 0 1-.8-.927c-.39-.564-1.04-.84-1.66-.846-.625-.006-1.316.27-1.693.921l-.478.826-.911 1.506Z",["M9.093 11.552c.046-.079.144-.15.32-.148a.53.53 0 0 1 .43.207c.285.414.636.847 1.046 1.2.405.35.914.662 1.516.754 1.334.205 2.502-.698 3.48-2.495l.014-.028.013-.03c.687-1.574.774-2.852-.005-3.675-.37-.391-.861-.586-1.333-.676a5.243 5.243 0 0 0-1.447-.044c-.173.016-.393-.073-.54-.257-.145-.18-.127-.316-.082-.392l.393-.672L14.287 3h5.71c1.536 0 2.499 1.659 1.737 2.992l-7.997 13.996c-.768 1.344-2.706 1.344-3.473 0l-3.037-5.314 1.377-2.278.004-.006.004-.007.481-.831Z",.6]]}},n)}const c6=n=>{const c=Hn($x);if(!c)throw new Error("Missing Vuetify Icons provide!");return{iconData:ct(()=>{var G;const v=At(n);if(!v)return{component:LE};let I=v;if(typeof I=="string"&&(I=I.trim(),I.startsWith("$")&&(I=(G=c.aliases)==null?void 0:G[I.slice(1)])),Array.isArray(I))return{component:iC,icon:I};if(typeof I!="string")return{component:LE,icon:I};const R=Object.keys(c.sets).find(X=>typeof I=="string"&&I.startsWith(`${X}:`)),D=R?I.slice(R.length+1):I;return{component:c.sets[R??c.defaultSet].component,icon:D}})}},u6=["x-small","small","default","large","x-large"],$1=un({size:{type:[String,Number],default:"default"}},"size");function G1(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tc();return KI(()=>{let p,v;return Vx(u6,n.size)?p=`${c}--size-${n.size}`:n.size&&(v={width:oi(n.size),height:oi(n.size)}),{sizeClasses:p,sizeStyles:v}})}const go=un({tag:{type:String,default:"div"}},"tag"),Qg=Symbol.for("vuetify:theme"),ku=un({theme:String},"theme");function OE(){return{defaultTheme:"light",variations:{colors:[],lighten:0,darken:0},themes:{light:{dark:!1,colors:{background:"#FFFFFF",surface:"#FFFFFF","surface-bright":"#FFFFFF","surface-light":"#EEEEEE","surface-variant":"#424242","on-surface-variant":"#EEEEEE",primary:"#1867C0","primary-darken-1":"#1F5592",secondary:"#48A9A6","secondary-darken-1":"#018786",error:"#B00020",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#000000","border-opacity":.12,"high-emphasis-opacity":.87,"medium-emphasis-opacity":.6,"disabled-opacity":.38,"idle-opacity":.04,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.12,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#F5F5F5","theme-on-code":"#000000"}},dark:{dark:!0,colors:{background:"#121212",surface:"#212121","surface-bright":"#ccbfd6","surface-light":"#424242","surface-variant":"#a3a3a3","on-surface-variant":"#424242",primary:"#2196F3","primary-darken-1":"#277CC1",secondary:"#54B6B2","secondary-darken-1":"#48A9A6",error:"#CF6679",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#FFFFFF","border-opacity":.12,"high-emphasis-opacity":1,"medium-emphasis-opacity":.7,"disabled-opacity":.5,"idle-opacity":.1,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.16,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#343434","theme-on-code":"#CCCCCC"}}}}}function h6(){var v,I;let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:OE();const c=OE();if(!n)return{...c,isDisabled:!0};const p={};for(const[R,D]of Object.entries(n.themes??{})){const i=D.dark||R==="dark"?(v=c.themes)==null?void 0:v.dark:(I=c.themes)==null?void 0:I.light;p[R]=_s(i,D)}return _s(c,{...n,themes:p})}function d6(n){const c=h6(n),p=In(c.defaultTheme),v=In(c.themes),I=ct(()=>{const q={};for(const[ee,ne]of Object.entries(v.value)){const me=q[ee]={...ne,colors:{...ne.colors}};if(c.variations)for(const he of c.variations.colors){const ye=me.colors[he];if(ye)for(const Le of["lighten","darken"]){const je=Le==="lighten"?e6:t6;for(const vt of WI(c.variations[Le],1))me.colors[`${he}-${Le}-${vt}`]=YN(je(Ba(ye),vt))}}for(const he of Object.keys(me.colors)){if(/^on-[a-z]/.test(he)||me.colors[`on-${he}`])continue;const ye=`on-${he}`,Le=Ba(me.colors[he]);me.colors[ye]=rC(Le)}}return q}),R=ct(()=>I.value[p.value]),D=ct(()=>{var he;const q=[];(he=R.value)!=null&&he.dark&&vu(q,":root",["color-scheme: dark"]),vu(q,":root",kE(R.value));for(const[ye,Le]of Object.entries(I.value))vu(q,`.v-theme--${ye}`,[`color-scheme: ${Le.dark?"dark":"normal"}`,...kE(Le)]);const ee=[],ne=[],me=new Set(Object.values(I.value).flatMap(ye=>Object.keys(ye.colors)));for(const ye of me)/^on-[a-z]/.test(ye)?vu(ne,`.${ye}`,[`color: rgb(var(--v-theme-${ye})) !important`]):(vu(ee,`.bg-${ye}`,[`--v-theme-overlay-multiplier: var(--v-theme-${ye}-overlay-multiplier)`,`background-color: rgb(var(--v-theme-${ye})) !important`,`color: rgb(var(--v-theme-on-${ye})) !important`]),vu(ne,`.text-${ye}`,[`color: rgb(var(--v-theme-${ye})) !important`]),vu(ne,`.border-${ye}`,[`--v-border-color: var(--v-theme-${ye})`]));return q.push(...ee,...ne),q.map((ye,Le)=>Le===0?ye:`    ${ye}`).join("")});function i(){return{style:[{textContent:D.value,id:"vuetify-theme-stylesheet",nonce:c.cspNonce||!1}]}}function G(q){if(c.isDisabled)return;const ee=q._context.provides.usehead;if(ee)if(ee.push){const ne=ee.push(i);ms&&zn(D,()=>{ne.patch(i)})}else ms?(ee.addHeadObjs(ct(i)),Ad(()=>ee.updateDOM())):ee.addHeadObjs(i());else{let me=function(){if(typeof document<"u"&&!ne){const he=document.createElement("style");he.type="text/css",he.id="vuetify-theme-stylesheet",c.cspNonce&&he.setAttribute("nonce",c.cspNonce),ne=he,document.head.appendChild(ne)}ne&&(ne.innerHTML=D.value)},ne=ms?document.getElementById("vuetify-theme-stylesheet"):null;ms?zn(D,me,{immediate:!0}):me()}}const X=ct(()=>c.isDisabled?void 0:`v-theme--${p.value}`);return{install:G,isDisabled:c.isDisabled,name:p,themes:v,current:R,computedThemes:I,themeClasses:X,styles:D,global:{name:p,current:R}}}function Fu(n){Bs("provideTheme");const c=Hn(Qg,null);if(!c)throw new Error("Could not find Vuetify theme injection");const p=ct(()=>n.theme??c.name.value),v=ct(()=>c.themes.value[p.value]),I=ct(()=>c.isDisabled?void 0:`v-theme--${p.value}`),R={...c,name:p,current:v,themeClasses:I};return ko(Qg,R),R}function vu(n,c,p){n.push(`${c} {
`,...p.map(v=>`  ${v};
`),`}
`)}function kE(n){const c=n.dark?2:1,p=n.dark?1:2,v=[];for(const[I,R]of Object.entries(n.colors)){const D=Ba(R);v.push(`--v-theme-${I}: ${D.r},${D.g},${D.b}`),I.startsWith("on-")||v.push(`--v-theme-${I}-overlay-multiplier: ${r6(R)>.18?c:p}`)}for(const[I,R]of Object.entries(n.variables)){const D=typeof R=="string"&&R.startsWith("#")?Ba(R):void 0,i=D?`${D.r}, ${D.g}, ${D.b}`:void 0;v.push(`--v-${I}: ${i??R}`)}return v}const f6=un({color:String,disabled:Boolean,start:Boolean,end:Boolean,icon:po,...qi(),...$1(),...go({tag:"i"}),...ku()},"VIcon"),oa=yi()({name:"VIcon",props:f6(),setup(n,c){let{attrs:p,slots:v}=c;const I=In(),{themeClasses:R}=Fu(n),{iconData:D}=c6(ct(()=>I.value||n.icon)),{sizeClasses:i}=G1(n),{textColorClasses:G,textColorStyles:X}=nC(ps(n,"color"));return gs(()=>{var ne,me;const q=(ne=v.default)==null?void 0:ne.call(v);q&&(I.value=(me=XI(q).filter(he=>he.type===Md&&he.children&&typeof he.children=="string")[0])==null?void 0:me.children);const ee=!!(p.onClick||p.onClickOnce);return dt(D.value.component,{tag:n.tag,icon:D.value.icon,class:["v-icon","notranslate",R.value,i.value,G.value,{"v-icon--clickable":ee,"v-icon--disabled":n.disabled,"v-icon--start":n.start,"v-icon--end":n.end},n.class],style:[i.value?void 0:{fontSize:oi(n.size),height:oi(n.size),width:oi(n.size)},X.value,n.style],role:ee?"button":void 0,"aria-hidden":!ee,tabindex:ee?n.disabled?-1:0:void 0},{default:()=>[q]})}),{}}}),Am=un({height:[Number,String],maxHeight:[Number,String],maxWidth:[Number,String],minHeight:[Number,String],minWidth:[Number,String],width:[Number,String]},"dimension");function Mm(n){return{dimensionStyles:ct(()=>{const p={},v=oi(n.height),I=oi(n.maxHeight),R=oi(n.maxWidth),D=oi(n.minHeight),i=oi(n.minWidth),G=oi(n.width);return v!=null&&(p.height=v),I!=null&&(p.maxHeight=I),R!=null&&(p.maxWidth=R),D!=null&&(p.minHeight=D),i!=null&&(p.minWidth=i),G!=null&&(p.width=G),p})}}function p6(n){return{aspectStyles:ct(()=>{const c=Number(n.aspectRatio);return c?{paddingBottom:String(1/c*100)+"%"}:void 0})}}const oC=un({aspectRatio:[String,Number],contentClass:null,inline:Boolean,...qi(),...Am()},"VResponsive"),FE=yi()({name:"VResponsive",props:oC(),setup(n,c){let{slots:p}=c;const{aspectStyles:v}=p6(n),{dimensionStyles:I}=Mm(n);return gs(()=>{var R;return dt("div",{class:["v-responsive",{"v-responsive--inline":n.inline},n.class],style:[I.value,n.style]},[dt("div",{class:"v-responsive__sizer",style:v.value},null),(R=p.additional)==null?void 0:R.call(p),p.default&&dt("div",{class:["v-responsive__content",n.contentClass]},[p.default()])])}),{}}}),Rd=un({rounded:{type:[Boolean,Number,String],default:void 0},tile:Boolean},"rounded");function Dd(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tc();return{roundedClasses:ct(()=>{const v=Qn(n)?n.value:n.rounded,I=Qn(n)?n.value:n.tile,R=[];if(v===!0||v==="")R.push(`${c}--rounded`);else if(typeof v=="string"||v===0)for(const D of String(v).split(" "))R.push(`rounded-${D}`);else(I||v===!1)&&R.push("rounded-0");return R})}}const m6=un({transition:{type:[Boolean,String,Object],default:"fade-transition",validator:n=>n!==!0}},"transition"),Ag=(n,c)=>{let{slots:p}=c;const{transition:v,disabled:I,group:R,...D}=n,{component:i=R?x1:ym,...G}=typeof v=="object"?v:{};return yl(i,Ks(typeof v=="string"?{name:I?"":v}:G,typeof v=="string"?{}:Object.fromEntries(Object.entries({disabled:I,group:R}).filter(X=>{let[q,ee]=X;return ee!==void 0})),D),p)};function _6(n,c){if(!N1)return;const p=c.modifiers||{},v=c.value,{handler:I,options:R}=typeof v=="object"?v:{handler:v,options:{}},D=new IntersectionObserver(function(){var ee;let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],G=arguments.length>1?arguments[1]:void 0;const X=(ee=n._observe)==null?void 0:ee[c.instance.$.uid];if(!X)return;const q=i.some(ne=>ne.isIntersecting);I&&(!p.quiet||X.init)&&(!p.once||q||X.init)&&I(q,i,G),q&&p.once?aC(n,c):X.init=!0},R);n._observe=Object(n._observe),n._observe[c.instance.$.uid]={init:!1,observer:D},D.observe(n)}function aC(n,c){var v;const p=(v=n._observe)==null?void 0:v[c.instance.$.uid];p&&(p.observer.unobserve(n),delete n._observe[c.instance.$.uid])}const g6={mounted:_6,unmounted:aC},y6=un({absolute:Boolean,alt:String,cover:Boolean,color:String,draggable:{type:[Boolean,String],default:void 0},eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},crossorigin:String,referrerpolicy:String,srcset:String,position:String,...oC(),...qi(),...Rd(),...m6()},"VImg"),zy=yi()({name:"VImg",directives:{intersect:g6},props:y6(),emits:{loadstart:n=>!0,load:n=>!0,error:n=>!0},setup(n,c){let{emit:p,slots:v}=c;const{backgroundColorClasses:I,backgroundColorStyles:R}=xd(ps(n,"color")),{roundedClasses:D}=Dd(n),i=Bs("VImg"),G=Fn(""),X=In(),q=Fn(n.eager?"loading":"idle"),ee=Fn(),ne=Fn(),me=ct(()=>n.src&&typeof n.src=="object"?{src:n.src.src,srcset:n.srcset||n.src.srcset,lazySrc:n.lazySrc||n.src.lazySrc,aspect:Number(n.aspectRatio||n.src.aspect||0)}:{src:n.src,srcset:n.srcset,lazySrc:n.lazySrc,aspect:Number(n.aspectRatio||0)}),he=ct(()=>me.value.aspect||ee.value/ne.value||0);zn(()=>n.src,()=>{ye(q.value!=="idle")}),zn(he,(yt,ir)=>{!yt&&ir&&X.value&&ut(X.value)}),XA(()=>ye());function ye(yt){if(!(n.eager&&yt)&&!(N1&&!yt&&!n.eager)){if(q.value="loading",me.value.lazySrc){const ir=new Image;ir.src=me.value.lazySrc,ut(ir,null)}me.value.src&&Ws(()=>{var ir;p("loadstart",((ir=X.value)==null?void 0:ir.currentSrc)||me.value.src),setTimeout(()=>{var zr;if(!i.isUnmounted)if((zr=X.value)!=null&&zr.complete){if(X.value.naturalWidth||je(),q.value==="error")return;he.value||ut(X.value,null),q.value==="loading"&&Le()}else he.value||ut(X.value),vt()})})}}function Le(){var yt;i.isUnmounted||(vt(),ut(X.value),q.value="loaded",p("load",((yt=X.value)==null?void 0:yt.currentSrc)||me.value.src))}function je(){var yt;i.isUnmounted||(q.value="error",p("error",((yt=X.value)==null?void 0:yt.currentSrc)||me.value.src))}function vt(){const yt=X.value;yt&&(G.value=yt.currentSrc||yt.src)}let Dt=-1;Na(()=>{clearTimeout(Dt)});function ut(yt){let ir=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const zr=()=>{if(clearTimeout(Dt),i.isUnmounted)return;const{naturalHeight:Zt,naturalWidth:Ir}=yt;Zt||Ir?(ee.value=Ir,ne.value=Zt):!yt.complete&&q.value==="loading"&&ir!=null?Dt=window.setTimeout(zr,ir):(yt.currentSrc.endsWith(".svg")||yt.currentSrc.startsWith("data:image/svg+xml"))&&(ee.value=1,ne.value=1)};zr()}const ht=ct(()=>({"v-img__img--cover":n.cover,"v-img__img--contain":!n.cover})),St=()=>{var zr;if(!me.value.src||q.value==="idle")return null;const yt=dt("img",{class:["v-img__img",ht.value],style:{objectPosition:n.position},crossorigin:n.crossorigin,src:me.value.src,srcset:me.value.srcset,alt:n.alt,referrerpolicy:n.referrerpolicy,draggable:n.draggable,sizes:n.sizes,ref:X,onLoad:Le,onError:je},null),ir=(zr=v.sources)==null?void 0:zr.call(v);return dt(Ag,{transition:n.transition,appear:!0},{default:()=>[Qp(ir?dt("picture",{class:"v-img__picture"},[ir,yt]):yt,[[IM,q.value==="loaded"]])]})},tt=()=>dt(Ag,{transition:n.transition},{default:()=>[me.value.lazySrc&&q.value!=="loaded"&&dt("img",{class:["v-img__img","v-img__img--preload",ht.value],style:{objectPosition:n.position},crossorigin:n.crossorigin,src:me.value.lazySrc,alt:n.alt,referrerpolicy:n.referrerpolicy,draggable:n.draggable},null)]}),Et=()=>v.placeholder?dt(Ag,{transition:n.transition,appear:!0},{default:()=>[(q.value==="loading"||q.value==="error"&&!v.error)&&dt("div",{class:"v-img__placeholder"},[v.placeholder()])]}):null,pt=()=>v.error?dt(Ag,{transition:n.transition,appear:!0},{default:()=>[q.value==="error"&&dt("div",{class:"v-img__error"},[v.error()])]}):null,ot=()=>n.gradient?dt("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${n.gradient})`}},null):null,gt=Fn(!1);{const yt=zn(he,ir=>{ir&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{gt.value=!0})}),yt())})}return gs(()=>{const yt=FE.filterProps(n);return Qp(dt(FE,Ks({class:["v-img",{"v-img--absolute":n.absolute,"v-img--booting":!gt.value},I.value,D.value,n.class],style:[{width:oi(n.width==="auto"?ee.value:n.width)},R.value,n.style]},yt,{aspectRatio:he.value,"aria-label":n.alt,role:n.alt?"img":void 0}),{additional:()=>dt(ti,null,[dt(St,null,null),dt(tt,null,null),dt(ot,null,null),dt(Et,null,null),dt(pt,null,null)]),default:v.default}),[[p1("intersect"),{handler:ye,options:n.options},null,{once:!0}]])}),{currentSrc:G,image:X,state:q,naturalWidth:ee,naturalHeight:ne}}}),Ly=un({border:[Boolean,Number,String]},"border");function Oy(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tc();return{borderClasses:ct(()=>{const v=Qn(n)?n.value:n.border,I=[];if(v===!0||v==="")I.push(`${c}--border`);else if(typeof v=="string"||v===0)for(const R of String(v).split(" "))I.push(`border-${R}`);return I})}}const v6=[null,"default","comfortable","compact"],ky=un({density:{type:String,default:"default",validator:n=>v6.includes(n)}},"density");function q1(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tc();return{densityClasses:ct(()=>`${c}--density-${n.density}`)}}const x6=["elevated","flat","tonal","outlined","text","plain"];function H1(n,c){return dt(ti,null,[n&&dt("span",{key:"overlay",class:`${c}__overlay`},null),dt("span",{key:"underlay",class:`${c}__underlay`},null)])}const Fy=un({color:String,variant:{type:String,default:"elevated",validator:n=>x6.includes(n)}},"variant");function W1(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tc();const p=ct(()=>{const{variant:R}=At(n);return`${c}--variant-${R}`}),{colorClasses:v,colorStyles:I}=j1(ct(()=>{const{variant:R,color:D}=At(n);return{[["elevated","flat"].includes(R)?"background":"text"]:D}}));return{colorClasses:v,colorStyles:I,variantClasses:p}}const b6=un({start:Boolean,end:Boolean,icon:po,image:String,text:String,...Ly(),...qi(),...ky(),...Rd(),...$1(),...go(),...ku(),...Fy({variant:"flat"})},"VAvatar"),hm=yi()({name:"VAvatar",props:b6(),setup(n,c){let{slots:p}=c;const{themeClasses:v}=Fu(n),{borderClasses:I}=Oy(n),{colorClasses:R,colorStyles:D,variantClasses:i}=W1(n),{densityClasses:G}=q1(n),{roundedClasses:X}=Dd(n),{sizeClasses:q,sizeStyles:ee}=G1(n);return gs(()=>dt(n.tag,{class:["v-avatar",{"v-avatar--start":n.start,"v-avatar--end":n.end},v.value,I.value,R.value,G.value,X.value,q.value,i.value,n.class],style:[D.value,ee.value,n.style]},{default:()=>[p.default?dt(ml,{key:"content-defaults",defaults:{VImg:{cover:!0,src:n.image},VIcon:{icon:n.icon}}},{default:()=>[p.default()]}):n.image?dt(zy,{key:"image",src:n.image,alt:"",cover:!0},null):n.icon?dt(oa,{key:"icon",icon:n.icon},null):n.text,H1(!1,"v-avatar")]})),{}}}),w6=yi()({name:"VCardActions",props:qi(),setup(n,c){let{slots:p}=c;return Ry({VBtn:{slim:!0,variant:"text"}}),gs(()=>{var v;return dt("div",{class:["v-card-actions",n.class],style:n.style},[(v=p.default)==null?void 0:v.call(p)])}),{}}}),T6=un({opacity:[Number,String],...qi(),...go()},"VCardSubtitle"),S6=yi()({name:"VCardSubtitle",props:T6(),setup(n,c){let{slots:p}=c;return gs(()=>dt(n.tag,{class:["v-card-subtitle",n.class],style:[{"--v-card-subtitle-opacity":n.opacity},n.style]},p)),{}}}),E6=n6("v-card-title"),A6=un({appendAvatar:String,appendIcon:po,prependAvatar:String,prependIcon:po,subtitle:{type:[String,Number,Boolean],default:void 0},title:{type:[String,Number,Boolean],default:void 0},...qi(),...ky()},"VCardItem"),M6=yi()({name:"VCardItem",props:A6(),setup(n,c){let{slots:p}=c;return gs(()=>{var X;const v=!!(n.prependAvatar||n.prependIcon),I=!!(v||p.prepend),R=!!(n.appendAvatar||n.appendIcon),D=!!(R||p.append),i=!!(n.title!=null||p.title),G=!!(n.subtitle!=null||p.subtitle);return dt("div",{class:["v-card-item",n.class],style:n.style},[I&&dt("div",{key:"prepend",class:"v-card-item__prepend"},[p.prepend?dt(ml,{key:"prepend-defaults",disabled:!v,defaults:{VAvatar:{density:n.density,image:n.prependAvatar},VIcon:{density:n.density,icon:n.prependIcon}}},p.prepend):dt(ti,null,[n.prependAvatar&&dt(hm,{key:"prepend-avatar",density:n.density,image:n.prependAvatar},null),n.prependIcon&&dt(oa,{key:"prepend-icon",density:n.density,icon:n.prependIcon},null)])]),dt("div",{class:"v-card-item__content"},[i&&dt(E6,{key:"title"},{default:()=>{var q;return[((q=p.title)==null?void 0:q.call(p))??Zs(n.title)]}}),G&&dt(S6,{key:"subtitle"},{default:()=>{var q;return[((q=p.subtitle)==null?void 0:q.call(p))??Zs(n.subtitle)]}}),(X=p.default)==null?void 0:X.call(p)]),D&&dt("div",{key:"append",class:"v-card-item__append"},[p.append?dt(ml,{key:"append-defaults",disabled:!R,defaults:{VAvatar:{density:n.density,image:n.appendAvatar},VIcon:{density:n.density,icon:n.appendIcon}}},p.append):dt(ti,null,[n.appendIcon&&dt(oa,{key:"append-icon",density:n.density,icon:n.appendIcon},null),n.appendAvatar&&dt(hm,{key:"append-avatar",density:n.density,image:n.appendAvatar},null)])])])}),{}}}),I6=un({opacity:[Number,String],...qi(),...go()},"VCardText"),lC=yi()({name:"VCardText",props:I6(),setup(n,c){let{slots:p}=c;return gs(()=>dt(n.tag,{class:["v-card-text",n.class],style:[{"--v-card-text-opacity":n.opacity},n.style]},p)),{}}}),Z1=un({elevation:{type:[Number,String],validator(n){const c=parseInt(n);return!isNaN(c)&&c>=0&&c<=24}}},"elevation");function X1(n){return{elevationClasses:ct(()=>{const p=Qn(n)?n.value:n.elevation,v=[];return p==null||v.push(`elevation-${p}`),v})}}function C6(n,c){const p=In(),v=Fn(!1);if(N1){const I=new IntersectionObserver(R=>{v.value=!!R.find(D=>D.isIntersecting)},c);Na(()=>{I.disconnect()}),zn(p,(R,D)=>{D&&(I.unobserve(D),v.value=!1),R&&I.observe(R)},{flush:"post"})}return{intersectionRef:p,isIntersecting:v}}function Xp(n,c){let p;function v(){p=Qx(),p.run(()=>c.length?c(()=>{p==null||p.stop(),v()}):c())}zn(n,I=>{I&&!p?v():I||(p==null||p.stop(),p=void 0)},{immediate:!0}),ly(()=>{p==null||p.stop()})}function Im(n,c,p){let v=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ee=>ee,I=arguments.length>4&&arguments[4]!==void 0?arguments[4]:ee=>ee;const R=Bs("useProxiedModel"),D=In(n[c]!==void 0?n[c]:p),i=Iu(c),X=ct(i!==c?()=>{var ee,ne,me,he;return n[c],!!(((ee=R.vnode.props)!=null&&ee.hasOwnProperty(c)||(ne=R.vnode.props)!=null&&ne.hasOwnProperty(i))&&((me=R.vnode.props)!=null&&me.hasOwnProperty(`onUpdate:${c}`)||(he=R.vnode.props)!=null&&he.hasOwnProperty(`onUpdate:${i}`)))}:()=>{var ee,ne;return n[c],!!((ee=R.vnode.props)!=null&&ee.hasOwnProperty(c)&&((ne=R.vnode.props)!=null&&ne.hasOwnProperty(`onUpdate:${c}`)))});Xp(()=>!X.value,()=>{zn(()=>n[c],ee=>{D.value=ee})});const q=ct({get(){const ee=n[c];return v(X.value?ee:D.value)},set(ee){const ne=I(ee),me=Mn(X.value?n[c]:D.value);me===ne||v(me)===ee||(D.value=ne,R==null||R.emit(`update:${c}`,ne))}});return Object.defineProperty(q,"externalValue",{get:()=>X.value?n[c]:D.value}),q}const P6={badge:"Badge",open:"Open",close:"Close",dismiss:"Dismiss",confirmEdit:{ok:"OK",cancel:"Cancel"},dataIterator:{noResultsText:"No matching records found",loadingText:"Loading items..."},dataTable:{itemsPerPageText:"Rows per page:",ariaLabel:{sortDescending:"Sorted descending.",sortAscending:"Sorted ascending.",sortNone:"Not sorted.",activateNone:"Activate to remove sorting.",activateDescending:"Activate to sort descending.",activateAscending:"Activate to sort ascending."},sortBy:"Sort by"},dataFooter:{itemsPerPageText:"Items per page:",itemsPerPageAll:"All",nextPage:"Next page",prevPage:"Previous page",firstPage:"First page",lastPage:"Last page",pageText:"{0}-{1} of {2}"},dateRangeInput:{divider:"to"},datePicker:{itemsSelected:"{0} selected",range:{title:"Select dates",header:"Enter dates"},title:"Select date",header:"Enter date",input:{placeholder:"Enter date"}},noDataText:"No data available",carousel:{prev:"Previous visual",next:"Next visual",ariaLabel:{delimiter:"Carousel slide {0} of {1}"}},calendar:{moreEvents:"{0} more",today:"Today"},input:{clear:"Clear {0}",prependAction:"{0} prepended action",appendAction:"{0} appended action",otp:"Please enter OTP character {0}"},fileInput:{counter:"{0} files",counterSize:"{0} files ({1} in total)"},fileUpload:{title:"Drag and drop files here",divider:"or",browse:"Browse Files"},timePicker:{am:"AM",pm:"PM",title:"Select Time"},pagination:{ariaLabel:{root:"Pagination Navigation",next:"Next page",previous:"Previous page",page:"Go to page {0}",currentPage:"Page {0}, Current page",first:"First page",last:"Last page"}},stepper:{next:"Next",prev:"Previous"},rating:{ariaLabel:{item:"Rating {0} of {1}"}},loading:"Loading...",infiniteScroll:{loadMore:"Load more",empty:"No more"}},BE="$vuetify.",NE=(n,c)=>n.replace(/\{(\d+)\}/g,(p,v)=>String(c[Number(v)])),cC=(n,c,p)=>function(v){for(var I=arguments.length,R=new Array(I>1?I-1:0),D=1;D<I;D++)R[D-1]=arguments[D];if(!v.startsWith(BE))return NE(v,R);const i=v.replace(BE,""),G=n.value&&p.value[n.value],X=c.value&&p.value[c.value];let q=vE(G,i,null);return q||(`${v}${n.value}`,q=vE(X,i,null)),q||(q=v),typeof q!="string"&&(q=v),NE(q,R)};function uC(n,c){return(p,v)=>new Intl.NumberFormat([n.value,c.value],v).format(p)}function dx(n,c,p){const v=Im(n,c,n[c]??p.value);return v.value=n[c]??p.value,zn(p,I=>{n[c]==null&&(v.value=p.value)}),v}function hC(n){return c=>{const p=dx(c,"locale",n.current),v=dx(c,"fallback",n.fallback),I=dx(c,"messages",n.messages);return{name:"vuetify",current:p,fallback:v,messages:I,t:cC(p,v,I),n:uC(p,v),provide:hC({current:p,fallback:v,messages:I})}}}function R6(n){const c=Fn((n==null?void 0:n.locale)??"en"),p=Fn((n==null?void 0:n.fallback)??"en"),v=In({en:P6,...n==null?void 0:n.messages});return{name:"vuetify",current:c,fallback:p,messages:v,t:cC(c,p,v),n:uC(c,p),provide:hC({current:c,fallback:p,messages:v})}}const ey=Symbol.for("vuetify:locale");function D6(n){return n.name!=null}function z6(n){const c=n!=null&&n.adapter&&D6(n==null?void 0:n.adapter)?n==null?void 0:n.adapter:R6(n),p=k6(c,n);return{...c,...p}}function L6(){const n=Hn(ey);if(!n)throw new Error("[Vuetify] Could not find injected locale instance");return n}function O6(){return{af:!1,ar:!0,bg:!1,ca:!1,ckb:!1,cs:!1,de:!1,el:!1,en:!1,es:!1,et:!1,fa:!0,fi:!1,fr:!1,hr:!1,hu:!1,he:!0,id:!1,it:!1,ja:!1,km:!1,ko:!1,lv:!1,lt:!1,nl:!1,no:!1,pl:!1,pt:!1,ro:!1,ru:!1,sk:!1,sl:!1,srCyrl:!1,srLatn:!1,sv:!1,th:!1,tr:!1,az:!1,uk:!1,vi:!1,zhHans:!1,zhHant:!1}}function k6(n,c){const p=In((c==null?void 0:c.rtl)??O6()),v=ct(()=>p.value[n.current.value]??!1);return{isRtl:v,rtl:p,rtlClasses:ct(()=>`v-locale--is-${v.value?"rtl":"ltr"}`)}}function zd(){const n=Hn(ey);if(!n)throw new Error("[Vuetify] Could not find injected rtl instance");return{isRtl:n.isRtl,rtlClasses:n.rtlClasses}}const VE={center:"center",top:"bottom",bottom:"top",left:"right",right:"left"},dC=un({location:String},"location");function fC(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,p=arguments.length>2?arguments[2]:void 0;const{isRtl:v}=zd();return{locationStyles:ct(()=>{if(!n.location)return{};const{side:R,align:D}=zN(n.location.split(" ").length>1?n.location:`${n.location} center`,v.value);function i(X){return p?p(X):0}const G={};return R!=="center"&&(c?G[VE[R]]=`calc(100% - ${i(R)}px)`:G[R]=0),D!=="center"?c?G[VE[D]]=`calc(100% - ${i(D)}px)`:G[D]=0:(R==="center"?G.top=G.left="50%":G[{top:"left",bottom:"left",left:"top",right:"top"}[R]]="50%",G.transform={top:"translateX(-50%)",bottom:"translateX(-50%)",left:"translateY(-50%)",right:"translateY(-50%)",center:"translate(-50%, -50%)"}[R]),G})}}const F6=un({absolute:Boolean,active:{type:Boolean,default:!0},bgColor:String,bgOpacity:[Number,String],bufferValue:{type:[Number,String],default:0},bufferColor:String,bufferOpacity:[Number,String],clickable:Boolean,color:String,height:{type:[Number,String],default:4},indeterminate:Boolean,max:{type:[Number,String],default:100},modelValue:{type:[Number,String],default:0},opacity:[Number,String],reverse:Boolean,stream:Boolean,striped:Boolean,roundedBar:Boolean,...qi(),...dC({location:"top"}),...Rd(),...go(),...ku()},"VProgressLinear"),B6=yi()({name:"VProgressLinear",props:F6(),emits:{"update:modelValue":n=>!0},setup(n,c){var gt;let{slots:p}=c;const v=Im(n,"modelValue"),{isRtl:I,rtlClasses:R}=zd(),{themeClasses:D}=Fu(n),{locationStyles:i}=fC(n),{textColorClasses:G,textColorStyles:X}=nC(n,"color"),{backgroundColorClasses:q,backgroundColorStyles:ee}=xd(ct(()=>n.bgColor||n.color)),{backgroundColorClasses:ne,backgroundColorStyles:me}=xd(ct(()=>n.bufferColor||n.bgColor||n.color)),{backgroundColorClasses:he,backgroundColorStyles:ye}=xd(n,"color"),{roundedClasses:Le}=Dd(n),{intersectionRef:je,isIntersecting:vt}=C6(),Dt=ct(()=>parseFloat(n.max)),ut=ct(()=>parseFloat(n.height)),ht=ct(()=>Yg(parseFloat(n.bufferValue)/Dt.value*100,0,100)),St=ct(()=>Yg(parseFloat(v.value)/Dt.value*100,0,100)),tt=ct(()=>I.value!==n.reverse),Et=ct(()=>n.indeterminate?"fade-transition":"slide-x-transition"),pt=ms&&((gt=window.matchMedia)==null?void 0:gt.call(window,"(forced-colors: active)").matches);function ot(yt){if(!je.value)return;const{left:ir,right:zr,width:Zt}=je.value.getBoundingClientRect(),Ir=tt.value?Zt-yt.clientX+(zr-Zt):yt.clientX-ir;v.value=Math.round(Ir/Zt*Dt.value)}return gs(()=>dt(n.tag,{ref:je,class:["v-progress-linear",{"v-progress-linear--absolute":n.absolute,"v-progress-linear--active":n.active&&vt.value,"v-progress-linear--reverse":tt.value,"v-progress-linear--rounded":n.rounded,"v-progress-linear--rounded-bar":n.roundedBar,"v-progress-linear--striped":n.striped},Le.value,D.value,R.value,n.class],style:[{bottom:n.location==="bottom"?0:void 0,top:n.location==="top"?0:void 0,height:n.active?oi(ut.value):0,"--v-progress-linear-height":oi(ut.value),...n.absolute?i.value:{}},n.style],role:"progressbar","aria-hidden":n.active?"false":"true","aria-valuemin":"0","aria-valuemax":n.max,"aria-valuenow":n.indeterminate?void 0:Math.min(parseFloat(v.value),Dt.value),onClick:n.clickable&&ot},{default:()=>[n.stream&&dt("div",{key:"stream",class:["v-progress-linear__stream",G.value],style:{...X.value,[tt.value?"left":"right"]:oi(-ut.value),borderTop:`${oi(ut.value/2)} dotted`,opacity:parseFloat(n.bufferOpacity),top:`calc(50% - ${oi(ut.value/4)})`,width:oi(100-ht.value,"%"),"--v-progress-linear-stream-to":oi(ut.value*(tt.value?1:-1))}},null),dt("div",{class:["v-progress-linear__background",pt?void 0:q.value],style:[ee.value,{opacity:parseFloat(n.bgOpacity),width:n.stream?0:void 0}]},null),dt("div",{class:["v-progress-linear__buffer",pt?void 0:ne.value],style:[me.value,{opacity:parseFloat(n.bufferOpacity),width:oi(ht.value,"%")}]},null),dt(ym,{name:Et.value},{default:()=>[n.indeterminate?dt("div",{class:"v-progress-linear__indeterminate"},[["long","short"].map(yt=>dt("div",{key:yt,class:["v-progress-linear__indeterminate",yt,pt?void 0:he.value],style:ye.value},null))]):dt("div",{class:["v-progress-linear__determinate",pt?void 0:he.value],style:[ye.value,{width:oi(St.value,"%")}]},null)]}),p.default&&dt("div",{class:"v-progress-linear__content"},[p.default({value:St.value,buffer:ht.value})])]})),{}}}),N6=un({loading:[Boolean,String]},"loader");function V6(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tc();return{loaderClasses:ct(()=>({[`${c}--loading`]:n.loading}))}}function U6(n,c){var v;let{slots:p}=c;return dt("div",{class:`${n.name}__loader`},[((v=p.default)==null?void 0:v.call(p,{color:n.color,isActive:n.active}))||dt(B6,{absolute:n.absolute,active:n.active,color:n.color,height:"2",indeterminate:!0},null)])}const j6=["static","relative","fixed","absolute","sticky"],$6=un({position:{type:String,validator:n=>j6.includes(n)}},"position");function G6(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tc();return{positionClasses:ct(()=>n.position?`${c}--${n.position}`:void 0)}}function q6(){const n=Bs("useRoute");return ct(()=>{var c;return(c=n==null?void 0:n.proxy)==null?void 0:c.$route})}function H6(){var n,c;return(c=(n=Bs("useRouter"))==null?void 0:n.proxy)==null?void 0:c.$router}function pC(n,c){var ee,ne;const p=uo("RouterLink"),v=ct(()=>!!(n.href||n.to)),I=ct(()=>(v==null?void 0:v.value)||EE(c,"click")||EE(n,"click"));if(typeof p=="string"||!("useLink"in p)){const me=ps(n,"href");return{isLink:v,isClickable:I,href:me,linkProps:Zi({href:me})}}const R=ct(()=>({...n,to:ps(()=>n.to||"")})),D=p.useLink(R.value),i=ct(()=>n.to?D:void 0),G=q6(),X=ct(()=>{var me,he,ye;return i.value?n.exact?G.value?((ye=i.value.isExactActive)==null?void 0:ye.value)&&Cy(i.value.route.value.query,G.value.query):((he=i.value.isExactActive)==null?void 0:he.value)??!1:((me=i.value.isActive)==null?void 0:me.value)??!1:!1}),q=ct(()=>{var me;return n.to?(me=i.value)==null?void 0:me.route.value.href:n.href});return{isLink:v,isClickable:I,isActive:X,route:(ee=i.value)==null?void 0:ee.route,navigate:(ne=i.value)==null?void 0:ne.navigate,href:q,linkProps:Zi({href:q,"aria-current":ct(()=>X.value?"page":void 0)})}}const mC=un({href:String,replace:Boolean,to:[String,Object],exact:Boolean},"router"),Gx=Symbol("rippleStop"),W6=80;function UE(n,c){n.style.transform=c,n.style.webkitTransform=c}function qx(n){return n.constructor.name==="TouchEvent"}function _C(n){return n.constructor.name==="KeyboardEvent"}const Z6=function(n,c){var ee;let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},v=0,I=0;if(!_C(n)){const ne=c.getBoundingClientRect(),me=qx(n)?n.touches[n.touches.length-1]:n;v=me.clientX-ne.left,I=me.clientY-ne.top}let R=0,D=.3;(ee=c._ripple)!=null&&ee.circle?(D=.15,R=c.clientWidth/2,R=p.center?R:R+Math.sqrt((v-R)**2+(I-R)**2)/4):R=Math.sqrt(c.clientWidth**2+c.clientHeight**2)/2;const i=`${(c.clientWidth-R*2)/2}px`,G=`${(c.clientHeight-R*2)/2}px`,X=p.center?i:`${v-R}px`,q=p.center?G:`${I-R}px`;return{radius:R,scale:D,x:X,y:q,centerX:i,centerY:G}},ty={show(n,c){var me;let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!((me=c==null?void 0:c._ripple)!=null&&me.enabled))return;const v=document.createElement("span"),I=document.createElement("span");v.appendChild(I),v.className="v-ripple__container",p.class&&(v.className+=` ${p.class}`);const{radius:R,scale:D,x:i,y:G,centerX:X,centerY:q}=Z6(n,c,p),ee=`${R*2}px`;I.className="v-ripple__animation",I.style.width=ee,I.style.height=ee,c.appendChild(v);const ne=window.getComputedStyle(c);ne&&ne.position==="static"&&(c.style.position="relative",c.dataset.previousPosition="static"),I.classList.add("v-ripple__animation--enter"),I.classList.add("v-ripple__animation--visible"),UE(I,`translate(${i}, ${G}) scale3d(${D},${D},${D})`),I.dataset.activated=String(performance.now()),requestAnimationFrame(()=>{requestAnimationFrame(()=>{I.classList.remove("v-ripple__animation--enter"),I.classList.add("v-ripple__animation--in"),UE(I,`translate(${X}, ${q}) scale3d(1,1,1)`)})})},hide(n){var R;if(!((R=n==null?void 0:n._ripple)!=null&&R.enabled))return;const c=n.getElementsByClassName("v-ripple__animation");if(c.length===0)return;const p=c[c.length-1];if(p.dataset.isHiding)return;p.dataset.isHiding="true";const v=performance.now()-Number(p.dataset.activated),I=Math.max(250-v,0);setTimeout(()=>{p.classList.remove("v-ripple__animation--in"),p.classList.add("v-ripple__animation--out"),setTimeout(()=>{var i;n.getElementsByClassName("v-ripple__animation").length===1&&n.dataset.previousPosition&&(n.style.position=n.dataset.previousPosition,delete n.dataset.previousPosition),((i=p.parentNode)==null?void 0:i.parentNode)===n&&n.removeChild(p.parentNode)},300)},I)}};function gC(n){return typeof n>"u"||!!n}function dm(n){const c={},p=n.currentTarget;if(!(!(p!=null&&p._ripple)||p._ripple.touched||n[Gx])){if(n[Gx]=!0,qx(n))p._ripple.touched=!0,p._ripple.isTouch=!0;else if(p._ripple.isTouch)return;if(c.center=p._ripple.centered||_C(n),p._ripple.class&&(c.class=p._ripple.class),qx(n)){if(p._ripple.showTimerCommit)return;p._ripple.showTimerCommit=()=>{ty.show(n,p,c)},p._ripple.showTimer=window.setTimeout(()=>{var v;(v=p==null?void 0:p._ripple)!=null&&v.showTimerCommit&&(p._ripple.showTimerCommit(),p._ripple.showTimerCommit=null)},W6)}else ty.show(n,p,c)}}function jE(n){n[Gx]=!0}function ho(n){const c=n.currentTarget;if(c!=null&&c._ripple){if(window.clearTimeout(c._ripple.showTimer),n.type==="touchend"&&c._ripple.showTimerCommit){c._ripple.showTimerCommit(),c._ripple.showTimerCommit=null,c._ripple.showTimer=window.setTimeout(()=>{ho(n)});return}window.setTimeout(()=>{c._ripple&&(c._ripple.touched=!1)}),ty.hide(c)}}function yC(n){const c=n.currentTarget;c!=null&&c._ripple&&(c._ripple.showTimerCommit&&(c._ripple.showTimerCommit=null),window.clearTimeout(c._ripple.showTimer))}let fm=!1;function vC(n){!fm&&(n.keyCode===bE.enter||n.keyCode===bE.space)&&(fm=!0,dm(n))}function xC(n){fm=!1,ho(n)}function bC(n){fm&&(fm=!1,ho(n))}function wC(n,c,p){const{value:v,modifiers:I}=c,R=gC(v);if(R||ty.hide(n),n._ripple=n._ripple??{},n._ripple.enabled=R,n._ripple.centered=I.center,n._ripple.circle=I.circle,vN(v)&&v.class&&(n._ripple.class=v.class),R&&!p){if(I.stop){n.addEventListener("touchstart",jE,{passive:!0}),n.addEventListener("mousedown",jE);return}n.addEventListener("touchstart",dm,{passive:!0}),n.addEventListener("touchend",ho,{passive:!0}),n.addEventListener("touchmove",yC,{passive:!0}),n.addEventListener("touchcancel",ho),n.addEventListener("mousedown",dm),n.addEventListener("mouseup",ho),n.addEventListener("mouseleave",ho),n.addEventListener("keydown",vC),n.addEventListener("keyup",xC),n.addEventListener("blur",bC),n.addEventListener("dragstart",ho,{passive:!0})}else!R&&p&&TC(n)}function TC(n){n.removeEventListener("mousedown",dm),n.removeEventListener("touchstart",dm),n.removeEventListener("touchend",ho),n.removeEventListener("touchmove",yC),n.removeEventListener("touchcancel",ho),n.removeEventListener("mouseup",ho),n.removeEventListener("mouseleave",ho),n.removeEventListener("keydown",vC),n.removeEventListener("keyup",xC),n.removeEventListener("dragstart",ho),n.removeEventListener("blur",bC)}function X6(n,c){wC(n,c,!1)}function K6(n){delete n._ripple,TC(n)}function Y6(n,c){if(c.value===c.oldValue)return;const p=gC(c.oldValue);wC(n,c,p)}const SC={mounted:X6,unmounted:K6,updated:Y6},J6=un({appendAvatar:String,appendIcon:po,disabled:Boolean,flat:Boolean,hover:Boolean,image:String,link:{type:Boolean,default:void 0},prependAvatar:String,prependIcon:po,ripple:{type:[Boolean,Object],default:!0},subtitle:{type:[String,Number,Boolean],default:void 0},text:{type:[String,Number,Boolean],default:void 0},title:{type:[String,Number,Boolean],default:void 0},...Ly(),...qi(),...ky(),...Am(),...Z1(),...N6(),...dC(),...$6(),...Rd(),...mC(),...go(),...ku(),...Fy({variant:"elevated"})},"VCard"),Q6=yi()({name:"VCard",directives:{Ripple:SC},props:J6(),setup(n,c){let{attrs:p,slots:v}=c;const{themeClasses:I}=Fu(n),{borderClasses:R}=Oy(n),{colorClasses:D,colorStyles:i,variantClasses:G}=W1(n),{densityClasses:X}=q1(n),{dimensionStyles:q}=Mm(n),{elevationClasses:ee}=X1(n),{loaderClasses:ne}=V6(n),{locationStyles:me}=fC(n),{positionClasses:he}=G6(n),{roundedClasses:ye}=Dd(n),Le=pC(n,p),je=ct(()=>n.link!==!1&&Le.isLink.value),vt=ct(()=>!n.disabled&&n.link!==!1&&(n.link||Le.isClickable.value));return gs(()=>{const Dt=je.value?"a":n.tag,ut=!!(v.title||n.title!=null),ht=!!(v.subtitle||n.subtitle!=null),St=ut||ht,tt=!!(v.append||n.appendAvatar||n.appendIcon),Et=!!(v.prepend||n.prependAvatar||n.prependIcon),pt=!!(v.image||n.image),ot=St||Et||tt,gt=!!(v.text||n.text!=null);return Qp(dt(Dt,Ks({class:["v-card",{"v-card--disabled":n.disabled,"v-card--flat":n.flat,"v-card--hover":n.hover&&!(n.disabled||n.flat),"v-card--link":vt.value},I.value,R.value,D.value,X.value,ee.value,ne.value,he.value,ye.value,G.value,n.class],style:[i.value,q.value,me.value,n.style],onClick:vt.value&&Le.navigate,tabindex:n.disabled?-1:void 0},Le.linkProps),{default:()=>{var yt;return[pt&&dt("div",{key:"image",class:"v-card__image"},[v.image?dt(ml,{key:"image-defaults",disabled:!n.image,defaults:{VImg:{cover:!0,src:n.image}}},v.image):dt(zy,{key:"image-img",cover:!0,src:n.image},null)]),dt(U6,{name:"v-card",active:!!n.loading,color:typeof n.loading=="boolean"?void 0:n.loading},{default:v.loader}),ot&&dt(M6,{key:"item",prependAvatar:n.prependAvatar,prependIcon:n.prependIcon,title:n.title,subtitle:n.subtitle,appendAvatar:n.appendAvatar,appendIcon:n.appendIcon},{default:v.item,prepend:v.prepend,title:v.title,subtitle:v.subtitle,append:v.append}),gt&&dt(lC,{key:"text"},{default:()=>{var ir;return[((ir=v.text)==null?void 0:ir.call(v))??n.text]}}),(yt=v.default)==null?void 0:yt.call(v),v.actions&&dt(w6,null,{default:v.actions}),H1(vt.value,"v-card")]}}),[[p1("ripple"),vt.value&&n.ripple]])}),{}}}),eV=un({disabled:Boolean,group:Boolean,hideOnLeave:Boolean,leaveAbsolute:Boolean,mode:String,origin:String},"transition");function yo(n,c,p){return yi()({name:n,props:eV({mode:p,origin:c}),setup(v,I){let{slots:R}=I;const D={onBeforeEnter(i){v.origin&&(i.style.transformOrigin=v.origin)},onLeave(i){if(v.leaveAbsolute){const{offsetTop:G,offsetLeft:X,offsetWidth:q,offsetHeight:ee}=i;i._transitionInitialStyles={position:i.style.position,top:i.style.top,left:i.style.left,width:i.style.width,height:i.style.height},i.style.position="absolute",i.style.top=`${G}px`,i.style.left=`${X}px`,i.style.width=`${q}px`,i.style.height=`${ee}px`}v.hideOnLeave&&i.style.setProperty("display","none","important")},onAfterLeave(i){if(v.leaveAbsolute&&(i!=null&&i._transitionInitialStyles)){const{position:G,top:X,left:q,width:ee,height:ne}=i._transitionInitialStyles;delete i._transitionInitialStyles,i.style.position=G||"",i.style.top=X||"",i.style.left=q||"",i.style.width=ee||"",i.style.height=ne||""}}};return()=>{const i=v.group?x1:ym;return yl(i,{name:v.disabled?"":n,css:!v.disabled,...v.group?void 0:{mode:v.mode},...v.disabled?{}:D},R.default)}}})}function EC(n,c){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"in-out";return yi()({name:n,props:{mode:{type:String,default:p},disabled:Boolean,group:Boolean},setup(v,I){let{slots:R}=I;const D=v.group?x1:ym;return()=>yl(D,{name:v.disabled?"":n,css:!v.disabled,...v.disabled?{}:c},R.default)}})}function AC(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";const p=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)?"width":"height",v=Fs(`offset-${p}`);return{onBeforeEnter(D){D._parent=D.parentNode,D._initialStyle={transition:D.style.transition,overflow:D.style.overflow,[p]:D.style[p]}},onEnter(D){const i=D._initialStyle;if(!i)return;D.style.setProperty("transition","none","important"),D.style.overflow="hidden";const G=`${D[v]}px`;D.style[p]="0",D.offsetHeight,D.style.transition=i.transition,n&&D._parent&&D._parent.classList.add(n),requestAnimationFrame(()=>{D.style[p]=G})},onAfterEnter:R,onEnterCancelled:R,onLeave(D){D._initialStyle={transition:"",overflow:D.style.overflow,[p]:D.style[p]},D.style.overflow="hidden",D.style[p]=`${D[v]}px`,D.offsetHeight,requestAnimationFrame(()=>D.style[p]="0")},onAfterLeave:I,onLeaveCancelled:I};function I(D){n&&D._parent&&D._parent.classList.remove(n),R(D)}function R(D){if(!D._initialStyle)return;const i=D._initialStyle[p];D.style.overflow=D._initialStyle.overflow,i!=null&&(D.style[p]=i),delete D._initialStyle}}yo("fab-transition","center center","out-in");yo("dialog-bottom-transition");yo("dialog-top-transition");const $E=yo("fade-transition");yo("scale-transition");yo("scroll-x-transition");yo("scroll-x-reverse-transition");yo("scroll-y-transition");yo("scroll-y-reverse-transition");yo("slide-x-transition");yo("slide-x-reverse-transition");yo("slide-y-transition");yo("slide-y-reverse-transition");EC("expand-transition",AC());const tV=EC("expand-x-transition",AC("",!0)),K1=["sm","md","lg","xl","xxl"],Hx=Symbol.for("vuetify:display"),GE={mobileBreakpoint:"lg",thresholds:{xs:0,sm:600,md:960,lg:1280,xl:1920,xxl:2560}},rV=function(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:GE;return _s(GE,n)};function qE(n){return ms&&!n?window.innerWidth:typeof n=="object"&&n.clientWidth||0}function HE(n){return ms&&!n?window.innerHeight:typeof n=="object"&&n.clientHeight||0}function WE(n){const c=ms&&!n?window.navigator.userAgent:"ssr";function p(he){return!!c.match(he)}const v=p(/android/i),I=p(/iphone|ipad|ipod/i),R=p(/cordova/i),D=p(/electron/i),i=p(/chrome/i),G=p(/edge/i),X=p(/firefox/i),q=p(/opera/i),ee=p(/win/i),ne=p(/mac/i),me=p(/linux/i);return{android:v,ios:I,cordova:R,electron:D,chrome:i,edge:G,firefox:X,opera:q,win:ee,mac:ne,linux:me,touch:mN,ssr:c==="ssr"}}function nV(n,c){const{thresholds:p,mobileBreakpoint:v}=rV(n),I=Fn(HE(c)),R=Fn(WE(c)),D=Zi({}),i=Fn(qE(c));function G(){I.value=HE(),i.value=qE()}function X(){G(),R.value=WE()}return Ad(()=>{const q=i.value<p.sm,ee=i.value<p.md&&!q,ne=i.value<p.lg&&!(ee||q),me=i.value<p.xl&&!(ne||ee||q),he=i.value<p.xxl&&!(me||ne||ee||q),ye=i.value>=p.xxl,Le=q?"xs":ee?"sm":ne?"md":me?"lg":he?"xl":"xxl",je=typeof v=="number"?v:p[v],vt=i.value<je;D.xs=q,D.sm=ee,D.md=ne,D.lg=me,D.xl=he,D.xxl=ye,D.smAndUp=!q,D.mdAndUp=!(q||ee),D.lgAndUp=!(q||ee||ne),D.xlAndUp=!(q||ee||ne||me),D.smAndDown=!(ne||me||he||ye),D.mdAndDown=!(me||he||ye),D.lgAndDown=!(he||ye),D.xlAndDown=!ye,D.name=Le,D.height=I.value,D.width=i.value,D.mobile=vt,D.mobileBreakpoint=v,D.platform=R.value,D.thresholds=p}),ms&&window.addEventListener("resize",G,{passive:!0}),{...uy(D),update:X,ssr:!!c}}const MC=un({mobile:{type:Boolean,default:!1},mobileBreakpoint:[Number,String]},"display");function IC(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{mobile:null},c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Tc();const p=Hn(Hx);if(!p)throw new Error("Could not find Vuetify display injection");const v=ct(()=>n.mobile?!0:typeof n.mobileBreakpoint=="number"?p.width.value<n.mobileBreakpoint:n.mobileBreakpoint?p.width.value<p.thresholds.value[n.mobileBreakpoint]:n.mobile===null?p.mobile.value:!1),I=ct(()=>c?{[`${c}--mobile`]:v.value}:{});return{...p,displayClasses:I,mobile:v}}const CC=Symbol.for("vuetify:goto");function PC(){return{container:void 0,duration:300,layout:!1,offset:0,easing:"easeInOutCubic",patterns:{linear:n=>n,easeInQuad:n=>n**2,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n**2:-1+(4-2*n)*n,easeInCubic:n=>n**3,easeOutCubic:n=>--n**3+1,easeInOutCubic:n=>n<.5?4*n**3:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n**4,easeOutQuart:n=>1- --n**4,easeInOutQuart:n=>n<.5?8*n**4:1-8*--n**4,easeInQuint:n=>n**5,easeOutQuint:n=>1+--n**5,easeInOutQuint:n=>n<.5?16*n**5:1+16*--n**5}}}function iV(n){return Y1(n)??(document.scrollingElement||document.body)}function Y1(n){return typeof n=="string"?document.querySelector(n):ZI(n)}function fx(n,c,p){if(typeof n=="number")return c&&p?-n:n;let v=Y1(n),I=0;for(;v;)I+=c?v.offsetLeft:v.offsetTop,v=v.offsetParent;return I}function sV(n,c){return{rtl:c.isRtl,options:_s(PC(),n)}}async function ZE(n,c,p,v){const I=p?"scrollLeft":"scrollTop",R=_s((v==null?void 0:v.options)??PC(),c),D=v==null?void 0:v.rtl.value,i=(typeof n=="number"?n:Y1(n))??0,G=R.container==="parent"&&i instanceof HTMLElement?i.parentElement:iV(R.container),X=typeof R.easing=="function"?R.easing:R.patterns[R.easing];if(!X)throw new TypeError(`Easing function "${R.easing}" not found.`);let q;if(typeof i=="number")q=fx(i,p,D);else if(q=fx(i,p,D)-fx(G,p,D),R.layout){const he=window.getComputedStyle(i).getPropertyValue("--v-layout-top");he&&(q-=parseInt(he,10))}q+=R.offset,q=aV(G,q,!!D,!!p);const ee=G[I]??0;if(q===ee)return Promise.resolve(q);const ne=performance.now();return new Promise(me=>requestAnimationFrame(function he(ye){const je=(ye-ne)/R.duration,vt=Math.floor(ee+(q-ee)*X(Yg(je,0,1)));if(G[I]=vt,je>=1&&Math.abs(vt-G[I])<10)return me(q);if(je>2)return me(G[I]);requestAnimationFrame(he)}))}function oV(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const c=Hn(CC),{isRtl:p}=zd();if(!c)throw new Error("[Vuetify] Could not find injected goto instance");const v={...c,rtl:ct(()=>c.rtl.value||p.value)};async function I(R,D){return ZE(R,_s(n,D),!1,v)}return I.horizontal=async(R,D)=>ZE(R,_s(n,D),!0,v),I}function aV(n,c,p,v){const{scrollWidth:I,scrollHeight:R}=n,[D,i]=n===document.scrollingElement?[window.innerWidth,window.innerHeight]:[n.offsetWidth,n.offsetHeight];let G,X;return v?p?(G=-(I-D),X=0):(G=0,X=I-D):(G=0,X=R+-i),Math.max(Math.min(c,X),G)}const RC=un({modelValue:{type:null,default:void 0},multiple:Boolean,mandatory:[Boolean,String],max:Number,selectedClass:String,disabled:Boolean},"group"),lV=un({value:null,disabled:Boolean,selectedClass:String},"group-item");function cV(n,c){let p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const v=Bs("useGroupItem");if(!v)throw new Error("[Vuetify] useGroupItem composable must be used inside a component setup function");const I=Py();ko(Symbol.for(`${c.description}:id`),I);const R=Hn(c,null);if(!R){if(!p)return R;throw new Error(`[Vuetify] Could not find useGroup injection with symbol ${c.description}`)}const D=ps(n,"value"),i=ct(()=>!!(R.disabled.value||n.disabled));R.register({id:I,value:D,disabled:i},v),Na(()=>{R.unregister(I)});const G=ct(()=>R.isSelected(I)),X=ct(()=>R.items.value[0].id===I),q=ct(()=>R.items.value[R.items.value.length-1].id===I),ee=ct(()=>G.value&&[R.selectedClass.value,n.selectedClass]);return zn(G,ne=>{v.emit("group:selected",{value:ne})},{flush:"sync"}),{id:I,isSelected:G,isFirst:X,isLast:q,toggle:()=>R.select(I,!G.value),select:ne=>R.select(I,ne),selectedClass:ee,value:D,disabled:i,group:R}}function DC(n,c){let p=!1;const v=Zi([]),I=Im(n,"modelValue",[],ne=>ne==null?[]:zC(v,bN(ne)),ne=>{const me=hV(v,ne);return n.multiple?me:me[0]}),R=Bs("useGroup");function D(ne,me){const he=ne,ye=Symbol.for(`${c.description}:id`),je=pd(ye,R==null?void 0:R.vnode).indexOf(me);At(he.value)==null&&(he.value=je,he.useIndexAsValue=!0),je>-1?v.splice(je,0,he):v.push(he)}function i(ne){if(p)return;G();const me=v.findIndex(he=>he.id===ne);v.splice(me,1)}function G(){const ne=v.find(me=>!me.disabled);ne&&n.mandatory==="force"&&!I.value.length&&(I.value=[ne.id])}ua(()=>{G()}),Na(()=>{p=!0}),h1(()=>{for(let ne=0;ne<v.length;ne++)v[ne].useIndexAsValue&&(v[ne].value=ne)});function X(ne,me){const he=v.find(ye=>ye.id===ne);if(!(me&&(he!=null&&he.disabled)))if(n.multiple){const ye=I.value.slice(),Le=ye.findIndex(vt=>vt===ne),je=~Le;if(me=me??!je,je&&n.mandatory&&ye.length<=1||!je&&n.max!=null&&ye.length+1>n.max)return;Le<0&&me?ye.push(ne):Le>=0&&!me&&ye.splice(Le,1),I.value=ye}else{const ye=I.value.includes(ne);if(n.mandatory&&ye)return;I.value=me??!ye?[ne]:[]}}function q(ne){if(n.multiple,I.value.length){const me=I.value[0],he=v.findIndex(je=>je.id===me);let ye=(he+ne)%v.length,Le=v[ye];for(;Le.disabled&&ye!==he;)ye=(ye+ne)%v.length,Le=v[ye];if(Le.disabled)return;I.value=[v[ye].id]}else{const me=v.find(he=>!he.disabled);me&&(I.value=[me.id])}}const ee={register:D,unregister:i,selected:I,select:X,disabled:ps(n,"disabled"),prev:()=>q(v.length-1),next:()=>q(1),isSelected:ne=>I.value.includes(ne),selectedClass:ct(()=>n.selectedClass),items:ct(()=>v),getItemIndex:ne=>uV(v,ne)};return ko(c,ee),ee}function uV(n,c){const p=zC(n,[c]);return p.length?n.findIndex(v=>v.id===p[0]):-1}function zC(n,c){const p=[];return c.forEach(v=>{const I=n.find(D=>Cy(v,D.value)),R=n[v];(I==null?void 0:I.value)!=null?p.push(I.id):R!=null&&p.push(R.id)}),p}function hV(n,c){const p=[];return c.forEach(v=>{const I=n.findIndex(R=>R.id===v);if(~I){const R=n[I];p.push(R.value!=null?R.value:I)}}),p}function Wx(n){let c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"content";const p=AN(),v=In();if(ms){const I=new ResizeObserver(R=>{R.length&&(c==="content"?v.value=R[0].contentRect:v.value=R[0].target.getBoundingClientRect())});Na(()=>{I.disconnect()}),zn(()=>p.el,(R,D)=>{D&&(I.unobserve(D),v.value=void 0),R&&I.observe(R)},{flush:"post"})}return{resizeRef:p,contentRect:mm(v)}}function dV(n){let{selectedElement:c,containerElement:p,isRtl:v,isHorizontal:I}=n;const R=pm(I,p),D=LC(I,v,p),i=pm(I,c),G=OC(I,c),X=i*.4;return D>G?G-X:D+R<G+i?G-R+i+X:D}function fV(n){let{selectedElement:c,containerElement:p,isHorizontal:v}=n;const I=pm(v,p),R=OC(v,c),D=pm(v,c);return R-I/2+D/2}function XE(n,c){const p=n?"scrollWidth":"scrollHeight";return(c==null?void 0:c[p])||0}function pV(n,c){const p=n?"clientWidth":"clientHeight";return(c==null?void 0:c[p])||0}function LC(n,c,p){if(!p)return 0;const{scrollLeft:v,offsetWidth:I,scrollWidth:R}=p;return n?c?R-I+v:v:p.scrollTop}function pm(n,c){const p=n?"offsetWidth":"offsetHeight";return(c==null?void 0:c[p])||0}function OC(n,c){const p=n?"offsetLeft":"offsetTop";return(c==null?void 0:c[p])||0}const mV=Symbol.for("vuetify:v-slide-group"),kC=un({centerActive:Boolean,direction:{type:String,default:"horizontal"},symbol:{type:null,default:mV},nextIcon:{type:po,default:"$next"},prevIcon:{type:po,default:"$prev"},showArrows:{type:[Boolean,String],validator:n=>typeof n=="boolean"||["always","desktop","mobile"].includes(n)},...qi(),...MC({mobile:null}),...go(),...RC({selectedClass:"v-slide-group-item--active"})},"VSlideGroup"),KE=yi()({name:"VSlideGroup",props:kC(),emits:{"update:modelValue":n=>!0},setup(n,c){let{slots:p}=c;const{isRtl:v}=zd(),{displayClasses:I,mobile:R}=IC(n),D=DC(n,n.symbol),i=Fn(!1),G=Fn(0),X=Fn(0),q=Fn(0),ee=ct(()=>n.direction==="horizontal"),{resizeRef:ne,contentRect:me}=Wx(),{resizeRef:he,contentRect:ye}=Wx(),Le=oV(),je=ct(()=>({container:ne.el,duration:200,easing:"easeOutQuart"})),vt=ct(()=>D.selected.value.length?D.items.value.findIndex(cr=>cr.id===D.selected.value[0]):-1),Dt=ct(()=>D.selected.value.length?D.items.value.findIndex(cr=>cr.id===D.selected.value[D.selected.value.length-1]):-1);if(ms){let cr=-1;zn(()=>[D.selected.value,me.value,ye.value,ee.value],()=>{cancelAnimationFrame(cr),cr=requestAnimationFrame(()=>{if(me.value&&ye.value){const rr=ee.value?"width":"height";X.value=me.value[rr],q.value=ye.value[rr],i.value=X.value+1<q.value}if(vt.value>=0&&he.el){const rr=he.el.children[Dt.value];ht(rr,n.centerActive)}})})}const ut=Fn(!1);function ht(cr,rr){let $t=0;rr?$t=fV({containerElement:ne.el,isHorizontal:ee.value,selectedElement:cr}):$t=dV({containerElement:ne.el,isHorizontal:ee.value,isRtl:v.value,selectedElement:cr}),St($t)}function St(cr){if(!ms||!ne.el)return;const rr=pm(ee.value,ne.el),$t=LC(ee.value,v.value,ne.el);if(!(XE(ee.value,ne.el)<=rr||Math.abs(cr-$t)<16)){if(ee.value&&v.value&&ne.el){const{scrollWidth:hi,offsetWidth:pn}=ne.el;cr=hi-pn-cr}ee.value?Le.horizontal(cr,je.value):Le(cr,je.value)}}function tt(cr){const{scrollTop:rr,scrollLeft:$t}=cr.target;G.value=ee.value?$t:rr}function Et(cr){if(ut.value=!0,!(!i.value||!he.el)){for(const rr of cr.composedPath())for(const $t of he.el.children)if($t===rr){ht($t);return}}}function pt(cr){ut.value=!1}let ot=!1;function gt(cr){var rr;!ot&&!ut.value&&!(cr.relatedTarget&&((rr=he.el)!=null&&rr.contains(cr.relatedTarget)))&&Zt(),ot=!1}function yt(){ot=!0}function ir(cr){if(!he.el)return;function rr($t){cr.preventDefault(),Zt($t)}ee.value?cr.key==="ArrowRight"?rr(v.value?"prev":"next"):cr.key==="ArrowLeft"&&rr(v.value?"next":"prev"):cr.key==="ArrowDown"?rr("next"):cr.key==="ArrowUp"&&rr("prev"),cr.key==="Home"?rr("first"):cr.key==="End"&&rr("last")}function zr(cr,rr){if(!cr)return;let $t=cr;do $t=$t==null?void 0:$t[rr==="next"?"nextElementSibling":"previousElementSibling"];while($t!=null&&$t.hasAttribute("disabled"));return $t}function Zt(cr){if(!he.el)return;let rr;if(!cr)rr=SN(he.el)[0];else if(cr==="next"){if(rr=zr(he.el.querySelector(":focus"),cr),!rr)return Zt("first")}else if(cr==="prev"){if(rr=zr(he.el.querySelector(":focus"),cr),!rr)return Zt("last")}else cr==="first"?(rr=he.el.firstElementChild,rr!=null&&rr.hasAttribute("disabled")&&(rr=zr(rr,"next"))):cr==="last"&&(rr=he.el.lastElementChild,rr!=null&&rr.hasAttribute("disabled")&&(rr=zr(rr,"prev")));rr&&rr.focus({preventScroll:!0})}function Ir(cr){const rr=ee.value&&v.value?-1:1,$t=(cr==="prev"?-rr:rr)*X.value;let vi=G.value+$t;if(ee.value&&v.value&&ne.el){const{scrollWidth:hi,offsetWidth:pn}=ne.el;vi+=hi-pn}St(vi)}const yr=ct(()=>({next:D.next,prev:D.prev,select:D.select,isSelected:D.isSelected})),Nr=ct(()=>{switch(n.showArrows){case"always":return!0;case"desktop":return!R.value;case!0:return i.value||Math.abs(G.value)>0;case"mobile":return R.value||i.value||Math.abs(G.value)>0;default:return!R.value&&(i.value||Math.abs(G.value)>0)}}),ar=ct(()=>Math.abs(G.value)>1),Gr=ct(()=>{if(!ne.value)return!1;const cr=XE(ee.value,ne.el),rr=pV(ee.value,ne.el);return cr-rr-Math.abs(G.value)>1});return gs(()=>dt(n.tag,{class:["v-slide-group",{"v-slide-group--vertical":!ee.value,"v-slide-group--has-affixes":Nr.value,"v-slide-group--is-overflowing":i.value},I.value,n.class],style:n.style,tabindex:ut.value||D.selected.value.length?-1:0,onFocus:gt},{default:()=>{var cr,rr,$t;return[Nr.value&&dt("div",{key:"prev",class:["v-slide-group__prev",{"v-slide-group__prev--disabled":!ar.value}],onMousedown:yt,onClick:()=>ar.value&&Ir("prev")},[((cr=p.prev)==null?void 0:cr.call(p,yr.value))??dt($E,null,{default:()=>[dt(oa,{icon:v.value?n.nextIcon:n.prevIcon},null)]})]),dt("div",{key:"container",ref:ne,class:"v-slide-group__container",onScroll:tt},[dt("div",{ref:he,class:"v-slide-group__content",onFocusin:Et,onFocusout:pt,onKeydown:ir},[(rr=p.default)==null?void 0:rr.call(p,yr.value)])]),Nr.value&&dt("div",{key:"next",class:["v-slide-group__next",{"v-slide-group__next--disabled":!Gr.value}],onMousedown:yt,onClick:()=>Gr.value&&Ir("next")},[(($t=p.next)==null?void 0:$t.call(p,yr.value))??dt($E,null,{default:()=>[dt(oa,{icon:v.value?n.prevIcon:n.nextIcon},null)]})])]}})),{selected:D.selected,scrollTo:Ir,scrollOffset:G,focus:Zt,hasPrev:ar,hasNext:Gr}}}),FC=Symbol.for("vuetify:v-chip-group"),_V=un({column:Boolean,filter:Boolean,valueComparator:{type:Function,default:Cy},...kC(),...qi(),...RC({selectedClass:"v-chip--selected"}),...go(),...ku(),...Fy({variant:"tonal"})},"VChipGroup");yi()({name:"VChipGroup",props:_V(),emits:{"update:modelValue":n=>!0},setup(n,c){let{slots:p}=c;const{themeClasses:v}=Fu(n),{isSelected:I,select:R,next:D,prev:i,selected:G}=DC(n,FC);return Ry({VChip:{color:ps(n,"color"),disabled:ps(n,"disabled"),filter:ps(n,"filter"),variant:ps(n,"variant")}}),gs(()=>{const X=KE.filterProps(n);return dt(KE,Ks(X,{class:["v-chip-group",{"v-chip-group--column":n.column},v.value,n.class],style:n.style}),{default:()=>{var q;return[(q=p.default)==null?void 0:q.call(p,{isSelected:I,select:R,next:D,prev:i,selected:G.value})]}})}),{}}});const gV=un({activeClass:String,appendAvatar:String,appendIcon:po,closable:Boolean,closeIcon:{type:po,default:"$delete"},closeLabel:{type:String,default:"$vuetify.close"},draggable:Boolean,filter:Boolean,filterIcon:{type:po,default:"$complete"},label:Boolean,link:{type:Boolean,default:void 0},pill:Boolean,prependAvatar:String,prependIcon:po,ripple:{type:[Boolean,Object],default:!0},text:{type:[String,Number,Boolean],default:void 0},modelValue:{type:Boolean,default:!0},onClick:SE(),onClickOnce:SE(),...Ly(),...qi(),...ky(),...Z1(),...lV(),...Rd(),...mC(),...$1(),...go({tag:"span"}),...ku(),...Fy({variant:"tonal"})},"VChip"),yV=yi()({name:"VChip",directives:{Ripple:SC},props:gV(),emits:{"click:close":n=>!0,"update:modelValue":n=>!0,"group:selected":n=>!0,click:n=>!0},setup(n,c){let{attrs:p,emit:v,slots:I}=c;const{t:R}=L6(),{borderClasses:D}=Oy(n),{colorClasses:i,colorStyles:G,variantClasses:X}=W1(n),{densityClasses:q}=q1(n),{elevationClasses:ee}=X1(n),{roundedClasses:ne}=Dd(n),{sizeClasses:me}=G1(n),{themeClasses:he}=Fu(n),ye=Im(n,"modelValue"),Le=cV(n,FC,!1),je=pC(n,p),vt=ct(()=>n.link!==!1&&je.isLink.value),Dt=ct(()=>!n.disabled&&n.link!==!1&&(!!Le||n.link||je.isClickable.value)),ut=ct(()=>({"aria-label":R(n.closeLabel),onClick(tt){tt.preventDefault(),tt.stopPropagation(),ye.value=!1,v("click:close",tt)}}));function ht(tt){var Et;v("click",tt),Dt.value&&((Et=je.navigate)==null||Et.call(je,tt),Le==null||Le.toggle())}function St(tt){(tt.key==="Enter"||tt.key===" ")&&(tt.preventDefault(),ht(tt))}return()=>{var Zt;const tt=je.isLink.value?"a":n.tag,Et=!!(n.appendIcon||n.appendAvatar),pt=!!(Et||I.append),ot=!!(I.close||n.closable),gt=!!(I.filter||n.filter)&&Le,yt=!!(n.prependIcon||n.prependAvatar),ir=!!(yt||I.prepend),zr=!Le||Le.isSelected.value;return ye.value&&Qp(dt(tt,Ks({class:["v-chip",{"v-chip--disabled":n.disabled,"v-chip--label":n.label,"v-chip--link":Dt.value,"v-chip--filter":gt,"v-chip--pill":n.pill,[`${n.activeClass}`]:n.activeClass&&((Zt=je.isActive)==null?void 0:Zt.value)},he.value,D.value,zr?i.value:void 0,q.value,ee.value,ne.value,me.value,X.value,Le==null?void 0:Le.selectedClass.value,n.class],style:[zr?G.value:void 0,n.style],disabled:n.disabled||void 0,draggable:n.draggable,tabindex:Dt.value?0:void 0,onClick:ht,onKeydown:Dt.value&&!vt.value&&St},je.linkProps),{default:()=>{var Ir;return[H1(Dt.value,"v-chip"),gt&&dt(tV,{key:"filter"},{default:()=>[Qp(dt("div",{class:"v-chip__filter"},[I.filter?dt(ml,{key:"filter-defaults",disabled:!n.filterIcon,defaults:{VIcon:{icon:n.filterIcon}}},I.filter):dt(oa,{key:"filter-icon",icon:n.filterIcon},null)]),[[IM,Le.isSelected.value]])]}),ir&&dt("div",{key:"prepend",class:"v-chip__prepend"},[I.prepend?dt(ml,{key:"prepend-defaults",disabled:!yt,defaults:{VAvatar:{image:n.prependAvatar,start:!0},VIcon:{icon:n.prependIcon,start:!0}}},I.prepend):dt(ti,null,[n.prependIcon&&dt(oa,{key:"prepend-icon",icon:n.prependIcon,start:!0},null),n.prependAvatar&&dt(hm,{key:"prepend-avatar",image:n.prependAvatar,start:!0},null)])]),dt("div",{class:"v-chip__content","data-no-activator":""},[((Ir=I.default)==null?void 0:Ir.call(I,{isSelected:Le==null?void 0:Le.isSelected.value,selectedClass:Le==null?void 0:Le.selectedClass.value,select:Le==null?void 0:Le.select,toggle:Le==null?void 0:Le.toggle,value:Le==null?void 0:Le.value.value,disabled:n.disabled}))??Zs(n.text)]),pt&&dt("div",{key:"append",class:"v-chip__append"},[I.append?dt(ml,{key:"append-defaults",disabled:!Et,defaults:{VAvatar:{end:!0,image:n.appendAvatar},VIcon:{end:!0,icon:n.appendIcon}}},I.append):dt(ti,null,[n.appendIcon&&dt(oa,{key:"append-icon",end:!0,icon:n.appendIcon},null),n.appendAvatar&&dt(hm,{key:"append-avatar",end:!0,image:n.appendAvatar},null)])]),ot&&dt("button",Ks({key:"close",class:"v-chip__close",type:"button","data-testid":"close-chip"},ut.value),[I.close?dt(ml,{key:"close-defaults",defaults:{VIcon:{icon:n.closeIcon,size:"x-small"}}},I.close):dt(oa,{key:"close-icon",icon:n.closeIcon,size:"x-small"},null)])]}}),[[p1("ripple"),Dt.value&&n.ripple,null]])}}}),vV=un({fluid:{type:Boolean,default:!1},...qi(),...Am(),...go()},"VContainer"),xV=yi()({name:"VContainer",props:vV(),setup(n,c){let{slots:p}=c;const{rtlClasses:v}=zd(),{dimensionStyles:I}=Mm(n);return gs(()=>dt(n.tag,{class:["v-container",{"v-container--fluid":n.fluid},v.value,n.class],style:[I.value,n.style]},p)),{}}}),BC=K1.reduce((n,c)=>(n[c]={type:[Boolean,String,Number],default:!1},n),{}),NC=K1.reduce((n,c)=>{const p="offset"+xc(c);return n[p]={type:[String,Number],default:null},n},{}),VC=K1.reduce((n,c)=>{const p="order"+xc(c);return n[p]={type:[String,Number],default:null},n},{}),YE={col:Object.keys(BC),offset:Object.keys(NC),order:Object.keys(VC)};function bV(n,c,p){let v=n;if(!(p==null||p===!1)){if(c){const I=c.replace(n,"");v+=`-${I}`}return n==="col"&&(v="v-"+v),n==="col"&&(p===""||p===!0)||(v+=`-${p}`),v.toLowerCase()}}const wV=["auto","start","end","center","baseline","stretch"],TV=un({cols:{type:[Boolean,String,Number],default:!1},...BC,offset:{type:[String,Number],default:null},...NC,order:{type:[String,Number],default:null},...VC,alignSelf:{type:String,default:null,validator:n=>wV.includes(n)},...qi(),...go()},"VCol"),Mg=yi()({name:"VCol",props:TV(),setup(n,c){let{slots:p}=c;const v=ct(()=>{const I=[];let R;for(R in YE)YE[R].forEach(i=>{const G=n[i],X=bV(R,i,G);X&&I.push(X)});const D=I.some(i=>i.startsWith("v-col-"));return I.push({"v-col":!D||!n.cols,[`v-col-${n.cols}`]:n.cols,[`offset-${n.offset}`]:n.offset,[`order-${n.order}`]:n.order,[`align-self-${n.alignSelf}`]:n.alignSelf}),I});return()=>{var I;return yl(n.tag,{class:[v.value,n.class],style:n.style},(I=p.default)==null?void 0:I.call(p))}}});function SV(n){let{rootEl:c,isSticky:p,layoutItemStyles:v}=n;const I=Fn(!1),R=Fn(0),D=ct(()=>{const X=typeof I.value=="boolean"?"top":I.value;return[p.value?{top:"auto",bottom:"auto",height:void 0}:void 0,I.value?{[X]:oi(R.value)}:{top:v.value.top}]});ua(()=>{zn(p,X=>{X?window.addEventListener("scroll",G,{passive:!0}):window.removeEventListener("scroll",G)},{immediate:!0})}),Na(()=>{window.removeEventListener("scroll",G)});let i=0;function G(){const X=i>window.scrollY?"up":"down",q=c.value.getBoundingClientRect(),ee=parseFloat(v.value.top??0),ne=window.scrollY-Math.max(0,R.value-ee),me=q.height+Math.max(R.value,ee)-window.scrollY-window.innerHeight,he=parseFloat(getComputedStyle(c.value).getPropertyValue("--v-body-scroll-y"))||0;q.height<window.innerHeight-ee?(I.value="top",R.value=ee):X==="up"&&I.value==="bottom"||X==="down"&&I.value==="top"?(R.value=window.scrollY+q.top-he,I.value=!0):X==="down"&&me<=0?(R.value=0,I.value="bottom"):X==="up"&&ne<=0&&(he?I.value!=="top"&&(R.value=-ne+he+ee,I.value="top"):(R.value=q.top+ne,I.value="top")),i=window.scrollY}return{isStuck:I,stickyStyles:D}}const EV=100,AV=20;function JE(n){return(n<0?-1:1)*Math.sqrt(Math.abs(n))*1.41421356237}function QE(n){if(n.length<2)return 0;if(n.length===2)return n[1].t===n[0].t?0:(n[1].d-n[0].d)/(n[1].t-n[0].t);let c=0;for(let p=n.length-1;p>0;p--){if(n[p].t===n[p-1].t)continue;const v=JE(c),I=(n[p].d-n[p-1].d)/(n[p].t-n[p-1].t);c+=(I-v)*Math.abs(I),p===n.length-1&&(c*=.5)}return JE(c)*1e3}function MV(){const n={};function c(I){Array.from(I.changedTouches).forEach(R=>{(n[R.identifier]??(n[R.identifier]=new TN(AV))).push([I.timeStamp,R])})}function p(I){Array.from(I.changedTouches).forEach(R=>{delete n[R.identifier]})}function v(I){var X;const R=(X=n[I])==null?void 0:X.values().reverse();if(!R)throw new Error(`No samples for touch id ${I}`);const D=R[0],i=[],G=[];for(const q of R){if(D[0]-q[0]>EV)break;i.push({t:q[0],d:q[1].clientX}),G.push({t:q[0],d:q[1].clientY})}return{x:QE(i),y:QE(G),get direction(){const{x:q,y:ee}=this,[ne,me]=[Math.abs(q),Math.abs(ee)];return ne>me&&q>=0?"right":ne>me&&q<=0?"left":me>ne&&ee>=0?"down":me>ne&&ee<=0?"up":IV()}}}return{addMovement:c,endTouch:p,getVelocity:v}}function IV(){throw new Error}function CV(n){let{el:c,isActive:p,isTemporary:v,width:I,touchless:R,position:D}=n;ua(()=>{window.addEventListener("touchstart",vt,{passive:!0}),window.addEventListener("touchmove",Dt,{passive:!1}),window.addEventListener("touchend",ut,{passive:!0})}),Na(()=>{window.removeEventListener("touchstart",vt),window.removeEventListener("touchmove",Dt),window.removeEventListener("touchend",ut)});const i=ct(()=>["left","right"].includes(D.value)),{addMovement:G,endTouch:X,getVelocity:q}=MV();let ee=!1;const ne=Fn(!1),me=Fn(0),he=Fn(0);let ye;function Le(St,tt){return(D.value==="left"?St:D.value==="right"?document.documentElement.clientWidth-St:D.value==="top"?St:D.value==="bottom"?document.documentElement.clientHeight-St:ud())-(tt?I.value:0)}function je(St){let tt=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const Et=D.value==="left"?(St-he.value)/I.value:D.value==="right"?(document.documentElement.clientWidth-St-he.value)/I.value:D.value==="top"?(St-he.value)/I.value:D.value==="bottom"?(document.documentElement.clientHeight-St-he.value)/I.value:ud();return tt?Math.max(0,Math.min(1,Et)):Et}function vt(St){if(R.value)return;const tt=St.changedTouches[0].clientX,Et=St.changedTouches[0].clientY,pt=25,ot=D.value==="left"?tt<pt:D.value==="right"?tt>document.documentElement.clientWidth-pt:D.value==="top"?Et<pt:D.value==="bottom"?Et>document.documentElement.clientHeight-pt:ud(),gt=p.value&&(D.value==="left"?tt<I.value:D.value==="right"?tt>document.documentElement.clientWidth-I.value:D.value==="top"?Et<I.value:D.value==="bottom"?Et>document.documentElement.clientHeight-I.value:ud());(ot||gt||p.value&&v.value)&&(ye=[tt,Et],he.value=Le(i.value?tt:Et,p.value),me.value=je(i.value?tt:Et),ee=he.value>-20&&he.value<80,X(St),G(St))}function Dt(St){const tt=St.changedTouches[0].clientX,Et=St.changedTouches[0].clientY;if(ee){if(!St.cancelable){ee=!1;return}const ot=Math.abs(tt-ye[0]),gt=Math.abs(Et-ye[1]);(i.value?ot>gt&&ot>3:gt>ot&&gt>3)?(ne.value=!0,ee=!1):(i.value?gt:ot)>3&&(ee=!1)}if(!ne.value)return;St.preventDefault(),G(St);const pt=je(i.value?tt:Et,!1);me.value=Math.max(0,Math.min(1,pt)),pt>1?he.value=Le(i.value?tt:Et,!0):pt<0&&(he.value=Le(i.value?tt:Et,!1))}function ut(St){if(ee=!1,!ne.value)return;G(St),ne.value=!1;const tt=q(St.changedTouches[0].identifier),Et=Math.abs(tt.x),pt=Math.abs(tt.y);(i.value?Et>pt&&Et>400:pt>Et&&pt>3)?p.value=tt.direction===({left:"right",right:"left",top:"down",bottom:"up"}[D.value]||ud()):p.value=me.value>.5}const ht=ct(()=>ne.value?{transform:D.value==="left"?`translateX(calc(-100% + ${me.value*I.value}px))`:D.value==="right"?`translateX(calc(100% - ${me.value*I.value}px))`:D.value==="top"?`translateY(calc(-100% + ${me.value*I.value}px))`:D.value==="bottom"?`translateY(calc(100% - ${me.value*I.value}px))`:ud(),transition:"none"}:void 0);return Xp(ne,()=>{var Et,pt;const St=((Et=c.value)==null?void 0:Et.style.transform)??null,tt=((pt=c.value)==null?void 0:pt.style.transition)??null;Ad(()=>{var ot,gt,yt,ir;(gt=c.value)==null||gt.style.setProperty("transform",((ot=ht.value)==null?void 0:ot.transform)||"none"),(ir=c.value)==null||ir.style.setProperty("transition",((yt=ht.value)==null?void 0:yt.transition)||null)}),ly(()=>{var ot,gt;(ot=c.value)==null||ot.style.setProperty("transform",St),(gt=c.value)==null||gt.style.setProperty("transition",tt)})}),{isDragging:ne,dragProgress:me,dragStyles:ht}}function ud(){throw new Error}const By={"001":1,AD:1,AE:6,AF:6,AG:0,AI:1,AL:1,AM:1,AN:1,AR:1,AS:0,AT:1,AU:1,AX:1,AZ:1,BA:1,BD:0,BE:1,BG:1,BH:6,BM:1,BN:1,BR:0,BS:0,BT:0,BW:0,BY:1,BZ:0,CA:0,CH:1,CL:1,CM:1,CN:1,CO:0,CR:1,CY:1,CZ:1,DE:1,DJ:6,DK:1,DM:0,DO:0,DZ:6,EC:1,EE:1,EG:6,ES:1,ET:0,FI:1,FJ:1,FO:1,FR:1,GB:1,"GB-alt-variant":0,GE:1,GF:1,GP:1,GR:1,GT:0,GU:0,HK:0,HN:0,HR:1,HU:1,ID:0,IE:1,IL:0,IN:0,IQ:6,IR:6,IS:1,IT:1,JM:0,JO:6,JP:0,KE:0,KG:1,KH:0,KR:0,KW:6,KZ:1,LA:0,LB:1,LI:1,LK:1,LT:1,LU:1,LV:1,LY:6,MC:1,MD:1,ME:1,MH:0,MK:1,MM:0,MN:1,MO:0,MQ:1,MT:0,MV:5,MX:0,MY:1,MZ:0,NI:0,NL:1,NO:1,NP:0,NZ:1,OM:6,PA:0,PE:0,PH:0,PK:0,PL:1,PR:0,PT:0,PY:0,QA:6,RE:1,RO:1,RS:1,RU:1,SA:0,SD:6,SE:1,SG:0,SI:1,SK:1,SM:1,SV:0,SY:6,TH:0,TJ:1,TM:1,TR:1,TT:0,TW:0,UA:1,UM:0,US:0,UY:1,UZ:1,VA:1,VE:0,VI:0,VN:1,WS:0,XK:1,YE:0,ZA:0,ZW:0};function PV(n,c,p){const v=[];let I=[];const R=UC(n),D=jC(n),i=p??By[c.slice(-2).toUpperCase()]??0,G=(R.getDay()-i+7)%7,X=(D.getDay()-i+7)%7;for(let q=0;q<G;q++){const ee=new Date(R);ee.setDate(ee.getDate()-(G-q)),I.push(ee)}for(let q=1;q<=D.getDate();q++){const ee=new Date(n.getFullYear(),n.getMonth(),q);I.push(ee),I.length===7&&(v.push(I),I=[])}for(let q=1;q<7-X;q++){const ee=new Date(D);ee.setDate(ee.getDate()+q),I.push(ee)}return I.length>0&&v.push(I),v}function RV(n,c,p){const v=p??By[c.slice(-2).toUpperCase()]??0,I=new Date(n);for(;I.getDay()!==v;)I.setDate(I.getDate()-1);return I}function DV(n,c){const p=new Date(n),v=((By[c.slice(-2).toUpperCase()]??0)+6)%7;for(;p.getDay()!==v;)p.setDate(p.getDate()+1);return p}function UC(n){return new Date(n.getFullYear(),n.getMonth(),1)}function jC(n){return new Date(n.getFullYear(),n.getMonth()+1,0)}function zV(n){const c=n.split("-").map(Number);return new Date(c[0],c[1]-1,c[2])}const LV=/^([12]\d{3}-([1-9]|0[1-9]|1[0-2])-([1-9]|0[1-9]|[12]\d|3[01]))$/;function $C(n){if(n==null)return new Date;if(n instanceof Date)return n;if(typeof n=="string"){let c;if(LV.test(n))return zV(n);if(c=Date.parse(n),!isNaN(c))return new Date(c)}return null}const eA=new Date(2e3,0,2);function OV(n,c){const p=c??By[n.slice(-2).toUpperCase()]??0;return WI(7).map(v=>{const I=new Date(eA);return I.setDate(eA.getDate()+p+v),new Intl.DateTimeFormat(n,{weekday:"narrow"}).format(I)})}function kV(n,c,p,v){const I=$C(n)??new Date,R=v==null?void 0:v[c];if(typeof R=="function")return R(I,c,p);let D={};switch(c){case"fullDate":D={year:"numeric",month:"long",day:"numeric"};break;case"fullDateWithWeekday":D={weekday:"long",year:"numeric",month:"long",day:"numeric"};break;case"normalDate":const i=I.getDate(),G=new Intl.DateTimeFormat(p,{month:"long"}).format(I);return`${i} ${G}`;case"normalDateWithWeekday":D={weekday:"short",day:"numeric",month:"short"};break;case"shortDate":D={month:"short",day:"numeric"};break;case"year":D={year:"numeric"};break;case"month":D={month:"long"};break;case"monthShort":D={month:"short"};break;case"monthAndYear":D={month:"long",year:"numeric"};break;case"monthAndDate":D={month:"long",day:"numeric"};break;case"weekday":D={weekday:"long"};break;case"weekdayShort":D={weekday:"short"};break;case"dayOfMonth":return new Intl.NumberFormat(p).format(I.getDate());case"hours12h":D={hour:"numeric",hour12:!0};break;case"hours24h":D={hour:"numeric",hour12:!1};break;case"minutes":D={minute:"numeric"};break;case"seconds":D={second:"numeric"};break;case"fullTime":D={hour:"numeric",minute:"numeric"};break;case"fullTime12h":D={hour:"numeric",minute:"numeric",hour12:!0};break;case"fullTime24h":D={hour:"numeric",minute:"numeric",hour12:!1};break;case"fullDateTime":D={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};break;case"fullDateTime12h":D={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0};break;case"fullDateTime24h":D={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",hour12:!1};break;case"keyboardDate":D={year:"numeric",month:"2-digit",day:"2-digit"};break;case"keyboardDateTime":return D={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric"},new Intl.DateTimeFormat(p,D).format(I).replace(/, /g," ");case"keyboardDateTime12h":return D={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",hour12:!0},new Intl.DateTimeFormat(p,D).format(I).replace(/, /g," ");case"keyboardDateTime24h":return D={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",hour12:!1},new Intl.DateTimeFormat(p,D).format(I).replace(/, /g," ");default:D=R??{timeZone:"UTC",timeZoneName:"short"}}return new Intl.DateTimeFormat(p,D).format(I)}function FV(n,c){const p=n.toJsDate(c),v=p.getFullYear(),I=TE(String(p.getMonth()+1),2,"0"),R=TE(String(p.getDate()),2,"0");return`${v}-${I}-${R}`}function BV(n){const[c,p,v]=n.split("-").map(Number);return new Date(c,p-1,v)}function NV(n,c){const p=new Date(n);return p.setMinutes(p.getMinutes()+c),p}function VV(n,c){const p=new Date(n);return p.setHours(p.getHours()+c),p}function UV(n,c){const p=new Date(n);return p.setDate(p.getDate()+c),p}function jV(n,c){const p=new Date(n);return p.setDate(p.getDate()+c*7),p}function $V(n,c){const p=new Date(n);return p.setDate(1),p.setMonth(p.getMonth()+c),p}function GV(n){return n.getFullYear()}function qV(n){return n.getMonth()}function HV(n){return n.getDate()}function WV(n){return new Date(n.getFullYear(),n.getMonth()+1,1)}function ZV(n){return new Date(n.getFullYear(),n.getMonth()-1,1)}function XV(n){return n.getHours()}function KV(n){return n.getMinutes()}function YV(n){return new Date(n.getFullYear(),0,1)}function JV(n){return new Date(n.getFullYear(),11,31)}function QV(n,c){return ry(n,c[0])&&rU(n,c[1])}function eU(n){const c=new Date(n);return c instanceof Date&&!isNaN(c.getTime())}function ry(n,c){return n.getTime()>c.getTime()}function tU(n,c){return ry(Zx(n),Zx(c))}function rU(n,c){return n.getTime()<c.getTime()}function tA(n,c){return n.getTime()===c.getTime()}function nU(n,c){return n.getDate()===c.getDate()&&n.getMonth()===c.getMonth()&&n.getFullYear()===c.getFullYear()}function iU(n,c){return n.getMonth()===c.getMonth()&&n.getFullYear()===c.getFullYear()}function sU(n,c){return n.getFullYear()===c.getFullYear()}function oU(n,c,p){const v=new Date(n),I=new Date(c);switch(p){case"years":return v.getFullYear()-I.getFullYear();case"quarters":return Math.floor((v.getMonth()-I.getMonth()+(v.getFullYear()-I.getFullYear())*12)/4);case"months":return v.getMonth()-I.getMonth()+(v.getFullYear()-I.getFullYear())*12;case"weeks":return Math.floor((v.getTime()-I.getTime())/(1e3*60*60*24*7));case"days":return Math.floor((v.getTime()-I.getTime())/(1e3*60*60*24));case"hours":return Math.floor((v.getTime()-I.getTime())/(1e3*60*60));case"minutes":return Math.floor((v.getTime()-I.getTime())/(1e3*60));case"seconds":return Math.floor((v.getTime()-I.getTime())/1e3);default:return v.getTime()-I.getTime()}}function aU(n,c){const p=new Date(n);return p.setHours(c),p}function lU(n,c){const p=new Date(n);return p.setMinutes(c),p}function cU(n,c){const p=new Date(n);return p.setMonth(c),p}function uU(n,c){const p=new Date(n);return p.setDate(c),p}function hU(n,c){const p=new Date(n);return p.setFullYear(c),p}function Zx(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0)}function dU(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59,999)}class fU{constructor(c){this.locale=c.locale,this.formats=c.formats}date(c){return $C(c)}toJsDate(c){return c}toISO(c){return FV(this,c)}parseISO(c){return BV(c)}addMinutes(c,p){return NV(c,p)}addHours(c,p){return VV(c,p)}addDays(c,p){return UV(c,p)}addWeeks(c,p){return jV(c,p)}addMonths(c,p){return $V(c,p)}getWeekArray(c,p){return PV(c,this.locale,p?Number(p):void 0)}startOfWeek(c,p){return RV(c,this.locale,p?Number(p):void 0)}endOfWeek(c){return DV(c,this.locale)}startOfMonth(c){return UC(c)}endOfMonth(c){return jC(c)}format(c,p){return kV(c,p,this.locale,this.formats)}isEqual(c,p){return tA(c,p)}isValid(c){return eU(c)}isWithinRange(c,p){return QV(c,p)}isAfter(c,p){return ry(c,p)}isAfterDay(c,p){return tU(c,p)}isBefore(c,p){return!ry(c,p)&&!tA(c,p)}isSameDay(c,p){return nU(c,p)}isSameMonth(c,p){return iU(c,p)}isSameYear(c,p){return sU(c,p)}setMinutes(c,p){return lU(c,p)}setHours(c,p){return aU(c,p)}setMonth(c,p){return cU(c,p)}setDate(c,p){return uU(c,p)}setYear(c,p){return hU(c,p)}getDiff(c,p,v){return oU(c,p,v)}getWeekdays(c){return OV(this.locale,c?Number(c):void 0)}getYear(c){return GV(c)}getMonth(c){return qV(c)}getDate(c){return HV(c)}getNextMonth(c){return WV(c)}getPreviousMonth(c){return ZV(c)}getHours(c){return XV(c)}getMinutes(c){return KV(c)}startOfDay(c){return Zx(c)}endOfDay(c){return dU(c)}startOfYear(c){return YV(c)}endOfYear(c){return JV(c)}}const pU=Symbol.for("vuetify:date-options"),rA=Symbol.for("vuetify:date-adapter");function mU(n,c){const p=_s({adapter:fU,locale:{af:"af-ZA",bg:"bg-BG",ca:"ca-ES",ckb:"",cs:"cs-CZ",de:"de-DE",el:"el-GR",en:"en-US",et:"et-EE",fa:"fa-IR",fi:"fi-FI",hr:"hr-HR",hu:"hu-HU",he:"he-IL",id:"id-ID",it:"it-IT",ja:"ja-JP",ko:"ko-KR",lv:"lv-LV",lt:"lt-LT",nl:"nl-NL",no:"no-NO",pl:"pl-PL",pt:"pt-PT",ro:"ro-RO",ru:"ru-RU",sk:"sk-SK",sl:"sl-SI",srCyrl:"sr-SP",srLatn:"sr-SP",sv:"sv-SE",th:"th-TH",tr:"tr-TR",az:"az-AZ",uk:"uk-UA",vi:"vi-VN",zhHans:"zh-CN",zhHant:"zh-TW"}},n);return{options:p,instance:_U(p,c)}}function _U(n,c){const p=Zi(typeof n.adapter=="function"?new n.adapter({locale:n.locale[c.current.value]??c.current.value,formats:n.formats}):n.adapter);return zn(c.current,v=>{p.locale=n.locale[v]??v??p.locale}),p}const ny=Symbol.for("vuetify:layout"),GC=Symbol.for("vuetify:layout-item"),nA=1e3,gU=un({overlaps:{type:Array,default:()=>[]},fullHeight:Boolean},"layout"),yU=un({name:{type:String},order:{type:[Number,String],default:0},absolute:Boolean},"layout-item");function vU(){const n=Hn(ny);if(!n)throw new Error("[Vuetify] Could not find injected layout");return{getLayoutItem:n.getLayoutItem,mainRect:n.mainRect,mainStyles:n.mainStyles}}function xU(n){const c=Hn(ny);if(!c)throw new Error("[Vuetify] Could not find injected layout");const p=n.id??`layout-item-${Py()}`,v=Bs("useLayoutItem");ko(GC,{id:p});const I=Fn(!1);WA(()=>I.value=!0),HA(()=>I.value=!1);const{layoutItemStyles:R,layoutItemScrimStyles:D}=c.register(v,{...n,active:ct(()=>I.value?!1:n.active.value),id:p});return Na(()=>c.unregister(p)),{layoutItemStyles:R,layoutRect:c.layoutRect,layoutItemScrimStyles:D}}const bU=(n,c,p,v)=>{let I={top:0,left:0,right:0,bottom:0};const R=[{id:"",layer:{...I}}];for(const D of n){const i=c.get(D),G=p.get(D),X=v.get(D);if(!i||!G||!X)continue;const q={...I,[i.value]:parseInt(I[i.value],10)+(X.value?parseInt(G.value,10):0)};R.push({id:D,layer:q}),I=q}return R};function wU(n){const c=Hn(ny,null),p=ct(()=>c?c.rootZIndex.value-100:nA),v=In([]),I=Zi(new Map),R=Zi(new Map),D=Zi(new Map),i=Zi(new Map),G=Zi(new Map),{resizeRef:X,contentRect:q}=Wx(),ee=ct(()=>{const St=new Map,tt=n.overlaps??[];for(const Et of tt.filter(pt=>pt.includes(":"))){const[pt,ot]=Et.split(":");if(!v.value.includes(pt)||!v.value.includes(ot))continue;const gt=I.get(pt),yt=I.get(ot),ir=R.get(pt),zr=R.get(ot);!gt||!yt||!ir||!zr||(St.set(ot,{position:gt.value,amount:parseInt(ir.value,10)}),St.set(pt,{position:yt.value,amount:-parseInt(zr.value,10)}))}return St}),ne=ct(()=>{const St=[...new Set([...D.values()].map(Et=>Et.value))].sort((Et,pt)=>Et-pt),tt=[];for(const Et of St){const pt=v.value.filter(ot=>{var gt;return((gt=D.get(ot))==null?void 0:gt.value)===Et});tt.push(...pt)}return bU(tt,I,R,i)}),me=ct(()=>!Array.from(G.values()).some(St=>St.value)),he=ct(()=>ne.value[ne.value.length-1].layer),ye=ct(()=>({"--v-layout-left":oi(he.value.left),"--v-layout-right":oi(he.value.right),"--v-layout-top":oi(he.value.top),"--v-layout-bottom":oi(he.value.bottom),...me.value?void 0:{transition:"none"}})),Le=ct(()=>ne.value.slice(1).map((St,tt)=>{let{id:Et}=St;const{layer:pt}=ne.value[tt],ot=R.get(Et),gt=I.get(Et);return{id:Et,...pt,size:Number(ot.value),position:gt.value}})),je=St=>Le.value.find(tt=>tt.id===St),vt=Bs("createLayout"),Dt=Fn(!1);ua(()=>{Dt.value=!0}),ko(ny,{register:(St,tt)=>{let{id:Et,order:pt,position:ot,layoutSize:gt,elementSize:yt,active:ir,disableTransitions:zr,absolute:Zt}=tt;D.set(Et,pt),I.set(Et,ot),R.set(Et,gt),i.set(Et,ir),zr&&G.set(Et,zr);const yr=pd(GC,vt==null?void 0:vt.vnode).indexOf(St);yr>-1?v.value.splice(yr,0,Et):v.value.push(Et);const Nr=ct(()=>Le.value.findIndex(rr=>rr.id===Et)),ar=ct(()=>p.value+ne.value.length*2-Nr.value*2),Gr=ct(()=>{const rr=ot.value==="left"||ot.value==="right",$t=ot.value==="right",vi=ot.value==="bottom",hi=yt.value??gt.value,pn=hi===0?"%":"px",Pt={[ot.value]:0,zIndex:ar.value,transform:`translate${rr?"X":"Y"}(${(ir.value?0:-(hi===0?100:hi))*($t||vi?-1:1)}${pn})`,position:Zt.value||p.value!==nA?"absolute":"fixed",...me.value?void 0:{transition:"none"}};if(!Dt.value)return Pt;const er=Le.value[Nr.value];if(!er)throw new Error(`[Vuetify] Could not find layout item "${Et}"`);const Kt=ee.value.get(Et);return Kt&&(er[Kt.position]+=Kt.amount),{...Pt,height:rr?`calc(100% - ${er.top}px - ${er.bottom}px)`:yt.value?`${yt.value}px`:void 0,left:$t?void 0:`${er.left}px`,right:$t?`${er.right}px`:void 0,top:ot.value!=="bottom"?`${er.top}px`:void 0,bottom:ot.value!=="top"?`${er.bottom}px`:void 0,width:rr?yt.value?`${yt.value}px`:void 0:`calc(100% - ${er.left}px - ${er.right}px)`}}),cr=ct(()=>({zIndex:ar.value-1}));return{layoutItemStyles:Gr,layoutItemScrimStyles:cr,zIndex:ar}},unregister:St=>{D.delete(St),I.delete(St),R.delete(St),i.delete(St),G.delete(St),v.value=v.value.filter(tt=>tt!==St)},mainRect:he,mainStyles:ye,getLayoutItem:je,items:Le,layoutRect:q,rootZIndex:p});const ut=ct(()=>["v-layout",{"v-layout--full-height":n.fullHeight}]),ht=ct(()=>({zIndex:c?p.value:void 0,position:c?"relative":void 0,overflow:c?"hidden":void 0}));return{layoutClasses:ut,layoutStyles:ht,getLayoutItem:je,items:Le,layoutRect:q,layoutRef:X}}const TU=un({closeDelay:[Number,String],openDelay:[Number,String]},"delay");function SU(n,c){let p=()=>{};function v(D){p==null||p();const i=Number(D?n.openDelay:n.closeDelay);return new Promise(G=>{p=EN(i,()=>{c==null||c(D),G(D)})})}function I(){return v(!0)}function R(){return v(!1)}return{clearDelay:p,runOpenDelay:I,runCloseDelay:R}}function EU(){const c=Bs("useScopeId").vnode.scopeId;return{scopeId:c?{[c]:""}:void 0}}function qC(){const n=Fn(!1);return ua(()=>{window.requestAnimationFrame(()=>{n.value=!0})}),{ssrBootStyles:ct(()=>n.value?void 0:{transition:"none !important"}),isBooted:mm(n)}}const AU=["start","end","left","right","top","bottom"],MU=un({color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:{type:Boolean,default:null},railWidth:{type:[Number,String],default:56},scrim:{type:[Boolean,String],default:!0},image:String,temporary:Boolean,persistent:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:n=>AU.includes(n)},sticky:Boolean,...Ly(),...qi(),...TU(),...MC({mobile:null}),...Z1(),...yU(),...Rd(),...go({tag:"nav"}),...ku()},"VNavigationDrawer"),IU=yi()({name:"VNavigationDrawer",props:MU(),emits:{"update:modelValue":n=>!0,"update:rail":n=>!0},setup(n,c){let{attrs:p,emit:v,slots:I}=c;const{isRtl:R}=zd(),{themeClasses:D}=Fu(n),{borderClasses:i}=Oy(n),{backgroundColorClasses:G,backgroundColorStyles:X}=xd(ps(n,"color")),{elevationClasses:q}=X1(n),{displayClasses:ee,mobile:ne}=IC(n),{roundedClasses:me}=Dd(n),he=H6(),ye=Im(n,"modelValue",null,Gr=>!!Gr),{ssrBootStyles:Le}=qC(),{scopeId:je}=EU(),vt=In(),Dt=Fn(!1),{runOpenDelay:ut,runCloseDelay:ht}=SU(n,Gr=>{Dt.value=Gr}),St=ct(()=>n.rail&&n.expandOnHover&&Dt.value?Number(n.width):Number(n.rail?n.railWidth:n.width)),tt=ct(()=>Ux(n.location,R.value)),Et=ct(()=>n.persistent),pt=ct(()=>!n.permanent&&(ne.value||n.temporary)),ot=ct(()=>n.sticky&&!pt.value&&tt.value!=="bottom");Xp(()=>n.expandOnHover&&n.rail!=null,()=>{zn(Dt,Gr=>v("update:rail",!Gr))}),Xp(()=>!n.disableResizeWatcher,()=>{zn(pt,Gr=>!n.permanent&&Ws(()=>ye.value=!Gr))}),Xp(()=>!n.disableRouteWatcher&&!!he,()=>{zn(he.currentRoute,()=>pt.value&&(ye.value=!1))}),zn(()=>n.permanent,Gr=>{Gr&&(ye.value=!0)}),n.modelValue==null&&!pt.value&&(ye.value=n.permanent||!ne.value);const{isDragging:gt,dragProgress:yt}=CV({el:vt,isActive:ye,isTemporary:pt,width:St,touchless:ps(n,"touchless"),position:tt}),ir=ct(()=>{const Gr=pt.value?0:n.rail&&n.expandOnHover?Number(n.railWidth):St.value;return gt.value?Gr*yt.value:Gr}),{layoutItemStyles:zr,layoutItemScrimStyles:Zt}=xU({id:n.name,order:ct(()=>parseInt(n.order,10)),position:tt,layoutSize:ir,elementSize:St,active:ct(()=>ye.value||gt.value),disableTransitions:ct(()=>gt.value),absolute:ct(()=>n.absolute||ot.value&&typeof Ir.value!="string")}),{isStuck:Ir,stickyStyles:yr}=SV({rootEl:vt,isSticky:ot,layoutItemStyles:zr}),Nr=xd(ct(()=>typeof n.scrim=="string"?n.scrim:null)),ar=ct(()=>({...gt.value?{opacity:yt.value*.2,transition:"none"}:void 0,...Zt.value}));return Ry({VList:{bgColor:"transparent"}}),gs(()=>{const Gr=I.image||n.image;return dt(ti,null,[dt(n.tag,Ks({ref:vt,onMouseenter:ut,onMouseleave:ht,class:["v-navigation-drawer",`v-navigation-drawer--${tt.value}`,{"v-navigation-drawer--expand-on-hover":n.expandOnHover,"v-navigation-drawer--floating":n.floating,"v-navigation-drawer--is-hovering":Dt.value,"v-navigation-drawer--rail":n.rail,"v-navigation-drawer--temporary":pt.value,"v-navigation-drawer--persistent":Et.value,"v-navigation-drawer--active":ye.value,"v-navigation-drawer--sticky":ot.value},D.value,G.value,i.value,ee.value,q.value,me.value,n.class],style:[X.value,zr.value,Le.value,yr.value,n.style]},je,p),{default:()=>{var cr,rr,$t;return[Gr&&dt("div",{key:"image",class:"v-navigation-drawer__img"},[I.image?dt(ml,{key:"image-defaults",disabled:!n.image,defaults:{VImg:{alt:"",cover:!0,height:"inherit",src:n.image}}},I.image):dt(zy,{key:"image-img",alt:"",cover:!0,height:"inherit",src:n.image},null)]),I.prepend&&dt("div",{class:"v-navigation-drawer__prepend"},[(cr=I.prepend)==null?void 0:cr.call(I)]),dt("div",{class:"v-navigation-drawer__content"},[(rr=I.default)==null?void 0:rr.call(I)]),I.append&&dt("div",{class:"v-navigation-drawer__append"},[($t=I.append)==null?void 0:$t.call(I)])]}}),dt(ym,{name:"fade-transition"},{default:()=>[pt.value&&(gt.value||ye.value)&&!!n.scrim&&dt("div",Ks({class:["v-navigation-drawer__scrim",Nr.backgroundColorClasses.value],style:[ar.value,Nr.backgroundColorStyles.value],onClick:()=>{Et.value||(ye.value=!1)}},je),null)]})])}),{isStuck:Ir}}}),CU={class:"mark"},PU={class:"mark-parent"},RU={class:"mark-types"},DU={class:"name"},zU={class:"total"},LU={name:"BassDrawer"},OU=ei({...LU,setup(n){const c=O5(),p=pN(),v=In(""),I=ct(()=>{const X=[];return(v.value?p.marks.filter(ee=>ee.mark_type_name.toLowerCase().includes(v.value.toLowerCase())):p.marks).forEach(ee=>{const ne=X.find(me=>me.name==ee.mark_type_parent);ne?(ne.list.push(ee),ne.total=ne.list.reduce((me,he)=>me+he.marks.length,0)):X.push({name:ee.mark_type_parent,list:[ee],total:ee.marks.length})}),X});zn([()=>p.unshowMarks,()=>p.showName],()=>{var X;(X=window.$gmap)==null||X.addPoints(p.fillterMarks,p.showName,p.pointsIds)},{deep:!0});function R(){var X;(X=window.$gmap)==null||X.addPoints(p.fillterMarks,p.showName,p.pointsIds)}function D(X){p.unshowMarks.includes(X.id)?p.unshowMarks=p.unshowMarks.filter(q=>q!=X.id):p.unshowMarks.push(X.id)}function i(){p.unshowMarks=p.marks.map(X=>X.id)}function G(){p.unshowMarks=[]}return(X,q)=>{const ee=A5,ne=L5,me=AF,he=Hs,ye=e5;return vr(),Dn(IU,{class:"drawer",modelValue:At(c).drawer,"onUpdate:modelValue":q[3]||(q[3]=Le=>At(c).drawer=Le),width:"375"},{default:An(()=>[dt(Q6,null,{default:An(()=>[dt(lC,{class:"content"},{default:An(()=>[dt(Mg,{cols:"12"},{default:An(()=>q[4]||(q[4]=[wn("h1",{class:"title"},"潜行者2 互动地图",-1)])),_:1}),dt(Mg,{cols:"12"},{default:An(()=>[dt(zy,{cover:"",src:"https://mod.3dmgame.com/static/upload/logo/croppedImg_67e41b904f5c9.jpg"})]),_:1}),dt(Mg,{cols:"12",class:"buttons"},{default:An(()=>[wn("div",null,[dt(ee,{onClick:G},{default:An(()=>q[5]||(q[5]=[Np("显示全部")])),_:1}),dt(ee,{onClick:i},{default:An(()=>q[6]||(q[6]=[Np("隐藏全部")])),_:1})]),wn("div",null,[dt(ne,{modelValue:At(p).showName,"onUpdate:modelValue":q[0]||(q[0]=Le=>At(p).showName=Le),class:"ml-2",style:{"--el-switch-on-color":"#13ce66","--el-switch-off-color":"#ff4949"},"active-text":"显示标记点名称"},null,8,["modelValue"])])]),_:1}),dt(Mg,{cols:"12"},{default:An(()=>[dt(ye,{modelValue:At(v),"onUpdate:modelValue":q[1]||(q[1]=Le=>Qn(v)?v.value=Le:null),placeholder:"搜索标记点",onInput:R},{append:An(()=>[dt(ee,null,{default:An(()=>[dt(he,null,{default:An(()=>[dt(me)]),_:1})]),_:1})]),_:1},8,["modelValue"]),(vr(!0),vn(ti,null,VT(At(I),Le=>(vr(),vn("div",CU,[wn("h3",PU,Zs(Le.name),1),wn("div",RU,[(vr(!0),vn(ti,null,VT(Le.list,je=>(vr(),Dn(yV,{class:Rn(["type-list",{unshow:At(p).unshowMarks.includes(je.id)}]),variant:"text",label:"",onClick:vt=>D(je)},{prepend:An(()=>[dt(hm,{image:je.mark_type_icon,size:"25"},null,8,["image"])]),append:An(()=>[wn("span",zU,Zs(Le.total),1)]),default:An(()=>[wn("span",DU,Zs(je.mark_type_name),1)]),_:2},1032,["onClick","class"]))),256))])]))),256))]),_:1})]),_:1})]),_:1}),wn("div",{class:"sidebar-close",onClick:q[2]||(q[2]=Le=>At(c).drawer=!At(c).drawer)},[At(c).drawer?(vr(),Dn(oa,{key:0},{default:An(()=>q[7]||(q[7]=[Np("mdi-chevron-double-left")])),_:1})):(vr(),Dn(oa,{key:1},{default:An(()=>q[8]||(q[8]=[Np("mdi-chevron-double-right")])),_:1}))])]),_:1},8,["modelValue"])}}}),kU=b1(OU,[["__scopeId","data-v-d11252fb"]]),FU={name:"DefaultLayout"},BU=un({...qi(),...Am(),...gU()},"VLayout"),NU=yi()({name:"VLayout",props:BU(),setup(n,c){let{slots:p}=c;const{layoutClasses:v,layoutStyles:I,getLayoutItem:R,items:D,layoutRef:i}=wU(n),{dimensionStyles:G}=Mm(n);return gs(()=>{var X;return dt("div",{ref:i,class:[v.value,n.class],style:[G.value,I.value,n.style]},[(X=p.default)==null?void 0:X.call(p)])}),{getLayoutItem:R,items:D}}}),VU=un({scrollable:Boolean,...qi(),...Am(),...go({tag:"main"})},"VMain"),UU=yi()({name:"VMain",props:VU(),setup(n,c){let{slots:p}=c;const{dimensionStyles:v}=Mm(n),{mainStyles:I}=vU(),{ssrBootStyles:R}=qC();return gs(()=>dt(n.tag,{class:["v-main",{"v-main--scrollable":n.scrollable},n.class],style:[I.value,R.value,v.value,n.style]},{default:()=>{var D,i;return[n.scrollable?dt("div",{class:"v-main__scroller"},[(D=p.default)==null?void 0:D.call(p)]):(i=p.default)==null?void 0:i.call(p)]}})),{}}});function jU(n,c,p,v,I,R){const D=kU,i=KA("RouterView");return vr(),Dn(NU,null,{default:An(()=>[dt(D),dt(UU,null,{default:An(()=>[dt(xV,{style:{padding:"0"},fluid:""},{default:An(()=>[dt(i)]),_:1})]),_:1})]),_:1})}const $U=b1(FU,[["render",jU]]),iA={default:$U};function GU(n){function c(p,v=!0){return p.map(I=>{var R,D,i,G,X,q;if(((R=I.children)==null?void 0:R.length)>0&&(I.children=c(I.children,!1)),v){if(!I.component&&((D=I.children)==null?void 0:D.find(ne=>{var me;return(ne.path===""||ne.path==="/")&&((me=ne.meta)==null?void 0:me.isLayout)})))return I;if(((i=I.meta)==null?void 0:i.layout)!==!1)return{path:I.path,component:iA[((G=I.meta)==null?void 0:G.layout)||"default"],children:I.path==="/"?[I]:[{...I,path:""}],meta:{isLayout:!0}}}return(X=I.meta)!=null&&X.layout?{path:I.path,component:iA[(q=I.meta)==null?void 0:q.layout],children:[{...I,path:""}],meta:{isLayout:!0}}:I})}return c(n)}const qU=CO({history:iO("/"),routes:GU(LO)});function HC(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{blueprint:c,...p}=n,v=_s(c,p),{aliases:I={},components:R={},directives:D={}}=v,i=IN(v.defaults),G=nV(v.display,v.ssr),X=d6(v.theme),q=l6(v.icons),ee=z6(v.locale),ne=mU(v.date,ee),me=sV(v.goTo,ee);return{install:ye=>{for(const Le in D)ye.directive(Le,D[Le]);for(const Le in R)ye.component(Le,R[Le]);for(const Le in I)ye.component(Le,Em({...I[Le],name:Le,aliasName:I[Le].name}));if(X.install(ye),ye.provide(Ed,i),ye.provide(Hx,G),ye.provide(Qg,X),ye.provide($x,q),ye.provide(ey,ee),ye.provide(pU,ne.options),ye.provide(rA,ne.instance),ye.provide(CC,me),ms&&v.ssr)if(ye.$nuxt)ye.$nuxt.hook("app:suspense:resolve",()=>{G.update()});else{const{mount:Le}=ye;ye.mount=function(){const je=Le(...arguments);return Ws(()=>G.update()),ye.mount=Le,je}}Py.reset(),ye.mixin({computed:{$vuetify(){return Zi({defaults:hd.call(this,Ed),display:hd.call(this,Hx),theme:hd.call(this,Qg),icons:hd.call(this,$x),locale:hd.call(this,ey),date:hd.call(this,rA)})}}})},defaults:i,display:G,theme:X,icons:q,locale:ee,date:ne,goTo:me}}const HU="3.7.18";HC.version=HU;function hd(n){var v,I;const c=this.$,p=((v=c.parent)==null?void 0:v.provides)??((I=c.vnode.appContext)==null?void 0:I.provides);if(p&&n in p)return p[n]}const WU=HC({theme:{defaultTheme:"dark"}}),Ny=_L(ML);Ny.use(vL());Ny.use(WU);Ny.use(qU);Ny.mount("#app");export{Zs as $,vr as A,by as B,Qr as C,rm as D,Fn as E,QA as F,am as G,X4 as H,Du as I,vn as J,qn as K,wn as L,An as M,Qp as N,RM as O,Rn as P,dt as Q,Hs as R,QU as S,XU as T,IM as U,ym as V,e8 as W,Cu as X,ti as Y,VT as Z,wm as _,Wg as a,Zi as a0,d1 as a1,P4 as a2,aF as a3,kF as a4,l1 as a5,s8 as a6,r8 as a7,Qx as a8,ix as a9,t8 as aa,Np as ab,a8 as ac,o8 as ad,uo as ae,n8 as af,i8 as ag,XD as ah,nI as ai,jF as aj,Ks as ak,ZU as al,Az as am,YU as an,M5 as ao,Q6 as ap,E6 as aq,A5 as ar,oa as as,lC as at,yV as au,b1 as av,l8 as aw,O5 as ax,pN as ay,_4 as b,Hn as c,ct as d,vd as e,In as f,ha as g,xm as h,M1 as i,Qn as j,JU as k,Na as l,KU as m,ei as n,ua as o,sa as p,E4 as q,S1 as r,Ws as s,jn as t,At as u,ko as v,zn as w,bm as x,Au as y,Dn as z};
